<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>OpenID Connect | hyunyoun's Blog</title>
<meta name=keywords content="Security,Authentication,OpenID-Connect,OIDC"><meta name=description content="OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/security/authentication/openid-connect/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.9a2bbe2d8b5afa9d4df22976abb7b72f1f7f1c467d2b30f03090108f9496ae6c.css integrity="sha256-miu+LYta+p1N8il2q7e3Lx9/HEZ9KzDwMJAQj5SWrmw=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/security/authentication/openid-connect/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/security/authentication/openid-connect/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="OpenID Connect"><meta property="og:description" content="OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-06T11:24:00+00:00"><meta property="article:modified_time" content="2024-11-06T11:24:00+00:00"><meta property="article:tag" content="Security"><meta property="article:tag" content="Authentication"><meta property="article:tag" content="OpenID-Connect"><meta property="article:tag" content="OIDC"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="OpenID Connect"><meta name=twitter:description content="OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"IT Security","item":"https://buenhyden.github.io/posts/security/"},{"@type":"ListItem","position":3,"name":"인증 (authentication)","item":"https://buenhyden.github.io/posts/security/authentication/"},{"@type":"ListItem","position":4,"name":"OpenID Connect","item":"https://buenhyden.github.io/posts/security/authentication/openid-connect/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OpenID Connect","name":"OpenID Connect","description":"OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공","keywords":["Security","Authentication","OpenID-Connect","OIDC"],"articleBody":"OpenID Connect (OIDC) OpenID Connect (OIDC)는 OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공한다.\n정의와 목적 OIDC는 OAuth 2.0을 확장하여 인증 기능을 추가한 프로토콜입니다. 사용자 신원 확인과 기본 프로필 정보 제공을 목적으로 합니다. 작동 방식 OAuth 2.0 흐름을 기반으로 하며, ID 토큰이라는 추가적인 토큰을 발급합니다. ID 토큰은 JWT(JSON Web Token) 형식으로, 사용자 정보를 포함합니다. 주요 구성 요소 ID 토큰 사용자 인증 정보를 포함한 JWT\n1 2 3 4 5 6 7 8 class IDToken: def __init__(self, token_data: Dict): self.sub = token_data['sub'] # 사용자 고유 식별자 self.iss = token_data['iss'] # 토큰 발행자 self.aud = token_data['aud'] # 토큰 수신자 self.exp = token_data['exp'] # 만료 시간 self.iat = token_data['iat'] # 발행 시간 self.nonce = token_data.get('nonce') # 재생 공격 방지 UserInfo 엔드포인트 추가적인 사용자 정보를 제공하는 API\n1 2 3 4 5 6 7 8 async def get_userinfo(self, access_token: str) -\u003e Dict: \"\"\"UserInfo 엔드포인트에서 사용자 정보 획득\"\"\" async with httpx.AsyncClient() as client: response = await client.get( self.userinfo_endpoint, headers={\"Authorization\": f\"Bearer {access_token}\"} ) return response.json() 표준화된 클레임 name, email 등 사용자 정보를 표현하는 표준 필드\nOAuth 2.0과의 차이점 OIDC는 인증에 중점을 두며, OAuth 2.0은 권한 부여에 초점을 맞춥니다. OIDC는 ID 토큰을 통해 사용자 정보를 직접 제공합니다. 장점 단일 로그인(SSO) 구현 용이 표준화된 프로토콜로 상호 운용성 확보 다양한 클라이언트 유형(웹, 모바일 등) 지원 OpenID Connect는 여러 보안 메커니즘을 제공\n1 2 3 4 5 6 7 8 9 10 class SecurityMeasures: @staticmethod def validate_tokens(id_token: str, nonce: str, expected_aud: str): \"\"\"토큰 유효성 검증\"\"\" claims = jwt.decode(id_token, verify=True) # 필수 검증 항목 assert claims['aud'] == expected_aud # 올바른 수신자 assert claims['nonce'] == nonce # 재생 공격 방지 assert claims['exp'] \u003e time.time() # 만료 확인 사용 사례 소셜 로그인 구현 엔터프라이즈 SSO 솔루션 다중 서비스 환경에서의 통합 인증 OpenID Connect의 주요 흐름(Flow) Authorization Code Flow: 가장 안전하고 일반적인 방식입니다. Implicit Flow: 단순화된 방식이지만, 보안성이 낮습니다. Hybrid Flow: 두 가지 방식의 장점을 결합한 방식입니다. OpenID Connect의 기본 구현 Python 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 from fastapi import FastAPI, HTTPException import httpx from jose import jwt from typing import Dict class OpenIDConnectClient: def __init__(self): self.client_id = \"your_client_id\" self.client_secret = \"your_client_secret\" self.redirect_uri = \"http://localhost:8000/callback\" # OpenID Provider 설정 self.authorization_endpoint = \"https://provider.com/auth\" self.token_endpoint = \"https://provider.com/token\" self.userinfo_endpoint = \"https://provider.com/userinfo\" async def get_authorization_url(self) -\u003e str: \"\"\"인증 URL 생성\"\"\" params = { \"client_id\": self.client_id, \"response_type\": \"code\", \"scope\": \"openid profile email\", # OpenID Connect 필수 스코프 \"redirect_uri\": self.redirect_uri, \"state\": self.generate_state(), \"nonce\": self.generate_nonce() # OIDC 보안 요구사항 } return f\"{self.authorization_endpoint}?{'\u0026'.join(f'{k}={v}' for k, v in params.items())}\" async def handle_callback(self, code: str) -\u003e Dict: \"\"\"인증 코드를 토큰으로 교환하고 사용자 정보 획득\"\"\" # 토큰 획득 tokens = await self.exchange_code_for_tokens(code) # ID 토큰 검증 id_token = self.verify_id_token(tokens['id_token']) # 추가 사용자 정보 획득 userinfo = await self.get_userinfo(tokens['access_token']) return { \"id_token_claims\": id_token, \"userinfo\": userinfo } def verify_id_token(self, id_token: str) -\u003e Dict: \"\"\"ID 토큰 검증\"\"\" try: # OpenID Provider의 공개키로 서명 검증 claims = jwt.decode( id_token, self.get_public_key(), algorithms=['RS256'], audience=self.client_id ) return claims except Exception as e: raise HTTPException(status_code=401, detail=\"Invalid ID token\") Javascript 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 const express = require('express'); const jwt = require('jsonwebtoken'); const axios = require('axios'); class OpenIDConnectClient { constructor() { this.client_id = \"your_client_id\"; this.client_secret = \"your_client_secret\"; this.redirect_uri = \"http://localhost:3000/callback\"; // OpenID Provider 설정 this.authorization_endpoint = \"https://provider.com/auth\"; this.token_endpoint = \"https://provider.com/token\"; this.userinfo_endpoint = \"https://provider.com/userinfo\"; } getAuthorizationUrl() { const params = new URLSearchParams({ client_id: this.client_id, response_type: 'code', scope: 'openid profile email', redirect_uri: this.redirect_uri, state: this.generateState(), nonce: this.generateNonce() }); return `${this.authorization_endpoint}?${params.toString()}`; } async handleCallback(code) { try { // 토큰 획득 const tokens = await this.exchangeCodeForTokens(code); // ID 토큰 검증 const idTokenClaims = await this.verifyIdToken(tokens.id_token); // 사용자 정보 획득 const userinfo = await this.getUserInfo(tokens.access_token); return { idTokenClaims, userinfo }; } catch (error) { throw new Error('Authentication failed'); } } } 참고 및 출처 ","wordCount":"700","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-11-06T11:24:00Z","dateModified":"2024-11-06T11:24:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/security/authentication/openid-connect/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>posts</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/security/>IT Security</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/security/authentication/>인증 (authentication)</a></div><h1 class="post-title entry-hint-parent">OpenID Connect</h1><div class=post-description>OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공</div><div class=post-meta><span title='2024-11-06 11:24:00 +0000 UTC'>November 6, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;700 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Security/Authentication/OpenID-Connect.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#openid-connect-oidc>OpenID Connect (OIDC)</a><ul><li><a href=#정의와-목적>정의와 목적</a></li><li><a href=#작동-방식>작동 방식</a></li><li><a href=#주요-구성-요소>주요 구성 요소</a></li><li><a href=#oauth-20과의-차이점>OAuth 2.0과의 차이점</a></li><li><a href=#장점>장점</a></li><li><a href=#사용-사례>사용 사례</a></li><li><a href=#openid-connect의-주요-흐름flow>OpenID Connect의 주요 흐름(Flow)</a></li><li><a href=#openid-connect의-기본-구현>OpenID Connect의 기본 구현</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=openid-connect-oidc>OpenID Connect (OIDC)<a hidden class=anchor aria-hidden=true href=#openid-connect-oidc>#</a></h2><p>OpenID Connect (OIDC)는 OAuth 2.0 프로토콜 위에 구축된 인증 계층으로, 사용자 인증과 기본적인 프로필 정보 획득을 위한 표준화된 방법을 제공한다.</p><h3 id=정의와-목적>정의와 목적<a hidden class=anchor aria-hidden=true href=#정의와-목적>#</a></h3><ul><li>OIDC는 OAuth 2.0을 확장하여 인증 기능을 추가한 프로토콜입니다.</li><li>사용자 신원 확인과 기본 프로필 정보 제공을 목적으로 합니다.</li></ul><h3 id=작동-방식>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식>#</a></h3><ul><li>OAuth 2.0 흐름을 기반으로 하며, ID 토큰이라는 추가적인 토큰을 발급합니다.</li><li>ID 토큰은 JWT(JSON Web Token) 형식으로, 사용자 정보를 포함합니다.</li></ul><h3 id=주요-구성-요소>주요 구성 요소<a hidden class=anchor aria-hidden=true href=#주요-구성-요소>#</a></h3><h4 id=id-토큰>ID 토큰<a hidden class=anchor aria-hidden=true href=#id-토큰>#</a></h4><p>사용자 인증 정보를 포함한 JWT</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7>7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>IDToken</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>token_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sub</span> <span class=o>=</span> <span class=n>token_data</span><span class=p>[</span><span class=s1>&#39;sub&#39;</span><span class=p>]</span>  <span class=c1># 사용자 고유 식별자</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iss</span> <span class=o>=</span> <span class=n>token_data</span><span class=p>[</span><span class=s1>&#39;iss&#39;</span><span class=p>]</span>  <span class=c1># 토큰 발행자</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aud</span> <span class=o>=</span> <span class=n>token_data</span><span class=p>[</span><span class=s1>&#39;aud&#39;</span><span class=p>]</span>  <span class=c1># 토큰 수신자</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>exp</span> <span class=o>=</span> <span class=n>token_data</span><span class=p>[</span><span class=s1>&#39;exp&#39;</span><span class=p>]</span>  <span class=c1># 만료 시간</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iat</span> <span class=o>=</span> <span class=n>token_data</span><span class=p>[</span><span class=s1>&#39;iat&#39;</span><span class=p>]</span>  <span class=c1># 발행 시간</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>nonce</span> <span class=o>=</span> <span class=n>token_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;nonce&#39;</span><span class=p>)</span>  <span class=c1># 재생 공격 방지</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=userinfo-엔드포인트>UserInfo 엔드포인트<a hidden class=anchor aria-hidden=true href=#userinfo-엔드포인트>#</a></h4><p>추가적인 사용자 정보를 제공하는 API</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_userinfo</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>access_token</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;UserInfo 엔드포인트에서 사용자 정보 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>userinfo_endpoint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;Authorization&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;Bearer </span><span class=si>{</span><span class=n>access_token</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=표준화된-클레임>표준화된 클레임<a hidden class=anchor aria-hidden=true href=#표준화된-클레임>#</a></h4><p>name, email 등 사용자 정보를 표현하는 표준 필드</p><h3 id=oauth-20과의-차이점>OAuth 2.0과의 차이점<a hidden class=anchor aria-hidden=true href=#oauth-20과의-차이점>#</a></h3><ul><li>OIDC는 인증에 중점을 두며, OAuth 2.0은 권한 부여에 초점을 맞춥니다.</li><li>OIDC는 ID 토큰을 통해 사용자 정보를 직접 제공합니다.</li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><ul><li>단일 로그인(SSO) 구현 용이</li><li>표준화된 프로토콜로 상호 운용성 확보</li><li>다양한 클라이언트 유형(웹, 모바일 등) 지원</li></ul><p>OpenID Connect는 여러 보안 메커니즘을 제공</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SecurityMeasures</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>validate_tokens</span><span class=p>(</span><span class=n>id_token</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>nonce</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>expected_aud</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;토큰 유효성 검증&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>claims</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>id_token</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 필수 검증 항목</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>claims</span><span class=p>[</span><span class=s1>&#39;aud&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>expected_aud</span>  <span class=c1># 올바른 수신자</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>claims</span><span class=p>[</span><span class=s1>&#39;nonce&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>nonce</span>      <span class=c1># 재생 공격 방지</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>claims</span><span class=p>[</span><span class=s1>&#39;exp&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>   <span class=c1># 만료 확인</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=사용-사례>사용 사례<a hidden class=anchor aria-hidden=true href=#사용-사례>#</a></h3><ul><li>소셜 로그인 구현</li><li>엔터프라이즈 SSO 솔루션</li><li>다중 서비스 환경에서의 통합 인증</li></ul><h3 id=openid-connect의-주요-흐름flow>OpenID Connect의 주요 흐름(Flow)<a hidden class=anchor aria-hidden=true href=#openid-connect의-주요-흐름flow>#</a></h3><ol><li>Authorization Code Flow: 가장 안전하고 일반적인 방식입니다.</li><li>Implicit Flow: 단순화된 방식이지만, 보안성이 낮습니다.</li><li>Hybrid Flow: 두 가지 방식의 장점을 결합한 방식입니다.</li></ol><h3 id=openid-connect의-기본-구현>OpenID Connect의 기본 구현<a hidden class=anchor aria-hidden=true href=#openid-connect의-기본-구현>#</a></h3><h4 id=python>Python<a hidden class=anchor aria-hidden=true href=#python>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42>42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43>43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44>44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45>45</a>
</span><span class=lnt id=hl-3-46><a class=lnlinks href=#hl-3-46>46</a>
</span><span class=lnt id=hl-3-47><a class=lnlinks href=#hl-3-47>47</a>
</span><span class=lnt id=hl-3-48><a class=lnlinks href=#hl-3-48>48</a>
</span><span class=lnt id=hl-3-49><a class=lnlinks href=#hl-3-49>49</a>
</span><span class=lnt id=hl-3-50><a class=lnlinks href=#hl-3-50>50</a>
</span><span class=lnt id=hl-3-51><a class=lnlinks href=#hl-3-51>51</a>
</span><span class=lnt id=hl-3-52><a class=lnlinks href=#hl-3-52>52</a>
</span><span class=lnt id=hl-3-53><a class=lnlinks href=#hl-3-53>53</a>
</span><span class=lnt id=hl-3-54><a class=lnlinks href=#hl-3-54>54</a>
</span><span class=lnt id=hl-3-55><a class=lnlinks href=#hl-3-55>55</a>
</span><span class=lnt id=hl-3-56><a class=lnlinks href=#hl-3-56>56</a>
</span><span class=lnt id=hl-3-57><a class=lnlinks href=#hl-3-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>httpx</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>jose</span> <span class=kn>import</span> <span class=n>jwt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OpenIDConnectClient</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client_id</span> <span class=o>=</span> <span class=s2>&#34;your_client_id&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client_secret</span> <span class=o>=</span> <span class=s2>&#34;your_client_secret&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redirect_uri</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:8000/callback&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># OpenID Provider 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>authorization_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://provider.com/auth&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>token_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://provider.com/token&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>userinfo_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://provider.com/userinfo&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_authorization_url</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;인증 URL 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;client_id&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>client_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;response_type&#34;</span><span class=p>:</span> <span class=s2>&#34;code&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;scope&#34;</span><span class=p>:</span> <span class=s2>&#34;openid profile email&#34;</span><span class=p>,</span>  <span class=c1># OpenID Connect 필수 스코프</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;redirect_uri&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>redirect_uri</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;state&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_state</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;nonce&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_nonce</span><span class=p>()</span>  <span class=c1># OIDC 보안 요구사항</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>authorization_endpoint</span><span class=si>}</span><span class=s2>?</span><span class=si>{</span><span class=s1>&#39;&amp;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>k</span><span class=si>}</span><span class=s1>=</span><span class=si>{</span><span class=n>v</span><span class=si>}</span><span class=s1>&#39;</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>params</span><span class=o>.</span><span class=n>items</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_callback</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>code</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;인증 코드를 토큰으로 교환하고 사용자 정보 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 토큰 획득</span>
</span></span><span class=line><span class=cl>        <span class=n>tokens</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>exchange_code_for_tokens</span><span class=p>(</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ID 토큰 검증</span>
</span></span><span class=line><span class=cl>        <span class=n>id_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>verify_id_token</span><span class=p>(</span><span class=n>tokens</span><span class=p>[</span><span class=s1>&#39;id_token&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추가 사용자 정보 획득</span>
</span></span><span class=line><span class=cl>        <span class=n>userinfo</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_userinfo</span><span class=p>(</span><span class=n>tokens</span><span class=p>[</span><span class=s1>&#39;access_token&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id_token_claims&#34;</span><span class=p>:</span> <span class=n>id_token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;userinfo&#34;</span><span class=p>:</span> <span class=n>userinfo</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>verify_id_token</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_token</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;ID 토큰 검증&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># OpenID Provider의 공개키로 서명 검증</span>
</span></span><span class=line><span class=cl>            <span class=n>claims</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>id_token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>get_public_key</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;RS256&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>audience</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>client_id</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>claims</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Invalid ID token&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=javascript>Javascript<a hidden class=anchor aria-hidden=true href=#javascript>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46>46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47>47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48>48</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>axios</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OpenIDConnectClient</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>client_id</span> <span class=o>=</span> <span class=s2>&#34;your_client_id&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>client_secret</span> <span class=o>=</span> <span class=s2>&#34;your_client_secret&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>redirect_uri</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:3000/callback&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// OpenID Provider 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>authorization_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://provider.com/auth&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>token_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://provider.com/token&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>userinfo_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://provider.com/userinfo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>getAuthorizationUrl</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URLSearchParams</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>client_id</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>client_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>response_type</span><span class=o>:</span> <span class=s1>&#39;code&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>scope</span><span class=o>:</span> <span class=s1>&#39;openid profile email&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>redirect_uri</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>redirect_uri</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>state</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateState</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>nonce</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateNonce</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>authorization_endpoint</span><span class=si>}</span><span class=sb>?</span><span class=si>${</span><span class=nx>params</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleCallback</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 토큰 획득
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>tokens</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>exchangeCodeForTokens</span><span class=p>(</span><span class=nx>code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// ID 토큰 검증
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>idTokenClaims</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>verifyIdToken</span><span class=p>(</span><span class=nx>tokens</span><span class=p>.</span><span class=nx>id_token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 사용자 정보 획득
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>userinfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getUserInfo</span><span class=p>(</span><span class=nx>tokens</span><span class=p>.</span><span class=nx>access_token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>idTokenClaims</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>userinfo</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Authentication failed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/security/>Security</a></li><li><a href=https://buenhyden.github.io/tags/authentication/>Authentication</a></li><li><a href=https://buenhyden.github.io/tags/openid-connect/>OpenID-Connect</a></li><li><a href=https://buenhyden.github.io/tags/oidc/>OIDC</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/security/authentication/oauth/><span class=title>« Prev</span><br><span>OAuth</span>
</a><a class=next href=https://buenhyden.github.io/posts/security/authentication/token-authentication/><span class=title>Next »</span><br><span>Token Authentication</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>