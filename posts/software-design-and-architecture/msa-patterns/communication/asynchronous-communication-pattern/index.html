<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>비동기 통신 패턴(Asynchronous Communication Pattern) | hyunyoun's Blog</title>
<meta name=keywords content="Software-Design-and-Architecture,Software-Architecture,Software-Architecture-Patterns,Application-Structure,MSA-Patterns,Communication,Asynchronous-Communication-Pattern"><meta name=description content="비동기 통신 패턴은 마이크로서비스 간의 통신에서 요청자가 응답을 기다리지 않고 다음 작업을 수행할 수 있게 하는 패턴이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/asynchronous-communication-pattern/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.9a2bbe2d8b5afa9d4df22976abb7b72f1f7f1c467d2b30f03090108f9496ae6c.css integrity="sha256-miu+LYta+p1N8il2q7e3Lx9/HEZ9KzDwMJAQj5SWrmw=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/asynchronous-communication-pattern/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/asynchronous-communication-pattern/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="비동기 통신 패턴(Asynchronous Communication Pattern)"><meta property="og:description" content="비동기 통신 패턴은 마이크로서비스 간의 통신에서 요청자가 응답을 기다리지 않고 다음 작업을 수행할 수 있게 하는 패턴이다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-28T03:56:00+00:00"><meta property="article:modified_time" content="2024-12-28T03:56:00+00:00"><meta property="article:tag" content="Software-Design-and-Architecture"><meta property="article:tag" content="Software-Architecture"><meta property="article:tag" content="Software-Architecture-Patterns"><meta property="article:tag" content="Application-Structure"><meta property="article:tag" content="MSA-Patterns"><meta property="article:tag" content="Communication"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="비동기 통신 패턴(Asynchronous Communication Pattern)"><meta name=twitter:description content="비동기 통신 패턴은 마이크로서비스 간의 통신에서 요청자가 응답을 기다리지 않고 다음 작업을 수행할 수 있게 하는 패턴이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Design and Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/"},{"@type":"ListItem","position":3,"name":"MSA Pattern","item":"https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/"},{"@type":"ListItem","position":4,"name":"Communication Patterns","item":"https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/"},{"@type":"ListItem","position":5,"name":"비동기 통신 패턴(Asynchronous Communication Pattern)","item":"https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/asynchronous-communication-pattern/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"비동기 통신 패턴(Asynchronous Communication Pattern)","name":"비동기 통신 패턴(Asynchronous Communication Pattern)","description":"비동기 통신 패턴은 마이크로서비스 간의 통신에서 요청자가 응답을 기다리지 않고 다음 작업을 수행할 수 있게 하는 패턴이다.","keywords":["Software-Design-and-Architecture","Software-Architecture","Software-Architecture-Patterns","Application-Structure","MSA-Patterns","Communication","Asynchronous-Communication-Pattern"],"articleBody":"비동기 통신 패턴(Asynchronous Communication Pattern) Asynchronous Communication Pattern은 마이크로서비스 간 통신에서 메시지를 보내는 서비스가 즉각적인 응답을 기다리지 않고 계속해서 작업을 수행할 수 있게 하는 방식이다.\n이 패턴은 서비스 간 느슨한 결합을 가능하게 하며, 시스템의 확장성과 탄력성을 향상시킨다.\nAsynchronous Communication Pattern은 MSA에서 서비스 간 효율적인 통신을 가능하게 하며, 시스템의 확장성과 탄력성을 크게 향상시킨다.\n하지만 구현의 복잡성과 메시지 순서 관리 등의 도전 과제도 존재하므로, 이를 고려하여 적절히 설계하고 구현해야 한다.\nAsynchronous Communication의 주요 특징 비동기 처리: 서비스는 메시지를 보낸 후 응답을 기다리지 않고 다음 작업을 수행한다. 메시지 브로커 사용: Kafka나 RabbitMQ와 같은 메시지 브로커를 통해 서비스 간 통신이 이루어진다. 유연성: 팀원들이 자신의 일정에 맞춰 작업할 수 있어 글로벌 팀이나 원격 근무에 적합하다. 확장성: 서비스들이 독립적으로 메시지를 처리할 수 있어 더 나은 확장성을 제공한다. Asynchronous Communication Pattern의 장점 높은 확장성: 서비스들이 독립적으로 메시지를 처리할 수 있어 시스템 전체의 확장성이 향상된다. 향상된 장애 허용성: 서비스 간 결합도가 낮아 한 서비스의 실패가 다른 서비스에 즉각적인 영향을 미치지 않는다. 유연한 의존성 관리: 이벤트 기반 아키텍처를 통해 서비스 간 의존성을 줄일 수 있다. 높은 처리량: 서비스들이 동시에 메시지를 처리할 수 있어 전체적인 처리량이 증가한다. Asynchronous Communication 구현 방식 메시징 시스템: Kafka, RabbitMQ 등의 메시지 브로커를 사용한다. 이벤트 기반 아키텍처: 서비스들이 이벤트를 발행하고 구독하는 방식으로 통신한다. 비동기 프로토콜: AMQP와 같은 비동기 프로토콜을 사용하여 메시지를 전송한다. Asynchronous Communication Pattern의 사용 사례 알림 시스템: SMS, 이메일 등의 알림을 보낼 때 사용된다. 주문 처리: 온라인 상점에서 주문 확인 메시지를 보낼 때 활용된다. 보고서 생성: 시간이 오래 걸리는 보고서 생성 작업에 적합하다. 구현 시 고려사항 메시지 순서: 메시지의 순서가 중요한 경우, 적절한 순서 보장 메커니즘을 구현해야 한다. 트랜잭션 관리: 클라이언트 측에서 트랜잭션을 관리하여 일관성을 유지해야 한다. 메시지 지속성: 시스템 장애 시에도 메시지가 손실되지 않도록 보장해야 한다. 모니터링 및 추적: 비동기 통신의 특성상 문제 발생 시 디버깅이 어려울 수 있으므로, 적절한 모니터링 및 추적 시스템을 구축해야 한다. Asynchronous Communication Pattern을 활용한 실제 구현 예시 %%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '12px'}, 'flowchart': {'width': 400, 'height': 250, 'diagramPadding': 8}}}%% sequenceDiagram participant Client participant OrderService participant MessageQueue participant PaymentService participant NotificationService Note over Client,NotificationService: Async Flow Client-\u003e\u003eOrderService: 1. Create Order activate OrderService OrderService--\u003e\u003eClient: 2. Accepted (202) OrderService-\u003e\u003eMessageQueue: 3. Publish Event deactivate OrderService MessageQueue-\u003e\u003ePaymentService: 4a. Consume activate PaymentService PaymentService-\u003e\u003eMessageQueue: 5a. Process deactivate PaymentService MessageQueue-\u003e\u003eNotificationService: 4b. Consume activate NotificationService NotificationService--\u003e\u003eMessageQueue: 5b. Ack deactivate NotificationService MessageQueue-\u003e\u003eOrderService: 6. Update activate OrderService OrderService-\u003e\u003eMessageQueue: 7. Status deactivate OrderService MessageQueue-\u003e\u003eNotificationService: 8. Send activate NotificationService NotificationService-\u003e\u003eClient: 9. Push deactivate NotificationService 알림 시스템과 주문 처리 시스템\n주요 컴포넌트와 특징:\n메시지 브로커 (MessageBroker):\n실제 메시지 큐잉 시스템(예: RabbitMQ, Kafka)을 시뮬레이션한다. 발행/구독(pub/sub) 패턴을 구현하여 비동기 메시지 전달을 지원한다. 여러 큐를 관리하고 메시지를 구독자들에게 전달한다. 주문 서비스 (OrderService):\n주문을 생성하고 상태를 관리한다. 주문 관련 이벤트를 발행하여 다른 서비스에 알린다. 비동기적으로 작동하여 주문 처리와 이벤트 발행이 독립적으로 실행된다. 알림 서비스 (NotificationService):\n주문 이벤트를 구독하여 적절한 알림을 생성한다. 이벤트 타입에 따라 다른 알림 메시지를 생성한다. 실제 시스템에서는 이메일, SMS 등 외부 시스템과의 통합이 추가될 수 있다. 이 시스템의 장점은 다음과 같다:\n느슨한 결합:\n주문 서비스와 알림 서비스는 서로에 대해 직접적인 의존성이 없다. 메시지 브로커를 통해 간접적으로 통신한다. 확장성:\n각 서비스는 독립적으로 확장할 수 있다. 새로운 이벤트 구독자를 쉽게 추가할 수 있다. 장애 격리:\n알림 서비스에 문제가 발생해도 주문 서비스는 정상적으로 작동한다. 메시지 큐는 일시적인 장애 시 버퍼 역할을 한다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 import asyncio import json from datetime import datetime from typing import Dict, List from dataclasses import dataclass, asdict from asyncio import Queue from uuid import uuid4 # 도메인 모델 정의 @dataclass class Order: order_id: str user_id: str items: List[Dict] total_amount: float status: str created_at: str @dataclass class Notification: notification_id: str user_id: str message: str type: str created_at: str # 이벤트 정의 @dataclass class OrderEvent: event_type: str order: Order timestamp: str # 메시지 브로커 시뮬레이션 class MessageBroker: def __init__(self): self.queues: Dict[str, Queue] = {} self.subscribers: Dict[str, List] = {} def create_queue(self, queue_name: str) -\u003e None: self.queues[queue_name] = Queue() self.subscribers[queue_name] = [] async def publish(self, queue_name: str, message: dict) -\u003e None: if queue_name not in self.queues: self.create_queue(queue_name) await self.queues[queue_name].put(message) # 구독자들에게 메시지 전달 for subscriber in self.subscribers[queue_name]: await subscriber(message) async def subscribe(self, queue_name: str, callback) -\u003e None: if queue_name not in self.subscribers: self.create_queue(queue_name) self.subscribers[queue_name].append(callback) # 주문 서비스 class OrderService: def __init__(self, message_broker: MessageBroker): self.message_broker = message_broker self.orders = {} async def create_order(self, user_id: str, items: List[Dict], total_amount: float) -\u003e Order: # 주문 생성 order = Order( order_id=str(uuid4()), user_id=user_id, items=items, total_amount=total_amount, status=\"PENDING\", created_at=datetime.now().isoformat() ) self.orders[order.order_id] = order # 주문 생성 이벤트 발행 event = OrderEvent( event_type=\"ORDER_CREATED\", order=order, timestamp=datetime.now().isoformat() ) await self.message_broker.publish(\"order_events\", asdict(event)) return order async def update_order_status(self, order_id: str, status: str) -\u003e None: if order_id in self.orders: order = self.orders[order_id] order.status = status # 주문 상태 변경 이벤트 발행 event = OrderEvent( event_type=\"ORDER_STATUS_UPDATED\", order=order, timestamp=datetime.now().isoformat() ) await self.message_broker.publish(\"order_events\", asdict(event)) # 알림 서비스 class NotificationService: def __init__(self, message_broker: MessageBroker): self.message_broker = message_broker self.notifications = {} async def handle_order_event(self, event: dict) -\u003e None: event_type = event['event_type'] order = event['order'] # 이벤트 타입에 따른 알림 메시지 생성 if event_type == \"ORDER_CREATED\": await self.create_notification( order['user_id'], f\"주문이 생성되었습니다. 주문번호: {order['order_id']}\", \"ORDER_NOTIFICATION\" ) elif event_type == \"ORDER_STATUS_UPDATED\": await self.create_notification( order['user_id'], f\"주문 상태가 {order['status']}로 변경되었습니다. 주문번호: {order['order_id']}\", \"STATUS_UPDATE\" ) async def create_notification(self, user_id: str, message: str, type: str) -\u003e Notification: notification = Notification( notification_id=str(uuid4()), user_id=user_id, message=message, type=type, created_at=datetime.now().isoformat() ) self.notifications[notification.notification_id] = notification # 실제 시스템에서는 여기서 이메일 발송, SMS 발송 등의 작업 수행 print(f\"알림 발송: {notification.message}\") return notification # 메인 애플리케이션 async def main(): # 시스템 초기화 message_broker = MessageBroker() order_service = OrderService(message_broker) notification_service = NotificationService(message_broker) # 알림 서비스를 주문 이벤트에 구독 await message_broker.subscribe(\"order_events\", notification_service.handle_order_event) # 테스트 시나리오 # 1. 주문 생성 order = await order_service.create_order( user_id=\"user123\", items=[{\"product_id\": \"prod1\", \"quantity\": 2, \"price\": 1000}], total_amount=2000 ) # 잠시 대기하여 알림 처리 시간 제공 await asyncio.sleep(1) # 2. 주문 상태 업데이트 await order_service.update_order_status(order.order_id, \"PROCESSING\") # 알림 처리 시간 제공 await asyncio.sleep(1) # 애플리케이션 실행 if __name__ == \"__main__\": asyncio.run(main()) 이 예시를 확장하거나 수정할 수 있는 방향:\n실제 메시지 브로커 통합\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # RabbitMQ 사용 예시 import pika class RabbitMQBroker: def __init__(self): self.connection = pika.BlockingConnection( pika.ConnectionParameters('localhost') ) self.channel = self.connection.channel() async def publish(self, queue_name: str, message: dict): self.channel.basic_publish( exchange='', routing_key=queue_name, body=json.dumps(message) ) 재시도 메커니즘 추가\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class NotificationService: async def handle_order_event(self, event: dict) -\u003e None: max_retries = 3 retry_count = 0 while retry_count \u003c max_retries: try: await self.process_event(event) break except Exception as e: retry_count += 1 if retry_count == max_retries: # Dead Letter Queue로 이동 await self.move_to_dlq(event) await asyncio.sleep(2 ** retry_count) # 지수 백오프 분산 트레이싱 추가\n1 2 3 4 5 6 7 8 class OrderService: async def create_order(self, user_id: str, items: List[Dict], total_amount: float) -\u003e Order: trace_id = str(uuid4()) # 트레이싱 컨텍스트 시작 with tracer.start_span(f\"create_order_{trace_id}\") as span: order = await self._create_order(user_id, items, total_amount) span.set_tag(\"order_id\", order.order_id) return order 참고 및 출처 ","wordCount":"1273","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-12-28T03:56:00Z","dateModified":"2024-12-28T03:56:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/asynchronous-communication-pattern/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>posts</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/>Software Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/>MSA Pattern</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/>Communication Patterns</a></div><h1 class="post-title entry-hint-parent">비동기 통신 패턴(Asynchronous Communication Pattern)</h1><div class=post-description>비동기 통신 패턴은 마이크로서비스 간의 통신에서 요청자가 응답을 기다리지 않고 다음 작업을 수행할 수 있게 하는 패턴이다.</div><div class=post-meta><span title='2024-12-28 03:56:00 +0000 UTC'>December 28, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1273 words&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#비동기-통신-패턴asynchronous-communication-pattern>비동기 통신 패턴(Asynchronous Communication Pattern)</a><ul><li><a href=#asynchronous-communication의-주요-특징>Asynchronous Communication의 주요 특징</a></li><li><a href=#asynchronous-communication-pattern의-장점>Asynchronous Communication Pattern의 장점</a></li><li><a href=#asynchronous-communication-구현-방식>Asynchronous Communication 구현 방식</a></li><li><a href=#asynchronous-communication-pattern의-사용-사례>Asynchronous Communication Pattern의 사용 사례</a></li><li><a href=#구현-시-고려사항>구현 시 고려사항</a></li><li><a href=#asynchronous-communication-pattern을-활용한-실제-구현-예시>Asynchronous Communication Pattern을 활용한 실제 구현 예시</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=비동기-통신-패턴asynchronous-communication-pattern>비동기 통신 패턴(Asynchronous Communication Pattern)<a hidden class=anchor aria-hidden=true href=#비동기-통신-패턴asynchronous-communication-pattern>#</a></h2><p>Asynchronous Communication Pattern은 마이크로서비스 간 통신에서 메시지를 보내는 서비스가 즉각적인 응답을 기다리지 않고 계속해서 작업을 수행할 수 있게 하는 방식이다.<br>이 패턴은 서비스 간 느슨한 결합을 가능하게 하며, 시스템의 확장성과 탄력성을 향상시킨다.</p><p>Asynchronous Communication Pattern은 MSA에서 서비스 간 효율적인 통신을 가능하게 하며, 시스템의 확장성과 탄력성을 크게 향상시킨다.<br>하지만 구현의 복잡성과 메시지 순서 관리 등의 도전 과제도 존재하므로, 이를 고려하여 적절히 설계하고 구현해야 한다.</p><h3 id=asynchronous-communication의-주요-특징>Asynchronous Communication의 주요 특징<a hidden class=anchor aria-hidden=true href=#asynchronous-communication의-주요-특징>#</a></h3><ol><li><strong>비동기 처리</strong>: 서비스는 메시지를 보낸 후 응답을 기다리지 않고 다음 작업을 수행한다.</li><li><strong>메시지 브로커 사용</strong>: Kafka나 RabbitMQ와 같은 메시지 브로커를 통해 서비스 간 통신이 이루어진다.</li><li><strong>유연성</strong>: 팀원들이 자신의 일정에 맞춰 작업할 수 있어 글로벌 팀이나 원격 근무에 적합하다.</li><li><strong>확장성</strong>: 서비스들이 독립적으로 메시지를 처리할 수 있어 더 나은 확장성을 제공한다.</li></ol><h3 id=asynchronous-communication-pattern의-장점>Asynchronous Communication Pattern의 장점<a hidden class=anchor aria-hidden=true href=#asynchronous-communication-pattern의-장점>#</a></h3><ol><li><strong>높은 확장성</strong>: 서비스들이 독립적으로 메시지를 처리할 수 있어 시스템 전체의 확장성이 향상된다.</li><li><strong>향상된 장애 허용성</strong>: 서비스 간 결합도가 낮아 한 서비스의 실패가 다른 서비스에 즉각적인 영향을 미치지 않는다.</li><li><strong>유연한 의존성 관리</strong>: 이벤트 기반 아키텍처를 통해 서비스 간 의존성을 줄일 수 있다.</li><li><strong>높은 처리량</strong>: 서비스들이 동시에 메시지를 처리할 수 있어 전체적인 처리량이 증가한다.</li></ol><h3 id=asynchronous-communication-구현-방식>Asynchronous Communication 구현 방식<a hidden class=anchor aria-hidden=true href=#asynchronous-communication-구현-방식>#</a></h3><ol><li><strong>메시징 시스템</strong>: Kafka, RabbitMQ 등의 메시지 브로커를 사용한다.</li><li><strong>이벤트 기반 아키텍처</strong>: 서비스들이 이벤트를 발행하고 구독하는 방식으로 통신한다.</li><li><strong>비동기 프로토콜</strong>: AMQP와 같은 비동기 프로토콜을 사용하여 메시지를 전송한다.</li></ol><h3 id=asynchronous-communication-pattern의-사용-사례>Asynchronous Communication Pattern의 사용 사례<a hidden class=anchor aria-hidden=true href=#asynchronous-communication-pattern의-사용-사례>#</a></h3><ol><li><strong>알림 시스템</strong>: SMS, 이메일 등의 알림을 보낼 때 사용된다.</li><li><strong>주문 처리</strong>: 온라인 상점에서 주문 확인 메시지를 보낼 때 활용된다.</li><li><strong>보고서 생성</strong>: 시간이 오래 걸리는 보고서 생성 작업에 적합하다.</li></ol><h3 id=구현-시-고려사항>구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#구현-시-고려사항>#</a></h3><ol><li><strong>메시지 순서</strong>: 메시지의 순서가 중요한 경우, 적절한 순서 보장 메커니즘을 구현해야 한다.</li><li><strong>트랜잭션 관리</strong>: 클라이언트 측에서 트랜잭션을 관리하여 일관성을 유지해야 한다.</li><li><strong>메시지 지속성</strong>: 시스템 장애 시에도 메시지가 손실되지 않도록 보장해야 한다.</li><li><strong>모니터링 및 추적</strong>: 비동기 통신의 특성상 문제 발생 시 디버깅이 어려울 수 있으므로, 적절한 모니터링 및 추적 시스템을 구축해야 한다.</li></ol><h3 id=asynchronous-communication-pattern을-활용한-실제-구현-예시>Asynchronous Communication Pattern을 활용한 실제 구현 예시<a hidden class=anchor aria-hidden=true href=#asynchronous-communication-pattern을-활용한-실제-구현-예시>#</a></h3><pre class=mermaid>%%{init: {&#39;theme&#39;: &#39;default&#39;, &#39;themeVariables&#39;: { &#39;fontSize&#39;: &#39;12px&#39;}, &#39;flowchart&#39;: {&#39;width&#39;: 400, &#39;height&#39;: 250, &#39;diagramPadding&#39;: 8}}}%%
sequenceDiagram
    participant Client
    participant OrderService
    participant MessageQueue
    participant PaymentService
    participant NotificationService
    
    Note over Client,NotificationService: Async Flow
    
    Client-&gt;&gt;OrderService: 1. Create Order
    activate OrderService
    OrderService--&gt;&gt;Client: 2. Accepted (202)
    
    OrderService-&gt;&gt;MessageQueue: 3. Publish Event
    deactivate OrderService
    
    MessageQueue-&gt;&gt;PaymentService: 4a. Consume
    activate PaymentService
    PaymentService-&gt;&gt;MessageQueue: 5a. Process
    deactivate PaymentService
    
    MessageQueue-&gt;&gt;NotificationService: 4b. Consume
    activate NotificationService
    NotificationService--&gt;&gt;MessageQueue: 5b. Ack
    deactivate NotificationService
    
    MessageQueue-&gt;&gt;OrderService: 6. Update
    activate OrderService
    OrderService-&gt;&gt;MessageQueue: 7. Status
    deactivate OrderService
    
    MessageQueue-&gt;&gt;NotificationService: 8. Send
    activate NotificationService
    NotificationService-&gt;&gt;Client: 9. Push
    deactivate NotificationService
</pre><p>알림 시스템과 주문 처리 시스템<br>주요 컴포넌트와 특징:</p><ol><li><p>메시지 브로커 (MessageBroker):</p><ul><li>실제 메시지 큐잉 시스템(예: RabbitMQ, Kafka)을 시뮬레이션한다.</li><li>발행/구독(pub/sub) 패턴을 구현하여 비동기 메시지 전달을 지원한다.</li><li>여러 큐를 관리하고 메시지를 구독자들에게 전달한다.</li></ul></li><li><p>주문 서비스 (OrderService):</p><ul><li>주문을 생성하고 상태를 관리한다.</li><li>주문 관련 이벤트를 발행하여 다른 서비스에 알린다.</li><li>비동기적으로 작동하여 주문 처리와 이벤트 발행이 독립적으로 실행된다.</li></ul></li><li><p>알림 서비스 (NotificationService):</p><ul><li>주문 이벤트를 구독하여 적절한 알림을 생성한다.</li><li>이벤트 타입에 따라 다른 알림 메시지를 생성한다.</li><li>실제 시스템에서는 이메일, SMS 등 외부 시스템과의 통합이 추가될 수 있다.</li></ul></li></ol><p>이 시스템의 장점은 다음과 같다:</p><ol><li><p>느슨한 결합:</p><ul><li>주문 서비스와 알림 서비스는 서로에 대해 직접적인 의존성이 없다.</li><li>메시지 브로커를 통해 간접적으로 통신한다.</li></ul></li><li><p>확장성:</p><ul><li>각 서비스는 독립적으로 확장할 수 있다.</li><li>새로운 이벤트 구독자를 쉽게 추가할 수 있다.</li></ul></li><li><p>장애 격리:</p><ul><li>알림 서비스에 문제가 발생해도 주문 서비스는 정상적으로 작동한다.</li><li>메시지 큐는 일시적인 장애 시 버퍼 역할을 한다.</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>  1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>  2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>  3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>  4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>  5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>  6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>  7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>  8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>  9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10> 10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11> 11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12> 12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13> 13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14> 14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15> 15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16> 16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17> 17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18> 18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19> 19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20> 20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21> 21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22> 22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23> 23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24> 24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25> 25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26> 26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27> 27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28> 28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29> 29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30> 30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31> 31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32> 32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33> 33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34> 34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35> 35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36> 36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37> 37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38> 38</a>
</span><span class=lnt id=hl-1-39><a class=lnlinks href=#hl-1-39> 39</a>
</span><span class=lnt id=hl-1-40><a class=lnlinks href=#hl-1-40> 40</a>
</span><span class=lnt id=hl-1-41><a class=lnlinks href=#hl-1-41> 41</a>
</span><span class=lnt id=hl-1-42><a class=lnlinks href=#hl-1-42> 42</a>
</span><span class=lnt id=hl-1-43><a class=lnlinks href=#hl-1-43> 43</a>
</span><span class=lnt id=hl-1-44><a class=lnlinks href=#hl-1-44> 44</a>
</span><span class=lnt id=hl-1-45><a class=lnlinks href=#hl-1-45> 45</a>
</span><span class=lnt id=hl-1-46><a class=lnlinks href=#hl-1-46> 46</a>
</span><span class=lnt id=hl-1-47><a class=lnlinks href=#hl-1-47> 47</a>
</span><span class=lnt id=hl-1-48><a class=lnlinks href=#hl-1-48> 48</a>
</span><span class=lnt id=hl-1-49><a class=lnlinks href=#hl-1-49> 49</a>
</span><span class=lnt id=hl-1-50><a class=lnlinks href=#hl-1-50> 50</a>
</span><span class=lnt id=hl-1-51><a class=lnlinks href=#hl-1-51> 51</a>
</span><span class=lnt id=hl-1-52><a class=lnlinks href=#hl-1-52> 52</a>
</span><span class=lnt id=hl-1-53><a class=lnlinks href=#hl-1-53> 53</a>
</span><span class=lnt id=hl-1-54><a class=lnlinks href=#hl-1-54> 54</a>
</span><span class=lnt id=hl-1-55><a class=lnlinks href=#hl-1-55> 55</a>
</span><span class=lnt id=hl-1-56><a class=lnlinks href=#hl-1-56> 56</a>
</span><span class=lnt id=hl-1-57><a class=lnlinks href=#hl-1-57> 57</a>
</span><span class=lnt id=hl-1-58><a class=lnlinks href=#hl-1-58> 58</a>
</span><span class=lnt id=hl-1-59><a class=lnlinks href=#hl-1-59> 59</a>
</span><span class=lnt id=hl-1-60><a class=lnlinks href=#hl-1-60> 60</a>
</span><span class=lnt id=hl-1-61><a class=lnlinks href=#hl-1-61> 61</a>
</span><span class=lnt id=hl-1-62><a class=lnlinks href=#hl-1-62> 62</a>
</span><span class=lnt id=hl-1-63><a class=lnlinks href=#hl-1-63> 63</a>
</span><span class=lnt id=hl-1-64><a class=lnlinks href=#hl-1-64> 64</a>
</span><span class=lnt id=hl-1-65><a class=lnlinks href=#hl-1-65> 65</a>
</span><span class=lnt id=hl-1-66><a class=lnlinks href=#hl-1-66> 66</a>
</span><span class=lnt id=hl-1-67><a class=lnlinks href=#hl-1-67> 67</a>
</span><span class=lnt id=hl-1-68><a class=lnlinks href=#hl-1-68> 68</a>
</span><span class=lnt id=hl-1-69><a class=lnlinks href=#hl-1-69> 69</a>
</span><span class=lnt id=hl-1-70><a class=lnlinks href=#hl-1-70> 70</a>
</span><span class=lnt id=hl-1-71><a class=lnlinks href=#hl-1-71> 71</a>
</span><span class=lnt id=hl-1-72><a class=lnlinks href=#hl-1-72> 72</a>
</span><span class=lnt id=hl-1-73><a class=lnlinks href=#hl-1-73> 73</a>
</span><span class=lnt id=hl-1-74><a class=lnlinks href=#hl-1-74> 74</a>
</span><span class=lnt id=hl-1-75><a class=lnlinks href=#hl-1-75> 75</a>
</span><span class=lnt id=hl-1-76><a class=lnlinks href=#hl-1-76> 76</a>
</span><span class=lnt id=hl-1-77><a class=lnlinks href=#hl-1-77> 77</a>
</span><span class=lnt id=hl-1-78><a class=lnlinks href=#hl-1-78> 78</a>
</span><span class=lnt id=hl-1-79><a class=lnlinks href=#hl-1-79> 79</a>
</span><span class=lnt id=hl-1-80><a class=lnlinks href=#hl-1-80> 80</a>
</span><span class=lnt id=hl-1-81><a class=lnlinks href=#hl-1-81> 81</a>
</span><span class=lnt id=hl-1-82><a class=lnlinks href=#hl-1-82> 82</a>
</span><span class=lnt id=hl-1-83><a class=lnlinks href=#hl-1-83> 83</a>
</span><span class=lnt id=hl-1-84><a class=lnlinks href=#hl-1-84> 84</a>
</span><span class=lnt id=hl-1-85><a class=lnlinks href=#hl-1-85> 85</a>
</span><span class=lnt id=hl-1-86><a class=lnlinks href=#hl-1-86> 86</a>
</span><span class=lnt id=hl-1-87><a class=lnlinks href=#hl-1-87> 87</a>
</span><span class=lnt id=hl-1-88><a class=lnlinks href=#hl-1-88> 88</a>
</span><span class=lnt id=hl-1-89><a class=lnlinks href=#hl-1-89> 89</a>
</span><span class=lnt id=hl-1-90><a class=lnlinks href=#hl-1-90> 90</a>
</span><span class=lnt id=hl-1-91><a class=lnlinks href=#hl-1-91> 91</a>
</span><span class=lnt id=hl-1-92><a class=lnlinks href=#hl-1-92> 92</a>
</span><span class=lnt id=hl-1-93><a class=lnlinks href=#hl-1-93> 93</a>
</span><span class=lnt id=hl-1-94><a class=lnlinks href=#hl-1-94> 94</a>
</span><span class=lnt id=hl-1-95><a class=lnlinks href=#hl-1-95> 95</a>
</span><span class=lnt id=hl-1-96><a class=lnlinks href=#hl-1-96> 96</a>
</span><span class=lnt id=hl-1-97><a class=lnlinks href=#hl-1-97> 97</a>
</span><span class=lnt id=hl-1-98><a class=lnlinks href=#hl-1-98> 98</a>
</span><span class=lnt id=hl-1-99><a class=lnlinks href=#hl-1-99> 99</a>
</span><span class=lnt id=hl-1-100><a class=lnlinks href=#hl-1-100>100</a>
</span><span class=lnt id=hl-1-101><a class=lnlinks href=#hl-1-101>101</a>
</span><span class=lnt id=hl-1-102><a class=lnlinks href=#hl-1-102>102</a>
</span><span class=lnt id=hl-1-103><a class=lnlinks href=#hl-1-103>103</a>
</span><span class=lnt id=hl-1-104><a class=lnlinks href=#hl-1-104>104</a>
</span><span class=lnt id=hl-1-105><a class=lnlinks href=#hl-1-105>105</a>
</span><span class=lnt id=hl-1-106><a class=lnlinks href=#hl-1-106>106</a>
</span><span class=lnt id=hl-1-107><a class=lnlinks href=#hl-1-107>107</a>
</span><span class=lnt id=hl-1-108><a class=lnlinks href=#hl-1-108>108</a>
</span><span class=lnt id=hl-1-109><a class=lnlinks href=#hl-1-109>109</a>
</span><span class=lnt id=hl-1-110><a class=lnlinks href=#hl-1-110>110</a>
</span><span class=lnt id=hl-1-111><a class=lnlinks href=#hl-1-111>111</a>
</span><span class=lnt id=hl-1-112><a class=lnlinks href=#hl-1-112>112</a>
</span><span class=lnt id=hl-1-113><a class=lnlinks href=#hl-1-113>113</a>
</span><span class=lnt id=hl-1-114><a class=lnlinks href=#hl-1-114>114</a>
</span><span class=lnt id=hl-1-115><a class=lnlinks href=#hl-1-115>115</a>
</span><span class=lnt id=hl-1-116><a class=lnlinks href=#hl-1-116>116</a>
</span><span class=lnt id=hl-1-117><a class=lnlinks href=#hl-1-117>117</a>
</span><span class=lnt id=hl-1-118><a class=lnlinks href=#hl-1-118>118</a>
</span><span class=lnt id=hl-1-119><a class=lnlinks href=#hl-1-119>119</a>
</span><span class=lnt id=hl-1-120><a class=lnlinks href=#hl-1-120>120</a>
</span><span class=lnt id=hl-1-121><a class=lnlinks href=#hl-1-121>121</a>
</span><span class=lnt id=hl-1-122><a class=lnlinks href=#hl-1-122>122</a>
</span><span class=lnt id=hl-1-123><a class=lnlinks href=#hl-1-123>123</a>
</span><span class=lnt id=hl-1-124><a class=lnlinks href=#hl-1-124>124</a>
</span><span class=lnt id=hl-1-125><a class=lnlinks href=#hl-1-125>125</a>
</span><span class=lnt id=hl-1-126><a class=lnlinks href=#hl-1-126>126</a>
</span><span class=lnt id=hl-1-127><a class=lnlinks href=#hl-1-127>127</a>
</span><span class=lnt id=hl-1-128><a class=lnlinks href=#hl-1-128>128</a>
</span><span class=lnt id=hl-1-129><a class=lnlinks href=#hl-1-129>129</a>
</span><span class=lnt id=hl-1-130><a class=lnlinks href=#hl-1-130>130</a>
</span><span class=lnt id=hl-1-131><a class=lnlinks href=#hl-1-131>131</a>
</span><span class=lnt id=hl-1-132><a class=lnlinks href=#hl-1-132>132</a>
</span><span class=lnt id=hl-1-133><a class=lnlinks href=#hl-1-133>133</a>
</span><span class=lnt id=hl-1-134><a class=lnlinks href=#hl-1-134>134</a>
</span><span class=lnt id=hl-1-135><a class=lnlinks href=#hl-1-135>135</a>
</span><span class=lnt id=hl-1-136><a class=lnlinks href=#hl-1-136>136</a>
</span><span class=lnt id=hl-1-137><a class=lnlinks href=#hl-1-137>137</a>
</span><span class=lnt id=hl-1-138><a class=lnlinks href=#hl-1-138>138</a>
</span><span class=lnt id=hl-1-139><a class=lnlinks href=#hl-1-139>139</a>
</span><span class=lnt id=hl-1-140><a class=lnlinks href=#hl-1-140>140</a>
</span><span class=lnt id=hl-1-141><a class=lnlinks href=#hl-1-141>141</a>
</span><span class=lnt id=hl-1-142><a class=lnlinks href=#hl-1-142>142</a>
</span><span class=lnt id=hl-1-143><a class=lnlinks href=#hl-1-143>143</a>
</span><span class=lnt id=hl-1-144><a class=lnlinks href=#hl-1-144>144</a>
</span><span class=lnt id=hl-1-145><a class=lnlinks href=#hl-1-145>145</a>
</span><span class=lnt id=hl-1-146><a class=lnlinks href=#hl-1-146>146</a>
</span><span class=lnt id=hl-1-147><a class=lnlinks href=#hl-1-147>147</a>
</span><span class=lnt id=hl-1-148><a class=lnlinks href=#hl-1-148>148</a>
</span><span class=lnt id=hl-1-149><a class=lnlinks href=#hl-1-149>149</a>
</span><span class=lnt id=hl-1-150><a class=lnlinks href=#hl-1-150>150</a>
</span><span class=lnt id=hl-1-151><a class=lnlinks href=#hl-1-151>151</a>
</span><span class=lnt id=hl-1-152><a class=lnlinks href=#hl-1-152>152</a>
</span><span class=lnt id=hl-1-153><a class=lnlinks href=#hl-1-153>153</a>
</span><span class=lnt id=hl-1-154><a class=lnlinks href=#hl-1-154>154</a>
</span><span class=lnt id=hl-1-155><a class=lnlinks href=#hl-1-155>155</a>
</span><span class=lnt id=hl-1-156><a class=lnlinks href=#hl-1-156>156</a>
</span><span class=lnt id=hl-1-157><a class=lnlinks href=#hl-1-157>157</a>
</span><span class=lnt id=hl-1-158><a class=lnlinks href=#hl-1-158>158</a>
</span><span class=lnt id=hl-1-159><a class=lnlinks href=#hl-1-159>159</a>
</span><span class=lnt id=hl-1-160><a class=lnlinks href=#hl-1-160>160</a>
</span><span class=lnt id=hl-1-161><a class=lnlinks href=#hl-1-161>161</a>
</span><span class=lnt id=hl-1-162><a class=lnlinks href=#hl-1-162>162</a>
</span><span class=lnt id=hl-1-163><a class=lnlinks href=#hl-1-163>163</a>
</span><span class=lnt id=hl-1-164><a class=lnlinks href=#hl-1-164>164</a>
</span><span class=lnt id=hl-1-165><a class=lnlinks href=#hl-1-165>165</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>asdict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>asyncio</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>uuid</span> <span class=kn>import</span> <span class=n>uuid4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 도메인 모델 정의</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Notification</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>notification_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 정의</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=p>:</span> <span class=n>Order</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 브로커 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageBroker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Queue</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_queue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>[</span><span class=n>queue_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>queue_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>queue_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>create_queue</span><span class=p>(</span><span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>[</span><span class=n>queue_name</span><span class=p>]</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 구독자들에게 메시지 전달</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>subscriber</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>queue_name</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>subscriber</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>callback</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>queue_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>create_queue</span><span class=p>(</span><span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>queue_name</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 서비스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_broker</span><span class=p>:</span> <span class=n>MessageBroker</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span> <span class=o>=</span> <span class=n>message_broker</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=o>=</span><span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>total_amount</span><span class=o>=</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span><span class=o>=</span><span class=s2>&#34;PENDING&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order</span><span class=o>.</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;ORDER_CREATED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=s2>&#34;order_events&#34;</span><span class=p>,</span> <span class=n>asdict</span><span class=p>(</span><span class=n>event</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_order_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>status</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>order_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>status</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 주문 상태 변경 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=n>OrderEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;ORDER_STATUS_UPDATED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=s2>&#34;order_events&#34;</span><span class=p>,</span> <span class=n>asdict</span><span class=p>(</span><span class=n>event</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 알림 서비스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NotificationService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_broker</span><span class=p>:</span> <span class=n>MessageBroker</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span> <span class=o>=</span> <span class=n>message_broker</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>notifications</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_order_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;order&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 타입에 따른 알림 메시지 생성</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;ORDER_CREATED&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_notification</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>order</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;주문이 생성되었습니다. 주문번호: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ORDER_NOTIFICATION&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;ORDER_STATUS_UPDATED&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_notification</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>order</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;주문 상태가 </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>로 변경되었습니다. 주문번호: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;STATUS_UPDATE&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_notification</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Notification</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>notification</span> <span class=o>=</span> <span class=n>Notification</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>notification_id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=nb>type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>notifications</span><span class=p>[</span><span class=n>notification</span><span class=o>.</span><span class=n>notification_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>notification</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실제 시스템에서는 여기서 이메일 발송, SMS 발송 등의 작업 수행</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;알림 발송: </span><span class=si>{</span><span class=n>notification</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>notification</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메인 애플리케이션</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 시스템 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>message_broker</span> <span class=o>=</span> <span class=n>MessageBroker</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>order_service</span> <span class=o>=</span> <span class=n>OrderService</span><span class=p>(</span><span class=n>message_broker</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>notification_service</span> <span class=o>=</span> <span class=n>NotificationService</span><span class=p>(</span><span class=n>message_broker</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 알림 서비스를 주문 이벤트에 구독</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>message_broker</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;order_events&#34;</span><span class=p>,</span> <span class=n>notification_service</span><span class=o>.</span><span class=n>handle_order_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 테스트 시나리오</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1. 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span><span class=o>=</span><span class=p>[{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;prod1&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=n>total_amount</span><span class=o>=</span><span class=mi>2000</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 잠시 대기하여 알림 처리 시간 제공</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. 주문 상태 업데이트</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>update_order_status</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;PROCESSING&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 알림 처리 시간 제공</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애플리케이션 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>이 예시를 확장하거나 수정할 수 있는 방향:</p><ol><li><p>실제 메시지 브로커 통합</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ 사용 예시</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RabbitMQBroker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>재시도 메커니즘 추가</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>NotificationService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_order_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>max_retries</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=n>retry_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>retry_count</span> <span class=o>&lt;</span> <span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>retry_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>retry_count</span> <span class=o>==</span> <span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># Dead Letter Queue로 이동</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>move_to_dlq</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>retry_count</span><span class=p>)</span>  <span class=c1># 지수 백오프</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>분산 트레이싱 추가</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>trace_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=c1># 트레이싱 컨텍스트 시작</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_span</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;create_order_</span><span class=si>{</span><span class=n>trace_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_order</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>items</span><span class=p>,</span> <span class=n>total_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_tag</span><span class=p>(</span><span class=s2>&#34;order_id&#34;</span><span class=p>,</span> <span class=n>order</span><span class=o>.</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>order</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/software-design-and-architecture/>Software-Design-and-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/software-architecture/>Software-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/software-architecture-patterns/>Software-Architecture-Patterns</a></li><li><a href=https://buenhyden.github.io/tags/application-structure/>Application-Structure</a></li><li><a href=https://buenhyden.github.io/tags/msa-patterns/>MSA-Patterns</a></li><li><a href=https://buenhyden.github.io/tags/communication/>Communication</a></li><li><a href=https://buenhyden.github.io/tags/asynchronous-communication-pattern/>Asynchronous-Communication-Pattern</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/software-design-and-architecture/msa-patterns/communication/synchronous-communication-pattern/><span class=title>« Prev</span><br><span>Synchronous Communication Pattern</span>
</a><a class=next href=https://buenhyden.github.io/posts/data-structure-and-algorithm/data-structure/non-primitive/non-linear/graph/directed-acyclic-graph/><span class=title>Next »</span><br><span>Directed Acyclic Graph</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>