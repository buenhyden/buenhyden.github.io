<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Peer-to-Peer Pattern | hyunyoun's Blog</title>
<meta name=keywords content="Software-Design-and-Architecture,Software-Architecture-Patterns,P2P,Peer-to-Peer-Pattern"><meta name=description content="분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/peer-to-peer-pattern/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.9a2bbe2d8b5afa9d4df22976abb7b72f1f7f1c467d2b30f03090108f9496ae6c.css integrity="sha256-miu+LYta+p1N8il2q7e3Lx9/HEZ9KzDwMJAQj5SWrmw=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/peer-to-peer-pattern/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/peer-to-peer-pattern/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Peer-to-Peer Pattern"><meta property="og:description" content="분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-20T08:28:00+00:00"><meta property="article:modified_time" content="2024-11-20T08:28:00+00:00"><meta property="article:tag" content="Software-Design-and-Architecture"><meta property="article:tag" content="Software-Architecture-Patterns"><meta property="article:tag" content="P2P"><meta property="article:tag" content="Peer-to-Peer-Pattern"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Peer-to-Peer Pattern"><meta name=twitter:description content="분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Design and Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/"},{"@type":"ListItem","position":3,"name":"Software Architecture Pattern","item":"https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/"},{"@type":"ListItem","position":4,"name":"Peer-to-Peer Pattern","item":"https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/peer-to-peer-pattern/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Peer-to-Peer Pattern","name":"Peer-to-Peer Pattern","description":"분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조","keywords":["Software-Design-and-Architecture","Software-Architecture-Patterns","P2P","Peer-to-Peer-Pattern"],"articleBody":"Peer-to-Peer Pattern (P2P 패턴) 피어-투-피어(Peer-to-Peer, P2P) 패턴은 분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조.\n이 패턴은 중앙 서버에 의존하지 않고 피어들이 직접 리소스를 공유하고 통신하는 것이 특징이다.\nhttps://www.geeksforgeeks.org/what-is-p2p-peer-to-peer-process/\nP2P 패턴의 주요 특징 분산화: 중앙 서버 없이 모든 피어가 동등한 권한과 책임을 가집니다. 자율성: 각 피어는 독립적으로 작동하며, 네트워크의 전체 기능에 영향을 주지 않고 참여하거나 떠날 수 있습니다. 확장성: 새로운 피어가 추가될수록 네트워크의 전체 용량과 리소스 풀이 증가합니다. 리소스 공유: 피어들은 파일, 대역폭, 처리 능력 등의 리소스를 직접 공유합니다. 익명성: 중앙 서버를 통하지 않고 직접 통신하므로 사용자의 익명성을 유지할 수 있습니다. 장점 효율적인 리소스 활용: 유휴 컴퓨팅 자원을 효과적으로 활용할 수 있습니다. 높은 확장성: 피어가 증가할수록 네트워크의 성능이 향상됩니다. 내결함성: 일부 피어의 장애가 전체 네트워크에 큰 영향을 미치지 않습니다. 비용 효율성: 중앙 서버 구축 및 유지 비용이 감소합니다. 단점 보안 위험: 중앙 통제가 없어 악성 코드나 불법 콘텐츠의 유통 위험이 있습니다. 성능 불균형: 피어들의 리소스 제공 정도에 따라 네트워크 성능이 불균형할 수 있습니다. 데이터 무결성: 피어들이 자유롭게 데이터를 추가하고 조작할 수 있어 데이터 무결성 유지가 어려울 수 있습니다. 구현 시 고려사항 피어 발견:\n새로운 피어를 어떻게 찾고 연결할 것인가 기존 네트워크에 어떻게 참여할 것인가 피어 목록을 어떻게 유지할 것인가 메시지 라우팅:\n메시지를 어떻게 효율적으로 전파할 것인가 중복 메시지를 어떻게 처리할 것인가 네트워크 부하를 어떻게 관리할 것인가 보안:\n악의적인 피어를 어떻게 처리할 것인가 데이터의 무결성을 어떻게 보장할 것인가 프라이버시를 어떻게 보호할 것인가 P2P 패턴의 주요 응용 분야 파일 공유: BitTorrent와 같은 프로토콜을 사용한 대용량 파일 공유. 블록체인 및 암호화폐: Bitcoin, Ethereum 등의 분산 원장 기술. 커뮤니케이션: Skype와 같은 P2P 기반의 음성 및 영상 통화 서비스. 분산 스토리지: InterPlanetary File System (IPFS)과 같은 분산 파일 시스템. 협업 컴퓨팅: Folding@home, SETI@home과 같은 분산 컴퓨팅 프로젝트. 구현 예시 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 import socket import threading import json from typing import Dict, Set import time class Peer: def __init__(self, host: str, port: int): # 피어의 기본 정보 self.host = host self.port = port self.peers: Dict[str, tuple] = {} # 연결된 피어들의 정보 self.messages: Set[str] = set() # 수신한 메시지 ID 추적 # 메시지 수신을 위한 서버 소켓 설정 self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.server_socket.bind((host, port)) self.server_socket.listen(10) # 서버 수신 스레드 시작 self.receiver_thread = threading.Thread(target=self._listen_for_peers) self.receiver_thread.daemon = True self.receiver_thread.start() print(f\"Peer started on {host}:{port}\") def _listen_for_peers(self): \"\"\"다른 피어로부터의 연결을 수신하는 메서드\"\"\" while True: try: client_socket, address = self.server_socket.accept() # 각 연결에 대해 새로운 핸들러 스레드 시작 handler = threading.Thread( target=self._handle_peer, args=(client_socket, address) ) handler.daemon = True handler.start() except Exception as e: print(f\"Error accepting connection: {e}\") def _handle_peer(self, client_socket: socket.socket, address: tuple): \"\"\"연결된 피어와의 통신을 처리하는 메서드\"\"\" try: while True: # 메시지 수신 data = client_socket.recv(4096) if not data: break # JSON 메시지 파싱 message = json.loads(data.decode()) if message[\"type\"] == \"chat\": # 이미 받은 메시지인지 확인 if message[\"id\"] not in self.messages: self.messages.add(message[\"id\"]) print(f\"\\nReceived message: {message['content']}\") # 다른 피어들에게 메시지 전파 self._broadcast_message(message) elif message[\"type\"] == \"join\": # 새로운 피어 정보 저장 peer_info = message[\"peer_info\"] peer_id = f\"{peer_info['host']}:{peer_info['port']}\" self.peers[peer_id] = (peer_info['host'], peer_info['port']) print(f\"New peer joined: {peer_id}\") # 현재 알고 있는 피어 목록 전송 response = { \"type\": \"peer_list\", \"peers\": [ {\"host\": h, \"port\": p} for h, p in self.peers.values() ] } client_socket.send(json.dumps(response).encode()) except Exception as e: print(f\"Error handling peer: {e}\") finally: client_socket.close() def connect_to_network(self, known_host: str, known_port: int): \"\"\"기존 P2P 네트워크에 연결하는 메서드\"\"\" try: # 알려진 피어에 연결 sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((known_host, known_port)) # 자신의 정보를 전송 join_message = { \"type\": \"join\", \"peer_info\": { \"host\": self.host, \"port\": self.port } } sock.send(json.dumps(join_message).encode()) # 피어 목록 수신 data = sock.recv(4096) response = json.loads(data.decode()) if response[\"type\"] == \"peer_list\": for peer in response[\"peers\"]: peer_id = f\"{peer['host']}:{peer['port']}\" self.peers[peer_id] = (peer['host'], peer['port']) print(f\"Connected to network via {known_host}:{known_port}\") print(f\"Known peers: {list(self.peers.keys())}\") except Exception as e: print(f\"Error connecting to network: {e}\") def broadcast_chat_message(self, content: str): \"\"\"채팅 메시지를 네트워크에 브로드캐스트하는 메서드\"\"\" message = { \"type\": \"chat\", \"id\": f\"{self.host}:{self.port}:{time.time()}\", \"content\": content } self._broadcast_message(message) def _broadcast_message(self, message: dict): \"\"\"메시지를 모든 알려진 피어에게 전송하는 메서드\"\"\" for peer_host, peer_port in self.peers.values(): try: sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((peer_host, peer_port)) sock.send(json.dumps(message).encode()) sock.close() except Exception as e: print(f\"Error sending to peer {peer_host}:{peer_port}: {e}\") # 사용 예시 def run_peer(host: str, port: int, known_peer: tuple = None): peer = Peer(host, port) if known_peer: # 기존 네트워크에 연결 peer.connect_to_network(*known_peer) # 사용자 입력 처리 while True: try: message = input(\"Enter message (or 'quit' to exit): \") if message.lower() == 'quit': break peer.broadcast_chat_message(message) except KeyboardInterrupt: break except Exception as e: print(f\"Error: {e}\") if __name__ == \"__main__\": # 첫 번째 피어 실행 run_peer(\"localhost\", 5000) # 다른 터미널에서 실행할 두 번째 피어 명령: # run_peer(\"localhost\", 5001, (\"localhost\", 5000)) 참고 및 출처 ","wordCount":"891","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-11-20T08:28:00Z","dateModified":"2024-11-20T08:28:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/peer-to-peer-pattern/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>posts</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/>Software Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/>Software Architecture Pattern</a></div><h1 class="post-title entry-hint-parent">Peer-to-Peer Pattern</h1><div class=post-description>분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조</div><div class=post-meta><span title='2024-11-20 08:28:00 +0000 UTC'>November 20, 2024</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;891 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Software%20Design%20and%20Architecture/Software%20Architecture%20Patterns/Peer-to-Peer-Pattern.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#peer-to-peer-pattern-p2p-패턴>Peer-to-Peer Pattern (P2P 패턴)</a><ul><li><a href=#p2p-패턴의-주요-특징>P2P 패턴의 주요 특징</a></li><li><a href=#장점>장점</a></li><li><a href=#단점>단점</a></li><li><a href=#구현-시-고려사항>구현 시 고려사항</a></li><li><a href=#p2p-패턴의-주요-응용-분야>P2P 패턴의 주요 응용 분야</a></li><li><a href=#구현-예시>구현 예시</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=peer-to-peer-pattern-p2p-패턴>Peer-to-Peer Pattern (P2P 패턴)<a hidden class=anchor aria-hidden=true href=#peer-to-peer-pattern-p2p-패턴>#</a></h2><p>피어-투-피어(Peer-to-Peer, P2P) 패턴은 분산 네트워크 아키텍처의 한 형태로, 각 노드(피어)가 클라이언트와 서버의 역할을 동시에 수행하는 구조.<br>이 패턴은 중앙 서버에 의존하지 않고 피어들이 직접 리소스를 공유하고 통신하는 것이 특징이다.</p><p><figure><img alt="P2P 아키텍처" loading=lazy src=/img/GFGP2PArchitecture.png><figcaption>https://www.geeksforgeeks.org/what-is-p2p-peer-to-peer-process/</figcaption></figure></p><h3 id=p2p-패턴의-주요-특징>P2P 패턴의 주요 특징<a hidden class=anchor aria-hidden=true href=#p2p-패턴의-주요-특징>#</a></h3><ol><li><strong>분산화</strong>: 중앙 서버 없이 모든 피어가 동등한 권한과 책임을 가집니다.</li><li><strong>자율성</strong>: 각 피어는 독립적으로 작동하며, 네트워크의 전체 기능에 영향을 주지 않고 참여하거나 떠날 수 있습니다.</li><li><strong>확장성</strong>: 새로운 피어가 추가될수록 네트워크의 전체 용량과 리소스 풀이 증가합니다.</li><li><strong>리소스 공유</strong>: 피어들은 파일, 대역폭, 처리 능력 등의 리소스를 직접 공유합니다.</li><li><strong>익명성</strong>: 중앙 서버를 통하지 않고 직접 통신하므로 사용자의 익명성을 유지할 수 있습니다.</li></ol><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><ol><li><strong>효율적인 리소스 활용</strong>: 유휴 컴퓨팅 자원을 효과적으로 활용할 수 있습니다.</li><li><strong>높은 확장성</strong>: 피어가 증가할수록 네트워크의 성능이 향상됩니다.</li><li><strong>내결함성</strong>: 일부 피어의 장애가 전체 네트워크에 큰 영향을 미치지 않습니다.</li><li><strong>비용 효율성</strong>: 중앙 서버 구축 및 유지 비용이 감소합니다.</li></ol><h3 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h3><ol><li><strong>보안 위험</strong>: 중앙 통제가 없어 악성 코드나 불법 콘텐츠의 유통 위험이 있습니다.</li><li><strong>성능 불균형</strong>: 피어들의 리소스 제공 정도에 따라 네트워크 성능이 불균형할 수 있습니다.</li><li><strong>데이터 무결성</strong>: 피어들이 자유롭게 데이터를 추가하고 조작할 수 있어 데이터 무결성 유지가 어려울 수 있습니다.</li></ol><h3 id=구현-시-고려사항>구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#구현-시-고려사항>#</a></h3><ol><li><p>피어 발견:</p><ul><li>새로운 피어를 어떻게 찾고 연결할 것인가</li><li>기존 네트워크에 어떻게 참여할 것인가</li><li>피어 목록을 어떻게 유지할 것인가</li></ul></li><li><p>메시지 라우팅:</p><ul><li>메시지를 어떻게 효율적으로 전파할 것인가</li><li>중복 메시지를 어떻게 처리할 것인가</li><li>네트워크 부하를 어떻게 관리할 것인가</li></ul></li><li><p>보안:</p><ul><li>악의적인 피어를 어떻게 처리할 것인가</li><li>데이터의 무결성을 어떻게 보장할 것인가</li><li>프라이버시를 어떻게 보호할 것인가</li></ul></li></ol><h3 id=p2p-패턴의-주요-응용-분야>P2P 패턴의 주요 응용 분야<a hidden class=anchor aria-hidden=true href=#p2p-패턴의-주요-응용-분야>#</a></h3><ol><li><strong>파일 공유</strong>: BitTorrent와 같은 프로토콜을 사용한 대용량 파일 공유.</li><li><strong>블록체인 및 암호화폐</strong>: Bitcoin, Ethereum 등의 분산 원장 기술.</li><li><strong>커뮤니케이션</strong>: Skype와 같은 P2P 기반의 음성 및 영상 통화 서비스.</li><li><strong>분산 스토리지</strong>: InterPlanetary File System (IPFS)과 같은 분산 파일 시스템.</li><li><strong>협업 컴퓨팅</strong>: Folding@home, SETI@home과 같은 분산 컴퓨팅 프로젝트.</li></ol><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>  1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>  2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>  3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>  4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>  5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>  6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7>  7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8>  8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9>  9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10> 10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11> 11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12> 12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13> 13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14> 14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15> 15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16> 16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17> 17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18> 18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19> 19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20> 20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21> 21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22> 22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23> 23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24> 24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25> 25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26> 26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27> 27</a>
</span><span class=lnt id=hl-0-28><a class=lnlinks href=#hl-0-28> 28</a>
</span><span class=lnt id=hl-0-29><a class=lnlinks href=#hl-0-29> 29</a>
</span><span class=lnt id=hl-0-30><a class=lnlinks href=#hl-0-30> 30</a>
</span><span class=lnt id=hl-0-31><a class=lnlinks href=#hl-0-31> 31</a>
</span><span class=lnt id=hl-0-32><a class=lnlinks href=#hl-0-32> 32</a>
</span><span class=lnt id=hl-0-33><a class=lnlinks href=#hl-0-33> 33</a>
</span><span class=lnt id=hl-0-34><a class=lnlinks href=#hl-0-34> 34</a>
</span><span class=lnt id=hl-0-35><a class=lnlinks href=#hl-0-35> 35</a>
</span><span class=lnt id=hl-0-36><a class=lnlinks href=#hl-0-36> 36</a>
</span><span class=lnt id=hl-0-37><a class=lnlinks href=#hl-0-37> 37</a>
</span><span class=lnt id=hl-0-38><a class=lnlinks href=#hl-0-38> 38</a>
</span><span class=lnt id=hl-0-39><a class=lnlinks href=#hl-0-39> 39</a>
</span><span class=lnt id=hl-0-40><a class=lnlinks href=#hl-0-40> 40</a>
</span><span class=lnt id=hl-0-41><a class=lnlinks href=#hl-0-41> 41</a>
</span><span class=lnt id=hl-0-42><a class=lnlinks href=#hl-0-42> 42</a>
</span><span class=lnt id=hl-0-43><a class=lnlinks href=#hl-0-43> 43</a>
</span><span class=lnt id=hl-0-44><a class=lnlinks href=#hl-0-44> 44</a>
</span><span class=lnt id=hl-0-45><a class=lnlinks href=#hl-0-45> 45</a>
</span><span class=lnt id=hl-0-46><a class=lnlinks href=#hl-0-46> 46</a>
</span><span class=lnt id=hl-0-47><a class=lnlinks href=#hl-0-47> 47</a>
</span><span class=lnt id=hl-0-48><a class=lnlinks href=#hl-0-48> 48</a>
</span><span class=lnt id=hl-0-49><a class=lnlinks href=#hl-0-49> 49</a>
</span><span class=lnt id=hl-0-50><a class=lnlinks href=#hl-0-50> 50</a>
</span><span class=lnt id=hl-0-51><a class=lnlinks href=#hl-0-51> 51</a>
</span><span class=lnt id=hl-0-52><a class=lnlinks href=#hl-0-52> 52</a>
</span><span class=lnt id=hl-0-53><a class=lnlinks href=#hl-0-53> 53</a>
</span><span class=lnt id=hl-0-54><a class=lnlinks href=#hl-0-54> 54</a>
</span><span class=lnt id=hl-0-55><a class=lnlinks href=#hl-0-55> 55</a>
</span><span class=lnt id=hl-0-56><a class=lnlinks href=#hl-0-56> 56</a>
</span><span class=lnt id=hl-0-57><a class=lnlinks href=#hl-0-57> 57</a>
</span><span class=lnt id=hl-0-58><a class=lnlinks href=#hl-0-58> 58</a>
</span><span class=lnt id=hl-0-59><a class=lnlinks href=#hl-0-59> 59</a>
</span><span class=lnt id=hl-0-60><a class=lnlinks href=#hl-0-60> 60</a>
</span><span class=lnt id=hl-0-61><a class=lnlinks href=#hl-0-61> 61</a>
</span><span class=lnt id=hl-0-62><a class=lnlinks href=#hl-0-62> 62</a>
</span><span class=lnt id=hl-0-63><a class=lnlinks href=#hl-0-63> 63</a>
</span><span class=lnt id=hl-0-64><a class=lnlinks href=#hl-0-64> 64</a>
</span><span class=lnt id=hl-0-65><a class=lnlinks href=#hl-0-65> 65</a>
</span><span class=lnt id=hl-0-66><a class=lnlinks href=#hl-0-66> 66</a>
</span><span class=lnt id=hl-0-67><a class=lnlinks href=#hl-0-67> 67</a>
</span><span class=lnt id=hl-0-68><a class=lnlinks href=#hl-0-68> 68</a>
</span><span class=lnt id=hl-0-69><a class=lnlinks href=#hl-0-69> 69</a>
</span><span class=lnt id=hl-0-70><a class=lnlinks href=#hl-0-70> 70</a>
</span><span class=lnt id=hl-0-71><a class=lnlinks href=#hl-0-71> 71</a>
</span><span class=lnt id=hl-0-72><a class=lnlinks href=#hl-0-72> 72</a>
</span><span class=lnt id=hl-0-73><a class=lnlinks href=#hl-0-73> 73</a>
</span><span class=lnt id=hl-0-74><a class=lnlinks href=#hl-0-74> 74</a>
</span><span class=lnt id=hl-0-75><a class=lnlinks href=#hl-0-75> 75</a>
</span><span class=lnt id=hl-0-76><a class=lnlinks href=#hl-0-76> 76</a>
</span><span class=lnt id=hl-0-77><a class=lnlinks href=#hl-0-77> 77</a>
</span><span class=lnt id=hl-0-78><a class=lnlinks href=#hl-0-78> 78</a>
</span><span class=lnt id=hl-0-79><a class=lnlinks href=#hl-0-79> 79</a>
</span><span class=lnt id=hl-0-80><a class=lnlinks href=#hl-0-80> 80</a>
</span><span class=lnt id=hl-0-81><a class=lnlinks href=#hl-0-81> 81</a>
</span><span class=lnt id=hl-0-82><a class=lnlinks href=#hl-0-82> 82</a>
</span><span class=lnt id=hl-0-83><a class=lnlinks href=#hl-0-83> 83</a>
</span><span class=lnt id=hl-0-84><a class=lnlinks href=#hl-0-84> 84</a>
</span><span class=lnt id=hl-0-85><a class=lnlinks href=#hl-0-85> 85</a>
</span><span class=lnt id=hl-0-86><a class=lnlinks href=#hl-0-86> 86</a>
</span><span class=lnt id=hl-0-87><a class=lnlinks href=#hl-0-87> 87</a>
</span><span class=lnt id=hl-0-88><a class=lnlinks href=#hl-0-88> 88</a>
</span><span class=lnt id=hl-0-89><a class=lnlinks href=#hl-0-89> 89</a>
</span><span class=lnt id=hl-0-90><a class=lnlinks href=#hl-0-90> 90</a>
</span><span class=lnt id=hl-0-91><a class=lnlinks href=#hl-0-91> 91</a>
</span><span class=lnt id=hl-0-92><a class=lnlinks href=#hl-0-92> 92</a>
</span><span class=lnt id=hl-0-93><a class=lnlinks href=#hl-0-93> 93</a>
</span><span class=lnt id=hl-0-94><a class=lnlinks href=#hl-0-94> 94</a>
</span><span class=lnt id=hl-0-95><a class=lnlinks href=#hl-0-95> 95</a>
</span><span class=lnt id=hl-0-96><a class=lnlinks href=#hl-0-96> 96</a>
</span><span class=lnt id=hl-0-97><a class=lnlinks href=#hl-0-97> 97</a>
</span><span class=lnt id=hl-0-98><a class=lnlinks href=#hl-0-98> 98</a>
</span><span class=lnt id=hl-0-99><a class=lnlinks href=#hl-0-99> 99</a>
</span><span class=lnt id=hl-0-100><a class=lnlinks href=#hl-0-100>100</a>
</span><span class=lnt id=hl-0-101><a class=lnlinks href=#hl-0-101>101</a>
</span><span class=lnt id=hl-0-102><a class=lnlinks href=#hl-0-102>102</a>
</span><span class=lnt id=hl-0-103><a class=lnlinks href=#hl-0-103>103</a>
</span><span class=lnt id=hl-0-104><a class=lnlinks href=#hl-0-104>104</a>
</span><span class=lnt id=hl-0-105><a class=lnlinks href=#hl-0-105>105</a>
</span><span class=lnt id=hl-0-106><a class=lnlinks href=#hl-0-106>106</a>
</span><span class=lnt id=hl-0-107><a class=lnlinks href=#hl-0-107>107</a>
</span><span class=lnt id=hl-0-108><a class=lnlinks href=#hl-0-108>108</a>
</span><span class=lnt id=hl-0-109><a class=lnlinks href=#hl-0-109>109</a>
</span><span class=lnt id=hl-0-110><a class=lnlinks href=#hl-0-110>110</a>
</span><span class=lnt id=hl-0-111><a class=lnlinks href=#hl-0-111>111</a>
</span><span class=lnt id=hl-0-112><a class=lnlinks href=#hl-0-112>112</a>
</span><span class=lnt id=hl-0-113><a class=lnlinks href=#hl-0-113>113</a>
</span><span class=lnt id=hl-0-114><a class=lnlinks href=#hl-0-114>114</a>
</span><span class=lnt id=hl-0-115><a class=lnlinks href=#hl-0-115>115</a>
</span><span class=lnt id=hl-0-116><a class=lnlinks href=#hl-0-116>116</a>
</span><span class=lnt id=hl-0-117><a class=lnlinks href=#hl-0-117>117</a>
</span><span class=lnt id=hl-0-118><a class=lnlinks href=#hl-0-118>118</a>
</span><span class=lnt id=hl-0-119><a class=lnlinks href=#hl-0-119>119</a>
</span><span class=lnt id=hl-0-120><a class=lnlinks href=#hl-0-120>120</a>
</span><span class=lnt id=hl-0-121><a class=lnlinks href=#hl-0-121>121</a>
</span><span class=lnt id=hl-0-122><a class=lnlinks href=#hl-0-122>122</a>
</span><span class=lnt id=hl-0-123><a class=lnlinks href=#hl-0-123>123</a>
</span><span class=lnt id=hl-0-124><a class=lnlinks href=#hl-0-124>124</a>
</span><span class=lnt id=hl-0-125><a class=lnlinks href=#hl-0-125>125</a>
</span><span class=lnt id=hl-0-126><a class=lnlinks href=#hl-0-126>126</a>
</span><span class=lnt id=hl-0-127><a class=lnlinks href=#hl-0-127>127</a>
</span><span class=lnt id=hl-0-128><a class=lnlinks href=#hl-0-128>128</a>
</span><span class=lnt id=hl-0-129><a class=lnlinks href=#hl-0-129>129</a>
</span><span class=lnt id=hl-0-130><a class=lnlinks href=#hl-0-130>130</a>
</span><span class=lnt id=hl-0-131><a class=lnlinks href=#hl-0-131>131</a>
</span><span class=lnt id=hl-0-132><a class=lnlinks href=#hl-0-132>132</a>
</span><span class=lnt id=hl-0-133><a class=lnlinks href=#hl-0-133>133</a>
</span><span class=lnt id=hl-0-134><a class=lnlinks href=#hl-0-134>134</a>
</span><span class=lnt id=hl-0-135><a class=lnlinks href=#hl-0-135>135</a>
</span><span class=lnt id=hl-0-136><a class=lnlinks href=#hl-0-136>136</a>
</span><span class=lnt id=hl-0-137><a class=lnlinks href=#hl-0-137>137</a>
</span><span class=lnt id=hl-0-138><a class=lnlinks href=#hl-0-138>138</a>
</span><span class=lnt id=hl-0-139><a class=lnlinks href=#hl-0-139>139</a>
</span><span class=lnt id=hl-0-140><a class=lnlinks href=#hl-0-140>140</a>
</span><span class=lnt id=hl-0-141><a class=lnlinks href=#hl-0-141>141</a>
</span><span class=lnt id=hl-0-142><a class=lnlinks href=#hl-0-142>142</a>
</span><span class=lnt id=hl-0-143><a class=lnlinks href=#hl-0-143>143</a>
</span><span class=lnt id=hl-0-144><a class=lnlinks href=#hl-0-144>144</a>
</span><span class=lnt id=hl-0-145><a class=lnlinks href=#hl-0-145>145</a>
</span><span class=lnt id=hl-0-146><a class=lnlinks href=#hl-0-146>146</a>
</span><span class=lnt id=hl-0-147><a class=lnlinks href=#hl-0-147>147</a>
</span><span class=lnt id=hl-0-148><a class=lnlinks href=#hl-0-148>148</a>
</span><span class=lnt id=hl-0-149><a class=lnlinks href=#hl-0-149>149</a>
</span><span class=lnt id=hl-0-150><a class=lnlinks href=#hl-0-150>150</a>
</span><span class=lnt id=hl-0-151><a class=lnlinks href=#hl-0-151>151</a>
</span><span class=lnt id=hl-0-152><a class=lnlinks href=#hl-0-152>152</a>
</span><span class=lnt id=hl-0-153><a class=lnlinks href=#hl-0-153>153</a>
</span><span class=lnt id=hl-0-154><a class=lnlinks href=#hl-0-154>154</a>
</span><span class=lnt id=hl-0-155><a class=lnlinks href=#hl-0-155>155</a>
</span><span class=lnt id=hl-0-156><a class=lnlinks href=#hl-0-156>156</a>
</span><span class=lnt id=hl-0-157><a class=lnlinks href=#hl-0-157>157</a>
</span><span class=lnt id=hl-0-158><a class=lnlinks href=#hl-0-158>158</a>
</span><span class=lnt id=hl-0-159><a class=lnlinks href=#hl-0-159>159</a>
</span><span class=lnt id=hl-0-160><a class=lnlinks href=#hl-0-160>160</a>
</span><span class=lnt id=hl-0-161><a class=lnlinks href=#hl-0-161>161</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Set</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Peer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>port</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 피어의 기본 정보</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>host</span> <span class=o>=</span> <span class=n>host</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>port</span> <span class=o>=</span> <span class=n>port</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>peers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 연결된 피어들의 정보</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>messages</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>    <span class=c1># 수신한 메시지 ID 추적</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 수신을 위한 서버 소켓 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server_socket</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=o>.</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>socket</span><span class=o>.</span><span class=n>SOCK_STREAM</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server_socket</span><span class=o>.</span><span class=n>bind</span><span class=p>((</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server_socket</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 서버 수신 스레드 시작</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>receiver_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_listen_for_peers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>receiver_thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>receiver_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Peer started on </span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_listen_for_peers</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;다른 피어로부터의 연결을 수신하는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>client_socket</span><span class=p>,</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>server_socket</span><span class=o>.</span><span class=n>accept</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=c1># 각 연결에 대해 새로운 핸들러 스레드 시작</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_handle_peer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>client_socket</span><span class=p>,</span> <span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error accepting connection: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_handle_peer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client_socket</span><span class=p>:</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>,</span> <span class=n>address</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;연결된 피어와의 통신을 처리하는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 수신</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=n>client_socket</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=c1># JSON 메시지 파싱</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;chat&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 이미 받은 메시지인지 확인</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Received message: </span><span class=si>{</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 다른 피어들에게 메시지 전파</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_broadcast_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;join&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 새로운 피어 정보 저장</span>
</span></span><span class=line><span class=cl>                    <span class=n>peer_info</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;peer_info&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>peer_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>peer_info</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>peer_info</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>peers</span><span class=p>[</span><span class=n>peer_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>peer_info</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>],</span> <span class=n>peer_info</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;New peer joined: </span><span class=si>{</span><span class=n>peer_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 현재 알고 있는 피어 목록 전송</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;peer_list&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;peers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=n>h</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=n>p</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>                            <span class=k>for</span> <span class=n>h</span><span class=p>,</span> <span class=n>p</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>peers</span><span class=o>.</span><span class=n>values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>client_socket</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>response</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error handling peer: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>client_socket</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>connect_to_network</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>known_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>known_port</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;기존 P2P 네트워크에 연결하는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 알려진 피어에 연결</span>
</span></span><span class=line><span class=cl>            <span class=n>sock</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=o>.</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>socket</span><span class=o>.</span><span class=n>SOCK_STREAM</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>sock</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=n>known_host</span><span class=p>,</span> <span class=n>known_port</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 자신의 정보를 전송</span>
</span></span><span class=line><span class=cl>            <span class=n>join_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;join&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;peer_info&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>port</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>sock</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>join_message</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 피어 목록 수신</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>sock</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;peer_list&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>peer</span> <span class=ow>in</span> <span class=n>response</span><span class=p>[</span><span class=s2>&#34;peers&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=n>peer_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>peer</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>peer</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>peers</span><span class=p>[</span><span class=n>peer_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>peer</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>],</span> <span class=n>peer</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Connected to network via </span><span class=si>{</span><span class=n>known_host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>known_port</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Known peers: </span><span class=si>{</span><span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>peers</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error connecting to network: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>broadcast_chat_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;채팅 메시지를 네트워크에 브로드캐스트하는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;chat&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>port</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_broadcast_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_broadcast_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지를 모든 알려진 피어에게 전송하는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>peer_host</span><span class=p>,</span> <span class=n>peer_port</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>peers</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>sock</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=o>.</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>socket</span><span class=o>.</span><span class=n>SOCK_STREAM</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sock</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=n>peer_host</span><span class=p>,</span> <span class=n>peer_port</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>sock</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=n>sock</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error sending to peer </span><span class=si>{</span><span class=n>peer_host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>peer_port</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_peer</span><span class=p>(</span><span class=n>host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>port</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>known_peer</span><span class=p>:</span> <span class=nb>tuple</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>peer</span> <span class=o>=</span> <span class=n>Peer</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>known_peer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기존 네트워크에 연결</span>
</span></span><span class=line><span class=cl>        <span class=n>peer</span><span class=o>.</span><span class=n>connect_to_network</span><span class=p>(</span><span class=o>*</span><span class=n>known_peer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 사용자 입력 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter message (or &#39;quit&#39; to exit): &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;quit&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=n>peer</span><span class=o>.</span><span class=n>broadcast_chat_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 첫 번째 피어 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>run_peer</span><span class=p>(</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=mi>5000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 다른 터미널에서 실행할 두 번째 피어 명령:</span>
</span></span><span class=line><span class=cl>    <span class=c1># run_peer(&#34;localhost&#34;, 5001, (&#34;localhost&#34;, 5000))</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/software-design-and-architecture/>Software-Design-and-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/software-architecture-patterns/>Software-Architecture-Patterns</a></li><li><a href=https://buenhyden.github.io/tags/p2p/>P2P</a></li><li><a href=https://buenhyden.github.io/tags/peer-to-peer-pattern/>Peer-to-Peer-Pattern</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/master-slave-pattern/><span class=title>« Prev</span><br><span>Master-Slave Pattern</span>
</a><a class=next href=https://buenhyden.github.io/posts/software-design-and-architecture/software-architecture-patterns/pipe-filter-pattern/><span class=title>Next »</span><br><span>Pipe-Filter Pattern</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>