<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Message-Driven vs. Event-Driven Architecture | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Styles,Messaging-Oriented-Styles,Message-Driven-Architecture,Event-Driven-Architecture,Asynchronous-Communication"><meta name=description content="메시지 기반 아키텍처 (Message-Driven Architecture, MDA) 와 이벤트 기반 아키텍처 (Event-Driven Architecture, EDA) 는 시스템 간의 통신 및 동작 연결 방식에서 핵심적인 패러다임이다. 메시지 - 기반은 직접적 명령과 데이터 전달에 집중하며, 이벤트 - 기반은 상태 변화와 그에 대한 반응에 중점을 둔다. 각각의 방식은 구조적 장점과 단점이 명확하므로 실무에서 상황에 맞는 선택이 필요하다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/message-driven-vs-event-driven-architecture/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/message-driven-vs-event-driven-architecture/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/message-driven-vs-event-driven-architecture/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Message-Driven vs. Event-Driven Architecture"><meta property="og:description" content="메시지 기반 아키텍처 (Message-Driven Architecture, MDA) 와 이벤트 기반 아키텍처 (Event-Driven Architecture, EDA) 는 시스템 간의 통신 및 동작 연결 방식에서 핵심적인 패러다임이다. 메시지 - 기반은 직접적 명령과 데이터 전달에 집중하며, 이벤트 - 기반은 상태 변화와 그에 대한 반응에 중점을 둔다. 각각의 방식은 구조적 장점과 단점이 명확하므로 실무에서 상황에 맞는 선택이 필요하다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-23T12:02:00+00:00"><meta property="article:modified_time" content="2025-06-23T12:02:00+00:00"><meta property="article:tag" content="Software-Engineering"><meta property="article:tag" content="Design-and-Architecture"><meta property="article:tag" content="Architecture-Styles-and-Patterns"><meta property="article:tag" content="Architecture-Styles"><meta property="article:tag" content="Messaging-Oriented-Styles"><meta property="article:tag" content="Message-Driven-Architecture"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Message-Driven vs. Event-Driven Architecture"><meta name=twitter:description content="메시지 기반 아키텍처 (Message-Driven Architecture, MDA) 와 이벤트 기반 아키텍처 (Event-Driven Architecture, EDA) 는 시스템 간의 통신 및 동작 연결 방식에서 핵심적인 패러다임이다. 메시지 - 기반은 직접적 명령과 데이터 전달에 집중하며, 이벤트 - 기반은 상태 변화와 그에 대한 반응에 중점을 둔다. 각각의 방식은 구조적 장점과 단점이 명확하므로 실무에서 상황에 맞는 선택이 필요하다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":3,"name":"Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/"},{"@type":"ListItem","position":4,"name":"Messaging-Oriented Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/"},{"@type":"ListItem","position":5,"name":"Message-Driven vs. Event-Driven Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/message-driven-vs-event-driven-architecture/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Message-Driven vs. Event-Driven Architecture","name":"Message-Driven vs. Event-Driven Architecture","description":"메시지 기반 아키텍처 (Message-Driven Architecture, MDA) 와 이벤트 기반 아키텍처 (Event-Driven Architecture, EDA) 는 시스템 간의 통신 및 동작 연결 방식에서 핵심적인 패러다임이다. 메시지 - 기반은 직접적 명령과 데이터 전달에 집중하며, 이벤트 - 기반은 상태 변화와 그에 대한 반응에 중점을 둔다. 각각의 방식은 구조적 장점과 단점이 명확하므로 실무에서 상황에 맞는 선택이 필요하다.","keywords":["Software-Engineering","Design-and-Architecture","Architecture-Styles-and-Patterns","Architecture-Styles","Messaging-Oriented-Styles","Message-Driven-Architecture","Event-Driven-Architecture","Asynchronous-Communication"],"articleBody":"Message-Driven vs. Event-Driven Architecture 메시지 기반 (Message‑Driven) 과 이벤트 기반 (Event‑Driven) 은 비동기 통신을 통한 분산 시스템 설계 방식이다.\n메시지 기반 (Message‑Driven) 는 명령 (Command) 또는 Request-Response 워크플로우 중심이며 수신자 주소를 알고 직접 메시지를 주고 받는다. 반면 이벤트 기반 (Event‑Driven) 는 상태 변화 (State Change) 를 이벤트로 정의하고 Publish-Subscribe (pub/sub) 나 Event Bus 로 브로드캐스트 (Broadcast) 하며, 소비자 목록을 알 필요 없이 느슨하게 결합된 구조로 동작한다.\n두 방식은 구현 목적, 응답 실시간성, 확장성, 복잡성 등에서 차이를 보이며, 실무에서는 상호 보완적으로 병용되기도 한다.\n핵심 개념 요약 정의 구분 Message-Driven Architecture (MDA) Event-Driven Architecture (EDA) 정의 명시적 수신자에게 명령 또는 요청을 메시지로 전달하는 아키텍처 스타일 상태 변화 등 **사실 (fact)**을 알리는 이벤트를 브로드캐스트하는 아키텍처 스타일 주요 흐름 Point-to-Point 메시지 기반 요청/응답 흐름 Publish-Subscribe 기반 비동기 반응 흐름 주된 목적 작업 실행 지시 (Command) 상태 변화 알림 (Event Notification) 핵심 차이 분석 항목 Message-Driven Event-Driven 의도 (Intent) 수신자에게 특정 작업을 수행하라는 명시적 명령 상태 변화가 발생했음을 알리는 사실 기반 알림 메시지 타입 Command, Request, Response Event (fact-based) 수신자 인식 여부 알고 있음 (Direct)–명시적으로 대상 지정 모름 (Decoupled)–브로드캐스트, 수신자는 선택적 구독 보통의 처리 흐름 1:1 메시지 라우팅 → 작업 수행 후 응답 1:N 이벤트 발행 → 여러 소비자가 병렬 반응 결합도 느슨하지만 명시적 수신자 존재로 일부 결합 느슨한 결합 (완전한 Decoupling 가능) 순서 보장 큐 기반 FIFO 순서 보장 가능 기본적으로 순서 미보장 (설정으로 보장 가능) 트리거 요청에 의해 명령 실행 상태 변화 발생 시 이벤트 발행 실행 제어 흐름 생산자가 통제 소비자가 반응 기술 예시 RabbitMQ (Command Queue), JMS Kafka (Event Log), AWS SNS 구조 비교 다이어그램 flowchart TD subgraph MDA[Message-Driven Architecture] A1[\"Service A (Producer)\"] --\u003e|Command: createOrder| Q1[Queue] Q1 --\u003e B1[\"Service B (Consumer)\"] end subgraph EDA[Event-Driven Architecture] A2[\"Service A (Producer)\"] --\u003e|Event: OrderCreated| T1[Topic] T1 --\u003e B2[\"Service B (Consumer)\"] T1 --\u003e C2[\"Service C (Consumer)\"] end MDA: 수신자가 명시되어 있고, 메시지가 큐로 전달됨 → Point-to-Point EDA: 이벤트는 브로드캐스트되며, 구독자가 선택적으로 반응 → Publish-Subscribe 실무 혼동 방지 포인트 구분 설명 Event ≠ Command Event 는 발생한 일, Command 는 수행하라는 지시. 동일한 메시지 구조를 갖더라도 의미는 완전히 다름. EDA ≠ 비동기 메시징 비동기라고 모두 EDA 가 되는 것은 아님. 핵심은 상태 변화 기반의 반응형 설계인지 여부임. MDA 도 pub/sub 로 구현 가능 예: Command 를 Kafka Topic 에 게시 → Consumer 가 명령 처리. 구조는 pub/sub 지만 의도는 MDA임. 복합 사용 가능 MDA 와 EDA 는 상호 배타적이지 않음. 보통 Command → 처리 → Event 발행 패턴으로 같이 사용됨. Message-Driven vs. Event-Driven Architecture 비교 항목 Message-Driven Architecture (MDA) Event-Driven Architecture (EDA) 핵심 철학 명령 (Command)/요청 (Request) 기반 처리. 명시적 수신자에게 작업을 지시함. 사실 (Fact)/상태 변화 (State Change) 중심. 이벤트가 발생하면 여러 수신자가 반응함. 통신 모델 Point-to-Point (1:1), 큐 기반 명령 전달 Publish-Subscribe (1:N), 이벤트 브로드캐스트 결합도 상대적으로 낮음 (비동기), 그러나 수신자 인식이 필요해 일부 의존성 존재 매우 낮음. 이벤트 생산자는 소비자를 전혀 알 필요 없음 메시지 성격 명령, 요청, 응답 (Command/Request/Response) 상태 변화 또는 발생된 사실 (Event/Notification) 처리 흐름 정의된 워크플로우에 따라 순차적 또는 동기·비동기 처리 가능 비동기, 병렬 트리거 처리. 순차성 보장은 어려움. 트리거 방식 명시적 메시지 호출이 트리거 상태 변화가 트리거되면 이벤트 발생 확장성 큐 및 컨슈머 확장으로 처리량 증가 가능, 구조적 확장에는 제약이 있음 구독자 추가만으로 확장 가능. 고유 이벤트 흐름 유지하며 동적 확장에 유리 복원력 및 재처리 메시지 ID, 상태 기반으로 재처리 용이 (DLQ 지원, 재시도 등) 이벤트 중복 및 순서 처리 로직 별도 필요. 보통 Idempotency 또는 Event Replay 사용 장애 추적 메시지 ID 기반 추적 용이. 큐 단위 관찰 가능 이벤트 흐름이 분산되기 때문에 End-to-End Trace 도구 필수 (예: OpenTelemetry, Jaeger) 데이터 일관성 모델 강한 일관성 (Strong Consistency) 설계 가능 최종 일관성 (Eventual Consistency) 중심. 수신자마다 상태가 비동기적으로 반영됨 대표 기술 스택 RabbitMQ, ActiveMQ, Amazon SQS, Azure Service Bus Apache Kafka, AWS SNS/EventBridge, Azure Event Grid, Google Pub/Sub 실무 적용 예시 주문 처리, 워크플로우 자동화, 이메일 전송, 비동기 백오피스 작업 실시간 데이터 분석, 사용자 활동 이벤트, IoT, 로그 수집, 알림 시스템 등 운영/모니터링 복잡도 비교적 단순. 큐 상태, 메시지 실패율 등으로 모니터링 가능 이벤트 흐름 추적 복잡. 분산 트레이싱 필요. 이벤트 로스 여부 판단 어렵고 누락 방지 전략 필요 설계 난이도 비교적 단순. 송수신 정의 명확. 흐름 제어 용이 복잡. 이벤트 정의, 버전 관리, 처리 순서 보장, idempotency 보장 등 추가 고려 요소 다수 심화 분석–설계/운영 관점에서의 고려 요소 항목 MDA 고려사항 EDA 고려사항 메시지 설계 명령 유형 정의, 메시지 순서 보장, 응답 처리 모델 포함 이벤트 정의, 불변성 설계, 중복 허용 처리 설계 필요 일관성 보장 트랜잭션 메시지 처리, SAGA 패턴 또는 Outbox 패턴 활용 가능 이벤트 기반 일관성. eventual consistency 허용, 보완을 위한 event chaining 필요 장애 대응 DLQ 구성, 메시지 재시도 및 순서 재정렬 메커니즘 필요 이벤트 중복 제거, 순서 보장 옵션 설정, Retry → Duplicate 여부 식별 로직 필요 메시지 추적 큐 단위 추적 가능, 로그 기반 문제 진단 용이 end-to-end 추적 어려움. 분산 트레이싱 도구 활용 필수 (ex. Jaeger + OpenTelemetry) 테스트 전략 Consumer 단위 단위 테스트 및 통합 테스트 비교적 용이 이벤트 흐름 기반 테스트 구성 어려움. Mock Event Stream, Consumer Simulation 등 필요 강점과 약점 구분 Message-Driven Architecture Event-Driven Architecture 강점 • 명확한 통신 구조\n• 높은 신뢰성\n• 트랜잭션 관리 용이\n• 디버깅 및 추적 용이 • 높은 확장성\n• 느슨한 결합\n• 실시간 반응성\n• 시스템 진화 용이 약점 • 송수신자 간 결합도\n• 확장성 제한\n• 복잡한 라우팅\n• 단일 장애점 위험 • 이벤트 순서 관리 복잡\n• 최종 일관성 문제\n• 복잡한 디버깅\n• 이벤트 스키마 관리 구조 및 아키텍처 Message-Driven Architecture 구조 graph LR A[Client] --\u003e B[Message Producer] B --\u003e C[Message Queue] C --\u003e D[Message Consumer] D --\u003e E[Service A] F[Service B] --\u003e G[Message Queue 2] G --\u003e H[Service C] subgraph \"Message Broker\" C G end 필수 구성요소:\nMessage Producer: 메시지 생성 및 전송 Message Queue: 메시지 저장 및 라우팅 Message Consumer: 메시지 수신 및 처리 Message Broker: 메시지 중개 및 관리 선택 구성요소:\nDead Letter Queue: 처리 실패 메시지 관리 Message Router: 조건부 메시지 라우팅 Retry Mechanism: 재시도 로직 Event-Driven Architecture graph TD A[Event Producer] --\u003e B[Event Bus] B --\u003e C[Event Consumer 1] B --\u003e D[Event Consumer 2] B --\u003e E[Event Consumer 3] C --\u003e F[Service A] D --\u003e G[Service B] E --\u003e H[Analytics Service] subgraph \"Event Broker\" B I[Event Store] J[Event Router] end 필수 구성요소:\nEvent Producer: 이벤트 발생 및 발행 Event Bus/Broker: 이벤트 배포 및 라우팅 Event Consumer: 이벤트 수신 및 반응 Event Store: 이벤트 영속화 (선택적) 선택 구성요소:\nEvent Sourcing: 이벤트 기반 상태 재구성 CQRS: 읽기/쓰기 분리 Event Mesh: 분산 이벤트 인프라 주요 원리 및 작동 원리 Message-Driven Architecture (MDA) 주요 원리:\n메시지 단위의 통신 송신자 - 수신자 간 느슨한 결합 메시지 큐 (MQ) 또는 메시지 브로커 기반 재시도, ACK, DLQ(Dead Letter Queue) 등 안정성 보장 작동 원리 다이어그램:\n메시지를 보내면 브로커 (큐) 에 쌓이고, 컨슈머가 해당 메시지를 받아 처리. 명령 - 응답/작업 요청 등 전통적 통신 대신, 비동기 큐가 중재함. sequenceDiagram participant Client participant Producer participant Queue participant Consumer Client-\u003e\u003eProducer: 요청 수행 Producer-\u003e\u003eQueue: 메시지 전송 Consumer-\u003e\u003eQueue: 메시지 Pull 또는 Subscribe Queue-\u003e\u003eConsumer: 메시지 전달 Consumer-\u003e\u003eQueue: 처리 성공 ACK Event-Driven Architecture (EDA) 주요 원리:\n시스템의 상태 변화 = 이벤트 발행/구독 (Pub/Sub) 모델 사용 발행자 (Producer) 는 수신자를 모름 다수의 소비자가 독립적으로 이벤트 처리 작동 원리 다이어그램:\n시스템 내 상태 변화 발생 시 이벤트 생성 후 이벤트 버스에 게시. 이를 구독하는 다수의 컨슈머가 해당 이벤트를 감지해 각각 독립적으로 반응. sequenceDiagram participant Producer participant EventBus participant Consumer1 participant Consumer2 Producer-\u003e\u003eEventBus: 이벤트 발생 EventBus-\u003e\u003eConsumer1: 이벤트 전달 EventBus-\u003e\u003eConsumer2: 이벤트 전달 Consumer1--\u003e\u003eEventBus: (선택적으로 ACK) Consumer2--\u003e\u003eEventBus: (선택적으로 ACK) 단점과 문제점 및 해결방안 문제 유형 원인 및 설명 탐지 및 진단 예방 전략 해결 방안 및 기법 설계 복잡성 증가 이벤트 흐름이 분산되고 시스템 구성요소가 많아짐 설계 불일치, 변경 시 영향도 분석 도메인 중심 이벤트 모델링 EventStorming 아키텍처 문서화, 워크플로 자동화 흐름 추적 어려움 이벤트가 비동기적으로 다양한 소비자로 전파됨 → 요청 추적 어려움 로그 상관관계, 호출 체인 누락 Correlation ID 포함, 메시지 라벨링 OpenTelemetry, 분산 트레이싱 도구 (Jaeger 등) 중복 메시지 재시도, 네트워크 실패, 브로커 재전송 등으로 중복 메시지 소비 발생 중복 데이터 탐지, 로그 기반 비교 메시지 ID/해시 기반 필터링 Idempotent 소비자 설계, 중복 필터, 메시지 해시 적용 메시지 유실 브로커 장애, 네트워크 단절, 일시적 장애 시 메시지가 손실될 수 있음 브로커 로그, 큐 상태, 처리 누락 검출 영속 메시지 설정, 멀티 브로커 구성 DLQ 설정, 재처리 큐 운영, 브로커 HA 구성 이벤트 순서 문제 파티셔닝된 소비자나 병렬 처리로 인해 순서가 변경될 수 있음 이벤트 순서 로그, 재현 시나리오 분석 메시지에 Sequence ID 부여, 순서 고정 큐 사용 Kafka Offset 기반 처리, 순서 보장 전략 적용 데이터 일관성 불일치 Eventual Consistency 모델로 인해 상태가 일시적으로 불일치 가능 상태 불일치 알람, 상태 모니터링 보상 트랜잭션 기반의 설계 (Saga) Event Sourcing, CDC (Change Data Capture) 디버깅 난이도 비동기 처리 로직은 동기 흐름과 달리 재현과 로깅이 복잡 로깅 미비, 트레이스 누락 테스트용 메시지 시뮬레이터 활용, 전체 흐름 로깅 활성화 Logging 강화, DLQ 재현용 시뮬레이터, Trace Replay Tool 테스트 어려움 메시지/이벤트 기반 시스템은 단위 테스트보단 통합 테스트 중심 → 시뮬레이션 요구 테스트 커버리지 부족, 비결정성 시나리오 발생 컨슈머 모킹, 메시지/이벤트 시뮬레이터 구성 통합 테스트 환경 구축 (e.g., TestContainers + Kafka) 장애 탐지 지연 분산된 구성 요소로 인해 장애의 위치나 원인 파악이 어려움 로그 누락, Alert 지연 중앙 집중 로깅 + 모니터링 통합 모니터링 (Prometheus, Grafana, ELK Stack 등) 메시지 적체 컨슈머 처리 속도 \u003c 메시지 유입 속도 시 큐가 적체되어 서비스 지연 발생 큐 크기, 처리율, 대기 시간 모니터링 Auto-scaling, Load Leveling 설계 큐 확장, 컨슈머 수 증가, 백프레셔 제어 적용 도전 과제 카테고리 도전 과제 원인/상황 영향 탐지 및 진단 방식 예방 및 해결 전략 신뢰성/안정성 메시지/이벤트 손실 네트워크 장애, 브로커 중단, Ack 누락 데이터 유실, 흐름 중단 브로커 상태 모니터링, ACK 로그 분석 메시지 영속화 (디스크 저장), 재시도 전략, DLQ 구성 중복 처리 메시지 재전송 시 중복 처리 QoS 1 이상 사용, 재시도 시 중복 허용 구조 데이터 중복 기록, 비즈니스 오류 이상 상태 탐지 로직, 중복 수신 로그 분석 메시지 ID 추적, Idempotency 키 사용, Deduplication 로직 구현 순서 보장 이벤트/메시지 순서 왜곡 멀티 스레드 처리, 병렬 큐, 복수 브로커 활용 상태 불일치, 잘못된 트랜잭션 실행 시퀀스 번호 모니터링, 상태 간 불일치 감지 파티션 키 활용, 순서 큐 구성, 메시지 헤더 시퀀싱, 이벤트 버퍼링 일관성 보장 분산 트랜잭션 처리 어려움 서비스 간 독립 처리, 원자성 부족 데이터 무결성 깨짐, 불일치 상태 발생 상태 불일치 분석, 상태 확인 작업 Saga 패턴, 보상 트랜잭션, Outbox 패턴, Eventually Consistent 설계 적용 관찰 가능성 이벤트 흐름 추적의 어려움 비동기 처리 + 이벤트 확산 → 인과 관계 파악 복잡 장애 진단 지연, 성능 병목 추적 어려움 분산 추적 시스템, 로그/메트릭 연동 분석 Correlation ID 삽입, OpenTelemetry, Jaeger, Zipkin 등 활용 스키마 진화 이벤트 구조 변경에 따른 호환성 이슈 메시지/이벤트 필드 추가/삭제, 버전 불일치 소비자 에러, 통신 오류 스키마 유효성 검사, 호환성 테스트 Schema Registry 도입, 버전 관리 전략, Avro/Protobuf 기반 호환 설계 보안/컴플라이언스 메시지/이벤트 보호 및 인증 문제 분산 경계, 브로커 - 컨슈머 간 전송 보안, 인증 미비 민감 데이터 노출, 규정 위반 감사 로그, 보안 이벤트 추적 메시지 암호화, OAuth2 인증, ACL 설정, Zero Trust 설계 적용 팀 간 협업/거버넌스 서비스 간 스키마 및 이벤트 관리 문제 서비스 단위로 분산 개발, 계약 부재, 의사소통 단절 중복 개발, 비호환 이벤트 설계 API/이벤트 문서 리뷰, 아키텍처 검토 API First, 표준화된 메시지 컨벤션, ADR 관리, 이벤트 명세 중심의 협업 프로세스 모니터링/운영 장애 대응 및 지표 부족 분산 컴포넌트 모니터링 누락, 지표 비통합 장애 징후 탐지 지연, 복구 시간 증가 지연/에러율 모니터링, DLQ 확인 메트릭 수집 (Prometheus), Alerting Rule 정의, 중앙 집중 로그 수집 (ELK/EFK 등) 테스트/검증 이벤트 흐름 테스트의 어려움 컨슈머/프로듀서 간 계약 불명확, 테스트 환경 미흡 이벤트 누락/불일치로 인한 기능 실패 컨트랙트 기반 테스트 도입, 이벤트 시뮬레이션 Consumer-Driven Contract Testing, 테스트 더블 (Double) 및 샌드박스 환경 구축 실무 사용 예시 산업 분야 시스템 유형 활용 아키텍처 유형 주요 목적 기대 효과 주요 기술 구성 전자상거래 주문 처리 시스템 MDA → EDA 혼합형 주문 → 결제 → 배송의 워크플로우 분리 및 상태 변화 후 다중 시스템 동기화 확장성, 처리 신뢰성, 실시간 반응 RabbitMQ, Kafka, Redis 금융 거래 처리 및 분석 시스템 MDA (트랜잭션 처리), EDA (사후 분석) 거래 승인 → 계좌 업데이트 후 이벤트 기반 분석/리스크 처리 신뢰성, 실시간 탐지, 규제 대응 JMS, EventStore, Lambda 물류 배송 추적/관리 시스템 EDA 중심 배송 상태 변화에 따른 이벤트를 실시간 처리 및 분석 연계 가시성 확보, 사용자 경험 향상 Kafka, AWS SNS, Webhook IoT/제조 센서 기반 데이터 처리 EDA 중심 대규모 센서 이벤트 스트리밍 처리 및 예측 정비 운영 효율성, 지능형 유지보수 실현 Kafka, MQTT, Flink 게임 멀티플레이어 실시간 게임 EDA 중심 플레이어 이벤트 발생 → 분석, 개인화, 랭킹, 추천 시스템 연동 실시간 반응, 사용자 경험 최적화 Kafka, Redis Streams, WebSocket 마케팅/알림 푸시 알림, 이벤트 기반 마케팅 EDA + Pub/Sub 알림, 캠페인, 마케팅 자동화 트리거 처리 실시간성, 개인화, 운영 자동화 AWS SNS/SQS, Firebase, Webhook 스마트 시티 환경/교통 데이터 수집 EDA + CEP 실시간 센서/트래픽 이벤트 분석 및 정책 트리거 정책 대응 속도 향상, 비상 상황 탐지 Kafka, Apache Flink, Complex Event Processing 엔터프라이즈 마이크로서비스 간 통신 MDA + EDA 혼합형 비즈니스 프로세스 → 메시지 처리 / 상태 변화 → 이벤트 반응 유연한 통합, 독립 배포, 확장성 확보 Kafka + RabbitMQ, Outbox Pattern 활용 사례 사례 1: 온라인 쇼핑몰의 주문 처리 시스템 아키텍처 적용 방식:\n주문 등록 → 결제 승인 → 재고 차감 → 배송 예약 과정을 각각 분리된 서비스로 구성 각 단계는 메시지 기반 (MDA) 으로 연결, 이벤트 발생 시 각 서비스는 이벤트를 수신하여 동작 시스템 구성\ngraph TD A[Order Service] --\u003e|Message| B[Payment Service] B --\u003e|Message| C[Inventory Service] C --\u003e|Message| D[Delivery Service] D --\u003e|Event| E[Notification Service] Workflow 설명:\n사용자가 주문을 생성하면 메시지가 결제 서비스로 전달됨. 결제 완료 후 재고 차감 요청 메시지 전송. 재고 확인 후 배송 예약 요청. 최종 배송 등록 이벤트 발생 → 이벤트 기반 (Notification) 으로 사용자 알림. Message-Driven 없을 경우 문제점:\n상태 전이 실패 시 복구 어려움. 재시도/보장된 순서 처리 불가능. Event-Driven 없이 Notification 처리 시 문제점:\nNotification Service 가 상태를 직접 폴링하거나 상태 공유 구조 필요 → 복잡성 증가. 구현 예시:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # 주문 생성 → 메시지 브로커 → 결제 서비스 import pika import json # 메시지 브로커 연결 connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() # 큐 생성 channel.queue_declare(queue='payment_queue', durable=True) # 메시지 전송 함수 def send_order_to_payment(order_id, amount): message = json.dumps({ \"order_id\": order_id, \"amount\": amount }) channel.basic_publish( exchange='', routing_key='payment_queue', body=message, properties=pika.BasicProperties(delivery_mode=2) ) print(f\"Sent order {order_id} for payment.\") send_order_to_payment(\"ORD-1001\", 19900) connection.close() 위 코드는 주문 생성 후 결제 서비스로 메시지를 큐에 넣는 구조. 결제 서비스는 이를 소비하여 처리하게 된다. 확장성과 안정성 확보에 유리하다.\n사례 2: 대형 이커머스의 주문 처리 시스템 시스템 구성: 주문 서비스 → 메시지 브로커 (RabbitMQ) → 재고 서비스, 결제 서비스\n아키텍처 다이어그램:\nsequenceDiagram participant User participant OrderService participant MQ as RabbitMQ participant InventoryService participant PaymentService User-\u003e\u003eOrderService: 주문 요청 OrderService-\u003e\u003eMQ: 주문 메시지 발행 MQ-\u003e\u003eInventoryService: 주문 메시지 전달 MQ-\u003e\u003ePaymentService: 주문 메시지 전달 InventoryService--\u003e\u003eOrderService: 재고 처리 결과(비동기) PaymentService--\u003e\u003eOrderService: 결제 결과(비동기) Workflow: 주문 발생 → 메시지 발행 → 재고/결제 서비스 각각 독립적으로 처리 및 알림\n역할: 동시성 보장, 이벤트/비동기 기반 병렬처리, 확장성 확보\n유무 차이점: 메시지 기반/이벤트 기반 아키텍처가 없을 경우 주문 폭주 상황에서 서비스 지연, 장애 확산이 잦음.\n구현 예시:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 주문 발생 시 메시지 발행과 큐 소비자 예시 import pika # 프로듀서: 주문 발생시 메시지 발행 def send_order_message(order_id, data): connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() channel.queue_declare(queue='order_queue') channel.basic_publish(exchange='', routing_key='order_queue', body=f\"{order_id}:{data}\") connection.close() # 컨슈머: 주문 메시지 처리(재고 서비스) def inventory_consumer(): connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() channel.queue_declare(queue='order_queue') def callback(ch, method, properties, body): order_id, data = body.decode().split(\":\") print(f\"재고 처리: 주문번호 {order_id}, 데이터 {data}\") # 재고 차감 처리 코드 위치 channel.basic_consume(queue='order_queue', on_message_callback=callback, auto_ack=True) print('재고 서비스 대기 중…') channel.start_consuming() 각 함수에 주석으로 메시지 발행/수신의 위치와 역할, 비동기 큐 소비를 명확하게 구분\n사례 3: 전자상거래 주문 처리 시스템 시스템 구성:\n전자상거래 플랫폼에서 Message-Driven 과 Event-Driven 아키텍처를 함께 활용한 하이브리드 접근법을 적용했다. graph TB subgraph \"프론트엔드\" A[웹/모바일 앱] end subgraph \"API Gateway\" B[API Gateway] end subgraph \"Message-Driven 영역\" C[주문 서비스] D[결제 서비스] E[재고 서비스] F[배송 서비스] Q1[주문 처리 큐] Q2[결제 큐] Q3[배송 큐] end subgraph \"Event-Driven 영역\" G[이벤트 버스] H[알림 서비스] I[분석 서비스] J[추천 서비스] K[재고 추적 서비스] L[고객 서비스] end subgraph \"데이터 저장소\" M[(주문 DB)] N[(결제 DB)] O[(재고 DB)] P[(이벤트 스토어)] end A --\u003e B B --\u003e C C --\u003e Q1 Q1 --\u003e D D --\u003e Q2 Q2 --\u003e E E --\u003e Q3 Q3 --\u003e F C --\u003e G D --\u003e G E --\u003e G F --\u003e G G --\u003e H G --\u003e I G --\u003e J G --\u003e K G --\u003e L C --\u003e M D --\u003e N E --\u003e O G --\u003e P Workflow:\nMessage-Driven 처리 흐름: 주문 생성: 고객이 주문을 생성하면 주문 서비스가 주문 정보를 검증 재고 확인: 주문 서비스가 재고 서비스에 메시지를 보내 재고 확인 요청 결제 처리: 재고 확인 완료 후 결제 서비스에 결제 처리 메시지 전송 배송 요청: 결제 완료 후 배송 서비스에 배송 요청 메시지 전송 Event-Driven 처리 흐름: 이벤트 발행: 각 단계 완료 시 이벤트 발행 (주문 생성됨, 결제 완료됨 등) 병렬 처리: 여러 서비스가 동일 이벤트를 동시 구독하여 처리 실시간 반응: 알림, 분석, 추천 등이 실시간으로 동작 역할:\nMessage-Driven Architecture 역할: 핵심 비즈니스 로직의 순차적 처리 보장 트랜잭션 일관성 유지 중요한 업무 프로세스의 신뢰성 확보 Event-Driven Architecture 역할: 부가 서비스들의 확장성 제공 시스템 간 느슨한 결합 달성 실시간 반응성 확보 아키텍처 유무에 따른 차이점:\n적용 전 (단순 REST API): 모든 서비스가 동기적으로 호출되어 응답 시간 증가 부가 서비스 장애가 핵심 주문 프로세스에 영향 새로운 기능 추가 시 기존 코드 수정 필요 적용 후 (하이브리드 아키텍처): 핵심 프로세스와 부가 서비스의 독립적 처리 부가 서비스 장애가 주문 프로세스에 미치는 영향 최소화 새로운 서비스 추가 시 이벤트 구독만으로 연동 가능 평균 주문 처리 시간 40% 단축, 시스템 가용성 99.9% 달성 구현 예시:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 \"\"\" 전자상거래 주문 처리 시스템 Message-Driven과 Event-Driven Architecture 하이브리드 구현 \"\"\" import asyncio import json import uuid from datetime import datetime from typing import Dict, List, Any, Callable from enum import Enum from dataclasses import dataclass, asdict import logging # ============================================================================ # 1. 기본 데이터 모델 # ============================================================================ class OrderStatus(Enum): \"\"\"주문 상태 열거형\"\"\" PENDING = \"pending\" PAYMENT_PROCESSING = \"payment_processing\" PAID = \"paid\" SHIPPED = \"shipped\" DELIVERED = \"delivered\" CANCELLED = \"cancelled\" @dataclass class Order: \"\"\"주문 데이터 클래스\"\"\" id: str customer_id: str items: List[Dict[str, Any]] total_amount: float status: OrderStatus created_at: datetime @dataclass class Message: \"\"\"메시지 데이터 클래스 (Message-Driven Architecture용)\"\"\" id: str type: str payload: Dict[str, Any] sender: str receiver: str created_at: datetime correlation_id: str = None @dataclass class Event: \"\"\"이벤트 데이터 클래스 (Event-Driven Architecture용)\"\"\" id: str type: str payload: Dict[str, Any] source: str created_at: datetime version: str = \"1.0\" # ============================================================================ # 2. Message-Driven Architecture 구현 # ============================================================================ class MessageQueue: \"\"\" 메시지 큐 구현 - 순차적 메시지 처리를 위한 FIFO 큐 - 메시지 지속성 및 재시도 메커니즘 제공 \"\"\" def __init__(self, name: str): self.name = name self.queue: List[Message] = [] self.handlers: Dict[str, Callable] = {} self.dead_letter_queue: List[Message] = [] async def send_message(self, message: Message): \"\"\"메시지를 큐에 전송\"\"\" self.queue.append(message) logging.info(f\"Message sent to {self.name}: {message.type}\") async def subscribe(self, message_type: str, handler: Callable): \"\"\"특정 메시지 타입에 대한 핸들러 등록\"\"\" self.handlers[message_type] = handler async def process_messages(self): \"\"\"큐의 메시지들을 순차적으로 처리\"\"\" while self.queue: message = self.queue.pop(0) try: if message.type in self.handlers: await self.handlers[message.type](message) logging.info(f\"Message processed: {message.id}\") else: logging.warning(f\"No handler for message type: {message.type}\") except Exception as e: # 실패한 메시지를 Dead Letter Queue로 이동 self.dead_letter_queue.append(message) logging.error(f\"Message processing failed: {e}\") class MessageBroker: \"\"\" 메시지 브로커 - 여러 큐를 관리하고 메시지 라우팅 담당 \"\"\" def __init__(self): self.queues: Dict[str, MessageQueue] = {} def create_queue(self, name: str) -\u003e MessageQueue: \"\"\"새로운 메시지 큐 생성\"\"\" self.queues[name] = MessageQueue(name) return self.queues[name] async def route_message(self, queue_name: str, message: Message): \"\"\"메시지를 지정된 큐로 라우팅\"\"\" if queue_name in self.queues: await self.queues[queue_name].send_message(message) else: logging.error(f\"Queue not found: {queue_name}\") # ============================================================================ # 3. Event-Driven Architecture 구현 # ============================================================================ class EventBus: \"\"\" 이벤트 버스 구현 - Publish-Subscribe 패턴으로 이벤트 배포 - 다수의 구독자에게 동시 이벤트 전달 \"\"\" def __init__(self): self.subscribers: Dict[str, List[Callable]] = {} self.event_store: List[Event] = [] async def publish(self, event: Event): \"\"\"이벤트 발행 - 모든 구독자에게 브로드캐스트\"\"\" # 이벤트 저장 (Event Sourcing) self.event_store.append(event) # 구독자들에게 이벤트 전달 if event.type in self.subscribers: tasks = [] for subscriber in self.subscribers[event.type]: tasks.append(subscriber(event)) await asyncio.gather(*tasks, return_exceptions=True) logging.info(f\"Event published: {event.type} to {len(self.subscribers.get(event.type, []))} subscribers\") async def subscribe(self, event_type: str, handler: Callable): \"\"\"이벤트 타입에 대한 핸들러 구독\"\"\" if event_type not in self.subscribers: self.subscribers[event_type] = [] self.subscribers[event_type].append(handler) # ============================================================================ # 4. 핵심 비즈니스 서비스 (Message-Driven) # ============================================================================ class OrderService: \"\"\" 주문 서비스 - 핵심 주문 처리 로직 Message-Driven 방식으로 순차적 처리 보장 \"\"\" def __init__(self, message_broker: MessageBroker, event_bus: EventBus): self.message_broker = message_broker self.event_bus = event_bus self.orders: Dict[str, Order] = {} async def create_order(self, customer_id: str, items: List[Dict], total_amount: float) -\u003e str: \"\"\"주문 생성\"\"\" order_id = str(uuid.uuid4()) order = Order( id=order_id, customer_id=customer_id, items=items, total_amount=total_amount, status=OrderStatus.PENDING, created_at=datetime.now() ) self.orders[order_id] = order # Message-Driven: 재고 확인 메시지 전송 inventory_message = Message( id=str(uuid.uuid4()), type=\"check_inventory\", payload={\"order_id\": order_id, \"items\": items}, sender=\"order_service\", receiver=\"inventory_service\", created_at=datetime.now(), correlation_id=order_id ) await self.message_broker.route_message(\"inventory_queue\", inventory_message) # Event-Driven: 주문 생성 이벤트 발행 await self.event_bus.publish(Event( id=str(uuid.uuid4()), type=\"order_created\", payload=asdict(order), source=\"order_service\", created_at=datetime.now() )) return order_id async def handle_inventory_confirmed(self, message: Message): \"\"\"재고 확인 완료 메시지 처리\"\"\" order_id = message.payload[\"order_id\"] if order_id in self.orders: # Payment 서비스로 메시지 전송 payment_message = Message( id=str(uuid.uuid4()), type=\"process_payment\", payload={ \"order_id\": order_id, \"amount\": self.orders[order_id].total_amount }, sender=\"order_service\", receiver=\"payment_service\", created_at=datetime.now(), correlation_id=order_id ) await self.message_broker.route_message(\"payment_queue\", payment_message) class PaymentService: \"\"\" 결제 서비스 - 결제 처리 담당 \"\"\" def __init__(self, message_broker: MessageBroker, event_bus: EventBus): self.message_broker = message_broker self.event_bus = event_bus async def handle_payment_request(self, message: Message): \"\"\"결제 처리 메시지 핸들러\"\"\" order_id = message.payload[\"order_id\"] amount = message.payload[\"amount\"] # 결제 처리 로직 (시뮬레이션) await asyncio.sleep(1) # 결제 처리 시간 시뮬레이션 # 배송 서비스로 메시지 전송 shipping_message = Message( id=str(uuid.uuid4()), type=\"prepare_shipping\", payload={\"order_id\": order_id}, sender=\"payment_service\", receiver=\"shipping_service\", created_at=datetime.now(), correlation_id=order_id ) await self.message_broker.route_message(\"shipping_queue\", shipping_message) # 결제 완료 이벤트 발행 await self.event_bus.publish(Event( id=str(uuid.uuid4()), type=\"payment_completed\", payload={\"order_id\": order_id, \"amount\": amount}, source=\"payment_service\", created_at=datetime.now() )) # ============================================================================ # 5. 부가 서비스들 (Event-Driven) # ============================================================================ class NotificationService: \"\"\" 알림 서비스 - 고객에게 실시간 알림 전송 Event-Driven 방식으로 다양한 이벤트에 반응 \"\"\" def __init__(self): self.sent_notifications: List[Dict] = [] async def handle_order_created(self, event: Event): \"\"\"주문 생성 이벤트 처리\"\"\" order_data = event.payload notification = { \"type\": \"order_confirmation\", \"customer_id\": order_data[\"customer_id\"], \"message\": f\"주문 {order_data['id']}가 접수되었습니다.\", \"timestamp\": datetime.now() } self.sent_notifications.append(notification) logging.info(f\"Notification sent: {notification['message']}\") async def handle_payment_completed(self, event: Event): \"\"\"결제 완료 이벤트 처리\"\"\" order_id = event.payload[\"order_id\"] notification = { \"type\": \"payment_confirmation\", \"order_id\": order_id, \"message\": f\"주문 {order_id}의 결제가 완료되었습니다.\", \"timestamp\": datetime.now() } self.sent_notifications.append(notification) logging.info(f\"Notification sent: {notification['message']}\") class AnalyticsService: \"\"\" 분석 서비스 - 주문 및 결제 데이터 분석 실시간으로 비즈니스 메트릭 수집 \"\"\" def __init__(self): self.metrics: Dict[str, int] = { \"total_orders\": 0, \"total_revenue\": 0, \"failed_payments\": 0 } async def handle_order_created(self, event: Event): \"\"\"주문 생성 분석\"\"\" self.metrics[\"total_orders\"] += 1 logging.info(f\"Analytics: Total orders = {self.metrics['total_orders']}\") async def handle_payment_completed(self, event: Event): \"\"\"결제 완료 분석\"\"\" amount = event.payload[\"amount\"] self.metrics[\"total_revenue\"] += amount logging.info(f\"Analytics: Total revenue = {self.metrics['total_revenue']}\") # ============================================================================ # 6. 시스템 통합 및 실행 # ============================================================================ class ECommerceSystem: \"\"\" 전자상거래 시스템 메인 클래스 Message-Driven과 Event-Driven 아키텍처를 통합 관리 \"\"\" def __init__(self): # 인프라 컴포넌트 초기화 self.message_broker = MessageBroker() self.event_bus = EventBus() # 큐 생성 self.inventory_queue = self.message_broker.create_queue(\"inventory_queue\") self.payment_queue = self.message_broker.create_queue(\"payment_queue\") self.shipping_queue = self.message_broker.create_queue(\"shipping_queue\") # 서비스 초기화 self.order_service = OrderService(self.message_broker, self.event_bus) self.payment_service = PaymentService(self.message_broker, self.event_bus) self.notification_service = NotificationService() self.analytics_service = AnalyticsService() async def setup(self): \"\"\"시스템 설정 및 핸들러 등록\"\"\" # Message-Driven 핸들러 등록 await self.inventory_queue.subscribe(\"check_inventory\", self._handle_inventory_check) await self.payment_queue.subscribe(\"process_payment\", self.payment_service.handle_payment_request) await self.shipping_queue.subscribe(\"prepare_shipping\", self._handle_shipping_preparation) # Event-Driven 구독자 등록 await self.event_bus.subscribe(\"order_created\", self.notification_service.handle_order_created) await self.event_bus.subscribe(\"order_created\", self.analytics_service.handle_order_created) await self.event_bus.subscribe(\"payment_completed\", self.notification_service.handle_payment_completed) await self.event_bus.subscribe(\"payment_completed\", self.analytics_service.handle_payment_completed) async def _handle_inventory_check(self, message: Message): \"\"\"재고 확인 처리 (시뮬레이션)\"\"\" order_id = message.payload[\"order_id\"] items = message.payload[\"items\"] # 재고 확인 로직 (시뮬레이션) await asyncio.sleep(0.5) # 재고 확인 완료 메시지를 주문 서비스로 전송 confirmation_message = Message( id=str(uuid.uuid4()), type=\"inventory_confirmed\", payload={\"order_id\": order_id, \"status\": \"confirmed\"}, sender=\"inventory_service\", receiver=\"order_service\", created_at=datetime.now(), correlation_id=order_id ) # 주문 서비스의 핸들러 직접 호출 (실제로는 큐를 통해 처리) await self.order_service.handle_inventory_confirmed(confirmation_message) async def _handle_shipping_preparation(self, message: Message): \"\"\"배송 준비 처리 (시뮬레이션)\"\"\" order_id = message.payload[\"order_id\"] # 배송 준비 로직 await asyncio.sleep(0.3) # 배송 준비 완료 이벤트 발행 await self.event_bus.publish(Event( id=str(uuid.uuid4()), type=\"shipping_prepared\", payload={\"order_id\": order_id}, source=\"shipping_service\", created_at=datetime.now() )) async def process_all_queues(self): \"\"\"모든 큐의 메시지 처리\"\"\" tasks = [] for queue in self.message_broker.queues.values(): tasks.append(queue.process_messages()) await asyncio.gather(*tasks) async def create_order(self, customer_id: str, items: List[Dict], total_amount: float): \"\"\"주문 생성 및 처리\"\"\" order_id = await self.order_service.create_order(customer_id, items, total_amount) await self.process_all_queues() return order_id def get_metrics(self): \"\"\"시스템 메트릭 조회\"\"\" return { \"analytics\": self.analytics_service.metrics, \"notifications_sent\": len(self.notification_service.sent_notifications), \"events_stored\": len(self.event_bus.event_store) } # ============================================================================ # 7. 사용 예시 및 테스트 # ============================================================================ async def main(): \"\"\"시스템 실행 및 테스트\"\"\" logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s') # 시스템 초기화 ecommerce = ECommerceSystem() await ecommerce.setup() print(\"=== 전자상거래 시스템 시작 ===\") # 테스트 주문 생성 test_items = [ {\"product_id\": \"P001\", \"name\": \"노트북\", \"quantity\": 1, \"price\": 1500000}, {\"product_id\": \"P002\", \"name\": \"마우스\", \"quantity\": 2, \"price\": 50000} ] # 첫 번째 주문 print(\"\\n--- 첫 번째 주문 처리 ---\") order1 = await ecommerce.create_order(\"CUST001\", test_items, 1600000) print(f\"주문 생성됨: {order1}\") # 두 번째 주문 print(\"\\n--- 두 번째 주문 처리 ---\") order2 = await ecommerce.create_order(\"CUST002\", test_items[:1], 1500000) print(f\"주문 생성됨: {order2}\") # 시스템 메트릭 출력 print(\"\\n--- 시스템 메트릭 ---\") metrics = ecommerce.get_metrics() print(f\"분석 데이터: {metrics['analytics']}\") print(f\"전송된 알림 수: {metrics['notifications_sent']}\") print(f\"저장된 이벤트 수: {metrics['events_stored']}\") # 이벤트 스토어 내용 출력 print(\"\\n--- 이벤트 히스토리 ---\") for event in ecommerce.event_bus.event_store: print(f\"{event.created_at}: {event.type} from {event.source}\") if __name__ == \"__main__\": asyncio.run(main()) MDA (Message-Driven Architecture) \u0026 EDA (Event-Driven Architecture) 혼합 아키텍처 MDA+EDA 혼합 아키텍처 도입 전략 상황 이유 명령형 워크플로우 필요 주문 → 결제 → 재고 차감 → 배송 등 명확한 순서가 존재 상태 변화 기반 이벤트 발생 필요 ’ 결제 완료됨 ‘, ’ 배송 시작됨 ’ 등의 이벤트 발생 필요 시스템 간 통합이 복잡함 일부 서비스는 명령 기반, 일부는 상태 반응 기반으로 구성됨 확장성과 디커플링 모두 필요 서비스 간 동기화 및 반응형 처리의 동시 구현 필요 전략적 구성 원칙 전략 설명 Command = Message (MDA) 명령적 흐름은 메시지 큐 기반 (e.g. 결제 요청, 배송 예약 등) State Change = Event (EDA) 상태 변화는 이벤트로 브로드캐스트 (e.g. 배송 완료 이벤트) 도메인 경계 기반 메시지/이벤트 분리 메시지는 요청 (Command), 이벤트는 상태 (State) 변화 중심으로 설계 비즈니스 로직은 메시지 기반, 리액션은 이벤트 기반 주 흐름은 메시지 처리로, 후속 작업 (알림, 분석 등) 은 이벤트 처리로 분리 메시지 우선, 이벤트 보완 구조 적용 강한 신뢰성과 제어가 필요한 영역은 메시지, 반응형은 이벤트 도입 시 아키텍처 구성 flowchart TD A[Order Service] --\u003e|Command| B[\"Message Broker (RabbitMQ)\"] B --\u003e C[Payment Service] C --\u003e|Event: PaymentCompleted| D[\"Event Bus (Kafka)\"] D --\u003e E[Shipping Service] D --\u003e F[Notification Service] D --\u003e G[Analytics Service] Message Broker: Command 중심 워크플로우 조율 Event Bus: 상태 변화 이벤트 전파 결제 완료 이벤트가 여러 서비스로 전파됨 (Shipping, Notification, Analytics) 적용 시 고려사항 고려항목 설명 권장 기술/패턴 메시지/이벤트 명확한 구분 Command 는 의도 (Intent), Event 는 결과 (Result) CQRS 패턴 메시지 처리 보장 중복 처리 방지, 실패 보상 등 Idempotent Consumer, DLQ 이벤트 흐름 추적 이벤트 경로 추적 가능해야 함 OpenTelemetry, Jaeger 트랜잭션 분산 처리 원자성 보장 안 되는 경우 처리 방식 명확화 Saga Pattern 데이터 일관성 확보 Command-Event 순서가 비동기인 경우 주의 Outbox Pattern 이벤트 처리 순서 순서 중요 시 파티션 키 기반 처리 필요 Kafka 파티션 사용 테스트 전략 수립 메시지 시뮬레이션, 이벤트 발행 모킹 Contract Test, Simulation Broker 혼합 아키텍처의 실무 적용 예시 시스템 MDA 역할 EDA 역할 도입 효과 주문 시스템 주문 등록, 결제 요청 결제 완료 → 배송 시작, 알림, 분석 명확한 흐름 + 반응형 서비스 분리 IoT 시스템 디바이스 제어 명령 센서 데이터 수신 이벤트 명령형 + 대규모 이벤트 수집 금융 시스템 대출 심사 요청 심사 완료 이벤트 → 상태 변경 및 통보 신뢰성 + 실시간 대응 교육 플랫폼 시험 시작 명령 시험 완료 → 결과 발표, 이메일 발송 명확한 트리거 + 다양한 이벤트 소비자 기술 조합 예시 목적 메시지 시스템 (MDA) 이벤트 시스템 (EDA) 명령/요청 워크플로우 RabbitMQ, AWS SQS, ActiveMQ - 상태 변화 이벤트 전파 - Apache Kafka, AWS EventBridge 복잡한 트랜잭션 처리 Saga Orchestrator with Message Bus Choreography 기반 Event Flow 유저 인터페이스 반응성 - WebSocket, SSE, Kafka Stream 이벤트 저장 - Event Sourcing, Change Data Capture 실제 메시지 / 이벤트 구조 설계 예시 (JSON Schema) Message-Driven (Command) 메시지 예시 1 2 3 4 5 6 7 8 9 10 11 12 13 { \"$schema\": \"http://json-schema.org/draft-07/schema#\", \"title\": \"CreateInvoiceCommand\", \"type\": \"object\", \"properties\": { \"command_id\": { \"type\": \"string\", \"format\": \"uuid\" }, \"order_id\": { \"type\": \"string\" }, \"customer_id\": { \"type\": \"string\" }, \"amount\": { \"type\": \"number\" }, \"issued_at\": { \"type\": \"string\", \"format\": \"date-time\" } }, \"required\": [\"command_id\", \"order_id\", \"customer_id\", \"amount\", \"issued_at\"] } 의도: 송신자가 수신자에게 CreateInvoice 작업을 명령 전송 대상: 특정 컨슈머 (InvoiceService) Event-Driven (Event) 메시지 예시 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 { \"$schema\": \"http://json-schema.org/draft-07/schema#\", \"title\": \"OrderCreatedEvent\", \"type\": \"object\", \"properties\": { \"event_id\": { \"type\": \"string\", \"format\": \"uuid\" }, \"event_type\": { \"type\": \"string\", \"enum\": [\"OrderCreated\"] }, \"occurred_at\": { \"type\": \"string\", \"format\": \"date-time\" }, \"payload\": { \"type\": \"object\", \"properties\": { \"order_id\": { \"type\": \"string\" }, \"customer_id\": { \"type\": \"string\" }, \"total_price\": { \"type\": \"number\" } }, \"required\": [\"order_id\", \"customer_id\", \"total_price\"] } }, \"required\": [\"event_id\", \"event_type\", \"occurred_at\", \"payload\"] } 의도: 주문이 생성되었다는 사실 전달 소비자: InvoiceService, AnalyticsService, NotificationService 등 다수 MDA / EDA 구조 예시 코드 (Python \u0026 Node.js) MDA - Python (RabbitMQ) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # publisher.py import pika import json import uuid from datetime import datetime connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() channel.queue_declare(queue='invoice_commands') message = { \"command_id\": str(uuid.uuid4()), \"order_id\": \"ORD-1001\", \"customer_id\": \"CUST-789\", \"amount\": 120.5, \"issued_at\": datetime.utcnow().isoformat() } channel.basic_publish( exchange='', routing_key='invoice_commands', body=json.dumps(message) ) print(\"Message sent.\") connection.close() 1 2 3 4 5 6 7 # consumer.py def callback(ch, method, properties, body): data = json.loads(body) print(f\"Processing command: {data['command_id']} → Create invoice for order {data['order_id']}\") channel.basic_consume(queue='invoice_commands', on_message_callback=callback, auto_ack=True) channel.start_consuming() EDA - JavaScript (Kafka with Node.js) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // producer.js const { Kafka } = require('kafkajs'); const kafka = new Kafka({ clientId: 'order-app', brokers: ['localhost:9092'] }); const producer = kafka.producer(); async function publishEvent() { await producer.connect(); const event = { event_id: 'evt-' + Date.now(), event_type: 'OrderCreated', occurred_at: new Date().toISOString(), payload: { order_id: 'ORD-1001', customer_id: 'CUST-789', total_price: 99.99 } }; await producer.send({ topic: 'order.events', messages: [{ key: event.event_id, value: JSON.stringify(event) }] }); console.log('Event published.'); await producer.disconnect(); } publishEvent(); 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // consumer.js const kafka = new Kafka({ clientId: 'invoice-service', brokers: ['localhost:9092'] }); const consumer = kafka.consumer({ groupId: 'invoice-consumer-group' }); async function run() { await consumer.connect(); await consumer.subscribe({ topic: 'order.events', fromBeginning: true }); await consumer.run({ eachMessage: async ({ message }) =\u003e { const event = JSON.parse(message.value.toString()); console.log(`Received event ${event.event_type} for order ${event.payload.order_id}`); } }); } run(); CQRS + Event Sourcing 기반 혼합 아키텍처 흐름도 sequenceDiagram actor User participant API as API Gateway participant CMD as Command Handler participant DB as Write DB participant EventBus as Event Bus participant ReadModel as Read DB (Projection) participant Invoice as Invoice Service User -\u003e\u003e API: HTTP POST /orders API -\u003e\u003e CMD: CreateOrderCommand CMD -\u003e\u003e DB: Persist Order (Event Sourced) CMD --\u003e\u003e EventBus: Publish OrderCreatedEvent EventBus --\u003e\u003e Invoice: OrderCreatedEvent EventBus --\u003e\u003e ReadModel: Project OrderView Note over ReadModel: Eventually consistent 사용자가 주문 생성 요청 (Command) Command Handler가 상태 변경 처리 → 이벤트 저장소에 기록 OrderCreatedEvent 를 Event Bus에 발행 InvoiceService 등은 이벤트를 기반으로 후속 작업 Read Model은 Projection 하여 조회 모델을 구성 (CQRS) Outbox 패턴 기반 MDA ↔ EDA 브리지 구현 Outbox 패턴은 트랜잭션 경계 내에서 메시지 저장 → 이후 메시지를 브로커에 발행하는 전략으로, MDA 의 안정성과 EDA 의 반응성을 연결하는 주요 패턴이다.\n아키텍처 흐름 개요 flowchart TD A[Service A: Command Handler] --\u003e|DB 트랜잭션| B[(Order Table + Outbox Table)] B --\u003e C[\"Outbox Poller (CDC or Cron)\"] C --\u003e D[Event Publisher] D --\u003e E[Kafka/EventBridge] E --\u003e F[\"Consumer Services (Invoice, Analytics, Notification)\"] Write 트랜잭션 서비스는 DB 트랜잭션 안에서 도메인 데이터와 함께 Outbox Table 에 이벤트를 기록한다. Outbox Poller 또는 CDC 별도 프로세스가 outbox 테이블을 주기적으로 스캔하거나 CDC 를 통해 변경 감지. Event 발행기 폴링된 메시지를 Kafka 나 EventBridge 등에 EDA 이벤트로 게시. 다수의 Consumer 가 이벤트 구독 Outbox Table 구조 예시 컬럼명 설명 id UUID aggregate_id 관련 도메인 ID type 이벤트 타입 (ex: OrderCreated) payload JSON 포맷의 이벤트 데이터 status PENDING, SENT, FAILED 등 created_at 생성 시각 Python 예시 (SQLAlchemy + Kafka) 1 2 3 4 5 6 7 8 9 10 11 12 # 1. Command 처리 시 Outbox 삽입 def create_order(order_data): order = Order(**order_data) db.session.add(order) event = OutboxEvent( type=\"OrderCreated\", payload=json.dumps({\"order_id\": order.id, \"total\": order.total}), status=\"PENDING\" ) db.session.add(event) db.session.commit() 1 2 3 4 5 6 7 # 2. Poller: 주기적으로 Kafka에 발행 def publish_events(): events = db.session.query(OutboxEvent).filter_by(status=\"PENDING\").all() for event in events: kafka_producer.send(\"order.events\", event.payload) event.status = \"SENT\" db.session.commit() MDA (Message-Driven Architecture) \u0026 EDA (Event-Driven Architecture) 혼합 아키텍처 With Kafka 아키텍처적으로 설계 관점과 메시지 사용 방식이 달라야 하며, Kafka 가 본질적으로 Event-Driven 친화적인 플랫폼이라는 점을 이해하고, MDA 스타일에 맞게 보완 설계가 필요하다.\nKafka 하나로 MDA \u0026 EDA 처리하는 방식 요약 아키텍처 유형 Kafka 적용 방식 설명 MDA (명령 기반) Point-to-Point 방식 구현 (Consumer Group 활용) 특정 명령을 하나의 서비스가 처리하도록 설정 (1:1 처리 구조) EDA (이벤트 기반) Pub/Sub 방식 구현 (Consumer Group 없이 독립 구독) 동일 이벤트를 여러 서비스가 독립적으로 병렬 반응 (1:N 구조) MDA with Kafka–구현 방법 Kafka 는 원래 Pub/Sub 구조지만, Consumer Group을 활용하면 MDA 의 Point-to-Point 스타일로 구현할 수 있다.\nflowchart LR Producer --\u003e|command: createInvoice| KafkaTopic KafkaTopic --\u003e|ConsumerGroup: invoice-service| ConsumerA 동일 Consumer Group 내에서는 단일 인스턴스만 메시지를 소비 즉, Kafka 에서도 MDA 스타일의 명령 처리 가능 EDA with Kafka–구현 방법 Kafka 본연의 Event-Driven 처리. 여러 Consumer Group 이 각각 이벤트를 수신하고 처리 가능하다.\nflowchart LR Producer --\u003e|event: OrderCreated| KafkaTopic KafkaTopic --\u003e|ConsumerGroup: invoice| InvoiceService KafkaTopic --\u003e|ConsumerGroup: notification| NotificationService KafkaTopic --\u003e|ConsumerGroup: analytics| AnalyticsService 이벤트는 모든 ConsumerGroup 에 복제 전파됨 병렬 반응 가능하며, 완전한 Pub/Sub 패턴 구현 Kafka 기반 MDA \u0026 EDA 혼합 예시 구조 flowchart TD API[User Command API] API --\u003e|Command| KafkaCmd[Kafka: order.commands] KafkaCmd --\u003e|Group: order-handler| OrderService OrderService --\u003e|Event| KafkaEvt[Kafka: order.events] KafkaEvt --\u003e InvoiceService KafkaEvt --\u003e AnalyticsService KafkaEvt --\u003e NotificationService order.commands: Command Topic (MDA 역할) order.events: Event Topic (EDA 역할) 구현 시 주의할 점 항목 주의사항 명령 vs 이벤트 토픽 분리 MDA 스타일은 command.topic, EDA 스타일은 event.topic 으로 분리하는 것이 좋음 역할 분리 명확히 CommandConsumer, EventConsumer 역할 분리해서 구현 Idempotency 필수 Kafka 는 중복 수신 가능 → 컨슈머는 반드시 중복 처리 방어 Dead Letter Queue (DLQ) MDA 의 경우 실패 메시지는 DLQ 처리 구조 반드시 설계 Schema Registry 활용 Avro/JSON 스키마를 등록해 구조 변경 관리 필요 Kafka 기반 MDA / EDA 분리 구현 예시 (Python) 기본 전제:\nKafka 서버 주소: localhost:9092 Command Topic: order.commands Event Topic: order.events Group ID: MDA Consumer: order-command-handler EDA Consumers: invoice-service, notification-service Command Producer (MDA 용) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # send_command.py from kafka import KafkaProducer import json import uuid from datetime import datetime producer = KafkaProducer( bootstrap_servers='localhost:9092', value_serializer=lambda v: json.dumps(v).encode('utf-8') ) command = { \"command_id\": str(uuid.uuid4()), \"command_type\": \"CreateOrder\", \"timestamp\": datetime.utcnow().isoformat(), \"payload\": { \"order_id\": \"ORD-1001\", \"customer_id\": \"C-123\", \"amount\": 99.99 } } producer.send(\"order.commands\", value=command) producer.flush() print(f\"✅ Command sent: {command}\") Command Consumer (MDA 처리기: 1:1 처리) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # command_consumer.py from kafka import KafkaConsumer import json consumer = KafkaConsumer( \"order.commands\", bootstrap_servers='localhost:9092', group_id=\"order-command-handler\", value_deserializer=lambda m: json.loads(m.decode('utf-8')), auto_offset_reset='earliest', enable_auto_commit=True ) for message in consumer: command = message.value print(f\"📥 Received Command: {command['command_type']} for Order {command['payload']['order_id']}\") # Command 처리 후 이벤트 발행 (EDA 트리거) from kafka import KafkaProducer producer = KafkaProducer( bootstrap_servers='localhost:9092', value_serializer=lambda v: json.dumps(v).encode('utf-8') ) event = { \"event_id\": str(uuid.uuid4()), \"event_type\": \"OrderCreated\", \"occurred_at\": command[\"timestamp\"], \"payload\": command[\"payload\"] } producer.send(\"order.events\", value=event) producer.flush() print(f\"📤 Published Event: {event['event_type']}\") Event Consumer (EDA: 다수 컨슈머) Invoice Service:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # invoice_consumer.py from kafka import KafkaConsumer import json consumer = KafkaConsumer( \"order.events\", bootstrap_servers='localhost:9092', group_id=\"invoice-service\", value_deserializer=lambda m: json.loads(m.decode('utf-8')), auto_offset_reset='earliest', enable_auto_commit=True ) for message in consumer: event = message.value print(f\"🧾 [Invoice Service] 처리 중: {event['event_type']} - Order {event['payload']['order_id']}\") Notification Service:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # notification_consumer.py from kafka import KafkaConsumer import json consumer = KafkaConsumer( \"order.events\", bootstrap_servers='localhost:9092', group_id=\"notification-service\", value_deserializer=lambda m: json.loads(m.decode('utf-8')), auto_offset_reset='earliest', enable_auto_commit=True ) for message in consumer: event = message.value print(f\"📣 [Notification Service] 사용자에게 알림 전송: {event['payload']['customer_id']}\") 실행 순서 요약 command_consumer.py → MDA Consumer 실행 invoice_consumer.py, notification_consumer.py → EDA Consumers 실행 send_command.py → 명령 전송 흐름: order.commands → Order 처리 처리 후 order.events 로 Event 발행 Event 는 여러 서비스에서 병렬로 소비됨 아키텍처 흐름 시각화 sequenceDiagram participant A as send_command.py participant B as command_consumer.py participant Kafka1 as Topic: order.commands participant Kafka2 as Topic: order.events participant C as invoice_consumer.py participant D as notification_consumer.py A-\u003e\u003eKafka1: Command: CreateOrder Kafka1-\u003e\u003eB: MDA Consumer (Command 처리) B-\u003e\u003eKafka2: Event: OrderCreated Kafka2-\u003e\u003eC: Invoice 처리 Kafka2-\u003e\u003eD: Notification 처리 Command vs. Event 구분 기준 및 메시지 라우팅 전략 구분 기준 항목 Command (명령) Event (이벤트) 의도 행동을 유도 (Do something) 사실을 알림 (Something happened) 시간 미래 (미실행 상태) 과거 (이미 발생함) 수신자 단일 수신자 (명확한 담당자) 0 개 이상 수신자 (누가 받을지는 모름) 응답 필요 여부 일반적으로 Yes (결과 필요) 일반적으로 No (단방향 브로드캐스트) 구성 요소 Command ID, Target, Payload, Expected Result Event ID, Event Type, Timestamp, Payload 라우팅 전략 전략 유형 설명 예시 명령 라우팅 (Command Routing) 큐 이름이나 라우팅 키로 명시적으로 라우팅. 보통 Point-to-Point 방식 사용 invoice.create.command → InvoiceService 큐에 직접 전달 이벤트 브로드캐스트 주제 기반 토픽에 게시. 관심 있는 소비자가 구독 order.events → 여러 서비스가 동시에 반응 EventType 기반 라우팅 이벤트의 type 필드 기반으로 동적 라우팅 수행 Kafka topic 내부에서 \"event_type\" == \"OrderCreated\" 필터 Contextual Routing 메시지에 포함된 도메인 정보나 컨텍스트를 기준으로 라우팅 “VIP 고객 이벤트만 분석 서비스로 전파 \" 메시지 라우팅 예시 (Kafka Stream) 1 2 3 4 5 6 7 8 9 10 { \"event_id\": \"abc-123\", \"event_type\": \"OrderCreated\", \"occurred_at\": \"2025-07-17T14:00:00Z\", \"payload\": { \"order_id\": \"ORD-101\", \"customer_id\": \"C-999\", \"is_vip\": true } } is_vip == true → Analytics 서비스로 전송 event_type == OrderCreated → Invoice, Notification, OrderHistory 모두 수신 Kafka Streams, Flink, NiFi 등을 이용하여 내용 기반 라우팅을 손쉽게 구현할 수 있음.\n실무에서 효과적 적용을 위한 고려사항 카테고리 고려 항목 Message-Driven Architecture (MDA) Event-Driven Architecture (EDA) 권장 사항 및 전략 1. 메시지/이벤트 설계 메시지/이벤트 정의 명시적 메시지 타입 (Command/Request/Response 구분) 이벤트 의미 중심 정의 (상태 변화, 도메인 사상 중심) 변하지 않는 계약 기반 설계 (Contract), 타입 명확화, 이벤트 이름 표현 일관성 유지 스키마 관리 명시적 메시지 계약 관리 이벤트 스키마의 하위 호환성 및 버전 관리 필요 JSON Schema / Protobuf + Schema Registry / AsyncAPI 활용 2. 장애 및 실패 처리 실패 메시지 처리 DLQ(Dead Letter Queue), Retry, Timeout 처리 중복 이벤트 처리, 순서 보장, 보상 트랜잭션 필요 Idempotency Key 적용, 메시지 순서 처리 (Partition Key, Session) 장애 전파 제어 처리 실패 시 오류 큐 분리 및 재처리 중심 이벤트 컨슈머 오류 시에도 전체 시스템 영향 최소화 Circuit Breaker, Retry with Backoff, Outbox Pattern 적용 3. 트랜잭션 관리 일관성 처리 큐 기반 트랜잭션 처리 필요 이벤트 흐름 기반 일관성 설계 (Eventually Consistent) Saga 패턴 활용 (로컬 트랜잭션 + 보상 로직 분리), Outbox + Polling 기반 데이터 연동 4. 운영/모니터링 지표 수집 큐 깊이, 처리 지연, 에러율 중심 이벤트 발생률, 처리 지연, 누락 이벤트 탐지 Prometheus + Grafana, Alerting Rule, DLQ 모니터링 흐름 추적 메시지 ID 및 Correlation ID 기반 흐름 추적 이벤트 흐름 추적 및 인과 관계 분석 필요 Distributed Tracing (OpenTelemetry, Jaeger, Zipkin 등) 적용 5. 테스트 전략 계약 기반 테스트 Producer/Consumer 간 명시적 메시지 계약 필요 Event Flow 기반 테스트 및 상태 전이 검증 Consumer-Driven Contract Test, Schema Validation Test 6. 팀/조직 구조 서비스 소유권 및 거버넌스 서비스 단위로 메시지 주고받는 명확한 책임 구조 이벤트 발행자/구독자 간 소유권 불분명 가능성 있음 Conway’s Law 기반 서비스 - 팀 정렬, 이벤트 명세에 대한 거버넌스 체계 수립 최적화를 위한 고려사항 카테고리 최적화 대상 메시지 기반 아키텍처 (MDA) 이벤트 기반 아키텍처 (EDA) 공통 권장 전략 및 설명 1. 성능 처리량 \u0026 지연 시간 배치 처리, 큐 기반 병렬 소비 스트림 기반 처리, 이벤트 파이프라인 분산 처리 파티셔닝, 병렬 소비자 구성, 비동기화 2. 저장소 스토리지 효율성 메시지 압축 (Gzip, Snappy), TTL 기반 자동 삭제 설정 이벤트 압축 + 장기 아카이빙 (예: S3, Glacier) 압축 알고리즘 적용, 저장 주기 분리 3. 네트워크 대역폭 효율성 메시지 배칭 및 경량 메시지 포맷 사용 이벤트 배칭, 미니멀 이벤트 페이로드 설계 배치 전송, 프로토콜 최소화 (e.g., Protobuf) 4. 메모리 메모리 사용 최적화 메시지 캐시 활용 (Redis, LRU 등), 큐 기반 버퍼링 스트림 버퍼 조절, 이벤트 리플레이 캐시 적응형 버퍼 크기 조정, 백프레셔 적용 5. 확장성 수평 확장 브로커 클러스터 구성, Consumer 확장 이벤트 버스 확장, Auto-scaling 기반 소비자 구성 클라우드 네이티브 Auto-scaling, 분산 트래픽 라우팅 6. 정확성 중복 방지 \u0026 유실 대응 메시지 ID 추적, 오프셋 관리, 재처리 시 idempotent 설계 이벤트 중복 필터링, Exactly-once 처리 (Kafka EOS 등) 재시도 + 중복 제거 전략, 메시지 추적 ID 기반 처리 7. 지연 최적화 지연 최소화 경량 메시지 포맷 (JSON → Protobuf), 브로커 처리 최적화 실시간 이벤트 전달 + 스트리밍 최적화 (Kafka, Flink 등) 경량화, 실시간 처리 우선 순위 설계 8. 운영 관리 리소스 활용도 큐 대기 시간, DLQ 메시지 수, 처리율 등 메트릭 기반 운영 이벤트 처리 실패율, 라그 (Lag), 소비자 상태 추적 Prometheus + Grafana 모니터링, Alerting 구성 9. 장애 대응 오류 회복력 DLQ, Retry Policy, Circuit Breaker 설정 이벤트 재처리 및 재전파, 컨슈머 복구 전략 자동 Failover, 상태 기반 재처리 설계 주목할 내용 카테고리 항목 설명 관련 아키텍처 ** 설계 원칙** Idempotency 동일 메시지 반복 처리 시 중복 효과 방지. 정합성과 안전성을 위한 핵심 속성 MDA, EDA 순서 보장 (Ordering) 메시지 순서대로 처리 보장 필요 시 파티션, 키, 세션 단위로 설계 (e.g., Kafka partition key) MDA CQRS 패턴 Command(쓰기) 와 Query(읽기) 모델 분리로 확장성 및 성능 최적화 EDA 중심 ** 패턴과 전략** Saga Pattern 분산 트랜잭션을 보상 트랜잭션으로 분리 관리하여 롤백 없이 일관성 유지 (비동기 트랜잭션 제어) MDA, EDA Event Sourcing 시스템 상태를 이벤트 로그로 저장, 재생성 가능한 상태 복원 및 감사 추적 가능 EDA ** 인프라/플랫폼** Apache Kafka 고성능 이벤트 스트리밍 플랫폼, Pub/Sub 및 로그 기반 저장 포함 MDA, EDA RabbitMQ 전통적인 메시지 큐, 복잡한 라우팅 및 보증 수준 처리에 적합 MDA AWS SQS/SNS 클라우드 기반 메시징 서비스, 확장성과 관리 편의성 제공 MDA, EDA ** 운영/모니터링** Dead Letter Queue (DLQ) 실패 메시지 격리 보관 큐, 장애 원인 분석 및 재처리 기반 MDA, EDA Distributed Tracing 마이크로서비스 및 메시지 기반 시스템 간 흐름 시각화 및 성능 병목 분석 (예: Jaeger, OpenTelemetry) MDA, EDA 메트릭 수집 처리량, 지연, 실패율 등의 지표 수집으로 SLA 및 성능 관리 MDA, EDA 로그 집계 (Logging) 구조화된 메시지 기반 로그를 통해 디버깅 및 이벤트 트레킹 가능 MDA, EDA ** 확장성과 복구성** 수평 확장성 (Scalability) 컨슈머/리스너 개별 확장이 용이하며 메시지 큐 기반 구조가 동적 스케일아웃에 적합 MDA, EDA 이벤트 기반 민첩성 시스템의 상태 변화에 따라 리액티브하게 동작하여 민첩성 확보 EDA Event Store 이벤트의 영속적 저장을 통한 재처리, 복구, 비즈니스 감사 가능 EDA 반드시 학습해야할 내용 카테고리 주제/영역 핵심 항목 설명 1. 이론적 기반 분산 시스템 이론 CAP Theorem Consistency, Availability, Partition Tolerance 간의 트레이드오프 원리 최종 일관성 (Eventually Consistent) 분산 환경에서 강한 일관성 대신 허용되는 지연된 동기화 모델 ACID vs BASE 전통 트랜잭션 모델과 느슨한 일관성 모델의 비교 2. 메시징 패턴 통신 패턴 Request-Reply 동기적 요청 - 응답 처리 구조 (예: HTTP, RPC) Publish-Subscribe 비동기 이벤트 기반 다중 수신자 구조 (예: Kafka Topics) Message Queue FIFO 기반의 메시지 큐 구조 (예: RabbitMQ Queue) 3. 이벤트 아키텍처 이벤트 중심 설계 Event Sourcing 모든 상태 변경을 이벤트로 저장해 재구성 가능 CQRS 명령 (Command) 과 조회 (Query) 모델 분리 Event Store 이벤트 영속화를 위한 저장소 (예: Kafka, EventStoreDB) 4. 트랜잭션 처리 분산 트랜잭션 관리 Saga Pattern 보상 트랜잭션 기반의 분산 트랜잭션 처리 Idempotent Design 재시도 시 중복 처리를 방지하는 설계 전략 Retry / DLQ 실패 메시지 재처리 및 대체 큐 전략 (Dead Letter Queue) 5. 구현 프레임워크 메시징 브로커 구성 요소 RabbitMQ / Kafka 대표적인 메시징 시스템, 큐/토픽 기반 메시지 처리 Event Bus 이벤트 기반 통합 시스템의 중심 통신 채널 Service Mesh 메시지 기반 마이크로서비스 간 통신 관리 (예: Istio) API Gateway 클라이언트 요청을 내부 서비스로 라우팅하는 진입 지점 6. 운영 및 관찰성 시스템 관찰성 구성 분산 트레이싱 (Tracing) 서비스 간 호출 관계 추적 (예: OpenTelemetry, Jaeger) 메트릭 수집 (Metrics) 처리량, 지연시간 등 시스템 지표 모니터링 (예: Prometheus) 중앙 로그 관리 (Logging) 구조화된 로그 수집 및 검색 (예: ELK Stack) 용어 정리 카테고리 용어 정의 및 설명 관련 아키텍처 ** 시스템 구성요소** Message Broker 생산자 - 소비자 간 메시지를 송수신하고 버퍼링, 라우팅, 전송 보장 처리 MDA, EDA Event Bus 이벤트 발행/구독 기반의 전파 중심 메시징 채널 (메시지 라우팅 포함) EDA Event Store 발생한 모든 이벤트를 영속적으로 저장하는 저장소 EDA Dead Letter Queue (DLQ) 처리 실패 메시지를 격리 보관하여 후속 처리나 모니터링에 활용하는 큐 MDA, EDA Projection 이벤트 로그 (Event Stream) 를 읽기 모델로 변환하는 과정 EDA Correlation ID 요청 - 응답/처리 흐름 추적을 위한 메시지 간 고유 식별자 MDA, EDA ** 메시지/이벤트 단위** Message 명시적 명령 (Command), 요청 (Request), 응답 (Response), 데이터 전달을 포함한 단위 MDA Event 시스템에서 발생한 상태 변화나 사상 (Occurrence) 을 의미. 결과 지향적 EDA ** 통신/설계 패턴** Publish/Subscribe (Pub/Sub) 발행자와 구독자 간 직접적 연결 없이 메시지를 중개 채널을 통해 전달하는 패턴 MDA, EDA Saga Pattern 분산 트랜잭션을 보상 트랜잭션 (Compensation) 으로 관리하는 패턴 MDA, EDA Compensating Transaction 실패한 작업을 취소하거나 보정하는 트랜잭션 MDA, EDA Circuit Breaker 장애 확산을 방지하고 빠른 실패 처리를 유도하는 안정성 제어 패턴 MDA, EDA Event Sourcing 상태를 DB 에 저장하는 대신, 발생한 이벤트 시퀀스를 저장하고 이를 재생해 상태를 복원 EDA ** 품질 및 운영 특성** Idempotency (멱등성) 동일 메시지를 여러 번 처리해도 결과가 동일하게 유지되는 속성 MDA, EDA Eventual Consistency 즉시 일관성은 보장하지 않지만 시간이 지나면 일관성을 확보하는 모델 EDA Back Pressure 처리량 초과 시 시스템 안정성 유지를 위한 흐름 제어 기법 MDA, EDA Bulkhead 장애 격리를 위한 시스템 분할 전략 (마이크로서비스의 독립 실행 보장) MDA, EDA Distributed Tracing 다중 서비스 간 요청 흐름을 추적하기 위한 기법 (예: Jaeger, Zipkin) MDA, EDA 참고 및 출처 Message-Driven vs Event-Driven Architecture 비교 - GeeksforGeeks Event vs Message: 차이와 실무 적용 - Medium (Simpplr Tech) Event-Driven vs Message-Driven 구조 비교 - Medium (Alex Dorand) Scaling Microservices: Message vs Event - Medium (Leela Kumili) Message vs Event Driven Architecture 비교 - LinkedIn (Saurabh Mishra) Message vs Event: 개념 차이와 적용 가이드 - Akka Guide Messaging vs Event-Driven Architecture 선택 가이드 - LinkedIn Microservices Pattern: Event-Driven Architecture - Microservices.io Asynchronous Message-Based Communication - Microsoft Learn Message-Driven Systems in Reactive Architecture - AWS Whitepaper Messaging Patterns for Event-Driven Microservices - Solace Event-Driven Architecture 개요 - Confluent Event-Driven Architecture 베스트 프랙티스 - AWS Architecture Blog Event-Driven Architecture 스타일 설명 - Azure Architecture Center CQRS 패턴 소개 - Azure Architecture Center CQRS \u0026 Event Sourcing with Java - Baeldung Amazon EventBridge 소개 - AWS 공식 문서 Saga Pattern in Microservices - Microsoft Docs Idempotent Consumer 구현 - Apache Kafka Docs Distributed Tracing 개요 - OpenTelemetry Message Broker vs Event Broker - Dev.to Event-Driven vs Message-Driven Architecture - Baeldung RabbitMQ 공식 문서 Apache Kafka 공식 문서 Message Broker 아키텍처 스타일 - Microsoft Architecture Center ","wordCount":"8141","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2025-06-23T12:02:00Z","dateModified":"2025-06-23T12:02:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/message-driven-vs-event-driven-architecture/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/>Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/>Messaging-Oriented Architecture</a></div><h1 class="post-title entry-hint-parent">Message-Driven vs. Event-Driven Architecture</h1><div class=post-description>메시지 기반 아키텍처 (Message-Driven Architecture, MDA) 와 이벤트 기반 아키텍처 (Event-Driven Architecture, EDA) 는 시스템 간의 통신 및 동작 연결 방식에서 핵심적인 패러다임이다. 메시지 - 기반은 직접적 명령과 데이터 전달에 집중하며, 이벤트 - 기반은 상태 변화와 그에 대한 반응에 중점을 둔다. 각각의 방식은 구조적 장점과 단점이 명확하므로 실무에서 상황에 맞는 선택이 필요하다.</div><div class=post-meta><span title='2025-06-23 12:02:00 +0000 UTC'>June 23, 2025</span>&nbsp;·&nbsp;39 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Software%20Design%20and%20Architecture/Architecture/Messaging-Oriented%20Architecture/message-driven-vs-event-driven-architecture.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#message-driven-vs-event-driven-architecture>Message-Driven vs. Event-Driven Architecture</a><ul><li><a href=#핵심-개념>핵심 개념</a></li><li><a href=#message-driven-vs-event-driven-architecture-비교>Message-Driven vs. Event-Driven Architecture 비교</a></li><li><a href=#단점과-문제점-및-해결방안>단점과 문제점 및 해결방안</a></li><li><a href=#도전-과제>도전 과제</a></li><li><a href=#실무-사용-예시>실무 사용 예시</a></li><li><a href=#활용-사례>활용 사례</a></li><li><a href=#mda-message-driven-architecture--eda-event-driven-architecture-혼합-아키텍처>MDA (Message-Driven Architecture) & EDA (Event-Driven Architecture) 혼합 아키텍처</a></li><li><a href=#command-vs-event-구분-기준-및-메시지-라우팅-전략>Command vs. Event 구분 기준 및 메시지 라우팅 전략</a></li><li><a href=#실무에서-효과적-적용을-위한-고려사항>실무에서 효과적 적용을 위한 고려사항</a></li><li><a href=#최적화를-위한-고려사항>최적화를 위한 고려사항</a></li><li><a href=#주목할-내용>주목할 내용</a></li><li><a href=#반드시-학습해야할-내용>반드시 학습해야할 내용</a></li></ul></li><li><a href=#용어-정리>용어 정리</a></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=message-driven-vs-event-driven-architecture>Message-Driven vs. Event-Driven Architecture<a hidden class=anchor aria-hidden=true href=#message-driven-vs-event-driven-architecture>#</a></h2><p>메시지 기반 (Message‑Driven) 과 이벤트 기반 (Event‑Driven) 은 비동기 통신을 통한 분산 시스템 설계 방식이다.</p><p>메시지 기반 (Message‑Driven) 는 명령 (Command) 또는 Request-Response 워크플로우 중심이며 수신자 주소를 알고 직접 메시지를 주고 받는다. 반면 이벤트 기반 (Event‑Driven) 는 상태 변화 (State Change) 를 이벤트로 정의하고 Publish-Subscribe (pub/sub) 나 Event Bus 로 브로드캐스트 (Broadcast) 하며, 소비자 목록을 알 필요 없이 느슨하게 결합된 구조로 동작한다.</p><p>두 방식은 구현 목적, 응답 실시간성, 확장성, 복잡성 등에서 차이를 보이며, 실무에서는 상호 보완적으로 병용되기도 한다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><h4 id=요약-정의>요약 정의<a hidden class=anchor aria-hidden=true href=#요약-정의>#</a></h4><table><thead><tr><th>구분</th><th>Message-Driven Architecture (MDA)</th><th>Event-Driven Architecture (EDA)</th></tr></thead><tbody><tr><td><strong>정의</strong></td><td>명시적 수신자에게 <strong>명령 또는 요청</strong>을 메시지로 전달하는 아키텍처 스타일</td><td>상태 변화 등 **사실 (fact)**을 알리는 이벤트를 브로드캐스트하는 아키텍처 스타일</td></tr><tr><td><strong>주요 흐름</strong></td><td>Point-to-Point 메시지 기반 요청/응답 흐름</td><td>Publish-Subscribe 기반 비동기 반응 흐름</td></tr><tr><td><strong>주된 목적</strong></td><td><strong>작업 실행 지시</strong> (Command)</td><td><strong>상태 변화 알림</strong> (Event Notification)</td></tr></tbody></table><h4 id=핵심-차이-분석>핵심 차이 분석<a hidden class=anchor aria-hidden=true href=#핵심-차이-분석>#</a></h4><table><thead><tr><th>항목</th><th>Message-Driven</th><th>Event-Driven</th></tr></thead><tbody><tr><td><strong>의도 (Intent)</strong></td><td>수신자에게 특정 작업을 수행하라는 <strong>명시적 명령</strong></td><td>상태 변화가 발생했음을 <strong>알리는 사실 기반 알림</strong></td></tr><tr><td><strong>메시지 타입</strong></td><td>Command, Request, Response</td><td>Event (fact-based)</td></tr><tr><td><strong>수신자 인식 여부</strong></td><td><strong>알고 있음 (Direct)</strong>–명시적으로 대상 지정</td><td><strong>모름 (Decoupled)</strong>–브로드캐스트, 수신자는 선택적 구독</td></tr><tr><td><strong>보통의 처리 흐름</strong></td><td>1:1 메시지 라우팅 → 작업 수행 후 응답</td><td>1:N 이벤트 발행 → 여러 소비자가 병렬 반응</td></tr><tr><td><strong>결합도</strong></td><td>느슨하지만 <strong>명시적 수신자 존재로 일부 결합</strong></td><td>느슨한 결합 (완전한 Decoupling 가능)</td></tr><tr><td><strong>순서 보장</strong></td><td>큐 기반 FIFO 순서 보장 가능</td><td>기본적으로 순서 미보장 (설정으로 보장 가능)</td></tr><tr><td><strong>트리거</strong></td><td><strong>요청에 의해 명령 실행</strong></td><td><strong>상태 변화 발생 시 이벤트 발행</strong></td></tr><tr><td><strong>실행 제어 흐름</strong></td><td>생산자가 <strong>통제</strong></td><td>소비자가 <strong>반응</strong></td></tr><tr><td><strong>기술 예시</strong></td><td>RabbitMQ (Command Queue), JMS</td><td>Kafka (Event Log), AWS SNS</td></tr></tbody></table><h4 id=구조-비교-다이어그램>구조 비교 다이어그램<a hidden class=anchor aria-hidden=true href=#구조-비교-다이어그램>#</a></h4><pre class=mermaid>flowchart TD
  subgraph MDA[Message-Driven Architecture]
    A1[&#34;Service A (Producer)&#34;] --&gt;|Command: createOrder| Q1[Queue]
    Q1 --&gt; B1[&#34;Service B (Consumer)&#34;]
  end

  subgraph EDA[Event-Driven Architecture]
    A2[&#34;Service A (Producer)&#34;] --&gt;|Event: OrderCreated| T1[Topic]
    T1 --&gt; B2[&#34;Service B (Consumer)&#34;]
    T1 --&gt; C2[&#34;Service C (Consumer)&#34;]
  end
</pre><ul><li><strong>MDA</strong>: 수신자가 명시되어 있고, 메시지가 큐로 전달됨 → <code>Point-to-Point</code></li><li><strong>EDA</strong>: 이벤트는 브로드캐스트되며, 구독자가 선택적으로 반응 → <code>Publish-Subscribe</code></li></ul><h4 id=실무-혼동-방지-포인트>실무 혼동 방지 포인트<a hidden class=anchor aria-hidden=true href=#실무-혼동-방지-포인트>#</a></h4><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td><strong>Event ≠ Command</strong></td><td>Event 는 <strong>발생한 일</strong>, Command 는 <strong>수행하라는 지시</strong>. 동일한 메시지 구조를 갖더라도 의미는 완전히 다름.</td></tr><tr><td><strong>EDA ≠ 비동기 메시징</strong></td><td>비동기라고 모두 EDA 가 되는 것은 아님. 핵심은 <strong>상태 변화 기반의 반응형 설계</strong>인지 여부임.</td></tr><tr><td><strong>MDA 도 pub/sub 로 구현 가능</strong></td><td>예: Command 를 Kafka Topic 에 게시 → Consumer 가 명령 처리. 구조는 pub/sub 지만 <strong>의도는 MDA</strong>임.</td></tr><tr><td><strong>복합 사용 가능</strong></td><td>MDA 와 EDA 는 상호 배타적이지 않음. 보통 <strong>Command → 처리 → Event 발행</strong> 패턴으로 같이 사용됨.</td></tr></tbody></table><h3 id=message-driven-vs-event-driven-architecture-비교>Message-Driven vs. Event-Driven Architecture 비교<a hidden class=anchor aria-hidden=true href=#message-driven-vs-event-driven-architecture-비교>#</a></h3><table><thead><tr><th>항목</th><th>Message-Driven Architecture (MDA)</th><th>Event-Driven Architecture (EDA)</th></tr></thead><tbody><tr><td><strong>핵심 철학</strong></td><td><strong>명령 (Command)/요청 (Request)</strong> 기반 처리. 명시적 수신자에게 작업을 지시함.</td><td><strong>사실 (Fact)/상태 변화 (State Change)</strong> 중심. 이벤트가 발생하면 여러 수신자가 반응함.</td></tr><tr><td><strong>통신 모델</strong></td><td>Point-to-Point (1:1), 큐 기반 명령 전달</td><td>Publish-Subscribe (1:N), 이벤트 브로드캐스트</td></tr><tr><td><strong>결합도</strong></td><td>상대적으로 낮음 (비동기), 그러나 수신자 인식이 필요해 일부 의존성 존재</td><td>매우 낮음. 이벤트 생산자는 소비자를 전혀 알 필요 없음</td></tr><tr><td><strong>메시지 성격</strong></td><td>명령, 요청, 응답 (Command/Request/Response)</td><td>상태 변화 또는 발생된 사실 (Event/Notification)</td></tr><tr><td><strong>처리 흐름</strong></td><td>정의된 워크플로우에 따라 순차적 또는 동기·비동기 처리 가능</td><td>비동기, 병렬 트리거 처리. 순차성 보장은 어려움.</td></tr><tr><td><strong>트리거 방식</strong></td><td>명시적 메시지 호출이 트리거</td><td>상태 변화가 트리거되면 이벤트 발생</td></tr><tr><td><strong>확장성</strong></td><td>큐 및 컨슈머 확장으로 처리량 증가 가능, 구조적 확장에는 제약이 있음</td><td>구독자 추가만으로 확장 가능. 고유 이벤트 흐름 유지하며 동적 확장에 유리</td></tr><tr><td><strong>복원력 및 재처리</strong></td><td>메시지 ID, 상태 기반으로 재처리 용이 (DLQ 지원, 재시도 등)</td><td>이벤트 중복 및 순서 처리 로직 별도 필요. 보통 <strong>Idempotency</strong> 또는 <strong>Event Replay</strong> 사용</td></tr><tr><td><strong>장애 추적</strong></td><td>메시지 ID 기반 추적 용이. 큐 단위 관찰 가능</td><td>이벤트 흐름이 분산되기 때문에 End-to-End Trace 도구 필수 (예: OpenTelemetry, Jaeger)</td></tr><tr><td><strong>데이터 일관성 모델</strong></td><td>강한 일관성 (Strong Consistency) 설계 가능</td><td>최종 일관성 (Eventual Consistency) 중심. 수신자마다 상태가 비동기적으로 반영됨</td></tr><tr><td><strong>대표 기술 스택</strong></td><td>RabbitMQ, ActiveMQ, Amazon SQS, Azure Service Bus</td><td>Apache Kafka, AWS SNS/EventBridge, Azure Event Grid, Google Pub/Sub</td></tr><tr><td><strong>실무 적용 예시</strong></td><td>주문 처리, 워크플로우 자동화, 이메일 전송, 비동기 백오피스 작업</td><td>실시간 데이터 분석, 사용자 활동 이벤트, IoT, 로그 수집, 알림 시스템 등</td></tr><tr><td><strong>운영/모니터링 복잡도</strong></td><td>비교적 단순. 큐 상태, 메시지 실패율 등으로 모니터링 가능</td><td>이벤트 흐름 추적 복잡. 분산 트레이싱 필요. 이벤트 로스 여부 판단 어렵고 누락 방지 전략 필요</td></tr><tr><td><strong>설계 난이도</strong></td><td>비교적 단순. 송수신 정의 명확. 흐름 제어 용이</td><td>복잡. 이벤트 정의, 버전 관리, 처리 순서 보장, idempotency 보장 등 추가 고려 요소 다수</td></tr></tbody></table><h4 id=심화-분석설계운영-관점에서의-고려-요소>심화 분석–설계/운영 관점에서의 고려 요소<a hidden class=anchor aria-hidden=true href=#심화-분석설계운영-관점에서의-고려-요소>#</a></h4><table><thead><tr><th>항목</th><th>MDA 고려사항</th><th>EDA 고려사항</th></tr></thead><tbody><tr><td>메시지 설계</td><td>명령 유형 정의, 메시지 순서 보장, 응답 처리 모델 포함</td><td>이벤트 정의, 불변성 설계, 중복 허용 처리 설계 필요</td></tr><tr><td>일관성 보장</td><td>트랜잭션 메시지 처리, SAGA 패턴 또는 Outbox 패턴 활용 가능</td><td>이벤트 기반 일관성. eventual consistency 허용, 보완을 위한 event chaining 필요</td></tr><tr><td>장애 대응</td><td>DLQ 구성, 메시지 재시도 및 순서 재정렬 메커니즘 필요</td><td>이벤트 중복 제거, 순서 보장 옵션 설정, Retry → Duplicate 여부 식별 로직 필요</td></tr><tr><td>메시지 추적</td><td>큐 단위 추적 가능, 로그 기반 문제 진단 용이</td><td>end-to-end 추적 어려움. <strong>분산 트레이싱 도구</strong> 활용 필수 (ex. Jaeger + OpenTelemetry)</td></tr><tr><td>테스트 전략</td><td>Consumer 단위 단위 테스트 및 통합 테스트 비교적 용이</td><td>이벤트 흐름 기반 테스트 구성 어려움. Mock Event Stream, Consumer Simulation 등 필요</td></tr></tbody></table><h4 id=강점과-약점>강점과 약점<a hidden class=anchor aria-hidden=true href=#강점과-약점>#</a></h4><table><thead><tr><th>구분</th><th>Message-Driven Architecture</th><th>Event-Driven Architecture</th></tr></thead><tbody><tr><td><strong>강점</strong></td><td>• 명확한 통신 구조<br>• 높은 신뢰성<br>• 트랜잭션 관리 용이<br>• 디버깅 및 추적 용이</td><td>• 높은 확장성<br>• 느슨한 결합<br>• 실시간 반응성<br>• 시스템 진화 용이</td></tr><tr><td><strong>약점</strong></td><td>• 송수신자 간 결합도<br>• 확장성 제한<br>• 복잡한 라우팅<br>• 단일 장애점 위험</td><td>• 이벤트 순서 관리 복잡<br>• 최종 일관성 문제<br>• 복잡한 디버깅<br>• 이벤트 스키마 관리</td></tr></tbody></table><h4 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h4><h5 id=message-driven-architecture-구조>Message-Driven Architecture 구조<a hidden class=anchor aria-hidden=true href=#message-driven-architecture-구조>#</a></h5><pre class=mermaid>graph LR
    A[Client] --&gt; B[Message Producer]
    B --&gt; C[Message Queue]
    C --&gt; D[Message Consumer]
    D --&gt; E[Service A]
    
    F[Service B] --&gt; G[Message Queue 2]
    G --&gt; H[Service C]
    
    subgraph &#34;Message Broker&#34;
        C
        G
    end
</pre><p><strong>필수 구성요소:</strong></p><ul><li><strong>Message Producer</strong>: 메시지 생성 및 전송</li><li><strong>Message Queue</strong>: 메시지 저장 및 라우팅</li><li><strong>Message Consumer</strong>: 메시지 수신 및 처리</li><li><strong>Message Broker</strong>: 메시지 중개 및 관리</li></ul><p><strong>선택 구성요소:</strong></p><ul><li><strong>Dead Letter Queue</strong>: 처리 실패 메시지 관리</li><li><strong>Message Router</strong>: 조건부 메시지 라우팅</li><li><strong>Retry Mechanism</strong>: 재시도 로직</li></ul><h5 id=event-driven-architecture>Event-Driven Architecture<a hidden class=anchor aria-hidden=true href=#event-driven-architecture>#</a></h5><pre class=mermaid>graph TD
    A[Event Producer] --&gt; B[Event Bus]
    B --&gt; C[Event Consumer 1]
    B --&gt; D[Event Consumer 2]
    B --&gt; E[Event Consumer 3]
    
    C --&gt; F[Service A]
    D --&gt; G[Service B]
    E --&gt; H[Analytics Service]
    
    subgraph &#34;Event Broker&#34;
        B
        I[Event Store]
        J[Event Router]
    end
</pre><p><strong>필수 구성요소:</strong></p><ul><li><strong>Event Producer</strong>: 이벤트 발생 및 발행</li><li><strong>Event Bus/Broker</strong>: 이벤트 배포 및 라우팅</li><li><strong>Event Consumer</strong>: 이벤트 수신 및 반응</li><li><strong>Event Store</strong>: 이벤트 영속화 (선택적)</li></ul><p><strong>선택 구성요소:</strong></p><ul><li><strong>Event Sourcing</strong>: 이벤트 기반 상태 재구성</li><li><strong>CQRS</strong>: 읽기/쓰기 분리</li><li><strong>Event Mesh</strong>: 분산 이벤트 인프라</li></ul><h4 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h4><h5 id=message-driven-architecture-mda>Message-Driven Architecture (MDA)<a hidden class=anchor aria-hidden=true href=#message-driven-architecture-mda>#</a></h5><p><strong>주요 원리</strong>:</p><ul><li>메시지 단위의 통신</li><li>송신자 - 수신자 간 느슨한 결합</li><li>메시지 큐 (MQ) 또는 메시지 브로커 기반</li><li>재시도, ACK, DLQ(Dead Letter Queue) 등 안정성 보장</li></ul><p><strong>작동 원리 다이어그램</strong>:</p><ul><li>메시지를 보내면 브로커 (큐) 에 쌓이고, 컨슈머가 해당 메시지를 받아 처리.</li></ul><ul><li>명령 - 응답/작업 요청 등 전통적 통신 대신, 비동기 큐가 중재함.</li></ul><pre class=mermaid>sequenceDiagram
    participant Client
    participant Producer
    participant Queue
    participant Consumer

    Client-&gt;&gt;Producer: 요청 수행
    Producer-&gt;&gt;Queue: 메시지 전송
    Consumer-&gt;&gt;Queue: 메시지 Pull 또는 Subscribe
    Queue-&gt;&gt;Consumer: 메시지 전달
    Consumer-&gt;&gt;Queue: 처리 성공 ACK
</pre><h5 id=event-driven-architecture-eda>Event-Driven Architecture (EDA)<a hidden class=anchor aria-hidden=true href=#event-driven-architecture-eda>#</a></h5><p><strong>주요 원리</strong>:</p><ul><li>시스템의 상태 변화 = 이벤트</li><li>발행/구독 (Pub/Sub) 모델 사용</li><li>발행자 (Producer) 는 수신자를 모름</li><li>다수의 소비자가 독립적으로 이벤트 처리</li></ul><p><strong>작동 원리 다이어그램</strong>:</p><ul><li>시스템 내 상태 변화 발생 시 이벤트 생성 후 이벤트 버스에 게시.</li><li>이를 구독하는 다수의 컨슈머가 해당 이벤트를 감지해 각각 독립적으로 반응.</li></ul><pre class=mermaid>sequenceDiagram
    participant Producer
    participant EventBus
    participant Consumer1
    participant Consumer2

    Producer-&gt;&gt;EventBus: 이벤트 발생
    EventBus-&gt;&gt;Consumer1: 이벤트 전달
    EventBus-&gt;&gt;Consumer2: 이벤트 전달
    Consumer1--&gt;&gt;EventBus: (선택적으로 ACK)
    Consumer2--&gt;&gt;EventBus: (선택적으로 ACK)
</pre><hr><h3 id=단점과-문제점-및-해결방안>단점과 문제점 및 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-및-해결방안>#</a></h3><table><thead><tr><th>문제 유형</th><th>원인 및 설명</th><th>탐지 및 진단</th><th>예방 전략</th><th>해결 방안 및 기법</th></tr></thead><tbody><tr><td><strong>설계 복잡성 증가</strong></td><td>이벤트 흐름이 분산되고 시스템 구성요소가 많아짐</td><td>설계 불일치, 변경 시 영향도 분석</td><td>도메인 중심 이벤트 모델링 EventStorming</td><td>아키텍처 문서화, 워크플로 자동화</td></tr><tr><td><strong>흐름 추적 어려움</strong></td><td>이벤트가 비동기적으로 다양한 소비자로 전파됨 → 요청 추적 어려움</td><td>로그 상관관계, 호출 체인 누락</td><td>Correlation ID 포함, 메시지 라벨링</td><td>OpenTelemetry, 분산 트레이싱 도구 (Jaeger 등)</td></tr><tr><td><strong>중복 메시지</strong></td><td>재시도, 네트워크 실패, 브로커 재전송 등으로 중복 메시지 소비 발생</td><td>중복 데이터 탐지, 로그 기반 비교</td><td>메시지 ID/해시 기반 필터링</td><td>Idempotent 소비자 설계, 중복 필터, 메시지 해시 적용</td></tr><tr><td><strong>메시지 유실</strong></td><td>브로커 장애, 네트워크 단절, 일시적 장애 시 메시지가 손실될 수 있음</td><td>브로커 로그, 큐 상태, 처리 누락 검출</td><td>영속 메시지 설정, 멀티 브로커 구성</td><td>DLQ 설정, 재처리 큐 운영, 브로커 HA 구성</td></tr><tr><td><strong>이벤트 순서 문제</strong></td><td>파티셔닝된 소비자나 병렬 처리로 인해 순서가 변경될 수 있음</td><td>이벤트 순서 로그, 재현 시나리오 분석</td><td>메시지에 Sequence ID 부여, 순서 고정 큐 사용</td><td>Kafka Offset 기반 처리, 순서 보장 전략 적용</td></tr><tr><td><strong>데이터 일관성 불일치</strong></td><td>Eventual Consistency 모델로 인해 상태가 일시적으로 불일치 가능</td><td>상태 불일치 알람, 상태 모니터링</td><td>보상 트랜잭션 기반의 설계 (Saga)</td><td>Event Sourcing, CDC (Change Data Capture)</td></tr><tr><td><strong>디버깅 난이도</strong></td><td>비동기 처리 로직은 동기 흐름과 달리 재현과 로깅이 복잡</td><td>로깅 미비, 트레이스 누락</td><td>테스트용 메시지 시뮬레이터 활용, 전체 흐름 로깅 활성화</td><td>Logging 강화, DLQ 재현용 시뮬레이터, Trace Replay Tool</td></tr><tr><td><strong>테스트 어려움</strong></td><td>메시지/이벤트 기반 시스템은 단위 테스트보단 통합 테스트 중심 → 시뮬레이션 요구</td><td>테스트 커버리지 부족, 비결정성 시나리오 발생</td><td>컨슈머 모킹, 메시지/이벤트 시뮬레이터 구성</td><td>통합 테스트 환경 구축 (e.g., TestContainers + Kafka)</td></tr><tr><td><strong>장애 탐지 지연</strong></td><td>분산된 구성 요소로 인해 장애의 위치나 원인 파악이 어려움</td><td>로그 누락, Alert 지연</td><td>중앙 집중 로깅 + 모니터링</td><td>통합 모니터링 (Prometheus, Grafana, ELK Stack 등)</td></tr><tr><td><strong>메시지 적체</strong></td><td>컨슈머 처리 속도 &lt; 메시지 유입 속도 시 큐가 적체되어 서비스 지연 발생</td><td>큐 크기, 처리율, 대기 시간 모니터링</td><td>Auto-scaling, Load Leveling 설계</td><td>큐 확장, 컨슈머 수 증가, 백프레셔 제어 적용</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인/상황</th><th>영향</th><th>탐지 및 진단 방식</th><th>예방 및 해결 전략</th></tr></thead><tbody><tr><td><strong>신뢰성/안정성</strong></td><td>메시지/이벤트 손실</td><td>네트워크 장애, 브로커 중단, Ack 누락</td><td>데이터 유실, 흐름 중단</td><td>브로커 상태 모니터링, ACK 로그 분석</td><td>메시지 영속화 (디스크 저장), 재시도 전략, DLQ 구성</td></tr><tr><td><strong>중복 처리</strong></td><td>메시지 재전송 시 중복 처리</td><td>QoS 1 이상 사용, 재시도 시 중복 허용 구조</td><td>데이터 중복 기록, 비즈니스 오류</td><td>이상 상태 탐지 로직, 중복 수신 로그 분석</td><td>메시지 ID 추적, Idempotency 키 사용, Deduplication 로직 구현</td></tr><tr><td><strong>순서 보장</strong></td><td>이벤트/메시지 순서 왜곡</td><td>멀티 스레드 처리, 병렬 큐, 복수 브로커 활용</td><td>상태 불일치, 잘못된 트랜잭션 실행</td><td>시퀀스 번호 모니터링, 상태 간 불일치 감지</td><td>파티션 키 활용, 순서 큐 구성, 메시지 헤더 시퀀싱, 이벤트 버퍼링</td></tr><tr><td><strong>일관성 보장</strong></td><td>분산 트랜잭션 처리 어려움</td><td>서비스 간 독립 처리, 원자성 부족</td><td>데이터 무결성 깨짐, 불일치 상태 발생</td><td>상태 불일치 분석, 상태 확인 작업</td><td>Saga 패턴, 보상 트랜잭션, Outbox 패턴, Eventually Consistent 설계 적용</td></tr><tr><td><strong>관찰 가능성</strong></td><td>이벤트 흐름 추적의 어려움</td><td>비동기 처리 + 이벤트 확산 → 인과 관계 파악 복잡</td><td>장애 진단 지연, 성능 병목 추적 어려움</td><td>분산 추적 시스템, 로그/메트릭 연동 분석</td><td>Correlation ID 삽입, OpenTelemetry, Jaeger, Zipkin 등 활용</td></tr><tr><td><strong>스키마 진화</strong></td><td>이벤트 구조 변경에 따른 호환성 이슈</td><td>메시지/이벤트 필드 추가/삭제, 버전 불일치</td><td>소비자 에러, 통신 오류</td><td>스키마 유효성 검사, 호환성 테스트</td><td>Schema Registry 도입, 버전 관리 전략, Avro/Protobuf 기반 호환 설계</td></tr><tr><td><strong>보안/컴플라이언스</strong></td><td>메시지/이벤트 보호 및 인증 문제</td><td>분산 경계, 브로커 - 컨슈머 간 전송 보안, 인증 미비</td><td>민감 데이터 노출, 규정 위반</td><td>감사 로그, 보안 이벤트 추적</td><td>메시지 암호화, OAuth2 인증, ACL 설정, Zero Trust 설계 적용</td></tr><tr><td><strong>팀 간 협업/거버넌스</strong></td><td>서비스 간 스키마 및 이벤트 관리 문제</td><td>서비스 단위로 분산 개발, 계약 부재, 의사소통 단절</td><td>중복 개발, 비호환 이벤트 설계</td><td>API/이벤트 문서 리뷰, 아키텍처 검토</td><td>API First, 표준화된 메시지 컨벤션, ADR 관리, 이벤트 명세 중심의 협업 프로세스</td></tr><tr><td><strong>모니터링/운영</strong></td><td>장애 대응 및 지표 부족</td><td>분산 컴포넌트 모니터링 누락, 지표 비통합</td><td>장애 징후 탐지 지연, 복구 시간 증가</td><td>지연/에러율 모니터링, DLQ 확인</td><td>메트릭 수집 (Prometheus), Alerting Rule 정의, 중앙 집중 로그 수집 (ELK/EFK 등)</td></tr><tr><td><strong>테스트/검증</strong></td><td>이벤트 흐름 테스트의 어려움</td><td>컨슈머/프로듀서 간 계약 불명확, 테스트 환경 미흡</td><td>이벤트 누락/불일치로 인한 기능 실패</td><td>컨트랙트 기반 테스트 도입, 이벤트 시뮬레이션</td><td>Consumer-Driven Contract Testing, 테스트 더블 (Double) 및 샌드박스 환경 구축</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>산업 분야</th><th>시스템 유형</th><th>활용 아키텍처 유형</th><th>주요 목적</th><th>기대 효과</th><th>주요 기술 구성</th></tr></thead><tbody><tr><td><strong>전자상거래</strong></td><td>주문 처리 시스템</td><td>MDA → EDA 혼합형</td><td>주문 → 결제 → 배송의 워크플로우 분리 및 상태 변화 후 다중 시스템 동기화</td><td>확장성, 처리 신뢰성, 실시간 반응</td><td>RabbitMQ, Kafka, Redis</td></tr><tr><td><strong>금융</strong></td><td>거래 처리 및 분석 시스템</td><td>MDA (트랜잭션 처리), EDA (사후 분석)</td><td>거래 승인 → 계좌 업데이트 후 이벤트 기반 분석/리스크 처리</td><td>신뢰성, 실시간 탐지, 규제 대응</td><td>JMS, EventStore, Lambda</td></tr><tr><td><strong>물류</strong></td><td>배송 추적/관리 시스템</td><td>EDA 중심</td><td>배송 상태 변화에 따른 이벤트를 실시간 처리 및 분석 연계</td><td>가시성 확보, 사용자 경험 향상</td><td>Kafka, AWS SNS, Webhook</td></tr><tr><td><strong>IoT/제조</strong></td><td>센서 기반 데이터 처리</td><td>EDA 중심</td><td>대규모 센서 이벤트 스트리밍 처리 및 예측 정비</td><td>운영 효율성, 지능형 유지보수 실현</td><td>Kafka, MQTT, Flink</td></tr><tr><td><strong>게임</strong></td><td>멀티플레이어 실시간 게임</td><td>EDA 중심</td><td>플레이어 이벤트 발생 → 분석, 개인화, 랭킹, 추천 시스템 연동</td><td>실시간 반응, 사용자 경험 최적화</td><td>Kafka, Redis Streams, WebSocket</td></tr><tr><td><strong>마케팅/알림</strong></td><td>푸시 알림, 이벤트 기반 마케팅</td><td>EDA + Pub/Sub</td><td>알림, 캠페인, 마케팅 자동화 트리거 처리</td><td>실시간성, 개인화, 운영 자동화</td><td>AWS SNS/SQS, Firebase, Webhook</td></tr><tr><td><strong>스마트 시티</strong></td><td>환경/교통 데이터 수집</td><td>EDA + CEP</td><td>실시간 센서/트래픽 이벤트 분석 및 정책 트리거</td><td>정책 대응 속도 향상, 비상 상황 탐지</td><td>Kafka, Apache Flink, Complex Event Processing</td></tr><tr><td><strong>엔터프라이즈</strong></td><td>마이크로서비스 간 통신</td><td>MDA + EDA 혼합형</td><td>비즈니스 프로세스 → 메시지 처리 / 상태 변화 → 이벤트 반응</td><td>유연한 통합, 독립 배포, 확장성 확보</td><td>Kafka + RabbitMQ, Outbox Pattern</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-온라인-쇼핑몰의-주문-처리-시스템>사례 1: 온라인 쇼핑몰의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-온라인-쇼핑몰의-주문-처리-시스템>#</a></h4><p><strong>아키텍처 적용 방식:</strong></p><ul><li>주문 등록 → 결제 승인 → 재고 차감 → 배송 예약 과정을 각각 분리된 서비스로 구성</li><li>각 단계는 메시지 기반 (MDA) 으로 연결, 이벤트 발생 시 각 서비스는 이벤트를 수신하여 동작</li></ul><p><strong>시스템 구성</strong></p><pre class=mermaid>graph TD
A[Order Service] --&gt;|Message| B[Payment Service]
B --&gt;|Message| C[Inventory Service]
C --&gt;|Message| D[Delivery Service]
D --&gt;|Event| E[Notification Service]
</pre><p><strong>Workflow 설명:</strong></p><ol><li>사용자가 주문을 생성하면 메시지가 <strong>결제 서비스</strong>로 전달됨.</li><li>결제 완료 후 재고 차감 요청 메시지 전송.</li><li>재고 확인 후 배송 예약 요청.</li><li>최종 배송 등록 이벤트 발생 → <strong>이벤트 기반 (Notification)</strong> 으로 사용자 알림.</li></ol><p><strong>Message-Driven 없을 경우 문제점:</strong></p><ul><li>상태 전이 실패 시 복구 어려움.</li><li>재시도/보장된 순서 처리 불가능.</li></ul><p><strong>Event-Driven 없이 Notification 처리 시 문제점:</strong></p><ul><li>Notification Service 가 상태를 직접 폴링하거나 상태 공유 구조 필요 → 복잡성 증가.</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 생성 → 메시지 브로커 → 결제 서비스</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 브로커 연결</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐 생성</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;payment_queue&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 전송 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_order_to_payment</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;payment_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>body</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Sent order </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> for payment.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>send_order_to_payment</span><span class=p>(</span><span class=s2>&#34;ORD-1001&#34;</span><span class=p>,</span> <span class=mi>19900</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>위 코드는 주문 생성 후 결제 서비스로 메시지를 큐에 넣는 구조. 결제 서비스는 이를 소비하여 처리하게 된다. <strong>확장성과 안정성</strong> 확보에 유리하다.</p></blockquote><h4 id=사례-2-대형-이커머스의-주문-처리-시스템>사례 2: 대형 이커머스의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-2-대형-이커머스의-주문-처리-시스템>#</a></h4><p><strong>시스템 구성</strong>: 주문 서비스 → 메시지 브로커 (RabbitMQ) → 재고 서비스, 결제 서비스</p><p><strong>아키텍처 다이어그램</strong>:</p><pre class=mermaid>sequenceDiagram
    participant User
    participant OrderService
    participant MQ as RabbitMQ
    participant InventoryService
    participant PaymentService

    User-&gt;&gt;OrderService: 주문 요청
    OrderService-&gt;&gt;MQ: 주문 메시지 발행
    MQ-&gt;&gt;InventoryService: 주문 메시지 전달
    MQ-&gt;&gt;PaymentService: 주문 메시지 전달
    InventoryService--&gt;&gt;OrderService: 재고 처리 결과(비동기)
    PaymentService--&gt;&gt;OrderService: 결제 결과(비동기)
</pre><p><strong>Workflow</strong>: 주문 발생 → 메시지 발행 → 재고/결제 서비스 각각 독립적으로 처리 및 알림</p><p><strong>역할</strong>: 동시성 보장, 이벤트/비동기 기반 병렬처리, 확장성 확보</p><p><strong>유무 차이점</strong>: 메시지 기반/이벤트 기반 아키텍처가 없을 경우 주문 폭주 상황에서 서비스 지연, 장애 확산이 잦음.</p><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 발생 시 메시지 발행과 큐 소비자 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 프로듀서: 주문 발생시 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_order_message</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>body</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 컨슈머: 주문 메시지 처리(재고 서비스)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inventory_consumer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 처리: 주문번호 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>, 데이터 </span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재고 차감 처리 코드 위치</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;재고 서비스 대기 중…&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>각 함수에 주석으로 메시지 발행/수신의 위치와 역할, 비동기 큐 소비를 명확하게 구분</p></blockquote><h4 id=사례-3-전자상거래-주문-처리-시스템>사례 3: 전자상거래 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-전자상거래-주문-처리-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li>전자상거래 플랫폼에서 Message-Driven 과 Event-Driven 아키텍처를 함께 활용한 하이브리드 접근법을 적용했다.</li></ul><pre class=mermaid>graph TB
    subgraph &#34;프론트엔드&#34;
        A[웹/모바일 앱]
    end
    
    subgraph &#34;API Gateway&#34;
        B[API Gateway]
    end
    
    subgraph &#34;Message-Driven 영역&#34;
        C[주문 서비스]
        D[결제 서비스]
        E[재고 서비스]
        F[배송 서비스]
        Q1[주문 처리 큐]
        Q2[결제 큐]
        Q3[배송 큐]
    end
    
    subgraph &#34;Event-Driven 영역&#34;
        G[이벤트 버스]
        H[알림 서비스]
        I[분석 서비스]
        J[추천 서비스]
        K[재고 추적 서비스]
        L[고객 서비스]
    end
    
    subgraph &#34;데이터 저장소&#34;
        M[(주문 DB)]
        N[(결제 DB)]
        O[(재고 DB)]
        P[(이벤트 스토어)]
    end
    
    A --&gt; B
    B --&gt; C
    C --&gt; Q1
    Q1 --&gt; D
    D --&gt; Q2
    Q2 --&gt; E
    E --&gt; Q3
    Q3 --&gt; F
    
    C --&gt; G
    D --&gt; G
    E --&gt; G
    F --&gt; G
    
    G --&gt; H
    G --&gt; I
    G --&gt; J
    G --&gt; K
    G --&gt; L
    
    C --&gt; M
    D --&gt; N
    E --&gt; O
    G --&gt; P
</pre><p><strong>Workflow</strong>:</p><ul><li><strong>Message-Driven 처리 흐름:</strong><ol><li><strong>주문 생성</strong>: 고객이 주문을 생성하면 주문 서비스가 주문 정보를 검증</li><li><strong>재고 확인</strong>: 주문 서비스가 재고 서비스에 메시지를 보내 재고 확인 요청</li><li><strong>결제 처리</strong>: 재고 확인 완료 후 결제 서비스에 결제 처리 메시지 전송</li><li><strong>배송 요청</strong>: 결제 완료 후 배송 서비스에 배송 요청 메시지 전송</li></ol></li><li><strong>Event-Driven 처리 흐름:</strong><ol><li><strong>이벤트 발행</strong>: 각 단계 완료 시 이벤트 발행 (주문 생성됨, 결제 완료됨 등)</li><li><strong>병렬 처리</strong>: 여러 서비스가 동일 이벤트를 동시 구독하여 처리</li><li><strong>실시간 반응</strong>: 알림, 분석, 추천 등이 실시간으로 동작</li></ol></li></ul><p><strong>역할</strong>:</p><ul><li><strong>Message-Driven Architecture 역할:</strong><ul><li>핵심 비즈니스 로직의 순차적 처리 보장</li><li>트랜잭션 일관성 유지</li><li>중요한 업무 프로세스의 신뢰성 확보</li></ul></li><li><strong>Event-Driven Architecture 역할:</strong><ul><li>부가 서비스들의 확장성 제공</li><li>시스템 간 느슨한 결합 달성</li><li>실시간 반응성 확보</li></ul></li></ul><p><strong>아키텍처 유무에 따른 차이점</strong>:</p><ul><li><strong>적용 전 (단순 REST API):</strong><ul><li>모든 서비스가 동기적으로 호출되어 응답 시간 증가</li><li>부가 서비스 장애가 핵심 주문 프로세스에 영향</li><li>새로운 기능 추가 시 기존 코드 수정 필요</li></ul></li><li><strong>적용 후 (하이브리드 아키텍처):</strong><ul><li>핵심 프로세스와 부가 서비스의 독립적 처리</li><li>부가 서비스 장애가 주문 프로세스에 미치는 영향 최소화</li><li>새로운 서비스 추가 시 이벤트 구독만으로 연동 가능</li><li>평균 주문 처리 시간 40% 단축, 시스템 가용성 99.9% 달성</li></ul></li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>  1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>  2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>  3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>  4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>  5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>  6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>  7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8>  8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9>  9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10> 10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11> 11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12> 12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13> 13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14> 14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15> 15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16> 16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17> 17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18> 18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19> 19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20> 20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21> 21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22> 22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23> 23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24> 24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25> 25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26> 26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27> 27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28> 28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29> 29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30> 30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31> 31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32> 32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33> 33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34> 34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35> 35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36> 36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37> 37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38> 38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39> 39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40> 40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41> 41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42> 42</a>
</span><span class=lnt id=hl-10-43><a class=lnlinks href=#hl-10-43> 43</a>
</span><span class=lnt id=hl-10-44><a class=lnlinks href=#hl-10-44> 44</a>
</span><span class=lnt id=hl-10-45><a class=lnlinks href=#hl-10-45> 45</a>
</span><span class=lnt id=hl-10-46><a class=lnlinks href=#hl-10-46> 46</a>
</span><span class=lnt id=hl-10-47><a class=lnlinks href=#hl-10-47> 47</a>
</span><span class=lnt id=hl-10-48><a class=lnlinks href=#hl-10-48> 48</a>
</span><span class=lnt id=hl-10-49><a class=lnlinks href=#hl-10-49> 49</a>
</span><span class=lnt id=hl-10-50><a class=lnlinks href=#hl-10-50> 50</a>
</span><span class=lnt id=hl-10-51><a class=lnlinks href=#hl-10-51> 51</a>
</span><span class=lnt id=hl-10-52><a class=lnlinks href=#hl-10-52> 52</a>
</span><span class=lnt id=hl-10-53><a class=lnlinks href=#hl-10-53> 53</a>
</span><span class=lnt id=hl-10-54><a class=lnlinks href=#hl-10-54> 54</a>
</span><span class=lnt id=hl-10-55><a class=lnlinks href=#hl-10-55> 55</a>
</span><span class=lnt id=hl-10-56><a class=lnlinks href=#hl-10-56> 56</a>
</span><span class=lnt id=hl-10-57><a class=lnlinks href=#hl-10-57> 57</a>
</span><span class=lnt id=hl-10-58><a class=lnlinks href=#hl-10-58> 58</a>
</span><span class=lnt id=hl-10-59><a class=lnlinks href=#hl-10-59> 59</a>
</span><span class=lnt id=hl-10-60><a class=lnlinks href=#hl-10-60> 60</a>
</span><span class=lnt id=hl-10-61><a class=lnlinks href=#hl-10-61> 61</a>
</span><span class=lnt id=hl-10-62><a class=lnlinks href=#hl-10-62> 62</a>
</span><span class=lnt id=hl-10-63><a class=lnlinks href=#hl-10-63> 63</a>
</span><span class=lnt id=hl-10-64><a class=lnlinks href=#hl-10-64> 64</a>
</span><span class=lnt id=hl-10-65><a class=lnlinks href=#hl-10-65> 65</a>
</span><span class=lnt id=hl-10-66><a class=lnlinks href=#hl-10-66> 66</a>
</span><span class=lnt id=hl-10-67><a class=lnlinks href=#hl-10-67> 67</a>
</span><span class=lnt id=hl-10-68><a class=lnlinks href=#hl-10-68> 68</a>
</span><span class=lnt id=hl-10-69><a class=lnlinks href=#hl-10-69> 69</a>
</span><span class=lnt id=hl-10-70><a class=lnlinks href=#hl-10-70> 70</a>
</span><span class=lnt id=hl-10-71><a class=lnlinks href=#hl-10-71> 71</a>
</span><span class=lnt id=hl-10-72><a class=lnlinks href=#hl-10-72> 72</a>
</span><span class=lnt id=hl-10-73><a class=lnlinks href=#hl-10-73> 73</a>
</span><span class=lnt id=hl-10-74><a class=lnlinks href=#hl-10-74> 74</a>
</span><span class=lnt id=hl-10-75><a class=lnlinks href=#hl-10-75> 75</a>
</span><span class=lnt id=hl-10-76><a class=lnlinks href=#hl-10-76> 76</a>
</span><span class=lnt id=hl-10-77><a class=lnlinks href=#hl-10-77> 77</a>
</span><span class=lnt id=hl-10-78><a class=lnlinks href=#hl-10-78> 78</a>
</span><span class=lnt id=hl-10-79><a class=lnlinks href=#hl-10-79> 79</a>
</span><span class=lnt id=hl-10-80><a class=lnlinks href=#hl-10-80> 80</a>
</span><span class=lnt id=hl-10-81><a class=lnlinks href=#hl-10-81> 81</a>
</span><span class=lnt id=hl-10-82><a class=lnlinks href=#hl-10-82> 82</a>
</span><span class=lnt id=hl-10-83><a class=lnlinks href=#hl-10-83> 83</a>
</span><span class=lnt id=hl-10-84><a class=lnlinks href=#hl-10-84> 84</a>
</span><span class=lnt id=hl-10-85><a class=lnlinks href=#hl-10-85> 85</a>
</span><span class=lnt id=hl-10-86><a class=lnlinks href=#hl-10-86> 86</a>
</span><span class=lnt id=hl-10-87><a class=lnlinks href=#hl-10-87> 87</a>
</span><span class=lnt id=hl-10-88><a class=lnlinks href=#hl-10-88> 88</a>
</span><span class=lnt id=hl-10-89><a class=lnlinks href=#hl-10-89> 89</a>
</span><span class=lnt id=hl-10-90><a class=lnlinks href=#hl-10-90> 90</a>
</span><span class=lnt id=hl-10-91><a class=lnlinks href=#hl-10-91> 91</a>
</span><span class=lnt id=hl-10-92><a class=lnlinks href=#hl-10-92> 92</a>
</span><span class=lnt id=hl-10-93><a class=lnlinks href=#hl-10-93> 93</a>
</span><span class=lnt id=hl-10-94><a class=lnlinks href=#hl-10-94> 94</a>
</span><span class=lnt id=hl-10-95><a class=lnlinks href=#hl-10-95> 95</a>
</span><span class=lnt id=hl-10-96><a class=lnlinks href=#hl-10-96> 96</a>
</span><span class=lnt id=hl-10-97><a class=lnlinks href=#hl-10-97> 97</a>
</span><span class=lnt id=hl-10-98><a class=lnlinks href=#hl-10-98> 98</a>
</span><span class=lnt id=hl-10-99><a class=lnlinks href=#hl-10-99> 99</a>
</span><span class=lnt id=hl-10-100><a class=lnlinks href=#hl-10-100>100</a>
</span><span class=lnt id=hl-10-101><a class=lnlinks href=#hl-10-101>101</a>
</span><span class=lnt id=hl-10-102><a class=lnlinks href=#hl-10-102>102</a>
</span><span class=lnt id=hl-10-103><a class=lnlinks href=#hl-10-103>103</a>
</span><span class=lnt id=hl-10-104><a class=lnlinks href=#hl-10-104>104</a>
</span><span class=lnt id=hl-10-105><a class=lnlinks href=#hl-10-105>105</a>
</span><span class=lnt id=hl-10-106><a class=lnlinks href=#hl-10-106>106</a>
</span><span class=lnt id=hl-10-107><a class=lnlinks href=#hl-10-107>107</a>
</span><span class=lnt id=hl-10-108><a class=lnlinks href=#hl-10-108>108</a>
</span><span class=lnt id=hl-10-109><a class=lnlinks href=#hl-10-109>109</a>
</span><span class=lnt id=hl-10-110><a class=lnlinks href=#hl-10-110>110</a>
</span><span class=lnt id=hl-10-111><a class=lnlinks href=#hl-10-111>111</a>
</span><span class=lnt id=hl-10-112><a class=lnlinks href=#hl-10-112>112</a>
</span><span class=lnt id=hl-10-113><a class=lnlinks href=#hl-10-113>113</a>
</span><span class=lnt id=hl-10-114><a class=lnlinks href=#hl-10-114>114</a>
</span><span class=lnt id=hl-10-115><a class=lnlinks href=#hl-10-115>115</a>
</span><span class=lnt id=hl-10-116><a class=lnlinks href=#hl-10-116>116</a>
</span><span class=lnt id=hl-10-117><a class=lnlinks href=#hl-10-117>117</a>
</span><span class=lnt id=hl-10-118><a class=lnlinks href=#hl-10-118>118</a>
</span><span class=lnt id=hl-10-119><a class=lnlinks href=#hl-10-119>119</a>
</span><span class=lnt id=hl-10-120><a class=lnlinks href=#hl-10-120>120</a>
</span><span class=lnt id=hl-10-121><a class=lnlinks href=#hl-10-121>121</a>
</span><span class=lnt id=hl-10-122><a class=lnlinks href=#hl-10-122>122</a>
</span><span class=lnt id=hl-10-123><a class=lnlinks href=#hl-10-123>123</a>
</span><span class=lnt id=hl-10-124><a class=lnlinks href=#hl-10-124>124</a>
</span><span class=lnt id=hl-10-125><a class=lnlinks href=#hl-10-125>125</a>
</span><span class=lnt id=hl-10-126><a class=lnlinks href=#hl-10-126>126</a>
</span><span class=lnt id=hl-10-127><a class=lnlinks href=#hl-10-127>127</a>
</span><span class=lnt id=hl-10-128><a class=lnlinks href=#hl-10-128>128</a>
</span><span class=lnt id=hl-10-129><a class=lnlinks href=#hl-10-129>129</a>
</span><span class=lnt id=hl-10-130><a class=lnlinks href=#hl-10-130>130</a>
</span><span class=lnt id=hl-10-131><a class=lnlinks href=#hl-10-131>131</a>
</span><span class=lnt id=hl-10-132><a class=lnlinks href=#hl-10-132>132</a>
</span><span class=lnt id=hl-10-133><a class=lnlinks href=#hl-10-133>133</a>
</span><span class=lnt id=hl-10-134><a class=lnlinks href=#hl-10-134>134</a>
</span><span class=lnt id=hl-10-135><a class=lnlinks href=#hl-10-135>135</a>
</span><span class=lnt id=hl-10-136><a class=lnlinks href=#hl-10-136>136</a>
</span><span class=lnt id=hl-10-137><a class=lnlinks href=#hl-10-137>137</a>
</span><span class=lnt id=hl-10-138><a class=lnlinks href=#hl-10-138>138</a>
</span><span class=lnt id=hl-10-139><a class=lnlinks href=#hl-10-139>139</a>
</span><span class=lnt id=hl-10-140><a class=lnlinks href=#hl-10-140>140</a>
</span><span class=lnt id=hl-10-141><a class=lnlinks href=#hl-10-141>141</a>
</span><span class=lnt id=hl-10-142><a class=lnlinks href=#hl-10-142>142</a>
</span><span class=lnt id=hl-10-143><a class=lnlinks href=#hl-10-143>143</a>
</span><span class=lnt id=hl-10-144><a class=lnlinks href=#hl-10-144>144</a>
</span><span class=lnt id=hl-10-145><a class=lnlinks href=#hl-10-145>145</a>
</span><span class=lnt id=hl-10-146><a class=lnlinks href=#hl-10-146>146</a>
</span><span class=lnt id=hl-10-147><a class=lnlinks href=#hl-10-147>147</a>
</span><span class=lnt id=hl-10-148><a class=lnlinks href=#hl-10-148>148</a>
</span><span class=lnt id=hl-10-149><a class=lnlinks href=#hl-10-149>149</a>
</span><span class=lnt id=hl-10-150><a class=lnlinks href=#hl-10-150>150</a>
</span><span class=lnt id=hl-10-151><a class=lnlinks href=#hl-10-151>151</a>
</span><span class=lnt id=hl-10-152><a class=lnlinks href=#hl-10-152>152</a>
</span><span class=lnt id=hl-10-153><a class=lnlinks href=#hl-10-153>153</a>
</span><span class=lnt id=hl-10-154><a class=lnlinks href=#hl-10-154>154</a>
</span><span class=lnt id=hl-10-155><a class=lnlinks href=#hl-10-155>155</a>
</span><span class=lnt id=hl-10-156><a class=lnlinks href=#hl-10-156>156</a>
</span><span class=lnt id=hl-10-157><a class=lnlinks href=#hl-10-157>157</a>
</span><span class=lnt id=hl-10-158><a class=lnlinks href=#hl-10-158>158</a>
</span><span class=lnt id=hl-10-159><a class=lnlinks href=#hl-10-159>159</a>
</span><span class=lnt id=hl-10-160><a class=lnlinks href=#hl-10-160>160</a>
</span><span class=lnt id=hl-10-161><a class=lnlinks href=#hl-10-161>161</a>
</span><span class=lnt id=hl-10-162><a class=lnlinks href=#hl-10-162>162</a>
</span><span class=lnt id=hl-10-163><a class=lnlinks href=#hl-10-163>163</a>
</span><span class=lnt id=hl-10-164><a class=lnlinks href=#hl-10-164>164</a>
</span><span class=lnt id=hl-10-165><a class=lnlinks href=#hl-10-165>165</a>
</span><span class=lnt id=hl-10-166><a class=lnlinks href=#hl-10-166>166</a>
</span><span class=lnt id=hl-10-167><a class=lnlinks href=#hl-10-167>167</a>
</span><span class=lnt id=hl-10-168><a class=lnlinks href=#hl-10-168>168</a>
</span><span class=lnt id=hl-10-169><a class=lnlinks href=#hl-10-169>169</a>
</span><span class=lnt id=hl-10-170><a class=lnlinks href=#hl-10-170>170</a>
</span><span class=lnt id=hl-10-171><a class=lnlinks href=#hl-10-171>171</a>
</span><span class=lnt id=hl-10-172><a class=lnlinks href=#hl-10-172>172</a>
</span><span class=lnt id=hl-10-173><a class=lnlinks href=#hl-10-173>173</a>
</span><span class=lnt id=hl-10-174><a class=lnlinks href=#hl-10-174>174</a>
</span><span class=lnt id=hl-10-175><a class=lnlinks href=#hl-10-175>175</a>
</span><span class=lnt id=hl-10-176><a class=lnlinks href=#hl-10-176>176</a>
</span><span class=lnt id=hl-10-177><a class=lnlinks href=#hl-10-177>177</a>
</span><span class=lnt id=hl-10-178><a class=lnlinks href=#hl-10-178>178</a>
</span><span class=lnt id=hl-10-179><a class=lnlinks href=#hl-10-179>179</a>
</span><span class=lnt id=hl-10-180><a class=lnlinks href=#hl-10-180>180</a>
</span><span class=lnt id=hl-10-181><a class=lnlinks href=#hl-10-181>181</a>
</span><span class=lnt id=hl-10-182><a class=lnlinks href=#hl-10-182>182</a>
</span><span class=lnt id=hl-10-183><a class=lnlinks href=#hl-10-183>183</a>
</span><span class=lnt id=hl-10-184><a class=lnlinks href=#hl-10-184>184</a>
</span><span class=lnt id=hl-10-185><a class=lnlinks href=#hl-10-185>185</a>
</span><span class=lnt id=hl-10-186><a class=lnlinks href=#hl-10-186>186</a>
</span><span class=lnt id=hl-10-187><a class=lnlinks href=#hl-10-187>187</a>
</span><span class=lnt id=hl-10-188><a class=lnlinks href=#hl-10-188>188</a>
</span><span class=lnt id=hl-10-189><a class=lnlinks href=#hl-10-189>189</a>
</span><span class=lnt id=hl-10-190><a class=lnlinks href=#hl-10-190>190</a>
</span><span class=lnt id=hl-10-191><a class=lnlinks href=#hl-10-191>191</a>
</span><span class=lnt id=hl-10-192><a class=lnlinks href=#hl-10-192>192</a>
</span><span class=lnt id=hl-10-193><a class=lnlinks href=#hl-10-193>193</a>
</span><span class=lnt id=hl-10-194><a class=lnlinks href=#hl-10-194>194</a>
</span><span class=lnt id=hl-10-195><a class=lnlinks href=#hl-10-195>195</a>
</span><span class=lnt id=hl-10-196><a class=lnlinks href=#hl-10-196>196</a>
</span><span class=lnt id=hl-10-197><a class=lnlinks href=#hl-10-197>197</a>
</span><span class=lnt id=hl-10-198><a class=lnlinks href=#hl-10-198>198</a>
</span><span class=lnt id=hl-10-199><a class=lnlinks href=#hl-10-199>199</a>
</span><span class=lnt id=hl-10-200><a class=lnlinks href=#hl-10-200>200</a>
</span><span class=lnt id=hl-10-201><a class=lnlinks href=#hl-10-201>201</a>
</span><span class=lnt id=hl-10-202><a class=lnlinks href=#hl-10-202>202</a>
</span><span class=lnt id=hl-10-203><a class=lnlinks href=#hl-10-203>203</a>
</span><span class=lnt id=hl-10-204><a class=lnlinks href=#hl-10-204>204</a>
</span><span class=lnt id=hl-10-205><a class=lnlinks href=#hl-10-205>205</a>
</span><span class=lnt id=hl-10-206><a class=lnlinks href=#hl-10-206>206</a>
</span><span class=lnt id=hl-10-207><a class=lnlinks href=#hl-10-207>207</a>
</span><span class=lnt id=hl-10-208><a class=lnlinks href=#hl-10-208>208</a>
</span><span class=lnt id=hl-10-209><a class=lnlinks href=#hl-10-209>209</a>
</span><span class=lnt id=hl-10-210><a class=lnlinks href=#hl-10-210>210</a>
</span><span class=lnt id=hl-10-211><a class=lnlinks href=#hl-10-211>211</a>
</span><span class=lnt id=hl-10-212><a class=lnlinks href=#hl-10-212>212</a>
</span><span class=lnt id=hl-10-213><a class=lnlinks href=#hl-10-213>213</a>
</span><span class=lnt id=hl-10-214><a class=lnlinks href=#hl-10-214>214</a>
</span><span class=lnt id=hl-10-215><a class=lnlinks href=#hl-10-215>215</a>
</span><span class=lnt id=hl-10-216><a class=lnlinks href=#hl-10-216>216</a>
</span><span class=lnt id=hl-10-217><a class=lnlinks href=#hl-10-217>217</a>
</span><span class=lnt id=hl-10-218><a class=lnlinks href=#hl-10-218>218</a>
</span><span class=lnt id=hl-10-219><a class=lnlinks href=#hl-10-219>219</a>
</span><span class=lnt id=hl-10-220><a class=lnlinks href=#hl-10-220>220</a>
</span><span class=lnt id=hl-10-221><a class=lnlinks href=#hl-10-221>221</a>
</span><span class=lnt id=hl-10-222><a class=lnlinks href=#hl-10-222>222</a>
</span><span class=lnt id=hl-10-223><a class=lnlinks href=#hl-10-223>223</a>
</span><span class=lnt id=hl-10-224><a class=lnlinks href=#hl-10-224>224</a>
</span><span class=lnt id=hl-10-225><a class=lnlinks href=#hl-10-225>225</a>
</span><span class=lnt id=hl-10-226><a class=lnlinks href=#hl-10-226>226</a>
</span><span class=lnt id=hl-10-227><a class=lnlinks href=#hl-10-227>227</a>
</span><span class=lnt id=hl-10-228><a class=lnlinks href=#hl-10-228>228</a>
</span><span class=lnt id=hl-10-229><a class=lnlinks href=#hl-10-229>229</a>
</span><span class=lnt id=hl-10-230><a class=lnlinks href=#hl-10-230>230</a>
</span><span class=lnt id=hl-10-231><a class=lnlinks href=#hl-10-231>231</a>
</span><span class=lnt id=hl-10-232><a class=lnlinks href=#hl-10-232>232</a>
</span><span class=lnt id=hl-10-233><a class=lnlinks href=#hl-10-233>233</a>
</span><span class=lnt id=hl-10-234><a class=lnlinks href=#hl-10-234>234</a>
</span><span class=lnt id=hl-10-235><a class=lnlinks href=#hl-10-235>235</a>
</span><span class=lnt id=hl-10-236><a class=lnlinks href=#hl-10-236>236</a>
</span><span class=lnt id=hl-10-237><a class=lnlinks href=#hl-10-237>237</a>
</span><span class=lnt id=hl-10-238><a class=lnlinks href=#hl-10-238>238</a>
</span><span class=lnt id=hl-10-239><a class=lnlinks href=#hl-10-239>239</a>
</span><span class=lnt id=hl-10-240><a class=lnlinks href=#hl-10-240>240</a>
</span><span class=lnt id=hl-10-241><a class=lnlinks href=#hl-10-241>241</a>
</span><span class=lnt id=hl-10-242><a class=lnlinks href=#hl-10-242>242</a>
</span><span class=lnt id=hl-10-243><a class=lnlinks href=#hl-10-243>243</a>
</span><span class=lnt id=hl-10-244><a class=lnlinks href=#hl-10-244>244</a>
</span><span class=lnt id=hl-10-245><a class=lnlinks href=#hl-10-245>245</a>
</span><span class=lnt id=hl-10-246><a class=lnlinks href=#hl-10-246>246</a>
</span><span class=lnt id=hl-10-247><a class=lnlinks href=#hl-10-247>247</a>
</span><span class=lnt id=hl-10-248><a class=lnlinks href=#hl-10-248>248</a>
</span><span class=lnt id=hl-10-249><a class=lnlinks href=#hl-10-249>249</a>
</span><span class=lnt id=hl-10-250><a class=lnlinks href=#hl-10-250>250</a>
</span><span class=lnt id=hl-10-251><a class=lnlinks href=#hl-10-251>251</a>
</span><span class=lnt id=hl-10-252><a class=lnlinks href=#hl-10-252>252</a>
</span><span class=lnt id=hl-10-253><a class=lnlinks href=#hl-10-253>253</a>
</span><span class=lnt id=hl-10-254><a class=lnlinks href=#hl-10-254>254</a>
</span><span class=lnt id=hl-10-255><a class=lnlinks href=#hl-10-255>255</a>
</span><span class=lnt id=hl-10-256><a class=lnlinks href=#hl-10-256>256</a>
</span><span class=lnt id=hl-10-257><a class=lnlinks href=#hl-10-257>257</a>
</span><span class=lnt id=hl-10-258><a class=lnlinks href=#hl-10-258>258</a>
</span><span class=lnt id=hl-10-259><a class=lnlinks href=#hl-10-259>259</a>
</span><span class=lnt id=hl-10-260><a class=lnlinks href=#hl-10-260>260</a>
</span><span class=lnt id=hl-10-261><a class=lnlinks href=#hl-10-261>261</a>
</span><span class=lnt id=hl-10-262><a class=lnlinks href=#hl-10-262>262</a>
</span><span class=lnt id=hl-10-263><a class=lnlinks href=#hl-10-263>263</a>
</span><span class=lnt id=hl-10-264><a class=lnlinks href=#hl-10-264>264</a>
</span><span class=lnt id=hl-10-265><a class=lnlinks href=#hl-10-265>265</a>
</span><span class=lnt id=hl-10-266><a class=lnlinks href=#hl-10-266>266</a>
</span><span class=lnt id=hl-10-267><a class=lnlinks href=#hl-10-267>267</a>
</span><span class=lnt id=hl-10-268><a class=lnlinks href=#hl-10-268>268</a>
</span><span class=lnt id=hl-10-269><a class=lnlinks href=#hl-10-269>269</a>
</span><span class=lnt id=hl-10-270><a class=lnlinks href=#hl-10-270>270</a>
</span><span class=lnt id=hl-10-271><a class=lnlinks href=#hl-10-271>271</a>
</span><span class=lnt id=hl-10-272><a class=lnlinks href=#hl-10-272>272</a>
</span><span class=lnt id=hl-10-273><a class=lnlinks href=#hl-10-273>273</a>
</span><span class=lnt id=hl-10-274><a class=lnlinks href=#hl-10-274>274</a>
</span><span class=lnt id=hl-10-275><a class=lnlinks href=#hl-10-275>275</a>
</span><span class=lnt id=hl-10-276><a class=lnlinks href=#hl-10-276>276</a>
</span><span class=lnt id=hl-10-277><a class=lnlinks href=#hl-10-277>277</a>
</span><span class=lnt id=hl-10-278><a class=lnlinks href=#hl-10-278>278</a>
</span><span class=lnt id=hl-10-279><a class=lnlinks href=#hl-10-279>279</a>
</span><span class=lnt id=hl-10-280><a class=lnlinks href=#hl-10-280>280</a>
</span><span class=lnt id=hl-10-281><a class=lnlinks href=#hl-10-281>281</a>
</span><span class=lnt id=hl-10-282><a class=lnlinks href=#hl-10-282>282</a>
</span><span class=lnt id=hl-10-283><a class=lnlinks href=#hl-10-283>283</a>
</span><span class=lnt id=hl-10-284><a class=lnlinks href=#hl-10-284>284</a>
</span><span class=lnt id=hl-10-285><a class=lnlinks href=#hl-10-285>285</a>
</span><span class=lnt id=hl-10-286><a class=lnlinks href=#hl-10-286>286</a>
</span><span class=lnt id=hl-10-287><a class=lnlinks href=#hl-10-287>287</a>
</span><span class=lnt id=hl-10-288><a class=lnlinks href=#hl-10-288>288</a>
</span><span class=lnt id=hl-10-289><a class=lnlinks href=#hl-10-289>289</a>
</span><span class=lnt id=hl-10-290><a class=lnlinks href=#hl-10-290>290</a>
</span><span class=lnt id=hl-10-291><a class=lnlinks href=#hl-10-291>291</a>
</span><span class=lnt id=hl-10-292><a class=lnlinks href=#hl-10-292>292</a>
</span><span class=lnt id=hl-10-293><a class=lnlinks href=#hl-10-293>293</a>
</span><span class=lnt id=hl-10-294><a class=lnlinks href=#hl-10-294>294</a>
</span><span class=lnt id=hl-10-295><a class=lnlinks href=#hl-10-295>295</a>
</span><span class=lnt id=hl-10-296><a class=lnlinks href=#hl-10-296>296</a>
</span><span class=lnt id=hl-10-297><a class=lnlinks href=#hl-10-297>297</a>
</span><span class=lnt id=hl-10-298><a class=lnlinks href=#hl-10-298>298</a>
</span><span class=lnt id=hl-10-299><a class=lnlinks href=#hl-10-299>299</a>
</span><span class=lnt id=hl-10-300><a class=lnlinks href=#hl-10-300>300</a>
</span><span class=lnt id=hl-10-301><a class=lnlinks href=#hl-10-301>301</a>
</span><span class=lnt id=hl-10-302><a class=lnlinks href=#hl-10-302>302</a>
</span><span class=lnt id=hl-10-303><a class=lnlinks href=#hl-10-303>303</a>
</span><span class=lnt id=hl-10-304><a class=lnlinks href=#hl-10-304>304</a>
</span><span class=lnt id=hl-10-305><a class=lnlinks href=#hl-10-305>305</a>
</span><span class=lnt id=hl-10-306><a class=lnlinks href=#hl-10-306>306</a>
</span><span class=lnt id=hl-10-307><a class=lnlinks href=#hl-10-307>307</a>
</span><span class=lnt id=hl-10-308><a class=lnlinks href=#hl-10-308>308</a>
</span><span class=lnt id=hl-10-309><a class=lnlinks href=#hl-10-309>309</a>
</span><span class=lnt id=hl-10-310><a class=lnlinks href=#hl-10-310>310</a>
</span><span class=lnt id=hl-10-311><a class=lnlinks href=#hl-10-311>311</a>
</span><span class=lnt id=hl-10-312><a class=lnlinks href=#hl-10-312>312</a>
</span><span class=lnt id=hl-10-313><a class=lnlinks href=#hl-10-313>313</a>
</span><span class=lnt id=hl-10-314><a class=lnlinks href=#hl-10-314>314</a>
</span><span class=lnt id=hl-10-315><a class=lnlinks href=#hl-10-315>315</a>
</span><span class=lnt id=hl-10-316><a class=lnlinks href=#hl-10-316>316</a>
</span><span class=lnt id=hl-10-317><a class=lnlinks href=#hl-10-317>317</a>
</span><span class=lnt id=hl-10-318><a class=lnlinks href=#hl-10-318>318</a>
</span><span class=lnt id=hl-10-319><a class=lnlinks href=#hl-10-319>319</a>
</span><span class=lnt id=hl-10-320><a class=lnlinks href=#hl-10-320>320</a>
</span><span class=lnt id=hl-10-321><a class=lnlinks href=#hl-10-321>321</a>
</span><span class=lnt id=hl-10-322><a class=lnlinks href=#hl-10-322>322</a>
</span><span class=lnt id=hl-10-323><a class=lnlinks href=#hl-10-323>323</a>
</span><span class=lnt id=hl-10-324><a class=lnlinks href=#hl-10-324>324</a>
</span><span class=lnt id=hl-10-325><a class=lnlinks href=#hl-10-325>325</a>
</span><span class=lnt id=hl-10-326><a class=lnlinks href=#hl-10-326>326</a>
</span><span class=lnt id=hl-10-327><a class=lnlinks href=#hl-10-327>327</a>
</span><span class=lnt id=hl-10-328><a class=lnlinks href=#hl-10-328>328</a>
</span><span class=lnt id=hl-10-329><a class=lnlinks href=#hl-10-329>329</a>
</span><span class=lnt id=hl-10-330><a class=lnlinks href=#hl-10-330>330</a>
</span><span class=lnt id=hl-10-331><a class=lnlinks href=#hl-10-331>331</a>
</span><span class=lnt id=hl-10-332><a class=lnlinks href=#hl-10-332>332</a>
</span><span class=lnt id=hl-10-333><a class=lnlinks href=#hl-10-333>333</a>
</span><span class=lnt id=hl-10-334><a class=lnlinks href=#hl-10-334>334</a>
</span><span class=lnt id=hl-10-335><a class=lnlinks href=#hl-10-335>335</a>
</span><span class=lnt id=hl-10-336><a class=lnlinks href=#hl-10-336>336</a>
</span><span class=lnt id=hl-10-337><a class=lnlinks href=#hl-10-337>337</a>
</span><span class=lnt id=hl-10-338><a class=lnlinks href=#hl-10-338>338</a>
</span><span class=lnt id=hl-10-339><a class=lnlinks href=#hl-10-339>339</a>
</span><span class=lnt id=hl-10-340><a class=lnlinks href=#hl-10-340>340</a>
</span><span class=lnt id=hl-10-341><a class=lnlinks href=#hl-10-341>341</a>
</span><span class=lnt id=hl-10-342><a class=lnlinks href=#hl-10-342>342</a>
</span><span class=lnt id=hl-10-343><a class=lnlinks href=#hl-10-343>343</a>
</span><span class=lnt id=hl-10-344><a class=lnlinks href=#hl-10-344>344</a>
</span><span class=lnt id=hl-10-345><a class=lnlinks href=#hl-10-345>345</a>
</span><span class=lnt id=hl-10-346><a class=lnlinks href=#hl-10-346>346</a>
</span><span class=lnt id=hl-10-347><a class=lnlinks href=#hl-10-347>347</a>
</span><span class=lnt id=hl-10-348><a class=lnlinks href=#hl-10-348>348</a>
</span><span class=lnt id=hl-10-349><a class=lnlinks href=#hl-10-349>349</a>
</span><span class=lnt id=hl-10-350><a class=lnlinks href=#hl-10-350>350</a>
</span><span class=lnt id=hl-10-351><a class=lnlinks href=#hl-10-351>351</a>
</span><span class=lnt id=hl-10-352><a class=lnlinks href=#hl-10-352>352</a>
</span><span class=lnt id=hl-10-353><a class=lnlinks href=#hl-10-353>353</a>
</span><span class=lnt id=hl-10-354><a class=lnlinks href=#hl-10-354>354</a>
</span><span class=lnt id=hl-10-355><a class=lnlinks href=#hl-10-355>355</a>
</span><span class=lnt id=hl-10-356><a class=lnlinks href=#hl-10-356>356</a>
</span><span class=lnt id=hl-10-357><a class=lnlinks href=#hl-10-357>357</a>
</span><span class=lnt id=hl-10-358><a class=lnlinks href=#hl-10-358>358</a>
</span><span class=lnt id=hl-10-359><a class=lnlinks href=#hl-10-359>359</a>
</span><span class=lnt id=hl-10-360><a class=lnlinks href=#hl-10-360>360</a>
</span><span class=lnt id=hl-10-361><a class=lnlinks href=#hl-10-361>361</a>
</span><span class=lnt id=hl-10-362><a class=lnlinks href=#hl-10-362>362</a>
</span><span class=lnt id=hl-10-363><a class=lnlinks href=#hl-10-363>363</a>
</span><span class=lnt id=hl-10-364><a class=lnlinks href=#hl-10-364>364</a>
</span><span class=lnt id=hl-10-365><a class=lnlinks href=#hl-10-365>365</a>
</span><span class=lnt id=hl-10-366><a class=lnlinks href=#hl-10-366>366</a>
</span><span class=lnt id=hl-10-367><a class=lnlinks href=#hl-10-367>367</a>
</span><span class=lnt id=hl-10-368><a class=lnlinks href=#hl-10-368>368</a>
</span><span class=lnt id=hl-10-369><a class=lnlinks href=#hl-10-369>369</a>
</span><span class=lnt id=hl-10-370><a class=lnlinks href=#hl-10-370>370</a>
</span><span class=lnt id=hl-10-371><a class=lnlinks href=#hl-10-371>371</a>
</span><span class=lnt id=hl-10-372><a class=lnlinks href=#hl-10-372>372</a>
</span><span class=lnt id=hl-10-373><a class=lnlinks href=#hl-10-373>373</a>
</span><span class=lnt id=hl-10-374><a class=lnlinks href=#hl-10-374>374</a>
</span><span class=lnt id=hl-10-375><a class=lnlinks href=#hl-10-375>375</a>
</span><span class=lnt id=hl-10-376><a class=lnlinks href=#hl-10-376>376</a>
</span><span class=lnt id=hl-10-377><a class=lnlinks href=#hl-10-377>377</a>
</span><span class=lnt id=hl-10-378><a class=lnlinks href=#hl-10-378>378</a>
</span><span class=lnt id=hl-10-379><a class=lnlinks href=#hl-10-379>379</a>
</span><span class=lnt id=hl-10-380><a class=lnlinks href=#hl-10-380>380</a>
</span><span class=lnt id=hl-10-381><a class=lnlinks href=#hl-10-381>381</a>
</span><span class=lnt id=hl-10-382><a class=lnlinks href=#hl-10-382>382</a>
</span><span class=lnt id=hl-10-383><a class=lnlinks href=#hl-10-383>383</a>
</span><span class=lnt id=hl-10-384><a class=lnlinks href=#hl-10-384>384</a>
</span><span class=lnt id=hl-10-385><a class=lnlinks href=#hl-10-385>385</a>
</span><span class=lnt id=hl-10-386><a class=lnlinks href=#hl-10-386>386</a>
</span><span class=lnt id=hl-10-387><a class=lnlinks href=#hl-10-387>387</a>
</span><span class=lnt id=hl-10-388><a class=lnlinks href=#hl-10-388>388</a>
</span><span class=lnt id=hl-10-389><a class=lnlinks href=#hl-10-389>389</a>
</span><span class=lnt id=hl-10-390><a class=lnlinks href=#hl-10-390>390</a>
</span><span class=lnt id=hl-10-391><a class=lnlinks href=#hl-10-391>391</a>
</span><span class=lnt id=hl-10-392><a class=lnlinks href=#hl-10-392>392</a>
</span><span class=lnt id=hl-10-393><a class=lnlinks href=#hl-10-393>393</a>
</span><span class=lnt id=hl-10-394><a class=lnlinks href=#hl-10-394>394</a>
</span><span class=lnt id=hl-10-395><a class=lnlinks href=#hl-10-395>395</a>
</span><span class=lnt id=hl-10-396><a class=lnlinks href=#hl-10-396>396</a>
</span><span class=lnt id=hl-10-397><a class=lnlinks href=#hl-10-397>397</a>
</span><span class=lnt id=hl-10-398><a class=lnlinks href=#hl-10-398>398</a>
</span><span class=lnt id=hl-10-399><a class=lnlinks href=#hl-10-399>399</a>
</span><span class=lnt id=hl-10-400><a class=lnlinks href=#hl-10-400>400</a>
</span><span class=lnt id=hl-10-401><a class=lnlinks href=#hl-10-401>401</a>
</span><span class=lnt id=hl-10-402><a class=lnlinks href=#hl-10-402>402</a>
</span><span class=lnt id=hl-10-403><a class=lnlinks href=#hl-10-403>403</a>
</span><span class=lnt id=hl-10-404><a class=lnlinks href=#hl-10-404>404</a>
</span><span class=lnt id=hl-10-405><a class=lnlinks href=#hl-10-405>405</a>
</span><span class=lnt id=hl-10-406><a class=lnlinks href=#hl-10-406>406</a>
</span><span class=lnt id=hl-10-407><a class=lnlinks href=#hl-10-407>407</a>
</span><span class=lnt id=hl-10-408><a class=lnlinks href=#hl-10-408>408</a>
</span><span class=lnt id=hl-10-409><a class=lnlinks href=#hl-10-409>409</a>
</span><span class=lnt id=hl-10-410><a class=lnlinks href=#hl-10-410>410</a>
</span><span class=lnt id=hl-10-411><a class=lnlinks href=#hl-10-411>411</a>
</span><span class=lnt id=hl-10-412><a class=lnlinks href=#hl-10-412>412</a>
</span><span class=lnt id=hl-10-413><a class=lnlinks href=#hl-10-413>413</a>
</span><span class=lnt id=hl-10-414><a class=lnlinks href=#hl-10-414>414</a>
</span><span class=lnt id=hl-10-415><a class=lnlinks href=#hl-10-415>415</a>
</span><span class=lnt id=hl-10-416><a class=lnlinks href=#hl-10-416>416</a>
</span><span class=lnt id=hl-10-417><a class=lnlinks href=#hl-10-417>417</a>
</span><span class=lnt id=hl-10-418><a class=lnlinks href=#hl-10-418>418</a>
</span><span class=lnt id=hl-10-419><a class=lnlinks href=#hl-10-419>419</a>
</span><span class=lnt id=hl-10-420><a class=lnlinks href=#hl-10-420>420</a>
</span><span class=lnt id=hl-10-421><a class=lnlinks href=#hl-10-421>421</a>
</span><span class=lnt id=hl-10-422><a class=lnlinks href=#hl-10-422>422</a>
</span><span class=lnt id=hl-10-423><a class=lnlinks href=#hl-10-423>423</a>
</span><span class=lnt id=hl-10-424><a class=lnlinks href=#hl-10-424>424</a>
</span><span class=lnt id=hl-10-425><a class=lnlinks href=#hl-10-425>425</a>
</span><span class=lnt id=hl-10-426><a class=lnlinks href=#hl-10-426>426</a>
</span><span class=lnt id=hl-10-427><a class=lnlinks href=#hl-10-427>427</a>
</span><span class=lnt id=hl-10-428><a class=lnlinks href=#hl-10-428>428</a>
</span><span class=lnt id=hl-10-429><a class=lnlinks href=#hl-10-429>429</a>
</span><span class=lnt id=hl-10-430><a class=lnlinks href=#hl-10-430>430</a>
</span><span class=lnt id=hl-10-431><a class=lnlinks href=#hl-10-431>431</a>
</span><span class=lnt id=hl-10-432><a class=lnlinks href=#hl-10-432>432</a>
</span><span class=lnt id=hl-10-433><a class=lnlinks href=#hl-10-433>433</a>
</span><span class=lnt id=hl-10-434><a class=lnlinks href=#hl-10-434>434</a>
</span><span class=lnt id=hl-10-435><a class=lnlinks href=#hl-10-435>435</a>
</span><span class=lnt id=hl-10-436><a class=lnlinks href=#hl-10-436>436</a>
</span><span class=lnt id=hl-10-437><a class=lnlinks href=#hl-10-437>437</a>
</span><span class=lnt id=hl-10-438><a class=lnlinks href=#hl-10-438>438</a>
</span><span class=lnt id=hl-10-439><a class=lnlinks href=#hl-10-439>439</a>
</span><span class=lnt id=hl-10-440><a class=lnlinks href=#hl-10-440>440</a>
</span><span class=lnt id=hl-10-441><a class=lnlinks href=#hl-10-441>441</a>
</span><span class=lnt id=hl-10-442><a class=lnlinks href=#hl-10-442>442</a>
</span><span class=lnt id=hl-10-443><a class=lnlinks href=#hl-10-443>443</a>
</span><span class=lnt id=hl-10-444><a class=lnlinks href=#hl-10-444>444</a>
</span><span class=lnt id=hl-10-445><a class=lnlinks href=#hl-10-445>445</a>
</span><span class=lnt id=hl-10-446><a class=lnlinks href=#hl-10-446>446</a>
</span><span class=lnt id=hl-10-447><a class=lnlinks href=#hl-10-447>447</a>
</span><span class=lnt id=hl-10-448><a class=lnlinks href=#hl-10-448>448</a>
</span><span class=lnt id=hl-10-449><a class=lnlinks href=#hl-10-449>449</a>
</span><span class=lnt id=hl-10-450><a class=lnlinks href=#hl-10-450>450</a>
</span><span class=lnt id=hl-10-451><a class=lnlinks href=#hl-10-451>451</a>
</span><span class=lnt id=hl-10-452><a class=lnlinks href=#hl-10-452>452</a>
</span><span class=lnt id=hl-10-453><a class=lnlinks href=#hl-10-453>453</a>
</span><span class=lnt id=hl-10-454><a class=lnlinks href=#hl-10-454>454</a>
</span><span class=lnt id=hl-10-455><a class=lnlinks href=#hl-10-455>455</a>
</span><span class=lnt id=hl-10-456><a class=lnlinks href=#hl-10-456>456</a>
</span><span class=lnt id=hl-10-457><a class=lnlinks href=#hl-10-457>457</a>
</span><span class=lnt id=hl-10-458><a class=lnlinks href=#hl-10-458>458</a>
</span><span class=lnt id=hl-10-459><a class=lnlinks href=#hl-10-459>459</a>
</span><span class=lnt id=hl-10-460><a class=lnlinks href=#hl-10-460>460</a>
</span><span class=lnt id=hl-10-461><a class=lnlinks href=#hl-10-461>461</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>전자상거래 주문 처리 시스템
</span></span></span><span class=line><span class=cl><span class=s2>Message-Driven과 Event-Driven Architecture 하이브리드 구현
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Callable</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>asdict</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 1. 기본 데이터 모델</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderStatus</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 상태 열거형&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>PENDING</span> <span class=o>=</span> <span class=s2>&#34;pending&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>PAYMENT_PROCESSING</span> <span class=o>=</span> <span class=s2>&#34;payment_processing&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>PAID</span> <span class=o>=</span> <span class=s2>&#34;paid&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHIPPED</span> <span class=o>=</span> <span class=s2>&#34;shipped&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>DELIVERED</span> <span class=o>=</span> <span class=s2>&#34;delivered&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>CANCELLED</span> <span class=o>=</span> <span class=s2>&#34;cancelled&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 데이터 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=n>OrderStatus</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메시지 데이터 클래스 (Message-Driven Architecture용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>sender</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>receiver</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>correlation_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 데이터 클래스 (Event-Driven Architecture용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;1.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 2. Message-Driven Architecture 구현</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageQueue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    메시지 큐 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - 순차적 메시지 처리를 위한 FIFO 큐
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 지속성 및 재시도 메커니즘 제공
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Message</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>dead_letter_queue</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Message</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>send_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지를 큐에 전송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Message sent to </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>type</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>Callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;특정 메시지 타입에 대한 핸들러 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>message_type</span><span class=p>]</span> <span class=o>=</span> <span class=n>handler</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_messages</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;큐의 메시지들을 순차적으로 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>type</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>message</span><span class=o>.</span><span class=n>type</span><span class=p>](</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Message processed: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No handler for message type: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>type</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 실패한 메시지를 Dead Letter Queue로 이동</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>dead_letter_queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Message processing failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageBroker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    메시지 브로커 - 여러 큐를 관리하고 메시지 라우팅 담당
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>MessageQueue</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_queue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>MessageQueue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;새로운 메시지 큐 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>MessageQueue</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>[</span><span class=n>name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>route_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지를 지정된 큐로 라우팅&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>queue_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>queues</span><span class=p>[</span><span class=n>queue_name</span><span class=p>]</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Queue not found: </span><span class=si>{</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 3. Event-Driven Architecture 구현</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이벤트 버스 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - Publish-Subscribe 패턴으로 이벤트 배포
</span></span></span><span class=line><span class=cl><span class=s2>    - 다수의 구독자에게 동시 이벤트 전달
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>Callable</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 발행 - 모든 구독자에게 브로드캐스트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 저장 (Event Sourcing)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 구독자들에게 이벤트 전달</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>subscriber</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>type</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>tasks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>subscriber</span><span class=p>(</span><span class=n>event</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>,</span> <span class=n>return_exceptions</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Event published: </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>type</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>type</span><span class=p>,</span> <span class=p>[]))</span><span class=si>}</span><span class=s2> subscribers&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>Callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 타입에 대한 핸들러 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 4. 핵심 비즈니스 서비스 (Message-Driven)</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 서비스 - 핵심 주문 처리 로직
</span></span></span><span class=line><span class=cl><span class=s2>    Message-Driven 방식으로 순차적 처리 보장
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_broker</span><span class=p>:</span> <span class=n>MessageBroker</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>:</span> <span class=n>EventBus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span> <span class=o>=</span> <span class=n>message_broker</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Order</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>customer_id</span><span class=o>=</span><span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=o>=</span><span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>total_amount</span><span class=o>=</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span><span class=o>=</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Message-Driven: 재고 확인 메시지 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>inventory_message</span> <span class=o>=</span> <span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;check_inventory&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>items</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>sender</span><span class=o>=</span><span class=s2>&#34;order_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>receiver</span><span class=o>=</span><span class=s2>&#34;inventory_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>correlation_id</span><span class=o>=</span><span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>route_message</span><span class=p>(</span><span class=s2>&#34;inventory_queue&#34;</span><span class=p>,</span> <span class=n>inventory_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event-Driven: 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>Event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;order_created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span><span class=o>=</span><span class=n>asdict</span><span class=p>(</span><span class=n>order</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=o>=</span><span class=s2>&#34;order_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_inventory_confirmed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 확인 완료 메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>order_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Payment 서비스로 메시지 전송</span>
</span></span><span class=line><span class=cl>            <span class=n>payment_message</span> <span class=o>=</span> <span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;process_payment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span><span class=o>.</span><span class=n>total_amount</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>sender</span><span class=o>=</span><span class=s2>&#34;order_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>receiver</span><span class=o>=</span><span class=s2>&#34;payment_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>correlation_id</span><span class=o>=</span><span class=n>order_id</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>route_message</span><span class=p>(</span><span class=s2>&#34;payment_queue&#34;</span><span class=p>,</span> <span class=n>payment_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    결제 서비스 - 결제 처리 담당
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_broker</span><span class=p>:</span> <span class=n>MessageBroker</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>:</span> <span class=n>EventBus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span> <span class=o>=</span> <span class=n>message_broker</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_payment_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 처리 메시지 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>amount</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;amount&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결제 처리 로직 (시뮬레이션)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 결제 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배송 서비스로 메시지 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>shipping_message</span> <span class=o>=</span> <span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;prepare_shipping&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>sender</span><span class=o>=</span><span class=s2>&#34;payment_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>receiver</span><span class=o>=</span><span class=s2>&#34;shipping_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>correlation_id</span><span class=o>=</span><span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>route_message</span><span class=p>(</span><span class=s2>&#34;shipping_queue&#34;</span><span class=p>,</span> <span class=n>shipping_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결제 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>Event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;payment_completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=o>=</span><span class=s2>&#34;payment_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 5. 부가 서비스들 (Event-Driven)</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NotificationService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    알림 서비스 - 고객에게 실시간 알림 전송
</span></span></span><span class=line><span class=cl><span class=s2>    Event-Driven 방식으로 다양한 이벤트에 반응
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sent_notifications</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_data</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>payload</span>
</span></span><span class=line><span class=cl>        <span class=n>notification</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;order_confirmation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s2>&#34;customer_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>가 접수되었습니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sent_notifications</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>notification</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Notification sent: </span><span class=si>{</span><span class=n>notification</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_payment_completed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 완료 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>notification</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;payment_confirmation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>의 결제가 완료되었습니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sent_notifications</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>notification</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Notification sent: </span><span class=si>{</span><span class=n>notification</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AnalyticsService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    분석 서비스 - 주문 및 결제 데이터 분석
</span></span></span><span class=line><span class=cl><span class=s2>    실시간으로 비즈니스 메트릭 수집
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_orders&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_revenue&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;failed_payments&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 분석&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;total_orders&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Analytics: Total orders = </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;total_orders&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_payment_completed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 완료 분석&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>amount</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;amount&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;total_revenue&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Analytics: Total revenue = </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;total_revenue&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 6. 시스템 통합 및 실행</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ECommerceSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    전자상거래 시스템 메인 클래스
</span></span></span><span class=line><span class=cl><span class=s2>    Message-Driven과 Event-Driven 아키텍처를 통합 관리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 인프라 컴포넌트 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span> <span class=o>=</span> <span class=n>MessageBroker</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 큐 생성</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>inventory_queue</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>create_queue</span><span class=p>(</span><span class=s2>&#34;inventory_queue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment_queue</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>create_queue</span><span class=p>(</span><span class=s2>&#34;payment_queue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shipping_queue</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>create_queue</span><span class=p>(</span><span class=s2>&#34;shipping_queue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 서비스 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_service</span> <span class=o>=</span> <span class=n>OrderService</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment_service</span> <span class=o>=</span> <span class=n>PaymentService</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>notification_service</span> <span class=o>=</span> <span class=n>NotificationService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>analytics_service</span> <span class=o>=</span> <span class=n>AnalyticsService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시스템 설정 및 핸들러 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Message-Driven 핸들러 등록</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>inventory_queue</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;check_inventory&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_inventory_check</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>payment_queue</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;process_payment&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>payment_service</span><span class=o>.</span><span class=n>handle_payment_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>shipping_queue</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;prepare_shipping&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_shipping_preparation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event-Driven 구독자 등록</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;order_created&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>notification_service</span><span class=o>.</span><span class=n>handle_order_created</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;order_created&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>analytics_service</span><span class=o>.</span><span class=n>handle_order_created</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;payment_completed&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>notification_service</span><span class=o>.</span><span class=n>handle_payment_completed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;payment_completed&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>analytics_service</span><span class=o>.</span><span class=n>handle_payment_completed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_handle_inventory_check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 확인 처리 (시뮬레이션)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재고 확인 로직 (시뮬레이션)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재고 확인 완료 메시지를 주문 서비스로 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>confirmation_message</span> <span class=o>=</span> <span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;inventory_confirmed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;confirmed&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>sender</span><span class=o>=</span><span class=s2>&#34;inventory_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>receiver</span><span class=o>=</span><span class=s2>&#34;order_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>correlation_id</span><span class=o>=</span><span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 서비스의 핸들러 직접 호출 (실제로는 큐를 통해 처리)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_service</span><span class=o>.</span><span class=n>handle_inventory_confirmed</span><span class=p>(</span><span class=n>confirmation_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_handle_shipping_preparation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배송 준비 처리 (시뮬레이션)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배송 준비 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배송 준비 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>Event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;shipping_prepared&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=o>=</span><span class=s2>&#34;shipping_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_all_queues</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;모든 큐의 메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>tasks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>queue</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>queues</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>queue</span><span class=o>.</span><span class=n>process_messages</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 및 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_service</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>items</span><span class=p>,</span> <span class=n>total_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_all_queues</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시스템 메트릭 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;analytics&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>analytics_service</span><span class=o>.</span><span class=n>metrics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;notifications_sent&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>notification_service</span><span class=o>.</span><span class=n>sent_notifications</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;events_stored&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 7. 사용 예시 및 테스트</span>
</span></span><span class=line><span class=cl><span class=c1># ============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;시스템 실행 및 테스트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%(asctime)s</span><span class=s1> - </span><span class=si>%(levelname)s</span><span class=s1> - </span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 시스템 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>ecommerce</span> <span class=o>=</span> <span class=n>ECommerceSystem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>ecommerce</span><span class=o>.</span><span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 전자상거래 시스템 시작 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 테스트 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>test_items</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;P001&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;노트북&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>1500000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;P002&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;마우스&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>50000</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 첫 번째 주문</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>--- 첫 번째 주문 처리 ---&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order1</span> <span class=o>=</span> <span class=k>await</span> <span class=n>ecommerce</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=s2>&#34;CUST001&#34;</span><span class=p>,</span> <span class=n>test_items</span><span class=p>,</span> <span class=mi>1600000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 생성됨: </span><span class=si>{</span><span class=n>order1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 두 번째 주문</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>--- 두 번째 주문 처리 ---&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order2</span> <span class=o>=</span> <span class=k>await</span> <span class=n>ecommerce</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=s2>&#34;CUST002&#34;</span><span class=p>,</span> <span class=n>test_items</span><span class=p>[:</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1500000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 생성됨: </span><span class=si>{</span><span class=n>order2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 시스템 메트릭 출력</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>--- 시스템 메트릭 ---&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>metrics</span> <span class=o>=</span> <span class=n>ecommerce</span><span class=o>.</span><span class=n>get_metrics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;분석 데이터: </span><span class=si>{</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;analytics&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;전송된 알림 수: </span><span class=si>{</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;notifications_sent&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;저장된 이벤트 수: </span><span class=si>{</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;events_stored&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 스토어 내용 출력</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>--- 이벤트 히스토리 ---&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>ecommerce</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>event_store</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>created_at</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>type</span><span class=si>}</span><span class=s2> from </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>source</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=mda-message-driven-architecture--eda-event-driven-architecture-혼합-아키텍처>MDA (Message-Driven Architecture) & EDA (Event-Driven Architecture) 혼합 아키텍처<a hidden class=anchor aria-hidden=true href=#mda-message-driven-architecture--eda-event-driven-architecture-혼합-아키텍처>#</a></h3><h4 id=mdaeda-혼합-아키텍처-도입-전략>MDA+EDA 혼합 아키텍처 도입 전략<a hidden class=anchor aria-hidden=true href=#mdaeda-혼합-아키텍처-도입-전략>#</a></h4><table><thead><tr><th>상황</th><th>이유</th></tr></thead><tbody><tr><td>명령형 워크플로우 필요</td><td>주문 → 결제 → 재고 차감 → 배송 등 명확한 순서가 존재</td></tr><tr><td>상태 변화 기반 이벤트 발생 필요</td><td>&rsquo; 결제 완료됨 &lsquo;, &rsquo; 배송 시작됨 &rsquo; 등의 이벤트 발생 필요</td></tr><tr><td>시스템 간 통합이 복잡함</td><td>일부 서비스는 명령 기반, 일부는 상태 반응 기반으로 구성됨</td></tr><tr><td>확장성과 디커플링 모두 필요</td><td>서비스 간 동기화 및 반응형 처리의 동시 구현 필요</td></tr></tbody></table><h4 id=전략적-구성-원칙>전략적 구성 원칙<a hidden class=anchor aria-hidden=true href=#전략적-구성-원칙>#</a></h4><table><thead><tr><th>전략</th><th>설명</th></tr></thead><tbody><tr><td><strong>Command = Message (MDA)</strong></td><td>명령적 흐름은 메시지 큐 기반 (e.g. 결제 요청, 배송 예약 등)</td></tr><tr><td><strong>State Change = Event (EDA)</strong></td><td>상태 변화는 이벤트로 브로드캐스트 (e.g. 배송 완료 이벤트)</td></tr><tr><td><strong>도메인 경계 기반 메시지/이벤트 분리</strong></td><td>메시지는 요청 (Command), 이벤트는 상태 (State) 변화 중심으로 설계</td></tr><tr><td><strong>비즈니스 로직은 메시지 기반</strong>, <strong>리액션은 이벤트 기반</strong></td><td>주 흐름은 메시지 처리로, 후속 작업 (알림, 분석 등) 은 이벤트 처리로 분리</td></tr><tr><td><strong>메시지 우선, 이벤트 보완 구조 적용</strong></td><td>강한 신뢰성과 제어가 필요한 영역은 메시지, 반응형은 이벤트</td></tr></tbody></table><h4 id=도입-시-아키텍처-구성>도입 시 아키텍처 구성<a hidden class=anchor aria-hidden=true href=#도입-시-아키텍처-구성>#</a></h4><pre class=mermaid>flowchart TD
    A[Order Service] --&gt;|Command| B[&#34;Message Broker (RabbitMQ)&#34;]
    B --&gt; C[Payment Service]
    C --&gt;|Event: PaymentCompleted| D[&#34;Event Bus (Kafka)&#34;]
    D --&gt; E[Shipping Service]
    D --&gt; F[Notification Service]
    D --&gt; G[Analytics Service]
</pre><ul><li><strong>Message Broker</strong>: Command 중심 워크플로우 조율</li><li><strong>Event Bus</strong>: 상태 변화 이벤트 전파</li><li><strong>결제 완료 이벤트</strong>가 여러 서비스로 전파됨 (Shipping, Notification, Analytics)</li></ul><h4 id=적용-시-고려사항>적용 시 고려사항<a hidden class=anchor aria-hidden=true href=#적용-시-고려사항>#</a></h4><table><thead><tr><th>고려항목</th><th>설명</th><th>권장 기술/패턴</th></tr></thead><tbody><tr><td>메시지/이벤트 명확한 구분</td><td>Command 는 의도 (Intent), Event 는 결과 (Result)</td><td>CQRS 패턴</td></tr><tr><td>메시지 처리 보장</td><td>중복 처리 방지, 실패 보상 등</td><td>Idempotent Consumer, DLQ</td></tr><tr><td>이벤트 흐름 추적</td><td>이벤트 경로 추적 가능해야 함</td><td>OpenTelemetry, Jaeger</td></tr><tr><td>트랜잭션 분산 처리</td><td>원자성 보장 안 되는 경우 처리 방식 명확화</td><td>Saga Pattern</td></tr><tr><td>데이터 일관성 확보</td><td>Command-Event 순서가 비동기인 경우 주의</td><td>Outbox Pattern</td></tr><tr><td>이벤트 처리 순서</td><td>순서 중요 시 파티션 키 기반 처리 필요</td><td>Kafka 파티션 사용</td></tr><tr><td>테스트 전략 수립</td><td>메시지 시뮬레이션, 이벤트 발행 모킹</td><td>Contract Test, Simulation Broker</td></tr></tbody></table><h4 id=혼합-아키텍처의-실무-적용-예시>혼합 아키텍처의 실무 적용 예시<a hidden class=anchor aria-hidden=true href=#혼합-아키텍처의-실무-적용-예시>#</a></h4><table><thead><tr><th>시스템</th><th>MDA 역할</th><th>EDA 역할</th><th>도입 효과</th></tr></thead><tbody><tr><td>주문 시스템</td><td>주문 등록, 결제 요청</td><td>결제 완료 → 배송 시작, 알림, 분석</td><td>명확한 흐름 + 반응형 서비스 분리</td></tr><tr><td>IoT 시스템</td><td>디바이스 제어 명령</td><td>센서 데이터 수신 이벤트</td><td>명령형 + 대규모 이벤트 수집</td></tr><tr><td>금융 시스템</td><td>대출 심사 요청</td><td>심사 완료 이벤트 → 상태 변경 및 통보</td><td>신뢰성 + 실시간 대응</td></tr><tr><td>교육 플랫폼</td><td>시험 시작 명령</td><td>시험 완료 → 결과 발표, 이메일 발송</td><td>명확한 트리거 + 다양한 이벤트 소비자</td></tr></tbody></table><h4 id=기술-조합-예시>기술 조합 예시<a hidden class=anchor aria-hidden=true href=#기술-조합-예시>#</a></h4><table><thead><tr><th>목적</th><th>메시지 시스템 (MDA)</th><th>이벤트 시스템 (EDA)</th></tr></thead><tbody><tr><td>명령/요청 워크플로우</td><td>RabbitMQ, AWS SQS, ActiveMQ</td><td>-</td></tr><tr><td>상태 변화 이벤트 전파</td><td>-</td><td>Apache Kafka, AWS EventBridge</td></tr><tr><td>복잡한 트랜잭션 처리</td><td>Saga Orchestrator with Message Bus</td><td>Choreography 기반 Event Flow</td></tr><tr><td>유저 인터페이스 반응성</td><td>-</td><td>WebSocket, SSE, Kafka Stream</td></tr><tr><td>이벤트 저장</td><td>-</td><td>Event Sourcing, Change Data Capture</td></tr></tbody></table><h4 id=실제-메시지--이벤트-구조-설계-예시-json-schema>실제 메시지 / 이벤트 구조 설계 예시 (JSON Schema)<a hidden class=anchor aria-hidden=true href=#실제-메시지--이벤트-구조-설계-예시-json-schema>#</a></h4><h5 id=message-driven-command-메시지-예시>Message-Driven (Command) 메시지 예시<a hidden class=anchor aria-hidden=true href=#message-driven-command-메시지-예시>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;$schema&#34;</span><span class=p>:</span> <span class=s2>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;CreateInvoiceCommand&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;command_id&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customer_id&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;number&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;issued_at&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;date-time&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;command_id&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>,</span> <span class=s2>&#34;customer_id&#34;</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>,</span> <span class=s2>&#34;issued_at&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>의도</strong>: 송신자가 수신자에게 <code>CreateInvoice</code> 작업을 <strong>명령</strong></li><li><strong>전송 대상</strong>: 특정 컨슈머 (<code>InvoiceService</code>)</li></ul><h5 id=event-driven-event-메시지-예시>Event-Driven (Event) 메시지 예시<a hidden class=anchor aria-hidden=true href=#event-driven-event-메시지-예시>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;$schema&#34;</span><span class=p>:</span> <span class=s2>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreatedEvent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;event_id&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=nt>&#34;enum&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;date-time&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;payload&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;customer_id&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;total_price&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;number&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>,</span> <span class=s2>&#34;customer_id&#34;</span><span class=p>,</span> <span class=s2>&#34;total_price&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;event_id&#34;</span><span class=p>,</span> <span class=s2>&#34;event_type&#34;</span><span class=p>,</span> <span class=s2>&#34;occurred_at&#34;</span><span class=p>,</span> <span class=s2>&#34;payload&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>의도</strong>: 주문이 생성되었다는 <strong>사실 전달</strong></li><li><strong>소비자</strong>: <code>InvoiceService</code>, <code>AnalyticsService</code>, <code>NotificationService</code> 등 <strong>다수</strong></li></ul><h4 id=mda--eda-구조-예시-코드-python--nodejs>MDA / EDA 구조 예시 코드 (Python & Node.js)<a hidden class=anchor aria-hidden=true href=#mda--eda-구조-예시-코드-python--nodejs>#</a></h4><h5 id=mda---python-rabbitmq>MDA - Python (RabbitMQ)<a hidden class=anchor aria-hidden=true href=#mda---python-rabbitmq>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># publisher.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;invoice_commands&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;command_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD-1001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;CUST-789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>120.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;issued_at&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;invoice_commands&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Message sent.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># consumer.py</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing command: </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;command_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> → Create invoice for order </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;invoice_commands&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=eda---javascript-kafka-with-nodejs>EDA - JavaScript (Kafka with Node.js)<a hidden class=anchor aria-hidden=true href=#eda---javascript-kafka-with-nodejs>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// producer.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span> <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;order-app&#39;</span><span class=p>,</span> <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>producer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>publishEvent</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>event_id</span><span class=o>:</span> <span class=s1>&#39;evt-&#39;</span> <span class=o>+</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>event_type</span><span class=o>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>occurred_at</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>order_id</span><span class=o>:</span> <span class=s1>&#39;ORD-1001&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>customer_id</span><span class=o>:</span> <span class=s1>&#39;CUST-789&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>total_price</span><span class=o>:</span> <span class=mf>99.99</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;order.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>messages</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>key</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>event_id</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Event published.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>publishEvent</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// consumer.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span> <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;invoice-service&#39;</span><span class=p>,</span> <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>consumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;invoice-consumer-group&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>run</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;order.events&#39;</span><span class=p>,</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Received event </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>event_type</span><span class=si>}</span><span class=sb> for order </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>payload</span><span class=p>.</span><span class=nx>order_id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>run</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cqrs--event-sourcing-기반-혼합-아키텍처-흐름도>CQRS + Event Sourcing 기반 혼합 아키텍처 흐름도<a hidden class=anchor aria-hidden=true href=#cqrs--event-sourcing-기반-혼합-아키텍처-흐름도>#</a></h4><pre class=mermaid>sequenceDiagram
  actor User
  participant API as API Gateway
  participant CMD as Command Handler
  participant DB as Write DB
  participant EventBus as Event Bus
  participant ReadModel as Read DB (Projection)
  participant Invoice as Invoice Service

  User -&gt;&gt; API: HTTP POST /orders
  API -&gt;&gt; CMD: CreateOrderCommand
  CMD -&gt;&gt; DB: Persist Order (Event Sourced)
  CMD --&gt;&gt; EventBus: Publish OrderCreatedEvent
  EventBus --&gt;&gt; Invoice: OrderCreatedEvent
  EventBus --&gt;&gt; ReadModel: Project OrderView

  Note over ReadModel: Eventually consistent
</pre><ol><li>사용자가 주문 생성 요청 (Command)</li><li><strong>Command Handler</strong>가 상태 변경 처리 → 이벤트 저장소에 기록</li><li><code>OrderCreatedEvent</code> 를 <strong>Event Bus</strong>에 발행</li><li><strong>InvoiceService</strong> 등은 이벤트를 기반으로 후속 작업</li><li><strong>Read Model</strong>은 Projection 하여 조회 모델을 구성 (CQRS)</li></ol><h4 id=outbox-패턴-기반-mda--eda-브리지-구현>Outbox 패턴 기반 MDA ↔ EDA 브리지 구현<a hidden class=anchor aria-hidden=true href=#outbox-패턴-기반-mda--eda-브리지-구현>#</a></h4><p>Outbox 패턴은 <strong>트랜잭션 경계 내에서 메시지 저장</strong> → 이후 메시지를 브로커에 발행하는 전략으로, <strong>MDA 의 안정성과 EDA 의 반응성을 연결</strong>하는 주요 패턴이다.</p><h5 id=아키텍처-흐름-개요>아키텍처 흐름 개요<a hidden class=anchor aria-hidden=true href=#아키텍처-흐름-개요>#</a></h5><pre class=mermaid>flowchart TD
  A[Service A: Command Handler] --&gt;|DB 트랜잭션| B[(Order Table + Outbox Table)]
  B --&gt; C[&#34;Outbox Poller (CDC or Cron)&#34;]
  C --&gt; D[Event Publisher]
  D --&gt; E[Kafka/EventBridge]
  E --&gt; F[&#34;Consumer Services (Invoice, Analytics, Notification)&#34;]
</pre><ol><li><strong>Write 트랜잭션</strong><ul><li>서비스는 DB 트랜잭션 안에서 도메인 데이터와 함께 <strong>Outbox Table 에 이벤트</strong>를 기록한다.</li></ul></li><li><strong>Outbox Poller 또는 CDC</strong><ul><li>별도 프로세스가 outbox 테이블을 주기적으로 스캔하거나 CDC 를 통해 변경 감지.</li></ul></li><li><strong>Event 발행기</strong><ul><li>폴링된 메시지를 Kafka 나 EventBridge 등에 <strong>EDA 이벤트로 게시</strong>.</li></ul></li><li><strong>다수의 Consumer 가 이벤트 구독</strong></li></ol><h5 id=outbox-table-구조-예시>Outbox Table 구조 예시<a hidden class=anchor aria-hidden=true href=#outbox-table-구조-예시>#</a></h5><table><thead><tr><th>컬럼명</th><th>설명</th></tr></thead><tbody><tr><td><code>id</code></td><td>UUID</td></tr><tr><td><code>aggregate_id</code></td><td>관련 도메인 ID</td></tr><tr><td><code>type</code></td><td>이벤트 타입 (ex: <code>OrderCreated</code>)</td></tr><tr><td><code>payload</code></td><td>JSON 포맷의 이벤트 데이터</td></tr><tr><td><code>status</code></td><td><code>PENDING</code>, <code>SENT</code>, <code>FAILED</code> 등</td></tr><tr><td><code>created_at</code></td><td>생성 시각</td></tr></tbody></table><h5 id=python-예시-sqlalchemy--kafka>Python 예시 (SQLAlchemy + Kafka)<a hidden class=anchor aria-hidden=true href=#python-예시-sqlalchemy--kafka>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 1. Command 처리 시 Outbox 삽입</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=o>**</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>OutboxEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=s2>&#34;total&#34;</span><span class=p>:</span> <span class=n>order</span><span class=o>.</span><span class=n>total</span><span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span><span class=o>=</span><span class=s2>&#34;PENDING&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 2. Poller: 주기적으로 Kafka에 발행</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>publish_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>OutboxEvent</span><span class=p>)</span><span class=o>.</span><span class=n>filter_by</span><span class=p>(</span><span class=n>status</span><span class=o>=</span><span class=s2>&#34;PENDING&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>kafka_producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;order.events&#34;</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;SENT&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mda-message-driven-architecture--eda-event-driven-architecture-혼합-아키텍처-with-kafka>MDA (Message-Driven Architecture) & EDA (Event-Driven Architecture) 혼합 아키텍처 With Kafka<a hidden class=anchor aria-hidden=true href=#mda-message-driven-architecture--eda-event-driven-architecture-혼합-아키텍처-with-kafka>#</a></h4><p><strong>아키텍처적으로 설계 관점과 메시지 사용 방식이 달라야 하며</strong>, Kafka 가 본질적으로 Event-Driven 친화적인 플랫폼이라는 점을 이해하고, <strong>MDA 스타일에 맞게 보완 설계</strong>가 필요하다.</p><h5 id=kafka-하나로-mda--eda-처리하는-방식-요약>Kafka 하나로 MDA & EDA 처리하는 방식 요약<a hidden class=anchor aria-hidden=true href=#kafka-하나로-mda--eda-처리하는-방식-요약>#</a></h5><table><thead><tr><th>아키텍처 유형</th><th>Kafka 적용 방식</th><th>설명</th></tr></thead><tbody><tr><td><strong>MDA (명령 기반)</strong></td><td><strong>Point-to-Point 방식 구현</strong> (Consumer Group 활용)</td><td>특정 명령을 하나의 서비스가 처리하도록 설정 (1:1 처리 구조)</td></tr><tr><td><strong>EDA (이벤트 기반)</strong></td><td><strong>Pub/Sub 방식 구현</strong> (Consumer Group 없이 독립 구독)</td><td>동일 이벤트를 여러 서비스가 독립적으로 병렬 반응 (1:N 구조)</td></tr></tbody></table><h5 id=mda-with-kafka구현-방법>MDA with Kafka–구현 방법<a hidden class=anchor aria-hidden=true href=#mda-with-kafka구현-방법>#</a></h5><p>Kafka 는 원래 Pub/Sub 구조지만, <strong>Consumer Group</strong>을 활용하면 MDA 의 <strong>Point-to-Point 스타일</strong>로 구현할 수 있다.</p><pre class=mermaid>flowchart LR
  Producer --&gt;|command: createInvoice| KafkaTopic
  KafkaTopic --&gt;|ConsumerGroup: invoice-service| ConsumerA
</pre><ul><li>동일 Consumer Group 내에서는 <strong>단일 인스턴스만 메시지를 소비</strong></li><li>즉, Kafka 에서도 <strong>MDA 스타일의 명령 처리 가능</strong></li></ul><h5 id=eda-with-kafka구현-방법>EDA with Kafka–구현 방법<a hidden class=anchor aria-hidden=true href=#eda-with-kafka구현-방법>#</a></h5><p>Kafka 본연의 Event-Driven 처리. 여러 Consumer Group 이 각각 이벤트를 수신하고 처리 가능하다.</p><pre class=mermaid>flowchart LR
  Producer --&gt;|event: OrderCreated| KafkaTopic
  KafkaTopic --&gt;|ConsumerGroup: invoice| InvoiceService
  KafkaTopic --&gt;|ConsumerGroup: notification| NotificationService
  KafkaTopic --&gt;|ConsumerGroup: analytics| AnalyticsService
</pre><ul><li>이벤트는 <strong>모든 ConsumerGroup 에 복제 전파됨</strong></li><li>병렬 반응 가능하며, <strong>완전한 Pub/Sub 패턴 구현</strong></li></ul><h5 id=kafka-기반-mda--eda-혼합-예시-구조>Kafka 기반 MDA & EDA 혼합 예시 구조<a hidden class=anchor aria-hidden=true href=#kafka-기반-mda--eda-혼합-예시-구조>#</a></h5><pre class=mermaid>flowchart TD
  API[User Command API]
  API --&gt;|Command| KafkaCmd[Kafka: order.commands]
  KafkaCmd --&gt;|Group: order-handler| OrderService

  OrderService --&gt;|Event| KafkaEvt[Kafka: order.events]
  KafkaEvt --&gt; InvoiceService
  KafkaEvt --&gt; AnalyticsService
  KafkaEvt --&gt; NotificationService
</pre><ul><li><code>order.commands</code>: Command Topic (MDA 역할)</li><li><code>order.events</code>: Event Topic (EDA 역할)</li></ul><h5 id=구현-시-주의할-점>구현 시 주의할 점<a hidden class=anchor aria-hidden=true href=#구현-시-주의할-점>#</a></h5><table><thead><tr><th>항목</th><th>주의사항</th></tr></thead><tbody><tr><td><strong>명령 vs 이벤트 토픽 분리</strong></td><td>MDA 스타일은 <code>command.topic</code>, EDA 스타일은 <code>event.topic</code> 으로 분리하는 것이 좋음</td></tr><tr><td><strong>역할 분리 명확히</strong></td><td><code>CommandConsumer</code>, <code>EventConsumer</code> 역할 분리해서 구현</td></tr><tr><td><strong>Idempotency 필수</strong></td><td>Kafka 는 중복 수신 가능 → 컨슈머는 반드시 중복 처리 방어</td></tr><tr><td><strong>Dead Letter Queue (DLQ)</strong></td><td>MDA 의 경우 실패 메시지는 DLQ 처리 구조 반드시 설계</td></tr><tr><td><strong>Schema Registry 활용</strong></td><td>Avro/JSON 스키마를 등록해 구조 변경 관리 필요</td></tr></tbody></table><h5 id=kafka-기반-mda--eda-분리-구현-예시-python>Kafka 기반 MDA / EDA 분리 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#kafka-기반-mda--eda-분리-구현-예시-python>#</a></h5><p><strong>기본 전제</strong>:</p><ul><li>Kafka 서버 주소: <code>localhost:9092</code></li><li>Command Topic: <code>order.commands</code></li><li>Event Topic: <code>order.events</code></li><li>Group ID:<ul><li>MDA Consumer: <code>order-command-handler</code></li><li>EDA Consumers: <code>invoice-service</code>, <code>notification-service</code></li></ul></li></ul><h6 id=command-producer-mda-용>Command Producer (MDA 용)<a hidden class=anchor aria-hidden=true href=#command-producer-mda-용>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># send_command.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>command</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;command_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;command_type&#34;</span><span class=p>:</span> <span class=s2>&#34;CreateOrder&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;payload&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD-1001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;C-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>99.99</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;order.commands&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;✅ Command sent: </span><span class=si>{</span><span class=n>command</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=command-consumer-mda-처리기-11-처리>Command Consumer (MDA 처리기: 1:1 처리)<a hidden class=anchor aria-hidden=true href=#command-consumer-mda-처리기-11-처리>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># command_consumer.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;order.commands&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s2>&#34;order-command-handler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;📥 Received Command: </span><span class=si>{</span><span class=n>command</span><span class=p>[</span><span class=s1>&#39;command_type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> for Order </span><span class=si>{</span><span class=n>command</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>][</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Command 처리 후 이벤트 발행 (EDA 트리거)</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=n>command</span><span class=p>[</span><span class=s2>&#34;timestamp&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;payload&#34;</span><span class=p>:</span> <span class=n>command</span><span class=p>[</span><span class=s2>&#34;payload&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;order.events&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;📤 Published Event: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=event-consumer-eda-다수-컨슈머>Event Consumer (EDA: 다수 컨슈머)<a hidden class=anchor aria-hidden=true href=#event-consumer-eda-다수-컨슈머>#</a></h6><p><strong>Invoice Service</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># invoice_consumer.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;order.events&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s2>&#34;invoice-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;🧾 [Invoice Service] 처리 중: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> - Order </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>][</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Notification Service</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># notification_consumer.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;order.events&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s2>&#34;notification-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;📣 [Notification Service] 사용자에게 알림 전송: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>][</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=실행-순서-요약>실행 순서 요약<a hidden class=anchor aria-hidden=true href=#실행-순서-요약>#</a></h6><ol><li><code>command_consumer.py</code> → MDA Consumer 실행</li><li><code>invoice_consumer.py</code>, <code>notification_consumer.py</code> → EDA Consumers 실행</li><li><code>send_command.py</code> → 명령 전송</li><li>흐름:<ul><li><code>order.commands</code> → Order 처리</li><li>처리 후 <code>order.events</code> 로 Event 발행</li><li>Event 는 여러 서비스에서 병렬로 소비됨</li></ul></li></ol><h6 id=아키텍처-흐름-시각화>아키텍처 흐름 시각화<a hidden class=anchor aria-hidden=true href=#아키텍처-흐름-시각화>#</a></h6><pre class=mermaid>sequenceDiagram
  participant A as send_command.py
  participant B as command_consumer.py
  participant Kafka1 as Topic: order.commands
  participant Kafka2 as Topic: order.events
  participant C as invoice_consumer.py
  participant D as notification_consumer.py

  A-&gt;&gt;Kafka1: Command: CreateOrder
  Kafka1-&gt;&gt;B: MDA Consumer (Command 처리)
  B-&gt;&gt;Kafka2: Event: OrderCreated
  Kafka2-&gt;&gt;C: Invoice 처리
  Kafka2-&gt;&gt;D: Notification 처리
</pre><h3 id=command-vs-event-구분-기준-및-메시지-라우팅-전략>Command vs. Event 구분 기준 및 메시지 라우팅 전략<a hidden class=anchor aria-hidden=true href=#command-vs-event-구분-기준-및-메시지-라우팅-전략>#</a></h3><h4 id=구분-기준>구분 기준<a hidden class=anchor aria-hidden=true href=#구분-기준>#</a></h4><table><thead><tr><th>항목</th><th>Command (명령)</th><th>Event (이벤트)</th></tr></thead><tbody><tr><td><strong>의도</strong></td><td><strong>행동을 유도</strong> (Do something)</td><td><strong>사실을 알림</strong> (Something happened)</td></tr><tr><td><strong>시간</strong></td><td>미래 (미실행 상태)</td><td>과거 (이미 발생함)</td></tr><tr><td><strong>수신자</strong></td><td><strong>단일 수신자</strong> (명확한 담당자)</td><td><strong>0 개 이상 수신자</strong> (누가 받을지는 모름)</td></tr><tr><td><strong>응답 필요 여부</strong></td><td>일반적으로 Yes (결과 필요)</td><td>일반적으로 No (단방향 브로드캐스트)</td></tr><tr><td><strong>구성 요소</strong></td><td><code>Command ID</code>, <code>Target</code>, <code>Payload</code>, <code>Expected Result</code></td><td><code>Event ID</code>, <code>Event Type</code>, <code>Timestamp</code>, <code>Payload</code></td></tr></tbody></table><h4 id=라우팅-전략>라우팅 전략<a hidden class=anchor aria-hidden=true href=#라우팅-전략>#</a></h4><table><thead><tr><th>전략 유형</th><th>설명</th><th>예시</th></tr></thead><tbody><tr><td><strong>명령 라우팅 (Command Routing)</strong></td><td>큐 이름이나 라우팅 키로 명시적으로 라우팅. 보통 <strong>Point-to-Point</strong> 방식 사용</td><td><code>invoice.create.command</code> → <code>InvoiceService</code> 큐에 직접 전달</td></tr><tr><td><strong>이벤트 브로드캐스트</strong></td><td>주제 기반 토픽에 게시. 관심 있는 소비자가 <strong>구독</strong></td><td><code>order.events</code> → 여러 서비스가 동시에 반응</td></tr><tr><td><strong>EventType 기반 라우팅</strong></td><td>이벤트의 <code>type</code> 필드 기반으로 동적 라우팅 수행</td><td>Kafka topic 내부에서 <code>"event_type" == "OrderCreated"</code> 필터</td></tr><tr><td><strong>Contextual Routing</strong></td><td>메시지에 포함된 <strong>도메인 정보나 컨텍스트</strong>를 기준으로 라우팅</td><td>&ldquo;VIP 고객 이벤트만 분석 서비스로 전파 "</td></tr></tbody></table><h4 id=메시지-라우팅-예시-kafka-stream>메시지 라우팅 예시 (Kafka Stream)<a hidden class=anchor aria-hidden=true href=#메시지-라우팅-예시-kafka-stream>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_id&#34;</span><span class=p>:</span> <span class=s2>&#34;abc-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-07-17T14:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;payload&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD-101&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;C-999&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;is_vip&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>is_vip == true</code> → Analytics 서비스로 전송</li><li><code>event_type == OrderCreated</code> → Invoice, Notification, OrderHistory 모두 수신</li></ul><p>Kafka Streams, Flink, NiFi 등을 이용하여 <strong>내용 기반 라우팅</strong>을 손쉽게 구현할 수 있음.</p><h3 id=실무에서-효과적-적용을-위한-고려사항>실무에서 효과적 적용을 위한 고려사항<a hidden class=anchor aria-hidden=true href=#실무에서-효과적-적용을-위한-고려사항>#</a></h3><table><thead><tr><th>카테고리</th><th>고려 항목</th><th>Message-Driven Architecture (MDA)</th><th>Event-Driven Architecture (EDA)</th><th>권장 사항 및 전략</th></tr></thead><tbody><tr><td><strong>1. 메시지/이벤트 설계</strong></td><td>메시지/이벤트 정의</td><td>명시적 메시지 타입 (Command/Request/Response 구분)</td><td>이벤트 의미 중심 정의 (상태 변화, 도메인 사상 중심)</td><td>변하지 않는 계약 기반 설계 (Contract), 타입 명확화, 이벤트 이름 표현 일관성 유지</td></tr><tr><td></td><td>스키마 관리</td><td>명시적 메시지 계약 관리</td><td>이벤트 스키마의 하위 호환성 및 버전 관리 필요</td><td>JSON Schema / Protobuf + Schema Registry / AsyncAPI 활용</td></tr><tr><td><strong>2. 장애 및 실패 처리</strong></td><td>실패 메시지 처리</td><td>DLQ(Dead Letter Queue), Retry, Timeout 처리</td><td>중복 이벤트 처리, 순서 보장, 보상 트랜잭션 필요</td><td>Idempotency Key 적용, 메시지 순서 처리 (Partition Key, Session)</td></tr><tr><td></td><td>장애 전파 제어</td><td>처리 실패 시 오류 큐 분리 및 재처리 중심</td><td>이벤트 컨슈머 오류 시에도 전체 시스템 영향 최소화</td><td>Circuit Breaker, Retry with Backoff, Outbox Pattern 적용</td></tr><tr><td><strong>3. 트랜잭션 관리</strong></td><td>일관성 처리</td><td>큐 기반 트랜잭션 처리 필요</td><td>이벤트 흐름 기반 일관성 설계 (Eventually Consistent)</td><td>Saga 패턴 활용 (로컬 트랜잭션 + 보상 로직 분리), Outbox + Polling 기반 데이터 연동</td></tr><tr><td><strong>4. 운영/모니터링</strong></td><td>지표 수집</td><td>큐 깊이, 처리 지연, 에러율 중심</td><td>이벤트 발생률, 처리 지연, 누락 이벤트 탐지</td><td>Prometheus + Grafana, Alerting Rule, DLQ 모니터링</td></tr><tr><td></td><td>흐름 추적</td><td>메시지 ID 및 Correlation ID 기반 흐름 추적</td><td>이벤트 흐름 추적 및 인과 관계 분석 필요</td><td>Distributed Tracing (OpenTelemetry, Jaeger, Zipkin 등) 적용</td></tr><tr><td><strong>5. 테스트 전략</strong></td><td>계약 기반 테스트</td><td>Producer/Consumer 간 명시적 메시지 계약 필요</td><td>Event Flow 기반 테스트 및 상태 전이 검증</td><td>Consumer-Driven Contract Test, Schema Validation Test</td></tr><tr><td><strong>6. 팀/조직 구조</strong></td><td>서비스 소유권 및 거버넌스</td><td>서비스 단위로 메시지 주고받는 명확한 책임 구조</td><td>이벤트 발행자/구독자 간 소유권 불분명 가능성 있음</td><td>Conway&rsquo;s Law 기반 서비스 - 팀 정렬, 이벤트 명세에 대한 거버넌스 체계 수립</td></tr></tbody></table><h3 id=최적화를-위한-고려사항>최적화를 위한 고려사항<a hidden class=anchor aria-hidden=true href=#최적화를-위한-고려사항>#</a></h3><table><thead><tr><th>카테고리</th><th>최적화 대상</th><th>메시지 기반 아키텍처 (MDA)</th><th>이벤트 기반 아키텍처 (EDA)</th><th>공통 권장 전략 및 설명</th></tr></thead><tbody><tr><td><strong>1. 성능</strong></td><td>처리량 & 지연 시간</td><td>배치 처리, 큐 기반 병렬 소비</td><td>스트림 기반 처리, 이벤트 파이프라인 분산 처리</td><td>파티셔닝, 병렬 소비자 구성, 비동기화</td></tr><tr><td><strong>2. 저장소</strong></td><td>스토리지 효율성</td><td>메시지 압축 (Gzip, Snappy), TTL 기반 자동 삭제 설정</td><td>이벤트 압축 + 장기 아카이빙 (예: S3, Glacier)</td><td>압축 알고리즘 적용, 저장 주기 분리</td></tr><tr><td><strong>3. 네트워크</strong></td><td>대역폭 효율성</td><td>메시지 배칭 및 경량 메시지 포맷 사용</td><td>이벤트 배칭, 미니멀 이벤트 페이로드 설계</td><td>배치 전송, 프로토콜 최소화 (e.g., Protobuf)</td></tr><tr><td><strong>4. 메모리</strong></td><td>메모리 사용 최적화</td><td>메시지 캐시 활용 (Redis, LRU 등), 큐 기반 버퍼링</td><td>스트림 버퍼 조절, 이벤트 리플레이 캐시</td><td>적응형 버퍼 크기 조정, 백프레셔 적용</td></tr><tr><td><strong>5. 확장성</strong></td><td>수평 확장</td><td>브로커 클러스터 구성, Consumer 확장</td><td>이벤트 버스 확장, Auto-scaling 기반 소비자 구성</td><td>클라우드 네이티브 Auto-scaling, 분산 트래픽 라우팅</td></tr><tr><td><strong>6. 정확성</strong></td><td>중복 방지 & 유실 대응</td><td>메시지 ID 추적, 오프셋 관리, 재처리 시 idempotent 설계</td><td>이벤트 중복 필터링, Exactly-once 처리 (Kafka EOS 등)</td><td>재시도 + 중복 제거 전략, 메시지 추적 ID 기반 처리</td></tr><tr><td><strong>7. 지연 최적화</strong></td><td>지연 최소화</td><td>경량 메시지 포맷 (JSON → Protobuf), 브로커 처리 최적화</td><td>실시간 이벤트 전달 + 스트리밍 최적화 (Kafka, Flink 등)</td><td>경량화, 실시간 처리 우선 순위 설계</td></tr><tr><td><strong>8. 운영 관리</strong></td><td>리소스 활용도</td><td>큐 대기 시간, DLQ 메시지 수, 처리율 등 메트릭 기반 운영</td><td>이벤트 처리 실패율, 라그 (Lag), 소비자 상태 추적</td><td>Prometheus + Grafana 모니터링, Alerting 구성</td></tr><tr><td><strong>9. 장애 대응</strong></td><td>오류 회복력</td><td>DLQ, Retry Policy, Circuit Breaker 설정</td><td>이벤트 재처리 및 재전파, 컨슈머 복구 전략</td><td>자동 Failover, 상태 기반 재처리 설계</td></tr></tbody></table><h3 id=주목할-내용>주목할 내용<a hidden class=anchor aria-hidden=true href=#주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>관련 아키텍처</th></tr></thead><tbody><tr><td>** 설계 원칙**</td><td><strong>Idempotency</strong></td><td>동일 메시지 반복 처리 시 중복 효과 방지. 정합성과 안전성을 위한 핵심 속성</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>순서 보장 (Ordering)</strong></td><td>메시지 순서대로 처리 보장 필요 시 파티션, 키, 세션 단위로 설계 (e.g., Kafka partition key)</td><td>MDA</td></tr><tr><td></td><td><strong>CQRS 패턴</strong></td><td>Command(쓰기) 와 Query(읽기) 모델 분리로 확장성 및 성능 최적화</td><td>EDA 중심</td></tr><tr><td>** 패턴과 전략**</td><td><strong>Saga Pattern</strong></td><td>분산 트랜잭션을 보상 트랜잭션으로 분리 관리하여 롤백 없이 일관성 유지 (비동기 트랜잭션 제어)</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Event Sourcing</strong></td><td>시스템 상태를 이벤트 로그로 저장, 재생성 가능한 상태 복원 및 감사 추적 가능</td><td>EDA</td></tr><tr><td>** 인프라/플랫폼**</td><td><strong>Apache Kafka</strong></td><td>고성능 이벤트 스트리밍 플랫폼, Pub/Sub 및 로그 기반 저장 포함</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>RabbitMQ</strong></td><td>전통적인 메시지 큐, 복잡한 라우팅 및 보증 수준 처리에 적합</td><td>MDA</td></tr><tr><td></td><td><strong>AWS SQS/SNS</strong></td><td>클라우드 기반 메시징 서비스, 확장성과 관리 편의성 제공</td><td>MDA, EDA</td></tr><tr><td>** 운영/모니터링**</td><td><strong>Dead Letter Queue (DLQ)</strong></td><td>실패 메시지 격리 보관 큐, 장애 원인 분석 및 재처리 기반</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Distributed Tracing</strong></td><td>마이크로서비스 및 메시지 기반 시스템 간 흐름 시각화 및 성능 병목 분석 (예: Jaeger, OpenTelemetry)</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>메트릭 수집</strong></td><td>처리량, 지연, 실패율 등의 지표 수집으로 SLA 및 성능 관리</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>로그 집계 (Logging)</strong></td><td>구조화된 메시지 기반 로그를 통해 디버깅 및 이벤트 트레킹 가능</td><td>MDA, EDA</td></tr><tr><td>** 확장성과 복구성**</td><td><strong>수평 확장성 (Scalability)</strong></td><td>컨슈머/리스너 개별 확장이 용이하며 메시지 큐 기반 구조가 동적 스케일아웃에 적합</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>이벤트 기반 민첩성</strong></td><td>시스템의 상태 변화에 따라 리액티브하게 동작하여 민첩성 확보</td><td>EDA</td></tr><tr><td></td><td><strong>Event Store</strong></td><td>이벤트의 영속적 저장을 통한 재처리, 복구, 비즈니스 감사 가능</td><td>EDA</td></tr></tbody></table><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제/영역</th><th>핵심 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 이론적 기반</strong></td><td>분산 시스템 이론</td><td><strong>CAP Theorem</strong></td><td>Consistency, Availability, Partition Tolerance 간의 트레이드오프 원리</td></tr><tr><td></td><td></td><td><strong>최종 일관성 (Eventually Consistent)</strong></td><td>분산 환경에서 강한 일관성 대신 허용되는 지연된 동기화 모델</td></tr><tr><td></td><td></td><td><strong>ACID vs BASE</strong></td><td>전통 트랜잭션 모델과 느슨한 일관성 모델의 비교</td></tr><tr><td><strong>2. 메시징 패턴</strong></td><td>통신 패턴</td><td><strong>Request-Reply</strong></td><td>동기적 요청 - 응답 처리 구조 (예: HTTP, RPC)</td></tr><tr><td></td><td></td><td><strong>Publish-Subscribe</strong></td><td>비동기 이벤트 기반 다중 수신자 구조 (예: Kafka Topics)</td></tr><tr><td></td><td></td><td><strong>Message Queue</strong></td><td>FIFO 기반의 메시지 큐 구조 (예: RabbitMQ Queue)</td></tr><tr><td><strong>3. 이벤트 아키텍처</strong></td><td>이벤트 중심 설계</td><td><strong>Event Sourcing</strong></td><td>모든 상태 변경을 이벤트로 저장해 재구성 가능</td></tr><tr><td></td><td></td><td><strong>CQRS</strong></td><td>명령 (Command) 과 조회 (Query) 모델 분리</td></tr><tr><td></td><td></td><td><strong>Event Store</strong></td><td>이벤트 영속화를 위한 저장소 (예: Kafka, EventStoreDB)</td></tr><tr><td><strong>4. 트랜잭션 처리</strong></td><td>분산 트랜잭션 관리</td><td><strong>Saga Pattern</strong></td><td>보상 트랜잭션 기반의 분산 트랜잭션 처리</td></tr><tr><td></td><td></td><td><strong>Idempotent Design</strong></td><td>재시도 시 중복 처리를 방지하는 설계 전략</td></tr><tr><td></td><td></td><td><strong>Retry / DLQ</strong></td><td>실패 메시지 재처리 및 대체 큐 전략 (Dead Letter Queue)</td></tr><tr><td><strong>5. 구현 프레임워크</strong></td><td>메시징 브로커 구성 요소</td><td><strong>RabbitMQ / Kafka</strong></td><td>대표적인 메시징 시스템, 큐/토픽 기반 메시지 처리</td></tr><tr><td></td><td></td><td><strong>Event Bus</strong></td><td>이벤트 기반 통합 시스템의 중심 통신 채널</td></tr><tr><td></td><td></td><td><strong>Service Mesh</strong></td><td>메시지 기반 마이크로서비스 간 통신 관리 (예: Istio)</td></tr><tr><td></td><td></td><td><strong>API Gateway</strong></td><td>클라이언트 요청을 내부 서비스로 라우팅하는 진입 지점</td></tr><tr><td><strong>6. 운영 및 관찰성</strong></td><td>시스템 관찰성 구성</td><td><strong>분산 트레이싱 (Tracing)</strong></td><td>서비스 간 호출 관계 추적 (예: OpenTelemetry, Jaeger)</td></tr><tr><td></td><td></td><td><strong>메트릭 수집 (Metrics)</strong></td><td>처리량, 지연시간 등 시스템 지표 모니터링 (예: Prometheus)</td></tr><tr><td></td><td></td><td><strong>중앙 로그 관리 (Logging)</strong></td><td>구조화된 로그 수집 및 검색 (예: ELK Stack)</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의 및 설명</th><th>관련 아키텍처</th></tr></thead><tbody><tr><td>** 시스템 구성요소**</td><td><strong>Message Broker</strong></td><td>생산자 - 소비자 간 메시지를 송수신하고 버퍼링, 라우팅, 전송 보장 처리</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Event Bus</strong></td><td>이벤트 발행/구독 기반의 전파 중심 메시징 채널 (메시지 라우팅 포함)</td><td>EDA</td></tr><tr><td></td><td><strong>Event Store</strong></td><td>발생한 모든 이벤트를 영속적으로 저장하는 저장소</td><td>EDA</td></tr><tr><td></td><td><strong>Dead Letter Queue (DLQ)</strong></td><td>처리 실패 메시지를 격리 보관하여 후속 처리나 모니터링에 활용하는 큐</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Projection</strong></td><td>이벤트 로그 (Event Stream) 를 읽기 모델로 변환하는 과정</td><td>EDA</td></tr><tr><td></td><td><strong>Correlation ID</strong></td><td>요청 - 응답/처리 흐름 추적을 위한 메시지 간 고유 식별자</td><td>MDA, EDA</td></tr><tr><td>** 메시지/이벤트 단위**</td><td><strong>Message</strong></td><td>명시적 명령 (Command), 요청 (Request), 응답 (Response), 데이터 전달을 포함한 단위</td><td>MDA</td></tr><tr><td></td><td><strong>Event</strong></td><td>시스템에서 발생한 상태 변화나 사상 (Occurrence) 을 의미. 결과 지향적</td><td>EDA</td></tr><tr><td>** 통신/설계 패턴**</td><td><strong>Publish/Subscribe (Pub/Sub)</strong></td><td>발행자와 구독자 간 직접적 연결 없이 메시지를 중개 채널을 통해 전달하는 패턴</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Saga Pattern</strong></td><td>분산 트랜잭션을 보상 트랜잭션 (Compensation) 으로 관리하는 패턴</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Compensating Transaction</strong></td><td>실패한 작업을 취소하거나 보정하는 트랜잭션</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Circuit Breaker</strong></td><td>장애 확산을 방지하고 빠른 실패 처리를 유도하는 안정성 제어 패턴</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Event Sourcing</strong></td><td>상태를 DB 에 저장하는 대신, 발생한 이벤트 시퀀스를 저장하고 이를 재생해 상태를 복원</td><td>EDA</td></tr><tr><td>** 품질 및 운영 특성**</td><td><strong>Idempotency (멱등성)</strong></td><td>동일 메시지를 여러 번 처리해도 결과가 동일하게 유지되는 속성</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Eventual Consistency</strong></td><td>즉시 일관성은 보장하지 않지만 시간이 지나면 일관성을 확보하는 모델</td><td>EDA</td></tr><tr><td></td><td><strong>Back Pressure</strong></td><td>처리량 초과 시 시스템 안정성 유지를 위한 흐름 제어 기법</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Bulkhead</strong></td><td>장애 격리를 위한 시스템 분할 전략 (마이크로서비스의 독립 실행 보장)</td><td>MDA, EDA</td></tr><tr><td></td><td><strong>Distributed Tracing</strong></td><td>다중 서비스 간 요청 흐름을 추적하기 위한 기법 (예: Jaeger, Zipkin)</td><td>MDA, EDA</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.geeksforgeeks.org/system-design/message-driven-architecture-vs-event-driven-architecture/>Message-Driven vs Event-Driven Architecture 비교 - GeeksforGeeks</a></li><li><a href=https://medium.com/simpplr-technology/event-driven-architecture-the-hard-parts-events-vs-messages-0fcfc7243703>Event vs Message: 차이와 실무 적용 - Medium (Simpplr Tech)</a></li><li><a href=https://medium.com/@alexdorand/event-driven-vs-message-driven-5f476d5932b4>Event-Driven vs Message-Driven 구조 비교 - Medium (Alex Dorand)</a></li><li><a href=https://medium.com/@leela.kumili/scaling-microservices-message-driven-vs-event-driven-architecture-16fe79402e40>Scaling Microservices: Message vs Event - Medium (Leela Kumili)</a></li><li><a href=https://www.linkedin.com/pulse/message-driven-vs-event-architecture-saurabh-mishra>Message vs Event Driven Architecture 비교 - LinkedIn (Saurabh Mishra)</a></li><li><a href=https://doc.akka.io/libraries/guide/concepts/message-driven-event-driven.html>Message vs Event: 개념 차이와 적용 가이드 - Akka Guide</a></li><li><a href=https://www.linkedin.com/advice/0/how-can-you-choose-between-message-oriented-event-driven-t2rxf>Messaging vs Event-Driven Architecture 선택 가이드 - LinkedIn</a></li><li><a href=https://microservices.io/patterns/data/event-driven-architecture.html>Microservices Pattern: Event-Driven Architecture - Microservices.io</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/architecture/microservices/architect-microservice-container-applications/asynchronous-message-based-communication>Asynchronous Message-Based Communication - Microsoft Learn</a></li><li><a href=https://docs.aws.amazon.com/whitepapers/latest/reactive-systems-on-aws/message-driven.html>Message-Driven Systems in Reactive Architecture - AWS Whitepaper</a></li><li><a href=https://solace.com/blog/messaging-patterns-for-event-driven-microservices/>Messaging Patterns for Event-Driven Microservices - Solace</a></li><li><a href=https://www.confluent.io/learn/event-driven-architecture/>Event-Driven Architecture 개요 - Confluent</a></li><li><a href=https://aws.amazon.com/blogs/architecture/best-practices-for-implementing-event-driven-architectures-in-your-organization/>Event-Driven Architecture 베스트 프랙티스 - AWS Architecture Blog</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/event-driven>Event-Driven Architecture 스타일 설명 - Azure Architecture Center</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS 패턴 소개 - Azure Architecture Center</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>CQRS & Event Sourcing with Java - Baeldung</a></li><li><a href=https://docs.aws.amazon.com/eventbridge/latest/userguide/what-is-amazon-eventbridge.html>Amazon EventBridge 소개 - AWS 공식 문서</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/saga>Saga Pattern in Microservices - Microsoft Docs</a></li><li><a href=https://kafka.apache.org/documentation/#idempotent>Idempotent Consumer 구현 - Apache Kafka Docs</a></li><li><a href=https://opentelemetry.io/docs/concepts/observability-primer/>Distributed Tracing 개요 - OpenTelemetry</a></li><li><a href=https://dev.to/>Message Broker vs Event Broker - Dev.to</a></li><li><a href=https://www.baeldung.com/cs/event-driven-vs-message-driven>Event-Driven vs Message-Driven Architecture - Baeldung</a></li><li><a href=https://www.rabbitmq.com/>RabbitMQ 공식 문서</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a></li><li><a href=https://docs.microsoft.com/en-us/azure/architecture/guide/architecture-styles/message-broker>Message Broker 아키텍처 스타일 - Microsoft Architecture Center</a></li></ul><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/software-engineering/>Software-Engineering</a></li><li><a href=https://buenhyden.github.io/tags/design-and-architecture/>Design-and-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/architecture-styles-and-patterns/>Architecture-Styles-and-Patterns</a></li><li><a href=https://buenhyden.github.io/tags/architecture-styles/>Architecture-Styles</a></li><li><a href=https://buenhyden.github.io/tags/messaging-oriented-styles/>Messaging-Oriented-Styles</a></li><li><a href=https://buenhyden.github.io/tags/message-driven-architecture/>Message-Driven-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/event-driven-architecture/>Event-Driven-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/asynchronous-communication/>Asynchronous-Communication</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/pessimistic-vs-optimistic-locking/><span class=title>« Prev</span><br><span>Pessimistic vs. Optimistic Locking</span>
</a><a class=next href=https://buenhyden.github.io/posts/software-design-and-architecture/design-principles/grasp/grasp-vs-solid/><span class=title>Next »</span><br><span>GRASP vs. SOLID</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>