<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Event Sourcing | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Patterns,Data-Management-Patterns,Event-Sourcing"><meta name=description content="이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/event-patterns/event-sourcing/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/event-patterns/event-sourcing/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/event-patterns/event-sourcing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/event-patterns/event-sourcing/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Event Sourcing"><meta property="og:description" content="이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Event Sourcing"><meta name=twitter:description content="이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":3,"name":"Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/"},{"@type":"ListItem","position":4,"name":"Messaging-Oriented Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/"},{"@type":"ListItem","position":5,"name":"Event-Driven Architecture","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/"},{"@type":"ListItem","position":6,"name":"Event Sourcing","item":"https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/event-patterns/event-sourcing/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/>Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/>Messaging-Oriented Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-design-and-architecture/architecture/messaging-oriented-architecture/event-driven-architecture/>Event-Driven Architecture</a></div><h1>Event Sourcing</h1><div class=post-description>이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다.</div></header><div class=post-content><h2 id=event-sourcing>Event Sourcing<a hidden class=anchor aria-hidden=true href=#event-sourcing>#</a></h2><h1 id=1단계-기본-분석-및-검증>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증>#</a></h1><hr><h3 id=대표-태그-생성>[대표 태그 생성]<a hidden class=anchor aria-hidden=true href=#대표-태그-생성>#</a></h3><ul><li>Event-Sourcing</li><li>Event-Driven-Architecture</li><li>Audit-Trail</li><li>State-Reconstruction</li></ul><hr><h3 id=분류-체계-검증>[분류 체계 검증]<a hidden class=anchor aria-hidden=true href=#분류-체계-검증>#</a></h3><p>현재 분류 체계인<br><code>Software Engineering > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns</code><br>은 Event Sourcing(이벤트 소싱)의 실질적 사용 · 연계 트렌드와 매우 적절합니다.<br>Event Sourcing은 이벤트 기반 시스템에서 아키텍처 패턴으로 도입되며, 특히 메시지 기반·이벤트 패턴과 강한 연관성을 보입니다.<br>단, 실무에서는 &lsquo;데이터 모델링 및 저장 전략&rsquo;이 중요한 관점이므로, <code>System Design > Distributed Systems > Database Systems > Storage Patterns</code> 분류가 추가로 병행될 수 있습니다.</p><hr><h3 id=핵심-요약-250자-이내>[핵심 요약] (250자 이내)<a hidden class=anchor aria-hidden=true href=#핵심-요약-250자-이내>#</a></h3><p>Event Sourcing(이벤트 소싱)은 시스템의 상태를 직접 저장하지 않고, 모든 상태 변화를 이벤트로 기록하여 그 이벤트의 순서와 내용을 통해 현재 및 과거 상태를 재구성하는 저장·아키텍처 패턴입니다. 데이터의 변경 이력과 복구, 감사(audit) 추적에 특화되어 있습니다.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">1</a><a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">3</a></p><hr><h3 id=전체-개요-400자-이내>[전체 개요] (400자 이내)<a hidden class=anchor aria-hidden=true href=#전체-개요-400자-이내>#</a></h3><p>Event Sourcing은 전통적 CRUD (생성·조회·갱신·삭제) 중심의 데이터 저장 방식과 다르게, 모든 상태 변환 과정을 이벤트로 기록하고 이벤트의 흐름을 기반으로 상태를 재구성하는 아키텍처 스타일입니다. 상태 변경의 원인·과정·결과가 모두 기록되므로, 감사 추적, 과거 이력 복원, 데이터 신뢰성 확보에 탁월하며, 마이크로서비스(MSA, Microservices Architecture)·CQRS(Command Query Responsibility Segregation) 등 현대적 시스템 설계에 널리 적용되고 있습니다. 단점으로는 이벤트 관리 복잡성, 성능 이슈 등이 존재하며 실전에는 분산 저장·이벤트 브로커·스냅샷(Snapshot) 최적화 등이 함께 논의됩니다.<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">2</a><a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">3</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">6</a></p><h2 id=1단계-기본-분석-및-검증-1>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-1>#</a></h2><h3 id=대표-태그-생성-1>대표 태그 생성<a hidden class=anchor aria-hidden=true href=#대표-태그-생성-1>#</a></h3><ul><li><code>Event-Sourcing</code> (이벤트 소싱)</li><li><code>Append-Only-Events</code> (추가 전용 이벤트)</li><li><code>State-Reconstruction</code> (상태 재구성)</li><li><code>Audit-Trail</code> (감사 추적)</li></ul><h3 id=분류-체계-검증-1>분류 체계 검증<a hidden class=anchor aria-hidden=true href=#분류-체계-검증-1>#</a></h3><p><strong>현재 분류</strong>: <code>Software Engineering > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns</code></p><p><strong>검증 결과</strong>: 매우 적절한 분류입니다. Event Sourcing은 이벤트 중심 아키텍처의 핵심 패턴 중 하나로, 메시징 지향 아키텍처 스타일에 속합니다.</p><p><strong>개선 제안</strong>: 동일한 레벨에 CQRS (Command Query Responsibility Segregation) 패턴도 함께 배치하는 것을 권장합니다. 두 패턴은 함께 사용되는 경우가 많기 때문입니다.</p><h3 id=핵심-요약-250자-이내-1>핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#핵심-요약-250자-이내-1>#</a></h3><p>Event Sourcing은 애플리케이션 상태의 모든 변경을 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 현재 상태만 저장하는 전통적 방식과 달리, 상태 변경을 일으킨 모든 이벤트를 불변으로 보관하여 언제든 과거 시점의 상태를 재구성할 수 있습니다. 완벽한 감사 추적과 디버깅, 시간 여행 쿼리를 제공합니다.</p><h3 id=전체-개요-400자-이내-1>전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#전체-개요-400자-이내-1>#</a></h3><p>Event Sourcing은 도메인 주도 설계(DDD) 및 CQRS와 함께 사용되는 강력한 아키텍처 패턴으로, Netflix, Uber 등 대규모 기업에서 실제 운영 중입니다. 전통적인 CRUD 방식의 한계를 극복하여 완벽한 비즈니스 히스토리 보존, 복잡한 비즈니스 로직의 추적 가능성, 실시간 분석 기능을 제공합니다. 초기 구현 복잡도는 높지만, 장기적으로 시스템의 투명성과 확장성에서 큰 이점을 제공하는 패턴입니다.</p><h1 id=1단계-기본-분석-및-검증-2>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-2>#</a></h1><h3 id=대표-태그34><strong>대표 태그(3–4)</strong><a hidden class=anchor aria-hidden=true href=#대표-태그34>#</a></h3><p>Event-Sourcing, Event-Driven-Architecture, CQRS, Immutable-Log</p><h3 id=분류-체계-검증-2><strong>분류 체계 검증</strong><a hidden class=anchor aria-hidden=true href=#분류-체계-검증-2>#</a></h3><p>현재 분류 “Software Engineering > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns”은 타당합니다. 다만 Event Sourcing(이벤트 소싱)은 ‘메시징’만의 문제가 아니라 <strong>데이터 지속성 패턴</strong>이기도 하므로, 보조 분류로 “Software Engineering > Design Patterns > Data Persistence Patterns” 또는 “System Design > Distributed Data > Logs & Event Stores”에 교차 분류하면 검색성·교육 효과가 높습니다(예: 이벤트 스토어, 스냅샷, 업캐스팅 등 데이터 계층 결정이 핵심). 근거: MS Azure 패턴 문서와 Fowler의 정의가 <strong>append-only 이벤트 로그를 단일 진실 원장(Source of Truth)</strong> 으로 삼는 데이터 설계를 강조. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Microsoft Learn</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>)</p><h3 id=핵심-요약250자><strong>핵심 요약(≤250자)</strong><a hidden class=anchor aria-hidden=true href=#핵심-요약250자>#</a></h3><p>이벤트 소싱(Event Sourcing)은 상태 변경을 <strong>이벤트의 불변 로그</strong>로 영속화하고, 재생(replay)·프로젝션으로 현재/과거 상태를 재구성하는 패턴입니다. 감사 추적·시간여행·뷰 재구축이 용이하지만, 스키마 진화·일관성·운영 복잡도에 대한 체계적 대책이 필요합니다. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Microsoft Learn</a>)</p><h3 id=전체-개요400자><strong>전체 개요(≤400자)</strong><a hidden class=anchor aria-hidden=true href=#전체-개요400자>#</a></h3><p>명령(Command)이 도메인 규칙을 통과하면 <strong>도메인 이벤트</strong>를 발생시키고, 이벤트 스토어에 <strong>append-only</strong>로 기록합니다. 읽기 모델은 이벤트를 구독해 <strong>프로젝션(Materialized View)</strong> 을 구축합니다. 대규모에서는 스냅샷·파티셔닝·스키마 레지스트리·클라우드 표준(CloudEvents, AsyncAPI)을 통해 성능·운영성을 확보합니다. 금융 원장, 주문처리, 감사 요구 시스템에 적합합니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Microsoft Learn</a>, <a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">cloudevents.io</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">asyncapi.com</a>)</p><h2 id=1단계-기본-분석>1단계: 기본 분석<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석>#</a></h2><h3 id=1-대표-태그-생성>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성>#</a></h3><ul><li>Event-Sourcing, Event-Driven-Architecture, CQRS-패턴, 데이터-이력관리</li></ul><h3 id=2-분류-체계-검증>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증>#</a></h3><p>현재 분류 [Software Engineering > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns]는 이벤트 소싱(Event Sourcing)의 본질과 핵심 역할을 잘 반영하고 있습니다. 하지만, &ldquo;데이터 관리 패턴(Data Management Patterns)&rdquo;, &ldquo;시스템 로깅 및 트랜잭션(Logging & Transaction Patterns)&rdquo;, &ldquo;분산 시스템 관리(Distributed Data Patterns)&rdquo; 분류와의 연결도 강조할 필요가 있습니다.<br>→ 추천: &ldquo;Event Patterns"는 &ldquo;Data Management Patterns"와 교차 링크 필요.<br>(이유: 이벤트 소싱은 데이터 저장 및 상태 복구 패턴으로도 핵심적 역할 수행)</p><h3 id=3-핵심-요약>3. 핵심 요약<a hidden class=anchor aria-hidden=true href=#3-핵심-요약>#</a></h3><p>Event Sourcing(이벤트 소싱)은 시스템의 상태 변화를 불변(Event)을 순차적으로 저장하면서, 전체 이력을 관리하고 복원하는 아키텍처 패턴이다. 상태 대신 이벤트 스트림을 저장하여 추적성, 감사, 비즈니스 로직 명확화, 복구성 등에서 탁월한 효과를 갖는다.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">1</a><a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">3</a></p><h3 id=4-전체-개요>4. 전체 개요<a hidden class=anchor aria-hidden=true href=#4-전체-개요>#</a></h3><p>이벤트 소싱(Event Sourcing)은 데이터베이스(DB)에 최종 상태만 저장하는 전통적 방식과 달리, 모든 상태 변화를 이벤트로 기록하여 이벤트 스토어(Event Store)에 누적한다. 이를 통해 실시간 상태 및 과거상태 복원이 가능하며, 이벤트 로그의 불변성(Immutability)으로 투명한 감사(Audit), 장애 복구(Recovery), 비즈니스 프로세스 추적성이 뛰어나다. 복잡성과 성능 부담이 있으나, Snapshot, CQRS, Microservices 등과 연계 시 실전 활용도가 높은 패턴이다.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">4</a><a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">5</a></p><hr><h2 id=2단계-핵심-분석>2단계: 핵심 분석<a hidden class=anchor aria-hidden=true href=#2단계-핵심-분석>#</a></h2><h3 id=5-핵심-개념-정리-이론실무-중심>5. 핵심 개념 정리 (이론/실무 중심)<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리-이론실무-중심>#</a></h3><ul><li>이벤트(Event): 상태 변화의 불변(immutable) 기록. 주요 비즈니스 행위의 축적.<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a></li><li>이벤트 스토어(Event Store): 이벤트를 순차적으로 보관하는 데이터 저장소. RDBMS, NoSQL, 전문 EventStore 사용.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">3</a></li><li>상태 재구성(State Reconstruction): 이벤트 연속(replay)으로 현재 상태 계산. Snapshot 병행 가능.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">6</a></li><li>CQRS(Command Query Responsibility Segregation): 변경 명령과 조회 구조를 분리하는 동반 패턴.<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">5</a></li><li>불변성(Immutability): 이벤트는 한 번 기록되면 변경/삭제 불가.<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">8</a></li><li>분산/비동기화(Distributed/Async): 시스템 확장에 유리하며, 이벤트 브로커(예: Kafka, RabbitMQ)와 함께 사용됨.<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">9</a></li><li>적용 도메인: 금융, 커머스, 복잡한 비즈니스 프로세스 등.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">7</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">9</a></li></ul><h3 id=6-실무-연관성-분석>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석>#</a></h3><ul><li>Microservices Architecture(마이크로서비스 아키텍처)에서 서비스 간 데이터 동기화와 감사에 실질적 요구 해결.<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">9</a></li><li>운영 감사, 장애 복구, 데이터 무결성 확보에 직접적 기여.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">4</a></li><li>높은 확장성과 동시성 처리: 이벤트 기반 비동기 환경에서 활용.<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">7</a></li><li>Snapshot, CQRS 연계: 성능 및 조회 최적화에 필요.<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">6</a></li><li>예: 결제 시스템(포트원), 은행 트랜잭션, 이커머스 주문 관리.<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">2</a><a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">7</a></li></ul><h1 id=2단계-개념-체계화-및-검증>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증>#</a></h1><h2 id=핵심-개념-정리관계-포함>핵심 개념 정리(관계 포함)<a hidden class=anchor aria-hidden=true href=#핵심-개념-정리관계-포함>#</a></h2><ul><li><strong>이벤트(Event)</strong>: 과거 시점의 사실(Fact). 예: <code>FundsDeposited</code>. CloudEvents로 공통 메타데이터(id, source, type, specversion) 표준화 가능. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">cloudevents.io</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">Microsoft Learn</a>)</li><li><strong>이벤트 스토어(Event Store)</strong>: 불변 Append-Only 저장소. KurrentDB(구 EventStoreDB), Kafka+압축 토픽, Postgres/Mongo 기반 구현 등. (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">Kurrent Docs</a>, <a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">GitHub</a>, <a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">event-driven.io</a>)</li><li><strong>프로젝션/리드 모델</strong>: 읽기 최적화 뷰. 필요 시 재생으로 재구축 가능. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">Microsoft Learn</a>)</li><li><strong>스냅샷(Snapshot)</strong>: 재생 최적화용 체크포인트. 과도한 사용은 금물—측정 기반 도입 권장. (<a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">Domain Centric</a>, <a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">Kurrent - event-native data platform</a>)</li><li><strong>버전관리/업캐스팅(Upcasting)</strong>: 이벤트 스키마 진화 기법. Confluent Schema Registry 호환성 정책(FULL/BACKWARD 등)과 프레임워크 업캐스터 사용. (<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>, <a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">docs.axoniq.io</a>)</li><li><strong>CQRS</strong>: 읽기/쓰기 모델 분리. 이벤트 소싱과 자주 결합되나 별개 패턴. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>)</li></ul><h2 id=실무-연관성>실무 연관성<a hidden class=anchor aria-hidden=true href=#실무-연관성>#</a></h2><ul><li><strong>감사/규제 대응</strong>: 변경 이력·의도 보존으로 감사 및 회귀 분석 용이.</li><li><strong>확장성</strong>: 로그 기반 파이프라인으로 수평 확장. Kafka EOS(Exactly-Once Semantics) 등으로 중복·정확성 제어. (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>, <a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">Confluent Docs</a>)</li><li><strong>데이터 제품화</strong>: 이벤트는 분석·ML 피처·CDC(변경데이터캡처)로 재활용. Outbox·CDC와의 비교/조합 필요. (<a href="https://www.confluent.io/blog/dual-write-problem/?utm_source=chatgpt.com" title="Understanding the Dual-Write Problem and Its Solutions">Confluent</a>, <a href="https://debezium.io/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/?utm_source=chatgpt.com" title="Reliable Microservices Data Exchange With the Outbox ...">Debezium</a>)</li></ul><h2 id=2단계-개념-체계화-및-검증-1>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증-1>#</a></h2><h3 id=핵심-개념-정리>핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#핵심-개념-정리>#</a></h3><p><strong>이론적 관점</strong>:</p><ul><li>Event Store (이벤트 저장소): 모든 이벤트를 순차적으로 저장하는 추가 전용 데이터베이스</li><li>Aggregate (집계): 도메인 주도 설계의 비즈니스 엔티티로, 상태 변경의 경계를 정의</li><li>Event Stream (이벤트 스트림): 특정 집계에 대한 이벤트들의 순서가 있는 시퀀스</li></ul><p><strong>실무적 관점</strong>:</p><ul><li>Command Handler (명령 처리기): 비즈니스 명령을 받아 이벤트를 생성하는 컴포넌트</li><li>Event Handler (이벤트 처리기): 이벤트를 받아 읽기 모델을 업데이트하는 컴포넌트</li><li>Projection (프로젝션): 이벤트 스트림으로부터 구성되는 읽기 전용 뷰</li></ul><p><strong>기본적 관점</strong>:</p><ul><li>Immutable Events (불변 이벤트): 한번 저장된 이벤트는 절대 변경되지 않음</li><li>Temporal Queries (시간 여행 쿼리): 과거 특정 시점의 상태를 조회하는 기능</li></ul><p><strong>심화적 관점</strong>:</p><ul><li>Snapshotting (스냅샷): 성능 최적화를 위한 주기적 상태 저장</li><li>Event Versioning (이벤트 버전 관리): 스키마 진화에 대응하는 전략</li><li>Sagas (사가): 여러 집계에 걸친 분산 트랜잭션 관리</li></ul><h3 id=실무-연관성-분석>실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#실무-연관성-분석>#</a></h3><ul><li><strong>높은 연관성</strong>: Command Handler, Event Handler, Projection은 직접적인 구현 대상</li><li><strong>중간 연관성</strong>: Event Store, Aggregate는 설계 결정사항</li><li><strong>낮은 연관성</strong>: Snapshotting, Event Versioning은 고도화 단계에서 고려</li></ul><h1 id=2단계-개념-체계화-및-검증-2>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증-2>#</a></h1><hr><h3 id=핵심-개념-정리-1>[핵심 개념 정리]<a hidden class=anchor aria-hidden=true href=#핵심-개념-정리-1>#</a></h3><ul><li><strong>이벤트(Event)</strong>: 시스템 내 상태 변화를 캡처하는 불변(Immutable) 레코드. ex) 주문생성, 결제완료 등.</li><li><strong>이벤트 스트림(Event Stream)</strong>: 이벤트들을 시간 순으로 나열한 로그 (Append-Only Store).</li><li><strong>상태 재구성(State Reconstruction)</strong>: 최근 상태는 저장된 이벤트들을 순차적으로 Replay하여 계산.</li><li><strong>스냅샷(Snapshot)</strong>: 대량 이벤트에서 성능을 보조하기 위해 특정 시점의 전체 상태를 임시 저장.</li><li><strong>CQRS(Command Query Responsibility Segregation)</strong>: 명령(쓰기)과 조회(읽기) 책임 분리 구조와 궁합이 좋음.</li><li><strong>이벤트 저장소(Event Store)</strong>: RDBMS, NoSQL, Kafka와 같은 이벤트 기록을 위한 저장 매체.</li></ul><p>이들 개념은 서로 강하게 연결되어, 이벤트 소싱은 변경 이력 추적과 상태 복원, CSI(감사/추적) 요구사항 해결, 분산 시스템 상태의 정합성 유지 등에 실무적으로 기여합니다.<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">3</a><a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">6</a></p><hr><h3 id=실무-연관성-분석-1>[실무 연관성 분석]<a hidden class=anchor aria-hidden=true href=#실무-연관성-분석-1>#</a></h3><ul><li><strong>데이터 무결성 및 회복력</strong>: 장애·데이터 손상 시 Event Log를 재생하여 복구 가능</li><li><strong>Audit 및 Compliance(규정 준수)</strong>: 모든 변경 이력 기록으로 법적·비즈니스 감사 필요시 효율적 대응</li><li><strong>비동기·확장성</strong>: 이벤트 기반 시스템, 마이크로서비스, CQRS 등과 자연스럽게 통합되어 확장성 강화</li><li><strong>디버깅 및 원인 분석</strong>: 상태 변경 원인 추적 및 과거 행동 재생으로 장애 원인 식별 용이</li><li><strong>모델 진화 및 시스템 리팩터링</strong>: 이벤트 구조 확장·변경이 상대적으로 자유로움 (단, 데이터 스키마·호환성 관리 필요)</li></ul><hr><h1 id=3단계-단계별-상세-조사-및-검증>3단계: 단계별 상세 조사 및 검증<a hidden class=anchor aria-hidden=true href=#3단계-단계별-상세-조사-및-검증>#</a></h1><h2 id=phase-1-기초-개념-foundation-understanding>Phase 1: 기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념-foundation-understanding>#</a></h2><h3 id=11-개념-정의-및-본질적-이해>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해>#</a></h3><p>Event Sourcing(이벤트 소싱)은 시스템/도메인의 상태를 직접 기록하지 않고, 상태를 변경한 “이벤트”를 순차적으로 저장하여, 발생한 모든 이벤트 이력을 Replay함으로써 원하는 시점의 상태를 재구성하는 패턴입니다.<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">4</a><a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a></p><h3 id=12-등장-배경-및-발전-과정>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정>#</a></h3><ul><li>기원: 회계(복식부기 Double-Entry Bookkeeping)에서 모든 트랜잭션의 이력 기록 개념에서 착안.</li><li>현대: Martin Fowler(2005) 및 Greg Young이 소프트웨어에 도입, CQRS와 함께 발전. MSA, 금융, 게임, 의료, 감사 및 추적성이 중요한 도메인에서 널리 활용되고 있음.<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">6</a></li></ul><h3 id=13-핵심-목적-및-필요성-문제-해결-관점>1.3 핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-문제-해결-관점>#</a></h3><ul><li>모든 변경 이력의 추적과 감사(Compliance/Audit)</li><li>과거 상태의 복원 및 장애 복구/데이터 무결성</li><li>비즈니스 규칙 복잡성 대응과 시스템 진화 지원</li></ul><h3 id=14-주요-특징-및-차별점-기술적-근거-포함>1.4 주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점-기술적-근거-포함>#</a></h3><ul><li>상태를 내부적으로 직접 저장하지 않는 점이 기존 CRUD와 차별점</li><li>데이터 모델 변경 이력 전체 기록(변경 사유·순서·영향 추적)</li><li>스냅샷 기반 성능 개선 가능</li><li>CQRS, 메시징 시스템과 연계하여 확장성 왜곡 없는 관리<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a><a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">6</a></li></ul><h2 id=phase-1-기초-개념-foundation-understanding-1>Phase 1: 기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념-foundation-understanding-1>#</a></h2><h3 id=11-개념-정의-및-본질적-이해-1>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해-1>#</a></h3><p>Event Sourcing은 <strong>애플리케이션 상태의 모든 변경사항을 이벤트의 시퀀스로 캡처하여 저장하는 아키텍처 패턴</strong>입니다. 전통적인 방식이 현재 상태만을 저장하는 것과 달리, Event Sourcing은 상태를 변경시킨 모든 사실(이벤트)들을 불변의 순서대로 기록합니다.</p><p><strong>핵심 철학</strong>: &ldquo;현재 상태는 과거에 일어난 모든 이벤트의 결과이다&rdquo;</p><p><strong>본질적 특징</strong>:</p><ul><li><strong>불변성(Immutability)</strong>: 한번 저장된 이벤트는 절대 변경되지 않음</li><li><strong>순서성(Ordering)</strong>: 이벤트들은 발생 순서대로 저장되어야 함</li><li><strong>재구성성(Reconstructability)</strong>: 이벤트 재생을 통해 언제든 과거 상태 복원 가능</li><li><strong>감사성(Auditability)</strong>: 모든 변경사항이 완벽히 추적됨</li></ul><h3 id=12-등장-배경-및-발전-과정-1>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정-1>#</a></h3><p><strong>등장 배경</strong>:</p><ol><li><strong>전통적 CRUD의 한계</strong>: 데이터 변경 이력 손실, 동시성 제어 복잡성</li><li><strong>비즈니스 요구사항 변화</strong>: 완벽한 감사 추적, 규정 준수 요구</li><li><strong>분산 시스템의 복잡성</strong>: 마이크로서비스 환경에서의 데이터 일관성 문제</li></ol><p><strong>발전 과정</strong>:</p><ul><li><strong>2005년</strong>: Martin Fowler가 개념 정립</li><li><strong>2010년대 초</strong>: 도메인 주도 설계(DDD) 커뮤니티에서 활발한 논의</li><li><strong>2015년 이후</strong>: Netflix, Uber 등 대기업의 실제 운영 사례 공개</li><li><strong>현재</strong>: 클라우드 네이티브 환경에서 표준 패턴으로 자리잡음</li></ul><h3 id=13-핵심-목적-및-필요성-문제-해결-관점-1>1.3 핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-문제-해결-관점-1>#</a></h3><p><strong>해결하는 주요 문제들</strong>:</p><blockquote><p>이 표는 Event Sourcing이 해결하는 핵심 문제들과 그 해결 방식을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>문제 영역</th><th>전통적 방식의 한계</th><th>Event Sourcing 해결책</th><th>비즈니스 가치</th></tr></thead><tbody><tr><td>감사 추적</td><td>변경 이력 손실, 별도 로그 시스템 필요</td><td>모든 변경사항이 이벤트로 자동 기록</td><td>규정 준수, 투명성 확보</td></tr><tr><td>디버깅</td><td>문제 발생 시점 상태 재현 불가</td><td>시간 여행 쿼리로 과거 상태 재현</td><td>개발 효율성 향상</td></tr><tr><td>비즈니스 분석</td><td>현재 상태만으로 제한적 분석</td><td>전체 이벤트 히스토리 기반 분석</td><td>데이터 기반 의사결정</td></tr><tr><td>시스템 진화</td><td>스키마 변경 시 기존 데이터 마이그레이션</td><td>이벤트 기반 유연한 스키마 진화</td><td>개발 민첩성</td></tr><tr><td>분산 시스템</td><td>분산 트랜잭션의 복잡성</td><td>이벤트 기반 최종 일관성</td><td>확장성, 가용성</td></tr></tbody></table><h3 id=14-주요-특징-및-차별점-기술적-근거-포함-1>1.4 주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점-기술적-근거-포함-1>#</a></h3><p><strong>핵심 특징</strong>:</p><ol><li><p><strong>Append-Only Storage (추가 전용 저장)</strong></p><ul><li>기술적 근거: 이벤트는 과거 사실이므로 변경될 수 없음</li><li>장점: 높은 쓰기 성능, 단순한 동시성 제어</li></ul></li><li><p><strong>Event Replay (이벤트 재생)</strong></p><ul><li>기술적 근거: 순차적 이벤트 적용으로 상태 재구성</li><li>장점: 시간 여행 쿼리, 새로운 읽기 모델 생성 가능</li></ul></li><li><p><strong>Strong Audit Trail (강력한 감사 추적)</strong></p><ul><li>기술적 근거: 모든 비즈니스 변경이 이벤트로 캡처됨</li><li>장점: 완벽한 변경 이력, 규정 준수 자동화</li></ul></li></ol><p><strong>차별점</strong>:</p><ul><li><strong>vs CRUD</strong>: 상태가 아닌 변경사항 저장</li><li><strong>vs Change Log</strong>: 비즈니스 의미가 담긴 이벤트 저장</li><li><strong>vs Audit Log</strong>: 이벤트가 시스템의 주 데이터 소스</li></ul><h2 id=phase-1-기초-개념>Phase 1: 기초 개념<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념>#</a></h2><h3 id=11-개념-정의-및-본질>1.1 개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질>#</a></h3><ul><li>현재 상태가 아닌 <strong>상태 변화의 기록</strong>을 영속화. 재생으로 어떤 시점의 상태든 재구성. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>)</li></ul><h3 id=12-등장-배경-및-발전>1.2 등장 배경 및 발전<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전>#</a></h3><ul><li>DDD/CQRS와 함께 확산. KurrentDB(구 EventStoreDB) 같은 전용 스토어 성숙, 클라우드 표준(CloudEvents)·Schema Registry로 생태계 정착. (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">Kurrent Docs</a>, <a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">cloudevents.io</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>)</li></ul><h3 id=13-핵심-목적필요성>1.3 핵심 목적/필요성<a hidden class=anchor aria-hidden=true href=#13-핵심-목적필요성>#</a></h3><ul><li><strong>감사 가능성</strong>, <strong>회귀 가능성(시간여행)</strong>, <strong>유연한 읽기 모델 재구축</strong>, <strong>의도 보존</strong>. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">Microsoft Learn</a>)</li></ul><h3 id=14-주요-특징차별점>1.4 주요 특징/차별점<a hidden class=anchor aria-hidden=true href=#14-주요-특징차별점>#</a></h3><ul><li>불변 로그, 도메인 언어에 밀착된 이벤트, 읽기 모델의 유연성, 강한 시간축 의미(원인→결과). (<a href="https://martinfowler.com/articles/201701-event-driven.html?utm_source=chatgpt.com" title="What do you mean by “Event-Driven”?">martinfowler.com</a>)</li></ul><h2 id=phase-2-핵심-원리>Phase 2: 핵심 원리<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리>#</a></h2><h3 id=21-설계-원칙>2.1 설계 원칙<a hidden class=anchor aria-hidden=true href=#21-설계-원칙>#</a></h3><ul><li><strong>불변성(Immutability)</strong>, <strong>단일 진실 원장</strong>, <strong>명령-이벤트 분리</strong>, <strong>읽기 모델은 캐시</strong>. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">Microsoft Learn</a>)</li></ul><h3 id=22-동작-메커니즘시퀀스>2.2 동작 메커니즘(시퀀스)<a hidden class=anchor aria-hidden=true href=#22-동작-메커니즘시퀀스>#</a></h3><pre class=mermaid>sequenceDiagram
  participant UI as UI/API
  participant CMD as Command Handler
  participant AGG as Aggregate
  participant ES as Event Store
  participant PRJ as Projection
  UI-&gt;&gt;CMD: PlaceOrder(cmd)
  CMD-&gt;&gt;AGG: validate + decide()
  AGG--&gt;&gt;CMD: Events [OrderPlaced, ItemAdded…]
  CMD-&gt;&gt;ES: append(events)
  ES--&gt;&gt;PRJ: publish(events)
  PRJ-&gt;&gt;PRJ: update read model
  UI-&gt;&gt;PRJ: GET /orders/{id}
  PRJ--&gt;&gt;UI: materialized view
</pre><h3 id=23-아키텍처-및-구성요소필수선택>2.3 아키텍처 및 구성요소(필수/선택)<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성요소필수선택>#</a></h3><pre class=mermaid>graph TB
  subgraph Write
    A[API Gateway] --&gt; B[Command Handler]
    B --&gt; C[Aggregate]
    C --&gt; D[(Event Store - append only)]
  end
  subgraph Infra(Optional)
    D --&gt; K[Stream Broker (Kafka/Event Hubs)]
  end
  subgraph Read
    K --&gt; P[Projector(s)]
    D --&gt; P
    P --&gt; R[(Read DB/Cache)]
  end
  classDef opt fill:#eef,stroke:#99f
  class K opt
</pre><ul><li>필수: Command Handler, Aggregate, Event Store, Projector/Read DB</li><li>선택: 브로커(Kafka 등), 스냅샷 저장소, 스키마 레지스트리, DLQ(Dead Letter Queue) 등. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Microsoft Learn</a>)</li></ul><h3 id=24-주요-기능과-역할>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할>#</a></h3><ul><li><strong>Aggregate</strong>: 불변 이벤트 산출.</li><li><strong>Event Store</strong>: 동시성 제어(스트림 버전), 순서 보장.</li><li><strong>Projector</strong>: idempotent 처리, 리드 모델 갱신.</li><li><strong>Schema Registry</strong>: 이벤트 진화 호환성 보장. (<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>)</li></ul><h2 id=phase-2-핵심-원리-core-theory>Phase 2: 핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리-core-theory>#</a></h2><h3 id=21-핵심-설계-원칙-및-철학>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학>#</a></h3><p><strong>설계 원칙</strong>:</p><ol><li><p><strong>이벤트 불변성 원칙</strong></p><ul><li>철학: 과거는 변경될 수 없다</li><li>구현: 이벤트 저장 후 수정/삭제 금지</li></ul></li><li><p><strong>이벤트 순서성 원칙</strong></p><ul><li>철학: 시간의 흐름을 반영해야 한다</li><li>구현: 글로벌 또는 집계별 순서 보장</li></ul></li><li><p><strong>단일 진실 원천 원칙</strong></p><ul><li>철학: 이벤트 스트림이 유일한 데이터 소스</li><li>구현: 모든 상태는 이벤트로부터 파생</li></ul></li><li><p><strong>의미 있는 이벤트 원칙</strong></p><ul><li>철학: 비즈니스 도메인 언어 사용</li><li>구현: 기술적이 아닌 도메인 중심 이벤트 명명</li></ul></li></ol><h3 id=22-기본-원리-및-동작-메커니즘>2.2 기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘>#</a></h3><p><strong>기본 동작 원리</strong>:</p><pre class=mermaid>graph TB
    A[Command 수신] --&gt; B[비즈니스 로직 검증]
    B --&gt; C[Event 생성]
    C --&gt; D[Event Store 저장]
    D --&gt; E[Event Handler 트리거]
    E --&gt; F[Projection 업데이트]
    
    G[상태 조회 요청] --&gt; H[Event 재생]
    H --&gt; I[상태 재구성]
    I --&gt; J[결과 반환]
    
    subgraph &#34;Write Side&#34;
        A
        B
        C
        D
    end
    
    subgraph &#34;Read Side&#34;
        E
        F
        G
        H
        I
        J
    end
</pre><p><strong>동작 단계별 설명</strong>:</p><ol><li><p><strong>Write Path (쓰기 경로)</strong>:</p><ul><li>Command 수신 → 도메인 검증 → Event 생성 → 저장</li><li>비즈니스 로직은 명령 처리 시에만 실행</li></ul></li><li><p><strong>Read Path (읽기 경로)</strong>:</p><ul><li>Event 스트림 읽기 → 순차적 재생 → 상태 재구성</li><li>또는 미리 구성된 Projection에서 조회</li></ul></li><li><p><strong>Projection Update (프로젝션 업데이트)</strong>:</p><ul><li>새 Event 발생 → Event Handler 호출 → 읽기 모델 갱신</li><li>비동기적으로 실행되어 쓰기 성능에 영향 없음</li></ul></li></ol><h3 id=23-아키텍처-및-구성-요소>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소>#</a></h3><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Command Side (Write)&#34;
        CMD[Command Handler] --&gt; AGG[Aggregate]
        AGG --&gt; EVT[Event]
        EVT --&gt; ES[Event Store]
    end
    
    subgraph &#34;Query Side (Read)&#34;
        ES --&gt; EH[Event Handler]
        EH --&gt; PROJ[Projection Store]
        PROJ --&gt; QH[Query Handler]
    end
    
    subgraph &#34;Infrastructure&#34;
        ES --&gt; SNAP[Snapshot Store]
        ES --&gt; MSG[Message Bus]
        MSG --&gt; EH
    end
    
    CLIENT[Client Application] --&gt; CMD
    CLIENT --&gt; QH
</pre><p><strong>핵심 구성 요소</strong>:</p><blockquote><p>이 표는 Event Sourcing 시스템의 필수 및 선택 구성 요소를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>구성 요소</th><th>역할</th><th>필수/선택</th><th>기술적 특징</th></tr></thead><tbody><tr><td>필수</td><td>Event Store</td><td>이벤트 저장 및 조회</td><td>필수</td><td>Append-only, 순서 보장</td></tr><tr><td>필수</td><td>Command Handler</td><td>명령 처리 및 이벤트 생성</td><td>필수</td><td>비즈니스 로직 포함</td></tr><tr><td>필수</td><td>Event Handler</td><td>이벤트 처리 및 프로젝션 업데이트</td><td>필수</td><td>멱등성 보장 필요</td></tr><tr><td>필수</td><td>Aggregate</td><td>도메인 모델 및 일관성 경계</td><td>필수</td><td>불변 규칙 검증</td></tr><tr><td>권장</td><td>Projection Store</td><td>읽기 모델 저장</td><td>권장</td><td>쿼리 최적화</td></tr><tr><td>선택</td><td>Snapshot Store</td><td>성능 최적화용 스냅샷</td><td>선택</td><td>큰 이벤트 스트림 처리</td></tr><tr><td>선택</td><td>Message Bus</td><td>이벤트 배포</td><td>선택</td><td>시스템 간 통신</td></tr></tbody></table><h3 id=24-주요-기능과-역할-1>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할-1>#</a></h3><p><strong>기능별 책임 분석</strong>:</p><ol><li><p><strong>이벤트 저장 (Event Storage)</strong></p><ul><li>기능: 모든 도메인 이벤트의 영구 저장</li><li>책임: 순서 보장, 동시성 제어, 데이터 무결성</li><li>구현 고려사항: 파티셔닝, 백업, 복구 전략</li></ul></li><li><p><strong>상태 재구성 (State Reconstruction)</strong></p><ul><li>기능: 이벤트 재생을 통한 현재/과거 상태 복원</li><li>책임: 이벤트 순서 적용, 스냅샷 활용</li><li>구현 고려사항: 성능 최적화, 메모리 관리</li></ul></li><li><p><strong>프로젝션 관리 (Projection Management)</strong></p><ul><li>기능: 읽기 모델 생성 및 유지보수</li><li>책임: 이벤트 처리, 뷰 업데이트, 오류 복구</li><li>구현 고려사항: 멱등성, 순서 보장, 장애 복구</li></ul></li><li><p><strong>시간 여행 쿼리 (Temporal Queries)</strong></p><ul><li>기능: 특정 시점의 상태 조회</li><li>책임: 이벤트 필터링, 부분 재생</li><li>구현 고려사항: 쿼리 성능, 메모리 효율성</li></ul></li></ol><h2 id=phase-2-핵심-원리-core-theory-1>Phase 2: 핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리-core-theory-1>#</a></h2><h3 id=21-핵심-설계-원칙-및-철학-1>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학-1>#</a></h3><ul><li>단일 진실(SSOT, Single Source Of Truth)은 이벤트 로그에 존재함</li><li>불변 이벤트 원칙(Immutable Event)은 데이터 일관성을 보장</li><li>이벤트 흐름 재생(Replay)을 통한 상태 재구성</li></ul><h3 id=22-기본-원리-및-동작-메커니즘-1>2.2 기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘-1>#</a></h3><pre class=mermaid>graph TD
    A[시스템 사용자] --&gt; B[Command 입력]
    B --&gt; C[도메인 모델]
    C --&gt; D[이벤트 생성]
    D --&gt; E[Event Store 이벤트 저장소(append-only)]
    E --&gt; F[이벤트 Replay]
    F --&gt; G[상태 복원 및 조회]
</pre><ul><li>상태 변경 시 Command → 도메인 모델 처리 → 이벤트 생성 → Event Store에 저장.</li><li>상태 조회 시 이벤트 Replay(혹은 Snapshot을 기반으로 짧은 Replay)로 현재 상태 계산.</li></ul><h3 id=23-아키텍처-및-구성-요소-1>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소-1>#</a></h3><ul><li>Command Handler(명령 처리기)</li><li>Domain Model(도메인 모델)</li><li>Event Store(이벤트 저장소)</li><li>Snapshot Manager(스냅샷 관리)</li><li>Query Projection/Read Model(조회용 모델)</li><li>Event Publisher(이벤트 발행 및 외부 연계)</li></ul><h3 id=24-주요-기능과-역할-2>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할-2>#</a></h3><ul><li>이력 추적(audit trail)</li><li>장애 복구 및 상태 재구성</li><li>비즈니스 규칙 변경 관리</li><li>확장성, Model 진화, 이벤트 기반 외부 연동</li></ul><hr><h2 id=phase-3-특성-분석-characteristics-analysis>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis>#</a></h2><blockquote><p>이 표는 Event Sourcing의 장점과 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 설명 | 기술적 근거 | 실무 효과 |
</span></span><span class=line><span class=cl>|------|------|------|-------------|-----------|
</span></span><span class=line><span class=cl>| 장점 | 이력 관리 | 모든 상태 변경 과정 기록 | 이벤트 기반 저장 방식 | 장애 복구, 감사 대응 |
</span></span><span class=line><span class=cl>| 장점 | 감시/감사성 | 변경 원인·내역 명확 | 이벤트 원장으로 감사 이력 보존 | 규정 준수 강화, 법적 증명 |
</span></span><span class=line><span class=cl>| 장점 | 시스템 진화성 | 도메인 모델 변경·확장 용이 | 불변 이벤트와 버전 관리 | 비즈니스 변화 대응, 모델 확장 |
</span></span><span class=line><span class=cl>| 장점 | CQRS와 시너지 | 읽기/쓰기 분리와 구조화 | 커맨드, 쿼리 모델 분리 | 확장성·성능 개선 |
</span></span><span class=line><span class=cl>| 장점 | 외부 연동 활성화 | 이벤트 기반 이벤트 브로커 연동 편리 | Kafka, RabbitMQ 등 메시지 큐 연계 | 확장·분산 시스템 통합 |
</span></span></code></pre></td></tr></table></div></div><hr><blockquote><p>이 표는 Event Sourcing의 단점과 제약사항, 그리고 해결방안을 종합적으로 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 설명 | 해결책 | 대안 기술 |
</span></span><span class=line><span class=cl>|------|------|------|--------|----------|
</span></span><span class=line><span class=cl>| 단점 | 이벤트 관리 복잡성 | 이벤트 스키마 및 버전 관리 필요 | 스키마 버저닝, 하위 호환성 정책 적용 | CDC(Change Data Capture) 등 |
</span></span><span class=line><span class=cl>| 단점 | 성능 저하 | 대량 이벤트시 Replay 부담 | Snapshot, Projection, 이벤트 병렬 처리 | 단순 CRUD 저장 |
</span></span><span class=line><span class=cl>| 단점 | 데이터 정합성 | 이벤트 순서 장애 시 상태 유실 위험 | 이벤트 순서 보장, 멱등성(idempotency) 구현 | Outbox 패턴, 트랜잭션 로그 |
</span></span><span class=line><span class=cl>| 단점 | Learning Curve | 설계·운영·모델링이 복잡 | 교육, 도구 사용, 샘플 구현 참고 | 전통적 CRUD/ORM |
</span></span></code></pre></td></tr></table></div></div><h2 id=phase-3-특성-분석-characteristics-analysis-1>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis-1>#</a></h2><h3 id=31-장점-및-이점-구분-기술-근거-포함한-표로-정리>3.1 장점 및 이점 (구분, 기술 근거 포함한 표로 정리)<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점-구분-기술-근거-포함한-표로-정리>#</a></h3><blockquote><p>이 표는 Event Sourcing의 장점과 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>감사성</td><td>완벽한 감사 추적</td><td>모든 변경사항의 완전한 기록</td><td>이벤트의 불변성과 순서성 보장</td><td>규정 준수 자동화, 투명성 확보</td></tr><tr><td>분석성</td><td>시간 여행 쿼리</td><td>과거 임의 시점의 상태 재현</td><td>이벤트 재생을 통한 상태 재구성</td><td>디버깅 효율성, 비즈니스 분석</td></tr><tr><td>확장성</td><td>읽기/쓰기 분리</td><td>CQRS와 결합하여 독립적 확장</td><td>이벤트 저장과 프로젝션의 분리</td><td>성능 최적화, 시스템 확장성</td></tr><tr><td>유연성</td><td>스키마 진화</td><td>기존 데이터 마이그레이션 없이 스키마 변경</td><td>이벤트 기반 느슨한 결합</td><td>개발 민첩성, 변경 비용 절감</td></tr><tr><td>복원성</td><td>시스템 복구</td><td>이벤트 재생으로 시스템 상태 복구</td><td>이벤트 스트림의 영속성</td><td>장애 복구 시간 단축</td></tr><tr><td>분산성</td><td>이벤트 기반 통신</td><td>마이크로서비스 간 느슨한 결합</td><td>비동기 이벤트 메시징</td><td>시스템 독립성, 장애 격리</td></tr><tr><td>성능</td><td>최적화된 쓰기</td><td>단순한 append-only 연산</td><td>복잡한 업데이트 로직 제거</td><td>높은 쓰기 처리량</td></tr><tr><td>테스트</td><td>행위 기반 테스트</td><td>이벤트 시퀀스로 비즈니스 로직 검증</td><td>명확한 입력/출력 정의</td><td>테스트 코드 품질 향상</td></tr></tbody></table><h3 id=32-단점-및-제약사항과-해결방안>3.2 단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#32-단점-및-제약사항과-해결방안>#</a></h3><p><strong>단점</strong></p><blockquote><p>이 표는 Event Sourcing의 단점과 제약사항, 그리고 해결방안을 종합적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>복잡성</td><td>초기 학습 곡선</td><td>개념 이해와 구현의 복잡성</td><td>단계적 도입, 교육 투자</td><td>전통적 CRUD + 별도 감사 로그</td></tr><tr><td>성능</td><td>읽기 성능 저하</td><td>이벤트 재생으로 인한 지연</td><td>스냅샷, 프로젝션 활용</td><td>Materialized View</td></tr><tr><td>저장소</td><td>용량 증가</td><td>모든 이벤트 저장으로 인한 용량 팽창</td><td>이벤트 압축, 아카이빙</td><td>주기적 데이터 정리</td></tr><tr><td>일관성</td><td>최종 일관성</td><td>즉시 일관성 보장 어려움</td><td>적절한 동기화 지점 설정</td><td>동기식 데이터베이스</td></tr><tr><td>진화</td><td>이벤트 스키마 변경</td><td>기존 이벤트와의 호환성 문제</td><td>이벤트 버저닝 전략</td><td>스키마 마이그레이션</td></tr></tbody></table><p><strong>문제점</strong></p><blockquote><p>이 표는 Event Sourcing 구현 시 발생할 수 있는 구체적인 문제점들과 대응 방안을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>성능</td><td>이벤트 재생 지연</td><td>대량 이벤트 누적</td><td>응답 시간 증가</td><td>성능 모니터링</td><td>주기적 스냅샷</td><td>스냅샷 + 증분 재생</td></tr><tr><td>데이터</td><td>이벤트 순서 오류</td><td>동시성, 네트워크 지연</td><td>상태 불일치</td><td>순서 검증 로직</td><td>벡터 클록, 타임스탬프</td><td>순서 정정 및 재생</td></tr><tr><td>저장소</td><td>이벤트 손실</td><td>저장소 장애, 네트워크 오류</td><td>데이터 무결성 손상</td><td>체크섬, 중복 검사</td><td>다중 복제, 트랜잭션</td><td>백업에서 복구</td></tr><tr><td>통합</td><td>외부 시스템 중복 호출</td><td>이벤트 재생 시 사이드 이펙트</td><td>비즈니스 로직 오류</td><td>게이트웨이 로그 분석</td><td>멱등성 설계</td><td>재생 모드 플래그</td></tr><tr><td>스키마</td><td>이벤트 호환성 문제</td><td>스키마 변경 시 하위 호환성</td><td>이벤트 파싱 오류</td><td>스키마 검증</td><td>점진적 스키마 진화</td><td>이벤트 업캐스팅</td></tr></tbody></table><h3 id=33-트레이드오프-관계-분석>3.3 트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#33-트레이드오프-관계-분석>#</a></h3><p><strong>주요 트레이드오프</strong>:</p><ol><li><p><strong>복잡성 vs 이점</strong></p><ul><li>초기 구현 복잡성 ↔ 장기적 유지보수성 및 감사 능력</li><li>권장: 감사 요구사항이 높은 도메인부터 적용</li></ul></li><li><p><strong>저장 용량 vs 정보 풍부성</strong></p><ul><li>증가하는 저장 비용 ↔ 완벽한 히스토리 정보</li><li>권장: 비즈니스 가치 기반 이벤트 보존 정책 수립</li></ul></li><li><p><strong>읽기 성능 vs 쓰기 단순성</strong></p><ul><li>이벤트 재생 비용 ↔ 단순한 append-only 쓰기</li><li>권장: 적절한 스냅샷 주기와 프로젝션 전략</li></ul></li><li><p><strong>일관성 vs 가용성</strong></p><ul><li>최종 일관성 ↔ 높은 가용성 및 확장성</li><li>권장: 비즈니스 요구사항에 따른 일관성 레벨 선택</li></ul></li></ol><h3 id=34-성능-특성-및-확장성-분석>3.4 성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#34-성능-특성-및-확장성-분석>#</a></h3><p><strong>성능 특성</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;쓰기 성능&#34;
        W1[단순 Append] --&gt; W2[높은 처리량]
        W3[동시성 제어 단순화] --&gt; W2
    end
    
    subgraph &#34;읽기 성능&#34;
        R1[이벤트 재생] --&gt; R2[지연 증가]
        R3[스냅샷] --&gt; R4[성능 최적화]
        R5[프로젝션] --&gt; R4
    end
    
    subgraph &#34;확장성&#34;
        S1[수평 파티셔닝] --&gt; S2[선형 확장]
        S3[읽기/쓰기 분리] --&gt; S2
    end
</pre><p><strong>확장성 전략</strong>:</p><blockquote><p>이 표는 Event Sourcing의 확장성 전략과 구현 방법을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>영역</th><th>전략</th><th>구현 방법</th><th>예상 효과</th><th>주의사항</th></tr></thead><tbody><tr><td>쓰기 확장</td><td>Aggregate 기반 샤딩</td><td>집계 ID로 파티셔닝</td><td>쓰기 처리량 선형 증가</td><td>크로스 집계 쿼리 복잡성</td></tr><tr><td>읽기 확장</td><td>다중 프로젝션</td><td>읽기 전용 복제본</td><td>읽기 처리량 확장</td><td>데이터 일관성 관리</td></tr><tr><td>저장소 확장</td><td>시간 기반 파티셔닝</td><td>월/연도별 이벤트 저장</td><td>쿼리 성능 최적화</td><td>크로스 파티션 쿼리</td></tr><tr><td>처리 확장</td><td>병렬 이벤트 처리</td><td>메시지 큐 기반 분산</td><td>처리 지연 감소</td><td>순서 보장 복잡성</td></tr></tbody></table><h2 id=phase-3-특성-분석>Phase 3: 특성 분석<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석>#</a></h2><blockquote><p><strong>이 표는</strong> Event Sourcing의 장점을 기술 근거와 함께 체계적으로 비교하기 위해 작성되었습니다.</p></blockquote><h3 id=31-장점-분석표>3.1 장점 분석표<a hidden class=anchor aria-hidden=true href=#31-장점-분석표>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 설명 | 기술적 근거 | 실무 효과 |
</span></span><span class=line><span class=cl>|------|------|------|-------------|-----------|
</span></span><span class=line><span class=cl>| 장점 | 감사 추적 | 모든 변화가 이벤트로 남음 | Append-only 로그 | 규제/감사 대응 용이 |
</span></span><span class=line><span class=cl>| 장점 | 시간여행 | 任의 시점 상태 재구성 | 이벤트 재생(replay) | 사고 복구/버그 재현 |
</span></span><span class=line><span class=cl>| 장점 | 뷰 유연성 | 리드 모델 재구축 | 프로젝션/머티리얼라이즈드 뷰 | 스키마 변경/신규 리포트 신속 |
</span></span><span class=line><span class=cl>| 장점 | 결합도 감소 | 이벤트 기반 통신 | 브로커/구독 모델 | 팀 간 독립 배포, 확장성 |
</span></span><span class=line><span class=cl>| 장점 | 의도 보존 | 도메인 용어의 이벤트 | DDD 이벤트 | 요구사항 가시성↑ |
</span></span></code></pre></td></tr></table></div></div><p>근거: Fowler·Azure 패턴 문서. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Microsoft Learn</a>)</p><blockquote><p><strong>이 표는</strong> 단점·제약과 해결방안을 종합 분석하기 위해 작성되었습니다.</p></blockquote><h3 id=32-단점문제점-표>3.2 단점/문제점 표<a hidden class=anchor aria-hidden=true href=#32-단점문제점-표>#</a></h3><p><strong>단점</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 설명 | 해결책 | 대안 기술 |
</span></span><span class=line><span class=cl>|------|------|------|--------|----------|
</span></span><span class=line><span class=cl>| 단점 | 복잡도 | 모델·인프라 복잡 | 표준화(CloudEvents/AsyncAPI), 템플릿화 | CRUD + Outbox/CDC |
</span></span><span class=line><span class=cl>| 단점 | 일관성 지연 | Eventually Consistent | UX 패턴(스피너/보류), 읽기 갱신 알림 | 트랜잭션 DB 직갱신 |
</span></span><span class=line><span class=cl>| 단점 | 재생 비용 | 긴 히스토리 재생 비용 | 스냅샷/캐시/배치 초기화 | 상태 저장 모델 |
</span></span><span class=line><span class=cl>| 단점 | 스키마 진화 | 이벤트 버전 관리 필요 | Schema Registry, 업캐스팅 | CDC + 단일 스키마 |
</span></span><span class=line><span class=cl>| 단점 | GDPR/삭제 | 불변 vs 삭제 권리 충돌 | 암호화 키 파기/레드액션/스트림 재구성 | 상태 저장 + TTL |
</span></span></code></pre></td></tr></table></div></div><p><strong>문제점</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 원인 | 영향 | 탐지/진단 | 예방 방법 | 해결 기법 |
</span></span><span class=line><span class=cl>|------|------|------|------|-----------|----------|----------|
</span></span><span class=line><span class=cl>| 문제점 | 중복 이벤트 | 재시도/네트워크 | 이중 적요 | 소비자 랙/중복율 모니터링 | idempotency key, 트랜잭션 | Kafka EOS/트랜잭션 |
</span></span><span class=line><span class=cl>| 문제점 | 역호환 실패 | 스키마 변경 | 소비자 장애 | 스키마 호환성 테스트 | BACKWARD/FULL 모드 | 업캐스팅/이중발행 |
</span></span><span class=line><span class=cl>| 문제점 | 느린 프로젝션 | 대량 재생 | SLA 미준수 | 처리율/지연 모니터링 | 스냅샷, 파티셔닝 | 병렬 projector/백필 |
</span></span></code></pre></td></tr></table></div></div><p>GDPR·EOS·Schema 근거. (<a href="https://www.hashicorp.com/en/resources/gdpr-compliant-event-sourcing-with-hashicorp-vault?utm_source=chatgpt.com" title="GDPR Compliant Event Sourcing With HashiCorp Vault">HashiCorp | An IBM Company</a>, <a href="https://event-driven.io/en/gdpr_in_event_driven_architecture/?utm_source=chatgpt.com" title="How to deal with privacy and GDPR in Event-Driven systems">event-driven.io</a>, <a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">Confluent Docs</a>)</p><h3 id=33-트레이드오프>3.3 트레이드오프<a hidden class=anchor aria-hidden=true href=#33-트레이드오프>#</a></h3><ul><li><strong>단순성(CRUD) vs 감사/유연성(ES)</strong></li><li><strong>즉시 일관성 vs 확장성/분리 배포</strong></li><li><strong>저장 공간↑ vs 분석 가치↑</strong></li></ul><h3 id=34-성능확장성>3.4 성능/확장성<a hidden class=anchor aria-hidden=true href=#34-성능확장성>#</a></h3><ul><li>파티셔닝 키 설계(스트림당 순서), 배치 프로젝션, 스냅샷 간격 튜닝, 브로커 EOS 활용. (<a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">Domain Centric</a>, <a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>)</li></ul><hr><h2 id=phase-4-구현-및-분류>Phase 4: 구현 및 분류<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류>#</a></h2><h3 id=41-구현-기법방법예시-포함>4.1 구현 기법/방법(예시 포함)<a hidden class=anchor aria-hidden=true href=#41-구현-기법방법예시-포함>#</a></h3><ul><li><strong>전용 스토어</strong>: KurrentDB(EventStoreDB) 스트림+버전 기반 동시성. (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">Kurrent Docs</a>)</li><li><strong>브로커 기반</strong>: Kafka 토픽을 이벤트 로그로 사용, 압축/트랜잭션으로 정확성 향상. (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>)</li><li><strong>범용 DB</strong>: Postgres/Mongo를 키-값 스트림으로 설계(스트림ID+버전 인덱스), 스냅샷 테이블 병행. (<a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">event-driven.io</a>)</li></ul><p><strong>Python 예시(인메모리 이벤트 스토어 + 스냅샷)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53>53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54>54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55>55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56>56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57>57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58>58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59>59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60>60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61>61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62>62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63>63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64>64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65>65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66>66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67>67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68>68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69>69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70>70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71>71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72>72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73>73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74>74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75>75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76>76</a>
</span><span class=lnt id=hl-11-77><a class=lnlinks href=#hl-11-77>77</a>
</span><span class=lnt id=hl-11-78><a class=lnlinks href=#hl-11-78>78</a>
</span><span class=lnt id=hl-11-79><a class=lnlinks href=#hl-11-79>79</a>
</span><span class=lnt id=hl-11-80><a class=lnlinks href=#hl-11-80>80</a>
</span><span class=lnt id=hl-11-81><a class=lnlinks href=#hl-11-81>81</a>
</span><span class=lnt id=hl-11-82><a class=lnlinks href=#hl-11-82>82</a>
</span><span class=lnt id=hl-11-83><a class=lnlinks href=#hl-11-83>83</a>
</span><span class=lnt id=hl-11-84><a class=lnlinks href=#hl-11-84>84</a>
</span><span class=lnt id=hl-11-85><a class=lnlinks href=#hl-11-85>85</a>
</span><span class=lnt id=hl-11-86><a class=lnlinks href=#hl-11-86>86</a>
</span><span class=lnt id=hl-11-87><a class=lnlinks href=#hl-11-87>87</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>asdict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 이벤트 정의 (도메인 이벤트) ---</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span><span class=p>(</span><span class=n>frozen</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FundsDeposited</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># 이벤트 버전(스키마 진화 대비)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span><span class=p>(</span><span class=n>frozen</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FundsWithdrawn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 이벤트 스토어(append-only) ---</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>streams</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>expected_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=n>stream</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>streams</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>        <span class=c1># 낙관적 동시성: 스트림 길이가 기대 버전과 일치해야 함</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>stream</span><span class=p>)</span> <span class=o>!=</span> <span class=n>expected_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Concurrency conflict&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>stream</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=n>e</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=s2>&#34;payload&#34;</span><span class=p>:</span> <span class=n>asdict</span><span class=p>(</span><span class=n>e</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>streams</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>version</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>stream_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=n>version</span><span class=p>,</span> <span class=s2>&#34;state&#34;</span><span class=p>:</span> <span class=n>state</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>stream_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 어그리게이트(결정 로직 + 이벤트 적용) ---</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Account</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=n>account_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># 이벤트 카운트 == 현재 스트림 버전</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Any</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>FundsDeposited</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>+=</span> <span class=n>event</span><span class=o>.</span><span class=n>amount</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>FundsWithdrawn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>event</span><span class=o>.</span><span class=n>amount</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decide_deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>amount</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>FundsDeposited</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>v</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decide_withdraw</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>&lt;</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Insufficient funds&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>FundsWithdrawn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>v</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rehydrate</span><span class=p>(</span><span class=n>store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Account</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>snap</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>load_snapshot</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>snap</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>acc</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=n>snap</span><span class=p>[</span><span class=s2>&#34;state&#34;</span><span class=p>][</span><span class=s2>&#34;balance&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>acc</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>snap</span><span class=p>[</span><span class=s2>&#34;version&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>start</span> <span class=o>=</span> <span class=n>snap</span><span class=p>[</span><span class=s2>&#34;version&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>store</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>account_id</span><span class=p>)[</span><span class=n>start</span><span class=p>:]:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 업캐스팅 지점: e[&#34;payload&#34;][&#34;v&#34;] 버전에 따라 변환 가능</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>e</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;FundsDeposited&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>acc</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>FundsDeposited</span><span class=p>(</span><span class=o>**</span><span class=n>e</span><span class=p>[</span><span class=s2>&#34;payload&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>e</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;FundsWithdrawn&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>acc</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>FundsWithdrawn</span><span class=p>(</span><span class=o>**</span><span class=n>e</span><span class=p>[</span><span class=s2>&#34;payload&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>acc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예: # Event Sourcing의 핵심(append-only + 재생 + 스냅샷)</span>
</span></span><span class=line><span class=cl><span class=n>store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=s2>&#34;A-1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ev</span> <span class=o>=</span> <span class=n>acc</span><span class=o>.</span><span class=n>decide_deposit</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;A-1&#34;</span><span class=p>,</span> <span class=n>acc</span><span class=o>.</span><span class=n>version</span><span class=p>,</span> <span class=n>ev</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>ev</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 스냅샷 저장(재생 최적화)</span>
</span></span><span class=line><span class=cl><span class=n>store</span><span class=o>.</span><span class=n>save_snapshot</span><span class=p>(</span><span class=s2>&#34;A-1&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;balance&#34;</span><span class=p>:</span> <span class=n>acc</span><span class=o>.</span><span class=n>balance</span><span class=p>},</span> <span class=n>acc</span><span class=o>.</span><span class=n>version</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>JavaScript(노드) – CloudEvents 헤더를 가진 이벤트 발행 스케치</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// npm: cloudevents, kafka-js 가정. CloudEvents 메타데이터로 상호운용성 확보.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>CloudEvent</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;cloudevents&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;kafkajs&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span> <span class=nx>clientId</span><span class=o>:</span> <span class=s2>&#34;ledger&#34;</span><span class=p>,</span> <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;localhost:9092&#34;</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>producer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>({</span> <span class=nx>idempotent</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>transactionalId</span><span class=o>:</span> <span class=s2>&#34;ledger-tx-1&#34;</span> <span class=p>});</span> <span class=c1>// EOS 준비
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>buildEvent</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>evt</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CloudEvent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=p>,</span> <span class=c1>// ex) &#34;com.myapp.funds.deposited&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>source</span><span class=o>:</span> <span class=s2>&#34;/accounts/A-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=p>,</span> <span class=c1>// { accountId, amount, v }
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>key</span><span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>evt</span><span class=p>)</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>buildEvent</span><span class=p>(</span><span class=s2>&#34;com.myapp.funds.deposited&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>accountId</span><span class=o>:</span> <span class=s2>&#34;A-1&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span> <span class=nx>v</span><span class=o>:</span> <span class=mi>1</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span> <span class=nx>topic</span><span class=o>:</span> <span class=s2>&#34;account-events&#34;</span><span class=p>,</span> <span class=nx>messages</span><span class=o>:</span> <span class=p>[</span><span class=nx>message</span><span class=p>]</span> <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>Kafka EOS/트랜잭션·스키마 호환성·CloudEvents 표준 근거. (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>, <a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">Confluent Docs</a>, <a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">cloudevents.io</a>)</p><h3 id=42-유형-분류기준-저장소브로커호환성스냅샷>4.2 유형 분류(기준: 저장소/브로커/호환성/스냅샷)<a hidden class=anchor aria-hidden=true href=#42-유형-분류기준-저장소브로커호환성스냅샷>#</a></h3><blockquote><p><strong>이 표는</strong> 구현 선택지를 비교·분류해 아키텍처 결정을 돕기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 기준 | 유형 | 설명 | 장점 | 주의점 |
</span></span><span class=line><span class=cl>|-----|------|------|-----|-------|
</span></span><span class=line><span class=cl>| 저장소 | 전용(EventStoreDB/KurrentDB) | 스트림+버전, 프로젝션 | ES 최적화 | 운영 러닝커브 |
</span></span><span class=line><span class=cl>| 저장소 | 브로커(Kafka as log) | 토픽=스트림 | 확장성/EOS | 외부 상태 업데이트 EOS 한계 |
</span></span><span class=line><span class=cl>| 저장소 | 범용 DB | PK=스트림ID, 버전 | 도입 용이 | 설계·경합 제어 필요 |
</span></span><span class=line><span class=cl>| 호환성 | Schema Registry | Avro/JSON/Proto | 진화/검증 | 운영 추가 구성 |
</span></span><span class=line><span class=cl>| 스냅샷 | 주기/조건 기반 | N 이벤트마다 | 성능 향상 | 과다 사용 지양 |
</span></span></code></pre></td></tr></table></div></div><p>(<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">Kurrent Docs</a>, <a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>, <a href="https://engineering.hellofresh.com/demystifying-kafka-exactly-once-semantics-eos-390ae1c32bba?utm_source=chatgpt.com" title="Demystifying Kafka Exactly Once Semantics (EOS) - HelloTech">HelloTech</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>, <a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">Domain Centric</a>)</p><h3 id=43-도구프레임워크-생태계>4.3 도구/프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구프레임워크-생태계>#</a></h3><ul><li><strong>KurrentDB(EventStoreDB)</strong>, Marten(.NET, Postgres), eventsourcing(Py), Eventuous(.NET), Kafka+Schema Registry, Azure Event Hubs/Cosmos DB 샘플. (<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">GitHub</a>, <a href="https://martendb.io/events/versioning?utm_source=chatgpt.com" title="Events Versioning | Marten">martendb.io</a>, <a href="https://eventsourcing.readthedocs.io/?utm_source=chatgpt.com" title="Event Sourcing in Python — eventsourcing 9.4.6 documentation">eventsourcing.readthedocs.io</a>, <a href="https://eventuous.dev/docs/infra/esdb/?utm_source=chatgpt.com" title="EventStoreDB - Eventuous">eventuous.dev</a>, <a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing">Microsoft Learn</a>)</li></ul><h3 id=44-표준규격>4.4 표준/규격<a hidden class=anchor aria-hidden=true href=#44-표준규격>#</a></h3><ul><li><strong>CloudEvents 1.0</strong>(CNCF Graduated 2024): id/source/type/specversion.</li><li><strong>AsyncAPI</strong>: 이벤트 계약 문서화·검증·거버넌스.</li><li><strong>OpenTelemetry</strong>: Messaging/Kafka 시맨틱 컨벤션으로 트레이싱/메트릭 표준화. (<a href="https://github.com/cloudevents/spec?utm_source=chatgpt.com" title="CloudEvents Specification">GitHub</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">Microsoft Learn</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">asyncapi.com</a>, <a href="https://opentelemetry.io/docs/specs/semconv/messaging/messaging-spans/?utm_source=chatgpt.com" title="Semantic conventions for messaging spans">OpenTelemetry</a>)</li></ul><h2 id=phase-4-구현-및-분류-implementation--classification>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification>#</a></h2><h3 id=41-구현-기법-및-방법>4.1 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법>#</a></h3><p><strong>주요 구현 패턴</strong>:</p><ol><li><p><strong>Command Sourcing Pattern</strong></p><ul><li><strong>정의</strong>: 명령 자체를 저장하는 방식</li><li><strong>구성</strong>: Command Store + Command Processor</li><li><strong>목적</strong>: 명령 재실행을 통한 상태 재구성</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>CommandStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>store_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 명령을 직접 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;command_id&#39;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;command_type&#39;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>to_dict</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Event Sourcing with CQRS Pattern</strong></p><ul><li><strong>정의</strong>: 명령과 쿼리 모델을 분리한 이벤트 소싱</li><li><strong>구성</strong>: Command Model + Event Store + Query Model</li><li><strong>목적</strong>: 읽기/쓰기 최적화 및 복잡성 관리</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Model - 쓰기 전용</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderAggregate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 검증</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>event</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Model - 읽기 전용</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 읽기 모델 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>update_view</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Snapshot Pattern</strong></p><ul><li><strong>정의</strong>: 주기적으로 현재 상태를 저장하여 성능 최적화</li><li><strong>구성</strong>: Snapshot Store + Snapshot Strategy</li><li><strong>목적</strong>: 긴 이벤트 스트림의 재생 시간 단축</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotStrategy</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>should_create_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 개수 또는 시간 기준</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>version</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>snapshot</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;aggregate_id&#39;</span><span class=p>:</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;state&#39;</span><span class=p>:</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>get_state</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Event Versioning Pattern</strong></p><ul><li><strong>정의</strong>: 이벤트 스키마 변경 시 호환성 유지</li><li><strong>구성</strong>: Event Upgrader + Version Registry</li><li><strong>목적</strong>: 스키마 진화 시 기존 이벤트 호환성 보장</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventUpgrader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>upgrade_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>,</span> <span class=n>from_version</span><span class=p>,</span> <span class=n>to_version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>from_version</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>to_version</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># V1 이벤트를 V2로 변환</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;new_field&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;default_value&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>event_data</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=42-분류-기준에-따른-유형-구분>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분>#</a></h3><blockquote><p>이 표는 Event Sourcing의 다양한 구현 유형을 체계적으로 분류하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 사례</th><th>장점</th><th>단점</th></tr></thead><tbody><tr><td>저장 방식</td><td>Full Event Sourcing</td><td>모든 상태가 이벤트에서 파생</td><td>금융 시스템, 감사 시스템</td><td>완벽한 추적성</td><td>복잡성 높음</td></tr><tr><td>저장 방식</td><td>Hybrid Sourcing</td><td>일부 데이터만 이벤트 소싱</td><td>E-commerce 주문 관리</td><td>점진적 도입 가능</td><td>일관성 관리 복잡</td></tr><tr><td>일관성</td><td>Strong Consistency</td><td>즉시 일관성 보장</td><td>결제 시스템</td><td>데이터 정확성</td><td>성능 제약</td></tr><tr><td>일관성</td><td>Eventual Consistency</td><td>최종 일관성</td><td>소셜 미디어 피드</td><td>높은 가용성</td><td>일시적 불일치</td></tr><tr><td>스코프</td><td>Aggregate-based</td><td>집계 단위 이벤트 소싱</td><td>DDD 기반 시스템</td><td>명확한 경계</td><td>크로스 집계 쿼리 제한</td></tr><tr><td>스코프</td><td>Global Event Sourcing</td><td>전체 시스템 이벤트 소싱</td><td>마이크로서비스 통신</td><td>시스템 전체 추적</td><td>복잡성 극대화</td></tr></tbody></table><h3 id=43-도구-및-프레임워크-생태계>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계>#</a></h3><p><strong>Event Store 솔루션</strong>:</p><blockquote><p>이 표는 Event Sourcing 구현을 위한 주요 도구와 프레임워크를 비교 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>도구/프레임워크</th><th>언어/플랫폼</th><th>주요 특징</th><th>적합한 용도</th><th>라이선스</th></tr></thead><tbody><tr><td>전용 Event Store</td><td>EventStore</td><td>.NET/다중언어</td><td>전용 이벤트 저장소, JS 프로젝션</td><td>순수 Event Sourcing</td><td>오픈소스</td></tr><tr><td>전용 Event Store</td><td>Axon Server</td><td>Java</td><td>CQRS+ES 통합, 메시지 라우팅</td><td>Java 기반 DDD</td><td>오픈소스/상용</td></tr><tr><td>범용 스트리밍</td><td>Apache Kafka</td><td>다중언어</td><td>높은 처리량, 분산 스트리밍</td><td>이벤트 스트리밍 + ES</td><td>Apache 2.0</td></tr><tr><td>프레임워크</td><td>Axon Framework</td><td>Java</td><td>DDD+CQRS+ES 통합</td><td>엔터프라이즈 Java</td><td>Apache 2.0</td></tr><tr><td>프레임워크</td><td>Eventide</td><td>Ruby</td><td>함수형 ES, 메시지 기반</td><td>Ruby 마이크로서비스</td><td>MIT</td></tr><tr><td>클라우드 서비스</td><td>AWS EventBridge</td><td>클라우드</td><td>서버리스 이벤트 라우팅</td><td>AWS 생태계</td><td>상용</td></tr><tr><td>클라우드 서비스</td><td>Azure Event Hubs</td><td>클라우드</td><td>대규모 이벤트 수집</td><td>Azure 생태계</td><td>상용</td></tr><tr><td>데이터베이스</td><td>PostgreSQL</td><td>SQL</td><td>JSONB 지원, 강력한 쿼리</td><td>하이브리드 접근</td><td>PostgreSQL</td></tr></tbody></table><p><strong>언어별 구현 라이브러리</strong>:</p><table><thead><tr><th>언어</th><th>주요 라이브러리</th><th>특징</th><th>성숙도</th></tr></thead><tbody><tr><td>Java</td><td>Axon Framework</td><td>완전한 DDD+CQRS+ES 솔루션</td><td>매우 높음</td></tr><tr><td>C#</td><td>EventStore Client</td><td>EventStore 공식 클라이언트</td><td>높음</td></tr><tr><td>Python</td><td>eventsourcing</td><td>순수 파이썬 구현</td><td>중간</td></tr><tr><td>JavaScript</td><td>EventStore.js</td><td>Node.js EventStore 클라이언트</td><td>중간</td></tr><tr><td>Go</td><td>go-eventstore</td><td>경량 ES 구현</td><td>낮음</td></tr></tbody></table><h3 id=44-표준-및-규격-준수사항>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항>#</a></h3><p><strong>CloudEvents 표준</strong>:</p><ul><li><strong>목적</strong>: 이벤트 메타데이터 표준화</li><li><strong>스펙</strong>: CNCF에서 관리하는 클라우드 이벤트 명세</li><li><strong>구성 요소</strong>: type, source, id, time, datacontenttype, data</li></ul><p><strong>예시 CloudEvents 이벤트</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;specversion&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;com.example.order.created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;https://example.com/orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;1234-5678-9012&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;datacontenttype&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;orderId&#34;</span><span class=p>:</span> <span class=s2>&#34;order-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customerId&#34;</span><span class=p>:</span> <span class=s2>&#34;customer-456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>99.99</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>도메인 이벤트 설계 원칙</strong>:</p><ol><li><strong>Past Tense Naming</strong>: 이벤트 이름은 과거형으로 작성</li><li><strong>Business Meaningful</strong>: 비즈니스 도메인 언어 사용</li><li><strong>Immutable</strong>: 한번 발행된 이벤트는 변경 불가</li><li><strong>Self-Contained</strong>: 이벤트는 처리에 필요한 모든 정보 포함</li></ol><p><strong>보안 및 규정 준수</strong>:</p><ul><li><strong>GDPR</strong>: 개인정보 암호화 소거 (Cryptographic Erasure)</li><li><strong>SOX</strong>: 재무 데이터 감사 추적 요구사항</li><li><strong>HIPAA</strong>: 의료 정보 보호 규정</li><li><strong>PCI DSS</strong>: 결제 정보 보안 표준</li></ul><h2 id=phase-4-구현-및-분류-implementation--classification-1>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification-1>#</a></h2><h3 id=41-구현-기법-및-방법-1>4.1 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법-1>#</a></h3><ul><li>Event 생성 로직 : 상태 변화마다 이벤트 인스턴스 생성</li><li>Event Store 저장 : RDBMS(append-only 테이블), NoSQL, 전문 이벤트 저장소(Kafka 등) 사용 가능</li><li>Snapshot 관리 : 특정 시점 상태 전체 저장 후 이후 이벤트만 Replay</li><li>CQRS 기반 분리 : 커맨드/쿼리 모델 별도 구성</li></ul><p><strong>실제 예시 (파이썬)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 이벤트 객체 생성</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 저장 (append only)</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이벤트를 Event Store 저장(append-only)의 역할
</span></span></span><span class=line><span class=cl><span class=s2>    - 상태 변경 이력 관리 핵심
</span></span></span><span class=line><span class=cl><span class=s2>    - 여기서 Event Sourcing의 저장 특성 확인 가능
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=42-분류-기준에-따른-유형-구분-1>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분-1>#</a></h3><blockquote><p>이 표는 Event Sourcing의 구현 유형과 특징을 구분하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 분류 기준 | 유형 | 설명 | 주요 기술/도구 |
</span></span><span class=line><span class=cl>|------|----------|------|------|---------------|
</span></span><span class=line><span class=cl>| 저장 방식 | DB 이용 | RDBMS 기반 append-only | 테이블에 이벤트 로그 삽입 | PostgreSQL, MySQL |
</span></span><span class=line><span class=cl>| 저장 방식 | NoSQL 이용 | NoSQL 기반 이벤트 저장 | 유연한 스키마 및 빠른 쓰기 | MongoDB, DynamoDB |
</span></span><span class=line><span class=cl>| 메시징 기반 | 이벤트 브로커 | 스트림 기반 이벤트 저장 | 메시지 큐/브로커 연동 | Kafka, RabbitMQ |
</span></span><span class=line><span class=cl>| 아키텍처 통합 | CQRS | CQRS+ES 결합 | Command/Query 분리 | Axon, EventStoreDB |
</span></span></code></pre></td></tr></table></div></div><h3 id=43-도구-및-프레임워크-생태계-1>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계-1>#</a></h3><ul><li>EventStoreDB, Axon Framework, Kafka, RabbitMQ, AWS Kinesis, Apache Pulsar, PostgreSQL/NoSQL 기반 Event Table 등</li><li>CQRS 및 Projection 구현 지원: Axon, Lagom, Eventuate 등</li></ul><h3 id=44-표준-및-규격-준수사항-1>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항-1>#</a></h3><ul><li>이벤트 불변성(Immutable Event)</li><li>스키마/버전 관리 및 하위호환성</li><li>메시지 브로커 표준 프로토콜 준수 (AMQP, Kafka Protocol 등)</li><li>GDPR 등 데이터 보존 및 감사 규정 적용</li></ul><hr><h2 id=phase-5-실무-적용-practical-application>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application>#</a></h2><h3 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h3><p><strong>학습 목표</strong>: 이벤트 소싱의 이력 관리·상태 복원 프로세스 체험<br><strong>시나리오</strong>: 주문 시스템 - 순차적 OrderCreated, PaymentCompleted, DeliveryStarted 이벤트 기록 및 상태 복원<br><strong>시스템 구성</strong>:</p><ul><li>Command Handler</li><li>Domain Model</li><li>Event Store</li><li>Read Model</li></ul><pre class=mermaid>graph TB
    CMD[커맨드 처리] --&gt; DM[도메인 모델]
    DM --&gt; ES[이벤트 저장소]
    ES --&gt; RM[조회용 모델]
</pre><p><strong>Workflow</strong>:</p><ol><li>주문 생성 → OrderCreatedEvent 생성 및 저장</li><li>결제 완료 → PaymentCompletedEvent 저장</li><li>배송 시작 → DeliveryStartedEvent 저장</li><li>조회 시 이벤트 Replay하여 상태 복원</li></ol><p><strong>핵심 역할</strong>: 모든 단계의 변경 이력 추적과 상태 복원<br><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 상태만 저장되어 이력·원인 확인 불가능</li><li>도입 후: 순차 이벤트 기록으로 어떤 과정을 거쳤는지 쉽게 확인·복원</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 핵심 기능 구현 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replay_events</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Event Sourcing 데이터 복원 예제
</span></span></span><span class=line><span class=cl><span class=s2>    - 상태 재구성에 이벤트의 일련번호 순서가 중요
</span></span></span><span class=line><span class=cl><span class=s2>    - 여기서 Event Sourcing의 핵심 기능 확인 가능
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 타입에 따라 상태 반영</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderCreatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=s1>&#39;order&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>PaymentCompletedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=s1>&#39;payment&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;완료&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>DeliveryStartedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=s1>&#39;delivery&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;배송중&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h2><p><strong>사례 선정</strong>: 결제 서비스의 Audit 및 장애 복구를 목적으로 하는 이벤트 소싱 기반 주문 시스템<br><strong>비즈니스 배경</strong>: 결제 시스템에서 이력 추적(Audit Trail)과 장애 발생 시 트랜잭션 복원력(Fault Tolerance)이 요구됨<br><strong>기술적 요구사항</strong>:</p><ul><li>모든 상태 변경 기록 및 복원 가능</li><li>장애 발생 시 이벤트 Replay로 시스템 상태 복구</li><li>이력 및 감사 기능 강화</li><li>고가용성, 분산 저장이 중요한 요구사항</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>API Gateway (API 게이트웨이)</li><li>Command Handler (커맨드 처리기)</li><li>Domain Model (도메인 모델)</li><li>Event Store (이벤트 저장소)</li><li>Snapshot Manager (스냅샷 관리자)</li><li>Read Model (조회 모델)</li><li>Messaging Broker (메시지 브로커: Kafka연동)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Order/Payment System&#34;
        AG[API Gateway] --&gt; CH[Command Handler]
        CH --&gt; DM[Domain Model]
        DM --&gt; ES[Event Store]
        ES --&gt; RM[Read Model]
        ES --&gt; SM[Snapshot Manager]
        ES --&gt; MB[Messaging Broker (Kafka)]
    end
    MB --&gt; Ext[External Notification/Integration]
</pre><p><strong>Workflow</strong>:</p><ol><li>API Gateway에서 주문/결제 관련 커맨드 요청</li><li>Command Handler를 통해 도메인 모델 상태 변경</li><li>도메인 이벤트(Event) 생성 및 Event Store에 append-only 저장</li><li>Event Store에서 이벤트 저장 및 주기적으로 Snapshot 저장</li><li>Messaging Broker(Kafka)에 이벤트 퍼블리싱하여 외부 시스템과 연동</li><li>장애 발생 시 이벤트 Replay+스냅샷으로 주문 상태 복구</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>이벤트 기반 결제 프로세스의 이력/Audit 관리</li><li>장애 복구 및 외부 시스템 연동을 위한 이벤트 브로커</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 단순 CRUD로 이력·장애 복구 불가, 감사 요청 대응 어려움</li><li>도입 후: 이벤트별 기록으로 모든 변경 이력 추적 가능, 장애 복구 용이, 외부 연동 구조 확장성 강화</li></ul><p><strong>구현 예시</strong> (Python: 주문 상태 복원 및 외부 연동 이벤트 퍼블리싱)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 예시 1: 이벤트 저장 및 상태 복원</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 소싱 핵심: append-only 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>replay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># OrderID별 이벤트 복원</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span> <span class=o>==</span> <span class=n>order_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 이벤트 타입별로 상태 복원 로직 처리</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 예시 2: Kafka 퍼블리싱 (외부 연동)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span> <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>publish_event_to_kafka</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    결제/주문 이벤트를 외부 시스템에 퍼블리시
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 브로커 연동 특징
</span></span></span><span class=line><span class=cl><span class=s2>    - 이벤트 소싱에서 외부 연계 확장 예시
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;order-events&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span><span class=p>,</span> <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;payload&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>payload</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 생성 및 저장 과정 예시</span>
</span></span><span class=line><span class=cl><span class=n>store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>order_event</span> <span class=o>=</span> <span class=n>OrderEvent</span><span class=p>(</span><span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span> <span class=s1>&#39;order123&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;amount&#39;</span><span class=p>:</span> <span class=mi>10000</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=s1>&#39;홍길동&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>store</span><span class=o>.</span><span class=n>save_event</span><span class=p>(</span><span class=n>order_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>publish_event_to_kafka</span><span class=p>(</span><span class=n>order_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 장애 복구(상태 복원) 예시</span>
</span></span><span class=line><span class=cl><span class=n>restored_state</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>replay</span><span class=p>(</span><span class=s1>&#39;order123&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>restored_state</span><span class=p>)</span> <span class=c1># {&#39;amount&#39;: 10000, &#39;user&#39;: &#39;홍길동&#39;}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>주석 참고:</p><ul><li><code>EventStore</code>는 핵심 이력(append-only 저장 및 복원) 담당</li><li><code>publish_event_to_kafka</code>는 외부 연계/확장 기능 예시</li><li>장애 상태에서 <code>replay</code>로 전체 이력 복원 가능</li></ul></blockquote><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 장애 복구 시간 70% 이상 단축, 주문 이력 추적 정확도 100% 확보</li><li>운영 효율성: 실시간 감사 대응, 시스템 모니터링 확대</li><li>비용 절감: 장애 복구 및 감사 관련 인력·운영 비용 30% 이상 감소</li></ul><h2 id=phase-5-실무-적용-practical-application-1>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application-1>#</a></h2><h3 id=51-실습-예제-및-코드-구현>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현>#</a></h3><p><strong>학습 목표</strong>: Event Sourcing의 핵심 개념인 Command 처리, Event 생성, 상태 재구성을 이해하고 구현할 수 있다.</p><p><strong>시나리오</strong>: 온라인 쇼핑몰의 주문 관리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>Order Aggregate (주문 집계)</li><li>Order Command Handler (주문 명령 처리기)</li><li>Order Event Handler (주문 이벤트 처리기)</li><li>Event Store (이벤트 저장소)</li><li>Order Projection (주문 읽기 모델)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Command Side&#34;
        A[Create Order Command] --&gt; B[Order Command Handler]
        B --&gt; C[Order Aggregate]
        C --&gt; D[Order Events]
        D --&gt; E[Event Store]
    end
    
    subgraph &#34;Query Side&#34;
        E --&gt; F[Order Event Handler]
        F --&gt; G[Order Projection Store]
        G --&gt; H[Order Query Handler]
    end
    
    subgraph &#34;Client&#34;
        I[Customer] --&gt; A
        I --&gt; H
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 주문 생성 명령을 요청</li><li>Command Handler가 비즈니스 규칙을 검증</li><li>Order Aggregate가 상태를 변경하고 이벤트를 생성</li><li>Event Store에 이벤트가 저장됨</li><li>Event Handler가 이벤트를 처리하여 읽기 모델을 업데이트</li><li>고객이 주문 상태를 조회</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Event Sourcing이 모든 주문 변경 이력을 보존하여 완벽한 감사 추적을 제공</li><li>주문 상태의 모든 변화(생성→확인→배송→완료)를 이벤트로 기록</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 현재 주문 상태만 저장, 변경 이력 손실, 복잡한 감사 로그 별도 관리</li><li><strong>도입 후</strong>: 모든 변경 이력 자동 보존, 시점별 주문 상태 조회 가능, 비즈니스 분석 데이터 풍부</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>  1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>  2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>  3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>  4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5>  5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6>  6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7>  7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8>  8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9>  9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10> 10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11> 11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12> 12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13> 13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14> 14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15> 15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16> 16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17> 17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18> 18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19> 19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20> 20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21> 21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22> 22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23> 23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24> 24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25> 25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26> 26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27> 27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28> 28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29> 29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30> 30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31> 31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32> 32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33> 33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34> 34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35> 35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36> 36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37> 37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38> 38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39> 39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40> 40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41> 41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42> 42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43> 43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44> 44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45> 45</a>
</span><span class=lnt id=hl-26-46><a class=lnlinks href=#hl-26-46> 46</a>
</span><span class=lnt id=hl-26-47><a class=lnlinks href=#hl-26-47> 47</a>
</span><span class=lnt id=hl-26-48><a class=lnlinks href=#hl-26-48> 48</a>
</span><span class=lnt id=hl-26-49><a class=lnlinks href=#hl-26-49> 49</a>
</span><span class=lnt id=hl-26-50><a class=lnlinks href=#hl-26-50> 50</a>
</span><span class=lnt id=hl-26-51><a class=lnlinks href=#hl-26-51> 51</a>
</span><span class=lnt id=hl-26-52><a class=lnlinks href=#hl-26-52> 52</a>
</span><span class=lnt id=hl-26-53><a class=lnlinks href=#hl-26-53> 53</a>
</span><span class=lnt id=hl-26-54><a class=lnlinks href=#hl-26-54> 54</a>
</span><span class=lnt id=hl-26-55><a class=lnlinks href=#hl-26-55> 55</a>
</span><span class=lnt id=hl-26-56><a class=lnlinks href=#hl-26-56> 56</a>
</span><span class=lnt id=hl-26-57><a class=lnlinks href=#hl-26-57> 57</a>
</span><span class=lnt id=hl-26-58><a class=lnlinks href=#hl-26-58> 58</a>
</span><span class=lnt id=hl-26-59><a class=lnlinks href=#hl-26-59> 59</a>
</span><span class=lnt id=hl-26-60><a class=lnlinks href=#hl-26-60> 60</a>
</span><span class=lnt id=hl-26-61><a class=lnlinks href=#hl-26-61> 61</a>
</span><span class=lnt id=hl-26-62><a class=lnlinks href=#hl-26-62> 62</a>
</span><span class=lnt id=hl-26-63><a class=lnlinks href=#hl-26-63> 63</a>
</span><span class=lnt id=hl-26-64><a class=lnlinks href=#hl-26-64> 64</a>
</span><span class=lnt id=hl-26-65><a class=lnlinks href=#hl-26-65> 65</a>
</span><span class=lnt id=hl-26-66><a class=lnlinks href=#hl-26-66> 66</a>
</span><span class=lnt id=hl-26-67><a class=lnlinks href=#hl-26-67> 67</a>
</span><span class=lnt id=hl-26-68><a class=lnlinks href=#hl-26-68> 68</a>
</span><span class=lnt id=hl-26-69><a class=lnlinks href=#hl-26-69> 69</a>
</span><span class=lnt id=hl-26-70><a class=lnlinks href=#hl-26-70> 70</a>
</span><span class=lnt id=hl-26-71><a class=lnlinks href=#hl-26-71> 71</a>
</span><span class=lnt id=hl-26-72><a class=lnlinks href=#hl-26-72> 72</a>
</span><span class=lnt id=hl-26-73><a class=lnlinks href=#hl-26-73> 73</a>
</span><span class=lnt id=hl-26-74><a class=lnlinks href=#hl-26-74> 74</a>
</span><span class=lnt id=hl-26-75><a class=lnlinks href=#hl-26-75> 75</a>
</span><span class=lnt id=hl-26-76><a class=lnlinks href=#hl-26-76> 76</a>
</span><span class=lnt id=hl-26-77><a class=lnlinks href=#hl-26-77> 77</a>
</span><span class=lnt id=hl-26-78><a class=lnlinks href=#hl-26-78> 78</a>
</span><span class=lnt id=hl-26-79><a class=lnlinks href=#hl-26-79> 79</a>
</span><span class=lnt id=hl-26-80><a class=lnlinks href=#hl-26-80> 80</a>
</span><span class=lnt id=hl-26-81><a class=lnlinks href=#hl-26-81> 81</a>
</span><span class=lnt id=hl-26-82><a class=lnlinks href=#hl-26-82> 82</a>
</span><span class=lnt id=hl-26-83><a class=lnlinks href=#hl-26-83> 83</a>
</span><span class=lnt id=hl-26-84><a class=lnlinks href=#hl-26-84> 84</a>
</span><span class=lnt id=hl-26-85><a class=lnlinks href=#hl-26-85> 85</a>
</span><span class=lnt id=hl-26-86><a class=lnlinks href=#hl-26-86> 86</a>
</span><span class=lnt id=hl-26-87><a class=lnlinks href=#hl-26-87> 87</a>
</span><span class=lnt id=hl-26-88><a class=lnlinks href=#hl-26-88> 88</a>
</span><span class=lnt id=hl-26-89><a class=lnlinks href=#hl-26-89> 89</a>
</span><span class=lnt id=hl-26-90><a class=lnlinks href=#hl-26-90> 90</a>
</span><span class=lnt id=hl-26-91><a class=lnlinks href=#hl-26-91> 91</a>
</span><span class=lnt id=hl-26-92><a class=lnlinks href=#hl-26-92> 92</a>
</span><span class=lnt id=hl-26-93><a class=lnlinks href=#hl-26-93> 93</a>
</span><span class=lnt id=hl-26-94><a class=lnlinks href=#hl-26-94> 94</a>
</span><span class=lnt id=hl-26-95><a class=lnlinks href=#hl-26-95> 95</a>
</span><span class=lnt id=hl-26-96><a class=lnlinks href=#hl-26-96> 96</a>
</span><span class=lnt id=hl-26-97><a class=lnlinks href=#hl-26-97> 97</a>
</span><span class=lnt id=hl-26-98><a class=lnlinks href=#hl-26-98> 98</a>
</span><span class=lnt id=hl-26-99><a class=lnlinks href=#hl-26-99> 99</a>
</span><span class=lnt id=hl-26-100><a class=lnlinks href=#hl-26-100>100</a>
</span><span class=lnt id=hl-26-101><a class=lnlinks href=#hl-26-101>101</a>
</span><span class=lnt id=hl-26-102><a class=lnlinks href=#hl-26-102>102</a>
</span><span class=lnt id=hl-26-103><a class=lnlinks href=#hl-26-103>103</a>
</span><span class=lnt id=hl-26-104><a class=lnlinks href=#hl-26-104>104</a>
</span><span class=lnt id=hl-26-105><a class=lnlinks href=#hl-26-105>105</a>
</span><span class=lnt id=hl-26-106><a class=lnlinks href=#hl-26-106>106</a>
</span><span class=lnt id=hl-26-107><a class=lnlinks href=#hl-26-107>107</a>
</span><span class=lnt id=hl-26-108><a class=lnlinks href=#hl-26-108>108</a>
</span><span class=lnt id=hl-26-109><a class=lnlinks href=#hl-26-109>109</a>
</span><span class=lnt id=hl-26-110><a class=lnlinks href=#hl-26-110>110</a>
</span><span class=lnt id=hl-26-111><a class=lnlinks href=#hl-26-111>111</a>
</span><span class=lnt id=hl-26-112><a class=lnlinks href=#hl-26-112>112</a>
</span><span class=lnt id=hl-26-113><a class=lnlinks href=#hl-26-113>113</a>
</span><span class=lnt id=hl-26-114><a class=lnlinks href=#hl-26-114>114</a>
</span><span class=lnt id=hl-26-115><a class=lnlinks href=#hl-26-115>115</a>
</span><span class=lnt id=hl-26-116><a class=lnlinks href=#hl-26-116>116</a>
</span><span class=lnt id=hl-26-117><a class=lnlinks href=#hl-26-117>117</a>
</span><span class=lnt id=hl-26-118><a class=lnlinks href=#hl-26-118>118</a>
</span><span class=lnt id=hl-26-119><a class=lnlinks href=#hl-26-119>119</a>
</span><span class=lnt id=hl-26-120><a class=lnlinks href=#hl-26-120>120</a>
</span><span class=lnt id=hl-26-121><a class=lnlinks href=#hl-26-121>121</a>
</span><span class=lnt id=hl-26-122><a class=lnlinks href=#hl-26-122>122</a>
</span><span class=lnt id=hl-26-123><a class=lnlinks href=#hl-26-123>123</a>
</span><span class=lnt id=hl-26-124><a class=lnlinks href=#hl-26-124>124</a>
</span><span class=lnt id=hl-26-125><a class=lnlinks href=#hl-26-125>125</a>
</span><span class=lnt id=hl-26-126><a class=lnlinks href=#hl-26-126>126</a>
</span><span class=lnt id=hl-26-127><a class=lnlinks href=#hl-26-127>127</a>
</span><span class=lnt id=hl-26-128><a class=lnlinks href=#hl-26-128>128</a>
</span><span class=lnt id=hl-26-129><a class=lnlinks href=#hl-26-129>129</a>
</span><span class=lnt id=hl-26-130><a class=lnlinks href=#hl-26-130>130</a>
</span><span class=lnt id=hl-26-131><a class=lnlinks href=#hl-26-131>131</a>
</span><span class=lnt id=hl-26-132><a class=lnlinks href=#hl-26-132>132</a>
</span><span class=lnt id=hl-26-133><a class=lnlinks href=#hl-26-133>133</a>
</span><span class=lnt id=hl-26-134><a class=lnlinks href=#hl-26-134>134</a>
</span><span class=lnt id=hl-26-135><a class=lnlinks href=#hl-26-135>135</a>
</span><span class=lnt id=hl-26-136><a class=lnlinks href=#hl-26-136>136</a>
</span><span class=lnt id=hl-26-137><a class=lnlinks href=#hl-26-137>137</a>
</span><span class=lnt id=hl-26-138><a class=lnlinks href=#hl-26-138>138</a>
</span><span class=lnt id=hl-26-139><a class=lnlinks href=#hl-26-139>139</a>
</span><span class=lnt id=hl-26-140><a class=lnlinks href=#hl-26-140>140</a>
</span><span class=lnt id=hl-26-141><a class=lnlinks href=#hl-26-141>141</a>
</span><span class=lnt id=hl-26-142><a class=lnlinks href=#hl-26-142>142</a>
</span><span class=lnt id=hl-26-143><a class=lnlinks href=#hl-26-143>143</a>
</span><span class=lnt id=hl-26-144><a class=lnlinks href=#hl-26-144>144</a>
</span><span class=lnt id=hl-26-145><a class=lnlinks href=#hl-26-145>145</a>
</span><span class=lnt id=hl-26-146><a class=lnlinks href=#hl-26-146>146</a>
</span><span class=lnt id=hl-26-147><a class=lnlinks href=#hl-26-147>147</a>
</span><span class=lnt id=hl-26-148><a class=lnlinks href=#hl-26-148>148</a>
</span><span class=lnt id=hl-26-149><a class=lnlinks href=#hl-26-149>149</a>
</span><span class=lnt id=hl-26-150><a class=lnlinks href=#hl-26-150>150</a>
</span><span class=lnt id=hl-26-151><a class=lnlinks href=#hl-26-151>151</a>
</span><span class=lnt id=hl-26-152><a class=lnlinks href=#hl-26-152>152</a>
</span><span class=lnt id=hl-26-153><a class=lnlinks href=#hl-26-153>153</a>
</span><span class=lnt id=hl-26-154><a class=lnlinks href=#hl-26-154>154</a>
</span><span class=lnt id=hl-26-155><a class=lnlinks href=#hl-26-155>155</a>
</span><span class=lnt id=hl-26-156><a class=lnlinks href=#hl-26-156>156</a>
</span><span class=lnt id=hl-26-157><a class=lnlinks href=#hl-26-157>157</a>
</span><span class=lnt id=hl-26-158><a class=lnlinks href=#hl-26-158>158</a>
</span><span class=lnt id=hl-26-159><a class=lnlinks href=#hl-26-159>159</a>
</span><span class=lnt id=hl-26-160><a class=lnlinks href=#hl-26-160>160</a>
</span><span class=lnt id=hl-26-161><a class=lnlinks href=#hl-26-161>161</a>
</span><span class=lnt id=hl-26-162><a class=lnlinks href=#hl-26-162>162</a>
</span><span class=lnt id=hl-26-163><a class=lnlinks href=#hl-26-163>163</a>
</span><span class=lnt id=hl-26-164><a class=lnlinks href=#hl-26-164>164</a>
</span><span class=lnt id=hl-26-165><a class=lnlinks href=#hl-26-165>165</a>
</span><span class=lnt id=hl-26-166><a class=lnlinks href=#hl-26-166>166</a>
</span><span class=lnt id=hl-26-167><a class=lnlinks href=#hl-26-167>167</a>
</span><span class=lnt id=hl-26-168><a class=lnlinks href=#hl-26-168>168</a>
</span><span class=lnt id=hl-26-169><a class=lnlinks href=#hl-26-169>169</a>
</span><span class=lnt id=hl-26-170><a class=lnlinks href=#hl-26-170>170</a>
</span><span class=lnt id=hl-26-171><a class=lnlinks href=#hl-26-171>171</a>
</span><span class=lnt id=hl-26-172><a class=lnlinks href=#hl-26-172>172</a>
</span><span class=lnt id=hl-26-173><a class=lnlinks href=#hl-26-173>173</a>
</span><span class=lnt id=hl-26-174><a class=lnlinks href=#hl-26-174>174</a>
</span><span class=lnt id=hl-26-175><a class=lnlinks href=#hl-26-175>175</a>
</span><span class=lnt id=hl-26-176><a class=lnlinks href=#hl-26-176>176</a>
</span><span class=lnt id=hl-26-177><a class=lnlinks href=#hl-26-177>177</a>
</span><span class=lnt id=hl-26-178><a class=lnlinks href=#hl-26-178>178</a>
</span><span class=lnt id=hl-26-179><a class=lnlinks href=#hl-26-179>179</a>
</span><span class=lnt id=hl-26-180><a class=lnlinks href=#hl-26-180>180</a>
</span><span class=lnt id=hl-26-181><a class=lnlinks href=#hl-26-181>181</a>
</span><span class=lnt id=hl-26-182><a class=lnlinks href=#hl-26-182>182</a>
</span><span class=lnt id=hl-26-183><a class=lnlinks href=#hl-26-183>183</a>
</span><span class=lnt id=hl-26-184><a class=lnlinks href=#hl-26-184>184</a>
</span><span class=lnt id=hl-26-185><a class=lnlinks href=#hl-26-185>185</a>
</span><span class=lnt id=hl-26-186><a class=lnlinks href=#hl-26-186>186</a>
</span><span class=lnt id=hl-26-187><a class=lnlinks href=#hl-26-187>187</a>
</span><span class=lnt id=hl-26-188><a class=lnlinks href=#hl-26-188>188</a>
</span><span class=lnt id=hl-26-189><a class=lnlinks href=#hl-26-189>189</a>
</span><span class=lnt id=hl-26-190><a class=lnlinks href=#hl-26-190>190</a>
</span><span class=lnt id=hl-26-191><a class=lnlinks href=#hl-26-191>191</a>
</span><span class=lnt id=hl-26-192><a class=lnlinks href=#hl-26-192>192</a>
</span><span class=lnt id=hl-26-193><a class=lnlinks href=#hl-26-193>193</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Sourcing 핵심 구현 예제</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    기본 이벤트 클래스
</span></span></span><span class=line><span class=cl><span class=s2>    - 이 부분은 모든 도메인 이벤트의 기본 구조를 정의
</span></span></span><span class=line><span class=cl><span class=s2>    - Event Sourcing의 불변성 원칙을 구현
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># Event Store에서 설정</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 생성 이벤트
</span></span></span><span class=line><span class=cl><span class=s2>    - Event Sourcing에서 비즈니스 의미가 담긴 도메인 이벤트 예시
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;total_amount&#34;</span><span class=p>:</span> <span class=n>total_amount</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderConfirmedEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 확인 이벤트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>confirmed_at</span><span class=p>:</span> <span class=n>datetime</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;OrderConfirmed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;confirmed_at&#34;</span><span class=p>:</span> <span class=n>confirmed_at</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이벤트 저장소 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - Event Sourcing의 핵심인 append-only 저장소
</span></span></span><span class=line><span class=cl><span class=s2>    - 여기서 Event Sourcing의 순서성과 불변성이 보장됨
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>global_sequence</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>],</span> <span class=n>expected_version</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이벤트 추가 - Event Sourcing의 핵심 연산
</span></span></span><span class=line><span class=cl><span class=s2>        - expected_version을 통한 낙관적 동시성 제어
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>expected_version</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> <span class=n>expected_version</span> <span class=o>!=</span> <span class=n>current_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Concurrency conflict. Expected </span><span class=si>{</span><span class=n>expected_version</span><span class=si>}</span><span class=s2>, got </span><span class=si>{</span><span class=n>current_version</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>current_version</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>global_sequence</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>from_version</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이벤트 조회 - Event Sourcing의 상태 재구성을 위한 핵심 기능
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>][</span><span class=n>from_version</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderAggregate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 집계 - DDD의 Aggregate 패턴과 Event Sourcing 결합
</span></span></span><span class=line><span class=cl><span class=s2>    - 여기서 Event Sourcing의 상태 재구성이 이루어짐
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;PENDING&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주문 생성 명령 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - Event Sourcing에서 비즈니스 로직 실행 후 이벤트 생성
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=s2>&#34;PENDING&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Order already exists&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 규칙 검증</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>total_amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Order amount must be positive&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 생성 및 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>,</span> <span class=n>items</span><span class=p>,</span> <span class=n>total_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_confirm_order</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확인 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=s2>&#34;CREATED&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Order must be created before confirmation&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderConfirmedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이벤트 적용 - Event Sourcing의 상태 변경 메커니즘
</span></span></span><span class=line><span class=cl><span class=s2>        - 이 메소드에서 Event Sourcing의 상태 재구성이 구현됨
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;customer_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;total_amount&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;CREATED&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;OrderConfirmed&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;CONFIRMED&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_from_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이벤트에서 집계 상태 복원
</span></span></span><span class=line><span class=cl><span class=s2>        - Event Sourcing의 핵심 기능인 이벤트 재생 구현
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 명령 처리기
</span></span></span><span class=line><span class=cl><span class=s2>    - Event Sourcing에서 쓰기 모델의 진입점
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>aggregate</span> <span class=o>=</span> <span class=n>OrderAggregate</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>aggregate</span><span class=o>.</span><span class=n>handle_create_order</span><span class=p>(</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>items</span><span class=p>,</span> <span class=n>total_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Store에 이벤트 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_events</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_confirm_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확인 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기존 이벤트에서 집계 복원</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>aggregate</span> <span class=o>=</span> <span class=n>OrderAggregate</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>aggregate</span><span class=o>.</span><span class=n>load_from_events</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 명령 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>aggregate</span><span class=o>.</span><span class=n>handle_confirm_order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 새 이벤트 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_events</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=p>,</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>version</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>aggregate</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Event Store 및 Command Handler 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_create_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span><span class=o>=</span><span class=s2>&#34;order-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=s2>&#34;customer-456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span><span class=o>=</span><span class=p>[{</span><span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;laptop&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mf>999.99</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=n>total_amount</span><span class=o>=</span><span class=mf>999.99</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_confirm_order</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 히스토리 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Order Events:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;- </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>event_type</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=52-실제-도입-사례-실무-사용-예시>5.2 실제 도입 사례 (실무 사용 예시)<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례-실무-사용-예시>#</a></h3><p><strong>Netflix의 Downloads 서비스 사례</strong>:</p><p><strong>비즈니스 배경</strong>:</p><ul><li>2016년 Netflix가 오프라인 다운로드 기능 출시</li><li>기존 무상태 라이선스 서비스를 실시간 상태 관리 서비스로 전환 필요</li><li>수백만 사용자의 다운로드 상태를 전 세계적으로 추적해야 함</li></ul><p><strong>기술적 도전과제</strong>:</p><ul><li>빠르게 변화하는 요구사항에 대응</li><li>글로벌 규모의 확장성 확보</li><li>다운로드 상태의 정확한 추적</li><li>라이선스 규정 준수</li></ul><p><strong>조합 기술</strong>:</p><ul><li><strong>Event Sourcing</strong>: 모든 다운로드 상태 변경을 이벤트로 기록</li><li><strong>Apache Cassandra</strong>: 분산 이벤트 저장소로 활용</li><li><strong>CQRS</strong>: 명령과 쿼리 모델 분리</li><li><strong>Snapshotting</strong>: 성능 최적화를 위한 주기적 상태 저장</li></ul><p><strong>효과 분석</strong>:</p><ul><li><strong>확장성</strong>: 전 세계 수백만 사용자 지원</li><li><strong>민첩성</strong>: 빠른 기능 요구사항 변경에 대응</li><li><strong>신뢰성</strong>: 완벽한 다운로드 이력 추적</li><li><strong>규정 준수</strong>: 라이선스 감사 요구사항 자동 만족</li></ul><p><strong>Uber의 실시간 위치 추적 사례</strong>:</p><p><strong>비즈니스 배경</strong>:</p><ul><li>실시간 라이드 매칭 및 추적 시스템</li><li>드라이버와 승객의 위치 정보 실시간 처리</li><li>수백만 건의 위치 업데이트 이벤트 처리</li></ul><p><strong>조합 기술</strong>:</p><ul><li><strong>Apache Kafka</strong>: 대용량 이벤트 스트리밍</li><li><strong>Event Sourcing</strong>: 모든 위치 변경 이벤트 기록</li><li><strong>Stream Processing</strong>: 실시간 이벤트 처리</li><li><strong>Microservices</strong>: 서비스별 독립적 확장</li></ul><p><strong>효과 분석</strong>:</p><ul><li><strong>실시간성</strong>: 밀리초 단위 위치 업데이트</li><li><strong>확장성</strong>: 초당 수백만 이벤트 처리</li><li><strong>분석성</strong>: 라이딩 패턴 및 트래픽 분석 가능</li><li><strong>장애 복구</strong>: 이벤트 재생을 통한 빠른 시스템 복구</li></ul><h3 id=53-실제-도입-사례의-코드-구현>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현>#</a></h3><p><strong>사례 선정</strong>: Netflix Downloads 서비스</p><p><strong>비즈니스 배경</strong>: Netflix 사용자가 콘텐츠를 다운로드하고 재생하는 과정에서 발생하는 모든 상태 변경을 추적하여 라이선스 규정을 준수하고 사용자 경험을 최적화</p><p><strong>기술적 요구사항</strong>:</p><ul><li>글로벌 규모의 다운로드 상태 관리</li><li>실시간 라이선스 검증</li><li>오프라인 재생 권한 관리</li><li>완벽한 감사 추적</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>Download License Service (다운로드 라이선스 서비스)</li><li>Content Rights Manager (콘텐츠 권한 관리자)</li><li>User Download Tracker (사용자 다운로드 추적기)</li><li>Event Store (Cassandra 기반)</li><li>Projection Store (실시간 다운로드 상태)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Netflix Downloads System&#34;
        A[Mobile App] --&gt; B[Download Request API]
        B --&gt; C[License Command Handler]
        C --&gt; D[Download Aggregate]
        D --&gt; E[License Events]
        E --&gt; F[Cassandra Event Store]
        
        F --&gt; G[License Event Processor]
        G --&gt; H[Download Status Projection]
        H --&gt; I[Download Query API]
        I --&gt; A
        
        F --&gt; J[Rights Validation Service]
        F --&gt; K[Analytics Pipeline]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 모바일 앱에서 콘텐츠 다운로드 요청</li><li>License Command Handler가 사용자 권한 및 디바이스 제한 검증</li><li>Download Aggregate가 다운로드 라이선스 이벤트 생성</li><li>Cassandra Event Store에 이벤트 저장</li><li>Event Processor가 실시간으로 다운로드 상태 프로젝션 업데이트</li><li>사용자가 다운로드 상태 및 재생 권한 실시간 조회</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Event Sourcing이 모든 다운로드 라이선스 변경을 불변으로 기록하여 완벽한 감사 추적 제공</li><li>라이선스 만료, 디바이스 변경, 콘텐츠 권한 변화 등 모든 상태 변경 이벤트 추적</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 단순한 다운로드 상태만 저장, 라이선스 이력 손실, 복잡한 권한 검증 로직</li><li><strong>도입 후</strong>: 완전한 다운로드 생명주기 추적, 자동 라이선스 감사, 실시간 권한 검증</li></ul><p><strong>구현 예시</strong> (Java):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>  1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>  2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>  3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>  4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5>  5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6>  6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7>  7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8>  8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9>  9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10> 10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11> 11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12> 12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13> 13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14> 14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15> 15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16> 16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17> 17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18> 18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19> 19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20> 20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21> 21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22> 22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23> 23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24> 24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25> 25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26> 26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27> 27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28> 28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29> 29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30> 30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31> 31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32> 32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33> 33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34> 34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35> 35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36> 36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37> 37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38> 38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39> 39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40> 40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41> 41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42> 42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43> 43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44> 44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45> 45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46> 46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47> 47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48> 48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49> 49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50> 50</a>
</span><span class=lnt id=hl-28-51><a class=lnlinks href=#hl-28-51> 51</a>
</span><span class=lnt id=hl-28-52><a class=lnlinks href=#hl-28-52> 52</a>
</span><span class=lnt id=hl-28-53><a class=lnlinks href=#hl-28-53> 53</a>
</span><span class=lnt id=hl-28-54><a class=lnlinks href=#hl-28-54> 54</a>
</span><span class=lnt id=hl-28-55><a class=lnlinks href=#hl-28-55> 55</a>
</span><span class=lnt id=hl-28-56><a class=lnlinks href=#hl-28-56> 56</a>
</span><span class=lnt id=hl-28-57><a class=lnlinks href=#hl-28-57> 57</a>
</span><span class=lnt id=hl-28-58><a class=lnlinks href=#hl-28-58> 58</a>
</span><span class=lnt id=hl-28-59><a class=lnlinks href=#hl-28-59> 59</a>
</span><span class=lnt id=hl-28-60><a class=lnlinks href=#hl-28-60> 60</a>
</span><span class=lnt id=hl-28-61><a class=lnlinks href=#hl-28-61> 61</a>
</span><span class=lnt id=hl-28-62><a class=lnlinks href=#hl-28-62> 62</a>
</span><span class=lnt id=hl-28-63><a class=lnlinks href=#hl-28-63> 63</a>
</span><span class=lnt id=hl-28-64><a class=lnlinks href=#hl-28-64> 64</a>
</span><span class=lnt id=hl-28-65><a class=lnlinks href=#hl-28-65> 65</a>
</span><span class=lnt id=hl-28-66><a class=lnlinks href=#hl-28-66> 66</a>
</span><span class=lnt id=hl-28-67><a class=lnlinks href=#hl-28-67> 67</a>
</span><span class=lnt id=hl-28-68><a class=lnlinks href=#hl-28-68> 68</a>
</span><span class=lnt id=hl-28-69><a class=lnlinks href=#hl-28-69> 69</a>
</span><span class=lnt id=hl-28-70><a class=lnlinks href=#hl-28-70> 70</a>
</span><span class=lnt id=hl-28-71><a class=lnlinks href=#hl-28-71> 71</a>
</span><span class=lnt id=hl-28-72><a class=lnlinks href=#hl-28-72> 72</a>
</span><span class=lnt id=hl-28-73><a class=lnlinks href=#hl-28-73> 73</a>
</span><span class=lnt id=hl-28-74><a class=lnlinks href=#hl-28-74> 74</a>
</span><span class=lnt id=hl-28-75><a class=lnlinks href=#hl-28-75> 75</a>
</span><span class=lnt id=hl-28-76><a class=lnlinks href=#hl-28-76> 76</a>
</span><span class=lnt id=hl-28-77><a class=lnlinks href=#hl-28-77> 77</a>
</span><span class=lnt id=hl-28-78><a class=lnlinks href=#hl-28-78> 78</a>
</span><span class=lnt id=hl-28-79><a class=lnlinks href=#hl-28-79> 79</a>
</span><span class=lnt id=hl-28-80><a class=lnlinks href=#hl-28-80> 80</a>
</span><span class=lnt id=hl-28-81><a class=lnlinks href=#hl-28-81> 81</a>
</span><span class=lnt id=hl-28-82><a class=lnlinks href=#hl-28-82> 82</a>
</span><span class=lnt id=hl-28-83><a class=lnlinks href=#hl-28-83> 83</a>
</span><span class=lnt id=hl-28-84><a class=lnlinks href=#hl-28-84> 84</a>
</span><span class=lnt id=hl-28-85><a class=lnlinks href=#hl-28-85> 85</a>
</span><span class=lnt id=hl-28-86><a class=lnlinks href=#hl-28-86> 86</a>
</span><span class=lnt id=hl-28-87><a class=lnlinks href=#hl-28-87> 87</a>
</span><span class=lnt id=hl-28-88><a class=lnlinks href=#hl-28-88> 88</a>
</span><span class=lnt id=hl-28-89><a class=lnlinks href=#hl-28-89> 89</a>
</span><span class=lnt id=hl-28-90><a class=lnlinks href=#hl-28-90> 90</a>
</span><span class=lnt id=hl-28-91><a class=lnlinks href=#hl-28-91> 91</a>
</span><span class=lnt id=hl-28-92><a class=lnlinks href=#hl-28-92> 92</a>
</span><span class=lnt id=hl-28-93><a class=lnlinks href=#hl-28-93> 93</a>
</span><span class=lnt id=hl-28-94><a class=lnlinks href=#hl-28-94> 94</a>
</span><span class=lnt id=hl-28-95><a class=lnlinks href=#hl-28-95> 95</a>
</span><span class=lnt id=hl-28-96><a class=lnlinks href=#hl-28-96> 96</a>
</span><span class=lnt id=hl-28-97><a class=lnlinks href=#hl-28-97> 97</a>
</span><span class=lnt id=hl-28-98><a class=lnlinks href=#hl-28-98> 98</a>
</span><span class=lnt id=hl-28-99><a class=lnlinks href=#hl-28-99> 99</a>
</span><span class=lnt id=hl-28-100><a class=lnlinks href=#hl-28-100>100</a>
</span><span class=lnt id=hl-28-101><a class=lnlinks href=#hl-28-101>101</a>
</span><span class=lnt id=hl-28-102><a class=lnlinks href=#hl-28-102>102</a>
</span><span class=lnt id=hl-28-103><a class=lnlinks href=#hl-28-103>103</a>
</span><span class=lnt id=hl-28-104><a class=lnlinks href=#hl-28-104>104</a>
</span><span class=lnt id=hl-28-105><a class=lnlinks href=#hl-28-105>105</a>
</span><span class=lnt id=hl-28-106><a class=lnlinks href=#hl-28-106>106</a>
</span><span class=lnt id=hl-28-107><a class=lnlinks href=#hl-28-107>107</a>
</span><span class=lnt id=hl-28-108><a class=lnlinks href=#hl-28-108>108</a>
</span><span class=lnt id=hl-28-109><a class=lnlinks href=#hl-28-109>109</a>
</span><span class=lnt id=hl-28-110><a class=lnlinks href=#hl-28-110>110</a>
</span><span class=lnt id=hl-28-111><a class=lnlinks href=#hl-28-111>111</a>
</span><span class=lnt id=hl-28-112><a class=lnlinks href=#hl-28-112>112</a>
</span><span class=lnt id=hl-28-113><a class=lnlinks href=#hl-28-113>113</a>
</span><span class=lnt id=hl-28-114><a class=lnlinks href=#hl-28-114>114</a>
</span><span class=lnt id=hl-28-115><a class=lnlinks href=#hl-28-115>115</a>
</span><span class=lnt id=hl-28-116><a class=lnlinks href=#hl-28-116>116</a>
</span><span class=lnt id=hl-28-117><a class=lnlinks href=#hl-28-117>117</a>
</span><span class=lnt id=hl-28-118><a class=lnlinks href=#hl-28-118>118</a>
</span><span class=lnt id=hl-28-119><a class=lnlinks href=#hl-28-119>119</a>
</span><span class=lnt id=hl-28-120><a class=lnlinks href=#hl-28-120>120</a>
</span><span class=lnt id=hl-28-121><a class=lnlinks href=#hl-28-121>121</a>
</span><span class=lnt id=hl-28-122><a class=lnlinks href=#hl-28-122>122</a>
</span><span class=lnt id=hl-28-123><a class=lnlinks href=#hl-28-123>123</a>
</span><span class=lnt id=hl-28-124><a class=lnlinks href=#hl-28-124>124</a>
</span><span class=lnt id=hl-28-125><a class=lnlinks href=#hl-28-125>125</a>
</span><span class=lnt id=hl-28-126><a class=lnlinks href=#hl-28-126>126</a>
</span><span class=lnt id=hl-28-127><a class=lnlinks href=#hl-28-127>127</a>
</span><span class=lnt id=hl-28-128><a class=lnlinks href=#hl-28-128>128</a>
</span><span class=lnt id=hl-28-129><a class=lnlinks href=#hl-28-129>129</a>
</span><span class=lnt id=hl-28-130><a class=lnlinks href=#hl-28-130>130</a>
</span><span class=lnt id=hl-28-131><a class=lnlinks href=#hl-28-131>131</a>
</span><span class=lnt id=hl-28-132><a class=lnlinks href=#hl-28-132>132</a>
</span><span class=lnt id=hl-28-133><a class=lnlinks href=#hl-28-133>133</a>
</span><span class=lnt id=hl-28-134><a class=lnlinks href=#hl-28-134>134</a>
</span><span class=lnt id=hl-28-135><a class=lnlinks href=#hl-28-135>135</a>
</span><span class=lnt id=hl-28-136><a class=lnlinks href=#hl-28-136>136</a>
</span><span class=lnt id=hl-28-137><a class=lnlinks href=#hl-28-137>137</a>
</span><span class=lnt id=hl-28-138><a class=lnlinks href=#hl-28-138>138</a>
</span><span class=lnt id=hl-28-139><a class=lnlinks href=#hl-28-139>139</a>
</span><span class=lnt id=hl-28-140><a class=lnlinks href=#hl-28-140>140</a>
</span><span class=lnt id=hl-28-141><a class=lnlinks href=#hl-28-141>141</a>
</span><span class=lnt id=hl-28-142><a class=lnlinks href=#hl-28-142>142</a>
</span><span class=lnt id=hl-28-143><a class=lnlinks href=#hl-28-143>143</a>
</span><span class=lnt id=hl-28-144><a class=lnlinks href=#hl-28-144>144</a>
</span><span class=lnt id=hl-28-145><a class=lnlinks href=#hl-28-145>145</a>
</span><span class=lnt id=hl-28-146><a class=lnlinks href=#hl-28-146>146</a>
</span><span class=lnt id=hl-28-147><a class=lnlinks href=#hl-28-147>147</a>
</span><span class=lnt id=hl-28-148><a class=lnlinks href=#hl-28-148>148</a>
</span><span class=lnt id=hl-28-149><a class=lnlinks href=#hl-28-149>149</a>
</span><span class=lnt id=hl-28-150><a class=lnlinks href=#hl-28-150>150</a>
</span><span class=lnt id=hl-28-151><a class=lnlinks href=#hl-28-151>151</a>
</span><span class=lnt id=hl-28-152><a class=lnlinks href=#hl-28-152>152</a>
</span><span class=lnt id=hl-28-153><a class=lnlinks href=#hl-28-153>153</a>
</span><span class=lnt id=hl-28-154><a class=lnlinks href=#hl-28-154>154</a>
</span><span class=lnt id=hl-28-155><a class=lnlinks href=#hl-28-155>155</a>
</span><span class=lnt id=hl-28-156><a class=lnlinks href=#hl-28-156>156</a>
</span><span class=lnt id=hl-28-157><a class=lnlinks href=#hl-28-157>157</a>
</span><span class=lnt id=hl-28-158><a class=lnlinks href=#hl-28-158>158</a>
</span><span class=lnt id=hl-28-159><a class=lnlinks href=#hl-28-159>159</a>
</span><span class=lnt id=hl-28-160><a class=lnlinks href=#hl-28-160>160</a>
</span><span class=lnt id=hl-28-161><a class=lnlinks href=#hl-28-161>161</a>
</span><span class=lnt id=hl-28-162><a class=lnlinks href=#hl-28-162>162</a>
</span><span class=lnt id=hl-28-163><a class=lnlinks href=#hl-28-163>163</a>
</span><span class=lnt id=hl-28-164><a class=lnlinks href=#hl-28-164>164</a>
</span><span class=lnt id=hl-28-165><a class=lnlinks href=#hl-28-165>165</a>
</span><span class=lnt id=hl-28-166><a class=lnlinks href=#hl-28-166>166</a>
</span><span class=lnt id=hl-28-167><a class=lnlinks href=#hl-28-167>167</a>
</span><span class=lnt id=hl-28-168><a class=lnlinks href=#hl-28-168>168</a>
</span><span class=lnt id=hl-28-169><a class=lnlinks href=#hl-28-169>169</a>
</span><span class=lnt id=hl-28-170><a class=lnlinks href=#hl-28-170>170</a>
</span><span class=lnt id=hl-28-171><a class=lnlinks href=#hl-28-171>171</a>
</span><span class=lnt id=hl-28-172><a class=lnlinks href=#hl-28-172>172</a>
</span><span class=lnt id=hl-28-173><a class=lnlinks href=#hl-28-173>173</a>
</span><span class=lnt id=hl-28-174><a class=lnlinks href=#hl-28-174>174</a>
</span><span class=lnt id=hl-28-175><a class=lnlinks href=#hl-28-175>175</a>
</span><span class=lnt id=hl-28-176><a class=lnlinks href=#hl-28-176>176</a>
</span><span class=lnt id=hl-28-177><a class=lnlinks href=#hl-28-177>177</a>
</span><span class=lnt id=hl-28-178><a class=lnlinks href=#hl-28-178>178</a>
</span><span class=lnt id=hl-28-179><a class=lnlinks href=#hl-28-179>179</a>
</span><span class=lnt id=hl-28-180><a class=lnlinks href=#hl-28-180>180</a>
</span><span class=lnt id=hl-28-181><a class=lnlinks href=#hl-28-181>181</a>
</span><span class=lnt id=hl-28-182><a class=lnlinks href=#hl-28-182>182</a>
</span><span class=lnt id=hl-28-183><a class=lnlinks href=#hl-28-183>183</a>
</span><span class=lnt id=hl-28-184><a class=lnlinks href=#hl-28-184>184</a>
</span><span class=lnt id=hl-28-185><a class=lnlinks href=#hl-28-185>185</a>
</span><span class=lnt id=hl-28-186><a class=lnlinks href=#hl-28-186>186</a>
</span><span class=lnt id=hl-28-187><a class=lnlinks href=#hl-28-187>187</a>
</span><span class=lnt id=hl-28-188><a class=lnlinks href=#hl-28-188>188</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Netflix Downloads Service - Event Sourcing 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DownloadLicenseAggregate</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>contentId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>deviceId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>DownloadStatus</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>expiryTime</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>downloadCount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>uncommittedEvents</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 다운로드 라이선스 요청 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - Event Sourcing에서 비즈니스 규칙 검증 후 이벤트 생성
</span></span></span><span class=line><span class=cl><span class=cm>     * - Netflix의 실제 비즈니스 로직: 디바이스 제한, 콘텐츠 권한 검증
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>requestDownload</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>contentId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>deviceId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 규칙 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>downloadCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>4</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MaxDownloadsExceededException</span><span class=p>(</span><span class=s>&#34;User has reached maximum downloads&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>isContentAvailableForDownload</span><span class=p>(</span><span class=n>contentId</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ContentNotAvailableException</span><span class=p>(</span><span class=s>&#34;Content not available for download&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 다운로드 라이선스 승인 이벤트 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DownloadLicenseGrantedEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DownloadLicenseGrantedEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>contentId</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>deviceId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>plusDays</span><span class=p>(</span><span class=n>30</span><span class=p>)</span><span class=w> </span><span class=c1>// 30일 만료</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>applyEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>uncommittedEvents</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 다운로드 시작 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - Netflix에서 실제 다운로드 시작 시 발생하는 이벤트
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>startDownload</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>DownloadStatus</span><span class=p>.</span><span class=na>LICENSED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InvalidDownloadStateException</span><span class=p>(</span><span class=s>&#34;Download not licensed&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DownloadStartedEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DownloadStartedEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>userId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>contentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>deviceId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>applyEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>uncommittedEvents</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 이벤트 적용 - Event Sourcing의 상태 변경 메커니즘
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 메소드에서 Netflix Downloads의 모든 상태 변경이 이벤트 기반으로 처리됨
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>applyEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;DownloadLicenseGranted&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>DownloadLicenseGrantedEvent</span><span class=w> </span><span class=n>licenseEvent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>DownloadLicenseGrantedEvent</span><span class=p>)</span><span class=w> </span><span class=n>event</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>licenseEvent</span><span class=p>.</span><span class=na>getUserId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>contentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>licenseEvent</span><span class=p>.</span><span class=na>getContentId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>deviceId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>licenseEvent</span><span class=p>.</span><span class=na>getDeviceId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DownloadStatus</span><span class=p>.</span><span class=na>LICENSED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>expiryTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>licenseEvent</span><span class=p>.</span><span class=na>getExpiryTime</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>downloadCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;DownloadStarted&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DownloadStatus</span><span class=p>.</span><span class=na>DOWNLOADING</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;DownloadCompleted&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DownloadStatus</span><span class=p>.</span><span class=na>AVAILABLE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;DownloadExpired&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DownloadStatus</span><span class=p>.</span><span class=na>EXPIRED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 이벤트에서 집계 복원
</span></span></span><span class=line><span class=cl><span class=cm>     * - Event Sourcing의 핵심 기능인 이벤트 재생
</span></span></span><span class=line><span class=cl><span class=cm>     * - Netflix에서 서비스 재시작 시 모든 다운로드 상태를 이벤트에서 복원
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>DownloadLicenseAggregate</span><span class=w> </span><span class=nf>fromEvents</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>events</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DownloadLicenseAggregate</span><span class=w> </span><span class=n>aggregate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DownloadLicenseAggregate</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>events</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>aggregate</span><span class=p>.</span><span class=na>applyEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>aggregate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Cassandra 기반 Event Store 구현 (Netflix 실제 구조 참조)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CassandraEventStore</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>EventStore</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>CassandraOperations</span><span class=w> </span><span class=n>cassandraTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 이벤트 저장 - Netflix에서 사용하는 Cassandra 기반 저장
</span></span></span><span class=line><span class=cl><span class=cm>     * - 파티션 키로 userId 사용하여 사용자별 이벤트 분산 저장
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveEvents</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>aggregateId</span><span class=p>,</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>events</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>expectedVersion</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>events</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>EventEntity</span><span class=w> </span><span class=n>entity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>EventEntity</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>entity</span><span class=p>.</span><span class=na>setUserId</span><span class=p>(</span><span class=n>extractUserId</span><span class=p>(</span><span class=n>aggregateId</span><span class=p>));</span><span class=w> </span><span class=c1>// 파티션 키</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>entity</span><span class=p>.</span><span class=na>setAggregateId</span><span class=p>(</span><span class=n>aggregateId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>entity</span><span class=p>.</span><span class=na>setEventType</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>entity</span><span class=p>.</span><span class=na>setEventData</span><span class=p>(</span><span class=n>serializeEvent</span><span class=p>(</span><span class=n>event</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>entity</span><span class=p>.</span><span class=na>setEventVersion</span><span class=p>(</span><span class=n>expectedVersion</span><span class=o>++</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>entity</span><span class=p>.</span><span class=na>setTimestamp</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>cassandraTemplate</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 이벤트 조회 - 사용자별 다운로드 이벤트 히스토리 조회
</span></span></span><span class=line><span class=cl><span class=cm>     * - Netflix에서 특정 사용자의 모든 다운로드 이력 조회에 사용
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getEvents</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>aggregateId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extractUserId</span><span class=p>(</span><span class=n>aggregateId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Select</span><span class=w> </span><span class=n>select</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>QueryBuilder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>selectFrom</span><span class=p>(</span><span class=s>&#34;download_events&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>all</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>whereColumn</span><span class=p>(</span><span class=s>&#34;user_id&#34;</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>literal</span><span class=p>(</span><span class=n>userId</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>whereColumn</span><span class=p>(</span><span class=s>&#34;aggregate_id&#34;</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>literal</span><span class=p>(</span><span class=n>aggregateId</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orderBy</span><span class=p>(</span><span class=s>&#34;event_version&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ClusteringOrder</span><span class=p>.</span><span class=na>ASC</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Row</span><span class=o>&gt;</span><span class=w> </span><span class=n>rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cassandraTemplate</span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>select</span><span class=p>,</span><span class=w> </span><span class=n>Row</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>rows</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=k>this</span><span class=p>::</span><span class=n>deserializeEvent</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 실시간 다운로드 상태 프로젝션 (Netflix의 읽기 모델)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DownloadStatusProjection</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>RedisTemplate</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 다운로드 라이선스 승인 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - 실시간으로 사용자의 다운로드 가능 상태 업데이트
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventHandler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handle</span><span class=p>(</span><span class=n>DownloadLicenseGrantedEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DownloadStatusView</span><span class=w> </span><span class=n>view</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DownloadStatusView</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>view</span><span class=p>.</span><span class=na>setUserId</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getUserId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>view</span><span class=p>.</span><span class=na>setContentId</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getContentId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>view</span><span class=p>.</span><span class=na>setDeviceId</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getDeviceId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>view</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;LICENSED&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>view</span><span class=p>.</span><span class=na>setExpiryTime</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getExpiryTime</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Redis에 실시간 상태 저장 (Netflix의 실제 패턴)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;download:%s:%s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getUserId</span><span class=p>(),</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getContentId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>set</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>JsonUtils</span><span class=p>.</span><span class=na>toJson</span><span class=p>(</span><span class=n>view</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 다운로드 만료 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - 만료된 다운로드 정리 및 상태 업데이트
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handle</span><span class=p>(</span><span class=n>DownloadExpiredEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;download:%s:%s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getUserId</span><span class=p>(),</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getContentId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 만료 통계 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>increment</span><span class=p>(</span><span class=s>&#34;stats:expired_downloads&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>성능 개선</strong>: 전 세계 수백만 사용자의 동시 다운로드 요청 처리 가능</li><li><strong>운영 효율성</strong>: 라이선스 위반 자동 탐지 및 처리, 수동 감사 작업 90% 감소</li><li><strong>비용 절감</strong>: 콘텐츠 권한 관리 자동화로 운영 비용 30% 절감</li><li><strong>규정 준수</strong>: 완벽한 다운로드 감사 추적으로 콘텐츠 제공업체 요구사항 100% 만족</li></ul><h3 id=54-통합-및-연계-기술-분석>5.4 통합 및 연계 기술 분석<a hidden class=anchor aria-hidden=true href=#54-통합-및-연계-기술-분석>#</a></h3><p><strong>CQRS (Command Query Responsibility Segregation) 연계</strong>:</p><ul><li><strong>목적</strong>: Event Sourcing의 복잡한 읽기 쿼리 문제 해결</li><li><strong>구현</strong>: 명령 모델(이벤트 저장)과 쿼리 모델(프로젝션) 분리</li><li><strong>효과</strong>: 읽기/쓰기 성능 독립적 최적화</li></ul><p><strong>Message Broker 통합</strong>:</p><ul><li><strong>Apache Kafka</strong>: 대용량 이벤트 스트리밍 및 분산 처리</li><li><strong>RabbitMQ</strong>: 복잡한 라우팅 및 보장된 메시지 전달</li><li><strong>Azure Service Bus</strong>: 클라우드 네이티브 메시징</li></ul><p><strong>Domain-Driven Design (DDD) 연계</strong>:</p><ul><li><strong>Bounded Context</strong>: Event Sourcing 적용 범위 결정</li><li><strong>Aggregate</strong>: 일관성 경계 및 이벤트 스트림 단위</li><li><strong>Domain Events</strong>: 비즈니스 의미가 담긴 이벤트 설계</li></ul><p><strong>Microservices Architecture 통합</strong>:</p><ul><li><strong>Event-Driven Communication</strong>: 서비스 간 느슨한 결합</li><li><strong>Saga Pattern</strong>: 분산 트랜잭션 관리</li><li><strong>Event Choreography</strong>: 복잡한 비즈니스 프로세스 조정</li></ul><h2 id=phase-5-실무-적용>Phase 5: 실무 적용<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용>#</a></h2><h3 id=51-실습-예제-및-코드-구현-1>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현-1>#</a></h3><p><strong>학습 목표</strong>: 이벤트 스토어·프로젝션·스냅샷·업캐스팅/EOS의 핵심 개념 체득
<strong>시나리오</strong>: 간단한 <strong>계좌 원장</strong>(입금/출금) 서비스
<strong>시스템 구성</strong>:</p><ul><li>API, Command Handler, In-memory Event Store(→Kafka 대체 가능), Projector(Read DB)</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
  API[FastAPI/Express] --&gt; CMD[Command Handler]
  CMD --&gt; ES[(Event Store)]
  ES --&gt; PRJ[Projector]
  PRJ --&gt; RD[(Read DB)]
</pre><p><strong>Workflow</strong></p><ol><li><code>POST /deposit</code> → Command 검증</li><li>이벤트 생성·저장(append)</li><li>Projector가 이벤트 소비 후 Read DB 갱신</li><li><code>GET /balance</code>는 Read DB 반환</li></ol><p><strong>핵심 역할</strong></p><ul><li>Event Store: 단일 원천</li><li>Projector: idempotent 업데이트</li></ul><p><strong>유무 차이</strong></p><ul><li>도입 전: DB 스키마 변경/리포트 요구 시 마이그레이션 부담</li><li>도입 후: 프로젝션 재구축로 빠른 대응</li></ul><p><strong>구현 예시(Python FastAPI + 인메모리 프로젝션)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>read_model</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/deposit/</span><span class=si>{acc_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=n>acc_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=n>rehydrate</span><span class=p>(</span><span class=n>store</span><span class=p>,</span> <span class=n>acc_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>acc</span><span class=o>.</span><span class=n>decide_deposit</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span>  <span class=c1># ES 핵심: 도메인 결정 =&gt; 이벤트 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>acc_id</span><span class=p>,</span> <span class=n>acc</span><span class=o>.</span><span class=n>version</span><span class=p>,</span> <span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>  <span class=c1># projector: idempotent 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>read_model</span><span class=p>[</span><span class=n>acc_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>acc_id</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>e</span><span class=o>.</span><span class=n>amount</span>
</span></span><span class=line><span class=cl>        <span class=n>acc</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;balance&#34;</span><span class=p>:</span> <span class=n>read_model</span><span class=p>[</span><span class=n>acc_id</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/balance/</span><span class=si>{acc_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>balance</span><span class=p>(</span><span class=n>acc_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;balance&#34;</span><span class=p>:</span> <span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>acc_id</span><span class=p>,</span> <span class=mi>0</span><span class=p>)}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=52-실제-도입-사례요약>5.2 실제 도입 사례(요약)<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례요약>#</a></h3><ul><li><strong>금융/정산 원장</strong>: Uber LedgerStore—금융 이벤트의 원장·인덱싱으로 대규모 정산 지원. (<a href="https://www.uber.com/blog/how-ledgerstore-supports-trillions-of-indexes/?utm_source=chatgpt.com" title="How LedgerStore Supports Trillions of Indexes at Uber">Uber</a>, <a href="https://www.infoq.com/news/2024/05/uber-dynamodb-ledgerstore/?utm_source=chatgpt.com" title="Uber Migrates 1 Trillion Records from DynamoDB to ...">InfoQ</a>)</li><li><strong>디지털은행</strong>: Monzo—Kafka 기반 이벤트 파이프라인/큐 추상화로 확장성 확보. (<a href="https://monzo.com/blog/how-we-built-a-queue-on-top-of-kafka?utm_source=chatgpt.com" title="How we built a queue on top of Kafka">Monzo</a>)</li><li><strong>클라우드 샘플</strong>: Azure Cosmos DB/패턴 구현 샘플 제공. (<a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing">Microsoft Learn</a>)</li></ul><h3 id=53-실제-도입-사례의-코드-구현-1>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현-1>#</a></h3><p><strong>사례 선정</strong>: “Kafka + Schema Registry 기반 계좌 이벤트 스트림”
<strong>비즈니스 배경</strong>: 원장 서비스의 <strong>중복 방지</strong>와 <strong>스키마 진화</strong> 요구
<strong>기술적 요구사항</strong>: EOS, 스키마 호환성(BACKWARD), CloudEvents 메타</p><p><strong>시스템 구성</strong></p><ul><li>Producer(Node.js, Kafka 트랜잭션), Schema Registry, Projector(읽기 DB)</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
  P[Producer (Node.js)] --&gt; K[(Kafka)]
  K --&gt; SR[Schema Registry]
  K --&gt; C[Consumer/Projector]
  C --&gt; RD[(Read DB)]
</pre><p><strong>Workflow</strong></p><ol><li>Producer 트랜잭션 시작 → 메시지 발행</li><li>Schema Registry에 호환 스키마 등록/검증</li><li>Consumer 트랜잭션 처리 후 커밋(외부 DB 영향 최소화)</li></ol><p><strong>구현 예시 (AsyncAPI + 설정 스니펫)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 이 설정은 Kafka 메시지 계약(스키마) 거버넌스를 위한 것</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>asyncapi</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.0.0&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>info</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>title: account-events, version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;1.0.0&#39;</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>servers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prod</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>host: kafka:9092, protocol</span><span class=p>:</span><span class=w> </span><span class=l>kafka }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>channels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>account-events</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>account-events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>messages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>FundsDeposited</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>FundsDeposited</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>payload</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>$ref</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;https://schema-registry/schemas/ids/1001&#39;</span><span class=w>  </span><span class=c># Avro/JSON Schema Registry 연계</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>AsyncAPI·Schema Registry 연계 근거. (<a href="https://docs.confluent.io/cloud/current/stream-governance/async-api.html?utm_source=chatgpt.com" title="Using the AsyncAPI with Stream Governance">Confluent Docs</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">asyncapi.com</a>)</p><p><strong>성과 분석</strong></p><ul><li>성능: 중복율 0에 근접(EOS 경로), 재생 시간 단축(스냅샷)</li><li>운영: 스키마 호환성 자동 검증으로 배포 리스크↓</li><li>비용: 리드 모델 재구축 자동화로 마이그레이션 비용↓ (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>, <a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">Domain Centric</a>)</li></ul><h3 id=54-통합-및-연계-기술>5.4 통합 및 연계 기술<a hidden class=anchor aria-hidden=true href=#54-통합-및-연계-기술>#</a></h3><ul><li>Outbox/CDC와 결합(이중 기록 문제 해결), 계약 우선(AsyncAPI), 표준 이벤트 포맷(CloudEvents). (<a href="https://www.confluent.io/blog/dual-write-problem/?utm_source=chatgpt.com" title="Understanding the Dual-Write Problem and Its Solutions">Confluent</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</li></ul><hr><h2 id=phase-6-운영-및-최적화>Phase 6: 운영 및 최적화<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화>#</a></h2><h3 id=61-보안거버넌스>6.1 보안/거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안거버넌스>#</a></h3><ul><li><strong>PII 최소화/분리</strong>, <strong>암호화(Envelope)+키 파기</strong>로 GDPR “삭제권” 충족(암호학적 소거), <strong>보존정책/수명주기</strong>. Vault/KMS 연계. (<a href="https://www.hashicorp.com/en/resources/gdpr-compliant-event-sourcing-with-hashicorp-vault?utm_source=chatgpt.com" title="GDPR Compliant Event Sourcing With HashiCorp Vault">HashiCorp | An IBM Company</a>, <a href="https://medium.com/sydseter/gdpr-compliant-event-sourcing-with-hashicorp-vault-f27011cac318?utm_source=chatgpt.com" title="GDPR compliant event sourcing with HashiCorp Vault">Medium</a>)</li></ul><h3 id=62-모니터링관측성>6.2 모니터링/관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링관측성>#</a></h3><ul><li><strong>핵심 지표</strong>: append 지연, 소비자 랙, 프로젝션 처리율, DLQ 건수, 스냅샷 히트율.</li><li><strong>플랫폼</strong>: EventStoreDB Prometheus <code>/metrics</code>, Grafana 대시보드, Datadog 통합.</li><li><strong>분산추적</strong>: OpenTelemetry Messaging/Kafka 시맨틱으로 <code>process/send</code> 스팬, trace id 전파. (<a href="https://www.kurrent.io/blog/metrics-in-eventstoredb-23.10?utm_source=chatgpt.com" title="Metrics in EventStoreDB 23.10 - Kurrent.io">Kurrent - event-native data platform</a>, <a href="https://grafana.com/grafana/dashboards/7673-eventstore/?utm_source=chatgpt.com" title="KurrentDB / EventStoreDB | Grafana Labs">Grafana Labs</a>, <a href="https://docs.datadoghq.com/integrations/eventstore/?utm_source=chatgpt.com" title=Eventstore>docs.datadoghq.com</a>, <a href="https://opentelemetry.io/docs/specs/semconv/messaging/messaging-spans/?utm_source=chatgpt.com" title="Semantic conventions for messaging spans">OpenTelemetry</a>)</li></ul><h3 id=63-실무-고려사항표>6.3 실무 고려사항(표)<a hidden class=anchor aria-hidden=true href=#63-실무-고려사항표>#</a></h3><blockquote><p><strong>이 표는</strong> 운영 시 주의점과 권장사항을 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3>3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4>4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5>5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6>6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 영역 | 고려사항 | 권장사항 |
</span></span><span class=line><span class=cl>|------|----------|---------|
</span></span><span class=line><span class=cl>| 일관성 | 최종 일관성 | UX/리드리플리카 정책, 보류 상태 표시 |
</span></span><span class=line><span class=cl>| 성능 | 재생 시간 | 스냅샷/배치 리플레이/파티셔닝 |
</span></span><span class=line><span class=cl>| 스키마 | 진화/검증 | Registry BACKWARD/FULL, CI 호환성 테스트 |
</span></span><span class=line><span class=cl>| 신뢰성 | 중복/순서 | Idempotency 키, Kafka EOS/트랜잭션 |
</span></span><span class=line><span class=cl>| 거버넌스 | PII/보존 | 키 파기/레드액션/보존주기 정책 |
</span></span></code></pre></td></tr></table></div></div><h3 id=64-성능-최적화표>6.4 성능 최적화(표)<a hidden class=anchor aria-hidden=true href=#64-성능-최적화표>#</a></h3><blockquote><p><strong>이 표는</strong> 성능 병목과 개선 전략을 빠르게 적용하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4>4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 병목 | 신호 | 전략 | 비고 |
</span></span><span class=line><span class=cl>|-----|------|------|------|
</span></span><span class=line><span class=cl>| 재생 지연 | API 타임아웃 | 스냅샷 주기 단축, 핫스트림 캐시 | 측정 기반 도입 |
</span></span><span class=line><span class=cl>| 프로젝션 | 소비자 랙↑ | 파티션 확장, 병렬 projector | 멱등 설계 필수 |
</span></span><span class=line><span class=cl>| 스토어 I/O | 디스크 바운드 | 배치 append, 압축/세그먼트 튜닝 | 브로커/스토어별 |
</span></span></code></pre></td></tr></table></div></div><h2 id=phase-6-운영-및-최적화-operations--optimization>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization>#</a></h2><h3 id=61-보안-및-거버넌스>6.1 보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스>#</a></h3><p><strong>Event Sourcing 보안 고려사항</strong>:</p><blockquote><p>이 표는 Event Sourcing 환경에서의 보안 위협과 대응 방안을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>보안 영역</th><th>위협 유형</th><th>위험도</th><th>대응 방안</th><th>구현 기술</th></tr></thead><tbody><tr><td>데이터 기밀성</td><td>민감 정보 노출</td><td>높음</td><td>이벤트 데이터 암호화</td><td>AES-256, Field-level Encryption</td></tr><tr><td>데이터 무결성</td><td>이벤트 위변조</td><td>높음</td><td>디지털 서명, 해시 체인</td><td>HMAC, Digital Signatures</td></tr><tr><td>접근 제어</td><td>무단 이벤트 조회</td><td>중간</td><td>RBAC, 집계별 권한 제어</td><td>OAuth2, JWT</td></tr><tr><td>개인정보 보호</td><td>GDPR 준수</td><td>높음</td><td>암호화 소거 기법</td><td>Cryptographic Erasure</td></tr><tr><td>감사 추적</td><td>보안 이벤트 탐지</td><td>중간</td><td>보안 이벤트 로깅</td><td>SIEM, Security Event Logs</td></tr></tbody></table><p><strong>Cryptographic Erasure (암호화 소거) 구현</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EncryptedEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    GDPR 준수를 위한 암호화 소거 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - 개인정보를 암호화하여 저장하고, 삭제 요청 시 키만 삭제
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>encryption_keys</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 사용자별 암호화 키</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>store_event_with_encryption</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 사용자별 암호화 키 생성 또는 조회</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>encryption_keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>encryption_keys</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_encryption_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 민감 데이터 암호화</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>event_data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>encryption_keys</span><span class=p>[</span><span class=n>user_id</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 암호화된 이벤트 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_data</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forget_user_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;GDPR 삭제 요청 처리 - 키만 삭제하여 데이터를 영구히 읽을 수 없게 함&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>encryption_keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>encryption_keys</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 자체는 삭제하지 않아 Event Sourcing 원칙 유지</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>규정 준수 요구사항</strong>:</p><p><strong>SOX (Sarbanes-Oxley Act)</strong>:</p><ul><li>재무 데이터의 완전한 감사 추적</li><li>데이터 변경 이력의 불변성 보장</li><li>정기적 내부 통제 검증</li></ul><p><strong>HIPAA (Health Insurance Portability and Accountability Act)</strong>:</p><ul><li>의료 정보 접근 로그 완전 기록</li><li>환자 데이터 수정/삭제 이력 추적</li><li>최소 권한 원칙 적용</li></ul><p><strong>PCI DSS (Payment Card Industry Data Security Standard)</strong>:</p><ul><li>결제 정보 처리 모든 단계 기록</li><li>카드 데이터 접근 감사 추적</li><li>보안 이벤트 실시간 모니터링</li></ul><h3 id=62-모니터링-및-관측성>6.2 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성>#</a></h3><p><strong>Event Sourcing 전용 메트릭</strong>:</p><blockquote><p>이 표는 Event Sourcing 시스템의 건강성을 모니터링하기 위한 핵심 메트릭을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>메트릭 카테고리</th><th>측정 항목</th><th>정상 범위</th><th>알림 조건</th><th>비즈니스 영향</th></tr></thead><tbody><tr><td>이벤트 처리량</td><td>Events/sec</td><td>1,000-10,000</td><td>&lt; 100 또는 > 50,000</td><td>시스템 과부하 또는 성능 저하</td></tr><tr><td>이벤트 지연시간</td><td>명령→이벤트 저장</td><td>&lt; 100ms</td><td>> 500ms</td><td>사용자 경험 저하</td></tr><tr><td>프로젝션 지연</td><td>이벤트→읽기모델 반영</td><td>&lt; 1초</td><td>> 5초</td><td>데이터 일관성 문제</td></tr><tr><td>이벤트 스트림 크기</td><td>Events per Aggregate</td><td>100-1,000</td><td>> 10,000</td><td>성능 저하, 스냅샷 필요</td></tr><tr><td>재생 시간</td><td>Full Replay Duration</td><td>&lt; 10분</td><td>> 1시간</td><td>복구 시간 지연</td></tr><tr><td>동시성 충돌</td><td>Concurrency Conflicts/min</td><td>&lt; 10</td><td>> 100</td><td>비즈니스 로직 검토 필요</td></tr></tbody></table><p><strong>실시간 모니터링 대시보드 구성</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22>22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23>23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24>24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25>25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Prometheus 메트릭 수집 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>prometheus_client</span> <span class=kn>import</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Histogram</span><span class=p>,</span> <span class=n>Gauge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventSourcingMetrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Event Sourcing 전용 메트릭 수집기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 처리 메트릭</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events_total</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=s1>&#39;events_stored_total&#39;</span><span class=p>,</span> <span class=s1>&#39;Total events stored&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;aggregate_type&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_processing_duration</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span><span class=s1>&#39;event_processing_seconds&#39;</span><span class=p>,</span> <span class=s1>&#39;Event processing time&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 프로젝션 메트릭  </span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>projection_lag</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span><span class=s1>&#39;projection_lag_seconds&#39;</span><span class=p>,</span> <span class=s1>&#39;Projection update lag&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;projection_name&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시스템 건강성 메트릭</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_size</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span><span class=s1>&#39;aggregate_event_count&#39;</span><span class=p>,</span> <span class=s1>&#39;Events per aggregate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>replay_duration</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span><span class=s1>&#39;replay_duration_seconds&#39;</span><span class=p>,</span> <span class=s1>&#39;Event replay time&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_event_stored</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>processing_time</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 저장 메트릭 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events_total</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>aggregate_type</span><span class=o>=</span><span class=n>aggregate_type</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_processing_duration</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>processing_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_projection_lag</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>projection_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>lag_seconds</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;프로젝션 지연 메트릭 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>projection_lag</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>projection_name</span><span class=o>=</span><span class=n>projection_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lag_seconds</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>로깅 전략</strong>:</p><p><strong>구조화된 로깅</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=s2>&#34;order-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregate_type&#34;</span><span class=p>:</span> <span class=s2>&#34;Order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;user-456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;correlation_id&#34;</span><span class=p>:</span> <span class=s2>&#34;req-789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;processing_time_ms&#34;</span><span class=p>:</span> <span class=mi>45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;environment&#34;</span><span class=p>:</span> <span class=s2>&#34;production&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>분산 추적 (Distributed Tracing)</strong>:</p><ul><li>명령 수신부터 프로젝션 업데이트까지 전체 플로우 추적</li><li>마이크로서비스 간 이벤트 전파 경로 시각화</li><li>성능 병목 지점 식별</li></ul><h3 id=63-실무-적용-고려사항-및-주의점>6.3 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-주의점>#</a></h3><blockquote><p>이 표는 Event Sourcing 실무 도입 시 반드시 고려해야 할 사항들과 권장사항을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>고려사항 카테고리</th><th>주의점</th><th>원인/위험</th><th>권장 대응방안</th><th>우선순위</th></tr></thead><tbody><tr><td>팀 역량</td><td>높은 학습 곡선</td><td>개념 복잡성, 구현 난이도</td><td>단계적 교육, 파일럿 프로젝트</td><td>높음</td></tr><tr><td>기술 부채</td><td>기존 시스템과의 불일치</td><td>레거시 시스템 연동 복잡성</td><td>점진적 마이그레이션 전략</td><td>높음</td></tr><tr><td>성능 최적화</td><td>읽기 성능 저하</td><td>이벤트 재생 오버헤드</td><td>스냅샷 전략, 캐싱</td><td>중간</td></tr><tr><td>데이터 거버넌스</td><td>이벤트 스키마 관리</td><td>하위 호환성 깨짐</td><td>이벤트 버저닝 정책</td><td>높음</td></tr><tr><td>운영 복잡성</td><td>디버깅 어려움</td><td>분산 이벤트 처리</td><td>통합 모니터링, 로깅</td><td>중간</td></tr><tr><td>비즈니스 정렬</td><td>도메인 모델링 오류</td><td>잘못된 집계 경계 설정</td><td>DDD 전문가 협업</td><td>높음</td></tr></tbody></table><p><strong>권장사항</strong>:</p><p><strong>도입 단계별 접근법</strong>:</p><ol><li><strong>1단계 (Pilot)</strong>: 단일 Bounded Context에서 시작</li><li><strong>2단계 (Expansion)</strong>: 성공 사례를 기반으로 확장</li><li><strong>3단계 (Integration)</strong>: 시스템 간 이벤트 기반 통신</li><li><strong>4단계 (Optimization)</strong>: 성능 최적화 및 고도화</li></ol><p><strong>기술적 권장사항</strong>:</p><ul><li><strong>시작 단순하게</strong>: 복잡한 CQRS보다 단순한 Event Sourcing부터</li><li><strong>도메인 우선</strong>: 기술보다 비즈니스 도메인 이해 우선</li><li><strong>점진적 도입</strong>: Big Bang 방식보다 단계적 적용</li><li><strong>전문가 활용</strong>: 초기에는 경험있는 컨설턴트 활용</li></ul><h3 id=64-성능-최적화-전략-및-고려사항>6.4 성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항>#</a></h3><blockquote><p>이 표는 Event Sourcing 시스템의 성능 최적화 전략과 구현 방법을 체계적으로 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>최적화 영역</th><th>전략</th><th>구현 방법</th><th>예상 성능 개선</th><th>구현 복잡도</th><th>권장 시기</th></tr></thead><tbody><tr><td>읽기 성능</td><td>스냅샷 전략</td><td>주기적 상태 저장</td><td>90% 읽기 시간 단축</td><td>중간</td><td>초기</td></tr><tr><td>읽기 성능</td><td>프로젝션 최적화</td><td>읽기 전용 모델 구성</td><td>95% 쿼리 성능 향상</td><td>낮음</td><td>초기</td></tr><tr><td>쓰기 성능</td><td>배치 이벤트 저장</td><td>다중 이벤트 한번에 저장</td><td>50% 쓰기 처리량 증가</td><td>낮음</td><td>중기</td></tr><tr><td>저장소 성능</td><td>파티셔닝 전략</td><td>집계별/시간별 분산</td><td>선형 확장성 확보</td><td>높음</td><td>중기</td></tr><tr><td>네트워크 성능</td><td>이벤트 압축</td><td>직렬화 최적화</td><td>60% 대역폭 절약</td><td>중간</td><td>후기</td></tr><tr><td>메모리 성능</td><td>지연 로딩</td><td>필요시에만 이벤트 로드</td><td>70% 메모리 사용량 감소</td><td>중간</td><td>후기</td></tr></tbody></table><p><strong>스냅샷 최적화 전략</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span><span class=lnt id=hl-38-27><a class=lnlinks href=#hl-38-27>27</a>
</span><span class=lnt id=hl-38-28><a class=lnlinks href=#hl-38-28>28</a>
</span><span class=lnt id=hl-38-29><a class=lnlinks href=#hl-38-29>29</a>
</span><span class=lnt id=hl-38-30><a class=lnlinks href=#hl-38-30>30</a>
</span><span class=lnt id=hl-38-31><a class=lnlinks href=#hl-38-31>31</a>
</span><span class=lnt id=hl-38-32><a class=lnlinks href=#hl-38-32>32</a>
</span><span class=lnt id=hl-38-33><a class=lnlinks href=#hl-38-33>33</a>
</span><span class=lnt id=hl-38-34><a class=lnlinks href=#hl-38-34>34</a>
</span><span class=lnt id=hl-38-35><a class=lnlinks href=#hl-38-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotOptimizer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    스냅샷 최적화 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - Event Sourcing에서 가장 효과적인 성능 최적화 기법
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_threshold</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>time_threshold_hours</span><span class=o>=</span><span class=mi>24</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_threshold</span> <span class=o>=</span> <span class=n>event_threshold</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>time_threshold</span> <span class=o>=</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=n>time_threshold_hours</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>should_create_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;스냅샷 생성 여부 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 개수 기준</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시간 기준</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>events</span> <span class=ow>and</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=n>events</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>time_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_optimized_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SnapshotData</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;최적화된 스냅샷 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 중요한 상태만 선별적으로 저장</span>
</span></span><span class=line><span class=cl>        <span class=n>essential_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_essential_state</span><span class=p>(</span><span class=n>aggregate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 압축 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>compressed_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>compress_state</span><span class=p>(</span><span class=n>essential_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>SnapshotData</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=n>aggregate</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>version</span><span class=o>=</span><span class=n>aggregate</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>compressed_state</span><span class=o>=</span><span class=n>compressed_state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>쿼리 성능 최적화</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15>15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16>16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17>17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18>18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19>19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20>20</a>
</span><span class=lnt id=hl-39-21><a class=lnlinks href=#hl-39-21>21</a>
</span><span class=lnt id=hl-39-22><a class=lnlinks href=#hl-39-22>22</a>
</span><span class=lnt id=hl-39-23><a class=lnlinks href=#hl-39-23>23</a>
</span><span class=lnt id=hl-39-24><a class=lnlinks href=#hl-39-24>24</a>
</span><span class=lnt id=hl-39-25><a class=lnlinks href=#hl-39-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OptimizedProjectionManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    프로젝션 성능 최적화
</span></span></span><span class=line><span class=cl><span class=s2>    - 읽기 쿼리 패턴에 맞춘 전용 인덱스 구성
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 자주 조회되는 프로젝션 캐싱</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_specialized_projections</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;쿼리 패턴별 전용 프로젝션 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시간 기반 프로젝션 (대시보드용)</span>
</span></span><span class=line><span class=cl>        <span class=n>daily_stats</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>build_daily_statistics</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용자별 프로젝션 (개인화된 뷰)</span>
</span></span><span class=line><span class=cl>        <span class=n>user_views</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>build_user_specific_views</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 검색 최적화 프로젝션 (전문 검색)</span>
</span></span><span class=line><span class=cl>        <span class=n>search_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>build_search_optimized_index</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;daily_stats&#39;</span><span class=p>:</span> <span class=n>daily_stats</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_views&#39;</span><span class=p>:</span> <span class=n>user_views</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;search_index&#39;</span><span class=p>:</span> <span class=n>search_index</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>대용량 데이터 처리 최적화</strong>:</p><ul><li><strong>스트림 처리</strong>: 배치 대신 실시간 스트림 처리로 지연시간 최소화</li><li><strong>파티셔닝</strong>: 시간, 지역, 사용자별 데이터 분산</li><li><strong>압축</strong>: 이벤트 페이로드 압축으로 저장 공간 절약</li><li><strong>비동기 처리</strong>: 이벤트 핸들러 비동기 실행으로 처리량 증대</li></ul><h1 id=phase-6-운영-및-최적화-operations--optimization-1>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization-1>#</a></h1><h2 id=61-보안-및-거버넌스-security--governance>6.1 보안 및 거버넌스 (Security & Governance)<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스-security--governance>#</a></h2><ul><li><strong>이벤트 불변성(Immutable Event)</strong>: 이벤트 변조 방지 및 보존 정책 필수.</li><li><strong>접근 제어</strong>: Event Store(이벤트 저장소)에 대한 읽기/쓰기 권한 관리.</li><li><strong>감사(audit) 로깅</strong>: 각 이벤트마다 기록자·타임스탬프 명확히 관리.</li><li><strong>데이터 보호 규정</strong>: GDPR, ISO27001 등 개인정보/이력 책임 준수.</li></ul><h2 id=62-모니터링-및-관측성-monitoring--observability>6.2 모니터링 및 관측성 (Monitoring & Observability)<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성-monitoring--observability>#</a></h2><ul><li><strong>이벤트 흐름 모니터링</strong>: 메트릭 및 트레이싱 도구로 이벤트 생성-저장-재생 과정 확인.</li><li><strong>Event Lag 엔진 관리</strong>: 병목·지연 이벤트 감지 및 경고 시스템 구축.</li><li><strong>실시간 대시보드</strong>: 이벤트 발생/처리량, 실패율, 주요 상태변화 시각화.</li><li><strong>로그/메트릭 연동</strong>: Prometheus, Grafana, ELK(Elasticsearch, Logstash, Kibana) 등 활용.</li></ul><h2 id=63-실무-적용-고려사항-및-주의점-1>6.3 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-주의점-1>#</a></h2><blockquote><p>이 표는 실무 적용 시의 주요 고려사항과 권장점·주의점을 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 설명 | 주의점 | 권장사항 |
</span></span><span class=line><span class=cl>|------|------|------|--------|----------|
</span></span><span class=line><span class=cl>| 운영 | 이벤트 순서 보장 | Event Replay시 순서 오류 방지 | 멱등성 보장 실패 시 데이터 혼란 유발 | 글로벌 순번, Event ID 도입 |
</span></span><span class=line><span class=cl>| 운영 | 스냅샷 빈도 | 자주 저장하면 저장소 부담, 적게 저장시 복원 느림 | 대량 이벤트에서는 성능 저하 | 이벤트양·트래픽별 적절 빈도 조정 |
</span></span><span class=line><span class=cl>| 운영 | 이벤트 스키마 변경 | 하위 호환성 유지 필요 | 스키마 불일치로 복원 장애 | 버전관리·변환로직 명확화 |
</span></span><span class=line><span class=cl>| 운영 | 분산환경 적용 | 노드별 동기화·정합성 중요 | 네트워크 장애시 이벤트 손실 위험 | 메시지 큐·브로커 연계 통합 |
</span></span></code></pre></td></tr></table></div></div><h2 id=64-성능-최적화-전략-및-고려사항-1>6.4 성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항-1>#</a></h2><blockquote><p>이 표는 Event Sourcing의 성능 최적화 방안과 권장사항을 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2>2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3>3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4>4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5>5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 설명 | 최적화 전략 | 비고 |
</span></span><span class=line><span class=cl>|------|------|------|-------------|------|
</span></span><span class=line><span class=cl>| 성능 | 이벤트 병렬처리 | 동시성 이벤트를 병렬로 처리해 처리량 확보 | 멀티스레드, 비동기 기반 처리 | 병렬 이벤트 충돌 방지 |
</span></span><span class=line><span class=cl>| 성능 | 스냅샷 도입 | 이벤트 재생 속도 향상 | 일정 이벤트수/시간마다 Snapshot 적재 | 주기적 백업 병행 |
</span></span><span class=line><span class=cl>| 성능 | Read Model 분리 | 조회용 모델 별도 구축으로 조회 성능 강화 | CQRS로 분리, 캐싱 활용 | 실시간/비동기 조회 |
</span></span><span class=line><span class=cl>| 성능 | 이벤트 필터링 | 불필요 이벤트(중복/무효) 미리 걸러내기 | Pre-Filtering 로직 도입 | 데이터 정합성 ↑ |
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=phase-7-고급-주제-advanced-topics>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics>#</a></h1><h2 id=71-현재-도전-과제>7.1 현재 도전 과제<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제>#</a></h2><ul><li><strong>이벤트 스키마 진화 문제</strong>: 이벤트 구조 변경 시 과거 이벤트 호환성, 변환 로직 완성도.</li><li><strong>대용량 이벤트 저장 최적화</strong>: 수십만~수억 이벤트 저장·조회 성능, 최적화 방안.</li><li><strong>복합 이벤트/거래/분산 트랜잭션</strong>: 여러 이벤트 동시 발생, ACID 보장 문제.</li><li><strong>분산 시스템 장애 복구 및 Rollback</strong>: 이벤트가 여러 노드에 분산시 발생 가능한 장애 시나리오와 복구 전략.</li></ul><blockquote><p>이 표는 도전 과제와 해결방안을 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2>2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3>3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4>4</a>
</span><span class=lnt id=hl-42-5><a class=lnlinks href=#hl-42-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 과제 | 원인 | 영향 | 해결방안 |
</span></span><span class=line><span class=cl>|------|------|------|------|----------|
</span></span><span class=line><span class=cl>| 난제 | 이벤트 스키마 진화 | 버전 변경, 구조 확장 | 복원 장애, 마이그레이션 문제 | 스키마 버저닝·변환모듈 구현 |
</span></span><span class=line><span class=cl>| 난제 | 대용량 저장 | 이벤트 폭증 | 조회/복원 속도 저하 | 분산 스토리지, 인덱스 최적화 |
</span></span><span class=line><span class=cl>| 난제 | 분산 시스템 오류 | 네트워크 장애, 노드 장애 | 이벤트 유실, 데이터 불일치 | 메시지 큐 강한 일관성, 재시도 로직 |
</span></span></code></pre></td></tr></table></div></div><h2 id=72-생태계-및-관련-기술>7.2 생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술>#</a></h2><ul><li><strong>메시지 브로커 연동</strong>: Kafka, RabbitMQ, AWS Kinesis 등 대량 이벤트 처리</li><li><strong>CQRS, Domain-Driven Design (DDD, 도메인 모델링)</strong>: Event Sourcing과 궁합이 좋은 아키텍처 스타일</li><li><strong>분산 저장소/이벤트 로그 시스템</strong>: EventStoreDB, Apache Pulsar(이벤트 스트림 포함) 등</li></ul><blockquote><p>이 표는 관련 기술·생태계와 Event Sourcing의 통합관계를 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2>2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3>3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4>4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 기술 | 특징 | 연동예시 | 주요 활용 |
</span></span><span class=line><span class=cl>|------|------|------|---------|----------|
</span></span><span class=line><span class=cl>| 아키텍처 | CQRS | 커맨드/쿼리 분리 | CQRS+ES 통합 | 확장성·성능 |
</span></span><span class=line><span class=cl>| 메시징 | Kafka | 자동 파티셔닝, 이벤트 스트림 | 이벤트 로그 저장 | 실시간 데이터 처리 |
</span></span><span class=line><span class=cl>| 분산저장 | EventStoreDB | Append-only, 불변 이벤트 저장 | 스냅샷 통합 | 대규모 이력 관리 |
</span></span></code></pre></td></tr></table></div></div><h2 id=73-최신-기술-트렌드와-미래-방향>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향>#</a></h2><ul><li><strong>서버리스(Serverless)·클라우드 Event Sourcing</strong>: AWS Lambda, Azure Functions 등 무상태 시스템에서 이벤트 소싱 활용 증가</li><li><strong>AI 기반 이벤트 패턴 분석</strong>: 이벤트 시계열 데이터로 이상탐지, 예측, 자동 진단</li><li><strong>복합 이벤트 스트리밍/스트림 프로세서 통합</strong>: Apache Flink, Kafka Streams 등 실시간 Analytics 분야 확장</li><li><strong>정책기반 롤백/자동화</strong>: 비즈니스 규칙에 따라 이벤트 롤백·재생 구간 자동 관리</li></ul><h2 id=74-기타-전문가-고려사항>7.4 기타 전문가 고려사항<a hidden class=anchor aria-hidden=true href=#74-기타-전문가-고려사항>#</a></h2><ul><li><strong>오픈소스/도구 커뮤니티 활성화</strong>: EventStoreDB, Axon 등 빠른 업데이트</li><li><strong>법률·컴플라이언스 정책 강화</strong>: 개인정보 기록의 삭제/보존 등</li><li><strong>도메인 사업별 특화 설계(금융, 의료, 공공 등)</strong>: 도메인 요구에 최적화된 커스텀 이벤트 관리 전략 필요</li></ul><h2 id=phase-7-고급-주제-advanced-topics-1>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics-1>#</a></h2><h3 id=71-현재-도전-과제-실무-환경-기반-기술-난제>7.1 현재 도전 과제 (실무 환경 기반 기술 난제)<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제-실무-환경-기반-기술-난제>#</a></h3><blockquote><p>이 표는 Event Sourcing을 실무에 적용할 때 직면하는 주요 기술적 도전과제와 대응방안을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>난제 영역</th><th>구체적 문제</th><th>원인</th><th>비즈니스 영향</th><th>탐지 방법</th><th>해결방안</th></tr></thead><tbody><tr><td>스키마 진화</td><td>이벤트 구조 변경 시 하위 호환성</td><td>비즈니스 요구사항 변화</td><td>시스템 장애, 데이터 손실</td><td>스키마 호환성 테스트</td><td>이벤트 업캐스팅, 다중 버전 지원</td></tr><tr><td>대용량 처리</td><td>수억 개 이벤트 재생 지연</td><td>이벤트 누적으로 인한 성능 저하</td><td>시스템 응답 지연</td><td>재생 시간 모니터링</td><td>스마트 스냅샷, 계층적 저장</td></tr><tr><td>분산 순서성</td><td>다중 노드에서 이벤트 순서 보장</td><td>CAP 정리에 따른 일관성 vs 가용성</td><td>비즈니스 로직 오류</td><td>이벤트 순서 검증</td><td>Vector Clock, Lamport Timestamp</td></tr><tr><td>외부 시스템 연동</td><td>이벤트 재생 시 외부 API 중복 호출</td><td>사이드 이펙트가 있는 외부 연동</td><td>비용 증가, 데이터 불일치</td><td>외부 호출 로그 분석</td><td>Outbox Pattern, Saga 패턴</td></tr><tr><td>보안 및 개인정보</td><td>GDPR 등 개인정보 삭제 요구</td><td>이벤트 불변성 vs 개인정보 보호</td><td>법적 리스크</td><td>개인정보 감사 도구</td><td>암호화 소거, 익명화</td></tr><tr><td>복잡한 쿼리</td><td>크로스 집계 분석 쿼리</td><td>이벤트 기반 저장의 한계</td><td>비즈니스 인사이트 부족</td><td>쿼리 성능 측정</td><td>CQRS, 전용 분석 DB</td></tr></tbody></table><p><strong>고급 스키마 진화 전략</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1> 1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2> 2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3> 3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4> 4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5> 5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6> 6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7> 7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8> 8</a>
</span><span class=lnt id=hl-44-9><a class=lnlinks href=#hl-44-9> 9</a>
</span><span class=lnt id=hl-44-10><a class=lnlinks href=#hl-44-10>10</a>
</span><span class=lnt id=hl-44-11><a class=lnlinks href=#hl-44-11>11</a>
</span><span class=lnt id=hl-44-12><a class=lnlinks href=#hl-44-12>12</a>
</span><span class=lnt id=hl-44-13><a class=lnlinks href=#hl-44-13>13</a>
</span><span class=lnt id=hl-44-14><a class=lnlinks href=#hl-44-14>14</a>
</span><span class=lnt id=hl-44-15><a class=lnlinks href=#hl-44-15>15</a>
</span><span class=lnt id=hl-44-16><a class=lnlinks href=#hl-44-16>16</a>
</span><span class=lnt id=hl-44-17><a class=lnlinks href=#hl-44-17>17</a>
</span><span class=lnt id=hl-44-18><a class=lnlinks href=#hl-44-18>18</a>
</span><span class=lnt id=hl-44-19><a class=lnlinks href=#hl-44-19>19</a>
</span><span class=lnt id=hl-44-20><a class=lnlinks href=#hl-44-20>20</a>
</span><span class=lnt id=hl-44-21><a class=lnlinks href=#hl-44-21>21</a>
</span><span class=lnt id=hl-44-22><a class=lnlinks href=#hl-44-22>22</a>
</span><span class=lnt id=hl-44-23><a class=lnlinks href=#hl-44-23>23</a>
</span><span class=lnt id=hl-44-24><a class=lnlinks href=#hl-44-24>24</a>
</span><span class=lnt id=hl-44-25><a class=lnlinks href=#hl-44-25>25</a>
</span><span class=lnt id=hl-44-26><a class=lnlinks href=#hl-44-26>26</a>
</span><span class=lnt id=hl-44-27><a class=lnlinks href=#hl-44-27>27</a>
</span><span class=lnt id=hl-44-28><a class=lnlinks href=#hl-44-28>28</a>
</span><span class=lnt id=hl-44-29><a class=lnlinks href=#hl-44-29>29</a>
</span><span class=lnt id=hl-44-30><a class=lnlinks href=#hl-44-30>30</a>
</span><span class=lnt id=hl-44-31><a class=lnlinks href=#hl-44-31>31</a>
</span><span class=lnt id=hl-44-32><a class=lnlinks href=#hl-44-32>32</a>
</span><span class=lnt id=hl-44-33><a class=lnlinks href=#hl-44-33>33</a>
</span><span class=lnt id=hl-44-34><a class=lnlinks href=#hl-44-34>34</a>
</span><span class=lnt id=hl-44-35><a class=lnlinks href=#hl-44-35>35</a>
</span><span class=lnt id=hl-44-36><a class=lnlinks href=#hl-44-36>36</a>
</span><span class=lnt id=hl-44-37><a class=lnlinks href=#hl-44-37>37</a>
</span><span class=lnt id=hl-44-38><a class=lnlinks href=#hl-44-38>38</a>
</span><span class=lnt id=hl-44-39><a class=lnlinks href=#hl-44-39>39</a>
</span><span class=lnt id=hl-44-40><a class=lnlinks href=#hl-44-40>40</a>
</span><span class=lnt id=hl-44-41><a class=lnlinks href=#hl-44-41>41</a>
</span><span class=lnt id=hl-44-42><a class=lnlinks href=#hl-44-42>42</a>
</span><span class=lnt id=hl-44-43><a class=lnlinks href=#hl-44-43>43</a>
</span><span class=lnt id=hl-44-44><a class=lnlinks href=#hl-44-44>44</a>
</span><span class=lnt id=hl-44-45><a class=lnlinks href=#hl-44-45>45</a>
</span><span class=lnt id=hl-44-46><a class=lnlinks href=#hl-44-46>46</a>
</span><span class=lnt id=hl-44-47><a class=lnlinks href=#hl-44-47>47</a>
</span><span class=lnt id=hl-44-48><a class=lnlinks href=#hl-44-48>48</a>
</span><span class=lnt id=hl-44-49><a class=lnlinks href=#hl-44-49>49</a>
</span><span class=lnt id=hl-44-50><a class=lnlinks href=#hl-44-50>50</a>
</span><span class=lnt id=hl-44-51><a class=lnlinks href=#hl-44-51>51</a>
</span><span class=lnt id=hl-44-52><a class=lnlinks href=#hl-44-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>AdvancedEventUpgrader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    고급 이벤트 스키마 진화 처리기
</span></span></span><span class=line><span class=cl><span class=s2>    - 복잡한 스키마 변경에도 대응하는 Event Sourcing 구현
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upgrade_chains</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 버전 체인별 업그레이드 경로</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>schema_registry</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 스키마 버전 레지스트리</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_upgrade_chain</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>from_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>to_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>upgrader</span><span class=p>:</span> <span class=n>callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;스키마 업그레이드 체인 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>upgrade_chains</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>upgrade_chains</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upgrade_chains</span><span class=p>[</span><span class=n>event_type</span><span class=p>][(</span><span class=n>from_version</span><span class=p>,</span> <span class=n>to_version</span><span class=p>)]</span> <span class=o>=</span> <span class=n>upgrader</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>upgrade_event_with_fallback</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>target_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        폴백 전략을 포함한 이벤트 업그레이드
</span></span></span><span class=line><span class=cl><span class=s2>        - Event Sourcing에서 스키마 진화의 고급 패턴
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;schema_version&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_type&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_version</span> <span class=o>==</span> <span class=n>target_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>event_data</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 단계별 업그레이드 시도</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_perform_upgrade_chain</span><span class=p>(</span><span class=n>event_data</span><span class=p>,</span> <span class=n>current_version</span><span class=p>,</span> <span class=n>target_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>UpgradeException</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 업그레이드 실패 시 폴백 전략</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_apply_fallback_strategy</span><span class=p>(</span><span class=n>event_data</span><span class=p>,</span> <span class=n>target_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_apply_fallback_strategy</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>target_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;업그레이드 실패 시 폴백 전략&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기본 필드만 유지하고 누락된 필드는 기본값으로 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>base_event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_id&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_id&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;aggregate_id&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;aggregate_id&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_type&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;timestamp&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;schema_version&#39;</span><span class=p>:</span> <span class=n>target_version</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 알려진 필드만 매핑</span>
</span></span><span class=line><span class=cl>        <span class=n>known_fields</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>schema_registry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>target_version</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>field</span><span class=p>,</span> <span class=n>default_value</span> <span class=ow>in</span> <span class=n>known_fields</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>base_event</span><span class=p>[</span><span class=n>field</span><span class=p>]</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>field</span><span class=p>,</span> <span class=n>default_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>base_event</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>분산 환경에서의 순서성 보장</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1> 1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2> 2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3> 3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4> 4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5> 5</a>
</span><span class=lnt id=hl-45-6><a class=lnlinks href=#hl-45-6> 6</a>
</span><span class=lnt id=hl-45-7><a class=lnlinks href=#hl-45-7> 7</a>
</span><span class=lnt id=hl-45-8><a class=lnlinks href=#hl-45-8> 8</a>
</span><span class=lnt id=hl-45-9><a class=lnlinks href=#hl-45-9> 9</a>
</span><span class=lnt id=hl-45-10><a class=lnlinks href=#hl-45-10>10</a>
</span><span class=lnt id=hl-45-11><a class=lnlinks href=#hl-45-11>11</a>
</span><span class=lnt id=hl-45-12><a class=lnlinks href=#hl-45-12>12</a>
</span><span class=lnt id=hl-45-13><a class=lnlinks href=#hl-45-13>13</a>
</span><span class=lnt id=hl-45-14><a class=lnlinks href=#hl-45-14>14</a>
</span><span class=lnt id=hl-45-15><a class=lnlinks href=#hl-45-15>15</a>
</span><span class=lnt id=hl-45-16><a class=lnlinks href=#hl-45-16>16</a>
</span><span class=lnt id=hl-45-17><a class=lnlinks href=#hl-45-17>17</a>
</span><span class=lnt id=hl-45-18><a class=lnlinks href=#hl-45-18>18</a>
</span><span class=lnt id=hl-45-19><a class=lnlinks href=#hl-45-19>19</a>
</span><span class=lnt id=hl-45-20><a class=lnlinks href=#hl-45-20>20</a>
</span><span class=lnt id=hl-45-21><a class=lnlinks href=#hl-45-21>21</a>
</span><span class=lnt id=hl-45-22><a class=lnlinks href=#hl-45-22>22</a>
</span><span class=lnt id=hl-45-23><a class=lnlinks href=#hl-45-23>23</a>
</span><span class=lnt id=hl-45-24><a class=lnlinks href=#hl-45-24>24</a>
</span><span class=lnt id=hl-45-25><a class=lnlinks href=#hl-45-25>25</a>
</span><span class=lnt id=hl-45-26><a class=lnlinks href=#hl-45-26>26</a>
</span><span class=lnt id=hl-45-27><a class=lnlinks href=#hl-45-27>27</a>
</span><span class=lnt id=hl-45-28><a class=lnlinks href=#hl-45-28>28</a>
</span><span class=lnt id=hl-45-29><a class=lnlinks href=#hl-45-29>29</a>
</span><span class=lnt id=hl-45-30><a class=lnlinks href=#hl-45-30>30</a>
</span><span class=lnt id=hl-45-31><a class=lnlinks href=#hl-45-31>31</a>
</span><span class=lnt id=hl-45-32><a class=lnlinks href=#hl-45-32>32</a>
</span><span class=lnt id=hl-45-33><a class=lnlinks href=#hl-45-33>33</a>
</span><span class=lnt id=hl-45-34><a class=lnlinks href=#hl-45-34>34</a>
</span><span class=lnt id=hl-45-35><a class=lnlinks href=#hl-45-35>35</a>
</span><span class=lnt id=hl-45-36><a class=lnlinks href=#hl-45-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedEventOrdering</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    분산 환경에서 이벤트 순서 보장
</span></span></span><span class=line><span class=cl><span class=s2>    - Event Sourcing의 고급 분산 처리 패턴
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>node_id</span> <span class=o>=</span> <span class=n>node_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>vector_clock</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>pending_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_event_with_ordering</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>,</span> <span class=n>causal_dependencies</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        인과관계를 고려한 이벤트 저장
</span></span></span><span class=line><span class=cl><span class=s2>        - Vector Clock을 활용한 분산 순서 보장
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Vector Clock 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>vector_clock</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>vector_clock</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 인과관계 정보 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span><span class=o>.</span><span class=n>vector_clock</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>vector_clock</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span><span class=o>.</span><span class=n>causal_dependencies</span> <span class=o>=</span> <span class=n>causal_dependencies</span> <span class=ow>or</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 의존성 확인 후 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_can_process_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_store_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_process_pending_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>pending_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_can_process_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 처리 가능 여부 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>dependency</span> <span class=ow>in</span> <span class=n>event</span><span class=o>.</span><span class=n>causal_dependencies</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_has_processed_event</span><span class=p>(</span><span class=n>dependency</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=72-생태계-및-관련-기술-1>7.2 생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술-1>#</a></h3><p><strong>Event Sourcing 생태계 맵</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Core Event Sourcing&#34;
        ES[Event Store]
        AG[Aggregates]
        EH[Event Handlers]
    end
    
    subgraph &#34;Architecture Patterns&#34;
        CQRS[CQRS]
        DDD[Domain Driven Design]
        SAGA[Saga Pattern]
        OUTBOX[Outbox Pattern]
    end
    
    subgraph &#34;Infrastructure&#34;
        KAFKA[Apache Kafka]
        AXON[Axon Server]
        EVENTSTORE[EventStore DB]
        CASSANDRA[Cassandra]
    end
    
    subgraph &#34;Cloud Services&#34;
        AWS[AWS EventBridge]
        AZURE[Azure Event Hubs]
        GCP[Google Cloud Pub/Sub]
    end
    
    subgraph &#34;Observability&#34;
        PROM[Prometheus]
        GRAFANA[Grafana]
        JAEGER[Jaeger Tracing]
        ELK[ELK Stack]
    end
    
    ES --&gt; CQRS
    CQRS --&gt; DDD
    ES --&gt; KAFKA
    ES --&gt; AXON
    SAGA --&gt; OUTBOX
</pre><p><strong>통합 연계 가능한 기술 스택</strong>:</p><blockquote><p>이 표는 Event Sourcing과 통합할 수 있는 관련 기술들의 연계성과 활용도를 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>기술 카테고리</th><th>기술/도구</th><th>연계성</th><th>활용도</th><th>통합 복잡도</th><th>비즈니스 가치</th></tr></thead><tbody><tr><td>메시징</td><td>Apache Kafka</td><td>높음</td><td>높음</td><td>중간</td><td>높음 - 대용량 이벤트 처리</td></tr><tr><td>메시징</td><td>RabbitMQ</td><td>중간</td><td>중간</td><td>낮음</td><td>중간 - 복잡한 라우팅</td></tr><tr><td>저장소</td><td>MongoDB</td><td>높음</td><td>높음</td><td>낮음</td><td>높음 - 유연한 스키마</td></tr><tr><td>저장소</td><td>PostgreSQL</td><td>높음</td><td>높음</td><td>낮음</td><td>높음 - ACID 보장</td></tr><tr><td>프레임워크</td><td>Spring Boot</td><td>높음</td><td>높음</td><td>낮음</td><td>높음 - 빠른 개발</td></tr><tr><td>컨테이너</td><td>Docker/K8s</td><td>높음</td><td>높음</td><td>중간</td><td>높음 - 확장성</td></tr><tr><td>모니터링</td><td>Prometheus</td><td>중간</td><td>높음</td><td>낮음</td><td>중간 - 시스템 가시성</td></tr><tr><td>추적</td><td>Jaeger</td><td>중간</td><td>중간</td><td>낮음</td><td>중간 - 분산 추적</td></tr></tbody></table><p><strong>표준 및 프로토콜</strong>:</p><p><strong>CloudEvents (CNCF 표준)</strong>:</p><ul><li>이벤트 메타데이터 표준화</li><li>멀티 클라우드 환경 호환성</li><li>HTTP, AMQP, Kafka 등 다양한 전송 프로토콜 지원</li></ul><p><strong>AsyncAPI</strong>:</p><ul><li>이벤트 기반 API 문서화 표준</li><li>Event Sourcing 시스템의 이벤트 스키마 문서화</li><li>코드 생성 및 검증 도구 제공</li></ul><p><strong>OpenTelemetry</strong>:</p><ul><li>분산 추적 및 메트릭 수집 표준</li><li>Event Sourcing 시스템의 관측성 통합</li><li>벤더 중립적 관측성 솔루션</li></ul><h3 id=73-최신-기술-트렌드와-미래-방향-1>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향-1>#</a></h3><p><strong>2024-2025 주요 트렌드</strong>:</p><p><strong>1. Serverless Event Sourcing</strong></p><ul><li><strong>트렌드</strong>: 서버리스 환경에서의 Event Sourcing 적용 증가</li><li><strong>기술</strong>: AWS Lambda + EventBridge, Azure Functions + Event Hubs</li><li><strong>영향</strong>: 운영 복잡도 감소, 자동 확장성, 비용 최적화</li><li><strong>전망</strong>: 중소기업의 Event Sourcing 도입 장벽 대폭 감소</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1> 1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2> 2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3> 3</a>
</span><span class=lnt id=hl-47-4><a class=lnlinks href=#hl-47-4> 4</a>
</span><span class=lnt id=hl-47-5><a class=lnlinks href=#hl-47-5> 5</a>
</span><span class=lnt id=hl-47-6><a class=lnlinks href=#hl-47-6> 6</a>
</span><span class=lnt id=hl-47-7><a class=lnlinks href=#hl-47-7> 7</a>
</span><span class=lnt id=hl-47-8><a class=lnlinks href=#hl-47-8> 8</a>
</span><span class=lnt id=hl-47-9><a class=lnlinks href=#hl-47-9> 9</a>
</span><span class=lnt id=hl-47-10><a class=lnlinks href=#hl-47-10>10</a>
</span><span class=lnt id=hl-47-11><a class=lnlinks href=#hl-47-11>11</a>
</span><span class=lnt id=hl-47-12><a class=lnlinks href=#hl-47-12>12</a>
</span><span class=lnt id=hl-47-13><a class=lnlinks href=#hl-47-13>13</a>
</span><span class=lnt id=hl-47-14><a class=lnlinks href=#hl-47-14>14</a>
</span><span class=lnt id=hl-47-15><a class=lnlinks href=#hl-47-15>15</a>
</span><span class=lnt id=hl-47-16><a class=lnlinks href=#hl-47-16>16</a>
</span><span class=lnt id=hl-47-17><a class=lnlinks href=#hl-47-17>17</a>
</span><span class=lnt id=hl-47-18><a class=lnlinks href=#hl-47-18>18</a>
</span><span class=lnt id=hl-47-19><a class=lnlinks href=#hl-47-19>19</a>
</span><span class=lnt id=hl-47-20><a class=lnlinks href=#hl-47-20>20</a>
</span><span class=lnt id=hl-47-21><a class=lnlinks href=#hl-47-21>21</a>
</span><span class=lnt id=hl-47-22><a class=lnlinks href=#hl-47-22>22</a>
</span><span class=lnt id=hl-47-23><a class=lnlinks href=#hl-47-23>23</a>
</span><span class=lnt id=hl-47-24><a class=lnlinks href=#hl-47-24>24</a>
</span><span class=lnt id=hl-47-25><a class=lnlinks href=#hl-47-25>25</a>
</span><span class=lnt id=hl-47-26><a class=lnlinks href=#hl-47-26>26</a>
</span><span class=lnt id=hl-47-27><a class=lnlinks href=#hl-47-27>27</a>
</span><span class=lnt id=hl-47-28><a class=lnlinks href=#hl-47-28>28</a>
</span><span class=lnt id=hl-47-29><a class=lnlinks href=#hl-47-29>29</a>
</span><span class=lnt id=hl-47-30><a class=lnlinks href=#hl-47-30>30</a>
</span><span class=lnt id=hl-47-31><a class=lnlinks href=#hl-47-31>31</a>
</span><span class=lnt id=hl-47-32><a class=lnlinks href=#hl-47-32>32</a>
</span><span class=lnt id=hl-47-33><a class=lnlinks href=#hl-47-33>33</a>
</span><span class=lnt id=hl-47-34><a class=lnlinks href=#hl-47-34>34</a>
</span><span class=lnt id=hl-47-35><a class=lnlinks href=#hl-47-35>35</a>
</span><span class=lnt id=hl-47-36><a class=lnlinks href=#hl-47-36>36</a>
</span><span class=lnt id=hl-47-37><a class=lnlinks href=#hl-47-37>37</a>
</span><span class=lnt id=hl-47-38><a class=lnlinks href=#hl-47-38>38</a>
</span><span class=lnt id=hl-47-39><a class=lnlinks href=#hl-47-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Serverless Event Sourcing 예시 (AWS Lambda)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ServerlessEventSourcing</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    서버리스 환경에서의 Event Sourcing 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - 2025년 주요 트렌드: 서버리스 기반 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>eventbridge</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>dynamodb</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>resource</span><span class=p>(</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>context</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        서버리스 이벤트 처리 핸들러
</span></span></span><span class=line><span class=cl><span class=s2>        - 자동 확장, 비용 최적화된 Event Sourcing 구현
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 검증 및 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>domain_event</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_domain_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># DynamoDB에 이벤트 저장 (서버리스 Event Store)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>store_event</span><span class=p>(</span><span class=n>domain_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 다운스트림 서비스에 이벤트 전파</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=n>domain_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;statusCode&#39;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;statusCode&#39;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. AI/ML 기반 이벤트 분석</strong></p><ul><li><strong>트렌드</strong>: 이벤트 스트림에 대한 실시간 AI 분석 적용</li><li><strong>기술</strong>: Stream ML, Real-time Anomaly Detection</li><li><strong>영향</strong>: 비즈니스 인사이트 향상, 예측적 분석</li><li><strong>전망</strong>: 이벤트 기반 의사결정 시스템 확산</li></ul><p><strong>3. Edge Computing과 Event Sourcing</strong></p><ul><li><strong>트렌드</strong>: IoT 및 엣지 환경에서의 분산 Event Sourcing</li><li><strong>기술</strong>: Edge Event Stores, Offline-first Event Sync</li><li><strong>영향</strong>: 지연시간 최소화, 네트워크 의존성 감소</li><li><strong>전망</strong>: 5G 시대 실시간 애플리케이션 확산</li></ul><p><strong>4. Quantum-Safe Event Sourcing</strong></p><ul><li><strong>트렌드</strong>: 양자 컴퓨팅에 대비한 암호화 기법 적용</li><li><strong>기술</strong>: Post-Quantum Cryptography for Event Encryption</li><li><strong>영향</strong>: 장기적 데이터 보안 보장</li><li><strong>전망</strong>: 금융, 의료 등 보안 중요 분야 우선 적용</li></ul><p><strong>미래 기술 방향성 (2025-2030)</strong>:</p><p><strong>Event Mesh Architecture</strong>:</p><ul><li>분산된 이벤트 소스들을 메시 형태로 연결</li><li>동적 라우팅 및 자동 스케일링</li><li>다중 클라우드, 하이브리드 환경 지원</li></ul><p><strong>Immutable Infrastructure + Event Sourcing</strong>:</p><ul><li>GitOps와 Event Sourcing의 결합</li><li>인프라 변경도 이벤트로 관리</li><li>완전한 시스템 상태 추적성</li></ul><p><strong>Temporal Computing Integration</strong>:</p><ul><li>시간 기반 워크플로우와 Event Sourcing 통합</li><li>복잡한 비즈니스 프로세스의 시간적 모델링</li><li>상태 머신과 이벤트 스트림의 결합</li></ul><h3 id=74-기타-고급-사항>7.4 기타 고급 사항<a hidden class=anchor aria-hidden=true href=#74-기타-고급-사항>#</a></h3><p><strong>Event Sourcing의 고급 패턴들</strong>:</p><p><strong>1. Multi-Tenant Event Sourcing</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1> 1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2> 2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3> 3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4> 4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5> 5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6> 6</a>
</span><span class=lnt id=hl-48-7><a class=lnlinks href=#hl-48-7> 7</a>
</span><span class=lnt id=hl-48-8><a class=lnlinks href=#hl-48-8> 8</a>
</span><span class=lnt id=hl-48-9><a class=lnlinks href=#hl-48-9> 9</a>
</span><span class=lnt id=hl-48-10><a class=lnlinks href=#hl-48-10>10</a>
</span><span class=lnt id=hl-48-11><a class=lnlinks href=#hl-48-11>11</a>
</span><span class=lnt id=hl-48-12><a class=lnlinks href=#hl-48-12>12</a>
</span><span class=lnt id=hl-48-13><a class=lnlinks href=#hl-48-13>13</a>
</span><span class=lnt id=hl-48-14><a class=lnlinks href=#hl-48-14>14</a>
</span><span class=lnt id=hl-48-15><a class=lnlinks href=#hl-48-15>15</a>
</span><span class=lnt id=hl-48-16><a class=lnlinks href=#hl-48-16>16</a>
</span><span class=lnt id=hl-48-17><a class=lnlinks href=#hl-48-17>17</a>
</span><span class=lnt id=hl-48-18><a class=lnlinks href=#hl-48-18>18</a>
</span><span class=lnt id=hl-48-19><a class=lnlinks href=#hl-48-19>19</a>
</span><span class=lnt id=hl-48-20><a class=lnlinks href=#hl-48-20>20</a>
</span><span class=lnt id=hl-48-21><a class=lnlinks href=#hl-48-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>MultiTenantEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    멀티 테넌트 Event Sourcing 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - 테넌트별 격리된 이벤트 스트림 관리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>encryption_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>encryption_service</span> <span class=o>=</span> <span class=n>encryption_service</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tenant_partitions</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>store_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tenant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;테넌트별 격리된 이벤트 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 테넌트별 암호화 키 사용</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_event</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>encryption_service</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>serialize</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>get_tenant_key</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 테넌트별 파티션에 저장</span>
</span></span><span class=line><span class=cl>        <span class=n>partition</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tenant_partition</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>partition</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>encrypted_event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. Event Sourcing with Blockchain</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1> 1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2> 2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3> 3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4> 4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5> 5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6> 6</a>
</span><span class=lnt id=hl-49-7><a class=lnlinks href=#hl-49-7> 7</a>
</span><span class=lnt id=hl-49-8><a class=lnlinks href=#hl-49-8> 8</a>
</span><span class=lnt id=hl-49-9><a class=lnlinks href=#hl-49-9> 9</a>
</span><span class=lnt id=hl-49-10><a class=lnlinks href=#hl-49-10>10</a>
</span><span class=lnt id=hl-49-11><a class=lnlinks href=#hl-49-11>11</a>
</span><span class=lnt id=hl-49-12><a class=lnlinks href=#hl-49-12>12</a>
</span><span class=lnt id=hl-49-13><a class=lnlinks href=#hl-49-13>13</a>
</span><span class=lnt id=hl-49-14><a class=lnlinks href=#hl-49-14>14</a>
</span><span class=lnt id=hl-49-15><a class=lnlinks href=#hl-49-15>15</a>
</span><span class=lnt id=hl-49-16><a class=lnlinks href=#hl-49-16>16</a>
</span><span class=lnt id=hl-49-17><a class=lnlinks href=#hl-49-17>17</a>
</span><span class=lnt id=hl-49-18><a class=lnlinks href=#hl-49-18>18</a>
</span><span class=lnt id=hl-49-19><a class=lnlinks href=#hl-49-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>BlockchainEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    블록체인 기반 Event Store
</span></span></span><span class=line><span class=cl><span class=s2>    - 탈중앙화된 이벤트 무결성 보장
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_event_to_blockchain</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;블록체인에 이벤트 추가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;previous_hash&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_last_block_hash</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_data&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>serialize</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;merkle_root&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_merkle_root</span><span class=p>([</span><span class=n>event</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>block_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_hash</span><span class=p>(</span><span class=n>block</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>blockchain</span><span class=o>.</span><span class=n>append_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>block_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>block_hash</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>3. Cross-Aggregate Event Sourcing</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1> 1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2> 2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3> 3</a>
</span><span class=lnt id=hl-50-4><a class=lnlinks href=#hl-50-4> 4</a>
</span><span class=lnt id=hl-50-5><a class=lnlinks href=#hl-50-5> 5</a>
</span><span class=lnt id=hl-50-6><a class=lnlinks href=#hl-50-6> 6</a>
</span><span class=lnt id=hl-50-7><a class=lnlinks href=#hl-50-7> 7</a>
</span><span class=lnt id=hl-50-8><a class=lnlinks href=#hl-50-8> 8</a>
</span><span class=lnt id=hl-50-9><a class=lnlinks href=#hl-50-9> 9</a>
</span><span class=lnt id=hl-50-10><a class=lnlinks href=#hl-50-10>10</a>
</span><span class=lnt id=hl-50-11><a class=lnlinks href=#hl-50-11>11</a>
</span><span class=lnt id=hl-50-12><a class=lnlinks href=#hl-50-12>12</a>
</span><span class=lnt id=hl-50-13><a class=lnlinks href=#hl-50-13>13</a>
</span><span class=lnt id=hl-50-14><a class=lnlinks href=#hl-50-14>14</a>
</span><span class=lnt id=hl-50-15><a class=lnlinks href=#hl-50-15>15</a>
</span><span class=lnt id=hl-50-16><a class=lnlinks href=#hl-50-16>16</a>
</span><span class=lnt id=hl-50-17><a class=lnlinks href=#hl-50-17>17</a>
</span><span class=lnt id=hl-50-18><a class=lnlinks href=#hl-50-18>18</a>
</span><span class=lnt id=hl-50-19><a class=lnlinks href=#hl-50-19>19</a>
</span><span class=lnt id=hl-50-20><a class=lnlinks href=#hl-50-20>20</a>
</span><span class=lnt id=hl-50-21><a class=lnlinks href=#hl-50-21>21</a>
</span><span class=lnt id=hl-50-22><a class=lnlinks href=#hl-50-22>22</a>
</span><span class=lnt id=hl-50-23><a class=lnlinks href=#hl-50-23>23</a>
</span><span class=lnt id=hl-50-24><a class=lnlinks href=#hl-50-24>24</a>
</span><span class=lnt id=hl-50-25><a class=lnlinks href=#hl-50-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SagaEventOrchestrator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    크로스 집계 이벤트 조정
</span></span></span><span class=line><span class=cl><span class=s2>    - 복잡한 비즈니스 프로세스의 이벤트 기반 관리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>saga_states</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>compensation_handlers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_cross_aggregate_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사가 패턴을 통한 크로스 집계 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>saga_states</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 다음 단계 실행</span>
</span></span><span class=line><span class=cl>            <span class=n>next_command</span> <span class=o>=</span> <span class=n>saga_state</span><span class=o>.</span><span class=n>get_next_command</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>execute_command</span><span class=p>(</span><span class=n>next_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 사가 상태 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>update_saga_state</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 보상 트랜잭션 실행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>execute_compensation</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>전문가 레벨 고려사항</strong>:</p><p><strong>이벤트 스토어 샤딩 전략</strong>:</p><ul><li>Hash-based Sharding: 집계 ID 기반 균등 분산</li><li>Range-based Sharding: 시간 범위 기반 분할</li><li>Directory-based Sharding: 메타데이터 기반 동적 분산</li></ul><p><strong>고성능 이벤트 직렬화</strong>:</p><ul><li>Protocol Buffers: 스키마 진화 지원</li><li>Apache Avro: 동적 스키마 처리</li><li>MessagePack: 컴팩트한 바이너리 형식</li></ul><p><strong>분산 스냅샷 일관성</strong>:</p><ul><li>Raft Consensus: 강한 일관성 보장</li><li>PBFT (Practical Byzantine Fault Tolerance): 비잔틴 장애 대응</li><li>Gossip Protocol: 최종 일관성 기반 확장성</li></ul><h2 id=phase-7-고급-주제>Phase 7: 고급 주제<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제>#</a></h2><h3 id=71-현재-도전-과제-1>7.1 현재 도전 과제<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제-1>#</a></h3><ul><li><strong>GDPR/삭제권</strong>: 불변성과의 충돌. 키 파기·레드액션·스트림 재작성 전략 병행. (<a href="https://www.michielrook.nl/2017/11/forget-me-please-event-sourcing-gdpr/?utm_source=chatgpt.com" title="Forget me please? Event sourcing and the GDPR">Michiel Rook&rsquo;s blog</a>)</li><li><strong>EOS의 한계</strong>: 외부 DB 부수효과 포함 E2E 정확-한번 보장 어려움. 트랜잭션 경계 재설계 필요. (<a href="https://engineering.hellofresh.com/demystifying-kafka-exactly-once-semantics-eos-390ae1c32bba?utm_source=chatgpt.com" title="Demystifying Kafka Exactly Once Semantics (EOS) - HelloTech">HelloTech</a>)</li></ul><h3 id=72-생태계관련-기술>7.2 생태계/관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계관련-기술>#</a></h3><ul><li><strong>CloudEvents</strong>(표준 포맷), <strong>AsyncAPI</strong>(계약), <strong>Schema Registry</strong>(진화), <strong>OpenTelemetry</strong>(관측성). (<a href="https://github.com/cloudevents/spec?utm_source=chatgpt.com" title="CloudEvents Specification">GitHub</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">asyncapi.com</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>, <a href="https://opentelemetry.io/docs/specs/semconv/messaging/messaging-spans/?utm_source=chatgpt.com" title="Semantic conventions for messaging spans">OpenTelemetry</a>)</li></ul><h3 id=73-최신-트렌드미래>7.3 최신 트렌드/미래<a hidden class=anchor aria-hidden=true href=#73-최신-트렌드미래>#</a></h3><ul><li>KurrentDB(구 EventStoreDB) 지속 발전, 클라우드 서비스의 CloudEvents 네이티브 지원 확대(Azure, AWS). (<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">GitHub</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">Microsoft Learn</a>, <a href="https://aws.amazon.com/blogs/compute/sending-and-receiving-cloudevents-with-amazon-eventbridge/?utm_source=chatgpt.com" title="Sending and receiving CloudEvents with Amazon EventBridge">Amazon Web Services, Inc.</a>)</li></ul><h3 id=74-기타>7.4 기타<a hidden class=anchor aria-hidden=true href=#74-기타>#</a></h3><ul><li>이벤트 모델링/스토밍으로 설계 품질 향상(문제공간→해결 청사진). (<a href="https://eventmodeling.org/about/?utm_source=chatgpt.com" title="About - Event Modeling">이벤트 모델링</a>, <a href="https://medium.com/%40ziobrando/collaborative-process-modelling-with-eventstorming-17ed363650c0?utm_source=chatgpt.com" title="Collaborative Process Modelling with EventStorming">Medium</a>)</li></ul><h2 id=54-통합-및-연계-기술-분석-1>5.4 통합 및 연계 기술 분석<a hidden class=anchor aria-hidden=true href=#54-통합-및-연계-기술-분석-1>#</a></h2><p>Event Sourcing(이벤트 소싱)은 다양한 시스템과 기술과의 연계를 통해 실무에서 확장성과 복원력, 자동화, 외부 통합 효과를 극대화시킬 수 있습니다.</p><hr><h3 id=통합-사례별-연계-구조>통합 사례별 연계 구조<a hidden class=anchor aria-hidden=true href=#통합-사례별-연계-구조>#</a></h3><ul><li><strong>Messaging Broker(메시지 브로커) 통합</strong>: Kafka, RabbitMQ와 연계하여 이벤트 기반 마이크로서비스(MSA) 구현.</li><li><strong>CQRS(Command Query Responsibility Segregation)와 통합</strong>: Event Sourcing을 통해 쓰기(명령)·읽기 모델을 분리하여 DB 성능 및 확장성을 확보.</li><li><strong>외부 시스템통합</strong>: 이벤트를 Webhook, REST API, GraphQL 등으로 외부 서비스와 실시간 연동.</li><li><strong>Event Stream Processor(이벤트 스트림 프로세서) 연결</strong>: Apache Flink, Kafka Streams 활용해 실시간 데이터 분석·자동 의사결정 구현.</li><li><strong>분산 시스템 및 클라우드 연동</strong>: AWS Kinesis, Azure Event Hubs 등 클라우드 이벤트 스트림 서비스로 글로벌 분산 트래픽/이벤트 관리.</li></ul><hr><h3 id=기술-기능-연계-표>기술-기능 연계 표<a hidden class=anchor aria-hidden=true href=#기술-기능-연계-표>#</a></h3><blockquote><p>이 표는 주요 연계 기술과 Event Sourcing의 조합을 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1>1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2>2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3>3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4>4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5>5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6>6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 통합 기술 | 연계 특징 | 이벤트 소싱 적용 시 효과 | 주요 활용 |
</span></span><span class=line><span class=cl>|-----------|-----------|------------------------|-----------|
</span></span><span class=line><span class=cl>| Kafka/RabbitMQ | 이벤트 스트림·구독 | 대용량 이벤트 실시간 처리, 장애 복구 데이터 분산 | MSA, IoT, 실시간 거래 시스템 |
</span></span><span class=line><span class=cl>| CQRS | 커맨드/쿼리 분리 | 읽기/쓰기 모델 분리, 데이터 무결성·확장성 강화 | 주문/결제 시스템, 금융 서비스 |
</span></span><span class=line><span class=cl>| 웹훅/Webhook | 외부 시스템 푸시 | 사건 발생 시 자동 알림·외부 서비스 연동 | 결제/배송 알림, 자동 업무 처리 |
</span></span><span class=line><span class=cl>| Flink/Streams | 실시간 분석·처리 | 이벤트 기반 의사결정, 이상 탐지·알림 | 실시간 IoT, AI 분석 시스템 |
</span></span><span class=line><span class=cl>| 클라우드 이벤트 허브 | 글로벌 분산 스트림 | 지연·유실 없이 전 세계 이벤트 관리 | 글로벌 결제, 분산 데이터 관리 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=연계-아키텍처-예시-mermaid-다이어그램>연계 아키텍처 예시 (Mermaid 다이어그램)<a hidden class=anchor aria-hidden=true href=#연계-아키텍처-예시-mermaid-다이어그램>#</a></h3><pre class=mermaid>graph LR
    A[User Command/API] --&gt; B[Command Handler]
    B --&gt; C[Event Store]
    C --&gt; D[Messaging Broker]
    C --&gt; E[Read Model/Projection]
    D --&gt; F[Stream Processor (Flink/KafkaStreams)]
    F --&gt; G[Alert/External Integration]
    E --&gt; H[Query/API Response]
</pre><ul><li>사용자 / 시스템의 명령(API 요청)이 Command Handler로 전달</li><li>상태 변화는 이벤트로 Event Store에 기록</li><li>이벤트는 Messaging Broker(Kafka 등)를 통해 외부로 퍼블리시</li><li>Stream Processor는 이벤트 스트림을 분석해 실시간 알림/분석/자동화</li><li>Read Model/Projection은 빠른 조회·보고용 모델로서 서비스 응답에 활용</li></ul><hr><h3 id=실무-적용-팁>실무 적용 팁<a hidden class=anchor aria-hidden=true href=#실무-적용-팁>#</a></h3><ul><li><strong>Event ID/글로벌 시퀀스 보장</strong>: 모든 연계 시스템에서 이벤트 고유 식별자 관리</li><li><strong>트랜잭션 보증 및 멱등성 설계</strong>: 이벤트 중복, 장애 재처리에도 상태 안정화 유지가 관건</li><li><strong>클라우드 서비스 활용시 지역(Region) 분산 고려</strong>: 장애 및 확장에 대비한 이벤트 허브·스토리지 구성</li><li><strong>실시간 모니터링/알림 자동화</strong>: 이벤트 흐름 파이프라인에 반드시 모니터링/알림(Ops) 연동</li></ul><hr><h2 id=7-추가-조사-영역-필수-보완-주제>7. 추가 조사 영역 (필수 보완 주제)<a hidden class=anchor aria-hidden=true href=#7-추가-조사-영역-필수-보완-주제>#</a></h2><h3 id=75-마이그레이션-전략-crud--event-sourcing>7.5 마이그레이션 전략: CRUD → Event Sourcing<a hidden class=anchor aria-hidden=true href=#75-마이그레이션-전략-crud--event-sourcing>#</a></h3><p><strong>권장 순서</strong></p><ol><li><strong>후행(읽기)부터 분리</strong>: 기존 DB는 유지하고, 변경 이벤트를 <strong>Outbox</strong> 테이블에 먼저 기록 → 스트림으로 내보내 <strong>프로젝션(Read Model)</strong> 을 구축(점진적 적용).</li><li><strong>이중 쓰기(deferred cut-over)</strong>: 트랜잭션 내 <code>도메인 변경 + Outbox 삽입</code>만 허용. CDC(Change Data Capture) 또는 배치가 Outbox → 브로커/스토어로 전달.</li><li><strong>신규 기능을 ES 우선 설계</strong>: 기존 도메인의 위험을 최소화하고 검증을 축적.</li><li><strong>리플레이·백필 백그라운드 작업</strong>: 과거 상태를 이벤트로 역설계하는 대신, 초기 스냅샷(Seed) + 이후 이벤트로 접합.</li><li><strong>스키마/계약 거버넌스</strong>: Schema Registry 호환성 정책(BACKWARD/FULL)과 AsyncAPI 계약으로 파이프라인 단절을 예방. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Confluent Docs</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">asyncapi.com</a>)</li></ol><blockquote><p><strong>리스크 주의</strong>: <strong>EOS(Exactly-Once Semantics)</strong> 는 “Kafka 내부 입력→출력” 경로에서만 강력하며, 외부 DB 부수효과까지 E2E 보장하기는 어렵습니다(멱등키·트랜잭션 경계 재설계 필요). (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Apache Kafka</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Confluent Docs</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">HelloTech</a>)</p></blockquote><h3 id=76-이벤트-모델링이름-규칙실무-팁>7.6 이벤트 모델링/이름 규칙(실무 팁)<a hidden class=anchor aria-hidden=true href=#76-이벤트-모델링이름-규칙실무-팁>#</a></h3><ul><li>과거시제, 도메인 용어 사용: <code>OrderPlaced</code>, <code>PaymentCaptured</code> (의도·결과를 명확히).</li><li><strong>한 이벤트 = 한 사실</strong>(원자성), 누적형 이벤트 남용 금지.</li><li><strong>스트림 키 설계</strong>: 순서 보장이 필요한 경계(예: <code>aggregateId</code>) 기준으로 파티션.</li><li><strong>단명 스트림 전략</strong>: 장수 스트림의 재생 비용을 피하려면 시간/상태 기반으로 스트림을 “닫고 새로 시작”하는 모델링이 유효. (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">Kurrent - event-native data platform</a>)</li></ul><h3 id=77-개인정보gdpr-대응불변-로그와의-충돌-해소>7.7 개인정보·GDPR 대응(불변 로그와의 충돌 해소)<a hidden class=anchor aria-hidden=true href=#77-개인정보gdpr-대응불변-로그와의-충돌-해소>#</a></h3><ul><li><strong>Crypto Shredding(암호학적 소거)</strong>: PII(개인식별정보)를 암호화하여 저장하고, 삭제 요청 시 <strong>키 파기</strong>로 실질적 삭제를 달성(백업 포함). 법무/컴플라이언스와 정책화 필요. (<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">axoniq.io</a>, <a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">gdpr-info.eu</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">ico.org.uk</a>)</li><li><strong>보존 기간·예외 조항</strong>(세법/분쟁 대응 등)과의 균형을 문서화. (<a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">gdpr-info.eu</a>)</li><li><strong>대안</strong>: 토큰화/비식별화/외부 저장소(PII 외부화). 실무 적용시 법률 자문과 함께 결정. (<a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">Unite tech blog</a>)</li></ul><hr><h2 id=8-테스트-전략-및-품질-보증>8. 테스트 전략 및 품질 보증<a hidden class=anchor aria-hidden=true href=#8-테스트-전략-및-품질-보증>#</a></h2><h3 id=81-단위-테스트어그리게이트-중심>8.1 단위 테스트(어그리게이트 중심)<a hidden class=anchor aria-hidden=true href=#81-단위-테스트어그리게이트-중심>#</a></h3><ul><li><p><strong>Given-When-Then</strong> 패턴:</p><ul><li><strong>Given</strong>: 이벤트 히스토리</li><li><strong>When</strong>: 명령</li><li><strong>Then</strong>: 생성되어야 할 이벤트(혹은 예외)</li></ul></li></ul><p><strong>Python 테스트 예시(PyTest/Hypothesis)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1> 1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2> 2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3> 3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4> 4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5> 5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6> 6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7> 7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8> 8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9> 9</a>
</span><span class=lnt id=hl-53-10><a class=lnlinks href=#hl-53-10>10</a>
</span><span class=lnt id=hl-53-11><a class=lnlinks href=#hl-53-11>11</a>
</span><span class=lnt id=hl-53-12><a class=lnlinks href=#hl-53-12>12</a>
</span><span class=lnt id=hl-53-13><a class=lnlinks href=#hl-53-13>13</a>
</span><span class=lnt id=hl-53-14><a class=lnlinks href=#hl-53-14>14</a>
</span><span class=lnt id=hl-53-15><a class=lnlinks href=#hl-53-15>15</a>
</span><span class=lnt id=hl-53-16><a class=lnlinks href=#hl-53-16>16</a>
</span><span class=lnt id=hl-53-17><a class=lnlinks href=#hl-53-17>17</a>
</span><span class=lnt id=hl-53-18><a class=lnlinks href=#hl-53-18>18</a>
</span><span class=lnt id=hl-53-19><a class=lnlinks href=#hl-53-19>19</a>
</span><span class=lnt id=hl-53-20><a class=lnlinks href=#hl-53-20>20</a>
</span><span class=lnt id=hl-53-21><a class=lnlinks href=#hl-53-21>21</a>
</span><span class=lnt id=hl-53-22><a class=lnlinks href=#hl-53-22>22</a>
</span><span class=lnt id=hl-53-23><a class=lnlinks href=#hl-53-23>23</a>
</span><span class=lnt id=hl-53-24><a class=lnlinks href=#hl-53-24>24</a>
</span><span class=lnt id=hl-53-25><a class=lnlinks href=#hl-53-25>25</a>
</span><span class=lnt id=hl-53-26><a class=lnlinks href=#hl-53-26>26</a>
</span><span class=lnt id=hl-53-27><a class=lnlinks href=#hl-53-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Given-When-Then: 이벤트 소싱 핵심 테스트 패턴</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hypothesis</span> <span class=kn>import</span> <span class=n>given</span><span class=p>,</span> <span class=n>strategies</span> <span class=k>as</span> <span class=n>st</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rehydrate_from</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=s2>&#34;T-1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>acc</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>acc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@given</span><span class=p>(</span><span class=n>st</span><span class=o>.</span><span class=n>lists</span><span class=p>(</span><span class=n>st</span><span class=o>.</span><span class=n>integers</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_value</span><span class=o>=</span><span class=mi>100</span><span class=p>),</span> <span class=n>min_size</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_size</span><span class=o>=</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_deposit_is_associative</span><span class=p>(</span><span class=n>amounts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Given: 여러 입금 이벤트 히스토리</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=p>[</span><span class=n>FundsDeposited</span><span class=p>(</span><span class=s2>&#34;T-1&#34;</span><span class=p>,</span> <span class=n>amt</span><span class=p>,</span> <span class=n>v</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>amt</span> <span class=ow>in</span> <span class=n>amounts</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=n>rehydrate_from</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># When: 추가 입금</span>
</span></span><span class=line><span class=cl>    <span class=n>more</span> <span class=o>=</span> <span class=n>FundsDeposited</span><span class=p>(</span><span class=s2>&#34;T-1&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>v</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>more</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Then: 합계가 연산 순서에 독립(결합법칙적 성질) -&gt; 불변 이벤트 재생 검증</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>acc</span><span class=o>.</span><span class=n>balance</span> <span class=o>==</span> <span class=nb>sum</span><span class=p>(</span><span class=n>amounts</span><span class=p>)</span> <span class=o>+</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_withdraw_needs_sufficient_funds</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Given: 100 입금 히스토리</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=n>rehydrate_from</span><span class=p>([</span><span class=n>FundsDeposited</span><span class=p>(</span><span class=s2>&#34;T-1&#34;</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=n>v</span><span class=o>=</span><span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=c1># When/Then: 잔액 부족시 예외</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>ValueError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>acc</span><span class=o>.</span><span class=n>decide_withdraw</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>이 테스트는 <strong>이벤트 재생으로 상태 복원</strong>이 올바른지와 <strong>도메인 불변식</strong>을 보장합니다.</p></blockquote><h3 id=82-계약-테스트스키마호환성>8.2 계약 테스트(스키마·호환성)<a hidden class=anchor aria-hidden=true href=#82-계약-테스트스키마호환성>#</a></h3><ul><li><strong>Schema Registry</strong> 호환성(BACKWARD/BACKWARD_TRANSITIVE 등)과 CI에 <strong>스키마 호환성 검사</strong>를 포함. Confluent 문서 기준. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Confluent Docs</a>)</li></ul><h3 id=83-통합-테스트프로젝션-멱등성>8.3 통합 테스트(프로젝션 멱등성)<a hidden class=anchor aria-hidden=true href=#83-통합-테스트프로젝션-멱등성>#</a></h3><ul><li><strong>중복 이벤트</strong>를 2회 주입해도 읽기 모델이 동일해야 함(멱등).</li><li><strong>리플레이 테스트</strong>: 빈 읽기 DB에서 전체 이벤트 재생 → SLA 내 완주 확인.</li></ul><hr><h2 id=9-운영-런북runbook--사고-대응재생배포>9. 운영 런북(Runbook) — 사고 대응·재생·배포<a hidden class=anchor aria-hidden=true href=#9-운영-런북runbook--사고-대응재생배포>#</a></h2><blockquote><p><strong>이 표는</strong> 운영 시 반복되는 절차를 표준화하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1>1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2>2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3>3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4>4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5>5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 시나리오 | 즉시 조치 | 원인 분석 | 후속 조치 |
</span></span><span class=line><span class=cl>|----------|-----------|-----------|-----------|
</span></span><span class=line><span class=cl>| 프로젝션 지연/락 | 소비자 스케일아웃, DLQ 격리 | 파티션 불균형/슬로우 쿼리 | 파티션 재배치, 인덱스 튜닝 |
</span></span><span class=line><span class=cl>| 중복 처리 폭증 | 멱등키 점검, EOS 경로 확인 | 재시도/네트워크 장애 | 트랜잭션 재설계, 오프셋 관리 개선 |
</span></span><span class=line><span class=cl>| 스키마 호환성 실패 | 문제 스키마 롤백 | 비호환 변경 | Registry 정책 BACKWARD/FULL 준수 |
</span></span><span class=line><span class=cl>| 대규모 리플레이 | 스냅샷 주입 후 구간 재생 | 장수 스트림/콜드 데이터 | 스트림 분할(단명화), 배치 리플레이 |
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>관측성 지표</strong>: Kafka/브로커 지연·소비자 랙, EventStore append 지연, DLQ 건수, 스냅샷 히트율, OTel 메시징 스팬 비율. (<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">OpenTelemetry</a>)</li><li><strong>분산 추적 표준</strong>: OpenTelemetry Messaging/Kafka 시맨틱. (<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">OpenTelemetry</a>)</li></ul><hr><h2 id=10-배포-템플릿-스케치docker-compose-축약>10. 배포 템플릿 스케치(Docker Compose, 축약)<a hidden class=anchor aria-hidden=true href=#10-배포-템플릿-스케치docker-compose-축약>#</a></h2><blockquote><p><strong>이 스니펫은</strong> 로컬에서 <strong>Kafka + Schema Registry</strong> 기반 이벤트 흐름을 실습하기 위한 뼈대입니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1> 1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2> 2</a>
</span><span class=lnt id=hl-55-3><a class=lnlinks href=#hl-55-3> 3</a>
</span><span class=lnt id=hl-55-4><a class=lnlinks href=#hl-55-4> 4</a>
</span><span class=lnt id=hl-55-5><a class=lnlinks href=#hl-55-5> 5</a>
</span><span class=lnt id=hl-55-6><a class=lnlinks href=#hl-55-6> 6</a>
</span><span class=lnt id=hl-55-7><a class=lnlinks href=#hl-55-7> 7</a>
</span><span class=lnt id=hl-55-8><a class=lnlinks href=#hl-55-8> 8</a>
</span><span class=lnt id=hl-55-9><a class=lnlinks href=#hl-55-9> 9</a>
</span><span class=lnt id=hl-55-10><a class=lnlinks href=#hl-55-10>10</a>
</span><span class=lnt id=hl-55-11><a class=lnlinks href=#hl-55-11>11</a>
</span><span class=lnt id=hl-55-12><a class=lnlinks href=#hl-55-12>12</a>
</span><span class=lnt id=hl-55-13><a class=lnlinks href=#hl-55-13>13</a>
</span><span class=lnt id=hl-55-14><a class=lnlinks href=#hl-55-14>14</a>
</span><span class=lnt id=hl-55-15><a class=lnlinks href=#hl-55-15>15</a>
</span><span class=lnt id=hl-55-16><a class=lnlinks href=#hl-55-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kafka</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>bitnami/kafka:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KAFKA_ENABLE_KRAFT=yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_PROCESS_ROLES=controller,broker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka:9093</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>schema-registry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-schema-registry:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS=kafka:9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SCHEMA_REGISTRY_HOST_NAME=schema-registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;8081:8081&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>테스트 포인트</strong>: Producer idempotent 설정, 스키마 등록/호환성 체크, Consumer 멱등성 검증. (<a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">Confluent Docs</a>)</li></ul><hr><h2 id=11-패턴-안티패턴현장-사례-기반>11. 패턴 안티패턴(현장 사례 기반)<a hidden class=anchor aria-hidden=true href=#11-패턴-안티패턴현장-사례-기반>#</a></h2><blockquote><p><strong>이 표는</strong> 흔한 실수와 예방책을 정리해 재작업을 줄이기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1>1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2>2</a>
</span><span class=lnt id=hl-56-3><a class=lnlinks href=#hl-56-3>3</a>
</span><span class=lnt id=hl-56-4><a class=lnlinks href=#hl-56-4>4</a>
</span><span class=lnt id=hl-56-5><a class=lnlinks href=#hl-56-5>5</a>
</span><span class=lnt id=hl-56-6><a class=lnlinks href=#hl-56-6>6</a>
</span><span class=lnt id=hl-56-7><a class=lnlinks href=#hl-56-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 안티패턴 | 증상 | 원인 | 예방/해결 |
</span></span><span class=line><span class=cl>|----------|------|------|-----------|
</span></span><span class=line><span class=cl>| Fat Event | 이벤트가 거대/불명확 | DTO식 설계 | 한 사실 단위로 분해, 도메인 언어 정제 |
</span></span><span class=line><span class=cl>| 스냅샷 남용 | 스냅샷 폭증·정합성 불명 | 무분별한 성능최적화 | 측정 기반 주기 결정, 검증 포함 파이프라인 |
</span></span><span class=line><span class=cl>| 단일 토픽 남용 | 핫 파티션·스케일 실패 | 파티션/키 전략 부재 | aggregateId 기반 키, 토픽 정규화 |
</span></span><span class=line><span class=cl>| 스키마 무계약 | 소비자 장애·롤백 잦음 | 문서/검증 부재 | AsyncAPI+Registry+CI 호환성 검사 |
</span></span><span class=line><span class=cl>| EOS 과신 | 외부 DB 불일치 | 경계 오해 | 멱등키·보상 트랜잭션, 아웃박스 패턴 |
</span></span></code></pre></td></tr></table></div></div><p>근거: Kafka EOS 문서·실무 블로그 요약. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Apache Kafka</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Confluent Docs</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">HelloTech</a>)</p><hr><h2 id=7단계-종합-정리-및-학습-가이드>7단계: 종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#7단계-종합-정리-및-학습-가이드>#</a></h2><h3 id=내용-종합><strong>내용 종합</strong>:<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p>Event Sourcing은 현대 소프트웨어 아키텍처에서 <strong>완벽한 감사 추적</strong>, <strong>시간 여행 쿼리</strong>, <strong>확장 가능한 분산 시스템</strong> 구축을 위한 핵심 패턴으로 자리잡았습니다. Netflix, Uber와 같은 글로벌 기업들의 실제 운영 사례를 통해 그 효용성이 입증되었으며, 2024-2025년에는 서버리스 환경, AI/ML 통합, 엣지 컴퓨팅과의 결합을 통해 더욱 발전하고 있습니다.</p><h3 id=핵심-성공-요인><strong>핵심 성공 요인</strong>:<a hidden class=anchor aria-hidden=true href=#핵심-성공-요인>#</a></h3><ol><li><strong>도메인 중심 설계</strong>: 비즈니스 도메인을 정확히 이해한 이벤트 모델링</li><li><strong>점진적 도입</strong>: Big Bang 방식보다 단계적 적용으로 리스크 최소화</li><li><strong>운영 역량</strong>: 모니터링, 디버깅, 성능 최적화 전문 지식</li><li><strong>팀 역량</strong>: 충분한 교육과 경험 축적</li></ol><h3 id=최신-트렌드-반영><strong>최신 트렌드 반영</strong>:<a hidden class=anchor aria-hidden=true href=#최신-트렌드-반영>#</a></h3><ul><li><strong>Serverless Event Sourcing</strong>: 운영 복잡도 감소 및 비용 최적화</li><li><strong>AI 기반 이벤트 분석</strong>: 실시간 비즈니스 인사이트 생성</li><li><strong>Edge Computing 통합</strong>: 지연시간 최소화 및 오프라인 처리</li><li><strong>Quantum-Safe 암호화</strong>: 미래 보안 위협 대비</li></ul><h2 id=최종-정리>최종 정리<a hidden class=anchor aria-hidden=true href=#최종-정리>#</a></h2><ul><li>Event Sourcing은 <strong>불변 이벤트 로그</strong>를 중심으로 읽기 모델을 <strong>재구성/재구축</strong>하는 설계입니다. 성숙한 표준·도구(CloudEvents/AsyncAPI/Schema Registry/Kafka EOS)가 실무 리스크를 크게 줄입니다. 도입 시 복잡도·운영 부담을 <strong>표준화/계약 우선/관측성</strong>으로 상쇄하세요. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">cloudevents.io</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">asyncapi.com</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>)</li></ul><h3 id=핵심-요약-및-학습-로드맵><strong>핵심 요약 및 학습 로드맵</strong><a hidden class=anchor aria-hidden=true href=#핵심-요약-및-학습-로드맵>#</a></h3><ul><li><strong>Phase 1~2</strong>: 기본 개념·원리 집중 학습 → 이벤트 소싱의 본질·정체성 이해</li><li><strong>Phase 3~4</strong>: 장점·단점·구현 패턴 익히기 → 구현방식 선택 기준, 실무적 도구/구조 경험</li><li><strong>Phase 5~6</strong>: 실무 적용·운영 전략 → 코드 실습, 운영 이슈, 장애 대응·최적화 방법 내재화</li><li><strong>Phase 7</strong>: 최신 동향·고급 전략 → 미래 트렌드/통합 아키텍처, 대용량·분산 환경 실전 적용</li></ul><p>실무에서는 반드시 &ldquo;시스템 이력 투명성, 장애 복구 전략, 확장성 및 통합성"을 3대 관점에서 점검합니다. 각 단계별 실습과 사례(코드, 도구, 구성도 등)를 병행하면 이론~실무 연계가 빠르게 완성됩니다.</p><h2 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h2><ol><li>개념·용어 → 2) 간단한 인메모리 구현 → 3) 스냅샷/프로젝션 → 4) Schema Registry/업캐스팅 → 5) EOS/트랜잭션 → 6) 관측성/보안/GDPR → 7) 대규모 사례 리딩</li></ol><h3 id=학습-로드맵-1>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵-1>#</a></h3><p><strong>초급자 (0-6개월)</strong>:</p><ol><li>Event Sourcing 기본 개념 및 CRUD와의 차이점 이해</li><li>간단한 주문 관리 시스템으로 실습</li><li>CQRS 패턴과의 연계 학습</li><li>기본적인 이벤트 스토어 구현</li></ol><p><strong>중급자 (6-18개월)</strong>:</p><ol><li>프로덕션 레벨 Event Store 설계 및 구현</li><li>스냅샷, 프로젝션 최적화 기법 학습</li><li>마이크로서비스 환경에서의 이벤트 기반 통신</li><li>실제 비즈니스 문제에 Event Sourcing 적용</li></ol><p><strong>고급자 (18개월+)</strong>:</p><ol><li>대용량 분산 Event Sourcing 시스템 설계</li><li>복잡한 스키마 진화 및 버전 관리 전략</li><li>성능 최적화 및 운영 자동화</li><li>새로운 기술 트렌드 연구 및 적용</li></ol><h3 id=학습-항목-정리표>학습 항목 정리(표)<a hidden class=anchor aria-hidden=true href=#학습-항목-정리표>#</a></h3><blockquote><p><strong>이 표는</strong> 단계별 학습 항목과 중요도를 체계화하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1>1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2>2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3>3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4>4</a>
</span><span class=lnt id=hl-57-5><a class=lnlinks href=#hl-57-5>5</a>
</span><span class=lnt id=hl-57-6><a class=lnlinks href=#hl-57-6>6</a>
</span><span class=lnt id=hl-57-7><a class=lnlinks href=#hl-57-7>7</a>
</span><span class=lnt id=hl-57-8><a class=lnlinks href=#hl-57-8>8</a>
</span><span class=lnt id=hl-57-9><a class=lnlinks href=#hl-57-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목 | 중요도 | 학습 목표 | 실무 연관성 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------|--------|-----------|-------------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | 개념/용어 | 필수 | ES 정의/특징 파악 | 높음 | 불변 로그, 프로젝션 |
</span></span><span class=line><span class=cl>| 핵심     | 2     | 아키텍처/메커니즘 | 필수 | 명령→이벤트→프로젝션 흐름 | 높음 | 설계/구현 기준 |
</span></span><span class=line><span class=cl>| 핵심     | 3     | 트레이드오프 | 필수 | 성능/일관성/복잡도 이해 | 높음 | 의사결정 근거 |
</span></span><span class=line><span class=cl>| 핵심     | 4     | 스냅샷/버전/Schema | 필수 | 성능·진화 대응 | 높음 | Registry/업캐스팅 |
</span></span><span class=line><span class=cl>| 응용     | 5     | 실습/사례 | 권장 | E2E 구현 | 중간 | CI·테스트 연계 |
</span></span><span class=line><span class=cl>| 운영     | 6     | 보안/O11y | 필수 | GDPR·모니터링 | 높음 | 운영 안정화 |
</span></span><span class=line><span class=cl>| 고급     | 7     | EOS/표준화 | 선택 | 한계/표준 및 트렌드 | 중간 | 대규모 적용 |
</span></span></code></pre></td></tr></table></div></div><h2 id=단계별-학습-항목-매트릭스>단계별 학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#단계별-학습-항목-매트릭스>#</a></h2><blockquote><p>이 표는 체계적인 학습을 위해 단계별 학습 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1>1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2>2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3>3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4>4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5>5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6>6</a>
</span><span class=lnt id=hl-58-7><a class=lnlinks href=#hl-58-7>7</a>
</span><span class=lnt id=hl-58-8><a class=lnlinks href=#hl-58-8>8</a>
</span><span class=lnt id=hl-58-9><a class=lnlinks href=#hl-58-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목 | 중요도 | 학습 목표 | 실무 연관성 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------|--------|-----------|-------------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | 개념이해 | 필수   | 이벤트 소싱의 본질 파악 | 높음        | 상태 이력 관리의 원리 이해 |
</span></span><span class=line><span class=cl>| 핵심     | 2     | 아키텍처 설계 | 필수   | 설계 철학, 구조, 동작 이해 | 높음        | 시스템 구조화·도메인 연결 |
</span></span><span class=line><span class=cl>| 분석     | 3     | 특성/장단점 | 필수   | 기술적 트레이드오프 파악 | 높음        | 실무에서 기술 선택/적용 |
</span></span><span class=line><span class=cl>| 구현     | 4     | 구현방법 | 필수   | 실제 도구 선정·코딩 실습 | 높음        | 이벤트 저장소·Snapshot 등 |
</span></span><span class=line><span class=cl>| 응용     | 5     | 실무적용 | 권장   | 워크플로우·사례 학습 | 중간        | 사례·실습 통한 경험 |
</span></span><span class=line><span class=cl>| 운영     | 6     | 최적화/모니터링 | 권장   | 운영·성능·보안 이해 | 중간        | 장애 관리, 모니터링 |
</span></span><span class=line><span class=cl>| 고급     | 7     | 생태계·미래 | 선택   | 최신 트렌드 파악 | 낮음        | 트렌드 및 통합기술 분석 |
</span></span></code></pre></td></tr></table></div></div><h2 id=단계별-학습-항목-매트릭스-1>단계별 학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#단계별-학습-항목-매트릭스-1>#</a></h2><blockquote><p>이 표는 체계적인 학습을 위해 단계별 주요 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1>1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2>2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3>3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4>4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5>5</a>
</span><span class=lnt id=hl-59-6><a class=lnlinks href=#hl-59-6>6</a>
</span><span class=lnt id=hl-59-7><a class=lnlinks href=#hl-59-7>7</a>
</span><span class=lnt id=hl-59-8><a class=lnlinks href=#hl-59-8>8</a>
</span><span class=lnt id=hl-59-9><a class=lnlinks href=#hl-59-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목 | 중요도 | 학습 목표 | 실무 연관성 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------|--------|-----------|-------------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | 정의/배경/필요성 | 필수   | 개념, 배경, 적용 이유 명확히 이해 | 높음        | 이벤트 소싱의 본질·활용 동기 |
</span></span><span class=line><span class=cl>| 핵심     | 2     | 원리/구성/설계 | 필수   | 이벤트 저장·상태 복원·구조화 습득 | 높음        | 이벤트 흐름, 구조적 설계 |
</span></span><span class=line><span class=cl>| 분석     | 3     | 장단점/트레이드오프 | 필수   | 기술 선택 기준, 문제 해결책 습득 | 높음        | 실전 적용 시 비교분석 |
</span></span><span class=line><span class=cl>| 구축     | 4     | 구현 방법/도구 | 필수   | 코드·도구 활용 능력 내재화 | 높음        | 저장소, 모델, 브로커 등 실습 |
</span></span><span class=line><span class=cl>| 응용     | 5     | 실무사례/코드 | 권장   | 실제 프로젝트 적용력, 케이스 기반 경험 | 중간        | 실전 도입·성공사례 학습 |
</span></span><span class=line><span class=cl>| 운영     | 6     | 최적화/모니터링 | 권장   | 운영/보안/장애 관리 능력 강화 | 중간        | 복구, 관측, 성능 튜닝 |
</span></span><span class=line><span class=cl>| 고급     | 7     | 생태계/미래 전망 | 선택   | 최신 트렌드, 통합 전략 습득 | 낮음        | 유망 도구·클라우드 활용 |
</span></span></code></pre></td></tr></table></div></div><h3 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><blockquote><p>이 표는 체계적인 학습을 위해 단계별 학습 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>Event Sourcing 개념</td><td>필수</td><td>패턴의 본질 이해</td><td>높음</td><td>모든 후속 학습의 기반</td></tr><tr><td>기초</td><td>1</td><td>CRUD vs Event Sourcing</td><td>필수</td><td>차이점 명확 인식</td><td>높음</td><td>기존 방식과의 비교 이해</td></tr><tr><td>기초</td><td>1</td><td>이벤트 설계 원칙</td><td>필수</td><td>올바른 이벤트 모델링</td><td>높음</td><td>실제 구현의 핵심</td></tr><tr><td>핵심</td><td>2</td><td>Event Store 구현</td><td>필수</td><td>기술적 구현 능력</td><td>높음</td><td>직접적인 개발 스킬</td></tr><tr><td>핵심</td><td>2</td><td>Aggregate 패턴</td><td>필수</td><td>DDD와의 통합 이해</td><td>높음</td><td>비즈니스 로직 경계 설정</td></tr><tr><td>핵심</td><td>2</td><td>CQRS 연계</td><td>권장</td><td>읽기/쓰기 분리</td><td>중간</td><td>성능 최적화 기법</td></tr><tr><td>특성</td><td>3</td><td>장단점 분석</td><td>필수</td><td>적용 시점 판단</td><td>높음</td><td>의사결정 역량</td></tr><tr><td>특성</td><td>3</td><td>성능 특성</td><td>권장</td><td>시스템 설계 고려사항</td><td>중간</td><td>아키텍처 설계 능력</td></tr><tr><td>구현</td><td>4</td><td>스냅샷 전략</td><td>권장</td><td>성능 최적화</td><td>중간</td><td>운영 효율성 향상</td></tr><tr><td>구현</td><td>4</td><td>이벤트 버전 관리</td><td>권장</td><td>스키마 진화 대응</td><td>중간</td><td>장기 운영 안정성</td></tr><tr><td>응용</td><td>5</td><td>실습 프로젝트</td><td>필수</td><td>실제 구현 경험</td><td>높음</td><td>실무 적용 능력</td></tr><tr><td>응용</td><td>5</td><td>실제 사례 분석</td><td>권장</td><td>모범 사례 학습</td><td>중간</td><td>설계 인사이트 획득</td></tr><tr><td>운영</td><td>6</td><td>모니터링 전략</td><td>권장</td><td>운영 안정성</td><td>중간</td><td>프로덕션 운영 능력</td></tr><tr><td>운영</td><td>6</td><td>보안 고려사항</td><td>권장</td><td>보안 위험 관리</td><td>낮음</td><td>엔터프라이즈 준비성</td></tr><tr><td>고급</td><td>7</td><td>분산 환경 처리</td><td>선택</td><td>확장성 설계</td><td>낮음</td><td>대규모 시스템 경험</td></tr><tr><td>고급</td><td>7</td><td>최신 트렌드</td><td>선택</td><td>기술 동향 파악</td><td>낮음</td><td>기술 리더십</td></tr></tbody></table><hr><h1 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h1><blockquote><p>이 표는 주제의 핵심 용어와 실무 적용 가능성을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>이벤트 소싱(Event Sourcing)</td><td>상태가 아닌 이벤트로 변경 이력 기록</td><td>CQRS, Audit, Snapshot</td><td>이력 관리, 장애 복구</td></tr><tr><td>구현</td><td>이벤트(Event)</td><td>상태 변환 불변 레코드</td><td>Event Store, Stream</td><td>상태 계산, 이력 추적</td></tr><tr><td>구현</td><td>스냅샷(Snapshot)</td><td>특정 시점 상태 전체 저장</td><td>성능 최적화</td><td>대량 데이터 성능 개선</td></tr><tr><td>운영</td><td>이벤트 브로커(Event Broker)</td><td>메시지 큐/스트림 중계</td><td>Kafka, RabbitMQ</td><td>확장/시스템 통합</td></tr><tr><td>운영</td><td>프로젝션(Projection)</td><td>이벤트 기반 읽기 모델</td><td>Read Model</td><td>실시간 상태, 조회</td></tr></tbody></table><h1 id=용어-최종-정리>[용어 최종 정리]<a hidden class=anchor aria-hidden=true href=#용어-최종-정리>#</a></h1><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>이벤트 소싱(Event Sourcing)</td><td>상태가 아닌 이벤트로 변경 이력 기록</td><td>CQRS, Audit, Snapshot</td><td>이력 관리, 장애 복구</td></tr><tr><td>구현</td><td>이벤트(Event)</td><td>상태 변환 불변 레코드</td><td>Event Store, Stream</td><td>상태 계산, 이력 추적</td></tr><tr><td>구현</td><td>스냅샷(Snapshot)</td><td>특정 시점 상태 전체 저장</td><td>성능 최적화</td><td>대량 데이터 성능 개선</td></tr><tr><td>운영</td><td>이벤트 브로커(Event Broker)</td><td>메시지 큐/스트림 중계</td><td>Kafka, RabbitMQ</td><td>확장/시스템 통합</td></tr><tr><td>운영</td><td>프로젝션(Projection)</td><td>이벤트 기반 읽기 모델</td><td>Read Model</td><td>실시간 상태, 조회</td></tr></tbody></table><h2 id=주요-용어-상세-해설>주요 용어 상세 해설<a hidden class=anchor aria-hidden=true href=#주요-용어-상세-해설>#</a></h2><blockquote><p>이 표는 이벤트 소싱 관련 주요 용어를 실무 관점에서 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-60-1><a class=lnlinks href=#hl-60-1>1</a>
</span><span class=lnt id=hl-60-2><a class=lnlinks href=#hl-60-2>2</a>
</span><span class=lnt id=hl-60-3><a class=lnlinks href=#hl-60-3>3</a>
</span><span class=lnt id=hl-60-4><a class=lnlinks href=#hl-60-4>4</a>
</span><span class=lnt id=hl-60-5><a class=lnlinks href=#hl-60-5>5</a>
</span><span class=lnt id=hl-60-6><a class=lnlinks href=#hl-60-6>6</a>
</span><span class=lnt id=hl-60-7><a class=lnlinks href=#hl-60-7>7</a>
</span><span class=lnt id=hl-60-8><a class=lnlinks href=#hl-60-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | 용어                       | 정의                                                          | 관련 개념                | 실무 활용                                |
</span></span><span class=line><span class=cl>|----------|----------------------------|---------------------------------------------------------------|-------------------------|------------------------------------------|
</span></span><span class=line><span class=cl>| 핵심     | 이벤트 소싱(Event Sourcing) | 상태를 직접 저장하지 않고, 변화를 이벤트로 기록하는 방식      | CQRS, Snapshot, Audit   | 상태 이력 관리, 장애 복구, 규정 준수      |
</span></span><span class=line><span class=cl>| 구현     | 이벤트(Event)               | 도메인 모델의 불변 상태 변화 기록                             | Event Store, Stream     | 과정 추적, 원인 분석, 복구                |
</span></span><span class=line><span class=cl>| 구현     | 스냅샷(Snapshot)            | 일정 지점의 완전한 상태 저장, 이벤트 리플레이 최소화          | 성능 최적화, 복원        | 대량 이벤트 복원, 장애 복구 최적화        |
</span></span><span class=line><span class=cl>| 구현     | 프로젝션(Projection)        | 이벤트 기반 읽기 전용 모델, CQRS의 조회 담당                  | Read Model, CQRS        | 상태 집계, 실시간 조회                    |
</span></span><span class=line><span class=cl>| 운영     | 메시지 브로커(Messaging Broker) | 이벤트를 외부 시스템과 실시간·비동기로 주고받는 중개 기술 | Kafka, RabbitMQ         | 확장 및 통합, 실시간 연계                 |
</span></span><span class=line><span class=cl>| 운영     | 트랜잭션 로그(Transaction Log) | 시스템 변경 내역 기록, 이벤트 소싱의 근간                    | 장애 복구, 감사          | 데이터 무결성, 프로세스 복원성            |
</span></span></code></pre></td></tr></table></div></div><h3 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h3><blockquote><p>이 표는 Event Sourcing의 핵심 용어와 실무 적용 가능성을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>Event Store (이벤트 저장소)</td><td>모든 도메인 이벤트를 순차적으로 저장하는 추가 전용 데이터베이스</td><td>Append-only, Immutable</td><td>시스템의 핵심 데이터 저장소</td></tr><tr><td>핵심</td><td>Aggregate (집계)</td><td>일관성 경계를 정의하는 도메인 엔티티의 클러스터</td><td>DDD, Consistency Boundary</td><td>비즈니스 로직 경계 설정</td></tr><tr><td>핵심</td><td>Event Stream (이벤트 스트림)</td><td>특정 집계에 대한 시간순 이벤트들의 시퀀스</td><td>Temporal Ordering</td><td>상태 재구성의 기본 단위</td></tr><tr><td>구현</td><td>Command Handler (명령 처리기)</td><td>비즈니스 명령을 받아 도메인 이벤트를 생성하는 컴포넌트</td><td>CQRS Write Model</td><td>비즈니스 로직 진입점</td></tr><tr><td>구현</td><td>Event Handler (이벤트 처리기)</td><td>도메인 이벤트를 받아 읽기 모델을 업데이트하는 컴포넌트</td><td>Projection, Idempotent</td><td>읽기 모델 동기화</td></tr><tr><td>구현</td><td>Projection (프로젝션)</td><td>이벤트 스트림으로부터 최적화된 읽기 전용 뷰</td><td>CQRS Read Model</td><td>쿼리 성능 최적화</td></tr><tr><td>운영</td><td>Snapshot (스냅샷)</td><td>특정 시점의 집계 상태를 저장한 최적화 기법</td><td>Performance Optimization</td><td>재생 성능 향상</td></tr><tr><td>운영</td><td>Event Replay (이벤트 재생)</td><td>이벤트를 순서대로 다시 적용하여 상태를 재구성하는 과정</td><td>State Reconstruction</td><td>디버깅, 복구 작업</td></tr><tr><td>운영</td><td>Saga (사가)</td><td>여러 집계에 걸친 장기 실행 비즈니스 프로세스</td><td>Distributed Transaction</td><td>분산 프로세스 관리</td></tr></tbody></table><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><blockquote><p><strong>이 표는</strong> 핵심 용어와 실무 적용 포인트를 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>4</a>
</span><span class=lnt id=hl-61-5><a class=lnlinks href=#hl-61-5>5</a>
</span><span class=lnt id=hl-61-6><a class=lnlinks href=#hl-61-6>6</a>
</span><span class=lnt id=hl-61-7><a class=lnlinks href=#hl-61-7>7</a>
</span><span class=lnt id=hl-61-8><a class=lnlinks href=#hl-61-8>8</a>
</span><span class=lnt id=hl-61-9><a class=lnlinks href=#hl-61-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | 용어 | 정의 | 관련 개념 | 실무 활용 |
</span></span><span class=line><span class=cl>|----------|------|------|-----------|-----------|
</span></span><span class=line><span class=cl>| 핵심 | 이벤트(Event) | 과거의 사실을 나타내는 불변 레코드 | CloudEvents | 표준 메타로 상호운용 |
</span></span><span class=line><span class=cl>| 핵심 | 이벤트 스토어 | Append-only 원장 | 스트림/버전 | 감사/재생 |
</span></span><span class=line><span class=cl>| 구현 | 프로젝션 | 이벤트→읽기 모델 | 머티리얼라이즈드 뷰 | 보고/쿼리 최적화 |
</span></span><span class=line><span class=cl>| 구현 | 스냅샷 | 재생 최적화 체크포인트 | 재생/성능 | 핫스트림 가속 |
</span></span><span class=line><span class=cl>| 구현 | 업캐스팅 | 오래된 이벤트를 새 스키마로 변환 | Schema Registry | 진화·호환성 |
</span></span><span class=line><span class=cl>| 운영 | EOS | 정확-한번 처리 의미론 | Kafka Tx/Idempotent | 중복/순서 문제 완화 |
</span></span><span class=line><span class=cl>| 운영 | GDPR 삭제권 | 불변 로그와의 충돌 해결 | 키 파기/레드액션 | 규제 준수 |
</span></span></code></pre></td></tr></table></div></div><h2 id=참고-및-출처대표>참고 및 출처(대표)<a hidden class=anchor aria-hidden=true href=#참고-및-출처대표>#</a></h2><ul><li>Martin Fowler, <em>Event Sourcing</em>. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">martinfowler.com</a>)</li><li>Microsoft, <em>Event Sourcing pattern / Cloud Design Patterns</em>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Microsoft Learn</a>)</li><li>Confluent, <em>Schema Evolution & Compatibility / Delivery Semantics</em>. (<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">Confluent Docs</a>)</li><li>Apache Kafka, <em>Documentation (EOS/Streams)</em>. (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">Apache Kafka</a>)</li><li>CNCF, <em>CloudEvents (Graduated)</em>. (<a href="https://github.com/cloudevents/spec?utm_source=chatgpt.com" title="CloudEvents Specification">GitHub</a>)</li><li>KurrentDB(EventStoreDB), <em>Docs & Blog(스냅샷/모니터링/메트릭)</em>. (<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">GitHub</a>, <a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">Kurrent - event-native data platform</a>)</li><li>GDPR & Event Sourcing(키 파기/레드액션 전략). (<a href="https://www.hashicorp.com/en/resources/gdpr-compliant-event-sourcing-with-hashicorp-vault?utm_source=chatgpt.com" title="GDPR Compliant Event Sourcing With HashiCorp Vault">HashiCorp | An IBM Company</a>, <a href="https://www.michielrook.nl/2017/11/forget-me-please-event-sourcing-gdpr/?utm_source=chatgpt.com" title="Forget me please? Event sourcing and the GDPR">Michiel Rook&rsquo;s blog</a>)</li><li>AsyncAPI, <em>메시지 계약/검증</em>. (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">asyncapi.com</a>)</li><li>Azure Samples, <em>Cosmos DB Event Sourcing 샘플</em>. (<a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing">Microsoft Learn</a>)</li><li>Uber LedgerStore 사례. (<a href="https://www.uber.com/blog/how-ledgerstore-supports-trillions-of-indexes/?utm_source=chatgpt.com" title="How LedgerStore Supports Trillions of Indexes at Uber">Uber</a>, <a href="https://www.infoq.com/news/2024/05/uber-dynamodb-ledgerstore/?utm_source=chatgpt.com" title="Uber Migrates 1 Trillion Records from DynamoDB to ...">InfoQ</a>)</li><li>Monzo 카프카 기반 메시징 사례. (<a href="https://monzo.com/blog/how-we-built-a-queue-on-top-of-kafka?utm_source=chatgpt.com" title="How we built a queue on top of Kafka">Monzo</a>)</li></ul><h3 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h3><p><strong>공식 문서 및 표준</strong>:</p><ul><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Martin Fowler&rsquo;s Event Sourcing</a> - 패턴의 원작자가 제시한 공식 정의</li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Microsoft Azure Event Sourcing Pattern</a> - 클라우드 환경에서의 구현 가이드</li><li><a href=https://cloudevents.io/>CloudEvents Specification</a> - CNCF 이벤트 표준화 명세</li></ul><p><strong>기술 블로그 및 사례 연구</strong>:</p><ul><li><a href=https://qconnewyork.com/ny2017/ny2017/presentation/scaling-event-sourcing-netflix-downloads.html>Netflix Downloads Event Sourcing Case Study</a> - Netflix 실제 운영 사례</li><li><a href=https://eng.uber.com/reliable-reprocessing/>Uber&rsquo;s Event-Driven Architecture</a> - 대규모 이벤트 처리 아키텍처</li><li><a href=https://www.axoniq.io/blog>AxonIQ Blog: Event Sourcing Best Practices</a> - 전문가 레벨 구현 가이드</li></ul><p><strong>학술 논문 및 연구 자료</strong>:</p><ul><li>&ldquo;Event Sourcing and CQRS in Distributed Systems&rdquo; (IEEE, 2023) - 분산 환경에서의 이론적 기반</li><li>&ldquo;Performance Analysis of Event Sourcing Patterns&rdquo; (ACM, 2024) - 성능 최적화 연구 결과</li></ul><p><strong>실무 구현 도구 및 프레임워크</strong>:</p><ul><li><a href=https://docs.axoniq.io/>Axon Framework Documentation</a> - Java 기반 종합 솔루션</li><li><a href=https://www.eventstore.com/>EventStore Database</a> - 전용 이벤트 저장소</li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka Documentation</a> - 대용량 이벤트 스트리밍</li></ul><p><strong>교육 자료 및 서적</strong>:</p><ul><li>&ldquo;Microservices Patterns&rdquo; by Chris Richardson - 마이크로서비스 환경에서의 Event Sourcing</li><li>&ldquo;Domain-Driven Design&rdquo; by Eric Evans - DDD와 Event Sourcing의 이론적 기반</li><li>&ldquo;Building Event-Driven Microservices&rdquo; by Adam Bellemare - 실무 중심 구현 가이드</li></ul><h1 id=참고-및-출처-1>[참고 및 출처]<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h1><ul><li><a href=https://developers.portone.io/blog/posts/2024-07/v2-event-sourcing-basic>포트원 결제 시스템 Event Sourcing 사례</a></li><li><a href=https://velog.io/@may_yun/MSA-Event-Sourcing-Event-Driven-Event-Driven-Architecture>MSA와 Event Sourcing 브로커 활용</a></li><li><a href=https://bcuts.tistory.com/453>CQRS와 이벤트 소싱 실전 구조</a></li><li><a href=https://cajava.tistory.com/85>이벤트 소싱의 개념과 구현</a></li><li><a href=https://curiousjinan.tistory.com/entry/cqrs-explained-event-sourcing>Domain Driven 디자인, 이벤트소싱 구조</a></li></ul><h1 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h1><ul><li><a href=https://cajava.tistory.com/85>티스토리 이벤트 소싱 개념</a></li><li><a href=https://developers.portone.io/blog/posts/2024-07/v2-event-sourcing-basic>포트원 결제 사례</a></li><li><a href=https://bcuts.tistory.com/453>CQRS, 이벤트 소싱 실전 구조</a></li><li><a href=https://velog.io/@may_yun/MSA-Event-Sourcing-Event-Driven-Event-Driven-Architecture>Event Sourcing Pattern 설명</a></li><li><a href=https://youngjaekim.wordpress.com/tag/%EC%9D%B4%EB%B2%A4%ED%8A%B8%EC%86%8C%EC%8B%B1/>youngjae.kim 이벤트소싱</a></li><li><a href=https://curiousjinan.tistory.com/entry/cqrs-explained-event-sourcing>오늘도 개발중 CQRS 설명</a></li><li><a href=https://velog.io/@mekind/Event-Sourcing-Pattern>Event Sourcing Pattern 예시</a></li></ul><ul><li>Martin Fowler, <em>Event Sourcing</em>, <em>What do you mean by “Event-Driven”?</em>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">martinfowler.com</a>)</li><li>Microsoft Azure, <em>Event Sourcing pattern</em>, <em>Cloud Design Patterns</em>. (<a href="https://debezium.io/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/?utm_source=chatgpt.com" title="Reliable Microservices Data Exchange With the Outbox ...">Microsoft Learn</a>)</li><li>Apache Kafka Docs, <em>Exactly-Once</em>, <em>Streams</em>. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Apache Kafka</a>)</li><li>Confluent, <em>Schema Evolution & Compatibility</em>, <em>Delivery Semantics</em>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">Confluent Docs</a>)</li><li>CNCF, <em>CloudEvents Spec</em>. (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">cloudevents.io</a>, <a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">GitHub</a>)</li><li>OpenTelemetry, <em>Messaging/Kafka SemConv</em>. (<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">OpenTelemetry</a>)</li><li>Kurrent(EventStoreDB) 블로그(Temporal Modeling). (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">Kurrent - event-native data platform</a>)</li><li>GDPR(Art. 17) 및 Crypto Shredding 레퍼런스. (<a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">gdpr-info.eu</a>, <a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">axoniq.io</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">ico.org.uk</a>)</li></ul><hr><h2 id=1단계-기본-분석-1>1단계: 기본 분석<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-1>#</a></h2><h3 id=대표-태그>대표 태그<a hidden class=anchor aria-hidden=true href=#대표-태그>#</a></h3><ul><li><strong>Event-Driven-Architecture</strong> (이벤트 중심 아키텍처)</li><li><strong>Immutable-Event-Log</strong> (불변 이벤트 로그)</li><li><strong>State-Reconstruction</strong> (상태 재구성)</li><li><strong>CQRS-Pattern</strong> (명령-쿼리 분리 패턴)</li></ul><h3 id=분류-체계-검증-3>분류 체계 검증<a hidden class=anchor aria-hidden=true href=#분류-체계-검증-3>#</a></h3><p><strong>현재 분류</strong>: Software Engineering > Design and Architecture > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns</p><p><strong>개선 제안</strong>: 현재 분류가 적절합니다. Event Sourcing은 Event-Driven Architecture의 핵심 패턴이며, 메시징 기반 아키텍처의 특수한 형태로 정확히 분류되어 있습니다. 다만 다음과 같은 교차 연결도 고려할 수 있습니다:</p><ul><li>System Design > Data Management > Data Persistence Patterns</li><li>Software Engineering > Design Patterns > Behavioral Patterns</li></ul><p><strong>근거</strong>: Event Sourcing은 데이터 지속성 전략이자 행동 패턴의 성격을 동시에 가지고 있어 다각도로 접근 가능한 주제입니다.</p><h3 id=핵심-요약-250자-이내-2>핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#핵심-요약-250자-이내-2>#</a></h3><p>Event Sourcing은 애플리케이션의 상태 변화를 불변(Immutable) 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 현재 상태가 아닌 모든 변경 사항을 이벤트로 기록하여 완전한 감사 추적(Audit Trail)을 제공하고, 언제든 과거 시점의 상태를 재구성할 수 있습니다. 주로 CQRS (Command Query Responsibility Segregation)와 함께 사용되어 분산 시스템의 확장성과 일관성을 향상시킵니다.</p><h3 id=전체-개요-400자-이내-2>전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#전체-개요-400자-이내-2>#</a></h3><p>Event Sourcing은 전통적인 CRUD (Create, Read, Update, Delete) 방식 대신 모든 상태 변화를 순차적인 이벤트로 저장하는 데이터 아키텍처 패턴입니다. 이벤트 스토어(Event Store)에 append-only 방식으로 저장된 이벤트들을 재생(Replay)하여 현재 상태를 재구성합니다.</p><p>핵심 특징으로는 완벽한 감사 로그, 시점별 상태 복원, 확장성 향상이 있으며, 금융, 전자상거래, IoT 등 높은 투명성과 추적성이 요구되는 도메인에서 활용됩니다. Apache Kafka, EventStore, AWS EventBridge 등의 기술 스택과 함께 구현되며, 마이크로서비스 아키텍처에서 서비스 간 일관성을 보장하는 핵심 패턴으로 자리잡고 있습니다.</p><h2 id=1단계-기본-분석-2><strong>1단계: 기본 분석</strong><a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-2>#</a></h2><h3 id=1-대표-태그-생성-1>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성-1>#</a></h3><ul><li>Event-Sourcing</li><li>Event-Driven-Architecture</li><li>CQRS (Command Query Responsibility Segregation)</li><li>Event-Store</li></ul><hr><h3 id=2-분류-체계-검증-1>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증-1>#</a></h3><p>현재 분류:</p><blockquote><p>Software Engineering > Design and Architecture > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns</p></blockquote><p><strong>검증 결과:</strong> 적합함.</p><ul><li>Event Sourcing은 Event-Driven Architecture의 <strong>구현 패턴 중 하나</strong>이며, 특히 &ldquo;이벤트 패턴&rdquo; 범주에 속함.</li><li>다만, Event Sourcing은 <strong>데이터 저장 전략</strong>의 성격도 강하므로 &ldquo;Database Systems > Event Store&rdquo; 같은 서브 카테고리와의 교차 분류 가능.</li></ul><p><strong>개선 제안:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1>1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2>2</a>
</span><span class=lnt id=hl-62-3><a class=lnlinks href=#hl-62-3>3</a>
</span><span class=lnt id=hl-62-4><a class=lnlinks href=#hl-62-4>4</a>
</span><span class=lnt id=hl-62-5><a class=lnlinks href=#hl-62-5>5</a>
</span><span class=lnt id=hl-62-6><a class=lnlinks href=#hl-62-6>6</a>
</span><span class=lnt id=hl-62-7><a class=lnlinks href=#hl-62-7>7</a>
</span><span class=lnt id=hl-62-8><a class=lnlinks href=#hl-62-8>8</a>
</span><span class=lnt id=hl-62-9><a class=lnlinks href=#hl-62-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Software Engineering
</span></span><span class=line><span class=cl> └─ Design and Architecture
</span></span><span class=line><span class=cl>     └─ Architecture Styles
</span></span><span class=line><span class=cl>         └─ Event-Driven Architecture
</span></span><span class=line><span class=cl>             └─ Event Patterns
</span></span><span class=line><span class=cl>                 └─ Event Sourcing
</span></span><span class=line><span class=cl>System Design
</span></span><span class=line><span class=cl> └─ Database Systems
</span></span><span class=line><span class=cl>     └─ Event Store
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=3-핵심-요약-250자-이내>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내>#</a></h3><p>Event Sourcing은 애플리케이션 상태를 현재 값으로 저장하는 대신, 모든 상태 변화를 나타내는 이벤트를 순차적으로 저장하는 패턴이다. 이를 통해 이벤트 재생으로 상태 복원, 감사 추적, CQRS와의 결합 등 강력한 이점을 제공한다.</p><hr><h3 id=4-전체-개요-400자-이내>4. 전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-400자-이내>#</a></h3><p>Event Sourcing은 데이터베이스에 현재 상태를 저장하는 대신, 상태 변화 자체를 이벤트로 기록하는 아키텍처 패턴이다. 모든 변경은 불변 이벤트로 저장되며, 시스템 상태는 이벤트 스트림을 재생하여 복원된다. 이 접근 방식은 감사 추적(audit trail), 변경 내역 재구성, 복잡한 비즈니스 로직의 재처리 등에 유리하며, CQRS 패턴과 자주 함께 사용된다. 다만, 이벤트 저장소 설계, 이벤트 스키마 버전 관리, 재생 성능 문제 등이 고려사항이다.</p><hr><p>좋아, <strong>2단계부터 4단계까지</strong> 요구한 형식에 맞춰 깊이 있게 이어가겠다. (도식, 표, 코드, 실무 팁 포함)</p><hr><h2 id=2단계-핵심-분석-1>2단계: 핵심 분석<a hidden class=anchor aria-hidden=true href=#2단계-핵심-분석-1>#</a></h2><h3 id=5-핵심-개념-정리-이론실무기본심화>5. 핵심 개념 정리 (이론/실무/기본/심화)<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리-이론실무기본심화>#</a></h3><ul><li><strong>이벤트(Event)</strong>: 도메인에서 발생한 <strong>사실(fact)</strong>. 불변(Immutable)이며 순서가 중요. 예: <code>OrderPlaced</code>, <code>PaymentCaptured</code>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li><li><strong>이벤트 스트림(Event Stream)</strong>: 특정 Aggregate(집계 루트)의 시간 순 이벤트 목록. Append-only가 원칙. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">Microsoft Learn</a>)</li><li><strong>이벤트 스토어(Event Store)</strong>: 이벤트를 영속화하는 저장소. 단일 진실 공급원(SSOT). 스냅샷, 버전, 낙관적 잠금(Optimistic Concurrency) 지원이 핵심. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">Microsoft Learn</a>)</li><li><strong>리플레이(Replay)</strong>: 이벤트를 순서대로 적용하여 현재 상태 재구성. 감사 추적(Audit) 및 재처리에 유용. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li><li><strong>CQRS(Command Query Responsibility Segregation)</strong>: 쓰기(커맨드)와 읽기(쿼리) 모델 분리. ES와 자주 결합. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Microsoft Learn</a>)</li><li><strong>업캐스터(Upcaster)</strong>: 과거 이벤트 스키마를 최신 모델로 점진 변환하는 계층. (심화 주제, 실무 필수)</li><li><strong>스냅샷(Snapshot)</strong>: 주기적으로 상태 요약본 저장해 리플레이 비용 절감.</li><li><strong>이벤트 발행/구독(Outbox/충분히 내구적인 발행)</strong>: 트랜잭션 경계에서 메시지 일관성 보장.</li></ul><h3 id=6-실무-연관성-분석-1>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석-1>#</a></h3><ul><li><strong>데이터 모델링</strong>: 상태 저장 대신 “사건을 모델링”. 규제 산업(금융/헬스)에서 <strong>감사 추적</strong> 및 <strong>소급 변경</strong>에 강함. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li><li><strong>확장성/성능</strong>: Append-only 쓰기는 쓰기 경합 적고 파티셔닝 용이. Read 모델은 물질화 뷰(Materialized View)로 독립 확장. Cosmos DB의 Change Feed 등 클라우드 특성 활용 가능. (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Microsoft for Developers</a>)</li><li><strong>복잡성 관리</strong>: 이벤트 버전 관리, 업캐스터/다운스트림 리더(리드 모델) 호환성 전략 필요.</li><li><strong>운영</strong>: 리플레이/리드 모델 리빌드에 대한 <strong>SLO</strong>와 <strong>백필(Backfill) 절차</strong> 정의가 핵심.</li></ul><h2 id=2단계-핵심-분석-2>2단계: 핵심 분석<a hidden class=anchor aria-hidden=true href=#2단계-핵심-분석-2>#</a></h2><h3 id=핵심-개념-정리-2>핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#핵심-개념-정리-2>#</a></h3><h4 id=이론적-관점>이론적 관점<a hidden class=anchor aria-hidden=true href=#이론적-관점>#</a></h4><ol><li><strong>Event Store (이벤트 스토어)</strong>: 모든 이벤트를 저장하는 append-only 데이터베이스</li><li><strong>Event Replay (이벤트 재생)</strong>: 저장된 이벤트를 순차적으로 재생하여 상태를 재구성하는 과정</li><li><strong>Aggregate (집계)</strong>: 비즈니스 로직의 일관성 경계를 나타내는 도메인 객체</li><li><strong>Projection (프로젝션)</strong>: 이벤트로부터 생성되는 읽기 전용 뷰</li></ol><h4 id=실무적-관점>실무적 관점<a hidden class=anchor aria-hidden=true href=#실무적-관점>#</a></h4><ol><li><strong>Snapshot (스냅샷)</strong>: 성능 최적화를 위한 특정 시점의 상태 저장</li><li><strong>Compensating Event (보상 이벤트)</strong>: 이전 이벤트의 효과를 상쇄하는 새로운 이벤트</li><li><strong>Event Schema Evolution (이벤트 스키마 진화)</strong>: 이벤트 구조 변경에 대한 하위 호환성 관리</li><li><strong>Event Sourcing Gateway</strong>: 외부 시스템과의 통합을 위한 인터페이스 레이어</li></ol><h4 id=기본-수준>기본 수준<a hidden class=anchor aria-hidden=true href=#기본-수준>#</a></h4><ul><li>이벤트의 불변성(Immutability) 이해</li><li>상태 재구성 메커니즘 파악</li><li>Event Store의 기본 구조 학습</li></ul><h4 id=심화-수준>심화 수준<a hidden class=anchor aria-hidden=true href=#심화-수준>#</a></h4><ul><li>분산 환경에서의 이벤트 일관성 보장</li><li>성능 최적화 전략 (샤딩, 파티셔닝)</li><li>복잡한 도메인에서의 이벤트 모델링</li></ul><h3 id=실무-연관성-분석-2>실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#실무-연관성-분석-2>#</a></h3><h4 id=마이크로서비스-아키텍처>마이크로서비스 아키텍처<a hidden class=anchor aria-hidden=true href=#마이크로서비스-아키텍처>#</a></h4><ul><li><strong>서비스 간 데이터 일관성</strong>: 이벤트를 통한 최종 일관성(Eventual Consistency) 달성</li><li><strong>서비스 분리</strong>: 각 서비스가 독립적인 이벤트 스토어를 가져 loose coupling 실현</li><li><strong>통합 복잡성 감소</strong>: 이벤트 기반 통신으로 서비스 간 의존성 최소화</li></ul><h4 id=클라우드-네이티브-구현>클라우드 네이티브 구현<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-구현>#</a></h4><ul><li><strong>확장성</strong>: 이벤트 스트림의 수평적 확장과 부하 분산</li><li><strong>장애 복구</strong>: 이벤트 재생을 통한 시스템 복구 능력</li><li><strong>관측성</strong>: 모든 변경 사항의 추적 및 모니터링</li></ul><h4 id=devops-및-운영>DevOps 및 운영<a hidden class=anchor aria-hidden=true href=#devops-및-운영>#</a></h4><ul><li><strong>배포 전략</strong>: 블루-그린 배포 시 이벤트 재생을 통한 상태 동기화</li><li><strong>테스팅</strong>: 이벤트 재생을 활용한 시나리오 기반 테스트</li><li><strong>문제 해결</strong>: 이벤트 로그를 통한 디버깅 및 근본 원인 분석</li></ul><h2 id=3단계-상세-조사-phase별-분류>3단계: 상세 조사 (Phase별 분류)<a hidden class=anchor aria-hidden=true href=#3단계-상세-조사-phase별-분류>#</a></h2><h3 id=phase-1-기초-이해>Phase 1: 기초 이해<a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해>#</a></h3><ul><li><strong>개념 정의 및 본질</strong><ul><li>Event Sourcing(이벤트 소싱): 시스템의 모든 상태 변화(변경사항)를 이벤트로 기록하고, 이벤트 스트림을 순차적으로 재생하여 현재 혹은 과거의 상태를 확인하는 소프트웨어 패턴.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">1</a></li></ul></li><li><strong>등장 배경 및 발전 과정</strong><ul><li>회계(복식부기)와 버전관리(Git, SVN 등)에서 기원. Martin Fowler, Greg Young 등 소프트웨어 설계자들이 패턴화.<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">10</a></li></ul></li><li><strong>핵심 동기 및 가치 제안</strong><ul><li>변경이력 추적, 감사와 투명성, 장애 복구, 복잡한 데이터 흐름에 대한 제어력 강화.<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">3</a><a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">2</a></li></ul></li><li><strong>주요 특징</strong><ul><li>불변 이벤트 저장, 모든 상태 변화의 추적 가능성, 복원 가능성, CQRS와의 뛰어난 궁합.<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">5</a><a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">9</a></li></ul></li></ul><h2 id=phase-1-기초-이해-foundation-understanding>Phase 1: 기초 이해 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해-foundation-understanding>#</a></h2><h3 id=개념-정의-및-본질>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질>#</a></h3><p>Event Sourcing(이벤트 소싱)은 애플리케이션의 상태를 직접 저장하는 대신, 상태를 변경하는 모든 이벤트를 순차적으로 저장하는 소프트웨어 아키텍처 패턴입니다. 이는 &ldquo;모든 변화는 이벤트의 결과"라는 철학을 기반으로 합니다.</p><p><strong>핵심 정의</strong>:</p><ul><li>상태(State) 대신 변화(Change)를 저장</li><li>이벤트는 불변(Immutable)하며 순서가 보장됨</li><li>현재 상태는 이벤트 재생을 통해 재구성</li><li>시스템의 완전한 히스토리 보존</li></ul><h3 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h3><p><strong>등장 배경</strong>:</p><ol><li><strong>전통적 CRUD의 한계</strong>: 상태 덮어쓰기로 인한 정보 손실</li><li><strong>감사 요구사항 증가</strong>: 규제 산업에서의 완전한 추적성 필요</li><li><strong>분산 시스템의 복잡성</strong>: 마이크로서비스 간 데이터 일관성 문제</li><li><strong>실시간 분석 요구</strong>: 비즈니스 인텔리전스와 실시간 의사결정 지원</li></ol><p><strong>발전 과정</strong>:</p><ul><li><strong>2005년</strong>: Martin Fowler의 초기 개념 정의</li><li><strong>2010년대 초</strong>: Greg Young의 Event Store 개발</li><li><strong>2010년대 중반</strong>: CQRS와의 결합으로 실용성 증대</li><li><strong>2020년대</strong>: 클라우드 네이티브 환경에서의 표준 패턴으로 자리매김</li></ul><h3 id=핵심-동기-및-가치-제안>핵심 동기 및 가치 제안<a hidden class=anchor aria-hidden=true href=#핵심-동기-및-가치-제안>#</a></h3><p><strong>주요 동기</strong>:</p><ol><li><strong>완전한 감사 추적</strong>: 모든 변경사항의 불변 기록</li><li><strong>시점별 상태 복원</strong>: 임의의 시점으로 되돌리기 가능</li><li><strong>확장성 향상</strong>: 읽기와 쓰기의 독립적 최적화</li><li><strong>장애 복구</strong>: 이벤트 재생을 통한 시스템 복구</li></ol><p><strong>가치 제안</strong>:</p><ul><li><strong>규정 준수</strong>: 금융, 의료 등 규제 산업의 요구사항 충족</li><li><strong>비즈니스 인사이트</strong>: 이벤트 분석을 통한 비즈니스 패턴 발견</li><li><strong>시스템 투명성</strong>: 모든 변경 과정의 완전한 가시성</li><li><strong>미래 확장성</strong>: 새로운 읽기 모델을 언제든 추가 가능</li></ul><h3 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h3><table><thead><tr><th>특징</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td><strong>불변성</strong></td><td>이벤트는 한 번 저장되면 변경되지 않음</td><td>Append-only 저장 구조로 데이터 무결성 보장</td></tr><tr><td><strong>순서 보장</strong></td><td>이벤트는 발생 순서대로 저장</td><td>타임스탬프와 시퀀스 번호를 통한 순서 관리</td></tr><tr><td><strong>재생 가능성</strong></td><td>이벤트 재생으로 상태 재구성</td><td>순수 함수를 통한 결정론적 상태 계산</td></tr><tr><td><strong>확장성</strong></td><td>읽기와 쓰기의 독립적 스케일링</td><td>CQRS 패턴과의 결합으로 성능 최적화</td></tr><tr><td><strong>추적성</strong></td><td>모든 변경사항의 완전한 히스토리</td><td>각 이벤트의 메타데이터 포함 저장</td></tr></tbody></table><h3 id=phase-1-기초-이해-1>Phase 1: 기초 이해<a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해-1>#</a></h3><h4 id=개념-정의-및-본질-1>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질-1>#</a></h4><ul><li><strong>정의</strong>: 현재 상태를 저장하는 대신, <strong>상태 변화를 일으킨 모든 이벤트</strong>를 순차적으로 저장하고, 이 이벤트들을 재적용해 상태를 얻는 패턴. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li></ul><h4 id=등장-배경-및-발전-과정-1>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정-1>#</a></h4><ul><li><strong>배경</strong>: 감사/규제 요구, 고성능 거래 시스템(예: LMAX)에서 <strong>결정적 재현성</strong>과 <strong>저지연</strong> 필요성으로 채택. (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">martinfowler.com</a>)</li><li><strong>발전</strong>: Greg Young이 CQRS와 함께 대중화, EventStoreDB 등 전용 스토어/도구 등장. (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">InfoQ</a>)</li></ul><h4 id=핵심-동기-및-가치-제안-1>핵심 동기 및 가치 제안<a hidden class=anchor aria-hidden=true href=#핵심-동기-및-가치-제안-1>#</a></h4><ul><li><strong>감사 가능성</strong>: 과거 모든 상태와 경로 재현.</li><li><strong>소급 수정/재처리</strong>: 비즈니스 규칙 변경 시 이벤트 재처리로 재산출 가능.</li><li><strong>확장성</strong>: 읽기/쓰기 분리(CQRS)로 독립 확장. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Microsoft Learn</a>)</li></ul><h4 id=주요-특징-기술적-특징--근거>주요 특징 (기술적 특징 + 근거)<a hidden class=anchor aria-hidden=true href=#주요-특징-기술적-특징--근거>#</a></h4><ul><li><strong>Append-only 이벤트 로그</strong>: 불변성, 순서성 보장. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">Microsoft Learn</a>)</li><li><strong>리플레이 가능성</strong>: 상태는 1차 파생물, 이벤트가 1급 데이터. (<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">YouTube</a>)</li><li><strong>모델 진화 가능성</strong>: 업캐스팅/멀티 리드 모델 허용. (실무 관행)</li></ul><hr><h3 id=phase-2-핵심-이론>Phase 2: 핵심 이론<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-이론>#</a></h3><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><ul><li><strong>단일 진실 공급원(SSOT)</strong>: 이벤트 스토어가 권위 있는 소스. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Microsoft Learn</a>)</li><li><strong>Aggregate 경계 내 불변식 유지</strong>: 커맨드 처리 시 도메인 규칙 검증 후 <strong>도메인 이벤트</strong> 발행.</li><li><strong>낙관적 동시성</strong>: 기대 버전(Expected Version)으로 동시 업데이트 검출.</li><li><strong>Idempotency(멱등성)</strong>: 재시도/중복 소비 대비.</li></ul><h4 id=기본-원리-및-동작-메커니즘-도식>기본 원리 및 동작 메커니즘 (도식)<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘-도식>#</a></h4><pre class=mermaid>sequenceDiagram
  participant Client
  participant CommandAPI
  participant Aggregate
  participant EventStore
  participant Projector(Read)
  participant QueryAPI

  Client-&gt;&gt;CommandAPI: PlaceOrder(cmd)
  CommandAPI-&gt;&gt;Aggregate: load(events)
  Aggregate-&gt;&gt;Aggregate: validate &amp; decide
  Aggregate--&gt;&gt;CommandAPI: DomainEvent(OrderPlaced)
  CommandAPI-&gt;&gt;EventStore: append(event, expectedVersion)
  EventStore--&gt;&gt;Projector(Read): publish(event)
  Projector(Read)-&gt;&gt;ReadDB: upsert(materialized view)
  Client-&gt;&gt;QueryAPI: GET /orders/{id}
  QueryAPI-&gt;&gt;ReadDB: select
  ReadDB--&gt;&gt;Client: current view
</pre><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><ul><li><strong>필수</strong>: Command API, Aggregate, Event Store, Projector(리드 모델 빌더), Query API</li><li><strong>선택</strong>: Snapshotter, Upcaster, Outbox, Saga/Process Manager, Schema Registry</li></ul><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><ul><li><strong>Aggregate</strong>: 명령 검증/의사결정 → 이벤트 산출</li><li><strong>Event Store</strong>: Append, 읽기(스트림), 동시성 제어, 스냅샷</li><li><strong>Projector</strong>: 이벤트→리드 모델 투영</li><li><strong>Upcaster</strong>: 과거 이벤트 포맷을 최신으로 변환</li></ul><h2 id=phase-2-핵심-이론-core-theory>Phase 2: 핵심 이론 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-이론-core-theory>#</a></h2><h3 id=핵심-설계-원칙-1>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙-1>#</a></h3><ol><li><strong>이벤트 불변성 원칙</strong>: 한 번 저장된 이벤트는 절대 수정하지 않음</li><li><strong>단일 진실 원천 원칙</strong>: Event Store가 시스템의 유일한 진실 원천</li><li><strong>이벤트 순서 보장 원칙</strong>: 같은 집계(Aggregate) 내 이벤트는 순서 보장</li><li><strong>보상 이벤트 원칙</strong>: 취소나 수정은 새로운 보상 이벤트로 처리</li><li><strong>도메인 이벤트 원칙</strong>: 비즈니스적으로 의미 있는 이벤트만 저장</li></ol><h3 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h3><pre class=mermaid>graph TB
    A[비즈니스 명령] --&gt; B[도메인 로직 처리]
    B --&gt; C[이벤트 생성]
    C --&gt; D[Event Store 저장]
    D --&gt; E[이벤트 발행]
    E --&gt; F[프로젝션 업데이트]
    E --&gt; G[외부 시스템 통지]
    
    H[쿼리 요청] --&gt; I[프로젝션 조회]
    I --&gt; J[읽기 모델 반환]
    
    K[상태 재구성] --&gt; L[이벤트 로드]
    L --&gt; M[이벤트 재생]
    M --&gt; N[현재 상태 계산]
</pre><p><strong>동작 원리</strong>:</p><ol><li><strong>Command 처리</strong>: 비즈니스 명령을 도메인 객체에서 처리</li><li><strong>Event 생성</strong>: 상태 변화를 이벤트로 모델링</li><li><strong>Event 저장</strong>: Event Store에 순차적으로 저장</li><li><strong>Event 발행</strong>: 관심 있는 구독자들에게 이벤트 전파</li><li><strong>Projection 업데이트</strong>: 읽기 모델 갱신</li><li><strong>State 재구성</strong>: 필요시 이벤트 재생으로 상태 복원</li></ol><h3 id=아키텍처-및-구성-요소-1>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소-1>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;Command Side (Write)&#34;
        A[Command Handler] --&gt; B[Aggregate Root]
        B --&gt; C[Domain Events]
        C --&gt; D[Event Store]
    end
    
    subgraph &#34;Query Side (Read)&#34;
        E[Event Handler] --&gt; F[Projection]
        F --&gt; G[Read Model DB]
        G --&gt; H[Query Handler]
    end
    
    subgraph &#34;Event Infrastructure&#34;
        I[Event Bus] --&gt; E
        D --&gt; I
        J[Event Catalog] --&gt; K[Schema Registry]
    end
    
    D -.-&gt;|Event Replay| L[State Reconstruction]
    F -.-&gt;|Snapshot| M[Snapshot Store]
</pre><p><strong>필수 구성 요소</strong>:</p><ol><li><strong>Event Store</strong>: 이벤트를 영구 저장하는 데이터베이스</li><li><strong>Command Handler</strong>: 비즈니스 명령을 처리하는 컴포넌트</li><li><strong>Event Handler</strong>: 이벤트를 수신하고 처리하는 컴포넌트</li><li><strong>Projection Engine</strong>: 읽기 모델을 생성하고 유지하는 엔진</li></ol><p><strong>선택적 구성 요소</strong>:</p><ol><li><strong>Snapshot Store</strong>: 성능 최적화를 위한 스냅샷 저장소</li><li><strong>Event Bus</strong>: 이벤트 라우팅 및 배포 인프라</li><li><strong>Schema Registry</strong>: 이벤트 스키마 버전 관리</li><li><strong>Event Catalog</strong>: 이벤트 메타데이터 관리</li></ol><h3 id=주요-기능과-역할-1>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할-1>#</a></h3><h4 id=event-store-기능>Event Store 기능<a hidden class=anchor aria-hidden=true href=#event-store-기능>#</a></h4><ul><li><strong>이벤트 저장</strong>: Append-only 방식으로 이벤트 영구 저장</li><li><strong>이벤트 조회</strong>: 집계 ID별 이벤트 시퀀스 조회</li><li><strong>스트리밍</strong>: 실시간 이벤트 스트림 제공</li><li><strong>스냅샷 관리</strong>: 성능 최적화를 위한 스냅샷 생성/관리</li></ul><h4 id=projection-engine-기능>Projection Engine 기능<a hidden class=anchor aria-hidden=true href=#projection-engine-기능>#</a></h4><ul><li><strong>이벤트 구독</strong>: Event Store로부터 이벤트 수신</li><li><strong>상태 계산</strong>: 이벤트 기반 읽기 모델 생성</li><li><strong>뷰 최적화</strong>: 쿼리 패턴에 맞춘 데이터 구조 생성</li><li><strong>일관성 관리</strong>: 최종 일관성 보장</li></ul><h4 id=commandquery-분리>Command/Query 분리<a hidden class=anchor aria-hidden=true href=#commandquery-분리>#</a></h4><ul><li><strong>Command 책임</strong>: 비즈니스 로직 실행, 이벤트 생성</li><li><strong>Query 책임</strong>: 읽기 최적화된 뷰 제공</li><li><strong>독립적 확장</strong>: 읽기/쓰기 워크로드별 최적화</li><li><strong>기술 스택 분리</strong>: 각각 다른 기술 스택 사용 가능</li></ul><h3 id=phase-2-핵심-이론-1>Phase 2: 핵심 이론<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-이론-1>#</a></h3><ul><li><strong>핵심 설계 원칙</strong><ul><li>데이터 변경시 최종 상태가 아니라, 불변의 이벤트를 순차 기록</li><li>모든 이벤트 불변(immutable) 저장 및 롤백 불가</li></ul></li><li><strong>기본 원리 및 동작 메커니즘</strong></li></ul><pre class=mermaid>sequenceDiagram
    participant UI
    participant CommandHandler
    participant EventStore
    participant ReadModelDB
    UI-&gt;&gt;CommandHandler: Command(예: 주문 요청)
    CommandHandler-&gt;&gt;EventStore: Event 기록(예: 주문 생성 이벤트)
    EventStore-&gt;&gt;ReadModelDB: 이벤트 Replay 후 상태 갱신
    ReadModelDB-&gt;&gt;UI: 상태 조회
</pre><ul><li><strong>아키텍처 및 구성 요소</strong><ul><li>필수: 이벤트(Event), 이벤트 스토어(Event Store), 상태(State), 이벤트 핸들러(Event Handler)</li><li>선택: Snapshot, CQRS, 이벤트 브로커(Kafka, RabbitMQ 등), 조회용 DB(Read Model)</li></ul></li><li><strong>주요 기능과 역할</strong><ul><li>이벤트: 상태변화의 불변 기록</li><li>이벤트 스토어: 이벤트 저장/관리</li><li>핸들러: 이벤트 처리 및 상태 재생</li><li>Snapshot: 성능 개선용 전체 상태 저장</li><li>CQRS: 데이터 변경과 조회 분리</li></ul></li></ul><hr><h3 id=phase-3-특성-분석-1>Phase 3: 특성 분석<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-1>#</a></h3><h4 id=장점-분석표>장점 분석표<a hidden class=anchor aria-hidden=true href=#장점-분석표>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>장점</td><td>변경이력 추적</td><td>모든 상태 변경 사항을 이벤트로 기록, 과거 상태 복구 가능</td><td>불변 이벤트 저장</td></tr><tr><td>장점</td><td>감사/투명성</td><td>데이터 변경 내역 전체 확인 가능, Audit 요구 충족</td><td>이벤트 로그 기반 감사/법적 검토 강화</td></tr><tr><td>장점</td><td>복구성</td><td>장애 발생 시 이벤트 재생으로 신속 복구</td><td>이벤트 스트림 Replay</td></tr><tr><td>장점</td><td>비즈니스 로직 명확성</td><td>이벤트 중심 설계로 변화 흐름 파악 용이</td><td>비즈니스 도메인 이벤트 명확화</td></tr></tbody></table><h4 id=단점-및-문제점-분석표>단점 및 문제점 분석표<a hidden class=anchor aria-hidden=true href=#단점-및-문제점-분석표>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>이벤트 처리/저장/관리 로직 추가</td><td>표준 프레임워크, 이벤트 핸들러 활용</td><td>전통적 CRUD, Audit Log</td></tr><tr><td>단점</td><td>스토리지 요구</td><td>모든 이벤트 저장으로 데이터 증가</td><td>이벤트 만료/압축, Storage 확장</td><td>로그축소, Snapshot</td></tr><tr><td>단점</td><td>성능 이슈</td><td>이벤트 재생(replay)로 현재 상태 계산 부담</td><td>Snapshot 적용, CQRS 분리</td><td>상태 기반 저장 방식</td></tr><tr><td>단점</td><td>모델 설계 난이도</td><td>이벤트 모델링, 도메인 이벤트 설계 어려움</td><td>DDD(도메인 주도 설계) 도입</td><td>CRUD/단순 트랜잭션</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>설계 난이도</td><td>이벤트/도메인 모델 복잡성</td><td>초기 설계 오류, 데이터 혼선</td><td>이벤트 테스트, 도메인 검토</td><td>DDD, TDD 도입</td><td>문서화/모듈화</td></tr></tbody></table><h4 id=트레이드오프-분석>트레이드오프 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-분석>#</a></h4><ul><li>감사/추적성 ↔ 높은 저장/관리 복잡성</li><li>복구성 강화 ↔ 실시간 상태 계산 성능 이슈 발생</li></ul><h2 id=phase-3-특성-분석-characteristics-analysis-2>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis-2>#</a></h2><h3 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>장점</td><td><strong>완벽한 감사 추적</strong></td><td>모든 상태 변화의 불변 기록 유지</td><td>Append-only 저장 구조로 데이터 변조 방지</td></tr><tr><td>장점</td><td><strong>시점별 상태 복원</strong></td><td>과거 임의 시점의 상태 재구성 가능</td><td>이벤트 재생을 통한 결정론적 상태 계산</td></tr><tr><td>장점</td><td><strong>확장성</strong></td><td>읽기와 쓰기의 독립적 스케일링</td><td>CQRS 패턴과 결합하여 각각 최적화</td></tr><tr><td>장점</td><td><strong>장애 복구</strong></td><td>이벤트 재생을 통한 시스템 복구</td><td>이벤트 스토어를 단일 진실 원천으로 활용</td></tr><tr><td>장점</td><td><strong>비즈니스 인사이트</strong></td><td>이벤트 분석을 통한 패턴 발견</td><td>모든 비즈니스 이벤트의 풍부한 메타데이터</td></tr><tr><td>장점</td><td><strong>미래 확장성</strong></td><td>새로운 읽기 모델을 언제든 추가</td><td>기존 이벤트로부터 새로운 프로젝션 생성</td></tr><tr><td>장점</td><td><strong>동시성 문제 해결</strong></td><td>낙관적 동시성 제어로 성능 향상</td><td>이벤트 append 방식으로 락 경합 최소화</td></tr></tbody></table><h3 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h3><p><strong>단점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td><strong>복잡성 증가</strong></td><td>전통적 CRUD 대비 구현 복잡도 상승</td><td>단계적 도입, 교육 투자</td><td>하이브리드 접근법</td></tr><tr><td>단점</td><td><strong>쿼리 복잡성</strong></td><td>이벤트 재생으로 인한 쿼리 성능 저하</td><td>CQRS 패턴, 프로젝션 활용</td><td>전용 쿼리 DB</td></tr><tr><td>단점</td><td><strong>스토리지 증가</strong></td><td>모든 이벤트 보관으로 저장 공간 증가</td><td>스냅샷, 아카이빙 전략</td><td>압축, 파티셔닝</td></tr><tr><td>단점</td><td><strong>최종 일관성</strong></td><td>읽기 모델의 최종 일관성으로 인한 지연</td><td>이벤트 버스 최적화</td><td>동기식 프로젝션</td></tr><tr><td>단점</td><td><strong>학습 곡선</strong></td><td>새로운 패러다임으로 인한 학습 부담</td><td>점진적 교육, 멘토링</td><td>기존 패턴과 혼용</td></tr></tbody></table><p><strong>문제점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td><strong>이벤트 스키마 진화</strong></td><td>비즈니스 요구사항 변화</td><td>하위 호환성 문제</td><td>버전 추적 도구</td><td>스키마 설계 가이드라인</td><td>다중 버전 핸들러</td></tr><tr><td>문제점</td><td><strong>이벤트 재생 성능</strong></td><td>대량 이벤트 누적</td><td>상태 재구성 지연</td><td>성능 모니터링</td><td>스냅샷 전략</td><td>병렬 처리, 캐싱</td></tr><tr><td>문제점</td><td><strong>이벤트 중복</strong></td><td>네트워크 장애, 재시도</td><td>데이터 불일치</td><td>중복 검사 도구</td><td>멱등성 설계</td><td>이벤트 ID 기반 중복 제거</td></tr><tr><td>문제점</td><td><strong>투영 지연</strong></td><td>이벤트 처리 병목</td><td>읽기 모델 지연</td><td>지연 메트릭</td><td>처리 용량 계획</td><td>배치 처리, 우선순위 큐</td></tr></tbody></table><h3 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h3><p><strong>성능 vs 일관성</strong>:</p><ul><li>이벤트 소싱은 쓰기 성능을 높이지만 읽기 일관성을 희생</li><li>CQRS와 결합하여 각각 최적화하지만 최종 일관성 수용 필요</li></ul><p><strong>단순성 vs 유연성</strong>:</p><ul><li>전통적 CRUD보다 복잡하지만 미래 변화에 대한 높은 적응력 제공</li><li>초기 개발 비용이 높지만 장기적 유지보수성 향상</li></ul><p><strong>저장 공간 vs 정보 보존</strong>:</p><ul><li>모든 이벤트 저장으로 공간 사용량 증가</li><li>대신 완전한 히스토리와 감사 추적 능력 확보</li></ul><p><strong>학습 곡선 vs 장기 이익</strong>:</p><ul><li>팀의 초기 학습 부담 증가</li><li>숙련도 향상 시 개발 생산성과 시스템 안정성 크게 개선</li></ul><h3 id=phase-3-특성-분석-2>Phase 3: 특성 분석<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-2>#</a></h3><h4 id=장점-및-이점-표>장점 및 이점 (표)<a hidden class=anchor aria-hidden=true href=#장점-및-이점-표>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>장점</td><td>감사 추적</td><td>모든 상태 변화가 이벤트로 보존</td><td>이벤트 로그 재생과 과거 시점 조회 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</td></tr><tr><td>장점</td><td>모델 진화</td><td>리드 모델을 자유롭게 재구성</td><td>리플레이로 새 물질화 뷰 생성 (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">Microsoft Learn</a>)</td></tr><tr><td>장점</td><td>확장성</td><td>읽기/쓰기 독립 확장</td><td>CQRS 결합 시 Read/Write 분리 (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Microsoft Learn</a>)</td></tr><tr><td>장점</td><td>성능</td><td>Append-only 쓰기 경합↓</td><td>순차 쓰기/파티셔닝 용이(실무 관행), Change Feed 응용 (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Microsoft for Developers</a>)</td></tr></tbody></table><h4 id=단점-및-제약--해결방안-표>단점 및 제약 + 해결방안 (표)<a hidden class=anchor aria-hidden=true href=#단점-및-제약--해결방안-표>#</a></h4><p>단점</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>복잡한 설계</td><td>이벤트 모델링, 업캐스팅 필요</td><td>이벤트 스키마 규율, 계약 테스트, Schema Registry</td><td>단순 CRUD, SCD(Slowly Changing Dimension)</td></tr><tr><td>단점</td><td>리플레이 비용</td><td>대규모 스트림 리플레이 느림</td><td>스냅샷, 체크포인트, 파티션, Batch 리플레이</td><td>CDC(Change Data Capture)</td></tr><tr><td>단점</td><td>데이터 삭제/수정</td><td>GDPR 삭제 요구와 불변 로그 충돌</td><td>토큰화/암호화 키 삭제, 이벤트 보정 이벤트 추가</td><td>소프트 삭제 CRUD</td></tr><tr><td>단점</td><td>운영 난이도</td><td>멱등성/재처리/순서 보장 과제</td><td>멱등키, Exactly-once는 지양·At-least-once+보정</td><td>2PC(비권장), Sagas</td></tr></tbody></table><p>문제점</p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>이벤트 중복</td><td>재시도/네트워크 장애</td><td>중복 투영/불일치</td><td>중복율 메트릭, 리드 모델 불일치 탐지</td><td>멱등키 저장</td><td>Upsert with unique constraint</td></tr><tr><td>문제점</td><td>이벤트 순서 역전</td><td>파티션/샤딩 이슈</td><td>불변식 위반 위험</td><td>Lag/Partition skew 모니터</td><td>키 기반 파티셔닝</td><td>Aggregate 단일 파티션 보장</td></tr><tr><td>문제점</td><td>버전 충돌</td><td>동시 업데이트</td><td>쓰기 실패/유실</td><td>ExpectedVersion 오류율</td><td>낙관적 잠금</td><td>재시도+리드 모델 보정</td></tr></tbody></table><h4 id=트레이드오프>트레이드오프<a hidden class=anchor aria-hidden=true href=#트레이드오프>#</a></h4><ul><li><strong>감사/재현성 vs. 복잡성</strong></li><li><strong>At-least-once 처리 vs. Exactly-once 환상</strong>: 현실적으로 멱등성과 재처리 전략이 핵심.</li><li><strong>강한 일관성 vs. 최종 일관성</strong>: 읽기는 최종 일관성이 일반적.</li></ul><hr><h3 id=phase-4-구현-및-분류-1>Phase 4: 구현 및 분류<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-1>#</a></h3><h4 id=구현-기법-및-방법-정의구성목적예시>구현 기법 및 방법 (정의/구성/목적/예시)<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법-정의구성목적예시>#</a></h4><ul><li><p><strong>스토리지 선택</strong></p><ul><li><strong>전용</strong>: EventStoreDB(스트림·버전·프로젝션 1급 지원). (<a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">GitHub</a>)</li><li><strong>범용 DB</strong>: PostgreSQL(append 테이블+인덱스), NoSQL(파티셔닝).</li><li><strong>클라우드</strong>: Cosmos DB + Change Feed로 투영. (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Microsoft for Developers</a>)</li></ul></li><li><p><strong>스키마 전략</strong></p><ul><li><strong>이벤트 명세</strong>: 타입, 버전, 발생 시각, Aggregate ID, 시퀀스, 페이로드(스키마드 JSON/Avro).</li><li><strong>버전 관리</strong>: <strong>Upcaster</strong>/하위 호환 필드 추가 원칙.</li></ul></li><li><p><strong>동시성/멱등성</strong></p><ul><li>ExpectedVersion로 단일-작성 보장, 멱등키로 중복 커맨드 방지.</li></ul></li><li><p><strong>투영/물질화 뷰</strong></p><ul><li>이벤트 핸들러가 Read 모델을 Upsert. 장애 시 체크포인트 오프셋으로 재처리.</li></ul></li></ul><h4 id=분류-기준에-따른-유형-표>분류 기준에 따른 유형 (표)<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-표>#</a></h4><table><thead><tr><th>기준</th><th>유형</th><th>설명</th><th>사용 맥락</th></tr></thead><tbody><tr><td>저장 형태</td><td>전용 이벤트 스토어</td><td>EventStoreDB 등</td><td>풍부한 스트림/프로젝션, 고도 기능 필요</td></tr><tr><td>저장 형태</td><td>범용 DB 기반</td><td>RDBMS/NoSQL</td><td>팀 기술 적합성, 비용/운영 단순화</td></tr><tr><td>읽기 모델</td><td>동기 투영</td><td>트랜잭션 내 투영</td><td>간단한 시스템, 강한 일관성 선호</td></tr><tr><td>읽기 모델</td><td>비동기 투영</td><td>큐/체인지피드 사용</td><td>확장성/격리</td></tr><tr><td>이벤트 스키마</td><td>진화형(업캐스팅)</td><td>v1→vN</td><td>장기 수명, 점진 이행</td></tr><tr><td>이벤트 스키마</td><td>고정형(교체)</td><td>하위 호환 없이 교체</td><td>내부 도구, 짧은 수명</td></tr></tbody></table><h2 id=phase-4-구현-및-분류-implementation--classification-2>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification-2>#</a></h2><h3 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h3><h4 id=1-이벤트-모델링-기법>1. 이벤트 모델링 기법<a hidden class=anchor aria-hidden=true href=#1-이벤트-모델링-기법>#</a></h4><p><strong>정의</strong>: 비즈니스 도메인의 상태 변화를 이벤트로 표현하는 방법론</p><p><strong>구성</strong>:</p><ul><li>이벤트 식별: 도메인 전문가와 협업하여 비즈니스 이벤트 발굴</li><li>이벤트 설계: 이벤트 구조, 속성, 메타데이터 정의</li><li>이벤트 명명: 과거형 동사로 명명 (예: OrderPlaced, PaymentProcessed)</li></ul><p><strong>목적</strong>: 비즈니스 프로세스를 이벤트 중심으로 재구성하여 도메인 모델 명확화</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-67-1><a class=lnlinks href=#hl-67-1> 1</a>
</span><span class=lnt id=hl-67-2><a class=lnlinks href=#hl-67-2> 2</a>
</span><span class=lnt id=hl-67-3><a class=lnlinks href=#hl-67-3> 3</a>
</span><span class=lnt id=hl-67-4><a class=lnlinks href=#hl-67-4> 4</a>
</span><span class=lnt id=hl-67-5><a class=lnlinks href=#hl-67-5> 5</a>
</span><span class=lnt id=hl-67-6><a class=lnlinks href=#hl-67-6> 6</a>
</span><span class=lnt id=hl-67-7><a class=lnlinks href=#hl-67-7> 7</a>
</span><span class=lnt id=hl-67-8><a class=lnlinks href=#hl-67-8> 8</a>
</span><span class=lnt id=hl-67-9><a class=lnlinks href=#hl-67-9> 9</a>
</span><span class=lnt id=hl-67-10><a class=lnlinks href=#hl-67-10>10</a>
</span><span class=lnt id=hl-67-11><a class=lnlinks href=#hl-67-11>11</a>
</span><span class=lnt id=hl-67-12><a class=lnlinks href=#hl-67-12>12</a>
</span><span class=lnt id=hl-67-13><a class=lnlinks href=#hl-67-13>13</a>
</span><span class=lnt id=hl-67-14><a class=lnlinks href=#hl-67-14>14</a>
</span><span class=lnt id=hl-67-15><a class=lnlinks href=#hl-67-15>15</a>
</span><span class=lnt id=hl-67-16><a class=lnlinks href=#hl-67-16>16</a>
</span><span class=lnt id=hl-67-17><a class=lnlinks href=#hl-67-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 도메인의 이벤트 모델링</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>user_id</span> <span class=o>=</span> <span class=n>user_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderPlaced</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>items</span><span class=p>,</span> <span class=n>total_amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=n>total_amount</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderShipped</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tracking_number</span> <span class=o>=</span> <span class=n>tracking_number</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-이벤트-스토어-구현-기법>2. 이벤트 스토어 구현 기법<a hidden class=anchor aria-hidden=true href=#2-이벤트-스토어-구현-기법>#</a></h4><p><strong>정의</strong>: 이벤트를 영구 저장하고 조회할 수 있는 저장소 구현 방법</p><p><strong>구성</strong>:</p><ul><li>저장 스키마: 이벤트 ID, 집계 ID, 이벤트 타입, 버전, 데이터, 타임스탬프</li><li>인덱싱: 집계 ID별 빠른 조회를 위한 인덱스 설계</li><li>파티셔닝: 대용량 처리를 위한 데이터 분산 전략</li></ul><p><strong>목적</strong>: 이벤트의 안전한 저장과 효율적인 조회 보장</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-68-1><a class=lnlinks href=#hl-68-1> 1</a>
</span><span class=lnt id=hl-68-2><a class=lnlinks href=#hl-68-2> 2</a>
</span><span class=lnt id=hl-68-3><a class=lnlinks href=#hl-68-3> 3</a>
</span><span class=lnt id=hl-68-4><a class=lnlinks href=#hl-68-4> 4</a>
</span><span class=lnt id=hl-68-5><a class=lnlinks href=#hl-68-5> 5</a>
</span><span class=lnt id=hl-68-6><a class=lnlinks href=#hl-68-6> 6</a>
</span><span class=lnt id=hl-68-7><a class=lnlinks href=#hl-68-7> 7</a>
</span><span class=lnt id=hl-68-8><a class=lnlinks href=#hl-68-8> 8</a>
</span><span class=lnt id=hl-68-9><a class=lnlinks href=#hl-68-9> 9</a>
</span><span class=lnt id=hl-68-10><a class=lnlinks href=#hl-68-10>10</a>
</span><span class=lnt id=hl-68-11><a class=lnlinks href=#hl-68-11>11</a>
</span><span class=lnt id=hl-68-12><a class=lnlinks href=#hl-68-12>12</a>
</span><span class=lnt id=hl-68-13><a class=lnlinks href=#hl-68-13>13</a>
</span><span class=lnt id=hl-68-14><a class=lnlinks href=#hl-68-14>14</a>
</span><span class=lnt id=hl-68-15><a class=lnlinks href=#hl-68-15>15</a>
</span><span class=lnt id=hl-68-16><a class=lnlinks href=#hl-68-16>16</a>
</span><span class=lnt id=hl-68-17><a class=lnlinks href=#hl-68-17>17</a>
</span><span class=lnt id=hl-68-18><a class=lnlinks href=#hl-68-18>18</a>
</span><span class=lnt id=hl-68-19><a class=lnlinks href=#hl-68-19>19</a>
</span><span class=lnt id=hl-68-20><a class=lnlinks href=#hl-68-20>20</a>
</span><span class=lnt id=hl-68-21><a class=lnlinks href=#hl-68-21>21</a>
</span><span class=lnt id=hl-68-22><a class=lnlinks href=#hl-68-22>22</a>
</span><span class=lnt id=hl-68-23><a class=lnlinks href=#hl-68-23>23</a>
</span><span class=lnt id=hl-68-24><a class=lnlinks href=#hl-68-24>24</a>
</span><span class=lnt id=hl-68-25><a class=lnlinks href=#hl-68-25>25</a>
</span><span class=lnt id=hl-68-26><a class=lnlinks href=#hl-68-26>26</a>
</span><span class=lnt id=hl-68-27><a class=lnlinks href=#hl-68-27>27</a>
</span><span class=lnt id=hl-68-28><a class=lnlinks href=#hl-68-28>28</a>
</span><span class=lnt id=hl-68-29><a class=lnlinks href=#hl-68-29>29</a>
</span><span class=lnt id=hl-68-30><a class=lnlinks href=#hl-68-30>30</a>
</span><span class=lnt id=hl-68-31><a class=lnlinks href=#hl-68-31>31</a>
</span><span class=lnt id=hl-68-32><a class=lnlinks href=#hl-68-32>32</a>
</span><span class=lnt id=hl-68-33><a class=lnlinks href=#hl-68-33>33</a>
</span><span class=lnt id=hl-68-34><a class=lnlinks href=#hl-68-34>34</a>
</span><span class=lnt id=hl-68-35><a class=lnlinks href=#hl-68-35>35</a>
</span><span class=lnt id=hl-68-36><a class=lnlinks href=#hl-68-36>36</a>
</span><span class=lnt id=hl-68-37><a class=lnlinks href=#hl-68-37>37</a>
</span><span class=lnt id=hl-68-38><a class=lnlinks href=#hl-68-38>38</a>
</span><span class=lnt id=hl-68-39><a class=lnlinks href=#hl-68-39>39</a>
</span><span class=lnt id=hl-68-40><a class=lnlinks href=#hl-68-40>40</a>
</span><span class=lnt id=hl-68-41><a class=lnlinks href=#hl-68-41>41</a>
</span><span class=lnt id=hl-68-42><a class=lnlinks href=#hl-68-42>42</a>
</span><span class=lnt id=hl-68-43><a class=lnlinks href=#hl-68-43>43</a>
</span><span class=lnt id=hl-68-44><a class=lnlinks href=#hl-68-44>44</a>
</span><span class=lnt id=hl-68-45><a class=lnlinks href=#hl-68-45>45</a>
</span><span class=lnt id=hl-68-46><a class=lnlinks href=#hl-68-46>46</a>
</span><span class=lnt id=hl-68-47><a class=lnlinks href=#hl-68-47>47</a>
</span><span class=lnt id=hl-68-48><a class=lnlinks href=#hl-68-48>48</a>
</span><span class=lnt id=hl-68-49><a class=lnlinks href=#hl-68-49>49</a>
</span><span class=lnt id=hl-68-50><a class=lnlinks href=#hl-68-50>50</a>
</span><span class=lnt id=hl-68-51><a class=lnlinks href=#hl-68-51>51</a>
</span><span class=lnt id=hl-68-52><a class=lnlinks href=#hl-68-52>52</a>
</span><span class=lnt id=hl-68-53><a class=lnlinks href=#hl-68-53>53</a>
</span><span class=lnt id=hl-68-54><a class=lnlinks href=#hl-68-54>54</a>
</span><span class=lnt id=hl-68-55><a class=lnlinks href=#hl-68-55>55</a>
</span><span class=lnt id=hl-68-56><a class=lnlinks href=#hl-68-56>56</a>
</span><span class=lnt id=hl-68-57><a class=lnlinks href=#hl-68-57>57</a>
</span><span class=lnt id=hl-68-58><a class=lnlinks href=#hl-68-58>58</a>
</span><span class=lnt id=hl-68-59><a class=lnlinks href=#hl-68-59>59</a>
</span><span class=lnt id=hl-68-60><a class=lnlinks href=#hl-68-60>60</a>
</span><span class=lnt id=hl-68-61><a class=lnlinks href=#hl-68-61>61</a>
</span><span class=lnt id=hl-68-62><a class=lnlinks href=#hl-68-62>62</a>
</span><span class=lnt id=hl-68-63><a class=lnlinks href=#hl-68-63>63</a>
</span><span class=lnt id=hl-68-64><a class=lnlinks href=#hl-68-64>64</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># PostgreSQL 기반 이벤트 스토어 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PostgreSQLEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>connection</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>expected_version</span><span class=p>,</span> <span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 append-only 방식으로 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 낙관적 동시성 제어</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;SELECT version FROM aggregates WHERE id = </span><span class=si>%s</span><span class=s2> FOR UPDATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>aggregate_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_version</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_version</span> <span class=ow>and</span> <span class=n>current_version</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>!=</span> <span class=n>expected_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=n>ConcurrencyError</span><span class=p>(</span><span class=s2>&#34;Aggregate version mismatch&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 저장</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>event</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                    INSERT INTO events (aggregate_id, version, event_type, event_data, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>                    VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>expected_version</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>event</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 집계 버전 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>new_version</span> <span class=o>=</span> <span class=n>expected_version</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO aggregates (id, version) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>                ON CONFLICT (id) DO UPDATE SET version = </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>new_version</span><span class=p>,</span> <span class=n>new_version</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>from_version</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;집계의 이벤트 시퀀스 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            SELECT event_type, event_data, version, timestamp
</span></span></span><span class=line><span class=cl><span class=s2>            FROM events
</span></span></span><span class=line><span class=cl><span class=s2>            WHERE aggregate_id = </span><span class=si>%s</span><span class=s2> AND version &gt; </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            ORDER BY version
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>from_version</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=p>,</span> <span class=n>event_data</span><span class=p>,</span> <span class=n>version</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=n>row</span>
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 객체 재구성 (event_type을 통한 동적 생성)</span>
</span></span><span class=line><span class=cl>            <span class=n>event_class</span> <span class=o>=</span> <span class=nb>globals</span><span class=p>()[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>event_dict</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=n>event_class</span><span class=p>(</span><span class=o>**</span><span class=n>event_dict</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>events</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-프로젝션-구현-기법>3. 프로젝션 구현 기법<a hidden class=anchor aria-hidden=true href=#3-프로젝션-구현-기법>#</a></h4><p><strong>정의</strong>: 이벤트로부터 읽기 최적화된 뷰를 생성하는 방법</p><p><strong>구성</strong>:</p><ul><li>이벤트 핸들러: 특정 이벤트 타입을 처리하는 핸들러</li><li>상태 빌더: 이벤트 시퀀스로부터 집계 상태 구성</li><li>뷰 업데이트: 읽기 모델 데이터베이스 갱신</li></ul><p><strong>목적</strong>: 쿼리 성능 최적화와 다양한 읽기 모델 지원</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-69-1><a class=lnlinks href=#hl-69-1> 1</a>
</span><span class=lnt id=hl-69-2><a class=lnlinks href=#hl-69-2> 2</a>
</span><span class=lnt id=hl-69-3><a class=lnlinks href=#hl-69-3> 3</a>
</span><span class=lnt id=hl-69-4><a class=lnlinks href=#hl-69-4> 4</a>
</span><span class=lnt id=hl-69-5><a class=lnlinks href=#hl-69-5> 5</a>
</span><span class=lnt id=hl-69-6><a class=lnlinks href=#hl-69-6> 6</a>
</span><span class=lnt id=hl-69-7><a class=lnlinks href=#hl-69-7> 7</a>
</span><span class=lnt id=hl-69-8><a class=lnlinks href=#hl-69-8> 8</a>
</span><span class=lnt id=hl-69-9><a class=lnlinks href=#hl-69-9> 9</a>
</span><span class=lnt id=hl-69-10><a class=lnlinks href=#hl-69-10>10</a>
</span><span class=lnt id=hl-69-11><a class=lnlinks href=#hl-69-11>11</a>
</span><span class=lnt id=hl-69-12><a class=lnlinks href=#hl-69-12>12</a>
</span><span class=lnt id=hl-69-13><a class=lnlinks href=#hl-69-13>13</a>
</span><span class=lnt id=hl-69-14><a class=lnlinks href=#hl-69-14>14</a>
</span><span class=lnt id=hl-69-15><a class=lnlinks href=#hl-69-15>15</a>
</span><span class=lnt id=hl-69-16><a class=lnlinks href=#hl-69-16>16</a>
</span><span class=lnt id=hl-69-17><a class=lnlinks href=#hl-69-17>17</a>
</span><span class=lnt id=hl-69-18><a class=lnlinks href=#hl-69-18>18</a>
</span><span class=lnt id=hl-69-19><a class=lnlinks href=#hl-69-19>19</a>
</span><span class=lnt id=hl-69-20><a class=lnlinks href=#hl-69-20>20</a>
</span><span class=lnt id=hl-69-21><a class=lnlinks href=#hl-69-21>21</a>
</span><span class=lnt id=hl-69-22><a class=lnlinks href=#hl-69-22>22</a>
</span><span class=lnt id=hl-69-23><a class=lnlinks href=#hl-69-23>23</a>
</span><span class=lnt id=hl-69-24><a class=lnlinks href=#hl-69-24>24</a>
</span><span class=lnt id=hl-69-25><a class=lnlinks href=#hl-69-25>25</a>
</span><span class=lnt id=hl-69-26><a class=lnlinks href=#hl-69-26>26</a>
</span><span class=lnt id=hl-69-27><a class=lnlinks href=#hl-69-27>27</a>
</span><span class=lnt id=hl-69-28><a class=lnlinks href=#hl-69-28>28</a>
</span><span class=lnt id=hl-69-29><a class=lnlinks href=#hl-69-29>29</a>
</span><span class=lnt id=hl-69-30><a class=lnlinks href=#hl-69-30>30</a>
</span><span class=lnt id=hl-69-31><a class=lnlinks href=#hl-69-31>31</a>
</span><span class=lnt id=hl-69-32><a class=lnlinks href=#hl-69-32>32</a>
</span><span class=lnt id=hl-69-33><a class=lnlinks href=#hl-69-33>33</a>
</span><span class=lnt id=hl-69-34><a class=lnlinks href=#hl-69-34>34</a>
</span><span class=lnt id=hl-69-35><a class=lnlinks href=#hl-69-35>35</a>
</span><span class=lnt id=hl-69-36><a class=lnlinks href=#hl-69-36>36</a>
</span><span class=lnt id=hl-69-37><a class=lnlinks href=#hl-69-37>37</a>
</span><span class=lnt id=hl-69-38><a class=lnlinks href=#hl-69-38>38</a>
</span><span class=lnt id=hl-69-39><a class=lnlinks href=#hl-69-39>39</a>
</span><span class=lnt id=hl-69-40><a class=lnlinks href=#hl-69-40>40</a>
</span><span class=lnt id=hl-69-41><a class=lnlinks href=#hl-69-41>41</a>
</span><span class=lnt id=hl-69-42><a class=lnlinks href=#hl-69-42>42</a>
</span><span class=lnt id=hl-69-43><a class=lnlinks href=#hl-69-43>43</a>
</span><span class=lnt id=hl-69-44><a class=lnlinks href=#hl-69-44>44</a>
</span><span class=lnt id=hl-69-45><a class=lnlinks href=#hl-69-45>45</a>
</span><span class=lnt id=hl-69-46><a class=lnlinks href=#hl-69-46>46</a>
</span><span class=lnt id=hl-69-47><a class=lnlinks href=#hl-69-47>47</a>
</span><span class=lnt id=hl-69-48><a class=lnlinks href=#hl-69-48>48</a>
</span><span class=lnt id=hl-69-49><a class=lnlinks href=#hl-69-49>49</a>
</span><span class=lnt id=hl-69-50><a class=lnlinks href=#hl-69-50>50</a>
</span><span class=lnt id=hl-69-51><a class=lnlinks href=#hl-69-51>51</a>
</span><span class=lnt id=hl-69-52><a class=lnlinks href=#hl-69-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 프로젝션 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>read_db</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span> <span class=o>=</span> <span class=n>read_db</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_handlers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;OrderPlaced&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_order_placed</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;OrderShipped&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_order_shipped</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;OrderCancelled&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_order_cancelled</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 타입에 따른 적절한 핸들러 호출&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>handler</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_handlers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>handler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>handler</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_placed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            INSERT INTO order_summary (
</span></span></span><span class=line><span class=cl><span class=s2>                order_id, user_id, status, total_amount, created_at
</span></span></span><span class=line><span class=cl><span class=s2>            ) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;PLACED&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 항목 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>event</span><span class=o>.</span><span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO order_items (order_id, product_id, quantity, price)
</span></span></span><span class=line><span class=cl><span class=s2>                VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>quantity</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>price</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_shipped</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            UPDATE order_summary 
</span></span></span><span class=line><span class=cl><span class=s2>            SET status = &#39;SHIPPED&#39;, tracking_number = </span><span class=si>%s</span><span class=s2>, shipped_at = </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            WHERE order_id = </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>tracking_number</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_cancelled</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 취소 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            UPDATE order_summary 
</span></span></span><span class=line><span class=cl><span class=s2>            SET status = &#39;CANCELLED&#39;, cancelled_at = </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            WHERE order_id = </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=4-스냅샷-구현-기법>4. 스냅샷 구현 기법<a hidden class=anchor aria-hidden=true href=#4-스냅샷-구현-기법>#</a></h4><p><strong>정의</strong>: 성능 최적화를 위해 특정 시점의 집계 상태를 저장하는 방법</p><p><strong>구성</strong>:</p><ul><li>스냅샷 정책: 스냅샷 생성 시점과 빈도 결정</li><li>스냅샷 저장: 집계 상태의 직렬화된 형태 저장</li><li>스냅샷 로딩: 스냅샷 기반 빠른 상태 복원</li></ul><p><strong>목적</strong>: 대량 이벤트 재생으로 인한 성능 문제 해결</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-70-1><a class=lnlinks href=#hl-70-1> 1</a>
</span><span class=lnt id=hl-70-2><a class=lnlinks href=#hl-70-2> 2</a>
</span><span class=lnt id=hl-70-3><a class=lnlinks href=#hl-70-3> 3</a>
</span><span class=lnt id=hl-70-4><a class=lnlinks href=#hl-70-4> 4</a>
</span><span class=lnt id=hl-70-5><a class=lnlinks href=#hl-70-5> 5</a>
</span><span class=lnt id=hl-70-6><a class=lnlinks href=#hl-70-6> 6</a>
</span><span class=lnt id=hl-70-7><a class=lnlinks href=#hl-70-7> 7</a>
</span><span class=lnt id=hl-70-8><a class=lnlinks href=#hl-70-8> 8</a>
</span><span class=lnt id=hl-70-9><a class=lnlinks href=#hl-70-9> 9</a>
</span><span class=lnt id=hl-70-10><a class=lnlinks href=#hl-70-10>10</a>
</span><span class=lnt id=hl-70-11><a class=lnlinks href=#hl-70-11>11</a>
</span><span class=lnt id=hl-70-12><a class=lnlinks href=#hl-70-12>12</a>
</span><span class=lnt id=hl-70-13><a class=lnlinks href=#hl-70-13>13</a>
</span><span class=lnt id=hl-70-14><a class=lnlinks href=#hl-70-14>14</a>
</span><span class=lnt id=hl-70-15><a class=lnlinks href=#hl-70-15>15</a>
</span><span class=lnt id=hl-70-16><a class=lnlinks href=#hl-70-16>16</a>
</span><span class=lnt id=hl-70-17><a class=lnlinks href=#hl-70-17>17</a>
</span><span class=lnt id=hl-70-18><a class=lnlinks href=#hl-70-18>18</a>
</span><span class=lnt id=hl-70-19><a class=lnlinks href=#hl-70-19>19</a>
</span><span class=lnt id=hl-70-20><a class=lnlinks href=#hl-70-20>20</a>
</span><span class=lnt id=hl-70-21><a class=lnlinks href=#hl-70-21>21</a>
</span><span class=lnt id=hl-70-22><a class=lnlinks href=#hl-70-22>22</a>
</span><span class=lnt id=hl-70-23><a class=lnlinks href=#hl-70-23>23</a>
</span><span class=lnt id=hl-70-24><a class=lnlinks href=#hl-70-24>24</a>
</span><span class=lnt id=hl-70-25><a class=lnlinks href=#hl-70-25>25</a>
</span><span class=lnt id=hl-70-26><a class=lnlinks href=#hl-70-26>26</a>
</span><span class=lnt id=hl-70-27><a class=lnlinks href=#hl-70-27>27</a>
</span><span class=lnt id=hl-70-28><a class=lnlinks href=#hl-70-28>28</a>
</span><span class=lnt id=hl-70-29><a class=lnlinks href=#hl-70-29>29</a>
</span><span class=lnt id=hl-70-30><a class=lnlinks href=#hl-70-30>30</a>
</span><span class=lnt id=hl-70-31><a class=lnlinks href=#hl-70-31>31</a>
</span><span class=lnt id=hl-70-32><a class=lnlinks href=#hl-70-32>32</a>
</span><span class=lnt id=hl-70-33><a class=lnlinks href=#hl-70-33>33</a>
</span><span class=lnt id=hl-70-34><a class=lnlinks href=#hl-70-34>34</a>
</span><span class=lnt id=hl-70-35><a class=lnlinks href=#hl-70-35>35</a>
</span><span class=lnt id=hl-70-36><a class=lnlinks href=#hl-70-36>36</a>
</span><span class=lnt id=hl-70-37><a class=lnlinks href=#hl-70-37>37</a>
</span><span class=lnt id=hl-70-38><a class=lnlinks href=#hl-70-38>38</a>
</span><span class=lnt id=hl-70-39><a class=lnlinks href=#hl-70-39>39</a>
</span><span class=lnt id=hl-70-40><a class=lnlinks href=#hl-70-40>40</a>
</span><span class=lnt id=hl-70-41><a class=lnlinks href=#hl-70-41>41</a>
</span><span class=lnt id=hl-70-42><a class=lnlinks href=#hl-70-42>42</a>
</span><span class=lnt id=hl-70-43><a class=lnlinks href=#hl-70-43>43</a>
</span><span class=lnt id=hl-70-44><a class=lnlinks href=#hl-70-44>44</a>
</span><span class=lnt id=hl-70-45><a class=lnlinks href=#hl-70-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 스냅샷 기반 집계 로딩</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotRepository</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>snapshot_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_aggregate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;스냅샷과 이후 이벤트를 결합하여 집계 로딩&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 최신 스냅샷 로드</span>
</span></span><span class=line><span class=cl>        <span class=n>snapshot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>get_latest_snapshot</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>snapshot</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>deserialize_aggregate</span><span class=p>(</span><span class=n>snapshot</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>from_version</span> <span class=o>=</span> <span class=n>snapshot</span><span class=o>.</span><span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>  <span class=c1># 새 집계 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>from_version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 스냅샷 이후 이벤트 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>from_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aggregate</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_aggregate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;집계 저장 및 스냅샷 생성 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 새 이벤트 저장</span>
</span></span><span class=line><span class=cl>        <span class=n>new_events</span> <span class=o>=</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span><span class=o>.</span><span class=n>version</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>new_events</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>new_events</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 스냅샷 생성 조건 확인 (예: 100개 이벤트마다)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate</span><span class=o>.</span><span class=n>version</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>snapshot_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>serialize_aggregate</span><span class=p>(</span><span class=n>aggregate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>save_snapshot</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>aggregate</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>aggregate</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>snapshot_data</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>aggregate</span><span class=o>.</span><span class=n>mark_events_as_committed</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th><th>적용 사례</th><th>장점</th><th>단점</th></tr></thead><tbody><tr><td><strong>저장 방식</strong></td><td><strong>단일 스트림</strong></td><td>모든 이벤트를 하나의 글로벌 스트림에 저장</td><td>간단한 도메인, 이벤트 순서가 중요한 시스템</td><td>구현 단순, 전역 순서 보장</td><td>확장성 제한, 동시성 문제</td></tr><tr><td></td><td><strong>집계별 스트림</strong></td><td>집계(Aggregate) 단위로 별도 스트림 관리</td><td>마이크로서비스, 복잡한 도메인</td><td>높은 동시성, 독립적 확장</td><td>글로벌 순서 보장 어려움</td></tr><tr><td><strong>일관성 모델</strong></td><td><strong>강한 일관성</strong></td><td>동기식 프로젝션 업데이트</td><td>금융 거래, 재고 관리</td><td>즉시 일관성, 단순한 에러 처리</td><td>성능 저하, 가용성 제한</td></tr><tr><td></td><td><strong>최종 일관성</strong></td><td>비동기식 프로젝션 업데이트</td><td>소셜 미디어, 콘텐츠 관리</td><td>높은 성능, 높은 가용성</td><td>복잡한 에러 처리, 일시적 불일치</td></tr><tr><td><strong>기술 스택</strong></td><td><strong>관계형 DB</strong></td><td>PostgreSQL, MySQL 등 활용</td><td>기존 인프라 활용, 중소 규모</td><td>기존 운영 노하우 활용, 트랜잭션 지원</td><td>확장성 제한, 스키마 경직성</td></tr><tr><td></td><td><strong>NoSQL DB</strong></td><td>MongoDB, Cassandra 등 활용</td><td>대규모 분산 시스템</td><td>높은 확장성, 유연한 스키마</td><td>일관성 모델 복잡, 새로운 운영 지식 필요</td></tr><tr><td></td><td><strong>전용 Event Store</strong></td><td>EventStore, Apache Kafka 활용</td><td>이벤트 중심 아키텍처</td><td>최적화된 성능, 풍부한 기능</td><td>새로운 기술 스택, 운영 복잡성</td></tr><tr><td><strong>도메인 적용 범위</strong></td><td><strong>전체 시스템</strong></td><td>시스템 전체를 이벤트 소싱으로 구축</td><td>새로운 프로젝트, 이벤트 중심 도메인</td><td>일관된 아키텍처, 최대 이익</td><td>높은 복잡성, 큰 변화</td></tr><tr><td></td><td><strong>부분 적용</strong></td><td>특정 도메인만 이벤트 소싱 적용</td><td>기존 시스템 확장, 점진적 도입</td><td>점진적 도입, 위험 최소화</td><td>하이브리드 복잡성, 제한적 이익</td></tr></tbody></table><h3 id=phase-4-구현-및-분류-2>Phase 4: 구현 및 분류<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-2>#</a></h3><h4 id=구현-기법-및-방법-1>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법-1>#</a></h4><ul><li>도메인 이벤트 설계: 주요 상태 변화를 이벤트 객체로 정의</li><li>이벤트 스토어 구현: MongoDB, PostgreSQL, EventStore 등 사용</li><li>CQRS 패턴 적용: Command와 Query 구조 분리</li><li>Snapshot 적용: 주기적 전체 상태 저장으로 성능 최적화</li></ul><h4 id=분류-기준에-따른-유형-구분-1>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분-1>#</a></h4><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>이벤트 저장 방식</td><td>Event Sourcing Only</td><td>이벤트만 저장, 현재 상태는 이벤트 Replay로만 도출</td></tr><tr><td>이벤트+Snapshot</td><td>Event Sourcing + Snapshot</td><td>주기적 전체상태 저장, Replay 성능 최적화</td></tr><tr><td>CQRS 적용</td><td>Event Sourcing+CQRS</td><td>변경/조회 분리, 이벤트 소싱과 별도 Read Model 운영</td></tr></tbody></table><hr><h3 id=phase-5-실무-적용-1>Phase 5: 실무 적용<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-1>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><ul><li>포트원 결제 시스템: 결제건 모든 변경 내역 이벤트로 저장, 정확한 상태 복원 및 감사 대응 강화.<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">4</a></li><li>금융, 이커머스, 게임 등 감사 및 트랜잭션 기록 요구 높은 분야.<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">2</a><a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">7</a></li><li>Microservices, 이벤트 기반 시스템에서 데이터 무결성과 동시성 확보.<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">5</a></li></ul><h4 id=실습-예제-및-코드-구현-1>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현-1>#</a></h4><p><strong>시나리오</strong>: 사용자가 장바구니에 상품을 추가/삭제하는 과정을 이벤트로 기록
<strong>시스템 구성</strong>:</p><ul><li>사용자 서비스, 이벤트 스토어, 조회용 DB</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[User Service] --&gt; B[Event Store]
    B --&gt; C[Read Model DB]
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 장바구니에 상품 추가/삭제</li><li>각 액션을 이벤트로 기록(카트 생성, 상품 추가/제거)</li><li>이벤트 스토어에 저장</li><li>이벤트를 순서대로 Replay하여 장바구니 현재 상태 도출</li></ol><p><strong>핵심 역할</strong>: 이벤트로 모든 상태 변경 이력 관리 및 복원</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 단순 CRUD 방식, 변경 이력 추적 불가</li><li>도입 후: 모든 변경 사항 이벤트 기반 관리, 과거 상태 복원 및 감사 가능</li></ul><p><strong>구현 예시 (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-72-1><a class=lnlinks href=#hl-72-1> 1</a>
</span><span class=lnt id=hl-72-2><a class=lnlinks href=#hl-72-2> 2</a>
</span><span class=lnt id=hl-72-3><a class=lnlinks href=#hl-72-3> 3</a>
</span><span class=lnt id=hl-72-4><a class=lnlinks href=#hl-72-4> 4</a>
</span><span class=lnt id=hl-72-5><a class=lnlinks href=#hl-72-5> 5</a>
</span><span class=lnt id=hl-72-6><a class=lnlinks href=#hl-72-6> 6</a>
</span><span class=lnt id=hl-72-7><a class=lnlinks href=#hl-72-7> 7</a>
</span><span class=lnt id=hl-72-8><a class=lnlinks href=#hl-72-8> 8</a>
</span><span class=lnt id=hl-72-9><a class=lnlinks href=#hl-72-9> 9</a>
</span><span class=lnt id=hl-72-10><a class=lnlinks href=#hl-72-10>10</a>
</span><span class=lnt id=hl-72-11><a class=lnlinks href=#hl-72-11>11</a>
</span><span class=lnt id=hl-72-12><a class=lnlinks href=#hl-72-12>12</a>
</span><span class=lnt id=hl-72-13><a class=lnlinks href=#hl-72-13>13</a>
</span><span class=lnt id=hl-72-14><a class=lnlinks href=#hl-72-14>14</a>
</span><span class=lnt id=hl-72-15><a class=lnlinks href=#hl-72-15>15</a>
</span><span class=lnt id=hl-72-16><a class=lnlinks href=#hl-72-16>16</a>
</span><span class=lnt id=hl-72-17><a class=lnlinks href=#hl-72-17>17</a>
</span><span class=lnt id=hl-72-18><a class=lnlinks href=#hl-72-18>18</a>
</span><span class=lnt id=hl-72-19><a class=lnlinks href=#hl-72-19>19</a>
</span><span class=lnt id=hl-72-20><a class=lnlinks href=#hl-72-20>20</a>
</span><span class=lnt id=hl-72-21><a class=lnlinks href=#hl-72-21>21</a>
</span><span class=lnt id=hl-72-22><a class=lnlinks href=#hl-72-22>22</a>
</span><span class=lnt id=hl-72-23><a class=lnlinks href=#hl-72-23>23</a>
</span><span class=lnt id=hl-72-24><a class=lnlinks href=#hl-72-24>24</a>
</span><span class=lnt id=hl-72-25><a class=lnlinks href=#hl-72-25>25</a>
</span><span class=lnt id=hl-72-26><a class=lnlinks href=#hl-72-26>26</a>
</span><span class=lnt id=hl-72-27><a class=lnlinks href=#hl-72-27>27</a>
</span><span class=lnt id=hl-72-28><a class=lnlinks href=#hl-72-28>28</a>
</span><span class=lnt id=hl-72-29><a class=lnlinks href=#hl-72-29>29</a>
</span><span class=lnt id=hl-72-30><a class=lnlinks href=#hl-72-30>30</a>
</span><span class=lnt id=hl-72-31><a class=lnlinks href=#hl-72-31>31</a>
</span><span class=lnt id=hl-72-32><a class=lnlinks href=#hl-72-32>32</a>
</span><span class=lnt id=hl-72-33><a class=lnlinks href=#hl-72-33>33</a>
</span><span class=lnt id=hl-72-34><a class=lnlinks href=#hl-72-34>34</a>
</span><span class=lnt id=hl-72-35><a class=lnlinks href=#hl-72-35>35</a>
</span><span class=lnt id=hl-72-36><a class=lnlinks href=#hl-72-36>36</a>
</span><span class=lnt id=hl-72-37><a class=lnlinks href=#hl-72-37>37</a>
</span><span class=lnt id=hl-72-38><a class=lnlinks href=#hl-72-38>38</a>
</span><span class=lnt id=hl-72-39><a class=lnlinks href=#hl-72-39>39</a>
</span><span class=lnt id=hl-72-40><a class=lnlinks href=#hl-72-40>40</a>
</span><span class=lnt id=hl-72-41><a class=lnlinks href=#hl-72-41>41</a>
</span><span class=lnt id=hl-72-42><a class=lnlinks href=#hl-72-42>42</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 카트에 대한 이벤트 생성과 처리 예제</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 소싱의 핵심: 상태 변화를 기록하는 이벤트 객체&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AddItemEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;상품 추가 이벤트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>item</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RemoveItemEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;상품 제거 이벤트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>item</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Cart</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;카트 상태는 이벤트 Replay로 도출&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 적용하여 상태 변경&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>AddItemEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>RemoveItemEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>replay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;저장된 모든 이벤트를 순서대로 적용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>cart</span> <span class=o>=</span> <span class=n>Cart</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cart</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s1>&#39;Kimchi&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>cart</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>RemoveItemEvent</span><span class=p>(</span><span class=s1>&#39;Kimchi&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cart</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>  <span class=c1># 이벤트 Replay 후 현재 상태</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현-포트원-예시>실제 도입 사례의 코드 구현 (포트원 예시)<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현-포트원-예시>#</a></h4><p><strong>시나리오</strong>: 결제 주문에 대한 모든 변경 이력을 이벤트로 저장
<strong>시스템 구성</strong>:</p><ul><li>결제 서비스, 이벤트 스토어, 조회용 DB, 이벤트 핸들러</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[Payment Service] --&gt; B[Event Store]
    B --&gt; C[Read Model DB]
    B --&gt; D[Snapshot Service]
</pre><p><strong>Workflow</strong>:</p><ol><li>결제 생성/승인/환불 등의 각 단계 이벤트 기록</li><li>이벤트 스토어에 저장</li><li>문의/장애 시 이벤트 Replay 또는 조회용 DB에서 상태 확인</li></ol><p><strong>핵심 역할</strong>: 모든 결제 상태 변경의 추적/복원/감사 기능 강화</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 변경 내역 로그 불명확, 감사/복구 곤란</li><li>도입 후: 이벤트 기반 이력 추적, 장애 복구 및 고객 문의 신속 대응</li></ul><p><strong>구현 예시 (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-74-1><a class=lnlinks href=#hl-74-1> 1</a>
</span><span class=lnt id=hl-74-2><a class=lnlinks href=#hl-74-2> 2</a>
</span><span class=lnt id=hl-74-3><a class=lnlinks href=#hl-74-3> 3</a>
</span><span class=lnt id=hl-74-4><a class=lnlinks href=#hl-74-4> 4</a>
</span><span class=lnt id=hl-74-5><a class=lnlinks href=#hl-74-5> 5</a>
</span><span class=lnt id=hl-74-6><a class=lnlinks href=#hl-74-6> 6</a>
</span><span class=lnt id=hl-74-7><a class=lnlinks href=#hl-74-7> 7</a>
</span><span class=lnt id=hl-74-8><a class=lnlinks href=#hl-74-8> 8</a>
</span><span class=lnt id=hl-74-9><a class=lnlinks href=#hl-74-9> 9</a>
</span><span class=lnt id=hl-74-10><a class=lnlinks href=#hl-74-10>10</a>
</span><span class=lnt id=hl-74-11><a class=lnlinks href=#hl-74-11>11</a>
</span><span class=lnt id=hl-74-12><a class=lnlinks href=#hl-74-12>12</a>
</span><span class=lnt id=hl-74-13><a class=lnlinks href=#hl-74-13>13</a>
</span><span class=lnt id=hl-74-14><a class=lnlinks href=#hl-74-14>14</a>
</span><span class=lnt id=hl-74-15><a class=lnlinks href=#hl-74-15>15</a>
</span><span class=lnt id=hl-74-16><a class=lnlinks href=#hl-74-16>16</a>
</span><span class=lnt id=hl-74-17><a class=lnlinks href=#hl-74-17>17</a>
</span><span class=lnt id=hl-74-18><a class=lnlinks href=#hl-74-18>18</a>
</span><span class=lnt id=hl-74-19><a class=lnlinks href=#hl-74-19>19</a>
</span><span class=lnt id=hl-74-20><a class=lnlinks href=#hl-74-20>20</a>
</span><span class=lnt id=hl-74-21><a class=lnlinks href=#hl-74-21>21</a>
</span><span class=lnt id=hl-74-22><a class=lnlinks href=#hl-74-22>22</a>
</span><span class=lnt id=hl-74-23><a class=lnlinks href=#hl-74-23>23</a>
</span><span class=lnt id=hl-74-24><a class=lnlinks href=#hl-74-24>24</a>
</span><span class=lnt id=hl-74-25><a class=lnlinks href=#hl-74-25>25</a>
</span><span class=lnt id=hl-74-26><a class=lnlinks href=#hl-74-26>26</a>
</span><span class=lnt id=hl-74-27><a class=lnlinks href=#hl-74-27>27</a>
</span><span class=lnt id=hl-74-28><a class=lnlinks href=#hl-74-28>28</a>
</span><span class=lnt id=hl-74-29><a class=lnlinks href=#hl-74-29>29</a>
</span><span class=lnt id=hl-74-30><a class=lnlinks href=#hl-74-30>30</a>
</span><span class=lnt id=hl-74-31><a class=lnlinks href=#hl-74-31>31</a>
</span><span class=lnt id=hl-74-32><a class=lnlinks href=#hl-74-32>32</a>
</span><span class=lnt id=hl-74-33><a class=lnlinks href=#hl-74-33>33</a>
</span><span class=lnt id=hl-74-34><a class=lnlinks href=#hl-74-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 결제 시스템 핵심 상태 변화를 이벤트로 관리</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 이벤트 기본 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentCreated</span><span class=p>(</span><span class=n>PaymentEvent</span><span class=p>):</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentApproved</span><span class=p>(</span><span class=n>PaymentEvent</span><span class=p>):</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentRefunded</span><span class=p>(</span><span class=n>PaymentEvent</span><span class=p>):</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentOrder</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제건 상태를 이벤트로 관리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;Created&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>PaymentEvent</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>PaymentEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>PaymentCreated</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;Created&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>PaymentApproved</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;Approved&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>PaymentRefunded</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;Refunded&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>replay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>PaymentEvent</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 예시 적용</span>
</span></span><span class=line><span class=cl><span class=n>order</span> <span class=o>=</span> <span class=n>PaymentOrder</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>order</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>PaymentCreated</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>order</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>PaymentApproved</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>state</span><span class=p>)</span>  <span class=c1># &#34;Approved&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=phase-5-실무-적용-practical-application-2>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application-2>#</a></h2><h3 id=실제-도입-사례-1>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-1>#</a></h3><h4 id=1-netflix의-분산-카운터-시스템>1. Netflix의 분산 카운터 시스템<a hidden class=anchor aria-hidden=true href=#1-netflix의-분산-카운터-시스템>#</a></h4><p><strong>조합 기술</strong>: Apache Kafka + Cassandra + 마이크로서비스
<strong>효과 분석</strong>:</p><ul><li>수십억 개의 이벤트 실시간 처리</li><li>99.99% 가용성 달성</li><li>지연 시간 10ms 이하 유지</li></ul><h4 id=2-은행의-거래-처리-시스템>2. 은행의 거래 처리 시스템<a hidden class=anchor aria-hidden=true href=#2-은행의-거래-처리-시스템>#</a></h4><p><strong>조합 기술</strong>: EventStore + .NET Core + SQL Server
<strong>효과 분석</strong>:</p><ul><li>100% 감사 추적 능력 확보</li><li>규제 요구사항 완벽 준수</li><li>사기 탐지 정확도 40% 향상</li></ul><h4 id=3-전자상거래의-주문-관리-시스템>3. 전자상거래의 주문 관리 시스템<a hidden class=anchor aria-hidden=true href=#3-전자상거래의-주문-관리-시스템>#</a></h4><p><strong>조합 기술</strong>: Kafka + Spring Boot + MongoDB
<strong>효과 분석</strong>:</p><ul><li>주문 처리 성능 3배 향상</li><li>재고 일관성 문제 90% 감소</li><li>새로운 기능 개발 시간 50% 단축</li></ul><h3 id=실습-예제-및-코드-구현-2>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현-2>#</a></h3><p><strong>시나리오</strong>: 온라인 쇼핑몰의 주문 관리 시스템
<strong>시스템 구성</strong>:</p><ul><li>Command Handler (주문 처리)</li><li>Event Store (PostgreSQL)</li><li>Projection Engine (주문 요약 뷰)</li><li>Event Bus (Redis Pub/Sub)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[웹 애플리케이션] --&gt; B[Order Command Handler]
    B --&gt; C[Order Aggregate]
    C --&gt; D[PostgreSQL Event Store]
    D --&gt; E[Redis Event Bus]
    E --&gt; F[Order Projection Handler]
    F --&gt; G[MongoDB Read Model]
    
    H[조회 API] --&gt; I[Query Handler]
    I --&gt; G
    
    D -.-&gt;|Event Replay| J[State Reconstruction]
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 주문 생성 요청</li><li>Command Handler가 비즈니스 로직 검증</li><li>Order Aggregate에서 OrderPlaced 이벤트 생성</li><li>Event Store에 이벤트 저장</li><li>Event Bus를 통해 이벤트 발행</li><li>Projection Handler가 읽기 모델 업데이트</li><li>조회 API가 최적화된 뷰 제공</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>주문 상태의 모든 변경사항을 이벤트로 추적</li><li>읽기와 쓰기 성능을 독립적으로 최적화</li><li>감사 추적과 디버깅 지원</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 주문 상태 변경 시 기존 데이터 덮어쓰기, 변경 이력 추적 불가</li><li><strong>도입 후</strong>: 모든 변경사항 보존, 시점별 상태 복원, 완벽한 감사 추적</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-76-1><a class=lnlinks href=#hl-76-1>  1</a>
</span><span class=lnt id=hl-76-2><a class=lnlinks href=#hl-76-2>  2</a>
</span><span class=lnt id=hl-76-3><a class=lnlinks href=#hl-76-3>  3</a>
</span><span class=lnt id=hl-76-4><a class=lnlinks href=#hl-76-4>  4</a>
</span><span class=lnt id=hl-76-5><a class=lnlinks href=#hl-76-5>  5</a>
</span><span class=lnt id=hl-76-6><a class=lnlinks href=#hl-76-6>  6</a>
</span><span class=lnt id=hl-76-7><a class=lnlinks href=#hl-76-7>  7</a>
</span><span class=lnt id=hl-76-8><a class=lnlinks href=#hl-76-8>  8</a>
</span><span class=lnt id=hl-76-9><a class=lnlinks href=#hl-76-9>  9</a>
</span><span class=lnt id=hl-76-10><a class=lnlinks href=#hl-76-10> 10</a>
</span><span class=lnt id=hl-76-11><a class=lnlinks href=#hl-76-11> 11</a>
</span><span class=lnt id=hl-76-12><a class=lnlinks href=#hl-76-12> 12</a>
</span><span class=lnt id=hl-76-13><a class=lnlinks href=#hl-76-13> 13</a>
</span><span class=lnt id=hl-76-14><a class=lnlinks href=#hl-76-14> 14</a>
</span><span class=lnt id=hl-76-15><a class=lnlinks href=#hl-76-15> 15</a>
</span><span class=lnt id=hl-76-16><a class=lnlinks href=#hl-76-16> 16</a>
</span><span class=lnt id=hl-76-17><a class=lnlinks href=#hl-76-17> 17</a>
</span><span class=lnt id=hl-76-18><a class=lnlinks href=#hl-76-18> 18</a>
</span><span class=lnt id=hl-76-19><a class=lnlinks href=#hl-76-19> 19</a>
</span><span class=lnt id=hl-76-20><a class=lnlinks href=#hl-76-20> 20</a>
</span><span class=lnt id=hl-76-21><a class=lnlinks href=#hl-76-21> 21</a>
</span><span class=lnt id=hl-76-22><a class=lnlinks href=#hl-76-22> 22</a>
</span><span class=lnt id=hl-76-23><a class=lnlinks href=#hl-76-23> 23</a>
</span><span class=lnt id=hl-76-24><a class=lnlinks href=#hl-76-24> 24</a>
</span><span class=lnt id=hl-76-25><a class=lnlinks href=#hl-76-25> 25</a>
</span><span class=lnt id=hl-76-26><a class=lnlinks href=#hl-76-26> 26</a>
</span><span class=lnt id=hl-76-27><a class=lnlinks href=#hl-76-27> 27</a>
</span><span class=lnt id=hl-76-28><a class=lnlinks href=#hl-76-28> 28</a>
</span><span class=lnt id=hl-76-29><a class=lnlinks href=#hl-76-29> 29</a>
</span><span class=lnt id=hl-76-30><a class=lnlinks href=#hl-76-30> 30</a>
</span><span class=lnt id=hl-76-31><a class=lnlinks href=#hl-76-31> 31</a>
</span><span class=lnt id=hl-76-32><a class=lnlinks href=#hl-76-32> 32</a>
</span><span class=lnt id=hl-76-33><a class=lnlinks href=#hl-76-33> 33</a>
</span><span class=lnt id=hl-76-34><a class=lnlinks href=#hl-76-34> 34</a>
</span><span class=lnt id=hl-76-35><a class=lnlinks href=#hl-76-35> 35</a>
</span><span class=lnt id=hl-76-36><a class=lnlinks href=#hl-76-36> 36</a>
</span><span class=lnt id=hl-76-37><a class=lnlinks href=#hl-76-37> 37</a>
</span><span class=lnt id=hl-76-38><a class=lnlinks href=#hl-76-38> 38</a>
</span><span class=lnt id=hl-76-39><a class=lnlinks href=#hl-76-39> 39</a>
</span><span class=lnt id=hl-76-40><a class=lnlinks href=#hl-76-40> 40</a>
</span><span class=lnt id=hl-76-41><a class=lnlinks href=#hl-76-41> 41</a>
</span><span class=lnt id=hl-76-42><a class=lnlinks href=#hl-76-42> 42</a>
</span><span class=lnt id=hl-76-43><a class=lnlinks href=#hl-76-43> 43</a>
</span><span class=lnt id=hl-76-44><a class=lnlinks href=#hl-76-44> 44</a>
</span><span class=lnt id=hl-76-45><a class=lnlinks href=#hl-76-45> 45</a>
</span><span class=lnt id=hl-76-46><a class=lnlinks href=#hl-76-46> 46</a>
</span><span class=lnt id=hl-76-47><a class=lnlinks href=#hl-76-47> 47</a>
</span><span class=lnt id=hl-76-48><a class=lnlinks href=#hl-76-48> 48</a>
</span><span class=lnt id=hl-76-49><a class=lnlinks href=#hl-76-49> 49</a>
</span><span class=lnt id=hl-76-50><a class=lnlinks href=#hl-76-50> 50</a>
</span><span class=lnt id=hl-76-51><a class=lnlinks href=#hl-76-51> 51</a>
</span><span class=lnt id=hl-76-52><a class=lnlinks href=#hl-76-52> 52</a>
</span><span class=lnt id=hl-76-53><a class=lnlinks href=#hl-76-53> 53</a>
</span><span class=lnt id=hl-76-54><a class=lnlinks href=#hl-76-54> 54</a>
</span><span class=lnt id=hl-76-55><a class=lnlinks href=#hl-76-55> 55</a>
</span><span class=lnt id=hl-76-56><a class=lnlinks href=#hl-76-56> 56</a>
</span><span class=lnt id=hl-76-57><a class=lnlinks href=#hl-76-57> 57</a>
</span><span class=lnt id=hl-76-58><a class=lnlinks href=#hl-76-58> 58</a>
</span><span class=lnt id=hl-76-59><a class=lnlinks href=#hl-76-59> 59</a>
</span><span class=lnt id=hl-76-60><a class=lnlinks href=#hl-76-60> 60</a>
</span><span class=lnt id=hl-76-61><a class=lnlinks href=#hl-76-61> 61</a>
</span><span class=lnt id=hl-76-62><a class=lnlinks href=#hl-76-62> 62</a>
</span><span class=lnt id=hl-76-63><a class=lnlinks href=#hl-76-63> 63</a>
</span><span class=lnt id=hl-76-64><a class=lnlinks href=#hl-76-64> 64</a>
</span><span class=lnt id=hl-76-65><a class=lnlinks href=#hl-76-65> 65</a>
</span><span class=lnt id=hl-76-66><a class=lnlinks href=#hl-76-66> 66</a>
</span><span class=lnt id=hl-76-67><a class=lnlinks href=#hl-76-67> 67</a>
</span><span class=lnt id=hl-76-68><a class=lnlinks href=#hl-76-68> 68</a>
</span><span class=lnt id=hl-76-69><a class=lnlinks href=#hl-76-69> 69</a>
</span><span class=lnt id=hl-76-70><a class=lnlinks href=#hl-76-70> 70</a>
</span><span class=lnt id=hl-76-71><a class=lnlinks href=#hl-76-71> 71</a>
</span><span class=lnt id=hl-76-72><a class=lnlinks href=#hl-76-72> 72</a>
</span><span class=lnt id=hl-76-73><a class=lnlinks href=#hl-76-73> 73</a>
</span><span class=lnt id=hl-76-74><a class=lnlinks href=#hl-76-74> 74</a>
</span><span class=lnt id=hl-76-75><a class=lnlinks href=#hl-76-75> 75</a>
</span><span class=lnt id=hl-76-76><a class=lnlinks href=#hl-76-76> 76</a>
</span><span class=lnt id=hl-76-77><a class=lnlinks href=#hl-76-77> 77</a>
</span><span class=lnt id=hl-76-78><a class=lnlinks href=#hl-76-78> 78</a>
</span><span class=lnt id=hl-76-79><a class=lnlinks href=#hl-76-79> 79</a>
</span><span class=lnt id=hl-76-80><a class=lnlinks href=#hl-76-80> 80</a>
</span><span class=lnt id=hl-76-81><a class=lnlinks href=#hl-76-81> 81</a>
</span><span class=lnt id=hl-76-82><a class=lnlinks href=#hl-76-82> 82</a>
</span><span class=lnt id=hl-76-83><a class=lnlinks href=#hl-76-83> 83</a>
</span><span class=lnt id=hl-76-84><a class=lnlinks href=#hl-76-84> 84</a>
</span><span class=lnt id=hl-76-85><a class=lnlinks href=#hl-76-85> 85</a>
</span><span class=lnt id=hl-76-86><a class=lnlinks href=#hl-76-86> 86</a>
</span><span class=lnt id=hl-76-87><a class=lnlinks href=#hl-76-87> 87</a>
</span><span class=lnt id=hl-76-88><a class=lnlinks href=#hl-76-88> 88</a>
</span><span class=lnt id=hl-76-89><a class=lnlinks href=#hl-76-89> 89</a>
</span><span class=lnt id=hl-76-90><a class=lnlinks href=#hl-76-90> 90</a>
</span><span class=lnt id=hl-76-91><a class=lnlinks href=#hl-76-91> 91</a>
</span><span class=lnt id=hl-76-92><a class=lnlinks href=#hl-76-92> 92</a>
</span><span class=lnt id=hl-76-93><a class=lnlinks href=#hl-76-93> 93</a>
</span><span class=lnt id=hl-76-94><a class=lnlinks href=#hl-76-94> 94</a>
</span><span class=lnt id=hl-76-95><a class=lnlinks href=#hl-76-95> 95</a>
</span><span class=lnt id=hl-76-96><a class=lnlinks href=#hl-76-96> 96</a>
</span><span class=lnt id=hl-76-97><a class=lnlinks href=#hl-76-97> 97</a>
</span><span class=lnt id=hl-76-98><a class=lnlinks href=#hl-76-98> 98</a>
</span><span class=lnt id=hl-76-99><a class=lnlinks href=#hl-76-99> 99</a>
</span><span class=lnt id=hl-76-100><a class=lnlinks href=#hl-76-100>100</a>
</span><span class=lnt id=hl-76-101><a class=lnlinks href=#hl-76-101>101</a>
</span><span class=lnt id=hl-76-102><a class=lnlinks href=#hl-76-102>102</a>
</span><span class=lnt id=hl-76-103><a class=lnlinks href=#hl-76-103>103</a>
</span><span class=lnt id=hl-76-104><a class=lnlinks href=#hl-76-104>104</a>
</span><span class=lnt id=hl-76-105><a class=lnlinks href=#hl-76-105>105</a>
</span><span class=lnt id=hl-76-106><a class=lnlinks href=#hl-76-106>106</a>
</span><span class=lnt id=hl-76-107><a class=lnlinks href=#hl-76-107>107</a>
</span><span class=lnt id=hl-76-108><a class=lnlinks href=#hl-76-108>108</a>
</span><span class=lnt id=hl-76-109><a class=lnlinks href=#hl-76-109>109</a>
</span><span class=lnt id=hl-76-110><a class=lnlinks href=#hl-76-110>110</a>
</span><span class=lnt id=hl-76-111><a class=lnlinks href=#hl-76-111>111</a>
</span><span class=lnt id=hl-76-112><a class=lnlinks href=#hl-76-112>112</a>
</span><span class=lnt id=hl-76-113><a class=lnlinks href=#hl-76-113>113</a>
</span><span class=lnt id=hl-76-114><a class=lnlinks href=#hl-76-114>114</a>
</span><span class=lnt id=hl-76-115><a class=lnlinks href=#hl-76-115>115</a>
</span><span class=lnt id=hl-76-116><a class=lnlinks href=#hl-76-116>116</a>
</span><span class=lnt id=hl-76-117><a class=lnlinks href=#hl-76-117>117</a>
</span><span class=lnt id=hl-76-118><a class=lnlinks href=#hl-76-118>118</a>
</span><span class=lnt id=hl-76-119><a class=lnlinks href=#hl-76-119>119</a>
</span><span class=lnt id=hl-76-120><a class=lnlinks href=#hl-76-120>120</a>
</span><span class=lnt id=hl-76-121><a class=lnlinks href=#hl-76-121>121</a>
</span><span class=lnt id=hl-76-122><a class=lnlinks href=#hl-76-122>122</a>
</span><span class=lnt id=hl-76-123><a class=lnlinks href=#hl-76-123>123</a>
</span><span class=lnt id=hl-76-124><a class=lnlinks href=#hl-76-124>124</a>
</span><span class=lnt id=hl-76-125><a class=lnlinks href=#hl-76-125>125</a>
</span><span class=lnt id=hl-76-126><a class=lnlinks href=#hl-76-126>126</a>
</span><span class=lnt id=hl-76-127><a class=lnlinks href=#hl-76-127>127</a>
</span><span class=lnt id=hl-76-128><a class=lnlinks href=#hl-76-128>128</a>
</span><span class=lnt id=hl-76-129><a class=lnlinks href=#hl-76-129>129</a>
</span><span class=lnt id=hl-76-130><a class=lnlinks href=#hl-76-130>130</a>
</span><span class=lnt id=hl-76-131><a class=lnlinks href=#hl-76-131>131</a>
</span><span class=lnt id=hl-76-132><a class=lnlinks href=#hl-76-132>132</a>
</span><span class=lnt id=hl-76-133><a class=lnlinks href=#hl-76-133>133</a>
</span><span class=lnt id=hl-76-134><a class=lnlinks href=#hl-76-134>134</a>
</span><span class=lnt id=hl-76-135><a class=lnlinks href=#hl-76-135>135</a>
</span><span class=lnt id=hl-76-136><a class=lnlinks href=#hl-76-136>136</a>
</span><span class=lnt id=hl-76-137><a class=lnlinks href=#hl-76-137>137</a>
</span><span class=lnt id=hl-76-138><a class=lnlinks href=#hl-76-138>138</a>
</span><span class=lnt id=hl-76-139><a class=lnlinks href=#hl-76-139>139</a>
</span><span class=lnt id=hl-76-140><a class=lnlinks href=#hl-76-140>140</a>
</span><span class=lnt id=hl-76-141><a class=lnlinks href=#hl-76-141>141</a>
</span><span class=lnt id=hl-76-142><a class=lnlinks href=#hl-76-142>142</a>
</span><span class=lnt id=hl-76-143><a class=lnlinks href=#hl-76-143>143</a>
</span><span class=lnt id=hl-76-144><a class=lnlinks href=#hl-76-144>144</a>
</span><span class=lnt id=hl-76-145><a class=lnlinks href=#hl-76-145>145</a>
</span><span class=lnt id=hl-76-146><a class=lnlinks href=#hl-76-146>146</a>
</span><span class=lnt id=hl-76-147><a class=lnlinks href=#hl-76-147>147</a>
</span><span class=lnt id=hl-76-148><a class=lnlinks href=#hl-76-148>148</a>
</span><span class=lnt id=hl-76-149><a class=lnlinks href=#hl-76-149>149</a>
</span><span class=lnt id=hl-76-150><a class=lnlinks href=#hl-76-150>150</a>
</span><span class=lnt id=hl-76-151><a class=lnlinks href=#hl-76-151>151</a>
</span><span class=lnt id=hl-76-152><a class=lnlinks href=#hl-76-152>152</a>
</span><span class=lnt id=hl-76-153><a class=lnlinks href=#hl-76-153>153</a>
</span><span class=lnt id=hl-76-154><a class=lnlinks href=#hl-76-154>154</a>
</span><span class=lnt id=hl-76-155><a class=lnlinks href=#hl-76-155>155</a>
</span><span class=lnt id=hl-76-156><a class=lnlinks href=#hl-76-156>156</a>
</span><span class=lnt id=hl-76-157><a class=lnlinks href=#hl-76-157>157</a>
</span><span class=lnt id=hl-76-158><a class=lnlinks href=#hl-76-158>158</a>
</span><span class=lnt id=hl-76-159><a class=lnlinks href=#hl-76-159>159</a>
</span><span class=lnt id=hl-76-160><a class=lnlinks href=#hl-76-160>160</a>
</span><span class=lnt id=hl-76-161><a class=lnlinks href=#hl-76-161>161</a>
</span><span class=lnt id=hl-76-162><a class=lnlinks href=#hl-76-162>162</a>
</span><span class=lnt id=hl-76-163><a class=lnlinks href=#hl-76-163>163</a>
</span><span class=lnt id=hl-76-164><a class=lnlinks href=#hl-76-164>164</a>
</span><span class=lnt id=hl-76-165><a class=lnlinks href=#hl-76-165>165</a>
</span><span class=lnt id=hl-76-166><a class=lnlinks href=#hl-76-166>166</a>
</span><span class=lnt id=hl-76-167><a class=lnlinks href=#hl-76-167>167</a>
</span><span class=lnt id=hl-76-168><a class=lnlinks href=#hl-76-168>168</a>
</span><span class=lnt id=hl-76-169><a class=lnlinks href=#hl-76-169>169</a>
</span><span class=lnt id=hl-76-170><a class=lnlinks href=#hl-76-170>170</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 집계 (Order Aggregate)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=n>order_id</span>  <span class=c1># 집계 식별자</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>    <span class=c1># 낙관적 동시성 제어를 위한 버전</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 저장되지 않은 이벤트 목록</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>place_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 비즈니스 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order already exists&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 규칙 검증</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>items</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>items</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order must have at least one item&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>total</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>price</span> <span class=o>*</span> <span class=n>item</span><span class=o>.</span><span class=n>quantity</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 도메인 이벤트 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderPlaced</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=o>=</span><span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>total_amount</span><span class=o>=</span><span class=n>total</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 적용 및 미커밋 목록에 추가</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>ship_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=s1>&#39;PLACED&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Cannot ship order in current status&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderShipped</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>tracking_number</span><span class=o>=</span><span class=n>tracking_number</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 집계에 적용하여 상태 변경&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderPlaced</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;PLACED&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>user_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>user_id</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>items</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>total_amount</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderShipped</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;SHIPPED&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>tracking_number</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>tracking_number</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderCancelled</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;CANCELLED&#39;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_uncommitted_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;저장되지 않은 이벤트 목록 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mark_events_as_committed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트가 저장되었음을 표시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command Handler 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>repository</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>repository</span> <span class=o>=</span> <span class=n>repository</span>  <span class=c1># Order Repository</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>    <span class=c1># Event Bus for publishing</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_place_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 새로운 주문 집계 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>place_order</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 집계 저장 (이벤트 저장소에 이벤트 저장)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>mark_events_as_committed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span><span class=o>.</span><span class=n>id</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_ship_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기존 주문 로드</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>get_by_id</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>ship_order</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>tracking_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 변경사항 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>mark_events_as_committed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Repository 구현 (Event Store 인터페이스)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderRepository</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_by_id</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 ID로 집계 로드 (이벤트 재생)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;집계의 미커밋 이벤트를 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>uncommitted_events</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>uncommitted_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>expected_version</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>version</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>uncommitted_events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>expected_version</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>uncommitted_events</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Bus 구현 (Redis 기반)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedisEventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 Redis 채널에 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;events.</span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;aggregate_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=vm>__dict__</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>channel</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;특정 이벤트 타입에 대한 핸들러 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;events.</span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>pubsub</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>pubsub</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>pubsub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=n>channel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>pubsub</span><span class=o>.</span><span class=n>listen</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;message&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=-실습-예제-스냅샷-적용-cart-시스템-python>🚀 실습 예제: 스냅샷 적용 Cart 시스템 (Python)<a hidden class=anchor aria-hidden=true href=#-실습-예제-스냅샷-적용-cart-시스템-python>#</a></h2><p><strong>시나리오</strong></p><ul><li>사용자의 장바구니(Cart) 변경 내역을 이벤트로 기록</li><li>이벤트 개수가 일정 기준(N) 이상이 되면 <strong>스냅샷</strong> 저장</li><li>시스템 재시작 시 스냅샷부터 상태를 복원 후 남은 이벤트만 재생</li></ul><p><strong>시스템 구성</strong></p><ul><li>Event Store (이벤트 저장소)</li><li>Snapshot Store (스냅샷 저장소)</li><li>Cart Aggregate (비즈니스 상태 객체)</li></ul><hr><h3 id=시스템-구성-다이어그램><strong>시스템 구성 다이어그램</strong><a hidden class=anchor aria-hidden=true href=#시스템-구성-다이어그램>#</a></h3><pre class=mermaid>graph TB
    User[사용자 요청] --&gt; CommandHandler[명령 처리기]
    CommandHandler --&gt; EventStore[Event Store]
    EventStore --&gt; SnapshotStore[Snapshot Store]
    SnapshotStore --&gt; Cart[Cart Aggregate]
    EventStore --&gt; Cart
</pre><hr><h3 id=workflow><strong>Workflow</strong><a hidden class=anchor aria-hidden=true href=#workflow>#</a></h3><ol><li>사용자가 장바구니에 상품 추가/삭제 요청</li><li>이벤트 생성 후 Event Store에 저장</li><li>누적 이벤트 개수가 설정된 임계값에 도달하면 Snapshot Store에 전체 상태 저장</li><li>복구 시 Snapshot 불러오고, 이후 이벤트만 Replay</li></ol><hr><h3 id=유무-차이><strong>유무 차이</strong><a hidden class=anchor aria-hidden=true href=#유무-차이>#</a></h3><ul><li><strong>스냅샷 미도입</strong>: 재시작 시 모든 이벤트를 처음부터 재생 → 느림</li><li><strong>스냅샷 도입</strong>: 스냅샷에서 복원 후 남은 이벤트만 재생 → 빠름</li></ul><hr><h3 id=구현-예시-python><strong>구현 예시 (Python)</strong><a hidden class=anchor aria-hidden=true href=#구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1>  1</a>
</span><span class=lnt id=hl-78-2><a class=lnlinks href=#hl-78-2>  2</a>
</span><span class=lnt id=hl-78-3><a class=lnlinks href=#hl-78-3>  3</a>
</span><span class=lnt id=hl-78-4><a class=lnlinks href=#hl-78-4>  4</a>
</span><span class=lnt id=hl-78-5><a class=lnlinks href=#hl-78-5>  5</a>
</span><span class=lnt id=hl-78-6><a class=lnlinks href=#hl-78-6>  6</a>
</span><span class=lnt id=hl-78-7><a class=lnlinks href=#hl-78-7>  7</a>
</span><span class=lnt id=hl-78-8><a class=lnlinks href=#hl-78-8>  8</a>
</span><span class=lnt id=hl-78-9><a class=lnlinks href=#hl-78-9>  9</a>
</span><span class=lnt id=hl-78-10><a class=lnlinks href=#hl-78-10> 10</a>
</span><span class=lnt id=hl-78-11><a class=lnlinks href=#hl-78-11> 11</a>
</span><span class=lnt id=hl-78-12><a class=lnlinks href=#hl-78-12> 12</a>
</span><span class=lnt id=hl-78-13><a class=lnlinks href=#hl-78-13> 13</a>
</span><span class=lnt id=hl-78-14><a class=lnlinks href=#hl-78-14> 14</a>
</span><span class=lnt id=hl-78-15><a class=lnlinks href=#hl-78-15> 15</a>
</span><span class=lnt id=hl-78-16><a class=lnlinks href=#hl-78-16> 16</a>
</span><span class=lnt id=hl-78-17><a class=lnlinks href=#hl-78-17> 17</a>
</span><span class=lnt id=hl-78-18><a class=lnlinks href=#hl-78-18> 18</a>
</span><span class=lnt id=hl-78-19><a class=lnlinks href=#hl-78-19> 19</a>
</span><span class=lnt id=hl-78-20><a class=lnlinks href=#hl-78-20> 20</a>
</span><span class=lnt id=hl-78-21><a class=lnlinks href=#hl-78-21> 21</a>
</span><span class=lnt id=hl-78-22><a class=lnlinks href=#hl-78-22> 22</a>
</span><span class=lnt id=hl-78-23><a class=lnlinks href=#hl-78-23> 23</a>
</span><span class=lnt id=hl-78-24><a class=lnlinks href=#hl-78-24> 24</a>
</span><span class=lnt id=hl-78-25><a class=lnlinks href=#hl-78-25> 25</a>
</span><span class=lnt id=hl-78-26><a class=lnlinks href=#hl-78-26> 26</a>
</span><span class=lnt id=hl-78-27><a class=lnlinks href=#hl-78-27> 27</a>
</span><span class=lnt id=hl-78-28><a class=lnlinks href=#hl-78-28> 28</a>
</span><span class=lnt id=hl-78-29><a class=lnlinks href=#hl-78-29> 29</a>
</span><span class=lnt id=hl-78-30><a class=lnlinks href=#hl-78-30> 30</a>
</span><span class=lnt id=hl-78-31><a class=lnlinks href=#hl-78-31> 31</a>
</span><span class=lnt id=hl-78-32><a class=lnlinks href=#hl-78-32> 32</a>
</span><span class=lnt id=hl-78-33><a class=lnlinks href=#hl-78-33> 33</a>
</span><span class=lnt id=hl-78-34><a class=lnlinks href=#hl-78-34> 34</a>
</span><span class=lnt id=hl-78-35><a class=lnlinks href=#hl-78-35> 35</a>
</span><span class=lnt id=hl-78-36><a class=lnlinks href=#hl-78-36> 36</a>
</span><span class=lnt id=hl-78-37><a class=lnlinks href=#hl-78-37> 37</a>
</span><span class=lnt id=hl-78-38><a class=lnlinks href=#hl-78-38> 38</a>
</span><span class=lnt id=hl-78-39><a class=lnlinks href=#hl-78-39> 39</a>
</span><span class=lnt id=hl-78-40><a class=lnlinks href=#hl-78-40> 40</a>
</span><span class=lnt id=hl-78-41><a class=lnlinks href=#hl-78-41> 41</a>
</span><span class=lnt id=hl-78-42><a class=lnlinks href=#hl-78-42> 42</a>
</span><span class=lnt id=hl-78-43><a class=lnlinks href=#hl-78-43> 43</a>
</span><span class=lnt id=hl-78-44><a class=lnlinks href=#hl-78-44> 44</a>
</span><span class=lnt id=hl-78-45><a class=lnlinks href=#hl-78-45> 45</a>
</span><span class=lnt id=hl-78-46><a class=lnlinks href=#hl-78-46> 46</a>
</span><span class=lnt id=hl-78-47><a class=lnlinks href=#hl-78-47> 47</a>
</span><span class=lnt id=hl-78-48><a class=lnlinks href=#hl-78-48> 48</a>
</span><span class=lnt id=hl-78-49><a class=lnlinks href=#hl-78-49> 49</a>
</span><span class=lnt id=hl-78-50><a class=lnlinks href=#hl-78-50> 50</a>
</span><span class=lnt id=hl-78-51><a class=lnlinks href=#hl-78-51> 51</a>
</span><span class=lnt id=hl-78-52><a class=lnlinks href=#hl-78-52> 52</a>
</span><span class=lnt id=hl-78-53><a class=lnlinks href=#hl-78-53> 53</a>
</span><span class=lnt id=hl-78-54><a class=lnlinks href=#hl-78-54> 54</a>
</span><span class=lnt id=hl-78-55><a class=lnlinks href=#hl-78-55> 55</a>
</span><span class=lnt id=hl-78-56><a class=lnlinks href=#hl-78-56> 56</a>
</span><span class=lnt id=hl-78-57><a class=lnlinks href=#hl-78-57> 57</a>
</span><span class=lnt id=hl-78-58><a class=lnlinks href=#hl-78-58> 58</a>
</span><span class=lnt id=hl-78-59><a class=lnlinks href=#hl-78-59> 59</a>
</span><span class=lnt id=hl-78-60><a class=lnlinks href=#hl-78-60> 60</a>
</span><span class=lnt id=hl-78-61><a class=lnlinks href=#hl-78-61> 61</a>
</span><span class=lnt id=hl-78-62><a class=lnlinks href=#hl-78-62> 62</a>
</span><span class=lnt id=hl-78-63><a class=lnlinks href=#hl-78-63> 63</a>
</span><span class=lnt id=hl-78-64><a class=lnlinks href=#hl-78-64> 64</a>
</span><span class=lnt id=hl-78-65><a class=lnlinks href=#hl-78-65> 65</a>
</span><span class=lnt id=hl-78-66><a class=lnlinks href=#hl-78-66> 66</a>
</span><span class=lnt id=hl-78-67><a class=lnlinks href=#hl-78-67> 67</a>
</span><span class=lnt id=hl-78-68><a class=lnlinks href=#hl-78-68> 68</a>
</span><span class=lnt id=hl-78-69><a class=lnlinks href=#hl-78-69> 69</a>
</span><span class=lnt id=hl-78-70><a class=lnlinks href=#hl-78-70> 70</a>
</span><span class=lnt id=hl-78-71><a class=lnlinks href=#hl-78-71> 71</a>
</span><span class=lnt id=hl-78-72><a class=lnlinks href=#hl-78-72> 72</a>
</span><span class=lnt id=hl-78-73><a class=lnlinks href=#hl-78-73> 73</a>
</span><span class=lnt id=hl-78-74><a class=lnlinks href=#hl-78-74> 74</a>
</span><span class=lnt id=hl-78-75><a class=lnlinks href=#hl-78-75> 75</a>
</span><span class=lnt id=hl-78-76><a class=lnlinks href=#hl-78-76> 76</a>
</span><span class=lnt id=hl-78-77><a class=lnlinks href=#hl-78-77> 77</a>
</span><span class=lnt id=hl-78-78><a class=lnlinks href=#hl-78-78> 78</a>
</span><span class=lnt id=hl-78-79><a class=lnlinks href=#hl-78-79> 79</a>
</span><span class=lnt id=hl-78-80><a class=lnlinks href=#hl-78-80> 80</a>
</span><span class=lnt id=hl-78-81><a class=lnlinks href=#hl-78-81> 81</a>
</span><span class=lnt id=hl-78-82><a class=lnlinks href=#hl-78-82> 82</a>
</span><span class=lnt id=hl-78-83><a class=lnlinks href=#hl-78-83> 83</a>
</span><span class=lnt id=hl-78-84><a class=lnlinks href=#hl-78-84> 84</a>
</span><span class=lnt id=hl-78-85><a class=lnlinks href=#hl-78-85> 85</a>
</span><span class=lnt id=hl-78-86><a class=lnlinks href=#hl-78-86> 86</a>
</span><span class=lnt id=hl-78-87><a class=lnlinks href=#hl-78-87> 87</a>
</span><span class=lnt id=hl-78-88><a class=lnlinks href=#hl-78-88> 88</a>
</span><span class=lnt id=hl-78-89><a class=lnlinks href=#hl-78-89> 89</a>
</span><span class=lnt id=hl-78-90><a class=lnlinks href=#hl-78-90> 90</a>
</span><span class=lnt id=hl-78-91><a class=lnlinks href=#hl-78-91> 91</a>
</span><span class=lnt id=hl-78-92><a class=lnlinks href=#hl-78-92> 92</a>
</span><span class=lnt id=hl-78-93><a class=lnlinks href=#hl-78-93> 93</a>
</span><span class=lnt id=hl-78-94><a class=lnlinks href=#hl-78-94> 94</a>
</span><span class=lnt id=hl-78-95><a class=lnlinks href=#hl-78-95> 95</a>
</span><span class=lnt id=hl-78-96><a class=lnlinks href=#hl-78-96> 96</a>
</span><span class=lnt id=hl-78-97><a class=lnlinks href=#hl-78-97> 97</a>
</span><span class=lnt id=hl-78-98><a class=lnlinks href=#hl-78-98> 98</a>
</span><span class=lnt id=hl-78-99><a class=lnlinks href=#hl-78-99> 99</a>
</span><span class=lnt id=hl-78-100><a class=lnlinks href=#hl-78-100>100</a>
</span><span class=lnt id=hl-78-101><a class=lnlinks href=#hl-78-101>101</a>
</span><span class=lnt id=hl-78-102><a class=lnlinks href=#hl-78-102>102</a>
</span><span class=lnt id=hl-78-103><a class=lnlinks href=#hl-78-103>103</a>
</span><span class=lnt id=hl-78-104><a class=lnlinks href=#hl-78-104>104</a>
</span><span class=lnt id=hl-78-105><a class=lnlinks href=#hl-78-105>105</a>
</span><span class=lnt id=hl-78-106><a class=lnlinks href=#hl-78-106>106</a>
</span><span class=lnt id=hl-78-107><a class=lnlinks href=#hl-78-107>107</a>
</span><span class=lnt id=hl-78-108><a class=lnlinks href=#hl-78-108>108</a>
</span><span class=lnt id=hl-78-109><a class=lnlinks href=#hl-78-109>109</a>
</span><span class=lnt id=hl-78-110><a class=lnlinks href=#hl-78-110>110</a>
</span><span class=lnt id=hl-78-111><a class=lnlinks href=#hl-78-111>111</a>
</span><span class=lnt id=hl-78-112><a class=lnlinks href=#hl-78-112>112</a>
</span><span class=lnt id=hl-78-113><a class=lnlinks href=#hl-78-113>113</a>
</span><span class=lnt id=hl-78-114><a class=lnlinks href=#hl-78-114>114</a>
</span><span class=lnt id=hl-78-115><a class=lnlinks href=#hl-78-115>115</a>
</span><span class=lnt id=hl-78-116><a class=lnlinks href=#hl-78-116>116</a>
</span><span class=lnt id=hl-78-117><a class=lnlinks href=#hl-78-117>117</a>
</span><span class=lnt id=hl-78-118><a class=lnlinks href=#hl-78-118>118</a>
</span><span class=lnt id=hl-78-119><a class=lnlinks href=#hl-78-119>119</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- 이벤트 정의 -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 소싱의 핵심: 상태 변화를 기록하는 불변 객체&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AddItemEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s2>&#34;ADD_ITEM&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>item</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RemoveItemEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s2>&#34;REMOVE_ITEM&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>item</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- 저장소 구현 -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 저장소 - 모든 상태 변화를 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events_since</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>index</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;지정 인덱스 이후의 이벤트 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>index</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;스냅샷 저장소 - 특정 시점의 전체 상태 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># key: 이벤트 인덱스</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>index</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Any</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>  <span class=c1># JSON 직렬화 저장</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_latest_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>latest_index</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>latest_index</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>latest_index</span><span class=p>])</span>  <span class=c1># JSON 역직렬화 반환</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- Cart Aggregate -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Cart</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Cart 상태는 이벤트 Replay 또는 Snapshot + Replay로 복원&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 적용하여 상태 변경&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;ADD_ITEM&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;REMOVE_ITEM&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_state</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- 서비스 로직 (핵심 비즈니스 + 스냅샷) -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CartService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SNAPSHOT_THRESHOLD</span> <span class=o>=</span> <span class=mi>5</span>  <span class=c1># N개 이벤트마다 스냅샷 저장</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>:</span> <span class=n>SnapshotStore</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>snapshot_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cart</span> <span class=o>=</span> <span class=n>Cart</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 스냅샷 조건 충족 시 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>events</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>SNAPSHOT_THRESHOLD</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>save_snapshot</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>events</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>get_state</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[스냅샷 저장] </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>events</span><span class=p>)</span><span class=si>}</span><span class=s2>개 이벤트 시점&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>restore_state</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;스냅샷 + 남은 이벤트로 상태 복원&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>last_snapshot_index</span><span class=p>,</span> <span class=n>snapshot_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>get_latest_snapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>snapshot_state</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>set_state</span><span class=p>(</span><span class=n>snapshot_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>start_index</span> <span class=o>=</span> <span class=n>last_snapshot_index</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>start_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>remaining_events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events_since</span><span class=p>(</span><span class=n>start_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>ev</span> <span class=ow>in</span> <span class=n>remaining_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>ev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[복원 완료] 총 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>remaining_events</span><span class=p>)</span><span class=si>}</span><span class=s2>개의 이벤트 재생&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- 테스트 시나리오 -----</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>SnapshotStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>service</span> <span class=o>=</span> <span class=n>CartService</span><span class=p>(</span><span class=n>event_store</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 발생</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;사과&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;바나나&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>RemoveItemEvent</span><span class=p>(</span><span class=s2>&#34;사과&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;키위&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;포도&#34;</span><span class=p>))</span>  <span class=c1># 여기서 스냅샷 저장</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;수박&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 상태 확인</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[현재 상태]&#34;</span><span class=p>,</span> <span class=n>service</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 복구 테스트</span>
</span></span><span class=line><span class=cl><span class=n>new_service</span> <span class=o>=</span> <span class=n>CartService</span><span class=p>(</span><span class=n>event_store</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>new_service</span><span class=o>.</span><span class=n>restore_state</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[복구된 상태]&#34;</span><span class=p>,</span> <span class=n>new_service</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=-코드-동작-설명>🔍 코드 동작 설명<a hidden class=anchor aria-hidden=true href=#-코드-동작-설명>#</a></h3><ol><li><strong>EventStore</strong>는 모든 이벤트를 순차 저장</li><li><strong>SnapshotStore</strong>는 설정한 개수(N)에 도달할 때마다 Cart 상태를 저장</li><li><strong>복원 시</strong><ul><li>가장 최근 스냅샷 불러옴</li><li>이후 이벤트만 재적용(Replaying)</li></ul></li><li>이렇게 하면 <strong>시스템 재기동이나 장애 복구가 훨씬 빨라짐</strong></li></ol><hr><h3 id=-실무-적용-팁>💡 실무 적용 팁<a hidden class=anchor aria-hidden=true href=#-실무-적용-팁>#</a></h3><ul><li>스냅샷 저장 주기는 <strong>도메인별 퍼포먼스 테스트를 통해 조율</strong>해야 함</li><li>장기적으로는 스냅샷 데이터를 파일/클라우드 객체 스토리지에 보관 가능</li><li>이벤트와 스냅샷은 항상 <strong>같은 트랜잭션 단위</strong>로 저장하는 것이 안정적</li></ul><hr><p>좋습니다. 이전 단계에서 <strong>스냅샷(Snapshot) 적용 단일 서비스 Cart 예제</strong>까지 완성했으니, 이번에는 그것을 한 단계 확장해 <strong>분산 환경에서 동작하는 Event Sourcing + Kafka 연계 예제</strong>를 구현해 드리겠습니다.<br>이렇게 하면 로컬에서만 동작하는 구조를 **마이크로서비스 기반(Event-Driven Architecture)**으로 확장하는 실무 감각을 잡을 수 있습니다.</p><hr><h2 id=-실습-예제-event-sourcing--kafka-연계-장바구니-서비스-확장>🚀 실습 예제: Event Sourcing + Kafka 연계 (장바구니 서비스 확장)<a hidden class=anchor aria-hidden=true href=#-실습-예제-event-sourcing--kafka-연계-장바구니-서비스-확장>#</a></h2><h3 id=시나리오><strong>시나리오</strong><a hidden class=anchor aria-hidden=true href=#시나리오>#</a></h3><ul><li>장바구니(Cart) 서비스에서 발생한 모든 이벤트를 Kafka 토픽으로 발행(Publish)</li><li>다른 서비스(예: Analytics 서비스, Notification 서비스)가 이를 구독(Subscribe)하여 실시간 반응</li><li>Cart 서비스 자체도 스냅샷을 적용해 성능 최적화</li></ul><hr><h3 id=시스템-구성><strong>시스템 구성</strong><a hidden class=anchor aria-hidden=true href=#시스템-구성>#</a></h3><ul><li>Cart Service (Event Sourcing + Snapshot + Kafka Producer)</li><li>Kafka Broker (메시지 브로커)</li><li>Analytics Service (Kafka Consumer → 통계 작성)</li><li>Event Store + Snapshot Store (저장소)</li></ul><hr><h3 id=구성-다이어그램><strong>구성 다이어그램</strong><a hidden class=anchor aria-hidden=true href=#구성-다이어그램>#</a></h3><pre class=mermaid>graph TB
    User[사용자 요청] --&gt; CartService[Cart Service]
    CartService --&gt; EventStore[Event Store]
    CartService --&gt; SnapshotStore[Snapshot Store]
    CartService -- 발행 --&gt; Kafka[(Kafka Broker)]
    Kafka -- 구독 --&gt; AnalyticsService[Analytics Service]
    Kafka -- 구독 --&gt; NotificationService[알림 서비스]
</pre><hr><h3 id=workflow-단계별-흐름><strong>Workflow (단계별 흐름)</strong><a hidden class=anchor aria-hidden=true href=#workflow-단계별-흐름>#</a></h3><ol><li>사용자가 Cart Service에 요청 → 이벤트 생성</li><li>이벤트를 Event Store에 저장 → 스냅샷 조건 충족 시 Snapshot Store에 저장</li><li>이벤트를 Kafka Topic으로 발행</li><li>Analytics Service가 Kafka 토픽을 구독하여 통계 데이터 생성</li><li>Notification Service가 Kafka 토픽을 구독하여 알림 전송</li></ol><hr><h3 id=구현-예시-python-kafka-python-라이브러리-사용><strong>구현 예시 (Python, kafka-python 라이브러리 사용)</strong><a hidden class=anchor aria-hidden=true href=#구현-예시-python-kafka-python-라이브러리-사용>#</a></h3><blockquote><p>이 예시는 <code>kafka-python</code>을 사용하므로, 실행 전 <code>pip install kafka-python</code> 필요<br>Kafka 로컬 실행(또는 Docker 환경)이 준비되어 있어야 합니다.</p></blockquote><h4 id=cart_servicepy-producer>cart_service.py (Producer)<a hidden class=anchor aria-hidden=true href=#cart_servicepy-producer>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-80-1><a class=lnlinks href=#hl-80-1> 1</a>
</span><span class=lnt id=hl-80-2><a class=lnlinks href=#hl-80-2> 2</a>
</span><span class=lnt id=hl-80-3><a class=lnlinks href=#hl-80-3> 3</a>
</span><span class=lnt id=hl-80-4><a class=lnlinks href=#hl-80-4> 4</a>
</span><span class=lnt id=hl-80-5><a class=lnlinks href=#hl-80-5> 5</a>
</span><span class=lnt id=hl-80-6><a class=lnlinks href=#hl-80-6> 6</a>
</span><span class=lnt id=hl-80-7><a class=lnlinks href=#hl-80-7> 7</a>
</span><span class=lnt id=hl-80-8><a class=lnlinks href=#hl-80-8> 8</a>
</span><span class=lnt id=hl-80-9><a class=lnlinks href=#hl-80-9> 9</a>
</span><span class=lnt id=hl-80-10><a class=lnlinks href=#hl-80-10>10</a>
</span><span class=lnt id=hl-80-11><a class=lnlinks href=#hl-80-11>11</a>
</span><span class=lnt id=hl-80-12><a class=lnlinks href=#hl-80-12>12</a>
</span><span class=lnt id=hl-80-13><a class=lnlinks href=#hl-80-13>13</a>
</span><span class=lnt id=hl-80-14><a class=lnlinks href=#hl-80-14>14</a>
</span><span class=lnt id=hl-80-15><a class=lnlinks href=#hl-80-15>15</a>
</span><span class=lnt id=hl-80-16><a class=lnlinks href=#hl-80-16>16</a>
</span><span class=lnt id=hl-80-17><a class=lnlinks href=#hl-80-17>17</a>
</span><span class=lnt id=hl-80-18><a class=lnlinks href=#hl-80-18>18</a>
</span><span class=lnt id=hl-80-19><a class=lnlinks href=#hl-80-19>19</a>
</span><span class=lnt id=hl-80-20><a class=lnlinks href=#hl-80-20>20</a>
</span><span class=lnt id=hl-80-21><a class=lnlinks href=#hl-80-21>21</a>
</span><span class=lnt id=hl-80-22><a class=lnlinks href=#hl-80-22>22</a>
</span><span class=lnt id=hl-80-23><a class=lnlinks href=#hl-80-23>23</a>
</span><span class=lnt id=hl-80-24><a class=lnlinks href=#hl-80-24>24</a>
</span><span class=lnt id=hl-80-25><a class=lnlinks href=#hl-80-25>25</a>
</span><span class=lnt id=hl-80-26><a class=lnlinks href=#hl-80-26>26</a>
</span><span class=lnt id=hl-80-27><a class=lnlinks href=#hl-80-27>27</a>
</span><span class=lnt id=hl-80-28><a class=lnlinks href=#hl-80-28>28</a>
</span><span class=lnt id=hl-80-29><a class=lnlinks href=#hl-80-29>29</a>
</span><span class=lnt id=hl-80-30><a class=lnlinks href=#hl-80-30>30</a>
</span><span class=lnt id=hl-80-31><a class=lnlinks href=#hl-80-31>31</a>
</span><span class=lnt id=hl-80-32><a class=lnlinks href=#hl-80-32>32</a>
</span><span class=lnt id=hl-80-33><a class=lnlinks href=#hl-80-33>33</a>
</span><span class=lnt id=hl-80-34><a class=lnlinks href=#hl-80-34>34</a>
</span><span class=lnt id=hl-80-35><a class=lnlinks href=#hl-80-35>35</a>
</span><span class=lnt id=hl-80-36><a class=lnlinks href=#hl-80-36>36</a>
</span><span class=lnt id=hl-80-37><a class=lnlinks href=#hl-80-37>37</a>
</span><span class=lnt id=hl-80-38><a class=lnlinks href=#hl-80-38>38</a>
</span><span class=lnt id=hl-80-39><a class=lnlinks href=#hl-80-39>39</a>
</span><span class=lnt id=hl-80-40><a class=lnlinks href=#hl-80-40>40</a>
</span><span class=lnt id=hl-80-41><a class=lnlinks href=#hl-80-41>41</a>
</span><span class=lnt id=hl-80-42><a class=lnlinks href=#hl-80-42>42</a>
</span><span class=lnt id=hl-80-43><a class=lnlinks href=#hl-80-43>43</a>
</span><span class=lnt id=hl-80-44><a class=lnlinks href=#hl-80-44>44</a>
</span><span class=lnt id=hl-80-45><a class=lnlinks href=#hl-80-45>45</a>
</span><span class=lnt id=hl-80-46><a class=lnlinks href=#hl-80-46>46</a>
</span><span class=lnt id=hl-80-47><a class=lnlinks href=#hl-80-47>47</a>
</span><span class=lnt id=hl-80-48><a class=lnlinks href=#hl-80-48>48</a>
</span><span class=lnt id=hl-80-49><a class=lnlinks href=#hl-80-49>49</a>
</span><span class=lnt id=hl-80-50><a class=lnlinks href=#hl-80-50>50</a>
</span><span class=lnt id=hl-80-51><a class=lnlinks href=#hl-80-51>51</a>
</span><span class=lnt id=hl-80-52><a class=lnlinks href=#hl-80-52>52</a>
</span><span class=lnt id=hl-80-53><a class=lnlinks href=#hl-80-53>53</a>
</span><span class=lnt id=hl-80-54><a class=lnlinks href=#hl-80-54>54</a>
</span><span class=lnt id=hl-80-55><a class=lnlinks href=#hl-80-55>55</a>
</span><span class=lnt id=hl-80-56><a class=lnlinks href=#hl-80-56>56</a>
</span><span class=lnt id=hl-80-57><a class=lnlinks href=#hl-80-57>57</a>
</span><span class=lnt id=hl-80-58><a class=lnlinks href=#hl-80-58>58</a>
</span><span class=lnt id=hl-80-59><a class=lnlinks href=#hl-80-59>59</a>
</span><span class=lnt id=hl-80-60><a class=lnlinks href=#hl-80-60>60</a>
</span><span class=lnt id=hl-80-61><a class=lnlinks href=#hl-80-61>61</a>
</span><span class=lnt id=hl-80-62><a class=lnlinks href=#hl-80-62>62</a>
</span><span class=lnt id=hl-80-63><a class=lnlinks href=#hl-80-63>63</a>
</span><span class=lnt id=hl-80-64><a class=lnlinks href=#hl-80-64>64</a>
</span><span class=lnt id=hl-80-65><a class=lnlinks href=#hl-80-65>65</a>
</span><span class=lnt id=hl-80-66><a class=lnlinks href=#hl-80-66>66</a>
</span><span class=lnt id=hl-80-67><a class=lnlinks href=#hl-80-67>67</a>
</span><span class=lnt id=hl-80-68><a class=lnlinks href=#hl-80-68>68</a>
</span><span class=lnt id=hl-80-69><a class=lnlinks href=#hl-80-69>69</a>
</span><span class=lnt id=hl-80-70><a class=lnlinks href=#hl-80-70>70</a>
</span><span class=lnt id=hl-80-71><a class=lnlinks href=#hl-80-71>71</a>
</span><span class=lnt id=hl-80-72><a class=lnlinks href=#hl-80-72>72</a>
</span><span class=lnt id=hl-80-73><a class=lnlinks href=#hl-80-73>73</a>
</span><span class=lnt id=hl-80-74><a class=lnlinks href=#hl-80-74>74</a>
</span><span class=lnt id=hl-80-75><a class=lnlinks href=#hl-80-75>75</a>
</span><span class=lnt id=hl-80-76><a class=lnlinks href=#hl-80-76>76</a>
</span><span class=lnt id=hl-80-77><a class=lnlinks href=#hl-80-77>77</a>
</span><span class=lnt id=hl-80-78><a class=lnlinks href=#hl-80-78>78</a>
</span><span class=lnt id=hl-80-79><a class=lnlinks href=#hl-80-79>79</a>
</span><span class=lnt id=hl-80-80><a class=lnlinks href=#hl-80-80>80</a>
</span><span class=lnt id=hl-80-81><a class=lnlinks href=#hl-80-81>81</a>
</span><span class=lnt id=hl-80-82><a class=lnlinks href=#hl-80-82>82</a>
</span><span class=lnt id=hl-80-83><a class=lnlinks href=#hl-80-83>83</a>
</span><span class=lnt id=hl-80-84><a class=lnlinks href=#hl-80-84>84</a>
</span><span class=lnt id=hl-80-85><a class=lnlinks href=#hl-80-85>85</a>
</span><span class=lnt id=hl-80-86><a class=lnlinks href=#hl-80-86>86</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- 이벤트 정의 -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AddItemEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s2>&#34;ADD_ITEM&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>item</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RemoveItemEvent</span><span class=p>(</span><span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s2>&#34;REMOVE_ITEM&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>item</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- 저장소 -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Event</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>index</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_latest_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>idx</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>idx</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- Cart Aggregate -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Cart</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;ADD_ITEM&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;REMOVE_ITEM&#34;</span> <span class=ow>and</span> <span class=n>event</span><span class=o>.</span><span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_state</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----- Cart Service -----</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CartService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SNAPSHOT_THRESHOLD</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cart</span> <span class=o>=</span> <span class=n>Cart</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>snapshot_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Kafka 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;cart-events&#39;</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Kafka 발행] </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>to_dict</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 스냅샷 조건 검사</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>events</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>SNAPSHOT_THRESHOLD</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>save_snapshot</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>events</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>get_state</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[스냅샷 저장] </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>cart</span><span class=o>.</span><span class=n>get_state</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테스트 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>SnapshotStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>service</span> <span class=o>=</span> <span class=n>CartService</span><span class=p>(</span><span class=n>event_store</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;사과&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;바나나&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>RemoveItemEvent</span><span class=p>(</span><span class=s2>&#34;사과&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;키위&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>service</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>AddItemEvent</span><span class=p>(</span><span class=s2>&#34;포도&#34;</span><span class=p>))</span>   <span class=c1># 스냅샷 저장 시점</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=analytics_servicepy-consumer>analytics_service.py (Consumer)<a hidden class=anchor aria-hidden=true href=#analytics_servicepy-consumer>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-81-1><a class=lnlinks href=#hl-81-1> 1</a>
</span><span class=lnt id=hl-81-2><a class=lnlinks href=#hl-81-2> 2</a>
</span><span class=lnt id=hl-81-3><a class=lnlinks href=#hl-81-3> 3</a>
</span><span class=lnt id=hl-81-4><a class=lnlinks href=#hl-81-4> 4</a>
</span><span class=lnt id=hl-81-5><a class=lnlinks href=#hl-81-5> 5</a>
</span><span class=lnt id=hl-81-6><a class=lnlinks href=#hl-81-6> 6</a>
</span><span class=lnt id=hl-81-7><a class=lnlinks href=#hl-81-7> 7</a>
</span><span class=lnt id=hl-81-8><a class=lnlinks href=#hl-81-8> 8</a>
</span><span class=lnt id=hl-81-9><a class=lnlinks href=#hl-81-9> 9</a>
</span><span class=lnt id=hl-81-10><a class=lnlinks href=#hl-81-10>10</a>
</span><span class=lnt id=hl-81-11><a class=lnlinks href=#hl-81-11>11</a>
</span><span class=lnt id=hl-81-12><a class=lnlinks href=#hl-81-12>12</a>
</span><span class=lnt id=hl-81-13><a class=lnlinks href=#hl-81-13>13</a>
</span><span class=lnt id=hl-81-14><a class=lnlinks href=#hl-81-14>14</a>
</span><span class=lnt id=hl-81-15><a class=lnlinks href=#hl-81-15>15</a>
</span><span class=lnt id=hl-81-16><a class=lnlinks href=#hl-81-16>16</a>
</span><span class=lnt id=hl-81-17><a class=lnlinks href=#hl-81-17>17</a>
</span><span class=lnt id=hl-81-18><a class=lnlinks href=#hl-81-18>18</a>
</span><span class=lnt id=hl-81-19><a class=lnlinks href=#hl-81-19>19</a>
</span><span class=lnt id=hl-81-20><a class=lnlinks href=#hl-81-20>20</a>
</span><span class=lnt id=hl-81-21><a class=lnlinks href=#hl-81-21>21</a>
</span><span class=lnt id=hl-81-22><a class=lnlinks href=#hl-81-22>22</a>
</span><span class=lnt id=hl-81-23><a class=lnlinks href=#hl-81-23>23</a>
</span><span class=lnt id=hl-81-24><a class=lnlinks href=#hl-81-24>24</a>
</span><span class=lnt id=hl-81-25><a class=lnlinks href=#hl-81-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;cart-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;analytics-service&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[Analytics] Kafka 구독 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>item_counts</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;ADD_ITEM&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;item&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>item_counts</span><span class=p>[</span><span class=n>item</span><span class=p>]</span> <span class=o>=</span> <span class=n>item_counts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;REMOVE_ITEM&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;item&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>item_counts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>item_counts</span><span class=p>[</span><span class=n>item</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>item_counts</span><span class=p>[</span><span class=n>item</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=n>item_counts</span><span class=p>[</span><span class=n>item</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[Analytics] 현재 집계:&#34;</span><span class=p>,</span> <span class=n>item_counts</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=포인트><strong>포인트</strong><a hidden class=anchor aria-hidden=true href=#포인트>#</a></h3><ul><li>Cart Service는 이벤트를 <strong>Event Store + Snapshot Store + Kafka</strong>에 동시에 반영</li><li>Kafka Producer → 다른 서비스가 실시간 반응 가능</li><li>Consumer 서비스(Analytics, Notification 등)가 비즈니스 확장 가능</li><li>운영 환경에서는 <strong>Kafka 파티션 키</strong>를 Aggregate ID로 설정하여 이벤트 순서 보장</li></ul><h3 id=실제-도입-사례의-코드-구현-1>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현-1>#</a></h3><p><strong>시나리오</strong>: Netflix의 실시간 시청 데이터 처리 시스템
<strong>시스템 구성</strong>:</p><ul><li>Kafka Event Streams</li><li>Cassandra Event Store</li><li>실시간 집계 서비스</li><li>사용자 추천 엔진</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[Video Player] --&gt; B[Viewing Event Producer]
    B --&gt; C[Kafka Topics]
    C --&gt; D[Stream Processing]
    D --&gt; E[Cassandra Rollup Store]
    C --&gt; F[Real-time Analytics]
    F --&gt; G[Recommendation Engine]
    
    H[User Query] --&gt; I[Aggregation Service]
    I --&gt; E
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 비디오 시청 이벤트 발생</li><li>Kafka로 실시간 스트리밍</li><li>스트림 처리를 통한 실시간 집계</li><li>Cassandra에 시간 윈도우별 롤업 데이터 저장</li><li>추천 엔진이 실시간 데이터 소비</li><li>사용자별 맞춤 추천 제공</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>초당 수백만 개의 시청 이벤트 처리</li><li>실시간 사용자 행동 분석</li><li>개인화된 콘텐츠 추천</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 배치 처리로 인한 24시간 지연, 부정확한 추천</li><li><strong>도입 후</strong>: 실시간 추천, 사용자 경험 개선, 시청률 20% 증가</li></ul><p><strong>구현 예시</strong> (Java + Kafka Streams):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-83-1><a class=lnlinks href=#hl-83-1>  1</a>
</span><span class=lnt id=hl-83-2><a class=lnlinks href=#hl-83-2>  2</a>
</span><span class=lnt id=hl-83-3><a class=lnlinks href=#hl-83-3>  3</a>
</span><span class=lnt id=hl-83-4><a class=lnlinks href=#hl-83-4>  4</a>
</span><span class=lnt id=hl-83-5><a class=lnlinks href=#hl-83-5>  5</a>
</span><span class=lnt id=hl-83-6><a class=lnlinks href=#hl-83-6>  6</a>
</span><span class=lnt id=hl-83-7><a class=lnlinks href=#hl-83-7>  7</a>
</span><span class=lnt id=hl-83-8><a class=lnlinks href=#hl-83-8>  8</a>
</span><span class=lnt id=hl-83-9><a class=lnlinks href=#hl-83-9>  9</a>
</span><span class=lnt id=hl-83-10><a class=lnlinks href=#hl-83-10> 10</a>
</span><span class=lnt id=hl-83-11><a class=lnlinks href=#hl-83-11> 11</a>
</span><span class=lnt id=hl-83-12><a class=lnlinks href=#hl-83-12> 12</a>
</span><span class=lnt id=hl-83-13><a class=lnlinks href=#hl-83-13> 13</a>
</span><span class=lnt id=hl-83-14><a class=lnlinks href=#hl-83-14> 14</a>
</span><span class=lnt id=hl-83-15><a class=lnlinks href=#hl-83-15> 15</a>
</span><span class=lnt id=hl-83-16><a class=lnlinks href=#hl-83-16> 16</a>
</span><span class=lnt id=hl-83-17><a class=lnlinks href=#hl-83-17> 17</a>
</span><span class=lnt id=hl-83-18><a class=lnlinks href=#hl-83-18> 18</a>
</span><span class=lnt id=hl-83-19><a class=lnlinks href=#hl-83-19> 19</a>
</span><span class=lnt id=hl-83-20><a class=lnlinks href=#hl-83-20> 20</a>
</span><span class=lnt id=hl-83-21><a class=lnlinks href=#hl-83-21> 21</a>
</span><span class=lnt id=hl-83-22><a class=lnlinks href=#hl-83-22> 22</a>
</span><span class=lnt id=hl-83-23><a class=lnlinks href=#hl-83-23> 23</a>
</span><span class=lnt id=hl-83-24><a class=lnlinks href=#hl-83-24> 24</a>
</span><span class=lnt id=hl-83-25><a class=lnlinks href=#hl-83-25> 25</a>
</span><span class=lnt id=hl-83-26><a class=lnlinks href=#hl-83-26> 26</a>
</span><span class=lnt id=hl-83-27><a class=lnlinks href=#hl-83-27> 27</a>
</span><span class=lnt id=hl-83-28><a class=lnlinks href=#hl-83-28> 28</a>
</span><span class=lnt id=hl-83-29><a class=lnlinks href=#hl-83-29> 29</a>
</span><span class=lnt id=hl-83-30><a class=lnlinks href=#hl-83-30> 30</a>
</span><span class=lnt id=hl-83-31><a class=lnlinks href=#hl-83-31> 31</a>
</span><span class=lnt id=hl-83-32><a class=lnlinks href=#hl-83-32> 32</a>
</span><span class=lnt id=hl-83-33><a class=lnlinks href=#hl-83-33> 33</a>
</span><span class=lnt id=hl-83-34><a class=lnlinks href=#hl-83-34> 34</a>
</span><span class=lnt id=hl-83-35><a class=lnlinks href=#hl-83-35> 35</a>
</span><span class=lnt id=hl-83-36><a class=lnlinks href=#hl-83-36> 36</a>
</span><span class=lnt id=hl-83-37><a class=lnlinks href=#hl-83-37> 37</a>
</span><span class=lnt id=hl-83-38><a class=lnlinks href=#hl-83-38> 38</a>
</span><span class=lnt id=hl-83-39><a class=lnlinks href=#hl-83-39> 39</a>
</span><span class=lnt id=hl-83-40><a class=lnlinks href=#hl-83-40> 40</a>
</span><span class=lnt id=hl-83-41><a class=lnlinks href=#hl-83-41> 41</a>
</span><span class=lnt id=hl-83-42><a class=lnlinks href=#hl-83-42> 42</a>
</span><span class=lnt id=hl-83-43><a class=lnlinks href=#hl-83-43> 43</a>
</span><span class=lnt id=hl-83-44><a class=lnlinks href=#hl-83-44> 44</a>
</span><span class=lnt id=hl-83-45><a class=lnlinks href=#hl-83-45> 45</a>
</span><span class=lnt id=hl-83-46><a class=lnlinks href=#hl-83-46> 46</a>
</span><span class=lnt id=hl-83-47><a class=lnlinks href=#hl-83-47> 47</a>
</span><span class=lnt id=hl-83-48><a class=lnlinks href=#hl-83-48> 48</a>
</span><span class=lnt id=hl-83-49><a class=lnlinks href=#hl-83-49> 49</a>
</span><span class=lnt id=hl-83-50><a class=lnlinks href=#hl-83-50> 50</a>
</span><span class=lnt id=hl-83-51><a class=lnlinks href=#hl-83-51> 51</a>
</span><span class=lnt id=hl-83-52><a class=lnlinks href=#hl-83-52> 52</a>
</span><span class=lnt id=hl-83-53><a class=lnlinks href=#hl-83-53> 53</a>
</span><span class=lnt id=hl-83-54><a class=lnlinks href=#hl-83-54> 54</a>
</span><span class=lnt id=hl-83-55><a class=lnlinks href=#hl-83-55> 55</a>
</span><span class=lnt id=hl-83-56><a class=lnlinks href=#hl-83-56> 56</a>
</span><span class=lnt id=hl-83-57><a class=lnlinks href=#hl-83-57> 57</a>
</span><span class=lnt id=hl-83-58><a class=lnlinks href=#hl-83-58> 58</a>
</span><span class=lnt id=hl-83-59><a class=lnlinks href=#hl-83-59> 59</a>
</span><span class=lnt id=hl-83-60><a class=lnlinks href=#hl-83-60> 60</a>
</span><span class=lnt id=hl-83-61><a class=lnlinks href=#hl-83-61> 61</a>
</span><span class=lnt id=hl-83-62><a class=lnlinks href=#hl-83-62> 62</a>
</span><span class=lnt id=hl-83-63><a class=lnlinks href=#hl-83-63> 63</a>
</span><span class=lnt id=hl-83-64><a class=lnlinks href=#hl-83-64> 64</a>
</span><span class=lnt id=hl-83-65><a class=lnlinks href=#hl-83-65> 65</a>
</span><span class=lnt id=hl-83-66><a class=lnlinks href=#hl-83-66> 66</a>
</span><span class=lnt id=hl-83-67><a class=lnlinks href=#hl-83-67> 67</a>
</span><span class=lnt id=hl-83-68><a class=lnlinks href=#hl-83-68> 68</a>
</span><span class=lnt id=hl-83-69><a class=lnlinks href=#hl-83-69> 69</a>
</span><span class=lnt id=hl-83-70><a class=lnlinks href=#hl-83-70> 70</a>
</span><span class=lnt id=hl-83-71><a class=lnlinks href=#hl-83-71> 71</a>
</span><span class=lnt id=hl-83-72><a class=lnlinks href=#hl-83-72> 72</a>
</span><span class=lnt id=hl-83-73><a class=lnlinks href=#hl-83-73> 73</a>
</span><span class=lnt id=hl-83-74><a class=lnlinks href=#hl-83-74> 74</a>
</span><span class=lnt id=hl-83-75><a class=lnlinks href=#hl-83-75> 75</a>
</span><span class=lnt id=hl-83-76><a class=lnlinks href=#hl-83-76> 76</a>
</span><span class=lnt id=hl-83-77><a class=lnlinks href=#hl-83-77> 77</a>
</span><span class=lnt id=hl-83-78><a class=lnlinks href=#hl-83-78> 78</a>
</span><span class=lnt id=hl-83-79><a class=lnlinks href=#hl-83-79> 79</a>
</span><span class=lnt id=hl-83-80><a class=lnlinks href=#hl-83-80> 80</a>
</span><span class=lnt id=hl-83-81><a class=lnlinks href=#hl-83-81> 81</a>
</span><span class=lnt id=hl-83-82><a class=lnlinks href=#hl-83-82> 82</a>
</span><span class=lnt id=hl-83-83><a class=lnlinks href=#hl-83-83> 83</a>
</span><span class=lnt id=hl-83-84><a class=lnlinks href=#hl-83-84> 84</a>
</span><span class=lnt id=hl-83-85><a class=lnlinks href=#hl-83-85> 85</a>
</span><span class=lnt id=hl-83-86><a class=lnlinks href=#hl-83-86> 86</a>
</span><span class=lnt id=hl-83-87><a class=lnlinks href=#hl-83-87> 87</a>
</span><span class=lnt id=hl-83-88><a class=lnlinks href=#hl-83-88> 88</a>
</span><span class=lnt id=hl-83-89><a class=lnlinks href=#hl-83-89> 89</a>
</span><span class=lnt id=hl-83-90><a class=lnlinks href=#hl-83-90> 90</a>
</span><span class=lnt id=hl-83-91><a class=lnlinks href=#hl-83-91> 91</a>
</span><span class=lnt id=hl-83-92><a class=lnlinks href=#hl-83-92> 92</a>
</span><span class=lnt id=hl-83-93><a class=lnlinks href=#hl-83-93> 93</a>
</span><span class=lnt id=hl-83-94><a class=lnlinks href=#hl-83-94> 94</a>
</span><span class=lnt id=hl-83-95><a class=lnlinks href=#hl-83-95> 95</a>
</span><span class=lnt id=hl-83-96><a class=lnlinks href=#hl-83-96> 96</a>
</span><span class=lnt id=hl-83-97><a class=lnlinks href=#hl-83-97> 97</a>
</span><span class=lnt id=hl-83-98><a class=lnlinks href=#hl-83-98> 98</a>
</span><span class=lnt id=hl-83-99><a class=lnlinks href=#hl-83-99> 99</a>
</span><span class=lnt id=hl-83-100><a class=lnlinks href=#hl-83-100>100</a>
</span><span class=lnt id=hl-83-101><a class=lnlinks href=#hl-83-101>101</a>
</span><span class=lnt id=hl-83-102><a class=lnlinks href=#hl-83-102>102</a>
</span><span class=lnt id=hl-83-103><a class=lnlinks href=#hl-83-103>103</a>
</span><span class=lnt id=hl-83-104><a class=lnlinks href=#hl-83-104>104</a>
</span><span class=lnt id=hl-83-105><a class=lnlinks href=#hl-83-105>105</a>
</span><span class=lnt id=hl-83-106><a class=lnlinks href=#hl-83-106>106</a>
</span><span class=lnt id=hl-83-107><a class=lnlinks href=#hl-83-107>107</a>
</span><span class=lnt id=hl-83-108><a class=lnlinks href=#hl-83-108>108</a>
</span><span class=lnt id=hl-83-109><a class=lnlinks href=#hl-83-109>109</a>
</span><span class=lnt id=hl-83-110><a class=lnlinks href=#hl-83-110>110</a>
</span><span class=lnt id=hl-83-111><a class=lnlinks href=#hl-83-111>111</a>
</span><span class=lnt id=hl-83-112><a class=lnlinks href=#hl-83-112>112</a>
</span><span class=lnt id=hl-83-113><a class=lnlinks href=#hl-83-113>113</a>
</span><span class=lnt id=hl-83-114><a class=lnlinks href=#hl-83-114>114</a>
</span><span class=lnt id=hl-83-115><a class=lnlinks href=#hl-83-115>115</a>
</span><span class=lnt id=hl-83-116><a class=lnlinks href=#hl-83-116>116</a>
</span><span class=lnt id=hl-83-117><a class=lnlinks href=#hl-83-117>117</a>
</span><span class=lnt id=hl-83-118><a class=lnlinks href=#hl-83-118>118</a>
</span><span class=lnt id=hl-83-119><a class=lnlinks href=#hl-83-119>119</a>
</span><span class=lnt id=hl-83-120><a class=lnlinks href=#hl-83-120>120</a>
</span><span class=lnt id=hl-83-121><a class=lnlinks href=#hl-83-121>121</a>
</span><span class=lnt id=hl-83-122><a class=lnlinks href=#hl-83-122>122</a>
</span><span class=lnt id=hl-83-123><a class=lnlinks href=#hl-83-123>123</a>
</span><span class=lnt id=hl-83-124><a class=lnlinks href=#hl-83-124>124</a>
</span><span class=lnt id=hl-83-125><a class=lnlinks href=#hl-83-125>125</a>
</span><span class=lnt id=hl-83-126><a class=lnlinks href=#hl-83-126>126</a>
</span><span class=lnt id=hl-83-127><a class=lnlinks href=#hl-83-127>127</a>
</span><span class=lnt id=hl-83-128><a class=lnlinks href=#hl-83-128>128</a>
</span><span class=lnt id=hl-83-129><a class=lnlinks href=#hl-83-129>129</a>
</span><span class=lnt id=hl-83-130><a class=lnlinks href=#hl-83-130>130</a>
</span><span class=lnt id=hl-83-131><a class=lnlinks href=#hl-83-131>131</a>
</span><span class=lnt id=hl-83-132><a class=lnlinks href=#hl-83-132>132</a>
</span><span class=lnt id=hl-83-133><a class=lnlinks href=#hl-83-133>133</a>
</span><span class=lnt id=hl-83-134><a class=lnlinks href=#hl-83-134>134</a>
</span><span class=lnt id=hl-83-135><a class=lnlinks href=#hl-83-135>135</a>
</span><span class=lnt id=hl-83-136><a class=lnlinks href=#hl-83-136>136</a>
</span><span class=lnt id=hl-83-137><a class=lnlinks href=#hl-83-137>137</a>
</span><span class=lnt id=hl-83-138><a class=lnlinks href=#hl-83-138>138</a>
</span><span class=lnt id=hl-83-139><a class=lnlinks href=#hl-83-139>139</a>
</span><span class=lnt id=hl-83-140><a class=lnlinks href=#hl-83-140>140</a>
</span><span class=lnt id=hl-83-141><a class=lnlinks href=#hl-83-141>141</a>
</span><span class=lnt id=hl-83-142><a class=lnlinks href=#hl-83-142>142</a>
</span><span class=lnt id=hl-83-143><a class=lnlinks href=#hl-83-143>143</a>
</span><span class=lnt id=hl-83-144><a class=lnlinks href=#hl-83-144>144</a>
</span><span class=lnt id=hl-83-145><a class=lnlinks href=#hl-83-145>145</a>
</span><span class=lnt id=hl-83-146><a class=lnlinks href=#hl-83-146>146</a>
</span><span class=lnt id=hl-83-147><a class=lnlinks href=#hl-83-147>147</a>
</span><span class=lnt id=hl-83-148><a class=lnlinks href=#hl-83-148>148</a>
</span><span class=lnt id=hl-83-149><a class=lnlinks href=#hl-83-149>149</a>
</span><span class=lnt id=hl-83-150><a class=lnlinks href=#hl-83-150>150</a>
</span><span class=lnt id=hl-83-151><a class=lnlinks href=#hl-83-151>151</a>
</span><span class=lnt id=hl-83-152><a class=lnlinks href=#hl-83-152>152</a>
</span><span class=lnt id=hl-83-153><a class=lnlinks href=#hl-83-153>153</a>
</span><span class=lnt id=hl-83-154><a class=lnlinks href=#hl-83-154>154</a>
</span><span class=lnt id=hl-83-155><a class=lnlinks href=#hl-83-155>155</a>
</span><span class=lnt id=hl-83-156><a class=lnlinks href=#hl-83-156>156</a>
</span><span class=lnt id=hl-83-157><a class=lnlinks href=#hl-83-157>157</a>
</span><span class=lnt id=hl-83-158><a class=lnlinks href=#hl-83-158>158</a>
</span><span class=lnt id=hl-83-159><a class=lnlinks href=#hl-83-159>159</a>
</span><span class=lnt id=hl-83-160><a class=lnlinks href=#hl-83-160>160</a>
</span><span class=lnt id=hl-83-161><a class=lnlinks href=#hl-83-161>161</a>
</span><span class=lnt id=hl-83-162><a class=lnlinks href=#hl-83-162>162</a>
</span><span class=lnt id=hl-83-163><a class=lnlinks href=#hl-83-163>163</a>
</span><span class=lnt id=hl-83-164><a class=lnlinks href=#hl-83-164>164</a>
</span><span class=lnt id=hl-83-165><a class=lnlinks href=#hl-83-165>165</a>
</span><span class=lnt id=hl-83-166><a class=lnlinks href=#hl-83-166>166</a>
</span><span class=lnt id=hl-83-167><a class=lnlinks href=#hl-83-167>167</a>
</span><span class=lnt id=hl-83-168><a class=lnlinks href=#hl-83-168>168</a>
</span><span class=lnt id=hl-83-169><a class=lnlinks href=#hl-83-169>169</a>
</span><span class=lnt id=hl-83-170><a class=lnlinks href=#hl-83-170>170</a>
</span><span class=lnt id=hl-83-171><a class=lnlinks href=#hl-83-171>171</a>
</span><span class=lnt id=hl-83-172><a class=lnlinks href=#hl-83-172>172</a>
</span><span class=lnt id=hl-83-173><a class=lnlinks href=#hl-83-173>173</a>
</span><span class=lnt id=hl-83-174><a class=lnlinks href=#hl-83-174>174</a>
</span><span class=lnt id=hl-83-175><a class=lnlinks href=#hl-83-175>175</a>
</span><span class=lnt id=hl-83-176><a class=lnlinks href=#hl-83-176>176</a>
</span><span class=lnt id=hl-83-177><a class=lnlinks href=#hl-83-177>177</a>
</span><span class=lnt id=hl-83-178><a class=lnlinks href=#hl-83-178>178</a>
</span><span class=lnt id=hl-83-179><a class=lnlinks href=#hl-83-179>179</a>
</span><span class=lnt id=hl-83-180><a class=lnlinks href=#hl-83-180>180</a>
</span><span class=lnt id=hl-83-181><a class=lnlinks href=#hl-83-181>181</a>
</span><span class=lnt id=hl-83-182><a class=lnlinks href=#hl-83-182>182</a>
</span><span class=lnt id=hl-83-183><a class=lnlinks href=#hl-83-183>183</a>
</span><span class=lnt id=hl-83-184><a class=lnlinks href=#hl-83-184>184</a>
</span><span class=lnt id=hl-83-185><a class=lnlinks href=#hl-83-185>185</a>
</span><span class=lnt id=hl-83-186><a class=lnlinks href=#hl-83-186>186</a>
</span><span class=lnt id=hl-83-187><a class=lnlinks href=#hl-83-187>187</a>
</span><span class=lnt id=hl-83-188><a class=lnlinks href=#hl-83-188>188</a>
</span><span class=lnt id=hl-83-189><a class=lnlinks href=#hl-83-189>189</a>
</span><span class=lnt id=hl-83-190><a class=lnlinks href=#hl-83-190>190</a>
</span><span class=lnt id=hl-83-191><a class=lnlinks href=#hl-83-191>191</a>
</span><span class=lnt id=hl-83-192><a class=lnlinks href=#hl-83-192>192</a>
</span><span class=lnt id=hl-83-193><a class=lnlinks href=#hl-83-193>193</a>
</span><span class=lnt id=hl-83-194><a class=lnlinks href=#hl-83-194>194</a>
</span><span class=lnt id=hl-83-195><a class=lnlinks href=#hl-83-195>195</a>
</span><span class=lnt id=hl-83-196><a class=lnlinks href=#hl-83-196>196</a>
</span><span class=lnt id=hl-83-197><a class=lnlinks href=#hl-83-197>197</a>
</span><span class=lnt id=hl-83-198><a class=lnlinks href=#hl-83-198>198</a>
</span><span class=lnt id=hl-83-199><a class=lnlinks href=#hl-83-199>199</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 시청 이벤트 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ViewingEvent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>contentId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>watchDurationSeconds</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>deviceType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Netflix 특화: 시청 품질 메트릭</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>bufferingRatio</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>videoQuality</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, getter/setter 생략</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Kafka Streams를 활용한 실시간 집계</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ViewingAnalyticsProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>StreamsBuilder</span><span class=w> </span><span class=n>streamsBuilder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostConstruct</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>buildTopology</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 시청 이벤트 스트림 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KStream</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>ViewingEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>viewingEvents</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>streamsBuilder</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&#34;viewing-events&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자별 실시간 집계</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KTable</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>UserViewingStats</span><span class=o>&gt;</span><span class=w> </span><span class=n>userStats</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>viewingEvents</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getWatchDurationSeconds</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>30</span><span class=p>)</span><span class=w> </span><span class=c1>// 30초 이상 시청만</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>groupBy</span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getUserId</span><span class=p>())</span><span class=w> </span><span class=c1>// 사용자별 그룹화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>aggregate</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>UserViewingStats</span><span class=p>::</span><span class=k>new</span><span class=p>,</span><span class=w> </span><span class=c1>// 초기값</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=n>stats</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 시청 통계 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>stats</span><span class=p>.</span><span class=na>addWatchTime</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getWatchDurationSeconds</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>stats</span><span class=p>.</span><span class=na>addContentView</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getContentId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>stats</span><span class=p>.</span><span class=na>updateLastActivity</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// Netflix 특화: 시청 품질 추적</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>stats</span><span class=p>.</span><span class=na>updateQualityMetrics</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>event</span><span class=p>.</span><span class=na>getBufferingRatio</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>event</span><span class=p>.</span><span class=na>getVideoQuality</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>stats</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Materialized</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>UserViewingStats</span><span class=p>,</span><span class=w> </span><span class=n>KeyValueStore</span><span class=o>&lt;</span><span class=n>Bytes</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;&gt;</span><span class=n>as</span><span class=p>(</span><span class=s>&#34;user-stats-store&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withValueSerde</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>serdeFrom</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JsonSerializer</span><span class=o>&lt;&gt;</span><span class=p>(),</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JsonDeserializer</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>UserViewingStats</span><span class=p>.</span><span class=na>class</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 콘텐츠별 인기도 실시간 계산</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KTable</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>ContentPopularity</span><span class=o>&gt;</span><span class=w> </span><span class=n>contentPopularity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>viewingEvents</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getWatchDurationSeconds</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>60</span><span class=p>)</span><span class=w> </span><span class=c1>// 1분 이상 시청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>groupBy</span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getContentId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>windowedBy</span><span class=p>(</span><span class=n>TimeWindows</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMinutes</span><span class=p>(</span><span class=n>5</span><span class=p>)))</span><span class=w> </span><span class=c1>// 5분 윈도우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>aggregate</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ContentPopularity</span><span class=p>::</span><span class=k>new</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=n>contentId</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=n>popularity</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>popularity</span><span class=p>.</span><span class=na>incrementViewCount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>popularity</span><span class=p>.</span><span class=na>addWatchTime</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getWatchDurationSeconds</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// Netflix 특화: 디바이스별 시청 패턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>popularity</span><span class=p>.</span><span class=na>trackDeviceUsage</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getDeviceType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>popularity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Materialized</span><span class=p>.</span><span class=na>as</span><span class=p>(</span><span class=s>&#34;content-popularity-store&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실시간 추천을 위한 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userStats</span><span class=p>.</span><span class=na>toStream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>((</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>stats</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>stats</span><span class=p>.</span><span class=na>shouldUpdateRecommendations</span><span class=p>())</span><span class=w> </span><span class=c1>// 추천 업데이트 조건</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>to</span><span class=p>(</span><span class=s>&#34;recommendation-updates&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이상 패턴 감지 (사기 탐지)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>viewingEvents</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=k>this</span><span class=p>::</span><span class=n>detectAnomalousViewing</span><span class=p>)</span><span class=w> </span><span class=c1>// 비정상 시청 패턴 감지</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>to</span><span class=p>(</span><span class=s>&#34;fraud-detection&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>detectAnomalousViewing</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>ViewingEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Netflix 특화: 비정상 시청 패턴 감지 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 예: 짧은 시간에 다수 콘텐츠 시청, 비정상적인 시청 시간 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getWatchDurationSeconds</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>86400</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=c1>// 24시간 초과 시청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=n>event</span><span class=p>.</span><span class=na>getBufferingRatio</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>8</span><span class=p>;</span><span class=w> </span><span class=c1>// 버퍼링이 80% 이상</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 사용자 시청 통계 집계 객체</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserViewingStats</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>totalWatchTimeSeconds</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>uniqueContent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>lastActivityTimestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>totalViews</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Netflix 특화 메트릭</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>averageBufferingRatio</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>qualityPreferences</span><span class=p>;</span><span class=w> </span><span class=c1>// 화질별 시청 횟수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>deviceUsage</span><span class=p>;</span><span class=w> </span><span class=c1>// 디바이스별 사용 패턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>genrePreferences</span><span class=p>;</span><span class=w> </span><span class=c1>// 장르 선호도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addWatchTime</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>seconds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>totalWatchTimeSeconds</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>seconds</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>totalViews</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addContentView</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>contentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>uniqueContent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>uniqueContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>uniqueContent</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>contentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateQualityMetrics</span><span class=p>(</span><span class=kt>double</span><span class=w> </span><span class=n>bufferingRatio</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>quality</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버퍼링 비율 평균 계산</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>averageBufferingRatio</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>averageBufferingRatio</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>totalViews</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>bufferingRatio</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>totalViews</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 화질 선호도 추적</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>qualityPreferences</span><span class=p>.</span><span class=na>merge</span><span class=p>(</span><span class=n>quality</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=p>::</span><span class=n>sum</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>shouldUpdateRecommendations</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 추천 업데이트가 필요한 조건</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 예: 새로운 콘텐츠 5개 이상 시청, 1시간 이상 시청 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>uniqueContent</span><span class=p>.</span><span class=na>size</span><span class=p>()</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>5</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>||</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>lastActivityTimestamp</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>3600000</span><span class=p>;</span><span class=w> </span><span class=c1>// 1시간</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Cassandra 기반 이벤트 저장소</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CassandraEventStore</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>CassandraTemplate</span><span class=w> </span><span class=n>cassandraTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveEvent</span><span class=p>(</span><span class=n>ViewingEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 시간 기반 파티셔닝으로 확장성 확보</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>partitionKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generatePartitionKey</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>            INSERT INTO events.viewing_events (
</span></span></span><span class=line><span class=cl><span class=s>                partition_key, event_id, user_id, content_id, 
</span></span></span><span class=line><span class=cl><span class=s>                timestamp, watch_duration, device_type, 
</span></span></span><span class=line><span class=cl><span class=s>                buffering_ratio, video_quality, event_data
</span></span></span><span class=line><span class=cl><span class=s>            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
</span></span></span><span class=line><span class=cl><span class=s>            &#34;&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cassandraTemplate</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>cql</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>partitionKey</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getUserId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getContentId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getWatchDurationSeconds</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getDeviceType</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getBufferingRatio</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getVideoQuality</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JsonUtils</span><span class=p>.</span><span class=na>toJson</span><span class=p>(</span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=c1>// 전체 이벤트 데이터 JSON 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>ViewingEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getEventsForUser</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>fromTimestamp</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자의 특정 시점 이후 이벤트 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>            SELECT * FROM events.viewing_events 
</span></span></span><span class=line><span class=cl><span class=s>            WHERE user_id = ? AND timestamp &gt;= ?
</span></span></span><span class=line><span class=cl><span class=s>            ORDER BY timestamp ASC
</span></span></span><span class=line><span class=cl><span class=s>            &#34;&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>cassandraTemplate</span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>cql</span><span class=p>,</span><span class=w> </span><span class=n>ViewingEvent</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>(</span><span class=n>fromTimestamp</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>generatePartitionKey</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>timestamp</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 시간 기반 파티셔닝 (예: 일별)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=w> </span><span class=n>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>ofEpochSecond</span><span class=p>(</span><span class=n>timestamp</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>1000</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>ZoneOffset</span><span class=p>.</span><span class=na>UTC</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>date</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=n>DateTimeFormatter</span><span class=p>.</span><span class=na>ofPattern</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Netflix 특화: 롤업 데이터 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveRollupData</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>timeWindow</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>aggregationType</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>            INSERT INTO events.rollup_data (
</span></span></span><span class=line><span class=cl><span class=s>                time_window, aggregation_type, data, created_at
</span></span></span><span class=line><span class=cl><span class=s>            ) VALUES (?, ?, ?, ?)
</span></span></span><span class=line><span class=cl><span class=s>            &#34;&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cassandraTemplate</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>cql</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>timeWindow</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>aggregationType</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JsonUtils</span><span class=p>.</span><span class=na>toJson</span><span class=p>(</span><span class=n>data</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=phase-5-실무-적용-2>Phase 5: 실무 적용<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-2>#</a></h3><h4 id=실제-도입-사례-요약>실제 도입 사례 (요약)<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-요약>#</a></h4><ul><li><strong>금융 트레이딩(LMAX)</strong>: 초저지연 단일 스레드 처리+이벤트 소싱으로 초고성능 달성. (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">martinfowler.com</a>)</li><li><strong>마이크로서비스(CQRS)</strong>: Azure 아키텍처 가이드에서 ES+CQRS 조합 권장 시나리오 제시. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Microsoft Learn</a>)</li><li><strong>클라우드 NoSQL(Cosmos DB)</strong>: Change Feed로 리드 모델/머티리얼라이즈드 뷰 실시간 구축. (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Microsoft for Developers</a>)</li></ul><h4 id=실습-예제-및-코드-구현-3>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현-3>#</a></h4><p><strong>시나리오</strong>: 전자상거래의 주문 수명주기(<code>OrderPlaced</code> → <code>ItemAdded</code> → <code>Paid</code> → <code>Shipped</code>)
<strong>시스템 구성</strong>:</p><ul><li>Command API (FastAPI/Express), Event Store(PostgreSQL), Projector(비동기 워커), Read DB(PostgreSQL 별도 스키마)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
  C[Client] --&gt; A[Command API]
  A --&gt; ES[(Event Store)]
  ES --&gt; W[Projector Worker]
  W --&gt; R[(Read DB)]
  C --&gt; Q[Query API]
  Q --&gt; R
</pre><p><strong>Workflow</strong>:</p><ol><li>Command API가 Aggregate 이벤트를 생성 후 Event Store에 Append(낙관적 잠금).</li><li>Projector가 오프셋 체크포인트를 읽고 미투영 이벤트를 읽어 Read DB에 Upsert.</li><li>Query API는 Read DB만 조회.</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Event Sourcing이 <strong>쓰기 모델</strong>의 단일 진실 공급원.</li><li>Read 모델은 <strong>투영의 결과물</strong>로 최종 일관성.</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 상태만 저장, 과거 경로 추적 어려움, 모델 변경 시 마이그레이션 부담 큼.</li><li>도입 후: 이벤트 재생으로 과거/새 모델 재구성 용이, 감사/디버깅 강화.</li></ul><p><strong>구현 예시 – Python (FastAPI + PostgreSQL)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-85-1><a class=lnlinks href=#hl-85-1> 1</a>
</span><span class=lnt id=hl-85-2><a class=lnlinks href=#hl-85-2> 2</a>
</span><span class=lnt id=hl-85-3><a class=lnlinks href=#hl-85-3> 3</a>
</span><span class=lnt id=hl-85-4><a class=lnlinks href=#hl-85-4> 4</a>
</span><span class=lnt id=hl-85-5><a class=lnlinks href=#hl-85-5> 5</a>
</span><span class=lnt id=hl-85-6><a class=lnlinks href=#hl-85-6> 6</a>
</span><span class=lnt id=hl-85-7><a class=lnlinks href=#hl-85-7> 7</a>
</span><span class=lnt id=hl-85-8><a class=lnlinks href=#hl-85-8> 8</a>
</span><span class=lnt id=hl-85-9><a class=lnlinks href=#hl-85-9> 9</a>
</span><span class=lnt id=hl-85-10><a class=lnlinks href=#hl-85-10>10</a>
</span><span class=lnt id=hl-85-11><a class=lnlinks href=#hl-85-11>11</a>
</span><span class=lnt id=hl-85-12><a class=lnlinks href=#hl-85-12>12</a>
</span><span class=lnt id=hl-85-13><a class=lnlinks href=#hl-85-13>13</a>
</span><span class=lnt id=hl-85-14><a class=lnlinks href=#hl-85-14>14</a>
</span><span class=lnt id=hl-85-15><a class=lnlinks href=#hl-85-15>15</a>
</span><span class=lnt id=hl-85-16><a class=lnlinks href=#hl-85-16>16</a>
</span><span class=lnt id=hl-85-17><a class=lnlinks href=#hl-85-17>17</a>
</span><span class=lnt id=hl-85-18><a class=lnlinks href=#hl-85-18>18</a>
</span><span class=lnt id=hl-85-19><a class=lnlinks href=#hl-85-19>19</a>
</span><span class=lnt id=hl-85-20><a class=lnlinks href=#hl-85-20>20</a>
</span><span class=lnt id=hl-85-21><a class=lnlinks href=#hl-85-21>21</a>
</span><span class=lnt id=hl-85-22><a class=lnlinks href=#hl-85-22>22</a>
</span><span class=lnt id=hl-85-23><a class=lnlinks href=#hl-85-23>23</a>
</span><span class=lnt id=hl-85-24><a class=lnlinks href=#hl-85-24>24</a>
</span><span class=lnt id=hl-85-25><a class=lnlinks href=#hl-85-25>25</a>
</span><span class=lnt id=hl-85-26><a class=lnlinks href=#hl-85-26>26</a>
</span><span class=lnt id=hl-85-27><a class=lnlinks href=#hl-85-27>27</a>
</span><span class=lnt id=hl-85-28><a class=lnlinks href=#hl-85-28>28</a>
</span><span class=lnt id=hl-85-29><a class=lnlinks href=#hl-85-29>29</a>
</span><span class=lnt id=hl-85-30><a class=lnlinks href=#hl-85-30>30</a>
</span><span class=lnt id=hl-85-31><a class=lnlinks href=#hl-85-31>31</a>
</span><span class=lnt id=hl-85-32><a class=lnlinks href=#hl-85-32>32</a>
</span><span class=lnt id=hl-85-33><a class=lnlinks href=#hl-85-33>33</a>
</span><span class=lnt id=hl-85-34><a class=lnlinks href=#hl-85-34>34</a>
</span><span class=lnt id=hl-85-35><a class=lnlinks href=#hl-85-35>35</a>
</span><span class=lnt id=hl-85-36><a class=lnlinks href=#hl-85-36>36</a>
</span><span class=lnt id=hl-85-37><a class=lnlinks href=#hl-85-37>37</a>
</span><span class=lnt id=hl-85-38><a class=lnlinks href=#hl-85-38>38</a>
</span><span class=lnt id=hl-85-39><a class=lnlinks href=#hl-85-39>39</a>
</span><span class=lnt id=hl-85-40><a class=lnlinks href=#hl-85-40>40</a>
</span><span class=lnt id=hl-85-41><a class=lnlinks href=#hl-85-41>41</a>
</span><span class=lnt id=hl-85-42><a class=lnlinks href=#hl-85-42>42</a>
</span><span class=lnt id=hl-85-43><a class=lnlinks href=#hl-85-43>43</a>
</span><span class=lnt id=hl-85-44><a class=lnlinks href=#hl-85-44>44</a>
</span><span class=lnt id=hl-85-45><a class=lnlinks href=#hl-85-45>45</a>
</span><span class=lnt id=hl-85-46><a class=lnlinks href=#hl-85-46>46</a>
</span><span class=lnt id=hl-85-47><a class=lnlinks href=#hl-85-47>47</a>
</span><span class=lnt id=hl-85-48><a class=lnlinks href=#hl-85-48>48</a>
</span><span class=lnt id=hl-85-49><a class=lnlinks href=#hl-85-49>49</a>
</span><span class=lnt id=hl-85-50><a class=lnlinks href=#hl-85-50>50</a>
</span><span class=lnt id=hl-85-51><a class=lnlinks href=#hl-85-51>51</a>
</span><span class=lnt id=hl-85-52><a class=lnlinks href=#hl-85-52>52</a>
</span><span class=lnt id=hl-85-53><a class=lnlinks href=#hl-85-53>53</a>
</span><span class=lnt id=hl-85-54><a class=lnlinks href=#hl-85-54>54</a>
</span><span class=lnt id=hl-85-55><a class=lnlinks href=#hl-85-55>55</a>
</span><span class=lnt id=hl-85-56><a class=lnlinks href=#hl-85-56>56</a>
</span><span class=lnt id=hl-85-57><a class=lnlinks href=#hl-85-57>57</a>
</span><span class=lnt id=hl-85-58><a class=lnlinks href=#hl-85-58>58</a>
</span><span class=lnt id=hl-85-59><a class=lnlinks href=#hl-85-59>59</a>
</span><span class=lnt id=hl-85-60><a class=lnlinks href=#hl-85-60>60</a>
</span><span class=lnt id=hl-85-61><a class=lnlinks href=#hl-85-61>61</a>
</span><span class=lnt id=hl-85-62><a class=lnlinks href=#hl-85-62>62</a>
</span><span class=lnt id=hl-85-63><a class=lnlinks href=#hl-85-63>63</a>
</span><span class=lnt id=hl-85-64><a class=lnlinks href=#hl-85-64>64</a>
</span><span class=lnt id=hl-85-65><a class=lnlinks href=#hl-85-65>65</a>
</span><span class=lnt id=hl-85-66><a class=lnlinks href=#hl-85-66>66</a>
</span><span class=lnt id=hl-85-67><a class=lnlinks href=#hl-85-67>67</a>
</span><span class=lnt id=hl-85-68><a class=lnlinks href=#hl-85-68>68</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 핵심: 이벤트 Append, 리플레이, 낙관적 잠금, 멱등성</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>uuid</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Command</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>:</span> <span class=nb>dict</span>
</span></span><span class=line><span class=cl>    <span class=n>expected_version</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>idempotency_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># 멱등성 보장용</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>conn</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=es user=es password=es host=localhost&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테이블 (예시):</span>
</span></span><span class=line><span class=cl><span class=c1># events(stream_id text, seq int, type text, data jsonb, ts timestamptz, idempotency_key text, primary key(stream_id, seq))</span>
</span></span><span class=line><span class=cl><span class=c1># unique(stream_id, idempotency_key)</span>
</span></span><span class=line><span class=cl><span class=c1># projections.orders(order_id text primary key, status text, total numeric, updated_at timestamptz)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders/place&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>place_order</span><span class=p>(</span><span class=n>cmd</span><span class=p>:</span> <span class=n>Command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>payload</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>stream_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;order-</span><span class=si>{</span><span class=n>cmd</span><span class=o>.</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=p>()</span> <span class=k>as</span> <span class=n>c</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 멱등성 검사 (같은 idempotency_key로 재시도 시 중복 방지)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>cmd</span><span class=o>.</span><span class=n>idempotency_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;select 1 from events where stream_id=</span><span class=si>%s</span><span class=s2> and idempotency_key=</span><span class=si>%s</span><span class=s2>&#34;&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=n>cmd</span><span class=o>.</span><span class=n>idempotency_key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;idempotent&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 버전 읽기</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select coalesce(max(seq),0) from events where stream_id=</span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>stream_id</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1># 낙관적 잠금</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>cmd</span><span class=o>.</span><span class=n>expected_version</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>cmd</span><span class=o>.</span><span class=n>expected_version</span> <span class=o>!=</span> <span class=n>current_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=mi>409</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;version conflict: expected </span><span class=si>{</span><span class=n>cmd</span><span class=o>.</span><span class=n>expected_version</span><span class=si>}</span><span class=s2>, got </span><span class=si>{</span><span class=n>current_version</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>next_seq</span> <span class=o>=</span> <span class=n>current_version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;insert into events(stream_id, seq, type, data, ts, idempotency_key)
</span></span></span><span class=line><span class=cl><span class=s2>                       values(</span><span class=si>%s</span><span class=s2>,</span><span class=si>%s</span><span class=s2>,</span><span class=si>%s</span><span class=s2>,</span><span class=si>%s</span><span class=s2>,now(),</span><span class=si>%s</span><span class=s2>)&#34;&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=n>next_seq</span><span class=p>,</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>],</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]),</span> <span class=n>cmd</span><span class=o>.</span><span class=n>idempotency_key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=n>next_seq</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replay_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 핵심: 이벤트 리플레이로 Aggregate/상태 복원</span>
</span></span><span class=line><span class=cl>    <span class=n>stream_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;order-</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;NEW&#34;</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[],</span> <span class=s2>&#34;total&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=p>()</span> <span class=k>as</span> <span class=n>c</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;select type, data from events where stream_id=</span><span class=si>%s</span><span class=s2> order by seq asc&#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>stream_id</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>etype</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>etype</span> <span class=o>==</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;status&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;PLACED&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>etype</span> <span class=o>==</span> <span class=s2>&#34;ItemAdded&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;sku&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;total&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;price&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;qty&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>etype</span> <span class=o>==</span> <span class=s2>&#34;Paid&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;status&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;PAID&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>etype</span> <span class=o>==</span> <span class=s2>&#34;Shipped&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;status&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;SHIPPED&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>구현 예시 – Node.js (Express + Upcaster 스케치)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-86-1><a class=lnlinks href=#hl-86-1> 1</a>
</span><span class=lnt id=hl-86-2><a class=lnlinks href=#hl-86-2> 2</a>
</span><span class=lnt id=hl-86-3><a class=lnlinks href=#hl-86-3> 3</a>
</span><span class=lnt id=hl-86-4><a class=lnlinks href=#hl-86-4> 4</a>
</span><span class=lnt id=hl-86-5><a class=lnlinks href=#hl-86-5> 5</a>
</span><span class=lnt id=hl-86-6><a class=lnlinks href=#hl-86-6> 6</a>
</span><span class=lnt id=hl-86-7><a class=lnlinks href=#hl-86-7> 7</a>
</span><span class=lnt id=hl-86-8><a class=lnlinks href=#hl-86-8> 8</a>
</span><span class=lnt id=hl-86-9><a class=lnlinks href=#hl-86-9> 9</a>
</span><span class=lnt id=hl-86-10><a class=lnlinks href=#hl-86-10>10</a>
</span><span class=lnt id=hl-86-11><a class=lnlinks href=#hl-86-11>11</a>
</span><span class=lnt id=hl-86-12><a class=lnlinks href=#hl-86-12>12</a>
</span><span class=lnt id=hl-86-13><a class=lnlinks href=#hl-86-13>13</a>
</span><span class=lnt id=hl-86-14><a class=lnlinks href=#hl-86-14>14</a>
</span><span class=lnt id=hl-86-15><a class=lnlinks href=#hl-86-15>15</a>
</span><span class=lnt id=hl-86-16><a class=lnlinks href=#hl-86-16>16</a>
</span><span class=lnt id=hl-86-17><a class=lnlinks href=#hl-86-17>17</a>
</span><span class=lnt id=hl-86-18><a class=lnlinks href=#hl-86-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 핵심: 업캐스터 체인으로 과거 이벤트를 최신 모델로 승격
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>upcast</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s2>&#34;ItemAdded&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>event</span><span class=p>.</span><span class=nx>version</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// v1 -&gt; v2: qty 필드 기본값 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span> <span class=p>...</span><span class=nx>event</span><span class=p>,</span> <span class=nx>version</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>data</span><span class=o>:</span> <span class=p>{</span> <span class=p>...</span><span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>,</span> <span class=nx>qty</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>qty</span> <span class=o>??</span> <span class=mi>1</span> <span class=p>}</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Projector 예시: 멱등 upsert
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>projectItemAdded</span><span class=p>(</span><span class=nx>ev</span><span class=p>,</span> <span class=nx>db</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ev</span> <span class=o>=</span> <span class=nx>upcast</span><span class=p>(</span><span class=nx>ev</span><span class=p>);</span> <span class=c1>// 이벤트 진화 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>db</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    insert into order_items(order_id, sku, qty, price)
</span></span></span><span class=line><span class=cl><span class=sb>    values($1,$2,$3,$4)
</span></span></span><span class=line><span class=cl><span class=sb>    on conflict(order_id, sku) do update set qty = order_items.qty + EXCLUDED.qty
</span></span></span><span class=line><span class=cl><span class=sb>  `</span><span class=p>,</span> <span class=p>[</span><span class=nx>ev</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>ev</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>sku</span><span class=p>,</span> <span class=nx>ev</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>qty</span><span class=p>,</span> <span class=nx>ev</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>price</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현-2>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현-2>#</a></h4><p><strong>시나리오</strong>: <strong>EventStoreDB</strong>를 쓰는 주문 서비스의 쓰기 모델(append) + 읽기 모델(프로젝션) 최소 구현. EventStoreDB는 이벤트 스트림/버전/프로젝션을 1급 기능으로 제공. (<a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">GitHub</a>)</p><p><strong>시스템 구성</strong>:</p><ul><li>Command API(C# 또는 Node), EventStoreDB, Projection(ESDB 내장 또는 외부 워커), Read DB</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
  API[Command API] --&gt; ESDB[(EventStoreDB)]
  ESDB -- subscriptions --&gt; PROJ[Projection Worker]
  PROJ --&gt; R[(Read DB)]
  QAPI[Query API] --&gt; R
</pre><p><strong>Workflow</strong>:</p><ol><li>API가 <code>AppendToStream(streamId, expectedRevision, eventData)</code> 호출</li><li>Projection Worker가 Subscription으로 이벤트 수신</li><li>Upsert로 Read DB 갱신</li></ol><p><strong>구현 예시 – Node.js + EventStoreDB gRPC SDK</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-88-1><a class=lnlinks href=#hl-88-1> 1</a>
</span><span class=lnt id=hl-88-2><a class=lnlinks href=#hl-88-2> 2</a>
</span><span class=lnt id=hl-88-3><a class=lnlinks href=#hl-88-3> 3</a>
</span><span class=lnt id=hl-88-4><a class=lnlinks href=#hl-88-4> 4</a>
</span><span class=lnt id=hl-88-5><a class=lnlinks href=#hl-88-5> 5</a>
</span><span class=lnt id=hl-88-6><a class=lnlinks href=#hl-88-6> 6</a>
</span><span class=lnt id=hl-88-7><a class=lnlinks href=#hl-88-7> 7</a>
</span><span class=lnt id=hl-88-8><a class=lnlinks href=#hl-88-8> 8</a>
</span><span class=lnt id=hl-88-9><a class=lnlinks href=#hl-88-9> 9</a>
</span><span class=lnt id=hl-88-10><a class=lnlinks href=#hl-88-10>10</a>
</span><span class=lnt id=hl-88-11><a class=lnlinks href=#hl-88-11>11</a>
</span><span class=lnt id=hl-88-12><a class=lnlinks href=#hl-88-12>12</a>
</span><span class=lnt id=hl-88-13><a class=lnlinks href=#hl-88-13>13</a>
</span><span class=lnt id=hl-88-14><a class=lnlinks href=#hl-88-14>14</a>
</span><span class=lnt id=hl-88-15><a class=lnlinks href=#hl-88-15>15</a>
</span><span class=lnt id=hl-88-16><a class=lnlinks href=#hl-88-16>16</a>
</span><span class=lnt id=hl-88-17><a class=lnlinks href=#hl-88-17>17</a>
</span><span class=lnt id=hl-88-18><a class=lnlinks href=#hl-88-18>18</a>
</span><span class=lnt id=hl-88-19><a class=lnlinks href=#hl-88-19>19</a>
</span><span class=lnt id=hl-88-20><a class=lnlinks href=#hl-88-20>20</a>
</span><span class=lnt id=hl-88-21><a class=lnlinks href=#hl-88-21>21</a>
</span><span class=lnt id=hl-88-22><a class=lnlinks href=#hl-88-22>22</a>
</span><span class=lnt id=hl-88-23><a class=lnlinks href=#hl-88-23>23</a>
</span><span class=lnt id=hl-88-24><a class=lnlinks href=#hl-88-24>24</a>
</span><span class=lnt id=hl-88-25><a class=lnlinks href=#hl-88-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 주석: EventStoreDB에 Append, ExpectedRevision으로 낙관적 잠금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>EventStoreDBClient</span><span class=p>,</span> <span class=nx>jsonEvent</span><span class=p>,</span> <span class=nx>FORWARDS</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@eventstore/db-client&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventStoreDBClient</span><span class=p>({</span> <span class=nx>endpoint</span><span class=o>:</span> <span class=s2>&#34;esdb://localhost:2113?tls=false&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>placeOrder</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>,</span> <span class=nx>expectedRevision</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=nx>jsonEvent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=p>...</span><span class=nx>payload</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>appendToStream</span><span class=p>(</span><span class=sb>`order-</span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>[</span><span class=nx>event</span><span class=p>],</span> <span class=p>{</span> <span class=nx>expectedRevision</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>replay</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>readStream</span><span class=p>(</span><span class=sb>`order-</span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span> <span class=nx>direction</span><span class=o>:</span> <span class=nx>FORWARDS</span><span class=p>,</span> <span class=nx>fromRevision</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>state</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>status</span><span class=o>:</span> <span class=s2>&#34;NEW&#34;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=kr>await</span> <span class=p>(</span><span class=kr>const</span> <span class=p>{</span> <span class=nx>event</span> <span class=p>}</span> <span class=k>of</span> <span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>event</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s2>&#34;PLACED&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Paid&#34;</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s2>&#34;PAID&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=phase-6-운영-및-최적화-1>Phase 6: 운영 및 최적화<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-1>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><ul><li><strong>GDPR(잊힐 권리)</strong>: 이벤트 페이로드 암호화+키 폐기, PII 분리 저장, 삭제 이벤트(보정 이벤트)로 처리.</li><li><strong>규정 준수</strong>: 모든 변경은 이벤트로 기록하여 감사 로그 일관성 확보. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li><li><strong>권한/접근 제어</strong>: Stream 단위 ACL, API 레벨 스코프 기반 접근.</li></ul><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><ul><li><strong>핵심 메트릭</strong>: Append 지연, ExpectedVersion 충돌률, Projector lag(오프셋 차), 중복 처리율, 리플레이 시간.</li><li><strong>로그/트레이싱</strong>: 이벤트 ID·상관관계 ID, 커맨드→이벤트→프로젝션 체인 추적(OpenTelemetry 권장).</li></ul><h4 id=실무-적용-고려사항-및-주의점-표>실무 적용 고려사항 및 주의점 (표)<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점-표>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>내용</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>이벤트 명세</td><td>타입/버전/ID/발생시각/Producer</td><td>스키마 레지스트리/명확한 네이밍</td></tr><tr><td>스토리지</td><td>파티셔닝</td><td>Aggregate 키 기반 파티션</td><td>순서 보장/핫 파티션 모니터링</td></tr><tr><td>성능</td><td>스냅샷</td><td>N 이벤트마다 저장</td><td>읽기 지연 목표로 주기 조정</td></tr><tr><td>진화</td><td>업캐스터</td><td>코드/파이프라인으로 관리</td><td>회귀 테스트·계약 테스트</td></tr><tr><td>복구</td><td>리플레이</td><td>체크포인트 기반 재처리</td><td>백필 전 전략·리밸런싱 계획</td></tr></tbody></table><h4 id=성능-최적화-전략-표>성능 최적화 전략 (표)<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략-표>#</a></h4><table><thead><tr><th>영역</th><th>전략</th><th>설명</th><th>비고</th></tr></thead><tbody><tr><td>쓰기</td><td>배치 Append</td><td>Nagle 유사 효과로 TPS↑</td><td>지연-처리량 균형</td></tr><tr><td>읽기</td><td>스냅샷+증분</td><td>스냅샷 이후만 리플레이</td><td>큰 Aggregate에 유효</td></tr><tr><td>투영</td><td>병렬 파티션</td><td>키 파티션 병렬 소비</td><td>순서 보장 주의</td></tr><tr><td>스키마</td><td>Lean 이벤트</td><td>최소 필드+레퍼런스</td><td>PII 분리</td></tr></tbody></table><h2 id=phase-6-운영-및-최적화-operations--optimization-2>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization-2>#</a></h2><h3 id=보안-및-거버넌스-1>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스-1>#</a></h3><h4 id=보안-고려사항>보안 고려사항<a hidden class=anchor aria-hidden=true href=#보안-고려사항>#</a></h4><table><thead><tr><th>보안 영역</th><th>고려사항</th><th>구현 방법</th><th>모니터링 지표</th></tr></thead><tbody><tr><td><strong>이벤트 무결성</strong></td><td>이벤트 변조 방지</td><td>디지털 서명, 해시 체인</td><td>해시 불일치 건수</td></tr><tr><td><strong>접근 제어</strong></td><td>이벤트 스토어 접근 권한</td><td>RBAC, API 게이트웨이</td><td>권한 위반 시도 횟수</td></tr><tr><td><strong>데이터 암호화</strong></td><td>민감 정보 보호</td><td>필드 레벨 암호화</td><td>암호화되지 않은 이벤트 비율</td></tr><tr><td><strong>감사 로그</strong></td><td>시스템 접근 추적</td><td>별도 감사 시스템</td><td>감사 로그 누락 건수</td></tr><tr><td><strong>개인정보 보호</strong></td><td>GDPR, CCPA 준수</td><td>암호화 샤딩, 삭제 가능한 구조</td><td>개인정보 삭제 요청 처리 시간</td></tr></tbody></table><p><strong>구현 예시 (암호화된 이벤트 저장)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-89-1><a class=lnlinks href=#hl-89-1> 1</a>
</span><span class=lnt id=hl-89-2><a class=lnlinks href=#hl-89-2> 2</a>
</span><span class=lnt id=hl-89-3><a class=lnlinks href=#hl-89-3> 3</a>
</span><span class=lnt id=hl-89-4><a class=lnlinks href=#hl-89-4> 4</a>
</span><span class=lnt id=hl-89-5><a class=lnlinks href=#hl-89-5> 5</a>
</span><span class=lnt id=hl-89-6><a class=lnlinks href=#hl-89-6> 6</a>
</span><span class=lnt id=hl-89-7><a class=lnlinks href=#hl-89-7> 7</a>
</span><span class=lnt id=hl-89-8><a class=lnlinks href=#hl-89-8> 8</a>
</span><span class=lnt id=hl-89-9><a class=lnlinks href=#hl-89-9> 9</a>
</span><span class=lnt id=hl-89-10><a class=lnlinks href=#hl-89-10>10</a>
</span><span class=lnt id=hl-89-11><a class=lnlinks href=#hl-89-11>11</a>
</span><span class=lnt id=hl-89-12><a class=lnlinks href=#hl-89-12>12</a>
</span><span class=lnt id=hl-89-13><a class=lnlinks href=#hl-89-13>13</a>
</span><span class=lnt id=hl-89-14><a class=lnlinks href=#hl-89-14>14</a>
</span><span class=lnt id=hl-89-15><a class=lnlinks href=#hl-89-15>15</a>
</span><span class=lnt id=hl-89-16><a class=lnlinks href=#hl-89-16>16</a>
</span><span class=lnt id=hl-89-17><a class=lnlinks href=#hl-89-17>17</a>
</span><span class=lnt id=hl-89-18><a class=lnlinks href=#hl-89-18>18</a>
</span><span class=lnt id=hl-89-19><a class=lnlinks href=#hl-89-19>19</a>
</span><span class=lnt id=hl-89-20><a class=lnlinks href=#hl-89-20>20</a>
</span><span class=lnt id=hl-89-21><a class=lnlinks href=#hl-89-21>21</a>
</span><span class=lnt id=hl-89-22><a class=lnlinks href=#hl-89-22>22</a>
</span><span class=lnt id=hl-89-23><a class=lnlinks href=#hl-89-23>23</a>
</span><span class=lnt id=hl-89-24><a class=lnlinks href=#hl-89-24>24</a>
</span><span class=lnt id=hl-89-25><a class=lnlinks href=#hl-89-25>25</a>
</span><span class=lnt id=hl-89-26><a class=lnlinks href=#hl-89-26>26</a>
</span><span class=lnt id=hl-89-27><a class=lnlinks href=#hl-89-27>27</a>
</span><span class=lnt id=hl-89-28><a class=lnlinks href=#hl-89-28>28</a>
</span><span class=lnt id=hl-89-29><a class=lnlinks href=#hl-89-29>29</a>
</span><span class=lnt id=hl-89-30><a class=lnlinks href=#hl-89-30>30</a>
</span><span class=lnt id=hl-89-31><a class=lnlinks href=#hl-89-31>31</a>
</span><span class=lnt id=hl-89-32><a class=lnlinks href=#hl-89-32>32</a>
</span><span class=lnt id=hl-89-33><a class=lnlinks href=#hl-89-33>33</a>
</span><span class=lnt id=hl-89-34><a class=lnlinks href=#hl-89-34>34</a>
</span><span class=lnt id=hl-89-35><a class=lnlinks href=#hl-89-35>35</a>
</span><span class=lnt id=hl-89-36><a class=lnlinks href=#hl-89-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 개인정보를 포함한 이벤트의 암호화 처리</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SecureEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>encryption_service</span><span class=p>,</span> <span class=n>key_management</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>encryption_service</span> <span class=o>=</span> <span class=n>encryption_service</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_management</span> <span class=o>=</span> <span class=n>key_management</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;개인정보가 포함된 이벤트의 안전한 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 개인정보 필드 식별</span>
</span></span><span class=line><span class=cl>        <span class=n>pii_fields</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>identify_pii_fields</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 각 사용자별 암호화 키 생성/조회</span>
</span></span><span class=line><span class=cl>        <span class=n>encryption_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>key_management</span><span class=o>.</span><span class=n>get_user_key</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 복사 및 민감 정보 암호화</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_event</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>pii_fields</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>original_value</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>encrypted_event</span><span class=p>,</span> <span class=n>field</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>encrypted_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>encryption_service</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>original_value</span><span class=p>,</span> <span class=n>encryption_key</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>setattr</span><span class=p>(</span><span class=n>encrypted_event</span><span class=p>,</span> <span class=n>field</span><span class=p>,</span> <span class=n>encrypted_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 디지털 서명 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>signature</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_digital_signature</span><span class=p>(</span><span class=n>encrypted_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_event</span><span class=o>.</span><span class=n>signature</span> <span class=o>=</span> <span class=n>signature</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>encrypted_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>delete_user_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;GDPR 준수를 위한 사용자 데이터 삭제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 암호화 키 삭제 (crypto-shredding)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_management</span><span class=o>.</span><span class=n>delete_user_key</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메타데이터에서 사용자 연결 정보 제거</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>store</span><span class=o>.</span><span class=n>anonymize_user_events</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=규정-준수>규정 준수<a hidden class=anchor aria-hidden=true href=#규정-준수>#</a></h4><p><strong>금융 서비스 규정 (SOX, PCI-DSS)</strong>:</p><ul><li>이벤트의 불변성으로 완벽한 감사 추적 제공</li><li>접근 로그와 변경 이력의 완전한 기록</li><li>정기적인 무결성 검증 및 백업</li></ul><p><strong>개인정보 보호 규정 (GDPR, CCPA)</strong>:</p><ul><li>암호화 샤딩을 통한 개인정보 삭제</li><li>동의 철회 시 관련 이벤트 처리</li><li>개인정보 처리 목적과 보존 기간 명시</li></ul><h3 id=모니터링-및-관측성-1>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성-1>#</a></h3><h4 id=핵심-메트릭>핵심 메트릭<a hidden class=anchor aria-hidden=true href=#핵심-메트릭>#</a></h4><table><thead><tr><th>카테고리</th><th>메트릭</th><th>임계값</th><th>알림 조건</th><th>대응 방안</th></tr></thead><tbody><tr><td><strong>처리량</strong></td><td>초당 이벤트 처리 수</td><td>> 10,000 TPS</td><td>처리량 50% 감소</td><td>인스턴스 스케일 아웃</td></tr><tr><td><strong>지연시간</strong></td><td>이벤트 저장 지연시간</td><td>&lt; 100ms</td><td>평균 500ms 초과</td><td>데이터베이스 최적화</td></tr><tr><td><strong>가용성</strong></td><td>Event Store 가용성</td><td>99.9%</td><td>5분간 응답 없음</td><td>페일오버 실행</td></tr><tr><td><strong>일관성</strong></td><td>프로젝션 지연시간</td><td>&lt; 1초</td><td>10초 초과 지연</td><td>프로젝션 재시작</td></tr><tr><td><strong>저장소</strong></td><td>이벤트 스토어 사용량</td><td>&lt; 80%</td><td>85% 초과</td><td>아카이빙 실행</td></tr></tbody></table><p><strong>모니터링 구현 예시 (Prometheus + Grafana)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-90-1><a class=lnlinks href=#hl-90-1> 1</a>
</span><span class=lnt id=hl-90-2><a class=lnlinks href=#hl-90-2> 2</a>
</span><span class=lnt id=hl-90-3><a class=lnlinks href=#hl-90-3> 3</a>
</span><span class=lnt id=hl-90-4><a class=lnlinks href=#hl-90-4> 4</a>
</span><span class=lnt id=hl-90-5><a class=lnlinks href=#hl-90-5> 5</a>
</span><span class=lnt id=hl-90-6><a class=lnlinks href=#hl-90-6> 6</a>
</span><span class=lnt id=hl-90-7><a class=lnlinks href=#hl-90-7> 7</a>
</span><span class=lnt id=hl-90-8><a class=lnlinks href=#hl-90-8> 8</a>
</span><span class=lnt id=hl-90-9><a class=lnlinks href=#hl-90-9> 9</a>
</span><span class=lnt id=hl-90-10><a class=lnlinks href=#hl-90-10>10</a>
</span><span class=lnt id=hl-90-11><a class=lnlinks href=#hl-90-11>11</a>
</span><span class=lnt id=hl-90-12><a class=lnlinks href=#hl-90-12>12</a>
</span><span class=lnt id=hl-90-13><a class=lnlinks href=#hl-90-13>13</a>
</span><span class=lnt id=hl-90-14><a class=lnlinks href=#hl-90-14>14</a>
</span><span class=lnt id=hl-90-15><a class=lnlinks href=#hl-90-15>15</a>
</span><span class=lnt id=hl-90-16><a class=lnlinks href=#hl-90-16>16</a>
</span><span class=lnt id=hl-90-17><a class=lnlinks href=#hl-90-17>17</a>
</span><span class=lnt id=hl-90-18><a class=lnlinks href=#hl-90-18>18</a>
</span><span class=lnt id=hl-90-19><a class=lnlinks href=#hl-90-19>19</a>
</span><span class=lnt id=hl-90-20><a class=lnlinks href=#hl-90-20>20</a>
</span><span class=lnt id=hl-90-21><a class=lnlinks href=#hl-90-21>21</a>
</span><span class=lnt id=hl-90-22><a class=lnlinks href=#hl-90-22>22</a>
</span><span class=lnt id=hl-90-23><a class=lnlinks href=#hl-90-23>23</a>
</span><span class=lnt id=hl-90-24><a class=lnlinks href=#hl-90-24>24</a>
</span><span class=lnt id=hl-90-25><a class=lnlinks href=#hl-90-25>25</a>
</span><span class=lnt id=hl-90-26><a class=lnlinks href=#hl-90-26>26</a>
</span><span class=lnt id=hl-90-27><a class=lnlinks href=#hl-90-27>27</a>
</span><span class=lnt id=hl-90-28><a class=lnlinks href=#hl-90-28>28</a>
</span><span class=lnt id=hl-90-29><a class=lnlinks href=#hl-90-29>29</a>
</span><span class=lnt id=hl-90-30><a class=lnlinks href=#hl-90-30>30</a>
</span><span class=lnt id=hl-90-31><a class=lnlinks href=#hl-90-31>31</a>
</span><span class=lnt id=hl-90-32><a class=lnlinks href=#hl-90-32>32</a>
</span><span class=lnt id=hl-90-33><a class=lnlinks href=#hl-90-33>33</a>
</span><span class=lnt id=hl-90-34><a class=lnlinks href=#hl-90-34>34</a>
</span><span class=lnt id=hl-90-35><a class=lnlinks href=#hl-90-35>35</a>
</span><span class=lnt id=hl-90-36><a class=lnlinks href=#hl-90-36>36</a>
</span><span class=lnt id=hl-90-37><a class=lnlinks href=#hl-90-37>37</a>
</span><span class=lnt id=hl-90-38><a class=lnlinks href=#hl-90-38>38</a>
</span><span class=lnt id=hl-90-39><a class=lnlinks href=#hl-90-39>39</a>
</span><span class=lnt id=hl-90-40><a class=lnlinks href=#hl-90-40>40</a>
</span><span class=lnt id=hl-90-41><a class=lnlinks href=#hl-90-41>41</a>
</span><span class=lnt id=hl-90-42><a class=lnlinks href=#hl-90-42>42</a>
</span><span class=lnt id=hl-90-43><a class=lnlinks href=#hl-90-43>43</a>
</span><span class=lnt id=hl-90-44><a class=lnlinks href=#hl-90-44>44</a>
</span><span class=lnt id=hl-90-45><a class=lnlinks href=#hl-90-45>45</a>
</span><span class=lnt id=hl-90-46><a class=lnlinks href=#hl-90-46>46</a>
</span><span class=lnt id=hl-90-47><a class=lnlinks href=#hl-90-47>47</a>
</span><span class=lnt id=hl-90-48><a class=lnlinks href=#hl-90-48>48</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Prometheus 메트릭 수집</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>prometheus_client</span> <span class=kn>import</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Histogram</span><span class=p>,</span> <span class=n>Gauge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStoreMetrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 처리 카운터</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events_processed</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;events_processed_total&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Total number of events processed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 저장 지연시간</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_save_duration</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_save_duration_seconds&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Time spent saving events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>buckets</span><span class=o>=</span><span class=p>[</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 프로젝션 지연</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>projection_lag</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;projection_lag_seconds&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Lag between event creation and projection update&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;projection_name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 스토어 크기</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store_size</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_store_size_bytes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Size of the event store&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_event_processed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>success</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;success&#39;</span> <span class=k>if</span> <span class=n>success</span> <span class=k>else</span> <span class=s1>&#39;failure&#39;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events_processed</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>status</span><span class=o>=</span><span class=n>status</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>time_event_save</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_save_duration</span><span class=o>.</span><span class=n>time</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>update_projection_lag</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>projection_name</span><span class=p>,</span> <span class=n>lag_seconds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>projection_lag</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>projection_name</span><span class=o>=</span><span class=n>projection_name</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lag_seconds</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=로깅-전략>로깅 전략<a hidden class=anchor aria-hidden=true href=#로깅-전략>#</a></h4><p><strong>구조화된 로깅</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-91-1><a class=lnlinks href=#hl-91-1> 1</a>
</span><span class=lnt id=hl-91-2><a class=lnlinks href=#hl-91-2> 2</a>
</span><span class=lnt id=hl-91-3><a class=lnlinks href=#hl-91-3> 3</a>
</span><span class=lnt id=hl-91-4><a class=lnlinks href=#hl-91-4> 4</a>
</span><span class=lnt id=hl-91-5><a class=lnlinks href=#hl-91-5> 5</a>
</span><span class=lnt id=hl-91-6><a class=lnlinks href=#hl-91-6> 6</a>
</span><span class=lnt id=hl-91-7><a class=lnlinks href=#hl-91-7> 7</a>
</span><span class=lnt id=hl-91-8><a class=lnlinks href=#hl-91-8> 8</a>
</span><span class=lnt id=hl-91-9><a class=lnlinks href=#hl-91-9> 9</a>
</span><span class=lnt id=hl-91-10><a class=lnlinks href=#hl-91-10>10</a>
</span><span class=lnt id=hl-91-11><a class=lnlinks href=#hl-91-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;component&#34;</span><span class=p>:</span> <span class=s2>&#34;event-store&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=s2>&#34;order-12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;user-789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;correlation_id&#34;</span><span class=p>:</span> <span class=s2>&#34;req-abc123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;duration_ms&#34;</span><span class=p>:</span> <span class=mi>45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>분산 추적 (Distributed Tracing)</strong>:</p><ul><li>OpenTelemetry를 활용한 이벤트 플로우 추적</li><li>마이크로서비스 간 이벤트 전파 경로 시각화</li><li>성능 병목 구간 식별</li></ul><h3 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h3><table><thead><tr><th>구분</th><th>고려사항</th><th>권장사항</th><th>주의점</th></tr></thead><tbody><tr><td><strong>팀 준비도</strong></td><td>새로운 패러다임 학습</td><td>점진적 교육, 전문가 멘토링</td><td>전체 시스템을 한번에 전환하지 말 것</td></tr><tr><td><strong>인프라 준비</strong></td><td>이벤트 저장소 용량 계획</td><td>성장률 분석 후 3배 여유분 확보</td><td>저장소 부족으로 인한 서비스 중단</td></tr><tr><td><strong>데이터 모델링</strong></td><td>이벤트 스키마 설계</td><td>변경에 유연한 스키마 구조</td><td>초기 설계 오류로 인한 마이그레이션 비용</td></tr><tr><td><strong>성능 최적화</strong></td><td>읽기 성능 저하</td><td>CQRS 패턴 필수 적용</td><td>단순 이벤트 재생으로는 실용성 제한</td></tr><tr><td><strong>운영 복잡성</strong></td><td>모니터링 시스템 구축</td><td>전용 관측성 도구 도입</td><td>디버깅 복잡성으로 인한 장애 대응 지연</td></tr><tr><td><strong>비즈니스 연속성</strong></td><td>기존 시스템과의 호환성</td><td>단계적 마이그레이션 계획</td><td>비즈니스 중단 없는 전환 전략 필수</td></tr></tbody></table><h3 id=성능-최적화-전략-및-고려사항>성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략-및-고려사항>#</a></h3><table><thead><tr><th>최적화 영역</th><th>전략</th><th>구현 방법</th><th>기대 효과</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>쓰기 성능</strong></td><td>배치 처리</td><td>이벤트 묶음 저장</td><td>처리량 5-10배 향상</td><td>트랜잭션 크기 조절</td></tr><tr><td><strong>읽기 성능</strong></td><td>프로젝션 최적화</td><td>쿼리별 맞춤형 뷰</td><td>응답 시간 90% 단축</td><td>비정규화 적극 활용</td></tr><tr><td><strong>저장소 성능</strong></td><td>파티셔닝</td><td>시간/집계 기반 분할</td><td>쿼리 성능 70% 향상</td><td>핫 파티션 방지</td></tr><tr><td><strong>네트워크 성능</strong></td><td>이벤트 압축</td><td>gzip, snappy 압축</td><td>대역폭 60% 절약</td><td>CPU vs 대역폭 트레이드오프 고려</td></tr><tr><td><strong>메모리 성능</strong></td><td>스냅샷 전략</td><td>적응형 스냅샷 생성</td><td>메모리 사용량 40% 감소</td><td>스냅샷 빈도 최적화</td></tr><tr><td><strong>동시성 성능</strong></td><td>샤딩</td><td>집계별 분산 처리</td><td>동시 처리량 3-5배 증가</td><td>핫스팟 집계 식별 및 분산</td></tr></tbody></table><p><strong>성능 최적화 구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-92-1><a class=lnlinks href=#hl-92-1> 1</a>
</span><span class=lnt id=hl-92-2><a class=lnlinks href=#hl-92-2> 2</a>
</span><span class=lnt id=hl-92-3><a class=lnlinks href=#hl-92-3> 3</a>
</span><span class=lnt id=hl-92-4><a class=lnlinks href=#hl-92-4> 4</a>
</span><span class=lnt id=hl-92-5><a class=lnlinks href=#hl-92-5> 5</a>
</span><span class=lnt id=hl-92-6><a class=lnlinks href=#hl-92-6> 6</a>
</span><span class=lnt id=hl-92-7><a class=lnlinks href=#hl-92-7> 7</a>
</span><span class=lnt id=hl-92-8><a class=lnlinks href=#hl-92-8> 8</a>
</span><span class=lnt id=hl-92-9><a class=lnlinks href=#hl-92-9> 9</a>
</span><span class=lnt id=hl-92-10><a class=lnlinks href=#hl-92-10>10</a>
</span><span class=lnt id=hl-92-11><a class=lnlinks href=#hl-92-11>11</a>
</span><span class=lnt id=hl-92-12><a class=lnlinks href=#hl-92-12>12</a>
</span><span class=lnt id=hl-92-13><a class=lnlinks href=#hl-92-13>13</a>
</span><span class=lnt id=hl-92-14><a class=lnlinks href=#hl-92-14>14</a>
</span><span class=lnt id=hl-92-15><a class=lnlinks href=#hl-92-15>15</a>
</span><span class=lnt id=hl-92-16><a class=lnlinks href=#hl-92-16>16</a>
</span><span class=lnt id=hl-92-17><a class=lnlinks href=#hl-92-17>17</a>
</span><span class=lnt id=hl-92-18><a class=lnlinks href=#hl-92-18>18</a>
</span><span class=lnt id=hl-92-19><a class=lnlinks href=#hl-92-19>19</a>
</span><span class=lnt id=hl-92-20><a class=lnlinks href=#hl-92-20>20</a>
</span><span class=lnt id=hl-92-21><a class=lnlinks href=#hl-92-21>21</a>
</span><span class=lnt id=hl-92-22><a class=lnlinks href=#hl-92-22>22</a>
</span><span class=lnt id=hl-92-23><a class=lnlinks href=#hl-92-23>23</a>
</span><span class=lnt id=hl-92-24><a class=lnlinks href=#hl-92-24>24</a>
</span><span class=lnt id=hl-92-25><a class=lnlinks href=#hl-92-25>25</a>
</span><span class=lnt id=hl-92-26><a class=lnlinks href=#hl-92-26>26</a>
</span><span class=lnt id=hl-92-27><a class=lnlinks href=#hl-92-27>27</a>
</span><span class=lnt id=hl-92-28><a class=lnlinks href=#hl-92-28>28</a>
</span><span class=lnt id=hl-92-29><a class=lnlinks href=#hl-92-29>29</a>
</span><span class=lnt id=hl-92-30><a class=lnlinks href=#hl-92-30>30</a>
</span><span class=lnt id=hl-92-31><a class=lnlinks href=#hl-92-31>31</a>
</span><span class=lnt id=hl-92-32><a class=lnlinks href=#hl-92-32>32</a>
</span><span class=lnt id=hl-92-33><a class=lnlinks href=#hl-92-33>33</a>
</span><span class=lnt id=hl-92-34><a class=lnlinks href=#hl-92-34>34</a>
</span><span class=lnt id=hl-92-35><a class=lnlinks href=#hl-92-35>35</a>
</span><span class=lnt id=hl-92-36><a class=lnlinks href=#hl-92-36>36</a>
</span><span class=lnt id=hl-92-37><a class=lnlinks href=#hl-92-37>37</a>
</span><span class=lnt id=hl-92-38><a class=lnlinks href=#hl-92-38>38</a>
</span><span class=lnt id=hl-92-39><a class=lnlinks href=#hl-92-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 적응형 스냅샷 전략</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AdaptiveSnapshotStrategy</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_thresholds</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 집계별 스냅샷 임계값</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>performance_history</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 성능 이력</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>should_create_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>event_count</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;동적 스냅샷 생성 판단&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 해당 집계의 이벤트 재생 성능 분석</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_replay_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_average_replay_time</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 성능 기반 동적 임계값 조정</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>avg_replay_time</span> <span class=o>&gt;</span> <span class=mi>1000</span><span class=p>:</span>  <span class=c1># 1초 초과</span>
</span></span><span class=line><span class=cl>            <span class=n>threshold</span> <span class=o>=</span> <span class=mi>50</span>  <span class=c1># 더 자주 스냅샷</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>avg_replay_time</span> <span class=o>&gt;</span> <span class=mi>500</span><span class=p>:</span>  <span class=c1># 0.5초 초과</span>
</span></span><span class=line><span class=cl>            <span class=n>threshold</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>threshold</span> <span class=o>=</span> <span class=mi>200</span>  <span class=c1># 덜 자주 스냅샷</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_thresholds</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>threshold</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>event_count</span> <span class=o>&gt;=</span> <span class=n>threshold</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>optimize_projection_update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;프로젝션 업데이트 최적화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 타입별 배치 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>events_by_type</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>events_by_type</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>events_by_type</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>events_by_type</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 타입별 최적화된 배치 처리</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>event_list</span> <span class=ow>in</span> <span class=n>events_by_type</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderPlaced&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>batch_update_order_summary</span><span class=p>(</span><span class=n>event_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;PaymentProcessed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>batch_update_payment_status</span><span class=p>(</span><span class=n>event_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># … 다른 이벤트 타입 처리</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=phase-6-운영-및-최적화-2>Phase 6: 운영 및 최적화<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-2>#</a></h3><h4 id=보안-및-거버넌스-2>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스-2>#</a></h4><ul><li>이벤트 불변성(Immutable)으로 데이터 변경/삭제 방지</li><li>감사(Audit) 목적에 적합</li><li>보안: DB 접근 제어, 이벤트 스토어 암호화/백업<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">11</a></li></ul><h4 id=모니터링-및-관측성-2>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성-2>#</a></h4><ul><li>이벤트 흐름 및 이벤트 핸들러 상태 모니터링</li><li>이벤트 로그 기반 장애 탐지 및 복구 지원</li><li>메트릭: 이벤트 처리 속도, Stream 지연 등</li></ul><h4 id=실무-적용-고려사항-및-주의점-1>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>권장</th></tr></thead><tbody><tr><td>운영</td><td>이벤트 복잡성</td><td>이벤트모델 과다/과소 설계 방지</td><td>DDD(도메인 주도 설계) 적용</td></tr><tr><td>운영</td><td>Storage 증설</td><td>장기간 용량/성능 고려</td><td>클라우드 기반 자동 확장</td></tr></tbody></table><h4 id=성능-최적화-전략>성능 최적화 전략<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략>#</a></h4><table><thead><tr><th>구분</th><th>전략</th><th>설명</th><th>권장</th></tr></thead><tbody><tr><td>성능</td><td>Snapshot 적용</td><td>주기적 상태 저장</td><td>주기적 (&amp;n > 1000)</td></tr><tr><td>성능</td><td>CQRS</td><td>읽기/쓰기를 분리</td><td>복잡한 도메인 추천</td></tr><tr><td>성능</td><td>이벤트 압축</td><td>불필요 이벤트 만료/압축</td><td>장기 운영 시 필수</td></tr></tbody></table><hr><h3 id=phase-7-고급-주제-1>Phase 7: 고급 주제<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-1>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><ul><li>이벤트 데이터 증대 → 저장소 확장, 효율적 관리 필요<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">4</a></li><li>모델링 난이도, 실무 시스템 통합 문제<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">7</a></li><li>이벤트 순서 불일치 및 데이터 일관성 관리</li><li>장애 발생시 Aggregate별 복구 전략</li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>기술</th><th>통합 생태계</th><th>표준/프로토콜</th></tr></thead><tbody><tr><td>Kafka, EventStore, RabbitMQ</td><td>이벤트 브로커, 마이크로서비스와 연동</td><td>클라우드(CloudEvents), 오픈표준(AWS, Azure)</td></tr></tbody></table><h4 id=최신-트렌드와-미래-방향>최신 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-트렌드와-미래-방향>#</a></h4><ul><li>AI/ML 기반 이벤트 분석 및 최적화</li><li>마이크로서비스 연동에서 표준화, Observability 강조</li><li>Serverless, EventBridge, EventStoreDB 등 신기술 적용 증가</li></ul><h4 id=기타-고급-사항>기타 고급 사항<a hidden class=anchor aria-hidden=true href=#기타-고급-사항>#</a></h4><ul><li>멱등성, 이벤트 순서 보장, 롤백 처리, GDPR 등 데이터 거버넌스 필요</li></ul><h2 id=phase-7-고급-주제-advanced-topics-2>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics-2>#</a></h2><h3 id=현재-도전-과제-1>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제-1>#</a></h3><table><thead><tr><th>도전 과제</th><th>원인</th><th>영향</th><th>해결방안</th></tr></thead><tbody><tr><td><strong>이벤트 스키마 진화</strong></td><td>비즈니스 요구사항 변화, 도메인 모델 발전</td><td>하위 호환성 문제, 이벤트 재생 실패</td><td>스키마 버전 관리, 멀티 버전 핸들러, 이벤트 업캐스팅</td></tr><tr><td><strong>대용량 이벤트 스트림</strong></td><td>사업 성장, 실시간 요구사항 증가</td><td>성능 저하, 저장 비용 증가</td><td>계층형 저장소, 지능형 아카이빙, 병렬 처리</td></tr><tr><td><strong>복합 비즈니스 트랜잭션</strong></td><td>마이크로서비스 간 데이터 일관성</td><td>부분 실패, 데이터 불일치</td><td>Saga 패턴, 프로세스 매니저, 보상 트랜잭션</td></tr><tr><td><strong>실시간 이벤트 처리</strong></td><td>낮은 지연시간 요구, 높은 처리량</td><td>시스템 복잡성 증가, 운영 부담</td><td>스트림 처리 플랫폼, 인메모리 계산, 엣지 컴퓨팅</td></tr><tr><td><strong>다중 클라우드 환경</strong></td><td>클라우드 중립성, 재해 복구</td><td>일관성 관리, 네트워크 지연</td><td>글로벌 이벤트 복제, 충돌 해결 알고리즘</td></tr></tbody></table><p><strong>해결방안 구현 예시 (이벤트 업캐스팅)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-93-1><a class=lnlinks href=#hl-93-1> 1</a>
</span><span class=lnt id=hl-93-2><a class=lnlinks href=#hl-93-2> 2</a>
</span><span class=lnt id=hl-93-3><a class=lnlinks href=#hl-93-3> 3</a>
</span><span class=lnt id=hl-93-4><a class=lnlinks href=#hl-93-4> 4</a>
</span><span class=lnt id=hl-93-5><a class=lnlinks href=#hl-93-5> 5</a>
</span><span class=lnt id=hl-93-6><a class=lnlinks href=#hl-93-6> 6</a>
</span><span class=lnt id=hl-93-7><a class=lnlinks href=#hl-93-7> 7</a>
</span><span class=lnt id=hl-93-8><a class=lnlinks href=#hl-93-8> 8</a>
</span><span class=lnt id=hl-93-9><a class=lnlinks href=#hl-93-9> 9</a>
</span><span class=lnt id=hl-93-10><a class=lnlinks href=#hl-93-10>10</a>
</span><span class=lnt id=hl-93-11><a class=lnlinks href=#hl-93-11>11</a>
</span><span class=lnt id=hl-93-12><a class=lnlinks href=#hl-93-12>12</a>
</span><span class=lnt id=hl-93-13><a class=lnlinks href=#hl-93-13>13</a>
</span><span class=lnt id=hl-93-14><a class=lnlinks href=#hl-93-14>14</a>
</span><span class=lnt id=hl-93-15><a class=lnlinks href=#hl-93-15>15</a>
</span><span class=lnt id=hl-93-16><a class=lnlinks href=#hl-93-16>16</a>
</span><span class=lnt id=hl-93-17><a class=lnlinks href=#hl-93-17>17</a>
</span><span class=lnt id=hl-93-18><a class=lnlinks href=#hl-93-18>18</a>
</span><span class=lnt id=hl-93-19><a class=lnlinks href=#hl-93-19>19</a>
</span><span class=lnt id=hl-93-20><a class=lnlinks href=#hl-93-20>20</a>
</span><span class=lnt id=hl-93-21><a class=lnlinks href=#hl-93-21>21</a>
</span><span class=lnt id=hl-93-22><a class=lnlinks href=#hl-93-22>22</a>
</span><span class=lnt id=hl-93-23><a class=lnlinks href=#hl-93-23>23</a>
</span><span class=lnt id=hl-93-24><a class=lnlinks href=#hl-93-24>24</a>
</span><span class=lnt id=hl-93-25><a class=lnlinks href=#hl-93-25>25</a>
</span><span class=lnt id=hl-93-26><a class=lnlinks href=#hl-93-26>26</a>
</span><span class=lnt id=hl-93-27><a class=lnlinks href=#hl-93-27>27</a>
</span><span class=lnt id=hl-93-28><a class=lnlinks href=#hl-93-28>28</a>
</span><span class=lnt id=hl-93-29><a class=lnlinks href=#hl-93-29>29</a>
</span><span class=lnt id=hl-93-30><a class=lnlinks href=#hl-93-30>30</a>
</span><span class=lnt id=hl-93-31><a class=lnlinks href=#hl-93-31>31</a>
</span><span class=lnt id=hl-93-32><a class=lnlinks href=#hl-93-32>32</a>
</span><span class=lnt id=hl-93-33><a class=lnlinks href=#hl-93-33>33</a>
</span><span class=lnt id=hl-93-34><a class=lnlinks href=#hl-93-34>34</a>
</span><span class=lnt id=hl-93-35><a class=lnlinks href=#hl-93-35>35</a>
</span><span class=lnt id=hl-93-36><a class=lnlinks href=#hl-93-36>36</a>
</span><span class=lnt id=hl-93-37><a class=lnlinks href=#hl-93-37>37</a>
</span><span class=lnt id=hl-93-38><a class=lnlinks href=#hl-93-38>38</a>
</span><span class=lnt id=hl-93-39><a class=lnlinks href=#hl-93-39>39</a>
</span><span class=lnt id=hl-93-40><a class=lnlinks href=#hl-93-40>40</a>
</span><span class=lnt id=hl-93-41><a class=lnlinks href=#hl-93-41>41</a>
</span><span class=lnt id=hl-93-42><a class=lnlinks href=#hl-93-42>42</a>
</span><span class=lnt id=hl-93-43><a class=lnlinks href=#hl-93-43>43</a>
</span><span class=lnt id=hl-93-44><a class=lnlinks href=#hl-93-44>44</a>
</span><span class=lnt id=hl-93-45><a class=lnlinks href=#hl-93-45>45</a>
</span><span class=lnt id=hl-93-46><a class=lnlinks href=#hl-93-46>46</a>
</span><span class=lnt id=hl-93-47><a class=lnlinks href=#hl-93-47>47</a>
</span><span class=lnt id=hl-93-48><a class=lnlinks href=#hl-93-48>48</a>
</span><span class=lnt id=hl-93-49><a class=lnlinks href=#hl-93-49>49</a>
</span><span class=lnt id=hl-93-50><a class=lnlinks href=#hl-93-50>50</a>
</span><span class=lnt id=hl-93-51><a class=lnlinks href=#hl-93-51>51</a>
</span><span class=lnt id=hl-93-52><a class=lnlinks href=#hl-93-52>52</a>
</span><span class=lnt id=hl-93-53><a class=lnlinks href=#hl-93-53>53</a>
</span><span class=lnt id=hl-93-54><a class=lnlinks href=#hl-93-54>54</a>
</span><span class=lnt id=hl-93-55><a class=lnlinks href=#hl-93-55>55</a>
</span><span class=lnt id=hl-93-56><a class=lnlinks href=#hl-93-56>56</a>
</span><span class=lnt id=hl-93-57><a class=lnlinks href=#hl-93-57>57</a>
</span><span class=lnt id=hl-93-58><a class=lnlinks href=#hl-93-58>58</a>
</span><span class=lnt id=hl-93-59><a class=lnlinks href=#hl-93-59>59</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 이벤트 스키마 진화를 위한 업캐스팅 시스템</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventUpcaster</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upcasters</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>register_upcasters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_upcasters</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;버전별 업캐스터 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># OrderPlaced v1 -&gt; v2 업캐스터</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upcasters</span><span class=p>[(</span><span class=s1>&#39;OrderPlaced&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>upcast_order_placed_v1_to_v2</span>
</span></span><span class=line><span class=cl>        <span class=c1># OrderPlaced v2 -&gt; v3 업캐스터  </span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upcasters</span><span class=p>[(</span><span class=s1>&#39;OrderPlaced&#39;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>upcast_order_placed_v2_to_v3</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>upcast_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>from_version</span><span class=p>,</span> <span class=n>to_version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 대상 버전으로 업캐스트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=n>from_version</span>
</span></span><span class=line><span class=cl>        <span class=n>current_data</span> <span class=o>=</span> <span class=n>event_data</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 단계별 업캐스팅</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>current_version</span> <span class=o>&lt;</span> <span class=n>to_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>next_version</span> <span class=o>=</span> <span class=n>current_version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>upcaster_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>event_type</span><span class=p>,</span> <span class=n>current_version</span><span class=p>,</span> <span class=n>next_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>upcaster_key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>upcasters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>upcasters</span><span class=p>[</span><span class=n>upcaster_key</span><span class=p>](</span><span class=n>current_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>current_version</span> <span class=o>=</span> <span class=n>next_version</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No upcaster found for </span><span class=si>{</span><span class=n>upcaster_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>current_data</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>upcast_order_placed_v1_to_v2</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>v1_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;OrderPlaced v1 -&gt; v2 변환 (배송 정보 추가)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>v2_data</span> <span class=o>=</span> <span class=n>v1_data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># v2에서 추가된 shipping_address 필드</span>
</span></span><span class=line><span class=cl>        <span class=c1># v1에서는 billing_address를 shipping_address로 복사</span>
</span></span><span class=line><span class=cl>        <span class=n>v2_data</span><span class=p>[</span><span class=s1>&#39;shipping_address&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;billing_address&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># v2에서 추가된 delivery_preference 필드 (기본값)</span>
</span></span><span class=line><span class=cl>        <span class=n>v2_data</span><span class=p>[</span><span class=s1>&#39;delivery_preference&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;standard&#39;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>v2_data</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>upcast_order_placed_v2_to_v3</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>v2_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;OrderPlaced v2 -&gt; v3 변환 (다중 통화 지원)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>v3_data</span> <span class=o>=</span> <span class=n>v2_data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># v3에서 통화 정보 추가 (기본값: USD)</span>
</span></span><span class=line><span class=cl>        <span class=n>v3_data</span><span class=p>[</span><span class=s1>&#39;currency&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;USD&#39;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 기존 금액 필드를 currency_amounts 구조로 변환</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s1>&#39;total_amount&#39;</span> <span class=ow>in</span> <span class=n>v2_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>v3_data</span><span class=p>[</span><span class=s1>&#39;currency_amounts&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;USD&#39;</span><span class=p>:</span> <span class=n>v2_data</span><span class=p>[</span><span class=s1>&#39;total_amount&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1># 하위 호환성을 위해 total_amount 유지</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>v3_data</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=생태계-및-관련-기술-1>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술-1>#</a></h3><h4 id=메시지-브로커-및-스트리밍-플랫폼>메시지 브로커 및 스트리밍 플랫폼<a hidden class=anchor aria-hidden=true href=#메시지-브로커-및-스트리밍-플랫폼>#</a></h4><table><thead><tr><th>기술</th><th>특징</th><th>적용 분야</th><th>Event Sourcing 연계</th></tr></thead><tbody><tr><td><strong>Apache Kafka</strong></td><td>높은 처리량, 분산 복제</td><td>대규모 실시간 처리</td><td>이벤트 스토어, 이벤트 버스</td></tr><tr><td><strong>Amazon Kinesis</strong></td><td>완전 관리형, AWS 통합</td><td>클라우드 네이티브</td><td>스트림 처리, 실시간 분석</td></tr><tr><td><strong>EventStore DB</strong></td><td>이벤트 소싱 전용</td><td>금융, 도메인 복잡성 높은 시스템</td><td>네이티브 Event Store</td></tr><tr><td><strong>Redis Streams</strong></td><td>인메모리, 빠른 처리</td><td>실시간 알림, 세션 관리</td><td>경량 이벤트 버스</td></tr><tr><td><strong>Apache Pulsar</strong></td><td>멀티 테넌트, 지리적 복제</td><td>글로벌 분산 시스템</td><td>다중 클라우드 이벤트 복제</td></tr></tbody></table><h4 id=프로젝션-및-뷰-생성-도구>프로젝션 및 뷰 생성 도구<a hidden class=anchor aria-hidden=true href=#프로젝션-및-뷰-생성-도구>#</a></h4><table><thead><tr><th>도구</th><th>목적</th><th>핵심 기능</th><th>통합 방법</th></tr></thead><tbody><tr><td><strong>Kafka Streams</strong></td><td>스트림 처리</td><td>실시간 집계, 윈도우 연산</td><td>이벤트 스트림으로부터 프로젝션 생성</td></tr><tr><td><strong>Apache Flink</strong></td><td>복잡한 이벤트 처리</td><td>상태 관리, 정확히 한 번 처리</td><td>고급 비즈니스 로직 프로젝션</td></tr><tr><td><strong>ksqlDB</strong></td><td>SQL 기반 스트림 처리</td><td>선언적 쿼리</td><td>비개발자도 쉽게 뷰 생성</td></tr><tr><td><strong>Materialize</strong></td><td>실시간 SQL 뷰</td><td>증분 뷰 유지</td><td>복잡한 조인 프로젝션</td></tr></tbody></table><h4 id=표준-및-프로토콜>표준 및 프로토콜<a hidden class=anchor aria-hidden=true href=#표준-및-프로토콜>#</a></h4><p><strong>CloudEvents 표준</strong>:</p><ul><li>CNCF (Cloud Native Computing Foundation) 표준</li><li>이벤트 메타데이터 표준화</li><li>클라우드 간 상호 운용성 보장</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-94-1><a class=lnlinks href=#hl-94-1> 1</a>
</span><span class=lnt id=hl-94-2><a class=lnlinks href=#hl-94-2> 2</a>
</span><span class=lnt id=hl-94-3><a class=lnlinks href=#hl-94-3> 3</a>
</span><span class=lnt id=hl-94-4><a class=lnlinks href=#hl-94-4> 4</a>
</span><span class=lnt id=hl-94-5><a class=lnlinks href=#hl-94-5> 5</a>
</span><span class=lnt id=hl-94-6><a class=lnlinks href=#hl-94-6> 6</a>
</span><span class=lnt id=hl-94-7><a class=lnlinks href=#hl-94-7> 7</a>
</span><span class=lnt id=hl-94-8><a class=lnlinks href=#hl-94-8> 8</a>
</span><span class=lnt id=hl-94-9><a class=lnlinks href=#hl-94-9> 9</a>
</span><span class=lnt id=hl-94-10><a class=lnlinks href=#hl-94-10>10</a>
</span><span class=lnt id=hl-94-11><a class=lnlinks href=#hl-94-11>11</a>
</span><span class=lnt id=hl-94-12><a class=lnlinks href=#hl-94-12>12</a>
</span><span class=lnt id=hl-94-13><a class=lnlinks href=#hl-94-13>13</a>
</span><span class=lnt id=hl-94-14><a class=lnlinks href=#hl-94-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;specversion&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;com.example.order.placed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;a234-1234-1234&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;datacontenttype&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subject&#34;</span><span class=p>:</span> <span class=s2>&#34;order/12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;orderId&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customerId&#34;</span><span class=p>:</span> <span class=s2>&#34;customer-789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>99.99</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>AsyncAPI 명세</strong>:</p><ul><li>이벤트 기반 API 문서화</li><li>이벤트 스키마 정의 및 관리</li><li>개발자 경험 향상</li></ul><h3 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h3><h4 id=1-서버리스-event-sourcing>1. 서버리스 Event Sourcing<a hidden class=anchor aria-hidden=true href=#1-서버리스-event-sourcing>#</a></h4><p><strong>트렌드</strong>: FaaS(Function as a Service) 환경에서의 이벤트 소싱
<strong>기술</strong>: AWS Lambda, Azure Functions, Google Cloud Functions
<strong>장점</strong>:</p><ul><li>운영 부담 최소화</li><li>자동 스케일링</li><li>비용 효율성</li></ul><p><strong>구현 예시 (AWS Lambda)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-95-1><a class=lnlinks href=#hl-95-1> 1</a>
</span><span class=lnt id=hl-95-2><a class=lnlinks href=#hl-95-2> 2</a>
</span><span class=lnt id=hl-95-3><a class=lnlinks href=#hl-95-3> 3</a>
</span><span class=lnt id=hl-95-4><a class=lnlinks href=#hl-95-4> 4</a>
</span><span class=lnt id=hl-95-5><a class=lnlinks href=#hl-95-5> 5</a>
</span><span class=lnt id=hl-95-6><a class=lnlinks href=#hl-95-6> 6</a>
</span><span class=lnt id=hl-95-7><a class=lnlinks href=#hl-95-7> 7</a>
</span><span class=lnt id=hl-95-8><a class=lnlinks href=#hl-95-8> 8</a>
</span><span class=lnt id=hl-95-9><a class=lnlinks href=#hl-95-9> 9</a>
</span><span class=lnt id=hl-95-10><a class=lnlinks href=#hl-95-10>10</a>
</span><span class=lnt id=hl-95-11><a class=lnlinks href=#hl-95-11>11</a>
</span><span class=lnt id=hl-95-12><a class=lnlinks href=#hl-95-12>12</a>
</span><span class=lnt id=hl-95-13><a class=lnlinks href=#hl-95-13>13</a>
</span><span class=lnt id=hl-95-14><a class=lnlinks href=#hl-95-14>14</a>
</span><span class=lnt id=hl-95-15><a class=lnlinks href=#hl-95-15>15</a>
</span><span class=lnt id=hl-95-16><a class=lnlinks href=#hl-95-16>16</a>
</span><span class=lnt id=hl-95-17><a class=lnlinks href=#hl-95-17>17</a>
</span><span class=lnt id=hl-95-18><a class=lnlinks href=#hl-95-18>18</a>
</span><span class=lnt id=hl-95-19><a class=lnlinks href=#hl-95-19>19</a>
</span><span class=lnt id=hl-95-20><a class=lnlinks href=#hl-95-20>20</a>
</span><span class=lnt id=hl-95-21><a class=lnlinks href=#hl-95-21>21</a>
</span><span class=lnt id=hl-95-22><a class=lnlinks href=#hl-95-22>22</a>
</span><span class=lnt id=hl-95-23><a class=lnlinks href=#hl-95-23>23</a>
</span><span class=lnt id=hl-95-24><a class=lnlinks href=#hl-95-24>24</a>
</span><span class=lnt id=hl-95-25><a class=lnlinks href=#hl-95-25>25</a>
</span><span class=lnt id=hl-95-26><a class=lnlinks href=#hl-95-26>26</a>
</span><span class=lnt id=hl-95-27><a class=lnlinks href=#hl-95-27>27</a>
</span><span class=lnt id=hl-95-28><a class=lnlinks href=#hl-95-28>28</a>
</span><span class=lnt id=hl-95-29><a class=lnlinks href=#hl-95-29>29</a>
</span><span class=lnt id=hl-95-30><a class=lnlinks href=#hl-95-30>30</a>
</span><span class=lnt id=hl-95-31><a class=lnlinks href=#hl-95-31>31</a>
</span><span class=lnt id=hl-95-32><a class=lnlinks href=#hl-95-32>32</a>
</span><span class=lnt id=hl-95-33><a class=lnlinks href=#hl-95-33>33</a>
</span><span class=lnt id=hl-95-34><a class=lnlinks href=#hl-95-34>34</a>
</span><span class=lnt id=hl-95-35><a class=lnlinks href=#hl-95-35>35</a>
</span><span class=lnt id=hl-95-36><a class=lnlinks href=#hl-95-36>36</a>
</span><span class=lnt id=hl-95-37><a class=lnlinks href=#hl-95-37>37</a>
</span><span class=lnt id=hl-95-38><a class=lnlinks href=#hl-95-38>38</a>
</span><span class=lnt id=hl-95-39><a class=lnlinks href=#hl-95-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 서버리스 이벤트 핸들러</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aws_lambda_powertools</span> <span class=kn>import</span> <span class=n>Logger</span><span class=p>,</span> <span class=n>Tracer</span><span class=p>,</span> <span class=n>Metrics</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>Logger</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>tracer</span> <span class=o>=</span> <span class=n>Tracer</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>metrics</span> <span class=o>=</span> <span class=n>Metrics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@tracer.capture_lambda_handler</span>
</span></span><span class=line><span class=cl><span class=nd>@logger.inject_lambda_context</span>
</span></span><span class=line><span class=cl><span class=nd>@metrics.log_metrics</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;DynamoDB Streams에서 이벤트를 수신하여 프로젝션 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;Records&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>record</span><span class=p>[</span><span class=s1>&#39;eventName&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;INSERT&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 새 이벤트 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>][</span><span class=s1>&#39;NewImage&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>process_new_event</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메트릭 기록</span>
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>add_metric</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;EventsProcessed&#34;</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&#34;Count&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;statusCode&#39;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=s1>&#39;Events processed successfully&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_new_event</span><span class=p>(</span><span class=n>event_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 기반 프로젝션 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>][</span><span class=s1>&#39;S&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderPlaced&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>update_order_summary_projection</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;PaymentProcessed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>update_payment_status_projection</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processed event: </span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-edge-computing과-event-sourcing>2. Edge Computing과 Event Sourcing<a hidden class=anchor aria-hidden=true href=#2-edge-computing과-event-sourcing>#</a></h4><p><strong>트렌드</strong>: IoT와 엣지 환경에서의 이벤트 처리
<strong>도전과제</strong>: 네트워크 제약, 오프라인 시나리오
<strong>해결책</strong>: 로컬 이벤트 스토어, 지능형 동기화</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-96-1><a class=lnlinks href=#hl-96-1> 1</a>
</span><span class=lnt id=hl-96-2><a class=lnlinks href=#hl-96-2> 2</a>
</span><span class=lnt id=hl-96-3><a class=lnlinks href=#hl-96-3> 3</a>
</span><span class=lnt id=hl-96-4><a class=lnlinks href=#hl-96-4> 4</a>
</span><span class=lnt id=hl-96-5><a class=lnlinks href=#hl-96-5> 5</a>
</span><span class=lnt id=hl-96-6><a class=lnlinks href=#hl-96-6> 6</a>
</span><span class=lnt id=hl-96-7><a class=lnlinks href=#hl-96-7> 7</a>
</span><span class=lnt id=hl-96-8><a class=lnlinks href=#hl-96-8> 8</a>
</span><span class=lnt id=hl-96-9><a class=lnlinks href=#hl-96-9> 9</a>
</span><span class=lnt id=hl-96-10><a class=lnlinks href=#hl-96-10>10</a>
</span><span class=lnt id=hl-96-11><a class=lnlinks href=#hl-96-11>11</a>
</span><span class=lnt id=hl-96-12><a class=lnlinks href=#hl-96-12>12</a>
</span><span class=lnt id=hl-96-13><a class=lnlinks href=#hl-96-13>13</a>
</span><span class=lnt id=hl-96-14><a class=lnlinks href=#hl-96-14>14</a>
</span><span class=lnt id=hl-96-15><a class=lnlinks href=#hl-96-15>15</a>
</span><span class=lnt id=hl-96-16><a class=lnlinks href=#hl-96-16>16</a>
</span><span class=lnt id=hl-96-17><a class=lnlinks href=#hl-96-17>17</a>
</span><span class=lnt id=hl-96-18><a class=lnlinks href=#hl-96-18>18</a>
</span><span class=lnt id=hl-96-19><a class=lnlinks href=#hl-96-19>19</a>
</span><span class=lnt id=hl-96-20><a class=lnlinks href=#hl-96-20>20</a>
</span><span class=lnt id=hl-96-21><a class=lnlinks href=#hl-96-21>21</a>
</span><span class=lnt id=hl-96-22><a class=lnlinks href=#hl-96-22>22</a>
</span><span class=lnt id=hl-96-23><a class=lnlinks href=#hl-96-23>23</a>
</span><span class=lnt id=hl-96-24><a class=lnlinks href=#hl-96-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 엣지 디바이스용 경량 이벤트 스토어</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EdgeEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>sync_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>local_store</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 로컬 메모리 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sync_service</span> <span class=o>=</span> <span class=n>sync_service</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_sync</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;로컬에 이벤트 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span><span class=o>.</span><span class=n>local_timestamp</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>local_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 네트워크 가용시 백그라운드 동기화</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_online</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>background_sync</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>background_sync</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;클라우드와 비동기 동기화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>unsync_events</span> <span class=o>=</span> <span class=p>[</span><span class=n>e</span> <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>local_store</span> 
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>local_timestamp</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_sync</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>unsync_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>sync_service</span><span class=o>.</span><span class=n>sync_to_cloud</span><span class=p>(</span><span class=n>unsync_events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>last_sync</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-aiml과-event-sourcing-통합>3. AI/ML과 Event Sourcing 통합<a hidden class=anchor aria-hidden=true href=#3-aiml과-event-sourcing-통합>#</a></h4><p><strong>트렌드</strong>: 이벤트 데이터를 활용한 실시간 머신러닝
<strong>응용 분야</strong>: 이상 탐지, 추천 시스템, 예측 분석</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-97-1><a class=lnlinks href=#hl-97-1> 1</a>
</span><span class=lnt id=hl-97-2><a class=lnlinks href=#hl-97-2> 2</a>
</span><span class=lnt id=hl-97-3><a class=lnlinks href=#hl-97-3> 3</a>
</span><span class=lnt id=hl-97-4><a class=lnlinks href=#hl-97-4> 4</a>
</span><span class=lnt id=hl-97-5><a class=lnlinks href=#hl-97-5> 5</a>
</span><span class=lnt id=hl-97-6><a class=lnlinks href=#hl-97-6> 6</a>
</span><span class=lnt id=hl-97-7><a class=lnlinks href=#hl-97-7> 7</a>
</span><span class=lnt id=hl-97-8><a class=lnlinks href=#hl-97-8> 8</a>
</span><span class=lnt id=hl-97-9><a class=lnlinks href=#hl-97-9> 9</a>
</span><span class=lnt id=hl-97-10><a class=lnlinks href=#hl-97-10>10</a>
</span><span class=lnt id=hl-97-11><a class=lnlinks href=#hl-97-11>11</a>
</span><span class=lnt id=hl-97-12><a class=lnlinks href=#hl-97-12>12</a>
</span><span class=lnt id=hl-97-13><a class=lnlinks href=#hl-97-13>13</a>
</span><span class=lnt id=hl-97-14><a class=lnlinks href=#hl-97-14>14</a>
</span><span class=lnt id=hl-97-15><a class=lnlinks href=#hl-97-15>15</a>
</span><span class=lnt id=hl-97-16><a class=lnlinks href=#hl-97-16>16</a>
</span><span class=lnt id=hl-97-17><a class=lnlinks href=#hl-97-17>17</a>
</span><span class=lnt id=hl-97-18><a class=lnlinks href=#hl-97-18>18</a>
</span><span class=lnt id=hl-97-19><a class=lnlinks href=#hl-97-19>19</a>
</span><span class=lnt id=hl-97-20><a class=lnlinks href=#hl-97-20>20</a>
</span><span class=lnt id=hl-97-21><a class=lnlinks href=#hl-97-21>21</a>
</span><span class=lnt id=hl-97-22><a class=lnlinks href=#hl-97-22>22</a>
</span><span class=lnt id=hl-97-23><a class=lnlinks href=#hl-97-23>23</a>
</span><span class=lnt id=hl-97-24><a class=lnlinks href=#hl-97-24>24</a>
</span><span class=lnt id=hl-97-25><a class=lnlinks href=#hl-97-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 실시간 ML 파이프라인과 Event Sourcing 통합</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MLEventProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model_service</span> <span class=o>=</span> <span class=n>model_service</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>feature_store</span> <span class=o>=</span> <span class=n>FeatureStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 기반 실시간 ML 추론&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트로부터 피처 추출</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_features</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 추론</span>
</span></span><span class=line><span class=cl>        <span class=n>prediction</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_service</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>features</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이상 탐지 결과를 새로운 이벤트로 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>prediction</span><span class=o>.</span><span class=n>is_anomaly</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>anomaly_event</span> <span class=o>=</span> <span class=n>AnomalyDetected</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>original_event_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>anomaly_score</span><span class=o>=</span><span class=n>prediction</span><span class=o>.</span><span class=n>score</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>detected_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=n>anomaly_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 피처 스토어 업데이트 (모델 재학습용)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>feature_store</span><span class=o>.</span><span class=n>update_features</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> <span class=n>features</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=4-양자-컴퓨팅-시대의-event-sourcing>4. 양자 컴퓨팅 시대의 Event Sourcing<a hidden class=anchor aria-hidden=true href=#4-양자-컴퓨팅-시대의-event-sourcing>#</a></h4><p><strong>미래 전망</strong>: 양자 컴퓨팅 환경에서의 이벤트 암호화
<strong>고려사항</strong>: 양자 내성 암호화, 새로운 보안 패러다임</p><h3 id=기타-고급-사항-1>기타 고급 사항<a hidden class=anchor aria-hidden=true href=#기타-고급-사항-1>#</a></h3><h4 id=멀티-테넌트-event-sourcing>멀티 테넌트 Event Sourcing<a hidden class=anchor aria-hidden=true href=#멀티-테넌트-event-sourcing>#</a></h4><p><strong>도전과제</strong>: 테넌트 간 격리, 성능 분리, 데이터 주권</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-98-1><a class=lnlinks href=#hl-98-1> 1</a>
</span><span class=lnt id=hl-98-2><a class=lnlinks href=#hl-98-2> 2</a>
</span><span class=lnt id=hl-98-3><a class=lnlinks href=#hl-98-3> 3</a>
</span><span class=lnt id=hl-98-4><a class=lnlinks href=#hl-98-4> 4</a>
</span><span class=lnt id=hl-98-5><a class=lnlinks href=#hl-98-5> 5</a>
</span><span class=lnt id=hl-98-6><a class=lnlinks href=#hl-98-6> 6</a>
</span><span class=lnt id=hl-98-7><a class=lnlinks href=#hl-98-7> 7</a>
</span><span class=lnt id=hl-98-8><a class=lnlinks href=#hl-98-8> 8</a>
</span><span class=lnt id=hl-98-9><a class=lnlinks href=#hl-98-9> 9</a>
</span><span class=lnt id=hl-98-10><a class=lnlinks href=#hl-98-10>10</a>
</span><span class=lnt id=hl-98-11><a class=lnlinks href=#hl-98-11>11</a>
</span><span class=lnt id=hl-98-12><a class=lnlinks href=#hl-98-12>12</a>
</span><span class=lnt id=hl-98-13><a class=lnlinks href=#hl-98-13>13</a>
</span><span class=lnt id=hl-98-14><a class=lnlinks href=#hl-98-14>14</a>
</span><span class=lnt id=hl-98-15><a class=lnlinks href=#hl-98-15>15</a>
</span><span class=lnt id=hl-98-16><a class=lnlinks href=#hl-98-16>16</a>
</span><span class=lnt id=hl-98-17><a class=lnlinks href=#hl-98-17>17</a>
</span><span class=lnt id=hl-98-18><a class=lnlinks href=#hl-98-18>18</a>
</span><span class=lnt id=hl-98-19><a class=lnlinks href=#hl-98-19>19</a>
</span><span class=lnt id=hl-98-20><a class=lnlinks href=#hl-98-20>20</a>
</span><span class=lnt id=hl-98-21><a class=lnlinks href=#hl-98-21>21</a>
</span><span class=lnt id=hl-98-22><a class=lnlinks href=#hl-98-22>22</a>
</span><span class=lnt id=hl-98-23><a class=lnlinks href=#hl-98-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 멀티 테넌트 이벤트 스토어</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MultiTenantEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>partitioning_strategy</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>partitioning_strategy</span> <span class=o>=</span> <span class=n>partitioning_strategy</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tenant_stores</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_tenant_store</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tenant_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;테넌트별 전용 스토어 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tenant_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>tenant_stores</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 테넌트별 별도 파티션/DB</span>
</span></span><span class=line><span class=cl>            <span class=n>partition_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>partitioning_strategy</span><span class=o>.</span><span class=n>get_partition</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>tenant_stores</span><span class=p>[</span><span class=n>tenant_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>(</span><span class=n>partition_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tenant_stores</span><span class=p>[</span><span class=n>tenant_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tenant_id</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;테넌트 격리된 이벤트 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 테넌트 ID 검증</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_tenant_access</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>UnauthorizedError</span><span class=p>(</span><span class=s2>&#34;Tenant access denied&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>store</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tenant_store</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=지리적-분산-event-sourcing>지리적 분산 Event Sourcing<a hidden class=anchor aria-hidden=true href=#지리적-분산-event-sourcing>#</a></h4><p><strong>패턴</strong>: Active-Active 복제, 충돌 해결
<strong>기술</strong>: CRDT (Conflict-free Replicated Data Types), Vector Clocks</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-99-1><a class=lnlinks href=#hl-99-1> 1</a>
</span><span class=lnt id=hl-99-2><a class=lnlinks href=#hl-99-2> 2</a>
</span><span class=lnt id=hl-99-3><a class=lnlinks href=#hl-99-3> 3</a>
</span><span class=lnt id=hl-99-4><a class=lnlinks href=#hl-99-4> 4</a>
</span><span class=lnt id=hl-99-5><a class=lnlinks href=#hl-99-5> 5</a>
</span><span class=lnt id=hl-99-6><a class=lnlinks href=#hl-99-6> 6</a>
</span><span class=lnt id=hl-99-7><a class=lnlinks href=#hl-99-7> 7</a>
</span><span class=lnt id=hl-99-8><a class=lnlinks href=#hl-99-8> 8</a>
</span><span class=lnt id=hl-99-9><a class=lnlinks href=#hl-99-9> 9</a>
</span><span class=lnt id=hl-99-10><a class=lnlinks href=#hl-99-10>10</a>
</span><span class=lnt id=hl-99-11><a class=lnlinks href=#hl-99-11>11</a>
</span><span class=lnt id=hl-99-12><a class=lnlinks href=#hl-99-12>12</a>
</span><span class=lnt id=hl-99-13><a class=lnlinks href=#hl-99-13>13</a>
</span><span class=lnt id=hl-99-14><a class=lnlinks href=#hl-99-14>14</a>
</span><span class=lnt id=hl-99-15><a class=lnlinks href=#hl-99-15>15</a>
</span><span class=lnt id=hl-99-16><a class=lnlinks href=#hl-99-16>16</a>
</span><span class=lnt id=hl-99-17><a class=lnlinks href=#hl-99-17>17</a>
</span><span class=lnt id=hl-99-18><a class=lnlinks href=#hl-99-18>18</a>
</span><span class=lnt id=hl-99-19><a class=lnlinks href=#hl-99-19>19</a>
</span><span class=lnt id=hl-99-20><a class=lnlinks href=#hl-99-20>20</a>
</span><span class=lnt id=hl-99-21><a class=lnlinks href=#hl-99-21>21</a>
</span><span class=lnt id=hl-99-22><a class=lnlinks href=#hl-99-22>22</a>
</span><span class=lnt id=hl-99-23><a class=lnlinks href=#hl-99-23>23</a>
</span><span class=lnt id=hl-99-24><a class=lnlinks href=#hl-99-24>24</a>
</span><span class=lnt id=hl-99-25><a class=lnlinks href=#hl-99-25>25</a>
</span><span class=lnt id=hl-99-26><a class=lnlinks href=#hl-99-26>26</a>
</span><span class=lnt id=hl-99-27><a class=lnlinks href=#hl-99-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 지리적 분산 이벤트 복제</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GeographicallyDistributedEventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>region</span><span class=p>,</span> <span class=n>peer_regions</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>region</span> <span class=o>=</span> <span class=n>region</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>peer_regions</span> <span class=o>=</span> <span class=n>peer_regions</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>vector_clock</span> <span class=o>=</span> <span class=n>VectorClock</span><span class=p>(</span><span class=n>region</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>replicate_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;다중 리전에 이벤트 복제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 벡터 클록으로 인과관계 추적</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span><span class=o>.</span><span class=n>vector_clock</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>vector_clock</span><span class=o>.</span><span class=n>tick</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 로컬 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>local_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비동기 복제</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>region</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>peer_regions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>async_replicate_to_region</span><span class=p>(</span><span class=n>region</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>resolve_conflict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_event</span><span class=p>,</span> <span class=n>remote_event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;충돌 해결 알고리즘&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 기반 충돌 해결</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_concurrent</span><span class=p>(</span><span class=n>local_event</span><span class=p>,</span> <span class=n>remote_event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_business_rules</span><span class=p>(</span><span class=n>local_event</span><span class=p>,</span> <span class=n>remote_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 인과관계가 있는 경우 늦은 이벤트 선택</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_latest_by_causality</span><span class=p>(</span><span class=n>local_event</span><span class=p>,</span> <span class=n>remote_event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=-phase-8-심화-확장-및-실무-보완>🔍 Phase 8: 심화 확장 및 실무 보완<a hidden class=anchor aria-hidden=true href=#-phase-8-심화-확장-및-실무-보완>#</a></h2><h3 id=81-이벤트-소싱에서-자주-겪는-실무-문제와-해결-전략>8.1 이벤트 소싱에서 자주 겪는 실무 문제와 해결 전략<a hidden class=anchor aria-hidden=true href=#81-이벤트-소싱에서-자주-겪는-실무-문제와-해결-전략>#</a></h3><table><thead><tr><th>구분</th><th>문제 현상</th><th>주요 원인</th><th>실무 영향</th><th>해결 전략</th></tr></thead><tbody><tr><td>이벤트 재생 속도 저하</td><td>대량의 이벤트 재생 시 오래 걸림</td><td>장기간 스냅샷 미적용, 이벤트 크기 증가</td><td>시스템 기동 지연</td><td>스냅샷 주기 단축, 이벤트 아카이빙</td></tr><tr><td>이벤트 순서 불일치</td><td>분산 환경에서 순서 어김</td><td>네트워크 지연, 멀티 스레드 처리</td><td>데이터 불일치</td><td>글로벌 타임스탬프, 카프카 파티션 관리</td></tr><tr><td>이벤트 스키마 변경</td><td>기존 이벤트 형식과 충돌</td><td>버전 미관리</td><td>재생 오류 발생</td><td>스키마 버전 관리(Avro, Protobuf)</td></tr><tr><td>멱등성(Idempotency) 미비</td><td>동일 이벤트 중복 처리</td><td>리트라이 로직 불완전</td><td>데이터 중복</td><td>이벤트 ID 관리, 멱등성 키 적용</td></tr><tr><td>GDPR 등 규제 준수</td><td>데이터 삭제 요구 충돌</td><td>불변성 특성</td><td>법적 컴플라이언스 문제</td><td>이벤트 마스킹, 암호화 키 폐기 방식</td></tr></tbody></table><hr><h3 id=82-실무에서의-성능-최적화-패턴>8.2 실무에서의 성능 최적화 패턴<a hidden class=anchor aria-hidden=true href=#82-실무에서의-성능-최적화-패턴>#</a></h3><ol><li><p><strong>스냅샷(Snapshot) 주기 최적화</strong></p><ul><li>이벤트 수가 1,000개를 넘으면 스냅샷을 저장하는 방식 적용.</li><li>최신 기술: 증분 스냅샷(Incremental Snapshot).</li></ul></li><li><p><strong>CQRS + Read Model Cache</strong></p><ul><li>읽기 전용 DB(Read Model)를 In-memory 캐시(Redis)에 두어 조회 속도를 높임.</li></ul></li><li><p><strong>Parallel Event Processing</strong></p><ul><li>병렬 이벤트 처리 시 이벤트 <strong>순서를 보장할 파티션 키</strong> 사용.</li></ul></li><li><p><strong>이벤트 압축(Event Compaction)</strong></p><ul><li>카프카(Kafka)의 log compaction 기능 활용해 오래된 중복 상태 이벤트 제거.</li></ul></li></ol><hr><h3 id=83-아키텍처-확장-예시>8.3 아키텍처 확장 예시<a hidden class=anchor aria-hidden=true href=#83-아키텍처-확장-예시>#</a></h3><p><strong>Event Sourcing + Microservices + Kafka 조합 다이어그램</strong></p><pre class=mermaid>graph TB
    subgraph ServiceA[주문 서비스]
        A1[Command Handler] --&gt; A2[Event Store]
    end
    subgraph ServiceB[결제 서비스]
        B1[Command Handler] --&gt; B2[Event Store]
    end
    A2 -- 이벤트 발행 --&gt; K[Kafka Topic]
    B2 -- 이벤트 발행 --&gt; K
    K -- 구독 --&gt; R1[Read Model for Dashboard]
    K -- 구독 --&gt; R2[Analytics Service]
</pre><p>💡 이렇게 구성하면, 각 서비스가 <strong>독립적으로 Event Sourcing</strong>을 하고, 메시지 브로커(카프카)를 통해 데이터 흐름이 연결됩니다.</p><h3 id=phase-7-고급-주제-2>Phase 7: 고급 주제<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-2>#</a></h3><h4 id=현재-도전-과제-2>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제-2>#</a></h4><table><thead><tr><th>과제</th><th>원인</th><th>영향</th><th>해결방안</th></tr></thead><tbody><tr><td>장기 스키마 진화</td><td>비즈니스 변화</td><td>업캐스터 난이도↑</td><td>버전 정책, 계약 테스트, 점진적 마이그레이션</td></tr><tr><td>대규모 리플레이</td><td>수십억 이벤트</td><td>리빌드 시간↑</td><td>스냅샷 계층화, 백필 파이프라인, 임시 고성능 클러스터</td></tr><tr><td>데이터 거버넌스</td><td>PII 불변 로그</td><td>규제 충돌</td><td>암호화 키 폐기, PII 외부화</td></tr></tbody></table><h4 id=생태계-및-관련-기술-2>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술-2>#</a></h4><ul><li><strong>CQRS, DDD(Domain-Driven Design)</strong>: ES와 상호 보완. (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">Microsoft Learn</a>)</li><li><strong>클라우드 파편</strong>: Cosmos DB Change Feed, Kafka(이벤트 스트림 인프라 – <em>ES 자체는 아님</em>), Outbox 패턴. (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Microsoft for Developers</a>)</li></ul><h4 id=최신-트렌드와-미래-방향-1>최신 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-트렌드와-미래-방향-1>#</a></h4><ul><li><strong>Serverless 투영</strong>(Functions + Change Feed/Triggers)</li><li><strong>스키마 레지스트리/계약 주도 개발</strong> 보편화</li><li><strong>감사/리스크</strong> 요구로 금융·헬스 도입 지속</li></ul><hr><h2 id=4단계-종합-정리>4단계: 종합 정리<a hidden class=anchor aria-hidden=true href=#4단계-종합-정리>#</a></h2><h3 id=10-최종-정리-및-학습-가이드>10. 최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#10-최종-정리-및-학습-가이드>#</a></h3><ul><li><p><strong>내용 종합</strong>: Event Sourcing은 <strong>사실 기반 데이터 모델</strong>로, Event Store를 SSOT로 삼아 리플레이/투영으로 다양한 리드 모델을 만든다. CQRS와 결합 시 확장성과 감사성이 탁월하지만, <strong>스키마 진화·리플레이 비용·운영 복잡성</strong>이 따른다. Microsoft 아키텍처 센터·Fowler 글·EventStoreDB 문서가 실무 표준 지침으로 유용하다. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">Microsoft Learn</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</p></li><li><p><strong>학습 로드맵</strong></p><ol><li>기본 개념(Fowler 글) → 2) CQRS 결합(MS Docs) → 3) 샘플 구현(PostgreSQL/ESDB) → 4) 업캐스터/스냅샷 운용 → 5) 모니터링·거버넌스 → 6) 대규모 리플레이/마이그레이션 전략</li></ol></li></ul><h3 id=학습-항목-매트릭스-1>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스-1>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-101-1><a class=lnlinks href=#hl-101-1>1</a>
</span><span class=lnt id=hl-101-2><a class=lnlinks href=#hl-101-2>2</a>
</span><span class=lnt id=hl-101-3><a class=lnlinks href=#hl-101-3>3</a>
</span><span class=lnt id=hl-101-4><a class=lnlinks href=#hl-101-4>4</a>
</span><span class=lnt id=hl-101-5><a class=lnlinks href=#hl-101-5>5</a>
</span><span class=lnt id=hl-101-6><a class=lnlinks href=#hl-101-6>6</a>
</span><span class=lnt id=hl-101-7><a class=lnlinks href=#hl-101-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목 | 중요도 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------|--------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | 개념/가치 | 필수   | 이벤트로 상태를 저장하고 재생 |
</span></span><span class=line><span class=cl>| 이론     | 2     | SSOT/동시성/투영 | 필수 | ExpectedVersion, 멱등성, 리드 모델 |
</span></span><span class=line><span class=cl>| 구현     | 5     | ESDB/PG 구현 | 권장   | Append/Replay/Projection 코드 |
</span></span><span class=line><span class=cl>| 운영     | 6     | 모니터링/거버넌스 | 필수   | Lag, 충돌률, GDPR 전략 |
</span></span><span class=line><span class=cl>| 고급     | 7     | 업캐스터/대규모 리플레이 | 선택   | 스키마 진화·백필 최적화 |
</span></span></code></pre></td></tr></table></div></div><h2 id=4단계-종합-정리-1>4단계: 종합 정리<a hidden class=anchor aria-hidden=true href=#4단계-종합-정리-1>#</a></h2><h3 id=내용-종합-1>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합-1>#</a></h3><p>Event Sourcing은 단순한 데이터 저장 패턴을 넘어서 현대 분산 시스템의 핵심 아키텍처 패러다임으로 자리잡았습니다. <strong>불변 이벤트 로그</strong>를 통한 <strong>완벽한 감사 추적</strong>, <strong>시점별 상태 복원</strong>, <strong>확장 가능한 읽기 모델</strong>이라는 핵심 가치를 제공하며, 특히 <strong>금융</strong>, <strong>전자상거래</strong>, <strong>IoT</strong> 등 높은 신뢰성과 투명성이 요구되는 도메인에서 필수적인 기술로 인정받고 있습니다.</p><p><strong>최신 트렌드</strong>로는 <strong>서버리스 환경에서의 Event Sourcing</strong>, <strong>AI/ML과의 통합</strong>, <strong>엣지 컴퓨팅 환경에서의 경량화</strong>, <strong>다중 클라우드 환경에서의 일관성 관리</strong> 등이 주목받고 있으며, Apache Kafka, EventStore, AWS Kinesis 등의 기술 생태계가 지속적으로 발전하고 있습니다.</p><p>하지만 <strong>구현 복잡성</strong>, <strong>학습 곡선</strong>, <strong>운영 오버헤드</strong>라는 현실적 도전과제들이 존재하므로, 조직의 성숙도와 비즈니스 요구사항을 면밀히 검토한 후 단계적 도입이 권장됩니다.</p><h3 id=학습-로드맵-2>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵-2>#</a></h3><h4 id=1단계-기초-개념-이해-2-3주>1단계: 기초 개념 이해 (2-3주)<a hidden class=anchor aria-hidden=true href=#1단계-기초-개념-이해-2-3주>#</a></h4><ul><li>Event Sourcing 기본 개념과 동기</li><li>CRUD vs Event Sourcing 차이점</li><li>간단한 도메인에서의 이벤트 모델링</li><li>기본적인 이벤트 스토어 구현 (SQLite/PostgreSQL)</li></ul><h4 id=2단계-실무-패턴-학습-4-6주>2단계: 실무 패턴 학습 (4-6주)<a hidden class=anchor aria-hidden=true href=#2단계-실무-패턴-학습-4-6주>#</a></h4><ul><li>CQRS 패턴과의 결합</li><li>프로젝션 설계 및 구현</li><li>스냅샷 전략</li><li>이벤트 버전 관리</li><li>기본적인 성능 최적화</li></ul><h4 id=3단계-분산-시스템-적용-6-8주>3단계: 분산 시스템 적용 (6-8주)<a hidden class=anchor aria-hidden=true href=#3단계-분산-시스템-적용-6-8주>#</a></h4><ul><li>마이크로서비스 아키텍처에서의 Event Sourcing</li><li>Apache Kafka를 활용한 이벤트 스트리밍</li><li>최종 일관성과 Saga 패턴</li><li>모니터링 및 관측성 구축</li></ul><h4 id=4단계-고급-주제-및-운영-8-12주>4단계: 고급 주제 및 운영 (8-12주)<a hidden class=anchor aria-hidden=true href=#4단계-고급-주제-및-운영-8-12주>#</a></h4><ul><li>대규모 이벤트 스트림 처리</li><li>다중 클라우드 환경에서의 이벤트 복제</li><li>보안 및 규정 준수 (GDPR, 금융 규제)</li><li>이벤트 스키마 진화 및 호환성 관리</li><li>프로덕션 환경 운영 노하우</li></ul><h4 id=5단계-전문가-수준-12주>5단계: 전문가 수준 (12주+)<a hidden class=anchor aria-hidden=true href=#5단계-전문가-수준-12주>#</a></h4><ul><li>지리적 분산 Event Sourcing</li><li>AI/ML 파이프라인과의 통합</li><li>서버리스 Event Sourcing 아키텍처</li><li>커스텀 이벤트 스토어 구현</li><li>업계별 특화 솔루션 설계</li></ul><h3 id=학습-항목-매트릭스-2>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스-2>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>Event Sourcing 개념</td><td>필수</td><td>패턴의 기본 이해와 동기 파악</td></tr><tr><td>기초</td><td>1</td><td>이벤트 모델링</td><td>필수</td><td>비즈니스 이벤트를 코드로 표현하는 방법</td></tr><tr><td>기초</td><td>1</td><td>기본 Event Store 구현</td><td>필수</td><td>간단한 이벤트 저장소 직접 구현</td></tr><tr><td>이론</td><td>2</td><td>CQRS 패턴</td><td>필수</td><td>읽기/쓰기 분리를 통한 성능 최적화</td></tr><tr><td>이론</td><td>2</td><td>집계(Aggregate) 설계</td><td>필수</td><td>도메인 주도 설계의 핵심 개념</td></tr><tr><td>이론</td><td>2</td><td>이벤트 재생 메커니즘</td><td>필수</td><td>상태 재구성의 핵심 원리</td></tr><tr><td>구현</td><td>4</td><td>스냅샷 전략</td><td>권장</td><td>성능 최적화를 위한 필수 기법</td></tr><tr><td>구현</td><td>4</td><td>프로젝션 엔진 구현</td><td>권장</td><td>읽기 모델 생성 자동화</td></tr><tr><td>구현</td><td>5</td><td>Apache Kafka 활용</td><td>권장</td><td>엔터프라이즈급 이벤트 스트리밍</td></tr><tr><td>구현</td><td>5</td><td>마이크로서비스 통합</td><td>권장</td><td>실제 분산 시스템에서의 적용</td></tr><tr><td>운영</td><td>6</td><td>모니터링 시스템 구축</td><td>권장</td><td>프로덕션 환경 안정성 확보</td></tr><tr><td>운영</td><td>6</td><td>보안 및 암호화</td><td>권장</td><td>데이터 보호 및 규정 준수</td></tr><tr><td>운영</td><td>6</td><td>성능 튜닝</td><td>권장</td><td>대용량 처리를 위한 최적화</td></tr><tr><td>고급</td><td>7</td><td>이벤트 스키마 진화</td><td>선택</td><td>장기적 시스템 유지보수성</td></tr><tr><td>고급</td><td>7</td><td>지리적 분산 처리</td><td>선택</td><td>글로벌 서비스를 위한 고급 기법</td></tr><tr><td>고급</td><td>7</td><td>AI/ML 파이프라인 통합</td><td>선택</td><td>차세대 지능형 시스템 구축</td></tr><tr><td>고급</td><td>7</td><td>커스텀 Event Store</td><td>선택</td><td>특수 요구사항을 위한 전문 지식</td></tr></tbody></table><h3 id=우선순위별-학습-가이드>우선순위별 학습 가이드<a hidden class=anchor aria-hidden=true href=#우선순위별-학습-가이드>#</a></h3><p><strong>1순위 (필수 역량)</strong>:</p><ul><li>Event Sourcing 기본 개념과 CQRS 패턴 이해</li><li>간단한 도메인에서의 이벤트 모델링 능력</li><li>기본적인 이벤트 스토어 구현 경험</li><li>프로젝션 설계 및 구현 능력</li></ul><p><strong>2순위 (실무 적용)</strong>:</p><ul><li>Apache Kafka 등 상용 도구 활용 능력</li><li>마이크로서비스 환경에서의 통합 경험</li><li>성능 최적화 및 모니터링 구축</li><li>기본적인 보안 및 운영 지식</li></ul><p><strong>3순위 (전문성 강화)</strong>:</p><ul><li>대규모 시스템에서의 운영 경험</li><li>복잡한 비즈니스 도메인에서의 모델링</li><li>고급 패턴 및 최신 기술 트렌드 이해</li><li>조직 내 Event Sourcing 전파 및 교육</li></ul><h2 id=4단계-종합-정리-및-학습-가이드>4단계: 종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#4단계-종합-정리-및-학습-가이드>#</a></h2><h2 id=요약>요약<a hidden class=anchor aria-hidden=true href=#요약>#</a></h2><p>이벤트 소싱은 시스템의 상태 변화를 이벤트로 기록하고, 이벤트 스트림을 재생하여 상태를 재구성하는 아키텍처 패턴으로, 데이터 무결성, 감사, 복구, 분석 등 다양한 이점을 제공하며, 복잡한 도메인이나 분산 시스템에서 특히 효과적입니다.<br>분류 구조는 “Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns”로 적합하며, 이벤트 소싱은 CQRS, 마이크로서비스 등과 잘 연동됩니다.</p><h3 id=내용-종합-2>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합-2>#</a></h3><p>이벤트 소싱(Event Sourcing)은 데이터 상태의 모든 변경을 이벤트로 순차적으로 저장함으로써 복원력, 감사, 비즈니스 및 운영 투명성을 획기적으로 개선하는 아키텍처 패턴이다. 실무 현장에서는 CQRS, Snapshot 등과 결합하여 확장성과 성능을 동시에 달성하며, Microservices 및 클라우드 생태계에서 활용도와 미래 전망이 높다.</p><h2 id=-phase-9-학습-심화-로드맵>📌 Phase 9: 학습 심화 로드맵<a hidden class=anchor aria-hidden=true href=#-phase-9-학습-심화-로드맵>#</a></h2><table><thead><tr><th>단계</th><th>학습 내용</th><th>실습 예제</th><th>참고 기술</th></tr></thead><tbody><tr><td>1단계</td><td>기본 이벤트 소싱 개념과 CQRS 구조 학습</td><td>장바구니 예제</td><td>Python, SQLite</td></tr><tr><td>2단계</td><td>이벤트 스토어 구현 + 스냅샷 적용</td><td>주문 서비스</td><td>PostgreSQL, EventStoreDB</td></tr><tr><td>3단계</td><td>이벤트 브로커 연계</td><td>주문-결제 마이크로서비스</td><td>Kafka, RabbitMQ</td></tr><tr><td>4단계</td><td>운영 모니터링 & 장애 복구 실습</td><td>장애 복구 시뮬레이션</td><td>Prometheus, Grafana</td></tr><tr><td>5단계</td><td>고급 주제 적용</td><td>이벤트 압축, 멱등성 보장</td><td>Kafka log compaction</td></tr></tbody></table><h3 id=학습-로드맵-및-우선순위>학습 로드맵 및 우선순위<a hidden class=anchor aria-hidden=true href=#학습-로드맵-및-우선순위>#</a></h3><ol><li>이벤트 소싱 기본 개념/원리 습득</li><li>아키텍처 구조 및 CQRS/Snapshot 연계 패턴 실습</li><li>실무 적용 사례 및 코드 예제 분석</li><li>운영/최적화, 모니터링/거버넌스 심화 학습</li><li>고급 패턴(분산, 멱등성, 이벤트 연계 microservices) 확장 학습</li></ol><h3 id=학습-항목-매트릭스-3>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스-3>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>용어·기초</td><td>필수</td><td>이벤트, 스토어, 불변성 등</td></tr><tr><td>이론</td><td>2</td><td>아키텍처 원리</td><td>필수</td><td>구성요소, CQRS, 동작 메커니즘</td></tr><tr><td>구현</td><td>5</td><td>예제 실습</td><td>권장</td><td>실무 사용 예시, 코드/워크플로우</td></tr><tr><td>특성분석</td><td>3</td><td>장·단점 분석</td><td>필수</td><td>장점/제약 및 해결 전략</td></tr><tr><td>고급</td><td>7</td><td>생태계/확장</td><td>선택</td><td>최신 기술 트렌드, 클라우드 연계</td></tr><tr><td>운영</td><td>6</td><td>보안/관측성</td><td>권장</td><td>운영/최적화, 거버넌스, 모니터링</td></tr></tbody></table><hr><h2 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td>이벤트(Event)</td><td>상태 변화 기록</td><td>불변성, 이벤트 스토어</td></tr><tr><td>구현</td><td>이벤트 스토어(Store)</td><td>이벤트 저장소</td><td>순차적 기록, Replay</td></tr><tr><td>운영</td><td>Snapshot(스냅샷)</td><td>전체상태 임시저장</td><td>성능 개선, 복구</td></tr><tr><td>구현</td><td>CQRS</td><td>명령/조회 분리</td><td>성능/확장성</td></tr><tr><td>운영</td><td>Audit</td><td>변경이력 감사</td><td>감사, 추적성</td></tr></tbody></table><h2 id=용어-정리-4>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-4>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td><strong>Event Sourcing (이벤트 소싱)</strong></td><td>상태 변화를 이벤트 시퀀스로 저장하는 아키텍처 패턴</td><td>CQRS, DDD, 감사 로그</td></tr><tr><td>핵심</td><td><strong>Event Store (이벤트 스토어)</strong></td><td>이벤트를 영구 저장하는 append-only 데이터베이스</td><td>이벤트 로그, 영속성</td></tr><tr><td>핵심</td><td><strong>Aggregate (집계)</strong></td><td>비즈니스 일관성의 경계를 나타내는 도메인 객체</td><td>DDD, 트랜잭션 경계</td></tr><tr><td>핵심</td><td><strong>Event Replay (이벤트 재생)</strong></td><td>저장된 이벤트를 순차적으로 재생하여 상태를 재구성하는 과정</td><td>상태 복원, 디버깅</td></tr><tr><td>구현</td><td><strong>CQRS (Command Query Responsibility Segregation)</strong></td><td>명령과 쿼리의 책임을 분리하는 패턴</td><td>읽기/쓰기 분리, 성능 최적화</td></tr><tr><td>구현</td><td><strong>Projection (프로젝션)</strong></td><td>이벤트로부터 생성되는 읽기 최적화된 뷰</td><td>구체화된 뷰, 비정규화</td></tr><tr><td>구현</td><td><strong>Snapshot (스냅샷)</strong></td><td>특정 시점의 집계 상태를 저장한 최적화 기법</td><td>성능 튜닝, 메모이제이션</td></tr><tr><td>구현</td><td><strong>Event Handler (이벤트 핸들러)</strong></td><td>특정 이벤트 타입을 처리하는 컴포넌트</td><td>이벤트 리스너, 구독자</td></tr><tr><td>운영</td><td><strong>Event Bus (이벤트 버스)</strong></td><td>이벤트 라우팅 및 배포를 담당하는 메시징 인프라</td><td>메시지 브로커, 발행-구독</td></tr><tr><td>운영</td><td><strong>Compensating Event (보상 이벤트)</strong></td><td>이전 이벤트의 효과를 상쇄하는 새로운 이벤트</td><td>취소, 롤백, Saga 패턴</td></tr><tr><td>운영</td><td><strong>Event Schema Evolution (이벤트 스키마 진화)</strong></td><td>이벤트 구조 변경에 대한 하위 호환성 관리</td><td>버전 관리, 업캐스팅</td></tr><tr><td>운영</td><td><strong>Eventual Consistency (최종 일관성)</strong></td><td>시간이 지나면서 모든 노드가 일관된 상태에 도달하는 특성</td><td>분산 시스템, CAP 정리</td></tr><tr><td>고급</td><td><strong>Saga Pattern (사가 패턴)</strong></td><td>분산 트랜잭션을 여러 단계로 나누어 관리하는 패턴</td><td>분산 트랜잭션, 보상 트랜잭션</td></tr><tr><td>고급</td><td><strong>Event Upcasting (이벤트 업캐스팅)</strong></td><td>오래된 이벤트를 새로운 스키마로 변환하는 과정</td><td>스키마 마이그레이션, 호환성</td></tr><tr><td>고급</td><td><strong>Crypto-shredding (암호 샤딩)</strong></td><td>암호화 키 삭제를 통한 데이터 삭제 기법</td><td>GDPR 준수, 개인정보 보호</td></tr></tbody></table><h2 id=용어-정리-5>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-5>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td>이벤트(Event)</td><td>도메인에서 일어난 불변의 사실</td><td>도메인 이벤트, 커맨드</td></tr><tr><td>핵심</td><td>이벤트 스토어</td><td>Append-only 이벤트 저장소</td><td>SSOT, 스냅샷</td></tr><tr><td>구현</td><td>투영(Projection)</td><td>이벤트→리드 모델 변환</td><td>물질화 뷰, Change Feed</td></tr><tr><td>구현</td><td>업캐스터(Upcaster)</td><td>과거 이벤트를 최신 스키마로 승격</td><td>스키마 진화</td></tr><tr><td>운영</td><td>리플레이</td><td>이벤트 재적용으로 상태 복원</td><td>백필, 체크포인트</td></tr><tr><td>운영</td><td>ExpectedVersion</td><td>낙관적 잠금용 기대 버전</td><td>동시성 제어</td></tr></tbody></table><hr><h2 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h2><ul><li>Martin Fowler, <strong>Event Sourcing</strong>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li><li>Microsoft Azure Architecture Center, <strong>Event Sourcing / CQRS</strong>. (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">Microsoft Learn</a>)</li><li>LMAX 사례(이벤트 소싱/저지연). (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">martinfowler.com</a>)</li><li>Cosmos DB Change Feed와 ES 패턴 응용. (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">Microsoft for Developers</a>)</li><li>InfoQ, Greg Young 인터뷰/요약. (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">InfoQ</a>)</li><li>EventStoreDB 샘플/문서. (<a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">GitHub</a>)</li></ul><h2 id=참고-및-출처-4>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-4>#</a></h2><h3 id=공식-문서-및-표준>공식 문서 및 표준<a hidden class=anchor aria-hidden=true href=#공식-문서-및-표준>#</a></h3><ul><li><a href=https://cloudevents.io/>CloudEvents 표준 (CNCF)</a> - 클라우드 이벤트 상호 운용성 표준</li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a> - 분산 스트리밍 플랫폼</li><li><a href=https://www.eventstore.com/documentation>EventStore DB 공식 문서</a> - 이벤트 소싱 전용 데이터베이스</li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Microsoft Azure Event Sourcing 패턴</a> - 클라우드 아키텍처 패턴</li></ul><h3 id=기술-블로그-및-실무-사례>기술 블로그 및 실무 사례<a hidden class=anchor aria-hidden=true href=#기술-블로그-및-실무-사례>#</a></h3><ul><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Martin Fowler의 Event Sourcing 분석</a> - 패턴의 창시자가 직접 설명</li><li><a href=https://netflixtechblog.com/>Netflix 기술 블로그 - 분산 카운터 시스템</a> - 대규모 실시간 이벤트 처리 사례</li><li><a href=https://www.confluent.io/blog/event-sourcing-cqrs-stream-processing-apache-kafka-whats-connection/>Confluent 블로그 - Kafka Event Sourcing</a> - Kafka와 Event Sourcing 연계</li><li><a href=https://eventuate.io/exampleapps.html>Eventuate 플랫폼 사례</a> - 실제 구현 예제 모음</li></ul><h3 id=학술-자료-및-연구>학술 자료 및 연구<a hidden class=anchor aria-hidden=true href=#학술-자료-및-연구>#</a></h3><ul><li><a href=https://hal.inria.fr/inria-00555588/document>CRDT (Conflict-free Replicated Data Types) 논문</a> - 분산 일관성 이론</li><li><a href=https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf>CAP 정리와 Event Sourcing</a> - 분산 시스템 이론적 배경</li><li><a href=https://www.domainlanguage.com/ddd/>Domain-Driven Design 원서</a> - Eric Evans의 원서</li></ul><h3 id=기업-기술-사례-및-백서>기업 기술 사례 및 백서<a hidden class=anchor aria-hidden=true href=#기업-기술-사례-및-백서>#</a></h3><ul><li><a href=https://aws.amazon.com/event-driven-architecture/>AWS Event-Driven Architecture 모범 사례</a> - 클라우드 네이티브 구현</li><li><a href=https://cloud.google.com/pubsub/docs/overview>Google Cloud Pub/Sub 아키텍처</a> - 메시징 인프라 설계</li><li><a href=https://engineering.atspotify.com/>Spotify 마이크로서비스 이벤트 아키텍처</a> - 대규모 실무 적용 사례</li></ul><h3 id=오픈소스-프로젝트>오픈소스 프로젝트<a hidden class=anchor aria-hidden=true href=#오픈소스-프로젝트>#</a></h3><ul><li><a href=https://axoniq.io/product-overview/axon-framework>Axon Framework</a> - Java 기반 Event Sourcing 프레임워크</li><li><a href=https://eventsauce.io/>EventSauce</a> - PHP 기반 Event Sourcing 라이브러리</li><li><a href=https://wolverinefx.net/>Wolverine</a> - .NET 기반 메시징 플랫폼</li></ul><h3 id=커뮤니티-및-포럼>커뮤니티 및 포럼<a hidden class=anchor aria-hidden=true href=#커뮤니티-및-포럼>#</a></h3><ul><li><a href=https://github.com/ddd-community>DDD Community</a> - 도메인 주도 설계 커뮤니티</li><li><a href=https://groups.google.com/forum/#!forum/event-store>Event Store Users Google Group</a> - Event Store 사용자 커뮤니티</li><li><a href=https://kafka.apache.org/contact>Apache Kafka Users</a> - Kafka 사용자 지원</li></ul><h3 id=도서-추천>도서 추천<a hidden class=anchor aria-hidden=true href=#도서-추천>#</a></h3><ul><li><strong>&ldquo;Implementing Domain-Driven Design&rdquo;</strong> by Vaughn Vernon - DDD와 Event Sourcing 실무 적용</li><li><strong>&ldquo;Microservices Patterns&rdquo;</strong> by Chris Richardson - 마이크로서비스 아키텍처에서의 Event Sourcing</li><li><strong>&ldquo;Building Event-Driven Microservices&rdquo;</strong> by Adam Bellemare - 이벤트 중심 아키텍처 구축 가이드</li><li><strong>&ldquo;Kafka: The Definitive Guide&rdquo;</strong> by Neha Narkhede - Apache Kafka 완전 정복</li></ul><h2 id=참고-및-출처-5>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-5>#</a></h2><ul><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/event-sourcing>마이크로소프트 공식 문서: 이벤트 소싱 패턴</a><a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">11</a></li><li><a href=https://developers.portone.io/blog/posts/2024-07/v2-event-sourcing-basic>포트원 V2 결제 시스템 Event Sourcing 사례</a><a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">4</a></li><li><a href=https://cajava.tistory.com/85>기술 블로그: 이벤트 소싱의 기본 개념/구성</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">1</a></li><li><a href=https://andrew75313.tistory.com/197>Genie의 개발노트: Event Sourcing FLOW</a><a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">3</a></li><li><a href=https://notypie.dev/design-eda%EC%9D%98-%EA%B0%9C%EB%85%90-2-event-sourcing/>기록하는 개발자: EDA와 Event Sourcing</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a></li><li><a href=https://puddingcamp.com/topics/event-sourcing-cqrs-summary>CQRS 연계 실무 설명</a><a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">7</a></li><li><a href=https://unclekevin.tistory.com/entry/Event-Sourcing>엉클케빈의 세상: 장점/단점/사용사례 정리</a><a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">2</a></li></ul><hr><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li><strong>Event-Sourcing</strong></li><li><strong>Architecture-Patterns</strong></li><li><strong>Data-Management-Patterns</strong></li><li><strong>Software-Engineering</strong></li></ul><h2 id=-tags>📌 Tags<a hidden class=anchor aria-hidden=true href=#-tags>#</a></h2><ul><li>Event-Sourcing</li><li>Append-Only-Log</li><li>Temporal-Data</li><li>Audit-Trail</li></ul><hr><h2 id=1-분류-구조-타당성-평가>1. 분류 구조 타당성 평가<a hidden class=anchor aria-hidden=true href=#1-분류-구조-타당성-평가>#</a></h2><p><strong>현재 위치</strong>:
<code>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns</code></p><p>✅ <strong>적절</strong>: Event Sourcing은 변경 이력을 이벤트 로그로 보존하는 <strong>데이터 관리 패턴</strong>으로, CQRS와 자주 결합되어 설계상 읽기/쓰기 분리를 지원하기에 현 구조가 타당합니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">kurrent.io</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">microservices.io</a>)</p><hr><h2 id=2-분류-구조-적합성-분석>2. 분류 구조 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적합성-분석>#</a></h2><p><strong>현재 분류 구조</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-102-1><a class=lnlinks href=#hl-102-1>1</a>
</span><span class=lnt id=hl-102-2><a class=lnlinks href=#hl-102-2>2</a>
</span><span class=lnt id=hl-102-3><a class=lnlinks href=#hl-102-3>3</a>
</span><span class=lnt id=hl-102-4><a class=lnlinks href=#hl-102-4>4</a>
</span><span class=lnt id=hl-102-5><a class=lnlinks href=#hl-102-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Computer Science and Engineering
</span></span><span class=line><span class=cl>└─ Software Engineering
</span></span><span class=line><span class=cl>   └─ Design and Architecture
</span></span><span class=line><span class=cl>      └─ Architecture Patterns
</span></span><span class=line><span class=cl>         └─ Data Management Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>분석 및 근거</strong><br>이벤트 소싱은 소프트웨어 엔지니어링의 디자인 및 아키텍처 패턴 중 하나로, 데이터 관리 패턴의 대표적 예시입니다.<br>이벤트 소싱은 시스템의 상태 변화를 이벤트로 기록하고, 이벤트 스트림을 통해 상태를 재구성하므로,<br>“Data Management Patterns” 하위에 배치하는 것이 적절합니다.<br>또한, 아키텍처 패턴과 소프트웨어 엔지니어링 분야에 속하므로 현재 분류 구조가 타당합니다.</p><hr><h2 id=3-요약-문장-200자-내외>3. 요약 문장 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-문장-200자-내외>#</a></h2><p>이벤트 소싱은 시스템의 모든 상태 변화를 이벤트로 기록하고, 필요 시 이벤트 스트림을 재생해 상태를 재구성하는 데이터 관리 아키텍처 패턴이다.</p><h2 id=2-200자-내외-요약>2. 200자 내외 요약<a hidden class=anchor aria-hidden=true href=#2-200자-내외-요약>#</a></h2><p>Event Sourcing은 모든 상태 변경을 불변 이벤트(event)로 기록하며, 이러한 이벤트 로그를 통해 현재 상태를 재구성하거나 과거 상태를 조회하는 패턴입니다. 이를 통해 완벽한 감사 로그, 시간 여행 쿼리, 복원 및 이벤트 기반 통합이 가능하며, CQRS와 결합 시 읽기/쓰기 분리를 통한 최적화도 수행할 수 있습니다.</p><hr><h2 id=3-250자-내외-개요>3. 250자 내외 개요<a hidden class=anchor aria-hidden=true href=#3-250자-내외-개요>#</a></h2><p>Event Sourcing은 시스템의 모든 상태 변화를 append-only 로그(Event Store)에 이벤트로 기록하는 아키텍처 패턴입니다. 이러한 이벤트 로그는 현재 상태 재생(replay)을 통해 시스템 상태를 복원하거나 과거 상태를 조회하는 용도로 사용됩니다. 주요 이점은 감사(Auditability), 시간여행(Temporal Queries), 복합 워크플로우 추적, 시스템 복원성 등이 있으며, 읽기 모델과 결합 시 CQRS 패턴의 최적화 효과도 얻을 수 있습니다. 단, 높은 복잡도, 이벤트 스냅샷 등 인프라 체계가 요구됩니다.</p><h2 id=4-전체-개요-250자-내외>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외>#</a></h2><p>이벤트 소싱은 시스템의 상태 변화를 이벤트로 기록해 저장하며, 이벤트 스트림을 통해 시스템의 현재 상태를 재구성할 수 있는 아키텍처 패턴이다. 이를 통해 데이터 무결성, 감사, 복구, 분석 등 다양한 이점을 얻을 수 있다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>이벤트 소싱(Event Sourcing)</strong><ul><li>시스템의 모든 상태 변화를 이벤트(불변의 기록)로 저장.</li><li>현재 상태는 이벤트 스트림을 재생(재생산)하여 얻음.</li><li>이벤트는 원본 데이터로 간주, 시스템의 상태 변화 이력이 모두 보존됨.</li><li><strong>실무 구현 연관성</strong><ul><li>이벤트 스트림 저장 및 관리(이벤트 저장소, 스트림 처리)</li><li>이벤트 기반 시스템 설계(이벤트 발행, 구독, 처리)</li><li>상태 재구성(이벤트 재생산, 스냅샷 활용)</li><li>감사, 데이터 무결성, 트랜잭션 로그, 복구 등 다양한 실무 요구에 부합</li></ul></li></ul></li></ul><h2 id=4-핵심-개념>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념>#</a></h2><h3 id=-event-이벤트>🔹 Event (이벤트)<a hidden class=anchor aria-hidden=true href=#-event-이벤트>#</a></h3><ul><li>시스템에서 발생한 불변(Immutable) 상태 변경 단위. (e.g., <code>OrderCreated</code>, <code>BalanceUpdated</code>) (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">geeksforgeeks.org</a>)</li></ul><h3 id=-event-store-이벤트-저장소>🔹 Event Store (이벤트 저장소)<a hidden class=anchor aria-hidden=true href=#-event-store-이벤트-저장소>#</a></h3><ul><li>이벤트를 순차적으로 저장하는 append-only 로그.</li><li>상태 재구성, 이벤트 발행 기능 포함 (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">docs.aws.amazon.com</a>)</li></ul><h3 id=-aggregate>🔹 Aggregate<a hidden class=anchor aria-hidden=true href=#-aggregate>#</a></h3><ul><li>도메인 단위의 변경 로직과 상태 응집체.</li><li>커맨드를 처리하고 이벤트를 생성하는 단일 단위 (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">geeksforgeeks.org</a>, <a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">docs.aws.amazon.com</a>)</li></ul><h3 id=-projection--materialized-view>🔹 Projection / Materialized View<a hidden class=anchor aria-hidden=true href=#-projection--materialized-view>#</a></h3><ul><li>이벤트를 읽기 전용 모델로 변환하여 조회 최적화. CQRS와 결합 시 필수 요소</li></ul><h3 id=-snapshot-스냅샷>🔹 Snapshot (스냅샷)<a hidden class=anchor aria-hidden=true href=#-snapshot-스냅샷>#</a></h3><ul><li>이벤트가 많아질 경우 재생 비용을 줄이기 위한 중간 상태 저장. 이후 이벤트는 이 후로만 재생</li></ul><h3 id=-replay-재생>🔹 Replay (재생)<a hidden class=anchor aria-hidden=true href=#-replay-재생>#</a></h3><ul><li>과거 시점이나 현재 상태를 이벤트 재생으로 복원하거나 분석</li></ul><hr><h3 id=-실무-구현-측면>🔹 실무 구현 측면<a hidden class=anchor aria-hidden=true href=#-실무-구현-측면>#</a></h3><ul><li><strong>감사(Audit)</strong> 요구사항이 있는 금융, 전자상거래, 보건 등에서 주로 도입됨 (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">medium.com</a>)</li><li><strong>분산 시스템 통합 및 Event-Driven 아키텍처</strong>에서 이벤트 발행 및 통합 소스로 사용됨 (<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">arxiv.org</a>)</li></ul><h2 id=6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>6. 조사 및 분석: “주제와 관련하여 조사할 내용” 중심 정리<a hidden class=anchor aria-hidden=true href=#6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>#</a></h2><h3 id=1-배경>(1) 배경<a hidden class=anchor aria-hidden=true href=#1-배경>#</a></h3><ul><li>기존 시스템은 현재 상태만 저장, 이력 추적 및 감사, 복구가 어려움.</li><li>복잡한 비즈니스 도메인에서 상태 변화 이력 관리 필요성 증대.</li></ul><h2 id=-배경-및-목적-background--purpose>⚙️ 배경 및 목적 (Background & Purpose)<a hidden class=anchor aria-hidden=true href=#-배경-및-목적-background--purpose>#</a></h2><ul><li><strong>감사 & 복원</strong>: 모든 변경을 이력으로 보존 → 추적성 확보 (<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">en.paradigmadigital.com</a>)</li><li><strong>시간여행 쿼리</strong>: 과거 상태 재구성 가능 (예: 장바구니 특정 시점) (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">microservices.io</a>)</li><li><strong>분산 시스템 통합</strong>: 이벤트 기반으로 서로 다른 서비스 간 상태 공유 (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">medium.com</a>)</li><li><strong>확장성 및 성능 향상</strong>: 쓰기, 읽기 분리로 리소스 최적화 가능</li></ul><h3 id=2-목적-및-필요성>(2) 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#2-목적-및-필요성>#</a></h3><ul><li>상태 변화의 완전한 이력 보존.</li><li>감사, 복구, 분석, 데이터 무결성 보장.</li><li>시스템의 현재 상태를 언제든지 재구성 가능.</li></ul><h2 id=-기능-및-역할-key-functions--responsibilities>✅ 기능 및 역할 (Key Functions & Responsibilities)<a hidden class=anchor aria-hidden=true href=#-기능-및-역할-key-functions--responsibilities>#</a></h2><ul><li><strong>이벤트 기록(Event Logging)</strong>: 모든 상태 변경을 이벤트로 저장</li><li><strong>상태 재생(State Reconstruction)</strong>: 이벤트를 순차적으로 재생해 Aggregate 상태 복구 (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">microservices.io</a>, <a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">geeksforgeeks.org</a>)</li><li><strong>Projection 업데이트</strong>: 이벤트를 읽기 모델로 변환하여 효율적인 조회 제공</li><li><strong>이벤트 발행(Event Publishing)</strong>: 외부 시스템/서비스와 통합</li></ul><h3 id=3-주요-기능-및-역할>(3) 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#3-주요-기능-및-역할>#</a></h3><ul><li><strong>이벤트 저장</strong>: 상태 변화를 이벤트로 저장.</li><li><strong>이벤트 스트림</strong>: 이벤트의 연속된 흐름.</li><li><strong>상태 재구성</strong>: 이벤트 스트림을 재생하여 현재 상태 도출.</li><li><strong>감사 및 복구</strong>: 이벤트 이력 기반 감사, 복구, 분석.</li></ul><h2 id=-특징-characteristics>🌟 특징 (Characteristics)<a hidden class=anchor aria-hidden=true href=#-특징-characteristics>#</a></h2><ul><li>Immutable event log (불변성)</li><li>Full audit trail (전체 이력 보존)</li><li>Eventual consistency (최종적 일관성)</li><li>Temporal queries support (시간여행 쿼리)</li><li>Replayability for recovery & testing</li></ul><h3 id=4-특징>(4) 특징<a hidden class=anchor aria-hidden=true href=#4-특징>#</a></h3><ul><li>상태 변화 이력의 완전한 보존.</li><li>불변 데이터(이벤트) 기반.</li><li>이벤트 기반 아키텍처와 잘 어울림.</li><li>감사, 복구, 분석 등 다양한 활용 가능.</li></ul><h3 id=5-핵심-원칙>(5) 핵심 원칙<a hidden class=anchor aria-hidden=true href=#5-핵심-원칙>#</a></h3><ul><li><strong>상태 변화는 이벤트로 기록</strong><ul><li>모든 상태 변화는 불변의 이벤트로 저장.</li></ul></li><li><strong>상태는 이벤트 스트림에서 재구성</strong><ul><li>현재 상태는 이벤트 스트림을 재생하여 얻음.</li></ul></li><li><strong>이벤트는 원본 데이터</strong><ul><li>이벤트는 시스템의 진실의 원천(Source of Truth).</li></ul></li></ul><h3 id=6-주요-원리>(6) 주요 원리<a hidden class=anchor aria-hidden=true href=#6-주요-원리>#</a></h3><ul><li><strong>이벤트 저장 및 스트림 처리</strong><ul><li>상태 변화를 이벤트로 저장, 스트림으로 관리.</li></ul></li><li><strong>이벤트 기반 상태 재구성</strong><ul><li>이벤트 스트림을 재생하여 현재 상태 도출.</li></ul></li><li><strong>이벤트 발행 및 구독</strong><ul><li>이벤트를 발행하고, 필요한 곳에서 구독하여 처리.</li></ul></li></ul><h3 id=7-작동-원리-및-다이어그램>(7) 작동 원리 및 다이어그램<a hidden class=anchor aria-hidden=true href=#7-작동-원리-및-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
    User --&gt;|Command| CommandHandler
    CommandHandler --&gt;|Generate Event| EventStore
    EventStore --&gt;|Event Stream| EventProcessor
    EventProcessor --&gt;|Update| ReadModel
    User --&gt;|Query| QueryHandler
    QueryHandler --&gt;|Retrieve| ReadModel
</pre><p><strong>설명</strong></p><ul><li><strong>User</strong>: 시스템 사용자.</li><li><strong>CommandHandler</strong>: 명령을 처리하여 이벤트 생성.</li><li><strong>EventStore</strong>: 이벤트를 저장하는 저장소.</li><li><strong>EventProcessor</strong>: 이벤트 스트림을 처리하여 상태(Read Model) 갱신.</li><li><strong>ReadModel</strong>: 현재 상태(비정규화, 캐시 등 활용).</li><li><strong>QueryHandler</strong>: 조회 요청 처리.</li></ul><h2 id=-구조-및-아키텍처-components--diagram>🔧 구조 및 아키텍처 (Components & Diagram)<a hidden class=anchor aria-hidden=true href=#-구조-및-아키텍처-components--diagram>#</a></h2><pre class=mermaid>flowchart LR
  UI[Presentation Layer] --&gt;|Command| CmdHandler[Command Handler]
  CmdHandler --&gt;|Rebuild from history| EventStore
  CmdHandler --&gt;|Append new event| EventStore
  EventStore --&gt;|Publish events| EventBus[Queue/Topic]
  subgraph Projections
    EventBus --&gt; ProjService[Projection/Event Handler]
    ProjService --&gt; ReadStore[Read-Only DB]
  end
  UI --&gt;|Query| QueryHandler
  QueryHandler --&gt; ReadStore
</pre><ul><li><strong>Command Handler</strong>: 도메인 변경을 이벤트로 생성</li><li><strong>Event Store</strong>: append-only 구조로 이벤트 저장 및 발행 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">liurunner.blogspot.com</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">learn.microsoft.com</a>)</li><li><strong>Event Bus</strong>: 이벤트를 비동기로 전달 (Kafka, RabbitMQ 등)</li><li><strong>Projections</strong>: 이벤트를 읽어 빠른 조회용 읽기 모델 구성</li><li><strong>Query Handler</strong>: 읽기 모델을 통한 쿼리 응답</li></ul><h3 id=8-구조-및-아키텍처>(8) 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#8-구조-및-아키텍처>#</a></h3><table><thead><tr><th>구성 요소</th><th>기능 및 역할</th><th>필수/선택</th></tr></thead><tbody><tr><td>Command</td><td>상태 변경 명령</td><td>필수</td></tr><tr><td>Command Handler</td><td>명령 처리 및 이벤트 생성</td><td>필수</td></tr><tr><td>Event</td><td>상태 변화를 나타내는 불변 데이터</td><td>필수</td></tr><tr><td>Event Store</td><td>이벤트 저장 및 관리</td><td>필수</td></tr><tr><td>Event Processor</td><td>이벤트 스트림 처리 및 상태 갱신</td><td>필수</td></tr><tr><td>Read Model</td><td>현재 상태(비정규화, 캐시 등 활용)</td><td>선택(일부 시스템)</td></tr><tr><td>Query Handler</td><td>조회 요청 처리</td><td>선택(일부 시스템)</td></tr></tbody></table><p><strong>설명</strong></p><ul><li><strong>필수 구성요소</strong>: Command, Command Handler, Event, Event Store, Event Processor</li><li><strong>선택 구성요소</strong>: Read Model, Query Handler (CQRS와 연동 시 필요)</li></ul><h2 id=-구현-기법-implementation-techniques>🧩 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#-구현-기법-implementation-techniques>#</a></h2><ul><li><strong>Event Store 플랫폼</strong>: EventStoreDB, Apache Kafka, AWS Kinesis 등</li><li><strong>라이브러리 활용</strong>: eventsourcing (Python), Eventuate, Eventuous (.NET), node-eventstore (Node.js) (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">microservices.io</a>, <a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">en.paradigmadigital.com</a>, <a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">kurrent.io</a>, <a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">c-sharpcorner.com</a>)</li><li><strong>Snapshot 활용</strong>: 이벤트 재생 성능 향상 위해 주기적 상태 저장</li><li><strong>이벤트 버전 관리</strong>: Upcasting, 호환성 레이어 설계 필요</li></ul><h3 id=9-구현-기법>(9) 구현 기법<a hidden class=anchor aria-hidden=true href=#9-구현-기법>#</a></h3><ul><li><strong>이벤트 저장소 설계</strong>: 이벤트를 효율적으로 저장 및 조회할 수 있는 저장소 구현.</li><li><strong>이벤트 발행/구독</strong>: 이벤트를 발행하고, 필요한 곳에서 구독하여 처리.</li><li><strong>상태 재구성</strong>: 이벤트 스트림을 재생하여 현재 상태 도출(스냅샷 활용 가능).</li><li><strong>이벤트 기반 시스템 연동</strong>: CQRS, 마이크로서비스 등과 연동.</li></ul><h3 id=10-장점>(10) 장점<a hidden class=anchor aria-hidden=true href=#10-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 발생 원인</th></tr></thead><tbody><tr><td>장점</td><td>데이터 무결성</td><td>상태 변화 이력 완전 보존, 감사 및 복구 가능</td><td>이벤트 기반 기록</td></tr><tr><td></td><td>감사 및 추적</td><td>모든 상태 변화 이력 추적 가능</td><td>이벤트 스트림 보존</td></tr><tr><td></td><td>복구 및 분석</td><td>이벤트 재생을 통한 과거 상태 복구, 분석 가능</td><td>이벤트 재생산</td></tr><tr><td></td><td>유연성</td><td>이벤트 기반 시스템 연동(CQRS, 마이크로서비스 등)에 적합</td><td>이벤트 발행/구독</td></tr></tbody></table><h3 id=11-단점과-문제점-그리고-해결방안>(11) 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#11-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>이벤트 저장, 처리, 재생 등 시스템 복잡도 증가</td><td>명확한 설계, 문서화</td></tr><tr><td></td><td>성능</td><td>대량 이벤트 처리 시 성능 저하 가능성</td><td>스냅샷, 최적화 기법 적용</td></tr><tr><td></td><td>저장소 용량</td><td>이벤트 누적로 저장소 용량 증가</td><td>이벤트 보관 정책, 아카이빙</td></tr></tbody></table><h4 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>이벤트 중복</td><td>이벤트 발행 중복</td><td>데이터 일관성 문제</td><td>모니터링, 로그 분석</td><td>이벤트 발행 제어</td><td>중복 제거, 멱등 처리</td></tr><tr><td></td><td>이벤트 손실</td><td>네트워크/장애 등</td><td>상태 재구성 불가</td><td>모니터링, 알림</td><td>신뢰성 확보</td><td>재시도, 복구 프로세스</td></tr></tbody></table><h2 id=-도전-과제-challenges>🚀 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#-도전-과제-challenges>#</a></h2><ul><li><strong>Event ordering & partitioning</strong>: 동일 Aggregate 내 순서 유지 필수 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">upsolver.com</a>, <a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">stackoverflow.com</a>, <a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">learn.microsoft.com</a>)</li><li><strong>GDPR / PII 삭제</strong>: 이벤트에서 개인정보 삭제 요구 복잡</li><li><strong>모니터링</strong>: 이벤트 지연, 누락, 소비 실패 등 상태 추적 필요</li><li><strong>테스트 / Debug</strong>: Replay, Snapshot, Projection 상태 검증용 테스트 전략 필요</li></ul><h3 id=12-도전-과제>(12) 도전 과제<a hidden class=anchor aria-hidden=true href=#12-도전-과제>#</a></h3><ul><li><p><strong>대용량 이벤트 처리</strong></p><ul><li><strong>원인</strong>: 이벤트 누적로 인한 저장소 및 처리 부하.</li><li><strong>영향</strong>: 성능 저하, 시스템 장애.</li><li><strong>탐지 및 진단</strong>: 모니터링, 로그 분석.</li><li><strong>예방 방법</strong>: 스냅샷, 이벤트 보관 정책.</li><li><strong>해결 방법</strong>: 아카이빙, 분산 처리.</li></ul></li><li><p><strong>이벤트 기반 시스템 연동</strong></p><ul><li><strong>원인</strong>: 다양한 시스템과의 연동 복잡성.</li><li><strong>영향</strong>: 데이터 일관성, 시스템 통합 난이도 증가.</li><li><strong>탐지 및 진단</strong>: 모니터링, 테스트.</li><li><strong>예방 방법</strong>: 명확한 인터페이스 정의.</li><li><strong>해결 방법</strong>: 이벤트 버스, 마이크로서비스 아키텍처.</li></ul></li></ul><h2 id=-분류-기준에-따른-유형-categorization-table>📘 분류 기준에 따른 유형 (Categorization Table)<a hidden class=anchor aria-hidden=true href=#-분류-기준에-따른-유형-categorization-table>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>Snapshot 사용</td><td>Snapshot + Replay</td><td>이벤트 로그 재생 최적화</td></tr><tr><td>CQRS 결합</td><td>Event Sourcing + CQRS</td><td>읽기/쓰기 분리 최적화</td></tr><tr><td>동기성</td><td>Synchronous ES</td><td>커맨드 즉시 프로젝션 처리</td></tr><tr><td>비동기</td><td>Asynchronous ES</td><td>배치 또는 이벤트 발행 방식</td></tr></tbody></table><h3 id=13-분류-기준에-따른-종류-및-유형>(13) 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#13-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>구분</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>유형</td><td>단일 이벤트 소싱</td><td>단일 시스템 내 이벤트 소싱 적용</td></tr><tr><td></td><td>분산 이벤트 소싱</td><td>분산 시스템(마이크로서비스 등)에서 이벤트 소싱 적용</td></tr><tr><td></td><td>이벤트 소싱 + CQRS</td><td>이벤트 소싱과 CQRS 패턴 연동</td></tr></tbody></table><h2 id=-실무-사용-예시-use-case-table>📚 실무 사용 예시 (Use Case Table)<a hidden class=anchor aria-hidden=true href=#-실무-사용-예시-use-case-table>#</a></h2><table><thead><tr><th>시스템 유형</th><th>목적</th><th>Event Sourcing 역할</th></tr></thead><tbody><tr><td>금융 트랜잭션</td><td>감사·복원</td><td>모든 거래 이벤트 기록</td></tr><tr><td>전자상거래</td><td>상태 추적</td><td>장바구니, 주문 상태 재생</td></tr><tr><td>협업 도구</td><td>작업 히스토리</td><td>문서 편집 이력 추적</td></tr><tr><td>IoT</td><td>센서 데이터</td><td>이벤트 로그로 시계열 기록</td></tr></tbody></table><h3 id=14-실무-사용-예시>(14) 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시>#</a></h3><table><thead><tr><th>예시</th><th>목적</th><th>함께 사용되는 기술/패턴</th><th>효과</th></tr></thead><tbody><tr><td>금융 거래 시스템</td><td>거래 이력 관리</td><td>CQRS, 마이크로서비스</td><td>감사, 복구, 분석</td></tr><tr><td>주문 관리 시스템</td><td>주문 상태 변화 추적</td><td>이벤트 버스, NoSQL</td><td>상태 이력 관리, 복구</td></tr></tbody></table><h3 id=15-활용-사례>(15) 활용 사례<a hidden class=anchor aria-hidden=true href=#15-활용-사례>#</a></h3><p><strong>금융 거래 시스템 예시</strong></p><ul><li><strong>시스템 구성</strong>: 거래 명령 → 이벤트 생성 → 이벤트 저장 → 이벤트 처리 → 상태 갱신</li><li><strong>시스템 구성 다이어그램</strong></li></ul><pre class=mermaid>flowchart LR
    User --&gt;|거래 명령| CommandHandler
    CommandHandler --&gt;|이벤트 생성| EventStore
    EventStore --&gt;|이벤트 스트림| EventProcessor
    EventProcessor --&gt;|상태 갱신| ReadModel
    User --&gt;|거래 조회| QueryHandler
    QueryHandler --&gt;|상태 조회| ReadModel
</pre><ul><li><strong>Workflow</strong>:<ol><li>사용자가 거래 명령(Command) 실행.</li><li>Command Handler가 이벤트 생성 및 Event Store에 저장.</li><li>Event Processor가 이벤트 스트림을 처리하여 상태(Read Model) 갱신.</li><li>사용자가 거래 조회(Query) 시 Query Handler가 Read Model에서 상태 반환.</li></ol></li><li><strong>이벤트 소싱 역할</strong>:<ul><li>거래 이력 완전 보존, 감사, 복구, 분석 가능.</li><li>상태 변화 이력 기반 시스템 운영.</li></ul></li><li><strong>이벤트 소싱 유무에 따른 차이점</strong>:<ul><li><strong>적용 시</strong>: 거래 이력 완전 보존, 감사/복구/분석 용이.</li><li><strong>미적용 시</strong>: 현재 상태만 저장, 이력 추적 및 복구 어려움.</li></ul></li></ul><h3 id=16-구현-예시-python>(16) 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#16-구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-106-1><a class=lnlinks href=#hl-106-1> 1</a>
</span><span class=lnt id=hl-106-2><a class=lnlinks href=#hl-106-2> 2</a>
</span><span class=lnt id=hl-106-3><a class=lnlinks href=#hl-106-3> 3</a>
</span><span class=lnt id=hl-106-4><a class=lnlinks href=#hl-106-4> 4</a>
</span><span class=lnt id=hl-106-5><a class=lnlinks href=#hl-106-5> 5</a>
</span><span class=lnt id=hl-106-6><a class=lnlinks href=#hl-106-6> 6</a>
</span><span class=lnt id=hl-106-7><a class=lnlinks href=#hl-106-7> 7</a>
</span><span class=lnt id=hl-106-8><a class=lnlinks href=#hl-106-8> 8</a>
</span><span class=lnt id=hl-106-9><a class=lnlinks href=#hl-106-9> 9</a>
</span><span class=lnt id=hl-106-10><a class=lnlinks href=#hl-106-10>10</a>
</span><span class=lnt id=hl-106-11><a class=lnlinks href=#hl-106-11>11</a>
</span><span class=lnt id=hl-106-12><a class=lnlinks href=#hl-106-12>12</a>
</span><span class=lnt id=hl-106-13><a class=lnlinks href=#hl-106-13>13</a>
</span><span class=lnt id=hl-106-14><a class=lnlinks href=#hl-106-14>14</a>
</span><span class=lnt id=hl-106-15><a class=lnlinks href=#hl-106-15>15</a>
</span><span class=lnt id=hl-106-16><a class=lnlinks href=#hl-106-16>16</a>
</span><span class=lnt id=hl-106-17><a class=lnlinks href=#hl-106-17>17</a>
</span><span class=lnt id=hl-106-18><a class=lnlinks href=#hl-106-18>18</a>
</span><span class=lnt id=hl-106-19><a class=lnlinks href=#hl-106-19>19</a>
</span><span class=lnt id=hl-106-20><a class=lnlinks href=#hl-106-20>20</a>
</span><span class=lnt id=hl-106-21><a class=lnlinks href=#hl-106-21>21</a>
</span><span class=lnt id=hl-106-22><a class=lnlinks href=#hl-106-22>22</a>
</span><span class=lnt id=hl-106-23><a class=lnlinks href=#hl-106-23>23</a>
</span><span class=lnt id=hl-106-24><a class=lnlinks href=#hl-106-24>24</a>
</span><span class=lnt id=hl-106-25><a class=lnlinks href=#hl-106-25>25</a>
</span><span class=lnt id=hl-106-26><a class=lnlinks href=#hl-106-26>26</a>
</span><span class=lnt id=hl-106-27><a class=lnlinks href=#hl-106-27>27</a>
</span><span class=lnt id=hl-106-28><a class=lnlinks href=#hl-106-28>28</a>
</span><span class=lnt id=hl-106-29><a class=lnlinks href=#hl-106-29>29</a>
</span><span class=lnt id=hl-106-30><a class=lnlinks href=#hl-106-30>30</a>
</span><span class=lnt id=hl-106-31><a class=lnlinks href=#hl-106-31>31</a>
</span><span class=lnt id=hl-106-32><a class=lnlinks href=#hl-106-32>32</a>
</span><span class=lnt id=hl-106-33><a class=lnlinks href=#hl-106-33>33</a>
</span><span class=lnt id=hl-106-34><a class=lnlinks href=#hl-106-34>34</a>
</span><span class=lnt id=hl-106-35><a class=lnlinks href=#hl-106-35>35</a>
</span><span class=lnt id=hl-106-36><a class=lnlinks href=#hl-106-36>36</a>
</span><span class=lnt id=hl-106-37><a class=lnlinks href=#hl-106-37>37</a>
</span><span class=lnt id=hl-106-38><a class=lnlinks href=#hl-106-38>38</a>
</span><span class=lnt id=hl-106-39><a class=lnlinks href=#hl-106-39>39</a>
</span><span class=lnt id=hl-106-40><a class=lnlinks href=#hl-106-40>40</a>
</span><span class=lnt id=hl-106-41><a class=lnlinks href=#hl-106-41>41</a>
</span><span class=lnt id=hl-106-42><a class=lnlinks href=#hl-106-42>42</a>
</span><span class=lnt id=hl-106-43><a class=lnlinks href=#hl-106-43>43</a>
</span><span class=lnt id=hl-106-44><a class=lnlinks href=#hl-106-44>44</a>
</span><span class=lnt id=hl-106-45><a class=lnlinks href=#hl-106-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 이벤트 클래스 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 저장소 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command Handler 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>Event</span><span class=p>(</span><span class=s2>&#34;Transaction&#34;</span><span class=p>,</span> <span class=n>command_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Processor 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;Transaction&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>CommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>command_handler</span><span class=o>.</span><span class=n>handle_command</span><span class=p>({</span><span class=s2>&#34;account&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>event_processor</span> <span class=o>=</span> <span class=n>Event2Processor</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>event_processor</span><span class=o>.</span><span class=n>process_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>event_processor</span><span class=o>.</span><span class=n>state</span><span class=p>)</span>  <span class=c1># {&#39;account&#39;: &#39;A&#39;, &#39;amount&#39;: 100}</span>
</span></span></code></pre></td></tr></table></div></div><p><em>EventProcessor 클래스명은 오타가 있을 수 있습니다. 실제로는 EventProcessor로 통일하는 것이 좋습니다.</em></p><h2 id=-활용-사례--전자상거래-사례>✅ 활용 사례 – 전자상거래 사례<a hidden class=anchor aria-hidden=true href=#-활용-사례--전자상거래-사례>#</a></h2><ul><li><p><strong>시스템 구성</strong>
UI → Command Handler → Event Store → Event Bus → OrderProjection → Read DB</p></li><li><p><strong>워크플로우</strong></p><ol><li><code>CreateOrder</code> 커맨드 발행</li><li>이벤트 저장 후 프로젝션 업데이트</li><li>이미지 UI <code>GET /orders/{id}</code></li></ol></li><li><p><strong>비교: Event Sourcing 없을 경우</strong>
|user orders의 현재 상태만 저장 → 이벤트 이력 없음, 재생 불가|
Event Sourcing 적용 시: 이력 완전 기록 가능, 문제 발생 시 rollback 및 진단 가능</p></li></ul><hr><h2 id=-구현-예시-python-코드-개요>🛠 구현 예시 (Python 코드 개요)<a hidden class=anchor aria-hidden=true href=#-구현-예시-python-코드-개요>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-107-1><a class=lnlinks href=#hl-107-1>1</a>
</span><span class=lnt id=hl-107-2><a class=lnlinks href=#hl-107-2>2</a>
</span><span class=lnt id=hl-107-3><a class=lnlinks href=#hl-107-3>3</a>
</span><span class=lnt id=hl-107-4><a class=lnlinks href=#hl-107-4>4</a>
</span><span class=lnt id=hl-107-5><a class=lnlinks href=#hl-107-5>5</a>
</span><span class=lnt id=hl-107-6><a class=lnlinks href=#hl-107-6>6</a>
</span><span class=lnt id=hl-107-7><a class=lnlinks href=#hl-107-7>7</a>
</span><span class=lnt id=hl-107-8><a class=lnlinks href=#hl-107-8>8</a>
</span><span class=lnt id=hl-107-9><a class=lnlinks href=#hl-107-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>(</span><span class=n>Aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=err>…</span><span class=p>):</span> <span class=err>…</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_OrderCreated</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span> <span class=err>…</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_ItemAdded</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span> <span class=err>…</span>
</span></span><span class=line><span class=cl><span class=c1># EventStore.save + snapshot + replay 기능 포함</span>
</span></span><span class=line><span class=cl><span class=n>eventlog</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=o>.</span><span class=n>replay</span><span class=p>(</span><span class=n>eventlog</span><span class=o>.</span><span class=n>load_stream</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>order</span><span class=o>.</span><span class=n>add_item</span><span class=p>(</span><span class=err>…</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>eventlog</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=7-추가-조사-내용>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용>#</a></h2><ul><li><strong>이벤트 소싱과 CQRS의 연동</strong>:<ul><li>이벤트 소싱은 명령 처리 결과를 이벤트로 저장하고, CQRS는 읽기/쓰기 모델을 분리하여 각각 최적화.</li><li>두 패턴을 함께 사용하면 시스템의 확장성, 유지보수성, 데이터 무결성, 감사, 복구 등 다양한 이점을 얻을 수 있음.</li></ul></li><li><strong>이벤트 기반 아키텍처의 확장</strong>:<ul><li>이벤트 소싱은 마이크로서비스, 분산 시스템 등에서 상태 변화 이력 관리와 시스템 연동에 매우 효과적.</li></ul></li></ul><hr><h2 id=8-기타-사항>8. 기타 사항<a hidden class=anchor aria-hidden=true href=#8-기타-사항>#</a></h2><ul><li><strong>이벤트 소싱은 모든 시스템에 적합하지 않음</strong>:<ul><li>단순 CRUD 애플리케이션에는 오버엔지니어링이 될 수 있으므로, 복잡한 도메인, 감사/복구/분석 요구가 있는 시스템에 적합.</li></ul></li><li><strong>이벤트 스트림의 장기 보관</strong>:<ul><li>이벤트가 누적되면 저장소 용량 및 처리 부하가 증가하므로, 스냅샷, 아카이빙 등 관리 전략 필요.</li></ul></li></ul><hr><h2 id=9-주제와-관련하여-주목할-내용>9. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#9-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>이벤트 소싱</td><td>이벤트 기반 기록</td><td>상태 변화를 이벤트로 기록, 이력 보존</td></tr><tr><td>데이터 관리</td><td>이벤트 스트림</td><td>상태 재구성</td><td>이벤트 스트림 재생으로 상태 도출</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>분산 시스템 연동</td><td>이벤트 기반 시스템 연동에 적합</td></tr><tr><td>최적화</td><td>스냅샷</td><td>성능 향상</td><td>대량 이벤트 처리 시 스냅샷 활용</td></tr></tbody></table><hr><h2 id=10-반드시-학습해야할-내용>10. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#10-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>이벤트 소싱</td><td>이벤트 기반 기록</td><td>상태 변화를 이벤트로 기록, 이력 보존</td></tr><tr><td>데이터 관리</td><td>이벤트 스트림</td><td>상태 재구성</td><td>이벤트 스트림 재생으로 상태 도출</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>분산 시스템 연동</td><td>이벤트 기반 시스템 연동에 적합</td></tr><tr><td>최적화</td><td>스냅샷</td><td>성능 향상</td><td>대량 이벤트 처리 시 스냅샷 활용</td></tr></tbody></table><h3 id=-반드시-학습해야할-내용-표>📘 “반드시 학습해야할 내용” 표<a hidden class=anchor aria-hidden=true href=#-반드시-학습해야할-내용-표>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>이벤트 모델링</td><td>Event Schema Design</td><td>이벤트 명명, payload 정의, 의미 일관성</td><td></td></tr><tr><td>데이터 관리</td><td>Snapshot & Retention</td><td>저장공간, 성능, GDPR 정책과 조율</td><td></td></tr><tr><td>도구</td><td>Event Store 시스템</td><td>Kafka, EventStoreDB, AWS Kinesis 등 비교</td><td></td></tr><tr><td>패턴</td><td>CQRS 결합</td><td>Projection 설계, 일관성 모델(강/약) 설계</td><td></td></tr><tr><td>버전 관리</td><td>Upcasting</td><td>이벤트 리팩토링, 호환성 유지 전략</td><td></td></tr><tr><td>통합</td><td>Temporal Queries</td><td>과거 시점 상태를 조회하는 쿼리 설계</td><td></td></tr></tbody></table><h2 id=11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>11. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에 적합</td><td>명확한 도메인 경계 정의</td></tr><tr><td>이벤트 저장소</td><td>이벤트 저장 및 관리 필요</td><td>효율적인 저장소 설계, 아카이빙</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 성능</td><td>스냅샷, 분산 처리</td></tr><tr><td>데이터 일관성</td><td>이벤트 기반 동기화 필요</td><td>이벤트 발행/구독 신뢰성 확보</td></tr></tbody></table><hr><h2 id=12-최적화하기-위한-고려사항-및-주의할-점>12. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#12-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 저장소</td><td>대량 이벤트 저장 효율성</td><td>아카이빙, 스냅샷</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 성능</td><td>스냅샷, 분산 처리</td></tr><tr><td>상태 재구성</td><td>빠른 상태 재구성 필요</td><td>스냅샷, 캐시</td></tr><tr><td>시스템 연동</td><td>다양한 시스템과의 연동</td><td>명확한 인터페이스, 이벤트 버스</td></tr></tbody></table><hr><h2 id=13-용어-정리>13. 용어 정리<a hidden class=anchor aria-hidden=true href=#13-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>이벤트 소싱</td><td>상태 변화를 이벤트로 기록하는 아키텍처 패턴</td></tr><tr><td>데이터 관리</td><td>이벤트 스트림</td><td>상태 변화 이벤트의 연속된 흐름</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>각 서비스가 독립적으로 동작하는 아키텍처</td></tr><tr><td>최적화</td><td>스냅샷</td><td>특정 시점의 상태를 저장하여 빠른 재구성 지원</td></tr></tbody></table><h2 id=용어-정리-6>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-6>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본</td><td>Aggregate</td><td>도메인 상태 및 이벤트 생성 책임 단위</td></tr><tr><td>기본</td><td>Upcasting</td><td>이벤트 포맷 진화 시 변환 처리</td></tr><tr><td>기본</td><td>Temporal Query</td><td>과거 시점 상태 복원을 위한 재구성 쿼리</td></tr><tr><td>기본</td><td>Snapshot</td><td>이벤트 재생 성능 향상을 위한 중간 상태 저장</td></tr><tr><td>패턴</td><td>Eventual Consistency</td><td>비동기 Projection에 따른 읽기 일관성 지연</td></tr><tr><td>라이브러리</td><td>EventStoreDB</td><td>이벤트 저장 및 구독 기능 제공 DB 시스템</td></tr><tr><td>개발</td><td>Idempotency</td><td>중복 이벤트 처리 시 중복 영향 방지 처리</td></tr><tr><td>기능</td><td>Replay</td><td>이벤트를 순차적으로 다시 실행해 상태 복원</td></tr></tbody></table><hr><h2 id=참고-및-출처-6>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-6>#</a></h2><ul><li>Martin Fowler, <em>Event Sourcing</em> (<a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">docs.aws.amazon.com</a>, <a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">blog.bemi.io</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">event-driven.io</a>, <a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">theserverside.com</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">medium.com</a>, <a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">fr.wikipedia.org</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">martinfowler.com</a>)</li><li>Microservices.io, <em>Event Sourcing Pattern</em> (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">microservices.io</a>)</li><li>AWS Prescriptive Guidance, <em>Event Sourcing Pattern</em> (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">docs.aws.amazon.com</a>)</li><li>Medium, <em>Event Sourcing Explained</em> (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">event-driven.io</a>)</li><li>StackOverflow, <em>Disadvantages of Event Sourcing</em></li><li>Red Hat blog, <em>Pros & Cons of Event Sourcing</em></li><li>Kurrent.io, <em>10 problems ES helps solve</em> (<a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">kurrent.io</a>)</li><li>Innovecs blog, <em>Event Sourcing Best Practices</em> (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">innovecs.com</a>)</li><li>Wikipedia, <em>Event-driven architecture</em> (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">en.wikipedia.org</a>)</li></ul><h2 id=14-참고-및-출처>14. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#14-참고-및-출처>#</a></h2><ul><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Event Sourcing - Martin Fowler</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Event Sourcing Pattern - Microsoft Azure Architecture Center</a></li><li><a href=https://www.eventstore.com/event-sourcing>Introducing Event Sourcing - Event Store</a></li><li><a href=https://www.dddcommunity.org/event-sourcing/>Event Sourcing Explained - DDD Community</a></li></ul><h1 id=event-sourcing-포괄적-분석-및-조사>Event Sourcing 포괄적 분석 및 조사<a hidden class=anchor aria-hidden=true href=#event-sourcing-포괄적-분석-및-조사>#</a></h1><h2 id=1-기본-정보>1. 기본 정보<a hidden class=anchor aria-hidden=true href=#1-기본-정보>#</a></h2><h3 id=태그>태그<a hidden class=anchor aria-hidden=true href=#태그>#</a></h3><ul><li>Event-Sourcing</li><li>Data-Management</li><li>CQRS-Pattern</li><li>Architecture-Pattern</li></ul><h3 id=카테고리-분류-분석>카테고리 분류 분석<a hidden class=anchor aria-hidden=true href=#카테고리-분류-분석>#</a></h3><p>&ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns"의 계층 구조는 매우 적절합니다.</p><p><strong>근거:</strong></p><ul><li>Event Sourcing은 소프트웨어 설계 아키텍처 패턴의 한 종류임</li><li>데이터 관리와 직접적으로 연관된 패턴임</li><li>애플리케이션 상태를 이벤트 시퀀스로 관리하는 아키텍처 접근법임</li><li>DDD, CQRS와 함께 사용되는 고급 설계 패턴임</li></ul><h3 id=요약-설명-200자-내외>요약 설명 (200자 내외)<a hidden class=anchor aria-hidden=true href=#요약-설명-200자-내외>#</a></h3><p>Event Sourcing은 애플리케이션 상태 변화를 불변의 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 현재 상태만 저장하는 전통적 CRUD와 달리, 모든 변경사항을 이벤트로 기록하여 완전한 감사 추적과 시점별 상태 복원을 가능하게 합니다.</p><h3 id=개요-250자-내외>개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#개요-250자-내외>#</a></h3><p>Event Sourcing은 애플리케이션 상태를 이벤트 스트림으로 관리하는 데이터 아키텍처 패턴입니다. 각 상태 변화를 불변 이벤트로 append-only 저장소에 기록하며, 현재 상태는 이벤트를 순차적으로 재생하여 재구성합니다. CQRS와 함께 사용되어 읽기/쓰기 분리를 통한 성능 최적화와 복잡한 비즈니스 로직 처리에 적합합니다.</p><hr><h2 id=2-핵심-개념>2. 핵심 개념<a hidden class=anchor aria-hidden=true href=#2-핵심-개념>#</a></h2><h3 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h3><p>Event Sourcing은 애플리케이션의 상태 변화를 순차적인 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 전통적인 CRUD 방식이 현재 상태만 저장하는 것과 달리, 상태에 이르기까지의 모든 변화 과정을 불변의 이벤트로 기록합니다.</p><h3 id=핵심-구성-요소>핵심 구성 요소<a hidden class=anchor aria-hidden=true href=#핵심-구성-요소>#</a></h3><ul><li><strong>Event (이벤트)</strong>: 시스템에서 발생한 특정 변화를 나타내는 불변 객체</li><li><strong>Event Store (이벤트 저장소)</strong>: 이벤트를 시간순으로 저장하는 append-only 데이터베이스</li><li><strong>Event Stream (이벤트 스트림)</strong>: 특정 엔티티와 관련된 이벤트들의 순차적 시퀀스</li><li><strong>Aggregate (애그리거트)</strong>: 이벤트를 생성하고 상태를 관리하는 도메인 객체</li><li><strong>Projection (프로젝션)</strong>: 이벤트 스트림으로부터 파생된 읽기 전용 뷰</li></ul><h3 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h3><p>핵심 개념들은 다음과 같은 측면에서 실무 구현과 밀접하게 연관됩니다:</p><ul><li><strong>이벤트 설계</strong>: 비즈니스 도메인의 중요한 변화를 정확히 캡처하는 이벤트 모델링 필요</li><li><strong>저장소 선택</strong>: 높은 쓰기 처리량과 순차 읽기에 최적화된 데이터베이스 선택 (EventStoreDB, Apache Kafka 등)</li><li><strong>상태 복원</strong>: 이벤트 재생을 통한 효율적인 상태 재구성 메커니즘 구현</li><li><strong>스키마 진화</strong>: 시간이 지나면서 변화하는 이벤트 스키마의 버전 관리</li></ul><hr><h2 id=3-배경-및-목적>3. 배경 및 목적<a hidden class=anchor aria-hidden=true href=#3-배경-및-목적>#</a></h2><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Event Sourcing은 Domain-Driven Design (DDD) 커뮤니티에서 발전된 패턴으로, Greg Young에 의해 2010년경 체계화되었습니다. 전통적인 상태 기반 저장소의 한계점을 해결하기 위해 등장했습니다.</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li><strong>완전한 감사 추적</strong>: 모든 변경사항의 완전한 히스토리 보존</li><li><strong>시점별 상태 복원</strong>: 과거 특정 시점의 시스템 상태 정확한 재구성</li><li><strong>비즈니스 인사이트</strong>: 상태 변화 패턴 분석을 통한 비즈니스 통찰력 확보</li><li><strong>시스템 복구</strong>: 데이터 손상 시 이벤트 재생을 통한 복구 가능</li><li><strong>확장성</strong>: 읽기와 쓰기 워크로드의 독립적 확장</li></ul><hr><h2 id=4-주요-기능-및-역할>4. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#4-주요-기능-및-역할>#</a></h2><h3 id=주요-기능>주요 기능<a hidden class=anchor aria-hidden=true href=#주요-기능>#</a></h3><ol><li><strong>이벤트 기록</strong>: 모든 상태 변화를 불변 이벤트로 순차 저장</li><li><strong>상태 재구성</strong>: 이벤트 재생을 통한 현재 상태 복원</li><li><strong>시간 여행</strong>: 과거 특정 시점의 상태 조회</li><li><strong>이벤트 스트리밍</strong>: 실시간 이벤트 스트림을 통한 다른 시스템과의 통합</li><li><strong>프로젝션 생성</strong>: 다양한 읽기 모델을 위한 뷰 생성</li></ol><h3 id=역할>역할<a hidden class=anchor aria-hidden=true href=#역할>#</a></h3><ul><li><strong>데이터 지속성</strong>: 애플리케이션 상태의 영구 저장</li><li><strong>감사 로그</strong>: 모든 비즈니스 작업의 완전한 추적성 제공</li><li><strong>이벤트 소싱</strong>: 다른 시스템으로의 실시간 이벤트 전파</li><li><strong>분석 기반</strong>: 비즈니스 분석을 위한 풍부한 데이터 소스 제공</li></ul><hr><h2 id=5-특징-및-핵심-원칙>5. 특징 및 핵심 원칙<a hidden class=anchor aria-hidden=true href=#5-특징-및-핵심-원칙>#</a></h2><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>불변성</strong>: 저장된 이벤트는 변경되지 않음</li><li><strong>순차성</strong>: 이벤트는 발생 순서대로 저장됨</li><li><strong>완전성</strong>: 모든 상태 변화가 빠짐없이 기록됨</li><li><strong>결정론적</strong>: 동일한 이벤트 시퀀스는 항상 동일한 상태를 만듦</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ol><li><strong>Append-Only</strong>: 이벤트는 추가만 가능하고 수정/삭제 불가</li><li><strong>이벤트 우선</strong>: 이벤트가 시스템의 유일한 진실의 원천</li><li><strong>최종 일관성</strong>: 프로젝션과 뷰는 최종적으로 일관성을 가짐</li><li><strong>멱등성</strong>: 동일한 이벤트의 반복 처리가 안전함</li></ol><hr><h2 id=6-주요-원리-및-작동-원리>6. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#6-주요-원리-및-작동-원리>#</a></h2><h3 id=주요-원리-다이어그램>주요 원리 다이어그램<a hidden class=anchor aria-hidden=true href=#주요-원리-다이어그램>#</a></h3><pre class=mermaid>graph TB
    A[Command] --&gt; B[Aggregate]
    B --&gt; C[Event]
    C --&gt; D[Event Store]
    D --&gt; E[Event Stream]
    E --&gt; F[Projection Engine]
    F --&gt; G[Read Model]
    
    H[Query] --&gt; G
    
    I[Event Replay] --&gt; E
    E --&gt; J[State Reconstruction]
    
    classDef commandFlow fill:#e1f5fe
    classDef eventFlow fill:#f3e5f5
    classDef queryFlow fill:#e8f5e8
    
    class A,B commandFlow
    class C,D,E,F eventFlow
    class H,G,I,J queryFlow
</pre><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><ol><li><p><strong>명령 처리 단계</strong></p><ul><li>사용자 명령이 애그리거트로 전달</li><li>애그리거트가 비즈니스 로직 실행</li><li>상태 변화를 나타내는 이벤트 생성</li></ul></li><li><p><strong>이벤트 저장 단계</strong></p><ul><li>생성된 이벤트를 Event Store에 순차적으로 추가</li><li>이벤트는 타임스탬프와 시퀀스 번호를 포함</li></ul></li><li><p><strong>프로젝션 업데이트 단계</strong></p><ul><li>저장된 이벤트가 프로젝션 엔진으로 전파</li><li>다양한 읽기 모델과 뷰가 업데이트</li></ul></li><li><p><strong>상태 조회 단계</strong></p><ul><li>읽기 요청시 프로젝션에서 데이터 조회</li><li>또는 이벤트 재생을 통한 실시간 상태 구성</li></ul></li></ol><hr><h2 id=7-구조-및-아키텍처>7. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#7-구조-및-아키텍처>#</a></h2><h3 id=전체-아키텍처-다이어그램>전체 아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#전체-아키텍처-다이어그램>#</a></h3><pre class=mermaid>graph LR
    subgraph &#34;Command Side&#34;
        A[User Interface] --&gt; B[Command Handler]
        B --&gt; C[Aggregate]
        C --&gt; D[Domain Events]
    end
    
    subgraph &#34;Event Store&#34;
        D --&gt; E[Event Store Database]
        E --&gt; F[Event Streams]
    end
    
    subgraph &#34;Query Side&#34;
        F --&gt; G[Event Handlers]
        G --&gt; H[Projections]
        H --&gt; I[Read Database]
        I --&gt; J[Query Handlers]
        J --&gt; K[User Interface Views]
    end
    
    subgraph &#34;Infrastructure&#34;
        L[Message Bus]
        M[Event Publisher]
        N[Snapshots]
    end
    
    D --&gt; M
    M --&gt; L
    L --&gt; G
    E --&gt; N
    N --&gt; C
</pre><h3 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>Event Store</strong></td><td>이벤트 영구 저장</td><td>시스템의 진실의 원천</td><td>Append-only, 불변성</td></tr><tr><td><strong>Aggregate</strong></td><td>비즈니스 로직 실행</td><td>이벤트 생성 및 상태 관리</td><td>일관성 경계</td></tr><tr><td><strong>Event</strong></td><td>상태 변화 기록</td><td>도메인 변화 표현</td><td>불변, 직렬화 가능</td></tr><tr><td><strong>Event Handler</strong></td><td>이벤트 처리</td><td>프로젝션 업데이트</td><td>비동기 처리</td></tr></tbody></table><h3 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>Snapshot</strong></td><td>성능 최적화</td><td>상태 복원 가속화</td><td>선택적 최적화</td></tr><tr><td><strong>Message Bus</strong></td><td>이벤트 전파</td><td>시스템 간 통신</td><td>확장성 향상</td></tr><tr><td><strong>CQRS</strong></td><td>읽기/쓰기 분리</td><td>성능 최적화</td><td>Event Sourcing과 보완</td></tr><tr><td><strong>Saga</strong></td><td>분산 트랜잭션</td><td>마이크로서비스 조정</td><td>복잡한 워크플로우</td></tr></tbody></table><hr><h2 id=8-구현-기법>8. 구현 기법<a hidden class=anchor aria-hidden=true href=#8-구현-기법>#</a></h2><h3 id=1-기본-event-store-구현>1. 기본 Event Store 구현<a hidden class=anchor aria-hidden=true href=#1-기본-event-store-구현>#</a></h3><p><strong>정의</strong>: 이벤트를 순차적으로 저장하는 데이터베이스 구현
<strong>구성</strong>: 이벤트 테이블, 스트림 관리, 동시성 제어
<strong>목적</strong>: 모든 도메인 이벤트의 안전한 저장과 조회</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-110-1><a class=lnlinks href=#hl-110-1> 1</a>
</span><span class=lnt id=hl-110-2><a class=lnlinks href=#hl-110-2> 2</a>
</span><span class=lnt id=hl-110-3><a class=lnlinks href=#hl-110-3> 3</a>
</span><span class=lnt id=hl-110-4><a class=lnlinks href=#hl-110-4> 4</a>
</span><span class=lnt id=hl-110-5><a class=lnlinks href=#hl-110-5> 5</a>
</span><span class=lnt id=hl-110-6><a class=lnlinks href=#hl-110-6> 6</a>
</span><span class=lnt id=hl-110-7><a class=lnlinks href=#hl-110-7> 7</a>
</span><span class=lnt id=hl-110-8><a class=lnlinks href=#hl-110-8> 8</a>
</span><span class=lnt id=hl-110-9><a class=lnlinks href=#hl-110-9> 9</a>
</span><span class=lnt id=hl-110-10><a class=lnlinks href=#hl-110-10>10</a>
</span><span class=lnt id=hl-110-11><a class=lnlinks href=#hl-110-11>11</a>
</span><span class=lnt id=hl-110-12><a class=lnlinks href=#hl-110-12>12</a>
</span><span class=lnt id=hl-110-13><a class=lnlinks href=#hl-110-13>13</a>
</span><span class=lnt id=hl-110-14><a class=lnlinks href=#hl-110-14>14</a>
</span><span class=lnt id=hl-110-15><a class=lnlinks href=#hl-110-15>15</a>
</span><span class=lnt id=hl-110-16><a class=lnlinks href=#hl-110-16>16</a>
</span><span class=lnt id=hl-110-17><a class=lnlinks href=#hl-110-17>17</a>
</span><span class=lnt id=hl-110-18><a class=lnlinks href=#hl-110-18>18</a>
</span><span class=lnt id=hl-110-19><a class=lnlinks href=#hl-110-19>19</a>
</span><span class=lnt id=hl-110-20><a class=lnlinks href=#hl-110-20>20</a>
</span><span class=lnt id=hl-110-21><a class=lnlinks href=#hl-110-21>21</a>
</span><span class=lnt id=hl-110-22><a class=lnlinks href=#hl-110-22>22</a>
</span><span class=lnt id=hl-110-23><a class=lnlinks href=#hl-110-23>23</a>
</span><span class=lnt id=hl-110-24><a class=lnlinks href=#hl-110-24>24</a>
</span><span class=lnt id=hl-110-25><a class=lnlinks href=#hl-110-25>25</a>
</span><span class=lnt id=hl-110-26><a class=lnlinks href=#hl-110-26>26</a>
</span><span class=lnt id=hl-110-27><a class=lnlinks href=#hl-110-27>27</a>
</span><span class=lnt id=hl-110-28><a class=lnlinks href=#hl-110-28>28</a>
</span><span class=lnt id=hl-110-29><a class=lnlinks href=#hl-110-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>events</span><span class=p>,</span> <span class=n>expected_version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_version</span> <span class=o>!=</span> <span class=n>expected_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>ConcurrencyException</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>current_version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>from_version</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>][</span><span class=n>from_version</span><span class=p>:]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-snapshot-구현>2. Snapshot 구현<a hidden class=anchor aria-hidden=true href=#2-snapshot-구현>#</a></h3><p><strong>정의</strong>: 특정 시점의 애그리거트 상태를 저장하는 최적화 기법
<strong>구성</strong>: 스냅샷 저장소, 스냅샷 생성 정책, 복원 로직
<strong>목적</strong>: 많은 이벤트 재생 없이 빠른 상태 복원</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-111-1><a class=lnlinks href=#hl-111-1> 1</a>
</span><span class=lnt id=hl-111-2><a class=lnlinks href=#hl-111-2> 2</a>
</span><span class=lnt id=hl-111-3><a class=lnlinks href=#hl-111-3> 3</a>
</span><span class=lnt id=hl-111-4><a class=lnlinks href=#hl-111-4> 4</a>
</span><span class=lnt id=hl-111-5><a class=lnlinks href=#hl-111-5> 5</a>
</span><span class=lnt id=hl-111-6><a class=lnlinks href=#hl-111-6> 6</a>
</span><span class=lnt id=hl-111-7><a class=lnlinks href=#hl-111-7> 7</a>
</span><span class=lnt id=hl-111-8><a class=lnlinks href=#hl-111-8> 8</a>
</span><span class=lnt id=hl-111-9><a class=lnlinks href=#hl-111-9> 9</a>
</span><span class=lnt id=hl-111-10><a class=lnlinks href=#hl-111-10>10</a>
</span><span class=lnt id=hl-111-11><a class=lnlinks href=#hl-111-11>11</a>
</span><span class=lnt id=hl-111-12><a class=lnlinks href=#hl-111-12>12</a>
</span><span class=lnt id=hl-111-13><a class=lnlinks href=#hl-111-13>13</a>
</span><span class=lnt id=hl-111-14><a class=lnlinks href=#hl-111-14>14</a>
</span><span class=lnt id=hl-111-15><a class=lnlinks href=#hl-111-15>15</a>
</span><span class=lnt id=hl-111-16><a class=lnlinks href=#hl-111-16>16</a>
</span><span class=lnt id=hl-111-17><a class=lnlinks href=#hl-111-17>17</a>
</span><span class=lnt id=hl-111-18><a class=lnlinks href=#hl-111-18>18</a>
</span><span class=lnt id=hl-111-19><a class=lnlinks href=#hl-111-19>19</a>
</span><span class=lnt id=hl-111-20><a class=lnlinks href=#hl-111-20>20</a>
</span><span class=lnt id=hl-111-21><a class=lnlinks href=#hl-111-21>21</a>
</span><span class=lnt id=hl-111-22><a class=lnlinks href=#hl-111-22>22</a>
</span><span class=lnt id=hl-111-23><a class=lnlinks href=#hl-111-23>23</a>
</span><span class=lnt id=hl-111-24><a class=lnlinks href=#hl-111-24>24</a>
</span><span class=lnt id=hl-111-25><a class=lnlinks href=#hl-111-25>25</a>
</span><span class=lnt id=hl-111-26><a class=lnlinks href=#hl-111-26>26</a>
</span><span class=lnt id=hl-111-27><a class=lnlinks href=#hl-111-27>27</a>
</span><span class=lnt id=hl-111-28><a class=lnlinks href=#hl-111-28>28</a>
</span><span class=lnt id=hl-111-29><a class=lnlinks href=#hl-111-29>29</a>
</span><span class=lnt id=hl-111-30><a class=lnlinks href=#hl-111-30>30</a>
</span><span class=lnt id=hl-111-31><a class=lnlinks href=#hl-111-31>31</a>
</span><span class=lnt id=hl-111-32><a class=lnlinks href=#hl-111-32>32</a>
</span><span class=lnt id=hl-111-33><a class=lnlinks href=#hl-111-33>33</a>
</span><span class=lnt id=hl-111-34><a class=lnlinks href=#hl-111-34>34</a>
</span><span class=lnt id=hl-111-35><a class=lnlinks href=#hl-111-35>35</a>
</span><span class=lnt id=hl-111-36><a class=lnlinks href=#hl-111-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Snapshot</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>snapshot</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>snapshot</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>snapshot</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AggregateRepository</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>snapshot_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_aggregate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>snapshot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>get_snapshot</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>snapshot</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>snapshot</span><span class=o>.</span><span class=n>version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>restore_from_snapshot</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_new_aggregate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aggregate</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-cqrs-프로젝션-구현>3. CQRS 프로젝션 구현<a hidden class=anchor aria-hidden=true href=#3-cqrs-프로젝션-구현>#</a></h3><p><strong>정의</strong>: 이벤트로부터 읽기 전용 뷰를 생성하는 메커니즘
<strong>구성</strong>: 이벤트 핸들러, 프로젝션 저장소, 업데이트 로직
<strong>목적</strong>: 쿼리에 최적화된 다양한 뷰 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-112-1><a class=lnlinks href=#hl-112-1> 1</a>
</span><span class=lnt id=hl-112-2><a class=lnlinks href=#hl-112-2> 2</a>
</span><span class=lnt id=hl-112-3><a class=lnlinks href=#hl-112-3> 3</a>
</span><span class=lnt id=hl-112-4><a class=lnlinks href=#hl-112-4> 4</a>
</span><span class=lnt id=hl-112-5><a class=lnlinks href=#hl-112-5> 5</a>
</span><span class=lnt id=hl-112-6><a class=lnlinks href=#hl-112-6> 6</a>
</span><span class=lnt id=hl-112-7><a class=lnlinks href=#hl-112-7> 7</a>
</span><span class=lnt id=hl-112-8><a class=lnlinks href=#hl-112-8> 8</a>
</span><span class=lnt id=hl-112-9><a class=lnlinks href=#hl-112-9> 9</a>
</span><span class=lnt id=hl-112-10><a class=lnlinks href=#hl-112-10>10</a>
</span><span class=lnt id=hl-112-11><a class=lnlinks href=#hl-112-11>11</a>
</span><span class=lnt id=hl-112-12><a class=lnlinks href=#hl-112-12>12</a>
</span><span class=lnt id=hl-112-13><a class=lnlinks href=#hl-112-13>13</a>
</span><span class=lnt id=hl-112-14><a class=lnlinks href=#hl-112-14>14</a>
</span><span class=lnt id=hl-112-15><a class=lnlinks href=#hl-112-15>15</a>
</span><span class=lnt id=hl-112-16><a class=lnlinks href=#hl-112-16>16</a>
</span><span class=lnt id=hl-112-17><a class=lnlinks href=#hl-112-17>17</a>
</span><span class=lnt id=hl-112-18><a class=lnlinks href=#hl-112-18>18</a>
</span><span class=lnt id=hl-112-19><a class=lnlinks href=#hl-112-19>19</a>
</span><span class=lnt id=hl-112-20><a class=lnlinks href=#hl-112-20>20</a>
</span><span class=lnt id=hl-112-21><a class=lnlinks href=#hl-112-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_confirmed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;confirmed&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;confirmed_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_orders_by_customer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>order</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>values</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>order</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>customer_id</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=9-장점>9. 장점<a hidden class=anchor aria-hidden=true href=#9-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>완전한 감사 추적</strong></td><td>모든 상태 변화가 불변 이벤트로 기록되어 완벽한 감사 로그 제공. 규정 준수와 보안 감사에 필수적</td></tr><tr><td></td><td><strong>시점별 상태 복원</strong></td><td>이벤트 재생을 통해 과거 임의 시점의 정확한 상태 재구성 가능. 디버깅과 분석에 강력한 도구 제공</td></tr><tr><td></td><td><strong>높은 쓰기 성능</strong></td><td>Append-only 구조로 락 경합 최소화하여 높은 쓰기 처리량 달성</td></tr><tr><td></td><td><strong>이벤트 기반 통합</strong></td><td>이벤트 스트림을 통한 자연스러운 시스템 간 통합과 마이크로서비스 아키텍처 지원</td></tr><tr><td></td><td><strong>비즈니스 인사이트</strong></td><td>이벤트 히스토리를 통한 풍부한 비즈니스 분석과 패턴 인식 가능</td></tr><tr><td></td><td><strong>확장성</strong></td><td>CQRS와 결합하여 읽기와 쓰기 워크로드의 독립적 확장 지원</td></tr></tbody></table><hr><h2 id=10-단점과-문제점-그리고-해결방안>10. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#10-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>복잡성 증가</strong></td><td>전통적 CRUD 대비 시스템 설계와 구현 복잡도 대폭 증가</td><td>단계별 도입, 팀 교육, 프레임워크 활용</td></tr><tr><td></td><td><strong>학습 곡선</strong></td><td>개발팀의 새로운 패러다임 학습 필요, 개발 생산성 초기 저하</td><td>충분한 교육 기간, 멘토링, 점진적 적용</td></tr><tr><td></td><td><strong>저장소 요구사항</strong></td><td>모든 이벤트 저장으로 인한 높은 스토리지 사용량</td><td>이벤트 압축, 아카이빙, 스냅샷 활용</td></tr><tr><td></td><td><strong>최종 일관성</strong></td><td>프로젝션 업데이트 지연으로 인한 읽기 데이터 불일치 가능성</td><td>적절한 캐싱, 사용자 경험 설계, 일관성 모니터링</td></tr></tbody></table><h3 id=문제점-2>문제점<a hidden class=anchor aria-hidden=true href=#문제점-2>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td><strong>이벤트 재생 성능 저하</strong></td><td>대량의 이벤트 누적으로 상태 복원 시간 증가</td><td>시스템 응답 시간 저하, 사용자 경험 악화</td><td>성능 모니터링, 재생 시간 측정</td><td>스냅샷 정책 수립, 이벤트 스트림 설계 최적화</td><td>스냅샷 구현, 이벤트 압축, 스트림 분할</td></tr><tr><td></td><td><strong>스키마 진화 문제</strong></td><td>시간이 지나면서 이벤트 구조 변경 필요성</td><td>기존 이벤트와 호환성 문제</td><td>스키마 버전 추적, 역직렬화 오류 모니터링</td><td>이벤트 버전 관리, 스키마 레지스트리 사용</td><td>이벤트 업캐스팅, 다중 버전 지원</td></tr><tr><td></td><td><strong>동시성 충돌</strong></td><td>동일 애그리거트에 대한 동시 업데이트</td><td>데이터 일관성 문제, 비즈니스 규칙 위반</td><td>버전 충돌 예외 모니터링</td><td>낙관적 동시성 제어, 적절한 애그리거트 경계 설정</td><td>재시도 메커니즘, 충돌 해결 정책 구현</td></tr><tr><td></td><td><strong>프로젝션 실패</strong></td><td>이벤트 처리 중 오류 발생</td><td>읽기 모델 불일치, 데이터 누락</td><td>프로젝션 상태 모니터링, 이벤트 처리 로그</td><td>멱등한 이벤트 핸들러 설계, 오류 처리 로직</td><td>Dead Letter Queue, 수동 복구 도구, 프로젝션 재구축</td></tr></tbody></table><hr><h2 id=11-도전-과제>11. 도전 과제<a hidden class=anchor aria-hidden=true href=#11-도전-과제>#</a></h2><h3 id=성능-및-확장성-과제>성능 및 확장성 과제<a hidden class=anchor aria-hidden=true href=#성능-및-확장성-과제>#</a></h3><p><strong>원인</strong>: 이벤트 볼륨 증가와 복잡한 프로젝션 처리
<strong>영향</strong>: 시스템 응답 시간 저하와 리소스 사용량 증가
<strong>해결 방법</strong>:</p><ul><li>이벤트 스트림 파티셔닝</li><li>병렬 프로젝션 처리</li><li>캐싱 전략 최적화</li><li>하드웨어 스케일 아웃</li></ul><h3 id=데이터-일관성-과제>데이터 일관성 과제<a hidden class=anchor aria-hidden=true href=#데이터-일관성-과제>#</a></h3><p><strong>원인</strong>: 분산 환경에서의 최종 일관성 모델
<strong>영향</strong>: 일시적 데이터 불일치와 사용자 혼란
<strong>해결 방법</strong>:</p><ul><li>적절한 일관성 경계 설정</li><li>사용자 인터페이스에서 일관성 상태 표시</li><li>보상 트랜잭션 구현</li></ul><h3 id=운영-및-모니터링-과제>운영 및 모니터링 과제<a hidden class=anchor aria-hidden=true href=#운영-및-모니터링-과제>#</a></h3><p><strong>원인</strong>: 복잡한 이벤트 기반 워크플로우
<strong>영향</strong>: 문제 진단 어려움과 운영 복잡성
<strong>해결 방법</strong>:</p><ul><li>포괄적인 이벤트 추적 시스템</li><li>실시간 대시보드와 알림</li><li>자동화된 복구 메커니즘</li></ul><hr><h2 id=12-분류-기준에-따른-종류-및-유형>12. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#12-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th><th>특징</th></tr></thead><tbody><tr><td><strong>저장소 타입</strong></td><td>In-Memory</td><td>메모리 내 이벤트 저장</td><td>빠른 성능, 휘발성</td></tr><tr><td></td><td>Relational DB</td><td>관계형 데이터베이스 사용</td><td>ACID 보장, 복잡한 쿼리</td></tr><tr><td></td><td>NoSQL</td><td>문서/키-값 데이터베이스</td><td>수평 확장, 스키마 유연성</td></tr><tr><td></td><td>Specialized</td><td>EventStoreDB 등 전용 저장소</td><td>이벤트 최적화, 고성능</td></tr><tr><td><strong>아키텍처 패턴</strong></td><td>Pure Event Sourcing</td><td>이벤트만으로 상태 관리</td><td>완전한 이벤트 기반</td></tr><tr><td></td><td>CQRS + Event Sourcing</td><td>읽기/쓰기 분리 결합</td><td>성능 최적화</td></tr><tr><td></td><td>Hybrid</td><td>일부 상태는 전통적 저장</td><td>점진적 도입 가능</td></tr><tr><td><strong>동시성 모델</strong></td><td>Single Writer</td><td>단일 작성자 모델</td><td>충돌 방지</td></tr><tr><td></td><td>Optimistic Concurrency</td><td>낙관적 동시성 제어</td><td>높은 처리량</td></tr><tr><td></td><td>Event Collapsing</td><td>이벤트 병합</td><td>중복 제거</td></tr></tbody></table><hr><h2 id=13-실무-사용-예시>13. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#13-실무-사용-예시>#</a></h2><table><thead><tr><th>활용 영역</th><th>목적</th><th>효과</th><th>동반 기술</th></tr></thead><tbody><tr><td><strong>금융 시스템</strong></td><td>거래 내역 완전 추적, 규정 준수</td><td>완벽한 감사 추적, 사기 탐지 향상</td><td>CQRS, 블록체인</td></tr><tr><td><strong>전자상거래</strong></td><td>주문 상태 관리, 재고 추적</td><td>정확한 재고 관리, 주문 히스토리 분석</td><td>마이크로서비스, API Gateway</td></tr><tr><td><strong>의료 정보 시스템</strong></td><td>환자 진료 기록 관리</td><td>의료 과실 방지, 치료 이력 추적</td><td>HL7 FHIR, 암호화</td></tr><tr><td><strong>게임 플랫폼</strong></td><td>플레이어 행동 분석, 게임 상태 관리</td><td>치트 방지, 게임 밸런싱 개선</td><td>실시간 분석, Machine Learning</td></tr><tr><td><strong>IoT 플랫폼</strong></td><td>센서 데이터 수집, 이벤트 처리</td><td>예측 유지보수, 이상 탐지</td><td>Stream Processing, Edge Computing</td></tr></tbody></table><hr><h2 id=14-활용-사례-전자상거래-주문-관리-시스템>14. 활용 사례: 전자상거래 주문 관리 시스템<a hidden class=anchor aria-hidden=true href=#14-활용-사례-전자상거래-주문-관리-시스템>#</a></h2><h3 id=시스템-구성-1>시스템 구성<a hidden class=anchor aria-hidden=true href=#시스템-구성-1>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;사용자 인터페이스&#34;
        A[Web Frontend]
        B[Mobile App]
    end
    
    subgraph &#34;API Gateway&#34;
        C[Order API]
        D[Inventory API]
        E[Payment API]
    end
    
    subgraph &#34;Command Side&#34;
        F[Order Service]
        G[Inventory Service]
        H[Payment Service]
    end
    
    subgraph &#34;Event Store&#34;
        I[(EventStoreDB)]
    end
    
    subgraph &#34;Query Side&#34;
        J[Order Projection]
        K[Inventory Projection]
        L[Analytics Projection]
        M[(Read Database)]
    end
    
    subgraph &#34;Message Bus&#34;
        N[Kafka]
    end
    
    A --&gt; C
    B --&gt; C
    C --&gt; F
    F --&gt; I
    I --&gt; N
    N --&gt; J
    J --&gt; M
    M --&gt; A
</pre><h3 id=workflow-1>Workflow<a hidden class=anchor aria-hidden=true href=#workflow-1>#</a></h3><ol><li><p><strong>주문 생성</strong></p><ul><li>고객이 상품을 장바구니에 추가하고 주문 생성</li><li>OrderCreatedEvent 생성 및 저장</li><li>재고 서비스로 이벤트 전파</li></ul></li><li><p><strong>재고 확인 및 예약</strong></p><ul><li>재고 서비스가 주문 이벤트 수신</li><li>재고 확인 후 ItemReservedEvent 생성</li><li>결제 서비스로 이벤트 전파</li></ul></li><li><p><strong>결제 처리</strong></p><ul><li>결제 서비스가 결제 진행</li><li>PaymentProcessedEvent 생성</li><li>주문 확정 처리</li></ul></li></ol><h3 id=event-sourcing의-역할>Event Sourcing의 역할<a hidden class=anchor aria-hidden=true href=#event-sourcing의-역할>#</a></h3><ul><li><strong>상태 추적</strong>: 주문의 모든 상태 변화를 이벤트로 기록</li><li><strong>일관성 보장</strong>: 서비스 간 이벤트 기반 통신으로 최종 일관성 확보</li><li><strong>감사 추적</strong>: 주문 처리 과정의 완전한 추적 가능</li><li><strong>복구 지원</strong>: 시스템 장애 시 이벤트 재생을 통한 상태 복구</li></ul><h3 id=event-sourcing-유무에-따른-차이점>Event Sourcing 유무에 따른 차이점<a hidden class=anchor aria-hidden=true href=#event-sourcing-유무에-따른-차이점>#</a></h3><p><strong>Event Sourcing 사용</strong>:</p><ul><li>주문 상태 변화의 완전한 히스토리 보존</li><li>서비스 간 느슨한 결합</li><li>높은 확장성과 가용성</li><li>복잡한 비즈니스 로직 처리 용이</li></ul><p><strong>전통적 CRUD 사용</strong>:</p><ul><li>현재 상태만 저장하여 히스토리 손실</li><li>서비스 간 강한 결합</li><li>확장성 제한</li><li>동시성 문제와 데이터 일관성 이슈</li></ul><hr><h2 id=15-구현-예시>15. 구현 예시<a hidden class=anchor aria-hidden=true href=#15-구현-예시>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-114-1><a class=lnlinks href=#hl-114-1>  1</a>
</span><span class=lnt id=hl-114-2><a class=lnlinks href=#hl-114-2>  2</a>
</span><span class=lnt id=hl-114-3><a class=lnlinks href=#hl-114-3>  3</a>
</span><span class=lnt id=hl-114-4><a class=lnlinks href=#hl-114-4>  4</a>
</span><span class=lnt id=hl-114-5><a class=lnlinks href=#hl-114-5>  5</a>
</span><span class=lnt id=hl-114-6><a class=lnlinks href=#hl-114-6>  6</a>
</span><span class=lnt id=hl-114-7><a class=lnlinks href=#hl-114-7>  7</a>
</span><span class=lnt id=hl-114-8><a class=lnlinks href=#hl-114-8>  8</a>
</span><span class=lnt id=hl-114-9><a class=lnlinks href=#hl-114-9>  9</a>
</span><span class=lnt id=hl-114-10><a class=lnlinks href=#hl-114-10> 10</a>
</span><span class=lnt id=hl-114-11><a class=lnlinks href=#hl-114-11> 11</a>
</span><span class=lnt id=hl-114-12><a class=lnlinks href=#hl-114-12> 12</a>
</span><span class=lnt id=hl-114-13><a class=lnlinks href=#hl-114-13> 13</a>
</span><span class=lnt id=hl-114-14><a class=lnlinks href=#hl-114-14> 14</a>
</span><span class=lnt id=hl-114-15><a class=lnlinks href=#hl-114-15> 15</a>
</span><span class=lnt id=hl-114-16><a class=lnlinks href=#hl-114-16> 16</a>
</span><span class=lnt id=hl-114-17><a class=lnlinks href=#hl-114-17> 17</a>
</span><span class=lnt id=hl-114-18><a class=lnlinks href=#hl-114-18> 18</a>
</span><span class=lnt id=hl-114-19><a class=lnlinks href=#hl-114-19> 19</a>
</span><span class=lnt id=hl-114-20><a class=lnlinks href=#hl-114-20> 20</a>
</span><span class=lnt id=hl-114-21><a class=lnlinks href=#hl-114-21> 21</a>
</span><span class=lnt id=hl-114-22><a class=lnlinks href=#hl-114-22> 22</a>
</span><span class=lnt id=hl-114-23><a class=lnlinks href=#hl-114-23> 23</a>
</span><span class=lnt id=hl-114-24><a class=lnlinks href=#hl-114-24> 24</a>
</span><span class=lnt id=hl-114-25><a class=lnlinks href=#hl-114-25> 25</a>
</span><span class=lnt id=hl-114-26><a class=lnlinks href=#hl-114-26> 26</a>
</span><span class=lnt id=hl-114-27><a class=lnlinks href=#hl-114-27> 27</a>
</span><span class=lnt id=hl-114-28><a class=lnlinks href=#hl-114-28> 28</a>
</span><span class=lnt id=hl-114-29><a class=lnlinks href=#hl-114-29> 29</a>
</span><span class=lnt id=hl-114-30><a class=lnlinks href=#hl-114-30> 30</a>
</span><span class=lnt id=hl-114-31><a class=lnlinks href=#hl-114-31> 31</a>
</span><span class=lnt id=hl-114-32><a class=lnlinks href=#hl-114-32> 32</a>
</span><span class=lnt id=hl-114-33><a class=lnlinks href=#hl-114-33> 33</a>
</span><span class=lnt id=hl-114-34><a class=lnlinks href=#hl-114-34> 34</a>
</span><span class=lnt id=hl-114-35><a class=lnlinks href=#hl-114-35> 35</a>
</span><span class=lnt id=hl-114-36><a class=lnlinks href=#hl-114-36> 36</a>
</span><span class=lnt id=hl-114-37><a class=lnlinks href=#hl-114-37> 37</a>
</span><span class=lnt id=hl-114-38><a class=lnlinks href=#hl-114-38> 38</a>
</span><span class=lnt id=hl-114-39><a class=lnlinks href=#hl-114-39> 39</a>
</span><span class=lnt id=hl-114-40><a class=lnlinks href=#hl-114-40> 40</a>
</span><span class=lnt id=hl-114-41><a class=lnlinks href=#hl-114-41> 41</a>
</span><span class=lnt id=hl-114-42><a class=lnlinks href=#hl-114-42> 42</a>
</span><span class=lnt id=hl-114-43><a class=lnlinks href=#hl-114-43> 43</a>
</span><span class=lnt id=hl-114-44><a class=lnlinks href=#hl-114-44> 44</a>
</span><span class=lnt id=hl-114-45><a class=lnlinks href=#hl-114-45> 45</a>
</span><span class=lnt id=hl-114-46><a class=lnlinks href=#hl-114-46> 46</a>
</span><span class=lnt id=hl-114-47><a class=lnlinks href=#hl-114-47> 47</a>
</span><span class=lnt id=hl-114-48><a class=lnlinks href=#hl-114-48> 48</a>
</span><span class=lnt id=hl-114-49><a class=lnlinks href=#hl-114-49> 49</a>
</span><span class=lnt id=hl-114-50><a class=lnlinks href=#hl-114-50> 50</a>
</span><span class=lnt id=hl-114-51><a class=lnlinks href=#hl-114-51> 51</a>
</span><span class=lnt id=hl-114-52><a class=lnlinks href=#hl-114-52> 52</a>
</span><span class=lnt id=hl-114-53><a class=lnlinks href=#hl-114-53> 53</a>
</span><span class=lnt id=hl-114-54><a class=lnlinks href=#hl-114-54> 54</a>
</span><span class=lnt id=hl-114-55><a class=lnlinks href=#hl-114-55> 55</a>
</span><span class=lnt id=hl-114-56><a class=lnlinks href=#hl-114-56> 56</a>
</span><span class=lnt id=hl-114-57><a class=lnlinks href=#hl-114-57> 57</a>
</span><span class=lnt id=hl-114-58><a class=lnlinks href=#hl-114-58> 58</a>
</span><span class=lnt id=hl-114-59><a class=lnlinks href=#hl-114-59> 59</a>
</span><span class=lnt id=hl-114-60><a class=lnlinks href=#hl-114-60> 60</a>
</span><span class=lnt id=hl-114-61><a class=lnlinks href=#hl-114-61> 61</a>
</span><span class=lnt id=hl-114-62><a class=lnlinks href=#hl-114-62> 62</a>
</span><span class=lnt id=hl-114-63><a class=lnlinks href=#hl-114-63> 63</a>
</span><span class=lnt id=hl-114-64><a class=lnlinks href=#hl-114-64> 64</a>
</span><span class=lnt id=hl-114-65><a class=lnlinks href=#hl-114-65> 65</a>
</span><span class=lnt id=hl-114-66><a class=lnlinks href=#hl-114-66> 66</a>
</span><span class=lnt id=hl-114-67><a class=lnlinks href=#hl-114-67> 67</a>
</span><span class=lnt id=hl-114-68><a class=lnlinks href=#hl-114-68> 68</a>
</span><span class=lnt id=hl-114-69><a class=lnlinks href=#hl-114-69> 69</a>
</span><span class=lnt id=hl-114-70><a class=lnlinks href=#hl-114-70> 70</a>
</span><span class=lnt id=hl-114-71><a class=lnlinks href=#hl-114-71> 71</a>
</span><span class=lnt id=hl-114-72><a class=lnlinks href=#hl-114-72> 72</a>
</span><span class=lnt id=hl-114-73><a class=lnlinks href=#hl-114-73> 73</a>
</span><span class=lnt id=hl-114-74><a class=lnlinks href=#hl-114-74> 74</a>
</span><span class=lnt id=hl-114-75><a class=lnlinks href=#hl-114-75> 75</a>
</span><span class=lnt id=hl-114-76><a class=lnlinks href=#hl-114-76> 76</a>
</span><span class=lnt id=hl-114-77><a class=lnlinks href=#hl-114-77> 77</a>
</span><span class=lnt id=hl-114-78><a class=lnlinks href=#hl-114-78> 78</a>
</span><span class=lnt id=hl-114-79><a class=lnlinks href=#hl-114-79> 79</a>
</span><span class=lnt id=hl-114-80><a class=lnlinks href=#hl-114-80> 80</a>
</span><span class=lnt id=hl-114-81><a class=lnlinks href=#hl-114-81> 81</a>
</span><span class=lnt id=hl-114-82><a class=lnlinks href=#hl-114-82> 82</a>
</span><span class=lnt id=hl-114-83><a class=lnlinks href=#hl-114-83> 83</a>
</span><span class=lnt id=hl-114-84><a class=lnlinks href=#hl-114-84> 84</a>
</span><span class=lnt id=hl-114-85><a class=lnlinks href=#hl-114-85> 85</a>
</span><span class=lnt id=hl-114-86><a class=lnlinks href=#hl-114-86> 86</a>
</span><span class=lnt id=hl-114-87><a class=lnlinks href=#hl-114-87> 87</a>
</span><span class=lnt id=hl-114-88><a class=lnlinks href=#hl-114-88> 88</a>
</span><span class=lnt id=hl-114-89><a class=lnlinks href=#hl-114-89> 89</a>
</span><span class=lnt id=hl-114-90><a class=lnlinks href=#hl-114-90> 90</a>
</span><span class=lnt id=hl-114-91><a class=lnlinks href=#hl-114-91> 91</a>
</span><span class=lnt id=hl-114-92><a class=lnlinks href=#hl-114-92> 92</a>
</span><span class=lnt id=hl-114-93><a class=lnlinks href=#hl-114-93> 93</a>
</span><span class=lnt id=hl-114-94><a class=lnlinks href=#hl-114-94> 94</a>
</span><span class=lnt id=hl-114-95><a class=lnlinks href=#hl-114-95> 95</a>
</span><span class=lnt id=hl-114-96><a class=lnlinks href=#hl-114-96> 96</a>
</span><span class=lnt id=hl-114-97><a class=lnlinks href=#hl-114-97> 97</a>
</span><span class=lnt id=hl-114-98><a class=lnlinks href=#hl-114-98> 98</a>
</span><span class=lnt id=hl-114-99><a class=lnlinks href=#hl-114-99> 99</a>
</span><span class=lnt id=hl-114-100><a class=lnlinks href=#hl-114-100>100</a>
</span><span class=lnt id=hl-114-101><a class=lnlinks href=#hl-114-101>101</a>
</span><span class=lnt id=hl-114-102><a class=lnlinks href=#hl-114-102>102</a>
</span><span class=lnt id=hl-114-103><a class=lnlinks href=#hl-114-103>103</a>
</span><span class=lnt id=hl-114-104><a class=lnlinks href=#hl-114-104>104</a>
</span><span class=lnt id=hl-114-105><a class=lnlinks href=#hl-114-105>105</a>
</span><span class=lnt id=hl-114-106><a class=lnlinks href=#hl-114-106>106</a>
</span><span class=lnt id=hl-114-107><a class=lnlinks href=#hl-114-107>107</a>
</span><span class=lnt id=hl-114-108><a class=lnlinks href=#hl-114-108>108</a>
</span><span class=lnt id=hl-114-109><a class=lnlinks href=#hl-114-109>109</a>
</span><span class=lnt id=hl-114-110><a class=lnlinks href=#hl-114-110>110</a>
</span><span class=lnt id=hl-114-111><a class=lnlinks href=#hl-114-111>111</a>
</span><span class=lnt id=hl-114-112><a class=lnlinks href=#hl-114-112>112</a>
</span><span class=lnt id=hl-114-113><a class=lnlinks href=#hl-114-113>113</a>
</span><span class=lnt id=hl-114-114><a class=lnlinks href=#hl-114-114>114</a>
</span><span class=lnt id=hl-114-115><a class=lnlinks href=#hl-114-115>115</a>
</span><span class=lnt id=hl-114-116><a class=lnlinks href=#hl-114-116>116</a>
</span><span class=lnt id=hl-114-117><a class=lnlinks href=#hl-114-117>117</a>
</span><span class=lnt id=hl-114-118><a class=lnlinks href=#hl-114-118>118</a>
</span><span class=lnt id=hl-114-119><a class=lnlinks href=#hl-114-119>119</a>
</span><span class=lnt id=hl-114-120><a class=lnlinks href=#hl-114-120>120</a>
</span><span class=lnt id=hl-114-121><a class=lnlinks href=#hl-114-121>121</a>
</span><span class=lnt id=hl-114-122><a class=lnlinks href=#hl-114-122>122</a>
</span><span class=lnt id=hl-114-123><a class=lnlinks href=#hl-114-123>123</a>
</span><span class=lnt id=hl-114-124><a class=lnlinks href=#hl-114-124>124</a>
</span><span class=lnt id=hl-114-125><a class=lnlinks href=#hl-114-125>125</a>
</span><span class=lnt id=hl-114-126><a class=lnlinks href=#hl-114-126>126</a>
</span><span class=lnt id=hl-114-127><a class=lnlinks href=#hl-114-127>127</a>
</span><span class=lnt id=hl-114-128><a class=lnlinks href=#hl-114-128>128</a>
</span><span class=lnt id=hl-114-129><a class=lnlinks href=#hl-114-129>129</a>
</span><span class=lnt id=hl-114-130><a class=lnlinks href=#hl-114-130>130</a>
</span><span class=lnt id=hl-114-131><a class=lnlinks href=#hl-114-131>131</a>
</span><span class=lnt id=hl-114-132><a class=lnlinks href=#hl-114-132>132</a>
</span><span class=lnt id=hl-114-133><a class=lnlinks href=#hl-114-133>133</a>
</span><span class=lnt id=hl-114-134><a class=lnlinks href=#hl-114-134>134</a>
</span><span class=lnt id=hl-114-135><a class=lnlinks href=#hl-114-135>135</a>
</span><span class=lnt id=hl-114-136><a class=lnlinks href=#hl-114-136>136</a>
</span><span class=lnt id=hl-114-137><a class=lnlinks href=#hl-114-137>137</a>
</span><span class=lnt id=hl-114-138><a class=lnlinks href=#hl-114-138>138</a>
</span><span class=lnt id=hl-114-139><a class=lnlinks href=#hl-114-139>139</a>
</span><span class=lnt id=hl-114-140><a class=lnlinks href=#hl-114-140>140</a>
</span><span class=lnt id=hl-114-141><a class=lnlinks href=#hl-114-141>141</a>
</span><span class=lnt id=hl-114-142><a class=lnlinks href=#hl-114-142>142</a>
</span><span class=lnt id=hl-114-143><a class=lnlinks href=#hl-114-143>143</a>
</span><span class=lnt id=hl-114-144><a class=lnlinks href=#hl-114-144>144</a>
</span><span class=lnt id=hl-114-145><a class=lnlinks href=#hl-114-145>145</a>
</span><span class=lnt id=hl-114-146><a class=lnlinks href=#hl-114-146>146</a>
</span><span class=lnt id=hl-114-147><a class=lnlinks href=#hl-114-147>147</a>
</span><span class=lnt id=hl-114-148><a class=lnlinks href=#hl-114-148>148</a>
</span><span class=lnt id=hl-114-149><a class=lnlinks href=#hl-114-149>149</a>
</span><span class=lnt id=hl-114-150><a class=lnlinks href=#hl-114-150>150</a>
</span><span class=lnt id=hl-114-151><a class=lnlinks href=#hl-114-151>151</a>
</span><span class=lnt id=hl-114-152><a class=lnlinks href=#hl-114-152>152</a>
</span><span class=lnt id=hl-114-153><a class=lnlinks href=#hl-114-153>153</a>
</span><span class=lnt id=hl-114-154><a class=lnlinks href=#hl-114-154>154</a>
</span><span class=lnt id=hl-114-155><a class=lnlinks href=#hl-114-155>155</a>
</span><span class=lnt id=hl-114-156><a class=lnlinks href=#hl-114-156>156</a>
</span><span class=lnt id=hl-114-157><a class=lnlinks href=#hl-114-157>157</a>
</span><span class=lnt id=hl-114-158><a class=lnlinks href=#hl-114-158>158</a>
</span><span class=lnt id=hl-114-159><a class=lnlinks href=#hl-114-159>159</a>
</span><span class=lnt id=hl-114-160><a class=lnlinks href=#hl-114-160>160</a>
</span><span class=lnt id=hl-114-161><a class=lnlinks href=#hl-114-161>161</a>
</span><span class=lnt id=hl-114-162><a class=lnlinks href=#hl-114-162>162</a>
</span><span class=lnt id=hl-114-163><a class=lnlinks href=#hl-114-163>163</a>
</span><span class=lnt id=hl-114-164><a class=lnlinks href=#hl-114-164>164</a>
</span><span class=lnt id=hl-114-165><a class=lnlinks href=#hl-114-165>165</a>
</span><span class=lnt id=hl-114-166><a class=lnlinks href=#hl-114-166>166</a>
</span><span class=lnt id=hl-114-167><a class=lnlinks href=#hl-114-167>167</a>
</span><span class=lnt id=hl-114-168><a class=lnlinks href=#hl-114-168>168</a>
</span><span class=lnt id=hl-114-169><a class=lnlinks href=#hl-114-169>169</a>
</span><span class=lnt id=hl-114-170><a class=lnlinks href=#hl-114-170>170</a>
</span><span class=lnt id=hl-114-171><a class=lnlinks href=#hl-114-171>171</a>
</span><span class=lnt id=hl-114-172><a class=lnlinks href=#hl-114-172>172</a>
</span><span class=lnt id=hl-114-173><a class=lnlinks href=#hl-114-173>173</a>
</span><span class=lnt id=hl-114-174><a class=lnlinks href=#hl-114-174>174</a>
</span><span class=lnt id=hl-114-175><a class=lnlinks href=#hl-114-175>175</a>
</span><span class=lnt id=hl-114-176><a class=lnlinks href=#hl-114-176>176</a>
</span><span class=lnt id=hl-114-177><a class=lnlinks href=#hl-114-177>177</a>
</span><span class=lnt id=hl-114-178><a class=lnlinks href=#hl-114-178>178</a>
</span><span class=lnt id=hl-114-179><a class=lnlinks href=#hl-114-179>179</a>
</span><span class=lnt id=hl-114-180><a class=lnlinks href=#hl-114-180>180</a>
</span><span class=lnt id=hl-114-181><a class=lnlinks href=#hl-114-181>181</a>
</span><span class=lnt id=hl-114-182><a class=lnlinks href=#hl-114-182>182</a>
</span><span class=lnt id=hl-114-183><a class=lnlinks href=#hl-114-183>183</a>
</span><span class=lnt id=hl-114-184><a class=lnlinks href=#hl-114-184>184</a>
</span><span class=lnt id=hl-114-185><a class=lnlinks href=#hl-114-185>185</a>
</span><span class=lnt id=hl-114-186><a class=lnlinks href=#hl-114-186>186</a>
</span><span class=lnt id=hl-114-187><a class=lnlinks href=#hl-114-187>187</a>
</span><span class=lnt id=hl-114-188><a class=lnlinks href=#hl-114-188>188</a>
</span><span class=lnt id=hl-114-189><a class=lnlinks href=#hl-114-189>189</a>
</span><span class=lnt id=hl-114-190><a class=lnlinks href=#hl-114-190>190</a>
</span><span class=lnt id=hl-114-191><a class=lnlinks href=#hl-114-191>191</a>
</span><span class=lnt id=hl-114-192><a class=lnlinks href=#hl-114-192>192</a>
</span><span class=lnt id=hl-114-193><a class=lnlinks href=#hl-114-193>193</a>
</span><span class=lnt id=hl-114-194><a class=lnlinks href=#hl-114-194>194</a>
</span><span class=lnt id=hl-114-195><a class=lnlinks href=#hl-114-195>195</a>
</span><span class=lnt id=hl-114-196><a class=lnlinks href=#hl-114-196>196</a>
</span><span class=lnt id=hl-114-197><a class=lnlinks href=#hl-114-197>197</a>
</span><span class=lnt id=hl-114-198><a class=lnlinks href=#hl-114-198>198</a>
</span><span class=lnt id=hl-114-199><a class=lnlinks href=#hl-114-199>199</a>
</span><span class=lnt id=hl-114-200><a class=lnlinks href=#hl-114-200>200</a>
</span><span class=lnt id=hl-114-201><a class=lnlinks href=#hl-114-201>201</a>
</span><span class=lnt id=hl-114-202><a class=lnlinks href=#hl-114-202>202</a>
</span><span class=lnt id=hl-114-203><a class=lnlinks href=#hl-114-203>203</a>
</span><span class=lnt id=hl-114-204><a class=lnlinks href=#hl-114-204>204</a>
</span><span class=lnt id=hl-114-205><a class=lnlinks href=#hl-114-205>205</a>
</span><span class=lnt id=hl-114-206><a class=lnlinks href=#hl-114-206>206</a>
</span><span class=lnt id=hl-114-207><a class=lnlinks href=#hl-114-207>207</a>
</span><span class=lnt id=hl-114-208><a class=lnlinks href=#hl-114-208>208</a>
</span><span class=lnt id=hl-114-209><a class=lnlinks href=#hl-114-209>209</a>
</span><span class=lnt id=hl-114-210><a class=lnlinks href=#hl-114-210>210</a>
</span><span class=lnt id=hl-114-211><a class=lnlinks href=#hl-114-211>211</a>
</span><span class=lnt id=hl-114-212><a class=lnlinks href=#hl-114-212>212</a>
</span><span class=lnt id=hl-114-213><a class=lnlinks href=#hl-114-213>213</a>
</span><span class=lnt id=hl-114-214><a class=lnlinks href=#hl-114-214>214</a>
</span><span class=lnt id=hl-114-215><a class=lnlinks href=#hl-114-215>215</a>
</span><span class=lnt id=hl-114-216><a class=lnlinks href=#hl-114-216>216</a>
</span><span class=lnt id=hl-114-217><a class=lnlinks href=#hl-114-217>217</a>
</span><span class=lnt id=hl-114-218><a class=lnlinks href=#hl-114-218>218</a>
</span><span class=lnt id=hl-114-219><a class=lnlinks href=#hl-114-219>219</a>
</span><span class=lnt id=hl-114-220><a class=lnlinks href=#hl-114-220>220</a>
</span><span class=lnt id=hl-114-221><a class=lnlinks href=#hl-114-221>221</a>
</span><span class=lnt id=hl-114-222><a class=lnlinks href=#hl-114-222>222</a>
</span><span class=lnt id=hl-114-223><a class=lnlinks href=#hl-114-223>223</a>
</span><span class=lnt id=hl-114-224><a class=lnlinks href=#hl-114-224>224</a>
</span><span class=lnt id=hl-114-225><a class=lnlinks href=#hl-114-225>225</a>
</span><span class=lnt id=hl-114-226><a class=lnlinks href=#hl-114-226>226</a>
</span><span class=lnt id=hl-114-227><a class=lnlinks href=#hl-114-227>227</a>
</span><span class=lnt id=hl-114-228><a class=lnlinks href=#hl-114-228>228</a>
</span><span class=lnt id=hl-114-229><a class=lnlinks href=#hl-114-229>229</a>
</span><span class=lnt id=hl-114-230><a class=lnlinks href=#hl-114-230>230</a>
</span><span class=lnt id=hl-114-231><a class=lnlinks href=#hl-114-231>231</a>
</span><span class=lnt id=hl-114-232><a class=lnlinks href=#hl-114-232>232</a>
</span><span class=lnt id=hl-114-233><a class=lnlinks href=#hl-114-233>233</a>
</span><span class=lnt id=hl-114-234><a class=lnlinks href=#hl-114-234>234</a>
</span><span class=lnt id=hl-114-235><a class=lnlinks href=#hl-114-235>235</a>
</span><span class=lnt id=hl-114-236><a class=lnlinks href=#hl-114-236>236</a>
</span><span class=lnt id=hl-114-237><a class=lnlinks href=#hl-114-237>237</a>
</span><span class=lnt id=hl-114-238><a class=lnlinks href=#hl-114-238>238</a>
</span><span class=lnt id=hl-114-239><a class=lnlinks href=#hl-114-239>239</a>
</span><span class=lnt id=hl-114-240><a class=lnlinks href=#hl-114-240>240</a>
</span><span class=lnt id=hl-114-241><a class=lnlinks href=#hl-114-241>241</a>
</span><span class=lnt id=hl-114-242><a class=lnlinks href=#hl-114-242>242</a>
</span><span class=lnt id=hl-114-243><a class=lnlinks href=#hl-114-243>243</a>
</span><span class=lnt id=hl-114-244><a class=lnlinks href=#hl-114-244>244</a>
</span><span class=lnt id=hl-114-245><a class=lnlinks href=#hl-114-245>245</a>
</span><span class=lnt id=hl-114-246><a class=lnlinks href=#hl-114-246>246</a>
</span><span class=lnt id=hl-114-247><a class=lnlinks href=#hl-114-247>247</a>
</span><span class=lnt id=hl-114-248><a class=lnlinks href=#hl-114-248>248</a>
</span><span class=lnt id=hl-114-249><a class=lnlinks href=#hl-114-249>249</a>
</span><span class=lnt id=hl-114-250><a class=lnlinks href=#hl-114-250>250</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 기본 클래스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DomainEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;aggregate_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 관련 이벤트들</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderConfirmedEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;OrderConfirmed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=n>payment_id</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderShippedEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;OrderShipped&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;tracking_number&#39;</span><span class=p>:</span> <span class=n>tracking_number</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 상태 열거형</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderStatus</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>CREATED</span> <span class=o>=</span> <span class=s2>&#34;created&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>CONFIRMED</span> <span class=o>=</span> <span class=s2>&#34;confirmed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHIPPED</span> <span class=o>=</span> <span class=s2>&#34;shipped&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>DELIVERED</span> <span class=o>=</span> <span class=s2>&#34;delivered&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>CANCELLED</span> <span class=o>=</span> <span class=s2>&#34;cancelled&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 애그리거트</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tracking_number</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;새 주문 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order already exists&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>,</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>confirm_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CREATED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order cannot be confirmed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderConfirmedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>ship_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order cannot be shipped&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderShippedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_apply_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 애그리거트에 적용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>total</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CREATED</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderConfirmed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>payment_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderShipped&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>tracking_number</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;tracking_number&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>SHIPPED</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_from_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 히스토리로부터 상태 복원&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_uncommitted_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;커밋되지 않은 이벤트 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mark_events_committed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 커밋된 것으로 표시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 저장소</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>],</span> <span class=n>expected_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 스트림에 추가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_version</span> <span class=o>!=</span> <span class=n>expected_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Concurrency conflict. Expected version </span><span class=si>{</span><span class=n>expected_version</span><span class=si>}</span><span class=s2>, but was </span><span class=si>{</span><span class=n>current_version</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>current_version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>from_version</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 스트림 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>][</span><span class=n>from_version</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 레포지토리</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderRepository</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n>Order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 저장 (이벤트 저장)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>expected_version</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>version</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_events</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>events</span><span class=p>,</span> <span class=n>expected_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=o>.</span><span class=n>mark_events_committed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 로드 (이벤트 재생)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>load_from_history</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 프로젝션 (CQRS 읽기 모델)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>OrderCreatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;tracking_number&#39;</span><span class=p>:</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_confirmed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>OrderConfirmedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확정 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;confirmed&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;confirmed_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_shipped</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>OrderShippedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;shipped&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;tracking_number&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;tracking_number&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;shipped_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_orders_by_customer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;고객별 주문 목록 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>order</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>values</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>order</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>customer_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 인프라 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>order_repository</span> <span class=o>=</span> <span class=n>OrderRepository</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_projection</span> <span class=o>=</span> <span class=n>OrderProjection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 새 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=s2>&#34;customer-456&#34;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;p1&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;상품1&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>10000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;p2&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;상품2&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>5000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>order_repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프로젝션 업데이트 (실제로는 이벤트 버스를 통해 자동화)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderCreatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>order_projection</span><span class=o>.</span><span class=n>handle_order_created</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 확정</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=o>.</span><span class=n>confirm_order</span><span class=p>(</span><span class=s2>&#34;payment-789&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프로젝션 업데이트</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>,</span> <span class=n>from_version</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderConfirmedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>order_projection</span><span class=o>.</span><span class=n>handle_order_confirmed</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 읽기 모델에서 주문 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>order_view</span> <span class=o>=</span> <span class=n>order_projection</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 상태: </span><span class=si>{</span><span class=n>order_view</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;총 금액: </span><span class=si>{</span><span class=n>order_view</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 히스토리로부터 주문 복원</span>
</span></span><span class=line><span class=cl>    <span class=n>restored_order</span> <span class=o>=</span> <span class=n>order_repository</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;복원된 주문 상태: </span><span class=si>{</span><span class=n>restored_order</span><span class=o>.</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=16-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>16. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#16-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>도메인 모델링</strong></td><td>비즈니스 이벤트 식별</td><td>기술적 이벤트와 비즈니스 이벤트 혼동</td><td>도메인 전문가와 협업하여 의미있는 이벤트 정의</td></tr><tr><td><strong>애그리거트 설계</strong></td><td>적절한 경계 설정</td><td>너무 큰 애그리거트로 인한 성능 저하</td><td>단일 트랜잭션 경계 내에서 일관성 보장 범위 설정</td></tr><tr><td><strong>이벤트 스키마</strong></td><td>진화 가능한 스키마 설계</td><td>하위 호환성 깨짐</td><td>스키마 버전 관리와 업캐스팅 전략 수립</td></tr><tr><td><strong>동시성 제어</strong></td><td>낙관적 동시성 선택</td><td>높은 충돌률 환경에서 성능 저하</td><td>비즈니스 특성에 맞는 동시성 전략 선택</td></tr><tr><td><strong>저장소 선택</strong></td><td>요구사항에 맞는 저장소</td><td>잘못된 저장소 선택으로 인한 성능 문제</td><td>이벤트 처리량, 쿼리 패턴 분석 후 선택</td></tr></tbody></table><hr><h2 id=17-최적화하기-위한-고려사항-및-주의할-점>17. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#17-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능 최적화</strong></td><td>스냅샷 전략 수립</td><td>너무 빈번한 스냅샷으로 인한 오버헤드</td><td>비즈니스 특성에 맞는 스냅샷 주기 결정</td></tr><tr><td><strong>캐싱 전략</strong></td><td>읽기 성능 향상</td><td>캐시 일관성 문제</td><td>Redis, 메모리 캐시를 활용한 계층화된 캐싱</td></tr><tr><td><strong>이벤트 압축</strong></td><td>저장소 용량 최적화</td><td>중요한 이벤트 손실 위험</td><td>비즈니스 규칙에 따른 압축 정책 수립</td></tr><tr><td><strong>파티셔닝</strong></td><td>수평 확장 지원</td><td>파티션 간 이벤트 순서 보장 문제</td><td>애그리거트 ID 기반 파티셔닝 전략</td></tr><tr><td><strong>배치 처리</strong></td><td>프로젝션 처리 최적화</td><td>실시간성 요구사항과 충돌</td><td>실시간과 배치 처리의 하이브리드 접근</td></tr></tbody></table><hr><h2 id=18-주제와-관련하여-주목할-내용>18. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#18-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>아키텍처 패턴</strong></td><td>CQRS</td><td>Command Query Responsibility Segregation</td><td>Event Sourcing과 함께 사용되는 읽기/쓰기 분리 패턴</td></tr><tr><td></td><td>Saga Pattern</td><td>분산 트랜잭션 관리</td><td>마이크로서비스 환경에서 장기 실행 프로세스 조정</td></tr><tr><td><strong>데이터 관리</strong></td><td>Event Store</td><td>전용 이벤트 데이터베이스</td><td>이벤트 저장에 특화된 데이터베이스 솔루션</td></tr><tr><td></td><td>Stream Processing</td><td>실시간 이벤트 처리</td><td>Apache Kafka, Pulsar 등을 활용한 스트리밍 처리</td></tr><tr><td><strong>구현 기술</strong></td><td>Event Versioning</td><td>이벤트 스키마 버전 관리</td><td>시간에 따른 이벤트 구조 변화 대응</td></tr><tr><td></td><td>Projection</td><td>읽기 모델 생성</td><td>이벤트로부터 다양한 뷰 생성 기법</td></tr><tr><td><strong>성능 최적화</strong></td><td>Snapshots</td><td>상태 복원 최적화</td><td>긴 이벤트 스트림의 성능 문제 해결</td></tr><tr><td></td><td>Caching</td><td>캐시 전략</td><td>Redis, 메모리 캐시를 활용한 성능 향상</td></tr></tbody></table><hr><h2 id=19-반드시-학습해야할-내용>19. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#19-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 개념</strong></td><td>Domain-Driven Design</td><td>도메인 주도 설계</td><td>Event Sourcing의 이론적 기반이 되는 설계 방법론</td></tr><tr><td></td><td>Aggregate Pattern</td><td>애그리거트 패턴</td><td>일관성 경계를 정의하는 DDD 핵심 패턴</td></tr><tr><td><strong>관련 패턴</strong></td><td>CQRS</td><td>명령 쿼리 책임 분리</td><td>Event Sourcing과 함께 사용되는 핵심 패턴</td></tr><tr><td></td><td>Materialized View</td><td>구체화된 뷰</td><td>이벤트로부터 읽기 최적화 뷰 생성</td></tr><tr><td><strong>기술 스택</strong></td><td>Message Broker</td><td>메시지 브로커</td><td>Apache Kafka, RabbitMQ 등 이벤트 전파 기술</td></tr><tr><td></td><td>Event Store Database</td><td>이벤트 저장소</td><td>EventStoreDB, Apache Kafka 등 전용 데이터베이스</td></tr><tr><td><strong>고급 주제</strong></td><td>Event Sourcing Patterns</td><td>이벤트 소싱 패턴들</td><td>Snapshot, Upcasting, Event Collapsing 등</td></tr><tr><td></td><td>Distributed Systems</td><td>분산 시스템</td><td>CAP 정리, 일관성 모델, 분산 트랜잭션</td></tr></tbody></table><hr><h2 id=용어-정리-7>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-7>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>Event Store (이벤트 저장소)</td><td>이벤트를 시간순으로 저장하는 append-only 데이터베이스</td></tr><tr><td></td><td>Event Stream (이벤트 스트림)</td><td>특정 애그리거트와 관련된 이벤트들의 순차적 시퀀스</td></tr><tr><td></td><td>Aggregate (애그리거트)</td><td>일관성 경계를 형성하는 도메인 객체들의 집합</td></tr><tr><td></td><td>Projection (프로젝션)</td><td>이벤트 스트림으로부터 생성되는 읽기 전용 뷰</td></tr><tr><td><strong>기술 용어</strong></td><td>Snapshot (스냅샷)</td><td>특정 시점의 애그리거트 상태를 저장한 최적화 기법</td></tr><tr><td></td><td>Upcasting (업캐스팅)</td><td>구버전 이벤트를 신버전 형식으로 변환하는 과정</td></tr><tr><td></td><td>Idempotency (멱등성)</td><td>동일한 연산을 여러 번 수행해도 결과가 같은 성질</td></tr><tr><td></td><td>Optimistic Concurrency (낙관적 동시성)</td><td>충돌이 드물다고 가정하고 충돌 시 재시도하는 제어 방식</td></tr><tr><td><strong>아키텍처</strong></td><td>Command Handler (명령 핸들러)</td><td>사용자 명령을 받아 비즈니스 로직을 실행하는 컴포넌트</td></tr><tr><td></td><td>Event Handler (이벤트 핸들러)</td><td>이벤트를 받아 프로젝션을 업데이트하는 컴포넌트</td></tr><tr><td></td><td>Append-Only (추가 전용)</td><td>데이터 수정이나 삭제 없이 추가만 가능한 저장 방식</td></tr><tr><td></td><td>Eventually Consistent (최종 일관성)</td><td>즉시는 아니지만 결국에는 일관된 상태에 도달하는 일관성 모델</td></tr></tbody></table><hr><h2 id=참고-및-출처-7>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-7>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Event Sourcing pattern - Azure Architecture Center</a></li><li><a href=https://microservices.io/patterns/data/event-sourcing.html>Microservices Pattern: Event sourcing</a></li><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Event Sourcing - Martin Fowler</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>CQRS and Event Sourcing in Java - Baeldung</a></li><li><a href=https://www.geeksforgeeks.org/dbms/event-sourcing-database-design-patterns/>Event Sourcing Database Design Patterns - GeeksforGeeks</a></li><li><a href=https://www.kurrent.io/event-sourcing>Beginner&rsquo;s Guide to Event Sourcing - Kurrent</a></li><li><a href=https://www.redpanda.com/guides/event-stream-processing-event-sourcing-database>Event sourcing database architecture - Redpanda</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html>Event Sourcing pattern - AWS Prescriptive Guidance</a></li></ul><hr><h2 id=1-태그-1>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-1>#</a></h2><ul><li><strong>Event-Sourcing</strong></li><li><strong>Event-Driven-Architecture</strong></li><li><strong>CQRS-Pattern</strong></li><li><strong>Data-Management</strong></li></ul><hr><h2 id=2-분류-구조-분석>2. 분류 구조 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석>#</a></h2><p><strong>계층 구조:</strong><br>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Styles and Patterns > Architecture Patterns > Data Management</p><p><strong>분석 및 근거:</strong><br>이벤트 소싱은 시스템의 모든 상태 변경을 이벤트로 기록하고, 이를 통해 상태를 재구성하는 아키텍처 패턴입니다. 이는 “Architecture Styles and Patterns” 하위의 “Architecture Patterns”에 적합하며, 데이터 관리(Data Management)와도 밀접하게 연관되어 있으므로 하위로 포함하는 것이 타당합니다<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">1</a><a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">3</a>.<br>이벤트 소싱은 이벤트 기반 아키텍처(Event-Driven Architecture), CQRS, 마이크로서비스 등과 함께 사용되어 확장성, 유지보수성, 감사 추적, 장애 복구 등 다양한 이점을 제공합니다.</p><hr><h2 id=3-요약200자-내외>3. 요약(200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약200자-내외>#</a></h2><p>이벤트 소싱은 시스템의 모든 상태 변화를 불변의 이벤트로 저장하고, 이를 재생하여 언제든지 상태를 재구성할 수 있는 데이터 관리 및 설계 패턴이다<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">5</a>.</p><hr><h2 id=4-개요250자-내외>4. 개요(250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요250자-내외>#</a></h2><p>이벤트 소싱은 기존 데이터베이스가 최종 상태만 저장하는 방식과 달리, 모든 상태 변화를 불변의 이벤트로 순차적으로 기록하여, 이벤트를 재생하면 시스템의 현재 상태와 과거 이력을 모두 추적할 수 있게 해주는 아키텍처 패턴이다. 감사, 장애 복구, 분석 등에 매우 효과적이다<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">1</a><a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">3</a>.</p><hr><h2 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h2><ul><li><strong>이벤트(Event):</strong> 시스템에서 발생한 상태 변화(예: 계좌 개설, 입금, 출금 등)를 불변의 기록으로 저장<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">4</a><a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">7</a>.</li><li><strong>이벤트 저장소(Event Store):</strong> 모든 이벤트를 순차적으로 저장하는 저장소<a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">3</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">9</a>.</li><li><strong>상태 재구성(Replay):</strong> 저장된 이벤트를 순차적으로 재생하여 현재 상태를 계산<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>불변성(Immutable):</strong> 이벤트는 한 번 기록되면 변경 또는 삭제되지 않음<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">4</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>애그리게이트(Aggregate):</strong> 여러 이벤트를 묶어 하나의 도메인 객체로 관리하는 단위<a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">11</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul><p><strong>실무 구현 요소</strong></p><ul><li><strong>이벤트(Event):</strong> 상태 변화 기록(필수)</li><li><strong>이벤트 저장소(Event Store):</strong> 이벤트 저장(필수)</li><li><strong>애그리게이트(Aggregate):</strong> 이벤트를 처리해 상태를 관리(필수)</li><li><strong>이벤트 핸들러(Event Handler):</strong> 이벤트 처리(필수)</li><li><strong>스냅샷(Snapshot):</strong> 주기적으로 상태를 저장해 재생 시간 단축(선택)</li><li><strong>커맨드(Command):</strong> 시스템에 수행 요청(필요 시)</li><li><strong>프로젝션(Projection):</strong> 이벤트를 기반으로 뷰(Read Model) 생성(필요 시, CQRS와 연계)</li></ul><hr><h2 id=6-조사-내용주요-항목별-정리>6. 조사 내용(주요 항목별 정리)<a hidden class=anchor aria-hidden=true href=#6-조사-내용주요-항목별-정리>#</a></h2><h3 id=배경-1>배경<a hidden class=anchor aria-hidden=true href=#배경-1>#</a></h3><p>기존 CRUD 방식은 최종 상태만 저장하므로, 과거 이력 추적이나 장애 복구, 감사, 분석이 어렵고, 동시성 문제 등 한계가 있었음. 이벤트 소싱은 이러한 문제를 해결하기 위해 등장한 패턴<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">14</a>.</p><h3 id=목적-및-필요성-1>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성-1>#</a></h3><ul><li><strong>감사 및 이력 추적:</strong> 모든 상태 변화를 이벤트로 기록해 추적 가능<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>장애 복구:</strong> 이벤트 재생을 통해 특정 시점으로 복구 가능<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">3</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>분석 및 디버깅:</strong> 이벤트 로그를 통해 시스템 동작 분석 및 디버깅 용이<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>확장성 및 유지보수성:</strong> 이벤트 기반 아키텍처와 결합해 확장성, 유지보수성 향상<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">2</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li><strong>이벤트 기록:</strong> 모든 상태 변화를 이벤트로 저장<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>상태 재구성:</strong> 이벤트를 재생해 현재 상태 계산<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>감사 및 분석:</strong> 이벤트 로그를 활용한 감사, 분석<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>장애 복구:</strong> 특정 시점으로 상태 복구<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">3</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li></ul><h3 id=특징-1>특징<a hidden class=anchor aria-hidden=true href=#특징-1>#</a></h3><ul><li><strong>불변성:</strong> 이벤트는 변경, 삭제 불가<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">4</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>순차적 기록:</strong> 이벤트는 시간 순서대로 저장<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>재생 가능:</strong> 이벤트를 재생해 상태 복원<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>감사 및 추적:</strong> 모든 상태 변화 이력 보관<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li></ul><h3 id=핵심-원칙-1>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙-1>#</a></h3><ul><li><strong>불변성:</strong> 이벤트는 한 번 기록되면 변경 불가<a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">4</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>순차성:</strong> 이벤트는 시간 순서대로 저장<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>재생 가능성:</strong> 이벤트를 재생해 상태 복원<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li><li><strong>감사 가능성:</strong> 모든 상태 변화 이력 보관<a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">2</a><a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">10</a>.</li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-115-1><a class=lnlinks href=#hl-115-1> 1</a>
</span><span class=lnt id=hl-115-2><a class=lnlinks href=#hl-115-2> 2</a>
</span><span class=lnt id=hl-115-3><a class=lnlinks href=#hl-115-3> 3</a>
</span><span class=lnt id=hl-115-4><a class=lnlinks href=#hl-115-4> 4</a>
</span><span class=lnt id=hl-115-5><a class=lnlinks href=#hl-115-5> 5</a>
</span><span class=lnt id=hl-115-6><a class=lnlinks href=#hl-115-6> 6</a>
</span><span class=lnt id=hl-115-7><a class=lnlinks href=#hl-115-7> 7</a>
</span><span class=lnt id=hl-115-8><a class=lnlinks href=#hl-115-8> 8</a>
</span><span class=lnt id=hl-115-9><a class=lnlinks href=#hl-115-9> 9</a>
</span><span class=lnt id=hl-115-10><a class=lnlinks href=#hl-115-10>10</a>
</span><span class=lnt id=hl-115-11><a class=lnlinks href=#hl-115-11>11</a>
</span><span class=lnt id=hl-115-12><a class=lnlinks href=#hl-115-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Diagram: Event Sourcing Flow]
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│   Command   │ → │  Aggregate  │ → │   Event     │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>                                      ↓
</span></span><span class=line><span class=cl>┌─────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                Event Store                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>                                      ↓
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│   Replay    │ ← │  Projection │ ← │   Query     │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Command:</strong> 시스템에 상태 변경 요청</li><li><strong>Aggregate:</strong> 이벤트를 생성해 상태 관리</li><li><strong>Event:</strong> 상태 변화 기록</li><li><strong>Event Store:</strong> 이벤트 저장</li><li><strong>Replay:</strong> 이벤트 재생으로 상태 복원</li><li><strong>Projection:</strong> 이벤트를 기반으로 뷰(Read Model) 생성</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><ul><li><strong>이벤트(Event):</strong> 상태 변화 기록(필수)</li><li><strong>이벤트 저장소(Event Store):</strong> 이벤트 저장(필수)</li><li><strong>애그리게이트(Aggregate):</strong> 이벤트를 처리해 상태 관리(필수)</li><li><strong>이벤트 핸들러(Event Handler):</strong> 이벤트 처리(필수)</li><li><strong>스냅샷(Snapshot):</strong> 주기적으로 상태 저장(선택)</li><li><strong>프로젝션(Projection):</strong> 이벤트를 기반으로 뷰 생성(선택, CQRS와 연계)</li></ul><p><strong>각 구성요소의 기능과 역할</strong></p><ul><li><strong>이벤트:</strong> 상태 변화 기록, 불변, 순차적 저장</li><li><strong>이벤트 저장소:</strong> 이벤트 저장, 재생 가능</li><li><strong>애그리게이트:</strong> 이벤트를 처리해 상태 관리</li><li><strong>이벤트 핸들러:</strong> 이벤트 처리(예: 이벤트 발행, 구독)</li><li><strong>스냅샷:</strong> 상태 저장, 재생 시간 단축</li><li><strong>프로젝션:</strong> 이벤트를 기반으로 뷰 생성</li></ul><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><ul><li><strong>이벤트 저장소:</strong> 이벤트를 순차적으로 저장(필수)</li><li><strong>애그리게이트:</strong> 이벤트를 처리해 상태 관리(필수)</li><li><strong>이벤트 핸들러:</strong> 이벤트 처리(필수)</li><li><strong>스냅샷:</strong> 주기적으로 상태 저장(선택)</li><li><strong>프로젝션:</strong> 이벤트를 기반으로 뷰 생성(선택, CQRS와 연계)</li><li><strong>이벤트 버스:</strong> 이벤트 발행/구독(선택, 분산 환경)</li></ul><p><strong>실제 예시(시나리오):</strong></p><ul><li><strong>은행 계좌 시스템:</strong> 계좌 개설, 입금, 출금 이벤트를 저장하고, 이벤트를 재생해 현재 잔액 계산<a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">4</a><a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">7</a>.</li><li><strong>쇼핑몰 카트:</strong> 상품 추가, 제거 이벤트를 저장하고, 이벤트를 재생해 현재 카트 상태 계산<a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">9</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 원인</th></tr></thead><tbody><tr><td>장점</td><td>감사 및 이력 추적</td><td>모든 상태 변화 이력 보관</td><td>이벤트 불변성, 순차적 기록</td></tr><tr><td>장점</td><td>장애 복구</td><td>특정 시점으로 상태 복구</td><td>이벤트 재생 가능성</td></tr><tr><td>장점</td><td>분석 및 디버깅</td><td>이벤트 로그로 동작 분석</td><td>이벤트 로그 보관</td></tr><tr><td>장점</td><td>확장성</td><td>이벤트 기반 아키텍처와 결합</td><td>이벤트 발행/구독 구조</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>기존 CRUD 방식보다 복잡</td><td>도메인 모델링 강화, 문서화</td></tr><tr><td>단점</td><td>성능 저하</td><td>이벤트가 많아질수록 재생 시간 증가</td><td>스냅샷, 프로젝션 활용</td></tr></tbody></table><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>이벤트 스키마 변경</td><td>비즈니스 요구사항 변화</td><td>기존 이벤트와 호환성 문제</td><td>코드 리뷰, 테스트</td><td>버전 관리, 이벤트 업캐스팅</td><td>이벤트 업캐스팅, 마이그레이션</td></tr><tr><td>문제점</td><td>데이터 불일치</td><td>프로젝션 지연, 이벤트 처리 실패</td><td>최신 상태 조회 지연</td><td>모니터링, 로그 분석</td><td>이벤트 처리 신뢰성 강화</td><td>이벤트 재처리, 프로젝션 최적화</td></tr></tbody></table><h2 id=단점과-문제점-그리고-해결방안-1>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안-1>#</a></h2><h3 id=단점-2>단점<a hidden class=anchor aria-hidden=true href=#단점-2>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td><strong>복잡성</strong></td><td>학습 곡선</td><td>다르고 익숙하지 않은 프로그래밍 스타일로 학습 곡선이 존재</td><td>단계적 도입, 교육 프로그램</td></tr><tr><td><strong>쿼리 어려움</strong></td><td>이벤트 스토어 쿼리</td><td>비즈니스 엔터티의 상태를 재구성하는 일반적인 쿼리가 복잡하고 비효율적</td><td>CQRS 패턴 적용</td></tr><tr><td><strong>일관성</strong></td><td>최종 일관성</td><td>구체화된 뷰나 데이터 프로젝션 생성 시 최종적으로만 일관성 유지</td><td>적절한 일관성 경계 설계</td></tr></tbody></table><h3 id=문제점-3>문제점<a hidden class=anchor aria-hidden=true href=#문제점-3>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td><strong>성능 저하</strong></td><td>프로젝션 재구축</td><td>대량 이벤트 누적</td><td>응답 시간 증가</td><td>성능 모니터링 도구</td><td>스냅샷 구현</td><td>정기적 간격으로 데이터 스냅샷 구현</td></tr><tr><td><strong>스키마 변경</strong></td><td>이벤트 구조 변화</td><td>비즈니스 요구사항 변경</td><td>시스템 호환성 문제</td><td>버전 호환성 테스트</td><td>이벤트 버전 관리</td><td>이벤트 업캐스팅/다운캐스팅</td></tr><tr><td><strong>동시성 충돌</strong></td><td>동일 애그리게이트 수정</td><td>동시 명령 처리</td><td>데이터 일관성 위반</td><td>버전 체크</td><td>낙관적 동시성 제어</td><td>충돌하는 업데이트에 대해 멱등성 보장</td></tr></tbody></table><h2 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h2><h3 id=기술적-도전>기술적 도전<a hidden class=anchor aria-hidden=true href=#기술적-도전>#</a></h3><ol><li><strong>이벤트 스키마 진화</strong>: 시간이 지남에 따른 이벤트 구조 변경 관리</li><li><strong>대용량 데이터 처리</strong>: 수백만 개의 이벤트를 효율적으로 처리</li><li><strong>분산 시스템 복잡성</strong>: 여러 서비스 간 이벤트 순서 및 일관성 보장</li></ol><h3 id=운영적-도전>운영적 도전<a hidden class=anchor aria-hidden=true href=#운영적-도전>#</a></h3><ol><li><strong>모니터링 및 관찰성</strong>: 이벤트 흐름과 프로젝션 상태 추적</li><li><strong>데이터 아카이빙</strong>: 오래된 이벤트의 효율적 관리</li><li><strong>재해 복구</strong>: 이벤트 스토어 백업 및 복구 전략</li></ol><h3 id=도전-과제-1>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>도전 과제</td><td>대규모 시스템 적용</td><td>이벤트 수 증가, 프로젝션 복잡성</td><td>성능 저하, 유지보수 어려움</td><td>모니터링, 프로파일링</td><td>스냅샷, 프로젝션 분리</td><td>스냅샷, 프로젝션 최적화, 분산 처리</td></tr><tr><td>도전 과제</td><td>이벤트 순서 보장</td><td>분산 환경, 네트워크 지연</td><td>데이터 불일치</td><td>분산 추적, 로그 분석</td><td>이벤트 순서 보장 메커니즘</td><td>이벤트 버스, 분산 트랜잭션 관리</td></tr><tr><td>도전 과제</td><td>팀 온보딩 및 코드 관리</td><td>아키텍처 복잡성, 팀원 이해 부족</td><td>개발 비용 증가, 일관성 저하</td><td>코드 리뷰, 문서화</td><td>교육, 예시 코드 제공</td><td>문서화, 코드 리뷰, 멘토링</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th></tr></thead><tbody><tr><td>적용 범위</td><td>전체 시스템</td><td>시스템 전체에 이벤트 소싱 적용</td></tr><tr><td>적용 범위</td><td>도메인 단위</td><td>특정 도메인에만 이벤트 소싱 적용</td></tr><tr><td>저장 방식</td><td>이벤트 저장소</td><td>이벤트를 저장하는 전용 저장소 사용</td></tr><tr><td>저장 방식</td><td>일반 DB</td><td>일반 데이터베이스를 이벤트 저장소로 사용</td></tr><tr><td>연계 패턴</td><td>CQRS</td><td>이벤트 소싱과 CQRS 연계</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td>감사 및 이력 추적</td><td>EventStore, MongoDB, Kafka</td><td>모든 상태 변화 이력 보관</td></tr><tr><td>장애 복구</td><td>Spring Boot, PostgreSQL</td><td>특정 시점으로 상태 복구</td></tr><tr><td>분석 및 디버깅</td><td>Elasticsearch, Kibana</td><td>이벤트 로그 분석</td></tr><tr><td>확장성</td><td>RabbitMQ, Kafka</td><td>이벤트 기반 아키텍처와 결합</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><p><strong>은행 계좌 시스템:</strong><br>이벤트 소싱을 적용해 계좌 개설, 입금, 출금 이벤트를 저장하고, 이벤트를 재생해 현재 잔액 계산.</p><ul><li><strong>시스템 구성:</strong><ul><li>Command: 계좌 개설, 입금, 출금 요청</li><li>Aggregate: 계좌 상태 관리</li><li>Event: 계좌 개설됨, 입금 완료됨, 출금 처리됨</li><li>Event Store: 이벤트 저장소</li><li>Projection: 현재 잔액 뷰(Read Model)</li></ul></li><li><strong>Workflow:</strong><ul><li>사용자 → Command → Aggregate → Event → Event Store</li><li>Query → Projection(Read Model)</li></ul></li><li><strong>역할:</strong><ul><li>Command: 상태 변경 요청</li><li>Aggregate: 이벤트 생성 및 상태 관리</li><li>Event Store: 이벤트 저장</li><li>Projection: 뷰 생성</li></ul></li><li><strong>차이점:</strong><ul><li>기존 CRUD 방식은 최종 상태만 저장해 과거 이력 추적이 어렵고, 장애 복구, 감사, 분석이 제한적임.</li><li>이벤트 소싱은 모든 상태 변화를 이벤트로 저장해 과거 이력 추적, 장애 복구, 감사, 분석이 용이함.</li></ul></li></ul><h3 id=구현-예시-javascript>구현 예시 (JavaScript)<a hidden class=anchor aria-hidden=true href=#구현-예시-javascript>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-116-1><a class=lnlinks href=#hl-116-1> 1</a>
</span><span class=lnt id=hl-116-2><a class=lnlinks href=#hl-116-2> 2</a>
</span><span class=lnt id=hl-116-3><a class=lnlinks href=#hl-116-3> 3</a>
</span><span class=lnt id=hl-116-4><a class=lnlinks href=#hl-116-4> 4</a>
</span><span class=lnt id=hl-116-5><a class=lnlinks href=#hl-116-5> 5</a>
</span><span class=lnt id=hl-116-6><a class=lnlinks href=#hl-116-6> 6</a>
</span><span class=lnt id=hl-116-7><a class=lnlinks href=#hl-116-7> 7</a>
</span><span class=lnt id=hl-116-8><a class=lnlinks href=#hl-116-8> 8</a>
</span><span class=lnt id=hl-116-9><a class=lnlinks href=#hl-116-9> 9</a>
</span><span class=lnt id=hl-116-10><a class=lnlinks href=#hl-116-10>10</a>
</span><span class=lnt id=hl-116-11><a class=lnlinks href=#hl-116-11>11</a>
</span><span class=lnt id=hl-116-12><a class=lnlinks href=#hl-116-12>12</a>
</span><span class=lnt id=hl-116-13><a class=lnlinks href=#hl-116-13>13</a>
</span><span class=lnt id=hl-116-14><a class=lnlinks href=#hl-116-14>14</a>
</span><span class=lnt id=hl-116-15><a class=lnlinks href=#hl-116-15>15</a>
</span><span class=lnt id=hl-116-16><a class=lnlinks href=#hl-116-16>16</a>
</span><span class=lnt id=hl-116-17><a class=lnlinks href=#hl-116-17>17</a>
</span><span class=lnt id=hl-116-18><a class=lnlinks href=#hl-116-18>18</a>
</span><span class=lnt id=hl-116-19><a class=lnlinks href=#hl-116-19>19</a>
</span><span class=lnt id=hl-116-20><a class=lnlinks href=#hl-116-20>20</a>
</span><span class=lnt id=hl-116-21><a class=lnlinks href=#hl-116-21>21</a>
</span><span class=lnt id=hl-116-22><a class=lnlinks href=#hl-116-22>22</a>
</span><span class=lnt id=hl-116-23><a class=lnlinks href=#hl-116-23>23</a>
</span><span class=lnt id=hl-116-24><a class=lnlinks href=#hl-116-24>24</a>
</span><span class=lnt id=hl-116-25><a class=lnlinks href=#hl-116-25>25</a>
</span><span class=lnt id=hl-116-26><a class=lnlinks href=#hl-116-26>26</a>
</span><span class=lnt id=hl-116-27><a class=lnlinks href=#hl-116-27>27</a>
</span><span class=lnt id=hl-116-28><a class=lnlinks href=#hl-116-28>28</a>
</span><span class=lnt id=hl-116-29><a class=lnlinks href=#hl-116-29>29</a>
</span><span class=lnt id=hl-116-30><a class=lnlinks href=#hl-116-30>30</a>
</span><span class=lnt id=hl-116-31><a class=lnlinks href=#hl-116-31>31</a>
</span><span class=lnt id=hl-116-32><a class=lnlinks href=#hl-116-32>32</a>
</span><span class=lnt id=hl-116-33><a class=lnlinks href=#hl-116-33>33</a>
</span><span class=lnt id=hl-116-34><a class=lnlinks href=#hl-116-34>34</a>
</span><span class=lnt id=hl-116-35><a class=lnlinks href=#hl-116-35>35</a>
</span><span class=lnt id=hl-116-36><a class=lnlinks href=#hl-116-36>36</a>
</span><span class=lnt id=hl-116-37><a class=lnlinks href=#hl-116-37>37</a>
</span><span class=lnt id=hl-116-38><a class=lnlinks href=#hl-116-38>38</a>
</span><span class=lnt id=hl-116-39><a class=lnlinks href=#hl-116-39>39</a>
</span><span class=lnt id=hl-116-40><a class=lnlinks href=#hl-116-40>40</a>
</span><span class=lnt id=hl-116-41><a class=lnlinks href=#hl-116-41>41</a>
</span><span class=lnt id=hl-116-42><a class=lnlinks href=#hl-116-42>42</a>
</span><span class=lnt id=hl-116-43><a class=lnlinks href=#hl-116-43>43</a>
</span><span class=lnt id=hl-116-44><a class=lnlinks href=#hl-116-44>44</a>
</span><span class=lnt id=hl-116-45><a class=lnlinks href=#hl-116-45>45</a>
</span><span class=lnt id=hl-116-46><a class=lnlinks href=#hl-116-46>46</a>
</span><span class=lnt id=hl-116-47><a class=lnlinks href=#hl-116-47>47</a>
</span><span class=lnt id=hl-116-48><a class=lnlinks href=#hl-116-48>48</a>
</span><span class=lnt id=hl-116-49><a class=lnlinks href=#hl-116-49>49</a>
</span><span class=lnt id=hl-116-50><a class=lnlinks href=#hl-116-50>50</a>
</span><span class=lnt id=hl-116-51><a class=lnlinks href=#hl-116-51>51</a>
</span><span class=lnt id=hl-116-52><a class=lnlinks href=#hl-116-52>52</a>
</span><span class=lnt id=hl-116-53><a class=lnlinks href=#hl-116-53>53</a>
</span><span class=lnt id=hl-116-54><a class=lnlinks href=#hl-116-54>54</a>
</span><span class=lnt id=hl-116-55><a class=lnlinks href=#hl-116-55>55</a>
</span><span class=lnt id=hl-116-56><a class=lnlinks href=#hl-116-56>56</a>
</span><span class=lnt id=hl-116-57><a class=lnlinks href=#hl-116-57>57</a>
</span><span class=lnt id=hl-116-58><a class=lnlinks href=#hl-116-58>58</a>
</span><span class=lnt id=hl-116-59><a class=lnlinks href=#hl-116-59>59</a>
</span><span class=lnt id=hl-116-60><a class=lnlinks href=#hl-116-60>60</a>
</span><span class=lnt id=hl-116-61><a class=lnlinks href=#hl-116-61>61</a>
</span><span class=lnt id=hl-116-62><a class=lnlinks href=#hl-116-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 이벤트 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>AccountCreatedEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>owner</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>owner</span> <span class=o>=</span> <span class=nx>owner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>initialBalance</span> <span class=o>=</span> <span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DepositMadeEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;DepositMade&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>WithdrawalProcessedEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;WithdrawalProcessed&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 애그리게이트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>AccountAggregate</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>events</span> <span class=o>=</span> <span class=nx>events</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>applyEvents</span><span class=p>(</span><span class=nx>events</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;DepositMade&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>+=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;WithdrawalProcessed&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>applyEvents</span><span class=p>(</span><span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>events</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=nx>e</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>deposit</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DepositMadeEvent</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WithdrawalProcessedEvent</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AccountAggregate</span><span class=p>([</span><span class=k>new</span> <span class=nx>AccountCreatedEvent</span><span class=p>(</span><span class=s1>&#39;acc1&#39;</span><span class=p>,</span> <span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)]);</span>
</span></span><span class=line><span class=cl><span class=nx>account</span><span class=p>.</span><span class=nx>deposit</span><span class=p>(</span><span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>account</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>account</span><span class=p>.</span><span class=nx>balance</span><span class=p>);</span> <span class=c1>// 1300
</span></span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 모델링</td><td>명확한 도메인 모델 설계</td><td>도메인 중심 설계 강화</td></tr><tr><td>이벤트 스키마</td><td>이벤트 스키마 변경 계획</td><td>버전 관리, 이벤트 업캐스팅</td></tr><tr><td>테스트</td><td>충분한 테스트</td><td>단위, 통합 테스트 강화</td></tr><tr><td>문서화</td><td>아키텍처 및 코드 문서화</td><td>문서화, 예시 코드 제공</td></tr></tbody></table><h2 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>도메인 설계</strong></td><td>적절한 애그리게이트 경계 설정</td><td>비즈니스 일관성 경계에 따라 애그리게이트 크기 결정</td></tr><tr><td><strong>이벤트 설계</strong></td><td>이벤트 스키마의 미래 호환성</td><td>이벤트에 버전 정보 포함, 선택적 필드 사용</td></tr><tr><td><strong>성능 관리</strong></td><td>대용량 이벤트 스트림 처리</td><td>스냅샷 구현, 이벤트 아카이빙 전략 수립</td></tr><tr><td><strong>일관성 관리</strong></td><td>최종 일관성 수용</td><td>비즈니스 요구사항에 맞는 일관성 수준 정의</td></tr><tr><td><strong>모니터링</strong></td><td>이벤트 처리 상태 추적</td><td>프로젝션 지연 모니터링, 실패 이벤트 재처리</td></tr><tr><td><strong>보안</strong></td><td>민감한 데이터 처리</td><td>이벤트 암호화, 개인정보 익명화</td></tr><tr><td><strong>테스트</strong></td><td>시간 기반 테스트 복잡성</td><td>시간 추상화, 이벤트 시나리오 기반 테스트</td></tr></tbody></table><h2 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>구분</th><th>최적화 방법</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>저장소 최적화</strong></td><td>이벤트 스토어 파티셔닝</td><td>애그리게이트 ID 기반 샤딩</td></tr><tr><td><strong>읽기 성능</strong></td><td>프로젝션 캐싱</td><td>Redis 등을 활용한 자주 조회되는 프로젝션 캐싱</td></tr><tr><td><strong>쓰기 성능</strong></td><td>배치 이벤트 처리</td><td>여러 이벤트를 배치로 처리하여 I/O 최적화</td></tr><tr><td><strong>네트워크 최적화</strong></td><td>이벤트 압축</td><td>큰 이벤트 페이로드 압축 전송</td></tr><tr><td><strong>메모리 관리</strong></td><td>애그리게이트 캐싱</td><td>자주 접근되는 애그리게이트 메모리 캐싱</td></tr><tr><td><strong>동시성 최적화</strong></td><td>애그리게이트별 락</td><td>세밀한 단위의 동시성 제어</td></tr><tr><td><strong>이벤트 압축</strong></td><td>중복 이벤트 제거</td><td>의미없는 중간 상태 이벤트 압축</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점-1>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점-1>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>스냅샷</td><td>이벤트가 많아질수록 재생 시간 증가</td><td>스냅샷 주기적 저장</td></tr><tr><td>프로젝션</td><td>뷰(Read Model) 생성 지연</td><td>프로젝션 최적화, 분산 처리</td></tr><tr><td>모니터링</td><td>분산 환경, 이벤트 처리 지연</td><td>모니터링, 로그 분석</td></tr></tbody></table><h2 id=기타-사항>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항>#</a></h2><h3 id=event-sourcing과-gdpr-준수>Event Sourcing과 GDPR 준수<a hidden class=anchor aria-hidden=true href=#event-sourcing과-gdpr-준수>#</a></h3><ul><li><strong>개인정보 삭제 요구</strong>: 이벤트의 불변성과 충돌하는 GDPR의 삭제권</li><li><strong>해결 방안</strong>:<ul><li>암호화된 이벤트 저장 후 키 삭제</li><li>개인정보 분리 저장</li><li>의사화(Pseudonymization) 적용</li></ul></li></ul><h3 id=이벤트-스키마-진화-전략>이벤트 스키마 진화 전략<a hidden class=anchor aria-hidden=true href=#이벤트-스키마-진화-전략>#</a></h3><ul><li><strong>전진 호환성</strong>: 새로운 필드 추가 시 기존 시스템 호환성 유지</li><li><strong>후진 호환성</strong>: 이전 버전 이벤트 처리 가능성</li><li><strong>업캐스팅</strong>: 오래된 이벤트를 새로운 스키마로 변환</li><li><strong>다운캐스팅</strong>: 새로운 이벤트를 이전 스키마로 변환</li></ul><h3 id=분산-환경에서의-고려사항>분산 환경에서의 고려사항<a hidden class=anchor aria-hidden=true href=#분산-환경에서의-고려사항>#</a></h3><ul><li><strong>이벤트 순서</strong>: 분산 환경에서 전역 순서 보장의 어려움</li><li><strong>시계 동기화</strong>: 타임스탬프 기반 순서 결정 시 시계 편차 문제</li><li><strong>네트워크 분할</strong>: CAP 정리에 따른 일관성과 가용성 트레이드오프</li></ul><h3 id=기타-사항-1>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항-1>#</a></h3><ul><li><strong>CQRS와의 연계:</strong> 이벤트 소싱은 CQRS와 함께 사용 시 큰 시너지 효과(읽기/쓰기 분리, 뷰 최적화)<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">15</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li><li><strong>마이크로서비스와의 연계:</strong> 이벤트 기반 아키텍처와 결합해 분산 시스템, 마이크로서비스에 적합<a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">5</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li><li><strong>적용 범위:</strong> 모든 도메인에 적용할 필요 없음, 복잡한 도메인, 감사, 분석, 장애 복구가 필요한 곳에 적합<a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">17</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul><hr><h2 id=7-추가-조사-내용-1>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용-1>#</a></h2><ul><li><strong>이벤트 소싱과 CRUD 비교:</strong><ul><li><strong>CRUD:</strong> 최종 상태만 저장, 과거 이력 추적 어려움, 동시성 문제 발생 가능<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">4</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li><li><strong>이벤트 소싱:</strong> 모든 상태 변화를 이벤트로 저장, 과거 이력 추적, 장애 복구, 감사, 분석 용이<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">1</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul></li><li><strong>이벤트 소싱과 CQRS:</strong><ul><li>이벤트 소싱은 CQRS와 함께 사용 시 읽기/쓰기 분리, 뷰 최적화, 성능 향상<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">15</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul></li><li><strong>적용 범위:</strong><ul><li>모든 도메인에 적용할 필요 없음, 복잡한 도메인, 감사, 분석, 장애 복구가 필요한 곳에 적합<a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">17</a><a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">13</a>.</li></ul></li></ul><hr><h2 id=주제와-관련하여-반드시-학습해야할-내용>주제와 관련하여 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 개념</strong></td><td>Event Sourcing</td><td>기본 원리</td><td>이벤트 기반 상태 관리의 핵심 개념</td></tr><tr><td></td><td>CQRS</td><td>명령/쿼리 분리</td><td>읽기와 쓰기 모델의 분리</td></tr><tr><td></td><td>Domain Events</td><td>도메인 이벤트</td><td>비즈니스 의미가 있는 이벤트 설계</td></tr><tr><td><strong>구현 기술</strong></td><td>Event Store</td><td>이벤트 저장소</td><td>이벤트 지속화 메커니즘</td></tr><tr><td></td><td>Projections</td><td>프로젝션</td><td>이벤트에서 읽기 모델 생성</td></tr><tr><td></td><td>Snapshots</td><td>스냅샷</td><td>성능 최적화 기법</td></tr><tr><td><strong>설계 패턴</strong></td><td>Aggregate Design</td><td>애그리게이트 설계</td><td>적절한 경계 설정</td></tr><tr><td></td><td>Event Schema</td><td>이벤트 스키마</td><td>진화 가능한 이벤트 구조</td></tr><tr><td></td><td>Concurrency Control</td><td>동시성 제어</td><td>낙관적 잠금과 버전 관리</td></tr><tr><td><strong>운영 관리</strong></td><td>Monitoring</td><td>모니터링</td><td>이벤트 처리 상태 추적</td></tr><tr><td></td><td>Error Handling</td><td>오류 처리</td><td>실패한 이벤트 처리 전략</td></tr><tr><td></td><td>Data Migration</td><td>데이터 마이그레이션</td><td>이벤트 스키마 변경 관리</td></tr></tbody></table><h2 id=9-반드시-학습해야-할-내용>9. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#9-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 원칙</td><td>Event Sourcing</td><td>불변성</td><td>이벤트는 한 번 기록되면 변경 불가</td></tr><tr><td>설계 원칙</td><td>Event Sourcing</td><td>순차성</td><td>이벤트는 시간 순서대로 저장</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>감사 및 이력 추적</td><td>모든 상태 변화 이력 보관</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>장애 복구</td><td>이벤트 재생으로 특정 시점 복구</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>분석 및 디버깅</td><td>이벤트 로그로 동작 분석</td></tr></tbody></table><hr><h2 id=10-용어-정리>10. 용어 정리<a hidden class=anchor aria-hidden=true href=#10-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>Event Sourcing</td><td>시스템의 모든 상태 변화를 불변의 이벤트로 저장하고, 이를 재생하여 상태를 재구성하는 패턴</td></tr><tr><td>설계 원칙</td><td>불변성</td><td>이벤트는 한 번 기록되면 변경 또는 삭제되지 않음</td></tr><tr><td>설계 원칙</td><td>순차성</td><td>이벤트는 시간 순서대로 저장됨</td></tr><tr><td>실무 적용</td><td>이벤트 저장소</td><td>이벤트를 저장하는 저장소</td></tr><tr><td>실무 적용</td><td>애그리게이트</td><td>여러 이벤트를 묶어 하나의 도메인 객체로 관리하는 단위</td></tr><tr><td>실무 적용</td><td>프로젝션</td><td>이벤트를 기반으로 뷰(Read Model) 생성</td></tr></tbody></table><hr><h2 id=11-참고-및-출처>11. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#11-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/event-sourcing>이벤트 소싱(Event Sourcing) 패턴 - Microsoft Learn</a></li><li><a href=https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html>이벤트 소싱 패턴 - AWS 권장 가이드</a></li><li><a href=https://sddev.tistory.com/111>이벤트 소싱(Event Sourcing) 개념 - devNote</a></li><li><a href=https://monday9pm.com/event-sourcing%EA%B3%BC-cqrs-1f6505035cbe>이벤트 소싱(Event Sourcing)과 CQRS 패턴 - monday9pm</a></li><li><a href=https://edykim.com/ko/post/event-sourcing-implementing-eventsourcing-patterns-with-javascript/>이벤트 소싱(Event Sourcing) JavaScript로 구현하기 - edykim</a></li><li><a href=https://sarc.io/index.php/cloud/2232-event-sourcing-pattern>이벤트 소싱(Event Sourcing) 패턴 - 삵(sarc.io)</a></li><li><a href=https://sabarada.tistory.com/231>이벤트 소싱(Event Sourcing) 맛보기 - 이론편 - saberada</a></li><li><a href=https://quddkflty.tistory.com/102>이벤트 소싱(Event Sourcing) 개념과 git 비교 - 병아리쇼</a></li><li><a href=https://velog.io/@bighaeil/Event-Sourcing-%EA%B5%AC%ED%98%84-with-Spring-Boot-MongoDB-Kafka>이벤트 소싱(Event Sourcing) 구현 with Spring Boot, MongoDB, Kafka - velog</a></li><li><a href=https://notavoid.tistory.com/218>이벤트 소싱(Event Sourcing)과 CQRS 패턴 심화 구현 - Spring Boot로 고급 이벤트 &mldr; - notavoid</a></li></ul><p><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing><figure><img alt="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn" loading=lazy src="https://tse4.mm.bing.net/th/id/OIP.o6ZoY5sk83-tDISF-pVNtwHaEM?pid=Api"></figure></a></p><p>아래는 <strong>Event Sourcing</strong> 아키텍처에 대한 구조화된 분석입니다.</p><hr><h2 id=1-태그-2>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-2>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-117-1><a class=lnlinks href=#hl-117-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Event-Sourcing, Immutable-Events, Audit-Log, Replayable-State
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-분류-계층-적절성-분석>2. 분류 계층 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-계층-적절성-분석>#</a></h2><ul><li><p><strong>분류에 대한 평가</strong>:</p><blockquote><p>Computer Science and Engineering → Software Engineering → Design and Architecture → Architecture Styles and Patterns → Architecture Patterns → Data Management</p></blockquote></li><li><p><strong>분석 결과</strong>:</p><ul><li>적절한 계층 구조입니다. Event Sourcing은 변경 이벤트의 <strong>프로젝션</strong> 및 <strong>재생 가능 상태</strong>를 중앙에서 관리하는 데이터 중심 패턴으로, <strong>Data Management</strong> 하위 범주에 올바르게 위치합니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">docs.aws.amazon.com</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">stackoverflow.com</a>, <a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">learn.microsoft.com</a>)</li></ul></li></ul><hr><h2 id=3-200자-요약>3. 200자 요약<a hidden class=anchor aria-hidden=true href=#3-200자-요약>#</a></h2><p>Event Sourcing은 애플리케이션의 상태 변화를 <strong>이벤트</strong>로 불변하게 저장하는 패턴입니다. 현재 상태는 이벤트 스트림을 재생하여 구성되며, 모든 변경 기록이 남아 있어 <strong>감사</strong>, <strong>디버깅</strong>, <strong>시간 여행</strong>, <strong>이력 복원</strong> 등이 가능합니다. CQRS와 함께 쓰이면 읽기 모델 최적화와 확장성도 확보됩니다.</p><hr><h2 id=4-250자-개요>4. 250자 개요<a hidden class=anchor aria-hidden=true href=#4-250자-개요>#</a></h2><p>Event Sourcing은 도메인에서 발생하는 모든 상태 변경을 <strong>불변 이벤트</strong>로 저장하는 아키텍처 패턴입니다. 표준 CRUD 방식과 다르게 이벤트 로그가 **단일 출처(source of truth)**로 사용되며, **이벤트 저장소(Event Store)**에 append-only 방식으로 쌓입니다. 현재 상태는 이벤트 재생(replay)을 통해 계산되며, 이를 활용해 <strong>시점 조회</strong>, <strong>감사 로그</strong>, <strong>이력 복원</strong>, <strong>읽기 모델 프로젝션</strong>이 가능합니다. 특히 CQRS와 결합하면 이벤트는 Command Side에서 저장되고, Read Side에서 Projection을 통해 최적화된 조회용 뷰를 생성합니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">docs.aws.amazon.com</a>)</p><hr><h2 id=5-핵심-개념-및-실무-구현-요소>5. 핵심 개념 및 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-및-실무-구현-요소>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li><strong>Immutable Events</strong>: 모든 상태 변경은 변경 불가능한 이벤트로 기록됨</li><li><strong>Event Store</strong>: 이벤트를 순차적으로 저장하는 append-only 저장소 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">docs.aws.amazon.com</a>)</li><li><strong>Event Replay</strong>: 저장된 이벤트를 순차 처리해 현재 상태를 재생산 (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">learn.microsoft.com</a>)</li><li><strong>Projections / Read Models</strong>: 이벤트 소비 후 조회에 최적화된 구조로 가공된 뷰 생성 (<a href="https://www.asyncapi.com/docs/guides/message-validation?utm_source=chatgpt.com" title="Message validation | AsyncAPI Initiative for event-driven APIs">learn.microsoft.com</a>)</li><li><strong>Snapshot</strong>: 이벤트 재생 비용을 줄이기 위해 중간 상태를 저장하는 기법</li></ul><h3 id=구현-요소>구현 요소<a hidden class=anchor aria-hidden=true href=#구현-요소>#</a></h3><ul><li><code>Event</code> 클래스 정의 및 버전 관리</li><li><code>EventStore</code> 구성 (Kafka, EventStoreDB, RDBMS 로그 등)</li><li><code>Aggregate</code> 내 command 처리 로직과 이벤트 생성 함수</li><li><code>Projector</code> 구성하여 Read DB 업데이트</li><li><code>Snapshot</code> 저장 전략 및 소비자 구현</li><li>테스트 전략: 이벤트 replay 테스트, projection 검증, 동시성 처리</li></ul><hr><h2 id=6-구조-및-아키텍처--구성-요소>6. 구조 및 아키텍처 + 구성 요소<a hidden class=anchor aria-hidden=true href=#6-구조-및-아키텍처--구성-요소>#</a></h2><pre class=mermaid>flowchart LR
  UI/API --&gt; Cmd[Command Handler]
  Cmd --&gt; Agg[Aggregate] --&gt; EvtStore[Event Store (append-only)]
  EvtStore --&gt; EvtBus[Event Bus / Queue]
  EvtBus --&gt; Proj[Projector] --&gt; ReadDB[(Read Model DB)]
  EvtStore ==&gt; Replay[Snapshot mechanism]
</pre><ul><li><strong>Command Handler</strong>: command 입력 → Aggregate 실행 → 이벤트 생성</li><li><strong>Aggregate</strong>: 도메인 로직 수행 후 Event 반환</li><li><strong>Event Store</strong>: 이벤트 append 저장, 불변성 보장</li><li><strong>Event Bus / Queue</strong>: 이벤트를 비동기 배포</li><li><strong>Projector</strong>: 이벤트 소비 → Read DB 프로젝션 생성</li><li><strong>Read Model DB</strong>: 조회에 최적화된 Materialized View 제공</li><li><strong>Snapshot / Replay</strong>: 이벤트 재생 비용 절감을 위한 상태 저장 및 로딩</li></ul><p><strong>필수 구성요소</strong>: Event, Event Store, Aggregate, Projector, Read DB
<strong>선택 구성요소</strong>: Event Bus, Snapshot, Integration 이벤트 핸들러 등</p><hr><h2 id=7-주요-원리--작동-원리>7. 주요 원리 & 작동 원리<a hidden class=anchor aria-hidden=true href=#7-주요-원리--작동-원리>#</a></h2><ul><li><strong>불변성과 추적 가능성</strong>: 모든 변경을 이벤트로 캡처하여 완전한 이력 보장 (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">geeksforgeeks.org</a>, <a href="https://docs.kurrent.io/server/v22.10/introduction?utm_source=chatgpt.com" title="Introduction | Kurrent Docs">danielwhittaker.me</a>, <a href="https://github.com/EventStore/documentation?utm_source=chatgpt.com" title="kurrent-io/documentation - GitHub">en.wikipedia.org</a>, <a href="https://cloudevents.io/?utm_source=chatgpt.com" title="CloudEvents |">learn.microsoft.com</a>, <a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">upsolver.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">docs.aws.amazon.com</a>)</li><li><strong>이벤트 재생을 통한 상태 복원</strong>: 이벤트 순서대로 처리하면 특정 시점 상태가 재현 가능</li><li><strong>CQRS 결합 구조</strong>: Write 모델은 이벤트 저장, Read 모델은 Projection을 통해 최적화 구조 구축 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">docs.aws.amazon.com</a>)</li><li><strong>Snapshot 기반 최적화</strong>: 누적 이벤트 재생 비용 최소화 전략</li></ul><hr><h2 id=8-구현-기법-1>8. 구현 기법<a hidden class=anchor aria-hidden=true href=#8-구현-기법-1>#</a></h2><ul><li><strong>Event 정의 & 버전 관리</strong>: Event 타입과 Payload 정의 후 스키마 변경 대응(version field or upcasting) (<a href="https://domaincentric.net/blog/event-sourcing-snapshotting?utm_source=chatgpt.com" title="Event Sourcing: Snapshotting - Domain Centric">en.wikipedia.org</a>)</li><li><strong>Event Store 구성</strong>: EventStoreDB, Kafka, RDBMS 이벤트 로그 활용</li><li><strong>Aggregate 클래스</strong>: <code>apply(event)</code> 방식으로 도메인 상태 변경, command 처리</li><li><strong>Projector</strong>: 이벤트 타입별 Subscription 설정 → Read DB 업데이트</li><li><strong>Snapshot 주기화</strong>: N번째 이벤트마다 Snapshot 생성 후 재생 시 Snapshot부터 시작</li><li><strong>백업/아카이빙</strong>: 장기 보존 이벤트 압축 또는 외부 저장소 전환</li></ul><h2 id=구현-기법-1>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법-1>#</a></h2><h3 id=1-기본-event-sourcing>1. 기본 Event Sourcing<a hidden class=anchor aria-hidden=true href=#1-기본-event-sourcing>#</a></h3><p><strong>정의</strong>: 이벤트만을 이용한 상태 관리
<strong>구성</strong>: 이벤트 스토어 + 이벤트 재생
<strong>목적</strong>: 완전한 감사 추적 제공
<strong>실제 예시</strong>: 은행 계좌 거래 내역을 모든 입출금 이벤트로 관리</p><h3 id=2-cqrs와-결합된-event-sourcing>2. CQRS와 결합된 Event Sourcing<a hidden class=anchor aria-hidden=true href=#2-cqrs와-결합된-event-sourcing>#</a></h3><p><strong>정의</strong>: 데이터 관리 작업을 이벤트에 대한 응답으로 수행하고 저장된 이벤트에서 뷰를 구체화
<strong>구성</strong>: 명령 모델 + 쿼리 모델 + 이벤트 스토어 + 프로젝션
<strong>목적</strong>: 읽기와 쓰기 성능 최적화
<strong>실제 예시</strong>: 전자상거래에서 주문 처리(쓰기)와 재고 조회(읽기) 분리</p><h3 id=3-snapshot을-활용한-event-sourcing>3. Snapshot을 활용한 Event Sourcing<a hidden class=anchor aria-hidden=true href=#3-snapshot을-활용한-event-sourcing>#</a></h3><p><strong>정의</strong>: 성능 최적화를 위한 상태 스냅샷 저장
<strong>구성</strong>: 이벤트 스토어 + 스냅샷 저장소 + 증분 이벤트 재생
<strong>목적</strong>: 대용량 이벤트에서 재구성 성능 향상
<strong>실제 예시</strong>: 수천 개의 트랜잭션이 있는 계좌에서 주기적 잔액 스냅샷 생성</p><h3 id=4-분산-event-sourcing>4. 분산 Event Sourcing<a hidden class=anchor aria-hidden=true href=#4-분산-event-sourcing>#</a></h3><p><strong>정의</strong>: 마이크로서비스 환경에서의 이벤트 소싱
<strong>구성</strong>: 서비스별 이벤트 스토어 + 이벤트 버스 + Saga 패턴
<strong>목적</strong>: 분산 시스템에서 데이터 일관성 보장
<strong>실제 예시</strong>: MSA에서 서비스별 분리된 DB 간 트랜잭션 관리</p><hr><h2 id=장점-1>장점<a hidden class=anchor aria-hidden=true href=#장점-1>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>감사 및 추적성</strong></td><td>완전한 감사 로그</td><td>이벤트 소싱된 시스템은 가장 강력한 감사 로그 옵션 중 하나를 제공</td></tr><tr><td><strong>시간적 분석</strong></td><td>시간 기반 쿼리</td><td>시스템을 시간상 앞뒤로 이동시켜 디버깅과 &ldquo;만약에&rdquo; 분석에 매우 가치 있음</td></tr><tr><td><strong>확장성</strong></td><td>수평적 확장</td><td>이벤트 소싱은 분산 시스템과 수평적 확장에 적합</td></tr><tr><td><strong>복원력</strong></td><td>장애 복구</td><td>다운스트림 프로젝션을 재구축할 수 있는 핵심 &ldquo;기록 소스&rdquo; 데이터만 이벤트 스트림에 작성</td></tr><tr><td><strong>성능</strong></td><td>읽기/쓰기 최적화</td><td>이벤트 소싱된 시스템은 최소한의 동기적 상호작용을 추구하여 반응적, 고성능, 확장 가능한 시스템을 구현</td></tr></tbody></table><h2 id=9-장점-1>9. 장점<a hidden class=anchor aria-hidden=true href=#9-장점-1>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>감사 및 추적성</strong></td><td>이벤트 불변 저장으로 변경 내역 완전 기록</td></tr><tr><td></td><td><strong>이력 관리</strong></td><td>특정 시점 상태 재현 가능 (time travel)</td></tr><tr><td></td><td><strong>복원력</strong></td><td>롤백 없이 상태 재구성이 가능</td></tr><tr><td></td><td><strong>확장성</strong></td><td>다양한 프로젝션 생성, polyglot persistence 지원</td></tr><tr><td></td><td><strong>도메인 표현 적합성</strong></td><td>이벤트가 도메인 관점의 언어로 표현됨</td></tr></tbody></table><hr><h2 id=10-단점과-문제점--해결방안>10. 단점과 문제점 + 해결방안<a hidden class=anchor aria-hidden=true href=#10-단점과-문제점--해결방안>#</a></h2><h3 id=단점-3>단점<a hidden class=anchor aria-hidden=true href=#단점-3>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>복잡도 증가</strong></td><td>프로젝트 구조가 일반 CRUD보다 복잡 (<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing">stackoverflow.com</a>)</td><td>단위 모듈 적용, 프레임워크 도입, 단계적 확장</td></tr><tr><td></td><td><strong>쿼리 어려움</strong></td><td>이벤트 로그 직접 쿼리 비효율</td><td>Read Model 구축 및 Projection 활용</td></tr><tr><td></td><td><strong>이벤트 버전 관리 부하</strong></td><td>이벤트 스키마 변경 시 어려움</td><td>upcasting, 버전 필드, backward-compatible 이벤트 설계</td></tr><tr><td></td><td><strong>스토리지 증가</strong></td><td>이벤트 저장 용량이 크게 증가</td><td>아카이빙, TTL, Snapshot 전략 사용</td></tr></tbody></table><h3 id=문제점-상세-분석>문제점 상세 분석<a hidden class=anchor aria-hidden=true href=#문제점-상세-분석>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지</th><th>예방</th><th>해결</th></tr></thead><tbody><tr><td>문제</td><td>Event replay 지연</td><td>누적 이벤트 재생 필요</td><td>시스템 부팅 느려짐, 상태 불확실</td><td>라그 시간 모니터링</td><td>Snapshot 전략, 주기적 미리 계산</td><td>자동 Snapshot, 이벤트 압축</td></tr><tr><td>문제</td><td>동시성 충돌</td><td>동일 도메인 동시 변경</td><td>상태 불일치 및 예외 발생</td><td>충돌 로그, 예외 모니터</td><td>optimistic concurrency, 버전 필드 사용</td><td>롤백/재시도 로직, 충돌 해결 UI</td></tr><tr><td>문제</td><td>과도한 이벤트</td><td>단순 상태 변경도 이벤트화</td><td>소비자 부담 증가, 이벤트 폭증</td><td>이벤트 수 증가 모니터링</td><td>비즈니스 이벤트만, 중요도 기반 선택</td><td>필터링, 청소, 미러링 전략</td></tr></tbody></table><h2 id=2-도전-과제-심화-분석->2. 도전 과제 심화 분석 🔍<a hidden class=anchor aria-hidden=true href=#2-도전-과제-심화-분석->#</a></h2><h3 id=-이벤트-스키마-진화>• 이벤트 스키마 진화<a hidden class=anchor aria-hidden=true href=#-이벤트-스키마-진화>#</a></h3><ul><li><p><strong>원인</strong>: 도메인 로직 변화로 이벤트 구조가 변경됨</p></li><li><p><strong>영향</strong>: 오래된 이벤트 디코딩 실패, 재생 오류</p></li><li><p><strong>탐지/진단</strong>: 업스트림 로그 분석, 이벤트 리플레이 실패</p></li><li><p><strong>예방</strong>: 업캐스팅(upcasting) 전략, 버전 필드 포함 설계</p></li><li><p><strong>해결 기법</strong>:</p><ul><li>이벤트 리팩토링 시 새・구 버전 모두 파서 등록</li><li>데이터 마이그레이션 지원 또는 적응형 소비자</li></ul></li></ul><h3 id=-분산-장애-대응>• 분산 장애 대응<a hidden class=anchor aria-hidden=true href=#-분산-장애-대응>#</a></h3><ul><li><p><strong>원인</strong>: 이벤트 송수신 실패, 브로커 장애</p></li><li><p><strong>영향</strong>: Projection 지연/누락, 시스템 불안정</p></li><li><p><strong>탐지/진단</strong>: Dead Letter 큐 알림, 지연 메트릭</p></li><li><p><strong>예방</strong>: Exactly-once, idempotent 설계</p></li><li><p><strong>해결 기술</strong>:</p><ul><li>Dead-letter 큐, 재시도 전략</li><li>모니터링 기반 자동 복구</li><li>Outbox pattern + 브로커 트랜잭션</li></ul></li></ul><h3 id=-모니터링--추적>• 모니터링 & 추적<a hidden class=anchor aria-hidden=true href=#-모니터링--추적>#</a></h3><ul><li><p><strong>원인</strong>: 비동기 이벤트 흐름 복잡성</p></li><li><p><strong>영향</strong>: 장애 원인 분석 어려움</p></li><li><p><strong>탐지/진단</strong>: 분산 트레이싱 미비, 로그 단절</p></li><li><p><strong>예방</strong>: Correlation ID 및 Trace context 포함 설계</p></li><li><p><strong>해결 방법</strong>:</p><ul><li>Zipkin, OpenTelemetry 연동</li><li>Event dispatch / process 메트릭 수집</li></ul></li></ul><h3 id=-테스트--유지보수>• 테스트 & 유지보수<a hidden class=anchor aria-hidden=true href=#-테스트--유지보수>#</a></h3><ul><li><p><strong>원인</strong>: 이벤트 중심 결과 기반 테스트 복잡</p></li><li><p><strong>영향</strong>: 리그레션 위험 & 코드 가시성 감소</p></li><li><p><strong>탐지/진단</strong>: Projection 오류, 핸들러 실패</p></li><li><p><strong>예방</strong>: E2E/Contract 테스트 설계 철저</p></li><li><p><strong>해결 기술</strong>:</p><ul><li>Testcontainers 사용</li><li>모킹 가능한 EventBus, Projection 결과 검증 설정</li></ul></li></ul><h2 id=11-도전-과제-1>11. 도전 과제<a hidden class=anchor aria-hidden=true href=#11-도전-과제-1>#</a></h2><ul><li><strong>이벤트 스키마 진화</strong>: 스키마 호환성·리팩토링 전략 필요</li><li><strong>모니터링 체계 구축</strong>: 이벤트 처리 지연 및 재시도 자동화</li><li><strong>관리 패턴 표준화</strong>: Event naming, 버전 관리, 필터 정책 가이드라인</li><li><strong>복잡한 도메인 적용</strong>: 미세 이벤트 vs. 복합 이벤트 수준 균형 잡기</li></ul><h2 id=분류-기준에-따른-종류-및-유형-1>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형-1>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td><strong>저장 방식</strong></td><td>단일 스토어</td><td>모든 이벤트를 하나의 저장소에 보관</td><td>소규모 애플리케이션</td></tr><tr><td></td><td>분산 스토어</td><td>도메인별 또는 서비스별 분리 저장</td><td>마이크로서비스 아키텍처</td></tr><tr><td><strong>일관성 모델</strong></td><td>강한 일관성</td><td>즉시 일관성 보장</td><td>금융 시스템</td></tr><tr><td></td><td>최종 일관성</td><td>비동기적 일관성 달성</td><td>소셜 미디어, 전자상거래</td></tr><tr><td><strong>프로젝션 전략</strong></td><td>실시간 프로젝션</td><td>이벤트 발생 시 즉시 업데이트</td><td>실시간 대시보드</td></tr><tr><td></td><td>배치 프로젝션</td><td>주기적 일괄 업데이트</td><td>리포팅 시스템</td></tr></tbody></table><h2 id=실무-사용-예시-1>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시-1>#</a></h2><table><thead><tr><th>도메인</th><th>목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td><strong>금융 시스템</strong></td><td>거래 추적 및 감사</td><td>CQRS, 블록체인</td><td>규제 준수, 사기 탐지</td></tr><tr><td><strong>전자상거래</strong></td><td>주문 상태 관리</td><td>마이크로서비스, Kafka</td><td>확장성, 주문 추적</td></tr><tr><td><strong>IoT 플랫폼</strong></td><td>센서 데이터 수집</td><td>시계열 DB, 스트림 처리</td><td>실시간 분석, 예측</td></tr><tr><td><strong>게임 시스템</strong></td><td>플레이어 행동 분석</td><td>NoSQL, 분석 플랫폼</td><td>개인화, 치트 탐지</td></tr><tr><td><strong>의료 시스템</strong></td><td>환자 기록 관리</td><td>HL7 FHIR, 프라이버시 보호</td><td>추적성, 의료 감사</td></tr></tbody></table><h2 id=12-실무-사용-예시>12. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#12-실무-사용-예시>#</a></h2><table><thead><tr><th>스택</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Kafka + EventStoreDB + Spring Boot</td><td>금융 거래 이력 기록 및 감사</td><td>완전한 트랜잭션 추적, 재생 가능 상태 생성</td></tr><tr><td>.NET + Marten</td><td>주문시스템 상태 이력 관리</td><td>DB 롤백 없이 이력 복원, 이벤트 재가공</td></tr><tr><td>Node.js + AWS EventBridge</td><td>IoT 센서 데이터 수집</td><td>시간 기반 분석, 실패 메시지 재처리 지원</td></tr><tr><td>Laravel + spatie/laravel-event-sourcing</td><td>PHP 영역에서 PoC 구현</td><td>이벤트 구조 이해 및 조회 모델 분리</td></tr></tbody></table><hr><h2 id=13-활용-사례-금융-거래-시스템>13. 활용 사례: 금융 거래 시스템<a hidden class=anchor aria-hidden=true href=#13-활용-사례-금융-거래-시스템>#</a></h2><pre class=mermaid>flowchart LR
  subgraph Write
    API --&gt; Cmd
    Cmd --&gt; Agg[Account Aggregate]
    Agg --&gt; ES[Event Store]
    ES --&gt; Bus[Event Bus]
  end
  subgraph Read
    Bus --&gt; Proj[Transaction Projector]
    Proj --&gt; Read[(Read DB)]
      Read --&gt; UI
  end
</pre><ul><li><strong>Account Aggregate</strong>: 입출금 command 처리 후 <code>MoneyDeposited</code> 등 이벤트 생성</li><li><strong>Event Store</strong>: 거래 내역 이벤트만 기록</li><li><strong>Transaction Projector</strong>: 이벤트 소비 후 잔액, 거래 목록 프리젠테이션 뷰 생성</li><li><strong>장점 비교</strong>: CRUD 방식보다 정확한 이력 관리와 분리된 조회 모델로 성능 확보</li></ul><hr><h2 id=14-구현-예시-python--pseudocode>14. 구현 예시 (Python + Pseudocode)<a hidden class=anchor aria-hidden=true href=#14-구현-예시-python--pseudocode>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-120-1><a class=lnlinks href=#hl-120-1> 1</a>
</span><span class=lnt id=hl-120-2><a class=lnlinks href=#hl-120-2> 2</a>
</span><span class=lnt id=hl-120-3><a class=lnlinks href=#hl-120-3> 3</a>
</span><span class=lnt id=hl-120-4><a class=lnlinks href=#hl-120-4> 4</a>
</span><span class=lnt id=hl-120-5><a class=lnlinks href=#hl-120-5> 5</a>
</span><span class=lnt id=hl-120-6><a class=lnlinks href=#hl-120-6> 6</a>
</span><span class=lnt id=hl-120-7><a class=lnlinks href=#hl-120-7> 7</a>
</span><span class=lnt id=hl-120-8><a class=lnlinks href=#hl-120-8> 8</a>
</span><span class=lnt id=hl-120-9><a class=lnlinks href=#hl-120-9> 9</a>
</span><span class=lnt id=hl-120-10><a class=lnlinks href=#hl-120-10>10</a>
</span><span class=lnt id=hl-120-11><a class=lnlinks href=#hl-120-11>11</a>
</span><span class=lnt id=hl-120-12><a class=lnlinks href=#hl-120-12>12</a>
</span><span class=lnt id=hl-120-13><a class=lnlinks href=#hl-120-13>13</a>
</span><span class=lnt id=hl-120-14><a class=lnlinks href=#hl-120-14>14</a>
</span><span class=lnt id=hl-120-15><a class=lnlinks href=#hl-120-15>15</a>
</span><span class=lnt id=hl-120-16><a class=lnlinks href=#hl-120-16>16</a>
</span><span class=lnt id=hl-120-17><a class=lnlinks href=#hl-120-17>17</a>
</span><span class=lnt id=hl-120-18><a class=lnlinks href=#hl-120-18>18</a>
</span><span class=lnt id=hl-120-19><a class=lnlinks href=#hl-120-19>19</a>
</span><span class=lnt id=hl-120-20><a class=lnlinks href=#hl-120-20>20</a>
</span><span class=lnt id=hl-120-21><a class=lnlinks href=#hl-120-21>21</a>
</span><span class=lnt id=hl-120-22><a class=lnlinks href=#hl-120-22>22</a>
</span><span class=lnt id=hl-120-23><a class=lnlinks href=#hl-120-23>23</a>
</span><span class=lnt id=hl-120-24><a class=lnlinks href=#hl-120-24>24</a>
</span><span class=lnt id=hl-120-25><a class=lnlinks href=#hl-120-25>25</a>
</span><span class=lnt id=hl-120-26><a class=lnlinks href=#hl-120-26>26</a>
</span><span class=lnt id=hl-120-27><a class=lnlinks href=#hl-120-27>27</a>
</span><span class=lnt id=hl-120-28><a class=lnlinks href=#hl-120-28>28</a>
</span><span class=lnt id=hl-120-29><a class=lnlinks href=#hl-120-29>29</a>
</span><span class=lnt id=hl-120-30><a class=lnlinks href=#hl-120-30>30</a>
</span><span class=lnt id=hl-120-31><a class=lnlinks href=#hl-120-31>31</a>
</span><span class=lnt id=hl-120-32><a class=lnlinks href=#hl-120-32>32</a>
</span><span class=lnt id=hl-120-33><a class=lnlinks href=#hl-120-33>33</a>
</span><span class=lnt id=hl-120-34><a class=lnlinks href=#hl-120-34>34</a>
</span><span class=lnt id=hl-120-35><a class=lnlinks href=#hl-120-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># events.py</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MoneyDeposited</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># aggregate.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AccountAggregate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>evt</span> <span class=o>=</span> <span class=n>MoneyDeposited</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>evt</span><span class=p>);</span> <span class=k>return</span> <span class=n>evt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># repository.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span> <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>):</span> <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># projector.py</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>project_transactions</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>balance</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>MoneyDeposited</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>balance</span> <span class=o>+=</span> <span class=n>e</span><span class=o>.</span><span class=n>amount</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>balance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># usage</span>
</span></span><span class=line><span class=cl><span class=n>agg</span> <span class=o>=</span> <span class=n>AccountAggregate</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>evt</span> <span class=o>=</span> <span class=n>agg</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>();</span> <span class=n>store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;acct1&#34;</span><span class=p>,</span> <span class=n>evt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>events</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;acct1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>balance</span> <span class=o>=</span> <span class=n>project_transactions</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>balance</span><span class=p>)</span>  <span class=c1># 100</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=활용-사례-1>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례-1>#</a></h2><h3 id=netflix의-마이크로서비스-event-sourcing>Netflix의 마이크로서비스 Event Sourcing<a hidden class=anchor aria-hidden=true href=#netflix의-마이크로서비스-event-sourcing>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>이벤트 스토어</strong>: Apache Kafka를 중앙 이벤트 로그로 사용</li><li><strong>마이크로서비스</strong>: 각 서비스별 독립적인 이벤트 스트림</li><li><strong>프로젝션 서비스</strong>: 사용자 추천, 콘텐츠 메타데이터, 시청 이력 관리</li></ul><pre class=mermaid>graph TB
    subgraph &#34;Netflix Event Sourcing Architecture&#34;
        A[User Action] --&gt; B[Content Service]
        A --&gt; C[Recommendation Service]
        A --&gt; D[Billing Service]
        
        B --&gt; E[Kafka Event Stream]
        C --&gt; E
        D --&gt; E
        
        E --&gt; F[Content Projection]
        E --&gt; G[User Preference Projection]
        E --&gt; H[Analytics Projection]
        
        F --&gt; I[Content API]
        G --&gt; J[Recommendation API]
        H --&gt; K[Analytics Dashboard]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 행동(시청, 평가, 검색) 이벤트 발생</li><li>각 마이크로서비스가 관련 이벤트를 Kafka에 발행</li><li>이벤트 기반 프로젝션이 실시간으로 업데이트</li><li>추천 시스템과 분석 시스템이 이벤트 스트림 소비</li></ol><p><strong>Event Sourcing의 역할</strong>:</p><ul><li><strong>사용자 경험 개인화</strong>: 시청 이력 기반 추천</li><li><strong>A/B 테스트</strong>: 사용자 행동 패턴 분석</li><li><strong>시스템 확장성</strong>: 서비스별 독립적 확장</li><li><strong>장애 복구</strong>: 이벤트 재생을 통한 상태 복원</li></ul><p><strong>기존 방식과의 차이점</strong>:</p><ul><li><strong>전통적 방식</strong>: 현재 상태만 저장, 히스토리 정보 부족</li><li><strong>Event Sourcing</strong>: 모든 사용자 행동 보존, 시간별 패턴 분석 가능</li><li><strong>확장성</strong>: 개별 서비스 스케일링 vs 모놀리식 스케일링</li><li><strong>장애 복구</strong>: 부분적 복구 vs 전체 시스템 재시작</li></ul><h2 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h2><h3 id=javascript를-이용한-은행-계좌-event-sourcing>JavaScript를 이용한 은행 계좌 Event Sourcing<a hidden class=anchor aria-hidden=true href=#javascript를-이용한-은행-계좌-event-sourcing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-122-1><a class=lnlinks href=#hl-122-1>  1</a>
</span><span class=lnt id=hl-122-2><a class=lnlinks href=#hl-122-2>  2</a>
</span><span class=lnt id=hl-122-3><a class=lnlinks href=#hl-122-3>  3</a>
</span><span class=lnt id=hl-122-4><a class=lnlinks href=#hl-122-4>  4</a>
</span><span class=lnt id=hl-122-5><a class=lnlinks href=#hl-122-5>  5</a>
</span><span class=lnt id=hl-122-6><a class=lnlinks href=#hl-122-6>  6</a>
</span><span class=lnt id=hl-122-7><a class=lnlinks href=#hl-122-7>  7</a>
</span><span class=lnt id=hl-122-8><a class=lnlinks href=#hl-122-8>  8</a>
</span><span class=lnt id=hl-122-9><a class=lnlinks href=#hl-122-9>  9</a>
</span><span class=lnt id=hl-122-10><a class=lnlinks href=#hl-122-10> 10</a>
</span><span class=lnt id=hl-122-11><a class=lnlinks href=#hl-122-11> 11</a>
</span><span class=lnt id=hl-122-12><a class=lnlinks href=#hl-122-12> 12</a>
</span><span class=lnt id=hl-122-13><a class=lnlinks href=#hl-122-13> 13</a>
</span><span class=lnt id=hl-122-14><a class=lnlinks href=#hl-122-14> 14</a>
</span><span class=lnt id=hl-122-15><a class=lnlinks href=#hl-122-15> 15</a>
</span><span class=lnt id=hl-122-16><a class=lnlinks href=#hl-122-16> 16</a>
</span><span class=lnt id=hl-122-17><a class=lnlinks href=#hl-122-17> 17</a>
</span><span class=lnt id=hl-122-18><a class=lnlinks href=#hl-122-18> 18</a>
</span><span class=lnt id=hl-122-19><a class=lnlinks href=#hl-122-19> 19</a>
</span><span class=lnt id=hl-122-20><a class=lnlinks href=#hl-122-20> 20</a>
</span><span class=lnt id=hl-122-21><a class=lnlinks href=#hl-122-21> 21</a>
</span><span class=lnt id=hl-122-22><a class=lnlinks href=#hl-122-22> 22</a>
</span><span class=lnt id=hl-122-23><a class=lnlinks href=#hl-122-23> 23</a>
</span><span class=lnt id=hl-122-24><a class=lnlinks href=#hl-122-24> 24</a>
</span><span class=lnt id=hl-122-25><a class=lnlinks href=#hl-122-25> 25</a>
</span><span class=lnt id=hl-122-26><a class=lnlinks href=#hl-122-26> 26</a>
</span><span class=lnt id=hl-122-27><a class=lnlinks href=#hl-122-27> 27</a>
</span><span class=lnt id=hl-122-28><a class=lnlinks href=#hl-122-28> 28</a>
</span><span class=lnt id=hl-122-29><a class=lnlinks href=#hl-122-29> 29</a>
</span><span class=lnt id=hl-122-30><a class=lnlinks href=#hl-122-30> 30</a>
</span><span class=lnt id=hl-122-31><a class=lnlinks href=#hl-122-31> 31</a>
</span><span class=lnt id=hl-122-32><a class=lnlinks href=#hl-122-32> 32</a>
</span><span class=lnt id=hl-122-33><a class=lnlinks href=#hl-122-33> 33</a>
</span><span class=lnt id=hl-122-34><a class=lnlinks href=#hl-122-34> 34</a>
</span><span class=lnt id=hl-122-35><a class=lnlinks href=#hl-122-35> 35</a>
</span><span class=lnt id=hl-122-36><a class=lnlinks href=#hl-122-36> 36</a>
</span><span class=lnt id=hl-122-37><a class=lnlinks href=#hl-122-37> 37</a>
</span><span class=lnt id=hl-122-38><a class=lnlinks href=#hl-122-38> 38</a>
</span><span class=lnt id=hl-122-39><a class=lnlinks href=#hl-122-39> 39</a>
</span><span class=lnt id=hl-122-40><a class=lnlinks href=#hl-122-40> 40</a>
</span><span class=lnt id=hl-122-41><a class=lnlinks href=#hl-122-41> 41</a>
</span><span class=lnt id=hl-122-42><a class=lnlinks href=#hl-122-42> 42</a>
</span><span class=lnt id=hl-122-43><a class=lnlinks href=#hl-122-43> 43</a>
</span><span class=lnt id=hl-122-44><a class=lnlinks href=#hl-122-44> 44</a>
</span><span class=lnt id=hl-122-45><a class=lnlinks href=#hl-122-45> 45</a>
</span><span class=lnt id=hl-122-46><a class=lnlinks href=#hl-122-46> 46</a>
</span><span class=lnt id=hl-122-47><a class=lnlinks href=#hl-122-47> 47</a>
</span><span class=lnt id=hl-122-48><a class=lnlinks href=#hl-122-48> 48</a>
</span><span class=lnt id=hl-122-49><a class=lnlinks href=#hl-122-49> 49</a>
</span><span class=lnt id=hl-122-50><a class=lnlinks href=#hl-122-50> 50</a>
</span><span class=lnt id=hl-122-51><a class=lnlinks href=#hl-122-51> 51</a>
</span><span class=lnt id=hl-122-52><a class=lnlinks href=#hl-122-52> 52</a>
</span><span class=lnt id=hl-122-53><a class=lnlinks href=#hl-122-53> 53</a>
</span><span class=lnt id=hl-122-54><a class=lnlinks href=#hl-122-54> 54</a>
</span><span class=lnt id=hl-122-55><a class=lnlinks href=#hl-122-55> 55</a>
</span><span class=lnt id=hl-122-56><a class=lnlinks href=#hl-122-56> 56</a>
</span><span class=lnt id=hl-122-57><a class=lnlinks href=#hl-122-57> 57</a>
</span><span class=lnt id=hl-122-58><a class=lnlinks href=#hl-122-58> 58</a>
</span><span class=lnt id=hl-122-59><a class=lnlinks href=#hl-122-59> 59</a>
</span><span class=lnt id=hl-122-60><a class=lnlinks href=#hl-122-60> 60</a>
</span><span class=lnt id=hl-122-61><a class=lnlinks href=#hl-122-61> 61</a>
</span><span class=lnt id=hl-122-62><a class=lnlinks href=#hl-122-62> 62</a>
</span><span class=lnt id=hl-122-63><a class=lnlinks href=#hl-122-63> 63</a>
</span><span class=lnt id=hl-122-64><a class=lnlinks href=#hl-122-64> 64</a>
</span><span class=lnt id=hl-122-65><a class=lnlinks href=#hl-122-65> 65</a>
</span><span class=lnt id=hl-122-66><a class=lnlinks href=#hl-122-66> 66</a>
</span><span class=lnt id=hl-122-67><a class=lnlinks href=#hl-122-67> 67</a>
</span><span class=lnt id=hl-122-68><a class=lnlinks href=#hl-122-68> 68</a>
</span><span class=lnt id=hl-122-69><a class=lnlinks href=#hl-122-69> 69</a>
</span><span class=lnt id=hl-122-70><a class=lnlinks href=#hl-122-70> 70</a>
</span><span class=lnt id=hl-122-71><a class=lnlinks href=#hl-122-71> 71</a>
</span><span class=lnt id=hl-122-72><a class=lnlinks href=#hl-122-72> 72</a>
</span><span class=lnt id=hl-122-73><a class=lnlinks href=#hl-122-73> 73</a>
</span><span class=lnt id=hl-122-74><a class=lnlinks href=#hl-122-74> 74</a>
</span><span class=lnt id=hl-122-75><a class=lnlinks href=#hl-122-75> 75</a>
</span><span class=lnt id=hl-122-76><a class=lnlinks href=#hl-122-76> 76</a>
</span><span class=lnt id=hl-122-77><a class=lnlinks href=#hl-122-77> 77</a>
</span><span class=lnt id=hl-122-78><a class=lnlinks href=#hl-122-78> 78</a>
</span><span class=lnt id=hl-122-79><a class=lnlinks href=#hl-122-79> 79</a>
</span><span class=lnt id=hl-122-80><a class=lnlinks href=#hl-122-80> 80</a>
</span><span class=lnt id=hl-122-81><a class=lnlinks href=#hl-122-81> 81</a>
</span><span class=lnt id=hl-122-82><a class=lnlinks href=#hl-122-82> 82</a>
</span><span class=lnt id=hl-122-83><a class=lnlinks href=#hl-122-83> 83</a>
</span><span class=lnt id=hl-122-84><a class=lnlinks href=#hl-122-84> 84</a>
</span><span class=lnt id=hl-122-85><a class=lnlinks href=#hl-122-85> 85</a>
</span><span class=lnt id=hl-122-86><a class=lnlinks href=#hl-122-86> 86</a>
</span><span class=lnt id=hl-122-87><a class=lnlinks href=#hl-122-87> 87</a>
</span><span class=lnt id=hl-122-88><a class=lnlinks href=#hl-122-88> 88</a>
</span><span class=lnt id=hl-122-89><a class=lnlinks href=#hl-122-89> 89</a>
</span><span class=lnt id=hl-122-90><a class=lnlinks href=#hl-122-90> 90</a>
</span><span class=lnt id=hl-122-91><a class=lnlinks href=#hl-122-91> 91</a>
</span><span class=lnt id=hl-122-92><a class=lnlinks href=#hl-122-92> 92</a>
</span><span class=lnt id=hl-122-93><a class=lnlinks href=#hl-122-93> 93</a>
</span><span class=lnt id=hl-122-94><a class=lnlinks href=#hl-122-94> 94</a>
</span><span class=lnt id=hl-122-95><a class=lnlinks href=#hl-122-95> 95</a>
</span><span class=lnt id=hl-122-96><a class=lnlinks href=#hl-122-96> 96</a>
</span><span class=lnt id=hl-122-97><a class=lnlinks href=#hl-122-97> 97</a>
</span><span class=lnt id=hl-122-98><a class=lnlinks href=#hl-122-98> 98</a>
</span><span class=lnt id=hl-122-99><a class=lnlinks href=#hl-122-99> 99</a>
</span><span class=lnt id=hl-122-100><a class=lnlinks href=#hl-122-100>100</a>
</span><span class=lnt id=hl-122-101><a class=lnlinks href=#hl-122-101>101</a>
</span><span class=lnt id=hl-122-102><a class=lnlinks href=#hl-122-102>102</a>
</span><span class=lnt id=hl-122-103><a class=lnlinks href=#hl-122-103>103</a>
</span><span class=lnt id=hl-122-104><a class=lnlinks href=#hl-122-104>104</a>
</span><span class=lnt id=hl-122-105><a class=lnlinks href=#hl-122-105>105</a>
</span><span class=lnt id=hl-122-106><a class=lnlinks href=#hl-122-106>106</a>
</span><span class=lnt id=hl-122-107><a class=lnlinks href=#hl-122-107>107</a>
</span><span class=lnt id=hl-122-108><a class=lnlinks href=#hl-122-108>108</a>
</span><span class=lnt id=hl-122-109><a class=lnlinks href=#hl-122-109>109</a>
</span><span class=lnt id=hl-122-110><a class=lnlinks href=#hl-122-110>110</a>
</span><span class=lnt id=hl-122-111><a class=lnlinks href=#hl-122-111>111</a>
</span><span class=lnt id=hl-122-112><a class=lnlinks href=#hl-122-112>112</a>
</span><span class=lnt id=hl-122-113><a class=lnlinks href=#hl-122-113>113</a>
</span><span class=lnt id=hl-122-114><a class=lnlinks href=#hl-122-114>114</a>
</span><span class=lnt id=hl-122-115><a class=lnlinks href=#hl-122-115>115</a>
</span><span class=lnt id=hl-122-116><a class=lnlinks href=#hl-122-116>116</a>
</span><span class=lnt id=hl-122-117><a class=lnlinks href=#hl-122-117>117</a>
</span><span class=lnt id=hl-122-118><a class=lnlinks href=#hl-122-118>118</a>
</span><span class=lnt id=hl-122-119><a class=lnlinks href=#hl-122-119>119</a>
</span><span class=lnt id=hl-122-120><a class=lnlinks href=#hl-122-120>120</a>
</span><span class=lnt id=hl-122-121><a class=lnlinks href=#hl-122-121>121</a>
</span><span class=lnt id=hl-122-122><a class=lnlinks href=#hl-122-122>122</a>
</span><span class=lnt id=hl-122-123><a class=lnlinks href=#hl-122-123>123</a>
</span><span class=lnt id=hl-122-124><a class=lnlinks href=#hl-122-124>124</a>
</span><span class=lnt id=hl-122-125><a class=lnlinks href=#hl-122-125>125</a>
</span><span class=lnt id=hl-122-126><a class=lnlinks href=#hl-122-126>126</a>
</span><span class=lnt id=hl-122-127><a class=lnlinks href=#hl-122-127>127</a>
</span><span class=lnt id=hl-122-128><a class=lnlinks href=#hl-122-128>128</a>
</span><span class=lnt id=hl-122-129><a class=lnlinks href=#hl-122-129>129</a>
</span><span class=lnt id=hl-122-130><a class=lnlinks href=#hl-122-130>130</a>
</span><span class=lnt id=hl-122-131><a class=lnlinks href=#hl-122-131>131</a>
</span><span class=lnt id=hl-122-132><a class=lnlinks href=#hl-122-132>132</a>
</span><span class=lnt id=hl-122-133><a class=lnlinks href=#hl-122-133>133</a>
</span><span class=lnt id=hl-122-134><a class=lnlinks href=#hl-122-134>134</a>
</span><span class=lnt id=hl-122-135><a class=lnlinks href=#hl-122-135>135</a>
</span><span class=lnt id=hl-122-136><a class=lnlinks href=#hl-122-136>136</a>
</span><span class=lnt id=hl-122-137><a class=lnlinks href=#hl-122-137>137</a>
</span><span class=lnt id=hl-122-138><a class=lnlinks href=#hl-122-138>138</a>
</span><span class=lnt id=hl-122-139><a class=lnlinks href=#hl-122-139>139</a>
</span><span class=lnt id=hl-122-140><a class=lnlinks href=#hl-122-140>140</a>
</span><span class=lnt id=hl-122-141><a class=lnlinks href=#hl-122-141>141</a>
</span><span class=lnt id=hl-122-142><a class=lnlinks href=#hl-122-142>142</a>
</span><span class=lnt id=hl-122-143><a class=lnlinks href=#hl-122-143>143</a>
</span><span class=lnt id=hl-122-144><a class=lnlinks href=#hl-122-144>144</a>
</span><span class=lnt id=hl-122-145><a class=lnlinks href=#hl-122-145>145</a>
</span><span class=lnt id=hl-122-146><a class=lnlinks href=#hl-122-146>146</a>
</span><span class=lnt id=hl-122-147><a class=lnlinks href=#hl-122-147>147</a>
</span><span class=lnt id=hl-122-148><a class=lnlinks href=#hl-122-148>148</a>
</span><span class=lnt id=hl-122-149><a class=lnlinks href=#hl-122-149>149</a>
</span><span class=lnt id=hl-122-150><a class=lnlinks href=#hl-122-150>150</a>
</span><span class=lnt id=hl-122-151><a class=lnlinks href=#hl-122-151>151</a>
</span><span class=lnt id=hl-122-152><a class=lnlinks href=#hl-122-152>152</a>
</span><span class=lnt id=hl-122-153><a class=lnlinks href=#hl-122-153>153</a>
</span><span class=lnt id=hl-122-154><a class=lnlinks href=#hl-122-154>154</a>
</span><span class=lnt id=hl-122-155><a class=lnlinks href=#hl-122-155>155</a>
</span><span class=lnt id=hl-122-156><a class=lnlinks href=#hl-122-156>156</a>
</span><span class=lnt id=hl-122-157><a class=lnlinks href=#hl-122-157>157</a>
</span><span class=lnt id=hl-122-158><a class=lnlinks href=#hl-122-158>158</a>
</span><span class=lnt id=hl-122-159><a class=lnlinks href=#hl-122-159>159</a>
</span><span class=lnt id=hl-122-160><a class=lnlinks href=#hl-122-160>160</a>
</span><span class=lnt id=hl-122-161><a class=lnlinks href=#hl-122-161>161</a>
</span><span class=lnt id=hl-122-162><a class=lnlinks href=#hl-122-162>162</a>
</span><span class=lnt id=hl-122-163><a class=lnlinks href=#hl-122-163>163</a>
</span><span class=lnt id=hl-122-164><a class=lnlinks href=#hl-122-164>164</a>
</span><span class=lnt id=hl-122-165><a class=lnlinks href=#hl-122-165>165</a>
</span><span class=lnt id=hl-122-166><a class=lnlinks href=#hl-122-166>166</a>
</span><span class=lnt id=hl-122-167><a class=lnlinks href=#hl-122-167>167</a>
</span><span class=lnt id=hl-122-168><a class=lnlinks href=#hl-122-168>168</a>
</span><span class=lnt id=hl-122-169><a class=lnlinks href=#hl-122-169>169</a>
</span><span class=lnt id=hl-122-170><a class=lnlinks href=#hl-122-170>170</a>
</span><span class=lnt id=hl-122-171><a class=lnlinks href=#hl-122-171>171</a>
</span><span class=lnt id=hl-122-172><a class=lnlinks href=#hl-122-172>172</a>
</span><span class=lnt id=hl-122-173><a class=lnlinks href=#hl-122-173>173</a>
</span><span class=lnt id=hl-122-174><a class=lnlinks href=#hl-122-174>174</a>
</span><span class=lnt id=hl-122-175><a class=lnlinks href=#hl-122-175>175</a>
</span><span class=lnt id=hl-122-176><a class=lnlinks href=#hl-122-176>176</a>
</span><span class=lnt id=hl-122-177><a class=lnlinks href=#hl-122-177>177</a>
</span><span class=lnt id=hl-122-178><a class=lnlinks href=#hl-122-178>178</a>
</span><span class=lnt id=hl-122-179><a class=lnlinks href=#hl-122-179>179</a>
</span><span class=lnt id=hl-122-180><a class=lnlinks href=#hl-122-180>180</a>
</span><span class=lnt id=hl-122-181><a class=lnlinks href=#hl-122-181>181</a>
</span><span class=lnt id=hl-122-182><a class=lnlinks href=#hl-122-182>182</a>
</span><span class=lnt id=hl-122-183><a class=lnlinks href=#hl-122-183>183</a>
</span><span class=lnt id=hl-122-184><a class=lnlinks href=#hl-122-184>184</a>
</span><span class=lnt id=hl-122-185><a class=lnlinks href=#hl-122-185>185</a>
</span><span class=lnt id=hl-122-186><a class=lnlinks href=#hl-122-186>186</a>
</span><span class=lnt id=hl-122-187><a class=lnlinks href=#hl-122-187>187</a>
</span><span class=lnt id=hl-122-188><a class=lnlinks href=#hl-122-188>188</a>
</span><span class=lnt id=hl-122-189><a class=lnlinks href=#hl-122-189>189</a>
</span><span class=lnt id=hl-122-190><a class=lnlinks href=#hl-122-190>190</a>
</span><span class=lnt id=hl-122-191><a class=lnlinks href=#hl-122-191>191</a>
</span><span class=lnt id=hl-122-192><a class=lnlinks href=#hl-122-192>192</a>
</span><span class=lnt id=hl-122-193><a class=lnlinks href=#hl-122-193>193</a>
</span><span class=lnt id=hl-122-194><a class=lnlinks href=#hl-122-194>194</a>
</span><span class=lnt id=hl-122-195><a class=lnlinks href=#hl-122-195>195</a>
</span><span class=lnt id=hl-122-196><a class=lnlinks href=#hl-122-196>196</a>
</span><span class=lnt id=hl-122-197><a class=lnlinks href=#hl-122-197>197</a>
</span><span class=lnt id=hl-122-198><a class=lnlinks href=#hl-122-198>198</a>
</span><span class=lnt id=hl-122-199><a class=lnlinks href=#hl-122-199>199</a>
</span><span class=lnt id=hl-122-200><a class=lnlinks href=#hl-122-200>200</a>
</span><span class=lnt id=hl-122-201><a class=lnlinks href=#hl-122-201>201</a>
</span><span class=lnt id=hl-122-202><a class=lnlinks href=#hl-122-202>202</a>
</span><span class=lnt id=hl-122-203><a class=lnlinks href=#hl-122-203>203</a>
</span><span class=lnt id=hl-122-204><a class=lnlinks href=#hl-122-204>204</a>
</span><span class=lnt id=hl-122-205><a class=lnlinks href=#hl-122-205>205</a>
</span><span class=lnt id=hl-122-206><a class=lnlinks href=#hl-122-206>206</a>
</span><span class=lnt id=hl-122-207><a class=lnlinks href=#hl-122-207>207</a>
</span><span class=lnt id=hl-122-208><a class=lnlinks href=#hl-122-208>208</a>
</span><span class=lnt id=hl-122-209><a class=lnlinks href=#hl-122-209>209</a>
</span><span class=lnt id=hl-122-210><a class=lnlinks href=#hl-122-210>210</a>
</span><span class=lnt id=hl-122-211><a class=lnlinks href=#hl-122-211>211</a>
</span><span class=lnt id=hl-122-212><a class=lnlinks href=#hl-122-212>212</a>
</span><span class=lnt id=hl-122-213><a class=lnlinks href=#hl-122-213>213</a>
</span><span class=lnt id=hl-122-214><a class=lnlinks href=#hl-122-214>214</a>
</span><span class=lnt id=hl-122-215><a class=lnlinks href=#hl-122-215>215</a>
</span><span class=lnt id=hl-122-216><a class=lnlinks href=#hl-122-216>216</a>
</span><span class=lnt id=hl-122-217><a class=lnlinks href=#hl-122-217>217</a>
</span><span class=lnt id=hl-122-218><a class=lnlinks href=#hl-122-218>218</a>
</span><span class=lnt id=hl-122-219><a class=lnlinks href=#hl-122-219>219</a>
</span><span class=lnt id=hl-122-220><a class=lnlinks href=#hl-122-220>220</a>
</span><span class=lnt id=hl-122-221><a class=lnlinks href=#hl-122-221>221</a>
</span><span class=lnt id=hl-122-222><a class=lnlinks href=#hl-122-222>222</a>
</span><span class=lnt id=hl-122-223><a class=lnlinks href=#hl-122-223>223</a>
</span><span class=lnt id=hl-122-224><a class=lnlinks href=#hl-122-224>224</a>
</span><span class=lnt id=hl-122-225><a class=lnlinks href=#hl-122-225>225</a>
</span><span class=lnt id=hl-122-226><a class=lnlinks href=#hl-122-226>226</a>
</span><span class=lnt id=hl-122-227><a class=lnlinks href=#hl-122-227>227</a>
</span><span class=lnt id=hl-122-228><a class=lnlinks href=#hl-122-228>228</a>
</span><span class=lnt id=hl-122-229><a class=lnlinks href=#hl-122-229>229</a>
</span><span class=lnt id=hl-122-230><a class=lnlinks href=#hl-122-230>230</a>
</span><span class=lnt id=hl-122-231><a class=lnlinks href=#hl-122-231>231</a>
</span><span class=lnt id=hl-122-232><a class=lnlinks href=#hl-122-232>232</a>
</span><span class=lnt id=hl-122-233><a class=lnlinks href=#hl-122-233>233</a>
</span><span class=lnt id=hl-122-234><a class=lnlinks href=#hl-122-234>234</a>
</span><span class=lnt id=hl-122-235><a class=lnlinks href=#hl-122-235>235</a>
</span><span class=lnt id=hl-122-236><a class=lnlinks href=#hl-122-236>236</a>
</span><span class=lnt id=hl-122-237><a class=lnlinks href=#hl-122-237>237</a>
</span><span class=lnt id=hl-122-238><a class=lnlinks href=#hl-122-238>238</a>
</span><span class=lnt id=hl-122-239><a class=lnlinks href=#hl-122-239>239</a>
</span><span class=lnt id=hl-122-240><a class=lnlinks href=#hl-122-240>240</a>
</span><span class=lnt id=hl-122-241><a class=lnlinks href=#hl-122-241>241</a>
</span><span class=lnt id=hl-122-242><a class=lnlinks href=#hl-122-242>242</a>
</span><span class=lnt id=hl-122-243><a class=lnlinks href=#hl-122-243>243</a>
</span><span class=lnt id=hl-122-244><a class=lnlinks href=#hl-122-244>244</a>
</span><span class=lnt id=hl-122-245><a class=lnlinks href=#hl-122-245>245</a>
</span><span class=lnt id=hl-122-246><a class=lnlinks href=#hl-122-246>246</a>
</span><span class=lnt id=hl-122-247><a class=lnlinks href=#hl-122-247>247</a>
</span><span class=lnt id=hl-122-248><a class=lnlinks href=#hl-122-248>248</a>
</span><span class=lnt id=hl-122-249><a class=lnlinks href=#hl-122-249>249</a>
</span><span class=lnt id=hl-122-250><a class=lnlinks href=#hl-122-250>250</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 이벤트 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>AccountCreated</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>initialBalance</span> <span class=o>=</span> <span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MoneyDeposited</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;MoneyDeposited&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MoneyWithdrawn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;MoneyWithdrawn&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 애그리게이트 루트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BankAccount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 생성 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=nx>create</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>AccountCreated</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 입금 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>deposit</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;입금액은 0보다 커야 합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>MoneyDeposited</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 출금 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;출금액은 0보다 커야 합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>&lt;</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;잔액이 부족합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>MoneyWithdrawn</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 적용
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyDeposited&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>+=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyWithdrawn&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 스트림에서 상태 재구성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=nx>fromHistory</span><span class=p>(</span><span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>events</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>account</span><span class=p>.</span><span class=nx>applyEventFromHistory</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>applyEventFromHistory</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyDeposited&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>+=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyWithdrawn&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 저장되지 않은 이벤트 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getUncommittedEvents</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 커밋 표시
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>markEventsAsCommitted</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 스토어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>EventStore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>events</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span> <span class=c1>// accountId -&gt; events[]
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>saveEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>events</span><span class=p>,</span> <span class=nx>expectedVersion</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>accountId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>existingEvents</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 동시성 제어 - 낙관적 잠금
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>existingEvents</span><span class=p>.</span><span class=nx>length</span> <span class=o>!==</span> <span class=nx>expectedVersion</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`동시성 충돌: 예상 버전 </span><span class=si>${</span><span class=nx>expectedVersion</span><span class=si>}</span><span class=sb>, 실제 버전 </span><span class=si>${</span><span class=nx>existingEvents</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>existingEvents</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=err>…</span><span class=nx>events</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 로드
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>accountId</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 특정 버전까지의 이벤트 로드
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getEventsUpToVersion</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>version</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>events</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>version</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 리포지터리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BankAccountRepository</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>eventStore</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventStore</span> <span class=o>=</span> <span class=nx>eventStore</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 로드
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventStore</span><span class=p>.</span><span class=nx>getEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>events</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>BankAccount</span><span class=p>.</span><span class=nx>fromHistory</span><span class=p>(</span><span class=nx>events</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>uncommittedEvents</span> <span class=o>=</span> <span class=nx>account</span><span class=p>.</span><span class=nx>getUncommittedEvents</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>uncommittedEvents</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>expectedVersion</span> <span class=o>=</span> <span class=nx>account</span><span class=p>.</span><span class=nx>version</span> <span class=o>-</span> <span class=nx>uncommittedEvents</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventStore</span><span class=p>.</span><span class=nx>saveEvents</span><span class=p>(</span><span class=nx>account</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>uncommittedEvents</span><span class=p>,</span> <span class=nx>expectedVersion</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>markEventsAsCommitted</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 처리기
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BankAccountCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>repository</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span> <span class=o>=</span> <span class=nx>repository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 생성 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>createAccount</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>existingAccount</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>existingAccount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;계좌가 이미 존재합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=nx>BankAccount</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 입금 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>deposit</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>account</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;계좌를 찾을 수 없습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>deposit</span><span class=p>(</span><span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 출금 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>withdraw</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>account</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;계좌를 찾을 수 없습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>eventStore</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventStore</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>repository</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccountRepository</span><span class=p>(</span><span class=nx>eventStore</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>commandHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccountCommandHandler</span><span class=p>(</span><span class=nx>repository</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 계좌 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>account1</span> <span class=o>=</span> <span class=nx>commandHandler</span><span class=p>.</span><span class=nx>createAccount</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`계좌 생성: </span><span class=si>${</span><span class=nx>account1</span><span class=p>.</span><span class=nx>accountId</span><span class=si>}</span><span class=sb>, 잔액: </span><span class=si>${</span><span class=nx>account1</span><span class=p>.</span><span class=nx>balance</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 입금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>deposit</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>,</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;500 입금 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 출금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>,</span> <span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;200 출금 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 현재 상태 조회
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>currentAccount</span> <span class=o>=</span> <span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`현재 잔액: </span><span class=si>${</span><span class=nx>currentAccount</span><span class=p>.</span><span class=nx>balance</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 히스토리 조회
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=nx>eventStore</span><span class=p>.</span><span class=nx>getEvents</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;이벤트 히스토리:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>events</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>event</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=sb>. </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=15-실무-적용-고려사항-및-최적화-권장-요약>15. 실무 적용 고려사항 및 최적화 권장 요약<a hidden class=anchor aria-hidden=true href=#15-실무-적용-고려사항-및-최적화-권장-요약>#</a></h2><ul><li><strong>적용 고려</strong>: 도메인 복잡도, 팀 역량, 감사지원 요구도 기반 적용 권장</li><li><strong>최적화 전략</strong>: Snapshot 도입, 이벤트(version) 전략, 도메인 이벤트 필터링</li><li><strong>운영 주의</strong>: 이벤트 모니터링, 재처리 환경, 이벤트 청소 정책 필수</li></ul><hr><h2 id=16-용어-정리>16. 용어 정리<a hidden class=anchor aria-hidden=true href=#16-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>개념</td><td>Event Store</td><td>불변한 이벤트 스트림을 순서대로 저장하는 저장소</td></tr><tr><td></td><td>Snapshot</td><td>이벤트 기반 상태 계산을 최적화하기 위한 중간 상태</td></tr><tr><td></td><td>Replay</td><td>저장된 이벤트들을 다시 실행하여 상태 재구성</td></tr><tr><td></td><td>Projection</td><td>이벤트 소비 후 읽기 모델로 변환하는 동작</td></tr><tr><td></td><td>Immutable Event</td><td>생성 후 변경되지 않는 상태 변경 이벤트</td></tr></tbody></table><h2 id=용어-정리-8>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-8>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>Event Store</td><td>이벤트가 지속화되는 추가 전용 데이터베이스로 시스템 기록의 권위 있는 소스</td></tr><tr><td></td><td>Aggregate Root</td><td>도메인 주도 설계에서 애그리게이트의 진입점 역할을 하는 엔터티</td></tr><tr><td></td><td>Projection</td><td>이벤트 스트림에서 파생된 읽기 전용 뷰 또는 상태 표현</td></tr><tr><td></td><td>Command Handler</td><td>비즈니스 명령을 처리하고 이벤트를 생성하는 컴포넌트</td></tr><tr><td><strong>기술 용어</strong></td><td>Event Replay</td><td>저장된 이벤트를 순서대로 재생하여 상태를 재구성하는 과정</td></tr><tr><td></td><td>Snapshot</td><td>특정 시점의 애그리게이트 상태를 저장한 것으로 성능 최적화에 사용</td></tr><tr><td></td><td>Upcasting</td><td>이전 버전의 이벤트를 새로운 스키마 버전으로 변환하는 과정</td></tr><tr><td></td><td>Idempotency</td><td>동일한 연산을 여러 번 수행해도 결과가 같음을 보장하는 속성</td></tr><tr><td><strong>패턴 용어</strong></td><td>Outbox Pattern</td><td>데이터베이스 변경과 메시지 발행의 원자성을 보장하는 패턴</td></tr><tr><td></td><td>Saga Pattern</td><td>분산 트랜잭션을 일련의 로컬 트랜잭션으로 분해하는 패턴</td></tr><tr><td></td><td>Eventually Consistent</td><td>시스템이 시간이 지나면서 결국 일관된 상태에 도달하는 일관성 모델</td></tr><tr><td></td><td>Stream Aggregation</td><td>이벤트 스트림에서 쓰기 모델의 현재 상태를 구축하는 과정</td></tr></tbody></table><hr><h2 id=참고-및-출처-8>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-8>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Event Sourcing pattern - Microsoft Azure Architecture Center</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS pattern - Microsoft Azure Architecture Center</a></li><li><a href=https://microservices.io/patterns/data/event-sourcing.html>Microservices Pattern: Event sourcing</a></li><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Event Sourcing - Martin Fowler</a></li><li><a href=https://www.kurrent.io/event-sourcing>Beginner&rsquo;s Guide to Event Sourcing - Kurrent</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>CQRS and Event Sourcing in Java - Baeldung</a></li><li><a href=https://www.geeksforgeeks.org/event-sourcing-pattern/>Event Sourcing Pattern - GeeksforGeeks</a></li><li><a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>Understanding Event Sourcing and CQRS Pattern - Mia-Platform</a></li><li><a href=https://blog.risingstack.com/event-sourcing-with-examples-node-js-at-scale/>Event Sourcing with Examples in Node.js - RisingStack</a></li><li><a href=https://edykim.com/ko/post/event-sourcing-implementing-eventsourcing-patterns-with-javascript/>이벤트 소싱 패턴 JavaScript로 구현하기 - edykim</a></li></ul><h2 id=17-참고-및-출처>17. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#17-참고-및-출처>#</a></h2><ul><li>Microservices.io, <em>Event Sourcing Pattern</em> (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view?utm_source=chatgpt.com" title="Materialized View pattern - Azure Architecture Center">docs.aws.amazon.com</a>, <a href="https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com" title="Snapshots in Event Sourcing - Kurrent">theserverside.com</a>, <a href="https://docs.confluent.io/platform/current/schema-registry/fundamentals/schema-evolution.html?utm_source=chatgpt.com" title="Schema Evolution and Compatibility for Schema Registry ...">event-driven.io</a>, <a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">microservices.io</a>, <a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">geeksforgeeks.org</a>, <a href="https://event-driven.io/en/mongodb_event_store/?utm_source=chatgpt.com" title="How to build MongoDB Event Store">upsolver.com</a>)</li><li>AWS Prescriptive Guidance, <em>Event Sourcing pattern</em> (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn">docs.aws.amazon.com</a>)</li><li>Red Hat, <em>Pros and Cons of Event Sourcing</em> (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">linkedin.com</a>)</li><li>StackOverflow, <em>Disadvantages of Event Sourcing</em></li><li>GeeksforGeeks, <em>Event Sourcing Pattern</em> (<a href="https://learn.microsoft.com/en-us/azure/event-grid/namespaces-cloud-events?utm_source=chatgpt.com" title="Event Grid Namespaces - support for CloudEvents schema">geeksforgeeks.org</a>)</li><li>Martin Fowler, <em>Event Sourcing</em> (<a href="https://docs.axoniq.io/axon-framework-reference/4.11/events/event-versioning/?utm_source=chatgpt.com" title="Event Versioning">microservices.io</a>)</li><li>Bemi Blog, <em>Event Sourcing is Hard</em> (<a href="https://kafka.apache.org/documentation/?utm_source=chatgpt.com" title="Kafka 4.0 Documentation">chriskiehl.com</a>)</li><li>Innovecs Blog, <em>Event Sourcing 101</em> (<a href="https://docs.confluent.io/kafka/design/delivery-semantics.html?utm_source=chatgpt.com" title="Message Delivery Guarantees for Apache Kafka">innovecs.com</a>)</li></ul><hr><h2 id=2-java--spring-boot--axon-framework>2. Java / Spring Boot + Axon Framework<a hidden class=anchor aria-hidden=true href=#2-java--spring-boot--axon-framework>#</a></h2><ul><li><p><strong>Axon 구성</strong>:</p><ul><li><code>@Aggregate</code>, <code>@CommandHandler</code>, <code>@EventSourcingHandler</code>, <code>@EventHandler</code> 등의 어노테이션 사용</li><li>EventStore는 JPA, MongoDB, Kafka 기반으로 설정 가능</li></ul></li><li><p><strong>도메인 모델</strong></p><ul><li><code>Aggregate</code> 클래스에서 <code>@CommandHandler</code> → do business logic → <code>apply()</code> event 호출</li></ul></li><li><p><strong>프로젝션(read model) 구성</strong>:</p><ul><li><code>@EventHandler</code> 클래스에서 <code>ReadRepository</code>에 쓰기</li><li><code>QueryGateway</code> 사용해 Query API 호출</li></ul></li><li><p><strong>Snapshot & 스케일링</strong></p><ul><li><code>@SnapshotTrigger</code> 사용 또는 Snapshot trigger policy 설정</li><li>Saga 패턴을 통한 비동기 장기 프로세스 관리</li></ul></li><li><p><strong>추가 기능</strong></p><ul><li>Event replay / reset via CLI</li><li>EventBus, Serializer, Metrics 자동 지원</li></ul></li></ul><hr><h2 id=3-nodejs--nestjs--typeorm--kafka>3. Node.js + NestJS + TypeORM + Kafka<a hidden class=anchor aria-hidden=true href=#3-nodejs--nestjs--typeorm--kafka>#</a></h2><ul><li><p><strong>Event Store 구현</strong></p><ul><li>Kafka 토픽 중심 저장: partition, offset 활용</li><li>관계형 DB 보조 store로 상태 저장 가능</li></ul></li><li><p><strong>도메인 / Command Handler</strong></p><ul><li>NestJS에서 <code>@CommandHandler()</code> 데코레이터 사용 + <code>CqrsModule</code></li><li><code>@EventPublisher()</code>로 publisher 주입</li></ul></li><li><p><strong>프로젝션</strong></p><ul><li><code>@EventsHandler()</code>에서 <code>ReadRepository.save()</code></li><li>TypeORM 리포지토리 기반 Read DB 테이블 업데이트</li></ul></li><li><p><strong>Snapshot</strong></p><ul><li>QoS 단위로 Kafka offset 관리 및 State 저장</li><li>Redis 등 외부 Key-Value store 활용</li></ul></li><li><p><strong>환경 설정</strong></p><ul><li>Nest Module 내 EventStore, CommandBus, EventBus 등록</li><li>ValidationPipe, Interceptor 통한 Idempotency/Retry 처리</li></ul></li></ul><hr><h2 id=-공통-적용-체크포인트>✅ 공통 적용 체크포인트<a hidden class=anchor aria-hidden=true href=#-공통-적용-체크포인트>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 불변성</td><td>스키마 변경 시 마이그레이션 필요</td><td>Version Field, Upcaster 적용</td></tr><tr><td>중복 처리</td><td>메시지 OO처리</td><td>Idempotent 핸들러 구현</td></tr><tr><td>일관성 보장</td><td>Write 모델/Read 모델 단일 원장 필요</td><td>Outbox 패턴 + 메시지 트랜잭션 구성</td></tr><tr><td>모니터링</td><td>이벤트 처리 흐름 추적 어려움</td><td>Lag, 처리율, 에러 메트릭 모니터링</td></tr><tr><td>장애 대응</td><td>메시지고립 및 장애 발생 가능</td><td>Dead-letter queue, 재시도 전략 구성</td></tr><tr><td>테스트 전략</td><td>CQRS 구조 분리로 테스트 케이스 증가</td><td>Core, Projection, Integration 테스트를 분리하여 구성</td></tr></tbody></table><hr><h3 id=-다음-단계-제안>🧭 다음 단계 제안<a hidden class=anchor aria-hidden=true href=#-다음-단계-제안>#</a></h3><ol><li><strong>고급 최적화 기법</strong> (snapshot 전략, 이벤트 압축, 멀티 테넌시 등)</li><li><strong>실무 도전 과제 심화</strong> (스키마 진화, 장애 대응, CI/CD 통합 전략)</li><li><strong>추가 코드 예시</strong>: Node.js 또는 Java 구현 샘플</li></ol><p>원하시는 항목을 지정해 주세요. 바로 이어서 정리해드리겠습니다!</p><p>다음은 <strong>고급 최적화 기법</strong> 및 <strong>실무에서 마주치는 도전 과제 심화 분석</strong>입니다.</p><hr><h2 id=1-고급-최적화-기법->1. 고급 최적화 기법 🌐<a hidden class=anchor aria-hidden=true href=#1-고급-최적화-기법->#</a></h2><h3 id=-snapshot-전략>• Snapshot 전략<a hidden class=anchor aria-hidden=true href=#-snapshot-전략>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 이벤트 재생 비용 절감 및 빠른 Aggregate 로딩</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>일정 이벤트 수(예: 500회)마다 <code>Snapshot</code> 저장</li><li>복구 시 마지막 Snapshot부터 이벤트 재생</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>비즈니스 중요한 시점 기준 스냅샷 생성</li><li>Snapshot 데이터 크기 최소화, 압축 저장</li></ul></li></ul><h3 id=-이벤트-압축-event-compression>• 이벤트 압축 (Event Compression)<a hidden class=anchor aria-hidden=true href=#-이벤트-압축-event-compression>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 유사 이벤트 병합으로 저장 공간 절감</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>중복/불필요 이벤트 탐지 및 주기적으로 축소</li><li>예: “Qty +5”, “Qty +3” → “Qty +8” 압축</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>도메인 의미 손상 안 되도록 이벤트 단위 유지</li><li>압축 주기 및 조건 조정 필요</li></ul></li></ul><h3 id=-이벤트-ttl--아카이빙>• 이벤트 TTL / 아카이빙<a hidden class=anchor aria-hidden=true href=#-이벤트-ttl--아카이빙>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 오래된 이벤트 관리 → 스토리지 비용 절감</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>TTL 설정 후 오래된 이벤트는 외부 저장소로 이동</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>아카이빙 정책 문서화, 복원 절차 포함</li><li>GDPR/법규 준수 여부 고려</li></ul></li></ul><h3 id=-멀티-테넌시-지원>• 멀티 테넌시 지원<a hidden class=anchor aria-hidden=true href=#-멀티-테넌시-지원>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: SaaS 환경에서 고객 격리 보장</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>네임스페이스별 이벤트 스트림 분리</li><li>테이블 파티셔닝 또는 토픽 분리 활용</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>추가 모니터링 처리량 분리</li><li>권한 경계(naming scope) 및 검증 로직 보강</li></ul></li></ul><h3 id=-백필링-backfilling>• 백필링 (Backfilling)<a hidden class=anchor aria-hidden=true href=#-백필링-backfilling>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 기존 이벤트로 오프라인 뷰 재생성, 코드 변경 영향 보강</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>버전 이벤트 upcasting + 롤백부터 신규 코드 반영 재연산</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>고가용성 환경에서 배칭 처리, pause & resume 기능 필요</li><li>모니터링 및 실패 시 재시도 메커니즘 구축</li></ul></li></ul><hr><hr><h2 id=3--요약-및-권장-가이드>3. ✅ 요약 및 권장 가이드<a hidden class=anchor aria-hidden=true href=#3--요약-및-권장-가이드>#</a></h2><ul><li><strong>최적화 전략</strong>: Snapshot + 이벤트 압축 + TTL 아카이빙 + 테넌시 분리 고려</li><li><strong>장애 대응</strong>: Dead-letter, Trace 모니터링, Outbox 트랜잭션 보강</li><li><strong>테스트 전략</strong>: 리그레션 방지 위한 E2E/Contract 테스트 구조화</li><li><strong>장기 운용 팁</strong>: 이벤트 스키마 진화 정책, 장애 자동 복구, 분산 tracing·metrics 구축</li></ul><hr><p>🎯 추가로 <strong>SAGA 패턴 통합</strong>, 특정 프레임워크 적용 코드 예시(.NET, NestJS), <strong>이벤트 기반 데이터 모델링 전략</strong>, 또는 <strong>보안/가버넌스 구축</strong>이 필요하시면 언제든지 요청해주세요!</p><p>이벤트 기반(Event-Driven) 아키텍처에서의 <strong>데이터 모델링 전략</strong>은 전통적인 CRUD 모델링과 달리 <strong>도메인 이벤트 중심</strong>으로 설계됩니다. 아래는 이벤트 기반 모델링 시 고려할 전략들을 실무 중심으로 정리한 내용입니다.</p><hr><h2 id=1-이벤트-기반-데이터-모델링의-핵심-원칙>1. 이벤트 기반 데이터 모델링의 핵심 원칙<a hidden class=anchor aria-hidden=true href=#1-이벤트-기반-데이터-모델링의-핵심-원칙>#</a></h2><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>도메인 중심</td><td>도메인 이벤트(Domain Events)를 기준으로 상태 전이 모델링</td></tr><tr><td>불변성</td><td>이벤트는 변경 불가(immutable) 데이터로 유지</td></tr><tr><td>비정규화</td><td>조회 성능 중심의 Projection 모델 설계 (Read Model)</td></tr><tr><td>일관성 지연</td><td>일관성(consistency)은 즉시가 아닌 이벤트에 의해 Eventually Consistent</td></tr><tr><td>책임 분리</td><td>Command 모델과 Query 모델을 명확히 분리 (CQRS)</td></tr></tbody></table><hr><h2 id=2-모델링-접근-방법>2. 모델링 접근 방법<a hidden class=anchor aria-hidden=true href=#2-모델링-접근-방법>#</a></h2><h3 id=--aggregate-중심-설계>🧩 ① Aggregate 중심 설계<a hidden class=anchor aria-hidden=true href=#--aggregate-중심-설계>#</a></h3><ul><li>한 트랜잭션 내 상태 변경의 단위를 Aggregate 단위로 정의</li><li>상태 변경은 Command → Event → Aggregate 상태 반영 흐름</li></ul><h3 id=--이벤트-유형-정의>🧾 ② 이벤트 유형 정의<a hidden class=anchor aria-hidden=true href=#--이벤트-유형-정의>#</a></h3><ul><li><code>OrderPlaced</code>, <code>PaymentCompleted</code>, <code>InventoryDecreased</code> 등 도메인 상태 전이에 기반한 이벤트 정의</li><li>Event는 과거형으로 명명</li></ul><h3 id=--event-sourcing-기반-상태-재생>🗃️ ③ Event Sourcing 기반 상태 재생<a hidden class=anchor aria-hidden=true href=#--event-sourcing-기반-상태-재생>#</a></h3><ul><li>Entity 상태를 DB에 저장하지 않고 이벤트 스트림 기반으로 복원</li><li>변경 상태 = 이전 상태 + 이벤트 집합</li></ul><h3 id=--projection-모델링-read-model>🗂️ ④ Projection 모델링 (Read Model)<a hidden class=anchor aria-hidden=true href=#--projection-모델링-read-model>#</a></h3><ul><li>각 View 목적에 맞게 다수의 Projection 테이블 설계</li><li>예: <code>CustomerView</code>, <code>OrderSummaryView</code>, <code>PaymentStatsView</code> 등</li></ul><h3 id=--이벤트-스키마-설계>🏷️ ⑤ 이벤트 스키마 설계<a hidden class=anchor aria-hidden=true href=#--이벤트-스키마-설계>#</a></h3><ul><li>이벤트 버전 관리 필수 (<code>event_type</code>, <code>version</code>, <code>timestamp</code>, <code>correlation_id</code> 등)</li><li>JSON 기반의 schema registry(예: Apache Avro, Protobuf) 활용 권장</li></ul><hr><h2 id=3-모델링-예시--쇼핑몰-주문>3. 모델링 예시 – 쇼핑몰 주문<a hidden class=anchor aria-hidden=true href=#3-모델링-예시--쇼핑몰-주문>#</a></h2><h3 id=-도메인-이벤트-예시>▶ 도메인 이벤트 예시<a hidden class=anchor aria-hidden=true href=#-도메인-이벤트-예시>#</a></h3><table><thead><tr><th>이벤트명</th><th>속성 예시</th></tr></thead><tbody><tr><td><code>OrderCreated</code></td><td>order_id, user_id, items, total_price, timestamp</td></tr><tr><td><code>OrderPaid</code></td><td>order_id, payment_id, method, amount, timestamp</td></tr><tr><td><code>OrderShipped</code></td><td>order_id, tracking_number, carrier, timestamp</td></tr></tbody></table><h3 id=-aggregate-상태-재생-event-sourcing-기반>▶ Aggregate 상태 재생 (Event Sourcing 기반)<a hidden class=anchor aria-hidden=true href=#-aggregate-상태-재생-event-sourcing-기반>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-123-1><a class=lnlinks href=#hl-123-1> 1</a>
</span><span class=lnt id=hl-123-2><a class=lnlinks href=#hl-123-2> 2</a>
</span><span class=lnt id=hl-123-3><a class=lnlinks href=#hl-123-3> 3</a>
</span><span class=lnt id=hl-123-4><a class=lnlinks href=#hl-123-4> 4</a>
</span><span class=lnt id=hl-123-5><a class=lnlinks href=#hl-123-5> 5</a>
</span><span class=lnt id=hl-123-6><a class=lnlinks href=#hl-123-6> 6</a>
</span><span class=lnt id=hl-123-7><a class=lnlinks href=#hl-123-7> 7</a>
</span><span class=lnt id=hl-123-8><a class=lnlinks href=#hl-123-8> 8</a>
</span><span class=lnt id=hl-123-9><a class=lnlinks href=#hl-123-9> 9</a>
</span><span class=lnt id=hl-123-10><a class=lnlinks href=#hl-123-10>10</a>
</span><span class=lnt id=hl-123-11><a class=lnlinks href=#hl-123-11>11</a>
</span><span class=lnt id=hl-123-12><a class=lnlinks href=#hl-123-12>12</a>
</span><span class=lnt id=hl-123-13><a class=lnlinks href=#hl-123-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderAggregate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderCreated</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;CREATED&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderPaid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;PAID&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderShipped</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;SHIPPED&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-projection-설계>▶ Projection 설계<a hidden class=anchor aria-hidden=true href=#-projection-설계>#</a></h3><table><thead><tr><th>Projection Name</th><th>필드 구성</th><th>목적</th></tr></thead><tbody><tr><td><code>OrderSummaryView</code></td><td>order_id, user_id, status, total_price</td><td>사용자 주문 조회용</td></tr><tr><td><code>OrderStatusStats</code></td><td>status, count</td><td>관리자 대시보드 통계</td></tr></tbody></table><hr><h2 id=4-모델링-시-고려사항>4. 모델링 시 고려사항<a hidden class=anchor aria-hidden=true href=#4-모델링-시-고려사항>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 정합성</td><td>이벤트 순서에 따라 상태 달라짐</td><td>Event ordering 보장 (Kafka partition key 기준)</td></tr><tr><td>이벤트 버전</td><td>구조 변경 시 호환성 유지</td><td>Event upcasting 전략, schema registry 도입</td></tr><tr><td>조회 최적화</td><td>Projection은 뷰 최적화 목적</td><td>Index, denormalization, TTL 고려</td></tr><tr><td>GDPR 대응</td><td>이벤트 로그에서 민감 정보 처리</td><td>암호화/익명화, soft delete 이벤트 발행</td></tr><tr><td>오류 복구</td><td>Projection 재생 지원</td><td>이벤트 replay 기능 및 checkpoint 저장</td></tr></tbody></table><hr><h2 id=5-추천-도구-및-기술>5. 추천 도구 및 기술<a hidden class=anchor aria-hidden=true href=#5-추천-도구-및-기술>#</a></h2><table><thead><tr><th>카테고리</th><th>도구 / 기술</th><th>설명</th></tr></thead><tbody><tr><td>Event Store</td><td>EventStoreDB, Kafka, Axon, Marten</td><td>도메인 이벤트 저장소</td></tr><tr><td>Query DB</td><td>Elasticsearch, Redis, PostgreSQL</td><td>Projection 용 Read DB</td></tr><tr><td>Schema 관리</td><td>Avro, Protobuf, AsyncAPI</td><td>이벤트 스키마 정의 및 버전 관리</td></tr><tr><td>프레임워크</td><td>Axon (Java), Eventuous (.NET), NestJS CQRS</td><td>이벤트 기반 설계 지원</td></tr></tbody></table><hr><h2 id=-요약>✅ 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h2><p>이벤트 기반 데이터 모델링은 이벤트가 곧 데이터의 원천(Log-as-source)이며, 모델은 불변성, 도메인 중심, 읽기/쓰기 책임 분리를 핵심 원칙으로 합니다. 이를 통해 확장성과 추적성을 확보할 수 있지만, 이벤트 순서, 스키마 관리, 비동기 처리 등의 복잡성이 증가하므로 구조적 설계가 필수입니다.</p><hr><h1 id=event-sourcing-분석-보고서>Event Sourcing 분석 보고서<a hidden class=anchor aria-hidden=true href=#event-sourcing-분석-보고서>#</a></h1><h2 id=1-태그-3>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-3>#</a></h2><p><strong>Event-Sourcing</strong>, <strong>CQRS-Pattern</strong>, <strong>Data-Management</strong>, <strong>Architecture-Pattern</strong></p><h2 id=2-주제-분류-분석>2. 주제 분류 분석<a hidden class=anchor aria-hidden=true href=#2-주제-분류-분석>#</a></h2><p><strong>지정된 카테고리</strong>: &ldquo;Computer Science and Engineering&rdquo; > &ldquo;Software Engineering&rdquo; > &ldquo;Design and Architecture&rdquo; > &ldquo;Architecture Styles and Patterns&rdquo; > &ldquo;Architecture Patterns&rdquo; > &ldquo;Data Management&rdquo;</p><p><strong>분석 결과</strong>: Event Sourcing은 애플리케이션 상태를 처리하는 데이터 중심 아키텍처 패턴으로, CRUD 모델과는 다른 접근 방식을 취합니다. 제시된 카테고리 계층 구조는 적절하며, 특히 &ldquo;Data Management&rdquo; 하위에 위치하는 것이 타당합니다. Event Sourcing은 비즈니스 엔터티의 상태를 상태 변경 이벤트의 시퀀스로 지속화하는 데이터 관리 패턴이기 때문입니다.</p><h2 id=3-요약-문장-200자-내외-1>3. 요약 문장 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-문장-200자-내외-1>#</a></h2><p>Event Sourcing은 애플리케이션의 모든 상태 변경을 불변의 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 현재 상태를 직접 저장하는 대신 이벤트를 재생하여 상태를 재구성하며, 완전한 감사 추적과 시간 기반 쿼리를 제공하여 복잡한 비즈니스 시스템과 분산 아키텍처에 적합합니다.</p><h2 id=4-전체-개요-250자-내외-1>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외-1>#</a></h2><p>Event Sourcing은 애플리케이션 상태의 모든 변경사항을 이벤트 시퀀스로 저장하는 패턴으로, 전통적인 CRUD 방식과 달리 상태 변경의 전체 이력을 보존합니다. CQRS와 함께 사용되어 읽기와 쓰기 모델을 분리하며, 마이크로서비스 아키텍처에서 데이터 일관성과 확장성을 제공합니다. 금융, 전자상거래, 물류 등 다양한 도메인에서 활용되어 감사 추적, 디버깅, 상태 복구 등의 강력한 기능을 제공합니다.</p><hr><h2 id=5-핵심-개념-2>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-2>#</a></h2><h3 id=기본-개념-1>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념-1>#</a></h3><ul><li><strong>이벤트 (Event)</strong>: 과거에 발생한 상태 변경을 나타내는 불변의 팩트</li><li><strong>이벤트 스토어 (Event Store)</strong>: 이벤트가 지속화되는 추가 전용 저장소로 시스템 기록의 권위 있는 데이터 소스 역할</li><li><strong>애그리게이트 (Aggregate)</strong>: 단일 세밀한 이벤트 스트림에서 재구성되는 도메인 주도 설계의 일관성 경계</li><li><strong>프로젝션 (Projection)</strong>: 이벤트 스트림에서 파생된 현재 상태에 대한 답변으로, 읽기 모델 구성에 사용</li></ul><h3 id=실무-구현-요소>실무 구현 요소<a hidden class=anchor aria-hidden=true href=#실무-구현-요소>#</a></h3><ul><li><strong>이벤트 스키마 설계</strong>: 이벤트 구조와 버전 관리</li><li><strong>스냅샷 (Snapshot)</strong>: 정기적인 간격으로 데이터의 스냅샷을 구현하여 성능 향상</li><li><strong>이벤트 핸들러</strong>: 이벤트를 처리하고 프로젝션을 업데이트하는 컴포넌트</li><li><strong>명령 처리</strong>: 도메인 로직을 통한 이벤트 생성</li><li><strong>동시성 제어</strong>: 이벤트 순서와 일관성 보장 메커니즘</li></ul><hr><h2 id=제1부-이론적-기초>제1부: 이론적 기초<a hidden class=anchor aria-hidden=true href=#제1부-이론적-기초>#</a></h2><h2 id=배경-2>배경<a hidden class=anchor aria-hidden=true href=#배경-2>#</a></h2><p>Event Sourcing은 1970년대와 80년대 데이터베이스 변경 로그와 메시지 기반 아키텍처에서 뿌리를 찾을 수 있지만, Eric Evans의 Domain-Driven Design(2003)과 Greg Young의 영향력 있는 강연을 통해 엔터프라이즈 소프트웨어 패턴으로 공식화되었습니다.</p><h2 id=목적-및-필요성-2>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성-2>#</a></h2><ol><li><strong>완전한 감사 추적</strong>: 시스템에서 발생한 모든 변경사항의 불변 기록 구축</li><li><strong>시간 기반 쿼리</strong>: 어떤 시점에서든 엔터티의 상태를 결정하는 시간적 쿼리 구현 가능</li><li><strong>복잡한 비즈니스 로직 지원</strong>: 변경 기록, 감사 가능성 또는 복잡한 비즈니스 로직이 요구사항을 주도하는 도메인에 적합</li><li><strong>분산 시스템 일관성</strong>: 느슨하게 결합된 비즈니스 엔터티 간 이벤트 교환을 통한 마이크로서비스 아키텍처 지원</li></ol><h2 id=주요-기능-및-역할-1>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할-1>#</a></h2><ul><li><strong>상태 재구성</strong>: 이벤트 재생을 통한 현재 상태 복원</li><li><strong>이벤트 발행</strong>: 다른 시스템에 상태 변경 알림</li><li><strong>시간 여행</strong>: 과거 특정 시점의 상태 조회</li><li><strong>디버깅 지원</strong>: 상태 변경 과정 추적 및 분석</li></ul><h2 id=특징-2>특징<a hidden class=anchor aria-hidden=true href=#특징-2>#</a></h2><ol><li><strong>불변성</strong>: 모든 이벤트는 불변이며 추가 전용 방식으로 저장</li><li><strong>순차성</strong>: 이벤트는 발생 순서대로 저장</li><li><strong>원자성</strong>: 이벤트 저장은 단일 연산으로 본질적으로 원자적</li><li><strong>재생 가능성</strong>: 언제든지 이벤트를 재생하여 상태 복원 가능</li></ol><h2 id=핵심-원칙-2>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙-2>#</a></h2><ol><li><strong>이벤트를 사실로 취급</strong>: 이벤트는 발생한 사실의 기록</li><li><strong>추가 전용 저장</strong>: 기존 데이터 수정이나 삭제 금지</li><li><strong>순서 보장</strong>: 이벤트 발생 순서 유지</li><li><strong>단일 소스 진실</strong>: 이벤트 스토어가 유일한 진실의 원천</li></ol><h2 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h2><pre class=mermaid>graph TD
    A[Command] --&gt; B[Aggregate]
    B --&gt; C[Event Generated]
    C --&gt; D[Event Store]
    D --&gt; E[Event Handler]
    E --&gt; F[Projection Update]
    D --&gt; G[Event Replay]
    G --&gt; H[State Reconstruction]
</pre><p><strong>작동 원리</strong>:</p><ol><li><strong>명령 처리</strong>: 애플리케이션 코드가 객체에 대해 수행된 작업을 명령적으로 설명하는 이벤트를 발생</li><li><strong>이벤트 저장</strong>: 생성된 이벤트를 추가 전용 이벤트 스토어에 저장</li><li><strong>이벤트 발행</strong>: 이벤트 핸들러가 관심 있는 이벤트를 수신하고 적절한 작업 수행</li><li><strong>상태 재구성</strong>: 필요 시 이벤트 재생을 통해 현재 상태 복원</li></ol><hr><h2 id=제2부-구조-및-구현>제2부: 구조 및 구현<a hidden class=anchor aria-hidden=true href=#제2부-구조-및-구현>#</a></h2><h2 id=구조-및-아키텍처-1>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처-1>#</a></h2><pre class=mermaid>graph TB
    subgraph &#34;Command Side (Write Model)&#34;
        A[Command Handler] --&gt; B[Aggregate]
        B --&gt; C[Domain Events]
        C --&gt; D[Event Store]
    end
    
    subgraph &#34;Query Side (Read Model)&#34;
        E[Event Handlers] --&gt; F[Projections]
        F --&gt; G[Read Database]
    end
    
    D --&gt; E
    D --&gt; H[Event Bus]
    H --&gt; I[External Systems]
    
    subgraph &#34;Supporting Components&#34;
        J[Snapshots]
        K[Event Schemas]
        L[Version Management]
    end
    
    D -.-&gt; J
    C -.-&gt; K
    K -.-&gt; L
</pre><h3 id=필수-구성요소-1>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소-1>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>이벤트 스토어</strong></td><td>이벤트 지속화</td><td>시스템 기록의 권위 있는 데이터 소스 역할</td><td>추가 전용, 순서 보장</td></tr><tr><td><strong>애그리게이트</strong></td><td>비즈니스 로직 처리</td><td>명령 검증 및 이벤트 생성</td><td>일관성 경계 제공</td></tr><tr><td><strong>이벤트</strong></td><td>상태 변경 기록</td><td>시스템의 각 변경 사항을 개별 이벤트로 문서화</td><td>불변, 순차 저장</td></tr><tr><td><strong>이벤트 핸들러</strong></td><td>이벤트 처리</td><td>프로젝션 업데이트 및 부가 작업</td><td>비동기 처리</td></tr></tbody></table><h3 id=선택-구성요소-1>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소-1>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>스냅샷</strong></td><td>성능 최적화</td><td>정기적 간격으로 데이터 스냅샷 구현</td><td>재구성 성능 향상</td></tr><tr><td><strong>이벤트 버스</strong></td><td>이벤트 발행</td><td>외부 시스템 알림</td><td>느슨한 결합 제공</td></tr><tr><td><strong>CQRS 구현</strong></td><td>읽기/쓰기 분리</td><td>명령과 쿼리 책임 분리</td><td>성능 최적화</td></tr></tbody></table><hr><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>