<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>API key authentication | hyunyoun's Blog</title><meta name=keywords content="Backend Development,API-Design-and-Implementation,API-Authentication-Methods,API-key-authentication"><meta name=description content="API 키는 API에 접근하려는 클라이언트를 식별하고 인증하는 데 사용되는 고유한 문자열"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/api-key-authentication/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/api-key-authentication/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/api-key-authentication/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/api-key-authentication/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="API key authentication"><meta property="og:description" content="API 키는 API에 접근하려는 클라이언트를 식별하고 인증하는 데 사용되는 고유한 문자열"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="API key authentication"><meta name=twitter:description content="API 키는 API에 접근하려는 클라이언트를 식별하고 인증하는 데 사용되는 고유한 문자열"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 블로그","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":""},{"@type":"ListItem","position":3,"name":"Application Development","item":""},{"@type":"ListItem","position":4,"name":"Backend Development","item":"https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/"},{"@type":"ListItem","position":5,"name":"Security","item":"https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/"},{"@type":"ListItem","position":6,"name":"API Authentication and Authorization","item":""},{"@type":"ListItem","position":7,"name":"Authentication Methods","item":"https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/"},{"@type":"ListItem","position":8,"name":"API key authentication","item":"https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/api-key-authentication/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기술 블로그</a>&nbsp;»&nbsp;<a href>Software Engineering</a>&nbsp;»&nbsp;<a href>Application Development</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/>Backend Development</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/>Security</a>&nbsp;»&nbsp;<a href>API Authentication and Authorization</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/application-development/backend-development/backend-security/authentication-and-authorization/authentication-methods/>Authentication Methods</a></div><h1>API key authentication</h1><div class=post-description>API 키는 API에 접근하려는 클라이언트를 식별하고 인증하는 데 사용되는 고유한 문자열</div></header><div class=post-content><h2 id=api-key-authentication>API key authentication<a hidden class=anchor aria-hidden=true href=#api-key-authentication>#</a></h2><p>API 키와 API 관리는 현대 소프트웨어 아키텍처의 핵심 요소로, 조직이 디지털 자산을 안전하게 공유하고 모니터링하는 데 필수적이다.</p><h3 id=api-키의-이해>API 키의 이해<a hidden class=anchor aria-hidden=true href=#api-키의-이해>#</a></h3><h4 id=api-키의-정의와-목적>API 키의 정의와 목적<a hidden class=anchor aria-hidden=true href=#api-키의-정의와-목적>#</a></h4><p>API 키는 API에 접근하려는 클라이언트를 식별하고 인증하는 데 사용되는 고유한 문자열이다.</p><p>주요 목적은 다음과 같다:</p><ul><li><strong>인증(Authentication)</strong>: 요청자가 누구인지 확인</li><li><strong>권한 부여(Authorization)</strong>: 요청자가 특정 리소스에 접근할 권한이 있는지 확인</li><li><strong>사용량 추적</strong>: 각 클라이언트의 API 사용량 모니터링</li><li><strong>속도 제한(Rate Limiting)</strong>: 단일 클라이언트의 과도한 요청 방지</li><li><strong>오용 방지</strong>: 무단 접근 및 악의적인 사용 차단</li></ul><h4 id=api-키의-구조와-형식>API 키의 구조와 형식<a hidden class=anchor aria-hidden=true href=#api-키의-구조와-형식>#</a></h4><p>일반적인 API 키는 다음과 같은 특성을 갖는다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>api_key: &#34;[YOUR_API_KEY]&#34;
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>길이</strong>: 보통 32~128자 사이의 길이</li><li><strong>랜덤성</strong>: 예측 불가능한 난수로 생성</li><li><strong>형식</strong>: Base64 인코딩된 문자열, 16진수 문자열, UUID 등 다양한 형식 사용</li><li><strong>접두사</strong>: 종종 환경(prod_, test_)이나 목적(read_, write_)을 나타내는 접두사 포함</li></ul><h4 id=api-키-전송-방법>API 키 전송 방법<a hidden class=anchor aria-hidden=true href=#api-키-전송-방법>#</a></h4><p>API 키를 클라이언트에서 서버로 전송하는 방법에는 여러 가지가 있다:</p><ol><li><p><strong>쿼리 파라미터로 전송</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET https://api.example.com/data?api_key=YOUR_API_KEY
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>HTTP 헤더로 전송</strong> (권장):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET https://api.example.com/data
</span></span><span class=line><span class=cl>X-API-Key: YOUR_API_KEY
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>사용자 정의 헤더로 전송</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET https://api.example.com/data
</span></span><span class=line><span class=cl>Authorization: ApiKey YOUR_API_KEY
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Bearer 토큰으로 전송</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET https://api.example.com/data
</span></span><span class=line><span class=cl>Authorization: Bearer YOUR_API_KEY
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=api-키의-장단점>API 키의 장단점<a hidden class=anchor aria-hidden=true href=#api-키의-장단점>#</a></h4><p><strong>장점</strong>:</p><ul><li>구현이 간단하고 이해하기 쉬움</li><li>클라이언트 애플리케이션 추적에 효과적</li><li>사용량 제한과 모니터링에 적합</li><li>다양한 인증 시스템과 통합 가능</li></ul><p><strong>단점</strong>:</p><ul><li>정적 키는 탈취 위험이 있음</li><li>키만으로는 사용자 수준의 세분화된 권한 관리가 어려움</li><li>HTTPS를 사용하지 않으면 중간자 공격에 취약</li><li>키 순환(교체) 메커니즘이 없으면 보안 위험 증가</li></ul><h3 id=api-키-관리-모범-사례>API 키 관리 모범 사례<a hidden class=anchor aria-hidden=true href=#api-키-관리-모범-사례>#</a></h3><h4 id=api-키-생성-및-배포>API 키 생성 및 배포<a hidden class=anchor aria-hidden=true href=#api-키-생성-및-배포>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python으로 구현한 API 키 생성 예시</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>secrets</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_api_key</span><span class=p>(</span><span class=n>client_id</span><span class=p>,</span> <span class=n>prefix</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;안전한 API 키 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 랜덤 바이트 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>random_bytes</span> <span class=o>=</span> <span class=n>secrets</span><span class=o>.</span><span class=n>token_bytes</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 타임스탬프 추가</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 클라이언트 ID 해싱</span>
</span></span><span class=line><span class=cl>    <span class=n>client_hash</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>client_id</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 요소 결합</span>
</span></span><span class=line><span class=cl>    <span class=n>key_material</span> <span class=o>=</span> <span class=n>random_bytes</span> <span class=o>+</span> <span class=n>timestamp</span> <span class=o>+</span> <span class=n>client_hash</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Base64로 인코딩하고 URL 안전하게 만듦</span>
</span></span><span class=line><span class=cl>    <span class=n>encoded_key</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>urlsafe_b64encode</span><span class=p>(</span><span class=n>key_material</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 접두사 추가 (예: 환경 또는 권한 수준)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>prefix</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encoded_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>encoded_key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>encoded_key</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>모범 사례</strong>:</p><ul><li>충분히 긴 키 사용 (최소 32바이트)</li><li>암호학적으로 안전한 난수 생성기 사용</li><li>키에 용도 또는 환경을 나타내는 접두사 추가</li><li>안전한 채널(HTTPS, 암호화된 이메일 등)을 통해 배포</li><li>주기적으로 키 순환(rotation) 메커니즘 구현</li></ul><h4 id=api-키-저장>API 키 저장<a hidden class=anchor aria-hidden=true href=#api-키-저장>#</a></h4><p><strong>클라이언트 측 저장</strong>:</p><ul><li>모바일/데스크톱 앱: 안전한 키체인/키스토어 활용</li><li>웹 앱: 환경 변수 또는 서버 측 저장소 사용</li><li>절대 소스 코드나 버전 관리 시스템에 키를 저장하지 말 것</li></ul><p><strong>서버 측 저장</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 서버에 API 키를 저장하는 예시 (Node.js/MongoDB)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>mongoose</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mongoose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bcrypt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bcrypt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>apiKeySchema</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>clientId</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>apiKey</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 해싱된 키 값을 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>apiKeyHash</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>scopes</span><span class=o>:</span> <span class=p>[</span><span class=nb>String</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>createdAt</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Date</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>expiresAt</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Date</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>lastUsed</span><span class=o>:</span> <span class=nb>Date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>rateLimit</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>requests</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=mi>1000</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>perTimeWindow</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=mi>3600</span> <span class=p>}</span> <span class=c1>// 초 단위
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 키를 해시하여 저장
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>apiKeySchema</span><span class=p>.</span><span class=nx>pre</span><span class=p>(</span><span class=s1>&#39;save&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=kd>function</span><span class=p>(</span><span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isModified</span><span class=p>(</span><span class=s1>&#39;apiKey&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>apiKeyHash</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>hash</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>apiKey</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 저장 후에는 원본 키를 데이터베이스에서 제거
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 이것은 해시 값만 데이터베이스에 유지하기 위한 것
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>apiKey</span> <span class=o>=</span> <span class=kc>undefined</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 키 검증 메서드
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>apiKeySchema</span><span class=p>.</span><span class=nx>methods</span><span class=p>.</span><span class=nx>verifyKey</span> <span class=o>=</span> <span class=kr>async</span> <span class=kd>function</span><span class=p>(</span><span class=nx>providedKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>compare</span><span class=p>(</span><span class=nx>providedKey</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>apiKeyHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ApiKey</span> <span class=o>=</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>model</span><span class=p>(</span><span class=s1>&#39;ApiKey&#39;</span><span class=p>,</span> <span class=nx>apiKeySchema</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>모범 사례</strong>:</p><ul><li>데이터베이스에 원본 키 대신 해시 값 저장</li><li>키와 함께 메타데이터(생성일, 만료일, 권한 범위 등) 저장</li><li>정기적으로 사용되지 않는 키 감사 및 취소</li><li>데이터베이스 암호화로 추가 보호 계층 제공</li></ul><h4 id=api-키-검증-및-처리>API 키 검증 및 처리<a hidden class=anchor aria-hidden=true href=#api-키-검증-및-처리>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33>33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34>34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35>35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36>36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37>37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38>38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39>39</a>
</span><span class=lnt id=hl-7-40><a class=lnlinks href=#hl-7-40>40</a>
</span><span class=lnt id=hl-7-41><a class=lnlinks href=#hl-7-41>41</a>
</span><span class=lnt id=hl-7-42><a class=lnlinks href=#hl-7-42>42</a>
</span><span class=lnt id=hl-7-43><a class=lnlinks href=#hl-7-43>43</a>
</span><span class=lnt id=hl-7-44><a class=lnlinks href=#hl-7-44>44</a>
</span><span class=lnt id=hl-7-45><a class=lnlinks href=#hl-7-45>45</a>
</span><span class=lnt id=hl-7-46><a class=lnlinks href=#hl-7-46>46</a>
</span><span class=lnt id=hl-7-47><a class=lnlinks href=#hl-7-47>47</a>
</span><span class=lnt id=hl-7-48><a class=lnlinks href=#hl-7-48>48</a>
</span><span class=lnt id=hl-7-49><a class=lnlinks href=#hl-7-49>49</a>
</span><span class=lnt id=hl-7-50><a class=lnlinks href=#hl-7-50>50</a>
</span><span class=lnt id=hl-7-51><a class=lnlinks href=#hl-7-51>51</a>
</span><span class=lnt id=hl-7-52><a class=lnlinks href=#hl-7-52>52</a>
</span><span class=lnt id=hl-7-53><a class=lnlinks href=#hl-7-53>53</a>
</span><span class=lnt id=hl-7-54><a class=lnlinks href=#hl-7-54>54</a>
</span><span class=lnt id=hl-7-55><a class=lnlinks href=#hl-7-55>55</a>
</span><span class=lnt id=hl-7-56><a class=lnlinks href=#hl-7-56>56</a>
</span><span class=lnt id=hl-7-57><a class=lnlinks href=#hl-7-57>57</a>
</span><span class=lnt id=hl-7-58><a class=lnlinks href=#hl-7-58>58</a>
</span><span class=lnt id=hl-7-59><a class=lnlinks href=#hl-7-59>59</a>
</span><span class=lnt id=hl-7-60><a class=lnlinks href=#hl-7-60>60</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Flask에서 API 키 검증 미들웨어 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>wraps</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>require_api_key</span><span class=p>(</span><span class=n>f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@wraps</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decorated_function</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>api_key</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-API-Key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>api_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;API 키가 제공되지 않았습니다&#34;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 데이터베이스에서 키 검증</span>
</span></span><span class=line><span class=cl>        <span class=n>key_data</span> <span class=o>=</span> <span class=n>validate_key_from_db</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>key_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;유효하지 않은 API 키&#34;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 키가 만료되었는지 확인</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>key_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;expires_at&#39;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>key_data</span><span class=p>[</span><span class=s1>&#39;expires_at&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;API 키가 만료되었습니다&#34;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 속도 제한 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>rate_limit_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;rate_limit:</span><span class=si>{</span><span class=n>api_key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_count</span> <span class=o>=</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>rate_limit_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_count</span> <span class=ow>and</span> <span class=nb>int</span><span class=p>(</span><span class=n>current_count</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>key_data</span><span class=p>[</span><span class=s1>&#39;rate_limit&#39;</span><span class=p>][</span><span class=s1>&#39;requests&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;속도 제한 초과&#34;</span><span class=p>}),</span> <span class=mi>429</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 요청 카운터 증가</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>current_count</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>rate_limit_key</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                              <span class=n>key_data</span><span class=p>[</span><span class=s1>&#39;rate_limit&#39;</span><span class=p>][</span><span class=s1>&#39;per_time_window&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                              <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>redis_client</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=n>rate_limit_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># API 키 사용 로그 기록</span>
</span></span><span class=line><span class=cl>        <span class=n>log_api_key_usage</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 요청 객체에 클라이언트 정보 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>client_id</span> <span class=o>=</span> <span class=n>key_data</span><span class=p>[</span><span class=s1>&#39;client_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>api_key_scopes</span> <span class=o>=</span> <span class=n>key_data</span><span class=p>[</span><span class=s1>&#39;scopes&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decorated_function</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/api/data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@require_api_key</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># API 키 범위(scopes) 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;read:data&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>api_key_scopes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;권한 부족&#34;</span><span class=p>}),</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># API 엔드포인트 로직</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=s2>&#34;요청한 데이터&#34;</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>모범 사례</strong>:</p><ul><li>모든 API 요청에서 키 유효성 검사</li><li>캐싱을 통한 검증 성능 최적화</li><li>적절한 HTTP 상태 코드 반환 (401 인증 오류, 403 권한 오류)</li><li>실패한 인증 시도 로깅 및 모니터링</li><li>의심스러운 활동 감지 시 자동 알림 설정</li></ul><h4 id=api-키-취소-및-갱신>API 키 취소 및 갱신<a hidden class=anchor aria-hidden=true href=#api-키-취소-및-갱신>#</a></h4><p>API 키 취소와 갱신을 위한 명확한 프로세스를 구현하는 것이 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63>63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64>64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65>65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66>66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67>67</a>
</span><span class=lnt id=hl-8-68><a class=lnlinks href=#hl-8-68>68</a>
</span><span class=lnt id=hl-8-69><a class=lnlinks href=#hl-8-69>69</a>
</span><span class=lnt id=hl-8-70><a class=lnlinks href=#hl-8-70>70</a>
</span><span class=lnt id=hl-8-71><a class=lnlinks href=#hl-8-71>71</a>
</span><span class=lnt id=hl-8-72><a class=lnlinks href=#hl-8-72>72</a>
</span><span class=lnt id=hl-8-73><a class=lnlinks href=#hl-8-73>73</a>
</span><span class=lnt id=hl-8-74><a class=lnlinks href=#hl-8-74>74</a>
</span><span class=lnt id=hl-8-75><a class=lnlinks href=#hl-8-75>75</a>
</span><span class=lnt id=hl-8-76><a class=lnlinks href=#hl-8-76>76</a>
</span><span class=lnt id=hl-8-77><a class=lnlinks href=#hl-8-77>77</a>
</span><span class=lnt id=hl-8-78><a class=lnlinks href=#hl-8-78>78</a>
</span><span class=lnt id=hl-8-79><a class=lnlinks href=#hl-8-79>79</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Express.js에서 API 키 취소 및 갱신 API 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 키 취소
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api-keys/:id/revoke&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>id</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 키 소유권 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>apiKey</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ApiKey</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>apiKey</span> <span class=o>||</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>userId</span> <span class=o>!==</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;키를 찾을 수 없음&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 키 취소 (즉시 또는 마감일 설정)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>apiKey</span><span class=p>.</span><span class=nx>revokedAt</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiKey</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;revoked&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 취소된 키 캐시 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>updateRevokedKeysCache</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;API 키가 성공적으로 취소되었습니다&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;API 키 취소 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;내부 서버 오류&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 키 갱신
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api-keys/:id/refresh&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>id</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 키 소유권 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>apiKey</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ApiKey</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>apiKey</span> <span class=o>||</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>userId</span> <span class=o>!==</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;키를 찾을 수 없음&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>apiKey</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;revoked&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;취소된 키는 갱신할 수 없습니다&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 새 키 생성 및 기존 키 마킹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>newKey</span> <span class=o>=</span> <span class=nx>generateApiKey</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>prefix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 기존 키를 취소하고 새 키 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>apiKey</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;replaced&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiKey</span><span class=p>.</span><span class=nx>replacedBy</span> <span class=o>=</span> <span class=nx>newKey</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 유예 기간 설정 (이전 키가 일정 기간 동안 계속 작동)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>graceEnd</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>graceEnd</span><span class=p>.</span><span class=nx>setDate</span><span class=p>(</span><span class=nx>graceEnd</span><span class=p>.</span><span class=nx>getDate</span><span class=p>()</span> <span class=o>+</span> <span class=mi>30</span><span class=p>);</span> <span class=c1>// 30일 유예 기간
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>ApiKey</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>_id</span><span class=o>:</span> <span class=nx>newKey</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=nx>newKey</span><span class=p>.</span><span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>keyHash</span><span class=o>:</span> <span class=kr>await</span> <span class=nx>hashKey</span><span class=p>(</span><span class=nx>newKey</span><span class=p>.</span><span class=nx>key</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>userId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>prefix</span><span class=o>:</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>prefix</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>scopes</span><span class=o>:</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>scopes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>expiresAt</span><span class=o>:</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>expiresAt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>replacesKey</span><span class=o>:</span> <span class=nx>apiKey</span><span class=p>.</span><span class=nx>_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>graceEnd</span><span class=o>:</span> <span class=nx>graceEnd</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;새 API 키가 생성되었습니다&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>newKey</span><span class=o>:</span> <span class=nx>newKey</span><span class=p>.</span><span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>graceEnd</span><span class=o>:</span> <span class=nx>graceEnd</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;API 키 갱신 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;내부 서버 오류&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>모범 사례</strong>:</p><ul><li>자동 만료 메커니즘 구현</li><li>기존 키를 즉시 취소하는 기능 제공</li><li>키 갱신 시 유예 기간 설정으로 서비스 중단 방지</li><li>주기적인 강제 키 순환 정책 시행</li><li>취소된 키 목록을 캐시하여 빠른 검증</li></ul><h3 id=api-관리-시스템의-이해>API 관리 시스템의 이해<a hidden class=anchor aria-hidden=true href=#api-관리-시스템의-이해>#</a></h3><h4 id=api-관리-시스템의-정의와-기능>API 관리 시스템의 정의와 기능<a hidden class=anchor aria-hidden=true href=#api-관리-시스템의-정의와-기능>#</a></h4><p>API 관리 시스템은 API의 전체 수명 주기를 관리하는 플랫폼으로, 다음과 같은 기능을 제공한다:</p><ul><li><strong>개발자 포털</strong>: API 문서, 샘플 코드, 테스트 콘솔 제공</li><li><strong>게이트웨이</strong>: API 트래픽 라우팅, 보안, 변환 처리</li><li><strong>분석 및 모니터링</strong>: API 사용량, 성능, 오류 추적</li><li><strong>정책 관리</strong>: 보안, 속도 제한, 캐싱 정책 적용</li><li><strong>버전 관리</strong>: API 버전 간의 변경 사항 처리</li><li><strong>수익화</strong>: API 사용에 대한 과금 및 요금제 관리</li></ul><h4 id=주요-api-관리-솔루션-비교>주요 API 관리 솔루션 비교<a hidden class=anchor aria-hidden=true href=#주요-api-관리-솔루션-비교>#</a></h4><p>현재 시장에는 다양한 API 관리 솔루션이 있다:</p><ol><li><strong>클라우드 제공업체 솔루션</strong>:<ul><li><strong>AWS API Gateway</strong>: AWS 서비스와의 원활한 통합</li><li><strong>Google Cloud Apigee</strong>: 고급 분석 및 AI 기능</li><li><strong>Azure API Management</strong>: Microsoft 생태계와의 통합</li></ul></li><li><strong>오픈소스 솔루션</strong>:<ul><li><strong>Kong</strong>: 고성능 API 게이트웨이</li><li><strong>Tyk</strong>: 완전한 오픈소스 API 관리 플랫폼</li><li><strong>3scale (Red Hat)</strong>: 하이브리드 클라우드 환경에 적합</li></ul></li><li><strong>독립 솔루션</strong>:<ul><li><strong>MuleSoft</strong>: 기업 통합 기능이 강화된 API 관리</li><li><strong>Postman</strong>: API 개발 및 테스트 중심</li><li><strong>Kong Enterprise</strong>: 엔터프라이즈급 보안 및 관리 기능</li></ul></li></ol><h4 id=api-게이트웨이-구현>API 게이트웨이 구현<a hidden class=anchor aria-hidden=true href=#api-게이트웨이-구현>#</a></h4><p>API 게이트웨이는 API 관리의 핵심 구성 요소로, 다음과 같은 기능을 수행한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>  1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>  2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>  3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>  4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>  5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>  6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7>  7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8>  8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9>  9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10> 10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11> 11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12> 12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13> 13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14> 14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15> 15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16> 16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17> 17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18> 18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19> 19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20> 20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21> 21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22> 22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23> 23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24> 24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25> 25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26> 26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27> 27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28> 28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29> 29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30> 30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31> 31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32> 32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33> 33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34> 34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35> 35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36> 36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37> 37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38> 38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39> 39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40> 40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41> 41</a>
</span><span class=lnt id=hl-9-42><a class=lnlinks href=#hl-9-42> 42</a>
</span><span class=lnt id=hl-9-43><a class=lnlinks href=#hl-9-43> 43</a>
</span><span class=lnt id=hl-9-44><a class=lnlinks href=#hl-9-44> 44</a>
</span><span class=lnt id=hl-9-45><a class=lnlinks href=#hl-9-45> 45</a>
</span><span class=lnt id=hl-9-46><a class=lnlinks href=#hl-9-46> 46</a>
</span><span class=lnt id=hl-9-47><a class=lnlinks href=#hl-9-47> 47</a>
</span><span class=lnt id=hl-9-48><a class=lnlinks href=#hl-9-48> 48</a>
</span><span class=lnt id=hl-9-49><a class=lnlinks href=#hl-9-49> 49</a>
</span><span class=lnt id=hl-9-50><a class=lnlinks href=#hl-9-50> 50</a>
</span><span class=lnt id=hl-9-51><a class=lnlinks href=#hl-9-51> 51</a>
</span><span class=lnt id=hl-9-52><a class=lnlinks href=#hl-9-52> 52</a>
</span><span class=lnt id=hl-9-53><a class=lnlinks href=#hl-9-53> 53</a>
</span><span class=lnt id=hl-9-54><a class=lnlinks href=#hl-9-54> 54</a>
</span><span class=lnt id=hl-9-55><a class=lnlinks href=#hl-9-55> 55</a>
</span><span class=lnt id=hl-9-56><a class=lnlinks href=#hl-9-56> 56</a>
</span><span class=lnt id=hl-9-57><a class=lnlinks href=#hl-9-57> 57</a>
</span><span class=lnt id=hl-9-58><a class=lnlinks href=#hl-9-58> 58</a>
</span><span class=lnt id=hl-9-59><a class=lnlinks href=#hl-9-59> 59</a>
</span><span class=lnt id=hl-9-60><a class=lnlinks href=#hl-9-60> 60</a>
</span><span class=lnt id=hl-9-61><a class=lnlinks href=#hl-9-61> 61</a>
</span><span class=lnt id=hl-9-62><a class=lnlinks href=#hl-9-62> 62</a>
</span><span class=lnt id=hl-9-63><a class=lnlinks href=#hl-9-63> 63</a>
</span><span class=lnt id=hl-9-64><a class=lnlinks href=#hl-9-64> 64</a>
</span><span class=lnt id=hl-9-65><a class=lnlinks href=#hl-9-65> 65</a>
</span><span class=lnt id=hl-9-66><a class=lnlinks href=#hl-9-66> 66</a>
</span><span class=lnt id=hl-9-67><a class=lnlinks href=#hl-9-67> 67</a>
</span><span class=lnt id=hl-9-68><a class=lnlinks href=#hl-9-68> 68</a>
</span><span class=lnt id=hl-9-69><a class=lnlinks href=#hl-9-69> 69</a>
</span><span class=lnt id=hl-9-70><a class=lnlinks href=#hl-9-70> 70</a>
</span><span class=lnt id=hl-9-71><a class=lnlinks href=#hl-9-71> 71</a>
</span><span class=lnt id=hl-9-72><a class=lnlinks href=#hl-9-72> 72</a>
</span><span class=lnt id=hl-9-73><a class=lnlinks href=#hl-9-73> 73</a>
</span><span class=lnt id=hl-9-74><a class=lnlinks href=#hl-9-74> 74</a>
</span><span class=lnt id=hl-9-75><a class=lnlinks href=#hl-9-75> 75</a>
</span><span class=lnt id=hl-9-76><a class=lnlinks href=#hl-9-76> 76</a>
</span><span class=lnt id=hl-9-77><a class=lnlinks href=#hl-9-77> 77</a>
</span><span class=lnt id=hl-9-78><a class=lnlinks href=#hl-9-78> 78</a>
</span><span class=lnt id=hl-9-79><a class=lnlinks href=#hl-9-79> 79</a>
</span><span class=lnt id=hl-9-80><a class=lnlinks href=#hl-9-80> 80</a>
</span><span class=lnt id=hl-9-81><a class=lnlinks href=#hl-9-81> 81</a>
</span><span class=lnt id=hl-9-82><a class=lnlinks href=#hl-9-82> 82</a>
</span><span class=lnt id=hl-9-83><a class=lnlinks href=#hl-9-83> 83</a>
</span><span class=lnt id=hl-9-84><a class=lnlinks href=#hl-9-84> 84</a>
</span><span class=lnt id=hl-9-85><a class=lnlinks href=#hl-9-85> 85</a>
</span><span class=lnt id=hl-9-86><a class=lnlinks href=#hl-9-86> 86</a>
</span><span class=lnt id=hl-9-87><a class=lnlinks href=#hl-9-87> 87</a>
</span><span class=lnt id=hl-9-88><a class=lnlinks href=#hl-9-88> 88</a>
</span><span class=lnt id=hl-9-89><a class=lnlinks href=#hl-9-89> 89</a>
</span><span class=lnt id=hl-9-90><a class=lnlinks href=#hl-9-90> 90</a>
</span><span class=lnt id=hl-9-91><a class=lnlinks href=#hl-9-91> 91</a>
</span><span class=lnt id=hl-9-92><a class=lnlinks href=#hl-9-92> 92</a>
</span><span class=lnt id=hl-9-93><a class=lnlinks href=#hl-9-93> 93</a>
</span><span class=lnt id=hl-9-94><a class=lnlinks href=#hl-9-94> 94</a>
</span><span class=lnt id=hl-9-95><a class=lnlinks href=#hl-9-95> 95</a>
</span><span class=lnt id=hl-9-96><a class=lnlinks href=#hl-9-96> 96</a>
</span><span class=lnt id=hl-9-97><a class=lnlinks href=#hl-9-97> 97</a>
</span><span class=lnt id=hl-9-98><a class=lnlinks href=#hl-9-98> 98</a>
</span><span class=lnt id=hl-9-99><a class=lnlinks href=#hl-9-99> 99</a>
</span><span class=lnt id=hl-9-100><a class=lnlinks href=#hl-9-100>100</a>
</span><span class=lnt id=hl-9-101><a class=lnlinks href=#hl-9-101>101</a>
</span><span class=lnt id=hl-9-102><a class=lnlinks href=#hl-9-102>102</a>
</span><span class=lnt id=hl-9-103><a class=lnlinks href=#hl-9-103>103</a>
</span><span class=lnt id=hl-9-104><a class=lnlinks href=#hl-9-104>104</a>
</span><span class=lnt id=hl-9-105><a class=lnlinks href=#hl-9-105>105</a>
</span><span class=lnt id=hl-9-106><a class=lnlinks href=#hl-9-106>106</a>
</span><span class=lnt id=hl-9-107><a class=lnlinks href=#hl-9-107>107</a>
</span><span class=lnt id=hl-9-108><a class=lnlinks href=#hl-9-108>108</a>
</span><span class=lnt id=hl-9-109><a class=lnlinks href=#hl-9-109>109</a>
</span><span class=lnt id=hl-9-110><a class=lnlinks href=#hl-9-110>110</a>
</span><span class=lnt id=hl-9-111><a class=lnlinks href=#hl-9-111>111</a>
</span><span class=lnt id=hl-9-112><a class=lnlinks href=#hl-9-112>112</a>
</span><span class=lnt id=hl-9-113><a class=lnlinks href=#hl-9-113>113</a>
</span><span class=lnt id=hl-9-114><a class=lnlinks href=#hl-9-114>114</a>
</span><span class=lnt id=hl-9-115><a class=lnlinks href=#hl-9-115>115</a>
</span><span class=lnt id=hl-9-116><a class=lnlinks href=#hl-9-116>116</a>
</span><span class=lnt id=hl-9-117><a class=lnlinks href=#hl-9-117>117</a>
</span><span class=lnt id=hl-9-118><a class=lnlinks href=#hl-9-118>118</a>
</span><span class=lnt id=hl-9-119><a class=lnlinks href=#hl-9-119>119</a>
</span><span class=lnt id=hl-9-120><a class=lnlinks href=#hl-9-120>120</a>
</span><span class=lnt id=hl-9-121><a class=lnlinks href=#hl-9-121>121</a>
</span><span class=lnt id=hl-9-122><a class=lnlinks href=#hl-9-122>122</a>
</span><span class=lnt id=hl-9-123><a class=lnlinks href=#hl-9-123>123</a>
</span><span class=lnt id=hl-9-124><a class=lnlinks href=#hl-9-124>124</a>
</span><span class=lnt id=hl-9-125><a class=lnlinks href=#hl-9-125>125</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js Express로 구현한 간단한 API 게이트웨이 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>rateLimit</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express-rate-limit&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>createProxyMiddleware</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http-proxy-middleware&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 키 인증 미들웨어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>apiKeyAuth</span> <span class=o>=</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>apiKey</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;x-api-key&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>apiKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;API 키가 필요합니다&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// API 키 검증 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>validateApiKey</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>keyData</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>keyData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;유효하지 않은 API 키&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>req</span><span class=p>.</span><span class=nx>clientId</span> <span class=o>=</span> <span class=nx>keyData</span><span class=p>.</span><span class=nx>clientId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>req</span><span class=p>.</span><span class=nx>scopes</span> <span class=o>=</span> <span class=nx>keyData</span><span class=p>.</span><span class=nx>scopes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;API 키 검증 오류:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;내부 서버 오류&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// JWT 인증 미들웨어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>jwtAuth</span> <span class=o>=</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>authHeader</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>authHeader</span> <span class=o>||</span> <span class=o>!</span><span class=nx>authHeader</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;Bearer &#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;유효한 JWT가 필요합니다&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>authHeader</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>decoded</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>token</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>req</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>decoded</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;유효하지 않은 토큰&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 속도 제한 미들웨어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>apiLimiter</span> <span class=o>=</span> <span class=nx>rateLimit</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>windowMs</span><span class=o>:</span> <span class=mi>15</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 15분
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>max</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span> <span class=c1>// IP당 최대 요청 수
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>standardHeaders</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>message</span><span class=o>:</span> <span class=p>{</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;너무 많은 요청, 나중에 다시 시도하세요&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 로깅 미들웨어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>loggingMiddleware</span> <span class=o>=</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>start</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;finish&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>duration</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>method</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>originalUrl</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>duration</span><span class=si>}</span><span class=sb>ms`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 상세 로그 기록
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>logApiCall</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>clientId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>clientId</span> <span class=o>||</span> <span class=s1>&#39;anonymous&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>endpoint</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>originalUrl</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>responseTime</span><span class=o>:</span> <span class=nx>duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 미들웨어 적용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>loggingMiddleware</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>apiLimiter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용자 서비스 라우팅
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/api/users&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>apiKeyAuth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>createProxyMiddleware</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=o>:</span> <span class=s1>&#39;http://user-service:3001&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>changeOrigin</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pathRewrite</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;^/api/users&#39;</span><span class=o>:</span> <span class=s1>&#39;/users&#39;</span> <span class=c1>// 경로 재작성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 결제 서비스 라우팅 (JWT 인증 필요)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/api/payments&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>jwtAuth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>createProxyMiddleware</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=o>:</span> <span class=s1>&#39;http://payment-service:3002&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>changeOrigin</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pathRewrite</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;^/api/payments&#39;</span><span class=o>:</span> <span class=s1>&#39;/payments&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 공개 서비스 라우팅 (인증 필요 없음)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/api/public&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>createProxyMiddleware</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=o>:</span> <span class=s1>&#39;http://public-service:3003&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>changeOrigin</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pathRewrite</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;^/api/public&#39;</span><span class=o>:</span> <span class=s1>&#39;/public&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`API 게이트웨이가 포트 </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>에서 실행 중입니다`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=개발자-포털-구축>개발자 포털 구축<a hidden class=anchor aria-hidden=true href=#개발자-포털-구축>#</a></h4><p>개발자 포털은 API 소비자가 API를 발견, 이해, 테스트할 수 있는 핵심 인터페이스이다:</p><p><strong>주요 구성 요소</strong>:</p><ul><li><strong>API 문서</strong>: OpenAPI(Swagger)를 활용한 대화형 문서</li><li><strong>샌드박스 환경</strong>: 실시간 API 테스트를 위한 콘솔</li><li><strong>코드 샘플</strong>: 다양한 언어로 작성된 구현 예시</li><li><strong>API 키 관리</strong>: 자가 서비스 키 생성 및 관리</li><li><strong>사용량 대시보드</strong>: API 호출 및 할당량 모니터링</li><li><strong>지원 리소스</strong>: 튜토리얼, FAQ, 지원 채널</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>  1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>  2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>  3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>  4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>  5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>  6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>  7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8>  8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9>  9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10> 10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11> 11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12> 12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13> 13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14> 14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15> 15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16> 16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17> 17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18> 18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19> 19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20> 20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21> 21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22> 22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23> 23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24> 24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25> 25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26> 26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27> 27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28> 28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29> 29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30> 30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31> 31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32> 32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33> 33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34> 34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35> 35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36> 36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37> 37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38> 38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39> 39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40> 40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41> 41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42> 42</a>
</span><span class=lnt id=hl-10-43><a class=lnlinks href=#hl-10-43> 43</a>
</span><span class=lnt id=hl-10-44><a class=lnlinks href=#hl-10-44> 44</a>
</span><span class=lnt id=hl-10-45><a class=lnlinks href=#hl-10-45> 45</a>
</span><span class=lnt id=hl-10-46><a class=lnlinks href=#hl-10-46> 46</a>
</span><span class=lnt id=hl-10-47><a class=lnlinks href=#hl-10-47> 47</a>
</span><span class=lnt id=hl-10-48><a class=lnlinks href=#hl-10-48> 48</a>
</span><span class=lnt id=hl-10-49><a class=lnlinks href=#hl-10-49> 49</a>
</span><span class=lnt id=hl-10-50><a class=lnlinks href=#hl-10-50> 50</a>
</span><span class=lnt id=hl-10-51><a class=lnlinks href=#hl-10-51> 51</a>
</span><span class=lnt id=hl-10-52><a class=lnlinks href=#hl-10-52> 52</a>
</span><span class=lnt id=hl-10-53><a class=lnlinks href=#hl-10-53> 53</a>
</span><span class=lnt id=hl-10-54><a class=lnlinks href=#hl-10-54> 54</a>
</span><span class=lnt id=hl-10-55><a class=lnlinks href=#hl-10-55> 55</a>
</span><span class=lnt id=hl-10-56><a class=lnlinks href=#hl-10-56> 56</a>
</span><span class=lnt id=hl-10-57><a class=lnlinks href=#hl-10-57> 57</a>
</span><span class=lnt id=hl-10-58><a class=lnlinks href=#hl-10-58> 58</a>
</span><span class=lnt id=hl-10-59><a class=lnlinks href=#hl-10-59> 59</a>
</span><span class=lnt id=hl-10-60><a class=lnlinks href=#hl-10-60> 60</a>
</span><span class=lnt id=hl-10-61><a class=lnlinks href=#hl-10-61> 61</a>
</span><span class=lnt id=hl-10-62><a class=lnlinks href=#hl-10-62> 62</a>
</span><span class=lnt id=hl-10-63><a class=lnlinks href=#hl-10-63> 63</a>
</span><span class=lnt id=hl-10-64><a class=lnlinks href=#hl-10-64> 64</a>
</span><span class=lnt id=hl-10-65><a class=lnlinks href=#hl-10-65> 65</a>
</span><span class=lnt id=hl-10-66><a class=lnlinks href=#hl-10-66> 66</a>
</span><span class=lnt id=hl-10-67><a class=lnlinks href=#hl-10-67> 67</a>
</span><span class=lnt id=hl-10-68><a class=lnlinks href=#hl-10-68> 68</a>
</span><span class=lnt id=hl-10-69><a class=lnlinks href=#hl-10-69> 69</a>
</span><span class=lnt id=hl-10-70><a class=lnlinks href=#hl-10-70> 70</a>
</span><span class=lnt id=hl-10-71><a class=lnlinks href=#hl-10-71> 71</a>
</span><span class=lnt id=hl-10-72><a class=lnlinks href=#hl-10-72> 72</a>
</span><span class=lnt id=hl-10-73><a class=lnlinks href=#hl-10-73> 73</a>
</span><span class=lnt id=hl-10-74><a class=lnlinks href=#hl-10-74> 74</a>
</span><span class=lnt id=hl-10-75><a class=lnlinks href=#hl-10-75> 75</a>
</span><span class=lnt id=hl-10-76><a class=lnlinks href=#hl-10-76> 76</a>
</span><span class=lnt id=hl-10-77><a class=lnlinks href=#hl-10-77> 77</a>
</span><span class=lnt id=hl-10-78><a class=lnlinks href=#hl-10-78> 78</a>
</span><span class=lnt id=hl-10-79><a class=lnlinks href=#hl-10-79> 79</a>
</span><span class=lnt id=hl-10-80><a class=lnlinks href=#hl-10-80> 80</a>
</span><span class=lnt id=hl-10-81><a class=lnlinks href=#hl-10-81> 81</a>
</span><span class=lnt id=hl-10-82><a class=lnlinks href=#hl-10-82> 82</a>
</span><span class=lnt id=hl-10-83><a class=lnlinks href=#hl-10-83> 83</a>
</span><span class=lnt id=hl-10-84><a class=lnlinks href=#hl-10-84> 84</a>
</span><span class=lnt id=hl-10-85><a class=lnlinks href=#hl-10-85> 85</a>
</span><span class=lnt id=hl-10-86><a class=lnlinks href=#hl-10-86> 86</a>
</span><span class=lnt id=hl-10-87><a class=lnlinks href=#hl-10-87> 87</a>
</span><span class=lnt id=hl-10-88><a class=lnlinks href=#hl-10-88> 88</a>
</span><span class=lnt id=hl-10-89><a class=lnlinks href=#hl-10-89> 89</a>
</span><span class=lnt id=hl-10-90><a class=lnlinks href=#hl-10-90> 90</a>
</span><span class=lnt id=hl-10-91><a class=lnlinks href=#hl-10-91> 91</a>
</span><span class=lnt id=hl-10-92><a class=lnlinks href=#hl-10-92> 92</a>
</span><span class=lnt id=hl-10-93><a class=lnlinks href=#hl-10-93> 93</a>
</span><span class=lnt id=hl-10-94><a class=lnlinks href=#hl-10-94> 94</a>
</span><span class=lnt id=hl-10-95><a class=lnlinks href=#hl-10-95> 95</a>
</span><span class=lnt id=hl-10-96><a class=lnlinks href=#hl-10-96> 96</a>
</span><span class=lnt id=hl-10-97><a class=lnlinks href=#hl-10-97> 97</a>
</span><span class=lnt id=hl-10-98><a class=lnlinks href=#hl-10-98> 98</a>
</span><span class=lnt id=hl-10-99><a class=lnlinks href=#hl-10-99> 99</a>
</span><span class=lnt id=hl-10-100><a class=lnlinks href=#hl-10-100>100</a>
</span><span class=lnt id=hl-10-101><a class=lnlinks href=#hl-10-101>101</a>
</span><span class=lnt id=hl-10-102><a class=lnlinks href=#hl-10-102>102</a>
</span><span class=lnt id=hl-10-103><a class=lnlinks href=#hl-10-103>103</a>
</span><span class=lnt id=hl-10-104><a class=lnlinks href=#hl-10-104>104</a>
</span><span class=lnt id=hl-10-105><a class=lnlinks href=#hl-10-105>105</a>
</span><span class=lnt id=hl-10-106><a class=lnlinks href=#hl-10-106>106</a>
</span><span class=lnt id=hl-10-107><a class=lnlinks href=#hl-10-107>107</a>
</span><span class=lnt id=hl-10-108><a class=lnlinks href=#hl-10-108>108</a>
</span><span class=lnt id=hl-10-109><a class=lnlinks href=#hl-10-109>109</a>
</span><span class=lnt id=hl-10-110><a class=lnlinks href=#hl-10-110>110</a>
</span><span class=lnt id=hl-10-111><a class=lnlinks href=#hl-10-111>111</a>
</span><span class=lnt id=hl-10-112><a class=lnlinks href=#hl-10-112>112</a>
</span><span class=lnt id=hl-10-113><a class=lnlinks href=#hl-10-113>113</a>
</span><span class=lnt id=hl-10-114><a class=lnlinks href=#hl-10-114>114</a>
</span><span class=lnt id=hl-10-115><a class=lnlinks href=#hl-10-115>115</a>
</span><span class=lnt id=hl-10-116><a class=lnlinks href=#hl-10-116>116</a>
</span><span class=lnt id=hl-10-117><a class=lnlinks href=#hl-10-117>117</a>
</span><span class=lnt id=hl-10-118><a class=lnlinks href=#hl-10-118>118</a>
</span><span class=lnt id=hl-10-119><a class=lnlinks href=#hl-10-119>119</a>
</span><span class=lnt id=hl-10-120><a class=lnlinks href=#hl-10-120>120</a>
</span><span class=lnt id=hl-10-121><a class=lnlinks href=#hl-10-121>121</a>
</span><span class=lnt id=hl-10-122><a class=lnlinks href=#hl-10-122>122</a>
</span><span class=lnt id=hl-10-123><a class=lnlinks href=#hl-10-123>123</a>
</span><span class=lnt id=hl-10-124><a class=lnlinks href=#hl-10-124>124</a>
</span><span class=lnt id=hl-10-125><a class=lnlinks href=#hl-10-125>125</a>
</span><span class=lnt id=hl-10-126><a class=lnlinks href=#hl-10-126>126</a>
</span><span class=lnt id=hl-10-127><a class=lnlinks href=#hl-10-127>127</a>
</span><span class=lnt id=hl-10-128><a class=lnlinks href=#hl-10-128>128</a>
</span><span class=lnt id=hl-10-129><a class=lnlinks href=#hl-10-129>129</a>
</span><span class=lnt id=hl-10-130><a class=lnlinks href=#hl-10-130>130</a>
</span><span class=lnt id=hl-10-131><a class=lnlinks href=#hl-10-131>131</a>
</span><span class=lnt id=hl-10-132><a class=lnlinks href=#hl-10-132>132</a>
</span><span class=lnt id=hl-10-133><a class=lnlinks href=#hl-10-133>133</a>
</span><span class=lnt id=hl-10-134><a class=lnlinks href=#hl-10-134>134</a>
</span><span class=lnt id=hl-10-135><a class=lnlinks href=#hl-10-135>135</a>
</span><span class=lnt id=hl-10-136><a class=lnlinks href=#hl-10-136>136</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- 개발자 포털 API 키 관리 인터페이스 예시 (React 컴포넌트) --&gt;</span>
</span></span><span class=line><span class=cl>function ApiKeyManagement() {
</span></span><span class=line><span class=cl>  const [apiKeys, setApiKeys] = useState([]);
</span></span><span class=line><span class=cl>  const [loading, setLoading] = useState(true);
</span></span><span class=line><span class=cl>  const [error, setError] = useState(null);
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  useEffect(() =&gt; {
</span></span><span class=line><span class=cl>    fetchApiKeys();
</span></span><span class=line><span class=cl>  }, []);
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  const fetchApiKeys = async () =&gt; {
</span></span><span class=line><span class=cl>    try {
</span></span><span class=line><span class=cl>      setLoading(true);
</span></span><span class=line><span class=cl>      const response = await fetch(&#39;/api/developer/keys&#39;, {
</span></span><span class=line><span class=cl>        headers: {
</span></span><span class=line><span class=cl>          &#39;Authorization&#39;: `Bearer ${getAccessToken()}`
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>      });
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      if (!response.ok) {
</span></span><span class=line><span class=cl>        throw new Error(&#39;API 키를 가져오는 데 실패했습니다&#39;);
</span></span><span class=line><span class=cl>      }
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      const data = await response.json();
</span></span><span class=line><span class=cl>      setApiKeys(data.keys);
</span></span><span class=line><span class=cl>    } catch (err) {
</span></span><span class=line><span class=cl>      setError(err.message);
</span></span><span class=line><span class=cl>    } finally {
</span></span><span class=line><span class=cl>      setLoading(false);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  };
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  const createNewKey = async () =&gt; {
</span></span><span class=line><span class=cl>    try {
</span></span><span class=line><span class=cl>      const response = await fetch(&#39;/api/developer/keys&#39;, {
</span></span><span class=line><span class=cl>        method: &#39;POST&#39;,
</span></span><span class=line><span class=cl>        headers: {
</span></span><span class=line><span class=cl>          &#39;Authorization&#39;: `Bearer ${getAccessToken()}`,
</span></span><span class=line><span class=cl>          &#39;Content-Type&#39;: &#39;application/json&#39;
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        body: JSON.stringify({
</span></span><span class=line><span class=cl>          name: &#39;New API Key&#39;,
</span></span><span class=line><span class=cl>          scopes: [&#39;read:users&#39;, &#39;write:users&#39;]
</span></span><span class=line><span class=cl>        })
</span></span><span class=line><span class=cl>      });
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      if (!response.ok) {
</span></span><span class=line><span class=cl>        throw new Error(&#39;새 키 생성에 실패했습니다&#39;);
</span></span><span class=line><span class=cl>      }
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      const data = await response.json();
</span></span><span class=line><span class=cl>      alert(`새 API 키가 생성되었습니다: ${data.key}\n이 키는 다시 표시되지 않으므로 안전한 곳에 보관하세요.`);
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      fetchApiKeys();
</span></span><span class=line><span class=cl>    } catch (err) {
</span></span><span class=line><span class=cl>      setError(err.message);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  };
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  const revokeKey = async (keyId) =&gt; {
</span></span><span class=line><span class=cl>    if (!confirm(&#39;이 API 키를 취소하시겠습니까? 이 작업은 되돌릴 수 없습니다.&#39;)) {
</span></span><span class=line><span class=cl>      return;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    try {
</span></span><span class=line><span class=cl>      const response = await fetch(`/api/developer/keys/${keyId}/revoke`, {
</span></span><span class=line><span class=cl>        method: &#39;POST&#39;,
</span></span><span class=line><span class=cl>        headers: {
</span></span><span class=line><span class=cl>          &#39;Authorization&#39;: `Bearer ${getAccessToken()}`
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>      });
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      if (!response.ok) {
</span></span><span class=line><span class=cl>        throw new Error(&#39;키 취소에 실패했습니다&#39;);
</span></span><span class=line><span class=cl>      }
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      fetchApiKeys();
</span></span><span class=line><span class=cl>    } catch (err) {
</span></span><span class=line><span class=cl>      setError(err.message);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  };
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  if (loading) return <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>로딩 중…<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>;
</span></span><span class=line><span class=cl>  if (error) return <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>오류: {error}<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>;
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  return (
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;api-keys-container&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span>API 키 관리<span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=s>{createNewKey}</span><span class=p>&gt;</span>새 API 키 생성<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>table</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;api-keys-table&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>thead</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>이름<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>접두사<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>생성일<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>마지막 사용<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>상태<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>작업<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>thead</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>tbody</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          {apiKeys.map(key =&gt; (
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>tr</span> <span class=na>key</span><span class=o>=</span><span class=s>{key.id}</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>{key.name}<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>{key.prefix}…<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>{new Date(key.createdAt).toLocaleDateString()}<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>{key.lastUsed ? new Date(key.lastUsed).toLocaleDateString() : &#39;미사용&#39;}<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>{`status-badge</span> <span class=err>${</span><span class=na>key</span><span class=err>.</span><span class=na>status</span><span class=err>}`}</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  {key.status}
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                {key.status === &#39;active&#39; <span class=err>&amp;&amp;</span> (
</span></span><span class=line><span class=cl>                  <span class=err>&lt;</span>&gt;
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=s>{()</span> <span class=err>=</span><span class=p>&gt;</span> revokeKey(key.id)}&gt;취소<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=s>{()</span> <span class=err>=</span><span class=p>&gt;</span> refreshKey(key.id)}&gt;갱신<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=err>&lt;</span>/&gt;
</span></span><span class=line><span class=cl>                )}
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          ))}
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>tbody</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>table</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;api-usage&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>API 사용량<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>이번 달 API 호출: {usage.currentMonth}<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>할당량: {usage.quota}<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>progress</span> <span class=na>value</span><span class=o>=</span><span class=s>{usage.currentMonth}</span> <span class=na>max</span><span class=o>=</span><span class=s>{usage.quota}</span><span class=p>&gt;&lt;/</span><span class=nt>progress</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  );
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=api-보안-강화-전략>API 보안 강화 전략<a hidden class=anchor aria-hidden=true href=#api-보안-강화-전략>#</a></h3><h4 id=api-키-이상의-보안-계층>API 키 이상의 보안 계층<a hidden class=anchor aria-hidden=true href=#api-키-이상의-보안-계층>#</a></h4><p>API 키만으로는 충분한 보안을 제공하지 못하므로, 다층 보안 접근 방식이 중요하다:</p><ol><li><strong>OAuth 2.0 / OpenID Connect 통합</strong>:<ul><li>사용자 인증과 API 액세스를 분리</li><li>범위 기반 권한 부여 지원</li><li>액세스 및 새로 고침 토큰 흐름 구현</li></ul></li><li><strong>상호 TLS (mTLS)</strong>:<ul><li>클라이언트와 서버 간 양방향 인증</li><li>키 탈취 시에도 추가적인 보안 계층 제공</li><li>에지 및 서비스 간 통신 보호</li></ul></li><li><strong>JWT 토큰 활용</strong>:<ul><li>자체 포함된 클레임으로 상태 비저장 인증</li><li>짧은 수명으로 토큰 재사용 위험 감소</li><li>서명을 통한 무결성 보장</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53>53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54>54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55>55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56>56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57>57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58>58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59>59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60>60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61>61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Flask에서 JWT 및 API 키를 함께 사용하는 예</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>wraps</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>jwt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;JWT_SECRET_KEY&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;your-secret-key&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>jwt_and_api_key_required</span><span class=p>(</span><span class=n>f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@wraps</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decorated</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>token</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>api_key</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># JWT 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>auth_header</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Authorization&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>auth_header</span> <span class=ow>and</span> <span class=n>auth_header</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;Bearer &#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>token</span> <span class=o>=</span> <span class=n>auth_header</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;JWT 토큰이 없습니다!&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># API 키 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>api_key</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-API-Key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>api_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;API 키가 없습니다!&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># JWT 검증</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;JWT_SECRET_KEY&#39;</span><span class=p>],</span> <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;HS256&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>current_user</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;sub&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># API 키 검증</span>
</span></span><span class=line><span class=cl>            <span class=n>is_valid_key</span> <span class=o>=</span> <span class=n>validate_api_key</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>current_user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>is_valid_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;유효하지 않은 API 키!&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 추가 컨텍스트 저장</span>
</span></span><span class=line><span class=cl>            <span class=n>request</span><span class=o>.</span><span class=n>user_id</span> <span class=o>=</span> <span class=n>current_user</span>
</span></span><span class=line><span class=cl>            <span class=n>request</span><span class=o>.</span><span class=n>api_scopes</span> <span class=o>=</span> <span class=n>get_api_key_scopes</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>ExpiredSignatureError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;토큰이 만료되었습니다!&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>InvalidTokenError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;유효하지 않은 토큰!&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;인증 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decorated</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/api/secure-resource&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@jwt_and_api_key_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>secure_resource</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 리소스에 대한 추가 권한 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;read:resource&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>api_scopes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;접근 권한이 없습니다&#39;</span><span class=p>}),</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># 리소스 로직 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=s1>&#39;보호된 데이터&#39;</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=api-키-취약점-및-대응-방안>API 키 취약점 및 대응 방안<a hidden class=anchor aria-hidden=true href=#api-키-취약점-및-대응-방안>#</a></h4><p><strong>일반적인 취약점</strong>:</p><ol><li><strong>키 노출</strong>: 코드, 버전 관리 시스템, 로그에 키가 노출될 위험</li><li><strong>재생 공격</strong>: 가로챈 API 키의 무단 재사용</li><li><strong>고정 키 문제</strong>: 장기간 변경되지 않은 키로 인한 위험</li><li><strong>과도한 권한</strong>: 필요 이상의 권한을 가진 API 키</li><li><strong>중간자 공격</strong>: 안전하지 않은 채널을 통한 키 전송</li></ol><p><strong>대응 방안</strong>:</p><ol><li><p><strong>API 키 보안 강화</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// API 키에 서명 추가 (Node.js)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>crypto</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;crypto&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createSignedRequest</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>,</span> <span class=nx>apiSecret</span><span class=p>,</span> <span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>nonce</span> <span class=o>=</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mi>16</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 메시지 구성
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>nonce</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// HMAC으로 메시지 서명
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>signature</span> <span class=o>=</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>createHmac</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>,</span> <span class=nx>apiSecret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                         <span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                         <span class=p>.</span><span class=nx>digest</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 요청 헤더
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;X-API-Key&#39;</span><span class=o>:</span> <span class=nx>apiKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;X-Timestamp&#39;</span><span class=o>:</span> <span class=nx>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;X-Nonce&#39;</span><span class=o>:</span> <span class=nx>nonce</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;X-Signature&#39;</span><span class=o>:</span> <span class=nx>signature</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>headers</span><span class=p>,</span> <span class=nx>payload</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>요청 서명 검증</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 서버 측에서 요청 서명 확인 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verify_signed_request</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>headers</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># API 키로 비밀 키 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>api_secret</span> <span class=o>=</span> <span class=n>get_secret_for_api_key</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>api_secret</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 타임스탬프 검증 (5분 이내)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-Timestamp&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>current_time</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>abs</span><span class=p>(</span><span class=n>current_time</span> <span class=o>-</span> <span class=n>timestamp</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>300000</span><span class=p>:</span>  <span class=c1># 5분</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 논스 검증 (재생 방지)</span>
</span></span><span class=line><span class=cl>    <span class=n>nonce</span> <span class=o>=</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-Nonce&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_nonce_used</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>nonce</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 서명 검증</span>
</span></span><span class=line><span class=cl>    <span class=n>received_signature</span> <span class=o>=</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-Signature&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>nonce</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>expected_signature</span> <span class=o>=</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>api_secret</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>hmac</span><span class=o>.</span><span class=n>compare_digest</span><span class=p>(</span><span class=n>received_signature</span><span class=p>,</span> <span class=n>expected_signature</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 사용된 논스 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>save_used_nonce</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>사전 공유 키(Pre-Shared Keys) 활용</strong>:</p><ul><li>각 클라이언트에게 고유한 비밀 키 제공</li><li>통신 채널이 손상되더라도 비밀 키는 안전하게 유지</li><li>서명 생성 및 검증에 사용</li></ul></li></ol><h4 id=owasp-api-보안-권장사항-적용>OWASP API 보안 권장사항 적용<a hidden class=anchor aria-hidden=true href=#owasp-api-보안-권장사항-적용>#</a></h4><p>OWASP(Open Web Application Security Project)는 API 보안을 위한 주요 권장사항을 제공한다:</p><ol><li><p><strong>취약한 객체 수준 인가 방지</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30>30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31>31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Express.js에서 객체 수준 인가 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>authorizeResourceAccess</span><span class=p>(</span><span class=nx>resourceType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>resourceId</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userId</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 리소스 소유권 또는 접근 권한 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>hasAccess</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>checkResourceAccess</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>userId</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nx>resourceType</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nx>resourceId</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nx>req</span><span class=p>.</span><span class=nx>method</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hasAccess</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;이 리소스에 접근할 권한이 없습니다&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 라우트에 적용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/documents/:id&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nx>jwtAuth</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nx>authorizeResourceAccess</span><span class=p>(</span><span class=s1>&#39;document&#39;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 문서 조회 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>손상된 사용자 인증 방지</strong>:</p><ul><li>강력한 암호 정책 적용</li><li>다중 인증(MFA) 구현</li><li>잠금 메커니즘으로 무차별 대입 공격 방지</li><li>통합 인증 공급자(IdP) 사용 고려</li></ul></li><li><p><strong>과도한 데이터 노출 방지</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 응답 데이터 필터링 미들웨어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>filterSensitiveData</span><span class=p>(</span><span class=nx>resourceType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>originalSend</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>send</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>parsedBody</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// JSON 응답인 경우 파싱
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>parsedBody</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 리소스 유형에 따른 필터링 규칙 적용
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>filteredData</span> <span class=o>=</span> <span class=nx>applyDataFilters</span><span class=p>(</span><span class=nx>parsedBody</span><span class=p>,</span> <span class=nx>resourceType</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>role</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 필터링된 데이터로 응답
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>arguments</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>filteredData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// JSON이 아닌 경우 원래 응답 유지
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>originalSend</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=nx>res</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>리소스 소모 공격 방지</strong>:</p><ul><li>모든 엔드포인트에 속도 제한 적용</li><li>페이지네이션 강제 적용</li><li>대용량 요청의 크기 제한</li><li>비동기 처리 및 작업 대기열 구현</li></ul></li><li><p><strong>기능 수준 인가 문제 해결</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 역할 기반 접근 제어 미들웨어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>requirePermission</span><span class=p>(</span><span class=nx>permission</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userRole</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>role</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userPermissions</span> <span class=o>=</span> <span class=nx>getRolePermissions</span><span class=p>(</span><span class=nx>userRole</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userPermissions</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>permission</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=o>:</span> <span class=sb>`이 작업을 수행할 권한이 없습니다. 필요한 권한: </span><span class=si>${</span><span class=nx>permission</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 라우트에 적용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/users&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>jwtAuth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>requirePermission</span><span class=p>(</span><span class=s1>&#39;users:create&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자 생성 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=api-모니터링-및-분석>API 모니터링 및 분석<a hidden class=anchor aria-hidden=true href=#api-모니터링-및-분석>#</a></h3><h4 id=api-사용량-추적-및-분석>API 사용량 추적 및 분석<a hidden class=anchor aria-hidden=true href=#api-사용량-추적-및-분석>#</a></h4><p>API 키는 사용량 추적과 분석의 기반이 된다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41>41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42>42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43>43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44>44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45>45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46>46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47>47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48>48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49>49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50>50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51>51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52>52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53>53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54>54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55>55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56>56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57>57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58>58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59>59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60>60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61>61</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># FastAPI에서 API 사용량 추적 구현</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>Request</span><span class=p>,</span> <span class=n>Response</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.middleware.cors</span> <span class=kn>import</span> <span class=n>CORSMiddleware</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.middleware</span><span class=p>(</span><span class=s2>&#34;http&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>track_api_usage</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 요청 시작 시간</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># API 키 추출</span>
</span></span><span class=line><span class=cl>    <span class=n>api_key</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;X-API-Key&#34;</span><span class=p>,</span> <span class=s2>&#34;anonymous&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 요청 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 응답 시간 계산</span>
</span></span><span class=line><span class=cl>    <span class=n>duration</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 사용량 데이터 구성</span>
</span></span><span class=line><span class=cl>    <span class=n>usage_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;api_key&#34;</span><span class=p>:</span> <span class=n>api_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;endpoint&#34;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status_code&#34;</span><span class=p>:</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;duration&#34;</span><span class=p>:</span> <span class=n>duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ip&#34;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>host</span> <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>client</span> <span class=k>else</span> <span class=s2>&#34;unknown&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Redis에 사용량 데이터 저장</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 처리를 위한 스트림에 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span><span class=o>.</span><span class=n>xadd</span><span class=p>(</span><span class=s2>&#34;api_usage_stream&#34;</span><span class=p>,</span> <span class=n>usage_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 집계를 위한 카운터 증가</span>
</span></span><span class=line><span class=cl>        <span class=n>day_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;api:usage:</span><span class=si>{</span><span class=n>api_key</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>endpoint_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>day_key</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>pipe</span> <span class=o>=</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>pipeline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=n>day_key</span><span class=p>)</span>  <span class=c1># 일일 총 요청 수</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=n>endpoint_key</span><span class=p>)</span>  <span class=c1># 엔드포인트별 요청 수</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 시간 집계</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>endpoint_key</span><span class=si>}</span><span class=s2>:times&#34;</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>ltrim</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>endpoint_key</span><span class=si>}</span><span class=s2>:times&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>999</span><span class=p>)</span>  <span class=c1># 최근 1000개만 유지</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 상태 코드 집계</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>endpoint_key</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용량 추적 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=모니터링-대시보드-구현>모니터링 대시보드 구현<a hidden class=anchor aria-hidden=true href=#모니터링-대시보드-구현>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span><span class=lnt id=hl-18-159><a class=lnlinks href=#hl-18-159>159</a>
</span><span class=lnt id=hl-18-160><a class=lnlinks href=#hl-18-160>160</a>
</span><span class=lnt id=hl-18-161><a class=lnlinks href=#hl-18-161>161</a>
</span><span class=lnt id=hl-18-162><a class=lnlinks href=#hl-18-162>162</a>
</span><span class=lnt id=hl-18-163><a class=lnlinks href=#hl-18-163>163</a>
</span><span class=lnt id=hl-18-164><a class=lnlinks href=#hl-18-164>164</a>
</span><span class=lnt id=hl-18-165><a class=lnlinks href=#hl-18-165>165</a>
</span><span class=lnt id=hl-18-166><a class=lnlinks href=#hl-18-166>166</a>
</span><span class=lnt id=hl-18-167><a class=lnlinks href=#hl-18-167>167</a>
</span><span class=lnt id=hl-18-168><a class=lnlinks href=#hl-18-168>168</a>
</span><span class=lnt id=hl-18-169><a class=lnlinks href=#hl-18-169>169</a>
</span><span class=lnt id=hl-18-170><a class=lnlinks href=#hl-18-170>170</a>
</span><span class=lnt id=hl-18-171><a class=lnlinks href=#hl-18-171>171</a>
</span><span class=lnt id=hl-18-172><a class=lnlinks href=#hl-18-172>172</a>
</span><span class=lnt id=hl-18-173><a class=lnlinks href=#hl-18-173>173</a>
</span><span class=lnt id=hl-18-174><a class=lnlinks href=#hl-18-174>174</a>
</span><span class=lnt id=hl-18-175><a class=lnlinks href=#hl-18-175>175</a>
</span><span class=lnt id=hl-18-176><a class=lnlinks href=#hl-18-176>176</a>
</span><span class=lnt id=hl-18-177><a class=lnlinks href=#hl-18-177>177</a>
</span><span class=lnt id=hl-18-178><a class=lnlinks href=#hl-18-178>178</a>
</span><span class=lnt id=hl-18-179><a class=lnlinks href=#hl-18-179>179</a>
</span><span class=lnt id=hl-18-180><a class=lnlinks href=#hl-18-180>180</a>
</span><span class=lnt id=hl-18-181><a class=lnlinks href=#hl-18-181>181</a>
</span><span class=lnt id=hl-18-182><a class=lnlinks href=#hl-18-182>182</a>
</span><span class=lnt id=hl-18-183><a class=lnlinks href=#hl-18-183>183</a>
</span><span class=lnt id=hl-18-184><a class=lnlinks href=#hl-18-184>184</a>
</span><span class=lnt id=hl-18-185><a class=lnlinks href=#hl-18-185>185</a>
</span><span class=lnt id=hl-18-186><a class=lnlinks href=#hl-18-186>186</a>
</span><span class=lnt id=hl-18-187><a class=lnlinks href=#hl-18-187>187</a>
</span><span class=lnt id=hl-18-188><a class=lnlinks href=#hl-18-188>188</a>
</span><span class=lnt id=hl-18-189><a class=lnlinks href=#hl-18-189>189</a>
</span><span class=lnt id=hl-18-190><a class=lnlinks href=#hl-18-190>190</a>
</span><span class=lnt id=hl-18-191><a class=lnlinks href=#hl-18-191>191</a>
</span><span class=lnt id=hl-18-192><a class=lnlinks href=#hl-18-192>192</a>
</span><span class=lnt id=hl-18-193><a class=lnlinks href=#hl-18-193>193</a>
</span><span class=lnt id=hl-18-194><a class=lnlinks href=#hl-18-194>194</a>
</span><span class=lnt id=hl-18-195><a class=lnlinks href=#hl-18-195>195</a>
</span><span class=lnt id=hl-18-196><a class=lnlinks href=#hl-18-196>196</a>
</span><span class=lnt id=hl-18-197><a class=lnlinks href=#hl-18-197>197</a>
</span><span class=lnt id=hl-18-198><a class=lnlinks href=#hl-18-198>198</a>
</span><span class=lnt id=hl-18-199><a class=lnlinks href=#hl-18-199>199</a>
</span><span class=lnt id=hl-18-200><a class=lnlinks href=#hl-18-200>200</a>
</span><span class=lnt id=hl-18-201><a class=lnlinks href=#hl-18-201>201</a>
</span><span class=lnt id=hl-18-202><a class=lnlinks href=#hl-18-202>202</a>
</span><span class=lnt id=hl-18-203><a class=lnlinks href=#hl-18-203>203</a>
</span><span class=lnt id=hl-18-204><a class=lnlinks href=#hl-18-204>204</a>
</span><span class=lnt id=hl-18-205><a class=lnlinks href=#hl-18-205>205</a>
</span><span class=lnt id=hl-18-206><a class=lnlinks href=#hl-18-206>206</a>
</span><span class=lnt id=hl-18-207><a class=lnlinks href=#hl-18-207>207</a>
</span><span class=lnt id=hl-18-208><a class=lnlinks href=#hl-18-208>208</a>
</span><span class=lnt id=hl-18-209><a class=lnlinks href=#hl-18-209>209</a>
</span><span class=lnt id=hl-18-210><a class=lnlinks href=#hl-18-210>210</a>
</span><span class=lnt id=hl-18-211><a class=lnlinks href=#hl-18-211>211</a>
</span><span class=lnt id=hl-18-212><a class=lnlinks href=#hl-18-212>212</a>
</span><span class=lnt id=hl-18-213><a class=lnlinks href=#hl-18-213>213</a>
</span><span class=lnt id=hl-18-214><a class=lnlinks href=#hl-18-214>214</a>
</span><span class=lnt id=hl-18-215><a class=lnlinks href=#hl-18-215>215</a>
</span><span class=lnt id=hl-18-216><a class=lnlinks href=#hl-18-216>216</a>
</span><span class=lnt id=hl-18-217><a class=lnlinks href=#hl-18-217>217</a>
</span><span class=lnt id=hl-18-218><a class=lnlinks href=#hl-18-218>218</a>
</span><span class=lnt id=hl-18-219><a class=lnlinks href=#hl-18-219>219</a>
</span><span class=lnt id=hl-18-220><a class=lnlinks href=#hl-18-220>220</a>
</span><span class=lnt id=hl-18-221><a class=lnlinks href=#hl-18-221>221</a>
</span><span class=lnt id=hl-18-222><a class=lnlinks href=#hl-18-222>222</a>
</span><span class=lnt id=hl-18-223><a class=lnlinks href=#hl-18-223>223</a>
</span><span class=lnt id=hl-18-224><a class=lnlinks href=#hl-18-224>224</a>
</span><span class=lnt id=hl-18-225><a class=lnlinks href=#hl-18-225>225</a>
</span><span class=lnt id=hl-18-226><a class=lnlinks href=#hl-18-226>226</a>
</span><span class=lnt id=hl-18-227><a class=lnlinks href=#hl-18-227>227</a>
</span><span class=lnt id=hl-18-228><a class=lnlinks href=#hl-18-228>228</a>
</span><span class=lnt id=hl-18-229><a class=lnlinks href=#hl-18-229>229</a>
</span><span class=lnt id=hl-18-230><a class=lnlinks href=#hl-18-230>230</a>
</span><span class=lnt id=hl-18-231><a class=lnlinks href=#hl-18-231>231</a>
</span><span class=lnt id=hl-18-232><a class=lnlinks href=#hl-18-232>232</a>
</span><span class=lnt id=hl-18-233><a class=lnlinks href=#hl-18-233>233</a>
</span><span class=lnt id=hl-18-234><a class=lnlinks href=#hl-18-234>234</a>
</span><span class=lnt id=hl-18-235><a class=lnlinks href=#hl-18-235>235</a>
</span><span class=lnt id=hl-18-236><a class=lnlinks href=#hl-18-236>236</a>
</span><span class=lnt id=hl-18-237><a class=lnlinks href=#hl-18-237>237</a>
</span><span class=lnt id=hl-18-238><a class=lnlinks href=#hl-18-238>238</a>
</span><span class=lnt id=hl-18-239><a class=lnlinks href=#hl-18-239>239</a>
</span><span class=lnt id=hl-18-240><a class=lnlinks href=#hl-18-240>240</a>
</span><span class=lnt id=hl-18-241><a class=lnlinks href=#hl-18-241>241</a>
</span><span class=lnt id=hl-18-242><a class=lnlinks href=#hl-18-242>242</a>
</span><span class=lnt id=hl-18-243><a class=lnlinks href=#hl-18-243>243</a>
</span><span class=lnt id=hl-18-244><a class=lnlinks href=#hl-18-244>244</a>
</span><span class=lnt id=hl-18-245><a class=lnlinks href=#hl-18-245>245</a>
</span><span class=lnt id=hl-18-246><a class=lnlinks href=#hl-18-246>246</a>
</span><span class=lnt id=hl-18-247><a class=lnlinks href=#hl-18-247>247</a>
</span><span class=lnt id=hl-18-248><a class=lnlinks href=#hl-18-248>248</a>
</span><span class=lnt id=hl-18-249><a class=lnlinks href=#hl-18-249>249</a>
</span><span class=lnt id=hl-18-250><a class=lnlinks href=#hl-18-250>250</a>
</span><span class=lnt id=hl-18-251><a class=lnlinks href=#hl-18-251>251</a>
</span><span class=lnt id=hl-18-252><a class=lnlinks href=#hl-18-252>252</a>
</span><span class=lnt id=hl-18-253><a class=lnlinks href=#hl-18-253>253</a>
</span><span class=lnt id=hl-18-254><a class=lnlinks href=#hl-18-254>254</a>
</span><span class=lnt id=hl-18-255><a class=lnlinks href=#hl-18-255>255</a>
</span><span class=lnt id=hl-18-256><a class=lnlinks href=#hl-18-256>256</a>
</span><span class=lnt id=hl-18-257><a class=lnlinks href=#hl-18-257>257</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// React로 구현한 API 키 사용량 대시보드 컴포넌트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Line</span><span class=p>,</span> <span class=nx>Bar</span><span class=p>,</span> <span class=nx>Pie</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-chartjs-2&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>format</span><span class=p>,</span> <span class=nx>subDays</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;date-fns&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ApiUsageDashboard</span><span class=p>({</span> <span class=nx>apiKey</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>usageData</span><span class=p>,</span> <span class=nx>setUsageData</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>dailyRequests</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointUsage</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nx>responseTimeData</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nx>statusCodesData</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nx>loading</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=o>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 날짜 범위 선택 상태
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>dateRange</span><span class=p>,</span> <span class=nx>setDateRange</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=mi>7</span><span class=p>);</span> <span class=c1>// 기본 7일
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>fetchUsageData</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>startDate</span> <span class=o>=</span> <span class=nx>format</span><span class=p>(</span><span class=nx>subDays</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span> <span class=nx>dateRange</span><span class=p>),</span> <span class=s1>&#39;yyyy-MM-dd&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>endDate</span> <span class=o>=</span> <span class=nx>format</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span> <span class=s1>&#39;yyyy-MM-dd&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// API 사용량 데이터 가져오기
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=sb>`/api/analytics/usage?apiKey=</span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>&amp;startDate=</span><span class=si>${</span><span class=nx>startDate</span><span class=si>}</span><span class=sb>&amp;endDate=</span><span class=si>${</span><span class=nx>endDate</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;token&#39;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;사용량 데이터를 가져오는 데 실패했습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 데이터 처리 및 상태 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>processedData</span> <span class=o>=</span> <span class=nx>processUsageData</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>setUsageData</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=err>…</span><span class=nx>processedData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>loading</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setUsageData</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=err>…</span><span class=nx>usageData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>loading</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>fetchUsageData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>apiKey</span><span class=p>,</span> <span class=nx>dateRange</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 사용량 데이터 처리 함수
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>function</span> <span class=nx>processUsageData</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 일일 요청 데이터 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>dailyRequests</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>dailyRequests</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>date</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>count</span>
</span></span><span class=line><span class=cl>    <span class=p>}));</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 엔드포인트별 사용량 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>endpointUsage</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>endpointUsage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>map</span><span class=p>(([</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>count</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>endpoint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>count</span>
</span></span><span class=line><span class=cl>      <span class=p>}))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>sort</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>count</span> <span class=o>-</span> <span class=nx>a</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span> <span class=c1>// 상위 10개만
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 응답 시간 데이터 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>responseTimeData</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>responseTimeData</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>date</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>avg</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>avg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>p95</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>p95</span>
</span></span><span class=line><span class=cl>    <span class=p>}));</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 상태 코드 데이터 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>statusCodesData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>labels</span><span class=o>:</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>statusCodes</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>datasets</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>values</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>statusCodes</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>backgroundColor</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;#4CAF50&#39;</span><span class=p>,</span> <span class=c1>// 2xx (성공)
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=s1>&#39;#FF9800&#39;</span><span class=p>,</span> <span class=c1>// 3xx (리디렉션)
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=s1>&#39;#F44336&#39;</span><span class=p>,</span> <span class=c1>// 4xx (클라이언트 오류)
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=s1>&#39;#9C27B0&#39;</span>  <span class=c1>// 5xx (서버 오류)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}]</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>dailyRequests</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>endpointUsage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>responseTimeData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCodesData</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>loading</span><span class=p>)</span> <span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>로딩</span> <span class=nx>중</span><span class=err>…</span><span class=o>&lt;</span><span class=err>/div&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>error</span><span class=p>)</span> <span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>오류</span><span class=o>:</span> <span class=p>{</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>error</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;api-usage-dashboard&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>API</span> <span class=nx>키</span> <span class=nx>사용량</span> <span class=nx>대시보드</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;date-range-selector&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span><span class=nx>기간</span> <span class=nx>선택</span><span class=o>:&lt;</span><span class=err>/label&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>select</span> 
</span></span><span class=line><span class=cl>          <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>dateRange</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>          <span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setDateRange</span><span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>))}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>option</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=mi>7</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>최근</span> <span class=mi>7</span><span class=nx>일</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>option</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=mi>30</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>최근</span> <span class=mi>30</span><span class=nx>일</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>option</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=mi>90</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>최근</span> <span class=mi>90</span><span class=nx>일</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/select&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;usage-summary&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;summary-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>총</span> <span class=nx>API</span> <span class=nx>호출</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;summary-value&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>dailyRequests</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>sum</span><span class=p>,</span> <span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sum</span> <span class=o>+</span> <span class=nx>item</span><span class=p>.</span><span class=nx>count</span><span class=p>,</span> <span class=mi>0</span><span class=p>).</span><span class=nx>toLocaleString</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;summary-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>평균</span> <span class=nx>응답</span> <span class=nx>시간</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;summary-value&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{(</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>responseTimeData</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>sum</span><span class=p>,</span> <span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sum</span> <span class=o>+</span> <span class=nx>item</span><span class=p>.</span><span class=nx>avg</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>/</span> 
</span></span><span class=line><span class=cl>              <span class=nx>usageData</span><span class=p>.</span><span class=nx>responseTimeData</span><span class=p>.</span><span class=nx>length</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)}</span><span class=nx>ms</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;summary-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>성공률</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;summary-value&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{((</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>statusCodesData</span><span class=p>.</span><span class=nx>datasets</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>/</span>
</span></span><span class=line><span class=cl>              <span class=nx>usageData</span><span class=p>.</span><span class=nx>statusCodesData</span><span class=p>.</span><span class=nx>datasets</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>data</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span> <span class=o>*</span> <span class=mi>100</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)}</span><span class=o>%</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;chart-container&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;chart-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>일일</span> <span class=nx>API</span> <span class=nx>호출</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>Line</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>labels</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>dailyRequests</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>date</span><span class=p>),</span>
</span></span><span class=line><span class=cl>              <span class=nx>datasets</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>                <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;API 호출 수&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>data</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>dailyRequests</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>count</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=nx>borderColor</span><span class=o>:</span> <span class=s1>&#39;#2196F3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>backgroundColor</span><span class=o>:</span> <span class=s1>&#39;rgba(33, 150, 243, 0.1)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>tension</span><span class=o>:</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl>              <span class=p>}]</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>            <span class=nx>options</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>responsive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>scales</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>y</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>beginAtZero</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;chart-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>상위</span> <span class=nx>엔드포인트</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>Bar</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>labels</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>endpointUsage</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>),</span>
</span></span><span class=line><span class=cl>              <span class=nx>datasets</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>                <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;API 호출 수&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>data</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>endpointUsage</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>count</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=nx>backgroundColor</span><span class=o>:</span> <span class=s1>&#39;#4CAF50&#39;</span>
</span></span><span class=line><span class=cl>              <span class=p>}]</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>            <span class=nx>options</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>responsive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>indexAxis</span><span class=o>:</span> <span class=s1>&#39;y&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;chart-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>응답</span> <span class=nx>시간</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>Line</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>labels</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>responseTimeData</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>date</span><span class=p>),</span>
</span></span><span class=line><span class=cl>              <span class=nx>datasets</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;평균 응답 시간&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>data</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>responseTimeData</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>avg</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                  <span class=nx>borderColor</span><span class=o>:</span> <span class=s1>&#39;#FF9800&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>backgroundColor</span><span class=o>:</span> <span class=s1>&#39;rgba(255, 152, 0, 0.1)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>tension</span><span class=o>:</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;P95 응답 시간&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>data</span><span class=o>:</span> <span class=nx>usageData</span><span class=p>.</span><span class=nx>responseTimeData</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>p95</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                  <span class=nx>borderColor</span><span class=o>:</span> <span class=s1>&#39;#F44336&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>backgroundColor</span><span class=o>:</span> <span class=s1>&#39;rgba(244, 67, 54, 0.1)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>tension</span><span class=o>:</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>            <span class=nx>options</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>responsive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>scales</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>y</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>beginAtZero</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>title</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>display</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;응답 시간 (ms)&#39;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;chart-card&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>HTTP</span> <span class=nx>상태</span> <span class=nx>코드</span> <span class=nx>분포</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>Pie</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>=</span><span class=p>{</span><span class=nx>usageData</span><span class=p>.</span><span class=nx>statusCodesData</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>options</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>              <span class=nx>responsive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>plugins</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>legend</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>position</span><span class=o>:</span> <span class=s1>&#39;right&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=nx>tooltip</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>callbacks</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>label</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=kr>const</span> <span class=nx>label</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>label</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=kr>const</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>raw</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=kr>const</span> <span class=nx>total</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>dataset</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                      <span class=kr>const</span> <span class=nx>percentage</span> <span class=o>=</span> <span class=p>((</span><span class=nx>value</span> <span class=o>/</span> <span class=nx>total</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                      <span class=k>return</span> <span class=sb>`</span><span class=si>${</span><span class=nx>label</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>value</span><span class=si>}</span><span class=sb> (</span><span class=si>${</span><span class=nx>percentage</span><span class=si>}</span><span class=sb>%)`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=비정상-사용-패턴-감지>비정상 사용 패턴 감지<a hidden class=anchor aria-hidden=true href=#비정상-사용-패턴-감지>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>  1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>  2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>  3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>  4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>  5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>  6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>  7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>  8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>  9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10> 10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11> 11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12> 12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13> 13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14> 14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15> 15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16> 16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17> 17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18> 18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19> 19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20> 20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21> 21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22> 22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23> 23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24> 24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25> 25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26> 26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27> 27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28> 28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29> 29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30> 30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31> 31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32> 32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33> 33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34> 34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35> 35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36> 36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37> 37</a>
</span><span class=lnt id=hl-19-38><a class=lnlinks href=#hl-19-38> 38</a>
</span><span class=lnt id=hl-19-39><a class=lnlinks href=#hl-19-39> 39</a>
</span><span class=lnt id=hl-19-40><a class=lnlinks href=#hl-19-40> 40</a>
</span><span class=lnt id=hl-19-41><a class=lnlinks href=#hl-19-41> 41</a>
</span><span class=lnt id=hl-19-42><a class=lnlinks href=#hl-19-42> 42</a>
</span><span class=lnt id=hl-19-43><a class=lnlinks href=#hl-19-43> 43</a>
</span><span class=lnt id=hl-19-44><a class=lnlinks href=#hl-19-44> 44</a>
</span><span class=lnt id=hl-19-45><a class=lnlinks href=#hl-19-45> 45</a>
</span><span class=lnt id=hl-19-46><a class=lnlinks href=#hl-19-46> 46</a>
</span><span class=lnt id=hl-19-47><a class=lnlinks href=#hl-19-47> 47</a>
</span><span class=lnt id=hl-19-48><a class=lnlinks href=#hl-19-48> 48</a>
</span><span class=lnt id=hl-19-49><a class=lnlinks href=#hl-19-49> 49</a>
</span><span class=lnt id=hl-19-50><a class=lnlinks href=#hl-19-50> 50</a>
</span><span class=lnt id=hl-19-51><a class=lnlinks href=#hl-19-51> 51</a>
</span><span class=lnt id=hl-19-52><a class=lnlinks href=#hl-19-52> 52</a>
</span><span class=lnt id=hl-19-53><a class=lnlinks href=#hl-19-53> 53</a>
</span><span class=lnt id=hl-19-54><a class=lnlinks href=#hl-19-54> 54</a>
</span><span class=lnt id=hl-19-55><a class=lnlinks href=#hl-19-55> 55</a>
</span><span class=lnt id=hl-19-56><a class=lnlinks href=#hl-19-56> 56</a>
</span><span class=lnt id=hl-19-57><a class=lnlinks href=#hl-19-57> 57</a>
</span><span class=lnt id=hl-19-58><a class=lnlinks href=#hl-19-58> 58</a>
</span><span class=lnt id=hl-19-59><a class=lnlinks href=#hl-19-59> 59</a>
</span><span class=lnt id=hl-19-60><a class=lnlinks href=#hl-19-60> 60</a>
</span><span class=lnt id=hl-19-61><a class=lnlinks href=#hl-19-61> 61</a>
</span><span class=lnt id=hl-19-62><a class=lnlinks href=#hl-19-62> 62</a>
</span><span class=lnt id=hl-19-63><a class=lnlinks href=#hl-19-63> 63</a>
</span><span class=lnt id=hl-19-64><a class=lnlinks href=#hl-19-64> 64</a>
</span><span class=lnt id=hl-19-65><a class=lnlinks href=#hl-19-65> 65</a>
</span><span class=lnt id=hl-19-66><a class=lnlinks href=#hl-19-66> 66</a>
</span><span class=lnt id=hl-19-67><a class=lnlinks href=#hl-19-67> 67</a>
</span><span class=lnt id=hl-19-68><a class=lnlinks href=#hl-19-68> 68</a>
</span><span class=lnt id=hl-19-69><a class=lnlinks href=#hl-19-69> 69</a>
</span><span class=lnt id=hl-19-70><a class=lnlinks href=#hl-19-70> 70</a>
</span><span class=lnt id=hl-19-71><a class=lnlinks href=#hl-19-71> 71</a>
</span><span class=lnt id=hl-19-72><a class=lnlinks href=#hl-19-72> 72</a>
</span><span class=lnt id=hl-19-73><a class=lnlinks href=#hl-19-73> 73</a>
</span><span class=lnt id=hl-19-74><a class=lnlinks href=#hl-19-74> 74</a>
</span><span class=lnt id=hl-19-75><a class=lnlinks href=#hl-19-75> 75</a>
</span><span class=lnt id=hl-19-76><a class=lnlinks href=#hl-19-76> 76</a>
</span><span class=lnt id=hl-19-77><a class=lnlinks href=#hl-19-77> 77</a>
</span><span class=lnt id=hl-19-78><a class=lnlinks href=#hl-19-78> 78</a>
</span><span class=lnt id=hl-19-79><a class=lnlinks href=#hl-19-79> 79</a>
</span><span class=lnt id=hl-19-80><a class=lnlinks href=#hl-19-80> 80</a>
</span><span class=lnt id=hl-19-81><a class=lnlinks href=#hl-19-81> 81</a>
</span><span class=lnt id=hl-19-82><a class=lnlinks href=#hl-19-82> 82</a>
</span><span class=lnt id=hl-19-83><a class=lnlinks href=#hl-19-83> 83</a>
</span><span class=lnt id=hl-19-84><a class=lnlinks href=#hl-19-84> 84</a>
</span><span class=lnt id=hl-19-85><a class=lnlinks href=#hl-19-85> 85</a>
</span><span class=lnt id=hl-19-86><a class=lnlinks href=#hl-19-86> 86</a>
</span><span class=lnt id=hl-19-87><a class=lnlinks href=#hl-19-87> 87</a>
</span><span class=lnt id=hl-19-88><a class=lnlinks href=#hl-19-88> 88</a>
</span><span class=lnt id=hl-19-89><a class=lnlinks href=#hl-19-89> 89</a>
</span><span class=lnt id=hl-19-90><a class=lnlinks href=#hl-19-90> 90</a>
</span><span class=lnt id=hl-19-91><a class=lnlinks href=#hl-19-91> 91</a>
</span><span class=lnt id=hl-19-92><a class=lnlinks href=#hl-19-92> 92</a>
</span><span class=lnt id=hl-19-93><a class=lnlinks href=#hl-19-93> 93</a>
</span><span class=lnt id=hl-19-94><a class=lnlinks href=#hl-19-94> 94</a>
</span><span class=lnt id=hl-19-95><a class=lnlinks href=#hl-19-95> 95</a>
</span><span class=lnt id=hl-19-96><a class=lnlinks href=#hl-19-96> 96</a>
</span><span class=lnt id=hl-19-97><a class=lnlinks href=#hl-19-97> 97</a>
</span><span class=lnt id=hl-19-98><a class=lnlinks href=#hl-19-98> 98</a>
</span><span class=lnt id=hl-19-99><a class=lnlinks href=#hl-19-99> 99</a>
</span><span class=lnt id=hl-19-100><a class=lnlinks href=#hl-19-100>100</a>
</span><span class=lnt id=hl-19-101><a class=lnlinks href=#hl-19-101>101</a>
</span><span class=lnt id=hl-19-102><a class=lnlinks href=#hl-19-102>102</a>
</span><span class=lnt id=hl-19-103><a class=lnlinks href=#hl-19-103>103</a>
</span><span class=lnt id=hl-19-104><a class=lnlinks href=#hl-19-104>104</a>
</span><span class=lnt id=hl-19-105><a class=lnlinks href=#hl-19-105>105</a>
</span><span class=lnt id=hl-19-106><a class=lnlinks href=#hl-19-106>106</a>
</span><span class=lnt id=hl-19-107><a class=lnlinks href=#hl-19-107>107</a>
</span><span class=lnt id=hl-19-108><a class=lnlinks href=#hl-19-108>108</a>
</span><span class=lnt id=hl-19-109><a class=lnlinks href=#hl-19-109>109</a>
</span><span class=lnt id=hl-19-110><a class=lnlinks href=#hl-19-110>110</a>
</span><span class=lnt id=hl-19-111><a class=lnlinks href=#hl-19-111>111</a>
</span><span class=lnt id=hl-19-112><a class=lnlinks href=#hl-19-112>112</a>
</span><span class=lnt id=hl-19-113><a class=lnlinks href=#hl-19-113>113</a>
</span><span class=lnt id=hl-19-114><a class=lnlinks href=#hl-19-114>114</a>
</span><span class=lnt id=hl-19-115><a class=lnlinks href=#hl-19-115>115</a>
</span><span class=lnt id=hl-19-116><a class=lnlinks href=#hl-19-116>116</a>
</span><span class=lnt id=hl-19-117><a class=lnlinks href=#hl-19-117>117</a>
</span><span class=lnt id=hl-19-118><a class=lnlinks href=#hl-19-118>118</a>
</span><span class=lnt id=hl-19-119><a class=lnlinks href=#hl-19-119>119</a>
</span><span class=lnt id=hl-19-120><a class=lnlinks href=#hl-19-120>120</a>
</span><span class=lnt id=hl-19-121><a class=lnlinks href=#hl-19-121>121</a>
</span><span class=lnt id=hl-19-122><a class=lnlinks href=#hl-19-122>122</a>
</span><span class=lnt id=hl-19-123><a class=lnlinks href=#hl-19-123>123</a>
</span><span class=lnt id=hl-19-124><a class=lnlinks href=#hl-19-124>124</a>
</span><span class=lnt id=hl-19-125><a class=lnlinks href=#hl-19-125>125</a>
</span><span class=lnt id=hl-19-126><a class=lnlinks href=#hl-19-126>126</a>
</span><span class=lnt id=hl-19-127><a class=lnlinks href=#hl-19-127>127</a>
</span><span class=lnt id=hl-19-128><a class=lnlinks href=#hl-19-128>128</a>
</span><span class=lnt id=hl-19-129><a class=lnlinks href=#hl-19-129>129</a>
</span><span class=lnt id=hl-19-130><a class=lnlinks href=#hl-19-130>130</a>
</span><span class=lnt id=hl-19-131><a class=lnlinks href=#hl-19-131>131</a>
</span><span class=lnt id=hl-19-132><a class=lnlinks href=#hl-19-132>132</a>
</span><span class=lnt id=hl-19-133><a class=lnlinks href=#hl-19-133>133</a>
</span><span class=lnt id=hl-19-134><a class=lnlinks href=#hl-19-134>134</a>
</span><span class=lnt id=hl-19-135><a class=lnlinks href=#hl-19-135>135</a>
</span><span class=lnt id=hl-19-136><a class=lnlinks href=#hl-19-136>136</a>
</span><span class=lnt id=hl-19-137><a class=lnlinks href=#hl-19-137>137</a>
</span><span class=lnt id=hl-19-138><a class=lnlinks href=#hl-19-138>138</a>
</span><span class=lnt id=hl-19-139><a class=lnlinks href=#hl-19-139>139</a>
</span><span class=lnt id=hl-19-140><a class=lnlinks href=#hl-19-140>140</a>
</span><span class=lnt id=hl-19-141><a class=lnlinks href=#hl-19-141>141</a>
</span><span class=lnt id=hl-19-142><a class=lnlinks href=#hl-19-142>142</a>
</span><span class=lnt id=hl-19-143><a class=lnlinks href=#hl-19-143>143</a>
</span><span class=lnt id=hl-19-144><a class=lnlinks href=#hl-19-144>144</a>
</span><span class=lnt id=hl-19-145><a class=lnlinks href=#hl-19-145>145</a>
</span><span class=lnt id=hl-19-146><a class=lnlinks href=#hl-19-146>146</a>
</span><span class=lnt id=hl-19-147><a class=lnlinks href=#hl-19-147>147</a>
</span><span class=lnt id=hl-19-148><a class=lnlinks href=#hl-19-148>148</a>
</span><span class=lnt id=hl-19-149><a class=lnlinks href=#hl-19-149>149</a>
</span><span class=lnt id=hl-19-150><a class=lnlinks href=#hl-19-150>150</a>
</span><span class=lnt id=hl-19-151><a class=lnlinks href=#hl-19-151>151</a>
</span><span class=lnt id=hl-19-152><a class=lnlinks href=#hl-19-152>152</a>
</span><span class=lnt id=hl-19-153><a class=lnlinks href=#hl-19-153>153</a>
</span><span class=lnt id=hl-19-154><a class=lnlinks href=#hl-19-154>154</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 비정상 API 사용 패턴 감지 서비스</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.ensemble</span> <span class=kn>import</span> <span class=n>IsolationForest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ApiAnomalyDetector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>contamination</span><span class=o>=</span><span class=mf>0.05</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>contamination</span> <span class=o>=</span> <span class=n>contamination</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_usage_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>,</span> <span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Redis에서 API 사용 데이터 가져오기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>end_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>start_date</span> <span class=o>=</span> <span class=n>end_date</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>days</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>usage_data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>current_date</span> <span class=o>=</span> <span class=n>start_date</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>current_date</span> <span class=o>&lt;=</span> <span class=n>end_date</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>date_str</span> <span class=o>=</span> <span class=n>current_date</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>day_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;api:usage:</span><span class=si>{</span><span class=n>api_key</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>date_str</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 일일 총 호출 수</span>
</span></span><span class=line><span class=cl>            <span class=n>total_calls</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>day_key</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태 코드별 호출 수</span>
</span></span><span class=line><span class=cl>            <span class=n>status_2xx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>status_4xx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>status_5xx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 모든 엔드포인트 패턴 가져오기</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>endpoint_key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>scan_iter</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>day_key</span><span class=si>}</span><span class=s2>:*&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>endpoint_key</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;:times&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>key_parts</span> <span class=o>=</span> <span class=n>endpoint_key</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_parts</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>4</span><span class=p>:</span>  <span class=c1># 상태 코드 포함</span>
</span></span><span class=line><span class=cl>                    <span class=n>status_code</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>key_parts</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=n>count</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint_key</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=mi>200</span> <span class=o>&lt;=</span> <span class=n>status_code</span> <span class=o>&lt;</span> <span class=mi>300</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>status_2xx</span> <span class=o>+=</span> <span class=n>count</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=mi>400</span> <span class=o>&lt;=</span> <span class=n>status_code</span> <span class=o>&lt;</span> <span class=mi>500</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>status_4xx</span> <span class=o>+=</span> <span class=n>count</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=mi>500</span> <span class=o>&lt;=</span> <span class=n>status_code</span> <span class=o>&lt;</span> <span class=mi>600</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>status_5xx</span> <span class=o>+=</span> <span class=n>count</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 응답 시간 데이터</span>
</span></span><span class=line><span class=cl>            <span class=n>avg_response_time</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>max_response_time</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 모든 엔드포인트의 응답 시간 데이터 집계</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>time_key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>scan_iter</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>day_key</span><span class=si>}</span><span class=s2>:*:times&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>times</span> <span class=o>=</span> <span class=p>[</span><span class=nb>float</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>lrange</span><span class=p>(</span><span class=n>time_key</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>times</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>avg_response_time</span> <span class=o>+=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>times</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>times</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>max_response_time</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>max_response_time</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=n>times</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 사용 패턴 데이터 추가</span>
</span></span><span class=line><span class=cl>            <span class=n>usage_data</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>date_str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_calls&#39;</span><span class=p>:</span> <span class=n>total_calls</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status_2xx&#39;</span><span class=p>:</span> <span class=n>status_2xx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status_4xx&#39;</span><span class=p>:</span> <span class=n>status_4xx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status_5xx&#39;</span><span class=p>:</span> <span class=n>status_5xx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;error_rate&#39;</span><span class=p>:</span> <span class=p>(</span><span class=n>status_4xx</span> <span class=o>+</span> <span class=n>status_5xx</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_calls</span> <span class=k>if</span> <span class=n>total_calls</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;avg_response_time&#39;</span><span class=p>:</span> <span class=n>avg_response_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;max_response_time&#39;</span><span class=p>:</span> <span class=n>max_response_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;weekend&#39;</span><span class=p>:</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>current_date</span><span class=o>.</span><span class=n>weekday</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=mi>5</span> <span class=k>else</span> <span class=mi>0</span>  <span class=c1># 주말 여부</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_date</span> <span class=o>+=</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>usage_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>train_model</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>,</span> <span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이상 탐지 모델 훈련&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_usage_data</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>days</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>:</span>  <span class=c1># 충분한 데이터 필요</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모델 훈련에 사용할 특성</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_calls&#39;</span><span class=p>,</span> <span class=s1>&#39;status_2xx&#39;</span><span class=p>,</span> <span class=s1>&#39;status_4xx&#39;</span><span class=p>,</span> <span class=s1>&#39;status_5xx&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;error_rate&#39;</span><span class=p>,</span> <span class=s1>&#39;avg_response_time&#39;</span><span class=p>,</span> <span class=s1>&#39;max_response_time&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모델 초기화 및 훈련</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>IsolationForest</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>contamination</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>contamination</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>features</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>detect_anomalies</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>,</span> <span class=n>days</span><span class=o>=</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;최근 사용 패턴에서 이상 탐지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>train_model</span><span class=p>(</span><span class=n>api_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>[],</span> <span class=s2>&#34;충분한 과거 데이터가 없습니다&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 최근 데이터 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_usage_data</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>days</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_data</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[],</span> <span class=s2>&#34;최근 사용 데이터가 없습니다&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>features</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_calls&#39;</span><span class=p>,</span> <span class=s1>&#39;status_2xx&#39;</span><span class=p>,</span> <span class=s1>&#39;status_4xx&#39;</span><span class=p>,</span> <span class=s1>&#39;status_5xx&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;error_rate&#39;</span><span class=p>,</span> <span class=s1>&#39;avg_response_time&#39;</span><span class=p>,</span> <span class=s1>&#39;max_response_time&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이상 점수 예측 (-1: 이상, 1: 정상)</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>recent_data</span><span class=p>[</span><span class=n>features</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>scores</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>decision_function</span><span class=p>(</span><span class=n>recent_data</span><span class=p>[</span><span class=n>features</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이상 데이터 선별</span>
</span></span><span class=line><span class=cl>        <span class=n>anomalies</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>pred</span><span class=p>,</span> <span class=n>score</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>predictions</span><span class=p>,</span> <span class=n>scores</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pred</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>  <span class=c1># 이상으로 감지된 경우</span>
</span></span><span class=line><span class=cl>                <span class=n>date</span> <span class=o>=</span> <span class=n>recent_data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 이상 원인 분석</span>
</span></span><span class=line><span class=cl>                <span class=n>causes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=n>row</span> <span class=o>=</span> <span class=n>recent_data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 평균 및 표준편차 계산을 위한 과거 데이터</span>
</span></span><span class=line><span class=cl>                <span class=n>historical_avg</span> <span class=o>=</span> <span class=n>recent_data</span><span class=p>[</span><span class=n>features</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>historical_std</span> <span class=o>=</span> <span class=n>recent_data</span><span class=p>[</span><span class=n>features</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 각 특성별 이상 원인 분석</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>feature</span> <span class=ow>in</span> <span class=n>features</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>feature</span> <span class=o>==</span> <span class=s1>&#39;weekend&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>continue</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>val</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=n>feature</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>avg</span> <span class=o>=</span> <span class=n>historical_avg</span><span class=p>[</span><span class=n>feature</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>std</span> <span class=o>=</span> <span class=n>historical_std</span><span class=p>[</span><span class=n>feature</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 3 표준편차 이상 차이나면 원인으로 추가</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>abs</span><span class=p>(</span><span class=n>val</span> <span class=o>-</span> <span class=n>avg</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>std</span> <span class=ow>and</span> <span class=n>std</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>direction</span> <span class=o>=</span> <span class=s2>&#34;높음&#34;</span> <span class=k>if</span> <span class=n>val</span> <span class=o>&gt;</span> <span class=n>avg</span> <span class=k>else</span> <span class=s2>&#34;낮음&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=n>causes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>feature</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>val</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>direction</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>anomalies</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;date&#39;</span><span class=p>:</span> <span class=n>date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;score&#39;</span><span class=p>:</span> <span class=n>score</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;causes&#39;</span><span class=p>:</span> <span class=n>causes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=p>{</span><span class=n>f</span><span class=p>:</span> <span class=n>row</span><span class=p>[</span><span class=n>f</span><span class=p>]</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>features</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>anomalies</span><span class=p>,</span> <span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api-키-수익화-및-비즈니스-모델>API 키 수익화 및 비즈니스 모델<a hidden class=anchor aria-hidden=true href=#api-키-수익화-및-비즈니스-모델>#</a></h3><h4 id=api-키-기반-과금-모델>API 키 기반 과금 모델<a hidden class=anchor aria-hidden=true href=#api-키-기반-과금-모델>#</a></h4><p>API 관리 시스템을 통해 다양한 수익화 모델을 구현할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>  1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>  2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>  3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>  4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>  5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>  6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>  7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>  8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9>  9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10> 10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11> 11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12> 12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13> 13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14> 14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15> 15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16> 16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17> 17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18> 18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19> 19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20> 20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21> 21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22> 22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23> 23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24> 24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25> 25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26> 26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27> 27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28> 28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29> 29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30> 30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31> 31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32> 32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33> 33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34> 34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35> 35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36> 36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37> 37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38> 38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39> 39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40> 40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41> 41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42> 42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43> 43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44> 44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45> 45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46> 46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47> 47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48> 48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49> 49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50> 50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51> 51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52> 52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53> 53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54> 54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55> 55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56> 56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57> 57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58> 58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59> 59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60> 60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61> 61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62> 62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63> 63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64> 64</a>
</span><span class=lnt id=hl-20-65><a class=lnlinks href=#hl-20-65> 65</a>
</span><span class=lnt id=hl-20-66><a class=lnlinks href=#hl-20-66> 66</a>
</span><span class=lnt id=hl-20-67><a class=lnlinks href=#hl-20-67> 67</a>
</span><span class=lnt id=hl-20-68><a class=lnlinks href=#hl-20-68> 68</a>
</span><span class=lnt id=hl-20-69><a class=lnlinks href=#hl-20-69> 69</a>
</span><span class=lnt id=hl-20-70><a class=lnlinks href=#hl-20-70> 70</a>
</span><span class=lnt id=hl-20-71><a class=lnlinks href=#hl-20-71> 71</a>
</span><span class=lnt id=hl-20-72><a class=lnlinks href=#hl-20-72> 72</a>
</span><span class=lnt id=hl-20-73><a class=lnlinks href=#hl-20-73> 73</a>
</span><span class=lnt id=hl-20-74><a class=lnlinks href=#hl-20-74> 74</a>
</span><span class=lnt id=hl-20-75><a class=lnlinks href=#hl-20-75> 75</a>
</span><span class=lnt id=hl-20-76><a class=lnlinks href=#hl-20-76> 76</a>
</span><span class=lnt id=hl-20-77><a class=lnlinks href=#hl-20-77> 77</a>
</span><span class=lnt id=hl-20-78><a class=lnlinks href=#hl-20-78> 78</a>
</span><span class=lnt id=hl-20-79><a class=lnlinks href=#hl-20-79> 79</a>
</span><span class=lnt id=hl-20-80><a class=lnlinks href=#hl-20-80> 80</a>
</span><span class=lnt id=hl-20-81><a class=lnlinks href=#hl-20-81> 81</a>
</span><span class=lnt id=hl-20-82><a class=lnlinks href=#hl-20-82> 82</a>
</span><span class=lnt id=hl-20-83><a class=lnlinks href=#hl-20-83> 83</a>
</span><span class=lnt id=hl-20-84><a class=lnlinks href=#hl-20-84> 84</a>
</span><span class=lnt id=hl-20-85><a class=lnlinks href=#hl-20-85> 85</a>
</span><span class=lnt id=hl-20-86><a class=lnlinks href=#hl-20-86> 86</a>
</span><span class=lnt id=hl-20-87><a class=lnlinks href=#hl-20-87> 87</a>
</span><span class=lnt id=hl-20-88><a class=lnlinks href=#hl-20-88> 88</a>
</span><span class=lnt id=hl-20-89><a class=lnlinks href=#hl-20-89> 89</a>
</span><span class=lnt id=hl-20-90><a class=lnlinks href=#hl-20-90> 90</a>
</span><span class=lnt id=hl-20-91><a class=lnlinks href=#hl-20-91> 91</a>
</span><span class=lnt id=hl-20-92><a class=lnlinks href=#hl-20-92> 92</a>
</span><span class=lnt id=hl-20-93><a class=lnlinks href=#hl-20-93> 93</a>
</span><span class=lnt id=hl-20-94><a class=lnlinks href=#hl-20-94> 94</a>
</span><span class=lnt id=hl-20-95><a class=lnlinks href=#hl-20-95> 95</a>
</span><span class=lnt id=hl-20-96><a class=lnlinks href=#hl-20-96> 96</a>
</span><span class=lnt id=hl-20-97><a class=lnlinks href=#hl-20-97> 97</a>
</span><span class=lnt id=hl-20-98><a class=lnlinks href=#hl-20-98> 98</a>
</span><span class=lnt id=hl-20-99><a class=lnlinks href=#hl-20-99> 99</a>
</span><span class=lnt id=hl-20-100><a class=lnlinks href=#hl-20-100>100</a>
</span><span class=lnt id=hl-20-101><a class=lnlinks href=#hl-20-101>101</a>
</span><span class=lnt id=hl-20-102><a class=lnlinks href=#hl-20-102>102</a>
</span><span class=lnt id=hl-20-103><a class=lnlinks href=#hl-20-103>103</a>
</span><span class=lnt id=hl-20-104><a class=lnlinks href=#hl-20-104>104</a>
</span><span class=lnt id=hl-20-105><a class=lnlinks href=#hl-20-105>105</a>
</span><span class=lnt id=hl-20-106><a class=lnlinks href=#hl-20-106>106</a>
</span><span class=lnt id=hl-20-107><a class=lnlinks href=#hl-20-107>107</a>
</span><span class=lnt id=hl-20-108><a class=lnlinks href=#hl-20-108>108</a>
</span><span class=lnt id=hl-20-109><a class=lnlinks href=#hl-20-109>109</a>
</span><span class=lnt id=hl-20-110><a class=lnlinks href=#hl-20-110>110</a>
</span><span class=lnt id=hl-20-111><a class=lnlinks href=#hl-20-111>111</a>
</span><span class=lnt id=hl-20-112><a class=lnlinks href=#hl-20-112>112</a>
</span><span class=lnt id=hl-20-113><a class=lnlinks href=#hl-20-113>113</a>
</span><span class=lnt id=hl-20-114><a class=lnlinks href=#hl-20-114>114</a>
</span><span class=lnt id=hl-20-115><a class=lnlinks href=#hl-20-115>115</a>
</span><span class=lnt id=hl-20-116><a class=lnlinks href=#hl-20-116>116</a>
</span><span class=lnt id=hl-20-117><a class=lnlinks href=#hl-20-117>117</a>
</span><span class=lnt id=hl-20-118><a class=lnlinks href=#hl-20-118>118</a>
</span><span class=lnt id=hl-20-119><a class=lnlinks href=#hl-20-119>119</a>
</span><span class=lnt id=hl-20-120><a class=lnlinks href=#hl-20-120>120</a>
</span><span class=lnt id=hl-20-121><a class=lnlinks href=#hl-20-121>121</a>
</span><span class=lnt id=hl-20-122><a class=lnlinks href=#hl-20-122>122</a>
</span><span class=lnt id=hl-20-123><a class=lnlinks href=#hl-20-123>123</a>
</span><span class=lnt id=hl-20-124><a class=lnlinks href=#hl-20-124>124</a>
</span><span class=lnt id=hl-20-125><a class=lnlinks href=#hl-20-125>125</a>
</span><span class=lnt id=hl-20-126><a class=lnlinks href=#hl-20-126>126</a>
</span><span class=lnt id=hl-20-127><a class=lnlinks href=#hl-20-127>127</a>
</span><span class=lnt id=hl-20-128><a class=lnlinks href=#hl-20-128>128</a>
</span><span class=lnt id=hl-20-129><a class=lnlinks href=#hl-20-129>129</a>
</span><span class=lnt id=hl-20-130><a class=lnlinks href=#hl-20-130>130</a>
</span><span class=lnt id=hl-20-131><a class=lnlinks href=#hl-20-131>131</a>
</span><span class=lnt id=hl-20-132><a class=lnlinks href=#hl-20-132>132</a>
</span><span class=lnt id=hl-20-133><a class=lnlinks href=#hl-20-133>133</a>
</span><span class=lnt id=hl-20-134><a class=lnlinks href=#hl-20-134>134</a>
</span><span class=lnt id=hl-20-135><a class=lnlinks href=#hl-20-135>135</a>
</span><span class=lnt id=hl-20-136><a class=lnlinks href=#hl-20-136>136</a>
</span><span class=lnt id=hl-20-137><a class=lnlinks href=#hl-20-137>137</a>
</span><span class=lnt id=hl-20-138><a class=lnlinks href=#hl-20-138>138</a>
</span><span class=lnt id=hl-20-139><a class=lnlinks href=#hl-20-139>139</a>
</span><span class=lnt id=hl-20-140><a class=lnlinks href=#hl-20-140>140</a>
</span><span class=lnt id=hl-20-141><a class=lnlinks href=#hl-20-141>141</a>
</span><span class=lnt id=hl-20-142><a class=lnlinks href=#hl-20-142>142</a>
</span><span class=lnt id=hl-20-143><a class=lnlinks href=#hl-20-143>143</a>
</span><span class=lnt id=hl-20-144><a class=lnlinks href=#hl-20-144>144</a>
</span><span class=lnt id=hl-20-145><a class=lnlinks href=#hl-20-145>145</a>
</span><span class=lnt id=hl-20-146><a class=lnlinks href=#hl-20-146>146</a>
</span><span class=lnt id=hl-20-147><a class=lnlinks href=#hl-20-147>147</a>
</span><span class=lnt id=hl-20-148><a class=lnlinks href=#hl-20-148>148</a>
</span><span class=lnt id=hl-20-149><a class=lnlinks href=#hl-20-149>149</a>
</span><span class=lnt id=hl-20-150><a class=lnlinks href=#hl-20-150>150</a>
</span><span class=lnt id=hl-20-151><a class=lnlinks href=#hl-20-151>151</a>
</span><span class=lnt id=hl-20-152><a class=lnlinks href=#hl-20-152>152</a>
</span><span class=lnt id=hl-20-153><a class=lnlinks href=#hl-20-153>153</a>
</span><span class=lnt id=hl-20-154><a class=lnlinks href=#hl-20-154>154</a>
</span><span class=lnt id=hl-20-155><a class=lnlinks href=#hl-20-155>155</a>
</span><span class=lnt id=hl-20-156><a class=lnlinks href=#hl-20-156>156</a>
</span><span class=lnt id=hl-20-157><a class=lnlinks href=#hl-20-157>157</a>
</span><span class=lnt id=hl-20-158><a class=lnlinks href=#hl-20-158>158</a>
</span><span class=lnt id=hl-20-159><a class=lnlinks href=#hl-20-159>159</a>
</span><span class=lnt id=hl-20-160><a class=lnlinks href=#hl-20-160>160</a>
</span><span class=lnt id=hl-20-161><a class=lnlinks href=#hl-20-161>161</a>
</span><span class=lnt id=hl-20-162><a class=lnlinks href=#hl-20-162>162</a>
</span><span class=lnt id=hl-20-163><a class=lnlinks href=#hl-20-163>163</a>
</span><span class=lnt id=hl-20-164><a class=lnlinks href=#hl-20-164>164</a>
</span><span class=lnt id=hl-20-165><a class=lnlinks href=#hl-20-165>165</a>
</span><span class=lnt id=hl-20-166><a class=lnlinks href=#hl-20-166>166</a>
</span><span class=lnt id=hl-20-167><a class=lnlinks href=#hl-20-167>167</a>
</span><span class=lnt id=hl-20-168><a class=lnlinks href=#hl-20-168>168</a>
</span><span class=lnt id=hl-20-169><a class=lnlinks href=#hl-20-169>169</a>
</span><span class=lnt id=hl-20-170><a class=lnlinks href=#hl-20-170>170</a>
</span><span class=lnt id=hl-20-171><a class=lnlinks href=#hl-20-171>171</a>
</span><span class=lnt id=hl-20-172><a class=lnlinks href=#hl-20-172>172</a>
</span><span class=lnt id=hl-20-173><a class=lnlinks href=#hl-20-173>173</a>
</span><span class=lnt id=hl-20-174><a class=lnlinks href=#hl-20-174>174</a>
</span><span class=lnt id=hl-20-175><a class=lnlinks href=#hl-20-175>175</a>
</span><span class=lnt id=hl-20-176><a class=lnlinks href=#hl-20-176>176</a>
</span><span class=lnt id=hl-20-177><a class=lnlinks href=#hl-20-177>177</a>
</span><span class=lnt id=hl-20-178><a class=lnlinks href=#hl-20-178>178</a>
</span><span class=lnt id=hl-20-179><a class=lnlinks href=#hl-20-179>179</a>
</span><span class=lnt id=hl-20-180><a class=lnlinks href=#hl-20-180>180</a>
</span><span class=lnt id=hl-20-181><a class=lnlinks href=#hl-20-181>181</a>
</span><span class=lnt id=hl-20-182><a class=lnlinks href=#hl-20-182>182</a>
</span><span class=lnt id=hl-20-183><a class=lnlinks href=#hl-20-183>183</a>
</span><span class=lnt id=hl-20-184><a class=lnlinks href=#hl-20-184>184</a>
</span><span class=lnt id=hl-20-185><a class=lnlinks href=#hl-20-185>185</a>
</span><span class=lnt id=hl-20-186><a class=lnlinks href=#hl-20-186>186</a>
</span><span class=lnt id=hl-20-187><a class=lnlinks href=#hl-20-187>187</a>
</span><span class=lnt id=hl-20-188><a class=lnlinks href=#hl-20-188>188</a>
</span><span class=lnt id=hl-20-189><a class=lnlinks href=#hl-20-189>189</a>
</span><span class=lnt id=hl-20-190><a class=lnlinks href=#hl-20-190>190</a>
</span><span class=lnt id=hl-20-191><a class=lnlinks href=#hl-20-191>191</a>
</span><span class=lnt id=hl-20-192><a class=lnlinks href=#hl-20-192>192</a>
</span><span class=lnt id=hl-20-193><a class=lnlinks href=#hl-20-193>193</a>
</span><span class=lnt id=hl-20-194><a class=lnlinks href=#hl-20-194>194</a>
</span><span class=lnt id=hl-20-195><a class=lnlinks href=#hl-20-195>195</a>
</span><span class=lnt id=hl-20-196><a class=lnlinks href=#hl-20-196>196</a>
</span><span class=lnt id=hl-20-197><a class=lnlinks href=#hl-20-197>197</a>
</span><span class=lnt id=hl-20-198><a class=lnlinks href=#hl-20-198>198</a>
</span><span class=lnt id=hl-20-199><a class=lnlinks href=#hl-20-199>199</a>
</span><span class=lnt id=hl-20-200><a class=lnlinks href=#hl-20-200>200</a>
</span><span class=lnt id=hl-20-201><a class=lnlinks href=#hl-20-201>201</a>
</span><span class=lnt id=hl-20-202><a class=lnlinks href=#hl-20-202>202</a>
</span><span class=lnt id=hl-20-203><a class=lnlinks href=#hl-20-203>203</a>
</span><span class=lnt id=hl-20-204><a class=lnlinks href=#hl-20-204>204</a>
</span><span class=lnt id=hl-20-205><a class=lnlinks href=#hl-20-205>205</a>
</span><span class=lnt id=hl-20-206><a class=lnlinks href=#hl-20-206>206</a>
</span><span class=lnt id=hl-20-207><a class=lnlinks href=#hl-20-207>207</a>
</span><span class=lnt id=hl-20-208><a class=lnlinks href=#hl-20-208>208</a>
</span><span class=lnt id=hl-20-209><a class=lnlinks href=#hl-20-209>209</a>
</span><span class=lnt id=hl-20-210><a class=lnlinks href=#hl-20-210>210</a>
</span><span class=lnt id=hl-20-211><a class=lnlinks href=#hl-20-211>211</a>
</span><span class=lnt id=hl-20-212><a class=lnlinks href=#hl-20-212>212</a>
</span><span class=lnt id=hl-20-213><a class=lnlinks href=#hl-20-213>213</a>
</span><span class=lnt id=hl-20-214><a class=lnlinks href=#hl-20-214>214</a>
</span><span class=lnt id=hl-20-215><a class=lnlinks href=#hl-20-215>215</a>
</span><span class=lnt id=hl-20-216><a class=lnlinks href=#hl-20-216>216</a>
</span><span class=lnt id=hl-20-217><a class=lnlinks href=#hl-20-217>217</a>
</span><span class=lnt id=hl-20-218><a class=lnlinks href=#hl-20-218>218</a>
</span><span class=lnt id=hl-20-219><a class=lnlinks href=#hl-20-219>219</a>
</span><span class=lnt id=hl-20-220><a class=lnlinks href=#hl-20-220>220</a>
</span><span class=lnt id=hl-20-221><a class=lnlinks href=#hl-20-221>221</a>
</span><span class=lnt id=hl-20-222><a class=lnlinks href=#hl-20-222>222</a>
</span><span class=lnt id=hl-20-223><a class=lnlinks href=#hl-20-223>223</a>
</span><span class=lnt id=hl-20-224><a class=lnlinks href=#hl-20-224>224</a>
</span><span class=lnt id=hl-20-225><a class=lnlinks href=#hl-20-225>225</a>
</span><span class=lnt id=hl-20-226><a class=lnlinks href=#hl-20-226>226</a>
</span><span class=lnt id=hl-20-227><a class=lnlinks href=#hl-20-227>227</a>
</span><span class=lnt id=hl-20-228><a class=lnlinks href=#hl-20-228>228</a>
</span><span class=lnt id=hl-20-229><a class=lnlinks href=#hl-20-229>229</a>
</span><span class=lnt id=hl-20-230><a class=lnlinks href=#hl-20-230>230</a>
</span><span class=lnt id=hl-20-231><a class=lnlinks href=#hl-20-231>231</a>
</span><span class=lnt id=hl-20-232><a class=lnlinks href=#hl-20-232>232</a>
</span><span class=lnt id=hl-20-233><a class=lnlinks href=#hl-20-233>233</a>
</span><span class=lnt id=hl-20-234><a class=lnlinks href=#hl-20-234>234</a>
</span><span class=lnt id=hl-20-235><a class=lnlinks href=#hl-20-235>235</a>
</span><span class=lnt id=hl-20-236><a class=lnlinks href=#hl-20-236>236</a>
</span><span class=lnt id=hl-20-237><a class=lnlinks href=#hl-20-237>237</a>
</span><span class=lnt id=hl-20-238><a class=lnlinks href=#hl-20-238>238</a>
</span><span class=lnt id=hl-20-239><a class=lnlinks href=#hl-20-239>239</a>
</span><span class=lnt id=hl-20-240><a class=lnlinks href=#hl-20-240>240</a>
</span><span class=lnt id=hl-20-241><a class=lnlinks href=#hl-20-241>241</a>
</span><span class=lnt id=hl-20-242><a class=lnlinks href=#hl-20-242>242</a>
</span><span class=lnt id=hl-20-243><a class=lnlinks href=#hl-20-243>243</a>
</span><span class=lnt id=hl-20-244><a class=lnlinks href=#hl-20-244>244</a>
</span><span class=lnt id=hl-20-245><a class=lnlinks href=#hl-20-245>245</a>
</span><span class=lnt id=hl-20-246><a class=lnlinks href=#hl-20-246>246</a>
</span><span class=lnt id=hl-20-247><a class=lnlinks href=#hl-20-247>247</a>
</span><span class=lnt id=hl-20-248><a class=lnlinks href=#hl-20-248>248</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 API 사용량 기반 과금 시스템
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>mongoose</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mongoose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 요금제 스키마
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>planSchema</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>code</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>price</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>billingCycle</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> <span class=kr>enum</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;monthly&#39;</span><span class=p>,</span> <span class=s1>&#39;yearly&#39;</span><span class=p>],</span> <span class=k>default</span><span class=o>:</span> <span class=s1>&#39;monthly&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>limits</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>requestsPerDay</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>requestsPerMonth</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>rateLimitPerSecond</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointsAllowed</span><span class=o>:</span> <span class=p>[</span><span class=nb>String</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>features</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>supportEmail</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>supportPhone</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>dedicatedSupport</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>customDomain</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>analyticsAccess</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>overage</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>ratePerThousand</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 구독 스키마
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>subscriptionSchema</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>userId</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nx>Types</span><span class=p>.</span><span class=nx>ObjectId</span><span class=p>,</span> <span class=nx>ref</span><span class=o>:</span> <span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>planId</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nx>Types</span><span class=p>.</span><span class=nx>ObjectId</span><span class=p>,</span> <span class=nx>ref</span><span class=o>:</span> <span class=s1>&#39;Plan&#39;</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>apiKeys</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>type</span><span class=o>:</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nx>Types</span><span class=p>.</span><span class=nx>ObjectId</span><span class=p>,</span> <span class=nx>ref</span><span class=o>:</span> <span class=s1>&#39;ApiKey&#39;</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>  <span class=nx>status</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=kr>enum</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;active&#39;</span><span class=p>,</span> <span class=s1>&#39;past_due&#39;</span><span class=p>,</span> <span class=s1>&#39;canceled&#39;</span><span class=p>,</span> <span class=s1>&#39;trialing&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span> <span class=s1>&#39;active&#39;</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>currentPeriodStart</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Date</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>currentPeriodEnd</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Date</span><span class=p>,</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancelAtPeriodEnd</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Boolean</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>paymentMethod</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>usageThisMonth</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=mi>0</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>overageCharges</span><span class=o>:</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span> <span class=k>default</span><span class=o>:</span> <span class=mi>0</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>lastBillingDate</span><span class=o>:</span> <span class=nb>Date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>nextBillingDate</span><span class=o>:</span> <span class=nb>Date</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Plan</span> <span class=o>=</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>model</span><span class=p>(</span><span class=s1>&#39;Plan&#39;</span><span class=p>,</span> <span class=nx>planSchema</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Subscription</span> <span class=o>=</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>model</span><span class=p>(</span><span class=s1>&#39;Subscription&#39;</span><span class=p>,</span> <span class=nx>subscriptionSchema</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 과금 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BillingService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>redisClient</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span> <span class=o>=</span> <span class=nx>redisClient</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 사용량 기록 및 한도 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>trackUsage</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>,</span> <span class=nx>endpoint</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// API 키 세부 정보 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>keyDetails</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ApiKey</span><span class=p>.</span><span class=nx>findOne</span><span class=p>({</span> <span class=nx>key</span><span class=o>:</span> <span class=nx>apiKey</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>populate</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;subscriptionId&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>populate</span><span class=o>:</span> <span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;planId&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>keyDetails</span> <span class=o>||</span> <span class=o>!</span><span class=nx>keyDetails</span><span class=p>.</span><span class=nx>subscriptionId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;invalid_api_key&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>subscription</span> <span class=o>=</span> <span class=nx>keyDetails</span><span class=p>.</span><span class=nx>subscriptionId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>plan</span> <span class=o>=</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>planId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 구독 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>subscription</span><span class=p>.</span><span class=nx>status</span> <span class=o>!==</span> <span class=s1>&#39;active&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>status</span> <span class=o>!==</span> <span class=s1>&#39;trialing&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;inactive_subscription&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 엔드포인트 액세스 권한 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>endpointsAllowed</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> 
</span></span><span class=line><span class=cl>      <span class=o>!</span><span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>endpointsAllowed</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;*&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> 
</span></span><span class=line><span class=cl>      <span class=o>!</span><span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>endpointsAllowed</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;endpoint_not_allowed&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 요율 제한 확인 (초당 요청)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>rateLimitKey</span> <span class=o>=</span> <span class=sb>`rate_limit:</span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>currentRate</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span><span class=p>.</span><span class=nx>incr</span><span class=p>(</span><span class=nx>rateLimitKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>currentRate</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 1초 후 키 만료
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>rateLimitKey</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>currentRate</span> <span class=o>&gt;</span> <span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>rateLimitPerSecond</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;rate_limit_exceeded&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 일일 사용량 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>today</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>dailyUsageKey</span> <span class=o>=</span> <span class=sb>`usage:daily:</span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>today</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>dailyUsage</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span><span class=p>.</span><span class=nx>incr</span><span class=p>(</span><span class=nx>dailyUsageKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>dailyUsage</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 하루 후 키 만료
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>dailyUsageKey</span><span class=p>,</span> <span class=mi>86400</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>dailyUsage</span> <span class=o>&gt;</span> <span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>requestsPerDay</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;daily_limit_exceeded&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 월간 사용량 확인 및 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>monthStart</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>monthStart</span><span class=p>.</span><span class=nx>setDate</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>monthStart</span><span class=p>.</span><span class=nx>setHours</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>monthEnd</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>monthStart</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>monthEnd</span><span class=p>.</span><span class=nx>setMonth</span><span class=p>(</span><span class=nx>monthEnd</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>monthEnd</span><span class=p>.</span><span class=nx>setDate</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>monthEnd</span><span class=p>.</span><span class=nx>setHours</span><span class=p>(</span><span class=mi>23</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>999</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>monthlyUsageKey</span> <span class=o>=</span> <span class=sb>`usage:monthly:</span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>monthStart</span><span class=p>.</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>monthlyUsage</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span><span class=p>.</span><span class=nx>incr</span><span class=p>(</span><span class=nx>monthlyUsageKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>monthlyUsage</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 월말까지 키 만료
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>ttl</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>((</span><span class=nx>monthEnd</span> <span class=o>-</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>())</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>monthlyUsageKey</span><span class=p>,</span> <span class=nx>ttl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 월간 한도 초과 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>monthlyUsage</span> <span class=o>&gt;</span> <span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>requestsPerMonth</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 초과 사용량 요금 허용 여부 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>plan</span><span class=p>.</span><span class=nx>overage</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;monthly_limit_exceeded&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 초과 사용량 추적
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>Subscription</span><span class=p>.</span><span class=nx>updateOne</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>_id</span><span class=o>:</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>_id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> 
</span></span><span class=line><span class=cl>          <span class=nx>$inc</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=nx>usageThisMonth</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>overageCharges</span><span class=o>:</span> <span class=nx>plan</span><span class=p>.</span><span class=nx>overage</span><span class=p>.</span><span class=nx>ratePerThousand</span> <span class=o>/</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 일반 사용량 추적
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>Subscription</span><span class=p>.</span><span class=nx>updateOne</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>_id</span><span class=o>:</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>_id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>$inc</span><span class=o>:</span> <span class=p>{</span> <span class=nx>usageThisMonth</span><span class=o>:</span> <span class=mi>1</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 사용 허용
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span> <span class=nx>allowed</span><span class=o>:</span> <span class=kc>true</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 월간 청구 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>processMonthlyBilling</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 오늘이 청구일인 구독 찾기
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>subscriptionsToProcess</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Subscription</span><span class=p>.</span><span class=nx>find</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=p>{</span> <span class=nx>$in</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;active&#39;</span><span class=p>,</span> <span class=s1>&#39;past_due&#39;</span><span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>nextBillingDate</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nx>$gte</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>now</span><span class=p>.</span><span class=nx>setHours</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=nx>$lte</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>now</span><span class=p>.</span><span class=nx>setHours</span><span class=p>(</span><span class=mi>23</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>999</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=nx>populate</span><span class=p>(</span><span class=s1>&#39;planId userId&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>subscription</span> <span class=k>of</span> <span class=nx>subscriptionsToProcess</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 요금 청구
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>planCharge</span> <span class=o>=</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>planId</span><span class=p>.</span><span class=nx>price</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 초과 사용량 요금 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>overageCharge</span> <span class=o>=</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>overageCharges</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 총 청구 금액
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>totalCharge</span> <span class=o>=</span> <span class=nx>planCharge</span> <span class=o>+</span> <span class=nx>overageCharge</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 지불 처리 (결제 서비스 통합)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>paymentResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processPayment</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=nx>subscription</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>subscription</span><span class=p>.</span><span class=nx>paymentMethod</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>totalCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=sb>`API 서비스 - </span><span class=si>${</span><span class=nx>subscription</span><span class=p>.</span><span class=nx>planId</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb> 요금제`</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>paymentResult</span><span class=p>.</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 다음 청구 기간 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>const</span> <span class=nx>nextBillingDate</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>subscription</span><span class=p>.</span><span class=nx>nextBillingDate</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>nextBillingDate</span><span class=p>.</span><span class=nx>setMonth</span><span class=p>(</span><span class=nx>nextBillingDate</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 구독 정보 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=nx>Subscription</span><span class=p>.</span><span class=nx>updateOne</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>_id</span><span class=o>:</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>_id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;active&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>lastBillingDate</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>              <span class=nx>nextBillingDate</span><span class=o>:</span> <span class=nx>nextBillingDate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>usageThisMonth</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>overageCharges</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>$push</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>billingHistory</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>date</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                  <span class=nx>amount</span><span class=o>:</span> <span class=nx>totalCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>planCharge</span><span class=o>:</span> <span class=nx>planCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>overageCharge</span><span class=o>:</span> <span class=nx>overageCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;paid&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 결제 실패 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=nx>Subscription</span><span class=p>.</span><span class=nx>updateOne</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>_id</span><span class=o>:</span> <span class=nx>subscription</span><span class=p>.</span><span class=nx>_id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;past_due&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>$push</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>billingHistory</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>date</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                  <span class=nx>amount</span><span class=o>:</span> <span class=nx>totalCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>planCharge</span><span class=o>:</span> <span class=nx>planCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>overageCharge</span><span class=o>:</span> <span class=nx>overageCharge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>failureReason</span><span class=o>:</span> <span class=nx>paymentResult</span><span class=p>.</span><span class=nx>error</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 결제 실패 알림 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendPaymentFailureNotification</span><span class=p>(</span><span class=nx>subscription</span><span class=p>.</span><span class=nx>userId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`구독 ID </span><span class=si>${</span><span class=nx>subscription</span><span class=p>.</span><span class=nx>_id</span><span class=si>}</span><span class=sb> 청구 처리 중 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=요금제-티어-설계>요금제 티어 설계<a hidden class=anchor aria-hidden=true href=#요금제-티어-설계>#</a></h4><p>API 서비스의 요금제 티어는 사용자의 다양한 요구와 예산에 맞게 설계되어야 한다:</p><ol><li><strong>무료 티어</strong>:<ul><li>제한된 API 호출 수 (예: 월 1,000회)</li><li>기본 엔드포인트만 접근 가능</li><li>낮은 속도 제한 (초당 요청 수 제한)</li><li>최소한의 지원</li><li>샌드박스 환경만 사용 가능</li></ul></li><li><strong>기본 티어</strong>:<ul><li>중간 수준의 API 호출 수 (예: 월 10,000회)</li><li>대부분의 엔드포인트 접근 가능</li><li>적절한 속도 제한</li><li>이메일 지원</li><li>생산 환경 접근</li></ul></li><li><strong>프로 티어</strong>:<ul><li>높은 API 호출 수 (예: 월 100,000회)</li><li>모든 엔드포인트 접근 가능</li><li>높은 속도 제한</li><li>우선 지원 및 전담 지원 매니저</li><li>고급 분석 및 보고 기능</li></ul></li><li><strong>엔터프라이즈 티어</strong>:<ul><li>맞춤형 API 호출 볼륨</li><li>전용 인프라 옵션</li><li>무제한 속도 제한</li><li>SLA(서비스 수준 계약) 제공</li><li>전담 계정 관리자</li><li>맞춤형 통합 지원</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>  1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>  2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>  3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>  4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>  5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>  6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>  7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8>  8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9>  9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10> 10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11> 11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12> 12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13> 13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14> 14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15> 15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16> 16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17> 17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18> 18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19> 19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20> 20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21> 21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22> 22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23> 23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24> 24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25> 25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26> 26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27> 27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28> 28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29> 29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30> 30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31> 31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32> 32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33> 33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34> 34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35> 35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36> 36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37> 37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38> 38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39> 39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40> 40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41> 41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42> 42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43> 43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44> 44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45> 45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46> 46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47> 47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48> 48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49> 49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50> 50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51> 51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52> 52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53> 53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54> 54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55> 55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56> 56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57> 57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58> 58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59> 59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60> 60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61> 61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62> 62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63> 63</a>
</span><span class=lnt id=hl-21-64><a class=lnlinks href=#hl-21-64> 64</a>
</span><span class=lnt id=hl-21-65><a class=lnlinks href=#hl-21-65> 65</a>
</span><span class=lnt id=hl-21-66><a class=lnlinks href=#hl-21-66> 66</a>
</span><span class=lnt id=hl-21-67><a class=lnlinks href=#hl-21-67> 67</a>
</span><span class=lnt id=hl-21-68><a class=lnlinks href=#hl-21-68> 68</a>
</span><span class=lnt id=hl-21-69><a class=lnlinks href=#hl-21-69> 69</a>
</span><span class=lnt id=hl-21-70><a class=lnlinks href=#hl-21-70> 70</a>
</span><span class=lnt id=hl-21-71><a class=lnlinks href=#hl-21-71> 71</a>
</span><span class=lnt id=hl-21-72><a class=lnlinks href=#hl-21-72> 72</a>
</span><span class=lnt id=hl-21-73><a class=lnlinks href=#hl-21-73> 73</a>
</span><span class=lnt id=hl-21-74><a class=lnlinks href=#hl-21-74> 74</a>
</span><span class=lnt id=hl-21-75><a class=lnlinks href=#hl-21-75> 75</a>
</span><span class=lnt id=hl-21-76><a class=lnlinks href=#hl-21-76> 76</a>
</span><span class=lnt id=hl-21-77><a class=lnlinks href=#hl-21-77> 77</a>
</span><span class=lnt id=hl-21-78><a class=lnlinks href=#hl-21-78> 78</a>
</span><span class=lnt id=hl-21-79><a class=lnlinks href=#hl-21-79> 79</a>
</span><span class=lnt id=hl-21-80><a class=lnlinks href=#hl-21-80> 80</a>
</span><span class=lnt id=hl-21-81><a class=lnlinks href=#hl-21-81> 81</a>
</span><span class=lnt id=hl-21-82><a class=lnlinks href=#hl-21-82> 82</a>
</span><span class=lnt id=hl-21-83><a class=lnlinks href=#hl-21-83> 83</a>
</span><span class=lnt id=hl-21-84><a class=lnlinks href=#hl-21-84> 84</a>
</span><span class=lnt id=hl-21-85><a class=lnlinks href=#hl-21-85> 85</a>
</span><span class=lnt id=hl-21-86><a class=lnlinks href=#hl-21-86> 86</a>
</span><span class=lnt id=hl-21-87><a class=lnlinks href=#hl-21-87> 87</a>
</span><span class=lnt id=hl-21-88><a class=lnlinks href=#hl-21-88> 88</a>
</span><span class=lnt id=hl-21-89><a class=lnlinks href=#hl-21-89> 89</a>
</span><span class=lnt id=hl-21-90><a class=lnlinks href=#hl-21-90> 90</a>
</span><span class=lnt id=hl-21-91><a class=lnlinks href=#hl-21-91> 91</a>
</span><span class=lnt id=hl-21-92><a class=lnlinks href=#hl-21-92> 92</a>
</span><span class=lnt id=hl-21-93><a class=lnlinks href=#hl-21-93> 93</a>
</span><span class=lnt id=hl-21-94><a class=lnlinks href=#hl-21-94> 94</a>
</span><span class=lnt id=hl-21-95><a class=lnlinks href=#hl-21-95> 95</a>
</span><span class=lnt id=hl-21-96><a class=lnlinks href=#hl-21-96> 96</a>
</span><span class=lnt id=hl-21-97><a class=lnlinks href=#hl-21-97> 97</a>
</span><span class=lnt id=hl-21-98><a class=lnlinks href=#hl-21-98> 98</a>
</span><span class=lnt id=hl-21-99><a class=lnlinks href=#hl-21-99> 99</a>
</span><span class=lnt id=hl-21-100><a class=lnlinks href=#hl-21-100>100</a>
</span><span class=lnt id=hl-21-101><a class=lnlinks href=#hl-21-101>101</a>
</span><span class=lnt id=hl-21-102><a class=lnlinks href=#hl-21-102>102</a>
</span><span class=lnt id=hl-21-103><a class=lnlinks href=#hl-21-103>103</a>
</span><span class=lnt id=hl-21-104><a class=lnlinks href=#hl-21-104>104</a>
</span><span class=lnt id=hl-21-105><a class=lnlinks href=#hl-21-105>105</a>
</span><span class=lnt id=hl-21-106><a class=lnlinks href=#hl-21-106>106</a>
</span><span class=lnt id=hl-21-107><a class=lnlinks href=#hl-21-107>107</a>
</span><span class=lnt id=hl-21-108><a class=lnlinks href=#hl-21-108>108</a>
</span><span class=lnt id=hl-21-109><a class=lnlinks href=#hl-21-109>109</a>
</span><span class=lnt id=hl-21-110><a class=lnlinks href=#hl-21-110>110</a>
</span><span class=lnt id=hl-21-111><a class=lnlinks href=#hl-21-111>111</a>
</span><span class=lnt id=hl-21-112><a class=lnlinks href=#hl-21-112>112</a>
</span><span class=lnt id=hl-21-113><a class=lnlinks href=#hl-21-113>113</a>
</span><span class=lnt id=hl-21-114><a class=lnlinks href=#hl-21-114>114</a>
</span><span class=lnt id=hl-21-115><a class=lnlinks href=#hl-21-115>115</a>
</span><span class=lnt id=hl-21-116><a class=lnlinks href=#hl-21-116>116</a>
</span><span class=lnt id=hl-21-117><a class=lnlinks href=#hl-21-117>117</a>
</span><span class=lnt id=hl-21-118><a class=lnlinks href=#hl-21-118>118</a>
</span><span class=lnt id=hl-21-119><a class=lnlinks href=#hl-21-119>119</a>
</span><span class=lnt id=hl-21-120><a class=lnlinks href=#hl-21-120>120</a>
</span><span class=lnt id=hl-21-121><a class=lnlinks href=#hl-21-121>121</a>
</span><span class=lnt id=hl-21-122><a class=lnlinks href=#hl-21-122>122</a>
</span><span class=lnt id=hl-21-123><a class=lnlinks href=#hl-21-123>123</a>
</span><span class=lnt id=hl-21-124><a class=lnlinks href=#hl-21-124>124</a>
</span><span class=lnt id=hl-21-125><a class=lnlinks href=#hl-21-125>125</a>
</span><span class=lnt id=hl-21-126><a class=lnlinks href=#hl-21-126>126</a>
</span><span class=lnt id=hl-21-127><a class=lnlinks href=#hl-21-127>127</a>
</span><span class=lnt id=hl-21-128><a class=lnlinks href=#hl-21-128>128</a>
</span><span class=lnt id=hl-21-129><a class=lnlinks href=#hl-21-129>129</a>
</span><span class=lnt id=hl-21-130><a class=lnlinks href=#hl-21-130>130</a>
</span><span class=lnt id=hl-21-131><a class=lnlinks href=#hl-21-131>131</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 프론트엔드에서 요금제 티어 표시 예시 (React)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>PricingPlans</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>plans</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;무료&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>features</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;월 1,000 API 호출&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;기본 엔드포인트&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;초당 2 요청&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;커뮤니티 지원&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;샌드박스 환경&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>limits</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requests</span><span class=o>:</span> <span class=s1>&#39;1,000/월&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>endpoints</span><span class=o>:</span> <span class=s1>&#39;기본&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rateLimit</span><span class=o>:</span> <span class=s1>&#39;2/초&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>recommended</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;기본&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span><span class=o>:</span> <span class=mi>29</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>features</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;월 10,000 API 호출&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;표준 엔드포인트&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;초당 5 요청&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;이메일 지원&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;생산 환경&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;기본 분석&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>limits</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requests</span><span class=o>:</span> <span class=s1>&#39;10,000/월&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>endpoints</span><span class=o>:</span> <span class=s1>&#39;표준&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rateLimit</span><span class=o>:</span> <span class=s1>&#39;5/초&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>recommended</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;프로&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span><span class=o>:</span> <span class=mi>99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>features</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;월 100,000 API 호출&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;모든 엔드포인트&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;초당 20 요청&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;우선 지원&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;고급 분석&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;전용 API 키&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>limits</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requests</span><span class=o>:</span> <span class=s1>&#39;100,000/월&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>endpoints</span><span class=o>:</span> <span class=s1>&#39;전체&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rateLimit</span><span class=o>:</span> <span class=s1>&#39;20/초&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>recommended</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;엔터프라이즈&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span><span class=o>:</span> <span class=s1>&#39;문의&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>features</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;맞춤형 API 호출 볼륨&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;전용 엔드포인트&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;맞춤형 속도 제한&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;전담 지원 관리자&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;SLA 보장&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;전용 인프라 옵션&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>limits</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requests</span><span class=o>:</span> <span class=s1>&#39;맞춤형&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>endpoints</span><span class=o>:</span> <span class=s1>&#39;전용 포함&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rateLimit</span><span class=o>:</span> <span class=s1>&#39;맞춤형&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>recommended</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;pricing-plans&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>API</span> <span class=nx>요금제</span><span class=o>&lt;</span><span class=err>/h1&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>p</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;subtitle&#34;</span><span class=o>&gt;</span><span class=nx>API</span> <span class=nx>요구</span> <span class=nx>사항에</span> <span class=nx>가장</span> <span class=nx>적합한</span> <span class=nx>요금제를</span> <span class=nx>선택하세요</span><span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;plans-container&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>plans</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>plan</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>div</span> 
</span></span><span class=line><span class=cl>            <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>            <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`plan-card </span><span class=si>${</span><span class=nx>plan</span><span class=p>.</span><span class=nx>recommended</span> <span class=o>?</span> <span class=s1>&#39;recommended&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>recommended</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;recommended-badge&#34;</span><span class=o>&gt;</span><span class=nx>추천</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>)}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>h2</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;plan-name&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;plan-price&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=k>typeof</span> <span class=nx>plan</span><span class=p>.</span><span class=nx>price</span> <span class=o>===</span> <span class=s1>&#39;number&#39;</span> <span class=o>?</span> 
</span></span><span class=line><span class=cl>                <span class=o>&lt;&gt;</span><span class=nx>$</span><span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>price</span><span class=p>}</span><span class=o>&lt;</span><span class=nx>span</span><span class=o>&gt;</span><span class=err>/월&lt;/span&gt;&lt;/&gt; : </span>
</span></span><span class=line><span class=cl>                <span class=nx>plan</span><span class=p>.</span><span class=nx>price</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;plan-limits&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-item&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-label&#34;</span><span class=o>&gt;</span><span class=nx>API</span> <span class=nx>호출</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-value&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>requests</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-item&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-label&#34;</span><span class=o>&gt;</span><span class=nx>엔드포인트</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-value&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>endpoints</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-item&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-label&#34;</span><span class=o>&gt;</span><span class=nx>속도</span> <span class=nx>제한</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;limit-value&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>limits</span><span class=p>.</span><span class=nx>rateLimit</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>ul</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;features-list&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>features</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>feature</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>feature</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=o>&lt;</span><span class=nx>span</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;feature-icon&#34;</span><span class=o>&gt;</span><span class=err>✓</span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>feature</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>))}</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/ul&gt;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>button</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;select-plan-button&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=nx>plan</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=s1>&#39;엔터프라이즈&#39;</span> <span class=o>?</span> <span class=s1>&#39;영업팀 문의&#39;</span> <span class=o>:</span> <span class=s1>&#39;시작하기&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>))}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=63-초과-사용량-및-스로틀링-전략>6.3 초과 사용량 및 스로틀링 전략<a hidden class=anchor aria-hidden=true href=#63-초과-사용량-및-스로틀링-전략>#</a></h4><p>API 사용량이 할당된 한도를 초과할 때 다양한 전략을 구현할 수 있다:</p><ol><li><strong>하드 캡(Hard Cap)</strong>:<ul><li>할당량에 도달하면 모든 요청 거부</li><li>HTTP 429 (Too Many Requests) 반환</li><li>명확한 오류 메시지로 한도 초과 알림</li></ul></li><li><strong>소프트 캡(Soft Cap)</strong>:<ul><li>할당량 초과 시 요금 부과</li><li>사전 정의된 초과 요금으로 추가 사용 허용</li><li>청구 주기 종료 시 정산</li></ul></li><li><strong>점진적 스로틀링(Throttling)</strong>:<ul><li>할당량에 가까워지면 요청 속도 점진적 감소</li><li>우선순위 기반 요청 처리</li><li>시스템 안정성 유지하면서 사용자 경험 제공</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>  1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2>  2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3>  3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4>  4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5>  5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6>  6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7>  7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8>  8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9>  9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10> 10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11> 11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12> 12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13> 13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14> 14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15> 15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16> 16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17> 17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18> 18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19> 19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20> 20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21> 21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22> 22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23> 23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24> 24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25> 25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26> 26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27> 27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28> 28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29> 29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30> 30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31> 31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32> 32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33> 33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34> 34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35> 35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36> 36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37> 37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38> 38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39> 39</a>
</span><span class=lnt id=hl-22-40><a class=lnlinks href=#hl-22-40> 40</a>
</span><span class=lnt id=hl-22-41><a class=lnlinks href=#hl-22-41> 41</a>
</span><span class=lnt id=hl-22-42><a class=lnlinks href=#hl-22-42> 42</a>
</span><span class=lnt id=hl-22-43><a class=lnlinks href=#hl-22-43> 43</a>
</span><span class=lnt id=hl-22-44><a class=lnlinks href=#hl-22-44> 44</a>
</span><span class=lnt id=hl-22-45><a class=lnlinks href=#hl-22-45> 45</a>
</span><span class=lnt id=hl-22-46><a class=lnlinks href=#hl-22-46> 46</a>
</span><span class=lnt id=hl-22-47><a class=lnlinks href=#hl-22-47> 47</a>
</span><span class=lnt id=hl-22-48><a class=lnlinks href=#hl-22-48> 48</a>
</span><span class=lnt id=hl-22-49><a class=lnlinks href=#hl-22-49> 49</a>
</span><span class=lnt id=hl-22-50><a class=lnlinks href=#hl-22-50> 50</a>
</span><span class=lnt id=hl-22-51><a class=lnlinks href=#hl-22-51> 51</a>
</span><span class=lnt id=hl-22-52><a class=lnlinks href=#hl-22-52> 52</a>
</span><span class=lnt id=hl-22-53><a class=lnlinks href=#hl-22-53> 53</a>
</span><span class=lnt id=hl-22-54><a class=lnlinks href=#hl-22-54> 54</a>
</span><span class=lnt id=hl-22-55><a class=lnlinks href=#hl-22-55> 55</a>
</span><span class=lnt id=hl-22-56><a class=lnlinks href=#hl-22-56> 56</a>
</span><span class=lnt id=hl-22-57><a class=lnlinks href=#hl-22-57> 57</a>
</span><span class=lnt id=hl-22-58><a class=lnlinks href=#hl-22-58> 58</a>
</span><span class=lnt id=hl-22-59><a class=lnlinks href=#hl-22-59> 59</a>
</span><span class=lnt id=hl-22-60><a class=lnlinks href=#hl-22-60> 60</a>
</span><span class=lnt id=hl-22-61><a class=lnlinks href=#hl-22-61> 61</a>
</span><span class=lnt id=hl-22-62><a class=lnlinks href=#hl-22-62> 62</a>
</span><span class=lnt id=hl-22-63><a class=lnlinks href=#hl-22-63> 63</a>
</span><span class=lnt id=hl-22-64><a class=lnlinks href=#hl-22-64> 64</a>
</span><span class=lnt id=hl-22-65><a class=lnlinks href=#hl-22-65> 65</a>
</span><span class=lnt id=hl-22-66><a class=lnlinks href=#hl-22-66> 66</a>
</span><span class=lnt id=hl-22-67><a class=lnlinks href=#hl-22-67> 67</a>
</span><span class=lnt id=hl-22-68><a class=lnlinks href=#hl-22-68> 68</a>
</span><span class=lnt id=hl-22-69><a class=lnlinks href=#hl-22-69> 69</a>
</span><span class=lnt id=hl-22-70><a class=lnlinks href=#hl-22-70> 70</a>
</span><span class=lnt id=hl-22-71><a class=lnlinks href=#hl-22-71> 71</a>
</span><span class=lnt id=hl-22-72><a class=lnlinks href=#hl-22-72> 72</a>
</span><span class=lnt id=hl-22-73><a class=lnlinks href=#hl-22-73> 73</a>
</span><span class=lnt id=hl-22-74><a class=lnlinks href=#hl-22-74> 74</a>
</span><span class=lnt id=hl-22-75><a class=lnlinks href=#hl-22-75> 75</a>
</span><span class=lnt id=hl-22-76><a class=lnlinks href=#hl-22-76> 76</a>
</span><span class=lnt id=hl-22-77><a class=lnlinks href=#hl-22-77> 77</a>
</span><span class=lnt id=hl-22-78><a class=lnlinks href=#hl-22-78> 78</a>
</span><span class=lnt id=hl-22-79><a class=lnlinks href=#hl-22-79> 79</a>
</span><span class=lnt id=hl-22-80><a class=lnlinks href=#hl-22-80> 80</a>
</span><span class=lnt id=hl-22-81><a class=lnlinks href=#hl-22-81> 81</a>
</span><span class=lnt id=hl-22-82><a class=lnlinks href=#hl-22-82> 82</a>
</span><span class=lnt id=hl-22-83><a class=lnlinks href=#hl-22-83> 83</a>
</span><span class=lnt id=hl-22-84><a class=lnlinks href=#hl-22-84> 84</a>
</span><span class=lnt id=hl-22-85><a class=lnlinks href=#hl-22-85> 85</a>
</span><span class=lnt id=hl-22-86><a class=lnlinks href=#hl-22-86> 86</a>
</span><span class=lnt id=hl-22-87><a class=lnlinks href=#hl-22-87> 87</a>
</span><span class=lnt id=hl-22-88><a class=lnlinks href=#hl-22-88> 88</a>
</span><span class=lnt id=hl-22-89><a class=lnlinks href=#hl-22-89> 89</a>
</span><span class=lnt id=hl-22-90><a class=lnlinks href=#hl-22-90> 90</a>
</span><span class=lnt id=hl-22-91><a class=lnlinks href=#hl-22-91> 91</a>
</span><span class=lnt id=hl-22-92><a class=lnlinks href=#hl-22-92> 92</a>
</span><span class=lnt id=hl-22-93><a class=lnlinks href=#hl-22-93> 93</a>
</span><span class=lnt id=hl-22-94><a class=lnlinks href=#hl-22-94> 94</a>
</span><span class=lnt id=hl-22-95><a class=lnlinks href=#hl-22-95> 95</a>
</span><span class=lnt id=hl-22-96><a class=lnlinks href=#hl-22-96> 96</a>
</span><span class=lnt id=hl-22-97><a class=lnlinks href=#hl-22-97> 97</a>
</span><span class=lnt id=hl-22-98><a class=lnlinks href=#hl-22-98> 98</a>
</span><span class=lnt id=hl-22-99><a class=lnlinks href=#hl-22-99> 99</a>
</span><span class=lnt id=hl-22-100><a class=lnlinks href=#hl-22-100>100</a>
</span><span class=lnt id=hl-22-101><a class=lnlinks href=#hl-22-101>101</a>
</span><span class=lnt id=hl-22-102><a class=lnlinks href=#hl-22-102>102</a>
</span><span class=lnt id=hl-22-103><a class=lnlinks href=#hl-22-103>103</a>
</span><span class=lnt id=hl-22-104><a class=lnlinks href=#hl-22-104>104</a>
</span><span class=lnt id=hl-22-105><a class=lnlinks href=#hl-22-105>105</a>
</span><span class=lnt id=hl-22-106><a class=lnlinks href=#hl-22-106>106</a>
</span><span class=lnt id=hl-22-107><a class=lnlinks href=#hl-22-107>107</a>
</span><span class=lnt id=hl-22-108><a class=lnlinks href=#hl-22-108>108</a>
</span><span class=lnt id=hl-22-109><a class=lnlinks href=#hl-22-109>109</a>
</span><span class=lnt id=hl-22-110><a class=lnlinks href=#hl-22-110>110</a>
</span><span class=lnt id=hl-22-111><a class=lnlinks href=#hl-22-111>111</a>
</span><span class=lnt id=hl-22-112><a class=lnlinks href=#hl-22-112>112</a>
</span><span class=lnt id=hl-22-113><a class=lnlinks href=#hl-22-113>113</a>
</span><span class=lnt id=hl-22-114><a class=lnlinks href=#hl-22-114>114</a>
</span><span class=lnt id=hl-22-115><a class=lnlinks href=#hl-22-115>115</a>
</span><span class=lnt id=hl-22-116><a class=lnlinks href=#hl-22-116>116</a>
</span><span class=lnt id=hl-22-117><a class=lnlinks href=#hl-22-117>117</a>
</span><span class=lnt id=hl-22-118><a class=lnlinks href=#hl-22-118>118</a>
</span><span class=lnt id=hl-22-119><a class=lnlinks href=#hl-22-119>119</a>
</span><span class=lnt id=hl-22-120><a class=lnlinks href=#hl-22-120>120</a>
</span><span class=lnt id=hl-22-121><a class=lnlinks href=#hl-22-121>121</a>
</span><span class=lnt id=hl-22-122><a class=lnlinks href=#hl-22-122>122</a>
</span><span class=lnt id=hl-22-123><a class=lnlinks href=#hl-22-123>123</a>
</span><span class=lnt id=hl-22-124><a class=lnlinks href=#hl-22-124>124</a>
</span><span class=lnt id=hl-22-125><a class=lnlinks href=#hl-22-125>125</a>
</span><span class=lnt id=hl-22-126><a class=lnlinks href=#hl-22-126>126</a>
</span><span class=lnt id=hl-22-127><a class=lnlinks href=#hl-22-127>127</a>
</span><span class=lnt id=hl-22-128><a class=lnlinks href=#hl-22-128>128</a>
</span><span class=lnt id=hl-22-129><a class=lnlinks href=#hl-22-129>129</a>
</span><span class=lnt id=hl-22-130><a class=lnlinks href=#hl-22-130>130</a>
</span><span class=lnt id=hl-22-131><a class=lnlinks href=#hl-22-131>131</a>
</span><span class=lnt id=hl-22-132><a class=lnlinks href=#hl-22-132>132</a>
</span><span class=lnt id=hl-22-133><a class=lnlinks href=#hl-22-133>133</a>
</span><span class=lnt id=hl-22-134><a class=lnlinks href=#hl-22-134>134</a>
</span><span class=lnt id=hl-22-135><a class=lnlinks href=#hl-22-135>135</a>
</span><span class=lnt id=hl-22-136><a class=lnlinks href=#hl-22-136>136</a>
</span><span class=lnt id=hl-22-137><a class=lnlinks href=#hl-22-137>137</a>
</span><span class=lnt id=hl-22-138><a class=lnlinks href=#hl-22-138>138</a>
</span><span class=lnt id=hl-22-139><a class=lnlinks href=#hl-22-139>139</a>
</span><span class=lnt id=hl-22-140><a class=lnlinks href=#hl-22-140>140</a>
</span><span class=lnt id=hl-22-141><a class=lnlinks href=#hl-22-141>141</a>
</span><span class=lnt id=hl-22-142><a class=lnlinks href=#hl-22-142>142</a>
</span><span class=lnt id=hl-22-143><a class=lnlinks href=#hl-22-143>143</a>
</span><span class=lnt id=hl-22-144><a class=lnlinks href=#hl-22-144>144</a>
</span><span class=lnt id=hl-22-145><a class=lnlinks href=#hl-22-145>145</a>
</span><span class=lnt id=hl-22-146><a class=lnlinks href=#hl-22-146>146</a>
</span><span class=lnt id=hl-22-147><a class=lnlinks href=#hl-22-147>147</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># FastAPI에서 점진적 스로틀링 구현</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Request</span><span class=p>,</span> <span class=n>Response</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ThrottlingMiddleware</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>api_key</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-API-Key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>api_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 청구 주기의 남은 시간 계산 (예: 월말까지)</span>
</span></span><span class=line><span class=cl>        <span class=n>seconds_left_in_cycle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_seconds_left_in_billing_cycle</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 키에 대한 계획 및 사용량 세부 정보 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>plan_details</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_plan_details</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>plan_details</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용량 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>current_usage</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_usage</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>total_limit</span> <span class=o>=</span> <span class=n>plan_details</span><span class=p>[</span><span class=s1>&#39;requests_per_cycle&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용량 비율 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>usage_ratio</span> <span class=o>=</span> <span class=n>current_usage</span> <span class=o>/</span> <span class=n>total_limit</span> <span class=k>if</span> <span class=n>total_limit</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 스로틀링 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>usage_ratio</span> <span class=o>&gt;=</span> <span class=mf>0.95</span><span class=p>:</span>  <span class=c1># 95% 이상 사용</span>
</span></span><span class=line><span class=cl>            <span class=c1># 할당량의 99% 이상 사용 시 강제 스로틀링</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>usage_ratio</span> <span class=o>&gt;=</span> <span class=mf>0.99</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>Response</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>content</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;할당량 한도에 도달했습니다. 요금제 업그레이드를 고려하세요.&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=n>status_code</span><span class=o>=</span><span class=mi>429</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 할당량의 95%-99% 사용 시 점진적 스로틀링</span>
</span></span><span class=line><span class=cl>            <span class=n>delay_factor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_delay_factor</span><span class=p>(</span><span class=n>usage_ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 남은 할당량을 청구 주기 동안 분배</span>
</span></span><span class=line><span class=cl>            <span class=n>remaining_requests</span> <span class=o>=</span> <span class=n>total_limit</span> <span class=o>-</span> <span class=n>current_usage</span>
</span></span><span class=line><span class=cl>            <span class=n>ideal_rate</span> <span class=o>=</span> <span class=n>remaining_requests</span> <span class=o>/</span> <span class=n>seconds_left_in_cycle</span> <span class=k>if</span> <span class=n>seconds_left_in_cycle</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 요청에 딜레이 적용</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ideal_rate</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 초당 이상적인 요청 수 계산</span>
</span></span><span class=line><span class=cl>                <span class=n>delay_seconds</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>ideal_rate</span><span class=p>)</span> <span class=o>*</span> <span class=n>delay_factor</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실제 딜레이 적용 (최대 5초)</span>
</span></span><span class=line><span class=cl>                <span class=n>actual_delay</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>delay_seconds</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>actual_delay</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>:</span>  <span class=c1># 100ms 이상의 딜레이만 적용</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>actual_delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용량 증가</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>increment_usage</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 요청 진행</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답이 429인 경우 헤더 추가</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>429</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Retry-After&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>ceil</span><span class=p>(</span><span class=n>actual_delay</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Rate-Limit-Reset&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>+</span> <span class=n>seconds_left_in_cycle</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 현재 사용량 정보를 헤더에 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Rate-Limit-Limit&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>total_limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Rate-Limit-Remaining&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>total_limit</span> <span class=o>-</span> <span class=n>current_usage</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Rate-Limit-Used&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>current_usage</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_delay_factor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>usage_ratio</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용량 비율에 따른 지연 계수 계산&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 95%에서는 지연 없음, 99%에서는 최대 지연</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>usage_ratio</span> <span class=o>&lt;=</span> <span class=mf>0.95</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 95%-99% 사이에서 선형 증가</span>
</span></span><span class=line><span class=cl>        <span class=n>normalized_ratio</span> <span class=o>=</span> <span class=p>(</span><span class=n>usage_ratio</span> <span class=o>-</span> <span class=mf>0.95</span><span class=p>)</span> <span class=o>/</span> <span class=mf>0.04</span>  <span class=c1># 0 to 1 scale</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=p>(</span><span class=n>normalized_ratio</span> <span class=o>*</span> <span class=mf>5.0</span><span class=p>)</span>  <span class=c1># 1x to 6x delay</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_current_usage</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 API 사용량 가져오기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_cycle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_billing_cycle</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>usage_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;usage:</span><span class=si>{</span><span class=n>api_key</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>current_cycle</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>usage</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>usage_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>usage</span><span class=p>)</span> <span class=k>if</span> <span class=n>usage</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>increment_usage</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;API 사용량 증가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_cycle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_billing_cycle</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>usage_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;usage:</span><span class=si>{</span><span class=n>api_key</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>current_cycle</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 증가 및 만료 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>pipeline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=n>usage_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=n>usage_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_seconds_left_in_billing_cycle</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>pipe</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_current_billing_cycle</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 청구 주기 식별자 (예: &#39;2023-09&#39;)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>now</span><span class=o>.</span><span class=n>year</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>now</span><span class=o>.</span><span class=n>month</span><span class=si>:</span><span class=s2>02d</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_seconds_left_in_billing_cycle</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;청구 주기가 끝날 때까지 남은 시간(초)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>next_month</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>next_month</span> <span class=o>=</span> <span class=n>next_month</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>month</span><span class=o>=</span><span class=n>next_month</span><span class=o>.</span><span class=n>month</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>next_month</span><span class=o>.</span><span class=n>month</span> <span class=o>&lt;</span> <span class=mi>12</span> <span class=k>else</span> <span class=n>next_month</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>year</span><span class=o>=</span><span class=n>next_month</span><span class=o>.</span><span class=n>year</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=n>month</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>next_month</span> <span class=o>-</span> <span class=n>now</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_plan_details</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;API 키와 연관된 요금제 세부 정보 가져오기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현에서는 데이터베이스에서 정보 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이 예제에서는 간단한 캐싱 사용</span>
</span></span><span class=line><span class=cl>        <span class=n>plan_cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;plan:details:</span><span class=si>{</span><span class=n>api_key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cached_plan</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>plan_cache_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>cached_plan</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cached_plan</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실제 상황에서는 데이터베이스 조회</span>
</span></span><span class=line><span class=cl>        <span class=c1># mock data for example</span>
</span></span><span class=line><span class=cl>        <span class=n>mock_plans</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;test_key_free&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;tier&#34;</span><span class=p>:</span> <span class=s2>&#34;free&#34;</span><span class=p>,</span> <span class=s2>&#34;requests_per_cycle&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;test_key_basic&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;tier&#34;</span><span class=p>:</span> <span class=s2>&#34;basic&#34;</span><span class=p>,</span> <span class=s2>&#34;requests_per_cycle&#34;</span><span class=p>:</span> <span class=mi>10000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;test_key_pro&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;tier&#34;</span><span class=p>:</span> <span class=s2>&#34;pro&#34;</span><span class=p>,</span> <span class=s2>&#34;requests_per_cycle&#34;</span><span class=p>:</span> <span class=mi>100000</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>plan</span> <span class=o>=</span> <span class=n>mock_plans</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;tier&#34;</span><span class=p>:</span> <span class=s2>&#34;free&#34;</span><span class=p>,</span> <span class=s2>&#34;requests_per_cycle&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 캐시에 저장 (1시간)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>plan_cache_key</span><span class=p>,</span> <span class=mi>3600</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>plan</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>plan</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 미들웨어 적용</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>add_middleware</span><span class=p>(</span><span class=n>ThrottlingMiddleware</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api-키-관리-시스템-구축-사례-연구>API 키 관리 시스템 구축 사례 연구<a hidden class=anchor aria-hidden=true href=#api-키-관리-시스템-구축-사례-연구>#</a></h3><h4 id=스타트업을-위한-간소화된-시스템>스타트업을 위한 간소화된 시스템<a hidden class=anchor aria-hidden=true href=#스타트업을-위한-간소화된-시스템>#</a></h4><p>작은 스타트업은 간단하지만 확장 가능한 API 키 관리 시스템으로 시작할 수 있다:</p><p><strong>구성 요소</strong>:</p><ol><li><strong>API 키 관리 서비스</strong>: API 키 생성, 저장, 검증을 처리하는 마이크로서비스</li><li><strong>간단한 개발자 포털</strong>: 기본 문서와 API 키 관리 인터페이스 제공</li><li><strong>인메모리 캐싱</strong>: Redis를 사용한 API 키 검증 속도 최적화</li><li><strong>기본 요금제</strong>: 무료와 유료의 두 가지 티어로 시작</li><li><strong>서버리스 아키텍처</strong>: AWS Lambda 또는 Firebase Functions를 활용하여 운영 복잡성 최소화</li></ol><p><strong>구현 단계</strong>:</p><ol><li>API 키 생성 및 검증 기능 구축</li><li>기본 사용량 추적 구현</li><li>간단한 개발자 포털 제작</li><li>최소한의 요금제와 결제 통합</li><li>기본 모니터링 및 알림 설정</li></ol><h4 id=엔터프라이즈급-api-관리-시스템>엔터프라이즈급 API 관리 시스템<a hidden class=anchor aria-hidden=true href=#엔터프라이즈급-api-관리-시스템>#</a></h4><p>대규모 기업이나 성장 중인 회사는 더 정교한 API 관리 시스템이 필요하다:</p><p><strong>구성 요소</strong>:</p><ol><li><strong>종합 API 게이트웨이</strong>: Kong, AWS API Gateway 또는 Apigee 활용</li><li><strong>다층 인증 시스템</strong>: API 키, OAuth 2.0, mTLS 등 다양한 인증 방식 지원</li><li><strong>고급 개발자 포털</strong>: 대화형 문서, 샌드박스, 코드 샘플, 지원 시스템</li><li><strong>복잡한 요금제 관리</strong>: 다양한 티어, 맞춤형 계약, 초과 사용량 처리</li><li><strong>고급 분석 및 비즈니스 인텔리전스</strong>: 사용 패턴, 수익, 고객 행동 분석</li><li><strong>다중 지역 배포</strong>: 글로벌 사용자를 위한 지연 시간 최소화</li></ol><p><strong>구현 단계</strong>:</p><ol><li>API 게이트웨이 및 관리 플랫폼 구축</li><li>고급 인증 및 권한 부여 시스템 구현</li><li>종합적인 개발자 포털 개발</li><li>복잡한 요금제 및 청구 시스템 통합</li><li>고급 모니터링 및 알림 체계 구축</li><li>BI 도구를 활용한 사용량 및 수익 분석</li></ol><h4 id=마이크로서비스-아키텍처에서의-구현>마이크로서비스 아키텍처에서의 구현<a hidden class=anchor aria-hidden=true href=#마이크로서비스-아키텍처에서의-구현>#</a></h4><p>마이크로서비스 아키텍처에서는 API 키 관리도 모듈화된 접근 방식이 필요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────┐     ┌──────────────┐     ┌──────────────────┐
</span></span><span class=line><span class=cl>│  API 게이트웨이  │────▶│  인증 서비스  │────▶│  API 키 관리 서비스 │
</span></span><span class=line><span class=cl>└─────────────────┘     └──────────────┘     └──────────────────┘
</span></span><span class=line><span class=cl>         │                     │                      │
</span></span><span class=line><span class=cl>         │                     │                      │
</span></span><span class=line><span class=cl>         ▼                     ▼                      ▼
</span></span><span class=line><span class=cl>┌─────────────────┐     ┌──────────────┐     ┌──────────────────┐
</span></span><span class=line><span class=cl>│  속도 제한 서비스 │     │  청구 서비스  │     │  분석 서비스      │
</span></span><span class=line><span class=cl>└─────────────────┘     └──────────────┘     └──────────────────┘
</span></span><span class=line><span class=cl>         │                     │                      │
</span></span><span class=line><span class=cl>         │                     │                      │
</span></span><span class=line><span class=cl>         ▼                     ▼                      ▼
</span></span><span class=line><span class=cl>┌─────────────────┐     ┌──────────────┐     ┌──────────────────┐
</span></span><span class=line><span class=cl>│  로깅 서비스     │     │  알림 서비스  │     │  개발자 포털 서비스 │
</span></span><span class=line><span class=cl>└─────────────────┘     └──────────────┘     └──────────────────┘
</span></span></code></pre></td></tr></table></div></div><p><strong>서비스별 책임</strong>:</p><ol><li><strong>API 게이트웨이 서비스</strong>:<ul><li>모든 API 요청 라우팅</li><li>인증 헤더 검증</li><li>응답 캐싱</li><li>요청/응답 변환</li></ul></li><li><strong>인증 서비스</strong>:<ul><li>API 키 검증</li><li>OAuth 토큰 처리</li><li>JWT 검증</li><li>mTLS 인증서 관리</li></ul></li><li><strong>API 키 관리 서비스</strong>:<ul><li>키 생성 및 관리</li><li>키 메타데이터 저장 및 관리</li><li>키 권한 범위(scopes) 관리</li><li>키 수명주기(생성, 갱신, 취소) 처리</li><li>키 저장소와의 상호작용</li></ul></li><li><strong>속도 제한 서비스</strong>:<ul><li>요금제별 속도 제한 적용</li><li>동적 속도 제한 계산</li><li>토큰 버킷 또는 리키 버킷 알고리즘 구현</li><li>분산 환경에서의 속도 제한 동기화</li></ul></li><li><strong>청구 서비스</strong>:<ul><li>사용량 기반 과금 계산</li><li>요금제 관리</li><li>결제 처리 및 인보이스 생성</li><li>수익 보고서 생성</li></ul></li><li><strong>분석 서비스</strong>:<ul><li>API 사용 패턴 분석</li><li>성능 지표 수집</li><li>고객 행동 통찰 제공</li><li>비즈니스 의사결정을 위한 데이터 제공</li></ul></li><li><strong>로깅 서비스</strong>:<ul><li>모든 API 호출 로깅</li><li>구조화된 로그 저장</li><li>감사 추적 제공</li><li>로그 보존 정책 관리</li></ul></li><li><strong>알림 서비스</strong>:<ul><li>임계값 기반 알림 발송</li><li>사용량 알림 관리</li><li>보안 경고 처리</li><li>다양한 채널(이메일, SMS, 웹훅)을 통한 알림</li></ul></li><li><strong>개발자 포털 서비스</strong>:<ul><li>API 문서 제공</li><li>대화형 API 테스트 콘솔</li><li>사용자 계정 관리</li><li>API 키 자가 서비스 관리 인터페이스</li></ul></li></ol><p><strong>마이크로서비스 통신 패턴</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53>53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54>54</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// API 키 검증을 위한 서비스 간 통신 예시 (Java/Spring)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ApiKeyValidationService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebClient</span><span class=w> </span><span class=n>webClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CacheManager</span><span class=w> </span><span class=n>cacheManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ApiKeyValidationService</span><span class=p>(</span><span class=n>WebClient</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>webClientBuilder</span><span class=p>,</span><span class=w> </span><span class=n>CacheManager</span><span class=w> </span><span class=n>cacheManager</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>webClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webClientBuilder</span><span class=p>.</span><span class=na>baseUrl</span><span class=p>(</span><span class=s>&#34;http://api-key-service&#34;</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>cacheManager</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cacheManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Cacheable</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;apiKeyCache&#34;</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;#apiKey&#34;</span><span class=p>,</span><span class=w> </span><span class=n>unless</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;#result == null&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>ApiKeyDetails</span><span class=o>&gt;</span><span class=w> </span><span class=nf>validateApiKey</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>apiKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>webClient</span><span class=p>.</span><span class=na>get</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/api/keys/validate/{apiKey}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>apiKey</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>ApiKeyDetails</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>onErrorResume</span><span class=p>(</span><span class=n>WebClientResponseException</span><span class=p>.</span><span class=na>NotFound</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>doOnSuccess</span><span class=p>(</span><span class=n>details</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>details</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 사용량 트래킹을 위한 비동기 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>publishApiKeyUsageEvent</span><span class=p>(</span><span class=n>apiKey</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>publishApiKeyUsageEvent</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>apiKey</span><span class=p>,</span><span class=w> </span><span class=n>ApiKeyDetails</span><span class=w> </span><span class=n>details</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ApiKeyUsageEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ApiKeyUsageEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>apiKey</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>details</span><span class=p>.</span><span class=na>getClientId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>details</span><span class=p>.</span><span class=na>getPlanId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Kafka 또는 RabbitMQ를 통한 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// usageEventPublisher.publishEvent(event);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 캐시에서 무효화된 키 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>60000</span><span class=p>)</span><span class=w> </span><span class=c1>// 1분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>refreshRevokedKeysCache</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webClient</span><span class=p>.</span><span class=na>get</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/api/keys/revoked?since={timestamp}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>getLastSyncTimestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>bodyToFlux</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>revokedKey</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Cache</span><span class=w> </span><span class=n>apiKeyCache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cacheManager</span><span class=p>.</span><span class=na>getCache</span><span class=p>(</span><span class=s>&#34;apiKeyCache&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>apiKeyCache</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>apiKeyCache</span><span class=p>.</span><span class=na>evict</span><span class=p>(</span><span class=n>revokedKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>이벤트 기반 아키텍처 통합</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52>52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53>53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54>54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55>55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56>56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57>57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58>58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59>59</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 Kafka를 사용한 이벤트 기반 API 키 사용량 추적
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Kafka 클라이언트 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;api-gateway-service&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;kafka-broker1:9092&#39;</span><span class=p>,</span> <span class=s1>&#39;kafka-broker2:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>producer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 키 사용 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>publishApiKeyUsageEvent</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>,</span> <span class=nx>endpoint</span><span class=p>,</span> <span class=nx>responseTime</span><span class=p>,</span> <span class=nx>statusCode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpoint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>responseTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>statusCode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;api.usage.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>messages</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>key</span><span class=o>:</span> <span class=nx>apiKey</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`API 사용 이벤트 발행: </span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>endpoint</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이벤트 발행 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용량 집계 서비스의 소비자 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>startApiUsageConsumer</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>consumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;usage-aggregator-service&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;api.usage.events&#39;</span><span class=p>,</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 사용량 집계 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>aggregateApiUsage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>event</span><span class=p>.</span><span class=nx>apiKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>event</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>event</span><span class=p>.</span><span class=nx>responseTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>event</span><span class=p>.</span><span class=nx>statusCode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=미래-동향-및-발전-방향>미래 동향 및 발전 방향<a hidden class=anchor aria-hidden=true href=#미래-동향-및-발전-방향>#</a></h3><h4 id=제로-트러스트-아키텍처와-api-보안>제로 트러스트 아키텍처와 API 보안<a hidden class=anchor aria-hidden=true href=#제로-트러스트-아키텍처와-api-보안>#</a></h4><p>제로 트러스트 모델은 &ldquo;신뢰하지 말고 항상 검증하라"는 원칙에 기반하며, API 보안에도 적용되고 있다:</p><p><strong>핵심 원칙</strong>:</p><ol><li>모든 액세스 요청이 인증 및 권한 부여되어야 함</li><li>최소 권한의 원칙 적용</li><li>모든 트래픽 검사 및 로깅</li><li>지속적인 모니터링 및 위협 탐지</li></ol><p><strong>API 키 관리에 대한 영향</strong>:</p><ul><li>단일 API 키 대신 세분화된 범위를 가진 여러 키 사용</li><li>짧은 수명의 임시 API 키 사용 증가</li><li>컨텍스트 기반 액세스 정책(사용자 위치, 디바이스 상태 등 고려)</li><li>지속적인 인증 메커니즘 도입</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36>36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37>37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38>38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39>39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40>40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41>41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42>42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43>43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44>44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45>45</a>
</span><span class=lnt id=hl-26-46><a class=lnlinks href=#hl-26-46>46</a>
</span><span class=lnt id=hl-26-47><a class=lnlinks href=#hl-26-47>47</a>
</span><span class=lnt id=hl-26-48><a class=lnlinks href=#hl-26-48>48</a>
</span><span class=lnt id=hl-26-49><a class=lnlinks href=#hl-26-49>49</a>
</span><span class=lnt id=hl-26-50><a class=lnlinks href=#hl-26-50>50</a>
</span><span class=lnt id=hl-26-51><a class=lnlinks href=#hl-26-51>51</a>
</span><span class=lnt id=hl-26-52><a class=lnlinks href=#hl-26-52>52</a>
</span><span class=lnt id=hl-26-53><a class=lnlinks href=#hl-26-53>53</a>
</span><span class=lnt id=hl-26-54><a class=lnlinks href=#hl-26-54>54</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 컨텍스트 인식 API 키 검증 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>validate_api_key_with_context</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>request_context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 기본 API 키 검증</span>
</span></span><span class=line><span class=cl>    <span class=n>key_data</span> <span class=o>=</span> <span class=n>validate_api_key</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>key_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;Invalid API key&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 컨텍스트 기반 검증</span>
</span></span><span class=line><span class=cl>    <span class=n>context_valid</span><span class=p>,</span> <span class=n>context_reason</span> <span class=o>=</span> <span class=n>validate_request_context</span><span class=p>(</span><span class=n>key_data</span><span class=p>,</span> <span class=n>request_context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>context_valid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log_security_event</span><span class=p>(</span><span class=s2>&#34;context_validation_failed&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;api_key&#34;</span><span class=p>:</span> <span class=n>mask_api_key</span><span class=p>(</span><span class=n>api_key</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;client_id&#34;</span><span class=p>:</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;client_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=n>context_reason</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;context&#34;</span><span class=p>:</span> <span class=n>request_context</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>context_reason</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;Valid&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>validate_request_context</span><span class=p>(</span><span class=n>key_data</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1. IP 주소 허용 목록 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;allowed_ips&#34;</span> <span class=ow>in</span> <span class=n>key_data</span> <span class=ow>and</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;allowed_ips&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>client_ip</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;ip_address&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>client_ip</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;allowed_ips&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;IP not in allowlist&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. 시간 기반 제한 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;time_restrictions&#34;</span> <span class=ow>in</span> <span class=n>key_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>current_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>allowed_start</span> <span class=o>=</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;time_restrictions&#34;</span><span class=p>][</span><span class=s2>&#34;start&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>allowed_end</span> <span class=o>=</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;time_restrictions&#34;</span><span class=p>][</span><span class=s2>&#34;end&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=n>allowed_start</span> <span class=o>&lt;=</span> <span class=n>current_time</span> <span class=o>&lt;=</span> <span class=n>allowed_end</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;Outside allowed time window&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 3. 디바이스 지문 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;device_fingerprints&#34;</span> <span class=ow>in</span> <span class=n>key_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>device_fp</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;device_fingerprint&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>device_fp</span> <span class=ow>and</span> <span class=n>device_fp</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;device_fingerprints&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;Unknown device fingerprint&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 4. 지역 제한 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;allowed_regions&#34;</span> <span class=ow>in</span> <span class=n>key_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>user_region</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;geo_region&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_region</span> <span class=ow>and</span> <span class=n>user_region</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;allowed_regions&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;Region not allowed&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 5. 이전 요청과의 연속성 확인</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;require_request_continuity&#34;</span> <span class=ow>in</span> <span class=n>key_data</span> <span class=ow>and</span> <span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;require_request_continuity&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>verify_request_continuity</span><span class=p>(</span><span class=n>key_data</span><span class=p>[</span><span class=s2>&#34;client_id&#34;</span><span class=p>],</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;Request continuity violated&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;Context valid&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=api-관리의-인공지능-활용>API 관리의 인공지능 활용<a hidden class=anchor aria-hidden=true href=#api-관리의-인공지능-활용>#</a></h4><p>AI와 기계 학습은 API 관리에 여러 가지 방식으로 통합되고 있다:</p><p><strong>주요 적용 영역</strong>:</p><ol><li><strong>지능형 위협 탐지</strong>:<ul><li>비정상적인 API 사용 패턴 자동 감지</li><li>잠재적 보안 위반 예측</li><li>제로데이 취약점에 대한 자동 방어</li></ul></li><li><strong>스마트 속도 제한</strong>:<ul><li>사용자 패턴에 따른 동적 제한 조정</li><li>리소스 사용량 예측에 기반한 제한</li><li>서비스 가용성 최적화</li></ul></li><li><strong>자동화된 API 문서화</strong>:<ul><li>API 트래픽 분석을 통한 문서 자동 생성</li><li>예제 요청/응답 자동 제안</li><li>사용 패턴 기반 모범 사례 제안</li></ul></li><li><strong>수익 최적화</strong>:<ul><li>개인화된 요금제 추천</li><li>수요 기반 동적 가격 책정</li><li>사용자 세분화 및 타겟 마케팅</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>  1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>  2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>  3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4>  4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5>  5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6>  6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7>  7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8>  8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9>  9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10> 10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11> 11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12> 12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13> 13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14> 14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15> 15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16> 16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17> 17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18> 18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19> 19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20> 20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21> 21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22> 22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23> 23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24> 24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25> 25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26> 26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27> 27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28> 28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29> 29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30> 30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31> 31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32> 32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33> 33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34> 34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35> 35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36> 36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37> 37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38> 38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39> 39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40> 40</a>
</span><span class=lnt id=hl-27-41><a class=lnlinks href=#hl-27-41> 41</a>
</span><span class=lnt id=hl-27-42><a class=lnlinks href=#hl-27-42> 42</a>
</span><span class=lnt id=hl-27-43><a class=lnlinks href=#hl-27-43> 43</a>
</span><span class=lnt id=hl-27-44><a class=lnlinks href=#hl-27-44> 44</a>
</span><span class=lnt id=hl-27-45><a class=lnlinks href=#hl-27-45> 45</a>
</span><span class=lnt id=hl-27-46><a class=lnlinks href=#hl-27-46> 46</a>
</span><span class=lnt id=hl-27-47><a class=lnlinks href=#hl-27-47> 47</a>
</span><span class=lnt id=hl-27-48><a class=lnlinks href=#hl-27-48> 48</a>
</span><span class=lnt id=hl-27-49><a class=lnlinks href=#hl-27-49> 49</a>
</span><span class=lnt id=hl-27-50><a class=lnlinks href=#hl-27-50> 50</a>
</span><span class=lnt id=hl-27-51><a class=lnlinks href=#hl-27-51> 51</a>
</span><span class=lnt id=hl-27-52><a class=lnlinks href=#hl-27-52> 52</a>
</span><span class=lnt id=hl-27-53><a class=lnlinks href=#hl-27-53> 53</a>
</span><span class=lnt id=hl-27-54><a class=lnlinks href=#hl-27-54> 54</a>
</span><span class=lnt id=hl-27-55><a class=lnlinks href=#hl-27-55> 55</a>
</span><span class=lnt id=hl-27-56><a class=lnlinks href=#hl-27-56> 56</a>
</span><span class=lnt id=hl-27-57><a class=lnlinks href=#hl-27-57> 57</a>
</span><span class=lnt id=hl-27-58><a class=lnlinks href=#hl-27-58> 58</a>
</span><span class=lnt id=hl-27-59><a class=lnlinks href=#hl-27-59> 59</a>
</span><span class=lnt id=hl-27-60><a class=lnlinks href=#hl-27-60> 60</a>
</span><span class=lnt id=hl-27-61><a class=lnlinks href=#hl-27-61> 61</a>
</span><span class=lnt id=hl-27-62><a class=lnlinks href=#hl-27-62> 62</a>
</span><span class=lnt id=hl-27-63><a class=lnlinks href=#hl-27-63> 63</a>
</span><span class=lnt id=hl-27-64><a class=lnlinks href=#hl-27-64> 64</a>
</span><span class=lnt id=hl-27-65><a class=lnlinks href=#hl-27-65> 65</a>
</span><span class=lnt id=hl-27-66><a class=lnlinks href=#hl-27-66> 66</a>
</span><span class=lnt id=hl-27-67><a class=lnlinks href=#hl-27-67> 67</a>
</span><span class=lnt id=hl-27-68><a class=lnlinks href=#hl-27-68> 68</a>
</span><span class=lnt id=hl-27-69><a class=lnlinks href=#hl-27-69> 69</a>
</span><span class=lnt id=hl-27-70><a class=lnlinks href=#hl-27-70> 70</a>
</span><span class=lnt id=hl-27-71><a class=lnlinks href=#hl-27-71> 71</a>
</span><span class=lnt id=hl-27-72><a class=lnlinks href=#hl-27-72> 72</a>
</span><span class=lnt id=hl-27-73><a class=lnlinks href=#hl-27-73> 73</a>
</span><span class=lnt id=hl-27-74><a class=lnlinks href=#hl-27-74> 74</a>
</span><span class=lnt id=hl-27-75><a class=lnlinks href=#hl-27-75> 75</a>
</span><span class=lnt id=hl-27-76><a class=lnlinks href=#hl-27-76> 76</a>
</span><span class=lnt id=hl-27-77><a class=lnlinks href=#hl-27-77> 77</a>
</span><span class=lnt id=hl-27-78><a class=lnlinks href=#hl-27-78> 78</a>
</span><span class=lnt id=hl-27-79><a class=lnlinks href=#hl-27-79> 79</a>
</span><span class=lnt id=hl-27-80><a class=lnlinks href=#hl-27-80> 80</a>
</span><span class=lnt id=hl-27-81><a class=lnlinks href=#hl-27-81> 81</a>
</span><span class=lnt id=hl-27-82><a class=lnlinks href=#hl-27-82> 82</a>
</span><span class=lnt id=hl-27-83><a class=lnlinks href=#hl-27-83> 83</a>
</span><span class=lnt id=hl-27-84><a class=lnlinks href=#hl-27-84> 84</a>
</span><span class=lnt id=hl-27-85><a class=lnlinks href=#hl-27-85> 85</a>
</span><span class=lnt id=hl-27-86><a class=lnlinks href=#hl-27-86> 86</a>
</span><span class=lnt id=hl-27-87><a class=lnlinks href=#hl-27-87> 87</a>
</span><span class=lnt id=hl-27-88><a class=lnlinks href=#hl-27-88> 88</a>
</span><span class=lnt id=hl-27-89><a class=lnlinks href=#hl-27-89> 89</a>
</span><span class=lnt id=hl-27-90><a class=lnlinks href=#hl-27-90> 90</a>
</span><span class=lnt id=hl-27-91><a class=lnlinks href=#hl-27-91> 91</a>
</span><span class=lnt id=hl-27-92><a class=lnlinks href=#hl-27-92> 92</a>
</span><span class=lnt id=hl-27-93><a class=lnlinks href=#hl-27-93> 93</a>
</span><span class=lnt id=hl-27-94><a class=lnlinks href=#hl-27-94> 94</a>
</span><span class=lnt id=hl-27-95><a class=lnlinks href=#hl-27-95> 95</a>
</span><span class=lnt id=hl-27-96><a class=lnlinks href=#hl-27-96> 96</a>
</span><span class=lnt id=hl-27-97><a class=lnlinks href=#hl-27-97> 97</a>
</span><span class=lnt id=hl-27-98><a class=lnlinks href=#hl-27-98> 98</a>
</span><span class=lnt id=hl-27-99><a class=lnlinks href=#hl-27-99> 99</a>
</span><span class=lnt id=hl-27-100><a class=lnlinks href=#hl-27-100>100</a>
</span><span class=lnt id=hl-27-101><a class=lnlinks href=#hl-27-101>101</a>
</span><span class=lnt id=hl-27-102><a class=lnlinks href=#hl-27-102>102</a>
</span><span class=lnt id=hl-27-103><a class=lnlinks href=#hl-27-103>103</a>
</span><span class=lnt id=hl-27-104><a class=lnlinks href=#hl-27-104>104</a>
</span><span class=lnt id=hl-27-105><a class=lnlinks href=#hl-27-105>105</a>
</span><span class=lnt id=hl-27-106><a class=lnlinks href=#hl-27-106>106</a>
</span><span class=lnt id=hl-27-107><a class=lnlinks href=#hl-27-107>107</a>
</span><span class=lnt id=hl-27-108><a class=lnlinks href=#hl-27-108>108</a>
</span><span class=lnt id=hl-27-109><a class=lnlinks href=#hl-27-109>109</a>
</span><span class=lnt id=hl-27-110><a class=lnlinks href=#hl-27-110>110</a>
</span><span class=lnt id=hl-27-111><a class=lnlinks href=#hl-27-111>111</a>
</span><span class=lnt id=hl-27-112><a class=lnlinks href=#hl-27-112>112</a>
</span><span class=lnt id=hl-27-113><a class=lnlinks href=#hl-27-113>113</a>
</span><span class=lnt id=hl-27-114><a class=lnlinks href=#hl-27-114>114</a>
</span><span class=lnt id=hl-27-115><a class=lnlinks href=#hl-27-115>115</a>
</span><span class=lnt id=hl-27-116><a class=lnlinks href=#hl-27-116>116</a>
</span><span class=lnt id=hl-27-117><a class=lnlinks href=#hl-27-117>117</a>
</span><span class=lnt id=hl-27-118><a class=lnlinks href=#hl-27-118>118</a>
</span><span class=lnt id=hl-27-119><a class=lnlinks href=#hl-27-119>119</a>
</span><span class=lnt id=hl-27-120><a class=lnlinks href=#hl-27-120>120</a>
</span><span class=lnt id=hl-27-121><a class=lnlinks href=#hl-27-121>121</a>
</span><span class=lnt id=hl-27-122><a class=lnlinks href=#hl-27-122>122</a>
</span><span class=lnt id=hl-27-123><a class=lnlinks href=#hl-27-123>123</a>
</span><span class=lnt id=hl-27-124><a class=lnlinks href=#hl-27-124>124</a>
</span><span class=lnt id=hl-27-125><a class=lnlinks href=#hl-27-125>125</a>
</span><span class=lnt id=hl-27-126><a class=lnlinks href=#hl-27-126>126</a>
</span><span class=lnt id=hl-27-127><a class=lnlinks href=#hl-27-127>127</a>
</span><span class=lnt id=hl-27-128><a class=lnlinks href=#hl-27-128>128</a>
</span><span class=lnt id=hl-27-129><a class=lnlinks href=#hl-27-129>129</a>
</span><span class=lnt id=hl-27-130><a class=lnlinks href=#hl-27-130>130</a>
</span><span class=lnt id=hl-27-131><a class=lnlinks href=#hl-27-131>131</a>
</span><span class=lnt id=hl-27-132><a class=lnlinks href=#hl-27-132>132</a>
</span><span class=lnt id=hl-27-133><a class=lnlinks href=#hl-27-133>133</a>
</span><span class=lnt id=hl-27-134><a class=lnlinks href=#hl-27-134>134</a>
</span><span class=lnt id=hl-27-135><a class=lnlinks href=#hl-27-135>135</a>
</span><span class=lnt id=hl-27-136><a class=lnlinks href=#hl-27-136>136</a>
</span><span class=lnt id=hl-27-137><a class=lnlinks href=#hl-27-137>137</a>
</span><span class=lnt id=hl-27-138><a class=lnlinks href=#hl-27-138>138</a>
</span><span class=lnt id=hl-27-139><a class=lnlinks href=#hl-27-139>139</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 기계 학습을 사용한 동적 속도 제한 예시</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.ensemble</span> <span class=kn>import</span> <span class=n>RandomForestRegressor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MLRateLimiter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>RandomForestRegressor</span><span class=p>(</span><span class=n>n_estimators</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>trained</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>retrain_interval</span> <span class=o>=</span> <span class=mi>24</span>  <span class=c1># 시간 단위</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_trained</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_features</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>,</span> <span class=n>client_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 요청의 특성 추출&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시간 관련 특성</span>
</span></span><span class=line><span class=cl>        <span class=n>hour_of_day</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>hour</span>
</span></span><span class=line><span class=cl>        <span class=n>day_of_week</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>weekday</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>is_weekend</span> <span class=o>=</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>day_of_week</span> <span class=o>&gt;=</span> <span class=mi>5</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이전 사용량 특성</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_1h_requests</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_usage_count</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>minutes</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_24h_requests</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_usage_count</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>minutes</span><span class=o>=</span><span class=mi>1440</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_1h_errors</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_error_count</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>minutes</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시스템 부하 특성</span>
</span></span><span class=line><span class=cl>        <span class=n>system_cpu_load</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_system_metric</span><span class=p>(</span><span class=s2>&#34;cpu_load&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>system_memory_used</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_system_metric</span><span class=p>(</span><span class=s2>&#34;memory_used&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>current_total_rps</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_system_metric</span><span class=p>(</span><span class=s2>&#34;requests_per_second&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 클라이언트 특성</span>
</span></span><span class=line><span class=cl>        <span class=n>client_priority</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_client_priority</span><span class=p>(</span><span class=n>client_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>subscription_tier</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_subscription_tier</span><span class=p>(</span><span class=n>client_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>subscription_tier_encoded</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_encode_tier</span><span class=p>(</span><span class=n>subscription_tier</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hour_of_day&#34;</span><span class=p>:</span> <span class=n>hour_of_day</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;day_of_week&#34;</span><span class=p>:</span> <span class=n>day_of_week</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;is_weekend&#34;</span><span class=p>:</span> <span class=n>is_weekend</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recent_1h_requests&#34;</span><span class=p>:</span> <span class=n>recent_1h_requests</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recent_24h_requests&#34;</span><span class=p>:</span> <span class=n>recent_24h_requests</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recent_1h_errors&#34;</span><span class=p>:</span> <span class=n>recent_1h_errors</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system_cpu_load&#34;</span><span class=p>:</span> <span class=n>system_cpu_load</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system_memory_used&#34;</span><span class=p>:</span> <span class=n>system_memory_used</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;current_total_rps&#34;</span><span class=p>:</span> <span class=n>current_total_rps</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;client_priority&#34;</span><span class=p>:</span> <span class=n>client_priority</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;subscription_tier&#34;</span><span class=p>:</span> <span class=n>subscription_tier_encoded</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>predict_optimal_rate_limit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>,</span> <span class=n>client_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;ML 모델을 사용하여 최적의 속도 제한 예측&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 필요한 경우 모델 재훈련</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_retrain_model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>trained</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 모델이 훈련되지 않은 경우 기본값 반환</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_rate_limit</span><span class=p>(</span><span class=n>client_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 특성 추출</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_features</span><span class=p>(</span><span class=n>api_key</span><span class=p>,</span> <span class=n>client_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 예측용 특성 벡터 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>feature_vector</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;hour_of_day&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;day_of_week&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;is_weekend&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;recent_1h_requests&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;recent_24h_requests&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;recent_1h_errors&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;system_cpu_load&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;system_memory_used&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;current_total_rps&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;client_priority&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>features</span><span class=p>[</span><span class=s2>&#34;subscription_tier&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>]])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 최적 속도 제한 예측</span>
</span></span><span class=line><span class=cl>        <span class=n>predicted_rate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>feature_vector</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 기본 제한과 예측 값 사이의 균형</span>
</span></span><span class=line><span class=cl>        <span class=n>default_limit</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_rate_limit</span><span class=p>(</span><span class=n>client_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시스템 부하가 높으면 보수적으로 제한</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>features</span><span class=p>[</span><span class=s2>&#34;system_cpu_load&#34;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>80</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>weight</span> <span class=o>=</span> <span class=mf>0.3</span>  <span class=c1># 기본 제한에 가중치 부여</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>weight</span> <span class=o>=</span> <span class=mf>0.7</span>  <span class=c1># 예측 값에 가중치 부여</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>balanced_limit</span> <span class=o>=</span> <span class=p>(</span><span class=n>predicted_rate</span> <span class=o>*</span> <span class=n>weight</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>default_limit</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>weight</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 최소 및 최대 제한 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>min_limit</span> <span class=o>=</span> <span class=n>default_limit</span> <span class=o>*</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>        <span class=n>max_limit</span> <span class=o>=</span> <span class=n>default_limit</span> <span class=o>*</span> <span class=mf>2.0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>max</span><span class=p>(</span><span class=n>min_limit</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=n>balanced_limit</span><span class=p>,</span> <span class=n>max_limit</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_check_retrain_model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;모델 재훈련 필요성 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_trained</span> <span class=ow>or</span> 
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>now</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_trained</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>retrain_interval</span> <span class=o>*</span> <span class=mi>3600</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_train_model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>last_trained</span> <span class=o>=</span> <span class=n>now</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_train_model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;과거 데이터로 모델 훈련&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 과거 데이터 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>training_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_historical_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>training_data</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>1000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 훈련에 충분한 데이터가 없음</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 특성 및 타겟 분할</span>
</span></span><span class=line><span class=cl>        <span class=n>X</span> <span class=o>=</span> <span class=n>training_data</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;optimal_rate&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>training_data</span><span class=p>[</span><span class=s1>&#39;optimal_rate&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모델 훈련</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>trained</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Rate limiting model retrained with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>training_data</span><span class=p>)</span><span class=si>}</span><span class=s2> samples&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_historical_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;모델 훈련용 과거 데이터 가져오기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현에서는 데이터베이스나 데이터 웨어하우스에서 데이터 로드</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이 예제에서는 더미 데이터 생성</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># … 과거 데이터 로드 로직 …</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=c1># 특성 및 최적 속도 제한 포함</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 헬퍼 메서드들…</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=서버리스-및-에지-컴퓨팅-환경의-api-관리>서버리스 및 에지 컴퓨팅 환경의 API 관리<a hidden class=anchor aria-hidden=true href=#서버리스-및-에지-컴퓨팅-환경의-api-관리>#</a></h4><p>클라우드 네이티브 환경의 발전에 따라 API 관리도 새로운 아키텍처로 진화하고 있다:</p><p><strong>주요 동향</strong>:</p><ol><li><strong>서버리스 API 게이트웨이</strong>:<ul><li>AWS Lambda + API Gateway, Azure Functions + API Management</li><li>자동 확장성 및 페이 퍼 유즈(pay-per-use) 모델</li><li>제로 인프라 관리로 운영 부담 감소</li></ul></li><li><strong>에지 컴퓨팅 기반 API 관리</strong>:<ul><li>CDN 에지에서 API 요청 처리</li><li>사용자에게 더 가까운 위치에서 API 제공</li><li>지연 시간 감소 및 지역 규정 준수 지원</li></ul></li><li><strong>WebAssembly를 활용한 에지 프로세싱</strong>:<ul><li>에지에서 안전하고 효율적인 코드 실행</li><li>동적 API 변환 및 처리</li><li>다양한 프로그래밍 언어 지원</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43>43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44>44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45>45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46>46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47>47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48>48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49>49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50>50</a>
</span><span class=lnt id=hl-28-51><a class=lnlinks href=#hl-28-51>51</a>
</span><span class=lnt id=hl-28-52><a class=lnlinks href=#hl-28-52>52</a>
</span><span class=lnt id=hl-28-53><a class=lnlinks href=#hl-28-53>53</a>
</span><span class=lnt id=hl-28-54><a class=lnlinks href=#hl-28-54>54</a>
</span><span class=lnt id=hl-28-55><a class=lnlinks href=#hl-28-55>55</a>
</span><span class=lnt id=hl-28-56><a class=lnlinks href=#hl-28-56>56</a>
</span><span class=lnt id=hl-28-57><a class=lnlinks href=#hl-28-57>57</a>
</span><span class=lnt id=hl-28-58><a class=lnlinks href=#hl-28-58>58</a>
</span><span class=lnt id=hl-28-59><a class=lnlinks href=#hl-28-59>59</a>
</span><span class=lnt id=hl-28-60><a class=lnlinks href=#hl-28-60>60</a>
</span><span class=lnt id=hl-28-61><a class=lnlinks href=#hl-28-61>61</a>
</span><span class=lnt id=hl-28-62><a class=lnlinks href=#hl-28-62>62</a>
</span><span class=lnt id=hl-28-63><a class=lnlinks href=#hl-28-63>63</a>
</span><span class=lnt id=hl-28-64><a class=lnlinks href=#hl-28-64>64</a>
</span><span class=lnt id=hl-28-65><a class=lnlinks href=#hl-28-65>65</a>
</span><span class=lnt id=hl-28-66><a class=lnlinks href=#hl-28-66>66</a>
</span><span class=lnt id=hl-28-67><a class=lnlinks href=#hl-28-67>67</a>
</span><span class=lnt id=hl-28-68><a class=lnlinks href=#hl-28-68>68</a>
</span><span class=lnt id=hl-28-69><a class=lnlinks href=#hl-28-69>69</a>
</span><span class=lnt id=hl-28-70><a class=lnlinks href=#hl-28-70>70</a>
</span><span class=lnt id=hl-28-71><a class=lnlinks href=#hl-28-71>71</a>
</span><span class=lnt id=hl-28-72><a class=lnlinks href=#hl-28-72>72</a>
</span><span class=lnt id=hl-28-73><a class=lnlinks href=#hl-28-73>73</a>
</span><span class=lnt id=hl-28-74><a class=lnlinks href=#hl-28-74>74</a>
</span><span class=lnt id=hl-28-75><a class=lnlinks href=#hl-28-75>75</a>
</span><span class=lnt id=hl-28-76><a class=lnlinks href=#hl-28-76>76</a>
</span><span class=lnt id=hl-28-77><a class=lnlinks href=#hl-28-77>77</a>
</span><span class=lnt id=hl-28-78><a class=lnlinks href=#hl-28-78>78</a>
</span><span class=lnt id=hl-28-79><a class=lnlinks href=#hl-28-79>79</a>
</span><span class=lnt id=hl-28-80><a class=lnlinks href=#hl-28-80>80</a>
</span><span class=lnt id=hl-28-81><a class=lnlinks href=#hl-28-81>81</a>
</span><span class=lnt id=hl-28-82><a class=lnlinks href=#hl-28-82>82</a>
</span><span class=lnt id=hl-28-83><a class=lnlinks href=#hl-28-83>83</a>
</span><span class=lnt id=hl-28-84><a class=lnlinks href=#hl-28-84>84</a>
</span><span class=lnt id=hl-28-85><a class=lnlinks href=#hl-28-85>85</a>
</span><span class=lnt id=hl-28-86><a class=lnlinks href=#hl-28-86>86</a>
</span><span class=lnt id=hl-28-87><a class=lnlinks href=#hl-28-87>87</a>
</span><span class=lnt id=hl-28-88><a class=lnlinks href=#hl-28-88>88</a>
</span><span class=lnt id=hl-28-89><a class=lnlinks href=#hl-28-89>89</a>
</span><span class=lnt id=hl-28-90><a class=lnlinks href=#hl-28-90>90</a>
</span><span class=lnt id=hl-28-91><a class=lnlinks href=#hl-28-91>91</a>
</span><span class=lnt id=hl-28-92><a class=lnlinks href=#hl-28-92>92</a>
</span><span class=lnt id=hl-28-93><a class=lnlinks href=#hl-28-93>93</a>
</span><span class=lnt id=hl-28-94><a class=lnlinks href=#hl-28-94>94</a>
</span><span class=lnt id=hl-28-95><a class=lnlinks href=#hl-28-95>95</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Cloudflare Workers를 사용한 에지에서의 API 키 검증 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;fetch&#39;</span><span class=p>,</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>respondWith</span><span class=p>(</span><span class=nx>handleRequest</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>request</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>handleRequest</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// API 키 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>apiKey</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;X-API-Key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>apiKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;API 키가 필요합니다&#39;</span> <span class=p>}),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>401</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// KV에서 API 키 검증
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>keyData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>API_KEYS</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>,</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>keyData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;유효하지 않은 API 키&#39;</span> <span class=p>}),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>401</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 키가 취소되었는지 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>keyData</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;revoked&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;API 키가 취소되었습니다&#39;</span> <span class=p>}),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>401</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 만료 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>keyData</span><span class=p>.</span><span class=nx>expiresAt</span> <span class=o>&amp;&amp;</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>keyData</span><span class=p>.</span><span class=nx>expiresAt</span><span class=p>)</span> <span class=o>&lt;</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;API 키가 만료되었습니다&#39;</span> <span class=p>}),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>401</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 속도 제한 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>rateLimitKey</span> <span class=o>=</span> <span class=sb>`ratelimit:</span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>/</span> <span class=mi>1000</span> <span class=o>|</span> <span class=mi>0</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>currentCount</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>API_USAGE</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>rateLimitKey</span><span class=p>)</span> <span class=o>||</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>currentCount</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=nx>keyData</span><span class=p>.</span><span class=nx>rateLimit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;속도 제한 초과&#39;</span> <span class=p>}),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>429</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Retry-After&#39;</span><span class=o>:</span> <span class=s1>&#39;60&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 속도 제한 카운터 증가
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>API_USAGE</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>rateLimitKey</span><span class=p>,</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>currentCount</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=p>{</span> <span class=nx>expirationTtl</span><span class=o>:</span> <span class=mi>60</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 비동기적으로 사용량 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>logApiUsage</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>,</span> <span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span> <span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 원본 API로 요청 전달
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span><span class=p>.</span><span class=nx>hostname</span> <span class=o>=</span> <span class=s1>&#39;api.example.com&#39;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>modifiedRequest</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Request</span><span class=p>(</span><span class=nx>url</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>method</span><span class=o>:</span> <span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=nx>request</span><span class=p>.</span><span class=nx>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>redirect</span><span class=o>:</span> <span class=s1>&#39;follow&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 클라이언트 ID를 요청에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>modifiedRequest</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;X-Client-ID&#39;</span><span class=p>,</span> <span class=nx>keyData</span><span class=p>.</span><span class=nx>clientId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>modifiedRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>logApiUsage</span><span class=p>(</span><span class=nx>apiKey</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>method</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>usage</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// Durable Objects나 Worker Queues를 사용한 사용량 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 실제 구현에서는 분석 데이터베이스로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>  <span class=c1>// 간단한 예시: KV에 로그 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>logKey</span> <span class=o>=</span> <span class=sb>`log:</span><span class=si>${</span><span class=nx>apiKey</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>API_LOGS</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>logKey</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>usage</span><span class=p>),</span> <span class=p>{</span> <span class=nx>expirationTtl</span><span class=o>:</span> <span class=mi>86400</span> <span class=o>*</span> <span class=mi>30</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사용자-중심-api-키-관리>사용자 중심 API 키 관리<a hidden class=anchor aria-hidden=true href=#사용자-중심-api-키-관리>#</a></h4><p>API 소비자 경험이 API 채택 및 성공의 핵심 요소로 부상하고 있다:</p><p><strong>혁신적인 접근법</strong>:</p><ol><li><strong>자가 서비스 API 키 관리</strong>:<ul><li>개발자가 직접 키 생성 및 관리</li><li>실시간 사용량 및 할당량 모니터링</li><li>맞춤형 알림 설정</li></ul></li><li><strong>세분화된 권한 모델</strong>:<ul><li>엔드포인트 수준의 접근 제어</li><li>시간 기반 키 제한</li><li>특정 사용 사례에 맞춘 키 구성</li></ul></li><li><strong>대화형 API 탐색 도구</strong>:<ul><li>API 키 통합 테스트 콘솔</li><li>실시간 피드백과 권장 사항</li><li>코드 샘플 자동 생성</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>  1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>  2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>  3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4>  4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5>  5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6>  6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7>  7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8>  8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9>  9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10> 10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11> 11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12> 12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13> 13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14> 14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15> 15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16> 16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17> 17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18> 18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19> 19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20> 20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21> 21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22> 22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23> 23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24> 24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25> 25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26> 26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27> 27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28> 28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29> 29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30> 30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31> 31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32> 32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33> 33</a>
</span><span class=lnt id=hl-29-34><a class=lnlinks href=#hl-29-34> 34</a>
</span><span class=lnt id=hl-29-35><a class=lnlinks href=#hl-29-35> 35</a>
</span><span class=lnt id=hl-29-36><a class=lnlinks href=#hl-29-36> 36</a>
</span><span class=lnt id=hl-29-37><a class=lnlinks href=#hl-29-37> 37</a>
</span><span class=lnt id=hl-29-38><a class=lnlinks href=#hl-29-38> 38</a>
</span><span class=lnt id=hl-29-39><a class=lnlinks href=#hl-29-39> 39</a>
</span><span class=lnt id=hl-29-40><a class=lnlinks href=#hl-29-40> 40</a>
</span><span class=lnt id=hl-29-41><a class=lnlinks href=#hl-29-41> 41</a>
</span><span class=lnt id=hl-29-42><a class=lnlinks href=#hl-29-42> 42</a>
</span><span class=lnt id=hl-29-43><a class=lnlinks href=#hl-29-43> 43</a>
</span><span class=lnt id=hl-29-44><a class=lnlinks href=#hl-29-44> 44</a>
</span><span class=lnt id=hl-29-45><a class=lnlinks href=#hl-29-45> 45</a>
</span><span class=lnt id=hl-29-46><a class=lnlinks href=#hl-29-46> 46</a>
</span><span class=lnt id=hl-29-47><a class=lnlinks href=#hl-29-47> 47</a>
</span><span class=lnt id=hl-29-48><a class=lnlinks href=#hl-29-48> 48</a>
</span><span class=lnt id=hl-29-49><a class=lnlinks href=#hl-29-49> 49</a>
</span><span class=lnt id=hl-29-50><a class=lnlinks href=#hl-29-50> 50</a>
</span><span class=lnt id=hl-29-51><a class=lnlinks href=#hl-29-51> 51</a>
</span><span class=lnt id=hl-29-52><a class=lnlinks href=#hl-29-52> 52</a>
</span><span class=lnt id=hl-29-53><a class=lnlinks href=#hl-29-53> 53</a>
</span><span class=lnt id=hl-29-54><a class=lnlinks href=#hl-29-54> 54</a>
</span><span class=lnt id=hl-29-55><a class=lnlinks href=#hl-29-55> 55</a>
</span><span class=lnt id=hl-29-56><a class=lnlinks href=#hl-29-56> 56</a>
</span><span class=lnt id=hl-29-57><a class=lnlinks href=#hl-29-57> 57</a>
</span><span class=lnt id=hl-29-58><a class=lnlinks href=#hl-29-58> 58</a>
</span><span class=lnt id=hl-29-59><a class=lnlinks href=#hl-29-59> 59</a>
</span><span class=lnt id=hl-29-60><a class=lnlinks href=#hl-29-60> 60</a>
</span><span class=lnt id=hl-29-61><a class=lnlinks href=#hl-29-61> 61</a>
</span><span class=lnt id=hl-29-62><a class=lnlinks href=#hl-29-62> 62</a>
</span><span class=lnt id=hl-29-63><a class=lnlinks href=#hl-29-63> 63</a>
</span><span class=lnt id=hl-29-64><a class=lnlinks href=#hl-29-64> 64</a>
</span><span class=lnt id=hl-29-65><a class=lnlinks href=#hl-29-65> 65</a>
</span><span class=lnt id=hl-29-66><a class=lnlinks href=#hl-29-66> 66</a>
</span><span class=lnt id=hl-29-67><a class=lnlinks href=#hl-29-67> 67</a>
</span><span class=lnt id=hl-29-68><a class=lnlinks href=#hl-29-68> 68</a>
</span><span class=lnt id=hl-29-69><a class=lnlinks href=#hl-29-69> 69</a>
</span><span class=lnt id=hl-29-70><a class=lnlinks href=#hl-29-70> 70</a>
</span><span class=lnt id=hl-29-71><a class=lnlinks href=#hl-29-71> 71</a>
</span><span class=lnt id=hl-29-72><a class=lnlinks href=#hl-29-72> 72</a>
</span><span class=lnt id=hl-29-73><a class=lnlinks href=#hl-29-73> 73</a>
</span><span class=lnt id=hl-29-74><a class=lnlinks href=#hl-29-74> 74</a>
</span><span class=lnt id=hl-29-75><a class=lnlinks href=#hl-29-75> 75</a>
</span><span class=lnt id=hl-29-76><a class=lnlinks href=#hl-29-76> 76</a>
</span><span class=lnt id=hl-29-77><a class=lnlinks href=#hl-29-77> 77</a>
</span><span class=lnt id=hl-29-78><a class=lnlinks href=#hl-29-78> 78</a>
</span><span class=lnt id=hl-29-79><a class=lnlinks href=#hl-29-79> 79</a>
</span><span class=lnt id=hl-29-80><a class=lnlinks href=#hl-29-80> 80</a>
</span><span class=lnt id=hl-29-81><a class=lnlinks href=#hl-29-81> 81</a>
</span><span class=lnt id=hl-29-82><a class=lnlinks href=#hl-29-82> 82</a>
</span><span class=lnt id=hl-29-83><a class=lnlinks href=#hl-29-83> 83</a>
</span><span class=lnt id=hl-29-84><a class=lnlinks href=#hl-29-84> 84</a>
</span><span class=lnt id=hl-29-85><a class=lnlinks href=#hl-29-85> 85</a>
</span><span class=lnt id=hl-29-86><a class=lnlinks href=#hl-29-86> 86</a>
</span><span class=lnt id=hl-29-87><a class=lnlinks href=#hl-29-87> 87</a>
</span><span class=lnt id=hl-29-88><a class=lnlinks href=#hl-29-88> 88</a>
</span><span class=lnt id=hl-29-89><a class=lnlinks href=#hl-29-89> 89</a>
</span><span class=lnt id=hl-29-90><a class=lnlinks href=#hl-29-90> 90</a>
</span><span class=lnt id=hl-29-91><a class=lnlinks href=#hl-29-91> 91</a>
</span><span class=lnt id=hl-29-92><a class=lnlinks href=#hl-29-92> 92</a>
</span><span class=lnt id=hl-29-93><a class=lnlinks href=#hl-29-93> 93</a>
</span><span class=lnt id=hl-29-94><a class=lnlinks href=#hl-29-94> 94</a>
</span><span class=lnt id=hl-29-95><a class=lnlinks href=#hl-29-95> 95</a>
</span><span class=lnt id=hl-29-96><a class=lnlinks href=#hl-29-96> 96</a>
</span><span class=lnt id=hl-29-97><a class=lnlinks href=#hl-29-97> 97</a>
</span><span class=lnt id=hl-29-98><a class=lnlinks href=#hl-29-98> 98</a>
</span><span class=lnt id=hl-29-99><a class=lnlinks href=#hl-29-99> 99</a>
</span><span class=lnt id=hl-29-100><a class=lnlinks href=#hl-29-100>100</a>
</span><span class=lnt id=hl-29-101><a class=lnlinks href=#hl-29-101>101</a>
</span><span class=lnt id=hl-29-102><a class=lnlinks href=#hl-29-102>102</a>
</span><span class=lnt id=hl-29-103><a class=lnlinks href=#hl-29-103>103</a>
</span><span class=lnt id=hl-29-104><a class=lnlinks href=#hl-29-104>104</a>
</span><span class=lnt id=hl-29-105><a class=lnlinks href=#hl-29-105>105</a>
</span><span class=lnt id=hl-29-106><a class=lnlinks href=#hl-29-106>106</a>
</span><span class=lnt id=hl-29-107><a class=lnlinks href=#hl-29-107>107</a>
</span><span class=lnt id=hl-29-108><a class=lnlinks href=#hl-29-108>108</a>
</span><span class=lnt id=hl-29-109><a class=lnlinks href=#hl-29-109>109</a>
</span><span class=lnt id=hl-29-110><a class=lnlinks href=#hl-29-110>110</a>
</span><span class=lnt id=hl-29-111><a class=lnlinks href=#hl-29-111>111</a>
</span><span class=lnt id=hl-29-112><a class=lnlinks href=#hl-29-112>112</a>
</span><span class=lnt id=hl-29-113><a class=lnlinks href=#hl-29-113>113</a>
</span><span class=lnt id=hl-29-114><a class=lnlinks href=#hl-29-114>114</a>
</span><span class=lnt id=hl-29-115><a class=lnlinks href=#hl-29-115>115</a>
</span><span class=lnt id=hl-29-116><a class=lnlinks href=#hl-29-116>116</a>
</span><span class=lnt id=hl-29-117><a class=lnlinks href=#hl-29-117>117</a>
</span><span class=lnt id=hl-29-118><a class=lnlinks href=#hl-29-118>118</a>
</span><span class=lnt id=hl-29-119><a class=lnlinks href=#hl-29-119>119</a>
</span><span class=lnt id=hl-29-120><a class=lnlinks href=#hl-29-120>120</a>
</span><span class=lnt id=hl-29-121><a class=lnlinks href=#hl-29-121>121</a>
</span><span class=lnt id=hl-29-122><a class=lnlinks href=#hl-29-122>122</a>
</span><span class=lnt id=hl-29-123><a class=lnlinks href=#hl-29-123>123</a>
</span><span class=lnt id=hl-29-124><a class=lnlinks href=#hl-29-124>124</a>
</span><span class=lnt id=hl-29-125><a class=lnlinks href=#hl-29-125>125</a>
</span><span class=lnt id=hl-29-126><a class=lnlinks href=#hl-29-126>126</a>
</span><span class=lnt id=hl-29-127><a class=lnlinks href=#hl-29-127>127</a>
</span><span class=lnt id=hl-29-128><a class=lnlinks href=#hl-29-128>128</a>
</span><span class=lnt id=hl-29-129><a class=lnlinks href=#hl-29-129>129</a>
</span><span class=lnt id=hl-29-130><a class=lnlinks href=#hl-29-130>130</a>
</span><span class=lnt id=hl-29-131><a class=lnlinks href=#hl-29-131>131</a>
</span><span class=lnt id=hl-29-132><a class=lnlinks href=#hl-29-132>132</a>
</span><span class=lnt id=hl-29-133><a class=lnlinks href=#hl-29-133>133</a>
</span><span class=lnt id=hl-29-134><a class=lnlinks href=#hl-29-134>134</a>
</span><span class=lnt id=hl-29-135><a class=lnlinks href=#hl-29-135>135</a>
</span><span class=lnt id=hl-29-136><a class=lnlinks href=#hl-29-136>136</a>
</span><span class=lnt id=hl-29-137><a class=lnlinks href=#hl-29-137>137</a>
</span><span class=lnt id=hl-29-138><a class=lnlinks href=#hl-29-138>138</a>
</span><span class=lnt id=hl-29-139><a class=lnlinks href=#hl-29-139>139</a>
</span><span class=lnt id=hl-29-140><a class=lnlinks href=#hl-29-140>140</a>
</span><span class=lnt id=hl-29-141><a class=lnlinks href=#hl-29-141>141</a>
</span><span class=lnt id=hl-29-142><a class=lnlinks href=#hl-29-142>142</a>
</span><span class=lnt id=hl-29-143><a class=lnlinks href=#hl-29-143>143</a>
</span><span class=lnt id=hl-29-144><a class=lnlinks href=#hl-29-144>144</a>
</span><span class=lnt id=hl-29-145><a class=lnlinks href=#hl-29-145>145</a>
</span><span class=lnt id=hl-29-146><a class=lnlinks href=#hl-29-146>146</a>
</span><span class=lnt id=hl-29-147><a class=lnlinks href=#hl-29-147>147</a>
</span><span class=lnt id=hl-29-148><a class=lnlinks href=#hl-29-148>148</a>
</span><span class=lnt id=hl-29-149><a class=lnlinks href=#hl-29-149>149</a>
</span><span class=lnt id=hl-29-150><a class=lnlinks href=#hl-29-150>150</a>
</span><span class=lnt id=hl-29-151><a class=lnlinks href=#hl-29-151>151</a>
</span><span class=lnt id=hl-29-152><a class=lnlinks href=#hl-29-152>152</a>
</span><span class=lnt id=hl-29-153><a class=lnlinks href=#hl-29-153>153</a>
</span><span class=lnt id=hl-29-154><a class=lnlinks href=#hl-29-154>154</a>
</span><span class=lnt id=hl-29-155><a class=lnlinks href=#hl-29-155>155</a>
</span><span class=lnt id=hl-29-156><a class=lnlinks href=#hl-29-156>156</a>
</span><span class=lnt id=hl-29-157><a class=lnlinks href=#hl-29-157>157</a>
</span><span class=lnt id=hl-29-158><a class=lnlinks href=#hl-29-158>158</a>
</span><span class=lnt id=hl-29-159><a class=lnlinks href=#hl-29-159>159</a>
</span><span class=lnt id=hl-29-160><a class=lnlinks href=#hl-29-160>160</a>
</span><span class=lnt id=hl-29-161><a class=lnlinks href=#hl-29-161>161</a>
</span><span class=lnt id=hl-29-162><a class=lnlinks href=#hl-29-162>162</a>
</span><span class=lnt id=hl-29-163><a class=lnlinks href=#hl-29-163>163</a>
</span><span class=lnt id=hl-29-164><a class=lnlinks href=#hl-29-164>164</a>
</span><span class=lnt id=hl-29-165><a class=lnlinks href=#hl-29-165>165</a>
</span><span class=lnt id=hl-29-166><a class=lnlinks href=#hl-29-166>166</a>
</span><span class=lnt id=hl-29-167><a class=lnlinks href=#hl-29-167>167</a>
</span><span class=lnt id=hl-29-168><a class=lnlinks href=#hl-29-168>168</a>
</span><span class=lnt id=hl-29-169><a class=lnlinks href=#hl-29-169>169</a>
</span><span class=lnt id=hl-29-170><a class=lnlinks href=#hl-29-170>170</a>
</span><span class=lnt id=hl-29-171><a class=lnlinks href=#hl-29-171>171</a>
</span><span class=lnt id=hl-29-172><a class=lnlinks href=#hl-29-172>172</a>
</span><span class=lnt id=hl-29-173><a class=lnlinks href=#hl-29-173>173</a>
</span><span class=lnt id=hl-29-174><a class=lnlinks href=#hl-29-174>174</a>
</span><span class=lnt id=hl-29-175><a class=lnlinks href=#hl-29-175>175</a>
</span><span class=lnt id=hl-29-176><a class=lnlinks href=#hl-29-176>176</a>
</span><span class=lnt id=hl-29-177><a class=lnlinks href=#hl-29-177>177</a>
</span><span class=lnt id=hl-29-178><a class=lnlinks href=#hl-29-178>178</a>
</span><span class=lnt id=hl-29-179><a class=lnlinks href=#hl-29-179>179</a>
</span><span class=lnt id=hl-29-180><a class=lnlinks href=#hl-29-180>180</a>
</span><span class=lnt id=hl-29-181><a class=lnlinks href=#hl-29-181>181</a>
</span><span class=lnt id=hl-29-182><a class=lnlinks href=#hl-29-182>182</a>
</span><span class=lnt id=hl-29-183><a class=lnlinks href=#hl-29-183>183</a>
</span><span class=lnt id=hl-29-184><a class=lnlinks href=#hl-29-184>184</a>
</span><span class=lnt id=hl-29-185><a class=lnlinks href=#hl-29-185>185</a>
</span><span class=lnt id=hl-29-186><a class=lnlinks href=#hl-29-186>186</a>
</span><span class=lnt id=hl-29-187><a class=lnlinks href=#hl-29-187>187</a>
</span><span class=lnt id=hl-29-188><a class=lnlinks href=#hl-29-188>188</a>
</span><span class=lnt id=hl-29-189><a class=lnlinks href=#hl-29-189>189</a>
</span><span class=lnt id=hl-29-190><a class=lnlinks href=#hl-29-190>190</a>
</span><span class=lnt id=hl-29-191><a class=lnlinks href=#hl-29-191>191</a>
</span><span class=lnt id=hl-29-192><a class=lnlinks href=#hl-29-192>192</a>
</span><span class=lnt id=hl-29-193><a class=lnlinks href=#hl-29-193>193</a>
</span><span class=lnt id=hl-29-194><a class=lnlinks href=#hl-29-194>194</a>
</span><span class=lnt id=hl-29-195><a class=lnlinks href=#hl-29-195>195</a>
</span><span class=lnt id=hl-29-196><a class=lnlinks href=#hl-29-196>196</a>
</span><span class=lnt id=hl-29-197><a class=lnlinks href=#hl-29-197>197</a>
</span><span class=lnt id=hl-29-198><a class=lnlinks href=#hl-29-198>198</a>
</span><span class=lnt id=hl-29-199><a class=lnlinks href=#hl-29-199>199</a>
</span><span class=lnt id=hl-29-200><a class=lnlinks href=#hl-29-200>200</a>
</span><span class=lnt id=hl-29-201><a class=lnlinks href=#hl-29-201>201</a>
</span><span class=lnt id=hl-29-202><a class=lnlinks href=#hl-29-202>202</a>
</span><span class=lnt id=hl-29-203><a class=lnlinks href=#hl-29-203>203</a>
</span><span class=lnt id=hl-29-204><a class=lnlinks href=#hl-29-204>204</a>
</span><span class=lnt id=hl-29-205><a class=lnlinks href=#hl-29-205>205</a>
</span><span class=lnt id=hl-29-206><a class=lnlinks href=#hl-29-206>206</a>
</span><span class=lnt id=hl-29-207><a class=lnlinks href=#hl-29-207>207</a>
</span><span class=lnt id=hl-29-208><a class=lnlinks href=#hl-29-208>208</a>
</span><span class=lnt id=hl-29-209><a class=lnlinks href=#hl-29-209>209</a>
</span><span class=lnt id=hl-29-210><a class=lnlinks href=#hl-29-210>210</a>
</span><span class=lnt id=hl-29-211><a class=lnlinks href=#hl-29-211>211</a>
</span><span class=lnt id=hl-29-212><a class=lnlinks href=#hl-29-212>212</a>
</span><span class=lnt id=hl-29-213><a class=lnlinks href=#hl-29-213>213</a>
</span><span class=lnt id=hl-29-214><a class=lnlinks href=#hl-29-214>214</a>
</span><span class=lnt id=hl-29-215><a class=lnlinks href=#hl-29-215>215</a>
</span><span class=lnt id=hl-29-216><a class=lnlinks href=#hl-29-216>216</a>
</span><span class=lnt id=hl-29-217><a class=lnlinks href=#hl-29-217>217</a>
</span><span class=lnt id=hl-29-218><a class=lnlinks href=#hl-29-218>218</a>
</span><span class=lnt id=hl-29-219><a class=lnlinks href=#hl-29-219>219</a>
</span><span class=lnt id=hl-29-220><a class=lnlinks href=#hl-29-220>220</a>
</span><span class=lnt id=hl-29-221><a class=lnlinks href=#hl-29-221>221</a>
</span><span class=lnt id=hl-29-222><a class=lnlinks href=#hl-29-222>222</a>
</span><span class=lnt id=hl-29-223><a class=lnlinks href=#hl-29-223>223</a>
</span><span class=lnt id=hl-29-224><a class=lnlinks href=#hl-29-224>224</a>
</span><span class=lnt id=hl-29-225><a class=lnlinks href=#hl-29-225>225</a>
</span><span class=lnt id=hl-29-226><a class=lnlinks href=#hl-29-226>226</a>
</span><span class=lnt id=hl-29-227><a class=lnlinks href=#hl-29-227>227</a>
</span><span class=lnt id=hl-29-228><a class=lnlinks href=#hl-29-228>228</a>
</span><span class=lnt id=hl-29-229><a class=lnlinks href=#hl-29-229>229</a>
</span><span class=lnt id=hl-29-230><a class=lnlinks href=#hl-29-230>230</a>
</span><span class=lnt id=hl-29-231><a class=lnlinks href=#hl-29-231>231</a>
</span><span class=lnt id=hl-29-232><a class=lnlinks href=#hl-29-232>232</a>
</span><span class=lnt id=hl-29-233><a class=lnlinks href=#hl-29-233>233</a>
</span><span class=lnt id=hl-29-234><a class=lnlinks href=#hl-29-234>234</a>
</span><span class=lnt id=hl-29-235><a class=lnlinks href=#hl-29-235>235</a>
</span><span class=lnt id=hl-29-236><a class=lnlinks href=#hl-29-236>236</a>
</span><span class=lnt id=hl-29-237><a class=lnlinks href=#hl-29-237>237</a>
</span><span class=lnt id=hl-29-238><a class=lnlinks href=#hl-29-238>238</a>
</span><span class=lnt id=hl-29-239><a class=lnlinks href=#hl-29-239>239</a>
</span><span class=lnt id=hl-29-240><a class=lnlinks href=#hl-29-240>240</a>
</span><span class=lnt id=hl-29-241><a class=lnlinks href=#hl-29-241>241</a>
</span><span class=lnt id=hl-29-242><a class=lnlinks href=#hl-29-242>242</a>
</span><span class=lnt id=hl-29-243><a class=lnlinks href=#hl-29-243>243</a>
</span><span class=lnt id=hl-29-244><a class=lnlinks href=#hl-29-244>244</a>
</span><span class=lnt id=hl-29-245><a class=lnlinks href=#hl-29-245>245</a>
</span><span class=lnt id=hl-29-246><a class=lnlinks href=#hl-29-246>246</a>
</span><span class=lnt id=hl-29-247><a class=lnlinks href=#hl-29-247>247</a>
</span><span class=lnt id=hl-29-248><a class=lnlinks href=#hl-29-248>248</a>
</span><span class=lnt id=hl-29-249><a class=lnlinks href=#hl-29-249>249</a>
</span><span class=lnt id=hl-29-250><a class=lnlinks href=#hl-29-250>250</a>
</span><span class=lnt id=hl-29-251><a class=lnlinks href=#hl-29-251>251</a>
</span><span class=lnt id=hl-29-252><a class=lnlinks href=#hl-29-252>252</a>
</span><span class=lnt id=hl-29-253><a class=lnlinks href=#hl-29-253>253</a>
</span><span class=lnt id=hl-29-254><a class=lnlinks href=#hl-29-254>254</a>
</span><span class=lnt id=hl-29-255><a class=lnlinks href=#hl-29-255>255</a>
</span><span class=lnt id=hl-29-256><a class=lnlinks href=#hl-29-256>256</a>
</span><span class=lnt id=hl-29-257><a class=lnlinks href=#hl-29-257>257</a>
</span><span class=lnt id=hl-29-258><a class=lnlinks href=#hl-29-258>258</a>
</span><span class=lnt id=hl-29-259><a class=lnlinks href=#hl-29-259>259</a>
</span><span class=lnt id=hl-29-260><a class=lnlinks href=#hl-29-260>260</a>
</span><span class=lnt id=hl-29-261><a class=lnlinks href=#hl-29-261>261</a>
</span><span class=lnt id=hl-29-262><a class=lnlinks href=#hl-29-262>262</a>
</span><span class=lnt id=hl-29-263><a class=lnlinks href=#hl-29-263>263</a>
</span><span class=lnt id=hl-29-264><a class=lnlinks href=#hl-29-264>264</a>
</span><span class=lnt id=hl-29-265><a class=lnlinks href=#hl-29-265>265</a>
</span><span class=lnt id=hl-29-266><a class=lnlinks href=#hl-29-266>266</a>
</span><span class=lnt id=hl-29-267><a class=lnlinks href=#hl-29-267>267</a>
</span><span class=lnt id=hl-29-268><a class=lnlinks href=#hl-29-268>268</a>
</span><span class=lnt id=hl-29-269><a class=lnlinks href=#hl-29-269>269</a>
</span><span class=lnt id=hl-29-270><a class=lnlinks href=#hl-29-270>270</a>
</span><span class=lnt id=hl-29-271><a class=lnlinks href=#hl-29-271>271</a>
</span><span class=lnt id=hl-29-272><a class=lnlinks href=#hl-29-272>272</a>
</span><span class=lnt id=hl-29-273><a class=lnlinks href=#hl-29-273>273</a>
</span><span class=lnt id=hl-29-274><a class=lnlinks href=#hl-29-274>274</a>
</span><span class=lnt id=hl-29-275><a class=lnlinks href=#hl-29-275>275</a>
</span><span class=lnt id=hl-29-276><a class=lnlinks href=#hl-29-276>276</a>
</span><span class=lnt id=hl-29-277><a class=lnlinks href=#hl-29-277>277</a>
</span><span class=lnt id=hl-29-278><a class=lnlinks href=#hl-29-278>278</a>
</span><span class=lnt id=hl-29-279><a class=lnlinks href=#hl-29-279>279</a>
</span><span class=lnt id=hl-29-280><a class=lnlinks href=#hl-29-280>280</a>
</span><span class=lnt id=hl-29-281><a class=lnlinks href=#hl-29-281>281</a>
</span><span class=lnt id=hl-29-282><a class=lnlinks href=#hl-29-282>282</a>
</span><span class=lnt id=hl-29-283><a class=lnlinks href=#hl-29-283>283</a>
</span><span class=lnt id=hl-29-284><a class=lnlinks href=#hl-29-284>284</a>
</span><span class=lnt id=hl-29-285><a class=lnlinks href=#hl-29-285>285</a>
</span><span class=lnt id=hl-29-286><a class=lnlinks href=#hl-29-286>286</a>
</span><span class=lnt id=hl-29-287><a class=lnlinks href=#hl-29-287>287</a>
</span><span class=lnt id=hl-29-288><a class=lnlinks href=#hl-29-288>288</a>
</span><span class=lnt id=hl-29-289><a class=lnlinks href=#hl-29-289>289</a>
</span><span class=lnt id=hl-29-290><a class=lnlinks href=#hl-29-290>290</a>
</span><span class=lnt id=hl-29-291><a class=lnlinks href=#hl-29-291>291</a>
</span><span class=lnt id=hl-29-292><a class=lnlinks href=#hl-29-292>292</a>
</span><span class=lnt id=hl-29-293><a class=lnlinks href=#hl-29-293>293</a>
</span><span class=lnt id=hl-29-294><a class=lnlinks href=#hl-29-294>294</a>
</span><span class=lnt id=hl-29-295><a class=lnlinks href=#hl-29-295>295</a>
</span><span class=lnt id=hl-29-296><a class=lnlinks href=#hl-29-296>296</a>
</span><span class=lnt id=hl-29-297><a class=lnlinks href=#hl-29-297>297</a>
</span><span class=lnt id=hl-29-298><a class=lnlinks href=#hl-29-298>298</a>
</span><span class=lnt id=hl-29-299><a class=lnlinks href=#hl-29-299>299</a>
</span><span class=lnt id=hl-29-300><a class=lnlinks href=#hl-29-300>300</a>
</span><span class=lnt id=hl-29-301><a class=lnlinks href=#hl-29-301>301</a>
</span><span class=lnt id=hl-29-302><a class=lnlinks href=#hl-29-302>302</a>
</span><span class=lnt id=hl-29-303><a class=lnlinks href=#hl-29-303>303</a>
</span><span class=lnt id=hl-29-304><a class=lnlinks href=#hl-29-304>304</a>
</span><span class=lnt id=hl-29-305><a class=lnlinks href=#hl-29-305>305</a>
</span><span class=lnt id=hl-29-306><a class=lnlinks href=#hl-29-306>306</a>
</span><span class=lnt id=hl-29-307><a class=lnlinks href=#hl-29-307>307</a>
</span><span class=lnt id=hl-29-308><a class=lnlinks href=#hl-29-308>308</a>
</span><span class=lnt id=hl-29-309><a class=lnlinks href=#hl-29-309>309</a>
</span><span class=lnt id=hl-29-310><a class=lnlinks href=#hl-29-310>310</a>
</span><span class=lnt id=hl-29-311><a class=lnlinks href=#hl-29-311>311</a>
</span><span class=lnt id=hl-29-312><a class=lnlinks href=#hl-29-312>312</a>
</span><span class=lnt id=hl-29-313><a class=lnlinks href=#hl-29-313>313</a>
</span><span class=lnt id=hl-29-314><a class=lnlinks href=#hl-29-314>314</a>
</span><span class=lnt id=hl-29-315><a class=lnlinks href=#hl-29-315>315</a>
</span><span class=lnt id=hl-29-316><a class=lnlinks href=#hl-29-316>316</a>
</span><span class=lnt id=hl-29-317><a class=lnlinks href=#hl-29-317>317</a>
</span><span class=lnt id=hl-29-318><a class=lnlinks href=#hl-29-318>318</a>
</span><span class=lnt id=hl-29-319><a class=lnlinks href=#hl-29-319>319</a>
</span><span class=lnt id=hl-29-320><a class=lnlinks href=#hl-29-320>320</a>
</span><span class=lnt id=hl-29-321><a class=lnlinks href=#hl-29-321>321</a>
</span><span class=lnt id=hl-29-322><a class=lnlinks href=#hl-29-322>322</a>
</span><span class=lnt id=hl-29-323><a class=lnlinks href=#hl-29-323>323</a>
</span><span class=lnt id=hl-29-324><a class=lnlinks href=#hl-29-324>324</a>
</span><span class=lnt id=hl-29-325><a class=lnlinks href=#hl-29-325>325</a>
</span><span class=lnt id=hl-29-326><a class=lnlinks href=#hl-29-326>326</a>
</span><span class=lnt id=hl-29-327><a class=lnlinks href=#hl-29-327>327</a>
</span><span class=lnt id=hl-29-328><a class=lnlinks href=#hl-29-328>328</a>
</span><span class=lnt id=hl-29-329><a class=lnlinks href=#hl-29-329>329</a>
</span><span class=lnt id=hl-29-330><a class=lnlinks href=#hl-29-330>330</a>
</span><span class=lnt id=hl-29-331><a class=lnlinks href=#hl-29-331>331</a>
</span><span class=lnt id=hl-29-332><a class=lnlinks href=#hl-29-332>332</a>
</span><span class=lnt id=hl-29-333><a class=lnlinks href=#hl-29-333>333</a>
</span><span class=lnt id=hl-29-334><a class=lnlinks href=#hl-29-334>334</a>
</span><span class=lnt id=hl-29-335><a class=lnlinks href=#hl-29-335>335</a>
</span><span class=lnt id=hl-29-336><a class=lnlinks href=#hl-29-336>336</a>
</span><span class=lnt id=hl-29-337><a class=lnlinks href=#hl-29-337>337</a>
</span><span class=lnt id=hl-29-338><a class=lnlinks href=#hl-29-338>338</a>
</span><span class=lnt id=hl-29-339><a class=lnlinks href=#hl-29-339>339</a>
</span><span class=lnt id=hl-29-340><a class=lnlinks href=#hl-29-340>340</a>
</span><span class=lnt id=hl-29-341><a class=lnlinks href=#hl-29-341>341</a>
</span><span class=lnt id=hl-29-342><a class=lnlinks href=#hl-29-342>342</a>
</span><span class=lnt id=hl-29-343><a class=lnlinks href=#hl-29-343>343</a>
</span><span class=lnt id=hl-29-344><a class=lnlinks href=#hl-29-344>344</a>
</span><span class=lnt id=hl-29-345><a class=lnlinks href=#hl-29-345>345</a>
</span><span class=lnt id=hl-29-346><a class=lnlinks href=#hl-29-346>346</a>
</span><span class=lnt id=hl-29-347><a class=lnlinks href=#hl-29-347>347</a>
</span><span class=lnt id=hl-29-348><a class=lnlinks href=#hl-29-348>348</a>
</span><span class=lnt id=hl-29-349><a class=lnlinks href=#hl-29-349>349</a>
</span><span class=lnt id=hl-29-350><a class=lnlinks href=#hl-29-350>350</a>
</span><span class=lnt id=hl-29-351><a class=lnlinks href=#hl-29-351>351</a>
</span><span class=lnt id=hl-29-352><a class=lnlinks href=#hl-29-352>352</a>
</span><span class=lnt id=hl-29-353><a class=lnlinks href=#hl-29-353>353</a>
</span><span class=lnt id=hl-29-354><a class=lnlinks href=#hl-29-354>354</a>
</span><span class=lnt id=hl-29-355><a class=lnlinks href=#hl-29-355>355</a>
</span><span class=lnt id=hl-29-356><a class=lnlinks href=#hl-29-356>356</a>
</span><span class=lnt id=hl-29-357><a class=lnlinks href=#hl-29-357>357</a>
</span><span class=lnt id=hl-29-358><a class=lnlinks href=#hl-29-358>358</a>
</span><span class=lnt id=hl-29-359><a class=lnlinks href=#hl-29-359>359</a>
</span><span class=lnt id=hl-29-360><a class=lnlinks href=#hl-29-360>360</a>
</span><span class=lnt id=hl-29-361><a class=lnlinks href=#hl-29-361>361</a>
</span><span class=lnt id=hl-29-362><a class=lnlinks href=#hl-29-362>362</a>
</span><span class=lnt id=hl-29-363><a class=lnlinks href=#hl-29-363>363</a>
</span><span class=lnt id=hl-29-364><a class=lnlinks href=#hl-29-364>364</a>
</span><span class=lnt id=hl-29-365><a class=lnlinks href=#hl-29-365>365</a>
</span><span class=lnt id=hl-29-366><a class=lnlinks href=#hl-29-366>366</a>
</span><span class=lnt id=hl-29-367><a class=lnlinks href=#hl-29-367>367</a>
</span><span class=lnt id=hl-29-368><a class=lnlinks href=#hl-29-368>368</a>
</span><span class=lnt id=hl-29-369><a class=lnlinks href=#hl-29-369>369</a>
</span><span class=lnt id=hl-29-370><a class=lnlinks href=#hl-29-370>370</a>
</span><span class=lnt id=hl-29-371><a class=lnlinks href=#hl-29-371>371</a>
</span><span class=lnt id=hl-29-372><a class=lnlinks href=#hl-29-372>372</a>
</span><span class=lnt id=hl-29-373><a class=lnlinks href=#hl-29-373>373</a>
</span><span class=lnt id=hl-29-374><a class=lnlinks href=#hl-29-374>374</a>
</span><span class=lnt id=hl-29-375><a class=lnlinks href=#hl-29-375>375</a>
</span><span class=lnt id=hl-29-376><a class=lnlinks href=#hl-29-376>376</a>
</span><span class=lnt id=hl-29-377><a class=lnlinks href=#hl-29-377>377</a>
</span><span class=lnt id=hl-29-378><a class=lnlinks href=#hl-29-378>378</a>
</span><span class=lnt id=hl-29-379><a class=lnlinks href=#hl-29-379>379</a>
</span><span class=lnt id=hl-29-380><a class=lnlinks href=#hl-29-380>380</a>
</span><span class=lnt id=hl-29-381><a class=lnlinks href=#hl-29-381>381</a>
</span><span class=lnt id=hl-29-382><a class=lnlinks href=#hl-29-382>382</a>
</span><span class=lnt id=hl-29-383><a class=lnlinks href=#hl-29-383>383</a>
</span><span class=lnt id=hl-29-384><a class=lnlinks href=#hl-29-384>384</a>
</span><span class=lnt id=hl-29-385><a class=lnlinks href=#hl-29-385>385</a>
</span><span class=lnt id=hl-29-386><a class=lnlinks href=#hl-29-386>386</a>
</span><span class=lnt id=hl-29-387><a class=lnlinks href=#hl-29-387>387</a>
</span><span class=lnt id=hl-29-388><a class=lnlinks href=#hl-29-388>388</a>
</span><span class=lnt id=hl-29-389><a class=lnlinks href=#hl-29-389>389</a>
</span><span class=lnt id=hl-29-390><a class=lnlinks href=#hl-29-390>390</a>
</span><span class=lnt id=hl-29-391><a class=lnlinks href=#hl-29-391>391</a>
</span><span class=lnt id=hl-29-392><a class=lnlinks href=#hl-29-392>392</a>
</span><span class=lnt id=hl-29-393><a class=lnlinks href=#hl-29-393>393</a>
</span><span class=lnt id=hl-29-394><a class=lnlinks href=#hl-29-394>394</a>
</span><span class=lnt id=hl-29-395><a class=lnlinks href=#hl-29-395>395</a>
</span><span class=lnt id=hl-29-396><a class=lnlinks href=#hl-29-396>396</a>
</span><span class=lnt id=hl-29-397><a class=lnlinks href=#hl-29-397>397</a>
</span><span class=lnt id=hl-29-398><a class=lnlinks href=#hl-29-398>398</a>
</span><span class=lnt id=hl-29-399><a class=lnlinks href=#hl-29-399>399</a>
</span><span class=lnt id=hl-29-400><a class=lnlinks href=#hl-29-400>400</a>
</span><span class=lnt id=hl-29-401><a class=lnlinks href=#hl-29-401>401</a>
</span><span class=lnt id=hl-29-402><a class=lnlinks href=#hl-29-402>402</a>
</span><span class=lnt id=hl-29-403><a class=lnlinks href=#hl-29-403>403</a>
</span><span class=lnt id=hl-29-404><a class=lnlinks href=#hl-29-404>404</a>
</span><span class=lnt id=hl-29-405><a class=lnlinks href=#hl-29-405>405</a>
</span><span class=lnt id=hl-29-406><a class=lnlinks href=#hl-29-406>406</a>
</span><span class=lnt id=hl-29-407><a class=lnlinks href=#hl-29-407>407</a>
</span><span class=lnt id=hl-29-408><a class=lnlinks href=#hl-29-408>408</a>
</span><span class=lnt id=hl-29-409><a class=lnlinks href=#hl-29-409>409</a>
</span><span class=lnt id=hl-29-410><a class=lnlinks href=#hl-29-410>410</a>
</span><span class=lnt id=hl-29-411><a class=lnlinks href=#hl-29-411>411</a>
</span><span class=lnt id=hl-29-412><a class=lnlinks href=#hl-29-412>412</a>
</span><span class=lnt id=hl-29-413><a class=lnlinks href=#hl-29-413>413</a>
</span><span class=lnt id=hl-29-414><a class=lnlinks href=#hl-29-414>414</a>
</span><span class=lnt id=hl-29-415><a class=lnlinks href=#hl-29-415>415</a>
</span><span class=lnt id=hl-29-416><a class=lnlinks href=#hl-29-416>416</a>
</span><span class=lnt id=hl-29-417><a class=lnlinks href=#hl-29-417>417</a>
</span><span class=lnt id=hl-29-418><a class=lnlinks href=#hl-29-418>418</a>
</span><span class=lnt id=hl-29-419><a class=lnlinks href=#hl-29-419>419</a>
</span><span class=lnt id=hl-29-420><a class=lnlinks href=#hl-29-420>420</a>
</span><span class=lnt id=hl-29-421><a class=lnlinks href=#hl-29-421>421</a>
</span><span class=lnt id=hl-29-422><a class=lnlinks href=#hl-29-422>422</a>
</span><span class=lnt id=hl-29-423><a class=lnlinks href=#hl-29-423>423</a>
</span><span class=lnt id=hl-29-424><a class=lnlinks href=#hl-29-424>424</a>
</span><span class=lnt id=hl-29-425><a class=lnlinks href=#hl-29-425>425</a>
</span><span class=lnt id=hl-29-426><a class=lnlinks href=#hl-29-426>426</a>
</span><span class=lnt id=hl-29-427><a class=lnlinks href=#hl-29-427>427</a>
</span><span class=lnt id=hl-29-428><a class=lnlinks href=#hl-29-428>428</a>
</span><span class=lnt id=hl-29-429><a class=lnlinks href=#hl-29-429>429</a>
</span><span class=lnt id=hl-29-430><a class=lnlinks href=#hl-29-430>430</a>
</span><span class=lnt id=hl-29-431><a class=lnlinks href=#hl-29-431>431</a>
</span><span class=lnt id=hl-29-432><a class=lnlinks href=#hl-29-432>432</a>
</span><span class=lnt id=hl-29-433><a class=lnlinks href=#hl-29-433>433</a>
</span><span class=lnt id=hl-29-434><a class=lnlinks href=#hl-29-434>434</a>
</span><span class=lnt id=hl-29-435><a class=lnlinks href=#hl-29-435>435</a>
</span><span class=lnt id=hl-29-436><a class=lnlinks href=#hl-29-436>436</a>
</span><span class=lnt id=hl-29-437><a class=lnlinks href=#hl-29-437>437</a>
</span><span class=lnt id=hl-29-438><a class=lnlinks href=#hl-29-438>438</a>
</span><span class=lnt id=hl-29-439><a class=lnlinks href=#hl-29-439>439</a>
</span><span class=lnt id=hl-29-440><a class=lnlinks href=#hl-29-440>440</a>
</span><span class=lnt id=hl-29-441><a class=lnlinks href=#hl-29-441>441</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=c1>// React를 사용한 현대적인 API 키 관리 인터페이스 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nx>Card</span><span class=p>,</span> <span class=nx>Button</span><span class=p>,</span> <span class=nx>Tabs</span><span class=p>,</span> <span class=nx>Form</span><span class=p>,</span> <span class=nx>Input</span><span class=p>,</span> <span class=nx>Select</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nx>Switch</span><span class=p>,</span> <span class=nx>DatePicker</span><span class=p>,</span> <span class=nx>Table</span><span class=p>,</span> <span class=nx>Tag</span><span class=p>,</span> <span class=nx>Tooltip</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nx>Badge</span><span class=p>,</span> <span class=nx>Alert</span><span class=p>,</span> <span class=nx>Modal</span><span class=p>,</span> <span class=nx>message</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;antd&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nx>KeyOutlined</span><span class=p>,</span> <span class=nx>ClockCircleOutlined</span><span class=p>,</span> <span class=nx>LockOutlined</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nx>ApiOutlined</span><span class=p>,</span> <span class=nx>LineChartOutlined</span><span class=p>,</span> <span class=nx>SettingOutlined</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>PlusOutlined</span><span class=p>,</span> <span class=nx>CopyOutlined</span><span class=p>,</span> <span class=nx>EyeOutlined</span><span class=p>,</span> <span class=nx>EyeInvisibleOutlined</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@ant-design/icons&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>TabPane</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>Tabs</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Option</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>Select</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ApiKeyManagement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>apiKeys</span><span class=p>,</span> <span class=nx>setApiKeys</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>setLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>visibleKey</span><span class=p>,</span> <span class=nx>setVisibleKey</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>createModalVisible</span><span class=p>,</span> <span class=nx>setCreateModalVisible</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>newKeyForm</span><span class=p>]</span> <span class=o>=</span> <span class=nx>Form</span><span class=p>.</span><span class=nx>useForm</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetchApiKeys</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>fetchApiKeys</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>setLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/api/developer/keys&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;auth_token&#39;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;API 키를 가져오는 데 실패했습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>setApiKeys</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>keys</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>handleCreateKey</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>values</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/api/developer/keys&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;auth_token&#39;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>name</span><span class=o>:</span> <span class=nx>values</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>expiresAt</span><span class=o>:</span> <span class=nx>values</span><span class=p>.</span><span class=nx>expiresAt</span><span class=o>?</span><span class=p>.</span><span class=nx>toISOString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>          <span class=nx>scopes</span><span class=o>:</span> <span class=nx>values</span><span class=p>.</span><span class=nx>scopes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>allowedIps</span><span class=o>:</span> <span class=nx>values</span><span class=p>.</span><span class=nx>allowedIps</span><span class=o>?</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>ip</span> <span class=p>=&gt;</span> <span class=nx>ip</span><span class=p>.</span><span class=nx>trim</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>          <span class=nx>allowedReferrers</span><span class=o>:</span> <span class=nx>values</span><span class=p>.</span><span class=nx>allowedReferrers</span><span class=o>?</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>ref</span> <span class=p>=&gt;</span> <span class=nx>ref</span><span class=p>.</span><span class=nx>trim</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>          <span class=nx>rateLimitPerMinute</span><span class=o>:</span> <span class=nx>values</span><span class=p>.</span><span class=nx>rateLimitPerMinute</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;API 키 생성에 실패했습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>Modal</span><span class=p>.</span><span class=nx>success</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;API 키가 생성되었습니다&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>아래</span> <span class=nx>API</span> <span class=nx>키를</span> <span class=nx>안전한</span> <span class=nx>곳에</span> <span class=nx>저장하세요</span><span class=p>.</span> <span class=nx>이</span> <span class=nx>키는</span> <span class=nx>다시</span> <span class=nx>표시되지</span> <span class=nx>않습니다</span><span class=p>.&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Input.Group</span> <span class=na>compact</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Input</span>
</span></span><span class=line><span class=cl>                <span class=na>readOnly</span>
</span></span><span class=line><span class=cl>                <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>width</span><span class=o>:</span> <span class=s1>&#39;calc(100% - 32px)&#39;</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>                <span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=nx>data</span><span class=p>.</span><span class=nx>key</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Tooltip</span> <span class=na>title</span><span class=o>=</span><span class=s>&#34;복사&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>Button</span> 
</span></span><span class=line><span class=cl>                  <span class=na>icon</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>CopyOutlined</span> <span class=p>/&gt;}</span>
</span></span><span class=line><span class=cl>                  <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>navigator</span><span class=p>.</span><span class=nx>clipboard</span><span class=p>.</span><span class=nx>writeText</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>message</span><span class=p>.</span><span class=nx>success</span><span class=p>(</span><span class=s1>&#39;API 키가 클립보드에 복사되었습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                  <span class=p>}}</span>
</span></span><span class=line><span class=cl>                <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Tooltip</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>Input.Group</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>onOk</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>setCreateModalVisible</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>newKeyForm</span><span class=p>.</span><span class=nx>resetFields</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=nx>fetchApiKeys</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>handleRevokeKey</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>keyId</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Modal</span><span class=p>.</span><span class=nx>confirm</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;API 키 취소&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;이 API 키를 취소하시겠습니까? 이 작업은 되돌릴 수 없으며, 이 키를 사용하는 모든 애플리케이션이 즉시 작동을 중지합니다.&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>okText</span><span class=o>:</span> <span class=s1>&#39;취소&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>okType</span><span class=o>:</span> <span class=s1>&#39;danger&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cancelText</span><span class=o>:</span> <span class=s1>&#39;취소 안 함&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>onOk</span><span class=o>:</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/developer/keys/</span><span class=si>${</span><span class=nx>keyId</span><span class=si>}</span><span class=sb>/revoke`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;auth_token&#39;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;API 키 취소에 실패했습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=p>.</span><span class=nx>success</span><span class=p>(</span><span class=s1>&#39;API 키가 성공적으로 취소되었습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>fetchApiKeys</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>handleRefreshKey</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>keyId</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Modal</span><span class=p>.</span><span class=nx>confirm</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;API 키 갱신&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;이 API 키를 갱신하시겠습니까? 새 키가 생성되고 이전 키는 30일의 유예 기간 후 만료됩니다.&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>okText</span><span class=o>:</span> <span class=s1>&#39;갱신&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cancelText</span><span class=o>:</span> <span class=s1>&#39;취소&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>onOk</span><span class=o>:</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/developer/keys/</span><span class=si>${</span><span class=nx>keyId</span><span class=si>}</span><span class=sb>/refresh`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;auth_token&#39;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;API 키 갱신에 실패했습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>Modal</span><span class=p>.</span><span class=nx>success</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;새 API 키가 생성되었습니다&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>content</span><span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>아래</span> <span class=nx>API</span> <span class=nx>키를</span> <span class=nx>안전한</span> <span class=nx>곳에</span> <span class=nx>저장하세요</span><span class=p>.</span> <span class=nx>이</span> <span class=nx>키는</span> <span class=nx>다시</span> <span class=nx>표시되지</span> <span class=nx>않습니다</span><span class=p>.&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>기존</span> <span class=nx>키는</span> <span class=p>{</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>graceEnd</span><span class=p>).</span><span class=nx>toLocaleDateString</span><span class=p>()}</span><span class=nx>까지</span> <span class=nx>계속</span> <span class=nx>작동합니다</span><span class=p>.&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>Input.Group</span> <span class=na>compact</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Input</span>
</span></span><span class=line><span class=cl>                    <span class=na>readOnly</span>
</span></span><span class=line><span class=cl>                    <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>width</span><span class=o>:</span> <span class=s1>&#39;calc(100% - 32px)&#39;</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>                    <span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=nx>data</span><span class=p>.</span><span class=nx>newKey</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Tooltip</span> <span class=na>title</span><span class=o>=</span><span class=s>&#34;복사&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>Button</span> 
</span></span><span class=line><span class=cl>                      <span class=na>icon</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>CopyOutlined</span> <span class=p>/&gt;}</span>
</span></span><span class=line><span class=cl>                      <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>navigator</span><span class=p>.</span><span class=nx>clipboard</span><span class=p>.</span><span class=nx>writeText</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>newKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=nx>message</span><span class=p>.</span><span class=nx>success</span><span class=p>(</span><span class=s1>&#39;API 키가 클립보드에 복사되었습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                      <span class=p>}}</span>
</span></span><span class=line><span class=cl>                    <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Tooltip</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>Input.Group</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>onOk</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>fetchApiKeys</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toggleKeyVisibility</span> <span class=o>=</span> <span class=p>(</span><span class=nx>keyId</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setVisibleKey</span><span class=p>(</span><span class=nx>visibleKey</span> <span class=o>===</span> <span class=nx>keyId</span> <span class=o>?</span> <span class=kc>null</span> <span class=o>:</span> <span class=nx>keyId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>columns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;이름&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dataIndex</span><span class=o>:</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=p>(</span><span class=nx>text</span><span class=p>,</span> <span class=nx>record</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{</span><span class=nx>text</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>small</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#888&#39;</span> <span class=p>}}&gt;</span><span class=nx>생성일</span><span class=o>:</span> <span class=p>{</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>createdAt</span><span class=p>).</span><span class=nx>toLocaleDateString</span><span class=p>()}&lt;/</span><span class=nt>small</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;API 키&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dataIndex</span><span class=o>:</span> <span class=s1>&#39;key&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;key&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=p>(</span><span class=nx>text</span><span class=p>,</span> <span class=nx>record</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>visibleKey</span> <span class=o>===</span> <span class=nx>record</span><span class=p>.</span><span class=nx>id</span> <span class=o>?</span> 
</span></span><span class=line><span class=cl>              <span class=nx>record</span><span class=p>.</span><span class=nx>keyPrefix</span> <span class=o>+</span> <span class=nx>record</span><span class=p>.</span><span class=nx>keyHint</span> <span class=o>:</span> 
</span></span><span class=line><span class=cl>              <span class=nx>record</span><span class=p>.</span><span class=nx>keyPrefix</span> <span class=o>+</span> <span class=s1>&#39;••••••••••••••&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Button</span> 
</span></span><span class=line><span class=cl>              <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> 
</span></span><span class=line><span class=cl>              <span class=na>size</span><span class=o>=</span><span class=s>&#34;small&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>icon</span><span class=o>=</span><span class=p>{</span><span class=nx>visibleKey</span> <span class=o>===</span> <span class=nx>record</span><span class=p>.</span><span class=nx>id</span> <span class=o>?</span> <span class=p>&lt;</span><span class=nt>EyeInvisibleOutlined</span> <span class=p>/&gt;</span> <span class=o>:</span> <span class=p>&lt;</span><span class=nt>EyeOutlined</span> <span class=p>/&gt;}</span>
</span></span><span class=line><span class=cl>              <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>toggleKeyVisibility</span><span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>            <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>keyPrefix</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Tag</span> <span class=na>color</span><span class=o>=</span><span class=s>&#34;blue&#34;</span><span class=p>&gt;{</span><span class=nx>record</span><span class=p>.</span><span class=nx>keyType</span> <span class=o>||</span> <span class=s1>&#39;LIVE&#39;</span><span class=p>}&lt;/</span><span class=nt>Tag</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;상태&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dataIndex</span><span class=o>:</span> <span class=s1>&#39;status&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;status&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=nx>status</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>color</span> <span class=o>=</span> <span class=s1>&#39;default&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;active&#39;</span><span class=p>)</span> <span class=nx>color</span> <span class=o>=</span> <span class=s1>&#39;success&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;revoked&#39;</span><span class=p>)</span> <span class=nx>color</span> <span class=o>=</span> <span class=s1>&#39;error&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;expired&#39;</span><span class=p>)</span> <span class=nx>color</span> <span class=o>=</span> <span class=s1>&#39;warning&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>&lt;</span><span class=nt>Badge</span> <span class=na>status</span><span class=o>=</span><span class=p>{</span><span class=nx>color</span><span class=p>}</span> <span class=na>text</span><span class=o>=</span><span class=p>{</span><span class=nx>status</span><span class=p>.</span><span class=nx>charAt</span><span class=p>(</span><span class=mi>0</span><span class=p>).</span><span class=nx>toUpperCase</span><span class=p>()</span> <span class=o>+</span> <span class=nx>status</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>)}</span> <span class=p>/&gt;;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;범위&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dataIndex</span><span class=o>:</span> <span class=s1>&#39;scopes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;scopes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=nx>scopes</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span><span class=nx>scopes</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>scope</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Tag</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>scope</span><span class=p>}</span> <span class=na>color</span><span class=o>=</span><span class=s>&#34;green&#34;</span><span class=p>&gt;{</span><span class=nx>scope</span><span class=p>}&lt;/</span><span class=nt>Tag</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>))}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;만료일&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dataIndex</span><span class=o>:</span> <span class=s1>&#39;expiresAt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;expiresAt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=nx>date</span> <span class=p>=&gt;</span> <span class=nx>date</span> <span class=o>?</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>date</span><span class=p>).</span><span class=nx>toLocaleDateString</span><span class=p>()</span> <span class=o>:</span> <span class=s1>&#39;만료 없음&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;마지막 사용&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dataIndex</span><span class=o>:</span> <span class=s1>&#39;lastUsed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;lastUsed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=nx>date</span> <span class=p>=&gt;</span> <span class=nx>date</span> <span class=o>?</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>date</span><span class=p>).</span><span class=nx>toLocaleDateString</span><span class=p>()</span> <span class=o>:</span> <span class=s1>&#39;미사용&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;작업&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;action&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=o>:</span> <span class=p>(</span><span class=nx>_</span><span class=p>,</span> <span class=nx>record</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;active&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Button</span> 
</span></span><span class=line><span class=cl>                <span class=na>type</span><span class=o>=</span><span class=s>&#34;link&#34;</span> 
</span></span><span class=line><span class=cl>                <span class=na>size</span><span class=o>=</span><span class=s>&#34;small&#34;</span> 
</span></span><span class=line><span class=cl>                <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>handleRefreshKey</span><span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>갱신</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Button</span> 
</span></span><span class=line><span class=cl>                <span class=na>type</span><span class=o>=</span><span class=s>&#34;link&#34;</span> 
</span></span><span class=line><span class=cl>                <span class=na>danger</span>
</span></span><span class=line><span class=cl>                <span class=na>size</span><span class=o>=</span><span class=s>&#34;small&#34;</span> 
</span></span><span class=line><span class=cl>                <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>handleRevokeKey</span><span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>취소</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;api-key-management&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Card</span>
</span></span><span class=line><span class=cl>        <span class=na>title</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>display</span><span class=o>:</span> <span class=s1>&#39;flex&#39;</span><span class=p>,</span> <span class=nx>justifyContent</span><span class=o>:</span> <span class=s1>&#39;space-between&#39;</span><span class=p>,</span> <span class=nx>alignItems</span><span class=o>:</span> <span class=s1>&#39;center&#39;</span> <span class=p>}}&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;&lt;</span><span class=nt>KeyOutlined</span> <span class=p>/&gt;</span> <span class=nx>API</span> <span class=nx>키</span> <span class=nx>관리</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Button</span> 
</span></span><span class=line><span class=cl>              <span class=na>type</span><span class=o>=</span><span class=s>&#34;primary&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>icon</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>PlusOutlined</span> <span class=p>/&gt;}</span>
</span></span><span class=line><span class=cl>              <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setCreateModalVisible</span><span class=p>(</span><span class=kc>true</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nx>새</span> <span class=nx>API</span> <span class=nx>키</span> <span class=nx>생성</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>Button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Alert</span>
</span></span><span class=line><span class=cl>          <span class=na>message</span><span class=o>=</span><span class=s>&#34;API 키 보안 알림&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>description</span><span class=o>=</span><span class=s>&#34;API 키는 암호처럼 취급하세요. 소스 코드, 버전 관리 시스템 또는 공개 저장소에 키를 저장하지 마세요. 키가 노출되면 즉시 취소하고 갱신하세요.&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>type</span><span class=o>=</span><span class=s>&#34;warning&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>showIcon</span>
</span></span><span class=line><span class=cl>          <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>marginBottom</span><span class=o>:</span> <span class=mi>16</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Table</span> 
</span></span><span class=line><span class=cl>          <span class=na>dataSource</span><span class=o>=</span><span class=p>{</span><span class=nx>apiKeys</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>          <span class=na>columns</span><span class=o>=</span><span class=p>{</span><span class=nx>columns</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=na>rowKey</span><span class=o>=</span><span class=s>&#34;id&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>loading</span><span class=o>=</span><span class=p>{</span><span class=nx>loading</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=na>pagination</span><span class=o>=</span><span class=p>{{</span> <span class=nx>pageSize</span><span class=o>:</span> <span class=mi>10</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>Card</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Modal</span>
</span></span><span class=line><span class=cl>        <span class=na>title</span><span class=o>=</span><span class=s>&#34;새 API 키 생성&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>visible</span><span class=o>=</span><span class=p>{</span><span class=nx>createModalVisible</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=na>onCancel</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setCreateModalVisible</span><span class=p>(</span><span class=kc>false</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=na>footer</span><span class=o>=</span><span class=p>{</span><span class=kc>null</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=na>width</span><span class=o>=</span><span class=p>{</span><span class=mi>700</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Form</span>
</span></span><span class=line><span class=cl>          <span class=na>form</span><span class=o>=</span><span class=p>{</span><span class=nx>newKeyForm</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=na>layout</span><span class=o>=</span><span class=s>&#34;vertical&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>onFinish</span><span class=o>=</span><span class=p>{</span><span class=nx>handleCreateKey</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span>
</span></span><span class=line><span class=cl>            <span class=na>name</span><span class=o>=</span><span class=s>&#34;name&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>label</span><span class=o>=</span><span class=s>&#34;키 이름&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>rules</span><span class=o>=</span><span class=p>{[{</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;키 이름을 입력하세요&#39;</span> <span class=p>}]}</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Input</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;예: 프로덕션 백엔드, 테스트 환경 등&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span>
</span></span><span class=line><span class=cl>            <span class=na>name</span><span class=o>=</span><span class=s>&#34;scopes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>label</span><span class=o>=</span><span class=s>&#34;접근 범위&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>rules</span><span class=o>=</span><span class=p>{[{</span> <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;하나 이상의 범위를 선택하세요&#39;</span> <span class=p>}]}</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Select</span> 
</span></span><span class=line><span class=cl>              <span class=na>mode</span><span class=o>=</span><span class=s>&#34;multiple&#34;</span> 
</span></span><span class=line><span class=cl>              <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;이 키에 부여할 권한 선택&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>optionLabelProp</span><span class=o>=</span><span class=s>&#34;label&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;read:users&#34;</span> <span class=na>label</span><span class=o>=</span><span class=s>&#34;사용자 읽기&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>strong</span><span class=p>&gt;</span><span class=nx>사용자</span> <span class=nx>읽기</span><span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>사용자</span> <span class=nx>정보</span> <span class=nx>조회</span> <span class=nx>권한</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;write:users&#34;</span> <span class=na>label</span><span class=o>=</span><span class=s>&#34;사용자 쓰기&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>strong</span><span class=p>&gt;</span><span class=nx>사용자</span> <span class=nx>쓰기</span><span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>사용자</span> <span class=nx>생성</span> <span class=nx>및</span> <span class=nx>수정</span> <span class=nx>권한</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;read:orders&#34;</span> <span class=na>label</span><span class=o>=</span><span class=s>&#34;주문 읽기&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>strong</span><span class=p>&gt;</span><span class=nx>주문</span> <span class=nx>읽기</span><span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>주문</span> <span class=nx>정보</span> <span class=nx>조회</span> <span class=nx>권한</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;write:orders&#34;</span> <span class=na>label</span><span class=o>=</span><span class=s>&#34;주문 쓰기&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>strong</span><span class=p>&gt;</span><span class=nx>주문</span> <span class=nx>쓰기</span><span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>주문</span> <span class=nx>생성</span> <span class=nx>및</span> <span class=nx>수정</span> <span class=nx>권한</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;admin&#34;</span> <span class=na>label</span><span class=o>=</span><span class=s>&#34;관리자&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>strong</span><span class=p>&gt;</span><span class=nx>관리자</span><span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>모든</span> <span class=nx>API에</span> <span class=nx>대한</span> <span class=nx>전체</span> <span class=nx>접근</span> <span class=nx>권한</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>Select</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span>
</span></span><span class=line><span class=cl>            <span class=na>name</span><span class=o>=</span><span class=s>&#34;expiresAt&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>label</span><span class=o>=</span><span class=s>&#34;만료일&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>extra</span><span class=o>=</span><span class=s>&#34;비워두면 키가 만료되지 않습니다. 보안을 위해 만료일 설정을 권장합니다.&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>DatePicker</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>width</span><span class=o>:</span> <span class=s1>&#39;100%&#39;</span> <span class=p>}}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span>
</span></span><span class=line><span class=cl>            <span class=na>name</span><span class=o>=</span><span class=s>&#34;rateLimitPerMinute&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>label</span><span class=o>=</span><span class=s>&#34;분당 요청 제한&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>initialValue</span><span class=o>=</span><span class=p>{</span><span class=mi>60</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=na>extra</span><span class=o>=</span><span class=s>&#34;이 키에 대한 분당 최대 요청 수&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;number&#34;</span> <span class=na>min</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>}</span> <span class=na>max</span><span class=o>=</span><span class=p>{</span><span class=mi>1000</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span>
</span></span><span class=line><span class=cl>            <span class=na>name</span><span class=o>=</span><span class=s>&#34;allowedIps&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>label</span><span class=o>=</span><span class=s>&#34;허용 IP 주소&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>extra</span><span class=o>=</span><span class=s>&#34;이 키가 사용될 수 있는 IP 주소 목록 (쉼표로 구분). 비워두면 모든 IP에서 사용 가능합니다.&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Input</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;예: 203.0.113.1, 198.51.100.0/24&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span>
</span></span><span class=line><span class=cl>            <span class=na>name</span><span class=o>=</span><span class=s>&#34;allowedReferrers&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>label</span><span class=o>=</span><span class=s>&#34;허용 Referrer&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>extra</span><span class=o>=</span><span class=s>&#34;이 키가 사용될 수 있는 도메인 목록 (쉼표로 구분). 비워두면 모든 도메인에서 사용 가능합니다.&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Input</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;예: example.com, *.myapp.com&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;primary&#34;</span> <span class=na>htmlType</span><span class=o>=</span><span class=s>&#34;submit&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nx>API</span> <span class=nx>키</span> <span class=nx>생성</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>Button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>Button</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>marginLeft</span><span class=o>:</span> <span class=mi>8</span> <span class=p>}}</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setCreateModalVisible</span><span class=p>(</span><span class=kc>false</span><span class=p>)}&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nx>취소</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>Button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>Form.Item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>Form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>Modal</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>ApiKeyManagement</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api-키-보안-체크리스트-및-모범-사례>API 키 보안 체크리스트 및 모범 사례<a hidden class=anchor aria-hidden=true href=#api-키-보안-체크리스트-및-모범-사례>#</a></h3><p>API 키 관리에 있어 보안은 가장 중요한 측면이다.</p><p>다음은 API 키 보안을 위한 종합적인 체크리스트이다:</p><ol><li><p>API 키 생성 및 배포</p><ul><li><strong>강력한 엔트로피</strong>: 충분히 긴(최소 32바이트) 무작위 키 사용</li><li><strong>접두사 사용</strong>: 환경(prod_, test_) 또는 목적(read_, admin_)을 식별하는 접두사 포함</li><li><strong>발급 제한</strong>: 사용자당 최대 API 키 수 제한</li><li><strong>안전한 전달</strong>: 생성 후 안전한 채널을 통해 키 전달 (일회성 액세스 링크, 암호화된 통신)</li><li><strong>생성 감사</strong>: 모든 API 키 생성 이벤트 기록 및 모니터링</li></ul></li><li><p>API 키 저장 및 처리</p><ul><li><strong>해싱 저장</strong>: 평문이 아닌 해시된 형태로 키 저장 (bcrypt, Argon2 등 사용)</li><li><strong>전송 중 암호화</strong>: TLS/HTTPS를 통한 키 전송 필수화</li><li><strong>안전한 헤더</strong>: Authorization 헤더나 사용자 지정 헤더를 통한 키 전송 (쿼리 파라미터 지양)</li><li><strong>키 분리</strong>: 프론트엔드 코드에서 키 제거, 백엔드 또는 프록시만 키 사용</li><li><strong>환경 변수</strong>: 하드코딩 대신 환경 변수 또는 비밀 관리 서비스 사용</li></ul></li><li><p>API 키 유효성 검사 및 권한 부여</p><ul><li><strong>범위 기반 권한</strong>: API 키에 최소한의 필요 권한만 부여</li><li><strong>네트워크 제한</strong>: 허용된 IP 주소나 IP 범위에서만 키 사용 가능하도록 제한</li><li><strong>컨텍스트 검증</strong>: 시간, 지역, 요청 패턴 등 추가 컨텍스트 검증</li><li><strong>키 순환 적용</strong>: 정기적인 키 교체 정책 시행</li><li><strong>즉시 취소 메커니즘</strong>: 노출 시 즉시 키를 취소할 수 있는 메커니즘 제공</li></ul></li><li><p>모니터링 및 감사</p><ul><li><strong>사용 패턴 추적</strong>: 일반적인 사용 패턴을 기준으로 이상 행동 감지</li><li><strong>임계값 경고</strong>: 비정상적인 사용량에 대한 자동 알림 설정</li><li><strong>취약점 스캔</strong>: API 인증 취약점에 대한 정기적인 보안 테스트</li><li><strong>로그 보존</strong>: API 키 사용에 대한 감사 로그 유지</li><li><strong>주기적 검토</strong>: 사용되지 않거나 오래된 키 정기적 검토 및 정리</li></ul></li><li><p>API 키 관리 모범 사례 명세</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21>21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22>22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23>23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24>24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25>25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26>26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27>27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28>28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29>29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30>30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31>31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32>32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33>33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34>34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35>35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36>36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37>37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38>38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39>39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40>40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41>41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42>42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43>43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44>44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45>45</a>
</span><span class=lnt id=hl-30-46><a class=lnlinks href=#hl-30-46>46</a>
</span><span class=lnt id=hl-30-47><a class=lnlinks href=#hl-30-47>47</a>
</span><span class=lnt id=hl-30-48><a class=lnlinks href=#hl-30-48>48</a>
</span><span class=lnt id=hl-30-49><a class=lnlinks href=#hl-30-49>49</a>
</span><span class=lnt id=hl-30-50><a class=lnlinks href=#hl-30-50>50</a>
</span><span class=lnt id=hl-30-51><a class=lnlinks href=#hl-30-51>51</a>
</span><span class=lnt id=hl-30-52><a class=lnlinks href=#hl-30-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># API 키 관리 모범 사례 구성 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>api_key_management_best_practices</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key_generation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entropy_bits</span><span class=p>:</span><span class=w> </span><span class=m>256</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>algorithm</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;cryptographically secure random number generator&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;base64url encoded&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prefix_strategy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;environment-service-random&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key_storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>storage_format</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hashed with bcrypt (cost factor 12+)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>plaintext_storage</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;never&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database_encryption</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;yes, with field-level encryption&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key_transmission</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;HTTPS only (TLS 1.2+)&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>header_method</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Authorization: Bearer &lt;key&gt; or X-API-Key&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>query_params</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;prohibited&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>body_params</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;prohibited for GET requests&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key_validation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>caching_strategy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;distributed cache with short TTL&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>validation_checks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;key existence&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;key status (active/revoked)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;expiration date&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;IP allowlist&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;rate limits&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;scope permissions&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key_lifecycle</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>max_age</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;90 days recommended&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rotation_strategy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;automatic with grace period&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>revocation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mechanism</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;immediate with blacklist&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>propagation_time</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt; 60 seconds&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>monitoring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_tracked</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;usage_count&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;error_count&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;unique_ips&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;request_patterns&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alerts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;abnormal_usage_spikes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;geographic_anomalies&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;unusual_endpoints&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;time-of-day anomalies&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>developer_experience</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>self_service</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;yes, with approval workflows for privileged scopes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>visibility</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;partial key display for verification&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key_management_ui</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;comprehensive with usage analytics&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=효과적인-api-키-관리의-중요성>효과적인 API 키 관리의 중요성<a hidden class=anchor aria-hidden=true href=#효과적인-api-키-관리의-중요성>#</a></h3><p>API 키 관리는 현대 소프트웨어 아키텍처의 핵심 구성 요소로, 효과적인 API 키 관리 시스템은 다음과 같은 중요한 가치를 제공한다:</p><h4 id=비즈니스-가치>비즈니스 가치<a hidden class=anchor aria-hidden=true href=#비즈니스-가치>#</a></h4><ul><li><strong>보안 강화</strong>: 효과적인 API 키 관리는 데이터 유출, 무단 액세스, 서비스 오용과 같은 보안 위험을 크게 줄인다. 이는 기업 평판을 보호하고 규제 준수를 보장하는 데 필수적이다.</li><li><strong>수익 최적화</strong>: API 키를 사용한 사용량 추적 및 과금은 API 기반 비즈니스 모델의 기반을 형성한다. 세분화된 요금제와 사용량 기반 과금을 통해 다양한 고객 세그먼트에 맞는 가치를 제공할 수 있다.</li><li><strong>개발자 경험 향상</strong>: 직관적이고 강력한 API 키 관리 인터페이스는 개발자 만족도를 높이고 API 채택률을 증가시킨다. 이는 API 생태계 성장에 직접적인 영향을 미친다.</li><li><strong>운영 효율성</strong>: 자동화된 API 키 관리는 운영 오버헤드를 줄이고, 지원 요청을 감소시키며, IT 팀이 더 가치 있는 업무에 집중할 수 있게 한다.</li></ul><h4 id=미래-전망>미래 전망<a hidden class=anchor aria-hidden=true href=#미래-전망>#</a></h4><p>API 경제가 계속 성장함에 따라 API 키 관리는 더욱 중요해질 것이다. 미래의 API 키 관리 시스템은 다음과 같은 방향으로 발전할 것으로 예상된다:</p><ol><li><strong>AI 기반 보안</strong>: 기계 학습을 활용한 실시간 위협 탐지 및 대응</li><li><strong>제로 트러스트 통합</strong>: 맥락 기반 액세스 정책과 지속적 검증</li><li><strong>자동화 확대</strong>: 키 수명 주기 관리의 완전 자동화</li><li><strong>통합 인증 시스템</strong>: API 키, OAuth, JWT 등을 통합 관리하는 통합 솔루션</li><li><strong>블록체인 기반 API 키</strong>: 분산형, 변조 방지 API 키 관리 탐색</li></ol><h4 id=권장-접근법>권장 접근법<a hidden class=anchor aria-hidden=true href=#권장-접근법>#</a></h4><p>API 키 관리 전략을 수립하는 데 있어 권장되는 단계적 접근법은 다음과 같다:</p><ol><li><strong>현재 상태 평가</strong>: 기존 API 키 관리 방식의 보안 및 효율성 평가</li><li><strong>명확한 정책 수립</strong>: API 키 생성, 배포, 취소에 관한 명확한 정책 문서화</li><li><strong>적절한 도구 선택</strong>: 조직 규모와 요구 사항에 맞는 API 관리 도구 선택</li><li><strong>점진적 구현</strong>: 모든 API에 대한 키 관리 일괄 적용보다는 단계적 접근</li><li><strong>지속적 개선</strong>: 사용자 피드백과 보안 동향을 바탕으로 시스템 지속적 개선</li></ol><p>API 키 관리는 단순한 기술적 구현 이상의 의미를 갖는다. 이는 보안, 비즈니스 모델, 개발자 관계, 규제 준수가 교차하는 전략적 기능이다. 효과적인 API 키 관리 시스템을 구축함으로써 조직은 API 자산을 보호하고, 수익화하며, 개발자 생태계를 육성할 수 있는 견고한 기반을 마련할 수 있다.</p><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>