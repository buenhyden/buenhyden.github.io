<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Aggregate Pattern | hyunyoun's Blog</title><meta name=keywords content="System-and-Software-Architecture,MSA-Patterns,Maintaining-Data-Consistency,Aggregate-Pattern"><meta name=description content="Aggregate 패턴은 도메인 주도 설계(DDD)에서 유래한 개념으로, 관련된 객체들을 하나의 단위로 묶어 데이터 변경 시 일관성을 유지한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/aggregate/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/aggregate/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/aggregate/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Aggregate Pattern"><meta property="og:description" content="Aggregate 패턴은 도메인 주도 설계(DDD)에서 유래한 개념으로, 관련된 객체들을 하나의 단위로 묶어 데이터 변경 시 일관성을 유지한다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-15T02:00:00+00:00"><meta property="article:modified_time" content="2024-11-15T02:00:00+00:00"><meta property="article:tag" content="System-and-Software-Architecture"><meta property="article:tag" content="MSA-Patterns"><meta property="article:tag" content="Maintaining-Data-Consistency"><meta property="article:tag" content="Aggregate-Pattern"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Aggregate Pattern"><meta name=twitter:description content="Aggregate 패턴은 도메인 주도 설계(DDD)에서 유래한 개념으로, 관련된 객체들을 하나의 단위로 묶어 데이터 변경 시 일관성을 유지한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":4,"name":"Design Methodology","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/"},{"@type":"ListItem","position":5,"name":"Domain-Driven Design","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/"},{"@type":"ListItem","position":6,"name":"Aggregate Pattern","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/aggregate/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Aggregate Pattern","name":"Aggregate Pattern","description":"Aggregate 패턴은 도메인 주도 설계(DDD)에서 유래한 개념으로, 관련된 객체들을 하나의 단위로 묶어 데이터 변경 시 일관성을 유지한다.","keywords":["System-and-Software-Architecture","MSA-Patterns","Maintaining-Data-Consistency","Aggregate-Pattern"],"articleBody":"Aggregate Pattern Aggregate 패턴은 마이크로서비스 아키텍처(MSA)에서 데이터 일관성을 유지하기 위한 중요한 패턴 중 하나이다.\n이 패턴은 도메인 주도 설계(DDD)에서 유래했으며, 복잡한 도메인 모델을 관리하고 트랜잭션 경계를 정의하는 데 도움을 줍니다.\nAggregate는 하나의 루트 엔티티(Aggregate Root)와 관련된 객체들의 집합이다.\n이 집합은 하나의 단위로 취급되며, 데이터 일관성을 유지하는 경계 역할을 한다.\nAggregate 패턴을 효과적으로 사용하려면 도메인에 대한 깊은 이해와 지속적인 리팩토링이 필요하다.\n이 패턴을 통해 마이크로서비스 아키텍처에서 데이터 일관성을 유지하면서도 확장 가능하고 유지보수가 용이한 시스템을 구축할 수 있다.\nhttps://codeopinion.com/aggregate-ddd-isnt-hierarchy-relationships/\nAggregate의 구성 요소 Aggregate Root: Aggregate의 최상위 엔터티로, 외부에서 Aggregate에 접근할 때의 진입점이다. 모든 데이터 변경은 Aggregate Root를 통해 이루어진다.\n엔터티 및 값 객체: Aggregate Root 아래에 포함된 관련 엔터티나 값 객체들로, Aggregate 내부에서만 접근되고 관리된다.\nAggregate 패턴의 주요 특징 트랜잭션 일관성: Aggregate는 ACID(원자성, 일관성, 격리성, 지속성) 특성을 갖는다. 명확한 경계: Aggregate는 외부 객체와의 경계가 명확하다. 내부 객체 보호: 외부 객체는 오직 Aggregate Root를 통해서만 내부 객체에 접근할 수 있다. 불변성 유지: Aggregate Root는 내부 객체들의 무결성을 보장해야 한다. Aggregate 패턴의 구현 방법 Aggregate Root 식별: 도메인 모델에서 핵심 엔티티를 Aggregate Root로 선정한다. 경계 설정: Aggregate에 포함될 관련 엔티티와 값 객체를 정의한다. 일관성 규칙 정의: Aggregate 내부의 일관성을 유지하기 위한 비즈니스 규칙을 정의한다. 접근 제어: Aggregate Root를 통해서만 내부 객체에 접근할 수 있도록 구현한다. 트랜잭션 관리: Aggregate 단위로 트랜잭션을 관리한다. Aggregate 패턴의 장점 데이터 일관성 향상: Aggregate 내부의 객체들은 항상 일관된 상태를 유지한다. 복잡성 관리: 큰 도메인 모델을 작은 단위로 나누어 관리할 수 있다. 성능 최적화: Aggregate 단위로 데이터를 로드하고 저장하여 성능을 개선할 수 있다. 동시성 제어: Aggregate 단위로 락을 적용하여 동시성 문제를 해결할 수 있다. Aggregate 패턴의 주의사항 Aggregate 크기: Aggregate를 너무 크게 설계하면 성능 문제가 발생할 수 있으므로 적절한 크기로 유지해야 한다. 참조 관리: Aggregate 간 참조는 ID를 통해 이루어져야 하며, 직접적인 객체 참조는 피해야 한다. 일관성 범위: 모든 데이터를 즉시 일관되게 유지할 필요는 없습니다. 일부 데이터는 결과적 일관성(Eventual Consistency)으로 관리할 수 있다. 설계 복잡성: Aggregate 패턴을 적용하면 설계가 복잡해질 수 있으므로, 도메인 전문가와의 긴밀한 협력이 필요하다. 실제 사용 예시 예를 들어, 전자상거래 시스템에서 ‘주문(Order)’ Aggregate를 설계할 수 있다:\nOrder를 Aggregate Root로 정의한다. OrderItem, ShippingAddress 등을 Order Aggregate에 포함시킨다. Order를 통해서만 OrderItem을 추가하거나 수정할 수 있도록 구현한다. Order의 총액 계산, 주문 상태 변경 등의 비즈니스 로직을 Order 클래스에 구현한다.\n이렇게 설계하면 주문과 관련된 모든 데이터의 일관성을 쉽게 유지할 수 있다. 예시코드 전자상거래 시스템\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // Aggregate Root 예시 public class Order { private OrderId id; private CustomerId customerId; private List\u003cOrderItem\u003e orderItems; private OrderStatus status; private Money totalAmount; // Aggregate Root를 통한 생성자 public Order(CustomerId customerId) { this.id = new OrderId(); this.customerId = customerId; this.orderItems = new ArrayList\u003c\u003e(); this.status = OrderStatus.CREATED; this.totalAmount = Money.ZERO; } // Aggregate 내부 상태 변경은 항상 Root를 통해 이루어짐 public void addItem(ProductId productId, int quantity, Money unitPrice) { validateAddItem(quantity); OrderItem newItem = new OrderItem(productId, quantity, unitPrice); orderItems.add(newItem); recalculateTotalAmount(); } private void validateAddItem(int quantity) { if (quantity \u003c= 0) { throw new IllegalArgumentException(\"수량은 0보다 커야 합니다.\"); } if (status != OrderStatus.CREATED) { throw new IllegalStateException(\"주문 생성 상태에서만 상품을 추가할 수 있습니다.\"); } } private void recalculateTotalAmount() { this.totalAmount = orderItems.stream() .map(OrderItem::getSubtotal) .reduce(Money.ZERO, Money::add); } } 참고 및 출처 ","wordCount":"539","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-11-15T02:00:00Z","dateModified":"2024-11-15T02:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/aggregate/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/>Design Methodology</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-methodology/domain-driven-design/>Domain-Driven Design</a></div><h1 class="post-title entry-hint-parent">Aggregate Pattern</h1><div class=post-description>Aggregate 패턴은 도메인 주도 설계(DDD)에서 유래한 개념으로, 관련된 객체들을 하나의 단위로 묶어 데이터 변경 시 일관성을 유지한다.</div><div class=post-meta><span title='2024-11-15 02:00:00 +0000 UTC'>November 15, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Software%20Engineering/Design%20and%20Architecture/Design%20Methodology/Domain-Driven%20Design/Aggregate.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#aggregate-pattern>Aggregate Pattern</a><ul><li><a href=#aggregate의-구성-요소>Aggregate의 구성 요소</a></li><li><a href=#aggregate-패턴의-주요-특징>Aggregate 패턴의 주요 특징</a></li><li><a href=#aggregate-패턴의-구현-방법>Aggregate 패턴의 구현 방법</a></li><li><a href=#aggregate-패턴의-장점>Aggregate 패턴의 장점</a></li><li><a href=#aggregate-패턴의-주의사항>Aggregate 패턴의 주의사항</a></li><li><a href=#실제-사용-예시>실제 사용 예시</a></li><li><a href=#예시코드>예시코드</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=aggregate-pattern>Aggregate Pattern<a hidden class=anchor aria-hidden=true href=#aggregate-pattern>#</a></h2><p>Aggregate 패턴은 마이크로서비스 아키텍처(MSA)에서 데이터 일관성을 유지하기 위한 중요한 패턴 중 하나이다.<br>이 패턴은 도메인 주도 설계(DDD)에서 유래했으며, 복잡한 도메인 모델을 관리하고 트랜잭션 경계를 정의하는 데 도움을 줍니다.</p><p>Aggregate는 하나의 루트 엔티티(Aggregate Root)와 관련된 객체들의 집합이다.<br>이 집합은 하나의 단위로 취급되며, 데이터 일관성을 유지하는 경계 역할을 한다.</p><p>Aggregate 패턴을 효과적으로 사용하려면 도메인에 대한 깊은 이해와 지속적인 리팩토링이 필요하다.<br>이 패턴을 통해 마이크로서비스 아키텍처에서 데이터 일관성을 유지하면서도 확장 가능하고 유지보수가 용이한 시스템을 구축할 수 있다.</p><p><figure><img alt="Aggregate Pattern" loading=lazy src=/img/1.png><figcaption>https://codeopinion.com/aggregate-ddd-isnt-hierarchy-relationships/</figcaption></figure></p><h3 id=aggregate의-구성-요소>Aggregate의 구성 요소<a hidden class=anchor aria-hidden=true href=#aggregate의-구성-요소>#</a></h3><ul><li><p><strong>Aggregate Root:</strong> Aggregate의 최상위 엔터티로, 외부에서 Aggregate에 접근할 때의 진입점이다. 모든 데이터 변경은 Aggregate Root를 통해 이루어진다.</p></li><li><p><strong>엔터티 및 값 객체:</strong> Aggregate Root 아래에 포함된 관련 엔터티나 값 객체들로, Aggregate 내부에서만 접근되고 관리된다.</p></li></ul><h3 id=aggregate-패턴의-주요-특징>Aggregate 패턴의 주요 특징<a hidden class=anchor aria-hidden=true href=#aggregate-패턴의-주요-특징>#</a></h3><ol><li>트랜잭션 일관성: Aggregate는 ACID(원자성, 일관성, 격리성, 지속성) 특성을 갖는다.</li><li>명확한 경계: Aggregate는 외부 객체와의 경계가 명확하다.</li><li>내부 객체 보호: 외부 객체는 오직 Aggregate Root를 통해서만 내부 객체에 접근할 수 있다.</li><li>불변성 유지: Aggregate Root는 내부 객체들의 무결성을 보장해야 한다.</li></ol><h3 id=aggregate-패턴의-구현-방법>Aggregate 패턴의 구현 방법<a hidden class=anchor aria-hidden=true href=#aggregate-패턴의-구현-방법>#</a></h3><ol><li>Aggregate Root 식별: 도메인 모델에서 핵심 엔티티를 Aggregate Root로 선정한다.</li><li>경계 설정: Aggregate에 포함될 관련 엔티티와 값 객체를 정의한다.</li><li>일관성 규칙 정의: Aggregate 내부의 일관성을 유지하기 위한 비즈니스 규칙을 정의한다.</li><li>접근 제어: Aggregate Root를 통해서만 내부 객체에 접근할 수 있도록 구현한다.</li><li>트랜잭션 관리: Aggregate 단위로 트랜잭션을 관리한다.</li></ol><h3 id=aggregate-패턴의-장점>Aggregate 패턴의 장점<a hidden class=anchor aria-hidden=true href=#aggregate-패턴의-장점>#</a></h3><ol><li>데이터 일관성 향상: Aggregate 내부의 객체들은 항상 일관된 상태를 유지한다.</li><li>복잡성 관리: 큰 도메인 모델을 작은 단위로 나누어 관리할 수 있다.</li><li>성능 최적화: Aggregate 단위로 데이터를 로드하고 저장하여 성능을 개선할 수 있다.</li><li>동시성 제어: Aggregate 단위로 락을 적용하여 동시성 문제를 해결할 수 있다.</li></ol><h3 id=aggregate-패턴의-주의사항>Aggregate 패턴의 주의사항<a hidden class=anchor aria-hidden=true href=#aggregate-패턴의-주의사항>#</a></h3><ol><li>Aggregate 크기: Aggregate를 너무 크게 설계하면 성능 문제가 발생할 수 있으므로 적절한 크기로 유지해야 한다.</li><li>참조 관리: Aggregate 간 참조는 ID를 통해 이루어져야 하며, 직접적인 객체 참조는 피해야 한다.</li><li>일관성 범위: 모든 데이터를 즉시 일관되게 유지할 필요는 없습니다. 일부 데이터는 결과적 일관성(Eventual Consistency)으로 관리할 수 있다.</li><li>설계 복잡성: Aggregate 패턴을 적용하면 설계가 복잡해질 수 있으므로, 도메인 전문가와의 긴밀한 협력이 필요하다.</li></ol><h3 id=실제-사용-예시>실제 사용 예시<a hidden class=anchor aria-hidden=true href=#실제-사용-예시>#</a></h3><p>예를 들어, 전자상거래 시스템에서 &lsquo;주문(Order)&rsquo; Aggregate를 설계할 수 있다:</p><ol><li>Order를 Aggregate Root로 정의한다.</li><li>OrderItem, ShippingAddress 등을 Order Aggregate에 포함시킨다.</li><li>Order를 통해서만 OrderItem을 추가하거나 수정할 수 있도록 구현한다.</li><li>Order의 총액 계산, 주문 상태 변경 등의 비즈니스 로직을 Order 클래스에 구현한다.<br>이렇게 설계하면 주문과 관련된 모든 데이터의 일관성을 쉽게 유지할 수 있다.</li></ol><h3 id=예시코드>예시코드<a hidden class=anchor aria-hidden=true href=#예시코드>#</a></h3><p>전자상거래 시스템</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27>27</a>
</span><span class=lnt id=hl-0-28><a class=lnlinks href=#hl-0-28>28</a>
</span><span class=lnt id=hl-0-29><a class=lnlinks href=#hl-0-29>29</a>
</span><span class=lnt id=hl-0-30><a class=lnlinks href=#hl-0-30>30</a>
</span><span class=lnt id=hl-0-31><a class=lnlinks href=#hl-0-31>31</a>
</span><span class=lnt id=hl-0-32><a class=lnlinks href=#hl-0-32>32</a>
</span><span class=lnt id=hl-0-33><a class=lnlinks href=#hl-0-33>33</a>
</span><span class=lnt id=hl-0-34><a class=lnlinks href=#hl-0-34>34</a>
</span><span class=lnt id=hl-0-35><a class=lnlinks href=#hl-0-35>35</a>
</span><span class=lnt id=hl-0-36><a class=lnlinks href=#hl-0-36>36</a>
</span><span class=lnt id=hl-0-37><a class=lnlinks href=#hl-0-37>37</a>
</span><span class=lnt id=hl-0-38><a class=lnlinks href=#hl-0-38>38</a>
</span><span class=lnt id=hl-0-39><a class=lnlinks href=#hl-0-39>39</a>
</span><span class=lnt id=hl-0-40><a class=lnlinks href=#hl-0-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Aggregate Root 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderId</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>CustomerId</span><span class=w> </span><span class=n>customerId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>orderItems</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Money</span><span class=w> </span><span class=n>totalAmount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Aggregate Root를 통한 생성자</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Order</span><span class=p>(</span><span class=n>CustomerId</span><span class=w> </span><span class=n>customerId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>customerId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>customerId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>orderItems</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>totalAmount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Money</span><span class=p>.</span><span class=na>ZERO</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Aggregate 내부 상태 변경은 항상 Root를 통해 이루어짐</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addItem</span><span class=p>(</span><span class=n>ProductId</span><span class=w> </span><span class=n>productId</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>quantity</span><span class=p>,</span><span class=w> </span><span class=n>Money</span><span class=w> </span><span class=n>unitPrice</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>validateAddItem</span><span class=p>(</span><span class=n>quantity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderItem</span><span class=w> </span><span class=n>newItem</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderItem</span><span class=p>(</span><span class=n>productId</span><span class=p>,</span><span class=w> </span><span class=n>quantity</span><span class=p>,</span><span class=w> </span><span class=n>unitPrice</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderItems</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>newItem</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>recalculateTotalAmount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>validateAddItem</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>quantity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>quantity</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;수량은 0보다 커야 합니다.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&#34;주문 생성 상태에서만 상품을 추가할 수 있습니다.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recalculateTotalAmount</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>totalAmount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderItems</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>OrderItem</span><span class=p>::</span><span class=n>getSubtotal</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>reduce</span><span class=p>(</span><span class=n>Money</span><span class=p>.</span><span class=na>ZERO</span><span class=p>,</span><span class=w> </span><span class=n>Money</span><span class=p>::</span><span class=n>add</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/system-and-software-architecture/>System-and-Software-Architecture</a></li><li><a href=https://buenhyden.github.io/tags/msa-patterns/>MSA-Patterns</a></li><li><a href=https://buenhyden.github.io/tags/maintaining-data-consistency/>Maintaining-Data-Consistency</a></li><li><a href=https://buenhyden.github.io/tags/aggregate-pattern/>Aggregate-Pattern</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/event-and-messaging-patterns/saga-pattern/saga/><span class=title>« Prev</span><br><span>Saga Pattern</span>
</a><a class=next href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/deployment-and-scalability-patterns/service-discovery/3rd-party-registration/><span class=title>Next »</span><br><span>3rd party registration</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>