<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ambassador | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Patterns,Deployment-and-Scalability-Patterns,Ambassador"><meta name=description content="Ambassador Pattern은 클라이언트와 마이크로서비스 사이에 별도의 서비스(Ambassador)를 두어 통신을 관리하는 디자인 패턴이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-patterns-and-integration/integration-patterns/service-integration/ambassador/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-patterns-and-integration/integration-patterns/service-integration/ambassador/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-patterns-and-integration/integration-patterns/service-integration/ambassador/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-patterns-and-integration/integration-patterns/service-integration/ambassador/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Ambassador"><meta property="og:description" content="Ambassador Pattern은 클라이언트와 마이크로서비스 사이에 별도의 서비스(Ambassador)를 두어 통신을 관리하는 디자인 패턴이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Ambassador"><meta name=twitter:description content="Ambassador Pattern은 클라이언트와 마이크로서비스 사이에 별도의 서비스(Ambassador)를 두어 통신을 관리하는 디자인 패턴이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Ambassador","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/design-patterns-and-integration/integration-patterns/service-integration/ambassador/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Ambassador</h1><div class=post-description>Ambassador Pattern은 클라이언트와 마이크로서비스 사이에 별도의 서비스(Ambassador)를 두어 통신을 관리하는 디자인 패턴이다.</div></header><div class=post-content><h2 id=ambassador>Ambassador<a hidden class=anchor aria-hidden=true href=#ambassador>#</a></h2><p>아래는 “Ambassador Pattern(앰배서더 패턴)”에 대한 체계적이고 깊이 있는 조사 및 분석 결과입니다.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><p>Ambassador-Pattern, Microservices-Architecture, Proxy-Pattern, Cloud-Native-Applications</p><hr><h2 id=2-분류-구조-적합성-검토>2. 분류 구조 적합성 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적합성-검토>#</a></h2><p><strong>현재 분류 구조</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Computer Science and Engineering
</span></span><span class=line><span class=cl>└─ Software Engineering &gt; Design and Architecture &gt; Architecture Patterns &gt; Deployment and Scalability Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>주제 분류:</strong><br>&ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Deployment and Scalability Patterns&rdquo;</p><p><strong>적합성 및 근거:</strong><br>앰배서더 패턴은 마이크로서비스(Microservices) 아키텍처와 클라우드 네이티브(Cloud Native) 환경에서 서비스 배포와 확장성, 네트워크 복잡성 관리 등에 주로 사용되는 대표적인 아키텍처 패턴 중 하나입니다.<br>따라서, “Software Engineering > Design and Architecture > Architecture Patterns > Deployment and Scalability Patterns”로의 분류는 적절합니다.<br>이 패턴은 서비스의 외부 의존성(네트워크, 로드 밸런싱, 재시도, 모니터링 등)을 중앙화하고 관리하는 역할을 하므로, 배포와 확장성 관련 패턴에 속합니다.</p><hr><h2 id=3-요약-200자-내외>3. 요약 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-200자-내외>#</a></h2><p>앰배서더 패턴은 외부 서비스와의 통신을 위해 별도의 프록시(앰배서더)를 두어, 네트워크 복잡성, 재시도, 로드 밸런싱, 모니터링 등 공통 기능을 중앙에서 관리하는 소프트웨어 아키텍처 패턴이다.</p><hr><h2 id=4-전체-개요-250자-내외>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외>#</a></h2><p>앰배서더 패턴은 마이크로서비스 환경에서 서비스가 외부 리소스와 상호작용할 때 발생하는 네트워크, 재시도, 로드 밸런싱 등 복잡한 문제를 프록시 역할을 하는 앰배서더가 대신 처리하여, 서비스의 유지보수성과 확장성을 높이는 데 중점을 둔다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><p><strong>정의 및 배경</strong><br>앰배서더 패턴은 서비스가 외부 시스템(예: 데이터베이스, 다른 마이크로서비스, 외부 API 등)과 통신할 때, 네트워크 관련 로직(재시도, 로드 밸런싱, 모니터링, 인증 등)을 서비스 외부에 별도의 컴포넌트(앰배서더)로 분리하는 패턴입니다.</p><p><strong>목적 및 필요성</strong></p><ul><li><strong>복잡성 분리:</strong> 네트워크 관련 복잡성을 서비스 코드에서 분리하여 서비스가 비즈니스 로직에 집중할 수 있도록 함</li><li><strong>유지보수성 향상:</strong> 네트워크 관련 변경 사항이 앰배서더만 수정하면 되므로 유지보수성이 높아짐</li><li><strong>확장성 및 재사용성:</strong> 여러 서비스에서 동일한 앰배서더를 공유할 수 있어 확장성과 재사용성이 높아짐</li></ul><p><strong>실무 구현 관련성</strong><br>실무에서는 마이크로서비스, 컨테이너 오케스트레이션(예: 쿠버네티스), 서비스 메시(Service Mesh), 클라우드 네이티브 환경에서 앰배서더 패턴이 널리 사용됩니다.<br>앰배서더는 서비스의 사이드카(Sidecar)로 동작하거나, 별도의 프록시 서버로 구현될 수 있습니다.</p><hr><h2 id=6-주요-기능-및-역할>6. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#6-주요-기능-및-역할>#</a></h2><ul><li><strong>프록시 역할:</strong> 외부 서비스와의 통신을 대신 처리</li><li><strong>재시도 및 타임아웃 관리:</strong> 네트워크 오류 발생 시 자동 재시도 및 타임아웃 처리</li><li><strong>로드 밸런싱:</strong> 여러 외부 인스턴스에 요청을 분산</li><li><strong>모니터링 및 로깅:</strong> 통신 상태, 성능, 오류 등을 모니터링 및 로깅</li><li><strong>인증 및 권한 부여:</strong> 외부 서비스 접근 시 인증 및 권한 부여 처리</li></ul><hr><h2 id=7-특징>7. 특징<a hidden class=anchor aria-hidden=true href=#7-특징>#</a></h2><ul><li><strong>서비스와 외부 시스템 간의 복잡성 분리</strong></li><li><strong>서비스 코드의 단순화 및 유지보수성 향상</strong></li><li><strong>여러 서비스에서 앰배서더 공유 가능</strong></li><li><strong>클라우드 네이티브, 마이크로서비스 환경에 적합</strong></li></ul><hr><h2 id=8-핵심-원칙-및-주요-원리>8. 핵심 원칙 및 주요 원리<a hidden class=anchor aria-hidden=true href=#8-핵심-원칙-및-주요-원리>#</a></h2><p><strong>핵심 원칙:</strong><br>“관심사 분리(Separation of Concerns)”<br>서비스는 비즈니스 로직에 집중하고, 네트워크 관련 복잡성은 앰배서더가 담당</p><p><strong>주요 원리:</strong></p><ul><li><strong>프록시 패턴(Proxy Pattern)의 확장</strong></li><li><strong>서비스와 앰배서더는 동일한 프로세스 또는 별도 프로세스에서 동작</strong></li><li><strong>앰배서더는 서비스의 요청을 가로채어 외부 시스템과 통신</strong></li></ul><p><strong>작동 원리 다이어그램 (mermaid)</strong></p><pre class=mermaid>graph LR
    A[서비스] --&gt;|요청| B[앰배서더]
    B --&gt;|외부 요청| C[외부 시스템]
    C --&gt;|응답| B
    B --&gt;|응답| A
</pre><p><strong>설명:</strong><br>서비스는 앰배서더에게 요청을 보내고, 앰배서더는 외부 시스템과 통신하여 결과를 서비스에 반환합니다.</p><hr><h2 id=9-구조-및-아키텍처>9. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#9-구조-및-아키텍처>#</a></h2><p><strong>구성 요소</strong></p><ul><li><strong>서비스:</strong> 비즈니스 로직을 담당하는 주체</li><li><strong>앰배서더:</strong> 네트워크 관련 로직을 담당하는 프록시</li><li><strong>외부 시스템:</strong> 데이터베이스, 다른 마이크로서비스, 외부 API 등</li></ul><p><strong>구조 다이어그램 (mermaid)</strong></p><pre class=mermaid>graph TD
    A[서비스] -- 요청 --&gt; B[앰배서더]
    B -- 외부 요청 --&gt; C[외부 시스템]
    C -- 응답 --&gt; B
    B -- 응답 --&gt; A
</pre><p><strong>설명:</strong><br>서비스는 앰배서더를 통해 외부 시스템과 통신하며, 앰배서더는 네트워크 관련 모든 작업을 처리합니다.</p><p><strong>필수 구성요소</strong></p><ul><li><strong>서비스:</strong> 비즈니스 로직 수행</li><li><strong>앰배서더:</strong> 네트워크 통신, 재시도, 로드 밸런싱 등</li></ul><p><strong>선택 구성요소</strong></p><ul><li><strong>모니터링/로깅 시스템:</strong> 앰배서더의 상태 모니터링</li><li><strong>인증/권한 부여 시스템:</strong> 외부 시스템 접근 제어</li></ul><hr><h2 id=10-구현-기법>10. 구현 기법<a hidden class=anchor aria-hidden=true href=#10-구현-기법>#</a></h2><ul><li><strong>사이드카 패턴(Sidecar Pattern):</strong> 서비스와 동일한 프로세스 또는 컨테이너에서 앰배서더 실행</li><li><strong>프록시 서버:</strong> 별도의 서버로 앰배서더 구현</li><li><strong>서비스 메시(Service Mesh):</strong> Istio, Linkerd 등 서비스 메시에서 앰배서더 역할 수행</li></ul><p><strong>실제 예시</strong></p><ul><li><strong>쿠버네티스 환경:</strong> Pod 내에 서비스와 앰배서더 컨테이너를 함께 배치</li><li><strong>클라우드 네이티브:</strong> AWS Lambda, Azure Functions 등에서 앰배서더 패턴 적용</li></ul><hr><h2 id=11-장점>11. 장점<a hidden class=anchor aria-hidden=true href=#11-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>복잡성 분리</td><td>네트워크 관련 복잡성을 서비스에서 분리하여 비즈니스 로직에 집중할 수 있음</td></tr><tr><td></td><td>유지보수성 향상</td><td>네트워크 관련 변경 시 앰배서더만 수정하면 되므로 유지보수성이 높아짐</td></tr><tr><td></td><td>확장성 및 재사용성</td><td>여러 서비스에서 동일한 앰배서더를 공유할 수 있어 확장성과 재사용성이 높아짐</td></tr><tr><td></td><td>모니터링 용이</td><td>앰배서더에서 통신 상태, 성능, 오류 등을 모니터링하기 쉬움</td></tr></tbody></table><hr><h2 id=12-단점과-문제점-그리고-해결방안>12. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#12-단점과-문제점-그리고-해결방안>#</a></h2><p><strong>단점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>추가 리소스 소모</td><td>앰배서더가 별도로 동작하므로 리소스(CPU, 메모리) 추가 소모</td><td>리소스 최적화, 효율적 구현</td></tr><tr><td></td><td>지연 시간 증가</td><td>앰배서더를 경유하므로 통신 지연 시간이 약간 증가할 수 있음</td><td>앰배서더 최적화, 캐싱 적용</td></tr></tbody></table><p><strong>문제점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>앰배서더 장애</td><td>앰배서더 프로세스 다운</td><td>서비스 외부 통신 불가</td><td>로깅, 모니터링</td><td>장애 감지 시스템</td><td>자동 복구, 장애 조치</td></tr><tr><td></td><td>보안 취약점</td><td>앰배서더 보안 설정 미흡</td><td>데이터 유출 가능</td><td>보안 감사</td><td>보안 정책 적용</td><td>인증/암호화 강화</td></tr></tbody></table><hr><h2 id=13-도전-과제>13. 도전 과제<a hidden class=anchor aria-hidden=true href=#13-도전-과제>#</a></h2><ul><li><strong>복잡한 트랜잭션 관리:</strong> 분산 트랜잭션에서 앰배서더의 역할 한계</li><li><strong>다양한 프로토콜 지원:</strong> 다양한 외부 시스템 프로토콜 지원 확장성</li><li><strong>성능 최적화:</strong> 앰배서더 경유 시 발생하는 지연 최소화</li><li><strong>보안 강화:</strong> 앰배서더를 통한 외부 통신 시 보안 위협 대응</li></ul><hr><h2 id=14-분류-기준에-따른-종류-및-유형>14. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#14-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td>사이드카 앰배서더</td><td>서비스와 동일한 프로세스/컨테이너에서 실행되는 앰배서더</td></tr><tr><td>프록시 서버 앰배서더</td><td>별도의 서버로 구현되는 앰배서더</td></tr><tr><td>서비스 메시 앰배서더</td><td>서비스 메시(Service Mesh) 환경에서 제공되는 앰배서더 기능</td></tr></tbody></table><hr><h2 id=15-실무-사용-예시>15. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#15-실무-사용-예시>#</a></h2><table><thead><tr><th>사용 목적</th><th>함께 사용되는 기술/시스템</th><th>효과</th></tr></thead><tbody><tr><td>외부 API 통신</td><td>REST, gRPC, GraphQL</td><td>네트워크 복잡성 분리, 재시도, 로드 밸런싱, 모니터링 용이</td></tr><tr><td>데이터베이스 접근</td><td>MySQL, PostgreSQL, MongoDB</td><td>연결 풀링, 재시도, 타임아웃, 모니터링</td></tr><tr><td>서비스 메시</td><td>Istio, Linkerd</td><td>트래픽 제어, 보안, 모니터링, 로드 밸런싱</td></tr></tbody></table><hr><h2 id=16-활용-사례>16. 활용 사례<a hidden class=anchor aria-hidden=true href=#16-활용-사례>#</a></h2><p><strong>사례:</strong><br>마이크로서비스 환경에서 여러 서비스가 외부 데이터베이스에 접근할 때, 각 서비스마다 데이터베이스 연결 풀링, 재시도, 타임아웃, 모니터링 등을 구현하면 코드 중복과 유지보수 문제가 발생합니다.<br>이때 앰배서더 패턴을 적용하면, 데이터베이스 연결 관련 모든 로직을 앰배서더에 위임할 수 있어 서비스 코드는 단순해지고, 유지보수성이 높아집니다.</p><p><strong>시스템 구성 다이어그램 (mermaid)</strong></p><pre class=mermaid>graph TD
    A[서비스1] --&gt; B[앰배서더]
    C[서비스2] --&gt; B
    B --&gt; D[데이터베이스]
</pre><p><strong>Workflow:</strong></p><ol><li>서비스1, 서비스2가 데이터베이스에 접근할 때 앰배서더를 통해 요청</li><li>앰배서더는 연결 풀링, 재시도, 타임아웃, 모니터링 등을 처리</li><li>데이터베이스에서 응답을 받아 서비스에 반환</li></ol><p><strong>앰배서더 유무에 따른 차이:</strong></p><ul><li><strong>앰배서더 있음:</strong> 네트워크 관련 복잡성 분리, 유지보수성 향상</li><li><strong>앰배서더 없음:</strong> 각 서비스마다 네트워크 로직 중복, 유지보수성 저하</li></ul><hr><h2 id=17-구현-예시-python>17. 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#17-구현-예시-python>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 앰배서더 역할을 하는 프록시 클래스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DatabaseAmbassador</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>db_host</span><span class=p>,</span> <span class=n>db_port</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_host</span> <span class=o>=</span> <span class=n>db_host</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_port</span> <span class=o>=</span> <span class=n>db_port</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 예시: 연결 풀 구현</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>connect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 연결 풀에서 연결 가져오기, 없으면 새로 생성</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 실제 DB 연결 코드 (예시)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Connecting to </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>db_host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>db_port</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;connection_object&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>execute_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>retries</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>retries</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=c1># 실제 쿼리 실행 코드 (예시)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Executing query: </span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=s2>&#34;query_result&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Retry </span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Query failed after retries&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 서비스 클래스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Service</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ambassador</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ambassador</span> <span class=o>=</span> <span class=n>ambassador</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>ambassador</span><span class=o>.</span><span class=n>execute_query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>ambassador</span> <span class=o>=</span> <span class=n>DatabaseAmbassador</span><span class=p>(</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=mi>5432</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>service</span> <span class=o>=</span> <span class=n>Service</span><span class=p>(</span><span class=n>ambassador</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>service</span><span class=o>.</span><span class=n>get_data</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM users&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=18-도전-과제>18. 도전 과제<a hidden class=anchor aria-hidden=true href=#18-도전-과제>#</a></h2><table><thead><tr><th>카테고리</th><th>과제</th><th>원인/영향/진단/예방/해결 방법</th></tr></thead><tbody><tr><td>트랜잭션 관리</td><td>분산 트랜잭션 한계</td><td>앰배서더 단일로 분산 트랜잭션 관리 어려움, 서비스 간 협력 필요</td></tr><tr><td>프로토콜 지원</td><td>다양한 프로토콜 지원</td><td>새로운 외부 시스템 프로토콜 추가 시 앰배서더 확장성 필요</td></tr><tr><td>성능</td><td>지연 시간 증가</td><td>앰배서더 경유 시 지연, 캐싱/최적화 필요</td></tr><tr><td>보안</td><td>보안 위협</td><td>앰배서더 통신 구간 암호화, 인증 강화 필요</td></tr></tbody></table><hr><h2 id=19-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>19. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#19-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>고려사항/주의점</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>앰배서더 장애 대응</td><td>앰배서더 장애 시 서비스 외부 통신 불가, 장애 감지 및 복구 필요</td><td>모니터링, 자동 복구 시스템</td></tr><tr><td>보안 설정</td><td>앰배서더 통신 구간 암호화, 인증 필요</td><td>TLS, 인증서 관리</td></tr><tr><td>성능 최적화</td><td>앰배서더 경유 시 지연, 리소스 소모</td><td>캐싱, 연결 풀링, 최적화</td></tr><tr><td>확장성</td><td>다양한 외부 시스템 지원</td><td>플러그인 구조, 확장성 설계</td></tr></tbody></table><hr><h2 id=20-최적화하기-위한-고려사항-및-주의할-점>20. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>고려사항/주의점</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>연결 풀링</td><td>데이터베이스 등 외부 시스템 연결 풀링 구현</td><td>연결 풀 크기 조정</td></tr><tr><td>캐싱</td><td>자주 사용되는 데이터 캐싱</td><td>캐시 정책 설정</td></tr><tr><td>비동기 처리</td><td>네트워크 요청 비동기화</td><td>비동기 라이브러리 사용</td></tr><tr><td>모니터링</td><td>앰배서더 상태, 성능 모니터링</td><td>모니터링 도구 연동</td></tr></tbody></table><hr><h2 id=21-주제와-관련하여-주목할-내용>21. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#21-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>마이크로서비스</td><td>복잡성 분리</td><td>앰배서더 패턴은 마이크로서비스 환경의 복잡성 분리에 적합</td></tr><tr><td>배포 및 확장</td><td>클라우드 네이티브</td><td>확장성</td><td>앰배서더 패턴은 클라우드 네이티브 환경에서 확장성 제공</td></tr><tr><td>보안</td><td>통신 보안</td><td>인증/암호화</td><td>앰배서더를 통한 통신 구간 암호화 및 인증 강화</td></tr><tr><td>운영</td><td>모니터링/로깅</td><td>운영 효율성</td><td>앰배서더에서 통신 상태, 성능, 오류 모니터링 용이</td></tr></tbody></table><hr><h2 id=22-반드시-학습해야할-내용>22. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#22-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>프록시 패턴</td><td>기본 원리</td><td>앰배서더 패턴의 기반이 되는 프록시 패턴 이해</td></tr><tr><td>네트워크</td><td>재시도/타임아웃</td><td>구현 방법</td><td>네트워크 오류 시 재시도, 타임아웃 처리 방법</td></tr><tr><td>보안</td><td>TLS/인증</td><td>적용 방법</td><td>앰배서더 통신 구간 암호화 및 인증 적용 방법</td></tr><tr><td>운영</td><td>모니터링/로깅</td><td>도구 연동</td><td>앰배서더 상태 모니터링 및 로깅 도구 연동 방법</td></tr></tbody></table><hr><h2 id=23-기타-사항>23. 기타 사항<a hidden class=anchor aria-hidden=true href=#23-기타-사항>#</a></h2><ul><li><strong>서비스 메시(Service Mesh)와의 차이:</strong><br>서비스 메시는 앰배서더 패턴을 확장한 개념으로, 여러 서비스에 걸쳐 네트워크 기능을 중앙에서 관리합니다.</li><li><strong>컨테이너 오케스트레이션 환경:</strong><br>쿠버네티스 등에서 앰배서더를 사이드카로 배치하여 서비스와 함께 운영할 수 있습니다.</li><li><strong>클라우드 네이티브 트렌드:</strong><br>앰배서더 패턴은 클라우드 네이티브 애플리케이션의 필수 요소로 자리잡고 있습니다.</li></ul><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>앰배서더 패턴</td><td>외부 서비스와의 통신을 프록시로 처리하는 소프트웨어 아키텍처 패턴</td></tr><tr><td>배포 및 확장</td><td>사이드카 패턴</td><td>서비스와 동일한 프로세스/컨테이너에서 실행되는 앰배서더 구현 방식</td></tr><tr><td>네트워크</td><td>프록시 서버</td><td>별도의 서버로 구현되는 앰배서더</td></tr><tr><td>클라우드</td><td>서비스 메시</td><td>여러 서비스에 걸쳐 네트워크 기능을 중앙에서 관리하는 아키텍처</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://microservices.io/patterns/apigateway.html>마이크로서비스 패턴: 앰배서더 패턴 소개</a> – 마이크로서비스 아키텍처에서 앰배서더 패턴의 역할 및 활용 예시</li><li><a href=https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador>Ambassador Pattern - Microsoft Docs</a> – 마이크로서비스, 클라우드 환경에서의 앰배서더 패턴 설명</li><li><a href=https://kubernetes.io/docs/concepts/workloads/pods/#workload-resources-for-managing-pods>Kubernetes Sidecar Pattern - Kubernetes Docs</a> – 쿠버네티스 환경에서 앰배서더(사이드카) 패턴 활용</li></ul><hr><p><strong>위 내용을 바탕으로 앰배서더 패턴(Ambassador Pattern)의 이론과 실무, 그리고 다양한 측면에서의 활용과 최적화, 주의사항 등을 체계적으로 정리하였습니다.</strong></p><p><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/ambassador><figure><img alt="Ambassador pattern - Azure Architecture Center | Microsoft Learn" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.SL3hJAcg24BEHZ0xUA6g6QHaDX\\&pid=Api"></figure></a></p><hr><h2 id=6-조사-내용-정리-with-updates>6. 조사 내용 정리 (with updates)<a hidden class=anchor aria-hidden=true href=#6-조사-내용-정리-with-updates>#</a></h2><h3 id=배경context>배경(Context)<a hidden class=anchor aria-hidden=true href=#배경context>#</a></h3><p>Ambassador 패턴은 클라이언트와 외부 서비스 간 통신을 중재하고 제어하기 위해 co‑located proxy(주로 sidecar)로 구현되며, 🤝 서비스 간 통신의 재시도, 회로 차단, TLS 종료, 로깅 등을 담당합니다 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/ambassador?utm_source=chatgpt.com" title="Ambassador pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>).</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li>레거시 시스템이나 수정이 불가능한 클라이언트에서 통신 기능을 강화하기 위함</li><li>클라이언트 로직을 변경하지 않고 통신 관련 공통 기능을 분리하여 중앙화된 관리를 가능하게 함 .</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><p>Ambassaor는 다음과 같은 기능을 수행합니다:</p><ul><li><strong>Service Discovery</strong>: 실제 서비스 위치를 동적으로 식별하고 라우팅함 (<a href="https://dzone.com/articles/design-patterns-for-microservices-ambassador-anti?utm_source=chatgpt.com" title="Design Patterns for Microservices">dzone.com</a>, <a href="https://github.com/joaosczip/k8s-ambassador?utm_source=chatgpt.com" title="joaosczip/k8s-ambassador: An Ambassador Pattern example - GitHub">github.com</a>)</li><li><strong>Resiliency</strong>: 재시도, 회로 차단, 로깅, 모니터링 구현 (<a href="https://java-design-patterns.com/patterns/ambassador/?utm_source=chatgpt.com" title="Ambassador Pattern in Java: Simplifying Remote Resource ...">java-design-patterns.com</a>)</li><li><strong>보안 기능</strong>: TLS 암호화, 인증 중재 담당</li><li><strong>프로토콜 변환</strong>: gRPC ↔ HTTP 등의 브리지 역할 (<a href="https://www.linkedin.com/pulse/design-patterns-sidecar-adapter-ambassador-avinash-tietler-2ippc?utm_source=chatgpt.com" title="Design Patterns- sidecar, adapter and ambassador - LinkedIn">linkedin.com</a>)</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>언어 독립성</strong>: 모든 언어/플랫폼에 적용 가능</li><li><strong>구분된 관리 책임</strong>: 네트워크 기능은 인프라 팀이, 비즈니스 로직은 개발팀이 담당</li><li><strong>Sidecar 형태 구현</strong>: 쿠버네티스 Pod 내 별도 컨테이너로 주로 배포됨 (<a href="https://kubernetes.io/blog/2025/04/22/multi-container-pods-overview/?utm_source=chatgpt.com" title="Kubernetes Multicontainer Pods: An Overview">kubernetes.io</a>)</li></ul><h3 id=핵심-원리>핵심 원리<a hidden class=anchor aria-hidden=true href=#핵심-원리>#</a></h3><ul><li>리소스 접근을 Ambassador 경유(localhost 기반)</li><li>동적 네트워크 기능 확장</li><li>중앙제어형 네트워크 정책, 보안, 모니터링의 구현</li></ul><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><ol><li>클라이언트가 localhost → Ambassador로 요청</li><li>Ambassador가 서비스 디스커버리 후 목적지 결정</li><li>재시도, 회로 차단, 보안, 모니터링 로직 수행</li><li>외부 서비스와 통신하며 응답 반환</li></ol><h2 id=7-추가-과정별-정보>7. 추가 과정별 정보<a hidden class=anchor aria-hidden=true href=#7-추가-과정별-정보>#</a></h2><p>이미지에 포함된 다이어그램들은 Ambassador의 구조와 작동 흐름을 적절히 보여줌(위 이미지들 참고).</p><hr><h2 id=8-기타-사항>8. 기타 사항<a hidden class=anchor aria-hidden=true href=#8-기타-사항>#</a></h2><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><ul><li><strong>쿠버네티스 Pod</strong>: App 컨테이너 + Ambassador 컨테이너</li><li><strong>Envoy 기반 Ambassador</strong>: Ambassador Labs의 Ambassador Edge Stack (<a href="https://developer.hashicorp.com/consul/tutorials/archive/kubernetes-consul-design-patterns?utm_source=chatgpt.com" title="Consul service mesh on Kubernetes design patterns">developer.hashicorp.com</a>, <a href="https://www.getambassador.io/?utm_source=chatgpt.com" title="Kubernetes-native microservices API gateway: Ambassador">getambassador.io</a>, <a href="https://blog.getambassador.io/building-ambassador-an-open-source-api-gateway-on-kubernetes-and-envoy-ed01ed520844?utm_source=chatgpt.com" title="Ambassador API Gateway built on Kubernetes and Envoy | Ambassador Labs">blog.getambassador.io</a>)</li><li><strong>NGINX 사용 예시</strong>: 실험/기본 서버간 트래픽 분산 가능 (<a href="https://medium.com/%40bjammal/hands-on-ambassador-pattern-625a13ceb8b7?utm_source=chatgpt.com" title="Hands-on Ambassador Pattern - Medium">medium.com</a>)</li></ul><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><ul><li>성능 오버헤드(추가 proxy 레이어)</li><li>Ambassador 자체의 복잡한 구성 및 유지보수 필요</li><li>단일 장애 지점(single point of failure)</li><li>레거시 코드와 빈번한 변경 시 관리 부담 (<a href="https://akfpartners.com/growth-blog/ambassador-pattern-description-and-advice-on-usage?utm_source=chatgpt.com" title="Ambassador Pattern: Description and Advice on Usage - AKF Partners">akfpartners.com</a>, <a href="https://dzone.com/articles/design-patterns-for-microservices-ambassador-anti?utm_source=chatgpt.com" title="Design Patterns for Microservices">dzone.com</a>)</li></ul><hr><h2 id=주요-정리-내용>주요 정리 내용<a hidden class=anchor aria-hidden=true href=#주요-정리-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>핵심 개념</td><td>Sidecar 기반</td><td>Ambassador container</td><td>앱과 동일 Pod 내 별도 컨테이너로 구현되며, localhost 기반 통신 제공</td></tr><tr><td>핵심 개념</td><td>역할 분리</td><td>네트워크 기능 대행</td><td>재시도, 회로차단, TLS, 모니터링 등 통신 관련 기능을 추상화</td></tr><tr><td>구현 기법</td><td>Envoy 기반</td><td>Ambassador Edge Stack</td><td>쿠버네티스 네이티브 API Gateway 프로덕션용 Ambassador 솔루션</td></tr><tr><td>구현 기법</td><td>NGINX 활용</td><td>트래픽 라우팅/실험</td><td>A/B 테스트·HTTPS 종료 등의 목적에 활용</td></tr><tr><td>특징</td><td>언어 및 플랫폼 무관</td><td>범용성</td><td>언어·레거시 시스템에 관계없이 적용 가능</td></tr><tr><td>도전 과제 및 문제점</td><td>성능 · 장애</td><td>오버헤드 및 단일 실패 지점</td><td>proxy 병목, Ambassador 장애 시 전체 통신 중단 가능성</td></tr></tbody></table><hr><p>다음으로는 <strong>구조 및 아키텍처</strong>, <strong>구성 요소 분류</strong>, <strong>장단점 분석 및 사례</strong>, <strong>코드 예시 등</strong>을 심층적으로 이어가겠습니다. 어떤 항목부터 진행할지 알려주세요!</p><p>알겠습니다. 이어서 <strong>구조 및 아키텍처</strong>와 <strong>구성 요소 분류</strong>, 그리고 Mermaid 다이어그램을 포함하여 심화 분석합니다.</p><hr><h2 id=9-구조-및-아키텍처-양식--다이어그램>9. 구조 및 아키텍처 (양식 + 다이어그램)<a hidden class=anchor aria-hidden=true href=#9-구조-및-아키텍처-양식--다이어그램>#</a></h2><h3 id=-구조-개요>🏗️ 구조 개요<a hidden class=anchor aria-hidden=true href=#-구조-개요>#</a></h3><p>Ambassador Pattern은 애플리케이션과 외부 서비스 간에 <strong>co‑located proxy</strong>로 배치되며, <strong>Sidecar 컨테이너</strong> 형태로 구현됩니다. 이는 트래픽 제어, 보안, 로깅, 모니터링, 라우팅, 장애 대응 등 <strong>네트워크/통신 관련 공통 기능</strong>을 담당하면서 애플리케이션 로직으로부터 명확히 분리됩니다.</p><h3 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h3><table><thead><tr><th>유형</th><th>구성 요소</th><th>역할 및 기능</th></tr></thead><tbody><tr><td>필수 구성요소</td><td>Application 컨테이너</td><td>비즈니스 로직 수행 및 localhost를 통해 Ambassador 호출</td></tr><tr><td></td><td>Ambassador 컨테이너</td><td>요청 수신 → 서비스 디스커버리 → 라우팅/보안/회복성 기능 수행 → 외부 서비스 호출</td></tr><tr><td>선택 구성요소</td><td>Policy/Config 서비스</td><td>Ambassador 설정(라우팅 정책, TLS 인증서, circuit breaker 설정 등) 중앙 관리</td></tr><tr><td></td><td>Service Registry</td><td>Ambassador가 동적으로 대상 서비스 조회</td></tr><tr><td></td><td>모니터링/로깅 시스템</td><td>Ambassador에서 수집된 메트릭/로그 수집 & 시각화</td></tr></tbody></table><h3 id=아키텍처-다이어그램-mermaid>아키텍처 다이어그램 (Mermaid)<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램-mermaid>#</a></h3><pre class=mermaid>graph LR
  subgraph Pod: App Service
    A[Application&lt;br&gt;(Client)]
    S[Ambassador Proxy&lt;br&gt;(Sidecar)]
  end
  subgraph Infra
    SR(Service Registry)
    PS(Policy Service)
    ES(External Service(s))
    ML(Monitoring &amp; Logging Backend)
  end
  A --&gt;|localhost| S
  S --&gt;|service lookup| SR
  S --&gt;|fetch config| PS
  S --&gt;|metrics/logs| ML
  S --&gt;|secured calls| ES
</pre><h3 id=설명>설명<a hidden class=anchor aria-hidden=true href=#설명>#</a></h3><ol><li><strong>Application</strong>은 단순히 localhost의 Ambassador에 HTTP/gRPC 요청을 보냄</li><li><strong>Ambassador</strong>는 호출된 API의 대상 서비스 위치를 <strong>Service Registry</strong>에서 확인</li><li><strong>Policy Service</strong>로부터 라우팅, TLS, 회로 차단 등 정책 정보를 동적으로 받아 설정</li><li>외부 서비스(또는 내부 마이크로서비스)에 <strong>보안 및 회복성</strong>을 적용해 요청 전송</li><li>요청 과정 중 <strong>모니터링/로깅 시스템</strong>으로 메트릭과 로그를 전송</li></ol><p>이런 구성 덕분에 다음과 같은 이점을 얻습니다:</p><ul><li>앱 코드 변경 없이 통신 정책 적용</li><li>중앙화된 네트워크 제어 및 정책 관리</li><li>쿠버네티스나 다른 컨테이너 환경에서 <strong>sidecar 패턴</strong>으로 구현 가능</li></ul><hr><h2 id=10-구성-요소-분류-필수-vs-선택>10. 구성 요소 분류: 필수 vs 선택<a hidden class=anchor aria-hidden=true href=#10-구성-요소-분류-필수-vs-선택>#</a></h2><h3 id=-필수-구성요소>✅ 필수 구성요소<a hidden class=anchor aria-hidden=true href=#-필수-구성요소>#</a></h3><table><thead><tr><th>구성 요소</th><th>기능</th></tr></thead><tbody><tr><td>Application 컨테이너</td><td>비즈니스 로직 실행, localhost를 통해 Ambassador 호출</td></tr><tr><td>Ambassador 컨테이너</td><td>트래픽 수신 → 라우팅/보안/회복성 적용 → 실제 서비스 호출</td></tr></tbody></table><h3 id=-선택-구성요소>🧩 선택 구성요소<a hidden class=anchor aria-hidden=true href=#-선택-구성요소>#</a></h3><table><thead><tr><th>구성 요소</th><th>기능</th></tr></thead><tbody><tr><td>Policy/Config 서비스</td><td>Ambassador 전체 인스턴스의 환경설정을 중앙에서 관리</td></tr><tr><td>Service Registry (예: Consul, etcd, Kubernetes API Server 등)</td><td>Ambassador에 동적 타겟 정보 제공</td></tr><tr><td>Monitoring & Logging 시스템</td><td>Ambassador가 보낸 지표 및 로그 집계 & 분석</td></tr></tbody></table><p><strong>정리</strong>: Application과 Ambassador 컨테이너는 필수이며, 나머지는 운영 효율성과 중앙 관리 목적에 따라 선택해 도입할 수 있습니다.</p><hr><h2 id=11-구현-기법-요약>11. 구현 기법 (요약)<a hidden class=anchor aria-hidden=true href=#11-구현-기법-요약>#</a></h2><ul><li><strong>Kubernetes Sidecar Pod</strong>: Ambassador를 Pod 내부에 sidecar 컨테이너로 배포</li><li><strong>Envoy Proxy 기반</strong>: Ambassador Edge Stack(Ambassador Labs 제품)은 Envoy에 사용자 정의 라우팅 및 인증 기능을 추가</li><li><strong>NGINX 기반 구현</strong>: 간단한 경우 NGINX를 Ambassador 역할로 사용, TLS Termination, A/B 테스트 등 수행</li><li><strong>클라이언트 로컬 프록시</strong>: VM 환경에서는 애플리케이션과 같은 호스트에 Ambassador 바이너리 배포</li><li><strong>서비스 매시 연동</strong>: Istio 같이 메시구조 내에서 Ambassador 역할 수행</li></ul><hr><h3 id=-요약-말씀>🧠 요약 말씀<a hidden class=anchor aria-hidden=true href=#-요약-말씀>#</a></h3><ul><li><strong>측면</strong>: 구조/아키텍처를 통해 Ambassador가 애플리케이션과 외부 서비스 간 프록시 역할을 수행하는 방식을 명확히 정리했습니다.</li><li><strong>다음 단계</strong>: 구성 요소별 역할 기반 장단점 분석, 문제점 및 해결책표화, 실무 적용 및 코드 예시 작성으로 넘어가겠습니다.</li></ul><p>이어서 <strong>장점/단점 및 문제점, 해결방안</strong>, 마지막으로 <strong>실무 사용 예시</strong>를 표와 함께 정리합니다.</p><hr><h2 id=12-장점-advantages>12. 장점 (Advantages)<a hidden class=anchor aria-hidden=true href=#12-장점-advantages>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>추상화된 통신 처리</strong></td><td>네트워크, 보안, 로깅, 라우팅 등 반복 기능을 Ambassador로 이전하여 애플리케이션 코드가 단순해짐 (<a href="https://dzone.com/articles/design-patterns-for-microservices-ambassador-anti?utm_source=chatgpt.com" title="Design Patterns for Microservices: Ambassador, Anti-Corruption ...">dzone.com</a>)</td></tr><tr><td>장점</td><td><strong>프로토콜 무관성</strong></td><td>HTTP, gRPC, 폴링, 레거시 등 다양한 통신 방식 지원 가능</td></tr><tr><td>장점</td><td><strong>신뢰성 및 복원력 강화</strong></td><td>재시도, 회로 차단 등을 통해 장애 복원성을 높이고 시스템 안정성 보장</td></tr><tr><td>장점</td><td><strong>중앙 통제점 제공</strong></td><td>설정 변경이나 로깅 정책을 모든 서비스에 한 번에 적용 가능</td></tr></tbody></table><hr><h2 id=13-단점과-문제점-및-해결방안>13. 단점과 문제점 및 해결방안<a hidden class=anchor aria-hidden=true href=#13-단점과-문제점-및-해결방안>#</a></h2><h3 id=131-단점-disadvantages>13.1 단점 (Disadvantages)<a hidden class=anchor aria-hidden=true href=#131-단점-disadvantages>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>추가 복잡도</td><td>새로운 프록시 계층 도입으로 아키텍처 복잡도 증가 (<a href="https://akfpartners.com/growth-blog/ambassador-pattern-description-and-advice-on-usage?utm_source=chatgpt.com" title="Ambassador Pattern: Description and Advice on Usage - AKF Partners">akfpartners.com</a>)</td><td>명확한 모니터링/트레이싱/문서화 통해 이해도 증가</td></tr><tr><td>단점</td><td>성능 오버헤드</td><td>요청이 Ambassador를 거치며 지연 발생</td><td>로깅 최적화·배치 전송, 핫패스 최적화</td></tr><tr><td>단점</td><td>운영 부담</td><td>Ambassador 구성/배포·업데이트·정책 관리 필요</td><td>설정자동화(CI/CD), 헬스체크 도입</td></tr><tr><td>단점</td><td>장애 리스크</td><td>Ambassador 장애 시 전체 흐름 영향 가능</td><td>Ambassador 다중 인스턴스/로드밸런싱 구성</td></tr></tbody></table><h3 id=132-문제점-issues>13.2 문제점 (Issues)<a hidden class=anchor aria-hidden=true href=#132-문제점-issues>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지·진단</th><th>예방</th><th>해결</th></tr></thead><tbody><tr><td>문제점</td><td>Latency 증가</td><td>중간 hops 추가</td><td>사용자 응답 지연</td><td>APM, Tracing 사용</td><td>경량화 구성, TTL 조정</td><td>Ambassador 버퍼링 및 속도 조정</td></tr><tr><td>문제점</td><td>멀티 쓰레드 제한</td><td>싱글 Ambassador 병목</td><td>동시 처리 능력 저하</td><td>리소스 모니터링</td><td>인스턴스 수 증가</td><td>스케일아웃 구성</td></tr><tr><td>문제점</td><td>정책 부정확 동기화</td><td>설정 분산 관리</td><td>정책 일관성 결여</td><td>Config drift 탐지</td><td>중앙 Config 서비스</td><td>Ambassador 자동 재로드</td></tr><tr><td>문제점</td><td>디버깅 어려움</td><td>프록시 계층 추가</td><td>문제 위치 파악 어려움</td><td>통합 로깅/추적</td><td>로그 포맷 표준화</td><td>에러 발생 시 상세 로그 수집</td></tr></tbody></table><hr><h2 id=14-실무-사용-예시-use-cases>14. 실무 사용 예시 (Use Cases)<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시-use-cases>#</a></h2><table><thead><tr><th>사용 예시</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td><strong>레거시 시스템 통합</strong></td><td>기존 SOAP/메인프레임 앱 통신 확장</td><td>코드 변경 없이 TLS, 로깅 적용 가능(<a href="https://akfpartners.com/growth-blog/ambassador-pattern-description-and-advice-on-usage?utm_source=chatgpt.com" title="Ambassador Pattern: Description and Advice on Usage - AKF Partners">akfpartners.com</a>, <a href="https://www.geeksforgeeks.org/system-design/ambassador-pattern-in-distributed-systems/?utm_source=chatgpt.com" title="Ambassador Pattern in Distributed Systems - GeeksforGeeks">geeksforgeeks.org</a>, <a href="https://medium.com/%40bindubc/ambassadors-557ea91a76d9?utm_source=chatgpt.com" title="Distributed Service: Ambassadors Pattern | by Bindu C | Medium">medium.com</a>, <a href="https://dzone.com/articles/design-patterns-for-microservices-ambassador-anti?utm_source=chatgpt.com" title="Design Patterns for Microservices: Ambassador, Anti-Corruption ...">dzone.com</a>, <a href="https://www.springfuse.com/ambassador-pattern-in-cloud-based-microservices/?utm_source=chatgpt.com" title="Implementing the Ambassador Pattern in Java Microservices for ...">springfuse.com</a>)</td></tr><tr><td><strong>서비스 셰어딩</strong></td><td>DB/Cache sharding 로직 적용</td><td>App는 localhost만 호출, Ambassador가 라우팅</td></tr><tr><td><strong>트래픽 분할/실험(A/B)</strong></td><td>신규 기능 실험 시도</td><td>NGINX Ambassador로 일부 트래픽 분기</td></tr><tr><td><strong>멀티 프로토콜 브리지</strong></td><td>HTTP ↔ gRPC 통신 지원</td><td>App 변경 없이 프록시에서 변환</td></tr><tr><td><strong>보안 관문(Gateway)</strong></td><td>TLS termination, 인증 적용</td><td>중앙 Ambassador에서 일괄 처리</td></tr></tbody></table><hr><h2 id=15-활용-사례-심화>15. 활용 사례 심화<a hidden class=anchor aria-hidden=true href=#15-활용-사례-심화>#</a></h2><ul><li><p><strong>서비스 셰어딩 기반 Redis 캐시 확장</strong></p><ul><li><p><strong>구성</strong>: App Pod 내 Twemproxy Ambassador 도입</p></li><li><p><strong>역할</strong>: App는 localhost:6379 호출 → Ambassador가 요청 분석 후 Redis shard로 라우팅</p></li><li><p><strong>차이점</strong>: Ambassador 없으면 App에서 shard 매핑 코드 필요. Ambassador는 App 코드 변경 없이 라우팅 구현 (<a href="https://medium.com/%40bindubc/ambassadors-557ea91a76d9?utm_source=chatgpt.com" title="Distributed Service: Ambassadors Pattern | by Bindu C | Medium">medium.com</a>)</p></li></ul></li><li><p><strong>A/B 실험 Ambassador 활용</strong></p><ul><li><p>주요 URL 일부 트래픽을 실험용 서비스로 분기</p></li><li><p>로깅 및 모니터링 이중화, 실험 안정성 확보 (<a href="https://medium.com/%40bindubc/ambassadors-557ea91a76d9?utm_source=chatgpt.com" title="Distributed Service: Ambassadors Pattern | by Bindu C | Medium">medium.com</a>)</p></li></ul></li></ul><hr><p>다음은 <strong>구현 예시 코드</strong>, <strong>도전 과제</strong>, <strong>분류 기준</strong>, <strong>실무 적용 권장사항</strong> 등을 필요한 순서에 따라 작성 가능합니다. 요청하시면 바로 이어서 작성하겠습니다. 어떤 항목부터 도입할까요?</p><p>다음으로 <strong>실제 구현 예시 코드</strong>, <strong>도전 과제</strong>, <strong>분류 기준</strong>, <strong>실무 적용 권장사항 및 최적화 팁</strong>을 순서대로 작성합니다.</p><hr><h2 id=16-구현-예시-python--kubernetes>16. 구현 예시 (Python + Kubernetes)<a hidden class=anchor aria-hidden=true href=#16-구현-예시-python--kubernetes>#</a></h2><h3 id=-python-grpc-클라이언트와-ambassador-sidecar-예시>🧪 Python gRPC 클라이언트와 Ambassador Sidecar 예시<a hidden class=anchor aria-hidden=true href=#-python-grpc-클라이언트와-ambassador-sidecar-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41>41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42>42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43>43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44>44</a>
</span><span class=lnt id=hl-6-45><a class=lnlinks href=#hl-6-45>45</a>
</span><span class=lnt id=hl-6-46><a class=lnlinks href=#hl-6-46>46</a>
</span><span class=lnt id=hl-6-47><a class=lnlinks href=#hl-6-47>47</a>
</span><span class=lnt id=hl-6-48><a class=lnlinks href=#hl-6-48>48</a>
</span><span class=lnt id=hl-6-49><a class=lnlinks href=#hl-6-49>49</a>
</span><span class=lnt id=hl-6-50><a class=lnlinks href=#hl-6-50>50</a>
</span><span class=lnt id=hl-6-51><a class=lnlinks href=#hl-6-51>51</a>
</span><span class=lnt id=hl-6-52><a class=lnlinks href=#hl-6-52>52</a>
</span><span class=lnt id=hl-6-53><a class=lnlinks href=#hl-6-53>53</a>
</span><span class=lnt id=hl-6-54><a class=lnlinks href=#hl-6-54>54</a>
</span><span class=lnt id=hl-6-55><a class=lnlinks href=#hl-6-55>55</a>
</span><span class=lnt id=hl-6-56><a class=lnlinks href=#hl-6-56>56</a>
</span><span class=lnt id=hl-6-57><a class=lnlinks href=#hl-6-57>57</a>
</span><span class=lnt id=hl-6-58><a class=lnlinks href=#hl-6-58>58</a>
</span><span class=lnt id=hl-6-59><a class=lnlinks href=#hl-6-59>59</a>
</span><span class=lnt id=hl-6-60><a class=lnlinks href=#hl-6-60>60</a>
</span><span class=lnt id=hl-6-61><a class=lnlinks href=#hl-6-61>61</a>
</span><span class=lnt id=hl-6-62><a class=lnlinks href=#hl-6-62>62</a>
</span><span class=lnt id=hl-6-63><a class=lnlinks href=#hl-6-63>63</a>
</span><span class=lnt id=hl-6-64><a class=lnlinks href=#hl-6-64>64</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># sidecar.yaml: Ambassador Sidecar Deployment (Kubernetes Pod)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-with-ambassador</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myorg/myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>50051</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>AMBASSADOR_ADDR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;localhost:9900&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ambassador</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>envoyproxy/envoy:v1.27</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>9900</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/envoy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>envoy.yaml</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    static_resources:
</span></span></span><span class=line><span class=cl><span class=sd>      listeners:
</span></span></span><span class=line><span class=cl><span class=sd>      - name: listener_9900
</span></span></span><span class=line><span class=cl><span class=sd>        address:
</span></span></span><span class=line><span class=cl><span class=sd>          socket_address: { address: 0.0.0.0, port_value: 9900 }
</span></span></span><span class=line><span class=cl><span class=sd>        filter_chains:
</span></span></span><span class=line><span class=cl><span class=sd>        - filters:
</span></span></span><span class=line><span class=cl><span class=sd>          - name: envoy.filters.network.http_connection_manager
</span></span></span><span class=line><span class=cl><span class=sd>            typed_config:
</span></span></span><span class=line><span class=cl><span class=sd>              &#34;@type&#34;: type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
</span></span></span><span class=line><span class=cl><span class=sd>              stat_prefix: grpc_proxy
</span></span></span><span class=line><span class=cl><span class=sd>              route_config:
</span></span></span><span class=line><span class=cl><span class=sd>                name: local_route
</span></span></span><span class=line><span class=cl><span class=sd>                virtual_hosts:
</span></span></span><span class=line><span class=cl><span class=sd>                - name: backend
</span></span></span><span class=line><span class=cl><span class=sd>                  domains: [&#34;*&#34;]
</span></span></span><span class=line><span class=cl><span class=sd>                  routes:
</span></span></span><span class=line><span class=cl><span class=sd>                  - match: { prefix: &#34;/&#34; }
</span></span></span><span class=line><span class=cl><span class=sd>                    route: { cluster: &#34;grpc_service&#34; }
</span></span></span><span class=line><span class=cl><span class=sd>              http_filters:
</span></span></span><span class=line><span class=cl><span class=sd>              - name: envoy.filters.http.router
</span></span></span><span class=line><span class=cl><span class=sd>      clusters:
</span></span></span><span class=line><span class=cl><span class=sd>      - name: grpc_service
</span></span></span><span class=line><span class=cl><span class=sd>        connect_timeout: 0.25s
</span></span></span><span class=line><span class=cl><span class=sd>        type: STRICT_DNS
</span></span></span><span class=line><span class=cl><span class=sd>        lb_policy: ROUND_ROBIN
</span></span></span><span class=line><span class=cl><span class=sd>        load_assignment:
</span></span></span><span class=line><span class=cl><span class=sd>          cluster_name: grpc_service
</span></span></span><span class=line><span class=cl><span class=sd>          endpoints:
</span></span></span><span class=line><span class=cl><span class=sd>          - lb_endpoints:
</span></span></span><span class=line><span class=cl><span class=sd>            - endpoint: { address: { socket_address: { address: grpc-backend.default.svc.cluster.local, port_value: 50051 } } }</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># client.py: Python gRPC Client</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>grpc</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>myapp_pb2</span><span class=o>,</span> <span class=nn>myapp_pb2_grpc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>grpc</span><span class=o>.</span><span class=n>insecure_channel</span><span class=p>(</span><span class=s2>&#34;localhost:9900&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>stub</span> <span class=o>=</span> <span class=n>myapp_pb2_grpc</span><span class=o>.</span><span class=n>MyServiceStub</span><span class=p>(</span><span class=n>channel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span> <span class=o>=</span> <span class=n>stub</span><span class=o>.</span><span class=n>MyRPC</span><span class=p>(</span><span class=n>myapp_pb2</span><span class=o>.</span><span class=n>MyRequest</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=s2>&#34;hello&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Response:&#34;</span><span class=p>,</span> <span class=n>resp</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>run</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>🔎 설명</strong>:</p><ul><li><code>app</code> 컨테이너는 Ambassador(proxy)로 <code>localhost:9900</code> gRPC 호출.</li><li><code>envoy</code> 컨테이너(Ambassador)는 <code>grpc_service</code> 클러스터로 라우팅.</li><li>Ambassador 분리 덕분에 앱 코드 변화 없이 라우팅 가능, TLS/인증, 로깅 정책도 중앙 적용.</li></ul><hr><h2 id=17-도전-과제-challenges>17. 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#17-도전-과제-challenges>#</a></h2><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방/해결</th></tr></thead><tbody><tr><td>성능</td><td>Latency 부담</td><td>요청 hop 추가</td><td>응답 지연 악화</td><td>APM/분산 추적</td><td>keep-alive 설정, 리팩토링 간섭 제거</td></tr><tr><td>안정성</td><td>Ambassador 장애</td><td>단일 인스턴스 의존</td><td>통신 전체 실패</td><td>헬스체크 및 LivenessProbe</td><td>sidecar ReplicaSet 증가, LB 구성</td></tr><tr><td>운영</td><td>Config drift</td><td>설정 동기화 실패</td><td>정책 충돌 및 로깅 누락</td><td>Config drift 모니터링</td><td>중앙 설정 서비스, GitOps</td></tr><tr><td>보안</td><td>인증서 로테이션</td><td>TLS 유효기간 만료</td><td>통신 보안 약화</td><td>로그/알람 모니터링</td><td>중앙 CA, 자동 갱신 도구 (cert-manager)</td></tr></tbody></table><hr><h2 id=18-분류-기준에-따른-종류-및-유형>18. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#18-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>배포 방식</td><td>Sidecar 컨테이너</td><td>컨테이너 환경에서 가장 널리 사용됨</td></tr><tr><td></td><td>로컬 프록시 바이너리</td><td>VM/물리 머신 환경 지원</td></tr><tr><td>기반 기술</td><td>Envoy 기반</td><td>Ambassador Labs, Istio 연동</td></tr><tr><td></td><td>NGINX/OpenResty 기반</td><td>간단한 라우팅, TLS, 실험 기능 중심</td></tr><tr><td>기능 범위</td><td>단순 라우팅 Only</td><td>최소 구성, 실험/프록시 목적</td></tr><tr><td></td><td>고급 서비스 매시 수준</td><td>인증, 모니터링, 서비스 메시 기능 포함</td></tr><tr><td>정책 관리</td><td>중앙정책(Config service)</td><td>중앙에서 정책 배포/동기화</td></tr><tr><td></td><td>파일 기반 Config</td><td>간단한 파일 또는 ConfigMap 사용</td></tr></tbody></table><hr><h2 id=19-실무에서-적용하기-위한-고려사항-및-주의점>19. 실무에서 적용하기 위한 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#19-실무에서-적용하기-위한-고려사항-및-주의점>#</a></h2><table><thead><tr><th>항목</th><th>주의사항</th><th>권장사항</th></tr></thead><tbody><tr><td>Config 관리</td><td>drift 및 버전 불일치 위험</td><td>GitOps, declarative config</td></tr><tr><td>모니터링</td><td>트래픽 시각화 필요</td><td>Prometheus + Grafana + Zipkin/Jaeger</td></tr><tr><td>보안</td><td>프록시의 TLS/인증 설정 누락 우려</td><td>cert-manager 사용, RBAC 클러스터 정책 설정</td></tr><tr><td>성능</td><td>병목 및 지연</td><td>Envoy tuning(keep-alive, connection pooling)</td></tr><tr><td>장애 대응</td><td>sidecar crash 시 영향</td><td>LivenessProbe, retries, fallback</td></tr><tr><td>비용</td><td>리소스 오버헤드</td><td>리소스 리미트 설정 및 sidecar 합리화</td></tr></tbody></table><hr><h2 id=20-최적화하기-위한-주의사항-및-권장-팁>20. 최적화하기 위한 주의사항 및 권장 팁<a hidden class=anchor aria-hidden=true href=#20-최적화하기-위한-주의사항-및-권장-팁>#</a></h2><table><thead><tr><th>항목</th><th>주의사항</th><th>권장</th></tr></thead><tbody><tr><td>지연 최적화</td><td>로깅/필터 과도 적용</td><td>경량화 로그, 필요 시 비동기로 전송</td></tr><tr><td>리소스 사용</td><td>sidecar 리소스 과다</td><td>CPU/Mem limit 및 autoscaling 적용</td></tr><tr><td>Config 동기화</td><td>높은 빈도 재시작 가능성</td><td>동적 xDS 기반 hot-reload</td></tr><tr><td>TLS 핸드셰이크</td><td>매 요청마다 TLS 오버헤드</td><td>비교적 긴 연결 TTL 유지, mTLS</td></tr><tr><td>장애 대비</td><td>Ambassador crash 반복</td><td>PodReplica 2개 이상 구성</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>Proxy</td><td>Sidecar</td><td>애플리케이션 컨테이너와 co‑located 되어 트래픽 중계 수행</td></tr><tr><td>Proxy</td><td>Ambassador</td><td>Sidecar 프록시로 라우팅, 보안, 로깅 기능 수행</td></tr><tr><td>설계</td><td>Circuit Breaker</td><td>장애 발생 시 요청 중단 및 빠른 실패 응답 처리</td></tr><tr><td>패턴</td><td>Service Mesh</td><td>서비스 간 통신을 프록시 기반으로 통합 관리하는 아키텍처</td></tr><tr><td>구성</td><td>GitOps</td><td>선언적 구성 자동화 방식으로 코드처럼 인프라 관리</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li>Ambassador Sidecar 패턴 개념 및 구현: <a href=http://www.google.co.kr>Envoy Proxy Business Use Cases</a></li><li>Ambassador Labs: Kubernetes-native API Gateway (Envoy 기반)</li><li>Istio Service Mesh 구조 및 Sidecar 활용 사례</li><li>Cert-manager GitOps 기반 TLS 인증서 자동 갱신</li></ul><hr><p>다른 항목들(테스트 시나리오, 비교 다이어그램 추가, etc.)이 필요하시면 언제든 말씀주세요!</p><p>이어서 <strong>추가 학습 내용</strong>, <strong>주목할 핵심 내용 정리</strong>, <strong>기타 보충 사항</strong>, <strong>전체 요약 및 다음 단계 제안</strong>을 작성합니다.</p><hr><h2 id=21-반드시-학습해야-할-추가-내용>21. 반드시 학습해야 할 추가 내용<a hidden class=anchor aria-hidden=true href=#21-반드시-학습해야-할-추가-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Service Mesh</td><td>Envoy xDS API</td><td>동적 구성 관리</td><td>Ambassador 설정을 xDS 기반으로 실시간 변경 가능</td></tr><tr><td>Monitoring</td><td>OpenTelemetry</td><td>메트릭/분산추적</td><td>Ambassador 로그/트레이스 수집 및 시각화</td></tr><tr><td>CI/CD</td><td>GitOps</td><td>declarative Config 배포</td><td>Ambassador 설정을 코드처럼 관리</td></tr><tr><td>Security</td><td>mTLS</td><td>상호 TLS 인증</td><td>Ambassador 간 및 외부 서비스 연결 시 보안 강화</td></tr><tr><td>Performance</td><td>Envoy Tuning</td><td>Connection pooling, keep‑alive</td><td>Latency/saturation 최적화</td></tr><tr><td>Kubernetes</td><td>Pod Injection</td><td>sidecar 자동 주입</td><td>Istio/MutatingWebhook으로 자동 배포</td></tr></tbody></table><hr><h2 id=22-주목할-내용-요약>22. 주목할 내용 요약<a hidden class=anchor aria-hidden=true href=#22-주목할-내용-요약>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Proxy 패턴</td><td>Sidecar 패턴</td><td>Ambassador placement</td><td>Pod 내부에 co‑located 구조</td></tr><tr><td>네트워크 제어</td><td>회복성</td><td>Circuit Breaker, Retry</td><td>Resiliency 내장</td></tr><tr><td>Config 관리</td><td>동기화</td><td>xDS, GitOps</td><td>구성 consistency 확보</td></tr><tr><td>보안</td><td>TLS 인증, mTLS</td><td>인증서 관리, RBAC</td><td>End-to-End 보안 구현</td></tr><tr><td>Observability</td><td>Metrics & Tracing</td><td>OpenTelemetry, Jaeger</td><td>분산 시스템 모니터링</td></tr><tr><td>작업 자동화</td><td>CI/CD, Sidecar injection</td><td>자동 배포/배관화</td><td>운영 비용 절감</td></tr></tbody></table><hr><h2 id=23-기타-보충-사항>23. 기타 보충 사항<a hidden class=anchor aria-hidden=true href=#23-기타-보충-사항>#</a></h2><h3 id=-비교-예시-istio-sidecar-vs-ambassador-pattern>🧩 비교 예시: Istio Sidecar vs Ambassador Pattern<a hidden class=anchor aria-hidden=true href=#-비교-예시-istio-sidecar-vs-ambassador-pattern>#</a></h3><pre class=mermaid>graph TD
  A(App) --&gt; B(Ambassador)
  A --&gt; C(Istio Sidecar)
  B --&gt; D(External Service)
  C --&gt; D
</pre><ul><li><strong>Istio Sidecar</strong>는 Envoy 기반 서비스 메시 전체 기능 제공 (보안, 라우팅, 정책 등 종합 관리)</li><li><strong>Ambassador</strong>는 API Gateway 프록시 중심으로 경량 구현, 단일 서비스 또는 Pod 수준에서 적용</li></ul><h3 id=-실전-팁>🧠 실전 팁<a hidden class=anchor aria-hidden=true href=#-실전-팁>#</a></h3><ul><li>개발/스테이징 환경에서 시범적으로 Ambassador를 적용해 latency, 로그 패턴 등을 측정 권장</li><li>기존 Kubernetes 환경에 Istio 같은 메시 플랫폼이 도입되어 있다면 Ambassador 대신 VirtualService나 Envoy 컨트롤러 활용 고려</li></ul><hr><h2 id=-전체-요약-및-다음-제안>🔁 전체 요약 및 다음 제안<a hidden class=anchor aria-hidden=true href=#-전체-요약-및-다음-제안>#</a></h2><p>Ambassador Pattern은 애플리케이션과 외부 서비스 사이에 <strong>Sidecar Proxy</strong>를 두어 네트워크 기능(라우팅, 보안, 로깅, 회복성 등)을 분리 및 모듈화하는 아키텍처입니다. Envoy 기반 Ambassador 컨테이너를 co‑located 구조로 활용하여 애플리케이션 코드를 변경하지 않고도 보안 및 네트워크 정책을 일괄 적용할 수 있습니다. Kubernetes뿐 아니라 VM 환경까지 적용 가능하며, GitOps, OpenTelemetry, mTLS 등과 결합하면 높은 수준의 운영 안정성과 보안을 구현할 수 있습니다.</p><p><strong>다음 단계 제안:</strong></p><ol><li><strong>PoC 구축</strong>: 간단한 gRPC/HTTP 앱에 Ambassador 적용해보기</li><li><strong>성능 테스트</strong>: latency, throughput 비교 측정</li><li><strong>Config 자동화 구축</strong>: GitOps 기반 구성 관리 구현</li><li><strong>모니터링/추적 도입</strong>: Prometheus + Jaeger 연동</li><li><strong>보안 강화 계획</strong>: mTLS 및 인증서 롤링 전략 수립</li></ol><p>원하시면 코드 예시, YAML, Kafka/REST 등 특정 워크로드 적용 사례, 또는 Istio 비교 심화도 제공할 수 있습니다. 언제든지 말씀해주세요!</p><p>Ambassador Pattern에 대해 체계적으로 조사하고 분석해보겠습니다. 먼저 최신 정보를 수집하기 위해 웹 검색을 진행하겠습니다.# Ambassador Pattern 분석 및 조사 보고서</p><h2 id=1-태그-1>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-1>#</a></h2><ul><li><strong>Ambassador-Pattern</strong></li><li><strong>Microservices-Proxy</strong></li><li><strong>Sidecar-Architecture</strong></li><li><strong>Legacy-Integration</strong></li></ul><h2 id=2-분류-구조-적절성-검토>2. 분류 구조 적절성 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적절성-검토>#</a></h2><p><strong>현재 분류</strong>: &ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Deployment and Scalability Patterns&rdquo;</p><p><strong>검토 결과</strong>: 적절함</p><p><strong>근거</strong>: Ambassador Pattern은 마이크로서비스 아키텍처에서 배포와 확장성을 고려한 설계 패턴으로, 레거시 시스템 통합 및 서비스 간 통신 최적화를 위한 아키텍처 패턴입니다. 특히 배포 환경에서 프록시 역할을 수행하며 확장성을 제공하므로 해당 분류가 적절합니다.</p><h2 id=3-주제-요약-200자>3. 주제 요약 (200자)<a hidden class=anchor aria-hidden=true href=#3-주제-요약-200자>#</a></h2><p>Ambassador Pattern은 클라이언트와 동일 호스트에 배치되는 아웃-오브-프로세스 프록시로, 모니터링, 로깅, 라우팅, 보안 등의 공통 연결 작업을 대행합니다. 특히 레거시 애플리케이션이나 수정이 어려운 시스템의 네트워킹 기능을 확장하는 데 효과적이며, 언어에 관계없이 복원력 패턴을 구현할 수 있게 해줍니다.</p><h2 id=4-개요-250자>4. 개요 (250자)<a hidden class=anchor aria-hidden=true href=#4-개요-250자>#</a></h2><p>Ambassador Pattern은 분산 시스템에서 서비스 간 통신을 관리하는 설계 패턴입니다. 클라이언트 애플리케이션과 원격 서비스 사이에서 프록시 역할을 수행하며, 연결 관리, 보안, 모니터링, 회로 차단기 등의 기능을 제공합니다. 마이크로서비스 아키텍처에서 특히 유용하며, 사이드카 컨테이너로 구현되어 애플리케이션 코드 변경 없이 인프라 기능을 추가할 수 있습니다.</p><hr><h2 id=i-핵심-개념-및-이론적-기반>I. 핵심 개념 및 이론적 기반<a hidden class=anchor aria-hidden=true href=#i-핵심-개념-및-이론적-기반>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p>Ambassador Pattern은 <strong>클라이언트와 외부 서비스 간의 통신을 중재하는 프록시 패턴</strong>의 특수한 형태입니다. 다음과 같은 핵심 개념들을 포함합니다:</p><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><ul><li><strong>아웃-오브-프로세스 프록시 (Out-of-Process Proxy)</strong>: 애플리케이션과 별도 프로세스로 실행되면서 네트워크 요청을 대행</li><li><strong>공동 위치 배치 (Co-location)</strong>: 클라이언트 애플리케이션과 동일한 호스트 환경에 배치</li><li><strong>언어 비종속성 (Language Agnostic)</strong>: 특정 프로그래밍 언어에 의존하지 않는 기능 제공</li><li><strong>교차 관심사 분리 (Cross-cutting Concerns Separation)</strong>: 비즈니스 로직과 인프라 기능의 분리</li></ul><h4 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h4><ul><li><strong>컨테이너 기반 배포</strong>: Kubernetes 환경에서 사이드카 컨테이너로 구현</li><li><strong>서비스 메시 통합</strong>: Istio, Linkerd 등의 서비스 메시에서 프록시 역할</li><li><strong>레거시 시스템 현대화</strong>: 기존 시스템 변경 없이 현대적 기능 추가</li><li><strong>마이크로서비스 연결</strong>: 서비스 간 안전하고 신뢰할 수 있는 통신 제공</li></ul><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Ambassador Pattern의 등장 배경은 다음과 같습니다:</p><ul><li><strong>분산 시스템의 복잡성 증가</strong>: 마이크로서비스 아키텍처에서 서비스 간 통신의 복잡성</li><li><strong>레거시 시스템 통합 필요성</strong>: 기존 시스템을 수정하지 않고 현대적 기능 추가</li><li><strong>운영 관심사의 표준화</strong>: 모니터링, 로깅, 보안 등의 일관된 구현 필요</li><li><strong>개발팀과 인프라팀의 역할 분리</strong>: 각 팀의 전문성을 활용한 효율적 개발</li></ul><h3 id=목적-및-필요성-1>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성-1>#</a></h3><h4 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h4><ol><li><strong>기능 오프로딩</strong>: 애플리케이션에서 인프라 관련 기능을 분리</li><li><strong>레거시 현대화</strong>: 기존 애플리케이션의 네트워킹 기능 확장</li><li><strong>표준화</strong>: 여러 서비스에서 일관된 연결 기능 제공</li><li><strong>전문화</strong>: 특수 기능을 전담 팀이 구현 및 관리</li></ol><h4 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h4><ul><li>클라우드 기반 애플리케이션의 복원력 요구사항</li><li>다중 언어/프레임워크 환경에서의 공통 기능 필요</li><li>네트워크 관련 설정 업데이트의 동적 관리</li><li>개발팀의 인프라 복잡성 부담 경감</li></ul><hr><h2 id=ii-구조-및-작동-원리>II. 구조 및 작동 원리<a hidden class=anchor aria-hidden=true href=#ii-구조-및-작동-원리>#</a></h2><h3 id=주요-기능-및-역할-1>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할-1>#</a></h3><p>Ambassador Pattern의 주요 기능은 다음과 같습니다:</p><h4 id=연결-관리-기능>연결 관리 기능<a hidden class=anchor aria-hidden=true href=#연결-관리-기능>#</a></h4><ul><li><strong>라우팅 (Routing)</strong>: 요청을 적절한 서비스 인스턴스로 전달</li><li><strong>로드 밸런싱 (Load Balancing)</strong>: 여러 서비스 인스턴스 간 부하 분산</li><li><strong>서비스 디스커버리 (Service Discovery)</strong>: 동적 서비스 위치 확인</li><li><strong>프로토콜 변환 (Protocol Translation)</strong>: 서로 다른 프로토콜 간 변환</li></ul><h4 id=복원력-기능>복원력 기능<a hidden class=anchor aria-hidden=true href=#복원력-기능>#</a></h4><ul><li><strong>회로 차단기 (Circuit Breaker)</strong>: 실패한 서비스 호출 방지</li><li><strong>재시도 (Retry)</strong>: 실패한 요청의 자동 재시도</li><li><strong>타임아웃 (Timeout)</strong>: 응답 시간 제한 설정</li><li><strong>백압력 (Backpressure)</strong>: 과부하 상황에서의 요청 제어</li></ul><h4 id=보안-기능>보안 기능<a hidden class=anchor aria-hidden=true href=#보안-기능>#</a></h4><ul><li><strong>TLS 종료 (TLS Termination)</strong>: SSL/TLS 암호화 처리</li><li><strong>인증/인가 (Authentication/Authorization)</strong>: 접근 권한 관리</li><li><strong>API 키 관리</strong>: 외부 서비스 접근을 위한 키 관리</li></ul><h4 id=관찰성-기능>관찰성 기능<a hidden class=anchor aria-hidden=true href=#관찰성-기능>#</a></h4><ul><li><strong>로깅 (Logging)</strong>: 요청/응답 로그 수집</li><li><strong>메트릭 수집 (Metrics Collection)</strong>: 성능 지표 측정</li><li><strong>분산 추적 (Distributed Tracing)</strong>: 요청 흐름 추적</li></ul><h3 id=특징-1>특징<a hidden class=anchor aria-hidden=true href=#특징-1>#</a></h3><table><thead><tr><th>구분</th><th>특징</th><th>설명</th></tr></thead><tbody><tr><td>배치</td><td>공동 위치성</td><td>클라이언트와 동일 호스트에 배치되어 지연 시간 최소화</td></tr><tr><td>독립성</td><td>프로세스 분리</td><td>별도 프로세스로 실행되어 애플리케이션과 독립적 관리</td></tr><tr><td>투명성</td><td>클라이언트 투명성</td><td>애플리케이션이 Ambassador 존재를 인식하지 않음</td></tr><tr><td>확장성</td><td>수평 확장</td><td>애플리케이션 인스턴스마다 Ambassador 인스턴스 배치</td></tr></tbody></table><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ol><li><strong>단일 책임 원칙</strong>: 각 Ambassador는 특정 유형의 외부 서비스 연결을 담당</li><li><strong>관심사 분리</strong>: 비즈니스 로직과 인프라 기능의 명확한 분리</li><li><strong>투명성</strong>: 클라이언트 애플리케이션이 Ambassador의 존재를 인식하지 않음</li><li><strong>독립성</strong>: Ambassador와 애플리케이션의 독립적인 생명주기 관리</li></ol><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><p>Ambassador Pattern의 작동 원리를 다이어그램으로 표현하면 다음과 같습니다:</p><pre class=mermaid>sequenceDiagram
    participant C as Client Application
    participant A as Ambassador
    participant S as Remote Service
    
    C-&gt;&gt;A: 1. Request (localhost)
    A-&gt;&gt;A: 2. Apply policies&lt;br/&gt;(retry, circuit breaker, etc.)
    A-&gt;&gt;S: 3. Forward request
    S-&gt;&gt;A: 4. Response
    A-&gt;&gt;A: 5. Process response&lt;br/&gt;(logging, metrics, etc.)
    A-&gt;&gt;C: 6. Return response
</pre><p><strong>작동 단계별 설명</strong>:</p><ol><li><strong>요청 수신</strong>: 클라이언트 애플리케이션이 localhost로 요청 전송</li><li><strong>정책 적용</strong>: Ambassador가 재시도, 회로 차단기 등의 정책 적용</li><li><strong>요청 전달</strong>: 실제 원격 서비스로 요청 전달</li><li><strong>응답 수신</strong>: 원격 서비스로부터 응답 수신</li><li><strong>응답 처리</strong>: 로깅, 메트릭 수집 등의 후처리 작업</li><li><strong>응답 반환</strong>: 클라이언트 애플리케이션으로 최종 응답 전달</li></ol><h3 id=작동-원리-1>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리-1>#</a></h3><p>Ambassador Pattern의 상세 작동 원리는 다음과 같습니다:</p><pre class=mermaid>graph TB
    subgraph &#34;Host Environment&#34;
        subgraph &#34;Application Container&#34;
            APP[Application Code]
        end
        subgraph &#34;Ambassador Container&#34;
            PROXY[Proxy Engine]
            POLICY[Policy Engine]
            MONITOR[Monitoring]
            SECURITY[Security]
        end
    end
    
    subgraph &#34;External Services&#34;
        SVC1[Service A]
        SVC2[Service B]
        SVC3[Service C]
    end
    
    APP --&gt;|localhost call| PROXY
    PROXY --&gt; POLICY
    POLICY --&gt; MONITOR
    MONITOR --&gt; SECURITY
    SECURITY --&gt;|network call| SVC1
    SECURITY --&gt;|network call| SVC2
    SECURITY --&gt;|network call| SVC3
</pre><p><strong>핵심 메커니즘</strong>:</p><ul><li><strong>로컬 프록시</strong>: 애플리케이션이 localhost를 통해 Ambassador에 연결</li><li><strong>정책 엔진</strong>: 라우팅, 재시도, 회로 차단기 등의 정책 적용</li><li><strong>모니터링 계층</strong>: 요청/응답에 대한 메트릭 수집 및 로깅</li><li><strong>보안 계층</strong>: 인증, 암호화, 권한 검증 수행</li></ul><hr><h2 id=iii-구현-및-적용>III. 구현 및 적용<a hidden class=anchor aria-hidden=true href=#iii-구현-및-적용>#</a></h2><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p>Ambassador Pattern의 전체 아키텍처는 다음과 같은 구성 요소들로 이루어집니다:</p><pre class=mermaid>graph TB
    subgraph &#34;Client Host&#34;
        subgraph &#34;Application Layer&#34;
            APP[Client Application]
            CONF[Configuration]
        end
        
        subgraph &#34;Ambassador Layer&#34;
            PROXY[Proxy Core]
            ROUTER[Request Router]
            BREAKER[Circuit Breaker]
            RETRY[Retry Handler]
            MONITOR[Metrics Collector]
            LOGGER[Logger]
            SECURITY[Security Handler]
        end
        
        subgraph &#34;Network Layer&#34;
            CONN[Connection Pool]
            TLS[TLS Handler]
        end
    end
    
    subgraph &#34;Remote Services&#34;
        API1[API Service]
        DB[Database]
        CACHE[Cache Service]
    end
    
    APP --&gt; PROXY
    CONF --&gt; ROUTER
    PROXY --&gt; ROUTER
    ROUTER --&gt; BREAKER
    BREAKER --&gt; RETRY
    RETRY --&gt; MONITOR
    MONITOR --&gt; LOGGER
    LOGGER --&gt; SECURITY
    SECURITY --&gt; CONN
    CONN --&gt; TLS
    TLS --&gt; API1
    TLS --&gt; DB
    TLS --&gt; CACHE
</pre><h4 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h4><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>Proxy Core</strong></td><td>요청/응답 중계</td><td>클라이언트와 서비스 간 통신 중재</td><td>고성능 비동기 처리</td></tr><tr><td><strong>Request Router</strong></td><td>요청 라우팅</td><td>적절한 서비스 엔드포인트로 라우팅</td><td>동적 라우팅 규칙 지원</td></tr><tr><td><strong>Connection Pool</strong></td><td>연결 관리</td><td>외부 서비스와의 연결 풀 관리</td><td>연결 재사용으로 성능 최적화</td></tr><tr><td><strong>Configuration Manager</strong></td><td>설정 관리</td><td>런타임 설정 변경 및 적용</td><td>무중단 설정 업데이트</td></tr></tbody></table><h4 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h4><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>Circuit Breaker</strong></td><td>장애 격리</td><td>실패 서비스에 대한 요청 차단</td><td>자동 복구 메커니즘</td></tr><tr><td><strong>Retry Handler</strong></td><td>재시도 처리</td><td>실패 요청의 자동 재시도</td><td>지수 백오프 지원</td></tr><tr><td><strong>Metrics Collector</strong></td><td>메트릭 수집</td><td>성능 지표 및 상태 정보 수집</td><td>실시간 모니터링</td></tr><tr><td><strong>Security Handler</strong></td><td>보안 처리</td><td>인증, 암호화, 권한 검증</td><td>다중 보안 정책 지원</td></tr><tr><td><strong>Cache Manager</strong></td><td>캐싱</td><td>응답 캐싱으로 성능 향상</td><td>TTL 기반 캐시 관리</td></tr><tr><td><strong>Load Balancer</strong></td><td>부하 분산</td><td>여러 서비스 인스턴스 간 부하 분산</td><td>다양한 분산 알고리즘</td></tr></tbody></table><h3 id=구현-기법-1>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법-1>#</a></h3><h4 id=1-사이드카-컨테이너-구현>1. 사이드카 컨테이너 구현<a hidden class=anchor aria-hidden=true href=#1-사이드카-컨테이너-구현>#</a></h4><p><strong>정의</strong>: 애플리케이션 컨테이너와 함께 배포되는 보조 컨테이너로 Ambassador 기능 제공</p><p><strong>구성</strong>:</p><ul><li>메인 애플리케이션 컨테이너</li><li>Ambassador 사이드카 컨테이너</li><li>공유 네트워크 네임스페이스</li><li>공유 볼륨 (설정 파일 등)</li></ul><p><strong>목적</strong>: 컨테이너 환경에서 밀접한 결합과 독립적 관리의 균형</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Kubernetes Pod 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-with-ambassador</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>main-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ambassador</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>envoy:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>9901</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/envoy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy-config</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-프록시-기반-구현>2. 프록시 기반 구현<a hidden class=anchor aria-hidden=true href=#2-프록시-기반-구현>#</a></h4><p><strong>정의</strong>: HTTP/TCP 프록시로 Ambassador를 구현하여 요청을 중계</p><p><strong>구성</strong>:</p><ul><li>프록시 서버 (Nginx, HAProxy, Envoy 등)</li><li>라우팅 규칙 설정</li><li>업스트림 서비스 정의</li><li>헬스 체크 메커니즘</li></ul><p><strong>목적</strong>: 네트워크 레벨에서의 투명한 요청 처리</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=c1># Nginx 기반 Ambassador 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>upstream</span> <span class=s>backend_service</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>server</span> <span class=n>service1.example.com</span><span class=p>:</span><span class=mi>8080</span> <span class=s>max_fails=3</span> <span class=s>fail_timeout=30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server</span> <span class=n>service2.example.com</span><span class=p>:</span><span class=mi>8080</span> <span class=s>max_fails=3</span> <span class=s>fail_timeout=30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://backend_service</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_connect_timeout</span> <span class=s>30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_send_timeout</span> <span class=s>30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_read_timeout</span> <span class=s>30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-언어별-라이브러리-구현>3. 언어별 라이브러리 구현<a hidden class=anchor aria-hidden=true href=#3-언어별-라이브러리-구현>#</a></h4><p><strong>정의</strong>: 특정 프로그래밍 언어로 Ambassador 기능을 구현한 라이브러리</p><p><strong>구성</strong>:</p><ul><li>HTTP 클라이언트 래퍼</li><li>설정 관리 모듈</li><li>메트릭 수집 인터페이스</li><li>플러그인 시스템</li></ul><p><strong>목적</strong>: 언어별 최적화와 개발자 친화적 인터페이스 제공</p><p><strong>실제 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>AmbassadorClient</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span> <span class=o>=</span> <span class=n>CircuitBreaker</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>MetricsCollector</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>timer</span><span class=p>(</span><span class=s1>&#39;request_duration&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>call</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_make_request</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>관심사 분리</strong></td><td>비즈니스 로직과 인프라 기능의 명확한 분리로 코드 가독성 향상</td></tr><tr><td>장점</td><td><strong>재사용성</strong></td><td>동일한 Ambassador를 여러 애플리케이션에서 재사용 가능</td></tr><tr><td>장점</td><td><strong>언어 비종속성</strong></td><td>프로그래밍 언어에 관계없이 일관된 기능 제공</td></tr><tr><td>장점</td><td><strong>독립적 업데이트</strong></td><td>애플리케이션 중단 없이 Ambassador 기능 업데이트</td></tr><tr><td>장점</td><td><strong>전문화 지원</strong></td><td>인프라 전담팀이 Ambassador 기능을 전문적으로 관리</td></tr><tr><td>장점</td><td><strong>레거시 통합</strong></td><td>기존 시스템 변경 없이 현대적 기능 추가 가능</td></tr><tr><td>장점</td><td><strong>위치 투명성</strong></td><td>클라이언트가 실제 서비스 위치를 알 필요 없음</td></tr><tr><td>장점</td><td><strong>표준화된 정책</strong></td><td>모든 서비스에 일관된 보안, 모니터링 정책 적용</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>추가 지연시간</strong></td><td>프록시 계층으로 인한 네트워크 지연</td><td>고성능 프록시 사용, 로컬 배치</td></tr><tr><td>단점</td><td><strong>복잡성 증가</strong></td><td>시스템 전체 아키텍처의 복잡도 상승</td><td>명확한 문서화, 자동화 도구 활용</td></tr><tr><td>단점</td><td><strong>단일 장애점</strong></td><td>Ambassador 실패 시 전체 통신 영향</td><td>고가용성 설계, 헬스 체크 강화</td></tr><tr><td>단점</td><td><strong>리소스 오버헤드</strong></td><td>추가 메모리 및 CPU 사용</td><td>리소스 최적화, 효율적인 프록시 선택</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td><strong>메모리 누수</strong></td><td>연결 풀 관리 부족</td><td>시스템 성능 저하</td><td>메모리 모니터링</td><td>적절한 연결 타임아웃 설정</td><td>연결 풀 재시작, 가비지 컬렉션</td></tr><tr><td>문제점</td><td><strong>설정 불일치</strong></td><td>환경별 설정 차이</td><td>서비스 연결 실패</td><td>설정 검증 도구</td><td>중앙화된 설정 관리</td><td>설정 동기화, 검증 프로세스</td></tr><tr><td>문제점</td><td><strong>버전 호환성</strong></td><td>Ambassador와 서비스 버전 불일치</td><td>API 호출 실패</td><td>버전 호환성 테스트</td><td>호환성 매트릭스 관리</td><td>점진적 업그레이드</td></tr></tbody></table><h3 id=도전-과제-1>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제-1>#</a></h3><p>현재 Ambassador Pattern과 관련하여 해결해야 하는 주요 도전 과제들을 카테고리별로 정리하면 다음과 같습니다:</p><h4 id=1-성능-최적화>1. 성능 최적화<a hidden class=anchor aria-hidden=true href=#1-성능-최적화>#</a></h4><ul><li><strong>원인</strong>: 프록시 계층으로 인한 지연시간 증가</li><li><strong>영향</strong>: 응답 시간 요구사항이 엄격한 시스템에서 사용 제한</li><li><strong>해결 방법</strong>: 고성능 프록시 엔진 사용, 캐싱 전략 적용</li></ul><h4 id=2-복잡성-관리>2. 복잡성 관리<a hidden class=anchor aria-hidden=true href=#2-복잡성-관리>#</a></h4><ul><li><strong>원인</strong>: 다중 계층 아키텍처로 인한 복잡도 증가</li><li><strong>영향</strong>: 디버깅과 운영 난이도 상승</li><li><strong>해결 방법</strong>: 관찰성 도구 강화, 자동화된 배포 파이프라인</li></ul><h4 id=3-서비스-메시-통합>3. 서비스 메시 통합<a hidden class=anchor aria-hidden=true href=#3-서비스-메시-통합>#</a></h4><ul><li><strong>원인</strong>: 다양한 서비스 메시 솔루션과의 호환성</li><li><strong>영향</strong>: 기술 스택 선택의 제약</li><li><strong>해결 방법</strong>: 표준화된 인터페이스 정의, 플러그인 아키텍처</li></ul><h4 id=4-보안-강화>4. 보안 강화<a hidden class=anchor aria-hidden=true href=#4-보안-강화>#</a></h4><ul><li><strong>원인</strong>: 중앙화된 보안 처리로 인한 보안 위험 집중</li><li><strong>영향</strong>: 보안 침해 시 광범위한 영향</li><li><strong>해결 방법</strong>: 다층 보안 설계, 제로 트러스트 모델 적용</li></ul><hr><h2 id=iv-실무-적용-및-활용>IV. 실무 적용 및 활용<a hidden class=anchor aria-hidden=true href=#iv-실무-적용-및-활용>#</a></h2><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th><th>특징</th></tr></thead><tbody><tr><td><strong>배치 방식</strong></td><td>사이드카 Ambassador</td><td>애플리케이션과 같은 Pod에 배치</td><td>밀접한 결합, 독립적 관리</td></tr><tr><td>배치 방식</td><td>독립형 Ambassador</td><td>별도 서버/컨테이너에 배치</td><td>여러 애플리케이션 공유 가능</td></tr><tr><td><strong>기능 범위</strong></td><td>연결 전용 Ambassador</td><td>기본적인 프록시 기능만 제공</td><td>단순한 구조, 낮은 오버헤드</td></tr><tr><td>기능 범위</td><td>풀 기능 Ambassador</td><td>보안, 모니터링, 캐싱 등 포함</td><td>포괄적 기능, 높은 복잡도</td></tr><tr><td><strong>프로토콜</strong></td><td>HTTP Ambassador</td><td>HTTP/HTTPS 프로토콜 전용</td><td>웹 서비스에 최적화</td></tr><tr><td>프로토콜</td><td>다중 프로토콜 Ambassador</td><td>HTTP, TCP, gRPC 등 지원</td><td>다양한 서비스 유형 지원</td></tr><tr><td><strong>대상 서비스</strong></td><td>레거시 통합 Ambassador</td><td>기존 시스템 현대화 목적</td><td>점진적 마이그레이션 지원</td></tr><tr><td>대상 서비스</td><td>마이크로서비스 Ambassador</td><td>현대적 서비스 간 통신</td><td>클라우드 네이티브 최적화</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td><strong>레거시 시스템 현대화</strong></td><td>Docker, Kubernetes, Istio</td><td>기존 코드 변경 없이 현대적 기능 추가</td></tr><tr><td><strong>마이크로서비스 통신</strong></td><td>Envoy, Consul, Prometheus</td><td>서비스 간 안전하고 관찰 가능한 통신</td></tr><tr><td><strong>API 게이트웨이</strong></td><td>Kong, Ambassador API Gateway</td><td>중앙화된 API 관리 및 보안</td></tr><tr><td><strong>데이터베이스 프록시</strong></td><td>PgBouncer, ProxySQL</td><td>연결 풀링 및 쿼리 최적화</td></tr><tr><td><strong>캐시 프록시</strong></td><td>Redis, Memcached</td><td>응답 시간 개선 및 부하 감소</td></tr><tr><td><strong>로드 밸런싱</strong></td><td>HAProxy, Nginx</td><td>트래픽 분산 및 고가용성</td></tr><tr><td><strong>보안 프록시</strong></td><td>OAuth2 Proxy, Keycloak</td><td>인증/인가 중앙화</td></tr><tr><td><strong>모니터링 통합</strong></td><td>Jaeger, Zipkin, Grafana</td><td>분산 추적 및 메트릭 수집</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-e-commerce-플랫폼의-레거시-결제-시스템-현대화>사례: E-commerce 플랫폼의 레거시 결제 시스템 현대화<a hidden class=anchor aria-hidden=true href=#사례-e-commerce-플랫폼의-레거시-결제-시스템-현대화>#</a></h4><p><strong>배경</strong>:
기존 결제 시스템이 SOAP 기반으로 구축되어 있었으나, 새로운 마이크로서비스들은 RESTful API를 사용하는 상황에서 Ambassador Pattern을 적용한 사례입니다.</p><p><strong>시스템 구성</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Frontend Services&#34;
        WEB[Web Frontend]
        MOBILE[Mobile App]
        API[API Gateway]
    end
    
    subgraph &#34;Modern Microservices&#34;
        ORDER[Order Service]
        CART[Cart Service]
        USER[User Service]
    end
    
    subgraph &#34;Ambassador Layer&#34;
        AMB[Payment Ambassador]
        CONV[Protocol Converter]
        SEC[Security Handler]
        MON[Monitoring]
    end
    
    subgraph &#34;Legacy Systems&#34;
        PAY[Legacy Payment System]
        BANK[Bank Interface]
    end
    
    WEB --&gt; API
    MOBILE --&gt; API
    API --&gt; ORDER
    ORDER --&gt; CART
    CART --&gt; AMB
    AMB --&gt; CONV
    CONV --&gt; SEC
    SEC --&gt; MON
    MON --&gt; PAY
    PAY --&gt; BANK
</pre><p><strong>활용 워크플로우</strong>:</p><ol><li><strong>요청 수신</strong>: 주문 서비스가 결제 요청을 Ambassador에 전송 (REST API)</li><li><strong>프로토콜 변환</strong>: Ambassador가 REST 요청을 SOAP로 변환</li><li><strong>보안 처리</strong>: 레거시 시스템 요구사항에 맞는 인증 헤더 추가</li><li><strong>요청 전달</strong>: 변환된 SOAP 요청을 레거시 결제 시스템으로 전송</li><li><strong>응답 처리</strong>: SOAP 응답을 REST 형태로 재변환</li><li><strong>모니터링</strong>: 트랜잭션 로그 및 메트릭 수집</li></ol><p><strong>Ambassador의 역할</strong>:</p><ul><li><strong>프로토콜 변환</strong>: REST ↔ SOAP 양방향 변환</li><li><strong>인증 관리</strong>: 레거시 시스템의 복잡한 인증 로직 처리</li><li><strong>에러 처리</strong>: 레거시 시스템의 에러 코드를 현대적 HTTP 상태 코드로 변환</li><li><strong>모니터링</strong>: 결제 트랜잭션의 성공률, 응답 시간 측정</li></ul><p><strong>Ambassador 유무에 따른 차이점</strong>:</p><table><thead><tr><th>측면</th><th>Ambassador 없음</th><th>Ambassador 있음</th></tr></thead><tbody><tr><td><strong>개발 복잡도</strong></td><td>각 서비스가 SOAP 클라이언트 구현 필요</td><td>서비스는 REST API만 사용</td></tr><tr><td><strong>유지보수성</strong></td><td>레거시 변경 시 모든 서비스 수정</td><td>Ambassador만 수정하면 됨</td></tr><tr><td><strong>테스트</strong></td><td>각 서비스별로 SOAP 통합 테스트 필요</td><td>모킹된 REST API로 단위 테스트 가능</td></tr><tr><td><strong>모니터링</strong></td><td>분산된 로깅 및 메트릭</td><td>중앙화된 결제 모니터링</td></tr><tr><td><strong>보안</strong></td><td>각 서비스가 인증 로직 구현</td><td>중앙화된 보안 정책</td></tr></tbody></table><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><p>다음은 Python을 사용한 Ambassador Pattern 구현 예시입니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>  1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>  2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>  3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>  4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>  5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>  6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>  7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>  8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9>  9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10> 10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11> 11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12> 12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13> 13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14> 14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15> 15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16> 16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17> 17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18> 18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19> 19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20> 20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21> 21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22> 22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23> 23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24> 24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25> 25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26> 26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27> 27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28> 28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29> 29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30> 30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31> 31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32> 32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33> 33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34> 34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35> 35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36> 36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37> 37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38> 38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39> 39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40> 40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41> 41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42> 42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43> 43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44> 44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45> 45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46> 46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47> 47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48> 48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49> 49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50> 50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51> 51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52> 52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53> 53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54> 54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55> 55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56> 56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57> 57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58> 58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59> 59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60> 60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61> 61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62> 62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63> 63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64> 64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65> 65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66> 66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67> 67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68> 68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69> 69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70> 70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71> 71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72> 72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73> 73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74> 74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75> 75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76> 76</a>
</span><span class=lnt id=hl-16-77><a class=lnlinks href=#hl-16-77> 77</a>
</span><span class=lnt id=hl-16-78><a class=lnlinks href=#hl-16-78> 78</a>
</span><span class=lnt id=hl-16-79><a class=lnlinks href=#hl-16-79> 79</a>
</span><span class=lnt id=hl-16-80><a class=lnlinks href=#hl-16-80> 80</a>
</span><span class=lnt id=hl-16-81><a class=lnlinks href=#hl-16-81> 81</a>
</span><span class=lnt id=hl-16-82><a class=lnlinks href=#hl-16-82> 82</a>
</span><span class=lnt id=hl-16-83><a class=lnlinks href=#hl-16-83> 83</a>
</span><span class=lnt id=hl-16-84><a class=lnlinks href=#hl-16-84> 84</a>
</span><span class=lnt id=hl-16-85><a class=lnlinks href=#hl-16-85> 85</a>
</span><span class=lnt id=hl-16-86><a class=lnlinks href=#hl-16-86> 86</a>
</span><span class=lnt id=hl-16-87><a class=lnlinks href=#hl-16-87> 87</a>
</span><span class=lnt id=hl-16-88><a class=lnlinks href=#hl-16-88> 88</a>
</span><span class=lnt id=hl-16-89><a class=lnlinks href=#hl-16-89> 89</a>
</span><span class=lnt id=hl-16-90><a class=lnlinks href=#hl-16-90> 90</a>
</span><span class=lnt id=hl-16-91><a class=lnlinks href=#hl-16-91> 91</a>
</span><span class=lnt id=hl-16-92><a class=lnlinks href=#hl-16-92> 92</a>
</span><span class=lnt id=hl-16-93><a class=lnlinks href=#hl-16-93> 93</a>
</span><span class=lnt id=hl-16-94><a class=lnlinks href=#hl-16-94> 94</a>
</span><span class=lnt id=hl-16-95><a class=lnlinks href=#hl-16-95> 95</a>
</span><span class=lnt id=hl-16-96><a class=lnlinks href=#hl-16-96> 96</a>
</span><span class=lnt id=hl-16-97><a class=lnlinks href=#hl-16-97> 97</a>
</span><span class=lnt id=hl-16-98><a class=lnlinks href=#hl-16-98> 98</a>
</span><span class=lnt id=hl-16-99><a class=lnlinks href=#hl-16-99> 99</a>
</span><span class=lnt id=hl-16-100><a class=lnlinks href=#hl-16-100>100</a>
</span><span class=lnt id=hl-16-101><a class=lnlinks href=#hl-16-101>101</a>
</span><span class=lnt id=hl-16-102><a class=lnlinks href=#hl-16-102>102</a>
</span><span class=lnt id=hl-16-103><a class=lnlinks href=#hl-16-103>103</a>
</span><span class=lnt id=hl-16-104><a class=lnlinks href=#hl-16-104>104</a>
</span><span class=lnt id=hl-16-105><a class=lnlinks href=#hl-16-105>105</a>
</span><span class=lnt id=hl-16-106><a class=lnlinks href=#hl-16-106>106</a>
</span><span class=lnt id=hl-16-107><a class=lnlinks href=#hl-16-107>107</a>
</span><span class=lnt id=hl-16-108><a class=lnlinks href=#hl-16-108>108</a>
</span><span class=lnt id=hl-16-109><a class=lnlinks href=#hl-16-109>109</a>
</span><span class=lnt id=hl-16-110><a class=lnlinks href=#hl-16-110>110</a>
</span><span class=lnt id=hl-16-111><a class=lnlinks href=#hl-16-111>111</a>
</span><span class=lnt id=hl-16-112><a class=lnlinks href=#hl-16-112>112</a>
</span><span class=lnt id=hl-16-113><a class=lnlinks href=#hl-16-113>113</a>
</span><span class=lnt id=hl-16-114><a class=lnlinks href=#hl-16-114>114</a>
</span><span class=lnt id=hl-16-115><a class=lnlinks href=#hl-16-115>115</a>
</span><span class=lnt id=hl-16-116><a class=lnlinks href=#hl-16-116>116</a>
</span><span class=lnt id=hl-16-117><a class=lnlinks href=#hl-16-117>117</a>
</span><span class=lnt id=hl-16-118><a class=lnlinks href=#hl-16-118>118</a>
</span><span class=lnt id=hl-16-119><a class=lnlinks href=#hl-16-119>119</a>
</span><span class=lnt id=hl-16-120><a class=lnlinks href=#hl-16-120>120</a>
</span><span class=lnt id=hl-16-121><a class=lnlinks href=#hl-16-121>121</a>
</span><span class=lnt id=hl-16-122><a class=lnlinks href=#hl-16-122>122</a>
</span><span class=lnt id=hl-16-123><a class=lnlinks href=#hl-16-123>123</a>
</span><span class=lnt id=hl-16-124><a class=lnlinks href=#hl-16-124>124</a>
</span><span class=lnt id=hl-16-125><a class=lnlinks href=#hl-16-125>125</a>
</span><span class=lnt id=hl-16-126><a class=lnlinks href=#hl-16-126>126</a>
</span><span class=lnt id=hl-16-127><a class=lnlinks href=#hl-16-127>127</a>
</span><span class=lnt id=hl-16-128><a class=lnlinks href=#hl-16-128>128</a>
</span><span class=lnt id=hl-16-129><a class=lnlinks href=#hl-16-129>129</a>
</span><span class=lnt id=hl-16-130><a class=lnlinks href=#hl-16-130>130</a>
</span><span class=lnt id=hl-16-131><a class=lnlinks href=#hl-16-131>131</a>
</span><span class=lnt id=hl-16-132><a class=lnlinks href=#hl-16-132>132</a>
</span><span class=lnt id=hl-16-133><a class=lnlinks href=#hl-16-133>133</a>
</span><span class=lnt id=hl-16-134><a class=lnlinks href=#hl-16-134>134</a>
</span><span class=lnt id=hl-16-135><a class=lnlinks href=#hl-16-135>135</a>
</span><span class=lnt id=hl-16-136><a class=lnlinks href=#hl-16-136>136</a>
</span><span class=lnt id=hl-16-137><a class=lnlinks href=#hl-16-137>137</a>
</span><span class=lnt id=hl-16-138><a class=lnlinks href=#hl-16-138>138</a>
</span><span class=lnt id=hl-16-139><a class=lnlinks href=#hl-16-139>139</a>
</span><span class=lnt id=hl-16-140><a class=lnlinks href=#hl-16-140>140</a>
</span><span class=lnt id=hl-16-141><a class=lnlinks href=#hl-16-141>141</a>
</span><span class=lnt id=hl-16-142><a class=lnlinks href=#hl-16-142>142</a>
</span><span class=lnt id=hl-16-143><a class=lnlinks href=#hl-16-143>143</a>
</span><span class=lnt id=hl-16-144><a class=lnlinks href=#hl-16-144>144</a>
</span><span class=lnt id=hl-16-145><a class=lnlinks href=#hl-16-145>145</a>
</span><span class=lnt id=hl-16-146><a class=lnlinks href=#hl-16-146>146</a>
</span><span class=lnt id=hl-16-147><a class=lnlinks href=#hl-16-147>147</a>
</span><span class=lnt id=hl-16-148><a class=lnlinks href=#hl-16-148>148</a>
</span><span class=lnt id=hl-16-149><a class=lnlinks href=#hl-16-149>149</a>
</span><span class=lnt id=hl-16-150><a class=lnlinks href=#hl-16-150>150</a>
</span><span class=lnt id=hl-16-151><a class=lnlinks href=#hl-16-151>151</a>
</span><span class=lnt id=hl-16-152><a class=lnlinks href=#hl-16-152>152</a>
</span><span class=lnt id=hl-16-153><a class=lnlinks href=#hl-16-153>153</a>
</span><span class=lnt id=hl-16-154><a class=lnlinks href=#hl-16-154>154</a>
</span><span class=lnt id=hl-16-155><a class=lnlinks href=#hl-16-155>155</a>
</span><span class=lnt id=hl-16-156><a class=lnlinks href=#hl-16-156>156</a>
</span><span class=lnt id=hl-16-157><a class=lnlinks href=#hl-16-157>157</a>
</span><span class=lnt id=hl-16-158><a class=lnlinks href=#hl-16-158>158</a>
</span><span class=lnt id=hl-16-159><a class=lnlinks href=#hl-16-159>159</a>
</span><span class=lnt id=hl-16-160><a class=lnlinks href=#hl-16-160>160</a>
</span><span class=lnt id=hl-16-161><a class=lnlinks href=#hl-16-161>161</a>
</span><span class=lnt id=hl-16-162><a class=lnlinks href=#hl-16-162>162</a>
</span><span class=lnt id=hl-16-163><a class=lnlinks href=#hl-16-163>163</a>
</span><span class=lnt id=hl-16-164><a class=lnlinks href=#hl-16-164>164</a>
</span><span class=lnt id=hl-16-165><a class=lnlinks href=#hl-16-165>165</a>
</span><span class=lnt id=hl-16-166><a class=lnlinks href=#hl-16-166>166</a>
</span><span class=lnt id=hl-16-167><a class=lnlinks href=#hl-16-167>167</a>
</span><span class=lnt id=hl-16-168><a class=lnlinks href=#hl-16-168>168</a>
</span><span class=lnt id=hl-16-169><a class=lnlinks href=#hl-16-169>169</a>
</span><span class=lnt id=hl-16-170><a class=lnlinks href=#hl-16-170>170</a>
</span><span class=lnt id=hl-16-171><a class=lnlinks href=#hl-16-171>171</a>
</span><span class=lnt id=hl-16-172><a class=lnlinks href=#hl-16-172>172</a>
</span><span class=lnt id=hl-16-173><a class=lnlinks href=#hl-16-173>173</a>
</span><span class=lnt id=hl-16-174><a class=lnlinks href=#hl-16-174>174</a>
</span><span class=lnt id=hl-16-175><a class=lnlinks href=#hl-16-175>175</a>
</span><span class=lnt id=hl-16-176><a class=lnlinks href=#hl-16-176>176</a>
</span><span class=lnt id=hl-16-177><a class=lnlinks href=#hl-16-177>177</a>
</span><span class=lnt id=hl-16-178><a class=lnlinks href=#hl-16-178>178</a>
</span><span class=lnt id=hl-16-179><a class=lnlinks href=#hl-16-179>179</a>
</span><span class=lnt id=hl-16-180><a class=lnlinks href=#hl-16-180>180</a>
</span><span class=lnt id=hl-16-181><a class=lnlinks href=#hl-16-181>181</a>
</span><span class=lnt id=hl-16-182><a class=lnlinks href=#hl-16-182>182</a>
</span><span class=lnt id=hl-16-183><a class=lnlinks href=#hl-16-183>183</a>
</span><span class=lnt id=hl-16-184><a class=lnlinks href=#hl-16-184>184</a>
</span><span class=lnt id=hl-16-185><a class=lnlinks href=#hl-16-185>185</a>
</span><span class=lnt id=hl-16-186><a class=lnlinks href=#hl-16-186>186</a>
</span><span class=lnt id=hl-16-187><a class=lnlinks href=#hl-16-187>187</a>
</span><span class=lnt id=hl-16-188><a class=lnlinks href=#hl-16-188>188</a>
</span><span class=lnt id=hl-16-189><a class=lnlinks href=#hl-16-189>189</a>
</span><span class=lnt id=hl-16-190><a class=lnlinks href=#hl-16-190>190</a>
</span><span class=lnt id=hl-16-191><a class=lnlinks href=#hl-16-191>191</a>
</span><span class=lnt id=hl-16-192><a class=lnlinks href=#hl-16-192>192</a>
</span><span class=lnt id=hl-16-193><a class=lnlinks href=#hl-16-193>193</a>
</span><span class=lnt id=hl-16-194><a class=lnlinks href=#hl-16-194>194</a>
</span><span class=lnt id=hl-16-195><a class=lnlinks href=#hl-16-195>195</a>
</span><span class=lnt id=hl-16-196><a class=lnlinks href=#hl-16-196>196</a>
</span><span class=lnt id=hl-16-197><a class=lnlinks href=#hl-16-197>197</a>
</span><span class=lnt id=hl-16-198><a class=lnlinks href=#hl-16-198>198</a>
</span><span class=lnt id=hl-16-199><a class=lnlinks href=#hl-16-199>199</a>
</span><span class=lnt id=hl-16-200><a class=lnlinks href=#hl-16-200>200</a>
</span><span class=lnt id=hl-16-201><a class=lnlinks href=#hl-16-201>201</a>
</span><span class=lnt id=hl-16-202><a class=lnlinks href=#hl-16-202>202</a>
</span><span class=lnt id=hl-16-203><a class=lnlinks href=#hl-16-203>203</a>
</span><span class=lnt id=hl-16-204><a class=lnlinks href=#hl-16-204>204</a>
</span><span class=lnt id=hl-16-205><a class=lnlinks href=#hl-16-205>205</a>
</span><span class=lnt id=hl-16-206><a class=lnlinks href=#hl-16-206>206</a>
</span><span class=lnt id=hl-16-207><a class=lnlinks href=#hl-16-207>207</a>
</span><span class=lnt id=hl-16-208><a class=lnlinks href=#hl-16-208>208</a>
</span><span class=lnt id=hl-16-209><a class=lnlinks href=#hl-16-209>209</a>
</span><span class=lnt id=hl-16-210><a class=lnlinks href=#hl-16-210>210</a>
</span><span class=lnt id=hl-16-211><a class=lnlinks href=#hl-16-211>211</a>
</span><span class=lnt id=hl-16-212><a class=lnlinks href=#hl-16-212>212</a>
</span><span class=lnt id=hl-16-213><a class=lnlinks href=#hl-16-213>213</a>
</span><span class=lnt id=hl-16-214><a class=lnlinks href=#hl-16-214>214</a>
</span><span class=lnt id=hl-16-215><a class=lnlinks href=#hl-16-215>215</a>
</span><span class=lnt id=hl-16-216><a class=lnlinks href=#hl-16-216>216</a>
</span><span class=lnt id=hl-16-217><a class=lnlinks href=#hl-16-217>217</a>
</span><span class=lnt id=hl-16-218><a class=lnlinks href=#hl-16-218>218</a>
</span><span class=lnt id=hl-16-219><a class=lnlinks href=#hl-16-219>219</a>
</span><span class=lnt id=hl-16-220><a class=lnlinks href=#hl-16-220>220</a>
</span><span class=lnt id=hl-16-221><a class=lnlinks href=#hl-16-221>221</a>
</span><span class=lnt id=hl-16-222><a class=lnlinks href=#hl-16-222>222</a>
</span><span class=lnt id=hl-16-223><a class=lnlinks href=#hl-16-223>223</a>
</span><span class=lnt id=hl-16-224><a class=lnlinks href=#hl-16-224>224</a>
</span><span class=lnt id=hl-16-225><a class=lnlinks href=#hl-16-225>225</a>
</span><span class=lnt id=hl-16-226><a class=lnlinks href=#hl-16-226>226</a>
</span><span class=lnt id=hl-16-227><a class=lnlinks href=#hl-16-227>227</a>
</span><span class=lnt id=hl-16-228><a class=lnlinks href=#hl-16-228>228</a>
</span><span class=lnt id=hl-16-229><a class=lnlinks href=#hl-16-229>229</a>
</span><span class=lnt id=hl-16-230><a class=lnlinks href=#hl-16-230>230</a>
</span><span class=lnt id=hl-16-231><a class=lnlinks href=#hl-16-231>231</a>
</span><span class=lnt id=hl-16-232><a class=lnlinks href=#hl-16-232>232</a>
</span><span class=lnt id=hl-16-233><a class=lnlinks href=#hl-16-233>233</a>
</span><span class=lnt id=hl-16-234><a class=lnlinks href=#hl-16-234>234</a>
</span><span class=lnt id=hl-16-235><a class=lnlinks href=#hl-16-235>235</a>
</span><span class=lnt id=hl-16-236><a class=lnlinks href=#hl-16-236>236</a>
</span><span class=lnt id=hl-16-237><a class=lnlinks href=#hl-16-237>237</a>
</span><span class=lnt id=hl-16-238><a class=lnlinks href=#hl-16-238>238</a>
</span><span class=lnt id=hl-16-239><a class=lnlinks href=#hl-16-239>239</a>
</span><span class=lnt id=hl-16-240><a class=lnlinks href=#hl-16-240>240</a>
</span><span class=lnt id=hl-16-241><a class=lnlinks href=#hl-16-241>241</a>
</span><span class=lnt id=hl-16-242><a class=lnlinks href=#hl-16-242>242</a>
</span><span class=lnt id=hl-16-243><a class=lnlinks href=#hl-16-243>243</a>
</span><span class=lnt id=hl-16-244><a class=lnlinks href=#hl-16-244>244</a>
</span><span class=lnt id=hl-16-245><a class=lnlinks href=#hl-16-245>245</a>
</span><span class=lnt id=hl-16-246><a class=lnlinks href=#hl-16-246>246</a>
</span><span class=lnt id=hl-16-247><a class=lnlinks href=#hl-16-247>247</a>
</span><span class=lnt id=hl-16-248><a class=lnlinks href=#hl-16-248>248</a>
</span><span class=lnt id=hl-16-249><a class=lnlinks href=#hl-16-249>249</a>
</span><span class=lnt id=hl-16-250><a class=lnlinks href=#hl-16-250>250</a>
</span><span class=lnt id=hl-16-251><a class=lnlinks href=#hl-16-251>251</a>
</span><span class=lnt id=hl-16-252><a class=lnlinks href=#hl-16-252>252</a>
</span><span class=lnt id=hl-16-253><a class=lnlinks href=#hl-16-253>253</a>
</span><span class=lnt id=hl-16-254><a class=lnlinks href=#hl-16-254>254</a>
</span><span class=lnt id=hl-16-255><a class=lnlinks href=#hl-16-255>255</a>
</span><span class=lnt id=hl-16-256><a class=lnlinks href=#hl-16-256>256</a>
</span><span class=lnt id=hl-16-257><a class=lnlinks href=#hl-16-257>257</a>
</span><span class=lnt id=hl-16-258><a class=lnlinks href=#hl-16-258>258</a>
</span><span class=lnt id=hl-16-259><a class=lnlinks href=#hl-16-259>259</a>
</span><span class=lnt id=hl-16-260><a class=lnlinks href=#hl-16-260>260</a>
</span><span class=lnt id=hl-16-261><a class=lnlinks href=#hl-16-261>261</a>
</span><span class=lnt id=hl-16-262><a class=lnlinks href=#hl-16-262>262</a>
</span><span class=lnt id=hl-16-263><a class=lnlinks href=#hl-16-263>263</a>
</span><span class=lnt id=hl-16-264><a class=lnlinks href=#hl-16-264>264</a>
</span><span class=lnt id=hl-16-265><a class=lnlinks href=#hl-16-265>265</a>
</span><span class=lnt id=hl-16-266><a class=lnlinks href=#hl-16-266>266</a>
</span><span class=lnt id=hl-16-267><a class=lnlinks href=#hl-16-267>267</a>
</span><span class=lnt id=hl-16-268><a class=lnlinks href=#hl-16-268>268</a>
</span><span class=lnt id=hl-16-269><a class=lnlinks href=#hl-16-269>269</a>
</span><span class=lnt id=hl-16-270><a class=lnlinks href=#hl-16-270>270</a>
</span><span class=lnt id=hl-16-271><a class=lnlinks href=#hl-16-271>271</a>
</span><span class=lnt id=hl-16-272><a class=lnlinks href=#hl-16-272>272</a>
</span><span class=lnt id=hl-16-273><a class=lnlinks href=#hl-16-273>273</a>
</span><span class=lnt id=hl-16-274><a class=lnlinks href=#hl-16-274>274</a>
</span><span class=lnt id=hl-16-275><a class=lnlinks href=#hl-16-275>275</a>
</span><span class=lnt id=hl-16-276><a class=lnlinks href=#hl-16-276>276</a>
</span><span class=lnt id=hl-16-277><a class=lnlinks href=#hl-16-277>277</a>
</span><span class=lnt id=hl-16-278><a class=lnlinks href=#hl-16-278>278</a>
</span><span class=lnt id=hl-16-279><a class=lnlinks href=#hl-16-279>279</a>
</span><span class=lnt id=hl-16-280><a class=lnlinks href=#hl-16-280>280</a>
</span><span class=lnt id=hl-16-281><a class=lnlinks href=#hl-16-281>281</a>
</span><span class=lnt id=hl-16-282><a class=lnlinks href=#hl-16-282>282</a>
</span><span class=lnt id=hl-16-283><a class=lnlinks href=#hl-16-283>283</a>
</span><span class=lnt id=hl-16-284><a class=lnlinks href=#hl-16-284>284</a>
</span><span class=lnt id=hl-16-285><a class=lnlinks href=#hl-16-285>285</a>
</span><span class=lnt id=hl-16-286><a class=lnlinks href=#hl-16-286>286</a>
</span><span class=lnt id=hl-16-287><a class=lnlinks href=#hl-16-287>287</a>
</span><span class=lnt id=hl-16-288><a class=lnlinks href=#hl-16-288>288</a>
</span><span class=lnt id=hl-16-289><a class=lnlinks href=#hl-16-289>289</a>
</span><span class=lnt id=hl-16-290><a class=lnlinks href=#hl-16-290>290</a>
</span><span class=lnt id=hl-16-291><a class=lnlinks href=#hl-16-291>291</a>
</span><span class=lnt id=hl-16-292><a class=lnlinks href=#hl-16-292>292</a>
</span><span class=lnt id=hl-16-293><a class=lnlinks href=#hl-16-293>293</a>
</span><span class=lnt id=hl-16-294><a class=lnlinks href=#hl-16-294>294</a>
</span><span class=lnt id=hl-16-295><a class=lnlinks href=#hl-16-295>295</a>
</span><span class=lnt id=hl-16-296><a class=lnlinks href=#hl-16-296>296</a>
</span><span class=lnt id=hl-16-297><a class=lnlinks href=#hl-16-297>297</a>
</span><span class=lnt id=hl-16-298><a class=lnlinks href=#hl-16-298>298</a>
</span><span class=lnt id=hl-16-299><a class=lnlinks href=#hl-16-299>299</a>
</span><span class=lnt id=hl-16-300><a class=lnlinks href=#hl-16-300>300</a>
</span><span class=lnt id=hl-16-301><a class=lnlinks href=#hl-16-301>301</a>
</span><span class=lnt id=hl-16-302><a class=lnlinks href=#hl-16-302>302</a>
</span><span class=lnt id=hl-16-303><a class=lnlinks href=#hl-16-303>303</a>
</span><span class=lnt id=hl-16-304><a class=lnlinks href=#hl-16-304>304</a>
</span><span class=lnt id=hl-16-305><a class=lnlinks href=#hl-16-305>305</a>
</span><span class=lnt id=hl-16-306><a class=lnlinks href=#hl-16-306>306</a>
</span><span class=lnt id=hl-16-307><a class=lnlinks href=#hl-16-307>307</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aiohttp</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 설정 및 상수</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CircuitState</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>CLOSED</span> <span class=o>=</span> <span class=s2>&#34;closed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>OPEN</span> <span class=o>=</span> <span class=s2>&#34;open&#34;</span>  
</span></span><span class=line><span class=cl>    <span class=n>HALF_OPEN</span> <span class=o>=</span> <span class=s2>&#34;half_open&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AmbassadorConfig</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Ambassador 설정 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>target_host</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>target_port</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>30.0</span>
</span></span><span class=line><span class=cl>    <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=n>circuit_breaker_threshold</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=n>circuit_breaker_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_logging</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_metrics</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CircuitBreaker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;회로 차단기 구현&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>threshold</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>threshold</span> <span class=o>=</span> <span class=n>threshold</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>timeout</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>CLOSED</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>can_execute</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;요청 실행 가능 여부 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>CLOSED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>OPEN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>HALF_OPEN</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>  <span class=c1># HALF_OPEN</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_success</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;성공 시 호출&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>CLOSED</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_failure</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실패 시 호출&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>OPEN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MetricsCollector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메트릭 수집기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;requests_total&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;requests_success&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;requests_failed&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;response_times&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;circuit_breaker_trips&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span> <span class=n>response_time</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;요청 메트릭 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;requests_total&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;requests_success&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;requests_failed&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;response_times&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>response_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_circuit_breaker_trip</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;회로 차단기 작동 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;circuit_breaker_trips&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;통계 정보 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>total_requests</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;requests_total&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>total_requests</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>avg_response_time</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;response_times&#39;</span><span class=p>])</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;response_times&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>success_rate</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;requests_success&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>total_requests</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;success_rate_percent&#39;</span><span class=p>:</span> <span class=nb>round</span><span class=p>(</span><span class=n>success_rate</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;average_response_time&#39;</span><span class=p>:</span> <span class=nb>round</span><span class=p>(</span><span class=n>avg_response_time</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentAmbassador</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 서비스를 위한 Ambassador 구현&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>AmbassadorConfig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span> <span class=o>=</span> <span class=n>CircuitBreaker</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>config</span><span class=o>.</span><span class=n>circuit_breaker_threshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>config</span><span class=o>.</span><span class=n>circuit_breaker_timeout</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>MetricsCollector</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>enable_logging</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>disabled</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=fm>__aenter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;비동기 컨텍스트 매니저 진입&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>timeout</span><span class=o>=</span><span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientTimeout</span><span class=p>(</span><span class=n>total</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=fm>__aexit__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_val</span><span class=p>,</span> <span class=n>exc_tb</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;비동기 컨텍스트 매니저 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 요청 처리 (REST → SOAP 변환)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 회로 차단기 확인</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>can_execute</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_circuit_breaker_trip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;Circuit breaker is OPEN, rejecting request&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Service temporarily unavailable&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># REST 요청을 SOAP 형태로 변환</span>
</span></span><span class=line><span class=cl>            <span class=n>soap_payload</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_convert_rest_to_soap</span><span class=p>(</span><span class=n>payment_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 레거시 시스템에 요청 전송</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_send_to_legacy_system</span><span class=p>(</span><span class=n>soap_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># SOAP 응답을 REST 형태로 변환</span>
</span></span><span class=line><span class=cl>            <span class=n>rest_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_convert_soap_to_rest</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 성공 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>response_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>on_success</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>enable_metrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_request</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>response_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment processed successfully in </span><span class=si>{</span><span class=n>response_time</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>rest_response</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 실패 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>response_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>on_failure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>enable_metrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>record_request</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=n>response_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment processing failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_convert_rest_to_soap</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rest_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;REST 데이터를 SOAP 형태로 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>soap_envelope</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span class=line><span class=cl><span class=s2>        &lt;soap:Envelope xmlns:soap=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                       xmlns:pay=&#34;http://legacy.payment.system/payment&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;soap:Header&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;pay:Authentication&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:ApiKey&gt;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_legacy_api_key</span><span class=p>()</span><span class=si>}</span><span class=s2>&lt;/pay:ApiKey&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:Timestamp&gt;</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>&lt;/pay:Timestamp&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;/pay:Authentication&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;/soap:Header&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;soap:Body&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;pay:ProcessPayment&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:Amount&gt;</span><span class=si>{</span><span class=n>rest_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;amount&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/pay:Amount&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:Currency&gt;</span><span class=si>{</span><span class=n>rest_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;currency&#39;</span><span class=p>,</span> <span class=s1>&#39;USD&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/pay:Currency&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:CardNumber&gt;</span><span class=si>{</span><span class=n>rest_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;card_number&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/pay:CardNumber&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:ExpiryDate&gt;</span><span class=si>{</span><span class=n>rest_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;expiry_date&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/pay:ExpiryDate&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:CVV&gt;</span><span class=si>{</span><span class=n>rest_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;cvv&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/pay:CVV&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;pay:MerchantId&gt;</span><span class=si>{</span><span class=n>rest_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;merchant_id&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/pay:MerchantId&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;/pay:ProcessPayment&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;/soap:Body&gt;
</span></span></span><span class=line><span class=cl><span class=s2>        &lt;/soap:Envelope&gt;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>soap_envelope</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_convert_soap_to_rest</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soap_response</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;SOAP 응답을 REST 형태로 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현에서는 XML 파싱 라이브러리 사용</span>
</span></span><span class=line><span class=cl>        <span class=c1># 여기서는 시뮬레이션을 위한 간단한 변환</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;SUCCESS&#34;</span> <span class=ow>in</span> <span class=n>soap_response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;transaction_id&#34;</span><span class=p>:</span> <span class=s2>&#34;TXN_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>100.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;currency&#34;</span><span class=p>:</span> <span class=s2>&#34;USD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;error_code&#34;</span><span class=p>:</span> <span class=s2>&#34;PAYMENT_DECLINED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;error_message&#34;</span><span class=p>:</span> <span class=s2>&#34;Payment was declined&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_send_to_legacy_system</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soap_payload</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;레거시 시스템에 SOAP 요청 전송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;http://</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>target_host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>target_port</span><span class=si>}</span><span class=s2>/payment/soap&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;text/xml; charset=utf-8&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SOAPAction&#39;</span><span class=p>:</span> <span class=s1>&#39;&#34;http://legacy.payment.system/payment/ProcessPayment&#34;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재시도 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>soap_payload</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=k>await</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientResponseError</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>request_info</span><span class=o>=</span><span class=n>response</span><span class=o>.</span><span class=n>request_info</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>history</span><span class=o>=</span><span class=n>response</span><span class=o>.</span><span class=n>history</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>status</span><span class=o>=</span><span class=n>response</span><span class=o>.</span><span class=n>status</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span>
</span></span><span class=line><span class=cl>                <span class=c1># 지수 백오프로 재시도</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Retry attempt </span><span class=si>{</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2> for payment request&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_legacy_api_key</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;레거시 시스템 API 키 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현에서는 보안 저장소에서 가져옴</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;LEGACY_API_KEY_12345&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_health_status</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Ambassador 상태 정보 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;healthy&#34;</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>CircuitState</span><span class=o>.</span><span class=n>CLOSED</span> <span class=k>else</span> <span class=s2>&#34;degraded&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;circuit_breaker_state&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;failure_count&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker</span><span class=o>.</span><span class=n>failure_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;metrics&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>get_stats</span><span class=p>()</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>enable_metrics</span> <span class=k>else</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Ambassador 사용 예시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Ambassador 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>config</span> <span class=o>=</span> <span class=n>AmbassadorConfig</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>target_host</span><span class=o>=</span><span class=s2>&#34;legacy-payment.internal&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>target_port</span><span class=o>=</span><span class=mi>8080</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>timeout</span><span class=o>=</span><span class=mf>30.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_retries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>circuit_breaker_threshold</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>circuit_breaker_timeout</span><span class=o>=</span><span class=mi>60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>enable_logging</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>enable_metrics</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Ambassador 사용</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>PaymentAmbassador</span><span class=p>(</span><span class=n>config</span><span class=p>)</span> <span class=k>as</span> <span class=n>ambassador</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결제 요청 데이터</span>
</span></span><span class=line><span class=cl>        <span class=n>payment_request</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>100.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;currency&#34;</span><span class=p>:</span> <span class=s2>&#34;USD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;card_number&#34;</span><span class=p>:</span> <span class=s2>&#34;4111111111111111&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;expiry_date&#34;</span><span class=p>:</span> <span class=s2>&#34;12/25&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;cvv&#34;</span><span class=p>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;merchant_id&#34;</span><span class=p>:</span> <span class=s2>&#34;MERCHANT_001&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 결제 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>ambassador</span><span class=o>.</span><span class=n>process_payment</span><span class=p>(</span><span class=n>payment_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment result: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>health</span> <span class=o>=</span> <span class=n>ambassador</span><span class=o>.</span><span class=n>get_health_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Ambassador health: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>health</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능</strong></td><td>지연시간 최소화</td><td>프록시 계층으로 인한 추가 지연</td><td>고성능 프록시 엔진 선택, 로컬 배치</td></tr><tr><td><strong>배포</strong></td><td>패키징 전략</td><td>Ambassador와 애플리케이션의 배포 단위</td><td>컨테이너 기반 배포, 사이드카 패턴 활용</td></tr><tr><td><strong>설정</strong></td><td>동적 설정 관리</td><td>런타임 설정 변경 요구사항</td><td>중앙화된 설정 저장소, 핫 리로드 지원</td></tr><tr><td><strong>모니터링</strong></td><td>관찰성 확보</td><td>Ambassador 자체의 모니터링 필요</td><td>메트릭 수집, 분산 추적 구현</td></tr><tr><td><strong>보안</strong></td><td>인증서 관리</td><td>TLS 인증서의 자동 갱신</td><td>cert-manager 등 자동화 도구 활용</td></tr><tr><td><strong>확장성</strong></td><td>수평 확장</td><td>트래픽 증가에 따른 확장 전략</td><td>오토스케일링, 로드 밸런싱 구성</td></tr><tr><td><strong>호환성</strong></td><td>버전 관리</td><td>Ambassador와 서비스 간 버전 호환성</td><td>호환성 매트릭스 관리, 점진적 업그레이드</td></tr><tr><td><strong>복구</strong></td><td>장애 복구</td><td>Ambassador 장애 시 복구 방안</td><td>헬스 체크, 자동 재시작 메커니즘</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능 최적화</strong></td><td>연결 풀링</td><td>외부 서비스와의 연결 재사용</td><td>적절한 풀 크기 설정, 연결 유지 시간 조정</td></tr><tr><td><strong>캐싱 전략</strong></td><td>응답 캐싱</td><td>반복적인 요청에 대한 캐싱</td><td>TTL 기반 캐싱, 캐시 무효화 전략</td></tr><tr><td><strong>리소스 관리</strong></td><td>메모리 최적화</td><td>Ambassador의 메모리 사용량 제어</td><td>메모리 제한 설정, 가비지 컬렉션 튜닝</td></tr><tr><td><strong>네트워크 최적화</strong></td><td>압축 활용</td><td>요청/응답 데이터 압축</td><td>gzip 압축, 브로틀리 압축 적용</td></tr><tr><td><strong>배치 처리</strong></td><td>요청 배칭</td><td>여러 요청을 묶어서 처리</td><td>배치 크기 최적화, 배치 타임아웃 설정</td></tr><tr><td><strong>회로 차단기</strong></td><td>임계값 튜닝</td><td>회로 차단기 파라미터 최적화</td><td>실제 트래픽 패턴 기반 임계값 설정</td></tr><tr><td><strong>로깅 최적화</strong></td><td>구조화된 로깅</td><td>효율적인 로그 처리</td><td>JSON 형태 로깅, 로그 레벨 최적화</td></tr><tr><td><strong>프로파일링</strong></td><td>성능 분석</td><td>정기적인 성능 프로파일링</td><td>APM 도구 활용, 병목 지점 식별</td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>컨테이너 기술</strong></td><td>Kubernetes</td><td>사이드카 패턴</td><td>Pod 내 다중 컨테이너로 Ambassador 구현</td></tr><tr><td><strong>서비스 메시</strong></td><td>Istio</td><td>Envoy 프록시</td><td>Ambassador 패턴을 활용한 서비스 메시 구현</td></tr><tr><td><strong>프록시 기술</strong></td><td>Envoy Proxy</td><td>고성능 프록시</td><td>L7 프록시로 Ambassador 기능 제공</td></tr><tr><td><strong>API 게이트웨이</strong></td><td>Kong</td><td>API 관리</td><td>Ambassador 패턴 기반 API 게이트웨이</td></tr><tr><td><strong>모니터링</strong></td><td>Prometheus</td><td>메트릭 수집</td><td>Ambassador에서 생성되는 메트릭 수집</td></tr><tr><td><strong>추적</strong></td><td>Jaeger</td><td>분산 추적</td><td>Ambassador를 통한 요청 추적</td></tr><tr><td><strong>설정 관리</strong></td><td>Consul</td><td>동적 설정</td><td>Ambassador 설정의 동적 업데이트</td></tr><tr><td><strong>보안</strong></td><td>OAuth2 Proxy</td><td>인증 프록시</td><td>Ambassador를 통한 인증/인가 처리</td></tr><tr><td><strong>데이터베이스</strong></td><td>PgBouncer</td><td>DB 프록시</td><td>데이터베이스 연결을 위한 Ambassador</td></tr><tr><td><strong>캐싱</strong></td><td>Varnish</td><td>HTTP 캐시</td><td>캐싱 기능을 제공하는 Ambassador</td></tr><tr><td><strong>로드 밸런싱</strong></td><td>HAProxy</td><td>L4/L7 밸런싱</td><td>로드 밸런싱 기능의 Ambassador</td></tr><tr><td><strong>레거시 통합</strong></td><td>ESB</td><td>엔터프라이즈 서비스 버스</td><td>레거시 시스템 통합을 위한 Ambassador</td></tr></tbody></table><h3 id=반드시-학습해야-할-내용>반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야-할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>네트워킹</strong></td><td>TCP/IP</td><td>소켓 프로그래밍</td><td>프록시 구현을 위한 네트워크 기초</td></tr><tr><td><strong>프로토콜</strong></td><td>HTTP/HTTPS</td><td>RESTful API</td><td>웹 서비스 통신 프로토콜 이해</td></tr><tr><td><strong>보안</strong></td><td>TLS/SSL</td><td>암호화 통신</td><td>안전한 통신을 위한 암호화 기술</td></tr><tr><td><strong>컨테이너</strong></td><td>Docker</td><td>컨테이너화</td><td>Ambassador의 컨테이너 기반 배포</td></tr><tr><td><strong>오케스트레이션</strong></td><td>Kubernetes</td><td>Pod, Service</td><td>사이드카 패턴 구현을 위한 K8s 개념</td></tr><tr><td><strong>프록시</strong></td><td>Reverse Proxy</td><td>리버스 프록시</td><td>Ambassador의 핵심 동작 원리</td></tr><tr><td><strong>패턴</strong></td><td>Sidecar Pattern</td><td>사이드카 패턴</td><td>Ambassador와 밀접한 관련 패턴</td></tr><tr><td><strong>아키텍처</strong></td><td>Microservices</td><td>마이크로서비스</td><td>Ambassador가 주로 사용되는 아키텍처</td></tr><tr><td><strong>모니터링</strong></td><td>Observability</td><td>관찰성</td><td>시스템 상태 파악을 위한 개념</td></tr><tr><td><strong>성능</strong></td><td>Load Testing</td><td>부하 테스트</td><td>Ambassador 성능 검증 방법</td></tr><tr><td><strong>배포</strong></td><td>CI/CD</td><td>지속적 배포</td><td>Ambassador의 자동화된 배포</td></tr><tr><td><strong>설정</strong></td><td>Configuration Management</td><td>설정 관리</td><td>동적 설정 업데이트 기법</td></tr></tbody></table><hr><h2 id=기타-사항>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항>#</a></h2><h3 id=ambassador-pattern과-관련-패턴-비교>Ambassador Pattern과 관련 패턴 비교<a hidden class=anchor aria-hidden=true href=#ambassador-pattern과-관련-패턴-비교>#</a></h3><p>Ambassador Pattern은 다른 아키텍처 패턴들과 밀접한 관련이 있으며, 특히 다음 패턴들과 함께 사용되거나 비교됩니다:</p><h4 id=1-sidecar-pattern과의-관계>1. Sidecar Pattern과의 관계<a hidden class=anchor aria-hidden=true href=#1-sidecar-pattern과의-관계>#</a></h4><p>Ambassador Pattern은 Sidecar Pattern의 특수한 형태로, 네트워킹에 특화된 사이드카 구현입니다. 모든 Ambassador는 사이드카이지만, 모든 사이드카가 Ambassador는 아닙니다.</p><h4 id=2-proxy-pattern과의-차이점>2. Proxy Pattern과의 차이점<a hidden class=anchor aria-hidden=true href=#2-proxy-pattern과의-차이점>#</a></h4><p>일반적인 Proxy Pattern과 달리 Ambassador는 특별히 외부 서비스와의 통신에 특화되어 있으며, 인프라 관련 기능들을 집중적으로 제공합니다.</p><h4 id=3-api-gateway와의-구별>3. API Gateway와의 구별<a hidden class=anchor aria-hidden=true href=#3-api-gateway와의-구별>#</a></h4><p>API Gateway는 클라이언트와 서비스 사이에 위치하는 반면, Ambassador는 서비스와 외부 종속성 사이에 위치합니다.</p><h3 id=클라우드-네이티브-환경에서의-중요성>클라우드 네이티브 환경에서의 중요성<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-환경에서의-중요성>#</a></h3><p>현대의 클라우드 네이티브 환경에서 Ambassador Pattern은 다음과 같은 이유로 더욱 중요해지고 있습니다:</p><ul><li><strong>마이크로서비스 확산</strong>: 서비스 간 통신의 복잡성 증가</li><li><strong>멀티 클라우드 환경</strong>: 다양한 클라우드 서비스와의 통합 필요</li><li><strong>제로 트러스트 아키텍처</strong>: 모든 통신에 대한 보안 강화 요구</li><li><strong>관찰성 요구사항</strong>: 분산 시스템의 복잡성으로 인한 모니터링 필요성 증대</li></ul><h3 id=미래-발전-방향>미래 발전 방향<a hidden class=anchor aria-hidden=true href=#미래-발전-방향>#</a></h3><p>Ambassador Pattern은 다음과 같은 방향으로 발전하고 있습니다:</p><ul><li><strong>AI/ML 통합</strong>: 지능형 라우팅 및 이상 탐지 기능</li><li><strong>웹어셈블리 활용</strong>: 고성능 필터 및 플러그인 시스템</li><li><strong>서버리스 통합</strong>: FaaS 환경에서의 Ambassador 활용</li><li><strong>엣지 컴퓨팅</strong>: 엣지 환경에서의 경량화된 Ambassador</li></ul><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>패턴</strong></td><td>Sidecar Pattern (사이드카 패턴)</td><td>메인 애플리케이션과 함께 배포되는 보조 컨테이너 패턴</td></tr><tr><td><strong>네트워킹</strong></td><td>Circuit Breaker (회로 차단기)</td><td>실패한 서비스에 대한 요청을 차단하여 시스템 안정성을 보장하는 메커니즘</td></tr><tr><td><strong>프록시</strong></td><td>Reverse Proxy (리버스 프록시)</td><td>클라이언트 대신 서버에 요청을 전달하는 프록시 서버</td></tr><tr><td><strong>컨테이너</strong></td><td>Co-location (공동 위치)</td><td>여러 컨테이너가 동일한 호스트에 배치되는 것</td></tr><tr><td><strong>보안</strong></td><td>TLS Termination (TLS 종료)</td><td>암호화된 연결을 복호화하여 내부 네트워크로 전달하는 과정</td></tr><tr><td><strong>아키텍처</strong></td><td>Out-of-Process (아웃-오브-프로세스)</td><td>메인 애플리케이션과 별도의 프로세스로 실행되는 것</td></tr><tr><td><strong>모니터링</strong></td><td>Observability (관찰성)</td><td>시스템의 내부 상태를 외부에서 관찰할 수 있는 능력</td></tr><tr><td><strong>성능</strong></td><td>Connection Pooling (연결 풀링)</td><td>네트워크 연결을 재사용하여 성능을 향상시키는 기법</td></tr><tr><td><strong>배포</strong></td><td>Service Mesh (서비스 메시)</td><td>마이크로서비스 간 통신을 관리하는 인프라 계층</td></tr><tr><td><strong>패턴</strong></td><td>Cross-cutting Concerns (교차 관심사)</td><td>여러 모듈에 걸쳐 공통으로 적용되는 기능</td></tr><tr><td><strong>네트워킹</strong></td><td>Load Balancing (로드 밸런싱)</td><td>여러 서버에 부하를 분산하는 기술</td></tr><tr><td><strong>보안</strong></td><td>Zero Trust (제로 트러스트)</td><td>모든 네트워크 트래픽을 검증하는 보안 모델</td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/ambassador>Ambassador pattern - Azure Architecture Center</a></li><li><a href=https://dzone.com/articles/design-patterns-for-microservices-ambassador-anti>Design Patterns for Microservices: Ambassador, Anti-Corruption Layer</a></li><li><a href=https://akfpartners.com/growth-blog/ambassador-pattern-description-and-advice-on-usage>Ambassador Pattern: Description and Advice on Usage</a></li><li><a href=https://www.geeksforgeeks.org/ambassador-pattern-in-distributed-systems/>Ambassador Pattern in Distributed Systems - GeeksforGeeks</a></li><li><a href=https://java-design-patterns.com/patterns/ambassador/>Ambassador Pattern in Java: Simplifying Remote Resource Management</a></li><li><a href=https://www.weave.works/blog/kubernetes-patterns-the-ambassador-pattern>Kubernetes Patterns: The Ambassador Pattern</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/sidecar>Sidecar pattern - Azure Architecture Center</a></li><li><a href=https://blog.christianposta.com/microservices/00-microservices-patterns-with-envoy-proxy-series/>Microservices Patterns With Envoy Sidecar Proxy</a></li></ul><hr><p>이 패턴은 마이크로서비스 간의 통신을 단순화하고 관리하는 데 사용된다.</p><p>Ambassador Pattern은 클라이언트와 마이크로서비스 사이에 별도의 서비스(Ambassador)를 두어 통신을 관리하는 디자인 패턴이다.<br>주요 목적은 다음과 같다:</p><ol><li>마이크로서비스 간 통신 복잡성 감소</li><li>서비스의 신뢰성과 확장성 향상</li><li>공통 기능(로깅, 모니터링 등)의 중앙화</li></ol><p><figure><img alt="앰버서더 패턴의 핵심 구성 요소" loading=lazy src=/img/Key-Components-of-the-Ambassador-Pattern.webp><figcaption>Source: https://www.geeksforgeeks.org/ambassador-pattern-in-distributed-systems/</figcaption></figure></p><p>Ambassador Pattern은 마이크로서비스 아키텍처에서 통신 관리, 공통 기능 처리, 레거시 시스템 통합 등 다양한 상황에서 유용하게 활용될 수 있는 디자인 패턴이다.</p><h3 id=장점-1>장점<a hidden class=anchor aria-hidden=true href=#장점-1>#</a></h3><ol><li>복잡성 감소: 마이크로서비스 간 통신 복잡성 감소</li><li>프로토콜 독립성: 다양한 프로토콜 지원 가능</li><li>신뢰성 향상: 장애 처리와 복구 메커니즘 중앙화</li><li>확장성 개선: 개별 서비스의 독립적 확장 용이</li></ol><h3 id=핵심-구성-요소>핵심 구성 요소<a hidden class=anchor aria-hidden=true href=#핵심-구성-요소>#</a></h3><ol><li>애플리케이션 코드: 주요 비즈니스 로직을 처리하는 코어 서비스</li><li>Ambassador: 클라이언트와 원격 서비스 사이의 프록시 역할을 하는 서비스</li><li>원격 서비스: 애플리케이션이 상호작용해야 하는 외부 서비스나 API</li></ol><h3 id=구현-방법>구현 방법<a hidden class=anchor aria-hidden=true href=#구현-방법>#</a></h3><ol><li>API 정의: 클라이언트와 마이크로서비스 간의 통신 프로토콜 정의</li><li>Ambassador 서비스 생성: 통신을 처리할 별도의 서비스 구현</li><li>배포: Ambassador를 별도의 컨테이너나 서버에 배포</li><li>요청 라우팅: Ambassador를 통해 클라이언트 요청을 적절한 마이크로서비스로 라우팅</li></ol><h4 id=구현-시-고려사항>구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#구현-시-고려사항>#</a></h4><p>Ambassador Pattern을 효과적으로 구현하기 위해 고려해야 할 사항들:</p><ol><li>성능 최적화<ul><li>최소한의 지연시간 추가</li><li>효율적인 리소스 사용</li><li>캐싱 전략 수립</li><li>병목 현상 방지</li></ul></li><li>오류 처리<ul><li>장애 격리</li><li>폴백 메커니즘</li><li>우아한 성능 저하</li><li>오류 전파 방지</li></ul></li><li>설정 관리<ul><li>환경별 설정</li><li>동적 설정 변경</li><li>기본값 관리</li><li>설정 검증</li></ul></li></ol><h3 id=주요-기능과-책임>주요 기능과 책임<a hidden class=anchor aria-hidden=true href=#주요-기능과-책임>#</a></h3><p>Ambassador Pattern이 처리하는 주요 cross-cutting concerns는 다음과 같다:</p><ol><li>회복성 관리<ul><li>재시도 메커니즘 구현</li><li>서킷 브레이커 패턴 적용</li><li>타임아웃 관리</li><li>오류 처리 표준화</li></ul></li><li>모니터링과 로깅<ul><li>요청/응답 로깅</li><li>성능 메트릭 수집</li><li>문제 진단 정보 수집</li><li>감사 로그 생성</li></ul></li><li>보안 처리<ul><li>인증 토큰 관리</li><li>API 키 관리</li><li>SSL/TLS 처리</li><li>요청 암호화/복호화</li></ul></li><li>트래픽 관리<ul><li>로드 밸런싱</li><li>속도 제한</li><li>캐싱</li><li>버퍼링</li></ul></li></ol><h3 id=사용-사례>사용 사례<a hidden class=anchor aria-hidden=true href=#사용-사례>#</a></h3><ol><li>서비스 디스커버리: Ambassador가 서비스 레지스트리 역할 수행</li><li>프로토콜 변환: 다양한 프로토콜 간 변환 처리</li><li>로드 밸런싱: 여러 서비스 인스턴스 간 부하 분산</li><li>보안: 인증 및 권한 부여 등 보안 정책 적용</li><li>API 관리: API 게이트웨이 역할 수행, 요청 제한 등 정책 적용</li></ol><h4 id=실제-적용-사례>실제 적용 사례<a hidden class=anchor aria-hidden=true href=#실제-적용-사례>#</a></h4><p>Ambassador Pattern의 일반적인 적용 사례:</p><ol><li>API 게이트웨이<ul><li>외부 API 통신 관리</li><li>요청/응답 변환</li><li>프로토콜 브리징</li><li>보안 처리</li></ul></li><li>서비스 메시<ul><li>서비스 간 통신 관리</li><li>트래픽 제어</li><li>보안 정책 적용</li><li>모니터링 통합</li></ul></li><li>레거시 시스템 통합<ul><li>프로토콜 변환</li><li>데이터 포맷 변환</li><li>호환성 처리</li><li>성능 최적화</li></ul></li></ol><h3 id=실제-예시>실제 예시<a hidden class=anchor aria-hidden=true href=#실제-예시>#</a></h3><p>호텔 컨시어지 서비스를 Ambassador Pattern의 예로 들 수 있다.<br>호텔 투숙객(클라이언트)이 레스토랑 예약, 티켓 예매, 교통편 예약 등을 요청할 때, 컨시어지(Ambassador)가 이러한 외부 서비스와의 상호작용을 대신 처리한다.<br>이를 통해 투숙객은 복잡한 외부 상호작용에 신경 쓰지 않고 서비스를 이용할 수 있다.</p><h4 id=구현-예시-1>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시-1>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>  1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>  2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>  3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>  4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>  5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>  6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>  7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>  8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>  9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10> 10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11> 11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12> 12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13> 13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14> 14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15> 15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16> 16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17> 17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18> 18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19> 19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20> 20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21> 21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22> 22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23> 23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24> 24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25> 25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26> 26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27> 27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28> 28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29> 29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30> 30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31> 31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32> 32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33> 33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34> 34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35> 35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36> 36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37> 37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38> 38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39> 39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40> 40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41> 41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42> 42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43> 43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44> 44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45> 45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46> 46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47> 47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48> 48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49> 49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50> 50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51> 51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52> 52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53> 53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54> 54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55> 55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56> 56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57> 57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58> 58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59> 59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60> 60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61> 61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62> 62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63> 63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64> 64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65> 65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66> 66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67> 67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68> 68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69> 69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70> 70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71> 71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72> 72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73> 73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74> 74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75> 75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76> 76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77> 77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78> 78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79> 79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80> 80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81> 81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82> 82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83> 83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84> 84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85> 85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86> 86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87> 87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88> 88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89> 89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90> 90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91> 91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92> 92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93> 93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94> 94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95> 95</a>
</span><span class=lnt id=hl-17-96><a class=lnlinks href=#hl-17-96> 96</a>
</span><span class=lnt id=hl-17-97><a class=lnlinks href=#hl-17-97> 97</a>
</span><span class=lnt id=hl-17-98><a class=lnlinks href=#hl-17-98> 98</a>
</span><span class=lnt id=hl-17-99><a class=lnlinks href=#hl-17-99> 99</a>
</span><span class=lnt id=hl-17-100><a class=lnlinks href=#hl-17-100>100</a>
</span><span class=lnt id=hl-17-101><a class=lnlinks href=#hl-17-101>101</a>
</span><span class=lnt id=hl-17-102><a class=lnlinks href=#hl-17-102>102</a>
</span><span class=lnt id=hl-17-103><a class=lnlinks href=#hl-17-103>103</a>
</span><span class=lnt id=hl-17-104><a class=lnlinks href=#hl-17-104>104</a>
</span><span class=lnt id=hl-17-105><a class=lnlinks href=#hl-17-105>105</a>
</span><span class=lnt id=hl-17-106><a class=lnlinks href=#hl-17-106>106</a>
</span><span class=lnt id=hl-17-107><a class=lnlinks href=#hl-17-107>107</a>
</span><span class=lnt id=hl-17-108><a class=lnlinks href=#hl-17-108>108</a>
</span><span class=lnt id=hl-17-109><a class=lnlinks href=#hl-17-109>109</a>
</span><span class=lnt id=hl-17-110><a class=lnlinks href=#hl-17-110>110</a>
</span><span class=lnt id=hl-17-111><a class=lnlinks href=#hl-17-111>111</a>
</span><span class=lnt id=hl-17-112><a class=lnlinks href=#hl-17-112>112</a>
</span><span class=lnt id=hl-17-113><a class=lnlinks href=#hl-17-113>113</a>
</span><span class=lnt id=hl-17-114><a class=lnlinks href=#hl-17-114>114</a>
</span><span class=lnt id=hl-17-115><a class=lnlinks href=#hl-17-115>115</a>
</span><span class=lnt id=hl-17-116><a class=lnlinks href=#hl-17-116>116</a>
</span><span class=lnt id=hl-17-117><a class=lnlinks href=#hl-17-117>117</a>
</span><span class=lnt id=hl-17-118><a class=lnlinks href=#hl-17-118>118</a>
</span><span class=lnt id=hl-17-119><a class=lnlinks href=#hl-17-119>119</a>
</span><span class=lnt id=hl-17-120><a class=lnlinks href=#hl-17-120>120</a>
</span><span class=lnt id=hl-17-121><a class=lnlinks href=#hl-17-121>121</a>
</span><span class=lnt id=hl-17-122><a class=lnlinks href=#hl-17-122>122</a>
</span><span class=lnt id=hl-17-123><a class=lnlinks href=#hl-17-123>123</a>
</span><span class=lnt id=hl-17-124><a class=lnlinks href=#hl-17-124>124</a>
</span><span class=lnt id=hl-17-125><a class=lnlinks href=#hl-17-125>125</a>
</span><span class=lnt id=hl-17-126><a class=lnlinks href=#hl-17-126>126</a>
</span><span class=lnt id=hl-17-127><a class=lnlinks href=#hl-17-127>127</a>
</span><span class=lnt id=hl-17-128><a class=lnlinks href=#hl-17-128>128</a>
</span><span class=lnt id=hl-17-129><a class=lnlinks href=#hl-17-129>129</a>
</span><span class=lnt id=hl-17-130><a class=lnlinks href=#hl-17-130>130</a>
</span><span class=lnt id=hl-17-131><a class=lnlinks href=#hl-17-131>131</a>
</span><span class=lnt id=hl-17-132><a class=lnlinks href=#hl-17-132>132</a>
</span><span class=lnt id=hl-17-133><a class=lnlinks href=#hl-17-133>133</a>
</span><span class=lnt id=hl-17-134><a class=lnlinks href=#hl-17-134>134</a>
</span><span class=lnt id=hl-17-135><a class=lnlinks href=#hl-17-135>135</a>
</span><span class=lnt id=hl-17-136><a class=lnlinks href=#hl-17-136>136</a>
</span><span class=lnt id=hl-17-137><a class=lnlinks href=#hl-17-137>137</a>
</span><span class=lnt id=hl-17-138><a class=lnlinks href=#hl-17-138>138</a>
</span><span class=lnt id=hl-17-139><a class=lnlinks href=#hl-17-139>139</a>
</span><span class=lnt id=hl-17-140><a class=lnlinks href=#hl-17-140>140</a>
</span><span class=lnt id=hl-17-141><a class=lnlinks href=#hl-17-141>141</a>
</span><span class=lnt id=hl-17-142><a class=lnlinks href=#hl-17-142>142</a>
</span><span class=lnt id=hl-17-143><a class=lnlinks href=#hl-17-143>143</a>
</span><span class=lnt id=hl-17-144><a class=lnlinks href=#hl-17-144>144</a>
</span><span class=lnt id=hl-17-145><a class=lnlinks href=#hl-17-145>145</a>
</span><span class=lnt id=hl-17-146><a class=lnlinks href=#hl-17-146>146</a>
</span><span class=lnt id=hl-17-147><a class=lnlinks href=#hl-17-147>147</a>
</span><span class=lnt id=hl-17-148><a class=lnlinks href=#hl-17-148>148</a>
</span><span class=lnt id=hl-17-149><a class=lnlinks href=#hl-17-149>149</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>wraps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ServiceAmbassador</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Ambassador 패턴을 구현한 클래스
</span></span></span><span class=line><span class=cl><span class=s2>    외부 서비스와의 통신을 관리하고 다양한 cross-cutting concerns를 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>service_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>service_url</span> <span class=o>=</span> <span class=n>service_url</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>timeout</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker_threshold</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>circuit_open</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>circuit_breaker</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;서킷 브레이커 패턴을 구현한 데코레이터&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_open</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 서킷이 열려있는 경우 복구 시도</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>&gt;</span> <span class=mi>60</span><span class=p>:</span>  <span class=c1># 1분 후 복구 시도</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Attempting circuit recovery&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>circuit_open</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Circuit is open - service unavailable&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 성공 시 실패 카운트 리셋</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실패 임계값 초과 시 서킷 오픈</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>circuit_breaker_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>circuit_open</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;Circuit breaker opened due to multiple failures&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>wrapper</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>retry_mechanism</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재시도 메커니즘을 구현한 데코레이터&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request failed, retrying... (attempt </span><span class=si>{</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span><span class=p>)</span>  <span class=c1># 지수 백오프</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>wrapper</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@circuit_breaker</span>
</span></span><span class=line><span class=cl>    <span class=nd>@retry_mechanism</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>make_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;GET&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=n>data</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;외부 서비스에 요청을 보내는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>service_url</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>endpoint</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>method</span><span class=o>=</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>timeout</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>timeout</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 응답 시간 측정 및 로깅</span>
</span></span><span class=line><span class=cl>            <span class=n>elapsed_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request to </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2> completed in </span><span class=si>{</span><span class=n>elapsed_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 응답 상태 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>Timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request to </span><span class=si>{</span><span class=n>endpoint</span><span class=si>}</span><span class=s2> timed out&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ambassador</span> <span class=o>=</span> <span class=n>ServiceAmbassador</span><span class=p>(</span><span class=s2>&#34;https://payment-api.example.com&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 처리 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>ambassador</span><span class=o>.</span><span class=n>make_request</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>endpoint</span><span class=o>=</span><span class=s2>&#34;process&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>method</span><span class=o>=</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span><span class=o>=</span><span class=n>payment_data</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment processing failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메트릭 수집을 위한 확장</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MetricsCollector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;request_count&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;error_count&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_response_time&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response_time</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;요청 메트릭 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;request_count&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;total_response_time&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>response_time</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;error_count&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 메트릭 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_response_time</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;total_response_time&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;request_count&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;request_count&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;request_count&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;request_count&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;error_rate&#39;</span><span class=p>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;error_count&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;request_count&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;request_count&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;average_response_time&#39;</span><span class=p>:</span> <span class=n>avg_response_time</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h2></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>