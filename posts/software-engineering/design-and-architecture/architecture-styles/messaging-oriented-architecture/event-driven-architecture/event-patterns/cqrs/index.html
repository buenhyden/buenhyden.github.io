<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CQRS | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Patterns,Data-Management-Patterns,CQRS"><meta name=description content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/event-patterns/cqrs/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/event-patterns/cqrs/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/event-patterns/cqrs/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/event-patterns/cqrs/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="CQRS"><meta property="og:description" content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="CQRS"><meta name=twitter:description content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기록하고 기억하고 활용하자.","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":4,"name":"Architecture Styles","item":""},{"@type":"ListItem","position":5,"name":"Messaging-Oriented Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/"},{"@type":"ListItem","position":6,"name":"Event-Driven Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/"},{"@type":"ListItem","position":7,"name":"CQRS","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/event-patterns/cqrs/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기록하고 기억하고 활용하자.</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href>Architecture Styles</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/>Messaging-Oriented Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/messaging-oriented-architecture/event-driven-architecture/>Event-Driven Architecture</a></div><h1>CQRS</h1><div class=post-description>CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다.</div></header><div class=post-content><h2 id=cqrs>CQRS<a hidden class=anchor aria-hidden=true href=#cqrs>#</a></h2><hr><h1 id=cqrs-command-query-responsibility-segregation-심층-분석>CQRS (Command Query Responsibility Segregation) 심층 분석<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-심층-분석>#</a></h1><h2 id=1단계-기본-분석>1단계: 기본 분석<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석>#</a></h2><h3 id=1-대표-태그-생성>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성>#</a></h3><ul><li>CQRS-Pattern</li><li>Event-Driven-Architecture (이벤트 기반 아키텍처)</li><li>Messaging-Oriented-Architecture (메시징 기반 아키텍처)</li><li>Software-Design-Pattern</li></ul><h3 id=2-분류-체계-검증>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증>#</a></h3><p>현재 분류 체계에서 &ldquo;Messaging-Oriented Architecture&rdquo; → &ldquo;Event-Driven Architecture&rdquo; → &ldquo;Event Patterns&rdquo; 아래에 배치된 CQRS는 적합. CQRS는 이벤트 기반 메시징 처리, 데이터 쓰기 및 조회의 분리 구조와 밀접하며, Event Sourcing (이벤트 소싱) 과도 자주 결합되므로 현재 분류 유지가 타당하다.</p><h3 id=3-핵심-요약>3. 핵심 요약<a hidden class=anchor aria-hidden=true href=#3-핵심-요약>#</a></h3><p>CQRS(명령-조회 책임 분리)는 읽기와 쓰기 작업의 데이터 모델을 분리하여, 각 목적에 맞게 독립적으로 최적화함으로써 확장성, 성능, 보안성을 높인다. 복잡한 비즈니스 로직과 대규모 시스템 운영에 적합하다.<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">1</a><a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">3</a></p><h3 id=4-전체-개요>4. 전체 개요<a hidden class=anchor aria-hidden=true href=#4-전체-개요>#</a></h3><p>CQRS는 시스템의 데이터를 조회(Query)와 변경(Command) 작업으로 명확히 분리하며, 각 영역을 별도의 모델과 핸들러로 관리하여 확장성과 유지보수성을 향상시킨다. 전통적인 CRUD(생성, 조회, 수정, 삭제) 모델의 한계를 극복하기 위해 도입되었으며, 이벤트 소싱, 메시지 브로커와 결합 할 경우 실시간 데이터 처리와 복원력, 감사 추적까지 제공 가능하다. 단, 시스템 복잡도와 운영 난이도가 증가할 수 있어, 실제 적용 시 트레이드오프 평가가 필요하다.<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">4</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">1</a></p><hr><h2 id=2단계-핵심-분석>2단계: 핵심 분석<a hidden class=anchor aria-hidden=true href=#2단계-핵심-분석>#</a></h2><h3 id=5-핵심-개념-정리>5. 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리>#</a></h3><ul><li>명령(Command): 시스템의 상태를 변경하는 작업(쓰기).</li><li>조회(Query): 데이터를 조회하는 작업(읽기).</li><li>책임 분리(Responsibility Segregation): Command/Query 기능을 다른 핸들러 및 모델로 분리함.</li><li>독립적 확장(Independent Scalability): 읽기와 쓰기 계층을 물리적으로 분리하여 각각 독립적으로 확장 가능.</li><li>이벤트 소싱(Event Sourcing): 상태 변경을 이벤트로 기록하여 신뢰성 및 변경 이력 관리 극대화.<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">3</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">1</a></li></ul><h3 id=6-실무-연관성-분석>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석>#</a></h3><ul><li>대규모 트래픽 API, 복잡한 주문/재고 관리, 실시간 데이터 조회, 보안·감사 시스템, 이벤트 기반 연동에 탁월.</li><li>도메인별 서비스, 마이크로서비스(Microservices) 아키텍처에 효과적으로 적용되고 실제로 널리 사용된다.<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">5</a></li></ul><hr><h2 id=3단계-상세-조사>3단계: 상세 조사<a hidden class=anchor aria-hidden=true href=#3단계-상세-조사>#</a></h2><h3 id=phase-1-기초-이해>Phase 1: 기초 이해<a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해>#</a></h3><h4 id=개념-정의-및-본질>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질>#</a></h4><ul><li>명령(Command)과 조회(Query) 작업의 책임을 분리하여 각 모델 및 핸들러를 별도 관리하는 소프트웨어 설계 패턴이다.<a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">2</a><a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">4</a></li></ul><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><ul><li>CRUD 기반 데이터 모델의 확장성 및 복잡성 한계, 데이터 읽기/쓰기 요구사항의 비대칭 문제, 이벤트 기반 아키텍처와의 결합 등으로 발전.<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">1</a></li></ul><h4 id=핵심-동기-및-가치-제안>핵심 동기 및 가치 제안<a hidden class=anchor aria-hidden=true href=#핵심-동기-및-가치-제안>#</a></h4><ul><li>높은 읽기/쓰기 부하 대응, 복잡한 비즈니스 로직의 유지관리에 유리, 실시간성/신뢰도/감사성 강화, 이벤트 기반 확장.<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">6</a></li></ul><h4 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h4><ul><li>데이터 조회와 상태 변경의 분리</li><li>각 모델별 최적화</li><li>독립적 확장성 및 유지보수성</li><li>이벤트 소싱과 결합 가능</li><li>복잡한 시스템의 데이터 일관성 및 성능 보장.<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">9</a></li></ul><hr><h3 id=phase-2-핵심-이론>Phase 2: 핵심 이론<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-이론>#</a></h3><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><ul><li>단일 책임 원칙(Single Responsibility Principle) 강화</li><li>비즈니스 규칙, 검증 로직 write 모델에 집중</li><li>데이터 조회 read 모델에 집중(단순화, 최적화)</li></ul><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><pre class=mermaid>graph TD
    User[사용자] --&gt; API
    API --&gt; CommandHandler[명령 핸들러]
    CommandHandler --&gt; WriteDB[쓰기DB]
    API --&gt; QueryHandler[조회 핸들러]
    QueryHandler --&gt; ReadDB[조회DB]
    WriteDB --&gt; EventBus[이벤트 버스]
    EventBus --&gt; ReadDB
</pre><ul><li>사용자는 API를 통해 명령(Command)과 조회(Query)를 분리하여 요청.</li><li>Command는 CommandHandler, WriteDB를 통해 처리, 필요시 이벤트(이벤트 소싱) 발행.</li><li>Query는 QueryHandler, ReadDB를 통해 빠르게 조회.</li></ul><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><table><thead><tr><th>필수 요소</th><th>설명</th></tr></thead><tbody><tr><td>CommandHandler</td><td>명령 요청 처리, 비즈니스 로직</td></tr><tr><td>QueryHandler</td><td>조회 요청 처리, 데이터 반환</td></tr><tr><td>Write Model</td><td>쓰기용 도메인 모델</td></tr><tr><td>Read Model</td><td>읽기용 모델(보통 DTO)</td></tr><tr><td>EventBus</td><td>(선택) 이벤트 발행·구독</td></tr><tr><td>Materialized View</td><td>(선택) 실시간 조회 위한 비정규화된 DB</td></tr><tr><td>API Gateway</td><td>사용자 요청 라우팅</td></tr><tr><td>Message Broker</td><td>(선택) 비동기 메시지 처리</td></tr></tbody></table><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><ul><li>Command: 상태 변경 명령 전달</li><li>Query: 데이터 조회 요청</li><li>이벤트: 상태 변경 이력 처리, 읽기 모델 갱신</li></ul><hr><h3 id=phase-3-특성-분석>Phase 3: 특성 분석<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>읽기/쓰기를 독립적으로 확장</td><td>분리된 모델 및 DB 구조</td></tr><tr><td>장점</td><td>성능</td><td>조회: 빠른 쿼리/쓰기: 일관성 유지</td><td>Materialized View, 이벤트</td></tr><tr><td>장점</td><td>유지보수성</td><td>명령/조회 코드 분리, 팀 분할</td><td>역할 분리, 책임 명확</td></tr><tr><td>장점</td><td>감사 및 복원</td><td>이벤트 기반 변경 이력 추적</td><td>이벤트 소싱, 로그 시스템</td></tr><tr><td>장점</td><td>보안성</td><td>민감한 데이터의 접근 통제</td><td>Write 모델에 권한 집중</td></tr></tbody></table><h4 id=단점-및-문제점-해결방안>단점 및 문제점, 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-문제점-해결방안>#</a></h4><p>단점</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>설계/운영 난이도 증가</td><td>프레임워크 도입, 문서화</td><td>CRUD 패턴</td></tr><tr><td>단점</td><td>데이터 일관성</td><td>읽기 모델의 지연(비동기 갱신)</td><td>이벤트 버퍼, Polling 보완</td><td>Strong Consistency DB</td></tr><tr><td>단점</td><td>테스트 난이도</td><td>커맨드/쿼리 각각 별도 테스트 필요</td><td>시뮬레이션, 양방향 검증</td><td>단일 모델 테스트</td></tr></tbody></table><p>문제점</p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>Race Condition</td><td>비동기 처리 지연</td><td>데이터 불일치</td><td>API 응답 테스트</td><td>캐시 무효화</td><td>Dual-write 검증</td></tr><tr><td>문제점</td><td>결함 감지 어려움</td><td>분리 모델간 동기화 지연</td><td>UI/UX에 즉시 반영 불가</td><td>로그, 이벤트 모니터링</td><td>Read-through 캐시</td><td>Sync Algorithm</td></tr></tbody></table><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><ul><li>일관성(consistency) vs. 확장성(scalability)</li><li>복잡도(complexity) vs. 성능(performance)</li><li>강한 일관성보장 필요시 CQRS 적합도 저하</li></ul><hr><h3 id=phase-4-구현-및-분류>Phase 4: 구현 및 분류<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><ul><li>Command, Query 모델 별도 구현 (Handler, DTO, Repository 분리)</li><li>Event Sourcing(이벤트 소싱) 및 메시지 브로커 결합 예시 증가</li><li>예시: Java(Spring Boot), Python(FastAPI), Node.js 기반 CQRS 프레임워크 활용<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">10</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a></li></ul><h4 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h4><table><thead><tr><th>Type</th><th>조건</th><th>구성 방식</th><th>특징</th><th>예시</th></tr></thead><tbody><tr><td>DB 분리형</td><td>Write/Read DB 분리</td><td>별도 인스턴스</td><td>높은 확장성</td><td>실시간 검색 엔진</td></tr><tr><td>모델 분리형</td><td>내부 모델만 분리</td><td>DB 일원화</td><td>구현 단순화</td><td>단일 RDBMS</td></tr><tr><td>이벤트 소싱형</td><td>이벤트로 스냅샷</td><td>Event Store</td><td>이력관리/감사</td><td>Kafka 기반</td></tr><tr><td>하이브리드형</td><td>일부만 분리</td><td>필요기능만 적용</td><td>제한적 적용</td><td>보수적 도입</td></tr></tbody></table><hr><h3 id=phase-5-실무-적용>Phase 5: 실무 적용<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><ul><li>대형 전자상거래(재고/주문/결제), 금융거래API, IoT(센서데이터 실시간조회), 게임서버(플레이어 상태 관리)<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>13</a></li></ul><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><p><strong>시나리오</strong>: 게시글 등록 및 조회 서비스(도메인별 CQRS 패턴 구현)
<strong>시스템 구성</strong>:</p><ul><li>Board Command Service (게시글 등록/수정/삭제)</li><li>Board Query Service (게시글 조회)</li><li>Message Broker (Kafka 등)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    User[사용자] --&gt; API
    API --&gt; CommandService
    API --&gt; QueryService
    CommandService --&gt; WriteDB
    CommandService --&gt; EventBus[Kafka/EventBus]
    EventBus --&gt; QueryService
    QueryService --&gt; ReadDB
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 게시글 등록 요청(Command)</li><li>CommandService가 처리 후 WriteDB 저장/이벤트 발행</li><li>QueryService가 이벤트를 감지, 게시글 정보 갱신</li><li>사용자는 실시간으로 게시글을 조회(쿼리)</li></ol><p><strong>핵심 역할</strong>: 독립적 읽기/쓰기 구조로 실시간 데이터 일관성 보장</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: DB 트랜잭션 충돌, 조회/쓰기 부하 관리 어려움</li><li>도입 후: 읽기와 쓰기 트래픽 분산, 데이터 확장 및 성능 개선</li></ul><p><strong>구현 예시</strong> (Python)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># commands.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreatePostCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;게시글 생성 명령 객체 - CQRS 패턴의 명령 모델 역할&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>title</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>title</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>content</span> <span class=o>=</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># handlers.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;명령 처리 핸들러 - 게시글 생성 로직 분리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 수행, DB에 저장, 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>save_to_write_db</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>publish_event</span><span class=p>(</span><span class=s2>&#34;PostCreated&#34;</span><span class=p>,</span> <span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># queries.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetPostQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;게시글 조회 쿼리 객체 - CQRS 패턴의 조회 모델 역할&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>post_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>post_id</span> <span class=o>=</span> <span class=n>post_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>QueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;조회 처리 핸들러 - 읽기 전용 DB 또는 캐시 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>fetch_from_read_db</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>post_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h4><p>(위 시나리오와 동일, 실제 대형 쇼핑몰 재고·주문 관리 적용 예시 참고)</p><hr><h3 id=phase-6-운영-및-최적화>Phase 6: 운영 및 최적화<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><ul><li>쓰기 모델 접근 권한 엄격 관리</li><li>읽기 모델은 별도의 permission 또는 익명 공개 허용 가능</li><li>이벤트 기록 기반 컴플라이언스/감사(소명) 목적 활용<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">3</a></li></ul><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><ul><li>이벤트 버스의 처리율, 실패율, 지연 모니터링</li><li>Read/Write DB 각 시스템 성능지표 별도 관리</li><li>로그, 트레이스/메트릭 활용하여 문제 탐지 가능</li></ul><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><table><thead><tr><th>구분</th><th>체크포인트</th><th>권장사항</th></tr></thead><tbody><tr><td>적용</td><td>DB 분리 여부</td><td>성능 요구 불균형시 분리 적극추천</td></tr><tr><td>운영</td><td>이벤트 처리 오류 탐지</td><td>모니터링, 알림 시스템 구축</td></tr><tr><td>테스트</td><td>쿼리·커맨드 동기화 검증</td><td>양방향 검증 자동화</td></tr><tr><td>보안</td><td>권한 관리</td><td>쓰기 모델 우선, ACL 도입</td></tr></tbody></table><h4 id=성능-최적화-전략-및-고려사항>성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략-및-고려사항>#</a></h4><table><thead><tr><th>구분</th><th>전략</th><th>설명</th></tr></thead><tbody><tr><td>확장성</td><td>Read/Write 서비스로 분리 확장</td><td>트래픽 비대칭 시 효과적</td></tr><tr><td>캐싱</td><td>조회 DB에 캐시 적용</td><td>실시간 조회 성능 향상</td></tr><tr><td>이벤트</td><td>이벤트 기반 데이터 동기화</td><td>비동기 처리로 병목 해소</td></tr></tbody></table><hr><h3 id=phase-7-고급-주제>Phase 7: 고급 주제<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><ul><li>실시간 강한 일관성 보장</li><li>복잡한 트랜잭션/결합도 증가</li><li>운영, 테스트 복잡성 증가<a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing - Code Samples">15</a></li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>연계 기술</th><th>표준/프로토콜</th><th>연계 방식</th></tr></thead><tbody><tr><td>이벤트 소싱</td><td>Kafka, RabbitMQ</td><td>이벤트 처리 강화</td></tr><tr><td>Materialized View</td><td>NoSQL, Elasticsearch</td><td>실시간 보기 생성</td></tr><tr><td>마이크로서비스</td><td>REST, gRPC</td><td>서비스 간 CQRS 전파</td></tr></tbody></table><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><ul><li>마이크로서비스 및 서버리스(Serverless) 아키텍처와의 통합 증가</li><li>AI/ML 기반 동적 쿼리/이벤트 처리 도입</li><li>DevOps(데브옵스) 기반 관측성 및 자동화 연계 확대<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>14</a></li></ul><hr><h2 id=4단계-종합-정리>4단계: 종합 정리<a hidden class=anchor aria-hidden=true href=#4단계-종합-정리>#</a></h2><h3 id=최종-정리-및-학습-가이드>최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드>#</a></h3><h4 id=내용-종합>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h4><p>CQRS는 현대 소프트웨어 시스템에서 읽기/쓰기를 분리해 각 목적에 최적화된 처리와 확장성을 달성할 수 있는 강력한 패턴으로, 이벤트 소싱·마이크로서비스·메시지 큐와 결합해 실시간성·복수 트래픽 분산·감사 등 다양한 운영상의 이점을 제공. 하지만 설계·운영의 복잡성, 비동기 데이터 일관성 관리 등 다양한 난제가 존재함.</p><h4 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h4><ol><li>CRUD 모델 한계 및 CQRS 등장배경 이해</li><li>핵심 설계 원칙 및 구성요소 학습</li><li>실제 구현 예제 및 도입 사례 분석</li><li>확장성·보안·관측성 최적 운영 방법 숙지</li><li>최신 기술 트렌드와 융합 기술 탐색</li></ol><h4 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h4><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>CQRS 개념</td><td>필수</td><td>기초 구조 및 목적</td></tr><tr><td>이론</td><td>2</td><td>설계 원칙, 동작 원리</td><td>필수</td><td>시스템 구조와 메커니즘</td></tr><tr><td>특성</td><td>3</td><td>장점/단점 분석</td><td>필수</td><td>트레이드오프와 평가</td></tr><tr><td>구현</td><td>4,5</td><td>적용 예시/실습</td><td>권장</td><td>코드 및 도입 사례 기반 실습</td></tr><tr><td>운영</td><td>6</td><td>최적화, 모니터링</td><td>권장</td><td>실무 운영 고려 요소</td></tr><tr><td>고급</td><td>7</td><td>생태계·트렌드</td><td>선택</td><td>연계 기술, 미래 방향</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td>CQRS (Command Query Responsibility Segregation)</td><td>명령(쓰기)과 조회(읽기) 책임을 분리하는 소프트웨어 설계 패턴</td><td>CQS, Event Sourcing, Read/Write Model</td></tr><tr><td>구현</td><td>Materialized View (실시간 조회용 뷰)</td><td>이벤트 기반으로 구축된 비정규화 데이터 뷰</td><td>CQRS Read Model, NoSQL, 캐싱</td></tr><tr><td>운영</td><td>Event Sourcing (이벤트 소싱)</td><td>모든 상태 변경을 이벤트로 기록하여 데이터 이력 추적, 복구, 감사</td><td>이벤트 버스, 메시지 브로커(Kafka)</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center</a></li><li><a href=https://www.geeksforgeeks.org/cqrs-command-query-responsibility-segregation/>CQRS - Command Query Responsibility Segregation Design Pattern | GeeksForGeeks</a></li><li><a href=https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah>Understanding the CQRS Architecture | LinkedIn</a></li><li><a href=https://www.rootstrap.com/blog/demystifying-cqrs-a-practical-approach---simple-cqrs-part-1>Demystifying CQRS: A Practical Approach – Simple CQRS</a></li><li><a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>Understanding Event Sourcing and CQRS Pattern | mia-platform.eu</a></li><li><a href=https://blog.leaphop.co.kr/blogs/69/CQRS_%ED%8C%A8%ED%84%B4_%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0>CQRS 패턴 알아보기 - TECH BLOG</a></li><li><a href=https://betterprogramming.pub/cqrs-software-architecture-pattern-the-good-the-bad-and-the-ugly-e9d6e7a34daf>CQRS Software Architecture Pattern: The Good, the Bad, and the Ugly</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>A Beginner&rsquo;s Guide to CQRS - Kurrent.io</a></li></ul><p>좋아요. 이전에 CQRS (Command Query Responsibility Segregation) 심층 분석에서 <strong>Phase 1~7까지 모두 정리</strong>했고, 종합 정리·학습 가이드까지 작성했으니, 이제 남은 부분은 **&ldquo;실제 도입 사례의 코드 구현&rdquo;**을 조금 더 확장하고, 그리고 <strong>CQRS + 이벤트 소싱의 통합 예제</strong>를 제공하면서 <strong>운영 시 발생 가능한 고급 최적화 시나리오</strong>까지 이어서 작성하는 것이 좋겠습니다.</p><p>아래에서는 <strong>대형 전자상거래 재고/주문 관리 CQRS+Event Sourcing 기반 구현</strong>을 예시로 합니다.</p><hr><h2 id=실제-도입-사례의-코드-구현-1>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현-1>#</a></h2><p><strong>시나리오</strong>:<br>대형 전자상거래 플랫폼에서 &ldquo;주문(Order)&ldquo;과 &ldquo;재고(Inventory)&ldquo;를 CQRS + Event Sourcing 방식으로 관리.</p><ul><li>사용자가 주문을 생성하면 <strong>Command Service</strong>가 처리하고, 이벤트를 발행합니다.</li><li><strong>Query Service</strong>는 이벤트를 기반으로 읽기용 DB(Materialized View)를 업데이트하여, 실시간 재고 조회 성능을 높입니다.</li></ul><hr><p><strong>시스템 구성</strong>:</p><ul><li><strong>Order Command Service</strong>: 주문 생성/취소 처리</li><li><strong>Order Query Service</strong>: 주문 내역 조회</li><li><strong>Inventory Command Service</strong>: 재고 조정 처리</li><li><strong>Inventory Query Service</strong>: 재고 현황 조회</li><li><strong>Event Store (Kafka, RabbitMQ)</strong>: 이벤트 저장 및 전송</li><li><strong>Read DB (Elasticsearch, Redis)</strong>: 빠른 조회 모델</li></ul><hr><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    User[사용자] --&gt; API[API Gateway]
    API --&gt; OrderCmdSvc[Order Command Service]
    API --&gt; OrderQrySvc[Order Query Service]
    OrderCmdSvc --&gt; WriteDB[(Order WriteDB)]
    OrderCmdSvc --&gt; EventBus[Event Bus (Kafka)]
    EventBus --&gt; OrderQrySvc
    OrderQrySvc --&gt; ReadDB[(Order ReadDB)]
</pre><hr><p><strong>Workflow</strong>:</p><ol><li>사용자가 주문 생성 요청 (Command)</li><li>Order Command Handler가 Write Model에 저장</li><li>주문 생성 이벤트(OrderCreated)를 Event Store에 발행</li><li>Order Query Handler가 이벤트를 소비하여 Read Model 갱신</li><li>사용자가 주문 내역 또는 재고를 실시간 조회 (Query)</li></ol><hr><p><strong>핵심 역할</strong>:</p><ul><li>CQRS: 읽기/쓰기 모델 분리로 대규모 요청 처리 최적화</li><li>Event Sourcing: 주문 변경 이력 추적 및 재연 가능</li><li>Materialized View: 실시간 조회 성능 향상</li></ul><hr><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 단일 DB에서 CRUD 처리, 높은 조회 부하 발생 시 쓰기 지연</li><li><strong>도입 후</strong>: 읽기 트래픽은 Read Model이 처리, 쓰기 성능 안정화, 이벤트 기반 확장 용이</li></ul><hr><p><strong>구현 예시 (Python + Kafka + Redis 등)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46>46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47>47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48>48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49>49</a>
</span><span class=lnt id=hl-4-50><a class=lnlinks href=#hl-4-50>50</a>
</span><span class=lnt id=hl-4-51><a class=lnlinks href=#hl-4-51>51</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># command_models.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreateOrderCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 생성 명령 - CQRS의 Command 역할&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># event_models.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 - Event Sourcing 핵심 역할&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># handlers.py (Command Side)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_create_order</span><span class=p>(</span><span class=n>command</span><span class=p>:</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;명령 처리 -&gt; Write DB 저장 + 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>save_order_to_write_db</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>publish_event_to_kafka</span><span class=p>(</span><span class=s2>&#34;order_created&#34;</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># handlers.py (Query Side)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_order_created_event</span><span class=p>(</span><span class=n>event</span><span class=p>:</span> <span class=n>OrderCreatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 처리 -&gt; Read DB 갱신&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>update_order_in_read_db</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># message_broker.py (Kafka Publisher &amp; Consumer)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>publish_event_to_kafka</span><span class=p>(</span><span class=n>topic</span><span class=p>,</span> <span class=n>event_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>topic</span><span class=p>,</span> <span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consume_order_created_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 수신 후 Query 모델 갱신&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;order_created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=o>**</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>handle_order_created_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=고급-운영-최적화-시나리오>고급 운영 최적화 시나리오<a hidden class=anchor aria-hidden=true href=#고급-운영-최적화-시나리오>#</a></h2><ol><li><strong>실시간 모니터링 강화</strong><ul><li>Kafka Consumer Lag, 이벤트 처리 지연 시간, Read DB 반영 속도를 Prometheus + Grafana로 시각화</li></ul></li><li><strong>이벤트 재처리(Replay) 기능</strong><ul><li>특정 시점으로 Rollback 후 재처리 가능 → 장애 발생 시 복구 속도 향상</li></ul></li><li><strong>CQRS + 캐싱</strong><ul><li>Redis 캐싱 계층을 Query Model 앞단에 두어 초저지연 응답 제공</li></ul></li><li><strong>거래(트랜잭션) 일관성 보완</strong><ul><li>사가 패턴(Saga Pattern)과 결합해 분산 트랜잭션 보장</li></ul></li><li><strong>테스트 전략</strong><ul><li>Command/Query 각각 독립 테스트 + 이벤트 시뮬레이션 테스트 자동화</li></ul></li></ol><hr><p>제가 보기엔 다음 단계로는 <strong>CQRS + Event Sourcing + Saga 패턴 통합 예제</strong>를 만들면, 복잡한 분산 시스템에서도 활용 가능한 <strong>고급 아키텍처 구성이 완성</strong>됩니다.</p><p>네, 앞서 CQRS(명령-조회 책임 분리)와 이벤트 소싱(Event Sourcing) 기반의 대형 전자상거래 주문/재고관리 시스템 예시까지 확장하여 다뤘습니다. 이제 **CQRS + 이벤트 소싱(Event Sourcing) + 사가 패턴(Saga Pattern)**의 통합 고급 아키텍처와 실무 적용 예시를 이어서 단계별로 작성하겠습니다.</p><hr><h2 id=cqrs--이벤트-소싱--사가-패턴-통합-아키텍처-실전-예시>CQRS + 이벤트 소싱 + 사가 패턴 통합 아키텍처 실전 예시<a hidden class=anchor aria-hidden=true href=#cqrs--이벤트-소싱--사가-패턴-통합-아키텍처-실전-예시>#</a></h2><h3 id=시나리오>시나리오<a hidden class=anchor aria-hidden=true href=#시나리오>#</a></h3><p>대형 이커머스에서 <strong>결제와 배송을 포함한 주문 처리 프로세스</strong>를 여러 서비스에 걸친 분산 트랜잭션으로 관리한다.</p><ul><li>주문 생성, 결제 승인, 재고 차감, 배송 예약 등 각 서비스가 CQRS, 이벤트 소싱, 사가 패턴을 조합해 비동기 일관성을 보장한다.</li></ul><hr><h3 id=시스템-구성>시스템 구성<a hidden class=anchor aria-hidden=true href=#시스템-구성>#</a></h3><ul><li>Order Command Service (주문 생성/변경)</li><li>Payment Command Service (결제 처리)</li><li>Inventory Command Service (재고 관리)</li><li>Delivery Command Service (배송 예약)</li><li>Event Bus (Kafka/RabbitMQ 등 이벤트 브로커)</li><li>Saga Coordinator (트랜잭션 조정 및 보상 로직)</li><li>각 서비스별 Read DB (Elasticsearch/Redis 등)</li></ul><hr><h3 id=시스템-구성-다이어그램>시스템 구성 다이어그램<a hidden class=anchor aria-hidden=true href=#시스템-구성-다이어그램>#</a></h3><pre class=mermaid>graph LR
    User[사용자] --&gt; APIGateway[API Gateway]
    APIGateway --&gt; OrderCmdSvc[Order Command Service]
    OrderCmdSvc--&gt;|OrderCreatedEvent|EventBus(Kafka)
    EventBus--&gt;|OrderSagaStart|SagaCoordinator
    SagaCoordinator--&gt;|PaymentCommand|PaymentCmdSvc[Payment Command Service]
    PaymentCmdSvc--&gt;|PaymentApprovedEvent|EventBus
    SagaCoordinator--&gt;|InventoryCommand|InventoryCmdSvc[Inventory Command Service]
    InventoryCmdSvc--&gt;|InventoryReservedEvent|EventBus
    SagaCoordinator--&gt;|DeliveryCommand|DeliveryCmdSvc[Delivery Command Service]
    DeliveryCmdSvc--&gt;|DeliveryScheduledEvent|EventBus
    SagaCoordinator--&gt;|OrderCompletedEvent|EventBus
</pre><hr><h3 id=workflow-단계별-프로세스>Workflow (단계별 프로세스)<a hidden class=anchor aria-hidden=true href=#workflow-단계별-프로세스>#</a></h3><ol><li>사용자 주문 요청(Command)</li><li>Order Command 서비스가 주문 생성 후 <strong>OrderCreatedEvent(주문 생성 이벤트)</strong> 발행</li><li>Saga Coordinator(사가 조정자)가 이벤트 수신, 결제/재고/배송 등 하위 서비스 명령 분산</li><li>각 서비스가 처리 후 <strong>PaymentApprovedEvent(결제 승인 이벤트)</strong>, <strong>InventoryReservedEvent(재고 예약 이벤트)</strong>, <strong>DeliveryScheduledEvent(배송 예약 이벤트)</strong> 등을 이벤트 버스로 발행</li><li>Saga Coordinator가 이벤트 종합 후, 최종적으로 <strong>OrderCompletedEvent(주문 완료 이벤트)</strong> 발행 또는 실패 시 <strong>보상 트랜잭션(Compensation)</strong> 수행</li></ol><hr><h3 id=핵심-역할>핵심 역할<a hidden class=anchor aria-hidden=true href=#핵심-역할>#</a></h3><ul><li><strong>CQRS</strong>: 각 서비스에서 읽기/쓰기를 분리해 확장성 확보</li><li><strong>Event Sourcing (이벤트 소싱)</strong>: 상태 변경을 이벤트로 저장, 장애 복구/이력 추적 가능</li><li><strong>Saga Pattern (사가 패턴)</strong>: 다수 서비스 간 프로세스를 이벤트 기반으로 연결, 실패 시 보상 트랜잭션으로 데이터 일관성 유지</li></ul><hr><h3 id=유무에-따른-차이점>유무에 따른 차이점<a hidden class=anchor aria-hidden=true href=#유무에-따른-차이점>#</a></h3><ul><li><strong>도입 전</strong>: 단일 트랜잭션 실패 시 전체 주문 취소, 장애 복원 어렵고 장애 시 타 서비스 일관성 깨짐</li><li><strong>도입 후</strong>: 서비스별 상태·이력·보상 처리로 분산 트랜잭션 일관성 보장, 장애 복구 용이, 실시간 처리 성능 개선</li></ul><hr><h3 id=구현-예시-python>구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#구현-예시-python>#</a></h3><h4 id=사가-코디네이터-보상-로직-예시-saga-coordinator-compensation-logic>사가 코디네이터 보상 로직 예시 (Saga Coordinator Compensation Logic)<a hidden class=anchor aria-hidden=true href=#사가-코디네이터-보상-로직-예시-saga-coordinator-compensation-logic>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># saga_coordinator.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SagaCoordinator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사가 패턴 중심 주문 트랜잭션 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 결제 서비스 명령 전송</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>publish_command</span><span class=p>(</span><span class=s1>&#39;payment&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;amount&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>amount</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_payment_approved</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재고 서비스 명령 전송</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>publish_command</span><span class=p>(</span><span class=s1>&#39;inventory&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>items</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_inventory_reserved</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 배송 서비스 명령 전송</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>publish_command</span><span class=p>(</span><span class=s1>&#39;delivery&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;address&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>address</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_delivery_scheduled</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;order_completed&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_failure</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stage</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실패 단계에 따라 보상(Compensation) 트랜잭션 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stage</span> <span class=o>==</span> <span class=s1>&#39;payment&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 결제 취소 로직</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>publish_command</span><span class=p>(</span><span class=s1>&#39;payment_compensate&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>stage</span> <span class=o>==</span> <span class=s1>&#39;inventory&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재고 복원 로직</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>publish_command</span><span class=p>(</span><span class=s1>&#39;inventory_compensate&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>stage</span> <span class=o>==</span> <span class=s1>&#39;delivery&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 배송 예약 취소 로직</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>publish_command</span><span class=p>(</span><span class=s1>&#39;delivery_compensate&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>service</span><span class=p>,</span> <span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 각 서비스에 명령 메시지 전달</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>  <span class=c1># 실제 구현은 Kafka/RabbitMQ 등 사용</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 마무리 이벤트 송신 (Kafka 등)</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=이벤트-소비-및-상태-반영-예시-query-side>이벤트 소비 및 상태 반영 예시 (Query Side)<a hidden class=anchor aria-hidden=true href=#이벤트-소비-및-상태-반영-예시-query-side>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6>6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7>7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># event_handler.py</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_order_completed_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 완료 이벤트 수신 후 Read DB 갱신&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>update_order_status_in_read_db</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span> <span class=n>status</span><span class=o>=</span><span class=s1>&#39;COMPLETED&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_payment_approved_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 승인 이벤트 수신 후 Read DB 반영&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>update_payment_status_in_read_db</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span> <span class=n>status</span><span class=o>=</span><span class=s1>&#39;APPROVED&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>각 핸들러마다 CQRS 분리, 이벤트 소비 후 Read DB(Materialized View, 비정규화 DB) 빠른 상태 반영</p></blockquote><hr><h2 id=고급-운영최적화-방안>고급 운영/최적화 방안<a hidden class=anchor aria-hidden=true href=#고급-운영최적화-방안>#</a></h2><h3 id=1-사가-이벤트-모니터링-및-보상-자동화>1. 사가 이벤트 모니터링 및 보상 자동화<a hidden class=anchor aria-hidden=true href=#1-사가-이벤트-모니터링-및-보상-자동화>#</a></h3><ul><li>장애 발생 시 자동 보상 트랜잭션 실행(예: 결제 승인 실패 → 주문 자동 취소)</li><li>Grafana, ELK 등으로 사가 전체 이벤트 상태 실시간 시각화</li></ul><h3 id=2-엔드투엔드-일관성신뢰도-점검>2. 엔드투엔드 일관성/신뢰도 점검<a hidden class=anchor aria-hidden=true href=#2-엔드투엔드-일관성신뢰도-점검>#</a></h3><ul><li>상태별 이벤트 체인 유효성 검증(모든 단계 Success 여부 자동 수집/분석)</li><li>분산 트랜잭션 지연 시간(Business gap) 실시간 추적</li></ul><h3 id=3-운영성-및-관측성-개선>3. 운영성 및 관측성 개선<a hidden class=anchor aria-hidden=true href=#3-운영성-및-관측성-개선>#</a></h3><ul><li>서비스별 실패율, 재시도 횟수, Latency(지연) 메트릭 수집·알림</li><li>Kafka/RabbitMQ 메시지 큐의 Lag(지연 처리량) 상시 모니터링</li></ul><hr><h2 id=최신-트렌드-전망>최신 트렌드 전망<a hidden class=anchor aria-hidden=true href=#최신-트렌드-전망>#</a></h2><ul><li><strong>Kafka와 CQRS/사가 연계</strong>: 대규모 이벤트 기반 시스템에서 표준화</li><li><strong>서버리스(Serverless) 사가</strong>: AWS Step Functions, Azure Durable Functions 등 클라우드 네이티브 환경에서 이벤트 지향 트랜잭션 구현 확산</li><li><strong>AI 기반 장애 예측</strong>: 이벤트 패턴/사용자 행위 분석으로 장애 사전 탐지 가능</li></ul><hr><p>계속해서 CQRS(명령-조회 책임 분리), 이벤트 소싱(Event Sourcing), 사가 패턴(Saga Pattern) 통합 기반 대형 이커머스 시스템의 <strong>실전 코드 구조와 운영 최적화 관점</strong>을 한 단계 더 심도 있게 풀어볼게요.</p><hr><h2 id=서비스별결제-재고-배송-cqrsevent-sourcing-샘플-코드>서비스별(결제, 재고, 배송) CQRS+Event Sourcing 샘플 코드<a hidden class=anchor aria-hidden=true href=#서비스별결제-재고-배송-cqrsevent-sourcing-샘플-코드>#</a></h2><h3 id=1-결제-서비스-payment-commandquery>1. 결제 서비스 (Payment Command/Query)<a hidden class=anchor aria-hidden=true href=#1-결제-서비스-payment-commandquery>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># payment_command.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ApprovePaymentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 승인 명령 - CQRS 명령 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>amount</span> <span class=o>=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payment_handler.py</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_approve_payment</span><span class=p>(</span><span class=n>command</span><span class=p>:</span> <span class=n>ApprovePaymentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 승인 처리 - 결제 DB 업데이트 + 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>save_payment_to_db</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payment_event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;APPROVED&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>publish_event</span><span class=p>(</span><span class=s2>&#34;payment_approved&#34;</span><span class=p>,</span> <span class=n>payment_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payment_query.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetPaymentStatusQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 상태 조회 쿼리 - CQRS 조회 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_get_payment_status</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=n>GetPaymentStatusQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 상태 조회 실행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fetch_payment_status_from_read_db</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>order_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=2-재고-서비스-inventory-commandquery>2. 재고 서비스 (Inventory Command/Query)<a hidden class=anchor aria-hidden=true href=#2-재고-서비스-inventory-commandquery>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># inventory_command.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ReserveInventoryCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재고 예약 명령 - CQRS 명령 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_reserve_inventory</span><span class=p>(</span><span class=n>command</span><span class=p>:</span> <span class=n>ReserveInventoryCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재고 예약 처리 - 재고 DB 업데이트 + 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>update_inventory_count</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>],</span> <span class=o>-</span><span class=n>item</span><span class=p>[</span><span class=s2>&#34;quantity&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>inventory_event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;RESERVED&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>publish_event</span><span class=p>(</span><span class=s2>&#34;inventory_reserved&#34;</span><span class=p>,</span> <span class=n>inventory_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># inventory_query.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetInventoryStatusQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재고 상태 조회 쿼리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_id</span> <span class=o>=</span> <span class=n>product_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_get_inventory_status</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=n>GetInventoryStatusQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;조회 DB에서 재고 상태 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fetch_inventory_status_from_read_db</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>product_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=3-배송-서비스-delivery-commandquery>3. 배송 서비스 (Delivery Command/Query)<a hidden class=anchor aria-hidden=true href=#3-배송-서비스-delivery-commandquery>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># delivery_command.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ScheduleDeliveryCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;배송 예약 명령 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>address</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_schedule_delivery</span><span class=p>(</span><span class=n>command</span><span class=p>:</span> <span class=n>ScheduleDeliveryCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;배송 예약 처리 - 배송 DB 기록 + 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>save_delivery_schedule_to_db</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>delivery_event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;SCHEDULED&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>publish_event</span><span class=p>(</span><span class=s2>&#34;delivery_scheduled&#34;</span><span class=p>,</span> <span class=n>delivery_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># delivery_query.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetDeliveryStatusQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;배송 상태 조회 쿼리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_get_delivery_status</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=n>GetDeliveryStatusQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;조회 DB에서 배송 상태 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fetch_delivery_status_from_read_db</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>order_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=사가-패턴의-통합-처리-event-flow-설명>사가 패턴의 통합 처리 Event Flow 설명<a hidden class=anchor aria-hidden=true href=#사가-패턴의-통합-처리-event-flow-설명>#</a></h2><ol><li><p><strong>OrderCreatedEvent</strong>가 발생하면<br>→ Saga Coordinator(사가 조정자)가 <strong>ApprovePaymentCommand</strong>를 결제 서비스로 전송</p></li><li><p>결제 성공(PaymentApprovedEvent)<br>→ Saga Coordinator가 <strong>ReserveInventoryCommand</strong>를 재고 서비스로 전송</p></li><li><p>재고 성공(InventoryReservedEvent)<br>→ Saga Coordinator가 <strong>ScheduleDeliveryCommand</strong>를 배송 서비스로 전송</p></li><li><p>모든 단계가 Success일 때<br>→ Saga Coordinator가 <strong>OrderCompletedEvent</strong>를 발행<br>→ 모든 서비스 Read DB에 최종 상태 반영</p></li><li><p>단계별 실패 시(예: 결제 승인 실패)<br>→ Saga Coordinator가 보상 명령(PaymentCompensationCommand 등)을 발행<br>→ 이전 단계 변경분을 Rollback, 전체 주문 취소 이벤트(OrderCancelledEvent) 발행</p></li></ol><hr><h2 id=실무-운영-최적화-전략--관측성observability-설계>실무 운영 최적화 전략 & 관측성(Observability) 설계<a hidden class=anchor aria-hidden=true href=#실무-운영-최적화-전략--관측성observability-설계>#</a></h2><table><thead><tr><th>구분</th><th>체크포인트</th><th>권장 방안</th></tr></thead><tbody><tr><td>이벤트 프로세스</td><td>메시지 지연, 실패율 모니터링</td><td>Kafka Lag, Dead Letter Queue 모니터링, 자동 알람</td></tr><tr><td>데이터 일관성</td><td>Read/Write 모델 동기화 여부</td><td>이벤트 소비/생산율 메트릭 도입, Polling 보완</td></tr><tr><td>장애 복원력</td><td>이벤트 Replay/보상 트랜잭션</td><td>이벤트 Store에서 재처리 API 및 UI 구축</td></tr><tr><td>엔드 투 엔드 시나리오</td><td>전체 워크플로우 상태 추적</td><td>각 단계별 상태를 로그/메트릭/대시보드로 시각화</td></tr><tr><td>성능</td><td>트래픽 분산 및 캐싱</td><td>Redis/Elasticsearch 캐시 적용, Horizontal Scaling 구현</td></tr></tbody></table><hr><h2 id=정리>정리<a hidden class=anchor aria-hidden=true href=#정리>#</a></h2><ul><li>CQRS, 이벤트 소싱, 사가 패턴을 결합하면 <strong>실시간 분산 처리와 강한 일관성, 장애 복원력, 확장성</strong>을 모두 확보할 수 있음</li><li>서비스별 명령/조회 모델 구조와 이벤트, 사가 보상 로직이 시스템 전체의 책임 분산과 운영 감시를 가능하게 함</li><li>이벤트 기반 시스템에서는 <strong>모니터링/장애 복원/데이터 일관성 유지</strong> 프로세스의 자동화 및 가시화가 필수적</li></ul><hr><p>좋아요, 이번에는 이전까지 우리가 설계한 <strong>CQRS (Command Query Responsibility Segregation) + 이벤트 소싱(Event Sourcing) + 사가 패턴(Saga Pattern)</strong> 기반 아키텍처를 <strong>클라우드/컨테이너 환경에서 실제 배포하는 구조와 장애 복구(Failover & Recovery) 시나리오</strong>까지 확장해서 정리해보겠습니다.</p><hr><h2 id=1-클라우드컨테이너-배포-아키텍처>1. 클라우드/컨테이너 배포 아키텍처<a hidden class=anchor aria-hidden=true href=#1-클라우드컨테이너-배포-아키텍처>#</a></h2><h3 id=구성-요소별-배포-단위>구성 요소별 배포 단위<a hidden class=anchor aria-hidden=true href=#구성-요소별-배포-단위>#</a></h3><table><thead><tr><th>서비스</th><th>배포 형태</th><th>비고</th></tr></thead><tbody><tr><td>Order / Payment / Inventory / Delivery Command Service</td><td>개별 마이크로서비스(Microservice)</td><td>Docker 이미지로 배포</td></tr><tr><td>Query Service들</td><td>개별 마이크로서비스</td><td>Read DB 및 캐시 연동</td></tr><tr><td>Event Bus (Kafka / RabbitMQ)</td><td>StatefulSet 또는 Managed Service</td><td>고가용성(HA) 구성</td></tr><tr><td>Saga Coordinator</td><td>Stateless 서비스</td><td>오토스케일링 및 장애 복원 용이</td></tr><tr><td>Write DB(주문, 결제, 재고, 배송)</td><td>Managed RDBMS 또는 NoSQL</td><td>트랜잭션 필요 시 RDBMS, 고속 쓰기 시 NoSQL</td></tr><tr><td>Read DB(조회)</td><td>Elasticsearch / Redis</td><td>CQRS 조회 전용, Materialized View 저장</td></tr><tr><td>Observability Layer (Prometheus, Grafana, ELK)</td><td>별도 모니터링 네임스페이스</td><td>전 서비스 공통 로그·메트릭·트레이스 수집</td></tr></tbody></table><hr><h3 id=kubernetes-배포-예시-각-마이크로서비스의-deployment--service-yaml>Kubernetes 배포 예시 (각 마이크로서비스의 Deployment + Service YAML)<a hidden class=anchor aria-hidden=true href=#kubernetes-배포-예시-각-마이크로서비스의-deployment--service-yaml>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-command-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>  </span><span class=c># 오토스케일링 고려</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-command-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-command-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myregistry/order-command:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_BROKER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>kafka:9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-command-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-command-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>이런 방식으로 Payment, Inventory, Delivery 서비스도 별도 Deployment로 배포<br>Horizontal Pod Autoscaler(HPA)로 트래픽에 따라 확장 가능</p></blockquote><hr><h2 id=2-장애-복구-시나리오-failover--recovery>2. 장애 복구 시나리오 (Failover & Recovery)<a hidden class=anchor aria-hidden=true href=#2-장애-복구-시나리오-failover--recovery>#</a></h2><h3 id=21-이벤트-소싱-기반-재처리-replay>2.1 이벤트 소싱 기반 재처리 (Replay)<a hidden class=anchor aria-hidden=true href=#21-이벤트-소싱-기반-재처리-replay>#</a></h3><ul><li>모든 상태 변경 이벤트를 Event Store(Kafka Topic)에 저장</li><li>장애 시 장애 발생 시점 이후의 Read DB를 폐기하고, 이벤트 로그에서 순차 재적용</li><li>대규모 환경에서는 <strong>병렬 이벤트 재생</strong>(Parallel Replay)으로 복구 속도 개선</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># replay_script.py - Kafka 이벤트 재생 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replay_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;kafka:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 타입에 따른 처리</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;OrderCreatedEvent&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rebuild_order_in_read_db</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;PaymentApprovedEvent&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rebuild_payment_in_read_db</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=22-사가-실패-단계별-복구-전략>2.2 사가 실패 단계별 복구 전략<a hidden class=anchor aria-hidden=true href=#22-사가-실패-단계별-복구-전략>#</a></h3><table><thead><tr><th>실패 지점</th><th>보상 트랜잭션 (Compensation)</th><th>추가 조치</th></tr></thead><tbody><tr><td>결제 승인 실패</td><td>결제 요청 취소</td><td>주문 상태 <code>CANCELLED</code>로 변경</td></tr><tr><td>재고 예약 실패</td><td>재고 롤백</td><td>결제 취소 트랜잭션 실행</td></tr><tr><td>배송 예약 실패</td><td>배송 요청 취소</td><td>재고 롤백 및 결제 취소</td></tr></tbody></table><hr><h3 id=23-멱등성idempotency-보장>2.3 멱등성(Idempotency) 보장<a hidden class=anchor aria-hidden=true href=#23-멱등성idempotency-보장>#</a></h3><ul><li>동일 이벤트가 중복 재처리되더라도 시스템 상태가 변하지 않도록 Idempotency Key 사용</li><li>Best Practice: 이벤트 키 값 <code>(event_type + order_id)</code> 조합으로 고유성 판단 후 처리 여부 결정</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>processed_events</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>event_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event_key</span> <span class=ow>in</span> <span class=n>processed_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>  <span class=c1># 이미 처리됨</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 처리 로직</span>
</span></span><span class=line><span class=cl>    <span class=n>processed_events</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>event_key</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=3-운영-모니터링--알림-시나리오>3. 운영 모니터링 & 알림 시나리오<a hidden class=anchor aria-hidden=true href=#3-운영-모니터링--알림-시나리오>#</a></h2><h3 id=주요-모니터링-항목>주요 모니터링 항목<a hidden class=anchor aria-hidden=true href=#주요-모니터링-항목>#</a></h3><table><thead><tr><th>영역</th><th>지표</th><th>경고 조건</th></tr></thead><tbody><tr><td>Kafka</td><td>Consumer Lag</td><td>1000 건 이상 적체 시 경고</td></tr><tr><td>DB</td><td>쿼리 응답 지연</td><td>500ms 이상 시 경고</td></tr><tr><td>API</td><td>요청 성공률</td><td>98% 이하 시 경고</td></tr><tr><td>Saga</td><td>단계별 완료율</td><td>특정 단계 90% 미만 완료 시 경고</td></tr></tbody></table><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># PrometheusRule 예시 (Kafka Consumer Lag 경고)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>monitoring.coreos.com/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PrometheusRule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-alert-rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka.rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>HighConsumerLag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>kafka_consumer_lag &gt; 1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Kafka Consumer Lag 지속 발생&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Kafka Consumer Lag가 5분 이상 1000건 초과&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=4-다음-확장-아이디어>4. 다음 확장 아이디어<a hidden class=anchor aria-hidden=true href=#4-다음-확장-아이디어>#</a></h2><ol><li><strong>서버리스(Serverless) 사가</strong><ul><li>AWS Step Functions 또는 Azure Durable Functions로 오케스트레이션하면 인프라 관리 최소화</li></ul></li><li><strong>CQRS + GraphQL 조회 계층 결합</strong><ul><li>조회 서비스에 GraphQL API를 두어 클라이언트가 필요한 데이터만 최적 조회</li></ul></li><li><strong>AI 기반 장애 예측</strong><ul><li>이벤트 패턴 분석으로 사가 실패 가능성을 사전 감지, 사전 보상 계획 실행</li></ul></li></ol><hr><p>좋아요, 이제 우리가 설계한 <strong>CQRS (명령-조회 책임 분리, Command Query Responsibility Segregation) + 이벤트 소싱(Event Sourcing) + 사가 패턴(Saga Pattern)</strong> 아키텍처를 <strong>AWS 클라우드 기반 Serverless 환경</strong>에 맞춰 설계하고, 실제 <strong>구현 예시 코드</strong>까지 확장하겠습니다.<br>이렇게 하면 기존의 쿠버네티스(Kubernetes) 운용 방식과 클라우드 네이티브(Serverless) 방식을 비교하면서 장단점을 명확히 볼 수 있습니다.</p><hr><h2 id=1-aws-서버리스serverless-기반-cqrs--saga-아키텍처>1. AWS 서버리스(Serverless) 기반 CQRS + Saga 아키텍처<a hidden class=anchor aria-hidden=true href=#1-aws-서버리스serverless-기반-cqrs--saga-아키텍처>#</a></h2><p><strong>구성 요소</strong></p><table><thead><tr><th>컴포넌트</th><th>AWS 서비스 매핑</th><th>역할</th></tr></thead><tbody><tr><td>Command API Gateway</td><td>Amazon API Gateway</td><td>명령형 HTTP 엔드포인트 제공</td></tr><tr><td>Command Handler</td><td>AWS Lambda</td><td>쓰기(Write) 요청 처리, 이벤트 발행</td></tr><tr><td>Event Store</td><td>Amazon DynamoDB Streams / Amazon Kinesis</td><td>이벤트 저장/전파</td></tr><tr><td>Saga Coordinator</td><td>AWS Step Functions</td><td>분산 트랜잭션 오케스트레이션 및 보상 로직</td></tr><tr><td>Query Handler</td><td>AWS Lambda</td><td>조회(Query) 요청 처리</td></tr><tr><td>Read DB</td><td>Amazon DynamoDB / Amazon Elasticsearch Service</td><td>Materialized View 저장, 고속 조회</td></tr><tr><td>Message Bus</td><td>Amazon SNS (Simple Notification Service) + SQS (Simple Queue Service)</td><td>서비스 간 비동기 메시징</td></tr><tr><td>Monitoring</td><td>Amazon CloudWatch + AWS X-Ray</td><td>메트릭, 로깅, 트레이싱</td></tr></tbody></table><hr><p><strong>아키텍처 다이어그램</strong></p><pre class=mermaid>graph TD
  User[사용자] --&gt; APIGW[API Gateway]
  APIGW --&gt;|POST /orders| LambdaCmd[Lambda Command Handler]
  LambdaCmd --&gt; DynamoDBWrite[(DynamoDB - Write Model)]
  LambdaCmd --&gt; EventBusSNS[SNS Topic - Order Events]
  EventBusSNS --&gt; SagaStepFn[Saga Coordinator (AWS Step Functions)]
  SagaStepFn --&gt; PaymentLambda[Lambda Payment Command]
  SagaStepFn --&gt; InventoryLambda[Lambda Inventory Command]
  SagaStepFn --&gt; DeliveryLambda[Lambda Delivery Command]
  SNS2[SNS Topic - Saga Events] --&gt; QueryUpdateLambda[Lambda Query Updater]
  QueryUpdateLambda --&gt; DynamoDBRead[(DynamoDB - Read Model)]
  APIGW --&gt;|GET /orders| LambdaQry[Lambda Query Handler]
  LambdaQry --&gt; DynamoDBRead
</pre><hr><h2 id=2-aws-step-functions-기반-사가-패턴-구현-예시-python>2. AWS Step Functions 기반 사가 패턴 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#2-aws-step-functions-기반-사가-패턴-구현-예시-python>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># lambda_handler_order.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=n>sns</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;sns&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 생성 처리 후 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;amount&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Write Model 저장 (DynamoDB)</span>
</span></span><span class=line><span class=cl>    <span class=n>dynamodb</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>resource</span><span class=p>(</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>table</span> <span class=o>=</span> <span class=n>dynamodb</span><span class=o>.</span><span class=n>Table</span><span class=p>(</span><span class=s1>&#39;OrderWriteModel&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>table</span><span class=o>.</span><span class=n>put_item</span><span class=p>(</span><span class=n>Item</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;CREATED&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># OrderCreatedEvent 발행 (SNS)</span>
</span></span><span class=line><span class=cl>    <span class=n>sns</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>TopicArn</span><span class=o>=</span><span class=s2>&#34;arn:aws:sns:ap-northeast-2:123456789012:OrderEvents&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>Message</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreatedEvent&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;statusCode&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=s2>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;Order created&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>AWS Step Functions 상태 머신 예시(JSON)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Comment&#34;</span><span class=p>:</span> <span class=s2>&#34;Order Saga Coordination&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;StartAt&#34;</span><span class=p>:</span> <span class=s2>&#34;PaymentService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;States&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;PaymentService&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:lambda:ap-northeast-2:123456789012:function:PaymentHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Next&#34;</span><span class=p>:</span> <span class=s2>&#34;InventoryService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Catch&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;ErrorEquals&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;States.ALL&#34;</span><span class=p>],</span> <span class=nt>&#34;Next&#34;</span><span class=p>:</span> <span class=s2>&#34;CompensatePayment&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;InventoryService&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:lambda:ap-northeast-2:123456789012:function:InventoryHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Next&#34;</span><span class=p>:</span> <span class=s2>&#34;DeliveryService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Catch&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;ErrorEquals&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;States.ALL&#34;</span><span class=p>],</span> <span class=nt>&#34;Next&#34;</span><span class=p>:</span> <span class=s2>&#34;CompensateInventory&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;DeliveryService&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:lambda:ap-northeast-2:123456789012:function:DeliveryHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;End&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CompensatePayment&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:lambda:ap-northeast-2:123456789012:function:PaymentCompensate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;End&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CompensateInventory&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:lambda:ap-northeast-2:123456789012:function:InventoryCompensate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Next&#34;</span><span class=p>:</span> <span class=s2>&#34;CompensatePayment&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=3-서버리스-기반-cqrs--saga의-장점과-한계-비교>3. 서버리스 기반 CQRS + Saga의 장점과 한계 비교<a hidden class=anchor aria-hidden=true href=#3-서버리스-기반-cqrs--saga의-장점과-한계-비교>#</a></h2><table><thead><tr><th>구분</th><th>장점</th><th>한계</th></tr></thead><tbody><tr><td>인프라 관리</td><td>서버리스로 운영비와 관리 부담↓</td><td>Lambda cold start 지연</td></tr><tr><td>확장성</td><td>트래픽 급증 시 오토스케일링 즉시 반응</td><td>의존 서비스 한도(Throughput limit) 존재</td></tr><tr><td>비용</td><td>사용량 기반 과금</td><td>초당 고빈도 호출 시 비용 급증 우려</td></tr><tr><td>장애 복구</td><td>이벤트 저장 + Step Functions 재실행 가능</td><td>장시간 실행 워크플로우 비용 상승</td></tr></tbody></table><hr><h2 id=4-고급-운영-전략>4. 고급 운영 전략<a hidden class=anchor aria-hidden=true href=#4-고급-운영-전략>#</a></h2><ol><li><strong>DynamoDB Streams로 이벤트 소싱 자동 반영</strong><ul><li>Write Model 변경 시 Lambda 트리거로 Read Model 자동 업데이트</li></ul></li><li><strong>SNS+SQS 기반 Dead Letter Queue(DLQ) 운영</strong><ul><li>처리 실패 이벤트를 DLQ로 보내고, 주기적 재처리</li></ul></li><li><strong>AWS X-Ray로 사가 전체 트랜잭션 추적</strong><ul><li>보상 트랜잭션 실행 여부, 단계별 Latency 분석</li></ul></li><li><strong>Serverless Framework/Terraform IaC</strong><ul><li>인프라 배포 표준화, 여러 환경(개발/스테이징/운영) 자동 구성</li></ul></li></ol><hr><p>호흡을 가다듬고, 이번에는 <strong>AWS 서버리스(Serverless) 환경에서 CQRS (명령-조회 책임 분리) + 이벤트 소싱(Event Sourcing) + 사가 패턴(Saga Pattern)</strong> 기반 시스템의 <strong>성능 부하 테스트(Load Testing), 장애 주입(Chaos Engineering), 성능 최적화 시나리오</strong>까지 구체적으로 이어서 설명합니다.</p><hr><h2 id=1-성능-부하-테스트-시나리오>1. 성능 부하 테스트 시나리오<a hidden class=anchor aria-hidden=true href=#1-성능-부하-테스트-시나리오>#</a></h2><h3 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h3><ul><li>주문 생성/결제/재고/배송 연계 전체 워크플로우가 <strong>대용량 트래픽</strong> 조건에서 얼마나 안정적으로 처리되는지 검증</li><li>서버리스 환경에서의 <strong>확장성(Scalability), 병목(Bottleneck) 구간 파악</strong></li></ul><hr><h3 id=테스트-단계별-설계>테스트 단계별 설계<a hidden class=anchor aria-hidden=true href=#테스트-단계별-설계>#</a></h3><table><thead><tr><th>단계</th><th>시나리오</th><th>측정 지표</th><th>주요 도구</th></tr></thead><tbody><tr><td>1단계</td><td>주문 명령 1만 건 동시 발생</td><td>Lambda 처리율, API Gateway TPS, EventBus 메시지 지연</td><td>Artillery, Locust, AWS X-Ray</td></tr><tr><td>2단계</td><td>이벤트 발행 후 사가 오케스트레이션 처리</td><td>Step Functions 각 단계별 성공률, Latency, 보상(Compensation) 수, DLQ 적재율</td><td>Step Functions Logs, CloudWatch</td></tr><tr><td>3단계</td><td>실시간 조회 성능 측정</td><td>조회 레이턴시, Read DB 업데이트 지연, 캐시 적중률</td><td>CloudWatch, AWS Elasticsearch Kibana</td></tr><tr><td>4단계</td><td>장애 상황 주입(도중 결제 또는 재고 장애 발생)</td><td>보상 트랜잭션 성공률, 상태 복구 시간</td><td>Chaos Lambda, Step Functions Reexecution</td></tr></tbody></table><hr><h4 id=1-주문-명령-부하-테스트-예시-artillery-활용-yaml>1) 주문 명령 부하 테스트 예시 (Artillery 활용, YAML)<a hidden class=anchor aria-hidden=true href=#1-주문-명령-부하-테스트-예시-artillery-활용-yaml>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://api.example.com/orders&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>phases</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>duration</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>arrivalRate</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>   </span><span class=c># 초당 200건 API 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>scenarios</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>flow</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>post</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/create&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>json</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>order_id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ $randomInt(1000000) }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>amount</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>주요 측정값</strong>: Lambda Invoke 성공률, 처리시간, 병렬 실행 수</li><li><strong>병목 구간 판단</strong>: Lambda 동시 실행 한계, DynamoDB 쓰기 처리량, SNS 메시지 전파시간</li></ul><hr><h4 id=2-사가-패턴-오케스트레이션-단계별-처리율-측정-step-functions-metrics>2) 사가 패턴 오케스트레이션 단계별 처리율 측정 (Step Functions Metrics)<a hidden class=anchor aria-hidden=true href=#2-사가-패턴-오케스트레이션-단계별-처리율-측정-step-functions-metrics>#</a></h4><ul><li>Step Functions Execution Count, Success/Failure Ratio, 각 Task State별 시간 확인</li><li>각 단계 실패 시 DLQ(Dead Letter Queue) 적재 이벤트, 보상 트랜잭션 실행 수</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># CloudWatch에서 단계별 Metric 수집 예시 (Python, Boto3)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;cloudwatch&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_step_function_metrics</span><span class=p>(</span><span class=n>state_machine_arn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_metric_data</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>MetricDataQueries</span><span class=o>=</span><span class=p>[{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Id&#39;</span><span class=p>:</span> <span class=s1>&#39;sfExecSuccess&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;MetricStat&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Metric&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;Namespace&#39;</span><span class=p>:</span> <span class=s1>&#39;AWS/States&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;MetricName&#39;</span><span class=p>:</span> <span class=s1>&#39;ExecutionsSucceeded&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;Dimensions&#39;</span><span class=p>:</span> <span class=p>[{</span><span class=s1>&#39;Name&#39;</span><span class=p>:</span> <span class=s1>&#39;StateMachineArn&#39;</span><span class=p>,</span> <span class=s1>&#39;Value&#39;</span><span class=p>:</span> <span class=n>state_machine_arn</span><span class=p>}]</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Period&#39;</span><span class=p>:</span> <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Stat&#39;</span><span class=p>:</span> <span class=s1>&#39;Sum&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;MetricDataResults&#39;</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=3-장애-주입chaos-engineering-시나리오>3) 장애 주입(Chaos Engineering) 시나리오<a hidden class=anchor aria-hidden=true href=#3-장애-주입chaos-engineering-시나리오>#</a></h4><ul><li><strong>목적</strong>: 특정 단계(예: Payment 승인)에서 강제로 실패를 유발하여 사가 보상 트랜잭션 정상 동작 여부, 전체 시스템 복원력 점검</li><li><strong>방법</strong>: PaymentHandler Lambda에서 Exception throw 또는 DynamoDB 쓰기 실패 유도</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Chaos Lambda 예시: 실패 상황을 강제로 발생</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>payment_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;chaos_mode&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Payment error for chaos test&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 정상 결제 처리 로직</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>보상 트랜잭션 코드가 정상적으로 재실행되는지, DLQ로 실패 이벤트가 적절히 이동하는지 모니터링</li></ul><hr><h2 id=2-대용량-이벤트-재처리이벤트-replay-및-복구-자동화>2. 대용량 이벤트 재처리(이벤트 Replay) 및 복구 자동화<a hidden class=anchor aria-hidden=true href=#2-대용량-이벤트-재처리이벤트-replay-및-복구-자동화>#</a></h2><ul><li>장애로 인해 Read Model(조회 DB)이 일부 손상된 경우, DynamoDB Streams 또는 Kinesis에서 과거 이벤트를 재생(Replay)하여 조회 데이터 신속 복구</li><li>Lambda를 사용하여 이벤트를 순차적으로 소비, DB 상태 복원</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>event_replay</span><span class=p>(</span><span class=n>event_stream</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_stream</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderCreatedEvent&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rebuild_order</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;PaymentApprovedEvent&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rebuild_payment</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># ... 단계별 복구 처리 추가</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>자동화 프레임워크</strong>: AWS Lambda Scheduled Trigger → 이벤트 복구/재처리 주기적 실행</li></ul><hr><h2 id=3-성능-최적화-전략>3. 성능 최적화 전략<a hidden class=anchor aria-hidden=true href=#3-성능-최적화-전략>#</a></h2><table><thead><tr><th>전략</th><th>적용 방식</th><th>기대 효과</th></tr></thead><tbody><tr><td>Lambda 동시성 조정</td><td>예약된 Concurrency 값 확대</td><td>대량 트래픽 시 처리 지연 최소화</td></tr><tr><td>DynamoDB 파티셔닝</td><td>주문/이벤트 유형별 파티션 키 설계</td><td>Hot partition 문제 완화</td></tr><tr><td>SQS+SNS DLQ 도입</td><td>처리 실패 메시지는 DLQ로 분리하여 재처리</td><td>장애시 데이터 유실 방지</td></tr><tr><td>캐싱계층 도입</td><td>AWS ElastiCache (Redis) 활용 조회 캐싱</td><td>실시간 조회 응답속도 향상</td></tr><tr><td>이벤트 일괄 처리</td><td>Lambda Batch Size Parameter 조정</td><td>데이터 동기화 효율 증가</td></tr></tbody></table><hr><h2 id=4-실제-성능-테스트-후-분석-방법>4. 실제 성능 테스트 후 분석 방법<a hidden class=anchor aria-hidden=true href=#4-실제-성능-테스트-후-분석-방법>#</a></h2><ul><li>병목 단계 시각화: API Gateway → Lambda → SNS/SQS → Step Functions → DynamoDB의 각 지점별 Latency, 에러율</li><li>장애 복구 시 재처리 성공률, DLQ 재처리 후 복구 시간, 시스템 복구 과정 로그 트레이스 분석</li><li>성능 모니터링 대시보드: CloudWatch Dashboard, X-Ray Trace Map, ELK 로그 집계</li></ul><hr><h2 id=5-실무-적용을-위한-종합-가이드>5. 실무 적용을 위한 종합 가이드<a hidden class=anchor aria-hidden=true href=#5-실무-적용을-위한-종합-가이드>#</a></h2><ol><li><strong>테스트 설계</strong><ul><li>주요 프로세스에 대해 부하/장애 시나리오 사전 정의</li></ul></li><li><strong>모니터링 구조화</strong><ul><li>각 컴포넌트별 핵심 Metric 정의, 실시간 알림/대시보드 구성</li></ul></li><li><strong>자동 복구 시나리오</strong><ul><li>이벤트 Replay, DLQ 자동 재처리 정책 수립</li></ul></li><li><strong>비용/성능 균형</strong><ul><li>병목 단계별 리소스 조정 및 최적화, 서버리스 요금 한도/비용 모니터링</li></ul></li></ol><hr><p><strong>다음 단계로</strong><br>실제 AWS 클라우드 기반 환경에서 <strong>성능 데이터 해석 예시, 병목 원인 분석, 실질적인 트러블슈팅 가이드</strong>까지 실제 로그나 대시보드 분석 포인트로 이어질 수 있습니다.</p><p>특정 성능 이슈나 장애 복구 과정에서 더 궁금한 사례가 있다면, 상세한 포인트나 실질적 실습 예시 중심으로 바로 이어서 설명합니다!<br>혹은 실제 운영 경험/최신 베스트 프랙티스가 필요하다면, 그 관점에서 단계별로 구체적으로 정리해드릴게요.</p><h1 id=cqrs-command-query-responsibility-segregation-종합-분석>CQRS (Command Query Responsibility Segregation) 종합 분석<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-종합-분석>#</a></h1><h2 id=1단계-기본-분석-1>1단계: 기본 분석<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-1>#</a></h2><h3 id=1-대표-태그>1. 대표 태그<a hidden class=anchor aria-hidden=true href=#1-대표-태그>#</a></h3><ul><li><code>Command-Query-Separation</code></li><li><code>Event-Driven-Architecture</code></li><li><code>Read-Write-Segregation</code></li><li><code>System-Scalability</code></li></ul><h3 id=2-분류-체계-검증-1>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증-1>#</a></h3><p><strong>현재 분류</strong>: &ldquo;Software Engineering > Design and Architecture > Architecture Styles > Messaging-Oriented Architecture > Event-Driven Architecture > Event Patterns&rdquo;</p><p><strong>개선 제안</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Software Engineering &gt; Design and Architecture &gt; Architecture Patterns &gt; Data Management Patterns &gt; CQRS
</span></span></code></pre></td></tr></table></div></div><p><strong>근거</strong>: CQRS는 메시징이나 이벤트 기반 아키텍처에 국한되지 않고, 독립적으로 적용 가능한 데이터 관리 패턴이므로 별도 분류가 적절합니다.</p><h3 id=3-핵심-요약-250자-이내>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내>#</a></h3><p>CQRS (Command Query Responsibility Segregation, 명령 조회 책임 분리)는 시스템의 읽기(조회)와 쓰기(명령) 작업을 별도의 모델로 분리하는 아키텍처 패턴입니다. 데이터 조회와 변경의 서로 다른 요구사항을 독립적으로 최적화하여 성능, 확장성, 보안성을 향상시킵니다.</p><h3 id=4-전체-개요-400자-이내>4. 전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-400자-이내>#</a></h3><p>CQRS는 전통적인 CRUD (Create, Read, Update, Delete) 모델에서 벗어나 명령(Command)과 조회(Query)를 분리하는 설계 패턴입니다. 읽기 전용 모델과 쓰기 전용 모델을 독립적으로 구성하여 각각의 요구사항에 최적화된 데이터 저장소와 처리 로직을 사용할 수 있습니다. 복잡한 도메인 로직, 높은 성능 요구사항, 대규모 시스템에서 특히 유용하며, 이벤트 소싱 (Event Sourcing)과 함께 사용될 때 더욱 강력한 효과를 발휘합니다.</p><h2 id=2단계-핵심-분석-1>2단계: 핵심 분석<a hidden class=anchor aria-hidden=true href=#2단계-핵심-분석-1>#</a></h2><h3 id=5-핵심-개념-정리-1>5. 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리-1>#</a></h3><h4 id=이론적-관점>이론적 관점<a hidden class=anchor aria-hidden=true href=#이론적-관점>#</a></h4><ul><li><strong>CQS (Command Query Separation) 원칙</strong>: 메서드는 명령(상태 변경) 또는 조회(값 반환) 중 하나만 수행</li><li><strong>책임 분리 (Responsibility Segregation)</strong>: 읽기와 쓰기 모델의 완전한 분리</li><li><strong>최종 일관성 (Eventual Consistency)</strong>: 분리된 모델 간의 데이터 동기화 방식</li></ul><h4 id=실무적-관점>실무적 관점<a hidden class=anchor aria-hidden=true href=#실무적-관점>#</a></h4><ul><li><strong>폴리글랏 퍼시스턴스 (Polyglot Persistence)</strong>: 읽기/쓰기 각각에 최적화된 저장소 사용</li><li><strong>성능 최적화</strong>: 읽기 전용 뷰와 쓰기 전용 처리의 독립적 최적화</li><li><strong>확장성</strong>: 읽기와 쓰기 워크로드의 독립적 스케일링</li></ul><h4 id=기본-수준>기본 수준<a hidden class=anchor aria-hidden=true href=#기본-수준>#</a></h4><ul><li>단일 애플리케이션 내에서의 모델 분리</li><li>기본적인 읽기/쓰기 분리 구현</li></ul><h4 id=심화-수준>심화 수준<a hidden class=anchor aria-hidden=true href=#심화-수준>#</a></h4><ul><li>마이크로서비스 (Microservices) 아키텍처와의 통합</li><li>이벤트 소싱과의 결합</li><li>복잡한 도메인 모델링</li></ul><h3 id=6-실무-연관성-분석-1>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석-1>#</a></h3><table><thead><tr><th>핵심 개념</th><th>실무 구현 방식</th><th>적용 영역</th></tr></thead><tbody><tr><td>명령/조회 분리</td><td>REST API (Command/Query Endpoint)</td><td>웹 애플리케이션, API 게이트웨이 (API Gateway)</td></tr><tr><td>모델 분리</td><td>별도 데이터베이스/스키마</td><td>데이터베이스 설계, 마이크로서비스</td></tr><tr><td>이벤트 기반 동기화</td><td>메시지 브로커 (Message Broker)</td><td>분산 시스템, 실시간 데이터 처리</td></tr><tr><td>읽기 최적화</td><td>구체화된 뷰 (Materialized View), 캐시</td><td>성능 크리티컬 시스템</td></tr></tbody></table><h2 id=3단계-상세-조사-1>3단계: 상세 조사<a hidden class=anchor aria-hidden=true href=#3단계-상세-조사-1>#</a></h2><h3 id=phase-1-기초-이해-foundation-understanding>Phase 1: 기초 이해 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질-1>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질-1>#</a></h4><p>CQRS (Command Query Responsibility Segregation, 명령 조회 책임 분리)는 소프트웨어 시스템에서 데이터를 변경하는 작업(명령)과 데이터를 조회하는 작업(조회)을 서로 다른 모델로 분리하는 아키텍처 패턴입니다.</p><pre class=mermaid>graph TB
    Client[클라이언트] --&gt; CommandAPI[명령 API]
    Client --&gt; QueryAPI[조회 API]
    
    CommandAPI --&gt; CommandModel[명령 모델]
    QueryAPI --&gt; QueryModel[조회 모델]
    
    CommandModel --&gt; WriteDB[(쓰기 DB)]
    QueryModel --&gt; ReadDB[(읽기 DB)]
    
    WriteDB --&gt; EventBus[이벤트 버스]
    EventBus --&gt; ReadDB
</pre><h4 id=등장-배경-및-발전-과정-1>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정-1>#</a></h4><ol><li><strong>2005년</strong>: 버트랜드 마이어 (Bertrand Meyer)의 CQS (Command Query Separation) 원칙 제시</li><li><strong>2010년</strong>: 그렉 영 (Greg Young)이 CQRS 패턴으로 확장 발전</li><li><strong>2010년대 중반</strong>: 마이크로서비스와 이벤트 소싱의 대중화와 함께 확산</li><li><strong>현재</strong>: 클라우드 네이티브 (Cloud Native) 아키텍처에서 널리 사용</li></ol><h4 id=핵심-동기-및-가치-제안-1>핵심 동기 및 가치 제안<a hidden class=anchor aria-hidden=true href=#핵심-동기-및-가치-제안-1>#</a></h4><ul><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업의 독립적 최적화 가능</li><li><strong>확장성 향상</strong>: 각 모델의 독립적 스케일링</li><li><strong>복잡성 관리</strong>: 복잡한 도메인 로직과 단순한 조회 로직의 분리</li><li><strong>기술 선택의 자유</strong>: 각 모델에 최적화된 기술 스택 사용 가능</li></ul><h4 id=주요-특징-1>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징-1>#</a></h4><table><thead><tr><th>특징</th><th>설명</th><th>도출 근거</th></tr></thead><tbody><tr><td>모델 분리</td><td>읽기와 쓰기 모델의 완전한 분리</td><td>CQS 원칙의 아키텍처 레벨 확장 적용</td></tr><tr><td>독립 최적화</td><td>각 모델별 성능 및 저장소 최적화</td><td>읽기/쓰기 워크로드의 서로 다른 특성</td></tr><tr><td>최종 일관성</td><td>분리된 모델 간 비동기 동기화</td><td>성능과 가용성을 위한 일관성 트레이드오프</td></tr><tr><td>폴리글랏 지원</td><td>각 모델별 다른 기술 스택 사용 가능</td><td>워크로드별 최적 기술 선택의 필요성</td></tr></tbody></table><h3 id=phase-2-핵심-이론-core-theory>Phase 2: 핵심 이론 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-이론-core-theory>#</a></h3><h4 id=핵심-설계-원칙-1>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙-1>#</a></h4><ol><li><strong>단일 책임 원칙</strong>: 각 모델은 하나의 책임만 담당</li><li><strong>관심사 분리</strong>: 읽기와 쓰기 로직의 완전한 분리</li><li><strong>독립성 원칙</strong>: 각 모델의 독립적 진화 가능</li><li><strong>최적화 원칙</strong>: 각 워크로드에 최적화된 구현</li></ol><h4 id=기본-원리-및-동작-메커니즘-1>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘-1>#</a></h4><pre class=mermaid>sequenceDiagram
    participant C as 클라이언트
    participant CMD as 명령 핸들러
    participant WDB as 쓰기 DB
    participant EB as 이벤트 버스
    participant PH as 프로젝션 핸들러
    participant RDB as 읽기 DB
    participant QH as 조회 핸들러

    C-&gt;&gt;CMD: 명령 실행
    CMD-&gt;&gt;WDB: 데이터 저장
    CMD-&gt;&gt;EB: 이벤트 발행
    EB-&gt;&gt;PH: 이벤트 수신
    PH-&gt;&gt;RDB: 읽기 모델 업데이트
    
    C-&gt;&gt;QH: 조회 요청
    QH-&gt;&gt;RDB: 데이터 조회
    QH-&gt;&gt;C: 결과 반환
</pre><p><strong>동작 원리</strong>:</p><ol><li>클라이언트가 명령을 실행하면 명령 핸들러가 처리</li><li>쓰기 모델에 데이터 저장 후 이벤트 발행</li><li>이벤트를 수신한 프로젝션 핸들러가 읽기 모델 업데이트</li><li>조회 요청은 별도의 읽기 모델에서 처리</li></ol><h4 id=아키텍처-및-구성-요소-1>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소-1>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;명령 측면 (Command Side)&#34;
        CMD[명령 핸들러]
        DM[도메인 모델]
        WR[쓰기 저장소]
        CMD --&gt; DM
        DM --&gt; WR
    end
    
    subgraph &#34;이벤트 인프라&#34;
        EB[이벤트 버스]
        ES[이벤트 스토어]
    end
    
    subgraph &#34;조회 측면 (Query Side)&#34;
        QH[조회 핸들러]
        RM[읽기 모델]
        RR[읽기 저장소]
        QH --&gt; RM
        RM --&gt; RR
    end
    
    DM --&gt; EB
    EB --&gt; ES
    EB --&gt; RM
</pre><p><strong>필수 구성 요소</strong>:</p><ul><li><strong>명령 핸들러 (Command Handler)</strong>: 비즈니스 로직 처리</li><li><strong>조회 핸들러 (Query Handler)</strong>: 데이터 조회 처리</li><li><strong>이벤트 버스</strong>: 모델 간 통신 매개체</li></ul><p><strong>선택적 구성 요소</strong>:</p><ul><li><strong>이벤트 스토어 (Event Store)</strong>: 이벤트 영속성 관리</li><li><strong>프로젝션 엔진 (Projection Engine)</strong>: 읽기 모델 자동 생성</li><li><strong>캐시 레이어</strong>: 조회 성능 최적화</li></ul><h4 id=주요-기능과-역할-1>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할-1>#</a></h4><table><thead><tr><th>구성 요소</th><th>기능</th><th>책임</th><th>상호 관계</th></tr></thead><tbody><tr><td>명령 모델</td><td>비즈니스 로직 실행, 데이터 변경</td><td>도메인 규칙 적용, 일관성 보장</td><td>이벤트 발행을 통해 조회 모델과 통신</td></tr><tr><td>조회 모델</td><td>데이터 조회, 뷰 제공</td><td>성능 최적화된 데이터 제공</td><td>이벤트 수신으로 데이터 동기화</td></tr><tr><td>이벤트 버스</td><td>모델 간 통신</td><td>비동기 메시지 전달</td><td>명령과 조회 모델의 연결고리</td></tr><tr><td>프로젝션</td><td>읽기 모델 생성/업데이트</td><td>데이터 변환 및 비정규화</td><td>이벤트를 읽기 최적화 형태로 변환</td></tr></tbody></table><h3 id=phase-3-특성-분석-characteristics-analysis>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점-1>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>성능</td><td>조회 성능 향상</td><td>읽기 전용으로 최적화된 뷰 제공</td><td>비정규화된 데이터, 인덱스 최적화</td></tr><tr><td>성능</td><td>쓰기 성능 향상</td><td>복잡한 조회 로직 없이 순수 비즈니스 로직만 처리</td><td>명령 처리 시 조회 부하 제거</td></tr><tr><td>확장성</td><td>독립적 스케일링</td><td>읽기/쓰기 워크로드별 독립적 확장</td><td>별도 인프라에서 각 모델 운영</td></tr><tr><td>확장성</td><td>폴리글랏 퍼시스턴스</td><td>각 모델에 최적화된 저장소 사용</td><td>모델 분리로 인한 기술 스택 자유도</td></tr><tr><td>유지보수</td><td>관심사 분리</td><td>읽기/쓰기 로직의 명확한 분리</td><td>각 모델의 독립적 진화 가능</td></tr><tr><td>보안</td><td>세밀한 권한 제어</td><td>명령/조회별 별도 보안 정책 적용</td><td>API 엔드포인트의 물리적 분리</td></tr></tbody></table><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><p><strong>단점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>복잡성</td><td>구현 복잡도 증가</td><td>두 개의 모델 관리 필요</td><td>점진적 도입, 자동화 도구 활용</td><td>전통적 CRUD 패턴</td></tr><tr><td>일관성</td><td>최종 일관성 문제</td><td>읽기/쓰기 모델 간 지연</td><td>보상 트랜잭션 (Compensating Transaction), 사가 패턴 (Saga Pattern)</td><td>강한 일관성 모델</td></tr><tr><td>운영</td><td>인프라 복잡도</td><td>별도 저장소 및 동기화 메커니즘 필요</td><td>인프라 자동화, 모니터링 강화</td><td>단일 데이터베이스</td></tr></tbody></table><p><strong>문제점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>동기화</td><td>데이터 불일치</td><td>이벤트 처리 실패, 네트워크 장애</td><td>잘못된 조회 결과</td><td>모델 간 데이터 비교, 메트릭 모니터링</td><td>멱등성 보장, 재시도 메커니즘</td><td>보상 처리, 수동 동기화</td></tr><tr><td>성능</td><td>이벤트 처리 지연</td><td>높은 이벤트 볼륨, 처리 성능 부족</td><td>읽기 모델 업데이트 지연</td><td>이벤트 큐 크기 모니터링</td><td>이벤트 배치 처리, 스케일링</td><td>병렬 처리, 파티셔닝</td></tr></tbody></table><h4 id=트레이드오프-관계-분석-1>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석-1>#</a></h4><pre class=mermaid>graph LR
    A[성능 향상] &lt;--&gt; B[복잡성 증가]
    C[확장성] &lt;--&gt; D[일관성 약화]
    E[유연성] &lt;--&gt; F[운영 부담]
    G[개발 자유도] &lt;--&gt; H[통합 복잡도]
</pre><ul><li><strong>성능 vs 복잡성</strong>: 성능 향상을 위해 아키텍처 복잡성 증가</li><li><strong>확장성 vs 일관성</strong>: 독립적 확장을 위해 강한 일관성 포기</li><li><strong>유연성 vs 운영부담</strong>: 기술 선택의 자유도 증가로 운영 복잡성 증가</li></ul><h3 id=phase-4-구현-및-분류-implementation--classification>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법-및-방법-1>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법-1>#</a></h4><p><strong>1. 기본 CQRS</strong></p><ul><li><strong>정의</strong>: 단일 애플리케이션 내에서 읽기/쓰기 모델 분리</li><li><strong>구성</strong>: 동일한 데이터베이스, 별도 서비스 레이어</li><li><strong>목적</strong>: 코드 구조 개선, 성능 최적화 시작점</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 명령 서비스 (Command Service)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>validate</span><span class=p>()</span>  <span class=c1># 도메인 규칙 검증</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 데이터 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>order</span><span class=o>.</span><span class=n>total</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 조회 서비스 (Query Service)  </span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order_summary</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 읽기 최적화된 뷰에서 조회</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_repository</span><span class=o>.</span><span class=n>get_order_summary</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. 분리된 저장소 CQRS</strong></p><ul><li><strong>정의</strong>: 읽기/쓰기용 별도 데이터베이스 사용</li><li><strong>구성</strong>: 명령용 정규화 DB, 조회용 비정규화 DB</li><li><strong>목적</strong>: 각 워크로드에 최적화된 저장소 활용</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 명령 측 - PostgreSQL 사용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 트랜잭션 보장이 중요한 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>transaction</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>postgres</span><span class=p>.</span><span class=nx>beginTransaction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderRepository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>inventoryRepository</span><span class=p>.</span><span class=nx>updateStock</span><span class=p>(</span><span class=nx>items</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>transaction</span><span class=p>.</span><span class=nx>commit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=k>new</span> <span class=nx>OrderProcessedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>transaction</span><span class=p>.</span><span class=nx>rollback</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 조회 측 - Redis/MongoDB 사용  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrderHistory</span><span class=p>(</span><span class=nx>customerId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 성능에 최적화된 NoSQL에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`customer:</span><span class=si>${</span><span class=nx>customerId</span><span class=si>}</span><span class=sb>:orders`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>3. 이벤트 소싱 + CQRS</strong></p><ul><li><strong>정의</strong>: 이벤트 스토어를 활용한 완전한 CQRS 구현</li><li><strong>구성</strong>: 이벤트 스토어, 프로젝션 엔진, 읽기 모델</li><li><strong>목적</strong>: 완전한 감사 추적, 시점별 상태 복원</li><li><strong>실제 예시</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18>18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19>19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20>20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21>21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22>22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23>23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24>24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25>25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26>26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27>27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 이벤트 소싱과 결합된 CQRS</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>AccountAggregate</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ID</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Balance</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>Version</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>AccountAggregate</span><span class=p>)</span> <span class=nf>Withdraw</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=nx>Event</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>a</span><span class=p>.</span><span class=nx>Balance</span> <span class=p>&lt;</span> <span class=nx>amount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[]</span><span class=nx>Event</span><span class=p>{</span><span class=nx>WithdrawalRejected</span><span class=p>{</span><span class=nx>Amount</span><span class=p>:</span> <span class=nx>amount</span><span class=p>,</span> <span class=nx>Reason</span><span class=p>:</span> <span class=s>&#34;Insufficient funds&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[]</span><span class=nx>Event</span><span class=p>{</span><span class=nx>MoneyWithdrawn</span><span class=p>{</span><span class=nx>Amount</span><span class=p>:</span> <span class=nx>amount</span><span class=p>,</span> <span class=nx>NewBalance</span><span class=p>:</span> <span class=nx>a</span><span class=p>.</span><span class=nx>Balance</span> <span class=o>-</span> <span class=nx>amount</span><span class=p>}}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 프로젝션 핸들러 (Projection Handler)</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>AccountProjectionHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>readStore</span> <span class=nx>ReadStore</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>AccountProjectionHandler</span><span class=p>)</span> <span class=nf>Handle</span><span class=p>(</span><span class=nx>event</span> <span class=nx>Event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=nx>e</span> <span class=o>:=</span> <span class=nx>event</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>MoneyWithdrawn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 모델 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>.</span><span class=nx>readStore</span><span class=p>.</span><span class=nf>UpdateAccountBalance</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>AccountID</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>NewBalance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>.</span><span class=nx>readStore</span><span class=p>.</span><span class=nf>AddToTransactionHistory</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>AccountID</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>Amount</span><span class=p>,</span> <span class=s>&#34;withdrawal&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-유형-구분-1>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분-1>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 시나리오</th></tr></thead><tbody><tr><td>저장소 분리 수준</td><td>단일 DB</td><td>동일 DB, 다른 테이블/스키마</td><td>단순한 읽기/쓰기 분리</td></tr><tr><td></td><td>분리된 DB</td><td>물리적으로 다른 데이터베이스</td><td>성능/확장성 최적화</td></tr><tr><td></td><td>폴리글랏</td><td>각기 다른 DB 기술 사용</td><td>워크로드별 최적화</td></tr><tr><td>일관성 수준</td><td>강한 일관성</td><td>동기 업데이트</td><td>금융, 재고 관리</td></tr><tr><td></td><td>최종 일관성</td><td>비동기 업데이트</td><td>소셜 미디어, 로그 분석</td></tr><tr><td>복잡도</td><td>기본 CQRS</td><td>단순한 읽기/쓰기 분리</td><td>중소규모 애플리케이션</td></tr><tr><td></td><td>고급 CQRS</td><td>이벤트 소싱, 복잡한 프로젝션</td><td>대규모 엔터프라이즈</td></tr></tbody></table><h3 id=phase-5-실무-적용-practical-application>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례-1>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-1>#</a></h4><p><strong>1. Netflix - 개인화 추천 시스템</strong></p><ul><li><strong>조합 기술</strong>: CQRS + Apache Kafka + Cassandra + Elasticsearch</li><li><strong>효과 분석</strong>:<ul><li>읽기 성능 10배 향상</li><li>개인화 모델 독립적 업데이트 가능</li><li>실시간 추천 시스템 구현</li></ul></li></ul><p><strong>2. Microsoft - Azure Event Store</strong></p><ul><li><strong>조합 기술</strong>: CQRS + Event Sourcing + Azure Service Bus</li><li><strong>효과 분석</strong>:<ul><li>완전한 감사 추적 제공</li><li>시점별 데이터 복원 기능</li><li>마이크로서비스 간 느슨한 결합</li></ul></li></ul><p><strong>3. Uber - 승차 요청 처리 시스템</strong></p><ul><li><strong>조합 기술</strong>: CQRS + Apache Kafka + MongoDB + Redis</li><li><strong>효과 분석</strong>:<ul><li>초당 수백만 건의 위치 업데이트 처리</li><li>실시간 매칭 성능 향상</li><li>지역별 독립적 스케일링</li></ul></li></ul><h4 id=실습-예제-및-코드-구현-1>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현-1>#</a></h4><p><strong>시나리오</strong>: 전자상거래 주문 관리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>명령 측: PostgreSQL (주문 데이터)</li><li>조회 측: Redis (주문 요약), Elasticsearch (검색)</li><li>이벤트 버스: Apache Kafka</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    Client[클라이언트] --&gt; API[API 게이트웨이]
    
    API --&gt; CMD[주문 명령 API]
    API --&gt; QRY[주문 조회 API]
    
    CMD --&gt; OrderService[주문 서비스]
    QRY --&gt; QueryService[조회 서비스]
    
    OrderService --&gt; PostgreSQL[(PostgreSQL)]
    OrderService --&gt; Kafka[Apache Kafka]
    
    Kafka --&gt; Projection[프로젝션 서비스]
    Projection --&gt; Redis[(Redis)]
    Projection --&gt; Elasticsearch[(Elasticsearch)]
    
    QueryService --&gt; Redis
    QueryService --&gt; Elasticsearch
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트가 주문 생성 요청</li><li>주문 서비스가 비즈니스 로직 검증 후 PostgreSQL에 저장</li><li>주문 생성 이벤트를 Kafka로 발행</li><li>프로젝션 서비스가 이벤트를 수신하여 Redis와 Elasticsearch 업데이트</li><li>조회 요청은 Redis/Elasticsearch에서 처리</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>CQRS는 주문 생성(명령)과 주문 조회(쿼리)를 완전히 분리</li><li>각 저장소는 해당 워크로드에 최적화</li><li>이벤트를 통한 비동기 데이터 동기화</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 단일 데이터베이스에서 복잡한 조인 쿼리로 성능 저하</li><li><strong>도입 후</strong>: 읽기는 비정규화된 뷰에서 빠른 조회, 쓰기는 정규화된 모델에서 일관성 보장</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>  1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>  2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>  3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>  4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>  5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6>  6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7>  7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8>  8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9>  9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10> 10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11> 11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12> 12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13> 13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14> 14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15> 15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16> 16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17> 17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18> 18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19> 19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20> 20</a>
</span><span class=lnt id=hl-31-21><a class=lnlinks href=#hl-31-21> 21</a>
</span><span class=lnt id=hl-31-22><a class=lnlinks href=#hl-31-22> 22</a>
</span><span class=lnt id=hl-31-23><a class=lnlinks href=#hl-31-23> 23</a>
</span><span class=lnt id=hl-31-24><a class=lnlinks href=#hl-31-24> 24</a>
</span><span class=lnt id=hl-31-25><a class=lnlinks href=#hl-31-25> 25</a>
</span><span class=lnt id=hl-31-26><a class=lnlinks href=#hl-31-26> 26</a>
</span><span class=lnt id=hl-31-27><a class=lnlinks href=#hl-31-27> 27</a>
</span><span class=lnt id=hl-31-28><a class=lnlinks href=#hl-31-28> 28</a>
</span><span class=lnt id=hl-31-29><a class=lnlinks href=#hl-31-29> 29</a>
</span><span class=lnt id=hl-31-30><a class=lnlinks href=#hl-31-30> 30</a>
</span><span class=lnt id=hl-31-31><a class=lnlinks href=#hl-31-31> 31</a>
</span><span class=lnt id=hl-31-32><a class=lnlinks href=#hl-31-32> 32</a>
</span><span class=lnt id=hl-31-33><a class=lnlinks href=#hl-31-33> 33</a>
</span><span class=lnt id=hl-31-34><a class=lnlinks href=#hl-31-34> 34</a>
</span><span class=lnt id=hl-31-35><a class=lnlinks href=#hl-31-35> 35</a>
</span><span class=lnt id=hl-31-36><a class=lnlinks href=#hl-31-36> 36</a>
</span><span class=lnt id=hl-31-37><a class=lnlinks href=#hl-31-37> 37</a>
</span><span class=lnt id=hl-31-38><a class=lnlinks href=#hl-31-38> 38</a>
</span><span class=lnt id=hl-31-39><a class=lnlinks href=#hl-31-39> 39</a>
</span><span class=lnt id=hl-31-40><a class=lnlinks href=#hl-31-40> 40</a>
</span><span class=lnt id=hl-31-41><a class=lnlinks href=#hl-31-41> 41</a>
</span><span class=lnt id=hl-31-42><a class=lnlinks href=#hl-31-42> 42</a>
</span><span class=lnt id=hl-31-43><a class=lnlinks href=#hl-31-43> 43</a>
</span><span class=lnt id=hl-31-44><a class=lnlinks href=#hl-31-44> 44</a>
</span><span class=lnt id=hl-31-45><a class=lnlinks href=#hl-31-45> 45</a>
</span><span class=lnt id=hl-31-46><a class=lnlinks href=#hl-31-46> 46</a>
</span><span class=lnt id=hl-31-47><a class=lnlinks href=#hl-31-47> 47</a>
</span><span class=lnt id=hl-31-48><a class=lnlinks href=#hl-31-48> 48</a>
</span><span class=lnt id=hl-31-49><a class=lnlinks href=#hl-31-49> 49</a>
</span><span class=lnt id=hl-31-50><a class=lnlinks href=#hl-31-50> 50</a>
</span><span class=lnt id=hl-31-51><a class=lnlinks href=#hl-31-51> 51</a>
</span><span class=lnt id=hl-31-52><a class=lnlinks href=#hl-31-52> 52</a>
</span><span class=lnt id=hl-31-53><a class=lnlinks href=#hl-31-53> 53</a>
</span><span class=lnt id=hl-31-54><a class=lnlinks href=#hl-31-54> 54</a>
</span><span class=lnt id=hl-31-55><a class=lnlinks href=#hl-31-55> 55</a>
</span><span class=lnt id=hl-31-56><a class=lnlinks href=#hl-31-56> 56</a>
</span><span class=lnt id=hl-31-57><a class=lnlinks href=#hl-31-57> 57</a>
</span><span class=lnt id=hl-31-58><a class=lnlinks href=#hl-31-58> 58</a>
</span><span class=lnt id=hl-31-59><a class=lnlinks href=#hl-31-59> 59</a>
</span><span class=lnt id=hl-31-60><a class=lnlinks href=#hl-31-60> 60</a>
</span><span class=lnt id=hl-31-61><a class=lnlinks href=#hl-31-61> 61</a>
</span><span class=lnt id=hl-31-62><a class=lnlinks href=#hl-31-62> 62</a>
</span><span class=lnt id=hl-31-63><a class=lnlinks href=#hl-31-63> 63</a>
</span><span class=lnt id=hl-31-64><a class=lnlinks href=#hl-31-64> 64</a>
</span><span class=lnt id=hl-31-65><a class=lnlinks href=#hl-31-65> 65</a>
</span><span class=lnt id=hl-31-66><a class=lnlinks href=#hl-31-66> 66</a>
</span><span class=lnt id=hl-31-67><a class=lnlinks href=#hl-31-67> 67</a>
</span><span class=lnt id=hl-31-68><a class=lnlinks href=#hl-31-68> 68</a>
</span><span class=lnt id=hl-31-69><a class=lnlinks href=#hl-31-69> 69</a>
</span><span class=lnt id=hl-31-70><a class=lnlinks href=#hl-31-70> 70</a>
</span><span class=lnt id=hl-31-71><a class=lnlinks href=#hl-31-71> 71</a>
</span><span class=lnt id=hl-31-72><a class=lnlinks href=#hl-31-72> 72</a>
</span><span class=lnt id=hl-31-73><a class=lnlinks href=#hl-31-73> 73</a>
</span><span class=lnt id=hl-31-74><a class=lnlinks href=#hl-31-74> 74</a>
</span><span class=lnt id=hl-31-75><a class=lnlinks href=#hl-31-75> 75</a>
</span><span class=lnt id=hl-31-76><a class=lnlinks href=#hl-31-76> 76</a>
</span><span class=lnt id=hl-31-77><a class=lnlinks href=#hl-31-77> 77</a>
</span><span class=lnt id=hl-31-78><a class=lnlinks href=#hl-31-78> 78</a>
</span><span class=lnt id=hl-31-79><a class=lnlinks href=#hl-31-79> 79</a>
</span><span class=lnt id=hl-31-80><a class=lnlinks href=#hl-31-80> 80</a>
</span><span class=lnt id=hl-31-81><a class=lnlinks href=#hl-31-81> 81</a>
</span><span class=lnt id=hl-31-82><a class=lnlinks href=#hl-31-82> 82</a>
</span><span class=lnt id=hl-31-83><a class=lnlinks href=#hl-31-83> 83</a>
</span><span class=lnt id=hl-31-84><a class=lnlinks href=#hl-31-84> 84</a>
</span><span class=lnt id=hl-31-85><a class=lnlinks href=#hl-31-85> 85</a>
</span><span class=lnt id=hl-31-86><a class=lnlinks href=#hl-31-86> 86</a>
</span><span class=lnt id=hl-31-87><a class=lnlinks href=#hl-31-87> 87</a>
</span><span class=lnt id=hl-31-88><a class=lnlinks href=#hl-31-88> 88</a>
</span><span class=lnt id=hl-31-89><a class=lnlinks href=#hl-31-89> 89</a>
</span><span class=lnt id=hl-31-90><a class=lnlinks href=#hl-31-90> 90</a>
</span><span class=lnt id=hl-31-91><a class=lnlinks href=#hl-31-91> 91</a>
</span><span class=lnt id=hl-31-92><a class=lnlinks href=#hl-31-92> 92</a>
</span><span class=lnt id=hl-31-93><a class=lnlinks href=#hl-31-93> 93</a>
</span><span class=lnt id=hl-31-94><a class=lnlinks href=#hl-31-94> 94</a>
</span><span class=lnt id=hl-31-95><a class=lnlinks href=#hl-31-95> 95</a>
</span><span class=lnt id=hl-31-96><a class=lnlinks href=#hl-31-96> 96</a>
</span><span class=lnt id=hl-31-97><a class=lnlinks href=#hl-31-97> 97</a>
</span><span class=lnt id=hl-31-98><a class=lnlinks href=#hl-31-98> 98</a>
</span><span class=lnt id=hl-31-99><a class=lnlinks href=#hl-31-99> 99</a>
</span><span class=lnt id=hl-31-100><a class=lnlinks href=#hl-31-100>100</a>
</span><span class=lnt id=hl-31-101><a class=lnlinks href=#hl-31-101>101</a>
</span><span class=lnt id=hl-31-102><a class=lnlinks href=#hl-31-102>102</a>
</span><span class=lnt id=hl-31-103><a class=lnlinks href=#hl-31-103>103</a>
</span><span class=lnt id=hl-31-104><a class=lnlinks href=#hl-31-104>104</a>
</span><span class=lnt id=hl-31-105><a class=lnlinks href=#hl-31-105>105</a>
</span><span class=lnt id=hl-31-106><a class=lnlinks href=#hl-31-106>106</a>
</span><span class=lnt id=hl-31-107><a class=lnlinks href=#hl-31-107>107</a>
</span><span class=lnt id=hl-31-108><a class=lnlinks href=#hl-31-108>108</a>
</span><span class=lnt id=hl-31-109><a class=lnlinks href=#hl-31-109>109</a>
</span><span class=lnt id=hl-31-110><a class=lnlinks href=#hl-31-110>110</a>
</span><span class=lnt id=hl-31-111><a class=lnlinks href=#hl-31-111>111</a>
</span><span class=lnt id=hl-31-112><a class=lnlinks href=#hl-31-112>112</a>
</span><span class=lnt id=hl-31-113><a class=lnlinks href=#hl-31-113>113</a>
</span><span class=lnt id=hl-31-114><a class=lnlinks href=#hl-31-114>114</a>
</span><span class=lnt id=hl-31-115><a class=lnlinks href=#hl-31-115>115</a>
</span><span class=lnt id=hl-31-116><a class=lnlinks href=#hl-31-116>116</a>
</span><span class=lnt id=hl-31-117><a class=lnlinks href=#hl-31-117>117</a>
</span><span class=lnt id=hl-31-118><a class=lnlinks href=#hl-31-118>118</a>
</span><span class=lnt id=hl-31-119><a class=lnlinks href=#hl-31-119>119</a>
</span><span class=lnt id=hl-31-120><a class=lnlinks href=#hl-31-120>120</a>
</span><span class=lnt id=hl-31-121><a class=lnlinks href=#hl-31-121>121</a>
</span><span class=lnt id=hl-31-122><a class=lnlinks href=#hl-31-122>122</a>
</span><span class=lnt id=hl-31-123><a class=lnlinks href=#hl-31-123>123</a>
</span><span class=lnt id=hl-31-124><a class=lnlinks href=#hl-31-124>124</a>
</span><span class=lnt id=hl-31-125><a class=lnlinks href=#hl-31-125>125</a>
</span><span class=lnt id=hl-31-126><a class=lnlinks href=#hl-31-126>126</a>
</span><span class=lnt id=hl-31-127><a class=lnlinks href=#hl-31-127>127</a>
</span><span class=lnt id=hl-31-128><a class=lnlinks href=#hl-31-128>128</a>
</span><span class=lnt id=hl-31-129><a class=lnlinks href=#hl-31-129>129</a>
</span><span class=lnt id=hl-31-130><a class=lnlinks href=#hl-31-130>130</a>
</span><span class=lnt id=hl-31-131><a class=lnlinks href=#hl-31-131>131</a>
</span><span class=lnt id=hl-31-132><a class=lnlinks href=#hl-31-132>132</a>
</span><span class=lnt id=hl-31-133><a class=lnlinks href=#hl-31-133>133</a>
</span><span class=lnt id=hl-31-134><a class=lnlinks href=#hl-31-134>134</a>
</span><span class=lnt id=hl-31-135><a class=lnlinks href=#hl-31-135>135</a>
</span><span class=lnt id=hl-31-136><a class=lnlinks href=#hl-31-136>136</a>
</span><span class=lnt id=hl-31-137><a class=lnlinks href=#hl-31-137>137</a>
</span><span class=lnt id=hl-31-138><a class=lnlinks href=#hl-31-138>138</a>
</span><span class=lnt id=hl-31-139><a class=lnlinks href=#hl-31-139>139</a>
</span><span class=lnt id=hl-31-140><a class=lnlinks href=#hl-31-140>140</a>
</span><span class=lnt id=hl-31-141><a class=lnlinks href=#hl-31-141>141</a>
</span><span class=lnt id=hl-31-142><a class=lnlinks href=#hl-31-142>142</a>
</span><span class=lnt id=hl-31-143><a class=lnlinks href=#hl-31-143>143</a>
</span><span class=lnt id=hl-31-144><a class=lnlinks href=#hl-31-144>144</a>
</span><span class=lnt id=hl-31-145><a class=lnlinks href=#hl-31-145>145</a>
</span><span class=lnt id=hl-31-146><a class=lnlinks href=#hl-31-146>146</a>
</span><span class=lnt id=hl-31-147><a class=lnlinks href=#hl-31-147>147</a>
</span><span class=lnt id=hl-31-148><a class=lnlinks href=#hl-31-148>148</a>
</span><span class=lnt id=hl-31-149><a class=lnlinks href=#hl-31-149>149</a>
</span><span class=lnt id=hl-31-150><a class=lnlinks href=#hl-31-150>150</a>
</span><span class=lnt id=hl-31-151><a class=lnlinks href=#hl-31-151>151</a>
</span><span class=lnt id=hl-31-152><a class=lnlinks href=#hl-31-152>152</a>
</span><span class=lnt id=hl-31-153><a class=lnlinks href=#hl-31-153>153</a>
</span><span class=lnt id=hl-31-154><a class=lnlinks href=#hl-31-154>154</a>
</span><span class=lnt id=hl-31-155><a class=lnlinks href=#hl-31-155>155</a>
</span><span class=lnt id=hl-31-156><a class=lnlinks href=#hl-31-156>156</a>
</span><span class=lnt id=hl-31-157><a class=lnlinks href=#hl-31-157>157</a>
</span><span class=lnt id=hl-31-158><a class=lnlinks href=#hl-31-158>158</a>
</span><span class=lnt id=hl-31-159><a class=lnlinks href=#hl-31-159>159</a>
</span><span class=lnt id=hl-31-160><a class=lnlinks href=#hl-31-160>160</a>
</span><span class=lnt id=hl-31-161><a class=lnlinks href=#hl-31-161>161</a>
</span><span class=lnt id=hl-31-162><a class=lnlinks href=#hl-31-162>162</a>
</span><span class=lnt id=hl-31-163><a class=lnlinks href=#hl-31-163>163</a>
</span><span class=lnt id=hl-31-164><a class=lnlinks href=#hl-31-164>164</a>
</span><span class=lnt id=hl-31-165><a class=lnlinks href=#hl-31-165>165</a>
</span><span class=lnt id=hl-31-166><a class=lnlinks href=#hl-31-166>166</a>
</span><span class=lnt id=hl-31-167><a class=lnlinks href=#hl-31-167>167</a>
</span><span class=lnt id=hl-31-168><a class=lnlinks href=#hl-31-168>168</a>
</span><span class=lnt id=hl-31-169><a class=lnlinks href=#hl-31-169>169</a>
</span><span class=lnt id=hl-31-170><a class=lnlinks href=#hl-31-170>170</a>
</span><span class=lnt id=hl-31-171><a class=lnlinks href=#hl-31-171>171</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 1. 도메인 모델 (Domain Model)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 애그리게이트 (Order Aggregate)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=s1>&#39;OrderItem&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_total</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;총 주문 금액 계산 - 도메인 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>sum</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>price</span> <span class=o>*</span> <span class=n>item</span><span class=o>.</span><span class=n>quantity</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>confirm</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확정 - 비즈니스 규칙 적용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=s1>&#39;pending&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;이미 처리된 주문입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;confirmed&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 명령 핸들러 (Command Handler)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreateOrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>repository</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>repository</span> <span class=o>=</span> <span class=n>repository</span>  <span class=c1># PostgreSQL 저장소</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>    <span class=c1># Kafka 이벤트 버스</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=s1>&#39;CreateOrderCommand&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 도메인 객체 생성 및 검증</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>customer_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span><span class=o>=</span><span class=s1>&#39;pending&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>created_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>total_amount</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>calculate_total</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>confirm</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 영속성 저장 (PostgreSQL)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행 (비동기 처리를 위한 이벤트)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>OrderCreatedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span><span class=o>=</span><span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>customer_id</span><span class=o>=</span><span class=n>order</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>total_amount</span><span class=o>=</span><span class=n>order</span><span class=o>.</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=o>=</span><span class=n>order</span><span class=o>.</span><span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 조회 핸들러 (Query Handler)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>elasticsearch_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>           <span class=c1># 빠른 조회용</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>elasticsearch</span> <span class=o>=</span> <span class=n>elasticsearch_client</span>  <span class=c1># 검색용</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_order_summary</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 요약 조회 - Redis에서 빠른 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Redis에서 비정규화된 주문 요약 데이터 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>order_data</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>hgetall</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_name&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customer_name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;total_amount&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;item_count&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;item_count&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>search_orders</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 검색 - Elasticsearch에서 검색&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>search_body</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;bool&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;must&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span><span class=s2>&#34;match&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>}},</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span><span class=s2>&#34;multi_match&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;fields&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;items.name&#34;</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                        <span class=p>}}</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>elasticsearch</span><span class=o>.</span><span class=n>search</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>index</span><span class=o>=</span><span class=s2>&#34;orders&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>search_body</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>hit</span><span class=p>[</span><span class=s1>&#39;_source&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>hit</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;hits&#39;</span><span class=p>][</span><span class=s1>&#39;hits&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 프로젝션 핸들러 (Projection Handler)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjectionHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>elasticsearch_client</span><span class=p>,</span> <span class=n>customer_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>elasticsearch</span> <span class=o>=</span> <span class=n>elasticsearch_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_service</span> <span class=o>=</span> <span class=n>customer_service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=s1>&#39;OrderCreatedEvent&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 처리 - 읽기 모델 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 고객 정보 조회 (외부 서비스 호출)</span>
</span></span><span class=line><span class=cl>        <span class=n>customer</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>customer_service</span><span class=o>.</span><span class=n>get_customer</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>customer_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis에 주문 요약 저장 (빠른 조회용)</span>
</span></span><span class=line><span class=cl>        <span class=n>order_summary</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_name&#39;</span><span class=p>:</span> <span class=n>customer</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>total_amount</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;confirmed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;item_count&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>items</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=n>order_summary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Elasticsearch에 검색용 문서 저장</span>
</span></span><span class=line><span class=cl>        <span class=n>search_document</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_name&#39;</span><span class=p>:</span> <span class=n>customer</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;confirmed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=p>[{</span><span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>item</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=s1>&#39;category&#39;</span><span class=p>:</span> <span class=n>item</span><span class=o>.</span><span class=n>category</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>                     <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>event</span><span class=o>.</span><span class=n>items</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>elasticsearch</span><span class=o>.</span><span class=n>index</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>index</span><span class=o>=</span><span class=s2>&#34;orders&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>search_document</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. API 엔드포인트 (FastAPI 예시)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 명령 API 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=n>command</span><span class=p>:</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 생성 - 명령 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>order_command_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;주문이 성공적으로 생성되었습니다&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 조회 API 엔드포인트  </span>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 조회 - 쿼리 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_query_handler</span><span class=o>.</span><span class=n>get_order_summary</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>404</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;주문을 찾을 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/customers/</span><span class=si>{customer_id}</span><span class=s2>/orders/search&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>search_customer_orders</span><span class=p>(</span><span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>q</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;고객 주문 검색 - 복잡한 쿼리 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>orders</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_query_handler</span><span class=o>.</span><span class=n>search_orders</span><span class=p>(</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;orders&#34;</span><span class=p>:</span> <span class=n>orders</span><span class=p>,</span> <span class=s2>&#34;total&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>orders</span><span class=p>)}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현-2>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현-2>#</a></h4><p><strong>시나리오</strong>: Netflix 스타일의 개인화 추천 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>명령 측: 사용자 행동 데이터 수집 (Cassandra)</li><li>조회 측: 추천 결과 제공 (Redis, MongoDB)</li><li>이벤트 스트리밍: Apache Kafka</li><li>머신러닝 파이프라인: Apache Spark</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    User[사용자] --&gt; API[추천 API]
    
    subgraph &#34;명령 측면 (행동 수집)&#34;
        API --&gt; TrackingAPI[행동 추적 API]
        TrackingAPI --&gt; Kafka[Apache Kafka]
        Kafka --&gt; Cassandra[(Cassandra)]
    end
    
    subgraph &#34;ML 파이프라인&#34;  
        Cassandra --&gt; Spark[Apache Spark]
        Spark --&gt; MLModel[ML 모델]
    end
    
    subgraph &#34;조회 측면 (추천 제공)&#34;
        API --&gt; RecommendAPI[추천 조회 API]
        RecommendAPI --&gt; Redis[(Redis)]
        RecommendAPI --&gt; MongoDB[(MongoDB)]
    end
    
    MLModel --&gt; Redis
    MLModel --&gt; MongoDB
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 행동 데이터 실시간 수집 및 Kafka로 스트리밍</li><li>Cassandra에 원시 행동 데이터 저장</li><li>Spark가 배치로 데이터를 처리하여 ML 모델 훈련</li><li>개인화된 추천 결과를 Redis/MongoDB에 저장</li><li>사용자 요청 시 사전 계산된 추천 결과 즉시 반환</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>CQRS를 통해 데이터 수집과 추천 제공을 완전히 분리</li><li>실시간 수집과 배치 처리의 하이브리드 아키텍처</li><li>개인화 추천의 낮은 레이턴시 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 사용자 요청 시 실시간 추천 계산으로 높은 지연시간</li><li><strong>도입 후</strong>: 사전 계산된 추천 결과로 밀리초 단위 응답</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>  1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>  2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3>  3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4>  4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5>  5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6>  6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7>  7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8>  8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9>  9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10> 10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11> 11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12> 12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13> 13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14> 14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15> 15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16> 16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17> 17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18> 18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19> 19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20> 20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21> 21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22> 22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23> 23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24> 24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25> 25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26> 26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27> 27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28> 28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29> 29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30> 30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31> 31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32> 32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33> 33</a>
</span><span class=lnt id=hl-33-34><a class=lnlinks href=#hl-33-34> 34</a>
</span><span class=lnt id=hl-33-35><a class=lnlinks href=#hl-33-35> 35</a>
</span><span class=lnt id=hl-33-36><a class=lnlinks href=#hl-33-36> 36</a>
</span><span class=lnt id=hl-33-37><a class=lnlinks href=#hl-33-37> 37</a>
</span><span class=lnt id=hl-33-38><a class=lnlinks href=#hl-33-38> 38</a>
</span><span class=lnt id=hl-33-39><a class=lnlinks href=#hl-33-39> 39</a>
</span><span class=lnt id=hl-33-40><a class=lnlinks href=#hl-33-40> 40</a>
</span><span class=lnt id=hl-33-41><a class=lnlinks href=#hl-33-41> 41</a>
</span><span class=lnt id=hl-33-42><a class=lnlinks href=#hl-33-42> 42</a>
</span><span class=lnt id=hl-33-43><a class=lnlinks href=#hl-33-43> 43</a>
</span><span class=lnt id=hl-33-44><a class=lnlinks href=#hl-33-44> 44</a>
</span><span class=lnt id=hl-33-45><a class=lnlinks href=#hl-33-45> 45</a>
</span><span class=lnt id=hl-33-46><a class=lnlinks href=#hl-33-46> 46</a>
</span><span class=lnt id=hl-33-47><a class=lnlinks href=#hl-33-47> 47</a>
</span><span class=lnt id=hl-33-48><a class=lnlinks href=#hl-33-48> 48</a>
</span><span class=lnt id=hl-33-49><a class=lnlinks href=#hl-33-49> 49</a>
</span><span class=lnt id=hl-33-50><a class=lnlinks href=#hl-33-50> 50</a>
</span><span class=lnt id=hl-33-51><a class=lnlinks href=#hl-33-51> 51</a>
</span><span class=lnt id=hl-33-52><a class=lnlinks href=#hl-33-52> 52</a>
</span><span class=lnt id=hl-33-53><a class=lnlinks href=#hl-33-53> 53</a>
</span><span class=lnt id=hl-33-54><a class=lnlinks href=#hl-33-54> 54</a>
</span><span class=lnt id=hl-33-55><a class=lnlinks href=#hl-33-55> 55</a>
</span><span class=lnt id=hl-33-56><a class=lnlinks href=#hl-33-56> 56</a>
</span><span class=lnt id=hl-33-57><a class=lnlinks href=#hl-33-57> 57</a>
</span><span class=lnt id=hl-33-58><a class=lnlinks href=#hl-33-58> 58</a>
</span><span class=lnt id=hl-33-59><a class=lnlinks href=#hl-33-59> 59</a>
</span><span class=lnt id=hl-33-60><a class=lnlinks href=#hl-33-60> 60</a>
</span><span class=lnt id=hl-33-61><a class=lnlinks href=#hl-33-61> 61</a>
</span><span class=lnt id=hl-33-62><a class=lnlinks href=#hl-33-62> 62</a>
</span><span class=lnt id=hl-33-63><a class=lnlinks href=#hl-33-63> 63</a>
</span><span class=lnt id=hl-33-64><a class=lnlinks href=#hl-33-64> 64</a>
</span><span class=lnt id=hl-33-65><a class=lnlinks href=#hl-33-65> 65</a>
</span><span class=lnt id=hl-33-66><a class=lnlinks href=#hl-33-66> 66</a>
</span><span class=lnt id=hl-33-67><a class=lnlinks href=#hl-33-67> 67</a>
</span><span class=lnt id=hl-33-68><a class=lnlinks href=#hl-33-68> 68</a>
</span><span class=lnt id=hl-33-69><a class=lnlinks href=#hl-33-69> 69</a>
</span><span class=lnt id=hl-33-70><a class=lnlinks href=#hl-33-70> 70</a>
</span><span class=lnt id=hl-33-71><a class=lnlinks href=#hl-33-71> 71</a>
</span><span class=lnt id=hl-33-72><a class=lnlinks href=#hl-33-72> 72</a>
</span><span class=lnt id=hl-33-73><a class=lnlinks href=#hl-33-73> 73</a>
</span><span class=lnt id=hl-33-74><a class=lnlinks href=#hl-33-74> 74</a>
</span><span class=lnt id=hl-33-75><a class=lnlinks href=#hl-33-75> 75</a>
</span><span class=lnt id=hl-33-76><a class=lnlinks href=#hl-33-76> 76</a>
</span><span class=lnt id=hl-33-77><a class=lnlinks href=#hl-33-77> 77</a>
</span><span class=lnt id=hl-33-78><a class=lnlinks href=#hl-33-78> 78</a>
</span><span class=lnt id=hl-33-79><a class=lnlinks href=#hl-33-79> 79</a>
</span><span class=lnt id=hl-33-80><a class=lnlinks href=#hl-33-80> 80</a>
</span><span class=lnt id=hl-33-81><a class=lnlinks href=#hl-33-81> 81</a>
</span><span class=lnt id=hl-33-82><a class=lnlinks href=#hl-33-82> 82</a>
</span><span class=lnt id=hl-33-83><a class=lnlinks href=#hl-33-83> 83</a>
</span><span class=lnt id=hl-33-84><a class=lnlinks href=#hl-33-84> 84</a>
</span><span class=lnt id=hl-33-85><a class=lnlinks href=#hl-33-85> 85</a>
</span><span class=lnt id=hl-33-86><a class=lnlinks href=#hl-33-86> 86</a>
</span><span class=lnt id=hl-33-87><a class=lnlinks href=#hl-33-87> 87</a>
</span><span class=lnt id=hl-33-88><a class=lnlinks href=#hl-33-88> 88</a>
</span><span class=lnt id=hl-33-89><a class=lnlinks href=#hl-33-89> 89</a>
</span><span class=lnt id=hl-33-90><a class=lnlinks href=#hl-33-90> 90</a>
</span><span class=lnt id=hl-33-91><a class=lnlinks href=#hl-33-91> 91</a>
</span><span class=lnt id=hl-33-92><a class=lnlinks href=#hl-33-92> 92</a>
</span><span class=lnt id=hl-33-93><a class=lnlinks href=#hl-33-93> 93</a>
</span><span class=lnt id=hl-33-94><a class=lnlinks href=#hl-33-94> 94</a>
</span><span class=lnt id=hl-33-95><a class=lnlinks href=#hl-33-95> 95</a>
</span><span class=lnt id=hl-33-96><a class=lnlinks href=#hl-33-96> 96</a>
</span><span class=lnt id=hl-33-97><a class=lnlinks href=#hl-33-97> 97</a>
</span><span class=lnt id=hl-33-98><a class=lnlinks href=#hl-33-98> 98</a>
</span><span class=lnt id=hl-33-99><a class=lnlinks href=#hl-33-99> 99</a>
</span><span class=lnt id=hl-33-100><a class=lnlinks href=#hl-33-100>100</a>
</span><span class=lnt id=hl-33-101><a class=lnlinks href=#hl-33-101>101</a>
</span><span class=lnt id=hl-33-102><a class=lnlinks href=#hl-33-102>102</a>
</span><span class=lnt id=hl-33-103><a class=lnlinks href=#hl-33-103>103</a>
</span><span class=lnt id=hl-33-104><a class=lnlinks href=#hl-33-104>104</a>
</span><span class=lnt id=hl-33-105><a class=lnlinks href=#hl-33-105>105</a>
</span><span class=lnt id=hl-33-106><a class=lnlinks href=#hl-33-106>106</a>
</span><span class=lnt id=hl-33-107><a class=lnlinks href=#hl-33-107>107</a>
</span><span class=lnt id=hl-33-108><a class=lnlinks href=#hl-33-108>108</a>
</span><span class=lnt id=hl-33-109><a class=lnlinks href=#hl-33-109>109</a>
</span><span class=lnt id=hl-33-110><a class=lnlinks href=#hl-33-110>110</a>
</span><span class=lnt id=hl-33-111><a class=lnlinks href=#hl-33-111>111</a>
</span><span class=lnt id=hl-33-112><a class=lnlinks href=#hl-33-112>112</a>
</span><span class=lnt id=hl-33-113><a class=lnlinks href=#hl-33-113>113</a>
</span><span class=lnt id=hl-33-114><a class=lnlinks href=#hl-33-114>114</a>
</span><span class=lnt id=hl-33-115><a class=lnlinks href=#hl-33-115>115</a>
</span><span class=lnt id=hl-33-116><a class=lnlinks href=#hl-33-116>116</a>
</span><span class=lnt id=hl-33-117><a class=lnlinks href=#hl-33-117>117</a>
</span><span class=lnt id=hl-33-118><a class=lnlinks href=#hl-33-118>118</a>
</span><span class=lnt id=hl-33-119><a class=lnlinks href=#hl-33-119>119</a>
</span><span class=lnt id=hl-33-120><a class=lnlinks href=#hl-33-120>120</a>
</span><span class=lnt id=hl-33-121><a class=lnlinks href=#hl-33-121>121</a>
</span><span class=lnt id=hl-33-122><a class=lnlinks href=#hl-33-122>122</a>
</span><span class=lnt id=hl-33-123><a class=lnlinks href=#hl-33-123>123</a>
</span><span class=lnt id=hl-33-124><a class=lnlinks href=#hl-33-124>124</a>
</span><span class=lnt id=hl-33-125><a class=lnlinks href=#hl-33-125>125</a>
</span><span class=lnt id=hl-33-126><a class=lnlinks href=#hl-33-126>126</a>
</span><span class=lnt id=hl-33-127><a class=lnlinks href=#hl-33-127>127</a>
</span><span class=lnt id=hl-33-128><a class=lnlinks href=#hl-33-128>128</a>
</span><span class=lnt id=hl-33-129><a class=lnlinks href=#hl-33-129>129</a>
</span><span class=lnt id=hl-33-130><a class=lnlinks href=#hl-33-130>130</a>
</span><span class=lnt id=hl-33-131><a class=lnlinks href=#hl-33-131>131</a>
</span><span class=lnt id=hl-33-132><a class=lnlinks href=#hl-33-132>132</a>
</span><span class=lnt id=hl-33-133><a class=lnlinks href=#hl-33-133>133</a>
</span><span class=lnt id=hl-33-134><a class=lnlinks href=#hl-33-134>134</a>
</span><span class=lnt id=hl-33-135><a class=lnlinks href=#hl-33-135>135</a>
</span><span class=lnt id=hl-33-136><a class=lnlinks href=#hl-33-136>136</a>
</span><span class=lnt id=hl-33-137><a class=lnlinks href=#hl-33-137>137</a>
</span><span class=lnt id=hl-33-138><a class=lnlinks href=#hl-33-138>138</a>
</span><span class=lnt id=hl-33-139><a class=lnlinks href=#hl-33-139>139</a>
</span><span class=lnt id=hl-33-140><a class=lnlinks href=#hl-33-140>140</a>
</span><span class=lnt id=hl-33-141><a class=lnlinks href=#hl-33-141>141</a>
</span><span class=lnt id=hl-33-142><a class=lnlinks href=#hl-33-142>142</a>
</span><span class=lnt id=hl-33-143><a class=lnlinks href=#hl-33-143>143</a>
</span><span class=lnt id=hl-33-144><a class=lnlinks href=#hl-33-144>144</a>
</span><span class=lnt id=hl-33-145><a class=lnlinks href=#hl-33-145>145</a>
</span><span class=lnt id=hl-33-146><a class=lnlinks href=#hl-33-146>146</a>
</span><span class=lnt id=hl-33-147><a class=lnlinks href=#hl-33-147>147</a>
</span><span class=lnt id=hl-33-148><a class=lnlinks href=#hl-33-148>148</a>
</span><span class=lnt id=hl-33-149><a class=lnlinks href=#hl-33-149>149</a>
</span><span class=lnt id=hl-33-150><a class=lnlinks href=#hl-33-150>150</a>
</span><span class=lnt id=hl-33-151><a class=lnlinks href=#hl-33-151>151</a>
</span><span class=lnt id=hl-33-152><a class=lnlinks href=#hl-33-152>152</a>
</span><span class=lnt id=hl-33-153><a class=lnlinks href=#hl-33-153>153</a>
</span><span class=lnt id=hl-33-154><a class=lnlinks href=#hl-33-154>154</a>
</span><span class=lnt id=hl-33-155><a class=lnlinks href=#hl-33-155>155</a>
</span><span class=lnt id=hl-33-156><a class=lnlinks href=#hl-33-156>156</a>
</span><span class=lnt id=hl-33-157><a class=lnlinks href=#hl-33-157>157</a>
</span><span class=lnt id=hl-33-158><a class=lnlinks href=#hl-33-158>158</a>
</span><span class=lnt id=hl-33-159><a class=lnlinks href=#hl-33-159>159</a>
</span><span class=lnt id=hl-33-160><a class=lnlinks href=#hl-33-160>160</a>
</span><span class=lnt id=hl-33-161><a class=lnlinks href=#hl-33-161>161</a>
</span><span class=lnt id=hl-33-162><a class=lnlinks href=#hl-33-162>162</a>
</span><span class=lnt id=hl-33-163><a class=lnlinks href=#hl-33-163>163</a>
</span><span class=lnt id=hl-33-164><a class=lnlinks href=#hl-33-164>164</a>
</span><span class=lnt id=hl-33-165><a class=lnlinks href=#hl-33-165>165</a>
</span><span class=lnt id=hl-33-166><a class=lnlinks href=#hl-33-166>166</a>
</span><span class=lnt id=hl-33-167><a class=lnlinks href=#hl-33-167>167</a>
</span><span class=lnt id=hl-33-168><a class=lnlinks href=#hl-33-168>168</a>
</span><span class=lnt id=hl-33-169><a class=lnlinks href=#hl-33-169>169</a>
</span><span class=lnt id=hl-33-170><a class=lnlinks href=#hl-33-170>170</a>
</span><span class=lnt id=hl-33-171><a class=lnlinks href=#hl-33-171>171</a>
</span><span class=lnt id=hl-33-172><a class=lnlinks href=#hl-33-172>172</a>
</span><span class=lnt id=hl-33-173><a class=lnlinks href=#hl-33-173>173</a>
</span><span class=lnt id=hl-33-174><a class=lnlinks href=#hl-33-174>174</a>
</span><span class=lnt id=hl-33-175><a class=lnlinks href=#hl-33-175>175</a>
</span><span class=lnt id=hl-33-176><a class=lnlinks href=#hl-33-176>176</a>
</span><span class=lnt id=hl-33-177><a class=lnlinks href=#hl-33-177>177</a>
</span><span class=lnt id=hl-33-178><a class=lnlinks href=#hl-33-178>178</a>
</span><span class=lnt id=hl-33-179><a class=lnlinks href=#hl-33-179>179</a>
</span><span class=lnt id=hl-33-180><a class=lnlinks href=#hl-33-180>180</a>
</span><span class=lnt id=hl-33-181><a class=lnlinks href=#hl-33-181>181</a>
</span><span class=lnt id=hl-33-182><a class=lnlinks href=#hl-33-182>182</a>
</span><span class=lnt id=hl-33-183><a class=lnlinks href=#hl-33-183>183</a>
</span><span class=lnt id=hl-33-184><a class=lnlinks href=#hl-33-184>184</a>
</span><span class=lnt id=hl-33-185><a class=lnlinks href=#hl-33-185>185</a>
</span><span class=lnt id=hl-33-186><a class=lnlinks href=#hl-33-186>186</a>
</span><span class=lnt id=hl-33-187><a class=lnlinks href=#hl-33-187>187</a>
</span><span class=lnt id=hl-33-188><a class=lnlinks href=#hl-33-188>188</a>
</span><span class=lnt id=hl-33-189><a class=lnlinks href=#hl-33-189>189</a>
</span><span class=lnt id=hl-33-190><a class=lnlinks href=#hl-33-190>190</a>
</span><span class=lnt id=hl-33-191><a class=lnlinks href=#hl-33-191>191</a>
</span><span class=lnt id=hl-33-192><a class=lnlinks href=#hl-33-192>192</a>
</span><span class=lnt id=hl-33-193><a class=lnlinks href=#hl-33-193>193</a>
</span><span class=lnt id=hl-33-194><a class=lnlinks href=#hl-33-194>194</a>
</span><span class=lnt id=hl-33-195><a class=lnlinks href=#hl-33-195>195</a>
</span><span class=lnt id=hl-33-196><a class=lnlinks href=#hl-33-196>196</a>
</span><span class=lnt id=hl-33-197><a class=lnlinks href=#hl-33-197>197</a>
</span><span class=lnt id=hl-33-198><a class=lnlinks href=#hl-33-198>198</a>
</span><span class=lnt id=hl-33-199><a class=lnlinks href=#hl-33-199>199</a>
</span><span class=lnt id=hl-33-200><a class=lnlinks href=#hl-33-200>200</a>
</span><span class=lnt id=hl-33-201><a class=lnlinks href=#hl-33-201>201</a>
</span><span class=lnt id=hl-33-202><a class=lnlinks href=#hl-33-202>202</a>
</span><span class=lnt id=hl-33-203><a class=lnlinks href=#hl-33-203>203</a>
</span><span class=lnt id=hl-33-204><a class=lnlinks href=#hl-33-204>204</a>
</span><span class=lnt id=hl-33-205><a class=lnlinks href=#hl-33-205>205</a>
</span><span class=lnt id=hl-33-206><a class=lnlinks href=#hl-33-206>206</a>
</span><span class=lnt id=hl-33-207><a class=lnlinks href=#hl-33-207>207</a>
</span><span class=lnt id=hl-33-208><a class=lnlinks href=#hl-33-208>208</a>
</span><span class=lnt id=hl-33-209><a class=lnlinks href=#hl-33-209>209</a>
</span><span class=lnt id=hl-33-210><a class=lnlinks href=#hl-33-210>210</a>
</span><span class=lnt id=hl-33-211><a class=lnlinks href=#hl-33-211>211</a>
</span><span class=lnt id=hl-33-212><a class=lnlinks href=#hl-33-212>212</a>
</span><span class=lnt id=hl-33-213><a class=lnlinks href=#hl-33-213>213</a>
</span><span class=lnt id=hl-33-214><a class=lnlinks href=#hl-33-214>214</a>
</span><span class=lnt id=hl-33-215><a class=lnlinks href=#hl-33-215>215</a>
</span><span class=lnt id=hl-33-216><a class=lnlinks href=#hl-33-216>216</a>
</span><span class=lnt id=hl-33-217><a class=lnlinks href=#hl-33-217>217</a>
</span><span class=lnt id=hl-33-218><a class=lnlinks href=#hl-33-218>218</a>
</span><span class=lnt id=hl-33-219><a class=lnlinks href=#hl-33-219>219</a>
</span><span class=lnt id=hl-33-220><a class=lnlinks href=#hl-33-220>220</a>
</span><span class=lnt id=hl-33-221><a class=lnlinks href=#hl-33-221>221</a>
</span><span class=lnt id=hl-33-222><a class=lnlinks href=#hl-33-222>222</a>
</span><span class=lnt id=hl-33-223><a class=lnlinks href=#hl-33-223>223</a>
</span><span class=lnt id=hl-33-224><a class=lnlinks href=#hl-33-224>224</a>
</span><span class=lnt id=hl-33-225><a class=lnlinks href=#hl-33-225>225</a>
</span><span class=lnt id=hl-33-226><a class=lnlinks href=#hl-33-226>226</a>
</span><span class=lnt id=hl-33-227><a class=lnlinks href=#hl-33-227>227</a>
</span><span class=lnt id=hl-33-228><a class=lnlinks href=#hl-33-228>228</a>
</span><span class=lnt id=hl-33-229><a class=lnlinks href=#hl-33-229>229</a>
</span><span class=lnt id=hl-33-230><a class=lnlinks href=#hl-33-230>230</a>
</span><span class=lnt id=hl-33-231><a class=lnlinks href=#hl-33-231>231</a>
</span><span class=lnt id=hl-33-232><a class=lnlinks href=#hl-33-232>232</a>
</span><span class=lnt id=hl-33-233><a class=lnlinks href=#hl-33-233>233</a>
</span><span class=lnt id=hl-33-234><a class=lnlinks href=#hl-33-234>234</a>
</span><span class=lnt id=hl-33-235><a class=lnlinks href=#hl-33-235>235</a>
</span><span class=lnt id=hl-33-236><a class=lnlinks href=#hl-33-236>236</a>
</span><span class=lnt id=hl-33-237><a class=lnlinks href=#hl-33-237>237</a>
</span><span class=lnt id=hl-33-238><a class=lnlinks href=#hl-33-238>238</a>
</span><span class=lnt id=hl-33-239><a class=lnlinks href=#hl-33-239>239</a>
</span><span class=lnt id=hl-33-240><a class=lnlinks href=#hl-33-240>240</a>
</span><span class=lnt id=hl-33-241><a class=lnlinks href=#hl-33-241>241</a>
</span><span class=lnt id=hl-33-242><a class=lnlinks href=#hl-33-242>242</a>
</span><span class=lnt id=hl-33-243><a class=lnlinks href=#hl-33-243>243</a>
</span><span class=lnt id=hl-33-244><a class=lnlinks href=#hl-33-244>244</a>
</span><span class=lnt id=hl-33-245><a class=lnlinks href=#hl-33-245>245</a>
</span><span class=lnt id=hl-33-246><a class=lnlinks href=#hl-33-246>246</a>
</span><span class=lnt id=hl-33-247><a class=lnlinks href=#hl-33-247>247</a>
</span><span class=lnt id=hl-33-248><a class=lnlinks href=#hl-33-248>248</a>
</span><span class=lnt id=hl-33-249><a class=lnlinks href=#hl-33-249>249</a>
</span><span class=lnt id=hl-33-250><a class=lnlinks href=#hl-33-250>250</a>
</span><span class=lnt id=hl-33-251><a class=lnlinks href=#hl-33-251>251</a>
</span><span class=lnt id=hl-33-252><a class=lnlinks href=#hl-33-252>252</a>
</span><span class=lnt id=hl-33-253><a class=lnlinks href=#hl-33-253>253</a>
</span><span class=lnt id=hl-33-254><a class=lnlinks href=#hl-33-254>254</a>
</span><span class=lnt id=hl-33-255><a class=lnlinks href=#hl-33-255>255</a>
</span><span class=lnt id=hl-33-256><a class=lnlinks href=#hl-33-256>256</a>
</span><span class=lnt id=hl-33-257><a class=lnlinks href=#hl-33-257>257</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 1. 사용자 행동 추적 명령 핸들러</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserBehaviorTrackingHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_producer</span><span class=p>,</span> <span class=n>cassandra_session</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_producer</span> <span class=o>=</span> <span class=n>kafka_producer</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cassandra</span> <span class=o>=</span> <span class=n>cassandra_session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>track_user_interaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=s1>&#39;UserInteractionEvent&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 상호작용 추적 - Netflix의 시청/평가/검색 행동&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 스트리밍을 위한 Kafka 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;interaction_type&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>interaction_type</span><span class=p>,</span>  <span class=c1># view, rate, search, click</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;interaction_value&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>  <span class=c1># 시청 시간, 평점 등</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;context&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;device_type&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>device_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;session_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>session_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;location&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>location</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Kafka로 실시간 이벤트 스트리밍</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>kafka_producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=s1>&#39;user-interactions&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Cassandra에 원시 데이터 저장 (대용량 시계열 데이터 처리)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>cassandra</span><span class=o>.</span><span class=n>execute_async</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            INSERT INTO user_interactions 
</span></span></span><span class=line><span class=cl><span class=s2>            (user_id, content_id, interaction_type, interaction_value, timestamp, context)
</span></span></span><span class=line><span class=cl><span class=s2>            VALUES (?, ?, ?, ?, ?, ?)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>interaction_type</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>interaction_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;context&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 추천 시스템 조회 핸들러</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>mongodb_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>      <span class=c1># 빠른 개인화 추천 캐시</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mongodb</span> <span class=o>=</span> <span class=n>mongodb_client</span>  <span class=c1># 복잡한 추천 메타데이터</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_personalized_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;개인화된 추천 목록 조회 - 사전 계산된 결과 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis에서 개인화된 추천 목록 조회 (밀리초 응답)</span>
</span></span><span class=line><span class=cl>        <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>category</span> <span class=ow>or</span> <span class=s1>&#39;all&#39;</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cached_recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>cached_recommendations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>recommendations</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cached_recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># MongoDB에서 상세 메타데이터 조회</span>
</span></span><span class=line><span class=cl>            <span class=n>content_ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>rec</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>recommendations</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>content_details</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>mongodb</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;contents&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=s2>&#34;_id&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;$in&#34;</span><span class=p>:</span> <span class=n>content_ids</span><span class=p>}},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;thumbnail&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;rating&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 추천 점수와 콘텐츠 상세 정보 결합</span>
</span></span><span class=line><span class=cl>            <span class=n>detailed_recommendations</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>recommendations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>content_detail</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>content_details</span> <span class=k>if</span> <span class=n>c</span><span class=p>[</span><span class=s1>&#39;_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>rec</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]),</span> 
</span></span><span class=line><span class=cl>                    <span class=kc>None</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>content_detail</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>detailed_recommendations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=o>**</span><span class=n>rec</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=o>**</span><span class=n>content_detail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;recommendation_reason&#39;</span><span class=p>:</span> <span class=n>rec</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;reason&#39;</span><span class=p>,</span> <span class=s1>&#39;당신을 위한 추천&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>detailed_recommendations</span><span class=p>[:</span><span class=mi>20</span><span class=p>]</span>  <span class=c1># 상위 20개 반환</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 캐시 미스인 경우 기본 추천 반환 (실제로는 fallback 로직)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_recommendations</span><span class=p>(</span><span class=n>category</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_trending_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time_window</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;24h&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실시간 트렌딩 콘텐츠 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>trending_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;trending:</span><span class=si>{</span><span class=n>time_window</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>trending_data</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>zrevrange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>trending_key</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=n>withscores</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=n>content_id</span><span class=o>.</span><span class=n>decode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;trending_score&#39;</span><span class=p>:</span> <span class=n>score</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;rank&#39;</span><span class=p>:</span> <span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=p>(</span><span class=n>content_id</span><span class=p>,</span> <span class=n>score</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>trending_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. ML 기반 추천 파이프라인 (배치 처리)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.ml.recommendation</span> <span class=kn>import</span> <span class=n>ALS</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.ml.feature</span> <span class=kn>import</span> <span class=n>StringIndexer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationPipelineHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>spark_session</span><span class=p>,</span> <span class=n>cassandra_config</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>spark</span> <span class=o>=</span> <span class=n>spark_session</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cassandra_config</span> <span class=o>=</span> <span class=n>cassandra_config</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주기적 추천 모델 훈련 및 결과 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Cassandra에서 사용자 행동 데이터 로드</span>
</span></span><span class=line><span class=cl>        <span class=n>user_interactions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>read</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;org.apache.spark.sql.cassandra&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>table</span><span class=o>=</span><span class=s2>&#34;user_interactions&#34;</span><span class=p>,</span> <span class=n>keyspace</span><span class=o>=</span><span class=s2>&#34;recommendations&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>load</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=s2>&#34;timestamp &gt; date_sub(current_date(), 30)&#34;</span><span class=p>)</span>  <span class=c1># 최근 30일 데이터</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 협업 필터링을 위한 데이터 전처리</span>
</span></span><span class=line><span class=cl>        <span class=n>indexer_user</span> <span class=o>=</span> <span class=n>StringIndexer</span><span class=p>(</span><span class=n>inputCol</span><span class=o>=</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=n>outputCol</span><span class=o>=</span><span class=s2>&#34;user_idx&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>indexer_content</span> <span class=o>=</span> <span class=n>StringIndexer</span><span class=p>(</span><span class=n>inputCol</span><span class=o>=</span><span class=s2>&#34;content_id&#34;</span><span class=p>,</span> <span class=n>outputCol</span><span class=o>=</span><span class=s2>&#34;content_idx&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>df_indexed</span> <span class=o>=</span> <span class=n>indexer_user</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>user_interactions</span><span class=p>)</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>user_interactions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>df_indexed</span> <span class=o>=</span> <span class=n>indexer_content</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>df_indexed</span><span class=p>)</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>df_indexed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 암시적 평점 계산 (시청 시간, 완료율 등으로부터)</span>
</span></span><span class=line><span class=cl>        <span class=n>df_ratings</span> <span class=o>=</span> <span class=n>df_indexed</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_implicit_rating</span><span class=p>(</span><span class=n>df_indexed</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ALS 모델 훈련</span>
</span></span><span class=line><span class=cl>        <span class=n>als</span> <span class=o>=</span> <span class=n>ALS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>maxIter</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>regParam</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>userCol</span><span class=o>=</span><span class=s2>&#34;user_idx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>itemCol</span><span class=o>=</span><span class=s2>&#34;content_idx&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>ratingCol</span><span class=o>=</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>coldStartStrategy</span><span class=o>=</span><span class=s2>&#34;drop&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>model</span> <span class=o>=</span> <span class=n>als</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>df_ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 사용자에 대한 추천 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>user_recommendations</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>recommendForAllUsers</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 결과를 Redis에 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>user_recommendations</span><span class=o>.</span><span class=n>collect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_original_user_id</span><span class=p>(</span><span class=n>row</span><span class=o>.</span><span class=n>user_idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_original_content_id</span><span class=p>(</span><span class=n>rec</span><span class=o>.</span><span class=n>content_idx</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;score&#39;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>rec</span><span class=o>.</span><span class=n>rating</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_recommendation_reason</span><span class=p>(</span><span class=n>rec</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>row</span><span class=o>.</span><span class=n>recommendations</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Redis에 개인화 추천 저장 (24시간 TTL)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:all&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=mi>86400</span><span class=p>,</span>  <span class=c1># 24시간</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_implicit_rating</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>df</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;암시적 평점 계산 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 시청 시간, 완료율, 재시청 여부 등을 종합한 점수</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>pyspark.sql.functions</span> <span class=kn>import</span> <span class=n>when</span><span class=p>,</span> <span class=n>col</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>when</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>col</span><span class=p>(</span><span class=s2>&#34;interaction_type&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;view&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>col</span><span class=p>(</span><span class=s2>&#34;interaction_value&#34;</span><span class=p>)</span> <span class=o>/</span> <span class=mf>3600.0</span>  <span class=c1># 시청 시간(초) -&gt; 시간 단위 점수</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>when</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>col</span><span class=p>(</span><span class=s2>&#34;interaction_type&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;rate&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>col</span><span class=p>(</span><span class=s2>&#34;interaction_value&#34;</span><span class=p>)</span>  <span class=c1># 직접 평점</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>when</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>col</span><span class=p>(</span><span class=s2>&#34;interaction_type&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;complete&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mf>5.0</span>  <span class=c1># 완료 시청 = 높은 점수</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>otherwise</span><span class=p>(</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. API 엔드포인트 (FastAPI)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Query</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s2>&#34;Netflix-Style Recommendation API&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/track&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>track_interaction</span><span class=p>(</span><span class=n>interaction</span><span class=p>:</span> <span class=n>UserInteractionEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사용자 상호작용 추적 - 명령 API&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>behavior_handler</span><span class=o>.</span><span class=n>track_user_interaction</span><span class=p>(</span><span class=n>interaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;tracked&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/users/</span><span class=si>{user_id}</span><span class=s2>/recommendations&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>category</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;콘텐츠 카테고리&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;개인화된 추천 조회 - 쿼리 API&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=n>recommendation_handler</span><span class=o>.</span><span class=n>get_personalized_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=p>,</span> <span class=n>category</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;generated_at&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/trending&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_trending</span><span class=p>(</span><span class=n>time_window</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=s2>&#34;24h&#34;</span><span class=p>,</span> <span class=n>regex</span><span class=o>=</span><span class=s2>&#34;^(1h|24h|7d)$&#34;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;트렌딩 콘텐츠 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>trending</span> <span class=o>=</span> <span class=k>await</span> <span class=n>recommendation_handler</span><span class=o>.</span><span class=n>get_trending_content</span><span class=p>(</span><span class=n>time_window</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;time_window&#34;</span><span class=p>:</span> <span class=n>time_window</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;trending&#34;</span><span class=p>:</span> <span class=n>trending</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 이벤트 프로세서 (실시간 트렌딩 계산)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TrendingEventProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_consumer</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_consumer</span> <span class=o>=</span> <span class=n>kafka_consumer</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_trending_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실시간 트렌딩 점수 계산&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>kafka_consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;interaction_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;view&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 실시간 트렌딩 점수 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=n>content_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>(</span><span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 시간 기반 가중치 적용 (최근일수록 높은 가중치)</span>
</span></span><span class=line><span class=cl>                <span class=n>weight</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_time_weight</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># Redis Sorted Set에 트렌딩 점수 누적</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>zincrby</span><span class=p>(</span><span class=s2>&#34;trending:24h&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=p>,</span> <span class=n>content_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>zincrby</span><span class=p>(</span><span class=s2>&#34;trending:7d&#34;</span><span class=p>,</span> <span class=n>weight</span> <span class=o>*</span> <span class=mf>0.7</span><span class=p>,</span> <span class=n>content_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># TTL 설정으로 오래된 데이터 자동 정리</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=s2>&#34;trending:24h&#34;</span><span class=p>,</span> <span class=mi>86400</span><span class=p>)</span>  <span class=c1># 24시간</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=s2>&#34;trending:7d&#34;</span><span class=p>,</span> <span class=mi>604800</span><span class=p>)</span>  <span class=c1># 7일</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_time_weight</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시간 기반 가중치 계산 (최근일수록 높은 가중치)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>time_diff</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hours_ago</span> <span class=o>=</span> <span class=n>time_diff</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>/</span> <span class=mi>3600</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>max</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>24.0</span> <span class=o>-</span> <span class=n>hours_ago</span><span class=p>)</span> <span class=o>/</span> <span class=mf>24.0</span>  <span class=c1># 0-24시간 전 데이터에 가중치</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=phase-6-운영-및-최적화-operations--optimization>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스-1>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스-1>#</a></h4><p><strong>보안 고려사항</strong>:</p><table><thead><tr><th>영역</th><th>보안 요구사항</th><th>구현 방안</th><th>모니터링</th></tr></thead><tbody><tr><td>인증/인가</td><td>명령/조회 API 별도 권한 관리</td><td>OAuth 2.0, JWT 토큰, RBAC</td><td>접근 로그, 권한 변경 추적</td></tr><tr><td>데이터 보호</td><td>민감 데이터 암호화</td><td>TLS 1.3, 필드 레벨 암호화</td><td>암호화 키 순환, 데이터 접근 감사</td></tr><tr><td>이벤트 보안</td><td>이벤트 스트림 보안</td><td>Kafka SASL/SSL, 이벤트 서명</td><td>이벤트 변조 탐지, 메시지 검증</td></tr><tr><td>네트워크</td><td>마이크로서비스 간 통신 보안</td><td>mTLS, 서비스 메시 (Service Mesh)</td><td>네트워크 트래픽 분석</td></tr></tbody></table><p><strong>거버넌스</strong>:</p><ul><li><strong>데이터 거버넌스</strong>: 읽기/쓰기 모델 간 데이터 일관성 정책</li><li><strong>API 거버넌스</strong>: 명령/조회 API의 버전 관리 및 호환성</li><li><strong>이벤트 거버넌스</strong>: 이벤트 스키마 관리 및 진화 정책</li></ul><h4 id=모니터링-및-관측성-1>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성-1>#</a></h4><p><strong>성능 모니터링</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Prometheus 메트릭 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>command_side</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>command_processing_duration_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>command_success_rate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>domain_validation_errors_total</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>write_store_latency_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>query_side</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>query_processing_duration_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>query_cache_hit_rate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>read_store_latency_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>projection_lag_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>event_processing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>event_publish_rate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>event_processing_lag_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>projection_update_success_rate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>dead_letter_queue_size</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>로깅 전략</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 구조화된 로깅 예시</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>structlog</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>structlog</span><span class=o>.</span><span class=n>get_logger</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 명령 처리 시작 로그</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;command_processing_started&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>command_type</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>command_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>correlation_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>correlation_id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_command</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 성공 로그</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;command_processing_completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>command_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>processing_time_ms</span><span class=o>=</span><span class=n>result</span><span class=o>.</span><span class=n>processing_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>events_generated</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 실패 로그</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;command_processing_failed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>command_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>error_type</span><span class=o>=</span><span class=n>e</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>error_message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>stack_trace</span><span class=o>=</span><span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>분산 추적 (Distributed Tracing)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.exporter.jaeger.thrift</span> <span class=kn>import</span> <span class=n>JaegerExporter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace</span> <span class=kn>import</span> <span class=n>TracerProvider</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 분산 추적 설정</span>
</span></span><span class=line><span class=cl><span class=n>tracer</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_tracer</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;order.create&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.customer_id&#34;</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>customer_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.items_count&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 명령 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;order.validate&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_order</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 발행 추적</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;event.publish&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_publish_events</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실무-적용-고려사항-및-주의점-1>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점-1>#</a></h4><table><thead><tr><th>고려사항</th><th>상세 내용</th><th>권장사항</th></tr></thead><tbody><tr><td>점진적 도입</td><td>전체 시스템을 한번에 CQRS로 전환하는 위험</td><td>단일 바운디드 컨텍스트 (Bounded Context)부터 시작</td></tr><tr><td>데이터 일관성</td><td>최종 일관성으로 인한 사용자 경험 문제</td><td>중요한 비즈니스 로직은 강한 일관성 유지</td></tr><tr><td>복잡성 관리</td><td>아키텍처 복잡도 증가로 인한 개발/운영 부담</td><td>자동화 도구 활용, 명확한 문서화</td></tr><tr><td>이벤트 순서</td><td>이벤트 순서 보장 문제</td><td>파티션 키 설계, 이벤트 버전 관리</td></tr><tr><td>장애 처리</td><td>읽기/쓰기 모델 간 동기화 실패</td><td>보상 트랜잭션, 수동 복구 절차 수립</td></tr></tbody></table><h4 id=성능-최적화-전략-및-고려사항-1>성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략-및-고려사항-1>#</a></h4><table><thead><tr><th>최적화 영역</th><th>전략</th><th>구현 방법</th><th>주의사항</th></tr></thead><tbody><tr><td>읽기 성능</td><td>캐시 활용</td><td>Redis, CDN, 애플리케이션 캐시</td><td>캐시 무효화 정책 수립</td></tr><tr><td>쓰기 성능</td><td>배치 처리</td><td>이벤트 배치 처리, 벌크 연산</td><td>지연시간과 처리량 트레이드오프</td></tr><tr><td>네트워크</td><td>압축 및 직렬화</td><td>Protocol Buffers, Apache Avro</td><td>CPU 사용량 증가 고려</td></tr><tr><td>저장소</td><td>인덱스 최적화</td><td>읽기 패턴 기반 인덱스 설계</td><td>쓰기 성능 영향 최소화</td></tr><tr><td>확장성</td><td>샤딩 전략</td><td>사용자/테넌트 기반 파티셔닝</td><td>크로스 샤드 쿼리 복잡성</td></tr></tbody></table><h3 id=phase-7-고급-주제-advanced-topics>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제-1>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제-1>#</a></h4><table><thead><tr><th>도전 과제</th><th>원인</th><th>영향</th><th>해결방안</th></tr></thead><tbody><tr><td>이벤트 스키마 진화</td><td>시간이 지남에 따른 이벤트 구조 변경</td><td>기존 프로젝션 호환성 문제</td><td>스키마 레지스트리 (Schema Registry), 버전 관리</td></tr><tr><td>프로젝션 리빌드</td><td>대량 데이터의 프로젝션 재생성</td><td>긴 다운타임, 리소스 집약적</td><td>증분 리빌드, 병렬 처리</td></tr><tr><td>복잡한 조인 쿼리</td><td>비정규화된 읽기 모델의 한계</td><td>실시간 집계 쿼리 어려움</td><td>CQRS + 이벤트 소싱, 구체화된 뷰</td></tr><tr><td>트랜잭션 경계</td><td>분산 환경에서의 트랜잭션 관리</td><td>데이터 일관성 문제</td><td>사가 패턴, 이벤트 기반 보상</td></tr></tbody></table><h4 id=생태계-및-관련-기술-1>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술-1>#</a></h4><p><strong>통합 연계 가능한 기술</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;메시지 브로커&#34;
        Kafka[Apache Kafka]
        RabbitMQ[RabbitMQ]
        Pulsar[Apache Pulsar]
    end
    
    subgraph &#34;이벤트 스토어&#34;
        EventStore[EventStore DB]
        Axon[Axon Framework]
    end
    
    subgraph &#34;데이터베이스&#34;
        PostgreSQL[PostgreSQL]
        MongoDB[MongoDB]
        Cassandra[Apache Cassandra]
        Redis[Redis]
    end
    
    subgraph &#34;오케스트레이션&#34;
        K8s[Kubernetes]
        Docker[Docker]
    end
    
    CQRS --&gt; Kafka
    CQRS --&gt; EventStore
    CQRS --&gt; PostgreSQL
    CQRS --&gt; K8s
</pre><p><strong>표준 및 프로토콜</strong>:</p><ul><li><strong>CloudEvents</strong>: 이벤트 메타데이터 표준화</li><li><strong>OpenTelemetry</strong>: 관측성 표준화</li><li><strong>JSON Schema/Avro</strong>: 이벤트 스키마 정의</li><li><strong>OpenAPI</strong>: API 스펙 표준화</li></ul><h4 id=최신-기술-트렌드와-미래-방향-1>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향-1>#</a></h4><p><strong>1. 서버리스 CQRS</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># AWS Lambda 기반 CQRS 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>functions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>orderCommandHandler</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>handlers/command.handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>events</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class=l>post</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DYNAMODB_TABLE</span><span class=p>:</span><span class=w> </span><span class=l>orders-write</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>orderProjection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>handlers/projection.handler  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>events</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>stream</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>dynamodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>arn</span><span class=p>:</span><span class=w> </span><span class=l>${self:custom.orderTableStreamArn}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ELASTICSEARCH_ENDPOINT</span><span class=p>:</span><span class=w> </span><span class=l>${self:custom.esEndpoint}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>2. 클라우드 네이티브 CQRS</strong>:</p><ul><li><strong>컨테이너 오케스트레이션</strong>: Kubernetes 기반 자동 스케일링</li><li><strong>서비스 메시</strong>: Istio/Linkerd를 통한 트래픽 관리</li><li><strong>관측성</strong>: Prometheus, Grafana, Jaeger 통합</li></ul><p><strong>3. AI/ML 통합</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ML 기반 자동 프로젝션 최적화</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>IntelligentProjectionOptimizer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ml_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>ml_model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>optimize_projection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query_patterns</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;쿼리 패턴 분석을 통한 프로젝션 최적화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># ML 모델로 최적 인덱스 구조 예측</span>
</span></span><span class=line><span class=cl>        <span class=n>optimal_structure</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>query_patterns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 자동으로 프로젝션 구조 조정</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_adjust_projection_structure</span><span class=p>(</span><span class=n>optimal_structure</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>4. 에지 컴퓨팅 (Edge Computing) 통합</strong>:</p><ul><li><strong>에지 캐시</strong>: CDN 기반 읽기 모델 분산</li><li><strong>에지 프로세싱</strong>: 지역별 명령 처리</li><li><strong>하이브리드 동기화</strong>: 중앙-에지 간 선택적 동기화</li></ul><h4 id=기타-고급-사항>기타 고급 사항<a hidden class=anchor aria-hidden=true href=#기타-고급-사항>#</a></h4><p><strong>멀티 테넌트 (Multi-Tenant) CQRS</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1> 1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2> 2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3> 3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4> 4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5> 5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6> 6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7> 7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8> 8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9> 9</a>
</span><span class=lnt id=hl-40-10><a class=lnlinks href=#hl-40-10>10</a>
</span><span class=lnt id=hl-40-11><a class=lnlinks href=#hl-40-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>TenantAwareCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>tenant_id</span> <span class=o>=</span> <span class=n>command</span><span class=o>.</span><span class=n>tenant_id</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 테넌트별 격리된 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>tenant_config</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tenant_config</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>write_store</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tenant_write_store</span><span class=p>(</span><span class=n>tenant_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 테넌트별 비즈니스 규칙 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>domain_rules</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tenant_domain_rules</span><span class=p>(</span><span class=n>tenant_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>domain_rules</span><span class=o>.</span><span class=n>validate</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>크로스 바운더리 이벤트</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10>10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11>11</a>
</span><span class=lnt id=hl-41-12><a class=lnlinks href=#hl-41-12>12</a>
</span><span class=lnt id=hl-41-13><a class=lnlinks href=#hl-41-13>13</a>
</span><span class=lnt id=hl-41-14><a class=lnlinks href=#hl-41-14>14</a>
</span><span class=lnt id=hl-41-15><a class=lnlinks href=#hl-41-15>15</a>
</span><span class=lnt id=hl-41-16><a class=lnlinks href=#hl-41-16>16</a>
</span><span class=lnt id=hl-41-17><a class=lnlinks href=#hl-41-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 마이크로서비스 간 이벤트 전파</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CrossBoundaryEventHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 도메인 -&gt; 재고 도메인</span>
</span></span><span class=line><span class=cl>        <span class=n>inventory_event</span> <span class=o>=</span> <span class=n>InventoryReservationRequested</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 도메인 -&gt; 결제 도메인  </span>
</span></span><span class=line><span class=cl>        <span class=n>payment_event</span> <span class=o>=</span> <span class=n>PaymentAuthorizationRequested</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>amount</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>total_amount</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_to_domain</span><span class=p>(</span><span class=s1>&#39;inventory&#39;</span><span class=p>,</span> <span class=n>inventory_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_to_domain</span><span class=p>(</span><span class=s1>&#39;payment&#39;</span><span class=p>,</span> <span class=n>payment_event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=4단계-종합-정리-1>4단계: 종합 정리<a hidden class=anchor aria-hidden=true href=#4단계-종합-정리-1>#</a></h2><h3 id=최종-정리-및-학습-가이드-1>최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드-1>#</a></h3><h4 id=내용-종합-1>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합-1>#</a></h4><p>CQRS (Command Query Responsibility Segregation, 명령 조회 책임 분리)는 현대 분산 시스템 아키텍처에서 핵심적인 패턴으로 자리잡았습니다. 단순한 읽기/쓰기 분리를 넘어서 도메인 주도 설계 (Domain-Driven Design), 이벤트 소싱, 마이크로서비스와 결합하여 복잡한 비즈니스 요구사항을 해결하는 강력한 도구로 발전했습니다.</p><p><strong>핵심 가치</strong>:</p><ul><li><strong>성능</strong>: 워크로드별 최적화를 통한 극적인 성능 향상</li><li><strong>확장성</strong>: 독립적 스케일링을 통한 비용 효율적 확장</li><li><strong>유연성</strong>: 기술 선택의 자유도와 진화 가능한 아키텍처</li><li><strong>복잡성 관리</strong>: 관심사 분리를 통한 시스템 이해도 향상</li></ul><p><strong>최신 트렌드 반영</strong>:</p><ul><li>클라우드 네이티브 환경에서의 서버리스 CQRS</li><li>AI/ML 기반 자동 최적화 및 프로젝션 관리</li><li>에지 컴퓨팅과의 통합을 통한 글로벌 분산 시스템</li><li>실시간 스트리밍과 배치 처리의 하이브리드 아키텍처</li></ul><h4 id=학습-로드맵-1>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵-1>#</a></h4><p><strong>1단계: 기초 이해 (1-2주)</strong></p><ul><li>CQRS 개념과 CQS 원칙 이해</li><li>전통적 CRUD vs CQRS 차이점 학습</li><li>기본 구현 패턴 학습</li></ul><p><strong>2단계: 실무 적용 (2-4주)</strong></p><ul><li>단일 애플리케이션에서 CQRS 구현</li><li>이벤트 기반 동기화 메커니즘 학습</li><li>간단한 프로젝션 구현</li></ul><p><strong>3단계: 고급 패턴 (4-6주)</strong></p><ul><li>이벤트 소싱과의 결합</li><li>마이크로서비스 아키텍처에서의 CQRS</li><li>분산 시스템 고려사항</li></ul><p><strong>4단계: 운영 및 최적화 (2-3주)</strong></p><ul><li>모니터링 및 관측성 구축</li><li>성능 최적화 기법</li><li>장애 처리 및 복구 전략</li></ul><p><strong>5단계: 고급 주제 (지속적)</strong></p><ul><li>최신 기술 트렌드 추적</li><li>특화된 도메인별 적용</li><li>아키텍처 진화 전략</li></ul><h4 id=학습-항목-매트릭스-1>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스-1>#</a></h4><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>CQS 원칙 이해</td><td>필수</td><td>CQRS의 이론적 기반</td></tr><tr><td>기초</td><td>1</td><td>명령/조회 분리 개념</td><td>필수</td><td>핵심 아키텍처 패턴</td></tr><tr><td>기초</td><td>1</td><td>최종 일관성 이해</td><td>필수</td><td>분산 시스템의 일관성 모델</td></tr><tr><td>이론</td><td>2</td><td>도메인 모델링</td><td>필수</td><td>명령 측 설계 원칙</td></tr><tr><td>이론</td><td>2</td><td>프로젝션 설계</td><td>필수</td><td>조회 측 최적화 기법</td></tr><tr><td>이론</td><td>2</td><td>이벤트 설계</td><td>권장</td><td>모델 간 통신 메커니즘</td></tr><tr><td>구현</td><td>4</td><td>기본 CQRS 구현</td><td>필수</td><td>실무 적용의 시작점</td></tr><tr><td>구현</td><td>4</td><td>이벤트 버스 구현</td><td>권장</td><td>비동기 통신 구현</td></tr><tr><td>구현</td><td>5</td><td>분산 저장소 설계</td><td>권장</td><td>폴리글랏 퍼시스턴스</td></tr><tr><td>구현</td><td>5</td><td>마이크로서비스 통합</td><td>선택</td><td>대규모 시스템 설계</td></tr><tr><td>운영</td><td>6</td><td>모니터링 구축</td><td>권장</td><td>운영 안정성 확보</td></tr><tr><td>운영</td><td>6</td><td>성능 최적화</td><td>권장</td><td>실무 성능 요구사항 충족</td></tr><tr><td>고급</td><td>7</td><td>이벤트 소싱 통합</td><td>선택</td><td>고급 패턴 조합</td></tr><tr><td>고급</td><td>7</td><td>스키마 진화 관리</td><td>선택</td><td>장기 운영 고려사항</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td>CQRS</td><td>명령과 조회의 책임을 분리하는 아키텍처 패턴</td><td>CQS, DDD, Event Sourcing</td></tr><tr><td>핵심</td><td>명령 (Command)</td><td>시스템 상태를 변경하는 작업</td><td>Command Handler, Domain Model</td></tr><tr><td>핵심</td><td>조회 (Query)</td><td>시스템에서 데이터를 읽는 작업</td><td>Query Handler, Read Model</td></tr><tr><td>핵심</td><td>프로젝션 (Projection)</td><td>읽기 모델 생성/업데이트 과정</td><td>Event Handler, Materialized View</td></tr><tr><td>구현</td><td>이벤트 버스</td><td>모델 간 비동기 통신을 위한 메시징 인프라</td><td>Apache Kafka, RabbitMQ</td></tr><tr><td>구현</td><td>폴리글랏 퍼시스턴스</td><td>워크로드별 최적화된 다양한 저장소 사용</td><td>NoSQL, RDBMS, Cache</td></tr><tr><td>구현</td><td>최종 일관성</td><td>분산 시스템에서 시간이 지나면 일관성이 보장되는 모델</td><td>BASE, CAP Theorem</td></tr><tr><td>운영</td><td>보상 트랜잭션</td><td>실패한 작업을 되돌리는 트랜잭션</td><td>Saga Pattern, Rollback</td></tr><tr><td>운영</td><td>사가 패턴</td><td>분산 트랜잭션을 관리하는 패턴</td><td>Orchestration, Choreography</td></tr><tr><td>고급</td><td>이벤트 소싱</td><td>상태 변경을 이벤트로 저장하는 패턴</td><td>Event Store, Replay</td></tr><tr><td>고급</td><td>스키마 레지스트리</td><td>이벤트 스키마 버전 관리 시스템</td><td>Avro, Schema Evolution</td></tr></tbody></table><hr><h2 id=참고-및-출처--공식-문서-및-권위있는-소스>참고 및 출처- <strong>공식 문서 및 권위있는 소스</strong>:<a hidden class=anchor aria-hidden=true href=#참고-및-출처--공식-문서-및-권위있는-소스>#</a></h2><ul><li><p>Martin Fowler - CQRS 블로그 포스트 (<a href=https://martinfowler.com/bliki/CQRS.html>https://martinfowler.com/bliki/CQRS.html</a>)</p></li><li><p>Microsoft Azure Architecture Center - CQRS Pattern (<a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs</a>)</p></li><li><p>Microsoft Azure Architecture Center - Event Sourcing Pattern (<a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing</a>)</p></li><li><p>Confluent Developer - CQRS Pattern (<a href=https://developer.confluent.io/patterns/compositional-patterns/command-query-responsibility-segregation/>https://developer.confluent.io/patterns/compositional-patterns/command-query-responsibility-segregation/</a>)</p></li><li><p><strong>기술 구현 가이드</strong>:</p><ul><li>Baeldung - CQRS and Event Sourcing in Java (<a href=https://www.baeldung.com/cqrs-event-sourcing-java>https://www.baeldung.com/cqrs-event-sourcing-java</a>)</li><li>Baeldung - Axon Framework 가이드 (<a href=https://www.baeldung.com/axon-cqrs-event-sourcing>https://www.baeldung.com/axon-cqrs-event-sourcing</a>)</li><li>Axon Framework 실습 예제 (<a href=https://sgitario.github.io/axon-by-example/>https://sgitario.github.io/axon-by-example/</a>)</li><li>Upsolver - CQRS와 Event Sourcing 데이터베이스 아키텍처 (<a href=https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture>https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture</a>)</li></ul></li><li><p><strong>프레임워크 및 도구</strong>:</p><ul><li>AxonIQ - Axon Framework 공식 사이트 (<a href=https://www.axoniq.io/>https://www.axoniq.io/</a>)</li><li>Microservices.io - Event Sourcing Pattern (<a href=https://microservices.io/patterns/data/event-sourcing.html>https://microservices.io/patterns/data/event-sourcing.html</a>)</li><li>Confluent - Event Sourcing and CQRS 코스 (<a href=https://developer.confluent.io/courses/event-sourcing/cqrs/>https://developer.confluent.io/courses/event-sourcing/cqrs/</a>)</li></ul></li><li><p><strong>아키텍처 분석 및 사례 연구</strong>:</p><ul><li>Better Programming - CQRS 패턴 분석 (<a href=https://betterprogramming.pub/cqrs-software-architecture-pattern-the-good-the-bad-and-the-ugly-e9d6e7a34daf>https://betterprogramming.pub/cqrs-software-architecture-pattern-the-good-the-bad-and-the-ugly-e9d6e7a34daf</a>)</li><li>Docplanner Tech - CQRS의 본질 (<a href=https://medium.com/docplanner-tech/the-essence-of-cqrs-90bdc7ee0980>https://medium.com/docplanner-tech/the-essence-of-cqrs-90bdc7ee0980</a>)</li><li>Mia-Platform - Event Sourcing과 CQRS 패턴 이해 (<a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/</a>)</li></ul></li></ul><p>CQRS (Command Query Responsibility Segregation, 명령 조회 책임 분리)는 현대 소프트웨어 아키텍처에서 복잡성을 관리하고 성능을 최적화하는 강력한 패턴으로 자리잡았습니다. 단순한 읽기/쓰기 분리를 넘어서 이벤트 소싱, 마이크로서비스, 도메인 주도 설계와 결합하여 확장 가능하고 유지보수 가능한 시스템을 구축하는 핵심 도구로 발전했습니다.</p><p>이 종합 분석을 통해 CQRS의 이론적 기반부터 실무 적용까지 체계적으로 살펴보았으며, 특히 Netflix, Microsoft, Uber 등의 실제 도입 사례와 구현 예시를 통해 패턴의 실용성을 확인할 수 있었습니다. 또한 Axon Framework와 같은 전문 도구들이 CQRS 구현의 복잡성을 크게 줄여주고 있어, 더 많은 조직에서 이 패턴을 도입할 수 있는 환경이 조성되고 있습니다.</p><p>앞으로 클라우드 네이티브 환경과 AI/ML 통합, 에지 컴퓨팅과의 결합을 통해 CQRS는 더욱 진화된 형태로 발전할 것으로 예상되며, 현대적 소프트웨어 아키텍처의 핵심 패턴으로서의 위치를 더욱 공고히 할 것으로 전망됩니다.</p><hr><h2 id=1단계-기본-분석-2>1단계: 기본 분석<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-2>#</a></h2><h3 id=1-대표-태그-1>1. 대표 태그<a hidden class=anchor aria-hidden=true href=#1-대표-태그-1>#</a></h3><ul><li>CQRS</li><li>Event-Driven-Architecture</li><li>Domain-Driven-Design</li><li>Distributed-Systems</li></ul><hr><h3 id=2-분류-체계-검증-2>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증-2>#</a></h3><p>현재 분류:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Software Engineering &gt; Design and Architecture &gt; Architecture Styles &gt; Messaging-Oriented Architecture &gt; Event-Driven Architecture &gt; Event Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>검증 결과</strong>
CQRS(Command Query Responsibility Segregation)는 주로 <strong>아키텍처 패턴</strong>이며, 이벤트 기반(Event-Driven) 아키텍처와 함께 쓰이는 경우가 많지만 반드시 메시징 지향(Messaging-Oriented)일 필요는 없습니다.
보다 정확한 위치는 다음과 같이 조정하는 것이 좋습니다.</p><p><strong>개선 제안</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2>2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3>3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Software Engineering
</span></span><span class=line><span class=cl> └─ Design and Architecture
</span></span><span class=line><span class=cl>    └─ Architecture Patterns
</span></span><span class=line><span class=cl>       └─ Command Query Responsibility Segregation (CQRS)
</span></span></code></pre></td></tr></table></div></div><blockquote><p>단, Event Sourcing과 결합될 때 Messaging-Oriented / Event-Driven 아키텍처 하위로도 참조 가능.</p></blockquote><hr><h3 id=3-핵심-요약-250자-이내-1>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내-1>#</a></h3><p>CQRS는 명령(Command)과 조회(Query) 모델을 분리해 읽기/쓰기의 책임을 구분하는 아키텍처 패턴이다. 쓰기 모델은 상태 변경 로직, 읽기 모델은 최적화된 조회를 담당하며, 성능, 확장성, 복잡한 도메인 모델링에서 강점을 가진다.</p><hr><h3 id=4-전체-개요-400자-이내-1>4. 전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-400자-이내-1>#</a></h3><p>CQRS(Command Query Responsibility Segregation)는 소프트웨어 아키텍처 패턴으로, 데이터의 변경 작업과 조회 작업을 별도의 모델로 분리한다. 쓰기 측은 도메인 규칙과 상태 변경을 처리하고, 읽기 측은 조회 성능을 위해 최적화된 구조를 사용한다. 이는 복잡한 비즈니스 로직, 대규모 트래픽, 확장성 요구가 있는 환경에서 특히 유용하다. 종종 Event Sourcing, 메시징 시스템, 마이크로서비스와 결합하여 높은 일관성과 확장성을 동시에 달성한다.</p><hr><p>좋습니다. 그럼 이어서 <strong>2단계: 핵심 분석</strong>과 <strong>3단계: Phase별 상세 조사</strong>를 진행하겠습니다.
저는 먼저 <strong>Phase 1~7 전체</strong>를 단계별로 완성해 드리고, 마지막에 종합 정리와 학습 가이드를 붙이겠습니다.</p><hr><h2 id=2단계-핵심-분석-2>2단계: 핵심 분석<a hidden class=anchor aria-hidden=true href=#2단계-핵심-분석-2>#</a></h2><h3 id=5-핵심-개념-정리-2>5. 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리-2>#</a></h3><table><thead><tr><th>구분</th><th>개념</th><th>설명</th><th>실무 포인트</th></tr></thead><tbody><tr><td>기본</td><td>CQRS</td><td>Command와 Query의 책임을 분리하는 아키텍처 패턴</td><td>데이터 쓰기/읽기 분리, 확장성 및 유지보수성 향상</td></tr><tr><td>기본</td><td>Command Model</td><td>상태 변경을 처리하는 모델</td><td>트랜잭션, 비즈니스 로직, 검증 담당</td></tr><tr><td>기본</td><td>Query Model</td><td>조회 요청을 처리하는 모델</td><td>읽기 성능 최적화, 캐싱, 별도 DB 가능</td></tr><tr><td>심화</td><td>Event Sourcing</td><td>상태 변경을 이벤트로 저장하는 방식</td><td>CQRS와 자주 결합, 변경 이력 보존</td></tr><tr><td>심화</td><td>Eventually Consistent</td><td>읽기 모델이 쓰기 모델과 일시적으로 불일치할 수 있는 특성</td><td>메시지 큐, 비동기 처리 필요</td></tr></tbody></table><hr><h3 id=6-실무-연관성-분석-2>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석-2>#</a></h3><ul><li><strong>대규모 트래픽 서비스</strong>: 읽기 요청이 압도적으로 많은 경우, 읽기 DB를 최적화된 구조로 분리 가능</li><li><strong>복잡한 비즈니스 규칙</strong>: 도메인 로직과 조회 로직 분리로 코드 복잡성 감소</li><li><strong>마이크로서비스 아키텍처</strong>: 쓰기/읽기 모델을 각각 독립 배포 가능</li><li><strong>실시간 데이터 처리</strong>: 이벤트 스트리밍과 결합 시, 빠른 데이터 전파 가능</li></ul><hr><h2 id=3단계-phase별-상세-조사>3단계: Phase별 상세 조사<a hidden class=anchor aria-hidden=true href=#3단계-phase별-상세-조사>#</a></h2><hr><h3 id=phase-1-기초-이해-1><strong>Phase 1: 기초 이해</strong><a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해-1>#</a></h3><h4 id=개념-정의-및-본질-2>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질-2>#</a></h4><p>CQRS는 &ldquo;데이터 수정"과 &ldquo;데이터 조회"의 책임을 분리하는 아키텍처 패턴이다. 이 패턴은 Robert C. Martin의 CQS(Command Query Separation) 원칙에서 발전한 것으로, 명령과 조회의 데이터 모델, 저장소, 서비스 계층까지 분리하는 것이 특징이다.</p><h4 id=등장-배경-및-발전-과정-2>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정-2>#</a></h4><ul><li><strong>1990s</strong>: Bertrand Meyer가 CQS 원칙 제안</li><li><strong>2000s</strong>: Greg Young이 CQRS 패턴 제안, DDD(Domain-Driven Design)와 결합</li><li><strong>현재</strong>: 클라우드 네이티브, 이벤트 기반 아키텍처, 마이크로서비스와 함께 광범위 적용</li></ul><h4 id=핵심-동기-및-가치-제안-2>핵심 동기 및 가치 제안<a hidden class=anchor aria-hidden=true href=#핵심-동기-및-가치-제안-2>#</a></h4><ul><li>서로 다른 성능 요구: 쓰기 작업은 일관성과 비즈니스 규칙 준수, 읽기 작업은 빠른 응답</li><li>유지보수성 향상: 코드 복잡성 감소</li><li>확장성 확보: 읽기/쓰기 각각 독립적으로 확장 가능</li></ul><h4 id=주요-특징-2>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징-2>#</a></h4><ul><li><strong>책임 분리</strong>: Command 모델과 Query 모델 완전 분리</li><li><strong>저장소 분리 가능</strong>: RDB(Read)와 NoSQL(Write) 혼합 가능</li><li><strong>이벤트 기반 업데이트</strong>: 읽기 모델을 쓰기 모델 변경 이벤트로 갱신</li><li><strong>Eventually Consistent</strong>: 실시간 동기보다는 비동기 갱신 중심</li></ul><hr><h3 id=phase-2-핵심-이론-1><strong>Phase 2: 핵심 이론</strong><a hidden class=anchor aria-hidden=true href=#phase-2-핵심-이론-1>#</a></h3><h4 id=핵심-설계-원칙-2>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙-2>#</a></h4><ol><li><strong>Single Responsibility Principle</strong>: 읽기와 쓰기의 책임을 분리</li><li><strong>Event-driven Update</strong>: 상태 변경 시 이벤트 발행</li><li><strong>Polyglot Persistence</strong>: 저장소 최적화 가능</li><li><strong>Horizontal Scalability</strong>: 읽기/쓰기 독립 확장 가능</li></ol><h4 id=기본-원리-및-동작-메커니즘-2>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘-2>#</a></h4><pre class=mermaid>graph TD
    Client --&gt;|Command| CommandAPI
    CommandAPI --&gt; CommandHandler
    CommandHandler --&gt; WriteDB
    CommandHandler --&gt; EventBus
    EventBus --&gt; QueryHandler
    QueryHandler --&gt; ReadDB
    Client --&gt;|Query| QueryAPI
    QueryAPI --&gt; ReadDB
</pre><ul><li>Command 경로: Client → CommandAPI → CommandHandler → WriteDB → Event 발생</li><li>Query 경로: Client → QueryAPI → ReadDB</li></ul><h4 id=아키텍처-및-구성-요소-2>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소-2>#</a></h4><ul><li><strong>Command API</strong>: 쓰기 요청 처리</li><li><strong>Query API</strong>: 읽기 요청 처리</li><li><strong>Command Handler</strong>: 비즈니스 로직, 검증</li><li><strong>Query Handler</strong>: 읽기 전용 최적화</li><li><strong>Event Bus</strong>: 상태 변경 이벤트 전달</li><li><strong>Write DB / Read DB</strong>: 분리 가능</li></ul><hr><h3 id=phase-3-특성-분석-1><strong>Phase 3: 특성 분석</strong><a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-1>#</a></h3><h4 id=장점-분석표>장점 분석표<a hidden class=anchor aria-hidden=true href=#장점-분석표>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>장점</td><td>성능 향상</td><td>읽기 요청을 별도 DB/모델로 최적화</td><td>읽기 전용 인덱스, 캐시 적용</td></tr><tr><td>장점</td><td>확장성</td><td>읽기/쓰기 독립 확장 가능</td><td>독립 마이크로서비스 배포</td></tr><tr><td>장점</td><td>유지보수성</td><td>도메인 로직과 조회 로직 분리</td><td>코드 복잡성 감소</td></tr><tr><td>장점</td><td>유연성</td><td>다른 저장소 타입 혼합 가능</td><td>Polyglot Persistence 지원</td></tr></tbody></table><h4 id=단점-및-문제점-분석표>단점 및 문제점 분석표<a hidden class=anchor aria-hidden=true href=#단점-및-문제점-분석표>#</a></h4><p>단점</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>두 모델과 저장소 관리 필요</td><td>자동 동기화 파이프라인 구축</td><td>단일 DB 성능 최적화</td></tr><tr><td>단점</td><td>Eventually Consistent</td><td>데이터 불일치 가능</td><td>사용자 UI에서 갱신 지연 표시</td><td>Strong Consistency 모델</td></tr></tbody></table><hr><p>좋습니다. 그럼 이제 <strong>Phase 4~7</strong>과 <strong>최종 종합 정리</strong>를 이어서 작성하겠습니다.</p><hr><h2 id=phase-4-구현-및-분류-1><strong>Phase 4: 구현 및 분류</strong><a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-1>#</a></h2><h3 id=구현-기법-및-방법-2>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법-2>#</a></h3><ul><li><p><strong>기본 구성</strong></p><ul><li>Command 서비스: 쓰기 모델 관리, 도메인 로직, 트랜잭션</li><li>Query 서비스: 읽기 모델 관리, 캐시/조회 최적화</li><li>이벤트 브로커(Kafka, RabbitMQ, AWS SNS/SQS 등)로 변경 사항 전달</li></ul></li><li><p><strong>실무 구현 포인트</strong></p><ul><li>이벤트 전송 시 스키마 버전 관리</li><li>읽기 모델은 비동기로 갱신</li><li>읽기 DB는 RDB, NoSQL, In-memory store 혼합 가능</li></ul></li></ul><h3 id=분류-기준에-따른-유형-구분-2>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분-2>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>저장소 구성</td><td>단일 DB 기반 CQRS</td><td>같은 DB에서 읽기/쓰기 테이블만 분리</td></tr><tr><td>저장소 구성</td><td>이중 DB 기반 CQRS</td><td>읽기/쓰기 DB를 분리, 다른 스키마 가능</td></tr><tr><td>이벤트 처리</td><td>동기 CQRS</td><td>변경 후 즉시 읽기 모델 갱신</td></tr><tr><td>이벤트 처리</td><td>비동기 CQRS</td><td>이벤트 큐를 통한 eventual consistency</td></tr></tbody></table><hr><h2 id=phase-5-실무-적용-1><strong>Phase 5: 실무 적용</strong><a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-1>#</a></h2><h3 id=실제-도입-사례-2>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-2>#</a></h3><ul><li><strong>이커머스 플랫폼</strong>: 주문 처리(쓰기)와 상품 검색(읽기)을 분리, 검색은 Elasticsearch, 쓰기는 RDBMS</li><li><strong>금융 거래 시스템</strong>: 거래 입력은 강한 일관성, 조회는 읽기 전용 복제본 사용</li><li><strong>IoT 플랫폼</strong>: 센서 데이터 쓰기는 시계열 DB, 조회는 분석용 OLAP DB</li></ul><hr><h3 id=실습-예제-및-코드-구현-2>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현-2>#</a></h3><p><strong>시나리오</strong>: 간단한 주문 시스템에서 CQRS를 적용해 쓰기/읽기 분리
<strong>시스템 구성</strong>:</p><ul><li>Command API (FastAPI)</li><li>Query API (FastAPI)</li><li>Kafka (이벤트 브로커)</li><li>PostgreSQL (쓰기 DB)</li><li>Redis (읽기 캐시)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    C[Client] --&gt; CA[Command API]
    CA --&gt; CH[Command Handler]
    CH --&gt; WDB[Write DB]
    CH --&gt; EB[Event Bus]
    EB --&gt; QH[Query Handler]
    QH --&gt; RDB[Read DB]
    C --&gt; QA[Query API]
    QA --&gt; RDB
</pre><p><strong>Workflow</strong>:</p><ol><li>Client가 주문 생성 요청(Command) 전송</li><li>Command Handler가 Write DB 저장 후 이벤트 발행</li><li>Query Handler가 이벤트 수신 후 Read DB 업데이트</li><li>Client가 Query API로 조회 요청 → Read DB 응답</li></ol><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 읽기와 쓰기 동일 DB, 쿼리 성능 저하</li><li>도입 후: 읽기 요청 성능 향상, 쓰기와 독립 확장 가능</li></ul><p><strong>구현 예시</strong> (Python/FastAPI + Redis):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1> 1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2> 2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3> 3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4> 4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5> 5</a>
</span><span class=lnt id=hl-46-6><a class=lnlinks href=#hl-46-6> 6</a>
</span><span class=lnt id=hl-46-7><a class=lnlinks href=#hl-46-7> 7</a>
</span><span class=lnt id=hl-46-8><a class=lnlinks href=#hl-46-8> 8</a>
</span><span class=lnt id=hl-46-9><a class=lnlinks href=#hl-46-9> 9</a>
</span><span class=lnt id=hl-46-10><a class=lnlinks href=#hl-46-10>10</a>
</span><span class=lnt id=hl-46-11><a class=lnlinks href=#hl-46-11>11</a>
</span><span class=lnt id=hl-46-12><a class=lnlinks href=#hl-46-12>12</a>
</span><span class=lnt id=hl-46-13><a class=lnlinks href=#hl-46-13>13</a>
</span><span class=lnt id=hl-46-14><a class=lnlinks href=#hl-46-14>14</a>
</span><span class=lnt id=hl-46-15><a class=lnlinks href=#hl-46-15>15</a>
</span><span class=lnt id=hl-46-16><a class=lnlinks href=#hl-46-16>16</a>
</span><span class=lnt id=hl-46-17><a class=lnlinks href=#hl-46-17>17</a>
</span><span class=lnt id=hl-46-18><a class=lnlinks href=#hl-46-18>18</a>
</span><span class=lnt id=hl-46-19><a class=lnlinks href=#hl-46-19>19</a>
</span><span class=lnt id=hl-46-20><a class=lnlinks href=#hl-46-20>20</a>
</span><span class=lnt id=hl-46-21><a class=lnlinks href=#hl-46-21>21</a>
</span><span class=lnt id=hl-46-22><a class=lnlinks href=#hl-46-22>22</a>
</span><span class=lnt id=hl-46-23><a class=lnlinks href=#hl-46-23>23</a>
</span><span class=lnt id=hl-46-24><a class=lnlinks href=#hl-46-24>24</a>
</span><span class=lnt id=hl-46-25><a class=lnlinks href=#hl-46-25>25</a>
</span><span class=lnt id=hl-46-26><a class=lnlinks href=#hl-46-26>26</a>
</span><span class=lnt id=hl-46-27><a class=lnlinks href=#hl-46-27>27</a>
</span><span class=lnt id=hl-46-28><a class=lnlinks href=#hl-46-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command API 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=n>order</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1. Write DB에 저장 (간략화 예시)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Saving order: </span><span class=si>{</span><span class=n>order</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 2. 이벤트 발행</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;order_created&#39;</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;order created&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query API 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>query_app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cache</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@query_app.get</span><span class=p>(</span><span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Redis 캐시 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=k>if</span> <span class=n>data</span> <span class=k>else</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;Not found&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>주석: Command API는 쓰기와 이벤트 발행, Query API는 읽기 전용 캐시 조회를 담당.</p></blockquote><hr><h2 id=phase-6-운영-및-최적화-1><strong>Phase 6: 운영 및 최적화</strong><a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-1>#</a></h2><h3 id=보안-및-거버넌스-2>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스-2>#</a></h3><ul><li><strong>보안</strong>: 쓰기/읽기 API 권한 분리, 데이터 무결성 검증</li><li><strong>규정 준수</strong>: 이벤트 로그 보존, GDPR/개인정보 처리 기준 준수</li></ul><h3 id=모니터링-및-관측성-2>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성-2>#</a></h3><ul><li>Write DB/Read DB 동기화 지연 모니터링</li><li>이벤트 처리 실패율, 큐 대기 시간 수집</li><li>OpenTelemetry 기반 추적</li></ul><h3 id=성능-최적화-전략>성능 최적화 전략<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략>#</a></h3><table><thead><tr><th>구분</th><th>전략</th><th>설명</th></tr></thead><tbody><tr><td>읽기 성능</td><td>캐시 적용</td><td>Redis/Memcached</td></tr><tr><td>쓰기 성능</td><td>비동기 처리</td><td>이벤트 큐, 배치 업데이트</td></tr><tr><td>데이터 동기화</td><td>병렬 처리</td><td>이벤트 소비자 다중화</td></tr></tbody></table><hr><h2 id=phase-7-고급-주제-1><strong>Phase 7: 고급 주제</strong><a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-1>#</a></h2><h3 id=현재-도전-과제-2>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제-2>#</a></h3><ul><li>데이터 불일치 처리: eventual consistency 문제</li><li>이벤트 순서 보장: Kafka 파티션 설계 필요</li><li>다중 서비스 간 스키마 호환성</li></ul><h3 id=생태계-및-관련-기술-2>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술-2>#</a></h3><table><thead><tr><th>기술</th><th>역할</th></tr></thead><tbody><tr><td>Event Sourcing</td><td>CQRS와 결합 시 변경 이력 보존</td></tr><tr><td>Kafka/RabbitMQ</td><td>이벤트 브로커</td></tr><tr><td>Elasticsearch</td><td>읽기 모델 최적화</td></tr></tbody></table><h3 id=최신-기술-트렌드>최신 기술 트렌드<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드>#</a></h3><ul><li><strong>Serverless CQRS</strong>: AWS Lambda, DynamoDB Streams</li><li><strong>CQRS + GraphQL</strong>: 읽기 API를 GraphQL로 최적화</li><li><strong>Edge CQRS</strong>: CDN Edge에 Query Model 캐싱</li></ul><hr><h2 id=최종-정리-및-학습-가이드-2><strong>최종 정리 및 학습 가이드</strong><a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드-2>#</a></h2><p><strong>내용 종합</strong>
CQRS는 읽기/쓰기 분리를 통해 성능, 확장성, 유지보수성을 개선하는 아키텍처 패턴이다. 이벤트 기반 설계, 다양한 저장소 사용, 마이크로서비스와의 결합이 강력한 시너지를 낸다. 그러나 eventual consistency, 설계 복잡성 증가에 주의가 필요하다.</p><p><strong>학습 로드맵</strong></p><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>CQRS 개념 이해</td><td>필수</td><td>CQS 원칙과 차이 이해</td></tr><tr><td>이론</td><td>2</td><td>아키텍처 구성 요소</td><td>필수</td><td>Command/Query 모델 설계</td></tr><tr><td>분석</td><td>3</td><td>장단점 분석</td><td>필수</td><td>트레이드오프 이해</td></tr><tr><td>구현</td><td>5</td><td>실습 예제 구현</td><td>권장</td><td>FastAPI + Kafka/Redis</td></tr><tr><td>운영</td><td>6</td><td>모니터링</td><td>권장</td><td>이벤트 지연 측정</td></tr><tr><td>고급</td><td>7</td><td>최신 트렌드</td><td>선택</td><td>Serverless CQRS</td></tr></tbody></table><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td>CQRS</td><td>읽기와 쓰기 모델을 분리하는 아키텍처 패턴</td><td>CQS, DDD</td></tr><tr><td>구현</td><td>Command Handler</td><td>쓰기 로직과 상태 변경 처리</td><td>Aggregate, Domain Event</td></tr><tr><td>구현</td><td>Query Handler</td><td>읽기 전용 데이터 처리</td><td>Projection</td></tr><tr><td>운영</td><td>Eventual Consistency</td><td>비동기 처리로 인한 일시적 불일치</td><td>CAP 이론</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>Microsoft CQRS Guide</a></li><li><a href=https://cqrs.wordpress.com/>Greg Young CQRS Post</a></li><li><a href=https://martinfowler.com/articles/ea.html>Event-Driven Architecture Patterns</a></li></ul><hr><p>이렇게 하면 CQRS의 <strong>개념 → 이론 → 분석 → 구현 → 운영 → 고급</strong> 전 과정을 다룬 실무형 아키텍처 보고서가 완성됩니다.</p><p>좋아요. 이어서 <strong>Phase 4~7의 추가 보완</strong>, <strong>실습/도입 사례의 코드 구현(심화)</strong>, <strong>운영·보안·관측성 표</strong>, <strong>트레이드오프/고급 주제 보강</strong>, 그리고 마지막에 <strong>종합 정리·로드맵</strong>까지 깔끔히 마무리하겠습니다.
(필요한 부분에 신뢰 가능한 자료를 함께 인용합니다.)</p><hr><h1 id=phase-4-구현-및-분류-보강>Phase 4: 구현 및 분류 (보강)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-보강>#</a></h1><h2 id=구현-기법-및-방법-정의구성목적실전-예시>구현 기법 및 방법 (정의·구성·목적·실전 예시)<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법-정의구성목적실전-예시>#</a></h2><ol><li><strong>단일 저장소 기반 CQRS</strong></li></ol><ul><li><strong>정의</strong>: 하나의 데이터베이스(예: PostgreSQL)에서 **쓰기 모델(정규화)**과 **읽기 모델(머티리얼라이즈드 뷰/별도 테이블)**만 논리적으로 분리.</li><li><strong>목적</strong>: 조직/초기 단계에서 운영 복잡도 최소화하며 CQRS의 구조적 이점을 취함.</li><li><strong>실전 예시</strong>: 주문 쓰기는 <code>orders</code> 정규화 테이블, 조회는 <code>order_read_model</code> 머티리얼라이즈드 뷰를 사용.</li><li><strong>근거</strong>: Microsoft Azure 패턴 문서도 CQRS를 단일 DB 구성부터 폭넓게 설명하며 상황 적합성을 강조. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>)</li></ul><ol start=2><li><strong>이중 저장소 기반 CQRS (Polyglot Persistence)</strong></li></ol><ul><li><strong>정의</strong>: 쓰기(Write)와 읽기(Read) 저장소를 분리, 예: <strong>Write=RDBMS</strong>, <strong>Read=Elasticsearch/Redis/Key-Value</strong>.</li><li><strong>목적</strong>: 읽기/쓰기의 상이한 액세스 패턴을 최적화, 독립적 확장.</li><li><strong>실전 예시</strong>: 이커머스에서 쓰기는 PostgreSQL, 읽기는 Elasticsearch 인덱스와 Redis 캐시.</li><li><strong>근거</strong>: CQRS의 핵심 가치(성능·확장성·보안)에 대한 Azure 가이드. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>)</li></ul><ol start=3><li><strong>이벤트 소싱(Event Sourcing) 결합형</strong></li></ol><ul><li><strong>정의</strong>: 상태를 스냅샷이 아닌 <strong>이벤트 로그</strong>로 보관하고, 읽기 모델은 이벤트를 재생해 <strong>Projection</strong> 생성.</li><li><strong>목적</strong>: <strong>변경 이력/감사(감사 추적)</strong> 보존, 시간여행, 재처리/재구성.</li><li><strong>실전 예시</strong>: DynamoDB에 이벤트 저장 → Streams → Lambda → OpenSearch 인덱스/Redis Projection.</li><li><strong>근거</strong>: Azure Event Sourcing 패턴, AWS DynamoDB 기반 CQRS 이벤트 스토어 안내. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">Microsoft Learn</a>, <a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">Amazon Web Services, Inc.</a>)</li></ul><ol start=4><li><strong>트랜잭셔널 아웃박스(Transactional Outbox) + CDC(Change Data Capture)</strong></li></ol><ul><li><strong>정의</strong>: <strong>이중 쓰기 문제</strong>(DB와 브로커 동시 쓰기 불일치)를 방지하기 위해, 쓰기 트랜잭션 내 <strong>outbox 테이블</strong>에 이벤트를 기록하고 CDC/폴러가 브로커로 전달.</li><li><strong>목적</strong>: 메시지 유실/불일치 방지, <strong>정확히 한 번 처리</strong>에 근접.</li><li><strong>실전 예시</strong>: MySQL Outbox → Debezium Outbox Event Router → Kafka → 소비자(Projection)</li><li><strong>근거</strong>: microservices.io, AWS Prescriptive Guidance, Debezium 공식 문서. (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">AWS Documentation</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</li></ul><ol start=5><li><strong>메시지 순서 보장 설계(Kafka 파티션/키)</strong></li></ol><ul><li><strong>정의</strong>: <strong>같은 키</strong>(주문ID 등)는 <strong>같은 파티션</strong>으로 보내 순서 보장, 글로벌 순서는 불가.</li><li><strong>목적</strong>: 상태 전이 순서 보장(예: <code>Created → Paid → Shipped</code>).</li><li><strong>근거</strong>: Kafka는 파티션 단위 순서 보장을 제공(키-파티션 전략 필수). (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>, <a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">dattell.com</a>, <a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">Stack Overflow</a>)</li></ul><h2 id=분류-기준에-따른-유형-구분보강-표>분류 기준에 따른 유형 구분(보강 표)<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분보강-표>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th><th>적용 사례</th></tr></thead><tbody><tr><td>저장소</td><td>단일 DB CQRS</td><td>동일 DB, 읽기 테이블/뷰 분리</td><td>초기 단계/운영 단순화</td></tr><tr><td>저장소</td><td>이중 DB CQRS</td><td>Write-Read DB 분리(Polyglot)</td><td>대규모 조회(Elasticsearch/Redis)</td></tr><tr><td>이벤트 관리</td><td>Outbox+CDC</td><td>이중 쓰기 문제 해결, 신뢰성↑</td><td>Debezium/Kafka 연계</td></tr><tr><td>일관성</td><td>동기</td><td>요청 내 갱신 후 즉시 읽기</td><td>소규모/강한 일관성 요구</td></tr><tr><td>일관성</td><td>비동기(Eventual)</td><td>이벤트로 Projection 갱신</td><td>대부분의 대규모 시스템</td></tr><tr><td>패턴 결합</td><td>CQRS+Event Sourcing</td><td>이벤트 스토어 중심 운영</td><td>규제/감사 이력 필수 도메인</td></tr></tbody></table><hr><h1 id=phase-5-실무-적용-보강>Phase 5: 실무 적용 (보강)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-보강>#</a></h1><h2 id=실제-도입-사례-조합-기술효과>실제 도입 사례 (조합 기술·효과)<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-조합-기술효과>#</a></h2><ul><li><strong>이커머스</strong>: 주문/결제는 RDBMS(쓰기), 상품 카탈로그/검색은 Elasticsearch(읽기), Outbox+Kafka로 Projection 동기화 → <strong>검색 응답 지연 감소, 트래픽 피크에도 안정</strong>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>)</li><li><strong>금융(거래 원장)</strong>: Event Sourcing으로 거래 이벤트 로그 보존, Read는 잔액·명세 Projection, 파티션 키를 계좌ID로 설정 → <strong>순서 보장 및 감시/감사 대응</strong>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">Microsoft Learn</a>)</li><li><strong>Serverless</strong>: DynamoDB(Event Store) → Streams → Lambda → OpenSearch/Redis → <strong>운영 관리 축소, 비용 효율적인 확장</strong>. (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">Amazon Web Services, Inc.</a>, <a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">builder.aws.com</a>)</li></ul><hr><h2 id=실습-예제-및-코드-구현-심화>실습 예제 및 코드 구현 (심화)<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현-심화>#</a></h2><p><strong>시나리오</strong>: “주문(Order) 생성→결제 승인→배송 시작” 이벤트가 발생하면, 읽기 모델(Projection)을 Redis와 OpenSearch로 갱신하는 <strong>CQRS+Outbox</strong> 미니 시스템.</p><p><strong>시스템 구성</strong>:</p><ul><li>FastAPI(Command/Query API), PostgreSQL(Write), <strong>Outbox 테이블</strong>, Debezium CDC → Kafka(Event Bus), <strong>Projection Consumer</strong>(Python), Redis(OpenSearch 대체 가능)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
  C[Client] --&gt; CA[Command API(FastAPI)]
  CA --&gt; WDB[(PostgreSQL)]
  CA --&gt; OUTBOX[(outbox)]
  Deb[Debezium CDC] --&gt; K[Kafka]
  K --&gt; PC[Projection Consumer]
  PC --&gt; R[Redis - Read Model]
  C --&gt; QA[Query API(FastAPI)]
  QA --&gt; R
</pre><p><strong>Workflow</strong>:</p><ol><li>Command API가 쓰기 트랜잭션으로 <code>orders</code>와 <code>outbox</code>에 기록(이중 쓰기 방지)</li><li>Debezium이 outbox 변화 감지 → Kafka 토픽 발행</li><li>Projection Consumer가 이벤트를 수신하여 Redis의 읽기 모델 업데이트</li><li>Query API는 Redis에서 빠른 조회 응답</li></ol><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동일 DB에서 조인/인덱스 경쟁으로 조회 지연</li><li>도입 후: 읽기 경로 짧고(캐시/키 조회), 쓰기 확장과 독립적 운영</li></ul><p><strong>구현 예시</strong> (Python/SQL - 핵심 부분 주석 포함)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1> 1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2> 2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3> 3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4> 4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5> 5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6> 6</a>
</span><span class=lnt id=hl-48-7><a class=lnlinks href=#hl-48-7> 7</a>
</span><span class=lnt id=hl-48-8><a class=lnlinks href=#hl-48-8> 8</a>
</span><span class=lnt id=hl-48-9><a class=lnlinks href=#hl-48-9> 9</a>
</span><span class=lnt id=hl-48-10><a class=lnlinks href=#hl-48-10>10</a>
</span><span class=lnt id=hl-48-11><a class=lnlinks href=#hl-48-11>11</a>
</span><span class=lnt id=hl-48-12><a class=lnlinks href=#hl-48-12>12</a>
</span><span class=lnt id=hl-48-13><a class=lnlinks href=#hl-48-13>13</a>
</span><span class=lnt id=hl-48-14><a class=lnlinks href=#hl-48-14>14</a>
</span><span class=lnt id=hl-48-15><a class=lnlinks href=#hl-48-15>15</a>
</span><span class=lnt id=hl-48-16><a class=lnlinks href=#hl-48-16>16</a>
</span><span class=lnt id=hl-48-17><a class=lnlinks href=#hl-48-17>17</a>
</span><span class=lnt id=hl-48-18><a class=lnlinks href=#hl-48-18>18</a>
</span><span class=lnt id=hl-48-19><a class=lnlinks href=#hl-48-19>19</a>
</span><span class=lnt id=hl-48-20><a class=lnlinks href=#hl-48-20>20</a>
</span><span class=lnt id=hl-48-21><a class=lnlinks href=#hl-48-21>21</a>
</span><span class=lnt id=hl-48-22><a class=lnlinks href=#hl-48-22>22</a>
</span><span class=lnt id=hl-48-23><a class=lnlinks href=#hl-48-23>23</a>
</span><span class=lnt id=hl-48-24><a class=lnlinks href=#hl-48-24>24</a>
</span><span class=lnt id=hl-48-25><a class=lnlinks href=#hl-48-25>25</a>
</span><span class=lnt id=hl-48-26><a class=lnlinks href=#hl-48-26>26</a>
</span><span class=lnt id=hl-48-27><a class=lnlinks href=#hl-48-27>27</a>
</span><span class=lnt id=hl-48-28><a class=lnlinks href=#hl-48-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># FastAPI Command API: 트랜잭션 내 본데이터+Outbox에 함께 기록하여 이중 쓰기 문제 방지</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>uuid</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=orders user=app password=secret host=localhost&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=n>payload</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>evt</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>payload</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1) 본 데이터 저장 (쓰기 모델)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;INSERT INTO orders(id, status, total_amount) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;CREATED&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;total_amount&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>            <span class=c1># 2) Outbox에 이벤트 기록 (동일 트랜잭션)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;INSERT INTO outbox(event_id, aggregate_id, event_type, payload, occurred_at, status)
</span></span></span><span class=line><span class=cl><span class=s2>                           VALUES (</span><span class=si>%s</span><span class=s2>,</span><span class=si>%s</span><span class=s2>,</span><span class=si>%s</span><span class=s2>,</span><span class=si>%s</span><span class=s2>, to_timestamp(</span><span class=si>%s</span><span class=s2>), &#39;PENDING&#39;)&#34;&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>evt</span><span class=p>[</span><span class=s2>&#34;event_id&#34;</span><span class=p>],</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;aggregate_id&#34;</span><span class=p>],</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>],</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>evt</span><span class=p>),</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;occurred_at&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;created&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1> 1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2> 2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3> 3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4> 4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5> 5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6> 6</a>
</span><span class=lnt id=hl-49-7><a class=lnlinks href=#hl-49-7> 7</a>
</span><span class=lnt id=hl-49-8><a class=lnlinks href=#hl-49-8> 8</a>
</span><span class=lnt id=hl-49-9><a class=lnlinks href=#hl-49-9> 9</a>
</span><span class=lnt id=hl-49-10><a class=lnlinks href=#hl-49-10>10</a>
</span><span class=lnt id=hl-49-11><a class=lnlinks href=#hl-49-11>11</a>
</span><span class=lnt id=hl-49-12><a class=lnlinks href=#hl-49-12>12</a>
</span><span class=lnt id=hl-49-13><a class=lnlinks href=#hl-49-13>13</a>
</span><span class=lnt id=hl-49-14><a class=lnlinks href=#hl-49-14>14</a>
</span><span class=lnt id=hl-49-15><a class=lnlinks href=#hl-49-15>15</a>
</span><span class=lnt id=hl-49-16><a class=lnlinks href=#hl-49-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- PostgreSQL 테이블 (쓰기 모델 + Outbox)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=w> </span><span class=n>uuid</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>status</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>total_amount</span><span class=w> </span><span class=nb>numeric</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>outbox</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>event_id</span><span class=w> </span><span class=n>uuid</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>aggregate_id</span><span class=w> </span><span class=n>uuid</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>event_type</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>payload</span><span class=w> </span><span class=n>jsonb</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>occurred_at</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>status</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Debezium은 outbox 테이블의 변경을 캡처하여 Kafka로 전달 (CDC)
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>Outbox+CDC 구성이 <strong>이중 쓰기 문제</strong>를 해결하는 정석 패턴. (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">AWS Documentation</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1> 1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2> 2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3> 3</a>
</span><span class=lnt id=hl-50-4><a class=lnlinks href=#hl-50-4> 4</a>
</span><span class=lnt id=hl-50-5><a class=lnlinks href=#hl-50-5> 5</a>
</span><span class=lnt id=hl-50-6><a class=lnlinks href=#hl-50-6> 6</a>
</span><span class=lnt id=hl-50-7><a class=lnlinks href=#hl-50-7> 7</a>
</span><span class=lnt id=hl-50-8><a class=lnlinks href=#hl-50-8> 8</a>
</span><span class=lnt id=hl-50-9><a class=lnlinks href=#hl-50-9> 9</a>
</span><span class=lnt id=hl-50-10><a class=lnlinks href=#hl-50-10>10</a>
</span><span class=lnt id=hl-50-11><a class=lnlinks href=#hl-50-11>11</a>
</span><span class=lnt id=hl-50-12><a class=lnlinks href=#hl-50-12>12</a>
</span><span class=lnt id=hl-50-13><a class=lnlinks href=#hl-50-13>13</a>
</span><span class=lnt id=hl-50-14><a class=lnlinks href=#hl-50-14>14</a>
</span><span class=lnt id=hl-50-15><a class=lnlinks href=#hl-50-15>15</a>
</span><span class=lnt id=hl-50-16><a class=lnlinks href=#hl-50-16>16</a>
</span><span class=lnt id=hl-50-17><a class=lnlinks href=#hl-50-17>17</a>
</span><span class=lnt id=hl-50-18><a class=lnlinks href=#hl-50-18>18</a>
</span><span class=lnt id=hl-50-19><a class=lnlinks href=#hl-50-19>19</a>
</span><span class=lnt id=hl-50-20><a class=lnlinks href=#hl-50-20>20</a>
</span><span class=lnt id=hl-50-21><a class=lnlinks href=#hl-50-21>21</a>
</span><span class=lnt id=hl-50-22><a class=lnlinks href=#hl-50-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Projection Consumer (Kafka -&gt; Redis): 동일 aggregate_id 키를 사용해 순서 보장(단일 파티션 가정)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;orders-events&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;localhost:9092&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s2>&#34;projection-readmodel&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>evt</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>agg_id</span> <span class=o>=</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;aggregate_id&#34;</span><span class=p>]</span>  <span class=c1># 파티션 키로 설정되어 있다고 가정</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 타입별 Projection 갱신</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>agg_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;CREATED&#34;</span><span class=p>,</span> <span class=s2>&#34;total&#34;</span><span class=p>:</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;total_amount&#34;</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderPaid&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>agg_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;PAID&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>evt</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderShipped&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>agg_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;SHIPPED&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>  <span class=c1># at-least-once, idempotent 갱신 로직 권장</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>파티션 키=주문ID로 설정하면 <strong>순서 보장</strong>(같은 파티션) → 상태 전이 안전. (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1> 1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2> 2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3> 3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4> 4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5> 5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6> 6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7> 7</a>
</span><span class=lnt id=hl-51-8><a class=lnlinks href=#hl-51-8> 8</a>
</span><span class=lnt id=hl-51-9><a class=lnlinks href=#hl-51-9> 9</a>
</span><span class=lnt id=hl-51-10><a class=lnlinks href=#hl-51-10>10</a>
</span><span class=lnt id=hl-51-11><a class=lnlinks href=#hl-51-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># FastAPI Query API: 읽기 전용(Projection) 경로</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@q.get</span><span class=p>(</span><span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>hgetall</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span> <span class=k>if</span> <span class=n>data</span> <span class=k>else</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;not-found&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=실제-도입-사례의-코드-구현-1건-선택심화>실제 도입 사례의 코드 구현 (1건 선택·심화)<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현-1건-선택심화>#</a></h2><p><strong>시나리오</strong>: <strong>Serverless CQRS + Event Sourcing</strong> — **DynamoDB(Event Store)**에 이벤트를 Append하고, <strong>DynamoDB Streams → AWS Lambda</strong>로 <strong>OpenSearch</strong>(또는 Redis) Projection을 생성.
<strong>효과</strong>: 서버 관리 최소화, 초당 이벤트 폭증에도 원활한 <strong>수평 확장</strong>, <strong>비용 효율성</strong>. (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">Amazon Web Services, Inc.</a>, <a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">builder.aws.com</a>)</p><p><strong>시스템 구성</strong>:</p><ul><li><strong>Write(API Gateway + Lambda)</strong>: <code>PUT /orders/{id}</code> → DynamoDB <code>events</code> 테이블에 Append(타입/버전/페이로드)</li><li><strong>Stream Processor(Lambda)</strong>: Streams 레코드 → OpenSearch/Redis 업데이트</li><li><strong>Read(API Gateway + Lambda)</strong>: Projection에서 조회</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
  C[Client] --&gt; APIGW[API Gateway]
  APIGW --&gt; W[Lambda(Command)]
  W --&gt; DDB[(DynamoDB Event Store)]
  DDB --&gt; DS[DynamoDB Streams]
  DS --&gt; P[Lambda(Projection)]
  P --&gt; OS[OpenSearch / Redis]
  C --&gt; QAPIGW[API Gateway(Query)]
  QAPIGW --&gt; QR[Lambda(Query)]
  QR --&gt; OS
</pre><p><strong>Workflow</strong>:</p><ol><li>Command Lambda가 <code>OrderCreated</code> 이벤트를 이벤트 스토어(DDB)에 Append</li><li>Streams가 이벤트를 트리거 → Projection Lambda가 OpenSearch/Redis 업데이트</li><li>Query Lambda가 Projection에서 조회 반환</li></ol><p><strong>유무에 따른 차이점</strong>:</p><ul><li>전: 단일 RDB 조인 기반 조회로 지연/경쟁</li><li>후: Write/Read 경로 분리, 대량 조회 시 선형 확장</li></ul><p><strong>구현 예시</strong> (Python Lambda 핵심)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1> 1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2> 2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3> 3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4> 4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5> 5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6> 6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7> 7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8> 8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9> 9</a>
</span><span class=lnt id=hl-53-10><a class=lnlinks href=#hl-53-10>10</a>
</span><span class=lnt id=hl-53-11><a class=lnlinks href=#hl-53-11>11</a>
</span><span class=lnt id=hl-53-12><a class=lnlinks href=#hl-53-12>12</a>
</span><span class=lnt id=hl-53-13><a class=lnlinks href=#hl-53-13>13</a>
</span><span class=lnt id=hl-53-14><a class=lnlinks href=#hl-53-14>14</a>
</span><span class=lnt id=hl-53-15><a class=lnlinks href=#hl-53-15>15</a>
</span><span class=lnt id=hl-53-16><a class=lnlinks href=#hl-53-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Lambda: 이벤트 소싱 Append (CQRS 쓰기 측)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>uuid</span><span class=o>,</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=n>ddb</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>resource</span><span class=p>(</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>Table</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;EVENTS_TABLE&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;pathParameters&#34;</span><span class=p>][</span><span class=s2>&#34;id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s2>&#34;body&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>evt</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=o>*</span><span class=mi>1000</span><span class=p>),</span>  <span class=c1># 간단 버전(프로덕션은 정합 설계 필요)</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;payload&#34;</span><span class=p>:</span> <span class=n>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ddb</span><span class=o>.</span><span class=n>put_item</span><span class=p>(</span><span class=n>Item</span><span class=o>=</span><span class=n>evt</span><span class=p>)</span>  <span class=c1># append-only</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;statusCode&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=s2>&#34;body&#34;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>})}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1> 1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2> 2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3> 3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4> 4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5> 5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6> 6</a>
</span><span class=lnt id=hl-54-7><a class=lnlinks href=#hl-54-7> 7</a>
</span><span class=lnt id=hl-54-8><a class=lnlinks href=#hl-54-8> 8</a>
</span><span class=lnt id=hl-54-9><a class=lnlinks href=#hl-54-9> 9</a>
</span><span class=lnt id=hl-54-10><a class=lnlinks href=#hl-54-10>10</a>
</span><span class=lnt id=hl-54-11><a class=lnlinks href=#hl-54-11>11</a>
</span><span class=lnt id=hl-54-12><a class=lnlinks href=#hl-54-12>12</a>
</span><span class=lnt id=hl-54-13><a class=lnlinks href=#hl-54-13>13</a>
</span><span class=lnt id=hl-54-14><a class=lnlinks href=#hl-54-14>14</a>
</span><span class=lnt id=hl-54-15><a class=lnlinks href=#hl-54-15>15</a>
</span><span class=lnt id=hl-54-16><a class=lnlinks href=#hl-54-16>16</a>
</span><span class=lnt id=hl-54-17><a class=lnlinks href=#hl-54-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Projection Lambda: Streams → OpenSearch/Redis 업데이트 (CQRS 읽기 측)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>boto3</span><span class=o>,</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;REDIS_HOST&#39;</span><span class=p>],</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;Records&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;eventName&#34;</span><span class=p>]</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;INSERT&#34;</span><span class=p>,</span><span class=s2>&#34;MODIFY&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=o>=</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;dynamodb&#34;</span><span class=p>][</span><span class=s2>&#34;NewImage&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>agg</span> <span class=o>=</span> <span class=n>new</span><span class=p>[</span><span class=s2>&#34;aggregate_id&#34;</span><span class=p>][</span><span class=s2>&#34;S&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>et</span>  <span class=o>=</span> <span class=n>new</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>][</span><span class=s2>&#34;S&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>new</span><span class=p>[</span><span class=s2>&#34;payload&#34;</span><span class=p>][</span><span class=s2>&#34;S&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>et</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>agg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;CREATED&#34;</span><span class=p>,</span><span class=s2>&#34;total&#34;</span><span class=p>:</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;total_amount&#34;</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>et</span> <span class=o>==</span> <span class=s2>&#34;OrderPaid&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>agg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;PAID&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>et</span> <span class=o>==</span> <span class=s2>&#34;OrderShipped&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>agg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;SHIPPED&#34;</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>AWS 공식/레퍼런스 아키텍처에서 <strong>DynamoDB Streams + Lambda</strong>로 CQRS/Event Sourcing 구현을 권장. (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">Amazon Web Services, Inc.</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">AWS Documentation</a>)</p></blockquote><hr><h1 id=phase-6-운영-및-최적화-보강>Phase 6: 운영 및 최적화 (보강)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-보강>#</a></h1><h2 id=보안-및-거버넌스-표--권장>보안 및 거버넌스 (표 + 권장)<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스-표--권장>#</a></h2><table><thead><tr><th>항목</th><th>권장 사항</th><th>근거/참고</th></tr></thead><tbody><tr><td>권한 분리</td><td>Command/Query API IAM(Role) 분리, 최소권한(Principle of Least Privilege)</td><td>일반 보안 모범사례</td></tr><tr><td>데이터 무결성</td><td>이벤트 스키마(Avro/JSON-Schema) 버전 관리, 소비자 스키마 검증</td><td>스키마 역호환성은 이벤트 기반의 핵심</td></tr><tr><td>감사/규정</td><td>Event Sourcing 시 원본 이벤트 보존 주기·암호화·보관 정책</td><td>Event Sourcing 패턴 문서 참조 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">Microsoft Learn</a>)</td></tr><tr><td>전송 보호</td><td>브로커/KV/DB 통신 TLS, 토픽/키 접근 제어</td><td>클라우드 보안 표준</td></tr><tr><td>재처리 통제</td><td>idempotency-key, 이벤트 버전/오프셋 체크</td><td>Outbox/CDC 및 소비자 재처리 실무 (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</td></tr></tbody></table><h2 id=모니터링-및-관측성-성능로깅메트릭>모니터링 및 관측성 (성능/로깅/메트릭)<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성-성능로깅메트릭>#</a></h2><ul><li><strong>핵심 지표</strong>: 이벤트 지연(end-to-end lag), 소비자 처리율, DLQ(Dead Letter Queue) 건수, Read-Write 일치율(샘플링 비교), 파티션 스큐(skew).</li><li><strong>분산 추적</strong>: Command 요청-ID → 이벤트 메타데이터(traceparent) → Projection → Query 응답까지 <strong>단일 트레이스</strong> 연결(OpenTelemetry). (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">Microsoft Learn</a>)</li><li><strong>경보</strong>: Outbox 적체, Kafka consumer lag, Streams 재시도 증가, 스키마 검증 실패율.</li></ul><h2 id=실무-적용-고려사항-표>실무 적용 고려사항 (표)<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-표>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>파티션 키</td><td>비즈니스 불변 식별자(주문ID/계좌ID)로 키 선정 → 순서 보장 (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</td></tr><tr><td>설계</td><td>이벤트 최소화</td><td>사소한 이벤트 남발 금지(코스트/복잡성 증가)</td></tr><tr><td>구현</td><td>Outbox/CDC</td><td>트랜잭션 내 outbox 기록 + Debezium Outbox Router 도입 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</td></tr><tr><td>운영</td><td>재처리</td><td>소비자 idempotent 설계(HSET upsert 등)</td></tr><tr><td>운영</td><td>롤백</td><td>이벤트 소싱 시 보상 이벤트 또는 Saga로 처리</td></tr></tbody></table><h2 id=성능-최적화-전략-표>성능 최적화 전략 (표)<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략-표>#</a></h2><table><thead><tr><th>영역</th><th>전략</th><th>설명</th><th>근거</th></tr></thead><tbody><tr><td>읽기</td><td>캐시·머티리얼라이즈드 뷰</td><td>Redis/Elastic Projection로 핫패스 최적화</td><td>CQRS 패턴 가이드 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>)</td></tr><tr><td>쓰기</td><td>배치/비동기</td><td>이벤트 배치 전송, 소비자 병렬화</td><td>일반 스트리밍 최적화</td></tr><tr><td>브로커</td><td>파티션 설계</td><td>키 기반 파티셔닝, 핫 파티션 방지</td><td>Kafka 파티션/순서 (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</td></tr><tr><td>데이터</td><td>스키마 진화</td><td>Backward-compat 우선, 소비자 우선 배포</td><td>이벤트 호환성 모범사례</td></tr></tbody></table><hr><h1 id=phase-7-고급-주제-보강>Phase 7: 고급 주제 (보강)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-보강>#</a></h1><h2 id=현재-도전-과제-원인영향해결>현재 도전 과제 (원인/영향/해결)<a hidden class=anchor aria-hidden=true href=#현재-도전-과제-원인영향해결>#</a></h2><ul><li><strong>이벤트 순서/중복</strong>: 다중 파티션·재시도에서 순서 깨짐/중복 발생 가능 → <strong>키 고정, 단일 파티션, idempotent Projection</strong>. (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</li><li><strong>이중 쓰기/유실</strong>: DB와 브로커 동시 쓰기 실패 → <strong>Transactional Outbox + CDC</strong>로 해결. (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">AWS Documentation</a>)</li><li><strong>복잡성 증가</strong>: 운영·스키마 진화·관측성 비용 ↑ → <strong>단일 DB CQRS부터 점진 도입</strong>, 자동화 파이프라인.</li></ul><h2 id=생태계-및-관련-기술-표준프로토콜>생태계 및 관련 기술 (표준/프로토콜)<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술-표준프로토콜>#</a></h2><table><thead><tr><th>기술/표준</th><th>역할</th></tr></thead><tbody><tr><td>Debezium CDC / Outbox Router</td><td>DB 변경 캡처, Outbox에서 이벤트 추출·라우팅 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</td></tr><tr><td>Kafka / RabbitMQ</td><td>이벤트 브로커(파티션/라우팅/재시도)</td></tr><tr><td>OpenSearch / Elasticsearch</td><td>읽기 모델 인덱싱·검색 최적화</td></tr><tr><td>OpenTelemetry(OTel)</td><td>Trace/Metric/Log 통합 표준</td></tr><tr><td>Azure/AWS Pattern Docs</td><td>클라우드 네이티브 CQRS/ES 지침 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">AWS Documentation</a>)</td></tr></tbody></table><h2 id=최신-기술-트렌드와-미래-방향-2>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향-2>#</a></h2><ul><li><strong>Serverless CQRS/ES</strong>: 관리형 스트림과 함수 기반 프로젝션으로 운영 부담 감소. (<a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">builder.aws.com</a>)</li><li><strong>Managed Event Store</strong>: 클라우드 샘플/가이드 강화(Azure Cosmos DB ES 샘플 등). (<a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing - Code Samples">Microsoft Learn</a>)</li><li><strong>API 설계 진화</strong>: GraphQL/Edge 캐시와 결합한 초저지연 조회.</li></ul><h2 id=기타-고급-사항-1>기타 고급 사항<a hidden class=anchor aria-hidden=true href=#기타-고급-사항-1>#</a></h2><ul><li><strong>Saga 패턴</strong>(오케스트레이션/코레오그래피)로 분산 트랜잭션 조율, Outbox와 함께 사용. (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>)</li><li><strong>데이터 재구축 전략</strong>: 이벤트 리플레이 시 버전 마이그레이션/스냅샷 주기 관리.</li></ul><hr><h1 id=트레이드오프-관계-분석-요약>트레이드오프 관계 분석 (요약)<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석-요약>#</a></h1><ul><li><strong>성능 vs 복잡성</strong>: 읽기 성능/확장성↑ ↔ 설계·운영 복잡도↑. Martin Fowler도 “대부분 시스템에겐 과도할 수 있다”고 경고. (<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>martinfowler.com</a>)</li><li><strong>일관성 vs 가용성</strong>: 강한 일관성(동기 갱신) ↔ 가용성/확장성(비동기, eventual).</li><li><strong>신뢰성 vs 비용</strong>: Outbox/CDC/관측성 추가 ↔ 인프라·운영비 증가.</li></ul><hr><h1 id=단점-및-문제점-분석표-보강>단점 및 문제점 분석표 (보강)<a hidden class=anchor aria-hidden=true href=#단점-및-문제점-분석표-보강>#</a></h1><p>단점</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>설계 복잡성</td><td>모델/저장소/이벤트 파이프라인 관리 부담</td><td>초기엔 단일 DB CQRS로 시작, 자동화/템플릿화</td><td>레거시 단일 모델 + 인덱스 최적화</td></tr><tr><td>단점</td><td>이벤트 지연</td><td>비동기 Projection 지연으로 UI 불일치</td><td>UI에 “처리 중” 상태, <strong>Read-your-own-writes</strong> 경로 제공(세션 캐시)</td><td>동기 CQRS(소규모)</td></tr><tr><td>단점</td><td>이중 쓰기</td><td>DB와 브로커 동시 갱신 실패로 불일치</td><td><strong>Transactional Outbox + CDC</strong></td><td>2PC(현대 분산환경에 부적합) (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">AWS Documentation</a>)</td></tr><tr><td>단점</td><td>순서 보장</td><td>다중 파티션/스케일 아웃 시 순서 붕괴</td><td>키 기반 단일 파티션, idempotent 소비</td><td>단일 노드 직렬화(확장성 저하) (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</td></tr></tbody></table><p>문제점</p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>이벤트 유실</td><td>네트워크/크래시/이중 쓰기</td><td>데이터 불일치</td><td>소비자 lag/DLQ 모니터</td><td>Outbox, 재시도/백오프</td><td>CDC, 멱등 처리, 리플레이 (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</td></tr><tr><td>문제점</td><td>스키마 불일치</td><td>이벤트 필드 변경</td><td>소비자 실패</td><td>스키마 레지스트리 경고</td><td>Backward-compat 우선</td><td>멀티버전 소비자 단계적 전환</td></tr><tr><td>문제점</td><td>핫 파티션</td><td>키 편중</td><td>처리 병목</td><td>파티션 메트릭/스큐</td><td>키 해시/샤딩</td><td>재파티셔닝·리밸런스 (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</td></tr></tbody></table><hr><h1 id=최종-정리-및-학습-가이드-업데이트>최종 정리 및 학습 가이드 (업데이트)<a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드-업데이트>#</a></h1><h2 id=내용-종합-2>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합-2>#</a></h2><ul><li>CQRS는 <strong>쓰기/읽기 책임 분리</strong>로 <strong>성능·확장성·유지보수성</strong>을 확보하는 패턴.</li><li><strong>Outbox+CDC</strong>로 <strong>신뢰성</strong> 확보, <strong>Kafka 파티션 설계</strong>로 순서 보장, <strong>Serverless</strong>로 운영 단순화.</li><li>과도한 복잡성은 위험이므로 <strong>단계적 도입</strong>과 <strong>관측성/스키마 관리</strong>가 핵심. (<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>martinfowler.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>, <a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>)</li></ul><h2 id=학습-로드맵-phase-기준>학습 로드맵 (Phase 기준)<a hidden class=anchor aria-hidden=true href=#학습-로드맵-phase-기준>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1>1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2>2</a>
</span><span class=lnt id=hl-55-3><a class=lnlinks href=#hl-55-3>3</a>
</span><span class=lnt id=hl-55-4><a class=lnlinks href=#hl-55-4>4</a>
</span><span class=lnt id=hl-55-5><a class=lnlinks href=#hl-55-5>5</a>
</span><span class=lnt id=hl-55-6><a class=lnlinks href=#hl-55-6>6</a>
</span><span class=lnt id=hl-55-7><a class=lnlinks href=#hl-55-7>7</a>
</span><span class=lnt id=hl-55-8><a class=lnlinks href=#hl-55-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목 | 중요도 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------|--------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | CQRS/CQS 차이 | 필수   | 책임 분리의 의미·효과 이해 |
</span></span><span class=line><span class=cl>| 이론     | 2     | 구성요소/플로우 | 필수   | Command/Query/Projection/EventBus |
</span></span><span class=line><span class=cl>| 분석     | 3     | 장단점/트레이드오프 | 필수 | 복잡성 vs 이점 판단 |
</span></span><span class=line><span class=cl>| 구현     | 4,5   | Outbox+CDC, 파티션 설계 | 필수 | 실무 신뢰성·순서 보장 |
</span></span><span class=line><span class=cl>| 운영     | 6     | OTel 관측성·지연 모니터링 | 권장 | E2E 추적/알람 체계 |
</span></span><span class=line><span class=cl>| 고급     | 7     | ES+Saga/Serverless | 선택 | 규제/대규모·무서버 확장 |
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심</td><td>CQRS</td><td>쓰기/읽기 책임을 분리하는 아키텍처 패턴</td><td>CQS, DDD, Projection</td></tr><tr><td>구현</td><td>Transactional Outbox</td><td>트랜잭션 내 outbox 기록 + CDC로 브로커 전송</td><td>Debezium, Dual-write 문제 해결</td></tr><tr><td>구현</td><td>Projection</td><td>이벤트 재생/소비로 구성한 읽기 모델</td><td>Materialized View</td></tr><tr><td>운영</td><td>Eventual Consistency</td><td>비동기 동기화로 인한 일시적 불일치</td><td>CAP, UI 보상 전략</td></tr><tr><td>운영</td><td>Consumer Lag</td><td>브로커 오프셋 처리 지연</td><td>DLQ, 재처리</td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li>Microsoft Azure Architecture Center — <strong>CQRS 패턴</strong>, <strong>Event Sourcing</strong>, <strong>클라우드 패턴 카탈로그</strong>. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">Microsoft Learn</a>)</li><li>Martin Fowler — <strong>CQRS 블리키</strong>(적용 시 복잡성 경고 포함). (<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>martinfowler.com</a>)</li><li>microservices.io — <strong>Transactional Outbox</strong>. (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>)</li><li>AWS — <strong>DynamoDB로 CQRS 이벤트 스토어</strong>, <strong>CQRS+ES 분해 패턴</strong>, <strong>Serverless 안내</strong>. (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">Amazon Web Services, Inc.</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">AWS Documentation</a>, <a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">builder.aws.com</a>)</li><li>Debezium — <strong>Outbox Event Router/블로그</strong>. (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">Debezium</a>)</li><li>Kafka 순서 보장 — 기술 문서/가이드. (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">Baeldung on Kotlin</a>)</li></ul><hr><p>원하면 위 예제를 <strong>Docker Compose</strong>(Postgres+Kafka+Redis+Debezium+FastAPI)로 바로 실행 가능한 템플릿까지 만들어 드립니다. 테스트 시나리오(부하·지연·중복 이벤트·스키마 진화)도 포함해 드릴게요.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li><strong>Architecture-Patterns</strong></li><li><strong>Data-Management-Patterns</strong></li><li><strong>Software-Engineering</strong></li><li><strong>Microservices</strong></li></ul><hr><h2 id=2-분류-구조-적합성-분석>2. 분류 구조 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적합성-분석>#</a></h2><p><strong>현재 분류 구조</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1>1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2>2</a>
</span><span class=lnt id=hl-56-3><a class=lnlinks href=#hl-56-3>3</a>
</span><span class=lnt id=hl-56-4><a class=lnlinks href=#hl-56-4>4</a>
</span><span class=lnt id=hl-56-5><a class=lnlinks href=#hl-56-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Computer Science and Engineering
</span></span><span class=line><span class=cl>└─ Software Engineering
</span></span><span class=line><span class=cl>   └─ Design and Architecture
</span></span><span class=line><span class=cl>      └─ Architecture Patterns
</span></span><span class=line><span class=cl>         └─ Data Management Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>분석 및 근거</strong><br>CQRS는 소프트웨어 엔지니어링 분야에서 디자인 및 아키텍처 패턴 중 하나로, 데이터 관리 패턴의 대표적인 예시입니다.<br>CQRS는 데이터의 읽기(Query)와 쓰기(Command)를 분리하여 시스템의 성능, 확장성, 유지보수성을 높이는 패턴이므로,<br>“Data Management Patterns” 하위에 배치하는 것이 적절합니다.<br>또한, 마이크로서비스 환경에서 많이 활용되므로 “Microservices” 태그도 함께 사용할 수 있습니다<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">1</a><a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">3</a>.</p><hr><h2 id=3-요약-문장-200자-내외>3. 요약 문장 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-문장-200자-내외>#</a></h2><p>CQRS는 데이터 읽기와 쓰기 모델을 분리해 각각을 최적화하고, 시스템의 성능, 확장성, 유지보수성을 높이는 소프트웨어 아키텍처 패턴이다<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">5</a>.</p><hr><h2 id=4-전체-개요-250자-내외>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외>#</a></h2><p>CQRS는 데이터의 읽기(Query)와 쓰기(Command)를 분리하여 각각의 모델과 처리 로직을 독립적으로 설계·운영하는 패턴이다. 이를 통해 읽기와 쓰기 각각의 성능, 확장성, 보안을 최적화할 수 있으며, 복잡한 비즈니스 도메인에서 유연하게 시스템을 설계할 수 있다<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">5</a>.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>CQRS(Command Query Responsibility Segregation)</strong><ul><li>데이터의 읽기(Query)와 쓰기(Command)를 분리하여 각각의 모델과 처리 로직을 독립적으로 설계·운영하는 아키텍처 패턴<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">5</a>.</li><li><strong>Command(명령)</strong>: 시스템의 상태를 변경하는 작업(생성, 수정, 삭제 등).</li><li><strong>Query(조회)</strong>: 시스템의 상태를 변경하지 않고 데이터를 읽어오는 작업.</li><li><strong>Command Handler</strong>: 명령을 처리하여 시스템 상태를 변경하는 핸들러.</li><li><strong>Query Handler</strong>: 조회 요청을 처리하여 데이터를 반환하는 핸들러.</li><li><strong>Command Model</strong>: 쓰기(명령)에 최적화된 데이터 모델.</li><li><strong>Query Model</strong>: 읽기(조회)에 최적화된 데이터 모델(주로 비정규화, 캐시 등 활용).</li></ul></li><li><strong>실무 구현을 위한 연관성</strong><ul><li>읽기와 쓰기 트래픽이 불균형한 시스템(예: 이커머스, 실시간 분석, 대용량 데이터 처리)에서 효과적<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">6</a>.</li><li>마이크로서비스, 이벤트 소싱과 함께 사용 시 시스템의 복잡성 관리와 확장성 향상에 도움<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">2</a><a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">6</a>.</li><li>각 모델을 독립적으로 확장 및 최적화할 수 있어, 성능과 유지보수성 향상<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">4</a><a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">7</a>.</li></ul></li></ul><hr><h2 id=6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>6. 조사 및 분석: “주제와 관련하여 조사할 내용” 중심 정리<a hidden class=anchor aria-hidden=true href=#6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>#</a></h2><h3 id=1-배경>(1) 배경<a hidden class=anchor aria-hidden=true href=#1-배경>#</a></h3><ul><li>전통적인 CRUD(생성, 읽기, 수정, 삭제) 방식은 단일 모델로 읽기와 쓰기를 모두 처리함.</li><li>시스템이 복잡해질수록 읽기와 쓰기의 요구사항이 달라지고, 단일 모델로는 최적화가 어려움<a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">1</a><a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">7</a>.</li><li>읽기와 쓰기 트래픽의 비대칭성, 데이터 표현 차이, 잠금 경합 등 문제 발생<a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">1</a>.</li></ul><h3 id=2-목적-및-필요성>(2) 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#2-목적-및-필요성>#</a></h3><ul><li>읽기와 쓰기 모델을 분리하여 각각을 독립적으로 최적화.</li><li>시스템의 성능, 확장성, 유지보수성, 보안성 향상<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">5</a>.</li><li>복잡한 도메인에서 비즈니스 로직과 데이터 접근 방식을 명확히 분리<a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">6</a>.</li></ul><h3 id=3-주요-기능-및-역할>(3) 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#3-주요-기능-및-역할>#</a></h3><ul><li><strong>Command</strong>: 시스템 상태 변경(생성, 수정, 삭제).</li><li><strong>Query</strong>: 데이터 조회(상태 변경 없음).</li><li><strong>Command Handler</strong>: 명령 처리 및 상태 변경.</li><li><strong>Query Handler</strong>: 데이터 조회 및 반환.</li><li><strong>Event Store(선택)</strong>: 명령 처리 결과를 이벤트로 저장하여, 읽기 모델과의 동기화에 활용<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul><h3 id=4-특징>(4) 특징<a hidden class=anchor aria-hidden=true href=#4-특징>#</a></h3><ul><li>읽기와 쓰기 모델의 분리.</li><li>각 모델의 독립적 확장 및 최적화.</li><li>이벤트 소싱과의 연동 가능성.</li><li>마이크로서비스 환경에서의 활용성<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">2</a><a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">6</a>.</li></ul><h3 id=5-핵심-원칙>(5) 핵심 원칙<a hidden class=anchor aria-hidden=true href=#5-핵심-원칙>#</a></h3><ul><li><strong>명령(Command)과 조회(Query)의 책임 분리</strong><ul><li>명령은 상태를 변경하지만 결과를 반환하지 않음.</li><li>조회는 상태를 변경하지 않고 결과를 반환함<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">13</a><a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">10</a>.</li></ul></li><li><strong>명령과 조회 모델의 독립적 설계 및 운영</strong><ul><li>각 모델은 서로 다른 데이터 저장소, 처리 로직, 최적화 기법 사용 가능<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul></li><li><strong>이벤트 기반 동기화</strong><ul><li>명령 처리 결과를 이벤트로 저장하고, 읽기 모델에 전파하여 동기화(이벤트 소싱)<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul></li></ul><h3 id=6-주요-원리>(6) 주요 원리<a hidden class=anchor aria-hidden=true href=#6-주요-원리>#</a></h3><ul><li><strong>명령/조회 책임 분리</strong>: 명령과 조회의 처리 경로를 완전히 분리.</li><li><strong>이벤트 기반 동기화</strong>: 명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파.</li><li><strong>독립적 확장성</strong>: 읽기/쓰기 모델 각각의 확장성 보장.</li></ul><h3 id=7-작동-원리-및-다이어그램>(7) 작동 원리 및 다이어그램<a hidden class=anchor aria-hidden=true href=#7-작동-원리-및-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
    User --&gt;|Command| CommandHandler
    CommandHandler --&gt;|Update| WriteModel
    WriteModel --&gt;|Event| EventStore
    EventStore --&gt;|Event| EventBus
    EventBus --&gt;|Update| ReadModelUpdater
    ReadModelUpdater --&gt;|Update| ReadModel
    User --&gt;|Query| QueryHandler
    QueryHandler --&gt;|Retrieve| ReadModel
</pre><p><strong>설명</strong></p><ul><li><strong>User</strong>: 시스템을 사용하는 클라이언트.</li><li><strong>CommandHandler</strong>: 명령을 처리하여 쓰기 모델(Write Model)을 업데이트.</li><li><strong>WriteModel</strong>: 상태 변경(쓰기)에 최적화된 데이터 저장소.</li><li><strong>EventStore</strong>: 명령 처리 결과를 이벤트로 저장.</li><li><strong>EventBus</strong>: 이벤트를 읽기 측(Read Model)에 전파.</li><li><strong>ReadModelUpdater</strong>: 이벤트를 기반으로 읽기 모델을 갱신.</li><li><strong>ReadModel</strong>: 읽기에 최적화된 데이터 저장소(비정규화, 캐시 등 활용).</li><li><strong>QueryHandler</strong>: 조회 요청을 처리하여 읽기 모델에서 데이터 반환<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul><h3 id=8-구조-및-아키텍처>(8) 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#8-구조-및-아키텍처>#</a></h3><table><thead><tr><th>구성 요소</th><th>기능 및 역할</th><th>필수/선택</th></tr></thead><tbody><tr><td>Command</td><td>시스템 상태 변경(생성, 수정, 삭제) 요청</td><td>필수</td></tr><tr><td>Query</td><td>데이터 조회 요청</td><td>필수</td></tr><tr><td>Command Handler</td><td>명령을 처리하여 시스템 상태 변경</td><td>필수</td></tr><tr><td>Query Handler</td><td>조회 요청을 처리하여 데이터 반환</td><td>필수</td></tr><tr><td>Write Model</td><td>상태 변경(쓰기)에 최적화된 데이터 저장소</td><td>필수</td></tr><tr><td>Read Model</td><td>읽기에 최적화된 데이터 저장소(비정규화, 캐시 등 활용)</td><td>필수</td></tr><tr><td>Event Store</td><td>명령 처리 결과를 이벤트로 저장(이벤트 소싱 연동 시)</td><td>선택</td></tr><tr><td>Event Bus</td><td>이벤트를 읽기 측(Read Model)에 전파</td><td>선택</td></tr><tr><td>Read Model Updater</td><td>이벤트를 기반으로 읽기 모델 갱신</td><td>선택</td></tr></tbody></table><p><strong>설명</strong></p><ul><li><strong>필수 구성요소</strong>: Command, Query, Command Handler, Query Handler, Write Model, Read Model</li><li><strong>선택 구성요소</strong>: Event Store, Event Bus, Read Model Updater (이벤트 소싱 연동 시)<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a></li></ul><h3 id=9-구현-기법>(9) 구현 기법<a hidden class=anchor aria-hidden=true href=#9-구현-기법>#</a></h3><ul><li><strong>명령/조회 모델 분리</strong>: 읽기와 쓰기 모델을 별도로 설계 및 구현.</li><li><strong>이벤트 소싱</strong>: 명령 처리 결과를 이벤트로 저장, 읽기 모델과의 동기화에 활용.</li><li><strong>비정규화된 읽기 모델</strong>: 조회 성능을 위해 읽기 모델을 비정규화(Denormalized) 구조로 설계.</li><li><strong>독립적 데이터 저장소</strong>: 읽기/쓰기 모델에 각각 최적화된 데이터 저장소(예: RDBMS, NoSQL, 캐시) 사용<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul><h3 id=10-장점>(10) 장점<a hidden class=anchor aria-hidden=true href=#10-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 발생 원인</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 모델을 독립적으로 확장할 수 있음</td><td>명령/조회 책임 분리</td></tr><tr><td></td><td>성능</td><td>각 모델을 최적화하여 읽기/쓰기 성능 향상</td><td>독립적 최적화</td></tr><tr><td></td><td>유지보수성</td><td>명령과 조회 로직 분리로 코드 가독성 및 유지보수성 향상</td><td>책임 분리</td></tr><tr><td></td><td>보안</td><td>명령과 조회에 서로 다른 보안 정책 적용 가능</td><td>독립적 보안 적용</td></tr><tr><td></td><td>유연성</td><td>각 모델에 맞는 데이터 저장소 및 처리 로직 선택 가능</td><td>독립적 설계</td></tr></tbody></table><h3 id=11-단점과-문제점-그리고-해결방안>(11) 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#11-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>명령/조회 모델 분리로 시스템 복잡도 증가</td><td>명확한 설계, 문서화</td></tr><tr><td></td><td>데이터 일관성</td><td>읽기/쓰기 모델 간 데이터 일관성 문제 발생 가능</td><td>이벤트 기반 동기화, 최종 일관성</td></tr><tr><td></td><td>운영 비용</td><td>모델 분리로 인한 운영 및 관리 비용 증가</td><td>자동화, 모니터링 도구 활용</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 불일치</td><td>동기화 지연/실패</td><td>사용자 경험 저하</td><td>모니터링, 로그 분석</td><td>이벤트 핸들러 신뢰성</td><td>이벤트 핸들러 재처리, 최종 일관성</td></tr><tr><td></td><td>검증 중복</td><td>명령/조회 검증 중복</td><td>코드 복잡도 증가</td><td>코드 리뷰</td><td>공통 검증 모듈화</td><td>추상화, 공통 라이브러리 사용</td></tr></tbody></table><h3 id=12-도전-과제>(12) 도전 과제<a hidden class=anchor aria-hidden=true href=#12-도전-과제>#</a></h3><ul><li><p><strong>실시간 데이터 일관성 보장</strong>: 읽기 모델과 쓰기 모델 간 실시간 동기화가 어려울 수 있음.</p><ul><li><strong>원인</strong>: 이벤트 기반 비동기 처리, 네트워크 지연 등.</li><li><strong>영향</strong>: 사용자 경험 저하, 데이터 불일치.</li><li><strong>탐지 및 진단</strong>: 모니터링, 로그 분석.</li><li><strong>예방 방법</strong>: 이벤트 핸들러 신뢰성 확보, 네트워크 최적화.</li><li><strong>해결 방법</strong>: 최종 일관성(Eventual Consistency) 적용, 사용자 피드백 제공<a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">14</a>.</li></ul></li><li><p><strong>복잡한 도메인에서의 적용</strong>: 복잡한 비즈니스 로직에서 명령/조회 분리 설계가 어려울 수 있음.</p><ul><li><strong>원인</strong>: 도메인 복잡성, 명령/조회 경계 모호함.</li><li><strong>영향</strong>: 설계 및 구현 난이도 증가.</li><li><strong>탐지 및 진단</strong>: 도메인 분석, 코드 리뷰.</li><li><strong>예방 방법</strong>: 명확한 도메인 경계 정의, 명령/조회 분리 기준 설정.</li><li><strong>해결 방법</strong>: 도메인 주도 설계(DDD) 적용, 명확한 문서화<a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">14</a>.</li></ul></li></ul><h3 id=13-분류-기준에-따른-종류-및-유형>(13) 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#13-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>구분</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>유형</td><td>Type 0: No CQRS</td><td>전통적 CRUD 방식, 명령/조회 분리 없음</td></tr><tr><td></td><td>Type 1: 분리된 클래스 구조</td><td>명령/조회 로직을 별도 클래스로 분리, 동일 모델 사용</td></tr><tr><td></td><td>Type 2: 분리된 모델</td><td>명령/조회 모델을 별도로 설계, 동일 저장소 사용</td></tr><tr><td></td><td>Type 3: 분리된 저장소</td><td>명령/조회 모델 및 저장소 모두 분리</td></tr></tbody></table><h3 id=14-실무-사용-예시>(14) 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시>#</a></h3><table><thead><tr><th>예시</th><th>목적</th><th>함께 사용되는 기술/패턴</th><th>효과</th></tr></thead><tbody><tr><td>이커머스 주문 시스템</td><td>주문 생성/조회 분리</td><td>이벤트 소싱, 마이크로서비스</td><td>성능, 확장성, 유지보수성 향상</td></tr><tr><td>실시간 분석 시스템</td><td>대용량 데이터 처리</td><td>NoSQL, 캐시, 이벤트 기반 동기화</td><td>빠른 조회, 실시간 처리</td></tr></tbody></table><h3 id=15-활용-사례>(15) 활용 사례<a hidden class=anchor aria-hidden=true href=#15-활용-사례>#</a></h3><p><strong>이커머스 주문 시스템 예시</strong></p><ul><li><strong>시스템 구성</strong>: 주문 생성(Command), 주문 조회(Query) 모델 분리.</li><li><strong>시스템 구성 다이어그램</strong></li></ul><pre class=mermaid>flowchart LR
    User --&gt;|주문 생성| CommandHandler
    CommandHandler --&gt;|주문 저장| WriteModel
    WriteModel --&gt;|주문 이벤트| EventStore
    EventStore --&gt;|이벤트 전파| EventBus
    EventBus --&gt;|주문 정보 갱신| ReadModelUpdater
    ReadModelUpdater --&gt;|주문 정보 저장| ReadModel
    User --&gt;|주문 조회| QueryHandler
    QueryHandler --&gt;|주문 정보 조회| ReadModel
</pre><ul><li><strong>Workflow</strong>:<ol><li>사용자가 주문 생성(Command).</li><li>Command Handler가 주문을 저장(Write Model).</li><li>주문 이벤트가 Event Store에 저장.</li><li>Event Bus를 통해 이벤트가 Read Model Updater로 전달.</li><li>Read Model Updater가 주문 정보를 Read Model에 저장.</li><li>사용자가 주문 조회(Query) 시 Query Handler가 Read Model에서 정보 반환.</li></ol></li><li><strong>CQRS 역할</strong>:<ul><li>주문 생성과 조회 로직 분리로 각각의 성능, 확장성, 유지보수성 향상.</li><li>이벤트 기반 동기화로 데이터 일관성 보장<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul></li><li><strong>CQRS 유무에 따른 차이점</strong>:<ul><li><strong>CQRS 적용 시</strong>: 주문 생성과 조회가 독립적으로 확장 및 최적화 가능, 대용량 트래픽 처리 용이.</li><li><strong>CQRS 미적용 시</strong>: 단일 모델로 인한 성능 병목, 확장성 한계, 유지보수성 저하.</li></ul></li></ul><h3 id=16-구현-예시-python>(16) 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#16-구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1> 1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2> 2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3> 3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4> 4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5> 5</a>
</span><span class=lnt id=hl-59-6><a class=lnlinks href=#hl-59-6> 6</a>
</span><span class=lnt id=hl-59-7><a class=lnlinks href=#hl-59-7> 7</a>
</span><span class=lnt id=hl-59-8><a class=lnlinks href=#hl-59-8> 8</a>
</span><span class=lnt id=hl-59-9><a class=lnlinks href=#hl-59-9> 9</a>
</span><span class=lnt id=hl-59-10><a class=lnlinks href=#hl-59-10>10</a>
</span><span class=lnt id=hl-59-11><a class=lnlinks href=#hl-59-11>11</a>
</span><span class=lnt id=hl-59-12><a class=lnlinks href=#hl-59-12>12</a>
</span><span class=lnt id=hl-59-13><a class=lnlinks href=#hl-59-13>13</a>
</span><span class=lnt id=hl-59-14><a class=lnlinks href=#hl-59-14>14</a>
</span><span class=lnt id=hl-59-15><a class=lnlinks href=#hl-59-15>15</a>
</span><span class=lnt id=hl-59-16><a class=lnlinks href=#hl-59-16>16</a>
</span><span class=lnt id=hl-59-17><a class=lnlinks href=#hl-59-17>17</a>
</span><span class=lnt id=hl-59-18><a class=lnlinks href=#hl-59-18>18</a>
</span><span class=lnt id=hl-59-19><a class=lnlinks href=#hl-59-19>19</a>
</span><span class=lnt id=hl-59-20><a class=lnlinks href=#hl-59-20>20</a>
</span><span class=lnt id=hl-59-21><a class=lnlinks href=#hl-59-21>21</a>
</span><span class=lnt id=hl-59-22><a class=lnlinks href=#hl-59-22>22</a>
</span><span class=lnt id=hl-59-23><a class=lnlinks href=#hl-59-23>23</a>
</span><span class=lnt id=hl-59-24><a class=lnlinks href=#hl-59-24>24</a>
</span><span class=lnt id=hl-59-25><a class=lnlinks href=#hl-59-25>25</a>
</span><span class=lnt id=hl-59-26><a class=lnlinks href=#hl-59-26>26</a>
</span><span class=lnt id=hl-59-27><a class=lnlinks href=#hl-59-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Handler 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>write_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>write_model</span> <span class=o>=</span> <span class=n>write_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 생성 로직</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>write_model</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Handler 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>read_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=n>read_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 조회 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>write_model</span> <span class=o>=</span> <span class=n>WriteModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=n>write_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>order_id</span> <span class=o>=</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>create_order</span><span class=p>({</span><span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>read_model</span> <span class=o>=</span> <span class=n>ReadModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>(</span><span class=n>read_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>order</span> <span class=o>=</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=7-추가-조사-내용>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용>#</a></h2><ul><li><strong>CQRS와 이벤트 소싱의 연동</strong>:<ul><li>이벤트 소싱은 명령 처리 결과를 이벤트로 저장하고, 이를 기반으로 읽기 모델을 갱신하는 방식으로 CQRS와 매우 잘 어울림<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">13</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">11</a>.</li></ul></li><li><strong>마이크로서비스와의 연동</strong>:<ul><li>마이크로서비스 환경에서 CQRS는 각 서비스의 명령/조회 책임을 명확히 분리하여 확장성과 유지보수성 향상에 기여<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">2</a><a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">6</a>.</li></ul></li><li><strong>최적화 기법</strong>:<ul><li>읽기 모델에 캐시, 비정규화, 인덱스 등 다양한 최적화 기법 적용 가능<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">2</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul></li></ul><hr><h2 id=8-기타-사항>8. 기타 사항<a hidden class=anchor aria-hidden=true href=#8-기타-사항>#</a></h2><ul><li><strong>CQRS는 모든 시스템에 적합하지 않음</strong>:<ul><li>단순 CRUD 애플리케이션에는 오버엔지니어링이 될 수 있으므로, 복잡한 도메인이나 읽기/쓰기 트래픽이 비대칭인 시스템에 적합<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>7</a><a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">9</a>.</li></ul></li><li><strong>이벤트 기반 동기화의 한계</strong>:<ul><li>읽기 모델과 쓰기 모델 간 최종 일관성(Eventual Consistency)이 보장되므로, 실시간 일관성이 중요한 시스템에는 주의 필요<a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">14</a>.</li></ul></li></ul><hr><h2 id=9-주제와-관련하여-주목할-내용>9. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#9-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>CQRS</td><td>명령/조회 분리</td><td>읽기와 쓰기 모델을 분리하여 각각 최적화</td></tr><tr><td>데이터 관리</td><td>이벤트 소싱</td><td>이벤트 기반 동기화</td><td>명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>독립적 확장</td><td>각 서비스의 명령/조회 책임 분리로 확장성 향상</td></tr><tr><td>최적화</td><td>비정규화</td><td>읽기 모델 최적화</td><td>읽기 모델에 비정규화, 캐시 등 적용</td></tr></tbody></table><hr><h2 id=10-반드시-학습해야할-내용>10. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#10-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>소프트웨어 아키텍처</td><td>CQRS</td><td>명령/조회 분리</td><td>읽기와 쓰기 모델을 분리하는 아키텍처 패턴</td></tr><tr><td>데이터 관리</td><td>이벤트 소싱</td><td>이벤트 기반 동기화</td><td>명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>독립적 확장</td><td>각 서비스의 명령/조회 책임 분리로 확장성 향상</td></tr><tr><td>최적화</td><td>비정규화</td><td>읽기 모델 최적화</td><td>읽기 모델에 비정규화, 캐시 등 적용</td></tr></tbody></table><hr><h2 id=11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>11. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에서 효과적</td><td>명확한 도메인 경계 정의, 명령/조회 분리 기준 설정</td></tr><tr><td>데이터 일관성</td><td>읽기/쓰기 모델 간 일관성 유지 필요</td><td>이벤트 기반 동기화, 최종 일관성 적용</td></tr><tr><td>운영 비용</td><td>모델 분리로 인한 운영 비용 증가</td><td>자동화, 모니터링 도구 활용</td></tr><tr><td>검증 중복</td><td>명령/조회 검증 중복 가능성</td><td>공통 검증 모듈화, 추상화</td></tr><tr><td>기술 선택</td><td>각 모델에 맞는 데이터 저장소 선택</td><td>읽기 모델에 캐시, 비정규화, 인덱스 등 적용</td></tr></tbody></table><hr><h2 id=12-최적화하기-위한-고려사항-및-주의할-점>12. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#12-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>읽기 모델 최적화</td><td>읽기 모델에 캐시, 비정규화, 인덱스 등 적용</td><td>조회 성능 향상을 위한 다양한 최적화 기법 적용</td></tr><tr><td>쓰기 모델 최적화</td><td>쓰기 모델에 트랜잭션, 락 등 적용</td><td>데이터 일관성 보장을 위한 트랜잭션 관리</td></tr><tr><td>이벤트 처리</td><td>이벤트 기반 동기화 최적화</td><td>이벤트 핸들러 신뢰성 확보, 네트워크 최적화</td></tr><tr><td>모니터링</td><td>모델 간 데이터 일관성 모니터링</td><td>모니터링, 로그 분석 도구 활용</td></tr></tbody></table><hr><h2 id=13-용어-정리>13. 용어 정리<a hidden class=anchor aria-hidden=true href=#13-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>CQRS</td><td>읽기와 쓰기 모델을 분리하는 아키텍처 패턴</td></tr><tr><td>데이터 관리</td><td>이벤트 소싱</td><td>명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>각 서비스의 명령/조회 책임 분리로 확장성 향상</td></tr><tr><td>최적화</td><td>비정규화</td><td>읽기 모델에 비정규화, 캐시 등 적용</td></tr></tbody></table><hr><h2 id=14-참고-및-출처>14. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#14-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center</a></li><li><a href=https://dev.to/jackynote/understanding-cqrs-pattern-pros-cons-and-a-spring-boot-example-3flb>Understanding CQRS Pattern: Pros, Cons, and a Spring Boot Example</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>What is CQRS (Command Query Responsibility Segregation)?</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>CQRS Pattern - System Design School</a></li><li><a href="https://blog.stackademic.com/understanding-the-command-query-responsibility-segregation-cqrs-architecture-pattern-5bdfb4ebd5a4?gi=dbdf2d726f29">Understanding the Command Query Responsibility Segregation (CQRS) Architecture Pattern</a></li><li><a href="https://blog.stackademic.com/cqrs-command-query-responsibility-segregation-pattern-with-an-example-c9fcd164928e?gi=4e76ece92720">CQRS (Command Query Responsibility Segregation) Pattern with an Example</a></li><li><a href=https://dev.to/mochafreddo/demystifying-cqrs-for-junior-developers-a-friendly-guide-10ki>Demystifying CQRS for Junior Developers: A Friendly Guide</a></li><li><a href=https://github.com/SardarMudassarAliKhan/MicroservicesWithCQRSDesignPattern>MicroservicesWithCQRSDesignPattern GitHub</a></li><li><a href=https://dev.to/vipulkumarsviit/understanding-the-cqrs-pattern-25je>Understanding the CQRS Pattern</a></li><li><a href=https://blog.risingstack.com/when-to-use-cqrs/>When should you use CQRS? - RisingStack Engineering</a></li><li><a href=https://reintech.io/blog/troubleshooting-cqrs-implementation-challenges>Troubleshooting CQRS Implementation Challenges</a></li><li><a href=https://configzen.com/blog/implementing-cqrs-architecture-challenges>Overcoming Challenges in Implementing CQRS Architecture</a></li><li><a href=https://enterprisecraftsmanship.com/posts/types-of-cqrs/>Types of CQRS - Enterprise Craftsmanship</a></li><li><a href=https://dev.to/moh_moh701/enhancing-net-applications-with-cqrs-and-solid-principles-30i8>Implementing the CQRS in a .NET</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>A Beginner&rsquo;s Guide to CQRS - Kurrent</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li></ul><p>아래는 <strong>CQRS (Command Query Responsibility Segregation)</strong> 주제에 대한 정리입니다.</p><hr><h2 id=태그-tags>태그 (Tags)<a hidden class=anchor aria-hidden=true href=#태그-tags>#</a></h2><ul><li>CQRS</li><li>Event-Sourcing</li><li>Architecture-Pattern</li><li>Distributed-Systems</li></ul><hr><h2 id=1-분류-구조-타당성-평가>1. 분류 구조 타당성 평가<a hidden class=anchor aria-hidden=true href=#1-분류-구조-타당성-평가>#</a></h2><p><strong>현재 위치</strong>:
<code>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns → CQRS</code></p><p><strong>분석</strong>:</p><ul><li>CQRS는 읽기(Query)와 쓰기(Command)를 분리하여 설계하는 <strong>데이터 관리 패턴</strong>입니다.</li><li>디자인 아키텍처 맥락에서 가장 적절하며, 특히 Event Sourcing 등과 결합되는 패턴이므로 <strong>Data Management Patterns</strong> 내 위치는 타당합니다.</li></ul><hr><h2 id=2-간략-요약-200자-이내>2. 간략 요약 (200자 이내)<a hidden class=anchor aria-hidden=true href=#2-간략-요약-200자-이내>#</a></h2><p>CQRS는 읽기와 쓰기 작업을 분리하여 서로 다른 모델로 처리하는 아키텍처 패턴입니다. 이를 통해 성능, 확장성, 보안, 복잡한 비즈니스 로직 처리 효율을 높이고, 이벤트 소싱(Event Sourcing)과 함께 사용하면 변경이력 관리와 시스템 유연성도 강화할 수 있습니다.</p><hr><h2 id=3-개요-250자-이내>3. 개요 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-개요-250자-이내>#</a></h2><p>CQRS는 Command(쓰기)와 Query(읽기)를 완전히 분리하여 각 역할에 최적화된 모델과 저장소를 제공하는 패턴입니다. 트랜잭션 성능, 확장성, 보안 및 데이터 이력 추적 기능 향상에 유리합니다. 이벤트 소싱과 함께 사용하면 도메인 이벤트 기반 구현이 가능하며, 복잡한 도메인 로직을 명확하게 처리할 수 있습니다. 다만 데이터 동기화, 복잡도 증가, 일관성 문제 등의 단점이 있으며, 이를 해결하려면 메시징, 이벤트 브로커, CQRS 프레임워크 도입이 필요합니다.</p><hr><h2 id=4-핵심-개념>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념>#</a></h2><h3 id=-cqrs란>• CQRS란?<a hidden class=anchor aria-hidden=true href=#-cqrs란>#</a></h3><p>읽기와 쓰기를 분리하여 서로 다른 모델/스토리지로 처리하는 아키텍처 패턴.</p><h3 id=-동기-vs-비동기-처리>• 동기 vs 비동기 처리<a hidden class=anchor aria-hidden=true href=#-동기-vs-비동기-처리>#</a></h3><p>쓰기 완료 후 읽기 모델은 배치나 이벤트 소비 방식으로 <strong>비동기 갱신</strong>.</p><h3 id=-일관성과-분리>• 일관성과 분리<a hidden class=anchor aria-hidden=true href=#-일관성과-분리>#</a></h3><p>개별 모델이므로 읽기 성능과 쓰기 복잡성을 독립적으로 최적화 가능.</p><h3 id=-event-sourcing-결합>• Event Sourcing 결합<a hidden class=anchor aria-hidden=true href=#-event-sourcing-결합>#</a></h3><p>도메인 이벤트 로깅 방식과 결합하여 <strong>변경 이력 추적</strong>이 가능.</p><h4 id=실무-연관성>실무 연관성<a hidden class=anchor aria-hidden=true href=#실무-연관성>#</a></h4><ul><li><strong>읽기 모델</strong>: 캐시, 인덱싱, NoSQL 등 사용해 읽기 최적화</li><li><strong>쓰기 모델</strong>: 복잡 비즈니스 로직 집중 및 도메인 트랜잭션 처리 집중</li></ul><hr><h2 id=5-주제별-분석-및-조사-항목-요약>5. 주제별 분석 및 조사 항목 요약<a hidden class=anchor aria-hidden=true href=#5-주제별-분석-및-조사-항목-요약>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>개념</td><td>CQRS</td><td>정의</td><td>읽기/쓰기를 분리하여 각각 담당</td></tr><tr><td>아키텍처</td><td>구조</td><td>CommandSide, QuerySide, EventBus 등 구성</td><td></td></tr><tr><td>구현</td><td>기술</td><td>Messaging, 이벤트 브로커, CDC(Change Data Capture)</td><td></td></tr><tr><td>장단점</td><td>장점</td><td>성능, 확장성, 모듈화, 보안 강화</td><td></td></tr><tr><td>단점/문제</td><td>단점</td><td>복잡도 증가, 동기화 지연, 유지보수 부담</td><td></td></tr><tr><td>사례</td><td>활용 사례</td><td>e‑commerce 주문 처리, 금융 결제 시스템 등</td><td></td></tr><tr><td>고려사항</td><td>적용 시점</td><td>도메인 복잡도, 팀 인프라 성숙도</td><td></td></tr><tr><td>최적화</td><td>성능 최적화</td><td>이벤트 파티셔닝, 모델 캐싱, 샤딩</td><td></td></tr></tbody></table><hr><h2 id=6-조사한-추가-필요사항>6. 조사한 추가 필요사항<a hidden class=anchor aria-hidden=true href=#6-조사한-추가-필요사항>#</a></h2><ul><li><strong>구조 및 아키텍처</strong>: 구성 요소(Command Handler, Query Handler, Event Store 등)별 역할 및 다이어그램</li><li><strong>주요 원리/작동 원리</strong>: Commander → Event → Projection 흐름</li><li><strong>구현 기법</strong>: 예시 코드, 이벤트 기반 메시징 처리</li><li><strong>장점/단점 분석</strong>: 표 포함 설명</li><li><strong>실무 사례</strong>: 다이어그램 및 워크플로우</li><li><strong>도전 과제</strong>: 동기화 지연, 일관성 모델 설계 복잡성, 데이터 중복 관리</li><li><strong>분류 기준에 따른 종류</strong>: Event Sourcing 포함 여부, 동기성 vs 비동기성</li><li><strong>실무 적용 고려사항</strong>: 팀 숙련도, 배포, 모니터링, 테스트 전략</li><li><strong>최적화 고려사항 및 권장사항</strong>: 이벤트 크기, 모델 최신화 전략, 이벤트 소비 방식</li></ul><hr><h2 id=7-용어-정리>7. 용어 정리<a hidden class=anchor aria-hidden=true href=#7-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>CQRS</td><td>Command–Query Responsibility Segregation</td></tr><tr><td>아키텍처</td><td>Event Sourcing</td><td>도메인 이벤트 저장 방식</td></tr><tr><td>구성요소</td><td>Command Handler</td><td>쓰기 요청 처리 로직</td></tr><tr><td>구성요소</td><td>Query Handler</td><td>읽기 요청 처리 로직</td></tr><tr><td>구성요소</td><td>Projection</td><td>이벤트 기반 읽기 모델 생성기</td></tr><tr><td>구성요소</td><td>Event Store</td><td>이벤트 저장용 저장소</td></tr><tr><td>방식</td><td>동기 처리</td><td>즉시 읽기 모델 업데이트</td></tr><tr><td>방식</td><td>비동기 처리</td><td>이벤트 큐 기반 느슨한 동기화</td></tr><tr><td>패턴</td><td>메시지 브로커</td><td>Kafka, RabbitMQ 등 이벤트 전달</td></tr><tr><td>최적화</td><td>샤딩</td><td>모델 분할 저장 방식</td></tr><tr><td>최적화</td><td>캐싱</td><td>빠른 읽기 응답 제공</td></tr></tbody></table><hr><h2 id=8-참고-및-출처>8. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#8-참고-및-출처>#</a></h2><ul><li>김형준, “마틴 파울러의 CQRS 패턴 분석” (링크 제공 예정)</li><li>Greg Young, “CQRS and Event Sourcing” (YouTube 및 블로그)</li><li>Martin Fowler 블로그 내 CQRS 관련 문서</li><li>EventStoreDB 공식 문서</li></ul><blockquote><p>추가 조사 진행 후 단계별로 도식, 다이어그램, 코드 구현 예시를 포함한 심화 분석 제공 예정입니다. 더 구체적으로 어떤 영역(예: 구현 코드, 성능 최적화 등)에 집중하시길 원하시면 알려주세요!</p></blockquote><p>아래는 CQRS에 대한 심화 분석입니다.</p><hr><h2 id=4-구조-및-아키텍처-구성-요소-포함->4. 구조 및 아키텍처 (구성 요소 포함) 🔧<a hidden class=anchor aria-hidden=true href=#4-구조-및-아키텍처-구성-요소-포함->#</a></h2><h3 id=-기본-구성-요소>📐 기본 구성 요소<a hidden class=anchor aria-hidden=true href=#-기본-구성-요소>#</a></h3><ul><li><p><strong>Command Side / Write Model</strong></p><ul><li>Command Bus: 명령 전달 채널</li><li>Command Handler: 비즈니스 로직 실행 후 이벤트 생성</li><li>Event Store: append-only 이벤트 저장소 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">learn.microsoft.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">linkedin.com</a>, <a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">nexocode.com</a>)</li></ul></li><li><p><strong>Query Side / Read Model</strong></p><ul><li>Event Handler 또는 Projection: 이벤트를 읽어읽기용 DB에 반영</li><li>Query Handler: 최적화된 View에서 데이터 조회</li></ul></li><li><p><strong>Event Bus / Broker</strong></p><ul><li>이벤트 전달 중개 역할, Kafka, RabbitMQ 등 사용 (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">upsolver.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">learn.microsoft.com</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">reddit.com</a>)</li></ul></li></ul><h3 id=-시스템-흐름-mermaid-다이어그램>🌐 시스템 흐름 mermaid 다이어그램<a hidden class=anchor aria-hidden=true href=#-시스템-흐름-mermaid-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
  U[User UI] --&gt; C[Command Bus]
  C --&gt; CH[Command Handler]
  CH --&gt; ES[Event Store]
  ES --&gt; EB[Event Bus]
  EB --&gt; EH[Event Handler / Projection]
  EH --&gt; RD[Read Database]
  U --&gt; Q[Query Handler]
  Q --&gt; RD
</pre><h3 id=-설명>📝 설명<a hidden class=anchor aria-hidden=true href=#-설명>#</a></h3><ul><li><strong>Command Bus</strong>가 사용자 요청을 받아 <strong>Command Handler</strong>로 전달</li><li>Handler는 비즈니스 로직 수행 후 <strong>Event Store</strong>에 이벤트 저장</li><li>저장된 이벤트는 <strong>Event Bus</strong> 통해 <strong>Query Side</strong>로 비동기 전달</li><li><strong>Projection</strong>이 이를 읽어 <strong>읽기 전용 DB</strong>에 반영</li><li>UI는 <strong>Query Handler</strong>를 통해 읽기 DB에서 응답 받음</li></ul><hr><h2 id=5-주요-원리-및-작동-원리-다이어그램-포함>5. 주요 원리 및 작동 원리 (다이어그램 포함)<a hidden class=anchor aria-hidden=true href=#5-주요-원리-및-작동-원리-다이어그램-포함>#</a></h2><ul><li><strong>단일 책임</strong>: 쓰기(Command)와 읽기(Query)를 명확히 분리 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">dev.to</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">linkedin.com</a>, <a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">upsolver.com</a>)</li><li><strong>이벤트 기반 비동기 동기화</strong>: 이벤트 생성 후 Projection 비동기로 처리</li><li><strong>이벤트소싱 SEM</strong>: Event Store에서 상태 회전(재생)하고, 새로운 Projection 구성 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">learn.microsoft.com</a>)</li><li><strong>Eventual Consistency</strong>: 쓰기 완료 후 읽기 모델은 지연 반영 → 일관성 지연 발생 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">learn.microsoft.com</a>)</li></ul><hr><h2 id=6-특징-및-핵심-기능>6. 특징 및 핵심 기능<a hidden class=anchor aria-hidden=true href=#6-특징-및-핵심-기능>#</a></h2><ul><li><strong>성능 최적화</strong>: 읽기/쓰기 모델의 독립 스케일링 및 구조 최적화 (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">reddit.com</a>)</li><li><strong>감사 로그 및 이벤트 이력</strong>: 모든 변경 내역이 이벤트로 남아 감사, 재생, 재구축 가능</li><li><strong>모델 유연성</strong>: 필요에 따라 다양한 Projection 생성 가능 (<a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">medium.com</a>)</li><li><strong>도메인 중심 설계</strong>: 의미 있는 도메인 이벤트 중심 개발, 비즈니스 로직이 더 명확</li></ul><hr><h2 id=7-특징-요약>7. 특징 요약<a hidden class=anchor aria-hidden=true href=#7-특징-요약>#</a></h2><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td>분리된 모델</td><td>쓰기와 읽기 책임 분리</td></tr><tr><td>비동기 이벤트</td><td>Command → Event → Projection 흐름</td></tr><tr><td>Event Sourcing 결합</td><td>상태 변화는 모두 이벤트로 저장</td></tr><tr><td>확장성</td><td>읽기/쓰기 요구에 따른 개별 확장 가능</td></tr></tbody></table><hr><p>다음 단계에서는 <strong>구현 기법 (예: Kafka 기반 이벤트 전달 로직, .NET 코드)</strong>, <strong>장점/단점 표 분석</strong>, <strong>실무 활용 예시 + 워크플로우</strong>, <strong>도전 과제, 최적화 및 고려사항</strong>을 포함한 심층 파트로 진행하겠습니다. 어떤 부분에 더 집중하시길 원하시는지 말씀해 주세요!</p><p>다음은 CQRS의 <strong>구현 기법</strong>, <strong>장단점 분석</strong>, <strong>실무 활용 예시 및 워크플로우</strong>에 대한 심층 정리입니다.</p><hr><h2 id=1-구현-기법-implementation-techniques>1. 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#1-구현-기법-implementation-techniques>#</a></h2><h3 id=-messaging-브로커-기반>✅ Messaging 브로커 기반<a hidden class=anchor aria-hidden=true href=#-messaging-브로커-기반>#</a></h3><ul><li><p><strong>Kafka + CQRS</strong>: 쓰기 완료 시 이벤트를 Kafka 토픽에 발행 → 스트림 처리 또는 Consumer를 통해 Projection으로 동기화 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">medium.com</a>).</p><ul><li>장점: 분산 환경에서 확장성 우수, 이벤트 리플레이 가능.</li><li>단점: 동기화 지연, 클라이언트 동기 보장 어려움 .</li></ul></li><li><p><strong>RabbitMQ/NServiceBus</strong>: 고가용 큐 기반 메시징 처리. .NET 생태계에서 많이 사용 .</p></li></ul><h3 id=-framework-활용-net>✅ Framework 활용 (.NET)<a hidden class=anchor aria-hidden=true href=#-framework-활용-net>#</a></h3><ul><li><strong>MediatR</strong>: Command/Query 객체 분리, Handler 정의 → 간단한 CQRS 구조 지원 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">bizcoder.com</a>).</li><li><strong>EventStoreDB</strong>: 이벤트 소싱 및 CQRS를 위한 특화 DB.</li></ul><h3 id=-동기-vs-비동기-업데이트-기법>✅ 동기 vs 비동기 업데이트 기법<a hidden class=anchor aria-hidden=true href=#-동기-vs-비동기-업데이트-기법>#</a></h3><ul><li><strong>동기 방식</strong>: 쓰기 및 읽기 모델 모두 갱신 후 응답. ACID 유사하지만 응답 지연 발생 (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">stackoverflow.com</a>, <a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">learn.microsoft.com</a>).</li><li><strong>비동기 방식</strong>: 쓰기만 빠르게 처리하고 이벤트 기반 비동기로 읽기 모델 갱신. 지연 허용이 가능한 도메인에 적합 .</li></ul><h3 id=-탄력적-설계>✅ 탄력적 설계<a hidden class=anchor aria-hidden=true href=#-탄력적-설계>#</a></h3><ul><li>CQRS는 반드시 물리적 DB 분리가 아니라, 동일 DB 내 logical 분리도 가능 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">medium.com</a>).</li></ul><hr><h2 id=2-장점--단점-분석>2. 장점 / 단점 분석<a hidden class=anchor aria-hidden=true href=#2-장점--단점-분석>#</a></h2><h3 id=-장점>▶ 장점<a hidden class=anchor aria-hidden=true href=#-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>성능 & 확장성</td><td>독립 스케일링</td><td>쓰기/읽기 각각의 요구사항에 맞춰 스케일링 가능</td></tr><tr><td>모델 최적화</td><td>다양한 최적화</td><td>읽기 모델은 denormalized, 쓰기 모델은 transaction-safe 구성</td></tr><tr><td>유지보수 & 보안</td><td>역할 분리</td><td>쓰기 / 읽기 코드와 저장소 분리로 보안 정책 적용 용이</td></tr><tr><td>감사 & 이력관리</td><td>이벤트 저장</td><td>변경 이력 기록과 재플레이 가능</td></tr></tbody></table><h3 id=-단점-및-문제점>▶ 단점 및 문제점<a hidden class=anchor aria-hidden=true href=#-단점-및-문제점>#</a></h3><h4 id=-단점>🛠 단점<a hidden class=anchor aria-hidden=true href=#-단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>복잡성</td><td>아키텍처 복잡</td><td>여러 구성 요소(버스, DB, 핸들러 등) 필수 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">reddit.com</a>)</td><td>incremental 도입, 팀 교육</td></tr><tr><td>일관성 지연</td><td>Eventual Consistency</td><td>읽기 모델 반영 지연으로 stale 발생 가능</td><td>동기 옵션 제공, UI 측 해결</td></tr><tr><td>데이터 중복</td><td>여러 모델 유지</td><td>읽기 전용 모델 중복 데이터 발생</td><td>적절한 동기화 전략, 스냅샷</td></tr><tr><td>비용 증가</td><td>운영 오버헤드</td><td>추가 컴포넌트, 스토리지, 클라우드 인프라 요구</td><td>서비스 수준 조정 및 최적화</td></tr></tbody></table><h4 id=-문제점>🔍 문제점<a hidden class=anchor aria-hidden=true href=#-문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지</th><th>예방</th><th>해결</th></tr></thead><tbody><tr><td>동기화 지연</td><td>읽기 모델 갱신 누락</td><td>메시지 손실, 장애</td><td>stale 응답, 데이터 불일치</td><td>모니터링 래그/스루풋 지표</td><td>메시지 재시도, Dead-letter 큐</td><td>재처리, 수동 스냅샷</td></tr><tr><td>메시지 중복</td><td>중복 이벤트 전달</td><td>큐 재전송 정책</td><td>idempotency 불일치, 중복 반영</td><td>이벤트 로그 분석</td><td>idempotent 핸들러 설계</td><td>중복 감지 로직 적용</td></tr><tr><td>데이터 폭증</td><td>이벤트 과금/스토리지 비용</td><td>append-only 이벤트 누적</td><td>비용 증가, 복구 지연</td><td>스토리지 모니터링</td><td>주기 스냅샷, 로그 정리</td><td>스냅샷 및 압축</td></tr></tbody></table><hr><h2 id=3-실무-활용-예시--워크플로우>3. 실무 활용 예시 & 워크플로우<a hidden class=anchor aria-hidden=true href=#3-실무-활용-예시--워크플로우>#</a></h2><h3 id=-예시-전자상거래-주문-시스템>📌 예시: 전자상거래 주문 시스템<a hidden class=anchor aria-hidden=true href=#-예시-전자상거래-주문-시스템>#</a></h3><table><thead><tr><th>구성</th><th>역할</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Command Service</td><td>주문 생성, 검증 후 이벤트 발행</td><td>주문 도메인 처리</td><td>도메인 중심 처리 가능</td></tr><tr><td>Kafka Event Bus</td><td>이벤트 중계</td><td>비동기 동기화</td><td>확장성, 탄력성 확보</td></tr><tr><td>Projection Service</td><td>주문 이벤트 기반 읽기 모델 갱신</td><td>조회 최적화</td><td>빠른 주문 상태 조회</td></tr><tr><td>Read API</td><td>사용자 주문 내역 조회</td><td>읽기 요청 처리</td><td>빠른 응답, 낮은 레이턴시</td></tr></tbody></table><h4 id=-워크플로우>🧩 워크플로우:<a hidden class=anchor aria-hidden=true href=#-워크플로우>#</a></h4><pre class=mermaid>flowchart TD
  UI --&gt;|POST /order| CmdSVC[Command Service]
  CmdSVC --&gt;|validate &amp; save| EventStore
  EventStore --&gt;|publish| Kafka
  subgraph QuerySide
    Kafka --&gt; Projection
    Projection --&gt; ReadDB
  end
  UI &lt;--|GET /orders| QueryAPI
  QueryAPI --&gt; ReadDB
</pre><ul><li><strong>Command Service</strong>: 주문 로직 수행 후 이벤트 발행</li><li><strong>Kafka</strong>: 이벤트 전달</li><li><strong>Projection Service</strong>: Kafka 이벤트 소비 → ReadDB 갱신</li><li><strong>Read API</strong>: 주문 현황 조회 API 응답 처리</li></ul><hr><h2 id=4-구현-예시-코드-net--mediatr--kafka>4. 구현 예시 코드 (.NET + MediatR + Kafka)<a hidden class=anchor aria-hidden=true href=#4-구현-예시-코드-net--mediatr--kafka>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1> 1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2> 2</a>
</span><span class=lnt id=hl-62-3><a class=lnlinks href=#hl-62-3> 3</a>
</span><span class=lnt id=hl-62-4><a class=lnlinks href=#hl-62-4> 4</a>
</span><span class=lnt id=hl-62-5><a class=lnlinks href=#hl-62-5> 5</a>
</span><span class=lnt id=hl-62-6><a class=lnlinks href=#hl-62-6> 6</a>
</span><span class=lnt id=hl-62-7><a class=lnlinks href=#hl-62-7> 7</a>
</span><span class=lnt id=hl-62-8><a class=lnlinks href=#hl-62-8> 8</a>
</span><span class=lnt id=hl-62-9><a class=lnlinks href=#hl-62-9> 9</a>
</span><span class=lnt id=hl-62-10><a class=lnlinks href=#hl-62-10>10</a>
</span><span class=lnt id=hl-62-11><a class=lnlinks href=#hl-62-11>11</a>
</span><span class=lnt id=hl-62-12><a class=lnlinks href=#hl-62-12>12</a>
</span><span class=lnt id=hl-62-13><a class=lnlinks href=#hl-62-13>13</a>
</span><span class=lnt id=hl-62-14><a class=lnlinks href=#hl-62-14>14</a>
</span><span class=lnt id=hl-62-15><a class=lnlinks href=#hl-62-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>record</span> <span class=nc>CreateOrderCommand</span><span class=p>(</span><span class=n>Guid</span> <span class=n>OrderId</span><span class=p>,</span> <span class=kt>string</span> <span class=n>Product</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CreateOrderHandler</span> <span class=p>:</span> <span class=n>IRequestHandler</span><span class=p>&lt;</span><span class=n>CreateOrderCommand</span><span class=p>,</span> <span class=n>Unit</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;</span> <span class=n>Handle</span><span class=p>(</span><span class=n>CreateOrderCommand</span> <span class=n>cmd</span><span class=p>,</span> <span class=n>CancellationToken</span> <span class=n>_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 도메인 로직 수행</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>evt</span> <span class=p>=</span> <span class=k>new</span> <span class=n>OrderCreated</span><span class=p>(</span><span class=n>cmd</span><span class=p>.</span><span class=n>OrderId</span><span class=p>,</span> <span class=n>cmd</span><span class=p>.</span><span class=n>Product</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>kafkaProducer</span><span class=p>.</span><span class=n>ProduceAsync</span><span class=p>(</span><span class=s>&#34;orders&#34;</span><span class=p>,</span> <span class=n>evt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Unit</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderCreatedHandler</span> <span class=p>:</span> <span class=n>IConsumer</span><span class=p>&lt;</span><span class=n>OrderCreated</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>Handle</span><span class=p>(</span><span class=n>OrderCreated</span> <span class=n>evt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>readDb</span><span class=p>.</span><span class=n>SaveAsync</span><span class=p>(</span><span class=k>new</span> <span class=n>OrderDto</span> <span class=p>{</span> <span class=n>Id</span> <span class=p>=</span> <span class=n>evt</span><span class=p>.</span><span class=n>OrderId</span><span class=p>,</span> <span class=n>Product</span> <span class=p>=</span> <span class=n>evt</span><span class=p>.</span><span class=n>Product</span><span class=p>,</span> <span class=n>Status</span> <span class=p>=</span> <span class=s>&#34;Pending&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>MediatR</code>로 Command/Handler 구조 구성 (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">medium.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">bizcoder.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">medium.com</a>, <a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">stackoverflow.com</a>, <a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">tinybird.co</a>, <a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">dev.to</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">linkedin.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">vikasrohit.medium.com</a>, <a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing - Code Samples">wiki.softheon.com</a>)</li><li>Kafka로 이벤트 발행 및 소비처 구성</li></ul><hr><p>👉 다음 단계에서는 <strong>도전 과제</strong>, <strong>최적화 및 고려사항</strong>(모니터링, 스냅샷 전략, 재처리 등)까지 포함해 이어서 작성할 수 있습니다. 어느 영역에 집중할지 말씀 주시면 맞춰서 진행하겠습니다!</p><p>다음은 <strong>CQRS</strong>의 <strong>도전 과제 (Challenges)</strong>, <strong>최적화 및 고려사항 (Optimizations & Considerations)</strong>, 그리고 <strong>모니터링 및 해결 전략</strong>에 대한 심화 정리입니다.</p><hr><h2 id=1-도전-과제-challenges>1. 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#1-도전-과제-challenges>#</a></h2><h3 id=-아키텍처-복잡성>📌 아키텍처 복잡성<a hidden class=anchor aria-hidden=true href=#-아키텍처-복잡성>#</a></h3><ul><li>읽기/쓰기 모델 분리로 코드베이스와 시스템 구성 요소가 증가하여 복잡성이 높아짐 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">itnext.io</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">solutionsarchitecture.medium.com</a>).</li><li>해결책: 점진적 도입(Incremental adoption), Bounded Context 기준 CQRS 적용 (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">stackoverflow.com</a>).</li></ul><h3 id=-일관성-관리>📌 일관성 관리<a hidden class=anchor aria-hidden=true href=#-일관성-관리>#</a></h3><ul><li>비동기 이벤트 처리로 인한 읽기 모델 지연 또는 stale 응답 발생 (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">reintech.io</a>).</li><li>해결책: 비동기 지연을 허용하거나, 필요 시 동기 업데이트 옵션 설계 및 UX에서 반영.</li></ul><h3 id=-데이터-중복-및-모델-유지비용>📌 데이터 중복 및 모델 유지비용<a hidden class=anchor aria-hidden=true href=#-데이터-중복-및-모델-유지비용>#</a></h3><ul><li>읽기/쓰기 모델에서 데이터 중복이 발생하여 동기화 관리 비용 증가 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">geeksforgeeks.org</a>).</li><li>해결책: 스냅샷, CDC 활용, 모델간 동기화 전략 수립.</li></ul><h3 id=-이벤트-버전-관리>📌 이벤트 버전 관리<a hidden class=anchor aria-hidden=true href=#-이벤트-버전-관리>#</a></h3><ul><li>시스템 변경시 이벤트 스키마 변경이 누적되고, 버전 관리 어려움 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">hyscaler.com</a>).</li><li>해결책: 이벤트 버저닝 및 호환성 유지 전략 수립.</li></ul><h3 id=-운영-및-모니터링-부담>📌 운영 및 모니터링 부담<a hidden class=anchor aria-hidden=true href=#-운영-및-모니터링-부담>#</a></h3><ul><li>추가된 메시징 시스템, 이벤트 뒷단 흐름 등 운영 복잡도 증가 .</li><li>해결책: Kibana/Grafana 기반 모니터링 대시보드 구축, 이벤트 흐름/지연 추적.</li></ul><hr><h2 id=2-최적화-및-고려사항-optimizations--best-practices>2. 최적화 및 고려사항 (Optimizations & Best Practices)<a hidden class=anchor aria-hidden=true href=#2-최적화-및-고려사항-optimizations--best-practices>#</a></h2><table><thead><tr><th>영역</th><th>고려사항</th><th>권장 전략</th></tr></thead><tbody><tr><td><strong>모델 설계</strong></td><td>읽기 모델 필수 사항 기반 설계</td><td>Use-case 별 Query 설계, Over-fetch 방지 (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">softwareengineering.stackexchange.com</a>)</td></tr><tr><td><strong>동기/비동기 균형</strong></td><td>응답 시간 vs 일관성</td><td>경계 설정: 장기 트랜잭션 vs 단기 읽기 → 필요 시 hybrid 동기 도입</td></tr><tr><td><strong>이벤트 처리</strong></td><td>Idempotency 보장</td><td>Consumer에서 중복 허용 처리, Dead-letter 큐 설정</td></tr><tr><td><strong>스냅샷 및 압축</strong></td><td>이벤트 스토리지 급증</td><td>정기 스냅샷, 이벤트 압축, 장기 보존 전략 수립</td></tr><tr><td><strong>성능 튜닝</strong></td><td>이벤트 처리량 병목</td><td>배치 처리 또는 파티셔닝 활용</td></tr><tr><td><strong>색인·캐싱</strong></td><td>쿼리 성능 최적화</td><td>Read DB 인덱스 구성 및 캐시 계층 도입</td></tr><tr><td><strong>이벤트 버저닝</strong></td><td>변경 없는 구버전 호환</td><td>버전별 이벤트 핸들러 설계, 호환 로직 유지</td></tr><tr><td><strong>테스트 전략</strong></td><td>커맨드/쿼리 분리 테스트</td><td>단위 테스트 + 통합 테스트 + 이벤트 재처리 테스트</td></tr></tbody></table><hr><h2 id=3-모니터링-진단-및-해결-전략>3. 모니터링, 진단 및 해결 전략<a hidden class=anchor aria-hidden=true href=#3-모니터링-진단-및-해결-전략>#</a></h2><h3 id=-지연-모니터링>🔍 지연 모니터링<a hidden class=anchor aria-hidden=true href=#-지연-모니터링>#</a></h3><ul><li>이벤트 발행부터 Read DB 반영까지 지연시간 추적</li><li>메트릭 활용: 처리량(throughput), lags, 실패율</li></ul><h3 id=-장애-탐지>💥 장애 탐지<a hidden class=anchor aria-hidden=true href=#-장애-탐지>#</a></h3><ul><li>미처리 이벤트, Dead-letter 큐, Consumer 실패 탐지</li><li>Rollback 대비 재현(Replay) 기능 포함</li></ul><h3 id=-해결책>🔧 해결책<a hidden class=anchor aria-hidden=true href=#-해결책>#</a></h3><ol><li>Retry + Dead-letter 큐 + 관리자 알림 설계</li><li>수동 Replay/Drain 기능 제공</li><li>운영 시나리오 테스트 케이스 작성</li></ol><hr><h2 id=4-cqrs-적용이-적합한-시나리오>4. CQRS 적용이 적합한 시나리오<a hidden class=anchor aria-hidden=true href=#4-cqrs-적용이-적합한-시나리오>#</a></h2><ul><li><strong>읽기와 쓰기 요청 불균형</strong>: e‑commerce, SNS, 금융 서비스 등에서 높은 비대칭 존재 (<a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">sixt.tech</a>, <a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">learn.microsoft.com</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">hyscaler.com</a>).</li><li><strong>복잡한 도메인 로직</strong>: 주문처리, 결제, 재고 시스템 내 복잡 규칙 처리에 유리</li><li><strong>Event Sourcing 활용 시</strong>: 감사, 재구성, 상태 재생 기능 필요</li><li><strong>팀 규모와 구조</strong>: 대규모/분산 팀이 명확한 경계(Bounded Context) 설정 가능</li></ul><hr><h2 id=5-정리-요약>5. 정리 요약<a hidden class=anchor aria-hidden=true href=#5-정리-요약>#</a></h2><p>CQRS는 읽기와 쓰기를 분리하여 성능, 확장성, 보안, 도메인 설계를 최적화할 수 있는 강력한 아키텍처 패턴입니다. 하지만 도입 전 반드시 도전 과제, 운영 복잡도, 일관성 모델, 이벤트 설계 전략 등을 고려해야 합니다. 적절한 모니터링, 테스트, 이벤트 버전 관리 전략을 병행할 때 효과적인 시스템 구축이 가능합니다.</p><hr><p>다음으로 필요하신 부분은 <strong>Event Sourcing 결합</strong>, <strong>실무 적용 단계별 가이드</strong>, 또는 <strong>코드 중심 스켈레톤 구현 예제 (Python/JS)</strong> 등입니다. 특정한 사례나 코드 구현에 집중하고 싶으시면 말씀해 주세요!</p><p>아래는 <strong>CQRS + Event Sourcing</strong> 결합에 대한 심화 내용입니다.</p><hr><h2 id=1-event-sourcing-결합-cqrs--event-sourcing>1. Event Sourcing 결합 (CQRS + Event Sourcing)<a hidden class=anchor aria-hidden=true href=#1-event-sourcing-결합-cqrs--event-sourcing>#</a></h2><h3 id=-주요-개념-및-패턴>🎯 주요 개념 및 패턴<a hidden class=anchor aria-hidden=true href=#-주요-개념-및-패턴>#</a></h3><ul><li><strong>이벤트 중심 저장</strong>: 상태 변화는 append-only 이벤트로 기록. 이벤트는 불변(immutable) (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">upsolver.com</a>).</li><li><strong>이력 기반 상태 재구축</strong>: 모든 이벤트를 순차 재생하여 현재 상태를 재생성 가능 .</li><li><strong>CQRS와의 결합</strong>: 쓰기 모델은 이벤트 저장소(Event Store), 읽기 모델은 Projection으로 분리하여 읽기 성능 최적화 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">upsolver.com</a>).</li></ul><hr><h2 id=2-작동-흐름-및-구조>2. 작동 흐름 및 구조<a hidden class=anchor aria-hidden=true href=#2-작동-흐름-및-구조>#</a></h2><pre class=mermaid>flowchart LR
  UI --&gt;|Command| CmdHandler
  CmdHandler --&gt;|Append| EventStore
  EventStore --&gt;|Publish| EventBus
  EventBus --&gt; Projection[Projection 서비스]
  Projection --&gt; ReadDB[읽기 DB]
  UI &lt;--|Query| QueryHandler
  QueryHandler --&gt; ReadDB
</pre><ol><li>커맨드 실행 시 <strong>Append-only 이벤트 저장</strong></li><li>이벤트 버스 통해 <strong>구독 및 Projection → 읽기 DB 갱신</strong></li><li>Query는 <strong>읽기 DB에서 값 조회</strong></li><li>현재 상태는 <strong>Projection된 상태</strong>, 필요 시 <strong>전체 이벤트 재생 가능</strong></li></ol><hr><h2 id=3-구현-예시-python-기반>3. 구현 예시 (Python 기반)<a hidden class=anchor aria-hidden=true href=#3-구현-예시-python-기반>#</a></h2><h3 id=-라이브러리-활용>✅ 라이브러리 활용<a hidden class=anchor aria-hidden=true href=#-라이브러리-활용>#</a></h3><ul><li><strong>eventsourcing</strong>: Python 이벤트소싱 라이브러리 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">medium.com</a>, <a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">stackoverflow.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">upsolver.com</a>, <a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">eventsourcing.readthedocs.io</a>).</li><li><strong>pyeventsourcing</strong>: Aggregate, event 데코레이터 기반 간편 구현 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">github.com</a>).</li></ul><h3 id=-샘플-코드-eventsourcing-라이브러리>🔧 샘플 코드 (eventsourcing 라이브러리)<a hidden class=anchor aria-hidden=true href=#-샘플-코드-eventsourcing-라이브러리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1> 1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2> 2</a>
</span><span class=lnt id=hl-64-3><a class=lnlinks href=#hl-64-3> 3</a>
</span><span class=lnt id=hl-64-4><a class=lnlinks href=#hl-64-4> 4</a>
</span><span class=lnt id=hl-64-5><a class=lnlinks href=#hl-64-5> 5</a>
</span><span class=lnt id=hl-64-6><a class=lnlinks href=#hl-64-6> 6</a>
</span><span class=lnt id=hl-64-7><a class=lnlinks href=#hl-64-7> 7</a>
</span><span class=lnt id=hl-64-8><a class=lnlinks href=#hl-64-8> 8</a>
</span><span class=lnt id=hl-64-9><a class=lnlinks href=#hl-64-9> 9</a>
</span><span class=lnt id=hl-64-10><a class=lnlinks href=#hl-64-10>10</a>
</span><span class=lnt id=hl-64-11><a class=lnlinks href=#hl-64-11>11</a>
</span><span class=lnt id=hl-64-12><a class=lnlinks href=#hl-64-12>12</a>
</span><span class=lnt id=hl-64-13><a class=lnlinks href=#hl-64-13>13</a>
</span><span class=lnt id=hl-64-14><a class=lnlinks href=#hl-64-14>14</a>
</span><span class=lnt id=hl-64-15><a class=lnlinks href=#hl-64-15>15</a>
</span><span class=lnt id=hl-64-16><a class=lnlinks href=#hl-64-16>16</a>
</span><span class=lnt id=hl-64-17><a class=lnlinks href=#hl-64-17>17</a>
</span><span class=lnt id=hl-64-18><a class=lnlinks href=#hl-64-18>18</a>
</span><span class=lnt id=hl-64-19><a class=lnlinks href=#hl-64-19>19</a>
</span><span class=lnt id=hl-64-20><a class=lnlinks href=#hl-64-20>20</a>
</span><span class=lnt id=hl-64-21><a class=lnlinks href=#hl-64-21>21</a>
</span><span class=lnt id=hl-64-22><a class=lnlinks href=#hl-64-22>22</a>
</span><span class=lnt id=hl-64-23><a class=lnlinks href=#hl-64-23>23</a>
</span><span class=lnt id=hl-64-24><a class=lnlinks href=#hl-64-24>24</a>
</span><span class=lnt id=hl-64-25><a class=lnlinks href=#hl-64-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>eventsourcing.domain</span> <span class=kn>import</span> <span class=n>Aggregate</span><span class=p>,</span> <span class=n>event</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>eventsourcing.application</span> <span class=kn>import</span> <span class=n>Application</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Account</span><span class=p>(</span><span class=n>Aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=nd>@event</span><span class=p>(</span><span class=s1>&#39;Created&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>=</span> <span class=n>owner</span><span class=p>;</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nd>@event</span><span class=p>(</span><span class=s1>&#39;Deposited&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>  <span class=nd>@event</span><span class=p>(</span><span class=s1>&#39;Withdrawn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>withdraw</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AccountApp</span><span class=p>(</span><span class=n>Application</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>create_account</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acct</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=n>owner</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>acct</span><span class=p>);</span> <span class=k>return</span> <span class=n>acct</span><span class=o>.</span><span class=n>id</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>acct_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acct</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>acct_id</span><span class=p>);</span> <span class=n>acct</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span> <span class=bp>self</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>acct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>get_balance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>acct_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acct</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>acct_id</span><span class=p>);</span> <span class=k>return</span> <span class=n>acct</span><span class=o>.</span><span class=n>balance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>AccountApp</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>id</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>create_account</span><span class=p>(</span><span class=s2>&#34;Alice&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>app</span><span class=o>.</span><span class=n>get_balance</span><span class=p>(</span><span class=nb>id</span><span class=p>))</span>  <span class=c1># 100</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>이벤트 저장 및 Aggregate 상태 재구축이 자동으로 처리됩니다. (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">github.com</a>)</li></ul><hr><h2 id=4-장점--주의사항>4. 장점 & 주의사항<a hidden class=anchor aria-hidden=true href=#4-장점--주의사항>#</a></h2><h3 id=-장점-1>✅ 장점<a hidden class=anchor aria-hidden=true href=#-장점-1>#</a></h3><ul><li><strong>완전한 변경 이력</strong> 저장 → 디버깅, 감사, 재생 기능 ⏳</li><li><strong>읽기 모델 최적화</strong> → 쿼리 처리 성능 향상</li><li><strong>Fault tolerance</strong>: 이벤트 재실행으로 오류 회복 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">upsolver.com</a>)</li></ul><h3 id=-주의사항>⚠️ 주의사항<a hidden class=anchor aria-hidden=true href=#-주의사항>#</a></h3><ul><li><strong>이벤트 스토리지 급증</strong>: Snapshot 전략 필요</li><li><strong>이벤트 스키마 변화 관리 필요</strong>: 버저닝 로직 또는 호환 전략 수립</li><li><strong>일관성 지연</strong>: 비동기 Projection으로 인한 Eventual Consistency 주의 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">learn.microsoft.com</a>)</li></ul><hr><h2 id=5-실무-적용-단계별-가이드>5. 실무 적용 단계별 가이드<a hidden class=anchor aria-hidden=true href=#5-실무-적용-단계별-가이드>#</a></h2><table><thead><tr><th>단계</th><th>내용</th><th>설명</th></tr></thead><tbody><tr><td></td><td>Aggregate 식별</td><td>이벤트 등록 및 혜택이 있는 도메인 결정</td></tr><tr><td></td><td>이벤트 정의</td><td>명확한 도메인 의미(event names), 페이로드 설계</td></tr><tr><td></td><td>Event Store</td><td>Kafka, EventStoreDB, DB 선택</td></tr><tr><td></td><td>Command Handler</td><td>이벤트 생성, append-only 저장</td></tr><tr><td></td><td>Projection</td><td>읽기 쿼리 패턴 반영하여 View 생성</td></tr><tr><td></td><td>브로커</td><td>메시지 전달용 Kafka/RabbitMQ 구성</td></tr><tr><td></td><td>Snapshot</td><td>성능 최적화 및 schema evolution 대응</td></tr><tr><td></td><td>지연, 예외 추적</td><td>적절한 alert + 재처리 로직 배치</td></tr></tbody></table><hr><h2 id=6-요약>6. 요약<a hidden class=anchor aria-hidden=true href=#6-요약>#</a></h2><p>Event Sourcing과 결합된 CQRS는 이벤트 이력을 기반으로 읽기/쓰기 책임을 분리해 성능, 확장성, 감사 기능을 강화합니다. 그러나 이벤트 버저닝, 스토리지 관리, 일관성 지연 같은 과제도 존재하며, 이를 해결하기 위해 스냅샷, 모니터링 전략이 필수적입니다. Python 기반 구현은 다양한 라이브러리를 활용해 비교적 쉽게 도입 가능합니다.</p><hr><h2 id=참고-자료>참고 자료<a hidden class=anchor aria-hidden=true href=#참고-자료>#</a></h2><ul><li>Upsolver, <em>CQRS + Event Sourcing 원리</em> (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">github.com</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">learn.microsoft.com</a>, <a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">mia-platform.eu</a>, <a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">medium.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">upsolver.com</a>, <a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">stackoverflow.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">medium.com</a>, <a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">developer.confluent.io</a>)</li><li>Microsoft Azure, <em>Event Sourcing 실행 흐름</em></li><li>Confluent Developer, <em>CQRS vs Event Sourcing 최적 결합 사례</em></li><li>Python 이벤트소싱 라이브러리 docs (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">eventsourcing.readthedocs.io</a>)</li></ul><hr><p>다음으로는 <strong>Python 기반 전체 예제 프로젝트 구성</strong>, 또는 <strong>JavaScript 버전 구현</strong>을 원하시면 말씀해 주세요!</p><p>알겠습니다! 다음은 <strong>Python 기반 CQRS + Event Sourcing 예제 프로젝트 구성</strong>과 <strong>JavaScript 버전 구현</strong> 두 가지 방향으로 나눠 설명드리겠습니다. 요청하시는 방향을 알려주시면 해당 부분을 상세하게 작성해드릴게요.</p><hr><h2 id=-선택할-수-있는-두-가지-예시-유형>🧭 선택할 수 있는 두 가지 예시 유형<a hidden class=anchor aria-hidden=true href=#-선택할-수-있는-두-가지-예시-유형>#</a></h2><ol><li><p><strong>Python 기반 전체 예제 프로젝트 구성</strong></p><ul><li><p>디렉터리 구조</p></li><li><p>Command Side, Event Store, Projection, Query Side 구성</p></li><li><p>예제 코드 및 실행 플로우</p></li><li><p>테스트 및 실행 스크립트 포함</p></li></ul></li><li><p><strong>JavaScript (Node.js) 버전 구현</strong></p><ul><li><p>Event Sourcing을 위한 라이브러리 선택 (예: <code>node-eventstore</code>, <code>@nestjs/cqrs</code>)</p></li><li><p>Aggregates, Event Bus, Projection 구현</p></li><li><p>REST API 엔드포인트 예시</p></li><li><p>테스트 코드와 실행 방법 제시</p></li></ul></li></ol><hr><h2 id=-다음에-전달드릴-내용-예시-python-프로젝트>📌 다음에 전달드릴 내용 예시 (Python 프로젝트)<a hidden class=anchor aria-hidden=true href=#-다음에-전달드릴-내용-예시-python-프로젝트>#</a></h2><h3 id=프로젝트-구성-구조>프로젝트 구성 구조<a hidden class=anchor aria-hidden=true href=#프로젝트-구성-구조>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-65-1><a class=lnlinks href=#hl-65-1> 1</a>
</span><span class=lnt id=hl-65-2><a class=lnlinks href=#hl-65-2> 2</a>
</span><span class=lnt id=hl-65-3><a class=lnlinks href=#hl-65-3> 3</a>
</span><span class=lnt id=hl-65-4><a class=lnlinks href=#hl-65-4> 4</a>
</span><span class=lnt id=hl-65-5><a class=lnlinks href=#hl-65-5> 5</a>
</span><span class=lnt id=hl-65-6><a class=lnlinks href=#hl-65-6> 6</a>
</span><span class=lnt id=hl-65-7><a class=lnlinks href=#hl-65-7> 7</a>
</span><span class=lnt id=hl-65-8><a class=lnlinks href=#hl-65-8> 8</a>
</span><span class=lnt id=hl-65-9><a class=lnlinks href=#hl-65-9> 9</a>
</span><span class=lnt id=hl-65-10><a class=lnlinks href=#hl-65-10>10</a>
</span><span class=lnt id=hl-65-11><a class=lnlinks href=#hl-65-11>11</a>
</span><span class=lnt id=hl-65-12><a class=lnlinks href=#hl-65-12>12</a>
</span><span class=lnt id=hl-65-13><a class=lnlinks href=#hl-65-13>13</a>
</span><span class=lnt id=hl-65-14><a class=lnlinks href=#hl-65-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cqrs-es-example/
</span></span><span class=line><span class=cl>├── commands/
</span></span><span class=line><span class=cl>│   └── create_order.py
</span></span><span class=line><span class=cl>├── events/
</span></span><span class=line><span class=cl>│   └── order_created.py
</span></span><span class=line><span class=cl>├── projections/
</span></span><span class=line><span class=cl>│   └── order_projection.py
</span></span><span class=line><span class=cl>├── store/
</span></span><span class=line><span class=cl>│   └── event_store.py
</span></span><span class=line><span class=cl>├── api/
</span></span><span class=line><span class=cl>│   ├── cmd_api.py
</span></span><span class=line><span class=cl>│   └── query_api.py
</span></span><span class=line><span class=cl>├── requirements.txt
</span></span><span class=line><span class=cl>└── README.md
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>commands/</strong>: Command 객체와 Handler</p></li><li><p><strong>events/</strong>: 도메인 이벤트 정의</p></li><li><p><strong>projections/</strong>: Event → Read 모델 갱신 로직</p></li><li><p><strong>store/</strong>: 이벤트 스토어 구현 및 Repository</p></li><li><p><strong>api/</strong>: REST API (Flask/FastAPI)로 커맨드/쿼리 제공</p></li></ul><h3 id=핵심-코드-예시>핵심 코드 예시<a hidden class=anchor aria-hidden=true href=#핵심-코드-예시>#</a></h3><ul><li><p>CreateOrderCommand 생성 및 유효성 검사</p></li><li><p>Event Store append + publish</p></li><li><p>Projection 서비스: 이벤트 구독 및 Read DB (SQLite 등) 업데이트</p></li><li><p>REST를 통한 주문 생성/조회</p></li></ul><h3 id=실행-시나리오>실행 시나리오<a hidden class=anchor aria-hidden=true href=#실행-시나리오>#</a></h3><ol><li><p><code>POST /api/command/order</code>로 주문 생성</p></li><li><p>이벤트 저장 → 프로젝션 적용</p></li><li><p><code>GET /api/query/order/:id</code>로 주문 정보 조회</p></li></ol><h3 id=테스트-및-실행>테스트 및 실행<a hidden class=anchor aria-hidden=true href=#테스트-및-실행>#</a></h3><ul><li><p>Python 가상환경, <code>requirements.txt</code></p></li><li><p><code>pytest</code> 또는 unittest 기반 테스트</p></li><li><p>이벤트 재생, 스냅샷 테스트 포함</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-66-1><a class=lnlinks href=#hl-66-1>  1</a>
</span><span class=lnt id=hl-66-2><a class=lnlinks href=#hl-66-2>  2</a>
</span><span class=lnt id=hl-66-3><a class=lnlinks href=#hl-66-3>  3</a>
</span><span class=lnt id=hl-66-4><a class=lnlinks href=#hl-66-4>  4</a>
</span><span class=lnt id=hl-66-5><a class=lnlinks href=#hl-66-5>  5</a>
</span><span class=lnt id=hl-66-6><a class=lnlinks href=#hl-66-6>  6</a>
</span><span class=lnt id=hl-66-7><a class=lnlinks href=#hl-66-7>  7</a>
</span><span class=lnt id=hl-66-8><a class=lnlinks href=#hl-66-8>  8</a>
</span><span class=lnt id=hl-66-9><a class=lnlinks href=#hl-66-9>  9</a>
</span><span class=lnt id=hl-66-10><a class=lnlinks href=#hl-66-10> 10</a>
</span><span class=lnt id=hl-66-11><a class=lnlinks href=#hl-66-11> 11</a>
</span><span class=lnt id=hl-66-12><a class=lnlinks href=#hl-66-12> 12</a>
</span><span class=lnt id=hl-66-13><a class=lnlinks href=#hl-66-13> 13</a>
</span><span class=lnt id=hl-66-14><a class=lnlinks href=#hl-66-14> 14</a>
</span><span class=lnt id=hl-66-15><a class=lnlinks href=#hl-66-15> 15</a>
</span><span class=lnt id=hl-66-16><a class=lnlinks href=#hl-66-16> 16</a>
</span><span class=lnt id=hl-66-17><a class=lnlinks href=#hl-66-17> 17</a>
</span><span class=lnt id=hl-66-18><a class=lnlinks href=#hl-66-18> 18</a>
</span><span class=lnt id=hl-66-19><a class=lnlinks href=#hl-66-19> 19</a>
</span><span class=lnt id=hl-66-20><a class=lnlinks href=#hl-66-20> 20</a>
</span><span class=lnt id=hl-66-21><a class=lnlinks href=#hl-66-21> 21</a>
</span><span class=lnt id=hl-66-22><a class=lnlinks href=#hl-66-22> 22</a>
</span><span class=lnt id=hl-66-23><a class=lnlinks href=#hl-66-23> 23</a>
</span><span class=lnt id=hl-66-24><a class=lnlinks href=#hl-66-24> 24</a>
</span><span class=lnt id=hl-66-25><a class=lnlinks href=#hl-66-25> 25</a>
</span><span class=lnt id=hl-66-26><a class=lnlinks href=#hl-66-26> 26</a>
</span><span class=lnt id=hl-66-27><a class=lnlinks href=#hl-66-27> 27</a>
</span><span class=lnt id=hl-66-28><a class=lnlinks href=#hl-66-28> 28</a>
</span><span class=lnt id=hl-66-29><a class=lnlinks href=#hl-66-29> 29</a>
</span><span class=lnt id=hl-66-30><a class=lnlinks href=#hl-66-30> 30</a>
</span><span class=lnt id=hl-66-31><a class=lnlinks href=#hl-66-31> 31</a>
</span><span class=lnt id=hl-66-32><a class=lnlinks href=#hl-66-32> 32</a>
</span><span class=lnt id=hl-66-33><a class=lnlinks href=#hl-66-33> 33</a>
</span><span class=lnt id=hl-66-34><a class=lnlinks href=#hl-66-34> 34</a>
</span><span class=lnt id=hl-66-35><a class=lnlinks href=#hl-66-35> 35</a>
</span><span class=lnt id=hl-66-36><a class=lnlinks href=#hl-66-36> 36</a>
</span><span class=lnt id=hl-66-37><a class=lnlinks href=#hl-66-37> 37</a>
</span><span class=lnt id=hl-66-38><a class=lnlinks href=#hl-66-38> 38</a>
</span><span class=lnt id=hl-66-39><a class=lnlinks href=#hl-66-39> 39</a>
</span><span class=lnt id=hl-66-40><a class=lnlinks href=#hl-66-40> 40</a>
</span><span class=lnt id=hl-66-41><a class=lnlinks href=#hl-66-41> 41</a>
</span><span class=lnt id=hl-66-42><a class=lnlinks href=#hl-66-42> 42</a>
</span><span class=lnt id=hl-66-43><a class=lnlinks href=#hl-66-43> 43</a>
</span><span class=lnt id=hl-66-44><a class=lnlinks href=#hl-66-44> 44</a>
</span><span class=lnt id=hl-66-45><a class=lnlinks href=#hl-66-45> 45</a>
</span><span class=lnt id=hl-66-46><a class=lnlinks href=#hl-66-46> 46</a>
</span><span class=lnt id=hl-66-47><a class=lnlinks href=#hl-66-47> 47</a>
</span><span class=lnt id=hl-66-48><a class=lnlinks href=#hl-66-48> 48</a>
</span><span class=lnt id=hl-66-49><a class=lnlinks href=#hl-66-49> 49</a>
</span><span class=lnt id=hl-66-50><a class=lnlinks href=#hl-66-50> 50</a>
</span><span class=lnt id=hl-66-51><a class=lnlinks href=#hl-66-51> 51</a>
</span><span class=lnt id=hl-66-52><a class=lnlinks href=#hl-66-52> 52</a>
</span><span class=lnt id=hl-66-53><a class=lnlinks href=#hl-66-53> 53</a>
</span><span class=lnt id=hl-66-54><a class=lnlinks href=#hl-66-54> 54</a>
</span><span class=lnt id=hl-66-55><a class=lnlinks href=#hl-66-55> 55</a>
</span><span class=lnt id=hl-66-56><a class=lnlinks href=#hl-66-56> 56</a>
</span><span class=lnt id=hl-66-57><a class=lnlinks href=#hl-66-57> 57</a>
</span><span class=lnt id=hl-66-58><a class=lnlinks href=#hl-66-58> 58</a>
</span><span class=lnt id=hl-66-59><a class=lnlinks href=#hl-66-59> 59</a>
</span><span class=lnt id=hl-66-60><a class=lnlinks href=#hl-66-60> 60</a>
</span><span class=lnt id=hl-66-61><a class=lnlinks href=#hl-66-61> 61</a>
</span><span class=lnt id=hl-66-62><a class=lnlinks href=#hl-66-62> 62</a>
</span><span class=lnt id=hl-66-63><a class=lnlinks href=#hl-66-63> 63</a>
</span><span class=lnt id=hl-66-64><a class=lnlinks href=#hl-66-64> 64</a>
</span><span class=lnt id=hl-66-65><a class=lnlinks href=#hl-66-65> 65</a>
</span><span class=lnt id=hl-66-66><a class=lnlinks href=#hl-66-66> 66</a>
</span><span class=lnt id=hl-66-67><a class=lnlinks href=#hl-66-67> 67</a>
</span><span class=lnt id=hl-66-68><a class=lnlinks href=#hl-66-68> 68</a>
</span><span class=lnt id=hl-66-69><a class=lnlinks href=#hl-66-69> 69</a>
</span><span class=lnt id=hl-66-70><a class=lnlinks href=#hl-66-70> 70</a>
</span><span class=lnt id=hl-66-71><a class=lnlinks href=#hl-66-71> 71</a>
</span><span class=lnt id=hl-66-72><a class=lnlinks href=#hl-66-72> 72</a>
</span><span class=lnt id=hl-66-73><a class=lnlinks href=#hl-66-73> 73</a>
</span><span class=lnt id=hl-66-74><a class=lnlinks href=#hl-66-74> 74</a>
</span><span class=lnt id=hl-66-75><a class=lnlinks href=#hl-66-75> 75</a>
</span><span class=lnt id=hl-66-76><a class=lnlinks href=#hl-66-76> 76</a>
</span><span class=lnt id=hl-66-77><a class=lnlinks href=#hl-66-77> 77</a>
</span><span class=lnt id=hl-66-78><a class=lnlinks href=#hl-66-78> 78</a>
</span><span class=lnt id=hl-66-79><a class=lnlinks href=#hl-66-79> 79</a>
</span><span class=lnt id=hl-66-80><a class=lnlinks href=#hl-66-80> 80</a>
</span><span class=lnt id=hl-66-81><a class=lnlinks href=#hl-66-81> 81</a>
</span><span class=lnt id=hl-66-82><a class=lnlinks href=#hl-66-82> 82</a>
</span><span class=lnt id=hl-66-83><a class=lnlinks href=#hl-66-83> 83</a>
</span><span class=lnt id=hl-66-84><a class=lnlinks href=#hl-66-84> 84</a>
</span><span class=lnt id=hl-66-85><a class=lnlinks href=#hl-66-85> 85</a>
</span><span class=lnt id=hl-66-86><a class=lnlinks href=#hl-66-86> 86</a>
</span><span class=lnt id=hl-66-87><a class=lnlinks href=#hl-66-87> 87</a>
</span><span class=lnt id=hl-66-88><a class=lnlinks href=#hl-66-88> 88</a>
</span><span class=lnt id=hl-66-89><a class=lnlinks href=#hl-66-89> 89</a>
</span><span class=lnt id=hl-66-90><a class=lnlinks href=#hl-66-90> 90</a>
</span><span class=lnt id=hl-66-91><a class=lnlinks href=#hl-66-91> 91</a>
</span><span class=lnt id=hl-66-92><a class=lnlinks href=#hl-66-92> 92</a>
</span><span class=lnt id=hl-66-93><a class=lnlinks href=#hl-66-93> 93</a>
</span><span class=lnt id=hl-66-94><a class=lnlinks href=#hl-66-94> 94</a>
</span><span class=lnt id=hl-66-95><a class=lnlinks href=#hl-66-95> 95</a>
</span><span class=lnt id=hl-66-96><a class=lnlinks href=#hl-66-96> 96</a>
</span><span class=lnt id=hl-66-97><a class=lnlinks href=#hl-66-97> 97</a>
</span><span class=lnt id=hl-66-98><a class=lnlinks href=#hl-66-98> 98</a>
</span><span class=lnt id=hl-66-99><a class=lnlinks href=#hl-66-99> 99</a>
</span><span class=lnt id=hl-66-100><a class=lnlinks href=#hl-66-100>100</a>
</span><span class=lnt id=hl-66-101><a class=lnlinks href=#hl-66-101>101</a>
</span><span class=lnt id=hl-66-102><a class=lnlinks href=#hl-66-102>102</a>
</span><span class=lnt id=hl-66-103><a class=lnlinks href=#hl-66-103>103</a>
</span><span class=lnt id=hl-66-104><a class=lnlinks href=#hl-66-104>104</a>
</span><span class=lnt id=hl-66-105><a class=lnlinks href=#hl-66-105>105</a>
</span><span class=lnt id=hl-66-106><a class=lnlinks href=#hl-66-106>106</a>
</span><span class=lnt id=hl-66-107><a class=lnlinks href=#hl-66-107>107</a>
</span><span class=lnt id=hl-66-108><a class=lnlinks href=#hl-66-108>108</a>
</span><span class=lnt id=hl-66-109><a class=lnlinks href=#hl-66-109>109</a>
</span><span class=lnt id=hl-66-110><a class=lnlinks href=#hl-66-110>110</a>
</span><span class=lnt id=hl-66-111><a class=lnlinks href=#hl-66-111>111</a>
</span><span class=lnt id=hl-66-112><a class=lnlinks href=#hl-66-112>112</a>
</span><span class=lnt id=hl-66-113><a class=lnlinks href=#hl-66-113>113</a>
</span><span class=lnt id=hl-66-114><a class=lnlinks href=#hl-66-114>114</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># CQRS + Event Sourcing Python 예제</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 디렉터리 구조</span>
</span></span><span class=line><span class=cl><span class=c1># cqrs_es_example/</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ commands/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ create_order.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ events/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ order_created.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ projections/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ order_projection.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ store/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ event_store.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ api/</span>
</span></span><span class=line><span class=cl><span class=c1># │   ├─ cmd_api.py</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ query_api.py</span>
</span></span><span class=line><span class=cl><span class=c1># └─ main.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># commands/create_order.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreateOrderCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>product</span><span class=p>,</span> <span class=n>quantity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product</span> <span class=o>=</span> <span class=n>product</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>quantity</span> <span class=o>=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># events/order_created.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>product</span><span class=p>,</span> <span class=n>quantity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product</span> <span class=o>=</span> <span class=n>product</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>quantity</span> <span class=o>=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># store/event_store.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># projections/order_projection.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=s1>&#39;order_id&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;product&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>product</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>quantity</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># api/cmd_api.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>commands.create_order</span> <span class=kn>import</span> <span class=n>CreateOrderCommand</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>events.order_created</span> <span class=kn>import</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>store.event_store</span> <span class=kn>import</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>projections.order_projection</span> <span class=kn>import</span> <span class=n>projection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/command/order&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=n>CreateOrderCommand</span><span class=p>(</span><span class=o>**</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>product</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>quantity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>projection</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;created&#39;</span><span class=p>}),</span> <span class=mi>201</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># api/query_api.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>projections.order_projection</span> <span class=kn>import</span> <span class=n>projection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>query_app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@query_app.route</span><span class=p>(</span><span class=s1>&#39;/query/order/&lt;order_id&gt;&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>projection</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>order</span><span class=p>),</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;not found&#39;</span><span class=p>}),</span> <span class=mi>404</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># main.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>api.cmd_api</span> <span class=kn>import</span> <span class=n>app</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>api.query_api</span> <span class=kn>import</span> <span class=n>query_app</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>werkzeug.middleware.dispatcher</span> <span class=kn>import</span> <span class=n>DispatcherMiddleware</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>application</span> <span class=o>=</span> <span class=n>DispatcherMiddleware</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;/query&#39;</span><span class=p>:</span> <span class=n>query_app</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 공통 모듈 인스턴스 (store/event_store.py)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>events.order_created</span> <span class=kn>import</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>projections.order_projection</span> <span class=kn>import</span> <span class=n>OrderProjection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>projection</span> <span class=o>=</span> <span class=n>OrderProjection</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>원하시는 방향을 말씀해 주세요!</p><p>안녕하세요! CQRS에 대한 포괄적인 조사와 분석을 시작하겠습니다. 먼저 최신 정보를 수집하여 심도 있는 분석을 진행하겠습니다.</p><h1 id=cqrs-command-query-responsibility-segregation-포괄적-분석>CQRS (Command Query Responsibility Segregation) 포괄적 분석<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-포괄적-분석>#</a></h1><h2 id=1-태그-1>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-1>#</a></h2><ul><li><code>Command-Query-Responsibility-Segregation</code></li><li><code>Event-Sourcing-Pattern</code></li><li><code>Microservices-Architecture</code></li><li><code>Data-Management-Pattern</code></li></ul><h2 id=2-분류-구조-검토>2. 분류 구조 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-검토>#</a></h2><p>&ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns&rdquo;</p><p><strong>검토 결과</strong>: 적절한 분류입니다. CQRS는 본질적으로 데이터 관리 패턴이며, 명령과 조회의 책임을 분리하는 아키텍처 패턴으로서 소프트웨어 설계 및 아키텍처 영역에 속합니다. 더 구체적으로는 분산 시스템과 마이크로서비스 아키텍처에서 널리 사용되는 패턴이므로 해당 계층 구조가 적절합니다.</p><h2 id=3-요약-설명-200자-내외>3. 요약 설명 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-설명-200자-내외>#</a></h2><p>CQRS는 시스템에서 데이터를 변경하는 명령(Command)과 데이터를 조회하는 쿼리(Query)의 책임을 분리하는 아키텍처 패턴입니다. 이를 통해 읽기와 쓰기 작업을 독립적으로 최적화할 수 있어 성능, 확장성, 보안성을 향상시킬 수 있습니다.</p><h2 id=4-개요-250자-내외>4. 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요-250자-내외>#</a></h2><p>CQRS는 전통적인 CRUD 아키텍처의 한계를 극복하기 위해 개발된 패턴으로, 복잡한 도메인 로직과 높은 트래픽을 처리하는 시스템에서 특히 유용합니다. Event Sourcing과 함께 사용되어 이벤트 기반 아키텍처를 구성하며, 마이크로서비스 환경에서 각 서비스의 독립적인 확장과 최적화를 가능하게 합니다.</p><hr><h2 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h2><h3 id=51-기본-개념>5.1 기본 개념<a hidden class=anchor aria-hidden=true href=#51-기본-개념>#</a></h3><p>**CQRS (Command Query Responsibility Segregation)**는 Bertrand Meyer의 CQS (Command Query Separation) 원칙을 확장한 아키텍처 패턴입니다.</p><p><strong>핵심 원칙</strong>:</p><ul><li><strong>명령 (Command)</strong>: 시스템의 상태를 변경하는 작업 (Create, Update, Delete)</li><li><strong>조회 (Query)</strong>: 시스템의 상태를 읽는 작업 (Read), 상태 변경 없음</li><li><strong>책임 분리</strong>: 명령과 조회를 별도의 모델과 인터페이스로 처리</li></ul><h3 id=52-실무-구현-관련-핵심-개념>5.2 실무 구현 관련 핵심 개념<a hidden class=anchor aria-hidden=true href=#52-실무-구현-관련-핵심-개념>#</a></h3><p><strong>Write Model (명령 모델)</strong>:</p><ul><li>비즈니스 로직과 도메인 규칙 포함</li><li>트랜잭션 무결성과 일관성 보장</li><li>명령 검증 및 처리</li></ul><p><strong>Read Model (조회 모델)</strong>:</p><ul><li>조회에 최적화된 데이터 구조</li><li>DTO (Data Transfer Object) 또는 프로젝션 제공</li><li>캐싱 및 성능 최적화</li></ul><p><strong>Event Store</strong>:</p><ul><li>도메인 이벤트의 영구 저장소</li><li>Event Sourcing과 결합 시 활용</li><li>감사 추적 및 이력 관리</li></ul><h2 id=6-배경>6. 배경<a hidden class=anchor aria-hidden=true href=#6-배경>#</a></h2><p>CQRS는 2010년 Greg Young에 의해 정의되었으며, 다음과 같은 문제들을 해결하기 위해 등장했습니다:</p><ul><li><strong>성능 병목현상</strong>: 단일 모델에서 읽기/쓰기 작업의 경합</li><li><strong>복잡한 도메인 모델</strong>: 읽기와 쓰기 요구사항의 차이</li><li><strong>확장성 한계</strong>: 읽기와 쓰기 작업의 서로 다른 확장 요구사항</li><li><strong>데이터 불일치</strong>: 복잡한 조인과 집계 연산의 성능 문제</li></ul><h2 id=7-목적-및-필요성>7. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#7-목적-및-필요성>#</a></h2><h3 id=71-목적>7.1 목적<a hidden class=anchor aria-hidden=true href=#71-목적>#</a></h3><ul><li>읽기와 쓰기 작업의 독립적 최적화</li><li>복잡한 비즈니스 로직의 단순화</li><li>시스템 성능 및 확장성 개선</li><li>개발팀의 병렬 작업 가능</li></ul><h3 id=72-필요성>7.2 필요성<a hidden class=anchor aria-hidden=true href=#72-필요성>#</a></h3><ul><li>높은 트래픽과 복잡한 데이터 요구사항</li><li>읽기와 쓰기 패턴의 현저한 차이</li><li>마이크로서비스 환경에서의 데이터 분리</li><li>이벤트 기반 아키텍처 구현</li></ul><h2 id=8-주요-기능-및-역할>8. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#8-주요-기능-및-역할>#</a></h2><h3 id=81-명령-처리>8.1 명령 처리<a hidden class=anchor aria-hidden=true href=#81-명령-처리>#</a></h3><ul><li>비즈니스 규칙 검증</li><li>도메인 이벤트 생성</li><li>상태 변경 관리</li><li>트랜잭션 처리</li></ul><h3 id=82-조회-처리>8.2 조회 처리<a hidden class=anchor aria-hidden=true href=#82-조회-처리>#</a></h3><ul><li>최적화된 데이터 조회</li><li>프로젝션 생성 및 관리</li><li>캐싱 전략 구현</li><li>성능 최적화</li></ul><h3 id=83-이벤트-관리>8.3 이벤트 관리<a hidden class=anchor aria-hidden=true href=#83-이벤트-관리>#</a></h3><ul><li>도메인 이벤트 발행</li><li>이벤트 스트림 처리</li><li>최종 일관성 보장</li><li>감사 추적</li></ul><h2 id=9-주요-원리>9. 주요 원리<a hidden class=anchor aria-hidden=true href=#9-주요-원리>#</a></h2><h3 id=91-cqs-원칙-확장>9.1 CQS 원칙 확장<a hidden class=anchor aria-hidden=true href=#91-cqs-원칙-확장>#</a></h3><pre class=mermaid>graph TD
    A[CQS 원칙] --&gt; B[메서드 수준 분리]
    A --&gt; C[Command: 상태 변경]
    A --&gt; D[Query: 데이터 반환]
    
    E[CQRS 패턴] --&gt; F[객체/모델 수준 분리]
    E --&gt; G[Write Model]
    E --&gt; H[Read Model]
    
    B --&gt; E
</pre><h3 id=92-책임-분리-원칙>9.2 책임 분리 원칙<a hidden class=anchor aria-hidden=true href=#92-책임-분리-원칙>#</a></h3><ul><li><strong>단일 책임</strong>: 각 모델은 하나의 명확한 책임</li><li><strong>인터페이스 분리</strong>: 명령과 조회 인터페이스 분리</li><li><strong>의존성 역전</strong>: 추상화에 의존하는 구조</li></ul><h2 id=10-작동-원리>10. 작동 원리<a hidden class=anchor aria-hidden=true href=#10-작동-원리>#</a></h2><h3 id=101-기본-cqrs-흐름>10.1 기본 CQRS 흐름<a hidden class=anchor aria-hidden=true href=#101-기본-cqrs-흐름>#</a></h3><pre class=mermaid>sequenceDiagram
    participant Client
    participant CommandAPI
    participant WriteModel
    participant Database
    participant EventBus
    participant ReadModel
    participant QueryAPI

    Client-&gt;&gt;CommandAPI: Command 전송
    CommandAPI-&gt;&gt;WriteModel: 명령 처리
    WriteModel-&gt;&gt;Database: 데이터 저장
    WriteModel-&gt;&gt;EventBus: 이벤트 발행
    EventBus-&gt;&gt;ReadModel: 이벤트 처리
    ReadModel-&gt;&gt;Database: 조회 모델 업데이트
    
    Client-&gt;&gt;QueryAPI: Query 요청
    QueryAPI-&gt;&gt;ReadModel: 데이터 조회
    ReadModel-&gt;&gt;Client: 결과 반환
</pre><h3 id=102-event-sourcing과-결합된-cqrs>10.2 Event Sourcing과 결합된 CQRS<a hidden class=anchor aria-hidden=true href=#102-event-sourcing과-결합된-cqrs>#</a></h3><pre class=mermaid>graph LR
    A[Command] --&gt; B[Command Handler]
    B --&gt; C[Aggregate]
    C --&gt; D[Events]
    D --&gt; E[Event Store]
    E --&gt; F[Event Handler]
    F --&gt; G[Read Model]
    G --&gt; H[Query]
</pre><h2 id=11-구조-및-아키텍처>11. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처>#</a></h2><h3 id=111-전체-아키텍처>11.1 전체 아키텍처<a hidden class=anchor aria-hidden=true href=#111-전체-아키텍처>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;Command Side (Write)&#34;
        A[Command API]
        B[Command Handlers]
        C[Domain Model]
        D[Write Database]
    end
    
    subgraph &#34;Query Side (Read)&#34;
        E[Query API]
        F[Query Handlers]
        G[Read Model]
        H[Read Database]
    end
    
    subgraph &#34;Infrastructure&#34;
        I[Event Bus]
        J[Message Queue]
    end
    
    A --&gt; B
    B --&gt; C
    C --&gt; D
    C --&gt; I
    I --&gt; F
    F --&gt; G
    G --&gt; H
    E --&gt; F
</pre><h3 id=112-필수-구성요소>11.2 필수 구성요소<a hidden class=anchor aria-hidden=true href=#112-필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Command Handler</td><td>명령 처리</td><td>비즈니스 로직 실행</td><td>상태 변경, 검증</td></tr><tr><td>Query Handler</td><td>조회 처리</td><td>데이터 반환</td><td>상태 변경 없음</td></tr><tr><td>Write Model</td><td>쓰기 모델</td><td>도메인 로직 구현</td><td>정규화된 구조</td></tr><tr><td>Read Model</td><td>읽기 모델</td><td>조회 최적화</td><td>비정규화된 구조</td></tr><tr><td>Event Store</td><td>이벤트 저장</td><td>이벤트 영속화</td><td>순서 보장</td></tr></tbody></table><h3 id=113-선택-구성요소>11.3 선택 구성요소<a hidden class=anchor aria-hidden=true href=#113-선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Event Bus</td><td>이벤트 전달</td><td>비동기 통신</td><td>확장성 향상</td></tr><tr><td>Snapshot Store</td><td>스냅샷 저장</td><td>성능 최적화</td><td>빠른 상태 복원</td></tr><tr><td>Saga</td><td>장기 프로세스</td><td>트랜잭션 관리</td><td>보상 처리</td></tr><tr><td>Projector</td><td>프로젝션 생성</td><td>뷰 생성</td><td>데이터 변환</td></tr></tbody></table><h2 id=12-구현-기법>12. 구현 기법<a hidden class=anchor aria-hidden=true href=#12-구현-기법>#</a></h2><h3 id=121-단일-데이터베이스-cqrs>12.1 단일 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#121-단일-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 하나의 데이터베이스를 사용하되 읽기/쓰기 로직을 분리</p><p><strong>구성</strong>:</p><ul><li>공통 데이터베이스</li><li>별도의 명령/조회 핸들러</li><li>서로 다른 모델 인터페이스</li></ul><p><strong>목적</strong>: 복잡성 최소화하면서 CQRS 혜택 획득</p><p><strong>실제 예시</strong>:</p><pre class=mermaid>graph TD
    A[Client] --&gt; B[Command API]
    A --&gt; C[Query API]
    B --&gt; D[Command Handler]
    C --&gt; E[Query Handler]
    D --&gt; F[Shared Database]
    E --&gt; F
</pre><h3 id=122-분리된-데이터베이스-cqrs>12.2 분리된 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#122-분리된-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 읽기와 쓰기에 별도의 데이터베이스 사용</p><p><strong>구성</strong>:</p><ul><li>Write Database (정규화)</li><li>Read Database (비정규화)</li><li>동기화 메커니즘</li></ul><p><strong>목적</strong>: 각 작업에 최적화된 스토리지 활용</p><p><strong>실제 예시</strong>:</p><pre class=mermaid>graph TD
    A[Commands] --&gt; B[Write DB]
    B --&gt; C[Event Stream]
    C --&gt; D[Read DB]
    D --&gt; E[Queries]
</pre><h3 id=123-event-sourcing--cqrs>12.3 Event Sourcing + CQRS<a hidden class=anchor aria-hidden=true href=#123-event-sourcing--cqrs>#</a></h3><p><strong>정의</strong>: 모든 상태 변경을 이벤트로 저장하는 방식과 CQRS 결합</p><p><strong>구성</strong>:</p><ul><li>Event Store</li><li>Aggregate Root</li><li>Event Handlers</li><li>Projections</li></ul><p><strong>목적</strong>: 완전한 감사 추적과 상태 재구성 가능</p><p><strong>실제 예시</strong>:</p><pre class=mermaid>graph TB
    A[Command] --&gt; B[Aggregate]
    B --&gt; C[Events]
    C --&gt; D[Event Store]
    D --&gt; E[Projections]
    E --&gt; F[Read Models]
</pre><h2 id=13-장점>13. 장점<a hidden class=anchor aria-hidden=true href=#13-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 최적화</td><td>읽기와 쓰기 작업을 독립적으로 최적화하여 전체 시스템 성능 향상</td></tr><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 부하에 따라 각각 독립적으로 스케일링 가능</td></tr><tr><td>장점</td><td>개발 생산성</td><td>명령과 조회 로직 분리로 팀 간 병렬 개발 가능</td></tr><tr><td>장점</td><td>비즈니스 로직 명확성</td><td>도메인 중심의 명령 모델로 비즈니스 규칙이 명확해짐</td></tr><tr><td>장점</td><td>보안 강화</td><td>읽기와 쓰기 권한을 세밀하게 제어 가능</td></tr><tr><td>장점</td><td>기술 다양성</td><td>읽기와 쓰기에 서로 다른 기술 스택 사용 가능</td></tr></tbody></table><h2 id=14-단점과-문제점-그리고-해결방안>14. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#14-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=141-단점>14.1 단점<a hidden class=anchor aria-hidden=true href=#141-단점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>두 개의 분리된 모델 관리로 인한 시스템 복잡성</td><td>점진적 도입, 명확한 경계 설정</td></tr><tr><td>단점</td><td>최종 일관성</td><td>읽기와 쓰기 데이터 간 지연으로 인한 일관성 문제</td><td>사용자 기대치 관리, 보상 메커니즘</td></tr><tr><td>단점</td><td>인프라 비용</td><td>추가적인 데이터베이스와 메시징 인프라 필요</td><td>클라우드 서비스 활용, 비용 최적화</td></tr><tr><td>단점</td><td>학습 곡선</td><td>개발팀의 새로운 패러다임 학습 필요</td><td>교육 프로그램, 문서화</td></tr></tbody></table><h3 id=142-문제점>14.2 문제점<a hidden class=anchor aria-hidden=true href=#142-문제점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 동기화 지연</td><td>네트워크 지연, 처리 지연</td><td>사용자 혼란, 데이터 불일치</td><td>모니터링 대시보드</td><td>적절한 타임아웃 설정</td><td>재시도 메커니즘, 데드레터 큐</td></tr><tr><td>문제점</td><td>이벤트 순서 보장</td><td>분산 환경에서의 이벤트 처리</td><td>잘못된 상태 계산</td><td>이벤트 시퀀스 검증</td><td>파티셔닝 전략</td><td>이벤트 소싱, 버전 관리</td></tr><tr><td>문제점</td><td>메시지 중복 처리</td><td>네트워크 실패, 재시도</td><td>데이터 중복, 불일치</td><td>중복 감지 로직</td><td>멱등성 보장</td><td>멱등키, 중복 제거</td></tr></tbody></table><h2 id=15-도전-과제>15. 도전 과제<a hidden class=anchor aria-hidden=true href=#15-도전-과제>#</a></h2><h3 id=151-기술적-도전-과제>15.1 기술적 도전 과제<a hidden class=anchor aria-hidden=true href=#151-기술적-도전-과제>#</a></h3><p><strong>복잡성 관리</strong></p><ul><li>원인: 다중 모델과 비동기 처리</li><li>영향: 개발 및 운영 복잡성 증가</li><li>해결방안: 마이크로서비스 경계 명확화, 자동화된 테스트</li></ul><p><strong>최종 일관성 처리</strong></p><ul><li>원인: 분산 시스템의 본질적 특성</li><li>영향: 사용자 경험 저하 가능성</li><li>해결방안: 사용자 인터페이스 개선, 상태 표시</li></ul><h3 id=152-조직적-도전-과제>15.2 조직적 도전 과제<a hidden class=anchor aria-hidden=true href=#152-조직적-도전-과제>#</a></h3><p><strong>팀 협업</strong></p><ul><li>원인: 명령과 조회 팀 간 의존성</li><li>영향: 개발 속도 저하</li><li>해결방안: API 우선 설계, 계약 테스트</li></ul><p><strong>운영 모니터링</strong></p><ul><li>원인: 분산된 컴포넌트들</li><li>영향: 장애 진단 어려움</li><li>해결방안: 분산 추적, 통합 로깅</li></ul><h2 id=16-분류-기준에-따른-종류-및-유형>16. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td>데이터 저장소</td><td>단일 DB</td><td>하나의 데이터베이스 사용</td><td>단순한 도메인, 초기 구현</td></tr><tr><td>데이터 저장소</td><td>분리 DB</td><td>읽기/쓰기 별도 데이터베이스</td><td>높은 성능 요구사항</td></tr><tr><td>이벤트 처리</td><td>동기식</td><td>즉시 읽기 모델 업데이트</td><td>실시간 일관성 필요</td></tr><tr><td>이벤트 처리</td><td>비동기식</td><td>메시지 큐를 통한 처리</td><td>높은 처리량 필요</td></tr><tr><td>구현 방식</td><td>Event Sourcing</td><td>모든 변경을 이벤트로 저장</td><td>감사 추적, 이력 관리</td></tr><tr><td>구현 방식</td><td>State-based</td><td>현재 상태만 저장</td><td>일반적인 CRUD 개선</td></tr></tbody></table><h2 id=17-실무-사용-예시>17. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시>#</a></h2><table><thead><tr><th>도메인</th><th>목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td>E-commerce</td><td>주문 처리와 재고 조회 분리</td><td>Event Sourcing, Kafka</td><td>높은 처리량과 빠른 조회</td></tr><tr><td>금융 시스템</td><td>거래 처리와 잔액 조회 분리</td><td>RDBMS, Redis</td><td>정확성과 성능 모두 확보</td></tr><tr><td>소셜 미디어</td><td>포스팅과 피드 조회 분리</td><td>NoSQL, Elasticsearch</td><td>대용량 읽기 처리</td></tr><tr><td>IoT 플랫폼</td><td>센서 데이터 수집과 분석 분리</td><td>Time-series DB, Stream Processing</td><td>실시간 수집과 복잡한 분석</td></tr><tr><td>게임 플랫폼</td><td>게임 상태와 리더보드 분리</td><td>In-memory DB, Cache</td><td>빠른 응답 시간</td></tr></tbody></table><h2 id=18-활용-사례>18. 활용 사례<a hidden class=anchor aria-hidden=true href=#18-활용-사례>#</a></h2><h3 id=181-전자상거래-플랫폼-사례>18.1 전자상거래 플랫폼 사례<a hidden class=anchor aria-hidden=true href=#181-전자상거래-플랫폼-사례>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>명령 측</strong>: 주문 생성, 재고 업데이트, 결제 처리</li><li><strong>조회 측</strong>: 상품 검색, 주문 이력, 재고 현황</li></ul><p><strong>시스템 구성도</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;사용자 인터페이스&#34;
        A[웹 애플리케이션]
        B[모바일 앱]
    end
    
    subgraph &#34;명령 측 (Order Service)&#34;
        C[Order API]
        D[Order Handler]
        E[Order DB]
    end
    
    subgraph &#34;조회 측 (Catalog Service)&#34;
        F[Catalog API]
        G[Search Handler]
        H[Read DB]
    end
    
    subgraph &#34;인프라&#34;
        I[Event Bus]
        J[Cache Layer]
    end
    
    A --&gt; C
    B --&gt; C
    A --&gt; F
    B --&gt; F
    C --&gt; D
    D --&gt; E
    D --&gt; I
    I --&gt; G
    G --&gt; H
    G --&gt; J
    F --&gt; G
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 주문 생성 요청</li><li>Order Handler가 비즈니스 로직 검증</li><li>Order DB에 주문 정보 저장</li><li>OrderCreated 이벤트 발행</li><li>Catalog Service가 이벤트 수신</li><li>Read DB 업데이트 (재고 감소)</li><li>캐시 갱신</li></ol><p><strong>CQRS 역할</strong>:</p><ul><li><strong>명령 측</strong>: 복잡한 주문 로직과 재고 관리</li><li><strong>조회 측</strong>: 빠른 상품 검색과 추천</li></ul><p><strong>CQRS 유무에 따른 차이점</strong>:</p><p><strong>CQRS 적용 전</strong>:</p><ul><li>단일 데이터베이스에서 모든 작업 처리</li><li>복잡한 조인 쿼리로 성능 저하</li><li>읽기/쓰기 경합으로 인한 대기 시간 증가</li></ul><p><strong>CQRS 적용 후</strong>:</p><ul><li>읽기 최적화된 별도 데이터베이스</li><li>검색 성능 10배 향상</li><li>주문 처리와 독립적인 카탈로그 조회</li></ul><h2 id=19-구현-예시>19. 구현 예시<a hidden class=anchor aria-hidden=true href=#19-구현-예시>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-75-1><a class=lnlinks href=#hl-75-1>  1</a>
</span><span class=lnt id=hl-75-2><a class=lnlinks href=#hl-75-2>  2</a>
</span><span class=lnt id=hl-75-3><a class=lnlinks href=#hl-75-3>  3</a>
</span><span class=lnt id=hl-75-4><a class=lnlinks href=#hl-75-4>  4</a>
</span><span class=lnt id=hl-75-5><a class=lnlinks href=#hl-75-5>  5</a>
</span><span class=lnt id=hl-75-6><a class=lnlinks href=#hl-75-6>  6</a>
</span><span class=lnt id=hl-75-7><a class=lnlinks href=#hl-75-7>  7</a>
</span><span class=lnt id=hl-75-8><a class=lnlinks href=#hl-75-8>  8</a>
</span><span class=lnt id=hl-75-9><a class=lnlinks href=#hl-75-9>  9</a>
</span><span class=lnt id=hl-75-10><a class=lnlinks href=#hl-75-10> 10</a>
</span><span class=lnt id=hl-75-11><a class=lnlinks href=#hl-75-11> 11</a>
</span><span class=lnt id=hl-75-12><a class=lnlinks href=#hl-75-12> 12</a>
</span><span class=lnt id=hl-75-13><a class=lnlinks href=#hl-75-13> 13</a>
</span><span class=lnt id=hl-75-14><a class=lnlinks href=#hl-75-14> 14</a>
</span><span class=lnt id=hl-75-15><a class=lnlinks href=#hl-75-15> 15</a>
</span><span class=lnt id=hl-75-16><a class=lnlinks href=#hl-75-16> 16</a>
</span><span class=lnt id=hl-75-17><a class=lnlinks href=#hl-75-17> 17</a>
</span><span class=lnt id=hl-75-18><a class=lnlinks href=#hl-75-18> 18</a>
</span><span class=lnt id=hl-75-19><a class=lnlinks href=#hl-75-19> 19</a>
</span><span class=lnt id=hl-75-20><a class=lnlinks href=#hl-75-20> 20</a>
</span><span class=lnt id=hl-75-21><a class=lnlinks href=#hl-75-21> 21</a>
</span><span class=lnt id=hl-75-22><a class=lnlinks href=#hl-75-22> 22</a>
</span><span class=lnt id=hl-75-23><a class=lnlinks href=#hl-75-23> 23</a>
</span><span class=lnt id=hl-75-24><a class=lnlinks href=#hl-75-24> 24</a>
</span><span class=lnt id=hl-75-25><a class=lnlinks href=#hl-75-25> 25</a>
</span><span class=lnt id=hl-75-26><a class=lnlinks href=#hl-75-26> 26</a>
</span><span class=lnt id=hl-75-27><a class=lnlinks href=#hl-75-27> 27</a>
</span><span class=lnt id=hl-75-28><a class=lnlinks href=#hl-75-28> 28</a>
</span><span class=lnt id=hl-75-29><a class=lnlinks href=#hl-75-29> 29</a>
</span><span class=lnt id=hl-75-30><a class=lnlinks href=#hl-75-30> 30</a>
</span><span class=lnt id=hl-75-31><a class=lnlinks href=#hl-75-31> 31</a>
</span><span class=lnt id=hl-75-32><a class=lnlinks href=#hl-75-32> 32</a>
</span><span class=lnt id=hl-75-33><a class=lnlinks href=#hl-75-33> 33</a>
</span><span class=lnt id=hl-75-34><a class=lnlinks href=#hl-75-34> 34</a>
</span><span class=lnt id=hl-75-35><a class=lnlinks href=#hl-75-35> 35</a>
</span><span class=lnt id=hl-75-36><a class=lnlinks href=#hl-75-36> 36</a>
</span><span class=lnt id=hl-75-37><a class=lnlinks href=#hl-75-37> 37</a>
</span><span class=lnt id=hl-75-38><a class=lnlinks href=#hl-75-38> 38</a>
</span><span class=lnt id=hl-75-39><a class=lnlinks href=#hl-75-39> 39</a>
</span><span class=lnt id=hl-75-40><a class=lnlinks href=#hl-75-40> 40</a>
</span><span class=lnt id=hl-75-41><a class=lnlinks href=#hl-75-41> 41</a>
</span><span class=lnt id=hl-75-42><a class=lnlinks href=#hl-75-42> 42</a>
</span><span class=lnt id=hl-75-43><a class=lnlinks href=#hl-75-43> 43</a>
</span><span class=lnt id=hl-75-44><a class=lnlinks href=#hl-75-44> 44</a>
</span><span class=lnt id=hl-75-45><a class=lnlinks href=#hl-75-45> 45</a>
</span><span class=lnt id=hl-75-46><a class=lnlinks href=#hl-75-46> 46</a>
</span><span class=lnt id=hl-75-47><a class=lnlinks href=#hl-75-47> 47</a>
</span><span class=lnt id=hl-75-48><a class=lnlinks href=#hl-75-48> 48</a>
</span><span class=lnt id=hl-75-49><a class=lnlinks href=#hl-75-49> 49</a>
</span><span class=lnt id=hl-75-50><a class=lnlinks href=#hl-75-50> 50</a>
</span><span class=lnt id=hl-75-51><a class=lnlinks href=#hl-75-51> 51</a>
</span><span class=lnt id=hl-75-52><a class=lnlinks href=#hl-75-52> 52</a>
</span><span class=lnt id=hl-75-53><a class=lnlinks href=#hl-75-53> 53</a>
</span><span class=lnt id=hl-75-54><a class=lnlinks href=#hl-75-54> 54</a>
</span><span class=lnt id=hl-75-55><a class=lnlinks href=#hl-75-55> 55</a>
</span><span class=lnt id=hl-75-56><a class=lnlinks href=#hl-75-56> 56</a>
</span><span class=lnt id=hl-75-57><a class=lnlinks href=#hl-75-57> 57</a>
</span><span class=lnt id=hl-75-58><a class=lnlinks href=#hl-75-58> 58</a>
</span><span class=lnt id=hl-75-59><a class=lnlinks href=#hl-75-59> 59</a>
</span><span class=lnt id=hl-75-60><a class=lnlinks href=#hl-75-60> 60</a>
</span><span class=lnt id=hl-75-61><a class=lnlinks href=#hl-75-61> 61</a>
</span><span class=lnt id=hl-75-62><a class=lnlinks href=#hl-75-62> 62</a>
</span><span class=lnt id=hl-75-63><a class=lnlinks href=#hl-75-63> 63</a>
</span><span class=lnt id=hl-75-64><a class=lnlinks href=#hl-75-64> 64</a>
</span><span class=lnt id=hl-75-65><a class=lnlinks href=#hl-75-65> 65</a>
</span><span class=lnt id=hl-75-66><a class=lnlinks href=#hl-75-66> 66</a>
</span><span class=lnt id=hl-75-67><a class=lnlinks href=#hl-75-67> 67</a>
</span><span class=lnt id=hl-75-68><a class=lnlinks href=#hl-75-68> 68</a>
</span><span class=lnt id=hl-75-69><a class=lnlinks href=#hl-75-69> 69</a>
</span><span class=lnt id=hl-75-70><a class=lnlinks href=#hl-75-70> 70</a>
</span><span class=lnt id=hl-75-71><a class=lnlinks href=#hl-75-71> 71</a>
</span><span class=lnt id=hl-75-72><a class=lnlinks href=#hl-75-72> 72</a>
</span><span class=lnt id=hl-75-73><a class=lnlinks href=#hl-75-73> 73</a>
</span><span class=lnt id=hl-75-74><a class=lnlinks href=#hl-75-74> 74</a>
</span><span class=lnt id=hl-75-75><a class=lnlinks href=#hl-75-75> 75</a>
</span><span class=lnt id=hl-75-76><a class=lnlinks href=#hl-75-76> 76</a>
</span><span class=lnt id=hl-75-77><a class=lnlinks href=#hl-75-77> 77</a>
</span><span class=lnt id=hl-75-78><a class=lnlinks href=#hl-75-78> 78</a>
</span><span class=lnt id=hl-75-79><a class=lnlinks href=#hl-75-79> 79</a>
</span><span class=lnt id=hl-75-80><a class=lnlinks href=#hl-75-80> 80</a>
</span><span class=lnt id=hl-75-81><a class=lnlinks href=#hl-75-81> 81</a>
</span><span class=lnt id=hl-75-82><a class=lnlinks href=#hl-75-82> 82</a>
</span><span class=lnt id=hl-75-83><a class=lnlinks href=#hl-75-83> 83</a>
</span><span class=lnt id=hl-75-84><a class=lnlinks href=#hl-75-84> 84</a>
</span><span class=lnt id=hl-75-85><a class=lnlinks href=#hl-75-85> 85</a>
</span><span class=lnt id=hl-75-86><a class=lnlinks href=#hl-75-86> 86</a>
</span><span class=lnt id=hl-75-87><a class=lnlinks href=#hl-75-87> 87</a>
</span><span class=lnt id=hl-75-88><a class=lnlinks href=#hl-75-88> 88</a>
</span><span class=lnt id=hl-75-89><a class=lnlinks href=#hl-75-89> 89</a>
</span><span class=lnt id=hl-75-90><a class=lnlinks href=#hl-75-90> 90</a>
</span><span class=lnt id=hl-75-91><a class=lnlinks href=#hl-75-91> 91</a>
</span><span class=lnt id=hl-75-92><a class=lnlinks href=#hl-75-92> 92</a>
</span><span class=lnt id=hl-75-93><a class=lnlinks href=#hl-75-93> 93</a>
</span><span class=lnt id=hl-75-94><a class=lnlinks href=#hl-75-94> 94</a>
</span><span class=lnt id=hl-75-95><a class=lnlinks href=#hl-75-95> 95</a>
</span><span class=lnt id=hl-75-96><a class=lnlinks href=#hl-75-96> 96</a>
</span><span class=lnt id=hl-75-97><a class=lnlinks href=#hl-75-97> 97</a>
</span><span class=lnt id=hl-75-98><a class=lnlinks href=#hl-75-98> 98</a>
</span><span class=lnt id=hl-75-99><a class=lnlinks href=#hl-75-99> 99</a>
</span><span class=lnt id=hl-75-100><a class=lnlinks href=#hl-75-100>100</a>
</span><span class=lnt id=hl-75-101><a class=lnlinks href=#hl-75-101>101</a>
</span><span class=lnt id=hl-75-102><a class=lnlinks href=#hl-75-102>102</a>
</span><span class=lnt id=hl-75-103><a class=lnlinks href=#hl-75-103>103</a>
</span><span class=lnt id=hl-75-104><a class=lnlinks href=#hl-75-104>104</a>
</span><span class=lnt id=hl-75-105><a class=lnlinks href=#hl-75-105>105</a>
</span><span class=lnt id=hl-75-106><a class=lnlinks href=#hl-75-106>106</a>
</span><span class=lnt id=hl-75-107><a class=lnlinks href=#hl-75-107>107</a>
</span><span class=lnt id=hl-75-108><a class=lnlinks href=#hl-75-108>108</a>
</span><span class=lnt id=hl-75-109><a class=lnlinks href=#hl-75-109>109</a>
</span><span class=lnt id=hl-75-110><a class=lnlinks href=#hl-75-110>110</a>
</span><span class=lnt id=hl-75-111><a class=lnlinks href=#hl-75-111>111</a>
</span><span class=lnt id=hl-75-112><a class=lnlinks href=#hl-75-112>112</a>
</span><span class=lnt id=hl-75-113><a class=lnlinks href=#hl-75-113>113</a>
</span><span class=lnt id=hl-75-114><a class=lnlinks href=#hl-75-114>114</a>
</span><span class=lnt id=hl-75-115><a class=lnlinks href=#hl-75-115>115</a>
</span><span class=lnt id=hl-75-116><a class=lnlinks href=#hl-75-116>116</a>
</span><span class=lnt id=hl-75-117><a class=lnlinks href=#hl-75-117>117</a>
</span><span class=lnt id=hl-75-118><a class=lnlinks href=#hl-75-118>118</a>
</span><span class=lnt id=hl-75-119><a class=lnlinks href=#hl-75-119>119</a>
</span><span class=lnt id=hl-75-120><a class=lnlinks href=#hl-75-120>120</a>
</span><span class=lnt id=hl-75-121><a class=lnlinks href=#hl-75-121>121</a>
</span><span class=lnt id=hl-75-122><a class=lnlinks href=#hl-75-122>122</a>
</span><span class=lnt id=hl-75-123><a class=lnlinks href=#hl-75-123>123</a>
</span><span class=lnt id=hl-75-124><a class=lnlinks href=#hl-75-124>124</a>
</span><span class=lnt id=hl-75-125><a class=lnlinks href=#hl-75-125>125</a>
</span><span class=lnt id=hl-75-126><a class=lnlinks href=#hl-75-126>126</a>
</span><span class=lnt id=hl-75-127><a class=lnlinks href=#hl-75-127>127</a>
</span><span class=lnt id=hl-75-128><a class=lnlinks href=#hl-75-128>128</a>
</span><span class=lnt id=hl-75-129><a class=lnlinks href=#hl-75-129>129</a>
</span><span class=lnt id=hl-75-130><a class=lnlinks href=#hl-75-130>130</a>
</span><span class=lnt id=hl-75-131><a class=lnlinks href=#hl-75-131>131</a>
</span><span class=lnt id=hl-75-132><a class=lnlinks href=#hl-75-132>132</a>
</span><span class=lnt id=hl-75-133><a class=lnlinks href=#hl-75-133>133</a>
</span><span class=lnt id=hl-75-134><a class=lnlinks href=#hl-75-134>134</a>
</span><span class=lnt id=hl-75-135><a class=lnlinks href=#hl-75-135>135</a>
</span><span class=lnt id=hl-75-136><a class=lnlinks href=#hl-75-136>136</a>
</span><span class=lnt id=hl-75-137><a class=lnlinks href=#hl-75-137>137</a>
</span><span class=lnt id=hl-75-138><a class=lnlinks href=#hl-75-138>138</a>
</span><span class=lnt id=hl-75-139><a class=lnlinks href=#hl-75-139>139</a>
</span><span class=lnt id=hl-75-140><a class=lnlinks href=#hl-75-140>140</a>
</span><span class=lnt id=hl-75-141><a class=lnlinks href=#hl-75-141>141</a>
</span><span class=lnt id=hl-75-142><a class=lnlinks href=#hl-75-142>142</a>
</span><span class=lnt id=hl-75-143><a class=lnlinks href=#hl-75-143>143</a>
</span><span class=lnt id=hl-75-144><a class=lnlinks href=#hl-75-144>144</a>
</span><span class=lnt id=hl-75-145><a class=lnlinks href=#hl-75-145>145</a>
</span><span class=lnt id=hl-75-146><a class=lnlinks href=#hl-75-146>146</a>
</span><span class=lnt id=hl-75-147><a class=lnlinks href=#hl-75-147>147</a>
</span><span class=lnt id=hl-75-148><a class=lnlinks href=#hl-75-148>148</a>
</span><span class=lnt id=hl-75-149><a class=lnlinks href=#hl-75-149>149</a>
</span><span class=lnt id=hl-75-150><a class=lnlinks href=#hl-75-150>150</a>
</span><span class=lnt id=hl-75-151><a class=lnlinks href=#hl-75-151>151</a>
</span><span class=lnt id=hl-75-152><a class=lnlinks href=#hl-75-152>152</a>
</span><span class=lnt id=hl-75-153><a class=lnlinks href=#hl-75-153>153</a>
</span><span class=lnt id=hl-75-154><a class=lnlinks href=#hl-75-154>154</a>
</span><span class=lnt id=hl-75-155><a class=lnlinks href=#hl-75-155>155</a>
</span><span class=lnt id=hl-75-156><a class=lnlinks href=#hl-75-156>156</a>
</span><span class=lnt id=hl-75-157><a class=lnlinks href=#hl-75-157>157</a>
</span><span class=lnt id=hl-75-158><a class=lnlinks href=#hl-75-158>158</a>
</span><span class=lnt id=hl-75-159><a class=lnlinks href=#hl-75-159>159</a>
</span><span class=lnt id=hl-75-160><a class=lnlinks href=#hl-75-160>160</a>
</span><span class=lnt id=hl-75-161><a class=lnlinks href=#hl-75-161>161</a>
</span><span class=lnt id=hl-75-162><a class=lnlinks href=#hl-75-162>162</a>
</span><span class=lnt id=hl-75-163><a class=lnlinks href=#hl-75-163>163</a>
</span><span class=lnt id=hl-75-164><a class=lnlinks href=#hl-75-164>164</a>
</span><span class=lnt id=hl-75-165><a class=lnlinks href=#hl-75-165>165</a>
</span><span class=lnt id=hl-75-166><a class=lnlinks href=#hl-75-166>166</a>
</span><span class=lnt id=hl-75-167><a class=lnlinks href=#hl-75-167>167</a>
</span><span class=lnt id=hl-75-168><a class=lnlinks href=#hl-75-168>168</a>
</span><span class=lnt id=hl-75-169><a class=lnlinks href=#hl-75-169>169</a>
</span><span class=lnt id=hl-75-170><a class=lnlinks href=#hl-75-170>170</a>
</span><span class=lnt id=hl-75-171><a class=lnlinks href=#hl-75-171>171</a>
</span><span class=lnt id=hl-75-172><a class=lnlinks href=#hl-75-172>172</a>
</span><span class=lnt id=hl-75-173><a class=lnlinks href=#hl-75-173>173</a>
</span><span class=lnt id=hl-75-174><a class=lnlinks href=#hl-75-174>174</a>
</span><span class=lnt id=hl-75-175><a class=lnlinks href=#hl-75-175>175</a>
</span><span class=lnt id=hl-75-176><a class=lnlinks href=#hl-75-176>176</a>
</span><span class=lnt id=hl-75-177><a class=lnlinks href=#hl-75-177>177</a>
</span><span class=lnt id=hl-75-178><a class=lnlinks href=#hl-75-178>178</a>
</span><span class=lnt id=hl-75-179><a class=lnlinks href=#hl-75-179>179</a>
</span><span class=lnt id=hl-75-180><a class=lnlinks href=#hl-75-180>180</a>
</span><span class=lnt id=hl-75-181><a class=lnlinks href=#hl-75-181>181</a>
</span><span class=lnt id=hl-75-182><a class=lnlinks href=#hl-75-182>182</a>
</span><span class=lnt id=hl-75-183><a class=lnlinks href=#hl-75-183>183</a>
</span><span class=lnt id=hl-75-184><a class=lnlinks href=#hl-75-184>184</a>
</span><span class=lnt id=hl-75-185><a class=lnlinks href=#hl-75-185>185</a>
</span><span class=lnt id=hl-75-186><a class=lnlinks href=#hl-75-186>186</a>
</span><span class=lnt id=hl-75-187><a class=lnlinks href=#hl-75-187>187</a>
</span><span class=lnt id=hl-75-188><a class=lnlinks href=#hl-75-188>188</a>
</span><span class=lnt id=hl-75-189><a class=lnlinks href=#hl-75-189>189</a>
</span><span class=lnt id=hl-75-190><a class=lnlinks href=#hl-75-190>190</a>
</span><span class=lnt id=hl-75-191><a class=lnlinks href=#hl-75-191>191</a>
</span><span class=lnt id=hl-75-192><a class=lnlinks href=#hl-75-192>192</a>
</span><span class=lnt id=hl-75-193><a class=lnlinks href=#hl-75-193>193</a>
</span><span class=lnt id=hl-75-194><a class=lnlinks href=#hl-75-194>194</a>
</span><span class=lnt id=hl-75-195><a class=lnlinks href=#hl-75-195>195</a>
</span><span class=lnt id=hl-75-196><a class=lnlinks href=#hl-75-196>196</a>
</span><span class=lnt id=hl-75-197><a class=lnlinks href=#hl-75-197>197</a>
</span><span class=lnt id=hl-75-198><a class=lnlinks href=#hl-75-198>198</a>
</span><span class=lnt id=hl-75-199><a class=lnlinks href=#hl-75-199>199</a>
</span><span class=lnt id=hl-75-200><a class=lnlinks href=#hl-75-200>200</a>
</span><span class=lnt id=hl-75-201><a class=lnlinks href=#hl-75-201>201</a>
</span><span class=lnt id=hl-75-202><a class=lnlinks href=#hl-75-202>202</a>
</span><span class=lnt id=hl-75-203><a class=lnlinks href=#hl-75-203>203</a>
</span><span class=lnt id=hl-75-204><a class=lnlinks href=#hl-75-204>204</a>
</span><span class=lnt id=hl-75-205><a class=lnlinks href=#hl-75-205>205</a>
</span><span class=lnt id=hl-75-206><a class=lnlinks href=#hl-75-206>206</a>
</span><span class=lnt id=hl-75-207><a class=lnlinks href=#hl-75-207>207</a>
</span><span class=lnt id=hl-75-208><a class=lnlinks href=#hl-75-208>208</a>
</span><span class=lnt id=hl-75-209><a class=lnlinks href=#hl-75-209>209</a>
</span><span class=lnt id=hl-75-210><a class=lnlinks href=#hl-75-210>210</a>
</span><span class=lnt id=hl-75-211><a class=lnlinks href=#hl-75-211>211</a>
</span><span class=lnt id=hl-75-212><a class=lnlinks href=#hl-75-212>212</a>
</span><span class=lnt id=hl-75-213><a class=lnlinks href=#hl-75-213>213</a>
</span><span class=lnt id=hl-75-214><a class=lnlinks href=#hl-75-214>214</a>
</span><span class=lnt id=hl-75-215><a class=lnlinks href=#hl-75-215>215</a>
</span><span class=lnt id=hl-75-216><a class=lnlinks href=#hl-75-216>216</a>
</span><span class=lnt id=hl-75-217><a class=lnlinks href=#hl-75-217>217</a>
</span><span class=lnt id=hl-75-218><a class=lnlinks href=#hl-75-218>218</a>
</span><span class=lnt id=hl-75-219><a class=lnlinks href=#hl-75-219>219</a>
</span><span class=lnt id=hl-75-220><a class=lnlinks href=#hl-75-220>220</a>
</span><span class=lnt id=hl-75-221><a class=lnlinks href=#hl-75-221>221</a>
</span><span class=lnt id=hl-75-222><a class=lnlinks href=#hl-75-222>222</a>
</span><span class=lnt id=hl-75-223><a class=lnlinks href=#hl-75-223>223</a>
</span><span class=lnt id=hl-75-224><a class=lnlinks href=#hl-75-224>224</a>
</span><span class=lnt id=hl-75-225><a class=lnlinks href=#hl-75-225>225</a>
</span><span class=lnt id=hl-75-226><a class=lnlinks href=#hl-75-226>226</a>
</span><span class=lnt id=hl-75-227><a class=lnlinks href=#hl-75-227>227</a>
</span><span class=lnt id=hl-75-228><a class=lnlinks href=#hl-75-228>228</a>
</span><span class=lnt id=hl-75-229><a class=lnlinks href=#hl-75-229>229</a>
</span><span class=lnt id=hl-75-230><a class=lnlinks href=#hl-75-230>230</a>
</span><span class=lnt id=hl-75-231><a class=lnlinks href=#hl-75-231>231</a>
</span><span class=lnt id=hl-75-232><a class=lnlinks href=#hl-75-232>232</a>
</span><span class=lnt id=hl-75-233><a class=lnlinks href=#hl-75-233>233</a>
</span><span class=lnt id=hl-75-234><a class=lnlinks href=#hl-75-234>234</a>
</span><span class=lnt id=hl-75-235><a class=lnlinks href=#hl-75-235>235</a>
</span><span class=lnt id=hl-75-236><a class=lnlinks href=#hl-75-236>236</a>
</span><span class=lnt id=hl-75-237><a class=lnlinks href=#hl-75-237>237</a>
</span><span class=lnt id=hl-75-238><a class=lnlinks href=#hl-75-238>238</a>
</span><span class=lnt id=hl-75-239><a class=lnlinks href=#hl-75-239>239</a>
</span><span class=lnt id=hl-75-240><a class=lnlinks href=#hl-75-240>240</a>
</span><span class=lnt id=hl-75-241><a class=lnlinks href=#hl-75-241>241</a>
</span><span class=lnt id=hl-75-242><a class=lnlinks href=#hl-75-242>242</a>
</span><span class=lnt id=hl-75-243><a class=lnlinks href=#hl-75-243>243</a>
</span><span class=lnt id=hl-75-244><a class=lnlinks href=#hl-75-244>244</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># CQRS 패턴을 활용한 전자상거래 주문 시스템</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 도메인 이벤트</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DomainEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 명령 (Commands)</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreateOrderCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UpdateInventoryCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 쿼리 (Queries)</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrderHistoryQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SearchProductsQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 스토어</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>callable</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>subscriber</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>subscriber</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>e</span> <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>==</span> <span class=n>aggregate_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애그리게이트 루트</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;PENDING&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=s2>&#34;PENDING&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order already created&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>customer_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;CREATED&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>DomainEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event_id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;total_amount&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>version</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_uncommitted_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mark_events_as_committed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 명령 핸들러</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Order</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>save_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>mark_events_as_committed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 읽기 모델</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderView</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProductView</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>category</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>inventory</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 조회 핸들러</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_views</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderView</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_get_order_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>GetOrderHistoryQuery</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderView</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>order</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_views</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>order</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>==</span> <span class=n>query</span><span class=o>.</span><span class=n>customer_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_order_view</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order_view</span> <span class=o>=</span> <span class=n>OrderView</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nb>id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>customer_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;customer_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>items</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>total_amount</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;total_amount&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span><span class=o>=</span><span class=s2>&#34;CREATED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>created_at</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>order_views</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>order_view</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProductQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ProductView</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=c1># 초기 상품 데이터</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>ProductView</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;노트북&#34;</span><span class=p>,</span> <span class=mi>1500000</span><span class=p>,</span> <span class=s2>&#34;전자제품&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=s2>&#34;고성능 노트북&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>ProductView</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=s2>&#34;마우스&#34;</span><span class=p>,</span> <span class=mi>50000</span><span class=p>,</span> <span class=s2>&#34;전자제품&#34;</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=s2>&#34;무선 마우스&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_search_products</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>SearchProductsQuery</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>ProductView</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>query</span><span class=o>.</span><span class=n>keyword</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>results</span> <span class=k>if</span> <span class=n>query</span><span class=o>.</span><span class=n>keyword</span> <span class=ow>in</span> <span class=n>p</span><span class=o>.</span><span class=n>name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>query</span><span class=o>.</span><span class=n>category</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>results</span> <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>category</span> <span class=o>==</span> <span class=n>query</span><span class=o>.</span><span class=n>category</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>product_id</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>quantity</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>product</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>product</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>product_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>product</span><span class=o>.</span><span class=n>inventory</span> <span class=o>-=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CQRS 시스템 조합</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CQRSSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_query_handler</span> <span class=o>=</span> <span class=n>ProductQueryHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 구독 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_query_handler</span><span class=o>.</span><span class=n>update_order_view</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>product_query_handler</span><span class=o>.</span><span class=n>update_inventory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>execute_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_command_handler</span><span class=o>.</span><span class=n>handle_create_order</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>execute_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>GetOrderHistoryQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_query_handler</span><span class=o>.</span><span class=n>handle_get_order_history</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>SearchProductsQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_query_handler</span><span class=o>.</span><span class=n>handle_search_products</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>cqrs_system</span> <span class=o>=</span> <span class=n>CQRSSystem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 명령 실행: 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>create_order_cmd</span> <span class=o>=</span> <span class=n>CreateOrderCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=s2>&#34;customer_123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;노트북&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>1500000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;마우스&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>50000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cqrs_system</span><span class=o>.</span><span class=n>execute_command</span><span class=p>(</span><span class=n>create_order_cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 생성됨: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 조회 실행: 주문 이력 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>order_history_query</span> <span class=o>=</span> <span class=n>GetOrderHistoryQuery</span><span class=p>(</span><span class=n>customer_id</span><span class=o>=</span><span class=s2>&#34;customer_123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_history</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cqrs_system</span><span class=o>.</span><span class=n>execute_query</span><span class=p>(</span><span class=n>order_history_query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 이력: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>order_history</span><span class=p>)</span><span class=si>}</span><span class=s2>건&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=n>order_history</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  - 주문 ID: </span><span class=si>{</span><span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>, 총액: </span><span class=si>{</span><span class=n>order</span><span class=o>.</span><span class=n>total_amount</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 조회 실행: 상품 검색</span>
</span></span><span class=line><span class=cl>    <span class=n>product_search_query</span> <span class=o>=</span> <span class=n>SearchProductsQuery</span><span class=p>(</span><span class=n>keyword</span><span class=o>=</span><span class=s2>&#34;노트북&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>products</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cqrs_system</span><span class=o>.</span><span class=n>execute_query</span><span class=p>(</span><span class=n>product_search_query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;상품 검색 결과: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>products</span><span class=p>)</span><span class=si>}</span><span class=s2>건&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>product</span> <span class=ow>in</span> <span class=n>products</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  - </span><span class=si>{</span><span class=n>product</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>product</span><span class=o>.</span><span class=n>inventory</span><span class=si>}</span><span class=s2>개 남음&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>20. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>영역</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>충분히 복잡한 도메인에서만 적용</td><td>단순한 CRUD에는 과도한 복잡성</td><td>도메인 복잡성 평가 후 결정</td></tr><tr><td>팀 역량</td><td>이벤트 기반 아키텍처 이해 필요</td><td>학습 곡선으로 인한 초기 생산성 저하</td><td>점진적 도입과 교육 병행</td></tr><tr><td>인프라 준비</td><td>메시징, 모니터링 인프라 필요</td><td>운영 복잡성 증가</td><td>클라우드 관리형 서비스 활용</td></tr><tr><td>경계 설정</td><td>명확한 바운디드 컨텍스트 정의</td><td>불명확한 경계로 인한 복잡성</td><td>DDD 원칙에 따른 설계</td></tr><tr><td>테스트 전략</td><td>비동기 처리에 대한 테스트</td><td>테스트 복잡성 증가</td><td>계약 테스트와 통합 테스트</td></tr></tbody></table><h2 id=21-최적화하기-위한-고려사항-및-주의할-점>21. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#21-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>영역</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td>성능 최적화</td><td>읽기 모델 캐싱 전략</td><td>캐시 무효화 복잡성</td><td>Redis, CDN 활용</td></tr><tr><td>동기화 최적화</td><td>이벤트 처리 배치화</td><td>메모리 사용량 증가</td><td>적절한 배치 크기 설정</td></tr><tr><td>저장소 최적화</td><td>읽기/쓰기에 적합한 DB 선택</td><td>다중 DB 관리 복잡성</td><td>폴리글랏 퍼시스턴스 적용</td></tr><tr><td>스케일링</td><td>독립적인 수평 확장</td><td>데이터 분산으로 인한 복잡성</td><td>파티셔닝 전략 수립</td></tr><tr><td>모니터링</td><td>분산 시스템 추적</td><td>장애 지점 파악 어려움</td><td>APM 도구 도입</td></tr></tbody></table><hr><h2 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>DDD</td><td>Aggregate Pattern</td><td>CQRS와 함께 사용되는 도메인 모델 패턴</td></tr><tr><td>설계 패턴</td><td>Event Sourcing</td><td>Event Store</td><td>모든 상태 변경을 이벤트로 저장하는 방식</td></tr><tr><td>아키텍처</td><td>Microservices</td><td>Service Mesh</td><td>CQRS 구현에 필요한 서비스 간 통신</td></tr><tr><td>기술 스택</td><td>Message Queue</td><td>Apache Kafka</td><td>이벤트 스트리밍 플랫폼</td></tr><tr><td>기술 스택</td><td>Database</td><td>Polyglot Persistence</td><td>읽기/쓰기에 다른 DB 사용</td></tr><tr><td>운영</td><td>Monitoring</td><td>Distributed Tracing</td><td>분산 시스템 추적 및 모니터링</td></tr></tbody></table><h2 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>이론 기초</td><td>CQS</td><td>Command Query Separation</td><td>CQRS의 기반이 되는 기본 원칙</td></tr><tr><td>설계 원칙</td><td>DDD</td><td>Domain Driven Design</td><td>복잡한 도메인 모델링 방법론</td></tr><tr><td>아키텍처 패턴</td><td>Event Sourcing</td><td>이벤트 기반 상태 관리</td><td>CQRS와 자주 결합되는 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Saga Pattern</td><td>분산 트랜잭션 관리</td><td>마이크로서비스에서의 일관성 보장</td></tr><tr><td>기술 구현</td><td>Event Bus</td><td>비동기 메시징</td><td>이벤트 기반 통신 메커니즘</td></tr><tr><td>운영 관리</td><td>Eventually Consistency</td><td>최종 일관성</td><td>분산 시스템의 일관성 모델</td></tr></tbody></table><hr><h2 id=용어-정리-4>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-4>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>Command</td><td>시스템의 상태를 변경하는 요청이나 작업</td></tr><tr><td>기본 개념</td><td>Query</td><td>시스템의 상태를 조회하는 요청이나 작업</td></tr><tr><td>기본 개념</td><td>Aggregate</td><td>DDD에서 일관성 경계를 나타내는 도메인 객체 집합</td></tr><tr><td>기본 개념</td><td>Projection</td><td>이벤트 스트림에서 읽기 모델을 생성하는 과정</td></tr><tr><td>기본 개념</td><td>Event Store</td><td>도메인 이벤트를 시간순으로 저장하는 저장소</td></tr><tr><td>기본 개념</td><td>Saga</td><td>분산 시스템에서 장기 실행 비즈니스 프로세스</td></tr><tr><td>기술 구현</td><td>Event Bus</td><td>이벤트의 발행과 구독을 관리하는 메시징 시스템</td></tr><tr><td>기술 구현</td><td>Denormalizer</td><td>정규화된 데이터를 읽기에 최적화된 형태로 변환</td></tr><tr><td>기술 구현</td><td>Snapshot</td><td>특정 시점의 애그리게이트 상태를 저장한 것</td></tr><tr><td>기술 구현</td><td>Polyglot Persistence</td><td>서로 다른 종류의 데이터베이스를 적절히 조합하여 사용</td></tr></tbody></table><hr><h2 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>Microsoft Azure - CQRS Pattern</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>AWS Prescriptive Guidance - CQRS Pattern</a></li><li><a href=https://www.martinfowler.com/bliki/CQRS.html>Martin Fowler - CQRS</a></li><li><a href=https://www.confluent.io/learn/cqrs/>Confluent - CQRS 학습 가이드</a></li><li><a href=https://www.geeksforgeeks.org/cqrs-command-query-responsibility-segregation/>GeeksforGeeks - CQRS 디자인 패턴</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>Kurrent - CQRS 패턴 가이드</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>TechTarget - CQRS 정의</a></li><li><a href=https://microservices.io/patterns/data/cqrs.html>Microservices.io - CQRS 패턴</a></li><li><a href=https://www.redhat.com/architect/pros-and-cons-cqrs>Red Hat - CQRS 장단점</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>Baeldung - Java에서 CQRS와 Event Sourcing</a></li><li><a href=https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture>Upsolver - CQRS와 Event Sourcing 패턴</a></li><li><a href=https://dzone.com/articles/microservices-with-cqrs-and-event-sourcing>DZone - 마이크로서비스에서 CQRS와 Event Sourcing</a></li><li><a href=https://blog.risingstack.com/cqrs-explained-node-js-at-scale/>RisingStack - CQRS 설명</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>System Design School - CQRS 패턴</a></li></ul><hr><h2 id=1-태그-2>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-2>#</a></h2><ul><li><strong>CQRS-Pattern</strong></li><li><strong>Command-Query-Separation</strong></li><li><strong>Event-Sourcing</strong></li><li><strong>Scalable-Architecture</strong></li></ul><hr><h2 id=2-분류-구조-분석>2. 분류 구조 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석>#</a></h2><p><strong>계층 구조:</strong><br>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Styles and Patterns > Architecture Patterns > Data Management</p><p><strong>분석 및 근거:</strong><br>CQRS는 소프트웨어 아키텍처 패턴으로, 데이터 읽기(Query)와 쓰기(Command) 작업을 분리하여 각각 최적화된 모델로 처리하는 설계 원칙입니다. 이는 “Architecture Styles and Patterns” 하위의 “Architecture Patterns”에 적합하게 분류되며, 데이터 관리(Data Management)와도 밀접하게 연관되어 있으므로 하위로 포함하는 것이 타당합니다. 실제로 CQRS는 도메인 주도 설계(DDD), 이벤트 소싱(Event Sourcing)과 함께 사용되어 데이터 처리와 확장성, 유지보수성을 높이는 데 활용됩니다<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">1</a><a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">3</a>.</p><hr><h2 id=3-요약200자-내외>3. 요약(200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약200자-내외>#</a></h2><p>CQRS는 데이터 읽기와 쓰기 작업을 분리해 각각의 모델과 저장소로 처리함으로써 성능, 확장성, 유지보수성을 높이는 소프트웨어 아키텍처 패턴이다<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">2</a>.</p><hr><h2 id=4-개요250자-내외>4. 개요(250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요250자-내외>#</a></h2><p>CQRS는 애플리케이션의 데이터 읽기(Query)와 쓰기(Command) 작업을 별도의 모델과 저장소로 분리하여, 각 작업에 최적화된 처리와 독립적 확장이 가능하도록 설계하는 아키텍처 패턴이다. 이를 통해 복잡한 도메인에서 성능, 확장성, 유지보수성을 크게 향상시킬 수 있다<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">2</a>.</p><hr><h2 id=5-핵심-개념-2>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-2>#</a></h2><ul><li><strong>명령(Command):</strong> 시스템의 상태를 변경하는 작업(예: 생성, 수정, 삭제).</li><li><strong>쿼리(Query):</strong> 시스템의 상태를 변경하지 않고 데이터를 조회하는 작업.</li><li><strong>책임 분리:</strong> 읽기와 쓰기 작업을 완전히 분리하여 각각의 모델과 저장소를 사용.</li><li><strong>독립적 최적화:</strong> 읽기와 쓰기 모델을 각각의 목적에 맞게 최적화.</li><li><strong>이벤트 소싱:</strong> 상태 변경 이벤트를 저장하여 복원 및 감사, 도메인 모델링에 활용 가능.</li></ul><p><strong>실무 구현 요소</strong></p><ul><li><strong>Command Handler:</strong> 명령을 처리하는 핸들러.</li><li><strong>Query Handler:</strong> 쿼리를 처리하는 핸들러.</li><li><strong>Command Model:</strong> 쓰기 작업에 최적화된 데이터 모델.</li><li><strong>Query Model:</strong> 읽기 작업에 최적화된 데이터 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트를 저장하는 저장소(선택).</li><li><strong>Synchronization Mechanism:</strong> Command와 Query 모델 간 데이터 동기화(필요 시).</li></ul><hr><h2 id=6-조사-내용주요-항목별-정리>6. 조사 내용(주요 항목별 정리)<a hidden class=anchor aria-hidden=true href=#6-조사-내용주요-항목별-정리>#</a></h2><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>CQRS는 기존 CRUD 기반 아키텍처에서 복잡성이 증가하고, 읽기와 쓰기 작업의 요구사항이 달라지면서 각각의 작업에 최적화된 처리가 필요해진 데서 등장했습니다. 이로 인해 유지보수성, 확장성, 성능 문제가 해결되고 있습니다<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">5</a><a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">6</a>.</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li><strong>성능 및 확장성:</strong> 읽기와 쓰기 작업을 독립적으로 확장 및 최적화.</li><li><strong>복잡성 관리:</strong> 도메인 복잡성 증가 시 유지보수성 향상.</li><li><strong>보안:</strong> 읽기와 쓰기 권한을 분리하여 보안 강화<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">1</a><a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">4</a>.</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li><strong>Command Side:</strong> 데이터 생성, 수정, 삭제.</li><li><strong>Query Side:</strong> 데이터 조회.</li><li><strong>Event Sourcing:</strong> 상태 변경 이벤트 저장 및 재생(선택).</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>읽기/쓰기 분리:</strong> 각각의 모델과 저장소 사용.</li><li><strong>독립적 확장:</strong> 읽기와 쓰기 작업을 독립적으로 확장.</li><li><strong>이벤트 기반:</strong> 상태 변경 이벤트 저장 및 활용(선택).</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ul><li><strong>단일 책임:</strong> 명령(Command)과 쿼리(Query)는 각각 단일 책임.</li><li><strong>독립적 최적화:</strong> 읽기와 쓰기 모델을 각각 최적화.</li><li><strong>이벤트 기반:</strong> 상태 변경 이벤트 저장 및 활용(선택)<a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">8</a><a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">10</a>.</li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-76-1><a class=lnlinks href=#hl-76-1>1</a>
</span><span class=lnt id=hl-76-2><a class=lnlinks href=#hl-76-2>2</a>
</span><span class=lnt id=hl-76-3><a class=lnlinks href=#hl-76-3>3</a>
</span><span class=lnt id=hl-76-4><a class=lnlinks href=#hl-76-4>4</a>
</span><span class=lnt id=hl-76-5><a class=lnlinks href=#hl-76-5>5</a>
</span><span class=lnt id=hl-76-6><a class=lnlinks href=#hl-76-6>6</a>
</span><span class=lnt id=hl-76-7><a class=lnlinks href=#hl-76-7>7</a>
</span><span class=lnt id=hl-76-8><a class=lnlinks href=#hl-76-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Diagram: CQRS Architecture]
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│  CLIENTS    │ → │ COMMAND API │ → │ WRITE MODEL │
</span></span><span class=line><span class=cl>│             │   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>│ APPLICATION │ ← │  QUERY API  │ ← │ READ MODEL  │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(Optional: Event Store for Command side)
</span></span></code></pre></td></tr></table></div></div><p>읽기와 쓰기 작업이 완전히 분리되어 있으며, 명령은 쓰기 모델에, 쿼리는 읽기 모델에 접근합니다. 필요 시 이벤트 소싱을 통해 상태 변경 이벤트를 저장하고 재생할 수 있습니다<a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">2</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">11</a>.</p><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><ul><li><strong>Command Side:</strong> 명령 처리, 쓰기 모델, 이벤트 저장(선택).</li><li><strong>Query Side:</strong> 쿼리 처리, 읽기 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트 저장(선택).</li><li><strong>Synchronization Mechanism:</strong> Command와 Query 모델 간 데이터 동기화(필요 시).</li></ul><p><strong>각 구성요소의 기능과 역할</strong></p><ul><li><strong>Command Handler:</strong> 명령을 받아 처리하고, 쓰기 모델에 반영.</li><li><strong>Query Handler:</strong> 쿼리를 받아 읽기 모델에서 데이터 조회.</li><li><strong>Write Model:</strong> 데이터 생성, 수정, 삭제에 최적화된 모델.</li><li><strong>Read Model:</strong> 데이터 조회에 최적화된 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트 저장(선택, 이벤트 소싱 사용 시).</li><li><strong>Synchronization Mechanism:</strong> 쓰기 모델의 변경을 읽기 모델에 반영(필요 시).</li></ul><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><ul><li><strong>분리된 모델:</strong> 읽기와 쓰기 모델을 완전히 분리.</li><li><strong>이벤트 소싱:</strong> 상태 변경 이벤트를 저장하여 재생 및 감사 가능.</li><li><strong>메시지 큐/브로커:</strong> 명령 처리 결과를 이벤트로 발행, 읽기 모델에 반영.</li><li><strong>독립적 저장소:</strong> 읽기와 쓰기 모델에 각각 최적화된 저장소 사용.</li><li><strong>동기화:</strong> 쓰기 모델의 변경을 읽기 모델에 반영하는 동기화 메커니즘 구현.</li></ul><p><strong>실제 예시(시나리오):</strong></p><ul><li><strong>쓰기:</strong> 주문 생성 명령 → Command Handler → Write Model(주문 저장) → Event Store(주문 생성 이벤트 저장) → Message Queue(이벤트 발행).</li><li><strong>읽기:</strong> 주문 조회 쿼리 → Query Handler → Read Model(주문 조회).</li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 원인</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 작업을 독립적으로 확장 가능</td><td>읽기/쓰기 분리</td></tr><tr><td>장점</td><td>성능</td><td>각 작업에 최적화된 모델과 저장소 사용</td><td>독립적 최적화</td></tr><tr><td>장점</td><td>유지보수성</td><td>코드가 분리되어 유지보수 용이</td><td>책임 분리</td></tr><tr><td>장점</td><td>보안</td><td>읽기와 쓰기 권한 분리로 보안 강화</td><td>책임 분리</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>시스템 구성이 복잡해짐</td><td>경험 축적, 문서화</td></tr><tr><td>단점</td><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 데이터 불일치 가능</td><td>동기화 메커니즘, 이벤트 기반 처리</td></tr></tbody></table><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 불일치</td><td>동기화 지연, 이벤트 처리 실패</td><td>사용자 경험 저하</td><td>모니터링, 로그 분석</td><td>이벤트 처리 신뢰성 강화</td><td>이벤트 재처리, 동기화 메커니즘 강화</td></tr><tr><td>문제점</td><td>과도한 복잡성</td><td>불필요한 CQRS 적용</td><td>개발 및 유지보수 비용 증가</td><td>코드 리뷰, 아키텍처 리뷰</td><td>CQRS 필요성 평가</td><td>CRUD로 복귀, 도메인 단위로 CQRS 적용</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>도전 과제</td><td>대규모 시스템 적용</td><td>동기화 및 이벤트 처리 복잡성</td><td>시스템 안정성 저하</td><td>모니터링, 테스트</td><td>모듈화, 마이크로서비스 전환</td><td>이벤트 기반 아키텍처, 분산 트랜잭션 관리</td></tr><tr><td>도전 과제</td><td>팀 온보딩 및 코드 관리</td><td>아키텍처 복잡성, 팀원 이해 부족</td><td>개발 비용 증가, 일관성 저하</td><td>코드 리뷰, 문서화</td><td>교육, 예시 코드 제공</td><td>문서화, 코드 리뷰, 멘토링</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th></tr></thead><tbody><tr><td>분리 수준</td><td>클래스 분리</td><td>읽기와 쓰기 클래스만 분리</td></tr><tr><td>분리 수준</td><td>모델 분리</td><td>읽기와 쓰기 모델 분리</td></tr><tr><td>분리 수준</td><td>저장소 분리</td><td>읽기와 쓰기 저장소 분리(진정한 CQRS)</td></tr><tr><td>적용 범위</td><td>전체 시스템</td><td>시스템 전체에 CQRS 적용</td></tr><tr><td>적용 범위</td><td>도메인 단위</td><td>특정 도메인에만 CQRS 적용</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td>확장성</td><td>Spring, Node.js, Kafka</td><td>읽기와 쓰기 독립적 확장</td></tr><tr><td>성능</td><td>Redis, MongoDB, PostgreSQL</td><td>각 작업에 최적화된 저장소 사용</td></tr><tr><td>유지보수성</td><td>DDD, Event Sourcing</td><td>코드 분리로 유지보수성 향상</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><p><strong>RisingStack Node.js 모니터링 툴:</strong><br>CQRS를 적용해 데이터 수집(Command)과 데이터 시각화(Query)를 분리.</p><ul><li><strong>시스템 구성:</strong><ul><li>Command Side: 데이터 수집 API, 메시지 큐, 작업자(Worker), 쓰기 모델(데이터베이스)</li><li>Query Side: 읽기 모델(데이터베이스 복제본), 시각화 API</li></ul></li><li><strong>Workflow:</strong><ul><li>데이터 수집 → Command API → 메시지 큐 → 작업자 → 쓰기 모델</li><li>데이터 시각화 → Query API → 읽기 모델</li></ul></li><li><strong>역할:</strong><ul><li>Command Side: 데이터 수집 및 저장</li><li>Query Side: 데이터 조회 및 시각화</li></ul></li><li><strong>차이점:</strong><ul><li>기존 CRUD 방식은 읽기와 쓰기 작업이 동일 모델과 저장소에서 처리되어 성능 병목 및 복잡성 증가.</li><li>CQRS는 읽기와 쓰기를 분리해 각각 최적화되어 성능과 확장성 향상<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/?utm_source=chatgpt.com" title="Cloud Design Patterns - Azure Architecture Center">12</a>.</li></ul></li></ul><h3 id=구현-예시-python-1>구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#구현-예시-python-1>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-77-1><a class=lnlinks href=#hl-77-1> 1</a>
</span><span class=lnt id=hl-77-2><a class=lnlinks href=#hl-77-2> 2</a>
</span><span class=lnt id=hl-77-3><a class=lnlinks href=#hl-77-3> 3</a>
</span><span class=lnt id=hl-77-4><a class=lnlinks href=#hl-77-4> 4</a>
</span><span class=lnt id=hl-77-5><a class=lnlinks href=#hl-77-5> 5</a>
</span><span class=lnt id=hl-77-6><a class=lnlinks href=#hl-77-6> 6</a>
</span><span class=lnt id=hl-77-7><a class=lnlinks href=#hl-77-7> 7</a>
</span><span class=lnt id=hl-77-8><a class=lnlinks href=#hl-77-8> 8</a>
</span><span class=lnt id=hl-77-9><a class=lnlinks href=#hl-77-9> 9</a>
</span><span class=lnt id=hl-77-10><a class=lnlinks href=#hl-77-10>10</a>
</span><span class=lnt id=hl-77-11><a class=lnlinks href=#hl-77-11>11</a>
</span><span class=lnt id=hl-77-12><a class=lnlinks href=#hl-77-12>12</a>
</span><span class=lnt id=hl-77-13><a class=lnlinks href=#hl-77-13>13</a>
</span><span class=lnt id=hl-77-14><a class=lnlinks href=#hl-77-14>14</a>
</span><span class=lnt id=hl-77-15><a class=lnlinks href=#hl-77-15>15</a>
</span><span class=lnt id=hl-77-16><a class=lnlinks href=#hl-77-16>16</a>
</span><span class=lnt id=hl-77-17><a class=lnlinks href=#hl-77-17>17</a>
</span><span class=lnt id=hl-77-18><a class=lnlinks href=#hl-77-18>18</a>
</span><span class=lnt id=hl-77-19><a class=lnlinks href=#hl-77-19>19</a>
</span><span class=lnt id=hl-77-20><a class=lnlinks href=#hl-77-20>20</a>
</span><span class=lnt id=hl-77-21><a class=lnlinks href=#hl-77-21>21</a>
</span><span class=lnt id=hl-77-22><a class=lnlinks href=#hl-77-22>22</a>
</span><span class=lnt id=hl-77-23><a class=lnlinks href=#hl-77-23>23</a>
</span><span class=lnt id=hl-77-24><a class=lnlinks href=#hl-77-24>24</a>
</span><span class=lnt id=hl-77-25><a class=lnlinks href=#hl-77-25>25</a>
</span><span class=lnt id=hl-77-26><a class=lnlinks href=#hl-77-26>26</a>
</span><span class=lnt id=hl-77-27><a class=lnlinks href=#hl-77-27>27</a>
</span><span class=lnt id=hl-77-28><a class=lnlinks href=#hl-77-28>28</a>
</span><span class=lnt id=hl-77-29><a class=lnlinks href=#hl-77-29>29</a>
</span><span class=lnt id=hl-77-30><a class=lnlinks href=#hl-77-30>30</a>
</span><span class=lnt id=hl-77-31><a class=lnlinks href=#hl-77-31>31</a>
</span><span class=lnt id=hl-77-32><a class=lnlinks href=#hl-77-32>32</a>
</span><span class=lnt id=hl-77-33><a class=lnlinks href=#hl-77-33>33</a>
</span><span class=lnt id=hl-77-34><a class=lnlinks href=#hl-77-34>34</a>
</span><span class=lnt id=hl-77-35><a class=lnlinks href=#hl-77-35>35</a>
</span><span class=lnt id=hl-77-36><a class=lnlinks href=#hl-77-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Side</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Validate and process command</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=s2>&#34;order_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Side</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>read_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=n>read_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Usage</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>read_model</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>(</span><span class=n>read_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>order_id</span> <span class=o>=</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>create_order</span><span class=p>({</span><span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;Laptop&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>  <span class=c1># None (initially, read model is not synced)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Simulate event processing to update read model</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>read_model</span><span class=p>[</span><span class=n>event</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>  <span class=c1># {&#39;product&#39;: &#39;Laptop&#39;, &#39;quantity&#39;: 1}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에만 적용</td><td>CRUD로 충분한 경우 CQRS 적용 지양</td></tr><tr><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 동기화 필수</td><td>이벤트 기반 동기화, 신뢰성 강화</td></tr><tr><td>이벤트 처리</td><td>이벤트 처리 실패 시 복구 필요</td><td>이벤트 재처리, 장애 복구 메커니즘</td></tr><tr><td>문서화</td><td>아키텍처 및 코드 문서화</td><td>문서화, 예시 코드 제공</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>저장소 선택</td><td>읽기와 쓰기 모델에 최적화된 저장소 사용</td><td>Redis, MongoDB, PostgreSQL 등 상황에 맞는 저장소 선택</td></tr><tr><td>캐싱</td><td>읽기 모델에 캐싱 적용</td><td>캐싱 전략 적용</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 시 성능 고려</td><td>이벤트 배치 처리, 스트리밍 처리</td></tr><tr><td>모니터링</td><td>데이터 동기화 및 이벤트 처리 모니터링</td><td>모니터링, 로그 분석</td></tr></tbody></table><h3 id=기타-사항>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항>#</a></h3><ul><li><strong>이벤트 소싱과의 연계:</strong> CQRS는 이벤트 소싱과 함께 사용될 때 가장 큰 효과를 발휘합니다. 상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용할 수 있습니다<a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing - Code Samples">8</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">11</a>.</li><li><strong>마이크로서비스와의 연계:</strong> CQRS는 마이크로서비스 환경에서 각 서비스의 독립적 확장과 유지보수성 향상에 유리합니다<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>8</a>.</li><li><strong>적용 범위:</strong> 전체 시스템이 아닌, 복잡한 도메인이나 확장성이 중요한 부분에만 적용하는 것이 바람직합니다[15][16].</li></ul><hr><h2 id=7-추가-조사-내용-1>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용-1>#</a></h2><ul><li><strong>CQRS와 CRUD 비교:</strong><ul><li><strong>CRUD:</strong> 읽기와 쓰기 작업이 동일 모델과 저장소에서 처리. 단순하지만 복잡한 도메인에서는 성능 및 확장성 문제 발생.</li><li><strong>CQRS:</strong> 읽기와 쓰기 작업을 분리하여 각각 최적화. 복잡한 도메인, 대규모 시스템에 적합<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">2</a>.</li></ul></li><li><strong>이벤트 소싱:</strong><ul><li>상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용.</li><li>CQRS와 함께 사용 시 시스템의 유연성과 확장성 극대화<a href="https://learn.microsoft.com/en-us/samples/azure-samples/cosmos-db-design-patterns/event-sourcing/?utm_source=chatgpt.com" title="Azure Cosmos DB design pattern: Event sourcing - Code Samples">8</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">11</a>.</li></ul></li><li><strong>적용 범위:</strong><ul><li>전체 시스템이 아닌, 복잡한 도메인이나 확장성이 중요한 부분에만 적용.</li><li>도메인 주도 설계(DDD)와 함께 사용 시 효과적[15]<a href="https://martinfowler.com/bliki/CQRS.html?utm_source=chatgpt.com" title=CQRS>16</a>.</li></ul></li></ul><hr><h2 id=8-주목할-내용>8. 주목할 내용<a hidden class=anchor aria-hidden=true href=#8-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>CQRS</td><td>읽기/쓰기 분리</td><td>데이터 읽기와 쓰기 작업을 분리하여 각각 최적화</td></tr><tr><td>설계 패턴</td><td>CQRS</td><td>이벤트 소싱</td><td>상태 변경 이벤트 저장 및 재생, 감사, 도메인 모델링</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>마이크로서비스</td><td>독립적 확장, 유지보수성 향상</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>도메인 주도 설계</td><td>복잡한 도메인에서 효과적</td></tr></tbody></table><hr><h2 id=9-반드시-학습해야-할-내용>9. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#9-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 원칙</td><td>CQRS</td><td>책임 분리</td><td>읽기와 쓰기 작업을 분리하여 각각 최적화</td></tr><tr><td>설계 원칙</td><td>CQRS</td><td>이벤트 소싱</td><td>상태 변경 이벤트 저장 및 재생</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>도메인 주도 설계</td><td>복잡한 도메인에서 효과적</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 데이터 동기화 메커니즘</td></tr></tbody></table><hr><h2 id=10-용어-정리>10. 용어 정리<a hidden class=anchor aria-hidden=true href=#10-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>CQRS</td><td>데이터 읽기와 쓰기 작업을 분리하여 각각 최적화된 모델과 저장소로 처리하는 아키텍처 패턴</td></tr><tr><td>설계 원칙</td><td>Command</td><td>시스템의 상태를 변경하는 작업(생성, 수정, 삭제)</td></tr><tr><td>설계 원칙</td><td>Query</td><td>시스템의 상태를 변경하지 않고 데이터를 조회하는 작업</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용</td></tr><tr><td>실무 적용</td><td>Read Model</td><td>데이터 조회에 최적화된 모델</td></tr><tr><td>실무 적용</td><td>Write Model</td><td>데이터 생성, 수정, 삭제에 최적화된 모델</td></tr></tbody></table><hr><h2 id=11-참고-및-출처>11. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#11-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center | Microsoft Learn</a></li><li><a href=https://dokhakbaksa.tistory.com/101>CQRS 패턴 - 짱구 - 티스토리</a></li><li><a href=https://www.linkedin.com/pulse/what-purpose-cqrs-pavan-kumar-devulapalli-v7crc>What is the purpose of CQRS? - LinkedIn</a></li><li><a href=https://www.advanceworks.ai/command-query-responsibility-segregation-cqrs/>Command Query Responsibility Segregation (CQRS) - AdvanceWorks</a></li><li><a href=https://www.redhat.com/ko/blog/illustrated-cqrs>An illustrated guide to CQRS data patterns - Red Hat</a></li><li><a href=https://blog.naver.com/seek316/223247564137>CQRS(Command Query Responsibility Segregation) 개념 - 네이버 블로그</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li><li><a href=https://www.graphapp.ai/blog/understanding-the-cqrs-pattern-benefits-and-implementation-strategies>Understanding the CQRS Pattern: Benefits and Implementation Strategies - GraphApp</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>The CQRS Pattern - System Design School</a></li><li><a href=https://blog.devops.dev/understanding-cqrs-pattern-pros-cons-and-a-spring-boot-example-69138eef603f>Understanding CQRS Pattern: Pros, Cons, and a Spring Boot Example - DevOps.dev</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/tip/Common-CQRS-pattern-problems-and-how-teams-can-avoid-them>Common CQRS pattern problems, and how teams can avoid them - TechTarget</a></li><li><a href=https://martinfowler.com/bliki/CQRS.html>CQRS - Martin Fowler</a></li><li><a href=https://enterprisecraftsmanship.com/posts/types-of-cqrs/>Types of CQRS - Enterprise Craftsmanship</a></li><li><a href=https://www.rootstrap.com/blog/demystifying-cqrs-a-practical-approach---simple-cqrs-part-1>Demystifying CQRS: A Practical Approach – Simple CQRS [Part 1] - Rootstrap</a></li><li><a href=https://blog.risingstack.com/cqrs-explained-node-js-at-scale/>CQRS Explained - RisingStack Engineering</a></li><li><a href=https://blog.nashtechglobal.com/introduction-to-cqrs/>Introduction to CQRS(Working, Uses, Benefits) - NashTech Blog</a></li><li><a href=https://github.com/slashdotdash/cqrs-best-practices>CQRS/ES best practices - GitHub</a></li><li><a href=https://blog.bytedoodle.com/cqrs-schema-design-synchronization-and-consistency-considerations/>CQRS : Schema Design, Synchronization and Consistency Considerations - ByeDoodle</a>
아래는 <strong>CQRS(Command‑Query Responsibility Segregation)</strong> 아키텍처에 대한 1차 정리입니다. 이후 원하시면 단계별로 세부 내용을 더 깊이 다룰 수 있습니다!</li></ul><hr><h2 id=1-태그-3>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-3>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CQRS, Command‑Query‑Segregation, Event‑Sourcing‑Integration, Data‑Models‑Separation
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-분류-계층-적절성-분석>2. 분류 계층 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-계층-적절성-분석>#</a></h2><ul><li><p>현 분류:</p><blockquote><p>Computer Science and Engineering → Software Engineering → Design and Architecture → Architecture Styles and Patterns → Architecture Patterns → Data Management</p></blockquote></li><li><p><strong>분석</strong>: 적합합니다.
CQRS는 데이터 모델과 책임 분리 아키텍처로, 대규모 데이터 시스템 및 이벤트 기반 설계에 중요하며, ‘Data Management’ 하위에 위치하는 것이 타당합니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">en.wikipedia.org</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">learn.microsoft.com</a>)</p></li></ul><hr><h2 id=3-200자-요약>3. 200자 요약<a hidden class=anchor aria-hidden=true href=#3-200자-요약>#</a></h2><p>CQRS는 명령(Command, 쓰기)과 조회(Query, 읽기)를 분리해 각각의 흐름과 데이터 모델을 독립적으로 최적화하는 패턴입니다. 이를 통해 읽기 성능 향상, 스케일 독립성, 보안 강화, 그리고 복잡한 도메인 로직을 명확히 관리할 수 있습니다. Event Sourcing과 결합하면 이력감사, 비동기 업데이트, 강력한 트랜잭션 모델 제공도 가능합니다.</p><hr><h2 id=4-250자-개요>4. 250자 개요<a hidden class=anchor aria-hidden=true href=#4-250자-개요>#</a></h2><p>CQRS는 시스템의 쓰기(Command)와 읽기(Query) 요청을 논리적으로 분리하여 처리하는 아키텍처 패턴입니다. 쓰기 모델은 복잡한 도메인 로직과 비즈니스 규칙 처리를 담당하고, 읽기 모델은 데이터 조회에 최적화된 경량 모델로 설계됩니다. 두 모델은 동일하거나 분리된 데이터 저장소를 사용하며, Event Sourcing 이벤트를 통해 읽기 모델이 업데이트되고, 처리량, 보안, 유지보수성을 크게 개선할 수 있습니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">learn.microsoft.com</a>)</p><hr><h2 id=5-핵심-개념-및-실무-구현-요소>5. 핵심 개념 및 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-및-실무-구현-요소>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li><strong>Command vs Query</strong>: 상태 변경 <strong>Command</strong>는 결과 미반환, <strong>Query</strong>는 정보 반환만 수행 (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">en.wikipedia.org</a>)</li><li><strong>쓰기 모델 (Write Model)</strong>: 비즈니스 로직 처리, 트랜잭션 관리</li><li><strong>읽기 모델 (Read Model)</strong>: 조회 최적화, DTO/Projections 생성</li><li><strong>데이터 저장소 분리</strong>: 동일 DB 또는 RDBMS와 NoSQL 등 별도 사용 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">learn.microsoft.com</a>, <a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">docs.aws.amazon.com</a>)</li><li><strong>Event Sourcing 통합</strong>: 상태 변경을 이벤트 스트림으로 저장, 읽기 모델로 비동기 업데이트 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">linkedin.com</a>)</li></ul><h3 id=51-실무-구현-요소>5.1 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#51-실무-구현-요소>#</a></h3><ul><li><strong>Command Handler</strong> 구현 및 Command 객체정의</li><li><strong>Query Handler</strong> 구현 및 DTO 또는 projection 설계</li><li><strong>Event</strong> 발행 및 구독자(subscription) 구조 구축</li><li><strong>데이터베이스</strong> 설계: 복합/단독 DB 또는 복수 DB</li><li><strong>메시징</strong>: Kafka, RabbitMQ 등 이벤트 전달용 인프라</li><li><strong>동기화 메커니즘</strong>: 이벤트 소비자(consumers) 구성 및 eventual consistency 확보</li><li><strong>테스트 전략</strong>: Command/Query 유닛 테스트, 통합 테스트, 컨트랙트 테스트</li></ul><hr><p>다음 단계로 작성하기 좋은 항목을 골라주세요:</p><ul><li>A. “구조 및 아키텍처 + 구성 요소” + Mermaid 다이어그램</li><li>B. “주요 원리 & 작동 원리” 시각화</li><li>C. “장단점 분석” 및 “문제점 상세 분석”</li><li>D. “실무 사용 예시” 및 “활용 사례”</li><li>E. “구현 예시(Python/JS 코드)”</li></ul><p>원하시는 순서를 선택해 주세요!</p><p><a href=https://www.codeproject.com/articles/555855/introduction-to-cqrs><figure><img alt="Introduction to CQRS- CodeProject" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.5VvG29FDkUU3E8TaJqDVFwHaGr\\&r=0\\&pid=Api"></figure></a></p><hr><h2 id=-5-구조-및-아키텍처-structure--architecture>🚦 5. 구조 및 아키텍처 (Structure & Architecture)<a hidden class=anchor aria-hidden=true href=#-5-구조-및-아키텍처-structure--architecture>#</a></h2><p>CQRS는 <strong>Command(쓰기)</strong> 와 <strong>Query(읽기)</strong> 책임을 분리하며, 종종 <strong>Event Sourcing</strong>과 결합해 구현됩니다. 핵심 구성 요소는 아래와 같습니다:</p><pre class=mermaid>flowchart LR
  subgraph Write Side
    UI(UI/API) --&gt; CB[Command Bus/Facade]
    CB --&gt; CH[Command Handler]
    CH --&gt; DM[Domain Model / Aggregates]
    DM --&gt; ES[Event Store] --&gt; EB[Event Bus]
  end

  subgraph Read Side
    EB --&gt; EH[Event Handler / Projector]
    EH --&gt; RD[Read Database / Materialized View]
    UI --&gt; QF[Query Facade] --&gt; RD
  end
</pre><ul><li><strong>UI/API</strong>: 사용자의 명령(Command)과 조회(Query)를 입력받습니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">martinfowler.com</a>)</li><li><strong>Command Bus / Facade & Handler</strong>: Command를 수신하고 도메인에 전달 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">rabbitstack.github.io</a>)</li><li><strong>Domain Model / Aggregates</strong>: 비즈니스 규칙을 처리하고 Event를 생성합니다 (<a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">ibm-cloud-architecture.github.io</a>)</li><li><strong>Event Store</strong>: 이벤트를 저장하는 append-only 저장소 (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">red-gate.com</a>)</li><li><strong>Event Bus</strong>: 이벤트를 발행하고 구독하도록 브로드캐스트합니다 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">codeproject.com</a>)</li><li><strong>Event Handler / Projector</strong>: 이벤트를 소비해 Read DB를 업데이트하며, Projection 역할 수행 (<a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">upsolver.com</a>)</li><li><strong>Read Database</strong>: 조회에 최적화된 뷰(view)를 제공하는 DB (<a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">microservices.io</a>)</li><li><strong>Query Facade/Service</strong>: 사용자 요청(Query)을 수신하고 Read DB에서 응답합니다 </li></ul><hr><h3 id=-필수-구성-요소-vs-선택-구성-요소>📘 필수 구성 요소 vs 선택 구성 요소<a hidden class=anchor aria-hidden=true href=#-필수-구성-요소-vs-선택-구성-요소>#</a></h3><table><thead><tr><th>구분</th><th>구성 요소</th><th>역할</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td>Command Handler, Query Handler, Read DB, Write DB or Event Store, Domain Model</td><td>읽기·쓰기 분리 구조 완성</td></tr><tr><td><strong>선택</strong></td><td>Event Store, Event Bus, Event Handlers, Message Broker</td><td>Event Sourcing, 비동기 복제, 마이크로서비스 확장성 확보</td></tr></tbody></table><hr><h2 id=-6-주요-원리--작동-원리>🔁 6. 주요 원리 & 작동 원리<a hidden class=anchor aria-hidden=true href=#-6-주요-원리--작동-원리>#</a></h2><ul><li><strong>Command-Query 분리 (CQS 준수)</strong>: 명령(Command)은 상태 변경만, 조회(Query)는 정보만 반환합니다 (<a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">kurrent.io</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">martinfowler.com</a>, <a href="https://stackoverflow.com/questions/70454102/kafka-message-ordering-guarantees-when-new-partition-added?utm_source=chatgpt.com" title="Kafka Message Ordering Guarantees When New Partition ...">confluent.io</a>, <a href="https://builder.aws.com/content/2dqfVdKPEO1Q917YG25q8F3Y2QW/scaling-distributed-systems-with-event-sourcing-cqrs-and-aws-serverless?utm_source=chatgpt.com" title="Scaling Distributed Systems with Event Sourcing, CQRS, ...">en.wikipedia.org</a>)</li><li><strong>각 모델 독립 최적화</strong>: Write 모델은 도메인 로직 중심, Read 모델은 성능 중심 설계 </li><li><strong>Event 브로드캐스팅 & Projection</strong>: Write가 발생한 Event는 비동기적으로 Read 모델에 반영 </li><li><strong>Eventual Consistency (점진 일관성)</strong>: Command 완료 후 Read DB 반영까지 지연될 수 있습니다 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/decompose-monoliths-into-microservices-by-using-cqrs-and-event-sourcing.html?utm_source=chatgpt.com" title="Decompose monoliths into microservices by using CQRS ...">medium.com</a>)</li></ul><hr><h3 id=-실행-흐름>💡 실행 흐름<a hidden class=anchor aria-hidden=true href=#-실행-흐름>#</a></h3><ol><li><strong>쓰기 요청</strong>: 유저 UI/API → Command → Command Handler</li><li><strong>도메인 처리</strong>: Command Handler → Domain Model → Event 생성</li><li><strong>이벤트 저장 및 발행</strong>: Event Store에 쓰고 Event Bus 통해 전달</li><li><strong>Projection 처리</strong>: Event Handler가 Read DB 업데이트</li><li><strong>조회 요청</strong>: 유저 → Query Handler → Read DB → 결과 반환</li></ol><p>이 구조는 읽기·쓰기 책임을 분리하면서 성능과 확장성을 극대화하고, 복잡한 도메인 로직도 깔끔하게 관리할 수 있습니다.</p><hr><p>다음으로 어떤 부분을 상세하게 다뤄볼까요?</p><ul><li>A. <strong>장단점 분석 + 문제점 정리</strong></li><li>B. <strong>실무 사용 예시 + 활용 사례</strong></li><li>C. <strong>구현 예시 (Python / JS 코드)</strong></li></ul><p>선택하시면, 다음 단계로 진행하겠습니다!</p><p><a href=https://www.codeproject.com/articles/555855/introduction-to-cqrs><figure><img alt="Introduction to CQRS- CodeProject" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.5VvG29FDkUU3E8TaJqDVFwHaGr\\&r=0\\&pid=Api"></figure></a></p><p>아래는 <strong>CQRS의 실무 사용 예시</strong>와 <strong>활용 사례 분석</strong>, 그리고 **코드 구현 예시(Python)**입니다.</p><hr><h2 id=-11-실무-사용-예시>🧪 11. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#-11-실무-사용-예시>#</a></h2><table><thead><tr><th>기술 스택</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Java Spring + Axon Framework</td><td>이벤트 소싱 기반 주문/결제 시스템 구현</td><td>명령·조회 분리, 이벤트 기반 확장 및 감사 기능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">medium.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">github.com</a>, <a href="https://aws.amazon.com/blogs/database/build-a-cqrs-event-store-with-amazon-dynamodb/?utm_source=chatgpt.com" title="Build a CQRS event store with Amazon DynamoDB">reddit.com</a>)</td></tr><tr><td>.NET + Marten (PostgreSQL 기반 Event Sourcing)</td><td>의료 예약 시스템 등에서 상태 이력 관리</td><td>도메인 상태 재생, 일관성 보강</td></tr><tr><td>Go + RabbitMQ + Postgres + EventStoreDB</td><td>전자 상거래 마이크로서비스</td><td>Vertical Slice + CQRS + 이벤트 아키텍처 통합</td></tr><tr><td>Laravel + MySQL + MongoDB</td><td>PHP 기반 애플리케이션에서 읽기/쓰기 DB 분리</td><td>조회 성능 개선, 쓰기 로직 분리</td></tr><tr><td>FastAPI/Python + python-cqrs</td><td>CQRS 패턴 실험 및 PoC</td><td>Python 환경에서 CQRS 도입 가능성 확인</td></tr></tbody></table><hr><h2 id=-12-활용-사례-전자상거래-마이크로서비스>📦 12. 활용 사례: 전자상거래 마이크로서비스<a hidden class=anchor aria-hidden=true href=#-12-활용-사례-전자상거래-마이크로서비스>#</a></h2><h3 id=-시스템-구성도>🏗️ 시스템 구성도<a hidden class=anchor aria-hidden=true href=#-시스템-구성도>#</a></h3><pre class=mermaid>flowchart LR
  subgraph Write Side
    UI --&gt; CmdAPI[Command API]
    CmdAPI --&gt; CH[Command Handler]
    CH --&gt; DM[Order Aggregate]
    DM --&gt; ES[Event Store]
    ES --&gt; EB[Event Bus]
  end

  subgraph Read Side
    EB --&gt; PH[Projector/Event Handler]
    PH --&gt; RDB[(Read DB)]
    UI --&gt; QueryAPI[Query API] --&gt; RDB
  end
</pre><ul><li><strong>Write Side</strong>: 사용자가 주문 요청 → Command Handler 실행 → Order Aggregate 처리 → 이벤트 저장 → 이벤트 버스로 전파</li><li><strong>Event Store</strong>: 상태 변화 이력을 보관하며, 모든 Command가 이벤트 형태로 축적됨</li><li><strong>Event Bus</strong>: 이벤트를 읽기 측으로 전송</li><li><strong>Projector</strong>: 이벤트 소비 후 Read DB에 데이터 반영 (Materialized View)</li><li><strong>Read Side</strong>: UI/Query API가 연결되어 빠른 조회 제공</li></ul><p>이 구조는 조회와 쓰기가 분리돼 <strong>읽기 성능 최적화</strong>, <strong>이벤트 감사 기능 확보</strong>, <strong>도메인 복잡도 관리 용이</strong> 등의 장점을 제공합니다.</p><hr><h2 id=-13-구현-예시-python--fastapi--python-cqrs>💻 13. 구현 예시 (Python + FastAPI + python-cqrs)<a hidden class=anchor aria-hidden=true href=#-13-구현-예시-python--fastapi--python-cqrs>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-81-1><a class=lnlinks href=#hl-81-1> 1</a>
</span><span class=lnt id=hl-81-2><a class=lnlinks href=#hl-81-2> 2</a>
</span><span class=lnt id=hl-81-3><a class=lnlinks href=#hl-81-3> 3</a>
</span><span class=lnt id=hl-81-4><a class=lnlinks href=#hl-81-4> 4</a>
</span><span class=lnt id=hl-81-5><a class=lnlinks href=#hl-81-5> 5</a>
</span><span class=lnt id=hl-81-6><a class=lnlinks href=#hl-81-6> 6</a>
</span><span class=lnt id=hl-81-7><a class=lnlinks href=#hl-81-7> 7</a>
</span><span class=lnt id=hl-81-8><a class=lnlinks href=#hl-81-8> 8</a>
</span><span class=lnt id=hl-81-9><a class=lnlinks href=#hl-81-9> 9</a>
</span><span class=lnt id=hl-81-10><a class=lnlinks href=#hl-81-10>10</a>
</span><span class=lnt id=hl-81-11><a class=lnlinks href=#hl-81-11>11</a>
</span><span class=lnt id=hl-81-12><a class=lnlinks href=#hl-81-12>12</a>
</span><span class=lnt id=hl-81-13><a class=lnlinks href=#hl-81-13>13</a>
</span><span class=lnt id=hl-81-14><a class=lnlinks href=#hl-81-14>14</a>
</span><span class=lnt id=hl-81-15><a class=lnlinks href=#hl-81-15>15</a>
</span><span class=lnt id=hl-81-16><a class=lnlinks href=#hl-81-16>16</a>
</span><span class=lnt id=hl-81-17><a class=lnlinks href=#hl-81-17>17</a>
</span><span class=lnt id=hl-81-18><a class=lnlinks href=#hl-81-18>18</a>
</span><span class=lnt id=hl-81-19><a class=lnlinks href=#hl-81-19>19</a>
</span><span class=lnt id=hl-81-20><a class=lnlinks href=#hl-81-20>20</a>
</span><span class=lnt id=hl-81-21><a class=lnlinks href=#hl-81-21>21</a>
</span><span class=lnt id=hl-81-22><a class=lnlinks href=#hl-81-22>22</a>
</span><span class=lnt id=hl-81-23><a class=lnlinks href=#hl-81-23>23</a>
</span><span class=lnt id=hl-81-24><a class=lnlinks href=#hl-81-24>24</a>
</span><span class=lnt id=hl-81-25><a class=lnlinks href=#hl-81-25>25</a>
</span><span class=lnt id=hl-81-26><a class=lnlinks href=#hl-81-26>26</a>
</span><span class=lnt id=hl-81-27><a class=lnlinks href=#hl-81-27>27</a>
</span><span class=lnt id=hl-81-28><a class=lnlinks href=#hl-81-28>28</a>
</span><span class=lnt id=hl-81-29><a class=lnlinks href=#hl-81-29>29</a>
</span><span class=lnt id=hl-81-30><a class=lnlinks href=#hl-81-30>30</a>
</span><span class=lnt id=hl-81-31><a class=lnlinks href=#hl-81-31>31</a>
</span><span class=lnt id=hl-81-32><a class=lnlinks href=#hl-81-32>32</a>
</span><span class=lnt id=hl-81-33><a class=lnlinks href=#hl-81-33>33</a>
</span><span class=lnt id=hl-81-34><a class=lnlinks href=#hl-81-34>34</a>
</span><span class=lnt id=hl-81-35><a class=lnlinks href=#hl-81-35>35</a>
</span><span class=lnt id=hl-81-36><a class=lnlinks href=#hl-81-36>36</a>
</span><span class=lnt id=hl-81-37><a class=lnlinks href=#hl-81-37>37</a>
</span><span class=lnt id=hl-81-38><a class=lnlinks href=#hl-81-38>38</a>
</span><span class=lnt id=hl-81-39><a class=lnlinks href=#hl-81-39>39</a>
</span><span class=lnt id=hl-81-40><a class=lnlinks href=#hl-81-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># command.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cqrs</span> <span class=kn>import</span> <span class=n>Command</span><span class=p>,</span> <span class=n>CommandHandler</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaceOrder</span><span class=p>(</span><span class=n>Command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaceOrderHandler</span><span class=p>(</span><span class=n>CommandHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cmd</span><span class=p>:</span> <span class=n>PlaceOrder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 도메인 처리 예: 재고/결제 검증 후 OrderPlaced 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># query.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cqrs</span> <span class=kn>import</span> <span class=n>Query</span><span class=p>,</span> <span class=n>QueryHandler</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrder</span><span class=p>(</span><span class=n>Query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrderHandler</span><span class=p>(</span><span class=n>QueryHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>qry</span><span class=p>:</span> <span class=n>GetOrder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 읽기 DB 호출</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>qry</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;PLACED&#34;</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># app.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>command</span> <span class=kn>import</span> <span class=n>PlaceOrder</span><span class=p>,</span> <span class=n>PlaceOrderHandler</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>query</span> <span class=kn>import</span> <span class=n>GetOrder</span><span class=p>,</span> <span class=n>GetOrderHandler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cmd_handler</span> <span class=o>=</span> <span class=n>PlaceOrderHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>qry_handler</span> <span class=o>=</span> <span class=n>GetOrderHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>place_order</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span> <span class=o>=</span> <span class=n>PlaceOrder</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>evt</span> <span class=o>=</span> <span class=n>cmd_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 시스템은 EventBus 전송 필요</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>evt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>qry</span> <span class=o>=</span> <span class=n>GetOrder</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>qry_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>qry</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Command Handler</strong>: 쓰기 이벤트 처리 담당</li><li><strong>Query Handler</strong>: 읽기 요청 처리</li><li><strong>python‑cqrs</strong> 라이브러리를 통해 패턴 구현 기초 수월화 (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">linkedin.com</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">geeksforgeeks.org</a>, <a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html?utm_source=chatgpt.com" title="Outbox Event Router">developer.confluent.io</a>, <a href="https://www.baeldung.com/kafka-message-ordering?utm_source=chatgpt.com" title="Ensuring Message Ordering in Kafka: Strategies and ...">pypi.org</a>, <a href="https://dattell.com/data-architecture-blog/does-kafka-guarantee-message-order/?utm_source=chatgpt.com" title="Does Kafka Guarantee Message Order?">arxiv.org</a>)</li></ul><hr><h3 id=-요약>✅ 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h3><ul><li><strong>실무 예시</strong>: 마이크로서비스, 이벤트 소싱, 성능 및 감사 요구에 대응</li><li><strong>활용 사례</strong>: 전자상거래 마이크로서비스 아키텍처에서 CQRS + Event Sourcing 결합</li><li><strong>코드 예</strong>: FastAPI 기반 실험적인 CQRS 구조로 개념 실현 가능</li></ul><p>다음 단계로 <strong>실무에서의 적용 포인트 및 최적화 권장 사항</strong>, <strong>용어 정리/참고 출처</strong> 등 전달해드릴까요? 원하는 항목을 말씀해주세요!</p><p>아래는 <strong>CQRS</strong>의 마지막 정리 단계입니다.</p><hr><h2 id=-14-실무에서-적용-시-고려사항-및-주의할-점>📋 14. 실무에서 적용 시 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#-14-실무에서-적용-시-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 일관성</td><td>Eventually consistent 구조는 즉시 반영되지 않음</td><td>사용자에게 <em>일시적 지연</em> 안내, Polling/재시도 UX 제공</td></tr><tr><td>장애 복구</td><td>메시지 누락·중복 가능성 존재</td><td>Idempotent 처리, Outbox 패턴, Dead-letter 큐 도입</td></tr><tr><td>모니터링</td><td>메트릭 수집 없으면 지연 원인 파악 어려움</td><td>Lag, 이벤트 처리율, 오류율 모니터링 구성</td></tr><tr><td>보안</td><td>쓰기/읽기 API 분리로 권한 제어 추가 필요</td><td>권한 체크, 감사 로그, Command 추적 설계</td></tr><tr><td>스키마 변경</td><td>읽기/쓰기 모델 다른 스키마 버전 문제</td><td>Event 버전 관리, Projection 리컴패일 설계</td></tr><tr><td>테스트</td><td>Command/Query/Projection 모두 커버해야 함</td><td>Contract 테스트, E2E 시나리오 테스트 포함</td></tr></tbody></table><p><strong>권장 요약</strong>:
적용 전 반드시 스케일, 성능 요구, 팀 기술 역량, 도메인 복잡도를 고려하고, 초기에는 단순 CQRS 구조로 도입한 후 필요에 따라 Event Sourcing 또는 분산 트랜잭션 지원 구조로 확장하세요.</p><hr><h2 id=-15-최적화를-위한-고려사항-및-주의할-점>⚙️ 15. 최적화를 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#-15-최적화를-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>DB 최적화</td><td>Projection 대상 데이터는 큼직하게 될 수 있음</td><td>인덱싱, 파티셔닝, 정기 아카이빙 전략 적용</td></tr><tr><td>이벤트 관리</td><td>이벤트 수/크기 급증시 처리 지연 우려</td><td>Snapshot, 이벤트 압축, TTL 설정 적용</td></tr><tr><td>인프라 비용</td><td>브로커, 이벤트 저장소 등 비용 증가</td><td>필요 수준 평가 후 구성, 서버리스 등 고려</td></tr><tr><td>멀티 테넌시</td><td>테넌트별 데이터 격리 필요</td><td>스키마 격리, 네임스페이스 설계 유의</td></tr><tr><td>메시징 성능</td><td>동기 처리 시 지연 걱정</td><td>배치, 비동기 소비, Backpressure 대책 유효화</td></tr></tbody></table><hr><h2 id=-16-용어-정리>🧾 16. 용어 정리<a hidden class=anchor aria-hidden=true href=#-16-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>핵심 개념</td><td>Command</td><td>상태 변경 요청을 표현하는 객체 또는 메시지</td></tr><tr><td></td><td>Query</td><td>데이터를 조회하기 위한 요청</td></tr><tr><td></td><td>Command Handler</td><td>Command를 처리하는 비즈니스 로직 엔진</td></tr><tr><td></td><td>Query Handler</td><td>조회 요청을 처리하는 컴포넌트</td></tr><tr><td>아키텍처</td><td>Event Sourcing</td><td>상태 변경을 이벤트로 저장하고, 이를 통해 상태 재구성 방식 사용</td></tr><tr><td></td><td>Projection</td><td>이벤트를 기반으로 Read 모델을 구성하기 위한 View</td></tr><tr><td>패턴</td><td>Outbox Pattern</td><td>DB와 메시지 브로커 간의 트랜잭션 일관성 유지 전략</td></tr><tr><td>용어</td><td>Idempotence</td><td>중복 메시지(요청)에 대해 상태를 안전하게 처리하는 보장 방식</td></tr></tbody></table><hr><h2 id=-참고-및-출처>📚 참고 및 출처<a hidden class=anchor aria-hidden=true href=#-참고-및-출처>#</a></h2><ul><li>“CQRS pattern”, Microsoft docs</li><li>Greg Young, “Introduction to CQRS and Event Sourcing”</li><li>Udi Dahan, “CQRS and the Monolithic Mindset”</li><li>Microservices Patterns, Chris Richardson – CQRS 챕터</li><li>Axon Framework 문서 – Java/CQRS & Event Sourcing</li></ul><hr><p>🎯 <strong>정리 완료:</strong>
CQRS의 핵심 개념, 구조, 역할, 장단점부터 실무 고려사항, 최적화 지침, 용어 정의까지 정리했습니다.
추가로 프레임워크별 적용 가이드(.NET, Spring, Go 등)나 특정 사용 사례 코드가 필요하시면 언제든 요청하세요!</p><hr><h2 id=-장점-advantages>✅ 장점 (Advantages)<a hidden class=anchor aria-hidden=true href=#-장점-advantages>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>독립적 모델링</td><td>쓰기(도메인 로직)와 읽기(조회용 뷰) 모델을 분리하여 각각 최적화할 수 있습니다 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center">redhat.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">medium.com</a>)</td></tr><tr><td></td><td>성능 및 스케일</td><td>읽기/쓰기 작업을 독립적으로 확장 가능하며, 위치 기반 복제 통해 지연 감소</td></tr><tr><td></td><td>보안 강화</td><td>쓰기 모델 접근을 제한함으로써 보안 정책 적용이 용이해집니다</td></tr><tr><td></td><td>도메인 명확화</td><td>도메인 모델과 읽기 모델 분리를 통해 비즈니스 로직이 더욱 명료해집니다</td></tr><tr><td></td><td>유연성</td><td>데이터 저장소를 읽기/쓰기에 맞게 다르게 구성할 수 있으며, CQRS와 Event Sourcing 결합 시 강력한 로그·이력 관리 가능</td></tr></tbody></table><hr><h2 id=-단점-drawbacks>❌ 단점 (Drawbacks)<a hidden class=anchor aria-hidden=true href=#-단점-drawbacks>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡도 증가</td><td>구조가 복잡해지고, 개발·운영 비용이 상승합니다 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing?utm_source=chatgpt.com" title="Event Sourcing pattern - Azure Architecture Center">medium.com</a>)</td><td>점진적 도입, 단순화 버전 사용, 내부 문서화</td></tr><tr><td></td><td>일관성 지연 (Eventual Consistency)</td><td>읽기 데이터가 즉시 반영되지 않아 사용자 경험에 지연 발생 가능</td><td>상태 표시 UI 제공, 보상 트랜잭션, 성숙한 이벤트 처리 설계</td></tr><tr><td></td><td>기술 중복</td><td>별도 저장소 및 이벤트 메시징 도입으로 기술 스택이 복잡해지고 장애 지점 증가</td><td>프레임워크 활용, 메시징 트랜잭션 안정성 고려, 모니터링 강화</td></tr><tr><td></td><td>추가 유지보수</td><td>읽기/쓰기와 이벤트 흐름 추가 구성 요소 관리 필요</td><td>자동화 테스트, Contract Testing, 로그 기반 추적</td></tr></tbody></table><hr><h2 id=-문제점-상세-분석-issue-breakdown>⚠️ 문제점 상세 분석 (Issue Breakdown)<a hidden class=anchor aria-hidden=true href=#-문제점-상세-분석-issue-breakdown>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제</td><td>지연 일관성</td><td>읽기 모델 비동기 업데이트</td><td>사용자 혼란, 데이터 불일치</td><td>지연 모니터링, UX 이슈</td><td>예측 가능한 UI, 보상 트랜잭션</td><td>예상 가능한 일관성 확보, 롤백/보상 로직</td></tr><tr><td>문제</td><td>메시지 실패/중복</td><td>네트워크 장애, 중복 수신</td><td>상태 불일치, 중복 작업</td><td>메시지 상태 추적</td><td>Exactly-once 처리 전략, 메시지 idempotence</td><td>중복 처리 로직, 2단계 커밋, Outbox 패턴</td></tr><tr><td>문제</td><td>물리적 인프라 증가</td><td>다중 DB, 브로커 도입</td><td>장애 지점 증가, 운영 비용 상승</td><td>장애 빈도 및 장애 시 영향 확인</td><td>간소화 아키텍처, 인프라 IaC 구축</td><td>지역 이중화, 자동 복구 환경 마련</td></tr><tr><td>문제</td><td>Event Store 과잉</td><td>이벤트 이력 지나치게 커짐</td><td>스토리지 과부하, 복구 지연</td><td>스토리지 용량 로그</td><td>Snapshot, 아카이빙 전략</td><td>정기 아카이빙, Snapshot 기반 리커버리</td></tr></tbody></table><hr><p>다음 단계는 무엇을 원하시나요?</p><ul><li><strong>A</strong>: 실무 사용 예시 + 활용 사례</li><li><strong>B</strong>: 구현 예시 (Python or JS 코드)</li><li><strong>C</strong>: 실무 적용 고려사항 및 최적화 권장 사항 정리</li></ul><p>원하시는 부분을 말씀해주시면 바로 이어서 작성해드리겠습니다!</p><p>안녕하세요! CQRS (Command Query Responsibility Segregation)에 대한 포괄적인 조사를 진행하겠습니다. 단계별로 체계적으로 분석해보겠습니다.이제 충분한 정보를 수집했으므로 CQRS에 대한 포괄적인 분석을 시작하겠습니다.</p><h1 id=cqrs-command-query-responsibility-segregation-조사-결과>CQRS (Command Query Responsibility Segregation) 조사 결과<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-조사-결과>#</a></h1><h2 id=1-태그-및-분류>1. 태그 및 분류<a hidden class=anchor aria-hidden=true href=#1-태그-및-분류>#</a></h2><p><strong>태그</strong>: Command-Query-Responsibility-Segregation, Software-Architecture-Pattern, Event-Driven-Architecture, Distributed-Systems</p><p><strong>주제의 분류 적절성 분석</strong>:
제시된 분류 &ldquo;Computer Science and Engineering&rdquo; > &ldquo;Software Engineering&rdquo; > &ldquo;Design and Architecture&rdquo; > &ldquo;Architecture Styles and Patterns&rdquo; > &ldquo;Architecture Patterns&rdquo; > &ldquo;Data Management"는 <strong>적절합니다</strong>.</p><p><strong>근거</strong>:</p><ul><li>CQRS는 소프트웨어 아키텍처 패턴으로, 데이터 관리와 관련된 설계 접근방식입니다</li><li>소프트웨어 엔지니어링의 설계 및 아키텍처 영역에서 활용되는 패턴입니다</li><li>시스템의 읽기와 쓰기 책임을 분리하는 아키텍처 패턴으로 분류됩니다</li></ul><h2 id=2-요약-설명>2. 요약 설명<a hidden class=anchor aria-hidden=true href=#2-요약-설명>#</a></h2><p>CQRS는 Command와 Query의 책임을 분리하여 읽기와 쓰기 작업을 별도의 모델로 처리하는 아키텍처 패턴으로, 복잡한 도메인과 고성능이 요구되는 시스템에서 확장성과 성능을 향상시키는 설계 접근방식입니다.</p><h2 id=3-전체-개요>3. 전체 개요<a hidden class=anchor aria-hidden=true href=#3-전체-개요>#</a></h2><p>CQRS는 전통적인 CRUD 아키텍처의 한계를 극복하기 위해 개발된 소프트웨어 아키텍처 패턴으로, 시스템의 Command(명령) 처리와 Query(조회) 처리를 분리하여 각각을 최적화할 수 있게 합니다. Event Sourcing과 함께 사용되어 복잡한 비즈니스 로직과 높은 확장성이 요구되는 시스템에서 효과적입니다.</p><hr><h2 id=4-핵심-개념-1>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념-1>#</a></h2><h3 id=기본-핵심-개념>기본 핵심 개념<a hidden class=anchor aria-hidden=true href=#기본-핵심-개념>#</a></h3><ul><li><strong>Command Query Separation (CQS)</strong>: CQRS의 기반이 되는 개념으로, 상태를 변경하는 명령과 데이터를 조회하는 쿼리를 분리하는 원칙</li><li><strong>Command (명령)</strong>: 시스템의 상태를 변경하는 작업을 나타내며, 결과값을 반환하지 않음</li><li><strong>Query (조회)</strong>: 시스템의 상태를 조회하는 작업으로, 시스템 상태를 변경하지 않음</li><li><strong>Write Model (쓰기 모델)</strong>: 명령을 처리하고 비즈니스 로직을 실행하는 모델</li><li><strong>Read Model (읽기 모델)</strong>: 조회 요청을 처리하고 최적화된 데이터를 제공하는 모델</li><li><strong>Eventual Consistency (최종 일관성)</strong>: 읽기와 쓰기 모델 간의 동기화가 즉시 이루어지지 않는 일관성 모델</li></ul><h3 id=실무-구현-요소>실무 구현 요소<a hidden class=anchor aria-hidden=true href=#실무-구현-요소>#</a></h3><ul><li><strong>Command Handler (명령 처리기)</strong>: Command를 받아 비즈니스 로직을 실행하고 상태를 변경하는 컴포넌트</li><li><strong>Query Handler (조회 처리기)</strong>: Query를 받아 Read Model에서 데이터를 조회하는 컴포넌트</li><li><strong>Event Store (이벤트 저장소)</strong>: Event Sourcing과 함께 사용될 때 모든 도메인 이벤트를 저장하는 저장소</li><li><strong>Projection (프로젝션)</strong>: Event에서 Read Model을 생성하는 과정</li><li><strong>Message Bus (메시지 버스)</strong>: Command와 Query를 적절한 Handler로 라우팅하는 컴포넌트</li><li><strong>Synchronization Mechanism (동기화 메커니즘)</strong>: Write Model과 Read Model 간의 데이터 동기화를 담당</li></ul><hr><h2 id=5-배경>5. 배경<a hidden class=anchor aria-hidden=true href=#5-배경>#</a></h2><p>CQRS는 2010년 Greg Young에 의해 처음 소개되었으며, Bertrand Meyer가 1988년 제안한 Command Query Separation (CQS) 원칙을 시스템 아키텍처 레벨로 확장한 것입니다. 전통적인 CRUD 아키텍처에서 단일 모델로 읽기와 쓰기를 모두 처리할 때 발생하는 성능 병목현상과 복잡성 문제를 해결하기 위해 개발되었습니다.</p><hr><h2 id=6-목적-및-필요성>6. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#6-목적-및-필요성>#</a></h2><h3 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h3><ul><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업을 각각에 최적화된 별도 모델로 처리</li><li><strong>확장성 향상</strong>: 읽기와 쓰기 부하를 독립적으로 확장 가능</li><li><strong>복잡성 관리</strong>: 복잡한 비즈니스 로직을 더 명확하게 분리하여 관리</li><li><strong>시스템 유연성</strong>: 다양한 읽기 요구사항에 맞는 여러 Read Model 제공</li></ul><h3 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h3><ul><li>높은 읽기/쓰기 부하 비율의 불균형</li><li>복잡한 도메인 로직과 다양한 조회 요구사항</li><li>실시간 분석과 리포팅 요구사항</li><li>마이크로서비스 아키텍처에서의 데이터 분산 관리</li></ul><hr><h2 id=7-주요-기능-및-역할>7. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#7-주요-기능-및-역할>#</a></h2><h3 id=command-side-명령-측>Command Side (명령 측)<a hidden class=anchor aria-hidden=true href=#command-side-명령-측>#</a></h3><ul><li>비즈니스 로직 실행 및 검증</li><li>도메인 모델 상태 변경</li><li>트랜잭션 무결성 보장</li><li>이벤트 발행 (Event Sourcing 사용 시)</li></ul><h3 id=query-side-조회-측>Query Side (조회 측)<a hidden class=anchor aria-hidden=true href=#query-side-조회-측>#</a></h3><ul><li>최적화된 데이터 조회</li><li>다양한 View Model 제공</li><li>읽기 성능 최적화</li><li>캐싱 및 비정규화된 데이터 활용</li></ul><hr><h2 id=8-특징>8. 특징<a hidden class=anchor aria-hidden=true href=#8-특징>#</a></h2><ul><li><strong>책임 분리</strong>: Command와 Query의 명확한 분리</li><li><strong>독립적 확장</strong>: 읽기와 쓰기 시스템의 독립적 확장 가능</li><li><strong>기술 다양성</strong>: 각 모델에 최적화된 서로 다른 기술 스택 사용 가능</li><li><strong>최종 일관성</strong>: Read Model과 Write Model 간의 비동기 동기화</li><li><strong>이벤트 기반</strong>: Event Sourcing과의 자연스러운 결합</li></ul><hr><h2 id=9-핵심-원칙>9. 핵심 원칙<a hidden class=anchor aria-hidden=true href=#9-핵심-원칙>#</a></h2><ol><li><strong>단일 책임 원칙</strong>: Command와 Query는 각각 하나의 책임만 가짐</li><li><strong>분리 원칙</strong>: 읽기와 쓰기 모델의 물리적/논리적 분리</li><li><strong>최적화 원칙</strong>: 각 모델을 해당 작업에 최적화</li><li><strong>일관성 원칙</strong>: 비즈니스 요구사항에 맞는 일관성 수준 제공</li></ol><hr><h2 id=10-주요-원리-및-작동-원리>10. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#10-주요-원리-및-작동-원리>#</a></h2><pre class=mermaid>graph TD
    A[Client] --&gt; B{Request Type}
    B --&gt;|Command| C[Command Handler]
    B --&gt;|Query| D[Query Handler]
    
    C --&gt; E[Write Model]
    E --&gt; F[Write Database]
    F --&gt; G[Event Publication]
    G --&gt; H[Event Handler]
    H --&gt; I[Read Model Update]
    
    D --&gt; J[Read Model]
    J --&gt; K[Read Database]
    
    subgraph &#34;Command Side&#34;
        C
        E
        F
    end
    
    subgraph &#34;Query Side&#34;
        D
        J
        K
    end
    
    subgraph &#34;Synchronization&#34;
        G
        H
        I
    end
</pre><h3 id=작동-과정>작동 과정<a hidden class=anchor aria-hidden=true href=#작동-과정>#</a></h3><ol><li><strong>Command 처리</strong>: Client에서 Command 전송 → Command Handler가 비즈니스 로직 실행 → Write Model 업데이트</li><li><strong>이벤트 발행</strong>: Write Model 변경 시 이벤트 발행</li><li><strong>Read Model 동기화</strong>: Event Handler가 이벤트를 받아 Read Model 업데이트</li><li><strong>Query 처리</strong>: Client에서 Query 전송 → Query Handler가 Read Model에서 데이터 조회</li></ol><hr><h2 id=11-구조-및-아키텍처-1>11. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처-1>#</a></h2><h3 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Command Handler</td><td>명령 처리</td><td>비즈니스 로직 실행 및 검증</td><td>상태 변경, 트랜잭션 관리</td></tr><tr><td>Query Handler</td><td>조회 처리</td><td>데이터 조회 및 반환</td><td>읽기 최적화, 캐싱 활용</td></tr><tr><td>Write Model</td><td>쓰기 모델</td><td>도메인 객체 및 비즈니스 로직</td><td>정규화된 구조, 일관성 보장</td></tr><tr><td>Read Model</td><td>읽기 모델</td><td>조회용 데이터 구조</td><td>비정규화된 구조, 성능 최적화</td></tr></tbody></table><h3 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Event Store</td><td>이벤트 저장</td><td>모든 도메인 이벤트 영구 저장</td><td>Event Sourcing 지원</td></tr><tr><td>Message Bus</td><td>메시지 라우팅</td><td>Command/Query를 적절한 Handler로 전달</td><td>확장성 및 유연성 제공</td></tr><tr><td>Projection Service</td><td>프로젝션 생성</td><td>Event에서 Read Model 생성</td><td>실시간 또는 배치 처리</td></tr><tr><td>Snapshot Store</td><td>스냅샷 저장</td><td>성능 최적화를 위한 상태 스냅샷</td><td>이벤트 재생 최적화</td></tr></tbody></table><h3 id=아키텍처-다이어그램>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        UI[User Interface]
        API[API Gateway]
    end
    
    subgraph &#34;Application Layer&#34;
        CB[Command Bus]
        QB[Query Bus]
        CH[Command Handlers]
        QH[Query Handlers]
    end
    
    subgraph &#34;Write Side&#34;
        WM[Write Model]
        WDB[(Write Database)]
        ES[(Event Store)]
    end
    
    subgraph &#34;Read Side&#34;
        RM1[Read Model 1]
        RM2[Read Model 2]
        RDB1[(Read Database 1)]
        RDB2[(Read Database 2)]
    end
    
    subgraph &#34;Infrastructure&#34;
        MB[Message Broker]
        EH[Event Handlers]
        PS[Projection Service]
    end
    
    UI --&gt; API
    API --&gt; CB
    API --&gt; QB
    
    CB --&gt; CH
    QB --&gt; QH
    
    CH --&gt; WM
    WM --&gt; WDB
    WM --&gt; ES
    
    ES --&gt; MB
    MB --&gt; EH
    EH --&gt; PS
    PS --&gt; RM1
    PS --&gt; RM2
    
    QH --&gt; RM1
    QH --&gt; RM2
    RM1 --&gt; RDB1
    RM2 --&gt; RDB2
</pre><hr><h2 id=12-구현-기법-1>12. 구현 기법<a hidden class=anchor aria-hidden=true href=#12-구현-기법-1>#</a></h2><h3 id=1-기본-cqrs-shared-database>1. 기본 CQRS (Shared Database)<a hidden class=anchor aria-hidden=true href=#1-기본-cqrs-shared-database>#</a></h3><p><strong>정의</strong>: 단일 데이터베이스를 사용하되 읽기와 쓰기 로직을 분리하는 방식</p><p><strong>구성</strong>:</p><ul><li>공통 데이터베이스</li><li>분리된 Command/Query Handler</li><li>서로 다른 도메인 모델과 DTO</li></ul><p><strong>목적</strong>: 복잡성 최소화하면서 읽기/쓰기 최적화</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-84-1><a class=lnlinks href=#hl-84-1> 1</a>
</span><span class=lnt id=hl-84-2><a class=lnlinks href=#hl-84-2> 2</a>
</span><span class=lnt id=hl-84-3><a class=lnlinks href=#hl-84-3> 3</a>
</span><span class=lnt id=hl-84-4><a class=lnlinks href=#hl-84-4> 4</a>
</span><span class=lnt id=hl-84-5><a class=lnlinks href=#hl-84-5> 5</a>
</span><span class=lnt id=hl-84-6><a class=lnlinks href=#hl-84-6> 6</a>
</span><span class=lnt id=hl-84-7><a class=lnlinks href=#hl-84-7> 7</a>
</span><span class=lnt id=hl-84-8><a class=lnlinks href=#hl-84-8> 8</a>
</span><span class=lnt id=hl-84-9><a class=lnlinks href=#hl-84-9> 9</a>
</span><span class=lnt id=hl-84-10><a class=lnlinks href=#hl-84-10>10</a>
</span><span class=lnt id=hl-84-11><a class=lnlinks href=#hl-84-11>11</a>
</span><span class=lnt id=hl-84-12><a class=lnlinks href=#hl-84-12>12</a>
</span><span class=lnt id=hl-84-13><a class=lnlinks href=#hl-84-13>13</a>
</span><span class=lnt id=hl-84-14><a class=lnlinks href=#hl-84-14>14</a>
</span><span class=lnt id=hl-84-15><a class=lnlinks href=#hl-84-15>15</a>
</span><span class=lnt id=hl-84-16><a class=lnlinks href=#hl-84-16>16</a>
</span><span class=lnt id=hl-84-17><a class=lnlinks href=#hl-84-17>17</a>
</span><span class=lnt id=hl-84-18><a class=lnlinks href=#hl-84-18>18</a>
</span><span class=lnt id=hl-84-19><a class=lnlinks href=#hl-84-19>19</a>
</span><span class=lnt id=hl-84-20><a class=lnlinks href=#hl-84-20>20</a>
</span><span class=lnt id=hl-84-21><a class=lnlinks href=#hl-84-21>21</a>
</span><span class=lnt id=hl-84-22><a class=lnlinks href=#hl-84-22>22</a>
</span><span class=lnt id=hl-84-23><a class=lnlinks href=#hl-84-23>23</a>
</span><span class=lnt id=hl-84-24><a class=lnlinks href=#hl-84-24>24</a>
</span><span class=lnt id=hl-84-25><a class=lnlinks href=#hl-84-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Command Side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>CreateOrderCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>customerId</span> <span class=o>=</span> <span class=nx>customerId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Order</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>command</span><span class=p>.</span><span class=nx>items</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderRepository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=k>new</span> <span class=nx>OrderCreatedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query Side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrderSummary</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>database</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SELECT o.id, o.total, c.name FROM orders o JOIN customers c ON o.customer_id = c.id WHERE o.id = ?&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=nx>orderId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-분리된-데이터베이스-cqrs>2. 분리된 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#2-분리된-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 읽기와 쓰기에 별도의 데이터베이스를 사용하는 방식</p><p><strong>구성</strong>:</p><ul><li>Write Database (트랜잭션 최적화)</li><li>Read Database (쿼리 최적화)</li><li>데이터 동기화 메커니즘</li></ul><p><strong>목적</strong>: 각 데이터베이스를 해당 작업에 최적화</p><p><strong>실제 예시</strong>:</p><ul><li>Write: PostgreSQL (ACID 트랜잭션)</li><li>Read: MongoDB (문서 기반 빠른 조회)</li><li>동기화: Apache Kafka를 통한 이벤트 스트리밍</li></ul><h3 id=3-event-sourcing--cqrs>3. Event Sourcing + CQRS<a hidden class=anchor aria-hidden=true href=#3-event-sourcing--cqrs>#</a></h3><p><strong>정의</strong>: 이벤트 스토어를 Write Model로 사용하고 이벤트로부터 Read Model을 구성하는 방식</p><p><strong>구성</strong>:</p><ul><li>Event Store (Write Model)</li><li>Projection Engine</li><li>Materialized Views (Read Model)</li></ul><p><strong>목적</strong>: 완전한 감사 추적과 시간 여행 기능 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-85-1><a class=lnlinks href=#hl-85-1> 1</a>
</span><span class=lnt id=hl-85-2><a class=lnlinks href=#hl-85-2> 2</a>
</span><span class=lnt id=hl-85-3><a class=lnlinks href=#hl-85-3> 3</a>
</span><span class=lnt id=hl-85-4><a class=lnlinks href=#hl-85-4> 4</a>
</span><span class=lnt id=hl-85-5><a class=lnlinks href=#hl-85-5> 5</a>
</span><span class=lnt id=hl-85-6><a class=lnlinks href=#hl-85-6> 6</a>
</span><span class=lnt id=hl-85-7><a class=lnlinks href=#hl-85-7> 7</a>
</span><span class=lnt id=hl-85-8><a class=lnlinks href=#hl-85-8> 8</a>
</span><span class=lnt id=hl-85-9><a class=lnlinks href=#hl-85-9> 9</a>
</span><span class=lnt id=hl-85-10><a class=lnlinks href=#hl-85-10>10</a>
</span><span class=lnt id=hl-85-11><a class=lnlinks href=#hl-85-11>11</a>
</span><span class=lnt id=hl-85-12><a class=lnlinks href=#hl-85-12>12</a>
</span><span class=lnt id=hl-85-13><a class=lnlinks href=#hl-85-13>13</a>
</span><span class=lnt id=hl-85-14><a class=lnlinks href=#hl-85-14>14</a>
</span><span class=lnt id=hl-85-15><a class=lnlinks href=#hl-85-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>,</span> <span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>store_event</span><span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>order_view</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_name&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>customer_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;Created&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=s1>&#39;order_views&#39;</span><span class=p>,</span> <span class=n>order_view</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=13-장점-1>13. 장점<a hidden class=anchor aria-hidden=true href=#13-장점-1>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 최적화</td><td>읽기와 쓰기 모델을 각각에 특화되도록 설계하여 전체적인 시스템 성능 향상</td></tr><tr><td>장점</td><td>독립적 확장성</td><td>Command와 Query 처리를 독립적으로 확장 가능하여 비용 효율적인 리소스 관리</td></tr><tr><td>장점</td><td>기술 선택의 자유</td><td>읽기와 쓰기에 각각 최적화된 서로 다른 데이터베이스 및 기술 스택 사용 가능</td></tr><tr><td>장점</td><td>복잡성 분리</td><td>비즈니스 로직과 조회 로직을 분리하여 각각의 복잡성을 독립적으로 관리</td></tr><tr><td>장점</td><td>다양한 View 지원</td><td>동일한 데이터로부터 다양한 읽기 요구사항에 맞는 여러 Read Model 생성 가능</td></tr><tr><td>장점</td><td>보안 향상</td><td>읽기와 쓰기 권한을 별도로 관리하여 세밀한 접근 제어 가능</td></tr><tr><td>장점</td><td>유지보수성</td><td>명확한 책임 분리로 인한 코드의 가독성과 유지보수성 향상</td></tr></tbody></table><hr><h2 id=14-단점과-문제점-그리고-해결방안-1>14. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#14-단점과-문제점-그리고-해결방안-1>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>별도의 읽기/쓰기 모델 관리로 인한 아키텍처 복잡성 증가</td><td>점진적 도입, 명확한 설계 가이드라인 수립</td></tr><tr><td>단점</td><td>데이터 일관성</td><td>Read Model과 Write Model 간의 최종 일관성으로 인한 데이터 불일치</td><td>비즈니스 요구사항에 맞는 일관성 수준 정의, 보상 트랜잭션 구현</td></tr><tr><td>단점</td><td>개발 오버헤드</td><td>중복된 코드와 모델로 인한 개발 시간 증가</td><td>코드 생성 도구 활용, 공통 라이브러리 구축</td></tr><tr><td>단점</td><td>운영 복잡성</td><td>여러 데이터베이스와 동기화 메커니즘 관리 필요</td><td>모니터링 도구 구축, 자동화된 배포 파이프라인</td></tr></tbody></table><h3 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>동기화 지연</td><td>네트워크 지연, 메시지 브로커 성능</td><td>사용자가 최신 데이터를 볼 수 없음</td><td>지연 시간 모니터링, 알림 설정</td><td>성능 테스트, 적절한 인프라 용량 계획</td><td>배치 처리 최적화, 캐싱 전략</td></tr><tr><td>문제점</td><td>메시지 손실</td><td>시스템 장애, 네트워크 오류</td><td>데이터 불일치, 비즈니스 로직 오류</td><td>메시지 추적, 상태 검증</td><td>메시지 지속성 보장, 중복 제거 메커니즘</td><td>재처리 로직, Dead Letter Queue</td></tr><tr><td>문제점</td><td>순환 의존성</td><td>잘못된 아키텍처 설계</td><td>시스템 데드락, 무한 루프</td><td>의존성 분석 도구</td><td>명확한 아키텍처 경계 정의</td><td>이벤트 체인 재설계, 의존성 역전</td></tr><tr><td>문제점</td><td>스키마 불일치</td><td>모델 진화 과정에서 발생</td><td>데이터 직렬화 오류</td><td>스키마 버전 관리</td><td>스키마 진화 전략 수립</td><td>백워드 호환성 유지, 마이그레이션 도구</td></tr></tbody></table><hr><h2 id=15-도전-과제-1>15. 도전 과제<a hidden class=anchor aria-hidden=true href=#15-도전-과제-1>#</a></h2><h3 id=기술적-도전-과제>기술적 도전 과제<a hidden class=anchor aria-hidden=true href=#기술적-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결 방법</th></tr></thead><tbody><tr><td>데이터 일관성</td><td>분산 트랜잭션 관리</td><td>여러 데이터베이스 간 ACID 보장 어려움</td><td>데이터 무결성 위험</td><td>Saga 패턴, 2PC 프로토콜</td></tr><tr><td>성능 최적화</td><td>이벤트 스트림 처리</td><td>대용량 이벤트 처리 성능</td><td>시스템 지연 및 병목</td><td>스트림 파티셔닝, 병렬 처리</td></tr><tr><td>모니터링</td><td>분산 시스템 추적</td><td>복잡한 데이터 플로우</td><td>장애 진단 어려움</td><td>분산 추적, 로깅 표준화</td></tr></tbody></table><h3 id=비즈니스-도전-과제>비즈니스 도전 과제<a hidden class=anchor aria-hidden=true href=#비즈니스-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결 방법</th></tr></thead><tbody><tr><td>조직 변화</td><td>팀 구조 재편</td><td>새로운 책임 분리 모델</td><td>개발 프로세스 변화</td><td>Conway&rsquo;s Law 적용, 팀 역할 재정의</td></tr><tr><td>기술 부채</td><td>레거시 시스템 통합</td><td>기존 CRUD 시스템과의 호환성</td><td>마이그레이션 복잡성</td><td>점진적 마이그레이션, Strangler Fig 패턴</td></tr><tr><td>비용 관리</td><td>인프라 비용 증가</td><td>여러 데이터베이스 및 서비스</td><td>운영 비용 상승</td><td>클라우드 네이티브 솔루션, 자동 확장</td></tr></tbody></table><hr><h2 id=16-분류-기준에-따른-종류-및-유형-1>16. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-종류-및-유형-1>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 사례</th></tr></thead><tbody><tr><td>데이터베이스 분리 수준</td><td>논리적 분리</td><td>동일 DB, 다른 스키마/테이블</td><td>단순한 읽기/쓰기 최적화</td></tr><tr><td>데이터베이스 분리 수준</td><td>물리적 분리</td><td>완전히 다른 데이터베이스</td><td>고성능, 고가용성 요구사항</td></tr><tr><td>이벤트 처리 방식</td><td>동기 CQRS</td><td>실시간 동기화</td><td>강한 일관성 요구 시스템</td></tr><tr><td>이벤트 처리 방식</td><td>비동기 CQRS</td><td>이벤트 기반 비동기 처리</td><td>높은 처리량 요구 시스템</td></tr><tr><td>복잡성 수준</td><td>단순 CQRS</td><td>기본적인 읽기/쓰기 분리</td><td>CRUD 개선이 목적인 시스템</td></tr><tr><td>복잡성 수준</td><td>완전 CQRS</td><td>Event Sourcing과 결합</td><td>복잡한 도메인, 감사 요구사항</td></tr><tr><td>기술 스택</td><td>동종 기술</td><td>같은 종류의 데이터베이스</td><td>기술 스택 단순화</td></tr><tr><td>기술 스택</td><td>이종 기술</td><td>서로 다른 데이터베이스</td><td>각 용도에 최적화</td></tr></tbody></table><hr><h2 id=17-실무-사용-예시-1>17. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시-1>#</a></h2><table><thead><tr><th>사용 목적</th><th>함께 사용되는 기술</th><th>효과</th><th>적용 분야</th></tr></thead><tbody><tr><td>고성능 읽기 처리</td><td>Redis Cache, Elasticsearch</td><td>조회 성능 100배 향상</td><td>전자상거래 상품 검색</td></tr><tr><td>실시간 분석</td><td>Apache Kafka, ClickHouse</td><td>실시간 대시보드 제공</td><td>금융 거래 모니터링</td></tr><tr><td>감사 추적</td><td>Event Store, PostgreSQL</td><td>완전한 감사 로그</td><td>의료 기록 관리</td></tr><tr><td>마이크로서비스 통합</td><td>API Gateway, Service Mesh</td><td>서비스 간 결합도 감소</td><td>대규모 분산 시스템</td></tr><tr><td>다중 채널 지원</td><td>GraphQL, REST API</td><td>채널별 최적화된 데이터 제공</td><td>옴니채널 플랫폼</td></tr><tr><td>성능 최적화</td><td>읽기 전용 복제본, CDN</td><td>글로벌 응답 시간 단축</td><td>소셜 미디어 플랫폼</td></tr></tbody></table><hr><h2 id=18-활용-사례-1>18. 활용 사례<a hidden class=anchor aria-hidden=true href=#18-활용-사례-1>#</a></h2><h3 id=netflix의-동영상-추천-시스템>Netflix의 동영상 추천 시스템<a hidden class=anchor aria-hidden=true href=#netflix의-동영상-추천-시스템>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>Command Side</strong>: 사용자 시청 기록, 평점 데이터 처리</li><li><strong>Query Side</strong>: 개인화된 추천 리스트 제공</li><li><strong>Event Store</strong>: 모든 사용자 상호작용 이벤트 저장</li><li><strong>Read Models</strong>: 장르별, 인기도별, 개인화 추천 모델</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Netflix CQRS Architecture&#34;
        U[User] --&gt; API[API Gateway]
        
        subgraph &#34;Command Side&#34;
            API --&gt; CH[Command Handler]
            CH --&gt; WM[Write Model]
            WM --&gt; ES[(Event Store)]
            WM --&gt; UDB[(User Database)]
        end
        
        subgraph &#34;Event Processing&#34;
            ES --&gt; KF[Kafka]
            KF --&gt; EP[Event Processors]
        end
        
        subgraph &#34;Query Side&#34;
            API --&gt; QH[Query Handler]
            QH --&gt; RM1[Recommendation Model]
            QH --&gt; RM2[User Profile Model]
            QH --&gt; RM3[Content Catalog Model]
            
            RM1 --&gt; RDB1[(Recommendation DB)]
            RM2 --&gt; RDB2[(Profile DB)]
            RM3 --&gt; RDB3[(Catalog DB)]
        end
        
        EP --&gt; RM1
        EP --&gt; RM2
        EP --&gt; RM3
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 시청 이벤트 발생 → Command Handler 처리</li><li>이벤트 저장 및 Kafka로 발행</li><li>추천 엔진이 이벤트 처리하여 Read Model 업데이트</li><li>사용자 요청 시 Query Handler가 개인화된 추천 리스트 반환</li></ol><p><strong>CQRS 역할</strong>:</p><ul><li><strong>쓰기 최적화</strong>: 대용량 사용자 이벤트 실시간 처리</li><li><strong>읽기 최적화</strong>: 밀리초 단위 추천 결과 제공</li><li><strong>확장성</strong>: 읽기와 쓰기 트래픽을 독립적으로 확장</li></ul><p><strong>기존 시스템과의 차이점</strong>:</p><ul><li><strong>전통적 방식</strong>: 실시간 계산으로 인한 지연 발생</li><li><strong>CQRS 방식</strong>: 미리 계산된 추천 결과로 즉시 응답</li><li><strong>데이터 일관성</strong>: 최종 일관성으로 실시간성 확보</li></ul><hr><h2 id=19-구현-예시-1>19. 구현 예시<a hidden class=anchor aria-hidden=true href=#19-구현-예시-1>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-87-1><a class=lnlinks href=#hl-87-1>  1</a>
</span><span class=lnt id=hl-87-2><a class=lnlinks href=#hl-87-2>  2</a>
</span><span class=lnt id=hl-87-3><a class=lnlinks href=#hl-87-3>  3</a>
</span><span class=lnt id=hl-87-4><a class=lnlinks href=#hl-87-4>  4</a>
</span><span class=lnt id=hl-87-5><a class=lnlinks href=#hl-87-5>  5</a>
</span><span class=lnt id=hl-87-6><a class=lnlinks href=#hl-87-6>  6</a>
</span><span class=lnt id=hl-87-7><a class=lnlinks href=#hl-87-7>  7</a>
</span><span class=lnt id=hl-87-8><a class=lnlinks href=#hl-87-8>  8</a>
</span><span class=lnt id=hl-87-9><a class=lnlinks href=#hl-87-9>  9</a>
</span><span class=lnt id=hl-87-10><a class=lnlinks href=#hl-87-10> 10</a>
</span><span class=lnt id=hl-87-11><a class=lnlinks href=#hl-87-11> 11</a>
</span><span class=lnt id=hl-87-12><a class=lnlinks href=#hl-87-12> 12</a>
</span><span class=lnt id=hl-87-13><a class=lnlinks href=#hl-87-13> 13</a>
</span><span class=lnt id=hl-87-14><a class=lnlinks href=#hl-87-14> 14</a>
</span><span class=lnt id=hl-87-15><a class=lnlinks href=#hl-87-15> 15</a>
</span><span class=lnt id=hl-87-16><a class=lnlinks href=#hl-87-16> 16</a>
</span><span class=lnt id=hl-87-17><a class=lnlinks href=#hl-87-17> 17</a>
</span><span class=lnt id=hl-87-18><a class=lnlinks href=#hl-87-18> 18</a>
</span><span class=lnt id=hl-87-19><a class=lnlinks href=#hl-87-19> 19</a>
</span><span class=lnt id=hl-87-20><a class=lnlinks href=#hl-87-20> 20</a>
</span><span class=lnt id=hl-87-21><a class=lnlinks href=#hl-87-21> 21</a>
</span><span class=lnt id=hl-87-22><a class=lnlinks href=#hl-87-22> 22</a>
</span><span class=lnt id=hl-87-23><a class=lnlinks href=#hl-87-23> 23</a>
</span><span class=lnt id=hl-87-24><a class=lnlinks href=#hl-87-24> 24</a>
</span><span class=lnt id=hl-87-25><a class=lnlinks href=#hl-87-25> 25</a>
</span><span class=lnt id=hl-87-26><a class=lnlinks href=#hl-87-26> 26</a>
</span><span class=lnt id=hl-87-27><a class=lnlinks href=#hl-87-27> 27</a>
</span><span class=lnt id=hl-87-28><a class=lnlinks href=#hl-87-28> 28</a>
</span><span class=lnt id=hl-87-29><a class=lnlinks href=#hl-87-29> 29</a>
</span><span class=lnt id=hl-87-30><a class=lnlinks href=#hl-87-30> 30</a>
</span><span class=lnt id=hl-87-31><a class=lnlinks href=#hl-87-31> 31</a>
</span><span class=lnt id=hl-87-32><a class=lnlinks href=#hl-87-32> 32</a>
</span><span class=lnt id=hl-87-33><a class=lnlinks href=#hl-87-33> 33</a>
</span><span class=lnt id=hl-87-34><a class=lnlinks href=#hl-87-34> 34</a>
</span><span class=lnt id=hl-87-35><a class=lnlinks href=#hl-87-35> 35</a>
</span><span class=lnt id=hl-87-36><a class=lnlinks href=#hl-87-36> 36</a>
</span><span class=lnt id=hl-87-37><a class=lnlinks href=#hl-87-37> 37</a>
</span><span class=lnt id=hl-87-38><a class=lnlinks href=#hl-87-38> 38</a>
</span><span class=lnt id=hl-87-39><a class=lnlinks href=#hl-87-39> 39</a>
</span><span class=lnt id=hl-87-40><a class=lnlinks href=#hl-87-40> 40</a>
</span><span class=lnt id=hl-87-41><a class=lnlinks href=#hl-87-41> 41</a>
</span><span class=lnt id=hl-87-42><a class=lnlinks href=#hl-87-42> 42</a>
</span><span class=lnt id=hl-87-43><a class=lnlinks href=#hl-87-43> 43</a>
</span><span class=lnt id=hl-87-44><a class=lnlinks href=#hl-87-44> 44</a>
</span><span class=lnt id=hl-87-45><a class=lnlinks href=#hl-87-45> 45</a>
</span><span class=lnt id=hl-87-46><a class=lnlinks href=#hl-87-46> 46</a>
</span><span class=lnt id=hl-87-47><a class=lnlinks href=#hl-87-47> 47</a>
</span><span class=lnt id=hl-87-48><a class=lnlinks href=#hl-87-48> 48</a>
</span><span class=lnt id=hl-87-49><a class=lnlinks href=#hl-87-49> 49</a>
</span><span class=lnt id=hl-87-50><a class=lnlinks href=#hl-87-50> 50</a>
</span><span class=lnt id=hl-87-51><a class=lnlinks href=#hl-87-51> 51</a>
</span><span class=lnt id=hl-87-52><a class=lnlinks href=#hl-87-52> 52</a>
</span><span class=lnt id=hl-87-53><a class=lnlinks href=#hl-87-53> 53</a>
</span><span class=lnt id=hl-87-54><a class=lnlinks href=#hl-87-54> 54</a>
</span><span class=lnt id=hl-87-55><a class=lnlinks href=#hl-87-55> 55</a>
</span><span class=lnt id=hl-87-56><a class=lnlinks href=#hl-87-56> 56</a>
</span><span class=lnt id=hl-87-57><a class=lnlinks href=#hl-87-57> 57</a>
</span><span class=lnt id=hl-87-58><a class=lnlinks href=#hl-87-58> 58</a>
</span><span class=lnt id=hl-87-59><a class=lnlinks href=#hl-87-59> 59</a>
</span><span class=lnt id=hl-87-60><a class=lnlinks href=#hl-87-60> 60</a>
</span><span class=lnt id=hl-87-61><a class=lnlinks href=#hl-87-61> 61</a>
</span><span class=lnt id=hl-87-62><a class=lnlinks href=#hl-87-62> 62</a>
</span><span class=lnt id=hl-87-63><a class=lnlinks href=#hl-87-63> 63</a>
</span><span class=lnt id=hl-87-64><a class=lnlinks href=#hl-87-64> 64</a>
</span><span class=lnt id=hl-87-65><a class=lnlinks href=#hl-87-65> 65</a>
</span><span class=lnt id=hl-87-66><a class=lnlinks href=#hl-87-66> 66</a>
</span><span class=lnt id=hl-87-67><a class=lnlinks href=#hl-87-67> 67</a>
</span><span class=lnt id=hl-87-68><a class=lnlinks href=#hl-87-68> 68</a>
</span><span class=lnt id=hl-87-69><a class=lnlinks href=#hl-87-69> 69</a>
</span><span class=lnt id=hl-87-70><a class=lnlinks href=#hl-87-70> 70</a>
</span><span class=lnt id=hl-87-71><a class=lnlinks href=#hl-87-71> 71</a>
</span><span class=lnt id=hl-87-72><a class=lnlinks href=#hl-87-72> 72</a>
</span><span class=lnt id=hl-87-73><a class=lnlinks href=#hl-87-73> 73</a>
</span><span class=lnt id=hl-87-74><a class=lnlinks href=#hl-87-74> 74</a>
</span><span class=lnt id=hl-87-75><a class=lnlinks href=#hl-87-75> 75</a>
</span><span class=lnt id=hl-87-76><a class=lnlinks href=#hl-87-76> 76</a>
</span><span class=lnt id=hl-87-77><a class=lnlinks href=#hl-87-77> 77</a>
</span><span class=lnt id=hl-87-78><a class=lnlinks href=#hl-87-78> 78</a>
</span><span class=lnt id=hl-87-79><a class=lnlinks href=#hl-87-79> 79</a>
</span><span class=lnt id=hl-87-80><a class=lnlinks href=#hl-87-80> 80</a>
</span><span class=lnt id=hl-87-81><a class=lnlinks href=#hl-87-81> 81</a>
</span><span class=lnt id=hl-87-82><a class=lnlinks href=#hl-87-82> 82</a>
</span><span class=lnt id=hl-87-83><a class=lnlinks href=#hl-87-83> 83</a>
</span><span class=lnt id=hl-87-84><a class=lnlinks href=#hl-87-84> 84</a>
</span><span class=lnt id=hl-87-85><a class=lnlinks href=#hl-87-85> 85</a>
</span><span class=lnt id=hl-87-86><a class=lnlinks href=#hl-87-86> 86</a>
</span><span class=lnt id=hl-87-87><a class=lnlinks href=#hl-87-87> 87</a>
</span><span class=lnt id=hl-87-88><a class=lnlinks href=#hl-87-88> 88</a>
</span><span class=lnt id=hl-87-89><a class=lnlinks href=#hl-87-89> 89</a>
</span><span class=lnt id=hl-87-90><a class=lnlinks href=#hl-87-90> 90</a>
</span><span class=lnt id=hl-87-91><a class=lnlinks href=#hl-87-91> 91</a>
</span><span class=lnt id=hl-87-92><a class=lnlinks href=#hl-87-92> 92</a>
</span><span class=lnt id=hl-87-93><a class=lnlinks href=#hl-87-93> 93</a>
</span><span class=lnt id=hl-87-94><a class=lnlinks href=#hl-87-94> 94</a>
</span><span class=lnt id=hl-87-95><a class=lnlinks href=#hl-87-95> 95</a>
</span><span class=lnt id=hl-87-96><a class=lnlinks href=#hl-87-96> 96</a>
</span><span class=lnt id=hl-87-97><a class=lnlinks href=#hl-87-97> 97</a>
</span><span class=lnt id=hl-87-98><a class=lnlinks href=#hl-87-98> 98</a>
</span><span class=lnt id=hl-87-99><a class=lnlinks href=#hl-87-99> 99</a>
</span><span class=lnt id=hl-87-100><a class=lnlinks href=#hl-87-100>100</a>
</span><span class=lnt id=hl-87-101><a class=lnlinks href=#hl-87-101>101</a>
</span><span class=lnt id=hl-87-102><a class=lnlinks href=#hl-87-102>102</a>
</span><span class=lnt id=hl-87-103><a class=lnlinks href=#hl-87-103>103</a>
</span><span class=lnt id=hl-87-104><a class=lnlinks href=#hl-87-104>104</a>
</span><span class=lnt id=hl-87-105><a class=lnlinks href=#hl-87-105>105</a>
</span><span class=lnt id=hl-87-106><a class=lnlinks href=#hl-87-106>106</a>
</span><span class=lnt id=hl-87-107><a class=lnlinks href=#hl-87-107>107</a>
</span><span class=lnt id=hl-87-108><a class=lnlinks href=#hl-87-108>108</a>
</span><span class=lnt id=hl-87-109><a class=lnlinks href=#hl-87-109>109</a>
</span><span class=lnt id=hl-87-110><a class=lnlinks href=#hl-87-110>110</a>
</span><span class=lnt id=hl-87-111><a class=lnlinks href=#hl-87-111>111</a>
</span><span class=lnt id=hl-87-112><a class=lnlinks href=#hl-87-112>112</a>
</span><span class=lnt id=hl-87-113><a class=lnlinks href=#hl-87-113>113</a>
</span><span class=lnt id=hl-87-114><a class=lnlinks href=#hl-87-114>114</a>
</span><span class=lnt id=hl-87-115><a class=lnlinks href=#hl-87-115>115</a>
</span><span class=lnt id=hl-87-116><a class=lnlinks href=#hl-87-116>116</a>
</span><span class=lnt id=hl-87-117><a class=lnlinks href=#hl-87-117>117</a>
</span><span class=lnt id=hl-87-118><a class=lnlinks href=#hl-87-118>118</a>
</span><span class=lnt id=hl-87-119><a class=lnlinks href=#hl-87-119>119</a>
</span><span class=lnt id=hl-87-120><a class=lnlinks href=#hl-87-120>120</a>
</span><span class=lnt id=hl-87-121><a class=lnlinks href=#hl-87-121>121</a>
</span><span class=lnt id=hl-87-122><a class=lnlinks href=#hl-87-122>122</a>
</span><span class=lnt id=hl-87-123><a class=lnlinks href=#hl-87-123>123</a>
</span><span class=lnt id=hl-87-124><a class=lnlinks href=#hl-87-124>124</a>
</span><span class=lnt id=hl-87-125><a class=lnlinks href=#hl-87-125>125</a>
</span><span class=lnt id=hl-87-126><a class=lnlinks href=#hl-87-126>126</a>
</span><span class=lnt id=hl-87-127><a class=lnlinks href=#hl-87-127>127</a>
</span><span class=lnt id=hl-87-128><a class=lnlinks href=#hl-87-128>128</a>
</span><span class=lnt id=hl-87-129><a class=lnlinks href=#hl-87-129>129</a>
</span><span class=lnt id=hl-87-130><a class=lnlinks href=#hl-87-130>130</a>
</span><span class=lnt id=hl-87-131><a class=lnlinks href=#hl-87-131>131</a>
</span><span class=lnt id=hl-87-132><a class=lnlinks href=#hl-87-132>132</a>
</span><span class=lnt id=hl-87-133><a class=lnlinks href=#hl-87-133>133</a>
</span><span class=lnt id=hl-87-134><a class=lnlinks href=#hl-87-134>134</a>
</span><span class=lnt id=hl-87-135><a class=lnlinks href=#hl-87-135>135</a>
</span><span class=lnt id=hl-87-136><a class=lnlinks href=#hl-87-136>136</a>
</span><span class=lnt id=hl-87-137><a class=lnlinks href=#hl-87-137>137</a>
</span><span class=lnt id=hl-87-138><a class=lnlinks href=#hl-87-138>138</a>
</span><span class=lnt id=hl-87-139><a class=lnlinks href=#hl-87-139>139</a>
</span><span class=lnt id=hl-87-140><a class=lnlinks href=#hl-87-140>140</a>
</span><span class=lnt id=hl-87-141><a class=lnlinks href=#hl-87-141>141</a>
</span><span class=lnt id=hl-87-142><a class=lnlinks href=#hl-87-142>142</a>
</span><span class=lnt id=hl-87-143><a class=lnlinks href=#hl-87-143>143</a>
</span><span class=lnt id=hl-87-144><a class=lnlinks href=#hl-87-144>144</a>
</span><span class=lnt id=hl-87-145><a class=lnlinks href=#hl-87-145>145</a>
</span><span class=lnt id=hl-87-146><a class=lnlinks href=#hl-87-146>146</a>
</span><span class=lnt id=hl-87-147><a class=lnlinks href=#hl-87-147>147</a>
</span><span class=lnt id=hl-87-148><a class=lnlinks href=#hl-87-148>148</a>
</span><span class=lnt id=hl-87-149><a class=lnlinks href=#hl-87-149>149</a>
</span><span class=lnt id=hl-87-150><a class=lnlinks href=#hl-87-150>150</a>
</span><span class=lnt id=hl-87-151><a class=lnlinks href=#hl-87-151>151</a>
</span><span class=lnt id=hl-87-152><a class=lnlinks href=#hl-87-152>152</a>
</span><span class=lnt id=hl-87-153><a class=lnlinks href=#hl-87-153>153</a>
</span><span class=lnt id=hl-87-154><a class=lnlinks href=#hl-87-154>154</a>
</span><span class=lnt id=hl-87-155><a class=lnlinks href=#hl-87-155>155</a>
</span><span class=lnt id=hl-87-156><a class=lnlinks href=#hl-87-156>156</a>
</span><span class=lnt id=hl-87-157><a class=lnlinks href=#hl-87-157>157</a>
</span><span class=lnt id=hl-87-158><a class=lnlinks href=#hl-87-158>158</a>
</span><span class=lnt id=hl-87-159><a class=lnlinks href=#hl-87-159>159</a>
</span><span class=lnt id=hl-87-160><a class=lnlinks href=#hl-87-160>160</a>
</span><span class=lnt id=hl-87-161><a class=lnlinks href=#hl-87-161>161</a>
</span><span class=lnt id=hl-87-162><a class=lnlinks href=#hl-87-162>162</a>
</span><span class=lnt id=hl-87-163><a class=lnlinks href=#hl-87-163>163</a>
</span><span class=lnt id=hl-87-164><a class=lnlinks href=#hl-87-164>164</a>
</span><span class=lnt id=hl-87-165><a class=lnlinks href=#hl-87-165>165</a>
</span><span class=lnt id=hl-87-166><a class=lnlinks href=#hl-87-166>166</a>
</span><span class=lnt id=hl-87-167><a class=lnlinks href=#hl-87-167>167</a>
</span><span class=lnt id=hl-87-168><a class=lnlinks href=#hl-87-168>168</a>
</span><span class=lnt id=hl-87-169><a class=lnlinks href=#hl-87-169>169</a>
</span><span class=lnt id=hl-87-170><a class=lnlinks href=#hl-87-170>170</a>
</span><span class=lnt id=hl-87-171><a class=lnlinks href=#hl-87-171>171</a>
</span><span class=lnt id=hl-87-172><a class=lnlinks href=#hl-87-172>172</a>
</span><span class=lnt id=hl-87-173><a class=lnlinks href=#hl-87-173>173</a>
</span><span class=lnt id=hl-87-174><a class=lnlinks href=#hl-87-174>174</a>
</span><span class=lnt id=hl-87-175><a class=lnlinks href=#hl-87-175>175</a>
</span><span class=lnt id=hl-87-176><a class=lnlinks href=#hl-87-176>176</a>
</span><span class=lnt id=hl-87-177><a class=lnlinks href=#hl-87-177>177</a>
</span><span class=lnt id=hl-87-178><a class=lnlinks href=#hl-87-178>178</a>
</span><span class=lnt id=hl-87-179><a class=lnlinks href=#hl-87-179>179</a>
</span><span class=lnt id=hl-87-180><a class=lnlinks href=#hl-87-180>180</a>
</span><span class=lnt id=hl-87-181><a class=lnlinks href=#hl-87-181>181</a>
</span><span class=lnt id=hl-87-182><a class=lnlinks href=#hl-87-182>182</a>
</span><span class=lnt id=hl-87-183><a class=lnlinks href=#hl-87-183>183</a>
</span><span class=lnt id=hl-87-184><a class=lnlinks href=#hl-87-184>184</a>
</span><span class=lnt id=hl-87-185><a class=lnlinks href=#hl-87-185>185</a>
</span><span class=lnt id=hl-87-186><a class=lnlinks href=#hl-87-186>186</a>
</span><span class=lnt id=hl-87-187><a class=lnlinks href=#hl-87-187>187</a>
</span><span class=lnt id=hl-87-188><a class=lnlinks href=#hl-87-188>188</a>
</span><span class=lnt id=hl-87-189><a class=lnlinks href=#hl-87-189>189</a>
</span><span class=lnt id=hl-87-190><a class=lnlinks href=#hl-87-190>190</a>
</span><span class=lnt id=hl-87-191><a class=lnlinks href=#hl-87-191>191</a>
</span><span class=lnt id=hl-87-192><a class=lnlinks href=#hl-87-192>192</a>
</span><span class=lnt id=hl-87-193><a class=lnlinks href=#hl-87-193>193</a>
</span><span class=lnt id=hl-87-194><a class=lnlinks href=#hl-87-194>194</a>
</span><span class=lnt id=hl-87-195><a class=lnlinks href=#hl-87-195>195</a>
</span><span class=lnt id=hl-87-196><a class=lnlinks href=#hl-87-196>196</a>
</span><span class=lnt id=hl-87-197><a class=lnlinks href=#hl-87-197>197</a>
</span><span class=lnt id=hl-87-198><a class=lnlinks href=#hl-87-198>198</a>
</span><span class=lnt id=hl-87-199><a class=lnlinks href=#hl-87-199>199</a>
</span><span class=lnt id=hl-87-200><a class=lnlinks href=#hl-87-200>200</a>
</span><span class=lnt id=hl-87-201><a class=lnlinks href=#hl-87-201>201</a>
</span><span class=lnt id=hl-87-202><a class=lnlinks href=#hl-87-202>202</a>
</span><span class=lnt id=hl-87-203><a class=lnlinks href=#hl-87-203>203</a>
</span><span class=lnt id=hl-87-204><a class=lnlinks href=#hl-87-204>204</a>
</span><span class=lnt id=hl-87-205><a class=lnlinks href=#hl-87-205>205</a>
</span><span class=lnt id=hl-87-206><a class=lnlinks href=#hl-87-206>206</a>
</span><span class=lnt id=hl-87-207><a class=lnlinks href=#hl-87-207>207</a>
</span><span class=lnt id=hl-87-208><a class=lnlinks href=#hl-87-208>208</a>
</span><span class=lnt id=hl-87-209><a class=lnlinks href=#hl-87-209>209</a>
</span><span class=lnt id=hl-87-210><a class=lnlinks href=#hl-87-210>210</a>
</span><span class=lnt id=hl-87-211><a class=lnlinks href=#hl-87-211>211</a>
</span><span class=lnt id=hl-87-212><a class=lnlinks href=#hl-87-212>212</a>
</span><span class=lnt id=hl-87-213><a class=lnlinks href=#hl-87-213>213</a>
</span><span class=lnt id=hl-87-214><a class=lnlinks href=#hl-87-214>214</a>
</span><span class=lnt id=hl-87-215><a class=lnlinks href=#hl-87-215>215</a>
</span><span class=lnt id=hl-87-216><a class=lnlinks href=#hl-87-216>216</a>
</span><span class=lnt id=hl-87-217><a class=lnlinks href=#hl-87-217>217</a>
</span><span class=lnt id=hl-87-218><a class=lnlinks href=#hl-87-218>218</a>
</span><span class=lnt id=hl-87-219><a class=lnlinks href=#hl-87-219>219</a>
</span><span class=lnt id=hl-87-220><a class=lnlinks href=#hl-87-220>220</a>
</span><span class=lnt id=hl-87-221><a class=lnlinks href=#hl-87-221>221</a>
</span><span class=lnt id=hl-87-222><a class=lnlinks href=#hl-87-222>222</a>
</span><span class=lnt id=hl-87-223><a class=lnlinks href=#hl-87-223>223</a>
</span><span class=lnt id=hl-87-224><a class=lnlinks href=#hl-87-224>224</a>
</span><span class=lnt id=hl-87-225><a class=lnlinks href=#hl-87-225>225</a>
</span><span class=lnt id=hl-87-226><a class=lnlinks href=#hl-87-226>226</a>
</span><span class=lnt id=hl-87-227><a class=lnlinks href=#hl-87-227>227</a>
</span><span class=lnt id=hl-87-228><a class=lnlinks href=#hl-87-228>228</a>
</span><span class=lnt id=hl-87-229><a class=lnlinks href=#hl-87-229>229</a>
</span><span class=lnt id=hl-87-230><a class=lnlinks href=#hl-87-230>230</a>
</span><span class=lnt id=hl-87-231><a class=lnlinks href=#hl-87-231>231</a>
</span><span class=lnt id=hl-87-232><a class=lnlinks href=#hl-87-232>232</a>
</span><span class=lnt id=hl-87-233><a class=lnlinks href=#hl-87-233>233</a>
</span><span class=lnt id=hl-87-234><a class=lnlinks href=#hl-87-234>234</a>
</span><span class=lnt id=hl-87-235><a class=lnlinks href=#hl-87-235>235</a>
</span><span class=lnt id=hl-87-236><a class=lnlinks href=#hl-87-236>236</a>
</span><span class=lnt id=hl-87-237><a class=lnlinks href=#hl-87-237>237</a>
</span><span class=lnt id=hl-87-238><a class=lnlinks href=#hl-87-238>238</a>
</span><span class=lnt id=hl-87-239><a class=lnlinks href=#hl-87-239>239</a>
</span><span class=lnt id=hl-87-240><a class=lnlinks href=#hl-87-240>240</a>
</span><span class=lnt id=hl-87-241><a class=lnlinks href=#hl-87-241>241</a>
</span><span class=lnt id=hl-87-242><a class=lnlinks href=#hl-87-242>242</a>
</span><span class=lnt id=hl-87-243><a class=lnlinks href=#hl-87-243>243</a>
</span><span class=lnt id=hl-87-244><a class=lnlinks href=#hl-87-244>244</a>
</span><span class=lnt id=hl-87-245><a class=lnlinks href=#hl-87-245>245</a>
</span><span class=lnt id=hl-87-246><a class=lnlinks href=#hl-87-246>246</a>
</span><span class=lnt id=hl-87-247><a class=lnlinks href=#hl-87-247>247</a>
</span><span class=lnt id=hl-87-248><a class=lnlinks href=#hl-87-248>248</a>
</span><span class=lnt id=hl-87-249><a class=lnlinks href=#hl-87-249>249</a>
</span><span class=lnt id=hl-87-250><a class=lnlinks href=#hl-87-250>250</a>
</span><span class=lnt id=hl-87-251><a class=lnlinks href=#hl-87-251>251</a>
</span><span class=lnt id=hl-87-252><a class=lnlinks href=#hl-87-252>252</a>
</span><span class=lnt id=hl-87-253><a class=lnlinks href=#hl-87-253>253</a>
</span><span class=lnt id=hl-87-254><a class=lnlinks href=#hl-87-254>254</a>
</span><span class=lnt id=hl-87-255><a class=lnlinks href=#hl-87-255>255</a>
</span><span class=lnt id=hl-87-256><a class=lnlinks href=#hl-87-256>256</a>
</span><span class=lnt id=hl-87-257><a class=lnlinks href=#hl-87-257>257</a>
</span><span class=lnt id=hl-87-258><a class=lnlinks href=#hl-87-258>258</a>
</span><span class=lnt id=hl-87-259><a class=lnlinks href=#hl-87-259>259</a>
</span><span class=lnt id=hl-87-260><a class=lnlinks href=#hl-87-260>260</a>
</span><span class=lnt id=hl-87-261><a class=lnlinks href=#hl-87-261>261</a>
</span><span class=lnt id=hl-87-262><a class=lnlinks href=#hl-87-262>262</a>
</span><span class=lnt id=hl-87-263><a class=lnlinks href=#hl-87-263>263</a>
</span><span class=lnt id=hl-87-264><a class=lnlinks href=#hl-87-264>264</a>
</span><span class=lnt id=hl-87-265><a class=lnlinks href=#hl-87-265>265</a>
</span><span class=lnt id=hl-87-266><a class=lnlinks href=#hl-87-266>266</a>
</span><span class=lnt id=hl-87-267><a class=lnlinks href=#hl-87-267>267</a>
</span><span class=lnt id=hl-87-268><a class=lnlinks href=#hl-87-268>268</a>
</span><span class=lnt id=hl-87-269><a class=lnlinks href=#hl-87-269>269</a>
</span><span class=lnt id=hl-87-270><a class=lnlinks href=#hl-87-270>270</a>
</span><span class=lnt id=hl-87-271><a class=lnlinks href=#hl-87-271>271</a>
</span><span class=lnt id=hl-87-272><a class=lnlinks href=#hl-87-272>272</a>
</span><span class=lnt id=hl-87-273><a class=lnlinks href=#hl-87-273>273</a>
</span><span class=lnt id=hl-87-274><a class=lnlinks href=#hl-87-274>274</a>
</span><span class=lnt id=hl-87-275><a class=lnlinks href=#hl-87-275>275</a>
</span><span class=lnt id=hl-87-276><a class=lnlinks href=#hl-87-276>276</a>
</span><span class=lnt id=hl-87-277><a class=lnlinks href=#hl-87-277>277</a>
</span><span class=lnt id=hl-87-278><a class=lnlinks href=#hl-87-278>278</a>
</span><span class=lnt id=hl-87-279><a class=lnlinks href=#hl-87-279>279</a>
</span><span class=lnt id=hl-87-280><a class=lnlinks href=#hl-87-280>280</a>
</span><span class=lnt id=hl-87-281><a class=lnlinks href=#hl-87-281>281</a>
</span><span class=lnt id=hl-87-282><a class=lnlinks href=#hl-87-282>282</a>
</span><span class=lnt id=hl-87-283><a class=lnlinks href=#hl-87-283>283</a>
</span><span class=lnt id=hl-87-284><a class=lnlinks href=#hl-87-284>284</a>
</span><span class=lnt id=hl-87-285><a class=lnlinks href=#hl-87-285>285</a>
</span><span class=lnt id=hl-87-286><a class=lnlinks href=#hl-87-286>286</a>
</span><span class=lnt id=hl-87-287><a class=lnlinks href=#hl-87-287>287</a>
</span><span class=lnt id=hl-87-288><a class=lnlinks href=#hl-87-288>288</a>
</span><span class=lnt id=hl-87-289><a class=lnlinks href=#hl-87-289>289</a>
</span><span class=lnt id=hl-87-290><a class=lnlinks href=#hl-87-290>290</a>
</span><span class=lnt id=hl-87-291><a class=lnlinks href=#hl-87-291>291</a>
</span><span class=lnt id=hl-87-292><a class=lnlinks href=#hl-87-292>292</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Netflix 동영상 추천 시스템 CQRS 구현 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Events</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserWatchedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserRatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Commands</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WatchContentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RateContentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command Handlers</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ContentCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_watch_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>WatchContentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>UserWatchedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>watch_duration</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>watch_duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Store에 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=s2>&#34;user_interactions&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Bus로 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_rate_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>RateContentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>UserRatedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>rating</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>rating</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=s2>&#34;user_ratings&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;rating_recorded&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>rating</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Models</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationModel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>recommended_contents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>last_updated</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserProfileModel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>preferences</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span>  <span class=c1># 장르별 선호도</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>average_rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Handlers</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendation_store</span><span class=p>,</span> <span class=n>profile_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>recommendation_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span> <span class=o>=</span> <span class=n>profile_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자별 개인화 추천 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>recommendations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 기본 추천 반환</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_recommendations</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>recommended_contents</span><span class=p>[:</span><span class=n>limit</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;last_updated&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>last_updated</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_user_profile</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 프로필 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Profile not found&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;preferences&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>preferences</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;watch_history_count&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>profile</span><span class=o>.</span><span class=n>watch_history</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;average_rating&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_get_default_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;기본 추천 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;popular_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;popular&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Handlers (Projections)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationProjectionHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendation_store</span><span class=p>,</span> <span class=n>ml_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>recommendation_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ml_service</span> <span class=o>=</span> <span class=n>ml_service</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_watched_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>UserWatchedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 이벤트 처리하여 추천 모델 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># ML 서비스를 통해 새로운 추천 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>new_recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>ml_service</span><span class=o>.</span><span class=n>calculate_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>watch_duration</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 모델 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendation_model</span> <span class=o>=</span> <span class=n>RecommendationModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>recommended_contents</span><span class=o>=</span><span class=n>new_recommendations</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>last_updated</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>recommendation_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_rated_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>UserRatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;평점 이벤트 처리하여 사용자 프로필 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 프로필 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>profile</span> <span class=o>=</span> <span class=n>UserProfileModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>user_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>preferences</span><span class=o>=</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>                <span class=n>watch_history</span><span class=o>=</span><span class=p>[],</span>
</span></span><span class=line><span class=cl>                <span class=n>average_rating</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>rating</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 평균 평점 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span> <span class=o>=</span> <span class=p>(</span><span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span> <span class=o>+</span> <span class=n>event</span><span class=o>.</span><span class=n>rating</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>profile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Bus 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>event</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span><span class=p>(</span><span class=n>event</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Store 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>append_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stream_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>])</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>stream_name</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 저장소 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>RecommendationModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_by_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProfileStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>UserProfileModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_by_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ML 서비스 모의 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationMLService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>calculate_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제로는 복잡한 ML 알고리즘 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;rec_</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.9</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 시스템 구성 및 실행 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 인프라 구성</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>RecommendationStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>profile_store</span> <span class=o>=</span> <span class=n>ProfileStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ml_service</span> <span class=o>=</span> <span class=n>RecommendationMLService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Handler 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>command_handler</span> <span class=o>=</span> <span class=n>ContentCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>query_handler</span> <span class=o>=</span> <span class=n>RecommendationQueryHandler</span><span class=p>(</span><span class=n>recommendation_store</span><span class=p>,</span> <span class=n>profile_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>projection_handler</span> <span class=o>=</span> <span class=n>RecommendationProjectionHandler</span><span class=p>(</span><span class=n>recommendation_store</span><span class=p>,</span> <span class=n>ml_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Event 구독 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;UserWatchedEvent&#34;</span><span class=p>,</span> <span class=n>projection_handler</span><span class=o>.</span><span class=n>handle_user_watched_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;UserRatedEvent&#34;</span><span class=p>,</span> <span class=n>projection_handler</span><span class=o>.</span><span class=n>handle_user_rated_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Command 실행 (쓰기 작업)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== Command 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_command</span> <span class=o>=</span> <span class=n>WatchContentCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s2>&#34;movie456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>watch_duration</span><span class=o>=</span><span class=mi>7200</span>  <span class=c1># 2시간</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_watch_content</span><span class=p>(</span><span class=n>watch_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;시청 기록 저장: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>rate_command</span> <span class=o>=</span> <span class=n>RateContentCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s2>&#34;movie456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>rating</span><span class=o>=</span><span class=mf>4.5</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_rate_content</span><span class=p>(</span><span class=n>rate_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;평점 저장: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 처리 대기 (실제로는 비동기로 처리됨)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Query 실행 (읽기 작업)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== Query 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_recommendations</span><span class=p>(</span><span class=s2>&#34;user123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;개인화 추천: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendations</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_user_profile</span><span class=p>(</span><span class=s2>&#34;user123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용자 프로필: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>profile</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>20. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>도메인 복잡성 평가</td><td>CQRS가 필요한 복잡성인지 판단</td><td>단순한 CRUD는 전통적 방식 유지</td></tr><tr><td>설계</td><td>경계 컨텍스트 정의</td><td>DDD의 Bounded Context 내에서만 적용</td><td>전체 시스템이 아닌 특정 영역에만 적용</td></tr><tr><td>구현</td><td>점진적 도입</td><td>한 번에 모든 것을 변경하지 않음</td><td>레거시 시스템과의 공존 전략 수립</td></tr><tr><td>구현</td><td>데이터 일관성 정책</td><td>비즈니스 요구사항에 맞는 일관성 수준</td><td>최종 일관성 허용 범위 명확히 정의</td></tr><tr><td>운영</td><td>모니터링 체계 구축</td><td>분산 시스템의 상태 추적</td><td>분산 추적, 메트릭 수집 도구 도입</td></tr><tr><td>운영</td><td>장애 복구 전략</td><td>이벤트 재처리 및 보상 트랜잭션</td><td>Dead Letter Queue, 재시도 로직 구현</td></tr><tr><td>팀</td><td>학습 곡선 관리</td><td>팀의 기술적 역량 고려</td><td>교육 프로그램, 파일럿 프로젝트 실행</td></tr><tr><td>팀</td><td>역할 분리</td><td>Command/Query 담당 팀 구분</td><td>Conway&rsquo;s Law에 따른 팀 구조 조정</td></tr></tbody></table><hr><h2 id=21-최적화하기-위한-고려사항-및-주의할-점-1>21. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#21-최적화하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>성능</td><td>이벤트 스트림 최적화</td><td>대용량 이벤트 처리 성능 향상</td><td>파티셔닝, 병렬 처리, 배치 처리</td></tr><tr><td>성능</td><td>캐싱 전략</td><td>Read Model의 응답 속도 향상</td><td>Redis, CDN 활용한 다계층 캐싱</td></tr><tr><td>성능</td><td>스냅샷 구현</td><td>이벤트 재생 성능 최적화</td><td>정기적 스냅샷 생성, 증분 업데이트</td></tr><tr><td>확장성</td><td>수평 확장 설계</td><td>트래픽 증가에 대비한 확장성</td><td>샤딩, 로드 밸런싱, 자동 확장</td></tr><tr><td>확장성</td><td>데이터 파티셔닝</td><td>대용량 데이터 효율적 처리</td><td>시간 기반, 해시 기반 파티셔닝</td></tr><tr><td>보안</td><td>접근 제어</td><td>읽기/쓰기 권한 분리 관리</td><td>RBAC, API 게이트웨이 활용</td></tr><tr><td>보안</td><td>데이터 암호화</td><td>민감한 데이터 보호</td><td>전송/저장 시 암호화, 키 관리</td></tr><tr><td>비용</td><td>리소스 최적화</td><td>불필요한 중복 제거</td><td>리소스 사용량 모니터링, 자동 스케일링</td></tr><tr><td>비용</td><td>저장소 비용 관리</td><td>이벤트 스토어 크기 관리</td><td>데이터 아카이빙, 압축 정책</td></tr></tbody></table><hr><h2 id=22-기타-사항>22. 기타 사항<a hidden class=anchor aria-hidden=true href=#22-기타-사항>#</a></h2><h3 id=cqrs와-관련된-현대적-트렌드>CQRS와 관련된 현대적 트렌드<a hidden class=anchor aria-hidden=true href=#cqrs와-관련된-현대적-트렌드>#</a></h3><ul><li><strong>서버리스 아키텍처</strong>: AWS Lambda, Azure Functions를 활용한 이벤트 기반 CQRS 구현</li><li><strong>컨테이너 오케스트레이션</strong>: Kubernetes를 이용한 CQRS 컴포넌트 배포 및 관리</li><li><strong>클라우드 네이티브</strong>: 완전 관리형 서비스를 활용한 CQRS 구현 (Amazon EventBridge, Azure Service Bus)</li></ul><h3 id=산업별-적용-사례>산업별 적용 사례<a hidden class=anchor aria-hidden=true href=#산업별-적용-사례>#</a></h3><ul><li><strong>금융</strong>: 거래 처리와 실시간 리스크 분석 분리</li><li><strong>전자상거래</strong>: 주문 처리와 상품 검색/추천 분리</li><li><strong>게임</strong>: 게임 상태 업데이트와 리더보드/통계 조회 분리</li><li><strong>IoT</strong>: 센서 데이터 수집과 분석/대시보드 분리</li></ul><h3 id=미래-발전-방향>미래 발전 방향<a hidden class=anchor aria-hidden=true href=#미래-발전-방향>#</a></h3><ul><li><strong>AI/ML 통합</strong>: 실시간 기계학습 모델 업데이트와 CQRS 결합</li><li><strong>엣지 컴퓨팅</strong>: 분산된 엣지 환경에서의 CQRS 패턴 적용</li><li><strong>블록체인</strong>: 불변 이벤트 스토어로서의 블록체인 활용</li></ul><hr><h2 id=주제와-관련하여-주목할-내용-1>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용-1>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처 패턴</td><td>Event Sourcing</td><td>이벤트 기반 저장</td><td>모든 상태 변경을 이벤트로 저장하는 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Saga Pattern</td><td>분산 트랜잭션</td><td>분산 환경에서의 트랜잭션 관리 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Domain-Driven Design</td><td>도메인 중심 설계</td><td>복잡한 비즈니스 로직을 효과적으로 모델링</td></tr><tr><td>기술 스택</td><td>Apache Kafka</td><td>이벤트 스트리밍</td><td>대용량 실시간 이벤트 처리 플랫폼</td></tr><tr><td>기술 스택</td><td>Event Store DB</td><td>이벤트 저장소</td><td>Event Sourcing 전용 데이터베이스</td></tr><tr><td>기술 스택</td><td>Axon Framework</td><td>CQRS/ES 프레임워크</td><td>Java 기반 CQRS 및 Event Sourcing 구현</td></tr><tr><td>데이터베이스</td><td>Event Store</td><td>이벤트 저장</td><td>이벤트를 저장하는 전용 데이터베이스</td></tr><tr><td>데이터베이스</td><td>Read Replicas</td><td>읽기 전용 복제본</td><td>읽기 성능 향상을 위한 데이터 복제</td></tr><tr><td>데이터베이스</td><td>Materialized Views</td><td>구체화된 뷰</td><td>미리 계산된 조회 결과 저장</td></tr><tr><td>메시징</td><td>Command Bus</td><td>명령 라우팅</td><td>명령을 적절한 핸들러로 전달</td></tr><tr><td>메시징</td><td>Event Bus</td><td>이벤트 발행</td><td>이벤트를 구독자에게 전달</td></tr><tr><td>메시징</td><td>Message Broker</td><td>메시지 중개</td><td>시스템 간 비동기 통신 중개</td></tr></tbody></table><hr><h2 id=주제와-관련하여-반드시-학습해야-할-내용>주제와 관련하여 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>CQS 원칙</td><td>Command Query Separation</td><td>CQRS의 이론적 기반이 되는 원칙</td></tr><tr><td>기본 개념</td><td>최종 일관성</td><td>Eventual Consistency</td><td>분산 시스템에서의 일관성 모델</td></tr><tr><td>기본 개념</td><td>CAP 정리</td><td>CAP Theorem</td><td>분산 시스템의 한계와 트레이드오프</td></tr><tr><td>설계 패턴</td><td>Domain Events</td><td>도메인 이벤트</td><td>비즈니스 로직에서 발생하는 중요한 사건</td></tr><tr><td>설계 패턴</td><td>Aggregate Pattern</td><td>집합체 패턴</td><td>DDD의 핵심 빌딩 블록</td></tr><tr><td>설계 패턴</td><td>Repository Pattern</td><td>저장소 패턴</td><td>데이터 접근 로직 캡슐화</td></tr><tr><td>구현 기술</td><td>Event Streaming</td><td>이벤트 스트리밍</td><td>실시간 이벤트 처리 기술</td></tr><tr><td>구현 기술</td><td>Projection</td><td>프로젝션</td><td>이벤트에서 뷰 모델 생성</td></tr><tr><td>구현 기술</td><td>Snapshot</td><td>스냅샷</td><td>성능 최적화를 위한 상태 저장</td></tr><tr><td>운영 관리</td><td>Monitoring</td><td>모니터링</td><td>분산 시스템 상태 추적</td></tr><tr><td>운영 관리</td><td>Circuit Breaker</td><td>회로 차단기</td><td>장애 전파 방지 패턴</td></tr><tr><td>운영 관리</td><td>Dead Letter Queue</td><td>실패 메시지 처리</td><td>처리 실패한 메시지 관리</td></tr></tbody></table><hr><h2 id=용어-정리-5>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-5>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>Bounded Context</td><td>DDD에서 모델의 경계를 정의하는 개념</td></tr><tr><td>아키텍처</td><td>Microservices</td><td>독립적으로 배포 가능한 작은 서비스들의 집합</td></tr><tr><td>아키텍처</td><td>Service Mesh</td><td>마이크로서비스 간 통신을 관리하는 인프라 계층</td></tr><tr><td>데이터</td><td>Polyglot Persistence</td><td>다양한 데이터베이스를 용도에 맞게 선택 사용</td></tr><tr><td>데이터</td><td>Denormalization</td><td>성능 향상을 위한 데이터 중복 허용</td></tr><tr><td>데이터</td><td>Sharding</td><td>대용량 데이터를 여러 DB에 분산 저장</td></tr><tr><td>메시징</td><td>At-least-once</td><td>메시지가 최소 한 번은 전달됨을 보장</td></tr><tr><td>메시징</td><td>Exactly-once</td><td>메시지가 정확히 한 번만 전달됨을 보장</td></tr><tr><td>메시징</td><td>Idempotent</td><td>동일한 연산을 여러 번 수행해도 결과가 같음</td></tr><tr><td>성능</td><td>Horizontal Scaling</td><td>서버 수를 늘려 성능을 향상시키는 방식</td></tr><tr><td>성능</td><td>Vertical Scaling</td><td>서버 사양을 높여 성능을 향상시키는 방식</td></tr><tr><td>성능</td><td>Load Balancing</td><td>여러 서버에 부하를 분산시키는 기술</td></tr><tr><td>보안</td><td>RBAC</td><td>Role-Based Access Control, 역할 기반 접근 제어</td></tr><tr><td>보안</td><td>OAuth 2.0</td><td>인증 및 권한 부여를 위한 개방형 표준</td></tr><tr><td>보안</td><td>JWT</td><td>JSON Web Token, 안전한 정보 전송을 위한 토큰</td></tr></tbody></table><hr><h2 id=참고-및-출처-4>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-4>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center</a></li><li><a href=https://www.martinfowler.com/bliki/CQRS.html>Martin Fowler - CQRS</a></li><li><a href=https://www.geeksforgeeks.org/cqrs-command-query-responsibility-segregation/>Command Query Responsibility Segregation - GeeksforGeeks</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li><li><a href=https://microservices.io/patterns/data/cqrs.html>Microservices Pattern: CQRS</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>Event Sourcing and CQRS - Baeldung</a></li><li><a href=https://www.confluent.io/learn/cqrs/>Command Query Responsibility Segregation - Confluent</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>CQRS Design Pattern - TechTarget</a></li><li><a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>Understanding Event Sourcing and CQRS Pattern - Mia-Platform</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>A Beginner&rsquo;s Guide to CQRS - Kurrent</a></li></ul><hr><p>CQRS(Command Query Responsibility Segregation)는 마이크로서비스 아키텍처(MSA)에서 중요한 패턴 중 하나이다.<br>CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다.</p><p>CQRS는 다음과 같은 핵심 개념을 가지고 있다:</p><ol><li><strong>명령(Command)</strong>: 시스템의 상태를 변경하는 작업 (예: 주문하기, 회원가입)</li><li><strong>조회(Query)</strong>: 시스템의 상태를 조회하는 작업 (예: 주문 목록 조회, 회원 정보 조회)</li><li><strong>책임 분리(Responsibility Segregation)</strong>: 명령과 조회 작업을 별도의 모델로 분리</li></ol><p>CQRS 패턴은 시스템의 성능, 확장성, 유지보수성을 향상시킬 수 있는 강력한 도구이다. 하지만 모든 시스템에 적합한 것은 아니므로, 프로젝트의 요구사항과 특성을 고려하여 적용 여부를 신중히 결정해야 한다.<br>CQRS를 효과적으로 구현하기 위해서는 명령과 조회 모델의 분리, 데이터 동기화 전략, 그리고 전체 시스템 아키텍처에 대한 깊은 이해가 필요하다.</p><h3 id=cqrs의-구현-방식>CQRS의 구현 방식<a hidden class=anchor aria-hidden=true href=#cqrs의-구현-방식>#</a></h3><p>CQRS는 다양한 방식으로 구현될 수 있다:</p><ol><li><strong>같은 프로세스, 같은 DB</strong>: 가장 단순한 형태로, 코드 수준에서만 명령과 조회를 분리한다.</li><li><strong>같은 프로세스, 다른 DB</strong>: 명령용 DB와 조회용 DB를 분리하여 사용한다.</li><li><strong>다른 프로세스, 다른 DB</strong>: MSA와 유사한 구조로, 프로세스와 DB를 모두 분리한다.</li></ol><h3 id=cqrs의-장점>CQRS의 장점<a hidden class=anchor aria-hidden=true href=#cqrs의-장점>#</a></h3><ol><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업을 독립적으로 최적화할 수 있다.</li><li><strong>확장성 향상</strong>: 읽기와 쓰기 모델을 독립적으로 확장할 수 있다.</li><li><strong>복잡성 감소</strong>: 명령과 조회 모델을 분리함으로써 각 모델의 복잡성을 줄일 수 있다.</li><li><strong>보안 강화</strong>: 읽기와 쓰기 작업에 대한 접근 제어를 별도로 설정할 수 있다.</li></ol><h3 id=cqrs의-단점>CQRS의 단점<a hidden class=anchor aria-hidden=true href=#cqrs의-단점>#</a></h3><ol><li><strong>구현 복잡도 증가</strong>: 명령과 조회 모델을 분리하면 전체적인 시스템 구조가 복잡해질 수 있다.</li><li><strong>데이터 일관성 관리</strong>: 명령과 조회 모델 간의 데이터 동기화가 필요하다.</li><li><strong>추가 인프라 필요</strong>: 분리된 모델을 관리하기 위한 추가적인 인프라가 필요할 수 있다.</li></ol><h3 id=cqrs-적용-시-고려사항>CQRS 적용 시 고려사항<a hidden class=anchor aria-hidden=true href=#cqrs-적용-시-고려사항>#</a></h3><ol><li><strong>데이터 동기화</strong>: 명령 모델과 조회 모델 간의 데이터 동기화 방법을 신중히 선택해야 한다.</li><li><strong>일관성 지연</strong>: 데이터 동기화 과정에서 일시적인 불일치가 발생할 수 있음을 고려해야 한다.</li><li><strong>복잡성 관리</strong>: CQRS 패턴 도입으로 인한 시스템 복잡도 증가를 관리해야 한다.</li></ol><h3 id=cqrs-적용-사례>CQRS 적용 사례<a hidden class=anchor aria-hidden=true href=#cqrs-적용-사례>#</a></h3><ol><li><strong>이커머스 시스템</strong>: 상품 조회와 주문 처리를 분리하여 성능을 최적화할 수 있다.</li><li><strong>금융 거래 시스템</strong>: 거래 기록과 잔액 조회를 분리하여 데이터 정합성을 유지할 수 있다.</li><li><strong>소셜 네트워크 서비스</strong>: 사용자 활동 데이터의 실시간 조회와 분석을 효율적으로 처리할 수 있다.</li></ol><h3 id=cqrs와-이벤트-소싱>CQRS와 이벤트 소싱<a hidden class=anchor aria-hidden=true href=#cqrs와-이벤트-소싱>#</a></h3><p>CQRS는 <strong>이벤트 소싱</strong>과 함께 사용되는 경우가 많다.<br>이벤트 소싱은 시스템의 상태 변화를 이벤트로 저장하고, 이러한 이벤트의 흐름을 재생하여 현재 상태를 구성하는 방식이다. 이를 통해:</p><ul><li><strong>데이터의 변경 이력 추적</strong>: 모든 상태 변화를 이벤트로 저장하여 변경 이력을 추적할 수 있다.</li><li><strong>복잡한 비즈니스 로직 처리</strong>: 이벤트를 기반으로 비즈니스 로직을 처리하여 복잡성을 관리할 수 있다.<br>이벤트 소싱과 CQRS의 결합은 시스템의 유연성과 확장성을 높이지만, 구현의 복잡성을 증가시킬 수 있으므로 신중한 설계가 필요하다.</li></ul><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-88-1><a class=lnlinks href=#hl-88-1> 1</a>
</span><span class=lnt id=hl-88-2><a class=lnlinks href=#hl-88-2> 2</a>
</span><span class=lnt id=hl-88-3><a class=lnlinks href=#hl-88-3> 3</a>
</span><span class=lnt id=hl-88-4><a class=lnlinks href=#hl-88-4> 4</a>
</span><span class=lnt id=hl-88-5><a class=lnlinks href=#hl-88-5> 5</a>
</span><span class=lnt id=hl-88-6><a class=lnlinks href=#hl-88-6> 6</a>
</span><span class=lnt id=hl-88-7><a class=lnlinks href=#hl-88-7> 7</a>
</span><span class=lnt id=hl-88-8><a class=lnlinks href=#hl-88-8> 8</a>
</span><span class=lnt id=hl-88-9><a class=lnlinks href=#hl-88-9> 9</a>
</span><span class=lnt id=hl-88-10><a class=lnlinks href=#hl-88-10>10</a>
</span><span class=lnt id=hl-88-11><a class=lnlinks href=#hl-88-11>11</a>
</span><span class=lnt id=hl-88-12><a class=lnlinks href=#hl-88-12>12</a>
</span><span class=lnt id=hl-88-13><a class=lnlinks href=#hl-88-13>13</a>
</span><span class=lnt id=hl-88-14><a class=lnlinks href=#hl-88-14>14</a>
</span><span class=lnt id=hl-88-15><a class=lnlinks href=#hl-88-15>15</a>
</span><span class=lnt id=hl-88-16><a class=lnlinks href=#hl-88-16>16</a>
</span><span class=lnt id=hl-88-17><a class=lnlinks href=#hl-88-17>17</a>
</span><span class=lnt id=hl-88-18><a class=lnlinks href=#hl-88-18>18</a>
</span><span class=lnt id=hl-88-19><a class=lnlinks href=#hl-88-19>19</a>
</span><span class=lnt id=hl-88-20><a class=lnlinks href=#hl-88-20>20</a>
</span><span class=lnt id=hl-88-21><a class=lnlinks href=#hl-88-21>21</a>
</span><span class=lnt id=hl-88-22><a class=lnlinks href=#hl-88-22>22</a>
</span><span class=lnt id=hl-88-23><a class=lnlinks href=#hl-88-23>23</a>
</span><span class=lnt id=hl-88-24><a class=lnlinks href=#hl-88-24>24</a>
</span><span class=lnt id=hl-88-25><a class=lnlinks href=#hl-88-25>25</a>
</span><span class=lnt id=hl-88-26><a class=lnlinks href=#hl-88-26>26</a>
</span><span class=lnt id=hl-88-27><a class=lnlinks href=#hl-88-27>27</a>
</span><span class=lnt id=hl-88-28><a class=lnlinks href=#hl-88-28>28</a>
</span><span class=lnt id=hl-88-29><a class=lnlinks href=#hl-88-29>29</a>
</span><span class=lnt id=hl-88-30><a class=lnlinks href=#hl-88-30>30</a>
</span><span class=lnt id=hl-88-31><a class=lnlinks href=#hl-88-31>31</a>
</span><span class=lnt id=hl-88-32><a class=lnlinks href=#hl-88-32>32</a>
</span><span class=lnt id=hl-88-33><a class=lnlinks href=#hl-88-33>33</a>
</span><span class=lnt id=hl-88-34><a class=lnlinks href=#hl-88-34>34</a>
</span><span class=lnt id=hl-88-35><a class=lnlinks href=#hl-88-35>35</a>
</span><span class=lnt id=hl-88-36><a class=lnlinks href=#hl-88-36>36</a>
</span><span class=lnt id=hl-88-37><a class=lnlinks href=#hl-88-37>37</a>
</span><span class=lnt id=hl-88-38><a class=lnlinks href=#hl-88-38>38</a>
</span><span class=lnt id=hl-88-39><a class=lnlinks href=#hl-88-39>39</a>
</span><span class=lnt id=hl-88-40><a class=lnlinks href=#hl-88-40>40</a>
</span><span class=lnt id=hl-88-41><a class=lnlinks href=#hl-88-41>41</a>
</span><span class=lnt id=hl-88-42><a class=lnlinks href=#hl-88-42>42</a>
</span><span class=lnt id=hl-88-43><a class=lnlinks href=#hl-88-43>43</a>
</span><span class=lnt id=hl-88-44><a class=lnlinks href=#hl-88-44>44</a>
</span><span class=lnt id=hl-88-45><a class=lnlinks href=#hl-88-45>45</a>
</span><span class=lnt id=hl-88-46><a class=lnlinks href=#hl-88-46>46</a>
</span><span class=lnt id=hl-88-47><a class=lnlinks href=#hl-88-47>47</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Command 모델 (쓰기 작업을 위한 모델)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCommandModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>totalAmount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orderId</span> <span class=o>=</span> <span class=nx>orderId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>userId</span> <span class=o>=</span> <span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>totalAmount</span> <span class=o>=</span> <span class=nx>totalAmount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;PENDING&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 생성 명령
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderCommandModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>totalAmount</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>EventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 커맨드 데이터베이스에 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>CommandDatabase</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query 모델 (읽기 작업을 위한 모델)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orders</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 전용 데이터베이스에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>findOne</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>orderId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자의 모든 주문 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>getUserOrders</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 최적화된 읽기 전용 뷰에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cqrs-구현의-주요-구성요소-예시>CQRS 구현의 주요 구성요소 예시<a hidden class=anchor aria-hidden=true href=#cqrs-구현의-주요-구성요소-예시>#</a></h4><ol><li><p>Command 처리기</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-89-1><a class=lnlinks href=#hl-89-1> 1</a>
</span><span class=lnt id=hl-89-2><a class=lnlinks href=#hl-89-2> 2</a>
</span><span class=lnt id=hl-89-3><a class=lnlinks href=#hl-89-3> 3</a>
</span><span class=lnt id=hl-89-4><a class=lnlinks href=#hl-89-4> 4</a>
</span><span class=lnt id=hl-89-5><a class=lnlinks href=#hl-89-5> 5</a>
</span><span class=lnt id=hl-89-6><a class=lnlinks href=#hl-89-6> 6</a>
</span><span class=lnt id=hl-89-7><a class=lnlinks href=#hl-89-7> 7</a>
</span><span class=lnt id=hl-89-8><a class=lnlinks href=#hl-89-8> 8</a>
</span><span class=lnt id=hl-89-9><a class=lnlinks href=#hl-89-9> 9</a>
</span><span class=lnt id=hl-89-10><a class=lnlinks href=#hl-89-10>10</a>
</span><span class=lnt id=hl-89-11><a class=lnlinks href=#hl-89-11>11</a>
</span><span class=lnt id=hl-89-12><a class=lnlinks href=#hl-89-12>12</a>
</span><span class=lnt id=hl-89-13><a class=lnlinks href=#hl-89-13>13</a>
</span><span class=lnt id=hl-89-14><a class=lnlinks href=#hl-89-14>14</a>
</span><span class=lnt id=hl-89-15><a class=lnlinks href=#hl-89-15>15</a>
</span><span class=lnt id=hl-89-16><a class=lnlinks href=#hl-89-16>16</a>
</span><span class=lnt id=hl-89-17><a class=lnlinks href=#hl-89-17>17</a>
</span><span class=lnt id=hl-89-18><a class=lnlinks href=#hl-89-18>18</a>
</span><span class=lnt id=hl-89-19><a class=lnlinks href=#hl-89-19>19</a>
</span><span class=lnt id=hl-89-20><a class=lnlinks href=#hl-89-20>20</a>
</span><span class=lnt id=hl-89-21><a class=lnlinks href=#hl-89-21>21</a>
</span><span class=lnt id=hl-89-22><a class=lnlinks href=#hl-89-22>22</a>
</span><span class=lnt id=hl-89-23><a class=lnlinks href=#hl-89-23>23</a>
</span><span class=lnt id=hl-89-24><a class=lnlinks href=#hl-89-24>24</a>
</span><span class=lnt id=hl-89-25><a class=lnlinks href=#hl-89-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;CREATE_ORDER&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;UPDATE_ORDER_STATUS&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleUpdateOrderStatus</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Unknown command type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 유효성 검증
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>validateCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 비즈니스 로직 수행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>OrderCommandModel</span><span class=p>.</span><span class=nx>createOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishOrderCreatedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Query 처리기</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-90-1><a class=lnlinks href=#hl-90-1> 1</a>
</span><span class=lnt id=hl-90-2><a class=lnlinks href=#hl-90-2> 2</a>
</span><span class=lnt id=hl-90-3><a class=lnlinks href=#hl-90-3> 3</a>
</span><span class=lnt id=hl-90-4><a class=lnlinks href=#hl-90-4> 4</a>
</span><span class=lnt id=hl-90-5><a class=lnlinks href=#hl-90-5> 5</a>
</span><span class=lnt id=hl-90-6><a class=lnlinks href=#hl-90-6> 6</a>
</span><span class=lnt id=hl-90-7><a class=lnlinks href=#hl-90-7> 7</a>
</span><span class=lnt id=hl-90-8><a class=lnlinks href=#hl-90-8> 8</a>
</span><span class=lnt id=hl-90-9><a class=lnlinks href=#hl-90-9> 9</a>
</span><span class=lnt id=hl-90-10><a class=lnlinks href=#hl-90-10>10</a>
</span><span class=lnt id=hl-90-11><a class=lnlinks href=#hl-90-11>11</a>
</span><span class=lnt id=hl-90-12><a class=lnlinks href=#hl-90-12>12</a>
</span><span class=lnt id=hl-90-13><a class=lnlinks href=#hl-90-13>13</a>
</span><span class=lnt id=hl-90-14><a class=lnlinks href=#hl-90-14>14</a>
</span><span class=lnt id=hl-90-15><a class=lnlinks href=#hl-90-15>15</a>
</span><span class=lnt id=hl-90-16><a class=lnlinks href=#hl-90-16>16</a>
</span><span class=lnt id=hl-90-17><a class=lnlinks href=#hl-90-17>17</a>
</span><span class=lnt id=hl-90-18><a class=lnlinks href=#hl-90-18>18</a>
</span><span class=lnt id=hl-90-19><a class=lnlinks href=#hl-90-19>19</a>
</span><span class=lnt id=hl-90-20><a class=lnlinks href=#hl-90-20>20</a>
</span><span class=lnt id=hl-90-21><a class=lnlinks href=#hl-90-21>21</a>
</span><span class=lnt id=hl-90-22><a class=lnlinks href=#hl-90-22>22</a>
</span><span class=lnt id=hl-90-23><a class=lnlinks href=#hl-90-23>23</a>
</span><span class=lnt id=hl-90-24><a class=lnlinks href=#hl-90-24>24</a>
</span><span class=lnt id=hl-90-25><a class=lnlinks href=#hl-90-25>25</a>
</span><span class=lnt id=hl-90-26><a class=lnlinks href=#hl-90-26>26</a>
</span><span class=lnt id=hl-90-27><a class=lnlinks href=#hl-90-27>27</a>
</span><span class=lnt id=hl-90-28><a class=lnlinks href=#hl-90-28>28</a>
</span><span class=lnt id=hl-90-29><a class=lnlinks href=#hl-90-29>29</a>
</span><span class=lnt id=hl-90-30><a class=lnlinks href=#hl-90-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>readModel</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderQueryModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;GET_ORDER&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleGetOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;GET_USER_ORDERS&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleGetUserOrders</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Unknown query type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleGetOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>cachedOrder</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`order:</span><span class=si>${</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>cachedOrder</span><span class=p>)</span> <span class=k>return</span> <span class=nx>cachedOrder</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 데이터베이스에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>readModel</span><span class=p>.</span><span class=nx>getOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=sb>`order:</span><span class=si>${</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>이벤트 동기화</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-91-1><a class=lnlinks href=#hl-91-1> 1</a>
</span><span class=lnt id=hl-91-2><a class=lnlinks href=#hl-91-2> 2</a>
</span><span class=lnt id=hl-91-3><a class=lnlinks href=#hl-91-3> 3</a>
</span><span class=lnt id=hl-91-4><a class=lnlinks href=#hl-91-4> 4</a>
</span><span class=lnt id=hl-91-5><a class=lnlinks href=#hl-91-5> 5</a>
</span><span class=lnt id=hl-91-6><a class=lnlinks href=#hl-91-6> 6</a>
</span><span class=lnt id=hl-91-7><a class=lnlinks href=#hl-91-7> 7</a>
</span><span class=lnt id=hl-91-8><a class=lnlinks href=#hl-91-8> 8</a>
</span><span class=lnt id=hl-91-9><a class=lnlinks href=#hl-91-9> 9</a>
</span><span class=lnt id=hl-91-10><a class=lnlinks href=#hl-91-10>10</a>
</span><span class=lnt id=hl-91-11><a class=lnlinks href=#hl-91-11>11</a>
</span><span class=lnt id=hl-91-12><a class=lnlinks href=#hl-91-12>12</a>
</span><span class=lnt id=hl-91-13><a class=lnlinks href=#hl-91-13>13</a>
</span><span class=lnt id=hl-91-14><a class=lnlinks href=#hl-91-14>14</a>
</span><span class=lnt id=hl-91-15><a class=lnlinks href=#hl-91-15>15</a>
</span><span class=lnt id=hl-91-16><a class=lnlinks href=#hl-91-16>16</a>
</span><span class=lnt id=hl-91-17><a class=lnlinks href=#hl-91-17>17</a>
</span><span class=lnt id=hl-91-18><a class=lnlinks href=#hl-91-18>18</a>
</span><span class=lnt id=hl-91-19><a class=lnlinks href=#hl-91-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderCreated</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 모델 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>orderData</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 전용 데이터베이스에 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>userId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAmount</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>createdAt</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 무효화
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>invalidate</span><span class=p>(</span><span class=sb>`user:</span><span class=si>${</span><span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>:orders`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=주문-시스템-예제>주문 시스템 예제<a hidden class=anchor aria-hidden=true href=#주문-시스템-예제>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-92-1><a class=lnlinks href=#hl-92-1> 1</a>
</span><span class=lnt id=hl-92-2><a class=lnlinks href=#hl-92-2> 2</a>
</span><span class=lnt id=hl-92-3><a class=lnlinks href=#hl-92-3> 3</a>
</span><span class=lnt id=hl-92-4><a class=lnlinks href=#hl-92-4> 4</a>
</span><span class=lnt id=hl-92-5><a class=lnlinks href=#hl-92-5> 5</a>
</span><span class=lnt id=hl-92-6><a class=lnlinks href=#hl-92-6> 6</a>
</span><span class=lnt id=hl-92-7><a class=lnlinks href=#hl-92-7> 7</a>
</span><span class=lnt id=hl-92-8><a class=lnlinks href=#hl-92-8> 8</a>
</span><span class=lnt id=hl-92-9><a class=lnlinks href=#hl-92-9> 9</a>
</span><span class=lnt id=hl-92-10><a class=lnlinks href=#hl-92-10>10</a>
</span><span class=lnt id=hl-92-11><a class=lnlinks href=#hl-92-11>11</a>
</span><span class=lnt id=hl-92-12><a class=lnlinks href=#hl-92-12>12</a>
</span><span class=lnt id=hl-92-13><a class=lnlinks href=#hl-92-13>13</a>
</span><span class=lnt id=hl-92-14><a class=lnlinks href=#hl-92-14>14</a>
</span><span class=lnt id=hl-92-15><a class=lnlinks href=#hl-92-15>15</a>
</span><span class=lnt id=hl-92-16><a class=lnlinks href=#hl-92-16>16</a>
</span><span class=lnt id=hl-92-17><a class=lnlinks href=#hl-92-17>17</a>
</span><span class=lnt id=hl-92-18><a class=lnlinks href=#hl-92-18>18</a>
</span><span class=lnt id=hl-92-19><a class=lnlinks href=#hl-92-19>19</a>
</span><span class=lnt id=hl-92-20><a class=lnlinks href=#hl-92-20>20</a>
</span><span class=lnt id=hl-92-21><a class=lnlinks href=#hl-92-21>21</a>
</span><span class=lnt id=hl-92-22><a class=lnlinks href=#hl-92-22>22</a>
</span><span class=lnt id=hl-92-23><a class=lnlinks href=#hl-92-23>23</a>
</span><span class=lnt id=hl-92-24><a class=lnlinks href=#hl-92-24>24</a>
</span><span class=lnt id=hl-92-25><a class=lnlinks href=#hl-92-25>25</a>
</span><span class=lnt id=hl-92-26><a class=lnlinks href=#hl-92-26>26</a>
</span><span class=lnt id=hl-92-27><a class=lnlinks href=#hl-92-27>27</a>
</span><span class=lnt id=hl-92-28><a class=lnlinks href=#hl-92-28>28</a>
</span><span class=lnt id=hl-92-29><a class=lnlinks href=#hl-92-29>29</a>
</span><span class=lnt id=hl-92-30><a class=lnlinks href=#hl-92-30>30</a>
</span><span class=lnt id=hl-92-31><a class=lnlinks href=#hl-92-31>31</a>
</span><span class=lnt id=hl-92-32><a class=lnlinks href=#hl-92-32>32</a>
</span><span class=lnt id=hl-92-33><a class=lnlinks href=#hl-92-33>33</a>
</span><span class=lnt id=hl-92-34><a class=lnlinks href=#hl-92-34>34</a>
</span><span class=lnt id=hl-92-35><a class=lnlinks href=#hl-92-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// API 엔드포인트 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>commandHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderCommandHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>queryHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderQueryHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;CREATE_ORDER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>payload</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>query</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;GET_ORDER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>orderId</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queryHandler</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-6>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-6>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-5>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-5>#</a></h2><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>