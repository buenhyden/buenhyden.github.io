<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Lambda Architecture | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Styles,Data-Flow,Architectures,Lambda-Architecture,Batch-Processing,Stream-Processing"><meta name=description content="Lambda Architecture 는 배치 처리 (Batch Processing) 와 실시간 스트림 처리 (Real-time Stream Processing) 를 결합하여 대용량 데이터를 효과적으로 처리하는 하이브리드 아키텍처 패턴이다. 배치 레이어 (Batch Layer), 스피드 레이어 (Speed Layer), 서빙 레이어 (Serving Layer) 세 계층으로 구성되어 높은 처리량과 낮은 지연시간을 동시에 제공한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/lambda-architecture/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/lambda-architecture/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/lambda-architecture/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/lambda-architecture/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Lambda Architecture"><meta property="og:description" content="Lambda Architecture 는 배치 처리 (Batch Processing) 와 실시간 스트림 처리 (Real-time Stream Processing) 를 결합하여 대용량 데이터를 효과적으로 처리하는 하이브리드 아키텍처 패턴이다. 배치 레이어 (Batch Layer), 스피드 레이어 (Speed Layer), 서빙 레이어 (Serving Layer) 세 계층으로 구성되어 높은 처리량과 낮은 지연시간을 동시에 제공한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Lambda Architecture"><meta name=twitter:description content="Lambda Architecture 는 배치 처리 (Batch Processing) 와 실시간 스트림 처리 (Real-time Stream Processing) 를 결합하여 대용량 데이터를 효과적으로 처리하는 하이브리드 아키텍처 패턴이다. 배치 레이어 (Batch Layer), 스피드 레이어 (Speed Layer), 서빙 레이어 (Serving Layer) 세 계층으로 구성되어 높은 처리량과 낮은 지연시간을 동시에 제공한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기록하고 기억하고 활용하자.","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":4,"name":"Architecture Styles","item":""},{"@type":"ListItem","position":5,"name":"Data-Flow Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/"},{"@type":"ListItem","position":6,"name":"Architectures","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/"},{"@type":"ListItem","position":7,"name":"Lambda Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/lambda-architecture/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기록하고 기억하고 활용하자.</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href>Architecture Styles</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/>Data-Flow Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles/data-flow-architecture/data-processing-architectures/>Architectures</a></div><h1>Lambda Architecture</h1><div class=post-description>Lambda Architecture 는 배치 처리 (Batch Processing) 와 실시간 스트림 처리 (Real-time Stream Processing) 를 결합하여 대용량 데이터를 효과적으로 처리하는 하이브리드 아키텍처 패턴이다. 배치 레이어 (Batch Layer), 스피드 레이어 (Speed Layer), 서빙 레이어 (Serving Layer) 세 계층으로 구성되어 높은 처리량과 낮은 지연시간을 동시에 제공한다.</div></header><div class=post-content><h2 id=lambda-architecture>Lambda Architecture<a hidden class=anchor aria-hidden=true href=#lambda-architecture>#</a></h2><p>Lambda Architecture 는 빅데이터 환경에서 실시간성과 정확성을 동시에 달성하기 위해 고안된 데이터 처리 아키텍처이다. 배치 레이어와 스피드 (실시간) 레이어, 그리고 서빙 레이어로 구성되며, 배치 레이어는 대규모 데이터를 정확하게 처리하고, 스피드 레이어는 최신 데이터를 빠르게 반영한다. 이 구조는 데이터 일관성, 확장성, 장애 복원력을 제공하며, IoT, 로그 분석, 실시간 이벤트 분석 등 다양한 분야에서 활용된다.</p><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Lambda Architecture 는 기존 배치 처리 시스템의 높은 지연시간과 스트림 처리 시스템의 낮은 정확성 문제를 해결하기 위해 개발되었다. 빅데이터 시대의 도래와 함께 실시간 분석에 대한 요구가 증가하면서, 대용량 데이터를 정확하고 빠르게 처리할 수 있는 아키텍처의 필요성이 대두되었다.</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><p><strong>주요 목적</strong>:</p><ul><li>대용량 데이터의 실시간 및 배치 처리 통합</li><li>높은 처리량과 낮은 지연시간의 균형</li><li>시스템 장애에 대한 높은 복원력 제공</li><li>데이터 정확성과 일관성 보장</li></ul><p><strong>필요성</strong>:</p><ul><li>기존 배치 처리만으로는 실시간 의사결정 지원 한계</li><li>스트림 처리만으로는 데이터 정확성과 완전성 보장 어려움</li><li>비즈니스 민첩성 (Business Agility) 요구 증가</li><li>다양한 데이터 소스와 처리 요구사항 대응</li></ul><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p>Lambda Architecture 는 <strong>대규모 데이터 시스템에서 정확성과 실시간성</strong>을 동시에 확보하기 위해 고안된 아키텍처로, <strong>Nathan Marz</strong>가 처음 제안했다.</p><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><p><strong>불변성 (Immutability)</strong></p><ul><li>데이터는 한번 저장되면 수정되지 않고 새로운 데이터만 추가됨</li><li>데이터 일관성과 신뢰성 보장</li><li>실무에서는 추가 전용 로그 (Append-only Log) 구조로 구현</li></ul><p><strong>3 계층 구조 (Three-Layer Architecture)</strong></p><ul><li>배치 레이어, 스피드 레이어, 서빙 레이어의 분리된 역할</li><li>각 계층의 독립적 확장성과 장애 격리</li><li>실무에서는 마이크로서비스 아키텍처와 유사한 설계 원칙 적용</li></ul><p><strong>뷰 (View) 기반 처리</strong></p><ul><li>원시 데이터로부터 미리 계산된 뷰 생성</li><li>배치 뷰와 실시간 뷰의 결합</li><li>실무에서는 구체화된 뷰 (Materialized View) 패턴으로 구현</li></ul><p><strong>하이브리드 처리 (Hybrid Processing)</strong></p><ul><li>배치와 스트림 처리의 장점 결합</li><li>높은 처리량과 낮은 지연시간의 균형</li><li>실무에서는 Apache Spark 의 배치/스트리밍 통합 API 활용</li></ul><h4 id=실무-구현을-위한-연관성>실무 구현을 위한 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현을-위한-연관성>#</a></h4><p><strong>데이터 파이프라인 설계 측면</strong></p><ul><li>ETL/ELT 프로세스와 긴밀한 연관성</li><li>데이터 레이크 (Data Lake) 와 데이터 웨어하우스 (Data Warehouse) 통합</li><li>실시간 데이터 수집 아키텍처와의 연계</li></ul><p><strong>분산 시스템 설계 측면</strong></p><ul><li>분산 컴퓨팅 프레임워크 활용 (Apache Spark, Apache Flink)</li><li>메시지 큐 시스템 통합 (Apache Kafka, Amazon Kinesis)</li><li>NoSQL 데이터베이스와의 연동 (Apache Cassandra, MongoDB)</li></ul><p><strong>장애 허용성 측면</strong></p><ul><li>체크포인팅 (Checkpointing) 메커니즘</li><li>정확히 한 번 처리 (Exactly-once Processing) 보장</li><li>분산 시스템의 부분 장애 처리</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><p><strong>실시간 분석 (Real-time Analytics)</strong></p><ul><li>스트리밍 데이터의 즉시 처리</li><li>밀리초 단위의 낮은 지연시간 제공</li><li>실시간 대시보드와 알림 시스템 지원</li></ul><p><strong>배치 분석 (Batch Analytics)</strong></p><ul><li>과거 데이터의 포괄적 분석</li><li>높은 정확성과 완전성 보장</li><li>복잡한 집계와 머신러닝 모델 학습</li></ul><p><strong>통합 질의 처리 (Unified Query Processing)</strong></p><ul><li>배치와 실시간 결과의 일관된 뷰 제공</li><li>애드혹 질의 (Ad-hoc Query) 지원</li><li>다양한 비즈니스 인텔리전스 도구와 연동</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><p><strong>확장성 (Scalability)</strong></p><ul><li>수평적 확장 지원</li><li>각 계층의 독립적 확장</li><li>클라우드 환경에서의 탄력적 자원 관리</li></ul><p><strong>내결함성 (Fault Tolerance)</strong></p><ul><li>개별 계층의 장애 격리</li><li>자동 복구 메커니즘</li><li>데이터 복제를 통한 가용성 보장</li></ul><p><strong>유연성 (Flexibility)</strong></p><ul><li>다양한 데이터 소스 지원</li><li>다중 처리 엔진 통합</li><li>비즈니스 요구사항 변화에 대한 적응성</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><p><strong>불변성 원칙 (Immutability Principle)</strong></p><ul><li>한번 저장된 데이터는 수정하지 않음</li><li>새로운 데이터만 추가 (Append-only)</li><li>데이터 무결성과 감사 추적 보장</li></ul><p><strong>재계산 원칙 (Recomputation Principle)</strong></p><ul><li>오류 발생 시 전체 데이터셋에서 재계산 가능</li><li>휴먼 에러 (Human Error) 에 대한 복구 능력</li><li>알고리즘 개선 시 과거 데이터 재처리 가능</li></ul><p><strong>읽기 전용 계산 원칙 (Read-only Computation)</strong></p><ul><li>원본 데이터는 변경하지 않고 뷰만 생성</li><li>부작용 (Side Effect) 없는 함수형 처리</li><li>동시성 문제 해결</li></ul><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><ul><li><strong>이중 처리 (Double Processing)</strong>: 동일 데이터를 batch 와 stream 에서 각각 처리함</li><li><strong>Event Sourcing 원칙 적용</strong>: 데이터는 Append-only log 로 기록됨</li><li><strong>불변 데이터</strong>: 데이터는 변경 불가능, 오직 추가만 가능</li><li><strong>지연 보상 보정 (Latency Compensation)</strong>: 실시간 결과는 추정값이며, 이후 batch 결과로 정정</li></ul><h3 id=작동-원리-및-방식>작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#작동-원리-및-방식>#</a></h3><pre class=mermaid>graph TD
    A[데이터 소스] --&gt; B[메시지 큐&lt;br/&gt;Apache Kafka]
    B --&gt; C[배치 레이어&lt;br/&gt;Apache Spark/Hadoop]
    B --&gt; D[스피드 레이어&lt;br/&gt;Apache Storm/Flink]
    C --&gt; E[배치 뷰&lt;br/&gt;HDFS/Data Lake]
    D --&gt; F[실시간 뷰&lt;br/&gt;NoSQL/In-Memory]
    E --&gt; G[서빙 레이어&lt;br/&gt;Query Engine]
    F --&gt; G
    G --&gt; H[통합 결과&lt;br/&gt;대시보드/API]
</pre><p><strong>설명:</strong></p><ul><li>모든 원시 데이터는 Batch 와 Speed Layer 로 동시에 전달됨</li><li>Batch Layer 는 일정 시간 주기로 전체 데이터를 분석하여 결과에 대한 배치 뷰를 생성</li><li>Speed Layer 는 최근 데이터를 빠르게 처리하여 응답 속도를 높임</li><li>Serving Layer 는 두 계층의 결과를 병합해 사용자의 쿼리에 응답</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;데이터 소스&#34;
        DS1[IoT 센서]
        DS2[웹 로그]
        DS3[트랜잭션 DB]
        DS4[소셜 미디어]
    end
    
    subgraph &#34;수집 계층&#34;
        MQ[메시지 큐&lt;br/&gt;Apache Kafka/Kinesis]
    end
    
    subgraph &#34;Lambda Architecture&#34;
        subgraph &#34;배치 레이어&#34;
            BP[배치 처리&lt;br/&gt;Apache Spark/Hadoop]
            BDS[배치 데이터 저장&lt;br/&gt;HDFS/S3]
            BV[배치 뷰&lt;br/&gt;Hive/Parquet]
        end
        
        subgraph &#34;스피드 레이어&#34;
            SP[스트림 처리&lt;br/&gt;Apache Storm/Flink]
            RDS[실시간 데이터 저장&lt;br/&gt;Redis/Cassandra]
            RV[실시간 뷰&lt;br/&gt;In-Memory DB]
        end
        
        subgraph &#34;서빙 레이어&#34;
            QE[질의 엔진&lt;br/&gt;Apache Druid/Pinot]
            API[API 게이트웨이]
        end
    end
    
    subgraph &#34;응용 계층&#34;
        DASH[대시보드]
        APP[애플리케이션]
        BI[BI 도구]
    end
    
    DS1 --&gt; MQ
    DS2 --&gt; MQ
    DS3 --&gt; MQ
    DS4 --&gt; MQ
    
    MQ --&gt; BP
    MQ --&gt; SP
    
    BP --&gt; BDS
    BDS --&gt; BV
    SP --&gt; RDS
    RDS --&gt; RV
    
    BV --&gt; QE
    RV --&gt; QE
    QE --&gt; API
    
    API --&gt; DASH
    API --&gt; APP
    API --&gt; BI
</pre><h4 id=구성요소>구성요소<a hidden class=anchor aria-hidden=true href=#구성요소>#</a></h4><table><thead><tr><th><strong>구분</strong></th><th><strong>레이어 / 구성요소</strong></th><th><strong>기능</strong></th><th><strong>역할</strong></th><th><strong>특징</strong></th><th><strong>기술 스택 예시</strong></th></tr></thead><tbody><tr><td><strong>필수</strong></td><td>배치 레이어 (Batch Layer)</td><td>전체 데이터셋의 정확하고 완전한 처리</td><td>마스터 데이터셋 저장 및 배치 뷰 생성</td><td>높은 처리량, 높은 정확성, 높은 지연시간</td><td>Apache Hadoop, Apache Spark, HDFS, Amazon S3</td></tr><tr><td></td><td>스피드 레이어 (Speed Layer)</td><td>실시간 스트림 데이터의 즉시 처리</td><td>배치 지연을 보완하는 근사 뷰 생성</td><td>낮은 지연시간, 근사 정확성, 제한된 처리량</td><td>Apache Storm, Apache Flink, Apache Kafka Streams</td></tr><tr><td></td><td>서빙 레이어 (Serving Layer)</td><td>배치와 실시간 결과의 통합 및 질의 제공</td><td>사용자에게 통합된 최신 데이터 뷰 제공</td><td>낮은 질의 지연시간, 높은 동시성 지원</td><td>Apache Cassandra, Apache HBase, Apache Druid</td></tr><tr><td><strong>선택</strong></td><td>메시지 큐 시스템</td><td>데이터 스트림 수집 및 중개</td><td>배치 및 스피드 레이어 간 데이터 전파 및 디커플링</td><td>높은 처리량, 내결함성, 메시지 순서 보장</td><td>Apache Kafka, Amazon Kinesis, Apache Pulsar</td></tr><tr><td></td><td>모니터링 및 관리 도구</td><td>시스템 성능 및 상태 실시간 모니터링 및 분석</td><td>장애 감지, 성능 최적화, 이상 탐지</td><td>실시간 메트릭, 로그 분석, 경고/알림 기능</td><td>Grafana, Apache Zeppelin, ELK Stack (Elasticsearch 등)</td></tr></tbody></table><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>구현 기법</strong></th><th><strong>정의 및 구성요소</strong></th><th><strong>주요 목적 / 역할</strong></th><th><strong>기술 스택 / 예시</strong></th></tr></thead><tbody><tr><td><strong>1. 배치 처리</strong></td><td>Batch Processing Framework</td><td>대용량 데이터의 정기적 처리 (시간 단위/일 단위)</td><td>전역 분석, 정밀 통계, 마스터 데이터셋 생성</td><td>Apache Spark, Hadoop, Airflow, HDFS, Amazon S3</td></tr><tr><td></td><td>Batch View Materialization</td><td>배치 결과를 쿼리 가능한 형태로 저장</td><td>정합성 높은 전처리 결과 제공</td><td>Spark Aggregation → Parquet/Hive Table/Redis</td></tr><tr><td><strong>2. 스트림 처리</strong></td><td>Stream Processing Engine</td><td>실시간 이벤트를 지속적으로 처리</td><td>낮은 지연시간, 실시간 반응, Near Real-time ETL</td><td>Apache Kafka Streams, Flink, Storm, Redis</td></tr><tr><td></td><td>Immutable Event Log</td><td>변경 불가능한 이벤트 로그 저장소 (로그 기반 처리 모델)</td><td>이벤트 재처리, 감사 추적, 장애 복구 기반</td><td>Apache Kafka, Amazon Kinesis</td></tr><tr><td></td><td>Backpressure Control</td><td>소비자 속도 제어 메커니즘 (과부하 방지)</td><td>안정성 보장, 시스템 보호</td><td>Reactive Streams, Akka Streams, Flink Watermarks</td></tr><tr><td><strong>3. 통합 및 병합</strong></td><td>Lambda Merge Logic</td><td>배치와 스트림 결과를 통합 (Timestamp, ID 기반 병합)</td><td>실시간 데이터와 정제 데이터의 정합성 유지</td><td>Serving Layer 병합 처리, 시간 우선 병합 로직</td></tr><tr><td></td><td>Serving Index / Data Store</td><td>질의 성능을 위한 데이터 인덱싱 및 저장소</td><td>빠른 조회 응답, 사용자 API 대응</td><td>Apache Druid, Presto, Cassandra, Elasticsearch</td></tr><tr><td><strong>4. 메시지 처리</strong></td><td>Messaging / Buffering Layer</td><td>데이터 생산자 ↔ 처리 계층 간 비동기 버퍼링</td><td>시스템 디커플링, 내결함성, 재시도 처리</td><td>Apache Kafka, RabbitMQ, Pulsar</td></tr><tr><td><strong>5. API 및 질의</strong></td><td>Unified Query API</td><td>배치 + 실시간 뷰를 API 수준에서 통합 질의 처리</td><td>사용자 요청에 최신 통합 결과 제공</td><td>Flask + Redis + Spark SQL, GraphQL Gateway</td></tr><tr><td></td><td>API Gateway / Result Cache</td><td>통합 결과 제공 및 캐싱 계층</td><td>지연시간 감소, 캐시 효율성</td><td>NGINX, FastAPI, Redis Cache</td></tr><tr><td><strong>6. 운영 및 모니터링</strong></td><td>Monitoring & Alerting Tools</td><td>상태 감시, 지표 수집, 이상 탐지</td><td>SLA 보장, 운영 효율성 확보</td><td>Prometheus, Grafana, ELK Stack, Jaeger</td></tr><tr><td></td><td>Orchestration & Scheduling</td><td>작업 스케줄링 및 의존성 관리</td><td>정기 실행, 장애 복구, 병렬 처리</td><td>Apache Airflow, Oozie</td></tr><tr><td><strong>7. 보안 및 안정성</strong></td><td>Secure Messaging & Data Access</td><td>메시지/API 수준의 보안 및 인증</td><td>데이터 보호, 비인가 접근 방지</td><td>TLS, mTLS, JWT, RBAC, Zero Trust Messaging</td></tr></tbody></table><h4 id=배치-처리-구현-기법>배치 처리 구현 기법<a hidden class=anchor aria-hidden=true href=#배치-처리-구현-기법>#</a></h4><p><strong>정의</strong>: 대용량 데이터를 일정 주기로 모아서 처리하는 기법</p><p><strong>구성</strong>:</p><ul><li>스케줄러 (Apache Airflow, Oozie)</li><li>분산 컴퓨팅 엔진 (Apache Spark, Hadoop MapReduce)</li><li>분산 저장소 (HDFS, Amazon S3)</li></ul><p><strong>목적</strong>: 높은 처리량과 정확성을 통한 포괄적 데이터 분석</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Apache Spark를 사용한 배치 처리 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.functions</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Spark 세션 초기화</span>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;Lambda_Batch_Layer&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.adaptive.enabled&#34;</span><span class=p>,</span> <span class=s2>&#34;true&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 배치 데이터 읽기 (하루치 데이터)</span>
</span></span><span class=line><span class=cl><span class=n>batch_data</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;multiline&#34;</span><span class=p>,</span> <span class=s2>&#34;true&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>json</span><span class=p>(</span><span class=s2>&#34;hdfs://cluster/raw_data/2024/01/15/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 배치 뷰 계산 (일일 사용자 활동 통계)</span>
</span></span><span class=line><span class=cl><span class=n>daily_stats</span> <span class=o>=</span> <span class=n>batch_data</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>groupBy</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;date&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>agg</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>count</span><span class=p>(</span><span class=s2>&#34;*&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;total_events&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nb>sum</span><span class=p>(</span><span class=s2>&#34;duration&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;total_duration&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>countDistinct</span><span class=p>(</span><span class=s2>&#34;session_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;sessions&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 배치 뷰 저장</span>
</span></span><span class=line><span class=cl><span class=n>daily_stats</span><span class=o>.</span><span class=n>write</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;overwrite&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>partitionBy</span><span class=p>(</span><span class=s2>&#34;date&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>parquet</span><span class=p>(</span><span class=s2>&#34;hdfs://cluster/batch_views/daily_user_stats/&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=스트림-처리-구현-기법>스트림 처리 구현 기법<a hidden class=anchor aria-hidden=true href=#스트림-처리-구현-기법>#</a></h4><p><strong>정의</strong>: 연속적으로 들어오는 데이터를 실시간으로 처리하는 기법</p><p><strong>구성</strong>:</p><ul><li>스트림 처리 엔진 (Apache Flink, Apache Storm)</li><li>메시지 큐 (Apache Kafka)</li><li>인메모리 저장소 (Redis, Apache Ignite)</li></ul><p><strong>목적</strong>: 낮은 지연시간으로 실시간 인사이트 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Apache Kafka Streams를 사용한 실시간 처리 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span><span class=p>,</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 클라이언트 초기화 (실시간 뷰 저장용)</span>
</span></span><span class=line><span class=cl><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka 컨슈머 설정</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;user_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;lambda_speed_layer&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 데이터 처리</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_real_time_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;실시간 이벤트 처리 및 뷰 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 뷰 업데이트 (최근 1시간 활동)</span>
</span></span><span class=line><span class=cl>        <span class=n>hour_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;user:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:hour:</span><span class=si>{</span><span class=n>timestamp</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>%H&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis에 실시간 통계 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span><span class=o>.</span><span class=n>hincrby</span><span class=p>(</span><span class=n>hour_key</span><span class=p>,</span> <span class=s1>&#39;event_count&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span><span class=o>.</span><span class=n>hincrby</span><span class=p>(</span><span class=n>hour_key</span><span class=p>,</span> <span class=s1>&#39;total_duration&#39;</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;duration&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=n>hour_key</span><span class=p>,</span> <span class=mi>3600</span><span class=p>)</span>  <span class=c1># 1시간 TTL</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 전역 실시간 통계 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>global_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;global:realtime:</span><span class=si>{</span><span class=n>timestamp</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>%H%M&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span><span class=o>.</span><span class=n>hincrby</span><span class=p>(</span><span class=n>global_key</span><span class=p>,</span> <span class=s1>&#39;total_events&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=n>global_key</span><span class=p>,</span> <span class=mi>300</span><span class=p>)</span>  <span class=c1># 5분 TTL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>process_real_time_events</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=통합-질의-구현-기법>통합 질의 구현 기법<a hidden class=anchor aria-hidden=true href=#통합-질의-구현-기법>#</a></h4><p><strong>정의</strong>: 배치 뷰와 실시간 뷰를 결합하여 통합된 결과를 제공하는 기법</p><p><strong>구성</strong>:</p><ul><li>질의 엔진 (Apache Druid, Presto)</li><li>API 게이트웨이</li><li>결과 캐싱 레이어</li></ul><p><strong>목적</strong>: 사용자에게 일관되고 완전한 데이터 뷰 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46>46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47>47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48>48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49>49</a>
</span><span class=lnt id=hl-4-50><a class=lnlinks href=#hl-4-50>50</a>
</span><span class=lnt id=hl-4-51><a class=lnlinks href=#hl-4-51>51</a>
</span><span class=lnt id=hl-4-52><a class=lnlinks href=#hl-4-52>52</a>
</span><span class=lnt id=hl-4-53><a class=lnlinks href=#hl-4-53>53</a>
</span><span class=lnt id=hl-4-54><a class=lnlinks href=#hl-4-54>54</a>
</span><span class=lnt id=hl-4-55><a class=lnlinks href=#hl-4-55>55</a>
</span><span class=lnt id=hl-4-56><a class=lnlinks href=#hl-4-56>56</a>
</span><span class=lnt id=hl-4-57><a class=lnlinks href=#hl-4-57>57</a>
</span><span class=lnt id=hl-4-58><a class=lnlinks href=#hl-4-58>58</a>
</span><span class=lnt id=hl-4-59><a class=lnlinks href=#hl-4-59>59</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Flask를 사용한 통합 질의 API 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Spark와 Redis 클라이언트 초기화</span>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span><span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;Lambda_Serving_Layer&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/api/user_stats/&lt;user_id&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_user_stats</span><span class=p>(</span><span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사용자 통계 조회 - 배치 뷰와 실시간 뷰 결합&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 현재 시간 기준으로 배치/실시간 경계 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>current_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_cutoff</span> <span class=o>=</span> <span class=n>current_time</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>minute</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>second</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>microsecond</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 배치 뷰에서 과거 데이터 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_stats</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>sql</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        SELECT 
</span></span></span><span class=line><span class=cl><span class=s2>            SUM(total_events) as batch_events,
</span></span></span><span class=line><span class=cl><span class=s2>            SUM(total_duration) as batch_duration,
</span></span></span><span class=line><span class=cl><span class=s2>            SUM(sessions) as batch_sessions
</span></span></span><span class=line><span class=cl><span class=s2>        FROM batch_views.daily_user_stats 
</span></span></span><span class=line><span class=cl><span class=s2>        WHERE user_id = &#39;</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#39; 
</span></span></span><span class=line><span class=cl><span class=s2>        AND date &lt; &#39;</span><span class=si>{</span><span class=n>batch_cutoff</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#39;
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>collect</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 실시간 뷰에서 최근 데이터 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>realtime_events</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>realtime_duration</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 최근 24시간의 실시간 데이터 집계</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>hour_offset</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>24</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>hour_time</span> <span class=o>=</span> <span class=n>current_time</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=n>hour_offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hour_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;user:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:hour:</span><span class=si>{</span><span class=n>hour_time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>%H&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>hour_data</span> <span class=o>=</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>hgetall</span><span class=p>(</span><span class=n>hour_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hour_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>realtime_events</span> <span class=o>+=</span> <span class=nb>int</span><span class=p>(</span><span class=n>hour_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;event_count&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>realtime_duration</span> <span class=o>+=</span> <span class=nb>int</span><span class=p>(</span><span class=n>hour_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;total_duration&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 배치와 실시간 결과 결합</span>
</span></span><span class=line><span class=cl>    <span class=n>total_stats</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;total_events&#39;</span><span class=p>:</span> <span class=p>(</span><span class=n>batch_stats</span><span class=p>[</span><span class=s1>&#39;batch_events&#39;</span><span class=p>]</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>realtime_events</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;total_duration&#39;</span><span class=p>:</span> <span class=p>(</span><span class=n>batch_stats</span><span class=p>[</span><span class=s1>&#39;batch_duration&#39;</span><span class=p>]</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>realtime_duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;total_sessions&#39;</span><span class=p>:</span> <span class=n>batch_stats</span><span class=p>[</span><span class=s1>&#39;batch_sessions&#39;</span><span class=p>]</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;data_freshness&#39;</span><span class=p>:</span> <span class=s1>&#39;real-time&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;last_updated&#39;</span><span class=p>:</span> <span class=n>current_time</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>total_stats</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8080</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 데이터 품질 및 정확성</strong></td><td><strong>정확성 보장</strong></td><td>배치 계층에서 전체 데이터셋 기반의 정합성 높은 결과 제공</td></tr><tr><td></td><td><strong>불변성 기반 복원 가능</strong></td><td>데이터가 변경되지 않으므로 오류 시 재처리로 정확성 회복 가능</td></tr><tr><td></td><td><strong>휴먼 에러 대응력</strong></td><td>잘못된 처리도 전체 재계산으로 정정 가능</td></tr><tr><td><strong>2. 실시간성과 신속성</strong></td><td><strong>실시간성과 지연 최소화</strong></td><td>Speed Layer 를 통해 지연 없이 빠른 응답 제공</td></tr><tr><td></td><td><strong>최신 데이터 반영</strong></td><td>스트림 기반 데이터가 즉시 조회 계층에 반영됨</td></tr><tr><td></td><td><strong>높은 처리량 균형</strong></td><td>배치 처리와 실시간 처리의 장점을 동시에 활용</td></tr><tr><td><strong>3. 확장성 및 유연성</strong></td><td><strong>계층별 독립 확장 가능</strong></td><td>Batch/Speed/Serving Layer 를 개별적으로 확장 가능</td></tr><tr><td></td><td><strong>다양한 기술 스택 적용</strong></td><td>각 계층에 최적화된 기술 선택 가능 (예: Hadoop + Kafka + Cassandra)</td></tr><tr><td></td><td><strong>유연한 처리 구조</strong></td><td>다양한 데이터 처리 요구사항에 대응 가능 (실시간, 지연 허용 분석 등)</td></tr><tr><td><strong>4. 장애 복원력 및 안정성</strong></td><td><strong>강력한 내결함성 (Fault Tolerance)</strong></td><td>계층 간 독립성으로 인해 한 계층의 장애가 전체에 영향을 미치지 않음</td></tr><tr><td></td><td><strong>재처리 기반 복구 가능</strong></td><td>오류나 장애 발생 시 불변 데이터셋 재처리로 복구 가능</td></tr><tr><td><strong>5. 운영 효율성</strong></td><td><strong>데이터 일관성 보장</strong></td><td>실시간 + 배치를 조합하여 최신성과 정합성을 모두 확보</td></tr><tr><td></td><td><strong>시스템 구성 단순화 가능성</strong></td><td>각 계층의 역할이 분리되어 관리 및 유지보수 용이</td></tr></tbody></table><h3 id=610-단점과-문제점-그리고-해결방안>6.10 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#610-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=설계상-단점-structural-drawbacks>설계상 단점 (Structural Drawbacks)<a hidden class=anchor aria-hidden=true href=#설계상-단점-structural-drawbacks>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th><th><strong>원인 또는 배경</strong></th><th><strong>해결 방안</strong></th></tr></thead><tbody><tr><td>아키텍처 복잡성</td><td>계층 분리로 인한 복잡성 증가</td><td>Batch, Speed, Serving 레이어의 독립 운영으로 전체 아키텍처가 복잡해짐</td><td>다중 처리 경로 및 연계 구성의 복잡성</td><td>자동화 도구 도입 (Airflow, Beam), 구조 간소화 및 명확한 책임 구분</td></tr><tr><td>코드 관리</td><td>배치/실시간 처리 코드 중복</td><td>동일한 비즈니스 로직이 두 번 구현되어 유지보수와 테스트 부담 증가</td><td>분리된 처리 방식, API 불일치 등</td><td>Apache Beam, Spark Structured Streaming 등 공통 API 활용, 모듈화 구조 개발</td></tr><tr><td>비용 측면</td><td>인프라 및 운영 비용 상승</td><td>3 계층 분리로 리소스 소비가 중복되고 관리 비용 증가</td><td>이중 처리 및 고가용성 요구</td><td>클라우드 네이티브 서비스 활용 (Glue, Kinesis), 서버리스 기반 처리, 리소스 스케일 최적화</td></tr><tr><td>데이터 정합성</td><td>일관성 보장 지연</td><td>배치와 스트림 결과가 즉시 반영되지 않아 일시적으로 결과 불일치 발생</td><td>비동기 수집과 지연 처리의 차이</td><td>시간 기준 병합 전략, 데이터 버전 관리 및 배치 주기 최적화</td></tr><tr><td>유지보수성</td><td>장애 진단 및 운영 난이도</td><td>각 계층에 대한 모니터링과 복구 전략이 상이하여 통합 운영 난이도 증가</td><td>복잡한 계층 구조 및 로그 파편화</td><td>통합 로그 관리 시스템 구축, 장애 시나리오 자동화, 문서화 강화</td></tr></tbody></table><h4 id=운영상-문제점-runtime-issues>운영상 문제점 (Runtime Issues)<a hidden class=anchor aria-hidden=true href=#운영상-문제점-runtime-issues>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>문제점</strong></th><th><strong>설명</strong></th><th><strong>원인</strong></th><th><strong>탐지 / 예방 / 해결 방안</strong></th></tr></thead><tbody><tr><td>성능 병목</td><td>데이터 스큐 (Data Skew)</td><td>일부 키에 데이터 집중 시 처리 병목 발생</td><td>파티셔닝 키 불균형, 데이터 쏠림</td><td>사전 분포 분석 → 솔트 키 (Salt Key) 적용, 동적 파티셔닝</td></tr><tr><td>처리 안정성</td><td>백프레셔 (Backpressure)</td><td>소비 속도보다 빠른 데이터 유입으로 인한 메모리 고갈, 처리 실패</td><td>큐 과부하, 스트림 처리 속도 부족</td><td>큐 크기 모니터링, 버퍼 조절, 오토스케일링, Reactive Streams 적용</td></tr><tr><td>상태 관리</td><td>상태 관리 복잡성</td><td>스트림 처리 중 상태 유지, 복구, 파티셔닝의 어려움</td><td>Checkpoint 지연, 상태 백업 미흡</td><td>분산 상태 저장소 (Flink RocksDB), 주기적 체크포인트, 상태 파티셔닝</td></tr><tr><td>결과 정합성</td><td>Batch vs Speed 결과 불일치</td><td>사용자에게 시간대별로 다른 결과 노출 가능성 발생</td><td>배치/실시간 처리 시점 불일치</td><td>Timestamp 기반 병합, 동일 기준 시점 적용, Serving Layer 에서의 보정 로직 적용</td></tr><tr><td>데이터 회복력</td><td>재처리 비용/부하</td><td>장애 또는 버그 발생 시 전체 재처리가 필요하여 성능과 비용에 큰 영향</td><td>이력 기반 처리 구조 부재</td><td>증분 처리 구조 도입 (Change Data Capture), Checkpoint 기반 증분 배치 처리</td></tr><tr><td>가용성</td><td>장애 시 전체 서비스 영향</td><td>하나의 계층 실패가 전체 응답 시스템에 영향을 미침</td><td>단일 지점 장애 (Single Point of Failure) 존재</td><td>계층 이중화 구성, 장애 탐지 → 자동 복구 스크립트 및 리트라이 로직 적용</td></tr><tr><td>최신성</td><td>데이터 지연 반영</td><td>배치 주기 지연 시 최신 데이터 미반영으로 사용자 경험 저하</td><td>긴 배치 간격, 느린 ETL 파이프라인</td><td>실시간 비율 확대, 배치 주기 단축, Stream-First 설계로 리디자인</td></tr><tr><td>일관성 검사</td><td>데이터 정합성 검증 미흡</td><td>배치/스트림 결과가 다를 경우 오류 감지가 늦음</td><td>검증 로직 미흡, 테스트 자동화 부족</td><td>데이터 검증 로직 추가 (hash match, 기준값 비교), 로그 기반 이상 탐지</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>문제 원인 / 특성</strong></th><th><strong>영향 및 문제점</strong></th><th><strong>해결 방향</strong></th></tr></thead><tbody><tr><td><strong>1. 설계 복잡도</strong></td><td>코드 및 로직 중복</td><td>Batch 와 Speed Layer 에서 유사한 데이터 처리 로직이 중복 구현됨</td><td>유지보수 난이도 상승, 로직 일관성 저하, 개발 생산성 저하</td><td>공통 유틸리티 추출, 코드 리팩토링, 스트림·배치 공용 DSL 도입</td></tr><tr><td></td><td>데이터 일관성 문제</td><td>두 계층이 다른 타이밍/경로로 동일 데이터를 처리함</td><td>최종 결과 불일치, 분석 결과 신뢰도 저하</td><td>통합 검증 도구 도입, Serving Layer 에서 보정 처리 적용</td></tr><tr><td><strong>2. 운영 복잡성</strong></td><td>장애 격리 및 복구 어려움</td><td>계층이 분리되어 있어 장애 발생 시 연동 지점 복구가 복잡함</td><td>파이프라인 실패 복구 시간 증가, 장애 원인 추적 어려움</td><td>Retry·DLQ 정책, 워크플로우 기반 복구 자동화 도입</td></tr><tr><td></td><td>운영 자동화 어려움</td><td>서로 다른 실행/스케줄 방식의 계층 운영이 병렬로 존재함</td><td>운영 비용 증가, 사람 의존도 상승</td><td>통합 오케스트레이션 툴 (Airflow, Dagster 등) 활용</td></tr><tr><td></td><td>멀티 테넌시</td><td>여러 팀이 하나의 파이프라인을 공유하며 사용</td><td>리소스 경합, 데이터 충돌, 관리 비용 증가</td><td>Namespace 분리, 우선순위 기반 리소스 관리</td></tr><tr><td><strong>3. 비용 효율성</strong></td><td>중복 처리로 인한 자원 낭비</td><td>동일 데이터를 배치·스트림에서 각각 처리</td><td>CPU, I/O, 저장소 비용 증가</td><td>처리 구조 단순화, 중복 작업 제거</td></tr><tr><td></td><td>복잡한 유지보수 및 인력 요구</td><td>파이프라인 수 증가 및 구성 복잡화로 인한 인력 투입 필요</td><td>운영 인력 과부하, 관리 실패 시 장애 확산</td><td>플랫폼화, 파이프라인 표준화</td></tr><tr><td><strong>4. 기술적 제약</strong></td><td>Exactly-Once 처리 보장 어려움</td><td>스트리밍과 배치의 일관된 트랜잭션 처리 어려움</td><td>중복 데이터 발생 또는 일부 누락으로 인한 데이터 오류</td><td>Idempotency 설계, Transactional Producer 활용</td></tr><tr><td></td><td>스키마 진화 대응</td><td>메시지 구조 또는 테이블 스키마의 점진적 변경</td><td>소비자 측 처리 오류, 호환성 문제</td><td>Avro, Protobuf 등 스키마 진화 지원 포맷 사용</td></tr><tr><td></td><td>아키텍처 전환의 어려움</td><td>기존 구성과 워크플로우 의존성이 높음</td><td>Kappa 등 대체 구조 도입에 진입 장벽 존재</td><td>추상화 레이어 도입 → 점진적 마이그레이션</td></tr><tr><td><strong>5. 데이터 품질 및 거버넌스</strong></td><td>데이터 거버넌스</td><td>계층마다 보안, 품질, 추적 수준이 상이함</td><td>규정 준수 어려움, 데이터 오류 추적 어려움</td><td>린리지 추적 도구, IAM, 암호화 정책 도입</td></tr><tr><td></td><td>데이터 신뢰성과 품질 관리</td><td>중간 상태 데이터를 빠르게 소비하지만 품질 보장이 어려움</td><td>사용자 신뢰 하락, 오류 누적</td><td>품질 모니터링 도구 (Monte Carlo 등), 자동 테스트 도입</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>분류 기준</strong></th><th><strong>유형</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 처리 패러다임</strong></td><td>처리 모델</td><td>Lambda Architecture</td><td>Batch + Stream 을 분리하여 병렬로 처리하는 기본 모델</td></tr><tr><td></td><td></td><td>Kappa Architecture</td><td>순수 Stream 기반 처리, 배치 제거로 구조 단순화</td></tr><tr><td></td><td></td><td>Hybrid Lambda</td><td>일부 공통 로직 공유 및 처리 계층에 따라 병합 전략 적용</td></tr><tr><td><strong>2. 처리 구성 방식</strong></td><td>아키텍처 계층 구성</td><td>3-Tier Lambda</td><td>Batch, Speed, Serving 3 계층 분리 구성</td></tr><tr><td></td><td>처리 파이프라인 구성</td><td>Dual Pipeline</td><td>Batch 와 Stream 이 각각 독립된 파이프라인으로 구현됨</td></tr><tr><td></td><td></td><td>Unified Pipeline</td><td>공통 처리 로직 또는 추상화를 통해 배치/스트림 간 재사용 가능 구조</td></tr><tr><td><strong>3. 구현 방식</strong></td><td>기술 적용 전략</td><td>Native Lambda</td><td>Spark, Kafka 등을 직접 구성하여 구현</td></tr><tr><td></td><td></td><td>Managed Lambda</td><td>AWS Glue, Kinesis 등 클라우드 플랫폼을 활용한 관리형 구조</td></tr><tr><td></td><td>배포 환경</td><td>클라우드 네이티브</td><td>완전한 클라우드 기반 (AWS Lambda, Azure Functions 등)</td></tr><tr><td></td><td></td><td>온프레미스</td><td>자체 서버 인프라에서 운영 (Hadoop, Spark 등)</td></tr><tr><td></td><td></td><td>하이브리드 클라우드</td><td>클라우드와 온프레미스 인프라를 조합하여 유연성 확보</td></tr><tr><td><strong>4. 데이터 특성</strong></td><td>데이터 입력 방식</td><td>이벤트 기반</td><td>Kafka 등 이벤트 스트림 중심의 실시간 데이터 처리</td></tr><tr><td></td><td></td><td>시계열 기반</td><td>시간순 정렬된 데이터 (로그, 센서 데이터 등) 의 주기적 분석에 특화</td></tr><tr><td><strong>5. 데이터 저장 구조</strong></td><td>저장 방식</td><td>분산 저장 기반</td><td>HDFS, S3, Parquet 등 확장성 높은 분산 파일 시스템 사용</td></tr><tr><td></td><td>뷰 구성 방식</td><td>머티리얼라이즈드 뷰</td><td>배치 또는 스트림 결과를 주기적으로 저장하여 빠른 질의 제공</td></tr><tr><td><strong>6. 운영 전략</strong></td><td>운영 복잡도 관리</td><td>자동화 기반</td><td>Orchestration (Airflow), 스케줄링, 상태 체크 등을 통한 운영 자동화</td></tr><tr><td></td><td></td><td>수동 통합 관리</td><td>수작업 중심 배치/스트림 관리, 운영 복잡도 증가 가능</td></tr></tbody></table><h4 id=lambda-architecture-vs-kappa-architecture-비교>Lambda Architecture vs. Kappa Architecture 비교<a hidden class=anchor aria-hidden=true href=#lambda-architecture-vs-kappa-architecture-비교>#</a></h4><table><thead><tr><th><strong>비교 항목</strong></th><th><strong>Lambda Architecture</strong></th><th><strong>Kappa Architecture</strong></th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>Batch + Speed Layer 조합으로 실시간성과 정확성을 모두 확보</td><td>단일 스트림 처리 계층으로 실시간 데이터만 처리하며, 배치를 대체함</td></tr><tr><td><strong>구성 계층</strong></td><td>Batch Layer, Speed Layer, Serving Layer</td><td>Stream Layer, Serving Layer (단순화됨)</td></tr><tr><td><strong>데이터 소스</strong></td><td>실시간 스트림 + 배치 파일 모두 처리</td><td>실시간 스트림 중심 처리 (배치 파일도 스트림으로 리플레이)</td></tr><tr><td><strong>처리 방식</strong></td><td>동일 데이터를 배치와 실시간 경로로 각각 처리 (이중 처리)</td><td>하나의 스트림 파이프라인으로 처리 (단일 처리 경로)</td></tr><tr><td><strong>재처리</strong></td><td>배치 계층으로 전체 데이터 재처리</td><td>스트림 리플레이 (replay) 기반</td></tr><tr><td><strong>코드 및 로직</strong></td><td>배치/실시간 로직 분리, 코드 중복 존재 가능</td><td>처리 로직 단일화로 중복 최소화</td></tr><tr><td><strong>복잡도</strong></td><td>계층 구성 및 파이프라인 복잡, 운영·모니터링 복잡도 높음</td><td>아키텍처 단순화, 유지보수 효율적</td></tr><tr><td><strong>정확성 보장</strong></td><td>배치 처리 기반으로 강한 정합성 및 재처리 용이</td><td>스트림 처리 기반으로 정합성 확보가 상대적으로 복잡 (Idempotency, Transaction 필요)</td></tr><tr><td><strong>장애 복구</strong></td><td>불변 데이터로 인해 장애 시 재처리 기반 복구 가능</td><td>스트림 재처리는 가능하나 설계 및 저장소 구성에 따라 복잡</td></tr><tr><td><strong>성능 특성</strong></td><td>배치는 대량 처리에 유리, 실시간 처리는 지연 감소 목적</td><td>모든 처리 스트림 기반 → 실시간 처리에 최적화</td></tr><tr><td><strong>기술 적합도</strong></td><td>Kafka + Hadoop + Spark/Flink (계층별 상이)</td><td>Kafka + Flink/KSQLDB (일관된 기술 스택)</td></tr><tr><td><strong>스키마 관리</strong></td><td>계층 간 포맷 다름 → 스키마 호환성 고려 필요</td><td>단일 파이프라인으로 스키마 관리 일원화 가능</td></tr><tr><td><strong>장점 요약</strong></td><td>- 정확성 보장<br>- 장애 복구 용이<br>- 유연한 계층 확장</td><td>- 단순성<br>- 운영 효율<br>- 로직 일관성 유지</td></tr><tr><td><strong>단점 요약</strong></td><td>- 복잡한 구성 및 운영<br>- 코드 중복 가능성<br>- 비용 증가</td><td>- 정합성 보장 어려움<br>- 재처리 기반 복원 한계</td></tr><tr><td><strong>적합한 경우</strong></td><td>정확성과 실시간성을 모두 요구하는 복합 환경</td><td>실시간성과 개발 단순성이 중요한 환경</td></tr><tr><td><strong>추천 사용 사례</strong></td><td>대규모 정산, 비즈니스 크리티컬 분석, 정합성/정확성 우선 영역</td><td>실시간 피드, IoT 센서 분석, 사용자 행동 추적 등 빠른 반응 요구 영역</td></tr></tbody></table><blockquote><p>🔍 <strong>정리</strong>: Lambda Architecture 는 정밀성과 내결함성을 강조하는 반면, Kappa Architecture 는 실시간성과 단순성을 추구한다. 최근에는 Kappa 방식이 데이터 플랫폼에서 더 많이 채택되는 추세이다.</p></blockquote><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th><strong>도메인</strong></th><th><strong>사용 목적</strong></th><th><strong>기술 조합</strong></th><th><strong>기대 효과</strong></th></tr></thead><tbody><tr><td><strong>1. 로그 분석</strong></td><td>실시간 이상 탐지 + 정확한 이력 분석</td><td>Hadoop (Batch) + Storm/Flink (Stream) + Cassandra</td><td>신속한 이벤트 대응, 보안 감사 기반 확보</td></tr><tr><td><strong>2. 광고 분석</strong></td><td>클릭/노출 로그의 실시간 분석 및 성과 정산</td><td>Spark (Batch) + Kafka (Stream) + Cassandra/Redis</td><td>타겟팅 최적화, 반응 속도 향상, 정확한 정산</td></tr><tr><td><strong>3. 금융 서비스</strong></td><td>실시간 사기 탐지 및 트랜잭션 정산</td><td>Kafka + Flink (Speed) + Cassandra/HBase (Serving)</td><td>리스크 감지 향상, 회계 일치, 응답 시간 단축</td></tr><tr><td><strong>4. IoT 플랫폼</strong></td><td>센서 이벤트 실시간 분석 및 이력 기반 이상 예측</td><td>Spark/Storm + Kafka + InfluxDB/Grafana</td><td>예지 정비, 유지보수 자동화, 장애 예방</td></tr><tr><td><strong>5. 전자상거래</strong></td><td>사용자 행동 기반 추천 및 개인화 모델 적용</td><td>Spark + Kafka + Redis + Druid</td><td>추천 정확도 향상, 매출 증대</td></tr><tr><td><strong>6. 통신 네트워크</strong></td><td>실시간 트래픽 감시 및 네트워크 이상 탐지</td><td>Kafka + Samza + HBase</td><td>네트워크 장애 예방, 복구 시간 단축</td></tr><tr><td><strong>7. 미디어/OTT</strong></td><td>사용자 시청 패턴 실시간 수집 및 분석</td><td>Pulsar + Druid + Elasticsearch</td><td>콘텐츠 개인화, 시청률 향상, 이탈률 감소</td></tr><tr><td><strong>8. 제조/산업 설비</strong></td><td>생산 공정 및 품질 지표 실시간 모니터링</td><td>Kafka + Flink + Time-series DB (e.g. InfluxDB)</td><td>생산성 향상, 품질 이상 사전 감지</td></tr></tbody></table><h4 id=유형-분류-요약>유형 분류 요약<a hidden class=anchor aria-hidden=true href=#유형-분류-요약>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>정의</strong></th><th><strong>대표 사례</strong></th></tr></thead><tbody><tr><td><strong>분석 중심형</strong></td><td>실시간 이벤트 분석 + 배치 기반 통계 집계 결합</td><td>로그 분석, 시청 패턴 분석</td></tr><tr><td><strong>정산/회계형</strong></td><td>실시간 응답 + 정확한 정산을 위한 배치 보정 처리 구조</td><td>광고 분석, 금융 거래</td></tr><tr><td><strong>예측/모니터링형</strong></td><td>실시간 수집 → 상태 예측 및 이상 탐지</td><td>IoT, 제조 설비, 네트워크</td></tr><tr><td><strong>개인화/추천형</strong></td><td>사용자 행동 실시간 추적 + 모델 학습/갱신 기반 추천 시스템 구현</td><td>이커머스, 미디어</td></tr><tr><td><strong>플랫폼 통합형</strong></td><td>다양한 이벤트 및 이력 정보를 통합 분석하여 거버넌스 및 통찰 확보</td><td>통신사, 대규모 IoT 플랫폼</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-광고-실시간-분석-시스템-real-time-ad-analytics>사례 1: 광고 실시간 분석 시스템 (Real-time Ad Analytics)<a hidden class=anchor aria-hidden=true href=#사례-1-광고-실시간-분석-시스템-real-time-ad-analytics>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li><strong>Batch Layer</strong>: 사용자 클릭 로그를 Spark 로 하루 단위 집계</li><li><strong>Speed Layer</strong>: Kafka + Flink 로 실시간 클릭 수 카운팅</li><li><strong>Serving Layer</strong>: Elasticsearch 에 batch + stream 결과 병합 저장</li></ul><p><strong>Workflow</strong>:</p><pre class=mermaid>sequenceDiagram
    participant User as 광고 사용자
    participant Kafka as Kafka (Ingestion)
    participant Flink as Speed Layer
    participant Spark as Batch Layer
    participant ES as Elasticsearch (Serving Layer)

    User-&gt;&gt;Kafka: 클릭 로그 발생
    Kafka-&gt;&gt;Flink: 실시간 처리
    Kafka-&gt;&gt;Spark: 배치 입력 대기
    Spark-&gt;&gt;ES: 배치 결과 저장
    Flink-&gt;&gt;ES: 실시간 결과 저장
    ES--&gt;&gt;User: 광고 성과 응답
</pre><p><strong>Lambda Architecture 의 역할</strong>:</p><ul><li>실시간으로 광고 클릭 성과를 대시보드에 표시 (Flink)</li><li>배치로 누적 성과 집계 및 이상 징후 검출 (Spark)</li><li>Serving Layer 가 두 결과를 병합하여 제공</li></ul><p><strong>유무에 따른 차이점</strong>:</p><table><thead><tr><th>비교 항목</th><th>Lambda 사용</th><th>미사용 (단일 처리)</th></tr></thead><tbody><tr><td>실시간성</td><td>우수</td><td>낮음</td></tr><tr><td>정합성</td><td>보장</td><td>실시간 처리에 의존하여 낮음</td></tr><tr><td>장애 대응</td><td>재처리 가능</td><td>실시간 처리 실패 시 손실 위험</td></tr></tbody></table><h4 id=사례-2-실시간-로그-분석-시스템>사례 2: 실시간 로그 분석 시스템<a hidden class=anchor aria-hidden=true href=#사례-2-실시간-로그-분석-시스템>#</a></h4><p><strong>시스템 구성:</strong></p><ul><li>웹 서버 로그 → Kafka(메시지 큐) → Hadoop(배치 처리) + Storm(실시간 처리) → HBase(서빙) → 대시보드</li></ul><p><strong>Workflow:</strong></p><ol><li>로그 데이터가 Kafka 로 유입</li><li>Hadoop 이 전체 로그를 배치로 분석</li><li>Storm 이 최신 로그를 실시간 분석</li><li>HBase 에 두 결과를 저장, 대시보드에서 결합 결과 조회</li></ol><p><strong>Lambda Architecture 의 역할:</strong></p><ul><li>실시간 이벤트 탐지, 정확한 집계, 장애 복원력</li></ul><p><strong>Lambda Architecture 유무에 따른 차이:</strong></p><ul><li><strong>도입 전:</strong><br>실시간성과 정확성 중 하나만 선택 가능, 장애 복원력 약함</li><li><strong>도입 후:</strong><br>실시간성과 정확성 동시 확보, 장애 복원력 및 확장성 강화</li></ul><h4 id=사례-3-전자상거래-실시간-추천-시스템>사례 3: 전자상거래 실시간 추천 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-전자상거래-실시간-추천-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li><strong>데이터 소스</strong>: 웹 클릭스트림, 구매 이력, 상품 카탈로그, 사용자 프로필</li><li><strong>수집 계층</strong>: Apache Kafka 를 통한 실시간 이벤트 수집</li><li><strong>배치 레이어</strong>: Apache Spark 를 사용한 일일 협업 필터링 모델 학습</li><li><strong>스피드 레이어</strong>: Apache Flink 를 통한 실시간 클릭스트림 분석</li><li><strong>서빙 레이어</strong>: Redis 기반 실시간 추천 캐시, Apache Cassandra 기반 배치 추천 저장</li></ul><pre class=mermaid>graph TD
    subgraph &#34;데이터 소스&#34;
        WEB[웹 클릭스트림]
        ORDER[주문 데이터]
        PRODUCT[상품 카탈로그]
        USER[사용자 프로필]
    end
    
    subgraph &#34;수집 계층&#34;
        KAFKA[Apache Kafka&lt;br/&gt;실시간 이벤트 수집]
    end
    
    subgraph &#34;배치 레이어&#34;
        SPARK[Apache Spark&lt;br/&gt;협업 필터링 모델]
        HDFS[HDFS&lt;br/&gt;과거 데이터 저장]
        MODEL[추천 모델&lt;br/&gt;MLlib]
    end
    
    subgraph &#34;스피드 레이어&#34;
        FLINK[Apache Flink&lt;br/&gt;실시간 행동 분석]
        REDIS[Redis&lt;br/&gt;실시간 세션 추적]
    end
    
    subgraph &#34;서빙 레이어&#34;
        CASSANDRA[Apache Cassandra&lt;br/&gt;배치 추천 저장]
        CACHE[Redis Cache&lt;br/&gt;실시간 추천 캐시]
        API[추천 API&lt;br/&gt;Gateway]
    end
    
    subgraph &#34;응용 계층&#34;
        WEBSITE[전자상거래 웹사이트]
        MOBILE[모바일 앱]
        EMAIL[이메일 마케팅]
    end
    
    WEB --&gt; KAFKA
    ORDER --&gt; KAFKA
    PRODUCT --&gt; KAFKA
    USER --&gt; KAFKA
    
    KAFKA --&gt; SPARK
    KAFKA --&gt; FLINK
    
    SPARK --&gt; HDFS
    HDFS --&gt; MODEL
    MODEL --&gt; CASSANDRA
    
    FLINK --&gt; REDIS
    REDIS --&gt; CACHE
    
    CASSANDRA --&gt; API
    CACHE --&gt; API
    
    API --&gt; WEBSITE
    API --&gt; MOBILE
    API --&gt; EMAIL
</pre><p><strong>Workflow</strong>:</p><ol><li><strong>데이터 수집</strong>: 사용자의 웹 브라우징, 구매, 검색 활동이 실시간으로 Kafka 에 수집</li><li><strong>배치 처리</strong>: 매일 밤 Spark 를 통해 전체 사용자 행동 데이터 기반 협업 필터링 모델 학습</li><li><strong>실시간 처리</strong>: Flink 를 통해 현재 세션의 사용자 행동을 실시간 분석하여 즉시 추천 업데이트</li><li><strong>결과 통합</strong>: 배치 추천 (장기 선호도) 과 실시간 추천 (즉시 관심사) 을 결합하여 개인화된 추천 제공</li></ol><p><strong>Lambda Architecture 의 역할</strong>:</p><ul><li><strong>배치 레이어</strong>: 정확한 장기 사용자 선호도 모델링 및 상품 간 유사도 계산</li><li><strong>스피드 레이어</strong>: 현재 세션의 즉시 관심사 반영 및 실시간 개인화</li><li><strong>서빙 레이어</strong>: 두 레이어의 결과를 결합하여 최적의 추천 목록 생성</li></ul><p><strong>Lambda Architecture 유무에 따른 차이점</strong>:</p><table><thead><tr><th>구분</th><th>Lambda Architecture 적용</th><th>기존 배치 처리만 적용</th></tr></thead><tbody><tr><td>추천 정확도</td><td>장기 선호도 + 실시간 관심사 반영으로 90% 정확도</td><td>과거 데이터 기반으로만 75% 정확도</td></tr><tr><td>응답 시간</td><td>실시간 추천으로 50ms 이내 응답</td><td>배치 처리로 24 시간 지연</td></tr><tr><td>사용자 경험</td><td>즉시 행동 변화 반영으로 높은 참여도</td><td>과거 선호도만 반영으로 낮은 적합성</td></tr><tr><td>비즈니스 효과</td><td>클릭률 25% 향상, 매출 15% 증가</td><td>기존 대비 개선 효과 제한적</td></tr></tbody></table><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><h4 id=python-전자상거래-추천-시스템의-핵심-구성요소>Python: 전자상거래 추천 시스템의 핵심 구성요소<a hidden class=anchor aria-hidden=true href=#python-전자상거래-추천-시스템의-핵심-구성요소>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>  1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>  2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>  3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>  4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>  5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6>  6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7>  7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8>  8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9>  9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10> 10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11> 11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12> 12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13> 13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14> 14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15> 15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16> 16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17> 17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18> 18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19> 19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20> 20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21> 21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22> 22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23> 23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24> 24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25> 25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26> 26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27> 27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28> 28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29> 29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30> 30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31> 31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32> 32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33> 33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34> 34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35> 35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36> 36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37> 37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38> 38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39> 39</a>
</span><span class=lnt id=hl-7-40><a class=lnlinks href=#hl-7-40> 40</a>
</span><span class=lnt id=hl-7-41><a class=lnlinks href=#hl-7-41> 41</a>
</span><span class=lnt id=hl-7-42><a class=lnlinks href=#hl-7-42> 42</a>
</span><span class=lnt id=hl-7-43><a class=lnlinks href=#hl-7-43> 43</a>
</span><span class=lnt id=hl-7-44><a class=lnlinks href=#hl-7-44> 44</a>
</span><span class=lnt id=hl-7-45><a class=lnlinks href=#hl-7-45> 45</a>
</span><span class=lnt id=hl-7-46><a class=lnlinks href=#hl-7-46> 46</a>
</span><span class=lnt id=hl-7-47><a class=lnlinks href=#hl-7-47> 47</a>
</span><span class=lnt id=hl-7-48><a class=lnlinks href=#hl-7-48> 48</a>
</span><span class=lnt id=hl-7-49><a class=lnlinks href=#hl-7-49> 49</a>
</span><span class=lnt id=hl-7-50><a class=lnlinks href=#hl-7-50> 50</a>
</span><span class=lnt id=hl-7-51><a class=lnlinks href=#hl-7-51> 51</a>
</span><span class=lnt id=hl-7-52><a class=lnlinks href=#hl-7-52> 52</a>
</span><span class=lnt id=hl-7-53><a class=lnlinks href=#hl-7-53> 53</a>
</span><span class=lnt id=hl-7-54><a class=lnlinks href=#hl-7-54> 54</a>
</span><span class=lnt id=hl-7-55><a class=lnlinks href=#hl-7-55> 55</a>
</span><span class=lnt id=hl-7-56><a class=lnlinks href=#hl-7-56> 56</a>
</span><span class=lnt id=hl-7-57><a class=lnlinks href=#hl-7-57> 57</a>
</span><span class=lnt id=hl-7-58><a class=lnlinks href=#hl-7-58> 58</a>
</span><span class=lnt id=hl-7-59><a class=lnlinks href=#hl-7-59> 59</a>
</span><span class=lnt id=hl-7-60><a class=lnlinks href=#hl-7-60> 60</a>
</span><span class=lnt id=hl-7-61><a class=lnlinks href=#hl-7-61> 61</a>
</span><span class=lnt id=hl-7-62><a class=lnlinks href=#hl-7-62> 62</a>
</span><span class=lnt id=hl-7-63><a class=lnlinks href=#hl-7-63> 63</a>
</span><span class=lnt id=hl-7-64><a class=lnlinks href=#hl-7-64> 64</a>
</span><span class=lnt id=hl-7-65><a class=lnlinks href=#hl-7-65> 65</a>
</span><span class=lnt id=hl-7-66><a class=lnlinks href=#hl-7-66> 66</a>
</span><span class=lnt id=hl-7-67><a class=lnlinks href=#hl-7-67> 67</a>
</span><span class=lnt id=hl-7-68><a class=lnlinks href=#hl-7-68> 68</a>
</span><span class=lnt id=hl-7-69><a class=lnlinks href=#hl-7-69> 69</a>
</span><span class=lnt id=hl-7-70><a class=lnlinks href=#hl-7-70> 70</a>
</span><span class=lnt id=hl-7-71><a class=lnlinks href=#hl-7-71> 71</a>
</span><span class=lnt id=hl-7-72><a class=lnlinks href=#hl-7-72> 72</a>
</span><span class=lnt id=hl-7-73><a class=lnlinks href=#hl-7-73> 73</a>
</span><span class=lnt id=hl-7-74><a class=lnlinks href=#hl-7-74> 74</a>
</span><span class=lnt id=hl-7-75><a class=lnlinks href=#hl-7-75> 75</a>
</span><span class=lnt id=hl-7-76><a class=lnlinks href=#hl-7-76> 76</a>
</span><span class=lnt id=hl-7-77><a class=lnlinks href=#hl-7-77> 77</a>
</span><span class=lnt id=hl-7-78><a class=lnlinks href=#hl-7-78> 78</a>
</span><span class=lnt id=hl-7-79><a class=lnlinks href=#hl-7-79> 79</a>
</span><span class=lnt id=hl-7-80><a class=lnlinks href=#hl-7-80> 80</a>
</span><span class=lnt id=hl-7-81><a class=lnlinks href=#hl-7-81> 81</a>
</span><span class=lnt id=hl-7-82><a class=lnlinks href=#hl-7-82> 82</a>
</span><span class=lnt id=hl-7-83><a class=lnlinks href=#hl-7-83> 83</a>
</span><span class=lnt id=hl-7-84><a class=lnlinks href=#hl-7-84> 84</a>
</span><span class=lnt id=hl-7-85><a class=lnlinks href=#hl-7-85> 85</a>
</span><span class=lnt id=hl-7-86><a class=lnlinks href=#hl-7-86> 86</a>
</span><span class=lnt id=hl-7-87><a class=lnlinks href=#hl-7-87> 87</a>
</span><span class=lnt id=hl-7-88><a class=lnlinks href=#hl-7-88> 88</a>
</span><span class=lnt id=hl-7-89><a class=lnlinks href=#hl-7-89> 89</a>
</span><span class=lnt id=hl-7-90><a class=lnlinks href=#hl-7-90> 90</a>
</span><span class=lnt id=hl-7-91><a class=lnlinks href=#hl-7-91> 91</a>
</span><span class=lnt id=hl-7-92><a class=lnlinks href=#hl-7-92> 92</a>
</span><span class=lnt id=hl-7-93><a class=lnlinks href=#hl-7-93> 93</a>
</span><span class=lnt id=hl-7-94><a class=lnlinks href=#hl-7-94> 94</a>
</span><span class=lnt id=hl-7-95><a class=lnlinks href=#hl-7-95> 95</a>
</span><span class=lnt id=hl-7-96><a class=lnlinks href=#hl-7-96> 96</a>
</span><span class=lnt id=hl-7-97><a class=lnlinks href=#hl-7-97> 97</a>
</span><span class=lnt id=hl-7-98><a class=lnlinks href=#hl-7-98> 98</a>
</span><span class=lnt id=hl-7-99><a class=lnlinks href=#hl-7-99> 99</a>
</span><span class=lnt id=hl-7-100><a class=lnlinks href=#hl-7-100>100</a>
</span><span class=lnt id=hl-7-101><a class=lnlinks href=#hl-7-101>101</a>
</span><span class=lnt id=hl-7-102><a class=lnlinks href=#hl-7-102>102</a>
</span><span class=lnt id=hl-7-103><a class=lnlinks href=#hl-7-103>103</a>
</span><span class=lnt id=hl-7-104><a class=lnlinks href=#hl-7-104>104</a>
</span><span class=lnt id=hl-7-105><a class=lnlinks href=#hl-7-105>105</a>
</span><span class=lnt id=hl-7-106><a class=lnlinks href=#hl-7-106>106</a>
</span><span class=lnt id=hl-7-107><a class=lnlinks href=#hl-7-107>107</a>
</span><span class=lnt id=hl-7-108><a class=lnlinks href=#hl-7-108>108</a>
</span><span class=lnt id=hl-7-109><a class=lnlinks href=#hl-7-109>109</a>
</span><span class=lnt id=hl-7-110><a class=lnlinks href=#hl-7-110>110</a>
</span><span class=lnt id=hl-7-111><a class=lnlinks href=#hl-7-111>111</a>
</span><span class=lnt id=hl-7-112><a class=lnlinks href=#hl-7-112>112</a>
</span><span class=lnt id=hl-7-113><a class=lnlinks href=#hl-7-113>113</a>
</span><span class=lnt id=hl-7-114><a class=lnlinks href=#hl-7-114>114</a>
</span><span class=lnt id=hl-7-115><a class=lnlinks href=#hl-7-115>115</a>
</span><span class=lnt id=hl-7-116><a class=lnlinks href=#hl-7-116>116</a>
</span><span class=lnt id=hl-7-117><a class=lnlinks href=#hl-7-117>117</a>
</span><span class=lnt id=hl-7-118><a class=lnlinks href=#hl-7-118>118</a>
</span><span class=lnt id=hl-7-119><a class=lnlinks href=#hl-7-119>119</a>
</span><span class=lnt id=hl-7-120><a class=lnlinks href=#hl-7-120>120</a>
</span><span class=lnt id=hl-7-121><a class=lnlinks href=#hl-7-121>121</a>
</span><span class=lnt id=hl-7-122><a class=lnlinks href=#hl-7-122>122</a>
</span><span class=lnt id=hl-7-123><a class=lnlinks href=#hl-7-123>123</a>
</span><span class=lnt id=hl-7-124><a class=lnlinks href=#hl-7-124>124</a>
</span><span class=lnt id=hl-7-125><a class=lnlinks href=#hl-7-125>125</a>
</span><span class=lnt id=hl-7-126><a class=lnlinks href=#hl-7-126>126</a>
</span><span class=lnt id=hl-7-127><a class=lnlinks href=#hl-7-127>127</a>
</span><span class=lnt id=hl-7-128><a class=lnlinks href=#hl-7-128>128</a>
</span><span class=lnt id=hl-7-129><a class=lnlinks href=#hl-7-129>129</a>
</span><span class=lnt id=hl-7-130><a class=lnlinks href=#hl-7-130>130</a>
</span><span class=lnt id=hl-7-131><a class=lnlinks href=#hl-7-131>131</a>
</span><span class=lnt id=hl-7-132><a class=lnlinks href=#hl-7-132>132</a>
</span><span class=lnt id=hl-7-133><a class=lnlinks href=#hl-7-133>133</a>
</span><span class=lnt id=hl-7-134><a class=lnlinks href=#hl-7-134>134</a>
</span><span class=lnt id=hl-7-135><a class=lnlinks href=#hl-7-135>135</a>
</span><span class=lnt id=hl-7-136><a class=lnlinks href=#hl-7-136>136</a>
</span><span class=lnt id=hl-7-137><a class=lnlinks href=#hl-7-137>137</a>
</span><span class=lnt id=hl-7-138><a class=lnlinks href=#hl-7-138>138</a>
</span><span class=lnt id=hl-7-139><a class=lnlinks href=#hl-7-139>139</a>
</span><span class=lnt id=hl-7-140><a class=lnlinks href=#hl-7-140>140</a>
</span><span class=lnt id=hl-7-141><a class=lnlinks href=#hl-7-141>141</a>
</span><span class=lnt id=hl-7-142><a class=lnlinks href=#hl-7-142>142</a>
</span><span class=lnt id=hl-7-143><a class=lnlinks href=#hl-7-143>143</a>
</span><span class=lnt id=hl-7-144><a class=lnlinks href=#hl-7-144>144</a>
</span><span class=lnt id=hl-7-145><a class=lnlinks href=#hl-7-145>145</a>
</span><span class=lnt id=hl-7-146><a class=lnlinks href=#hl-7-146>146</a>
</span><span class=lnt id=hl-7-147><a class=lnlinks href=#hl-7-147>147</a>
</span><span class=lnt id=hl-7-148><a class=lnlinks href=#hl-7-148>148</a>
</span><span class=lnt id=hl-7-149><a class=lnlinks href=#hl-7-149>149</a>
</span><span class=lnt id=hl-7-150><a class=lnlinks href=#hl-7-150>150</a>
</span><span class=lnt id=hl-7-151><a class=lnlinks href=#hl-7-151>151</a>
</span><span class=lnt id=hl-7-152><a class=lnlinks href=#hl-7-152>152</a>
</span><span class=lnt id=hl-7-153><a class=lnlinks href=#hl-7-153>153</a>
</span><span class=lnt id=hl-7-154><a class=lnlinks href=#hl-7-154>154</a>
</span><span class=lnt id=hl-7-155><a class=lnlinks href=#hl-7-155>155</a>
</span><span class=lnt id=hl-7-156><a class=lnlinks href=#hl-7-156>156</a>
</span><span class=lnt id=hl-7-157><a class=lnlinks href=#hl-7-157>157</a>
</span><span class=lnt id=hl-7-158><a class=lnlinks href=#hl-7-158>158</a>
</span><span class=lnt id=hl-7-159><a class=lnlinks href=#hl-7-159>159</a>
</span><span class=lnt id=hl-7-160><a class=lnlinks href=#hl-7-160>160</a>
</span><span class=lnt id=hl-7-161><a class=lnlinks href=#hl-7-161>161</a>
</span><span class=lnt id=hl-7-162><a class=lnlinks href=#hl-7-162>162</a>
</span><span class=lnt id=hl-7-163><a class=lnlinks href=#hl-7-163>163</a>
</span><span class=lnt id=hl-7-164><a class=lnlinks href=#hl-7-164>164</a>
</span><span class=lnt id=hl-7-165><a class=lnlinks href=#hl-7-165>165</a>
</span><span class=lnt id=hl-7-166><a class=lnlinks href=#hl-7-166>166</a>
</span><span class=lnt id=hl-7-167><a class=lnlinks href=#hl-7-167>167</a>
</span><span class=lnt id=hl-7-168><a class=lnlinks href=#hl-7-168>168</a>
</span><span class=lnt id=hl-7-169><a class=lnlinks href=#hl-7-169>169</a>
</span><span class=lnt id=hl-7-170><a class=lnlinks href=#hl-7-170>170</a>
</span><span class=lnt id=hl-7-171><a class=lnlinks href=#hl-7-171>171</a>
</span><span class=lnt id=hl-7-172><a class=lnlinks href=#hl-7-172>172</a>
</span><span class=lnt id=hl-7-173><a class=lnlinks href=#hl-7-173>173</a>
</span><span class=lnt id=hl-7-174><a class=lnlinks href=#hl-7-174>174</a>
</span><span class=lnt id=hl-7-175><a class=lnlinks href=#hl-7-175>175</a>
</span><span class=lnt id=hl-7-176><a class=lnlinks href=#hl-7-176>176</a>
</span><span class=lnt id=hl-7-177><a class=lnlinks href=#hl-7-177>177</a>
</span><span class=lnt id=hl-7-178><a class=lnlinks href=#hl-7-178>178</a>
</span><span class=lnt id=hl-7-179><a class=lnlinks href=#hl-7-179>179</a>
</span><span class=lnt id=hl-7-180><a class=lnlinks href=#hl-7-180>180</a>
</span><span class=lnt id=hl-7-181><a class=lnlinks href=#hl-7-181>181</a>
</span><span class=lnt id=hl-7-182><a class=lnlinks href=#hl-7-182>182</a>
</span><span class=lnt id=hl-7-183><a class=lnlinks href=#hl-7-183>183</a>
</span><span class=lnt id=hl-7-184><a class=lnlinks href=#hl-7-184>184</a>
</span><span class=lnt id=hl-7-185><a class=lnlinks href=#hl-7-185>185</a>
</span><span class=lnt id=hl-7-186><a class=lnlinks href=#hl-7-186>186</a>
</span><span class=lnt id=hl-7-187><a class=lnlinks href=#hl-7-187>187</a>
</span><span class=lnt id=hl-7-188><a class=lnlinks href=#hl-7-188>188</a>
</span><span class=lnt id=hl-7-189><a class=lnlinks href=#hl-7-189>189</a>
</span><span class=lnt id=hl-7-190><a class=lnlinks href=#hl-7-190>190</a>
</span><span class=lnt id=hl-7-191><a class=lnlinks href=#hl-7-191>191</a>
</span><span class=lnt id=hl-7-192><a class=lnlinks href=#hl-7-192>192</a>
</span><span class=lnt id=hl-7-193><a class=lnlinks href=#hl-7-193>193</a>
</span><span class=lnt id=hl-7-194><a class=lnlinks href=#hl-7-194>194</a>
</span><span class=lnt id=hl-7-195><a class=lnlinks href=#hl-7-195>195</a>
</span><span class=lnt id=hl-7-196><a class=lnlinks href=#hl-7-196>196</a>
</span><span class=lnt id=hl-7-197><a class=lnlinks href=#hl-7-197>197</a>
</span><span class=lnt id=hl-7-198><a class=lnlinks href=#hl-7-198>198</a>
</span><span class=lnt id=hl-7-199><a class=lnlinks href=#hl-7-199>199</a>
</span><span class=lnt id=hl-7-200><a class=lnlinks href=#hl-7-200>200</a>
</span><span class=lnt id=hl-7-201><a class=lnlinks href=#hl-7-201>201</a>
</span><span class=lnt id=hl-7-202><a class=lnlinks href=#hl-7-202>202</a>
</span><span class=lnt id=hl-7-203><a class=lnlinks href=#hl-7-203>203</a>
</span><span class=lnt id=hl-7-204><a class=lnlinks href=#hl-7-204>204</a>
</span><span class=lnt id=hl-7-205><a class=lnlinks href=#hl-7-205>205</a>
</span><span class=lnt id=hl-7-206><a class=lnlinks href=#hl-7-206>206</a>
</span><span class=lnt id=hl-7-207><a class=lnlinks href=#hl-7-207>207</a>
</span><span class=lnt id=hl-7-208><a class=lnlinks href=#hl-7-208>208</a>
</span><span class=lnt id=hl-7-209><a class=lnlinks href=#hl-7-209>209</a>
</span><span class=lnt id=hl-7-210><a class=lnlinks href=#hl-7-210>210</a>
</span><span class=lnt id=hl-7-211><a class=lnlinks href=#hl-7-211>211</a>
</span><span class=lnt id=hl-7-212><a class=lnlinks href=#hl-7-212>212</a>
</span><span class=lnt id=hl-7-213><a class=lnlinks href=#hl-7-213>213</a>
</span><span class=lnt id=hl-7-214><a class=lnlinks href=#hl-7-214>214</a>
</span><span class=lnt id=hl-7-215><a class=lnlinks href=#hl-7-215>215</a>
</span><span class=lnt id=hl-7-216><a class=lnlinks href=#hl-7-216>216</a>
</span><span class=lnt id=hl-7-217><a class=lnlinks href=#hl-7-217>217</a>
</span><span class=lnt id=hl-7-218><a class=lnlinks href=#hl-7-218>218</a>
</span><span class=lnt id=hl-7-219><a class=lnlinks href=#hl-7-219>219</a>
</span><span class=lnt id=hl-7-220><a class=lnlinks href=#hl-7-220>220</a>
</span><span class=lnt id=hl-7-221><a class=lnlinks href=#hl-7-221>221</a>
</span><span class=lnt id=hl-7-222><a class=lnlinks href=#hl-7-222>222</a>
</span><span class=lnt id=hl-7-223><a class=lnlinks href=#hl-7-223>223</a>
</span><span class=lnt id=hl-7-224><a class=lnlinks href=#hl-7-224>224</a>
</span><span class=lnt id=hl-7-225><a class=lnlinks href=#hl-7-225>225</a>
</span><span class=lnt id=hl-7-226><a class=lnlinks href=#hl-7-226>226</a>
</span><span class=lnt id=hl-7-227><a class=lnlinks href=#hl-7-227>227</a>
</span><span class=lnt id=hl-7-228><a class=lnlinks href=#hl-7-228>228</a>
</span><span class=lnt id=hl-7-229><a class=lnlinks href=#hl-7-229>229</a>
</span><span class=lnt id=hl-7-230><a class=lnlinks href=#hl-7-230>230</a>
</span><span class=lnt id=hl-7-231><a class=lnlinks href=#hl-7-231>231</a>
</span><span class=lnt id=hl-7-232><a class=lnlinks href=#hl-7-232>232</a>
</span><span class=lnt id=hl-7-233><a class=lnlinks href=#hl-7-233>233</a>
</span><span class=lnt id=hl-7-234><a class=lnlinks href=#hl-7-234>234</a>
</span><span class=lnt id=hl-7-235><a class=lnlinks href=#hl-7-235>235</a>
</span><span class=lnt id=hl-7-236><a class=lnlinks href=#hl-7-236>236</a>
</span><span class=lnt id=hl-7-237><a class=lnlinks href=#hl-7-237>237</a>
</span><span class=lnt id=hl-7-238><a class=lnlinks href=#hl-7-238>238</a>
</span><span class=lnt id=hl-7-239><a class=lnlinks href=#hl-7-239>239</a>
</span><span class=lnt id=hl-7-240><a class=lnlinks href=#hl-7-240>240</a>
</span><span class=lnt id=hl-7-241><a class=lnlinks href=#hl-7-241>241</a>
</span><span class=lnt id=hl-7-242><a class=lnlinks href=#hl-7-242>242</a>
</span><span class=lnt id=hl-7-243><a class=lnlinks href=#hl-7-243>243</a>
</span><span class=lnt id=hl-7-244><a class=lnlinks href=#hl-7-244>244</a>
</span><span class=lnt id=hl-7-245><a class=lnlinks href=#hl-7-245>245</a>
</span><span class=lnt id=hl-7-246><a class=lnlinks href=#hl-7-246>246</a>
</span><span class=lnt id=hl-7-247><a class=lnlinks href=#hl-7-247>247</a>
</span><span class=lnt id=hl-7-248><a class=lnlinks href=#hl-7-248>248</a>
</span><span class=lnt id=hl-7-249><a class=lnlinks href=#hl-7-249>249</a>
</span><span class=lnt id=hl-7-250><a class=lnlinks href=#hl-7-250>250</a>
</span><span class=lnt id=hl-7-251><a class=lnlinks href=#hl-7-251>251</a>
</span><span class=lnt id=hl-7-252><a class=lnlinks href=#hl-7-252>252</a>
</span><span class=lnt id=hl-7-253><a class=lnlinks href=#hl-7-253>253</a>
</span><span class=lnt id=hl-7-254><a class=lnlinks href=#hl-7-254>254</a>
</span><span class=lnt id=hl-7-255><a class=lnlinks href=#hl-7-255>255</a>
</span><span class=lnt id=hl-7-256><a class=lnlinks href=#hl-7-256>256</a>
</span><span class=lnt id=hl-7-257><a class=lnlinks href=#hl-7-257>257</a>
</span><span class=lnt id=hl-7-258><a class=lnlinks href=#hl-7-258>258</a>
</span><span class=lnt id=hl-7-259><a class=lnlinks href=#hl-7-259>259</a>
</span><span class=lnt id=hl-7-260><a class=lnlinks href=#hl-7-260>260</a>
</span><span class=lnt id=hl-7-261><a class=lnlinks href=#hl-7-261>261</a>
</span><span class=lnt id=hl-7-262><a class=lnlinks href=#hl-7-262>262</a>
</span><span class=lnt id=hl-7-263><a class=lnlinks href=#hl-7-263>263</a>
</span><span class=lnt id=hl-7-264><a class=lnlinks href=#hl-7-264>264</a>
</span><span class=lnt id=hl-7-265><a class=lnlinks href=#hl-7-265>265</a>
</span><span class=lnt id=hl-7-266><a class=lnlinks href=#hl-7-266>266</a>
</span><span class=lnt id=hl-7-267><a class=lnlinks href=#hl-7-267>267</a>
</span><span class=lnt id=hl-7-268><a class=lnlinks href=#hl-7-268>268</a>
</span><span class=lnt id=hl-7-269><a class=lnlinks href=#hl-7-269>269</a>
</span><span class=lnt id=hl-7-270><a class=lnlinks href=#hl-7-270>270</a>
</span><span class=lnt id=hl-7-271><a class=lnlinks href=#hl-7-271>271</a>
</span><span class=lnt id=hl-7-272><a class=lnlinks href=#hl-7-272>272</a>
</span><span class=lnt id=hl-7-273><a class=lnlinks href=#hl-7-273>273</a>
</span><span class=lnt id=hl-7-274><a class=lnlinks href=#hl-7-274>274</a>
</span><span class=lnt id=hl-7-275><a class=lnlinks href=#hl-7-275>275</a>
</span><span class=lnt id=hl-7-276><a class=lnlinks href=#hl-7-276>276</a>
</span><span class=lnt id=hl-7-277><a class=lnlinks href=#hl-7-277>277</a>
</span><span class=lnt id=hl-7-278><a class=lnlinks href=#hl-7-278>278</a>
</span><span class=lnt id=hl-7-279><a class=lnlinks href=#hl-7-279>279</a>
</span><span class=lnt id=hl-7-280><a class=lnlinks href=#hl-7-280>280</a>
</span><span class=lnt id=hl-7-281><a class=lnlinks href=#hl-7-281>281</a>
</span><span class=lnt id=hl-7-282><a class=lnlinks href=#hl-7-282>282</a>
</span><span class=lnt id=hl-7-283><a class=lnlinks href=#hl-7-283>283</a>
</span><span class=lnt id=hl-7-284><a class=lnlinks href=#hl-7-284>284</a>
</span><span class=lnt id=hl-7-285><a class=lnlinks href=#hl-7-285>285</a>
</span><span class=lnt id=hl-7-286><a class=lnlinks href=#hl-7-286>286</a>
</span><span class=lnt id=hl-7-287><a class=lnlinks href=#hl-7-287>287</a>
</span><span class=lnt id=hl-7-288><a class=lnlinks href=#hl-7-288>288</a>
</span><span class=lnt id=hl-7-289><a class=lnlinks href=#hl-7-289>289</a>
</span><span class=lnt id=hl-7-290><a class=lnlinks href=#hl-7-290>290</a>
</span><span class=lnt id=hl-7-291><a class=lnlinks href=#hl-7-291>291</a>
</span><span class=lnt id=hl-7-292><a class=lnlinks href=#hl-7-292>292</a>
</span><span class=lnt id=hl-7-293><a class=lnlinks href=#hl-7-293>293</a>
</span><span class=lnt id=hl-7-294><a class=lnlinks href=#hl-7-294>294</a>
</span><span class=lnt id=hl-7-295><a class=lnlinks href=#hl-7-295>295</a>
</span><span class=lnt id=hl-7-296><a class=lnlinks href=#hl-7-296>296</a>
</span><span class=lnt id=hl-7-297><a class=lnlinks href=#hl-7-297>297</a>
</span><span class=lnt id=hl-7-298><a class=lnlinks href=#hl-7-298>298</a>
</span><span class=lnt id=hl-7-299><a class=lnlinks href=#hl-7-299>299</a>
</span><span class=lnt id=hl-7-300><a class=lnlinks href=#hl-7-300>300</a>
</span><span class=lnt id=hl-7-301><a class=lnlinks href=#hl-7-301>301</a>
</span><span class=lnt id=hl-7-302><a class=lnlinks href=#hl-7-302>302</a>
</span><span class=lnt id=hl-7-303><a class=lnlinks href=#hl-7-303>303</a>
</span><span class=lnt id=hl-7-304><a class=lnlinks href=#hl-7-304>304</a>
</span><span class=lnt id=hl-7-305><a class=lnlinks href=#hl-7-305>305</a>
</span><span class=lnt id=hl-7-306><a class=lnlinks href=#hl-7-306>306</a>
</span><span class=lnt id=hl-7-307><a class=lnlinks href=#hl-7-307>307</a>
</span><span class=lnt id=hl-7-308><a class=lnlinks href=#hl-7-308>308</a>
</span><span class=lnt id=hl-7-309><a class=lnlinks href=#hl-7-309>309</a>
</span><span class=lnt id=hl-7-310><a class=lnlinks href=#hl-7-310>310</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Lambda Architecture 기반 추천 시스템 구현</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span><span class=p>,</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.ml.recommendation</span> <span class=kn>import</span> <span class=n>ALS</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.ml.evaluation</span> <span class=kn>import</span> <span class=n>RegressionEvaluator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Tuple</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LambdaRecommendationSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Lambda Architecture 기반 추천 시스템&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Spark 세션 초기화 (배치 레이어용)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;Lambda_Recommendation_Batch&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.adaptive.enabled&#34;</span><span class=p>,</span> <span class=s2>&#34;true&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis 클라이언트 (실시간 데이터 저장용)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Kafka 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_servers</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>kafka_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>kafka_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BatchLayer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;배치 레이어 - 정확한 협업 필터링 모델 학습&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lambda_system</span><span class=p>:</span> <span class=n>LambdaRecommendationSystem</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lambda_system</span> <span class=o>=</span> <span class=n>lambda_system</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>spark</span> <span class=o>=</span> <span class=n>lambda_system</span><span class=o>.</span><span class=n>spark</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>train_collaborative_filtering_model</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        협업 필터링 모델 학습
</span></span></span><span class=line><span class=cl><span class=s2>        매일 밤 전체 사용자-상품 상호작용 데이터로 ALS 모델 학습
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;배치 레이어: 협업 필터링 모델 학습 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 과거 상호작용 데이터 로드</span>
</span></span><span class=line><span class=cl>        <span class=n>interactions_df</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>read</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;header&#34;</span><span class=p>,</span> <span class=s2>&#34;true&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;inferSchema&#34;</span><span class=p>,</span> <span class=s2>&#34;true&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>csv</span><span class=p>(</span><span class=n>data_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ALS (Alternating Least Squares) 모델 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>als</span> <span class=o>=</span> <span class=n>ALS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>maxIter</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>regParam</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>userCol</span><span class=o>=</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>itemCol</span><span class=o>=</span><span class=s2>&#34;product_id&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>ratingCol</span><span class=o>=</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>coldStartStrategy</span><span class=o>=</span><span class=s2>&#34;drop&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>implicitPrefs</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모델 학습</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span> <span class=o>=</span> <span class=n>als</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>interactions_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모델 평가</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>interactions_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>evaluator</span> <span class=o>=</span> <span class=n>RegressionEvaluator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>metricName</span><span class=o>=</span><span class=s2>&#34;rmse&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>labelCol</span><span class=o>=</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>predictionCol</span><span class=o>=</span><span class=s2>&#34;prediction&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rmse</span> <span class=o>=</span> <span class=n>evaluator</span><span class=o>.</span><span class=n>evaluate</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;배치 모델 RMSE: </span><span class=si>{</span><span class=n>rmse</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 사용자에 대한 추천 생성 (Top-10)</span>
</span></span><span class=line><span class=cl>        <span class=n>user_recommendations</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>recommendForAllUsers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 결과를 서빙 레이어에 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_save_batch_recommendations</span><span class=p>(</span><span class=n>user_recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;배치 레이어: 모델 학습 및 추천 생성 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_save_batch_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendations_df</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 추천 결과를 Cassandra에 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 환경에서는 Cassandra 커넥터 사용</span>
</span></span><span class=line><span class=cl>        <span class=c1># 여기서는 Redis를 대용으로 사용</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations_list</span> <span class=o>=</span> <span class=n>recommendations_df</span><span class=o>.</span><span class=n>collect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>recommendations_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>user_id</span>
</span></span><span class=line><span class=cl>            <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=n>rec</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>rec</span><span class=o>.</span><span class=n>rating</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>row</span><span class=o>.</span><span class=n>recommendations</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Redis에 배치 추천 저장 (7일 TTL)</span>
</span></span><span class=line><span class=cl>            <span class=n>batch_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;batch_recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>lambda_system</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>batch_key</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>7</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SpeedLayer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;스피드 레이어 - 실시간 사용자 행동 분석&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lambda_system</span><span class=p>:</span> <span class=n>LambdaRecommendationSystem</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lambda_system</span> <span class=o>=</span> <span class=n>lambda_system</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>lambda_system</span><span class=o>.</span><span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>lambda_system</span><span class=o>.</span><span class=n>consumer</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_real_time_events</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실시간 사용자 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;스피드 레이어: 실시간 이벤트 처리 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_process_single_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_process_single_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;개별 사용자 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>product_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;product_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 현재 세션 키</span>
</span></span><span class=line><span class=cl>        <span class=n>session_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;session:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>timestamp</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>%H&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;view&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 상품 조회 이벤트</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_update_product_affinity</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>hincrby</span><span class=p>(</span><span class=n>session_key</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;view:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;add_to_cart&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 장바구니 추가 이벤트 (더 높은 가중치)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_update_product_affinity</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=mf>3.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>hincrby</span><span class=p>(</span><span class=n>session_key</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;cart:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;purchase&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 구매 이벤트 (가장 높은 가중치)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_update_product_affinity</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>hincrby</span><span class=p>(</span><span class=n>session_key</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;purchase:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 세션 만료 시간 설정 (1시간)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=n>session_key</span><span class=p>,</span> <span class=mi>3600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 추천 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_update_real_time_recommendations</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_product_affinity</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>weight</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자-상품 친화도 실시간 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>affinity_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;affinity:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_score</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>affinity_key</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>new_score</span> <span class=o>=</span> <span class=n>current_score</span> <span class=o>+</span> <span class=n>weight</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 24시간 TTL로 실시간 친화도 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>affinity_key</span><span class=p>,</span> <span class=mi>86400</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>new_score</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_real_time_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실시간 추천 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 세션의 관심 상품 기반 유사 상품 추천</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제로는 더 정교한 알고리즘 사용</span>
</span></span><span class=line><span class=cl>        <span class=n>session_pattern</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;session:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>:*&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>session_keys</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>keys</span><span class=p>(</span><span class=n>session_pattern</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>recent_products</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>session_key</span> <span class=ow>in</span> <span class=n>session_keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>hgetall</span><span class=p>(</span><span class=n>session_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>field</span><span class=p>,</span> <span class=n>count</span> <span class=ow>in</span> <span class=n>session_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=n>field_str</span> <span class=o>=</span> <span class=n>field</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>field</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=k>else</span> <span class=n>field</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>field_str</span><span class=o>.</span><span class=n>startswith</span><span class=p>((</span><span class=s1>&#39;view:&#39;</span><span class=p>,</span> <span class=s1>&#39;cart:&#39;</span><span class=p>,</span> <span class=s1>&#39;purchase:&#39;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                    <span class=n>_</span><span class=p>,</span> <span class=n>product_id</span> <span class=o>=</span> <span class=n>field_str</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>recent_products</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 최근 관심 상품 기반 실시간 추천 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>realtime_recommendations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_similar_products</span><span class=p>(</span><span class=n>recent_products</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis에 실시간 추천 저장 (1시간 TTL)</span>
</span></span><span class=line><span class=cl>        <span class=n>realtime_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;realtime_recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>realtime_key</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=mi>3600</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>realtime_recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_generate_similar_products</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;유사 상품 추천 생성 (간단한 예시)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제로는 상품 임베딩, 협업 필터링 등 사용</span>
</span></span><span class=line><span class=cl>        <span class=c1># 여기서는 단순화된 로직</span>
</span></span><span class=line><span class=cl>        <span class=n>similar_products</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>product_id</span> <span class=ow>in</span> <span class=n>product_ids</span><span class=p>[</span><span class=o>-</span><span class=mi>5</span><span class=p>:]:</span>  <span class=c1># 최근 5개 상품만 고려</span>
</span></span><span class=line><span class=cl>            <span class=c1># 가상의 유사 상품 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>base_id</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span> <span class=k>if</span> <span class=n>product_id</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=k>else</span> <span class=nb>hash</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span> <span class=o>%</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>  <span class=c1># 각 상품당 3개 유사 상품</span>
</span></span><span class=line><span class=cl>                <span class=n>similar_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>base_id</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>similar_products</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=n>similar_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.8</span> <span class=o>-</span> <span class=p>(</span><span class=n>i</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;similar_to_</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 중복 제거 및 점수순 정렬</span>
</span></span><span class=line><span class=cl>        <span class=n>unique_products</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>product</span> <span class=ow>in</span> <span class=n>similar_products</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pid</span> <span class=o>=</span> <span class=n>product</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pid</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>unique_products</span> <span class=ow>or</span> <span class=n>product</span><span class=p>[</span><span class=s2>&#34;score&#34;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>unique_products</span><span class=p>[</span><span class=n>pid</span><span class=p>][</span><span class=s2>&#34;score&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>unique_products</span><span class=p>[</span><span class=n>pid</span><span class=p>]</span> <span class=o>=</span> <span class=n>product</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>unique_products</span><span class=o>.</span><span class=n>values</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;score&#34;</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ServingLayer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;서빙 레이어 - 배치와 실시간 추천 결합&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lambda_system</span><span class=p>:</span> <span class=n>LambdaRecommendationSystem</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lambda_system</span> <span class=o>=</span> <span class=n>lambda_system</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>lambda_system</span><span class=o>.</span><span class=n>redis_client</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_unified_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        통합 추천 생성
</span></span></span><span class=line><span class=cl><span class=s2>        배치 추천(장기 선호도)과 실시간 추천(즉시 관심사)을 결합
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 배치 추천 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>batch_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;batch_recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>batch_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>batch_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>batch_recommendations</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>batch_data</span><span class=p>)</span> <span class=k>if</span> <span class=n>batch_data</span> <span class=k>else</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 추천 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>realtime_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;realtime_recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>realtime_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>realtime_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>realtime_recommendations</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>realtime_data</span><span class=p>)</span> <span class=k>if</span> <span class=n>realtime_data</span> <span class=k>else</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 결합 및 가중치 적용</span>
</span></span><span class=line><span class=cl>        <span class=n>unified_recommendations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_combine_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>batch_recommendations</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>realtime_recommendations</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 상위 N개 추천 반환</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unified_recommendations</span><span class=p>[:</span><span class=n>limit</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_combine_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_recs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>realtime_recs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치와 실시간 추천 결합&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>combined</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배치 추천 (가중치 0.6)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>batch_recs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>product_id</span> <span class=o>=</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>combined</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;score&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=mf>0.6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;sources&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;batch&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실시간 추천 (가중치 0.4)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>rec</span> <span class=ow>in</span> <span class=n>realtime_recs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>product_id</span> <span class=o>=</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>product_id</span> <span class=ow>in</span> <span class=n>combined</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 이미 배치 추천에 있는 경우 점수 합산</span>
</span></span><span class=line><span class=cl>                <span class=n>combined</span><span class=p>[</span><span class=n>product_id</span><span class=p>][</span><span class=s2>&#34;score&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;score&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=mf>0.4</span>
</span></span><span class=line><span class=cl>                <span class=n>combined</span><span class=p>[</span><span class=n>product_id</span><span class=p>][</span><span class=s2>&#34;sources&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;realtime&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 새로운 실시간 추천</span>
</span></span><span class=line><span class=cl>                <span class=n>combined</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=n>rec</span><span class=p>[</span><span class=s2>&#34;score&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=mf>0.4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;sources&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;realtime&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 점수순 정렬</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>combined</span><span class=o>.</span><span class=n>values</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;score&#34;</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Lambda Architecture 기반 추천 시스템 실행 예시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 시스템 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>lambda_system</span> <span class=o>=</span> <span class=n>LambdaRecommendationSystem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_layer</span> <span class=o>=</span> <span class=n>BatchLayer</span><span class=p>(</span><span class=n>lambda_system</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>speed_layer</span> <span class=o>=</span> <span class=n>SpeedLayer</span><span class=p>(</span><span class=n>lambda_system</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>serving_layer</span> <span class=o>=</span> <span class=n>ServingLayer</span><span class=p>(</span><span class=n>lambda_system</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 배치 처리 (일일 실행)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 배치 레이어 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_layer</span><span class=o>.</span><span class=n>train_collaborative_filtering_model</span><span class=p>(</span><span class=s2>&#34;hdfs://cluster/user_interactions/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 실시간 처리 (연속 실행)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 스피드 레이어 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제로는 별도 프로세스에서 실행</span>
</span></span><span class=line><span class=cl>    <span class=c1># speed_layer.process_real_time_events()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 통합 추천 조회 예시</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 서빙 레이어 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span> <span class=o>=</span> <span class=s2>&#34;user_12345&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendations</span> <span class=o>=</span> <span class=n>serving_layer</span><span class=o>.</span><span class=n>get_unified_recommendations</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용자 </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>를 위한 통합 추천:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>rec</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>recommendations</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>. 상품 </span><span class=si>{</span><span class=n>rec</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (점수: </span><span class=si>{</span><span class=n>rec</span><span class=p>[</span><span class=s1>&#39;score&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>, 소스: </span><span class=si>{</span><span class=n>rec</span><span class=p>[</span><span class=s1>&#39;sources&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=python-기반-kafka--spark-구조>Python 기반, Kafka + Spark 구조<a hidden class=anchor aria-hidden=true href=#python-기반-kafka--spark-구조>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kafka에서 실시간 스트리밍 데이터를 수신하고 Spark로 처리하는 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.functions</span> <span class=kn>import</span> <span class=n>from_json</span><span class=p>,</span> <span class=n>col</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.types</span> <span class=kn>import</span> <span class=n>StructType</span><span class=p>,</span> <span class=n>StringType</span><span class=p>,</span> <span class=n>TimestampType</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SparkSession 생성</span>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;Lambda Architecture - Speed Layer&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka에서 수신할 데이터 스키마 정의</span>
</span></span><span class=line><span class=cl><span class=n>schema</span> <span class=o>=</span> <span class=n>StructType</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&#34;event_type&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span> <span class=n>TimestampType</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka 스트리밍 데이터 수신</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>readStream</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;kafka&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;kafka.bootstrap.servers&#34;</span><span class=p>,</span> <span class=s2>&#34;localhost:9092&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;subscribe&#34;</span><span class=p>,</span> <span class=s2>&#34;click_events&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>load</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka의 value는 바이너리 -&gt; 문자열로 변환</span>
</span></span><span class=line><span class=cl><span class=n>json_df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>selectExpr</span><span class=p>(</span><span class=s2>&#34;CAST(value AS STRING) as json&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=n>from_json</span><span class=p>(</span><span class=s2>&#34;json&#34;</span><span class=p>,</span> <span class=n>schema</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>))</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;data.*&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 클릭 이벤트 카운팅</span>
</span></span><span class=line><span class=cl><span class=n>click_counts</span> <span class=o>=</span> <span class=n>json_df</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;event_type&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;click&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>groupBy</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 결과를 콘솔로 출력 (Serving Layer로 저장하는 구조도 가능)</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=n>click_counts</span><span class=o>.</span><span class=n>writeStream</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>outputMode</span><span class=p>(</span><span class=s2>&#34;complete&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;console&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>query</span><span class=o>.</span><span class=n>awaitTermination</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>이 예시는 Speed Layer 의 실시간 분석 부분에 해당하며, Serving Layer 로는 Elasticsearch 또는 Redis 와 연동하여 실시간 UI 업데이트가 가능하다.</p></blockquote><h4 id=python-spark-streaming--hadoop-기반>Python, Spark Streaming + Hadoop 기반<a hidden class=anchor aria-hidden=true href=#python-spark-streaming--hadoop-기반>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kafka에서 로그 데이터를 수신하여 Spark Streaming으로 실시간 처리, Hadoop으로 배치 처리하는 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark</span> <span class=kn>import</span> <span class=n>SparkContext</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.streaming</span> <span class=kn>import</span> <span class=n>StreamingContext</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.streaming.kafka</span> <span class=kn>import</span> <span class=n>KafkaUtils</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Spark Streaming 환경 설정</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=n>SparkContext</span><span class=p>(</span><span class=n>appName</span><span class=o>=</span><span class=s2>&#34;LambdaArchitectureLogAnalysis&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ssc</span> <span class=o>=</span> <span class=n>StreamingContext</span><span class=p>(</span><span class=n>sc</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka에서 로그 데이터 스트림 수신</span>
</span></span><span class=line><span class=cl><span class=n>kafkaStream</span> <span class=o>=</span> <span class=n>KafkaUtils</span><span class=o>.</span><span class=n>createStream</span><span class=p>(</span><span class=n>ssc</span><span class=p>,</span> <span class=s2>&#34;localhost:2181&#34;</span><span class=p>,</span> <span class=s2>&#34;log-group&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;logs&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 처리: 에러 로그 탐지</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>detect_error</span><span class=p>(</span><span class=n>log</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;ERROR&#34;</span> <span class=ow>in</span> <span class=n>log</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>error_logs</span> <span class=o>=</span> <span class=n>kafkaStream</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>detect_error</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>error_logs</span><span class=o>.</span><span class=n>pprint</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 배치 처리(예시): Hadoop MapReduce로 전체 로그 집계 (별도 배치 스크립트)</span>
</span></span><span class=line><span class=cl><span class=c1># 실제 배치 처리는 Hadoop 환경에서 별도 실행</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ssc</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ssc</span><span class=o>.</span><span class=n>awaitTermination</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>설명:</strong><br>Kafka 에서 로그 데이터를 받아 Spark Streaming 으로 실시간 에러 로그를 탐지한다. 전체 로그 집계는 Hadoop 에서 별도로 수행한다.</li></ul><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>고려사항</strong></th><th><strong>설명</strong></th><th><strong>권장사항</strong></th></tr></thead><tbody><tr><td><strong>1. 아키텍처 설계</strong></td><td>데이터 파티셔닝 전략</td><td>병렬 처리 및 확장성을 위한 파티셔닝 키 전략 수립</td><td>시간/사용자/지역 기반 등 도메인 맞춤 파티셔닝 적용</td></tr><tr><td></td><td>스키마 설계</td><td>처리 계층 간 스키마 호환성 확보 및 진화 대응</td><td>Avro, Protobuf, Schema Registry 사용</td></tr><tr><td></td><td>계층별 기술 스택 분리</td><td>Batch / Speed / Serving 계층별 최적화 기술 선택</td><td>Spark, Kafka, Cassandra, Redis 등 분리 조합</td></tr><tr><td><strong>2. 운영 및 모니터링</strong></td><td>통합 모니터링 체계 구축</td><td>계층별 지표 수집, 장애 탐지, 알람 대응 시스템 구축</td><td>Prometheus, Grafana, AlertManager 도입</td></tr><tr><td></td><td>코드/로직 중복 최소화</td><td>배치와 스트리밍에 동일 로직 반복 방지</td><td>공통 로직 추출 및 모듈화, 재사용 구조 설계</td></tr><tr><td></td><td>Serving Layer 검증</td><td>실시간 결과와 배치 결과 간의 일관성 확보</td><td>정기 검증 Job, 결과 비교 로직 운영</td></tr><tr><td><strong>3. 성능 최적화</strong></td><td>리소스 사용량 관리</td><td>CPU, 메모리, I/O 등의 낭비 방지를 위한 관리 정책 수립</td><td>우선순위 기반 스케줄링, 리소스 격리, 동적 스케일링</td></tr><tr><td></td><td>캐싱 전략</td><td>반복 접근되는 Hot Data 에 대한 응답 속도 개선</td><td>TTL 기반 다층 캐시, Redis, Memcached 활용</td></tr><tr><td></td><td>백프레셔 대응</td><td>처리 지연 발생 시 스트림 흐름 제어</td><td>Kafka Consumer Lag 모니터링, 처리율 제어</td></tr><tr><td><strong>4. 배포 및 운영 전략</strong></td><td>무중단 배포 및 롤백 전략</td><td>실시간 계층 변경 시 다운타임 방지와 오류 회복 전략</td><td>Blue-Green 배포, 카나리 롤아웃 적용</td></tr><tr><td></td><td>마이크로서비스화</td><td>계층 간 의존성 축소, 독립 배포 및 장애 격리 가능</td><td>Docker + Kubernetes 기반 MSA 구성</td></tr><tr><td></td><td>테스트 자동화</td><td>계층별 통합 테스트 및 재처리 시 검증 자동화</td><td>Testcontainers, E2E Pipeline Test 구성</td></tr><tr><td><strong>5. 데이터 품질 및 관리</strong></td><td>데이터 일관성 검증</td><td>배치/스트림 결과의 불일치 방지를 위한 자동화된 검증 메커니즘</td><td>결과 비교 자동화 스크립트, 해시/해당일 기준 검증</td></tr><tr><td></td><td>불변 데이터 보존</td><td>오류 복구와 재처리를 위한 원본 로그/이벤트의 불변성 확보</td><td>Kafka log 보존 기간 설정, S3 Raw 저장소 구축</td></tr><tr><td></td><td>스키마 검증 및 이상치 탐지</td><td>입력 데이터의 품질 확보 및 스키마 일탈 방지</td><td>Schema Validator, 데이터 프로파일링 도구 활용</td></tr><tr><td></td><td>백업 및 복구</td><td>시스템 장애 시 데이터 손실 최소화를 위한 정책</td><td>주기적 백업, 오브젝트 스토리지 이중화, DR 시나리오 구축</td></tr><tr><td><strong>6. 보안 및 거버넌스</strong></td><td>멀티테넌시 자원 격리</td><td>다양한 팀/도메인 사용 시 리소스 충돌 최소화</td><td>네임스페이스, RBAC, 쿼터 기반 격리 정책 적용</td></tr><tr><td></td><td>민감 데이터 보호</td><td>데이터 전송 및 저장 중 보안 확보</td><td>TLS, 데이터 마스킹, 필드 암호화 적용</td></tr><tr><td></td><td>접근 제어 및 감사 로그 관리</td><td>운영 인프라에 대한 무단 접근 방지 및 변경 추적</td><td>IAM 정책, API 접근 로그 저장, 감사 트레일 구축</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>최적화 요소</strong></th><th><strong>설명</strong></th><th><strong>권장 사항</strong></th></tr></thead><tbody><tr><td><strong>1. 처리 성능</strong></td><td>배치 크기 조정</td><td>마이크로 배치 단위 조절을 통해 처리량과 지연 시간 간 균형 확보</td><td>Spark 의 <code>trigger.batch</code> 조정, adaptive batch 사용 등</td></tr><tr><td></td><td>병렬도 최적화</td><td>파티션 수와 실행 병렬도 조절로 처리 속도 향상</td><td>CPU, 메모리, 네트워크 대역폭 기반 병렬도 설정, Kafka 파티션 조정</td></tr><tr><td></td><td>데이터 병합 전략</td><td>Serving Layer 에서 배치·스트림 중복 제거 및 정합성 보장</td><td>시간 우선 병합 (Timestamp Priority Merge), ID 기반 Deduplication 적용</td></tr><tr><td></td><td>Speed Layer 튜닝</td><td>스트림 지연 최소화를 위한 Kafka 및 처리엔진 설정 최적화</td><td>Kafka 의 Topic 파티션 분산, 소비자 그룹 병렬 구성, low-latency 모드 활성화</td></tr><tr><td><strong>2. 자원 관리</strong></td><td>배치 작업 최적화</td><td>리소스 과다 사용 방지를 위한 증분 처리 및 필터링 적용</td><td>Delta 방식 증분 배치, 데이터 전처리 필터, predicate pushdown</td></tr><tr><td></td><td>상태 저장소 최적화</td><td>스트림 처리 시 상태 저장 성능 향상 및 메모리 사용 최소화</td><td>RocksDB 튜닝, 상태 압축 사용, 증분 체크포인팅</td></tr><tr><td></td><td>JVM 메모리 튜닝</td><td>GC 튜닝을 통한 처리 안정성 및 지연 최소화</td><td>G1GC 사용, 힙 메모리 설정, GC 로그 기반 모니터링</td></tr><tr><td><strong>3. 네트워크 효율</strong></td><td>데이터 압축</td><td>전송량 감소 및 I/O 병목 완화를 위한 압축 기법 적용</td><td>Snappy, LZ4, ZSTD 등 알고리즘 선택, Producer 압축 설정</td></tr><tr><td></td><td>배치 전송 전략</td><td>네트워크 오버헤드 최소화를 위한 메시지 묶음 처리</td><td>Async I/O, Batching, Connection Pool 활용</td></tr><tr><td><strong>4. 저장소 최적화</strong></td><td>데이터 레이아웃 구성</td><td>질의 최적화를 위한 파티셔닝, 컬럼형 저장 구조 설계</td><td>Parquet 포맷, 날짜/키 기반 파티셔닝, Z-Ordering</td></tr><tr><td></td><td>압축 및 인코딩</td><td>저장 공간 절약과 처리 성능 향상</td><td>Dictionary Encoding, RLE, Delta Encoding</td></tr><tr><td><strong>5. 장애 복원성</strong></td><td>장애 대응 전략</td><td>각 계층 장애 시 자동 복구 및 리트라이 체계 확보</td><td>Airflow 재시도 설정, Kafka consumer 리트라이, Serving Layer fallback 처리</td></tr><tr><td></td><td>상태 복구 및 재처리</td><td>중단 시 지연 최소화를 위한 상태 기반 재처리 구조 설계</td><td>Checkpoint 주기 설정, offset 저장, 증분 로그 기반 복구</td></tr><tr><td><strong>6. 비용 최적화</strong></td><td>오토스케일링</td><td>사용량에 따라 동적 리소스 할당 및 클러스터 크기 조절</td><td>Kubernetes HPA, AWS Auto Scaling Group, Spark Dynamic Allocation</td></tr><tr><td></td><td>서버리스 활용</td><td>관리형 인프라를 통한 비용 절감 및 운영 단순화</td><td>AWS Glue, Kinesis Data Analytics, Azure Stream Analytics</td></tr><tr><td><strong>7. 운영 신뢰성</strong></td><td>테스트 자동화</td><td>파이프라인 변경 시 회귀 방지 및 신뢰성 확보</td><td>데이터 컨트랙트 테스트 (dbt), 통합 테스트 (Testcontainers), Smoke Test 구성</td></tr><tr><td></td><td>모니터링 및 알림</td><td>성능 저하 및 장애 조기 감지를 위한 상태 감시 체계 구축</td><td>Prometheus + Grafana, Kafka Metrics, 로그 기반 Alert 설정</td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>주제</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 아키텍처 특성</strong></td><td>Lambda Architecture</td><td>이중 처리 구조 (Batch + Speed)</td><td>정확성과 실시간성 동시 확보, 일관성 보장</td></tr><tr><td></td><td>Serving Layer</td><td>빠른 조회 계층</td><td>처리된 결과를 사용자 요청에 빠르게 서빙</td></tr><tr><td><strong>2. 핵심 기술 스택</strong></td><td>메시징/전송</td><td>Apache Kafka</td><td>배치/스트림 데이터의 분기와 전달을 담당</td></tr><tr><td></td><td>스트림 처리</td><td>Apache Storm, Flink, Spark SS</td><td>실시간 이벤트 흐름 처리에 특화된 엔진</td></tr><tr><td></td><td>배치 처리</td><td>Hadoop, Apache Spark</td><td>대규모 데이터셋의 일괄 처리 담당</td></tr><tr><td></td><td>서빙 스토리지</td><td>Elasticsearch, Cassandra</td><td>결과 데이터를 위한 빠른 질의 지원</td></tr><tr><td></td><td>워크플로 엔진</td><td>Apache Airflow, Prefect</td><td>배치 작업 스케줄링 및 관리</td></tr><tr><td><strong>3. 대안 아키텍처</strong></td><td>Kappa Architecture</td><td>스트림 중심 단일 처리 모델</td><td>배치 제거, 실시간 처리 일원화로 복잡도 감소</td></tr><tr><td></td><td>Delta Architecture</td><td>통합 스토리지 계층</td><td>Delta Lake 기반 배치/스트림 통합 처리</td></tr><tr><td><strong>4. 진화된 프로그래밍 모델</strong></td><td>Apache Beam</td><td>Unified API</td><td>배치 + 스트림 처리를 단일 API 로 구성 가능</td></tr><tr><td></td><td>Structured Streaming</td><td>SQL 기반 실시간 스트리밍 처리</td><td>Spark 의 구조적 스트리밍 기능</td></tr><tr><td><strong>5. 클라우드 서비스</strong></td><td>AWS Lambda + Kinesis</td><td>서버리스 Lambda 아키텍처 구현</td><td>배치 및 스트림 처리를 클라우드 기반으로 단순화</td></tr><tr><td></td><td>Azure Stream Analytics</td><td>관리형 실시간 분석 서비스</td><td>실시간 SQL 쿼리 기반 분석</td></tr><tr><td><strong>6. 운영 및 배포 환경</strong></td><td>Kubernetes</td><td>컨테이너 기반 오케스트레이션</td><td>각 계층의 독립 배포와 자원 격리 실현</td></tr><tr><td></td><td>Terraform/Ansible</td><td>IaC 기반 인프라 자동화</td><td>환경 구성의 일관성 및 확장성 확보</td></tr><tr><td></td><td>Prometheus + Grafana</td><td>통합 모니터링 및 알림</td><td>계층별 지표 수집과 실시간 상태 추적</td></tr><tr><td><strong>7. 활용 및 적용 사례</strong></td><td>로그/보안 분석</td><td>Lambda + Elastic Stack</td><td>실시간 탐지 + 정밀 분석 병행</td></tr><tr><td></td><td>IoT + 센서 데이터</td><td>Kafka + Spark/Flink</td><td>이벤트 중심 이상 탐지 및 트렌드 분석</td></tr><tr><td></td><td>실시간 광고/추천 시스템</td><td>Lambda + Redis</td><td>실시간 반응형 피드백 제공</td></tr></tbody></table><ul><li><strong>아키텍처 관점</strong>: 이중 처리 구조를 통한 정확성과 실시간성 트레이드오프 해결</li><li><strong>기술 구성</strong>: Kafka + Spark/Flink + Elasticsearch 조합이 전형적</li><li><strong>비교 아키텍처</strong>: Kappa(단순화), Delta(통합성), Beam(프로그래밍 통일성)</li><li><strong>클라우드 전략</strong>: Lambda + Kinesis 또는 Azure SA 로 서버리스 대체 가능</li><li><strong>운영 환경</strong>: Kubernetes 와 IaC, 통합 모니터링 툴로 안정적 운영 필수</li></ul><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>주제</strong></th><th><strong>항목/개념</strong></th><th><strong>설명 / 학습 필요성</strong></th></tr></thead><tbody><tr><td><strong>1. 분산 시스템 기초</strong></td><td>CAP 정리</td><td>Consistency, Availability, Partition Tolerance</td><td>분산 시스템에서의 핵심 트레이드오프 원칙 이해</td></tr><tr><td></td><td>분산 합의 알고리즘</td><td>Raft, PBFT</td><td>일관성 보장을 위한 리더 선출 및 상태 동기화 알고리즘 학습</td></tr><tr><td></td><td>Immutable Data</td><td>불변 데이터 구조</td><td>재처리 가능성과 데이터 정합성 확보에 필요한 기반 설계 원칙</td></tr><tr><td><strong>2. 데이터 처리 모델</strong></td><td>Lambda vs Kappa Architecture</td><td>아키텍처 비교</td><td>Batch+Stream 분리 vs 단일 스트림 모델, 설계 선택 시의 기준 이해</td></tr><tr><td></td><td>Batch ETL</td><td>Hadoop, Spark</td><td>대용량 데이터 집계 및 변환 처리에 필요한 프레임워크와 처리 모델 학습</td></tr><tr><td></td><td>Stream Processing</td><td>Kafka, Flink, Storm</td><td>실시간 데이터 처리 아키텍처와 스트림 처리 엔진 비교 분석</td></tr><tr><td></td><td>이벤트 시간 vs 처리 시간</td><td>Watermarking</td><td>지연 이벤트를 정확하게 처리하기 위한 타임 윈도우 개념 및 처리 시간 기준 차이 이해</td></tr><tr><td></td><td>정확히 한 번 처리</td><td>Exactly-once Semantics</td><td>메시지 중복 방지 및 데이터 손실 방지를 위한 스트림 신뢰성 처리 기법</td></tr><tr><td><strong>3. 데이터 모델링 및 아키텍처</strong></td><td>이벤트 소싱 (Event Sourcing)</td><td>Event Store</td><td>상태 대신 이벤트 저장을 통한 변경 이력 보존 및 재구성 구조 학습</td></tr><tr><td></td><td>CQRS 패턴</td><td>Command / Query 분리</td><td>읽기와 쓰기의 책임 분리로 인해 확장성과 유연성이 향상되는 설계 패턴 이해</td></tr><tr><td></td><td>Kappa Architecture</td><td>단일 스트림 기반 처리 아키텍처</td><td>Lambda 아키텍처의 대안 구조로, 유지보수성과 실시간성 중심 환경에 적합</td></tr><tr><td><strong>4. 성능 최적화 기법</strong></td><td>백프레셔 관리</td><td>Flow Control</td><td>스트림 과부하 방지를 위한 처리 속도 조절 및 시스템 안정성 확보 기법</td></tr><tr><td></td><td>로드 밸런싱</td><td>부하 분산 전략</td><td>Hotspot 제거 및 트래픽 분산을 통한 처리 효율 향상</td></tr><tr><td></td><td>Serving Layer 병합 전략</td><td>실시간/배치 뷰 통합 처리 방식</td><td>시간 우선 병합, 중복 제거 전략 등 최종 사용자 응답 일관성 확보</td></tr><tr><td><strong>5. 저장 및 서빙 기술</strong></td><td>서빙 데이터베이스</td><td>HBase, Cassandra</td><td>대용량 데이터의 빠른 조회와 쓰기를 지원하는 NoSQL 기반 서빙 레이어 이해</td></tr><tr><td></td><td>데이터 저장 최적화</td><td>컬럼형 저장, 파티셔닝</td><td>분석 효율성과 비용 절감을 위한 저장 구조 설계 전략</td></tr><tr><td><strong>6. 운영 및 모니터링</strong></td><td>시스템 모니터링 및 알림</td><td>Prometheus, Grafana</td><td>지표 수집, 대시보드 시각화, 알림 설정을 통한 시스템 상태의 실시간 관리</td></tr><tr><td></td><td>로그 및 상태 추적</td><td>ELK Stack, Checkpointing</td><td>장애 분석, 상태 복구, 운영 이력 파악을 위한 필수 도구 및 기법</td></tr><tr><td></td><td>테스트 자동화</td><td>dbt test, Testcontainers</td><td>전체 파이프라인에 대한 신뢰성 확보와 변경 안정성 확보를 위한 자동화 테스트 전략</td></tr></tbody></table><ul><li><strong>이론/설계/구현/운영</strong>의 4 단계 흐름을 반영하여 실무 적용까지 고려한 분류</li><li>각 항목은 <strong>실제 Lambda 구현 시 꼭 필요한 기초 및 고급 요소</strong>를 포함</li><li>중복 항목 제거, 의미 중복은 통합 (예: 이벤트 소싱 + CQRS → 모델링 카테고리로 통합)</li></ul><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>데이터 처리 방식</strong></td><td><strong>배치 처리 (Batch Processing)</strong></td><td>일정량의 데이터를 모아 정해진 시점에 일괄 처리하는 방식</td></tr><tr><td></td><td><strong>스트림 처리 (Stream Processing)</strong></td><td>데이터가 생성되는 즉시 처리하는 방식으로, 실시간 반응 가능</td></tr><tr><td><strong>아키텍처 구성 요소</strong></td><td><strong>Batch Layer</strong></td><td>전체 데이터셋 기반으로 정확한 결과를 생성하는 계층 (정확성 중시)</td></tr><tr><td></td><td><strong>Speed Layer</strong></td><td>최신 데이터를 빠르게 처리하는 실시간 계층 (신속성 중시)</td></tr><tr><td></td><td><strong>Serving Layer</strong></td><td>배치와 스트림 처리 결과를 병합하여 사용자 요청에 응답하는 계층</td></tr><tr><td><strong>데이터 저장 방식</strong></td><td><strong>분산 저장소 (Distributed Storage)</strong></td><td>데이터를 여러 서버에 분산 저장하여 확장성과 가용성 확보</td></tr><tr><td><strong>핵심 개념</strong></td><td><strong>불변성 (Immutability)</strong></td><td>데이터는 수정되지 않으며, 추가만 가능하도록 보존됨</td></tr><tr><td></td><td><strong>재계산 (Recomputation)</strong></td><td>장애 발생 시 전체 데이터를 기반으로 결과를 다시 생성하는 방식</td></tr><tr><td></td><td><strong>뷰 (View)</strong></td><td>처리된 데이터 결과를 미리 계산한 집계 또는 변환된 형태</td></tr><tr><td><strong>기술 메커니즘</strong></td><td><strong>백프레셔 (Backpressure)</strong></td><td>처리 속도보다 빠른 입력으로 인해 발생하는 시스템 부하 현상</td></tr><tr><td></td><td><strong>워터마킹 (Watermarking)</strong></td><td>지연 데이터를 정확히 처리하기 위한 기준 시간값 설정 방식</td></tr><tr><td></td><td><strong>체크포인팅 (Checkpointing)</strong></td><td>스트림 처리 중 상태를 저장하여 장애 복구 시 복원 가능하도록 지원</td></tr><tr><td><strong>메시징 시스템</strong></td><td><strong>Apache Kafka</strong></td><td>스트리밍 데이터의 발행과 소비를 담당하는 고성능 메시지 브로커</td></tr><tr><td><strong>아키텍처 유형</strong></td><td><strong>Lambda Architecture</strong></td><td>배치와 스트림 처리를 결합한 하이브리드 아키텍처</td></tr><tr><td></td><td><strong>Kappa Architecture</strong></td><td>스트림 기반 단일 파이프라인 아키텍처로, Lambda 의 단순화 모델</td></tr><tr><td></td><td><strong>Delta Architecture</strong></td><td>배치와 스트림을 동일한 테이블/스토리지에서 처리하는 통합 모델</td></tr><tr><td><strong>성능 지표</strong></td><td><strong>처리량 (Throughput)</strong></td><td>단위 시간당 처리 가능한 데이터의 양</td></tr><tr><td></td><td><strong>지연시간 (Latency)</strong></td><td>데이터가 입력되어 결과가 나올 때까지 걸리는 시간</td></tr><tr><td></td><td><strong>가용성 (Availability)</strong></td><td>시스템이 오류 없이 사용 가능한 시간 비율</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.databricks.com/glossary/lambda-architecture>Lambda Architecture 기본 개념 – Databricks</a></li><li><a href=https://aws.amazon.com/blogs/big-data/build-a-big-data-lambda-architecture-for-batch-and-real-time-analytics-using-amazon-redshift/>Build a big data Lambda architecture for batch and real‑time analytics – AWS Blog</a></li><li><a href=https://en.wikipedia.org/wiki/Lambda_architecture>Lambda Architecture – Wikipedia</a></li><li><a href=https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html>Apache Spark Structured Streaming Programming Guide</a></li><li><a href=https://hadoop.apache.org/docs/>Apache Hadoop 공식 문서</a></li><li><a href=https://martinfowler.com/bliki/LambdaArchitecture.html>Lambda Architecture 글 – Martin Fowler Bliki</a></li><li><a href=https://martinfowler.com/articles/serverless.html>Serverless 아키텍처 – Martin Fowler</a></li><li><a href=https://spark.apache.org/docs/latest/streaming-programming-guide.html>Spark Streaming Programming Guide</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>