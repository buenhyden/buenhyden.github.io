<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Message-Driven Architecture | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Styles,Messaging-Oriented,Message-Driven-Architecture,Message-Broker,Asynchronous-Communication"><meta name=description content="Message-Driven Architecture 는 시스템 구성 요소들이 비동기 메시지 교환을 통해 상호작용하는 소프트웨어 아키텍처 패턴이다. 느슨한 결합 (Loose Coupling), 확장성 (Scalability), 탄력성 (Resilience) 을 제공하며, 분산 시스템에서 높은 처리량과 장애 허용성을 실현한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-architecture/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-architecture/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-architecture/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-architecture/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Message-Driven Architecture"><meta property="og:description" content="Message-Driven Architecture 는 시스템 구성 요소들이 비동기 메시지 교환을 통해 상호작용하는 소프트웨어 아키텍처 패턴이다. 느슨한 결합 (Loose Coupling), 확장성 (Scalability), 탄력성 (Resilience) 을 제공하며, 분산 시스템에서 높은 처리량과 장애 허용성을 실현한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Message-Driven Architecture"><meta name=twitter:description content="Message-Driven Architecture 는 시스템 구성 요소들이 비동기 메시지 교환을 통해 상호작용하는 소프트웨어 아키텍처 패턴이다. 느슨한 결합 (Loose Coupling), 확장성 (Scalability), 탄력성 (Resilience) 을 제공하며, 분산 시스템에서 높은 처리량과 장애 허용성을 실현한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기록하고 기억하고 활용하자.","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":4,"name":"Architecture Styles and Patterns","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/"},{"@type":"ListItem","position":5,"name":"Architecture Styles","item":""},{"@type":"ListItem","position":6,"name":"Messaging-Oriented Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/"},{"@type":"ListItem","position":7,"name":"Message-Driven Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-architecture/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기록하고 기억하고 활용하자.</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/>Architecture Styles and Patterns</a>&nbsp;»&nbsp;<a href>Architecture Styles</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/>Messaging-Oriented Architecture</a></div><h1>Message-Driven Architecture</h1><div class=post-description>Message-Driven Architecture 는 시스템 구성 요소들이 비동기 메시지 교환을 통해 상호작용하는 소프트웨어 아키텍처 패턴이다. 느슨한 결합 (Loose Coupling), 확장성 (Scalability), 탄력성 (Resilience) 을 제공하며, 분산 시스템에서 높은 처리량과 장애 허용성을 실현한다.</div></header><div class=post-content><h2 id=message-driven-architecture>Message-Driven Architecture<a hidden class=anchor aria-hidden=true href=#message-driven-architecture>#</a></h2><p>Message‑Driven Architecture 는 메시지 브로커 또는 버스를 통해 송신자 (Producer) 와 수신자 (Consumer) 가 메시지를 비동기 방식으로 주고받는 설계 방식이다. 주요 구성 요소는 Producer, Broker, Consumer, Queue/Topic 이며 선택적으로 스키마 레지스트리, DLQ, 메시지 변환기 등을 포함한다. RabbitMQ, Kafka, ActiveMQ 등이 대표 브로커이며, 구조적으로 느슨한 결합, 확장성과 고가용성을 확보할 수 있는 동시에, 메시지 순서 보장, 멱등성, 트레이싱 같은 운영 및 안정성 요소도 고려해야 한다.</p><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><h4 id=역사적-배경>역사적 배경<a hidden class=anchor aria-hidden=true href=#역사적-배경>#</a></h4><ul><li><p><strong>1970 년대 - 액터 모델 (Actor Model)</strong>:<br>Carl Hewitt 이 제안한 액터 모델이 메시지 기반 아키텍처의 이론적 기반을 제공했다. 각 액터는 메시지를 통해서만 상호작용하며, 상태를 캡슐화하는 개념을 도입했다.</p></li><li><p><strong>1980 년대 - 분산 시스템의 발전</strong>:<br>네트워크 기술의 발전과 함께 분산 시스템에서 통신 메커니즘의 필요성이 대두되었다. 원격 프로시저 호출 (RPC) 의 한계를 극복하기 위한 대안으로 메시지 기반 통신이 주목받았다.</p></li><li><p><strong>1990 년대 - 미들웨어의 등장</strong>:<br>Message-Oriented Middleware (MOM) 가 등장하여 기업 환경에서 이종 시스템 간 통신을 지원했다. IBM MQSeries, TIBCO 등이 대표적이다.</p></li></ul><h4 id=기술적-배경>기술적 배경<a hidden class=anchor aria-hidden=true href=#기술적-배경>#</a></h4><p><strong>동기식 통신의 한계</strong>:</p><ul><li>블로킹 호출로 인한 성능 저하</li><li>타이트 커플링으로 인한 시스템 복잡성 증가</li><li>장애 전파 문제</li></ul><p><strong>분산 시스템의 복잡성</strong>:</p><ul><li>CAP 정리 (Consistency, Availability, Partition tolerance)</li><li>네트워크 지연 및 불안정성</li><li>확장성 요구사항 증가</li></ul><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><h4 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h4><ol><li><p><strong>시스템 분리 (Decoupling)</strong>:<br>구성 요소들을 독립적으로 개발, 배포, 확장할 수 있도록 분리한다. 이를 통해 개발 팀의 자율성을 높이고 시스템의 복잡성을 관리할 수 있다.</p></li><li><p><strong>확장성 (Scalability) 향상</strong>:<br>개별 구성 요소를 독립적으로 확장할 수 있어 시스템 전체의 처리 능력을 효율적으로 증대시킬 수 있다.</p></li><li><p><strong>탄력성 (Resilience) 확보</strong>:<br>장애가 발생한 구성 요소가 전체 시스템에 미치는 영향을 최소화하여 시스템의 안정성을 높인다.</p></li><li><p><strong>비동기 처리</strong>:<br>논블로킹 방식으로 시스템의 처리량과 응답성을 향상시킨다.</p></li></ol><h4 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h4><p><strong>비즈니스 민첩성 향상</strong></p><ul><li>빠른 기능 개발과 배포</li><li>변화하는 요구사항에 대한 신속한 대응</li></ul><p><strong>현대 비즈니스 환경</strong>:</p><ul><li>실시간 데이터 처리 요구</li><li>글로벌 서비스 확장 필요</li><li>고가용성 시스템 구축 요구</li></ul><p><strong>모놀리식 아키텍처의 한계 극복</strong></p><ul><li>단일 장애점 (Single Point of Failure) 문제 해결</li><li>기술 스택의 다양화 지원</li></ul><p><strong>기술적 필요성</strong>:</p><ul><li>마이크로서비스 아키텍처 지원</li><li>클라우드 네이티브 환경 적응</li><li>DevOps 및 CI/CD 파이프라인 지원</li></ul><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p><strong>메시지 패싱 (Message Passing)</strong>:</p><ul><li>시스템 구성 요소들이 직접 호출 대신 메시지를 통해 상호작용하는 통신 패러다임이다. 메시지는 데이터와 메타데이터를 포함하는 구조화된 정보 단위로, 송신자 (Sender) 와 수신자 (Receiver) 간의 매개체 역할을 한다.</li></ul><p><strong>메시지 (Message)</strong>:</p><ul><li>시스템 컴포넌트 간에 전달되는 데이터 단위</li><li>명령 (Command), 문서 (Document), 이벤트 (Event) 형태로 분류</li><li>메타데이터와 페이로드를 포함하는 구조화된 정보</li></ul><p><strong>메시지 브로커 (Message Broker)</strong>:</p><ul><li>메시지의 라우팅, 변환, 저장을 담당하는 중간 계층</li><li>발신자와 수신자 간의 결합도를 제거하는 역할</li><li>Apache Kafka, RabbitMQ, Apache ActiveMQ 등이 대표적</li></ul><p><strong>비동기 통신 (Asynchronous Communication)</strong>:</p><ul><li>발신자가 응답을 기다리지 않고 메시지를 전송하는 방식</li><li>시스템 성능과 응답성을 향상시키는 핵심 요소</li></ul><p><strong>메시지 큐 (Message Queue)</strong>:</p><ul><li>메시지를 임시 저장하는 FIFO(First In, First Out) 구조</li><li>부하 분산과 장애 복구를 지원하는 버퍼 역할</li></ul><p><strong>느슨한 결합 (Loose Coupling)</strong>:</p><ul><li>시스템 구성 요소들이 서로의 내부 구현에 대해 최소한의 지식만을 가지고 상호작용하는 설계 원칙.</li><li>메시지 인터페이스만을 통해 통신함으로써 시스템의 유연성과 유지보수성을 높인다.</li></ul><p><strong>탄력성 (Resilience)</strong>:</p><ul><li>시스템이 장애 상황에서도 정상적으로 작동을 유지하거나 빠르게 복구할 수 있는 능력</li><li>메시지 기반 시스템은 구성 요소 간의 격리를 통해 장애 전파를 최소화한다.</li></ul><h4 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h4><table><thead><tr><th>영역</th><th>설명</th></tr></thead><tbody><tr><td><strong>서비스 독립성 및 마이크로서비스 지원</strong></td><td>각 서비스가 메시지를 통해 통신하므로 독립적으로 배포/확장 가능. MSA 의 핵심 요소.</td></tr><tr><td><strong>실시간 데이터 처리</strong></td><td>Kafka 등 스트림 중심 브로커를 활용해 이벤트 중심의 실시간 처리 파이프라인 구현 가능.</td></tr><tr><td><strong>내결함성 및 장애 격리</strong></td><td>브로커의 메시지 저장 및 재시도 메커니즘으로 인해 장애가 전파되지 않음.</td></tr><tr><td><strong>계약 기반 통신 (Contract-first)</strong></td><td>메시지 스키마 (예: Avro, Protobuf) 를 통해 통신 계약을 사전에 정의하고, 시스템 간 호환성을 유지.</td></tr><tr><td><strong>운영 가시성 확보</strong></td><td>메시지 흐름 추적 (Trace), 지연 모니터링, 실패 메시지 추적 (DLQ) 을 통한 운용 효율성 확보.</td></tr><tr><td><strong>비동기 작업 처리</strong></td><td>사용자의 요청과 별도로 긴 작업을 처리하고 응답 시점을 분리할 수 있어 UX 개선과 시스템 부하 분산 가능.</td></tr></tbody></table><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><h4 id=핵심-기능>핵심 기능<a hidden class=anchor aria-hidden=true href=#핵심-기능>#</a></h4><table><thead><tr><th>기능 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>메시지 발행 (Produce)</strong></td><td>Producer 가 메시지를 브로커에 비동기적으로 발행</td></tr><tr><td><strong>메시지 라우팅 (Routing)</strong></td><td>메시지를 큐/토픽 기준 또는 컨텐츠/헤더 기반으로 라우팅</td></tr><tr><td><strong>메시지 변환 (Transformation)</strong></td><td>이기종 시스템 간 데이터 형식, 프로토콜, 인코딩 등을 변환</td></tr><tr><td><strong>메시지 필터링 (Filtering)</strong></td><td>조건에 따라 메시지를 선택적으로 처리 (예: Rule 기반 필터)</td></tr><tr><td><strong>메시지 저장 및 지속성 (Persistence)</strong></td><td>디스크 기반 저장, 장애 발생 시 메시지 유실 방지</td></tr><tr><td><strong>메시지 순서 보장 (Ordering)</strong></td><td>FIFO 또는 파티셔닝 방식으로 메시지 순서 보장</td></tr><tr><td><strong>중복 방지 (Idempotency)</strong></td><td>동일 메시지 재처리에 대한 안전성 확보 (ID 기반 멱등 처리)</td></tr><tr><td><strong>오류 처리 및 DLQ (Dead Letter Queue)</strong></td><td>처리 실패 메시지 별도 저장 및 재처리 로직 적용</td></tr><tr><td><strong>확장성 지원 (Scalability)</strong></td><td>Consumer Group 기반 병렬 처리 및 동적 확장 가능</td></tr><tr><td><strong>백프레셔 관리 (Backpressure)</strong></td><td>수신자 과부하 시 메시지 흐름 제어 및 버퍼링</td></tr></tbody></table><h4 id=시스템-역할>시스템 역할<a hidden class=anchor aria-hidden=true href=#시스템-역할>#</a></h4><table><thead><tr><th>역할 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>통신 추상화 (Communication Abstraction)</strong></td><td>네트워크/프로토콜 복잡성 은폐, 비즈니스 로직 집중 가능</td></tr><tr><td><strong>비동기 통신 중개자 (Async Mediator)</strong></td><td>Producer 와 Consumer 간 비동기적 연결</td></tr><tr><td><strong>컴포넌트 격리 (Component Isolation)</strong></td><td>서비스 간 느슨한 결합과 독립적 배포 가능</td></tr><tr><td><strong>장애 완충기 (Failure Buffer)</strong></td><td>일시적 장애 발생 시 메시지 유실 방지, 복구 가능</td></tr><tr><td><strong>인터페이스 표준화 (Interface Standardization)</strong></td><td>다양한 시스템 간의 통신을 추상화하여 일관된 인터페이스 제공</td></tr><tr><td><strong>프로토콜 브리지 역할</strong></td><td>REST, MQTT, gRPC 등 서로 다른 통신 방식 간 브릿지 역할 수행 가능</td></tr></tbody></table><h4 id=운영-특성-및-보장>운영 특성 및 보장<a hidden class=anchor aria-hidden=true href=#운영-특성-및-보장>#</a></h4><table><thead><tr><th>특성 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>전달 보장 수준 (Delivery Guarantees)</strong></td><td>At-least-once / At-most-once / Exactly-once</td></tr><tr><td><strong>부하 분산 (Load Balancing)</strong></td><td>여러 Consumer 간 메시지 분산 처리</td></tr><tr><td><strong>모니터링 및 트레이싱</strong></td><td>메시지 흐름 추적, 메트릭 수집, Jaeger/Grafana 연동</td></tr><tr><td><strong>보안 및 접근 제어</strong></td><td>메시지 ACL, 인증, TLS 기반 암호화</td></tr><tr><td><strong>QoS 제어</strong></td><td>메시지 우선순위, 처리 지연 허용 범위 설정</td></tr><tr><td><strong>운영 자동화 및 재시도 정책</strong></td><td>Retry Interval, Max Retry Count, DLQ Threshold 등 구성 가능</td></tr></tbody></table><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><h4 id=핵심-기술적-특징-technical-characteristics>핵심 기술적 특징 (Technical Characteristics)<a hidden class=anchor aria-hidden=true href=#핵심-기술적-특징-technical-characteristics>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>비동기 처리 (Asynchronous Processing)</strong></td><td>송신자와 수신자의 실행 흐름이 분리되어 비차단 (non-blocking) 구조를 제공함.</td></tr><tr><td><strong>시간적 분리 (Temporal Decoupling)</strong></td><td>메시지 전송 시 수신자가 반드시 가용하지 않아도 되며, 시스템 응답성과 유연성 향상에 기여함.</td></tr><tr><td><strong>공간적 분리 (Spatial Decoupling)</strong></td><td>송신자와 수신자는 서로의 구체적인 위치나 존재를 알 필요 없이 통신할 수 있음. (위치 투명성 포함)</td></tr><tr><td><strong>메시지 중심 통신 (Message-Oriented Communication)</strong></td><td>명령, 이벤트, 문서 등 구조화된 메시지를 기반으로 상호작용하며, 형식 표준화 및 계약 기반 통합이 가능함.</td></tr><tr><td><strong>표준 기반 통합 (Contract-based Integration)</strong></td><td>메시지 스키마와 계약 기반 통신을 통해 이질적인 시스템 간 통합이 용이함.</td></tr><tr><td><strong>메시지 순서 및 일관성 유지</strong></td><td>Kafka, RabbitMQ 등에서 파티션 또는 큐 기반으로 순서를 보장하며 메시지 정합성을 유지함.</td></tr></tbody></table><h4 id=운영적-특징-operational-characteristics><strong>운영적 특징 (Operational Characteristics)</strong><a hidden class=anchor aria-hidden=true href=#운영적-특징-operational-characteristics>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>확장성 (Scalability)</strong></td><td>Consumer 수평 확장이 용이하며, 컴포넌트 단위의 확장 지원으로 시스템 탄력성이 증가함.</td></tr><tr><td><strong>내결함성 (Fault Tolerance)</strong></td><td>메시지 브로커는 중간 저장소 역할을 하며 장애 시에도 데이터 유실 없이 복구 가능함.</td></tr><tr><td><strong>정상 상태 복원력 (Resilience)</strong></td><td>메시지 재처리, 재시도 메커니즘 등을 통해 시스템 회복력을 강화함.</td></tr><tr><td><strong>디커플링 (Loose Coupling)</strong></td><td>컴포넌트 간의 의존도를 최소화하여 유지보수성과 재사용성이 증가함.</td></tr><tr><td><strong>감시 및 테스트 용이성 (Observability & Testability)</strong></td><td>메시지 추적 (trace) 기반 모니터링이 가능하고, 구성 요소 단위로 독립 테스트가 가능함.</td></tr><tr><td><strong>장애 격리 (Fault Isolation)</strong></td><td>단일 컴포넌트의 장애가 전체 시스템에 영향을 주지 않도록 설계 가능함.</td></tr></tbody></table><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><h4 id=설계-원칙>설계 원칙<a hidden class=anchor aria-hidden=true href=#설계-원칙>#</a></h4><table><thead><tr><th>원칙</th><th>설명</th></tr></thead><tbody><tr><td><strong>Message-First Principle (메시지 우선 원칙)</strong></td><td>모든 상호작용은 메시지를 통해 이루어져야 하며, 직접 호출이나 공유 상태 접근을 지양해야 함.</td></tr><tr><td><strong>Loose Coupling (느슨한 결합)</strong></td><td>송신자와 수신자 간 직접적인 참조 제거, 메시지 인터페이스만으로 연결됨.</td></tr><tr><td><strong>Encapsulation (캡슐화)</strong></td><td>각 컴포넌트는 내부 상태를 감추고 메시지를 통해서만 상호작용. 외부에서 직접 상태 접근 불가.</td></tr><tr><td><strong>Location Transparency (위치 독립성)</strong></td><td>컴포넌트의 물리적 위치에 상관없이 통신 가능, 시스템 토폴로지 변경에 유연함.</td></tr><tr><td><strong>Single Responsibility (단일 책임)</strong></td><td>각 메시지 및 핸들러는 하나의 책임만 가지도록 설계해야 하며, 변경 이유가 명확히 분리됨.</td></tr><tr><td><strong>Eventual Consistency (최종 일관성)</strong></td><td>전체 시스템은 메시지를 통해 일관성 있게 수렴함. 강한 일관성보다는 결국 수렴에 초점을 둠.</td></tr></tbody></table><h4 id=운영-원칙>운영 원칙<a hidden class=anchor aria-hidden=true href=#운영-원칙>#</a></h4><table><thead><tr><th>원칙</th><th>설명</th></tr></thead><tbody><tr><td><strong>Resilience / Failure Isolation (탄력성 / 장애 격리)</strong></td><td>컴포넌트 간 장애가 전파되지 않도록 설계되어야 하며, 장애 복구 및 재시도 전략이 포함되어야 함.</td></tr><tr><td><strong>Idempotency (멱등성)</strong></td><td>동일 메시지를 여러 번 처리해도 동일한 결과를 보장해야 함 (재시도, 중복 방지 목적).</td></tr><tr><td><strong>Reliability First (신뢰성 우선)</strong></td><td>메시지의 손실/중복/순서를 관리하여 신뢰성 있는 전달 보장 필요 (예: Exactly-once 보장).</td></tr><tr><td><strong>Logged-by-default (기록 우선)</strong></td><td>모든 메시지는 로그에 기록되어야 하며, 감사 추적 및 재생 (replay) 을 위한 기반 마련 필요.</td></tr><tr><td><strong>Observability (관찰 가능성)</strong></td><td>메시지 흐름, 상태, 지연 등을 추적할 수 있어야 하며, 분산 추적 시스템과 통합됨.</td></tr><tr><td><strong>Performance-Aware (성능 최적화)</strong></td><td>시스템 구성은 처리량/지연/리소스 사용 최적화를 고려해야 하며, 병렬성과 비동기 처리 적극 활용.</td></tr></tbody></table><h4 id=프로그래밍-및-메시징-원칙>프로그래밍 및 메시징 원칙<a hidden class=anchor aria-hidden=true href=#프로그래밍-및-메시징-원칙>#</a></h4><table><thead><tr><th>원칙</th><th>설명</th></tr></thead><tbody><tr><td><strong>Asynchronous Messaging (비동기 메시징)</strong></td><td>송신자는 수신자의 가용성과 무관하게 메시지를 전송하며, 처리 흐름은 차단되지 않음.</td></tr><tr><td><strong>Broker Mediation (브로커 중재)</strong></td><td>메시지는 브로커를 통해 송수신되며, 컴포넌트 간 직접 의존성을 제거함.</td></tr><tr><td><strong>End-to-End Responsibility (엔드투엔드 책임)</strong></td><td>메시지를 생성한 서비스가 해당 메시지가 처리되었는지까지 추적할 수 있어야 함.</td></tr><tr><td><strong>Retry & Recovery (재시도 및 복구)</strong></td><td>메시지 실패에 대비한 재시도 로직, DLQ(Dead Letter Queue), Circuit Breaker 등의 복구 전략 필요.</td></tr></tbody></table><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><h4 id=비동기-메시지-처리-원리>비동기 메시지 처리 원리<a hidden class=anchor aria-hidden=true href=#비동기-메시지-처리-원리>#</a></h4><pre class=mermaid>sequenceDiagram
    participant S as Sender
    participant MB as Message Broker
    participant R as Receiver
    
    S-&gt;&gt;MB: Send Message
    Note over S: Continue Processing
    MB-&gt;&gt;R: Deliver Message
    R-&gt;&gt;R: Process Message
    R-&gt;&gt;MB: Acknowledgment
    MB-&gt;&gt;S: Delivery Confirmation (Optional)
</pre><p>송신자는 메시지를 메시지 브로커에 전송한 후 즉시 다른 작업을 계속할 수 있다. 메시지 브로커는 수신자에게 메시지를 전달하고, 수신자는 비동기적으로 메시지를 처리한다.</p><h4 id=발행---구독-원리-publish-subscribe>발행 - 구독 원리 (Publish-Subscribe)<a hidden class=anchor aria-hidden=true href=#발행---구독-원리-publish-subscribe>#</a></h4><pre class=mermaid>graph TD
    P[Publisher] --&gt; T[Topic/Exchange]
    T --&gt; S1[Subscriber 1]
    T --&gt; S2[Subscriber 2]
    T --&gt; S3[Subscriber 3]
    
    style T fill:#f9f,stroke:#333,stroke-width:2px
    style P fill:#bbf,stroke:#333,stroke-width:2px
    style S1 fill:#bfb,stroke:#333,stroke-width:2px
    style S2 fill:#bfb,stroke:#333,stroke-width:2px
    style S3 fill:#bfb,stroke:#333,stroke-width:2px
</pre><p>발행자는 특정 토픽에 메시지를 게시하고, 해당 토픽을 구독하는 모든 구독자가 메시지를 수신한다. 이는 일대다 통신을 효율적으로 지원한다.</p><h4 id=메시지-큐-원리>메시지 큐 원리<a hidden class=anchor aria-hidden=true href=#메시지-큐-원리>#</a></h4><pre class=mermaid>graph LR
    P1[Producer 1] --&gt; Q[Message Queue]
    P2[Producer 2] --&gt; Q
    Q --&gt; C1[Consumer 1]
    Q --&gt; C2[Consumer 2]
    
    style Q fill:#fbb,stroke:#333,stroke-width:2px
    style P1 fill:#bbf,stroke:#333,stroke-width:2px
    style P2 fill:#bbf,stroke:#333,stroke-width:2px
    style C1 fill:#bfb,stroke:#333,stroke-width:2px
    style C2 fill:#bfb,stroke:#333,stroke-width:2px
</pre><p>여러 생산자가 큐에 메시지를 넣고, 여러 소비자가 큐에서 메시지를 가져와 처리한다. 큐는 메시지의 순서와 전달을 보장한다.</p><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><pre class=mermaid>sequenceDiagram
  participant P as Producer
  participant B as Broker
  participant C as Consumer
  P-&gt;&gt;B: publish(&#34;OrderPlaced&#34;)
  B-&gt;&gt;B: enqueue to Queue
  B-&gt;&gt;C: deliver(&#34;OrderPlaced&#34;)
  alt ack == success
    C-&gt;&gt;B: consumer_ack
  else failure
    B-&gt;&gt;DLQ: send to DeadLetterQueue
  end
</pre><ol><li><p><strong>메시지 생성 및 전송</strong></p><ul><li>송신자가 비즈니스 이벤트 또는 명령을 메시지로 변환</li><li>메시지에 헤더, 페이로드, 메타데이터 포함</li><li>메시지 브로커 또는 큐에 전송</li></ul></li><li><p><strong>메시지 라우팅 및 저장</strong></p><ul><li>메시지 브로커가 라우팅 규칙에 따라 적절한 큐나 토픽으로 전달</li><li>메시지 지속성 정책에 따라 디스크에 저장</li><li>중복 제거 및 순서 보장 처리</li></ul></li><li><p><strong>메시지 소비 및 처리</strong></p><ul><li>수신자가 큐나 토픽에서 메시지 폴링 또는 푸시 수신</li><li>메시지 역직렬화 및 비즈니스 로직 처리</li><li>처리 완료 후 확인 응답 (Acknowledgment) 전송</li></ul></li><li><p><strong>오류 처리 및 재시도</strong></p><ul><li>처리 실패 시 재시도 정책 적용</li><li>데드 레터 큐 (Dead Letter Queue) 로 처리 불가 메시지 이동</li><li>오류 모니터링 및 알림</li></ul></li></ol><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p>Message-Driven Architecture 의 구조는 여러 핵심 구성 요소들이 유기적으로 연결된 형태로 구성된다.</p><pre class=mermaid>graph TB
    subgraph &#34;Application Layer&#34;
        A1[Service A] 
        A2[Service B]
        A3[Service C]
    end
    
    subgraph &#34;Message Infrastructure Layer&#34;
        MB[Message Broker]
        Q1[Queue 1]
        Q2[Queue 2]
        T1[Topic 1]
        T2[Topic 2]
        DLQ[Dead Letter Queue]
    end
    
    subgraph &#34;Storage Layer&#34;
        DB1[(Database 1)]
        DB2[(Database 2)]
        ES[(Event Store)]
    end
    
    A1 &lt;--&gt; MB
    A2 &lt;--&gt; MB
    A3 &lt;--&gt; MB
    MB --&gt; Q1
    MB --&gt; Q2
    MB --&gt; T1
    MB --&gt; T2
    MB --&gt; DLQ
    A1 &lt;--&gt; DB1
    A2 &lt;--&gt; DB2
    A3 &lt;--&gt; ES
    
    style MB fill:#f96,stroke:#333,stroke-width:3px
    style A1 fill:#bbf,stroke:#333,stroke-width:2px
    style A2 fill:#bbf,stroke:#333,stroke-width:2px
    style A3 fill:#bbf,stroke:#333,stroke-width:2px
</pre><h4 id=구성요소>구성요소<a hidden class=anchor aria-hidden=true href=#구성요소>#</a></h4><table><thead><tr><th>구분</th><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td><strong>메시지 생산자 (Producer)</strong></td><td>비즈니스 이벤트를 메시지로 변환하여 전송</td><td>시스템 내 상태 변화나 명령을 메시지로 전달</td><td>수신자에 대한 정보 없이 독립적으로 메시지 전송</td></tr><tr><td></td><td><strong>메시지 브로커 (Broker)</strong></td><td>메시지의 라우팅, 변환, 필터링, 저장</td><td>생산자와 소비자 간 중재자</td><td>높은 가용성 및 확장성을 갖춘 메시징 인프라</td></tr><tr><td></td><td><strong>메시지 소비자 (Consumer)</strong></td><td>메시지 수신 및 처리</td><td>메시지에 기반하여 적절한 액션 수행</td><td>메시지 처리 후 Ack 또는 결과 응답 반환</td></tr><tr><td></td><td><strong>메시지 큐/토픽 (Queue/Topic)</strong></td><td>메시지 임시 저장 및 순서 보장</td><td>생산자 - 소비자 간의 버퍼 역할</td><td>지속성, 순서 보장, 전달 보장 기능 제공</td></tr><tr><td><strong>선택</strong></td><td><strong>메시지 변환기 (Transformer)</strong></td><td>메시지 포맷 변환 및 필드 매핑</td><td>이기종 시스템 간 통신 포맷 통합</td><td>플러그인 기반 확장 가능, 포맷 표준화 지원</td></tr><tr><td></td><td><strong>메시지 필터 (Filter)</strong></td><td>조건부 메시지 필터링 및 라우팅</td><td>비즈니스 로직 기반 메시지 선별 전송</td><td>동적 라우팅, 룰 변경 지원</td></tr><tr><td></td><td><strong>메시지 집계기 (Aggregator)</strong></td><td>관련 메시지 집계 후 단일 처리</td><td>복합 이벤트 처리 및 프로세스 통합 지원</td><td>시간 기반, 이벤트 기반 집계 가능</td></tr><tr><td></td><td><strong>데드 레터 큐 (DLQ)</strong></td><td>실패 메시지 별도 격리 저장</td><td>오류 메시지 분석, 재처리 가능성 확보</td><td>재처리 정책 수립 및 패턴 분석 가능</td></tr><tr><td></td><td><strong>메시지 스토어 (Store)</strong></td><td>메시지 영속 저장 및 이벤트 로그화</td><td>이벤트 소싱, 감사 추적, 시스템 상태 재현</td><td>시간 순서 정렬, 스냅샷 저장, 복구 지원</td></tr></tbody></table><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><table><thead><tr><th>카테고리</th><th>구현 기법</th><th>정의 및 구성 요소</th><th>목적</th><th>실제 예시</th></tr></thead><tbody><tr><td><strong>기본 메시징 패턴</strong></td><td><strong>Queue-Based (PTP)</strong></td><td>- 메시지 큐, Consumer Pool, QoS(prefetch), DLQ<br>- AMQP 기반 RabbitMQ 등 사용</td><td>- 작업 분산<br>- 비동기 병렬 처리<br>- 메시지 순서 보장</td><td>주문 서비스 → 큐 발행 → 다수 소비자가 병렬 처리</td></tr><tr><td></td><td><strong>Publish-Subscribe (Pub/Sub)</strong></td><td>- Publisher, Topic/Exchange, 다중 Subscriber<br>- Kafka, SNS 등 사용</td><td>- 이벤트 브로드캐스트<br>- 느슨한 결합</td><td>주문 생성 → 여러 구독자 (알림, 로깅, 분석) 처리</td></tr><tr><td></td><td><strong>Request-Reply</strong></td><td>- Request Queue, Reply Queue, Correlation ID<br>- RPC over messaging</td><td>- 동기적 메시지 처리<br>- 응답 추적 가능</td><td>API 요청 → 메시지 큐 → 응답 큐로 결과 수신</td></tr><tr><td><strong>메시징 미들웨어 기반</strong></td><td><strong>Kafka 기반 스트림 처리</strong></td><td>- Producer, Topic(Partition), Consumer Group<br>- Kafka Streams, Connect 등 포함</td><td>- 내구성 높은 메시지 전달<br>- 고속 스트림 처리</td><td>주문 이벤트 → Kafka → 소비자 그룹 병렬 처리</td></tr><tr><td></td><td><strong>Cloud Messaging (SNS/SQS)</strong></td><td>- Fully Managed 서비스 (AWS SQS, GCP PubSub)<br>- DLQ, Delay, Trigger 등 구성</td><td>- 인프라 관리 최소화<br>- 빠른 도입과 확장</td><td>SNS → SQS → Lambda 호출 트리거</td></tr><tr><td><strong>고급 아키텍처 전략</strong></td><td><strong>Event Sourcing</strong></td><td>- 모든 상태 변화를 이벤트로 저장<br>- 이벤트 재생, 스냅샷</td><td>- 상태 이력 보존<br>- 디버깅 및 감사용</td><td>은행 계좌 시스템: 거래 내역 → 상태 재구성</td></tr><tr><td></td><td><strong>CQRS (Command Query Responsibility Segregation)</strong></td><td>- Command 모델, Query 모델 분리<br>- 이벤트 기반 읽기 모델 동기화</td><td>- 쓰기/읽기 분리 최적화<br>- 조회 성능 향상</td><td>소셜 플랫폼: 쓰기 모델 (포스트 생성) → 읽기 모델 (피드)</td></tr><tr><td></td><td><strong>Saga Pattern</strong></td><td>- 분산 트랜잭션 분해<br>- 오케스트레이션 or 코레오그래피<br>- 보상 트랜잭션 포함</td><td>- 데이터 일관성 유지<br>- 장애 회복/취소 처리</td><td>여행 예약 시스템: 항공 예약 실패 시 전체 보상</td></tr><tr><td><strong>실시간 스트림 처리</strong></td><td><strong>Stream Processing</strong></td><td>- Kafka Streams, Flink 등<br>- Stateful 연산, Window, 체크포인트</td><td>- 실시간 이벤트 집계<br>- 상태 기반 이벤트 처리</td><td>IoT 센서: 5 분 윈도우 평균 계산, 경고 발행</td></tr><tr><td><strong>지원 기법 및 패턴</strong></td><td><strong>Dead Letter Queue (DLQ)</strong></td><td>- 실패 메시지를 별도 큐로 이동<br>- 메시지 재처리 또는 알림용</td><td>- 오류 격리 및 재시도<br>- 장애 분석</td><td>메시지 처리 실패 → DLQ 로 이동 → 경고</td></tr><tr><td></td><td><strong>Backpressure / QoS 설정</strong></td><td>- prefetch count, rate limit<br>- 느린 소비자 보호</td><td>- 시스템 과부하 방지<br>- 병목 최소화</td><td>Kafka → Consumer Lag 모니터링, Throttle 적용</td></tr><tr><td></td><td><strong>Message Sourcing</strong></td><td>- 상태 변화 발생 시 메시지로 발행<br>- Event sourcing 과 결합 가능</td><td>- 상태 → 이벤트 변환<br>- 변경 감지 기반 처리</td><td>주문 상태 변경 시 메시지 발행 → 워크플로우 제어</td></tr></tbody></table><h4 id=queue-based-pattern>Queue-Based Pattern<a hidden class=anchor aria-hidden=true href=#queue-based-pattern>#</a></h4><p><strong>정의:</strong> Point-to-Point 통신을 위한 메시지 큐 활용 패턴</p><p><strong>구성:</strong></p><ul><li>Message Queue: 메시지 저장소</li><li>Competing Consumers: 병렬 처리를 위한 다중 소비자</li><li>Load Balancer: 메시지 분배 로직</li></ul><p><strong>목적:</strong> 작업 분산과 부하 분산을 통한 처리량 향상</p><p><strong>실제 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span><span class=lnt id=hl-5-41><a class=lnlinks href=#hl-5-41>41</a>
</span><span class=lnt id=hl-5-42><a class=lnlinks href=#hl-5-42>42</a>
</span><span class=lnt id=hl-5-43><a class=lnlinks href=#hl-5-43>43</a>
</span><span class=lnt id=hl-5-44><a class=lnlinks href=#hl-5-44>44</a>
</span><span class=lnt id=hl-5-45><a class=lnlinks href=#hl-5-45>45</a>
</span><span class=lnt id=hl-5-46><a class=lnlinks href=#hl-5-46>46</a>
</span><span class=lnt id=hl-5-47><a class=lnlinks href=#hl-5-47>47</a>
</span><span class=lnt id=hl-5-48><a class=lnlinks href=#hl-5-48>48</a>
</span><span class=lnt id=hl-5-49><a class=lnlinks href=#hl-5-49>49</a>
</span><span class=lnt id=hl-5-50><a class=lnlinks href=#hl-5-50>50</a>
</span><span class=lnt id=hl-5-51><a class=lnlinks href=#hl-5-51>51</a>
</span><span class=lnt id=hl-5-52><a class=lnlinks href=#hl-5-52>52</a>
</span><span class=lnt id=hl-5-53><a class=lnlinks href=#hl-5-53>53</a>
</span><span class=lnt id=hl-5-54><a class=lnlinks href=#hl-5-54>54</a>
</span><span class=lnt id=hl-5-55><a class=lnlinks href=#hl-5-55>55</a>
</span><span class=lnt id=hl-5-56><a class=lnlinks href=#hl-5-56>56</a>
</span><span class=lnt id=hl-5-57><a class=lnlinks href=#hl-5-57>57</a>
</span><span class=lnt id=hl-5-58><a class=lnlinks href=#hl-5-58>58</a>
</span><span class=lnt id=hl-5-59><a class=lnlinks href=#hl-5-59>59</a>
</span><span class=lnt id=hl-5-60><a class=lnlinks href=#hl-5-60>60</a>
</span><span class=lnt id=hl-5-61><a class=lnlinks href=#hl-5-61>61</a>
</span><span class=lnt id=hl-5-62><a class=lnlinks href=#hl-5-62>62</a>
</span><span class=lnt id=hl-5-63><a class=lnlinks href=#hl-5-63>63</a>
</span><span class=lnt id=hl-5-64><a class=lnlinks href=#hl-5-64>64</a>
</span><span class=lnt id=hl-5-65><a class=lnlinks href=#hl-5-65>65</a>
</span><span class=lnt id=hl-5-66><a class=lnlinks href=#hl-5-66>66</a>
</span><span class=lnt id=hl-5-67><a class=lnlinks href=#hl-5-67>67</a>
</span><span class=lnt id=hl-5-68><a class=lnlinks href=#hl-5-68>68</a>
</span><span class=lnt id=hl-5-69><a class=lnlinks href=#hl-5-69>69</a>
</span><span class=lnt id=hl-5-70><a class=lnlinks href=#hl-5-70>70</a>
</span><span class=lnt id=hl-5-71><a class=lnlinks href=#hl-5-71>71</a>
</span><span class=lnt id=hl-5-72><a class=lnlinks href=#hl-5-72>72</a>
</span><span class=lnt id=hl-5-73><a class=lnlinks href=#hl-5-73>73</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ를 이용한 Queue-Based 구현</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 처리 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># 큐 지속성 보장</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 메시지를 큐에 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># 메시지 지속성</span>
</span></span><span class=line><span class=cl>                <span class=n>correlation_id</span><span class=o>=</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 전송됨: </span><span class=si>{</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_orders</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 메시지 소비 및 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 역직렬화</span>
</span></span><span class=line><span class=cl>                <span class=n>order_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 주문 처리 로직 (예: 재고 확인, 결제 처리)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>handle_order</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 처리 완료 확인 응답</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 완료: </span><span class=si>{</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 실패 시 메시지 거부</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>requeue</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># Dead Letter Queue로 전송</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 실패: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># QoS 설정 (한 번에 하나의 메시지만 처리)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 소비자 등록</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;주문 처리 대기 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실제 주문 처리 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재고 확인, 결제 처리, 배송 준비 등</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=publish-subscribe-pattern>Publish-Subscribe Pattern<a hidden class=anchor aria-hidden=true href=#publish-subscribe-pattern>#</a></h4><p><strong>정의:</strong> 하나의 메시지를 여러 구독자에게 브로드캐스트하는 패턴</p><p><strong>구성:</strong></p><ul><li>Publisher: 메시지 발행자</li><li>Topic/Exchange: 메시지 분배 채널</li><li>Subscribers: 메시지 구독자들</li></ul><p><strong>목적:</strong> 이벤트 기반 시스템에서 느슨한 결합 구현</p><p><strong>실제 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>  1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>  2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>  3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>  4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>  5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6>  6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7>  7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8>  8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9>  9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10> 10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11> 11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12> 12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13> 13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14> 14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15> 15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16> 16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17> 17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18> 18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19> 19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20> 20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21> 21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22> 22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23> 23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24> 24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25> 25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26> 26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27> 27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28> 28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29> 29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30> 30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31> 31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32> 32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33> 33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34> 34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35> 35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36> 36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37> 37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38> 38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39> 39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40> 40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41> 41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42> 42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43> 43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44> 44</a>
</span><span class=lnt id=hl-6-45><a class=lnlinks href=#hl-6-45> 45</a>
</span><span class=lnt id=hl-6-46><a class=lnlinks href=#hl-6-46> 46</a>
</span><span class=lnt id=hl-6-47><a class=lnlinks href=#hl-6-47> 47</a>
</span><span class=lnt id=hl-6-48><a class=lnlinks href=#hl-6-48> 48</a>
</span><span class=lnt id=hl-6-49><a class=lnlinks href=#hl-6-49> 49</a>
</span><span class=lnt id=hl-6-50><a class=lnlinks href=#hl-6-50> 50</a>
</span><span class=lnt id=hl-6-51><a class=lnlinks href=#hl-6-51> 51</a>
</span><span class=lnt id=hl-6-52><a class=lnlinks href=#hl-6-52> 52</a>
</span><span class=lnt id=hl-6-53><a class=lnlinks href=#hl-6-53> 53</a>
</span><span class=lnt id=hl-6-54><a class=lnlinks href=#hl-6-54> 54</a>
</span><span class=lnt id=hl-6-55><a class=lnlinks href=#hl-6-55> 55</a>
</span><span class=lnt id=hl-6-56><a class=lnlinks href=#hl-6-56> 56</a>
</span><span class=lnt id=hl-6-57><a class=lnlinks href=#hl-6-57> 57</a>
</span><span class=lnt id=hl-6-58><a class=lnlinks href=#hl-6-58> 58</a>
</span><span class=lnt id=hl-6-59><a class=lnlinks href=#hl-6-59> 59</a>
</span><span class=lnt id=hl-6-60><a class=lnlinks href=#hl-6-60> 60</a>
</span><span class=lnt id=hl-6-61><a class=lnlinks href=#hl-6-61> 61</a>
</span><span class=lnt id=hl-6-62><a class=lnlinks href=#hl-6-62> 62</a>
</span><span class=lnt id=hl-6-63><a class=lnlinks href=#hl-6-63> 63</a>
</span><span class=lnt id=hl-6-64><a class=lnlinks href=#hl-6-64> 64</a>
</span><span class=lnt id=hl-6-65><a class=lnlinks href=#hl-6-65> 65</a>
</span><span class=lnt id=hl-6-66><a class=lnlinks href=#hl-6-66> 66</a>
</span><span class=lnt id=hl-6-67><a class=lnlinks href=#hl-6-67> 67</a>
</span><span class=lnt id=hl-6-68><a class=lnlinks href=#hl-6-68> 68</a>
</span><span class=lnt id=hl-6-69><a class=lnlinks href=#hl-6-69> 69</a>
</span><span class=lnt id=hl-6-70><a class=lnlinks href=#hl-6-70> 70</a>
</span><span class=lnt id=hl-6-71><a class=lnlinks href=#hl-6-71> 71</a>
</span><span class=lnt id=hl-6-72><a class=lnlinks href=#hl-6-72> 72</a>
</span><span class=lnt id=hl-6-73><a class=lnlinks href=#hl-6-73> 73</a>
</span><span class=lnt id=hl-6-74><a class=lnlinks href=#hl-6-74> 74</a>
</span><span class=lnt id=hl-6-75><a class=lnlinks href=#hl-6-75> 75</a>
</span><span class=lnt id=hl-6-76><a class=lnlinks href=#hl-6-76> 76</a>
</span><span class=lnt id=hl-6-77><a class=lnlinks href=#hl-6-77> 77</a>
</span><span class=lnt id=hl-6-78><a class=lnlinks href=#hl-6-78> 78</a>
</span><span class=lnt id=hl-6-79><a class=lnlinks href=#hl-6-79> 79</a>
</span><span class=lnt id=hl-6-80><a class=lnlinks href=#hl-6-80> 80</a>
</span><span class=lnt id=hl-6-81><a class=lnlinks href=#hl-6-81> 81</a>
</span><span class=lnt id=hl-6-82><a class=lnlinks href=#hl-6-82> 82</a>
</span><span class=lnt id=hl-6-83><a class=lnlinks href=#hl-6-83> 83</a>
</span><span class=lnt id=hl-6-84><a class=lnlinks href=#hl-6-84> 84</a>
</span><span class=lnt id=hl-6-85><a class=lnlinks href=#hl-6-85> 85</a>
</span><span class=lnt id=hl-6-86><a class=lnlinks href=#hl-6-86> 86</a>
</span><span class=lnt id=hl-6-87><a class=lnlinks href=#hl-6-87> 87</a>
</span><span class=lnt id=hl-6-88><a class=lnlinks href=#hl-6-88> 88</a>
</span><span class=lnt id=hl-6-89><a class=lnlinks href=#hl-6-89> 89</a>
</span><span class=lnt id=hl-6-90><a class=lnlinks href=#hl-6-90> 90</a>
</span><span class=lnt id=hl-6-91><a class=lnlinks href=#hl-6-91> 91</a>
</span><span class=lnt id=hl-6-92><a class=lnlinks href=#hl-6-92> 92</a>
</span><span class=lnt id=hl-6-93><a class=lnlinks href=#hl-6-93> 93</a>
</span><span class=lnt id=hl-6-94><a class=lnlinks href=#hl-6-94> 94</a>
</span><span class=lnt id=hl-6-95><a class=lnlinks href=#hl-6-95> 95</a>
</span><span class=lnt id=hl-6-96><a class=lnlinks href=#hl-6-96> 96</a>
</span><span class=lnt id=hl-6-97><a class=lnlinks href=#hl-6-97> 97</a>
</span><span class=lnt id=hl-6-98><a class=lnlinks href=#hl-6-98> 98</a>
</span><span class=lnt id=hl-6-99><a class=lnlinks href=#hl-6-99> 99</a>
</span><span class=lnt id=hl-6-100><a class=lnlinks href=#hl-6-100>100</a>
</span><span class=lnt id=hl-6-101><a class=lnlinks href=#hl-6-101>101</a>
</span><span class=lnt id=hl-6-102><a class=lnlinks href=#hl-6-102>102</a>
</span><span class=lnt id=hl-6-103><a class=lnlinks href=#hl-6-103>103</a>
</span><span class=lnt id=hl-6-104><a class=lnlinks href=#hl-6-104>104</a>
</span><span class=lnt id=hl-6-105><a class=lnlinks href=#hl-6-105>105</a>
</span><span class=lnt id=hl-6-106><a class=lnlinks href=#hl-6-106>106</a>
</span><span class=lnt id=hl-6-107><a class=lnlinks href=#hl-6-107>107</a>
</span><span class=lnt id=hl-6-108><a class=lnlinks href=#hl-6-108>108</a>
</span><span class=lnt id=hl-6-109><a class=lnlinks href=#hl-6-109>109</a>
</span><span class=lnt id=hl-6-110><a class=lnlinks href=#hl-6-110>110</a>
</span><span class=lnt id=hl-6-111><a class=lnlinks href=#hl-6-111>111</a>
</span><span class=lnt id=hl-6-112><a class=lnlinks href=#hl-6-112>112</a>
</span><span class=lnt id=hl-6-113><a class=lnlinks href=#hl-6-113>113</a>
</span><span class=lnt id=hl-6-114><a class=lnlinks href=#hl-6-114>114</a>
</span><span class=lnt id=hl-6-115><a class=lnlinks href=#hl-6-115>115</a>
</span><span class=lnt id=hl-6-116><a class=lnlinks href=#hl-6-116>116</a>
</span><span class=lnt id=hl-6-117><a class=lnlinks href=#hl-6-117>117</a>
</span><span class=lnt id=hl-6-118><a class=lnlinks href=#hl-6-118>118</a>
</span><span class=lnt id=hl-6-119><a class=lnlinks href=#hl-6-119>119</a>
</span><span class=lnt id=hl-6-120><a class=lnlinks href=#hl-6-120>120</a>
</span><span class=lnt id=hl-6-121><a class=lnlinks href=#hl-6-121>121</a>
</span><span class=lnt id=hl-6-122><a class=lnlinks href=#hl-6-122>122</a>
</span><span class=lnt id=hl-6-123><a class=lnlinks href=#hl-6-123>123</a>
</span><span class=lnt id=hl-6-124><a class=lnlinks href=#hl-6-124>124</a>
</span><span class=lnt id=hl-6-125><a class=lnlinks href=#hl-6-125>125</a>
</span><span class=lnt id=hl-6-126><a class=lnlinks href=#hl-6-126>126</a>
</span><span class=lnt id=hl-6-127><a class=lnlinks href=#hl-6-127>127</a>
</span><span class=lnt id=hl-6-128><a class=lnlinks href=#hl-6-128>128</a>
</span><span class=lnt id=hl-6-129><a class=lnlinks href=#hl-6-129>129</a>
</span><span class=lnt id=hl-6-130><a class=lnlinks href=#hl-6-130>130</a>
</span><span class=lnt id=hl-6-131><a class=lnlinks href=#hl-6-131>131</a>
</span><span class=lnt id=hl-6-132><a class=lnlinks href=#hl-6-132>132</a>
</span><span class=lnt id=hl-6-133><a class=lnlinks href=#hl-6-133>133</a>
</span><span class=lnt id=hl-6-134><a class=lnlinks href=#hl-6-134>134</a>
</span><span class=lnt id=hl-6-135><a class=lnlinks href=#hl-6-135>135</a>
</span><span class=lnt id=hl-6-136><a class=lnlinks href=#hl-6-136>136</a>
</span><span class=lnt id=hl-6-137><a class=lnlinks href=#hl-6-137>137</a>
</span><span class=lnt id=hl-6-138><a class=lnlinks href=#hl-6-138>138</a>
</span><span class=lnt id=hl-6-139><a class=lnlinks href=#hl-6-139>139</a>
</span><span class=lnt id=hl-6-140><a class=lnlinks href=#hl-6-140>140</a>
</span><span class=lnt id=hl-6-141><a class=lnlinks href=#hl-6-141>141</a>
</span><span class=lnt id=hl-6-142><a class=lnlinks href=#hl-6-142>142</a>
</span><span class=lnt id=hl-6-143><a class=lnlinks href=#hl-6-143>143</a>
</span><span class=lnt id=hl-6-144><a class=lnlinks href=#hl-6-144>144</a>
</span><span class=lnt id=hl-6-145><a class=lnlinks href=#hl-6-145>145</a>
</span><span class=lnt id=hl-6-146><a class=lnlinks href=#hl-6-146>146</a>
</span><span class=lnt id=hl-6-147><a class=lnlinks href=#hl-6-147>147</a>
</span><span class=lnt id=hl-6-148><a class=lnlinks href=#hl-6-148>148</a>
</span><span class=lnt id=hl-6-149><a class=lnlinks href=#hl-6-149>149</a>
</span><span class=lnt id=hl-6-150><a class=lnlinks href=#hl-6-150>150</a>
</span><span class=lnt id=hl-6-151><a class=lnlinks href=#hl-6-151>151</a>
</span><span class=lnt id=hl-6-152><a class=lnlinks href=#hl-6-152>152</a>
</span><span class=lnt id=hl-6-153><a class=lnlinks href=#hl-6-153>153</a>
</span><span class=lnt id=hl-6-154><a class=lnlinks href=#hl-6-154>154</a>
</span><span class=lnt id=hl-6-155><a class=lnlinks href=#hl-6-155>155</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Apache Kafka를 이용한 Pub-Sub 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>EventBus</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Kafka 클라이언트 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;event-bus-app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>producer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> 
</span></span><span class=line><span class=cl>            <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;notification-group&#39;</span> 
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>publishEvent</span><span class=p>(</span><span class=nx>eventType</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 이벤트 발행 메소드
</span></span></span><span class=line><span class=cl><span class=cm>         * @param {string} eventType - 이벤트 타입 (토픽명)
</span></span></span><span class=line><span class=cl><span class=cm>         * @param {object} eventData - 이벤트 데이터
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>key</span><span class=o>:</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>id</span> <span class=o>||</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>().</span><span class=nx>toString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=nx>eventType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=nx>data</span><span class=o>:</span> <span class=nx>eventData</span>
</span></span><span class=line><span class=cl>                <span class=p>}),</span>
</span></span><span class=line><span class=cl>                <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;content-type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;event-version&#39;</span><span class=o>:</span> <span class=s1>&#39;1.0&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>topic</span><span class=o>:</span> <span class=nx>eventType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>messages</span><span class=o>:</span> <span class=p>[</span><span class=nx>message</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이벤트 발행됨: </span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이벤트 발행 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>subscribeToEvents</span><span class=p>(</span><span class=nx>eventTypes</span><span class=p>,</span> <span class=nx>handler</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 이벤트 구독 메소드
</span></span></span><span class=line><span class=cl><span class=cm>         * @param {string[]} eventTypes - 구독할 이벤트 타입들
</span></span></span><span class=line><span class=cl><span class=cm>         * @param {function} handler - 이벤트 처리 함수
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 토픽 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>eventType</span> <span class=k>of</span> <span class=nx>eventTypes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> 
</span></span><span class=line><span class=cl>                    <span class=nx>topic</span><span class=o>:</span> <span class=nx>eventType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>false</span> 
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// 메시지 역직렬화
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=kr>const</span> <span class=nx>eventData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=c1>// 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=kr>await</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>topic</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이벤트 처리 완료: </span><span class=si>${</span><span class=nx>topic</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이벤트 처리 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// 재시도 또는 DLQ 전송 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이벤트 구독 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventBus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>id</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateOrderId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>customerId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAmount</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>calculateTotal</span><span class=p>(</span><span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;created&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publishEvent</span><span class=p>(</span><span class=s1>&#39;order-created&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>NotificationService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventBus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>initEventListeners</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>initEventListeners</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 관련 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>subscribeToEvents</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;order-created&#39;</span><span class=p>,</span> <span class=s1>&#39;order-completed&#39;</span><span class=p>,</span> <span class=s1>&#39;order-cancelled&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>handleOrderEvent</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderEvent</span><span class=p>(</span><span class=nx>eventType</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 주문 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=cm>         * @param {string} eventType - 이벤트 타입
</span></span></span><span class=line><span class=cl><span class=cm>         * @param {object} eventData - 이벤트 데이터
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>eventType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;order-created&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendOrderConfirmation</span><span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;order-completed&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendCompletionNotification</span><span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;order-cancelled&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendCancellationNotification</span><span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>sendOrderConfirmation</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 확인 알림 전송 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`주문 확인 알림 전송: </span><span class=si>${</span><span class=nx>orderData</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 설계 유연성 (Design Flexibility)</strong></td><td>느슨한 결합 (Loose Coupling)</td><td>컴포넌트 간 인터페이스만을 통한 통신으로 내부 구현에 대한 의존 없이 독립적 개발·배포 가능</td></tr><tr><td></td><td>위치 투명성 (Location Transparency)</td><td>네트워크 및 배포 위치에 관계없이 통신 가능 → 분산 환경에서 구조적 유연성 확보</td></tr><tr><td></td><td>시간 분리 (Temporal Decoupling)</td><td>송신자 - 수신자가 동시에 존재할 필요 없음 → 시스템 운영 시간대 유연성 확보</td></tr><tr><td></td><td>진화 가능성 (Evolution Capability)</td><td>기존 시스템에 영향 없이 새로운 서비스 추가 또는 교체 가능</td></tr><tr><td></td><td>다양한 기술 통합 (Interoperability)</td><td>이기종 시스템 간 프로토콜·언어가 달라도 메시지 포맷 기반 통신 가능</td></tr><tr><td><strong>2. 운영 안정성 (Operational Resilience)</strong></td><td>장애 격리 (Fault Isolation)</td><td>하나의 컴포넌트 장애가 전체 시스템에 영향을 주지 않도록 구조적으로 분리</td></tr><tr><td></td><td>메시지 지속성 (Message Durability)</td><td>디스크 기반 저장, 메시지 복제 등을 통해 메시지 유실 방지</td></tr><tr><td></td><td>재처리 및 복구 가능성 (Recoverability)</td><td>메시지 로그 (offset) 기반 재처리 및 DLQ 를 활용한 장애 대응 가능</td></tr><tr><td></td><td>신뢰성 (Reliability)</td><td>Ack, Retry, DLQ 정책 등을 통해 메시지 전송의 안정성과 예측 가능성 확보</td></tr><tr><td></td><td>백프레셔 관리 (Backpressure Handling)</td><td>메시지 큐/버퍼를 통해 일시적 트래픽 증가 상황에서 시스템을 보호하고 안정성을 유지</td></tr><tr><td><strong>3. 확장성 (Scalability)</strong></td><td>수평 확장 (Horizontal Scalability)</td><td>Consumer Group 기반으로 인스턴스를 자유롭게 추가하여 처리량 증가 대응 가능</td></tr><tr><td></td><td>독립 확장 (Independent Scaling)</td><td>특정 서비스만 선택적으로 확장 가능 (프로듀서 또는 컨슈머 측)</td></tr><tr><td></td><td>동적 구성 (Dynamic Reconfiguration)</td><td>새로운 큐/토픽 추가, 구성 요소 교체 등 무중단 운영 지원</td></tr><tr><td><strong>4. 성능 최적화 (Performance Optimization)</strong></td><td>비동기 처리 (Asynchronous Processing)</td><td>논블로킹 메시징으로 높은 동시성 및 시스템 응답성 확보</td></tr><tr><td></td><td>부하 흡수 (Load Absorption)</td><td>메시지 큐가 트래픽 피크를 완충, 시스템 병목 완화</td></tr><tr><td></td><td>순서 보장 (Ordering)</td><td>FIFO 또는 파티션 기반으로 메시지 순차성 유지 가능</td></tr><tr><td></td><td>자원 효율성 (Resource Efficiency)</td><td>유휴 시간 활용 가능, 스레드나 프로세스를 블로킹하지 않음</td></tr><tr><td><strong>5. 운영 가시성 (Observability & Testability)</strong></td><td>메시지 흐름 추적 (Traceability)</td><td>메시지 단위로 이벤트 흐름을 추적할 수 있어 디버깅과 문제 분석이 용이</td></tr><tr><td></td><td>모니터링 가능성 (Monitoring)</td><td>메트릭 수집, 트레이싱 도구 연동 (예: Prometheus, Grafana, Jaeger) 지원</td></tr><tr><td></td><td>테스트 용이성 (Testability)</td><td>구성 요소 간 독립성으로 단위 테스트 및 통합 테스트가 구조적으로 용이함</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>카테고리</th><th>단점</th><th>설명</th><th>해결 방안</th></tr></thead><tbody><tr><td><strong>설계/구조적</strong></td><td>시스템 복잡성 증가</td><td>메시지 브로커, 큐, DLQ, 멱등성 처리 등 아키텍처가 복잡해짐</td><td>IaC(Terraform/Helm) 기반 자동화, 메시징 표준 가이드 수립, MDA 도입 전 컴포넌트 명세 문서화</td></tr><tr><td></td><td>일관성 지연 (Eventually Consistent)</td><td>실시간 강한 일관성을 제공하지 않음</td><td>비즈니스에서 eventual consistency 허용 범위 정의, Saga 패턴, 이벤트 기반 검증 로직</td></tr><tr><td></td><td>설계 추상화 과도</td><td>메시지 중심 설계로 인해 단순한 서비스에도 오버엔지니어링 발생 가능</td><td>경량 메시징 또는 API- 우선 설계와 혼합 (Hybrid Architecture)</td></tr><tr><td><strong>운영/관측</strong></td><td>디버깅 및 추적 어려움</td><td>비동기 흐름으로 인해 호출 관계 파악이 어려움</td><td>Correlation ID 삽입, OpenTelemetry, 분산 트레이싱 시스템 도입</td></tr><tr><td></td><td>운영 오버헤드</td><td>큐 상태, 브로커 상태, 메시지 재처리 등 추가 운영 비용 발생</td><td>Managed Service 도입, DLQ 자동 알람 구성, Slack 알림 연동</td></tr><tr><td></td><td>테스트 어려움</td><td>메시지 흐름 기반 테스트는 타이밍 이슈와 상태 일관성 확보가 어려움</td><td>메시지 시뮬레이션 테스트, Contract 기반 테스트 도입</td></tr><tr><td><strong>성능/신뢰성</strong></td><td>메시지 중복 처리</td><td>재시도나 네트워크 오류로 중복 수신 가능성 존재</td><td>멱등성 설계, 고유 메시지 ID 관리, 소비자 중복 제거 로직</td></tr><tr><td></td><td>메시지 순서 보장 어려움</td><td>분산 처리, 파티션 재할당으로 순서 역전 가능</td><td>파티션 키 고정, 순서 보장 큐 (FIFO) 사용, 소비자에서 재정렬 처리</td></tr><tr><td></td><td>통신 지연 발생</td><td>브로커 중개, 네트워크 hops 증가로 인한 latency 상승</td><td>고성능 브로커 선택, 내부 네트워크 튜닝, 메시지 경량화</td></tr><tr><td><strong>유지보수/진화</strong></td><td>스키마 진화 관리</td><td>메시지 포맷 변경 시 하위 호환성 문제 발생</td><td>스키마 레지스트리 적용, 버전 명시, 어댑터 패턴 도입</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>카테고리</th><th>문제점</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방안</th><th>해결 방안</th></tr></thead><tbody><tr><td><strong>성능</strong></td><td>메시지 지연</td><td>파티션 불균형, 소비자 병목</td><td>시스템 처리량 저하, SLA 불이행</td><td>큐 길이, 소비자 처리율 모니터링</td><td>소비자 수 자동 스케일링, prefetch 설정 최적화</td><td>파티션 재조정, Autoscaler, 백프레셔 제어</td></tr><tr><td></td><td>백프레셔 전파</td><td>하위 시스템 처리 지연</td><td>전체 흐름 정체</td><td>처리율 메트릭 추적</td><td>비동기 큐 버퍼링, 우선순위 큐 도입</td><td>Adaptive Flow Control</td></tr><tr><td><strong>신뢰성</strong></td><td>메시지 유실</td><td>브로커 장애, ACK 실패</td><td>데이터 손실, 일관성 문제</td><td>로그 분석, 모니터링 시스템</td><td>durable 설정, 재전송 큐 구성</td><td>DLQ, 재처리 자동화</td></tr><tr><td></td><td>메시지 중복</td><td>재전송, 네트워크 오류</td><td>비즈니스 로직 중복 실행</td><td>메시지 ID 불일치 감지</td><td>고유 ID 부여, 멱등 처리 설계</td><td>중복 검사, 상태 기반 필터링</td></tr><tr><td></td><td>독성 메시지 (Poison Message)</td><td>잘못된 포맷, 소비자 오류</td><td>큐 정체, 장애 전파</td><td>반복 실패 패턴 감지</td><td>메시지 유효성 검사, 전처리 단계 적용</td><td>DLQ 격리, 재처리 횟수 제한</td></tr><tr><td><strong>일관성</strong></td><td>순서 역전</td><td>잘못된 파티셔닝, 병렬 소비자 처리</td><td>상태 비일관성</td><td>메시지 순서 모니터링</td><td>FIFO 큐, 파티션 키 고정</td><td>소비자 측 재정렬, 트랜잭션 보장</td></tr><tr><td><strong>유지보수</strong></td><td>스키마 불일치</td><td>메시지 포맷 변경</td><td>호환성 오류</td><td>메시지 디코딩 실패율 추적</td><td>스키마 레지스트리, 버전 관리</td><td>Adapter Pattern 적용</td></tr><tr><td><strong>복원력</strong></td><td>무한 루프 또는 재시도 폭주</td><td>잘못된 라우팅 설정</td><td>시스템 자원 소모</td><td>메시지 홉 수 추적</td><td>TTL, 최대 재시도 제한</td><td>회로 차단기 (Circuit Breaker), 조건 기반 DLQ</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방/해결 전략</th></tr></thead><tbody><tr><td><strong>1. 확장성과 성능</strong></td><td>대용량 메시지 실시간 처리</td><td>IoT, 빅데이터 환경에서의 메시지 폭증</td><td>시스템 과부하, 처리 지연, 백프레셔 유발</td><td>메시지 큐 지연, 처리량 모니터링, 리소스 사용량 추적</td><td>수평 확장, 파티셔닝 전략, Kafka Streams / Flink 도입, 엣지 컴퓨팅 활용, 적응형 처리 (adaptive batching)</td></tr><tr><td></td><td>순서 보장 문제</td><td>파티셔닝된 분산 환경에서 순서 유지를 위한 메커니즘 부족</td><td>비즈니스 로직 오류, 이벤트 처리 실패</td><td>메시지 순서 교란 탐지, 파티션 상태 확인</td><td>파티션 키 전략, 순서 ID 도입, FIFO 큐 활용, 메시지 재정렬 (logical sequencing) 구현</td></tr><tr><td></td><td>백프레셔 및 큐 과부하</td><td>컨슈머 처리 속도 &lt; 프로듀서 전송 속도</td><td>큐 포화, 메시지 지연, OOM 등 시스템 불안정성 유발</td><td>메시지 큐 길이, CPU/메모리 부하 감시</td><td>큐 사이즈 제한, 워커 증설, 유휴 처리기 스케줄링, Circuit Breaker 및 유량 제어 도입</td></tr><tr><td><strong>2. 일관성과 트랜잭션</strong></td><td>분산 트랜잭션 처리</td><td>메시지 기반 비동기 환경에서 ACID 보장 어려움</td><td>데이터 불일치, 복구 복잡성</td><td>트랜잭션 실패율, 메시지 응답 로그 분석</td><td>Saga 패턴, 보상 트랜잭션 설계, 이벤트 소싱, 최소 일관성 (일관된 상태 모델 정의), 2PC 일부 도입 고려</td></tr><tr><td></td><td>메시지 중복 및 멱등성 문제</td><td>네트워크 오류, 재전송, Ack 실패 등으로 인한 중복 메시지 발생</td><td>상태 불일치, 중복 처리, 장애 유발</td><td>메시지 ID 기반 중복 로그 분석</td><td>메시지에 UUID 부여, 수신 측에서 멱등성 보장 처리, Outbox 패턴, 중복 제거 캐시 (예: Redis)</td></tr><tr><td></td><td>메시지 유실 방지 문제</td><td>브로커 장애, 네트워크 단절, 비지속성 설정 등</td><td>데이터 손실, 트랜잭션 실패</td><td>브로커 상태, DLQ, 오프셋 상태 확인</td><td>메시지 영속성 설정 (ACK+ 디스크저장), 재전송 큐, DLQ 도입, Kafka 의 ISR(in-sync replica) 구성</td></tr><tr><td><strong>3. 메시지 스키마 및 계약</strong></td><td>메시지 스키마 진화</td><td>생산자 - 소비자 간 메시지 계약 불일치 (버전 호환성 없음)</td><td>소비자 오류, 파싱 실패, 시스템 다운</td><td>Schema Registry 에러율, 파싱 실패율 감시</td><td>Schema Registry 사용, backward/forward 호환 설계, 버전 명시, AsyncAPI 기반 계약 문서화</td></tr><tr><td></td><td>브로커 교체 또는 멀티 브로커 운영</td><td>브로커 변경 또는 이기종 브로커 병행 사용에 따른 계약 충돌</td><td>시스템간 연동 실패, 메시지 손실</td><td>브로커 간 호환성 테스트, 메시지 형식 모니터링</td><td>어댑터 계층 구축, 메시지 변환 계층 (Message Translator), 공통 포맷 (JSON, Avro) 도입</td></tr><tr><td><strong>4. 보안과 거버넌스</strong></td><td>민감 데이터 유출 위험</td><td>메시지 내 PII, 인증 정보, 금융 정보 포함 → 보호 필요성 증가</td><td>보안 위반, 법적 책임, 평판 하락</td><td>메시지 암호화 상태, 접근 로그, ACL 위반 확인</td><td>TLS 전송 암호화, 메시지 Payload 암호화/익명화, RBAC/ABAC 적용, 메시지 감시 시스템 구축</td></tr><tr><td></td><td>컴플라이언스 요구사항 대응</td><td>GDPR, HIPAA, CCPA 등 규제 대응 필수</td><td>벌금, 규제 위반, 감시 강화</td><td>감사 로그 분석, 개인정보 포함 메시지 탐지</td><td>메시지 수명주기 정책, 익명화, 토큰화, 감사 로그 저장, 데이터 주체 권리 행사 대응 절차 구현</td></tr><tr><td><strong>5. 관찰 가능성 (Observability)</strong></td><td>메시지 추적 어려움</td><td>비동기 흐름, 브로커 간 hop, 서비스 간 메시지 연쇄 발생</td><td>장애 원인 파악 지연, 디버깅 어려움</td><td>메시지 ID 기반 추적, 분산 트레이싱 로그 분석</td><td>메시지 상관관계 ID 삽입, OpenTelemetry 연동, Zipkin/Jaeger, 로그 집계 및 상관 분석 시스템 구축</td></tr><tr><td></td><td>메트릭/로그/트레이싱 통합 부족</td><td>도구 혼재, 브로커별 모니터링 방식 상이</td><td>운영 가시성 단절, 장애 탐지 지연</td><td>모니터링 데이터 수집률, 알림 반응시간 분석</td><td>표준화된 메트릭 수집 (Prometheus), 구조화 로그 (JSON), 메시지 라우팅 기반 트레이싱</td></tr><tr><td><strong>6. 레거시 통합 및 호환성</strong></td><td>레거시 동기 시스템과의 통합</td><td>기존 시스템이 메시지 기반 구조와 비호환</td><td>통합 복잡성 증가, 비즈니스 로직 오류, 일관성 손상</td><td>통신 시퀀스 분석, 요청/응답 패턴 감시</td><td>API Gateway, Adapter 패턴, Anti-Corruption Layer(ACL), Strangler Pattern, 이벤트 스토밍 활용</td></tr><tr><td></td><td>트랜잭션 경계 불일치 문제</td><td>레거시 시스템은 ACID 트랜잭션을 요구하지만 메시징은 eventual consistency 기반</td><td>일관성 보장 실패, 복잡한 보상 로직 필요</td><td>동기/비동기 경계 감시, 응답 지연 측정</td><td>트랜잭션 분해 설계, 보상 트랜잭션 정의, 상태 전이 기반 메시지 처리</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th><th>실무 적용 사례</th></tr></thead><tbody><tr><td><strong>메시지 전달 모델</strong></td><td>Point-to-Point (Queue)</td><td>하나의 Producer → 하나의 Consumer 비동기 작업 분산에 적합</td><td>주문 처리, 결제 큐</td></tr><tr><td></td><td>Publish-Subscribe (Topic)</td><td>하나의 Publisher → 다수의 Subscriber 이벤트 브로드캐스트 방식</td><td>알림 시스템, 뉴스피드</td></tr><tr><td></td><td>Request-Reply</td><td>요청/응답 구조로 응답 대기 필요 RPC 대안으로 활용</td><td>API 게이트웨이, 동기 서비스 호출</td></tr><tr><td></td><td>Fire-and-Forget</td><td>메시지 전송 후 응답 없이 다음 작업 수행</td><td>로그 수집, 트래킹 이벤트</td></tr><tr><td><strong>메시지 보장 수준</strong></td><td>At-most-once</td><td>메시지가 손실될 수 있음, 중복 없음</td><td>메트릭 수집, 모니터링</td></tr><tr><td></td><td>At-least-once</td><td>최소 한 번 이상 수신됨, 중복 가능성 있음</td><td>주문 이벤트, 이메일 발송</td></tr><tr><td></td><td>Exactly-once</td><td>정확히 한 번만 처리되도록 보장 (고비용)</td><td>결제 처리, 회계 트랜잭션</td></tr><tr><td><strong>처리 방식</strong></td><td>동기 메시징 (Synchronous)</td><td>요청 후 응답을 받을 때까지 대기, 응답 지연에 민감함</td><td>인증, 검증 요청</td></tr><tr><td></td><td>비동기 메시징 (Asynchronous)</td><td>메시지 발행 후 즉시 작업 해제, 처리 결과는 나중에 수신</td><td>비동기 주문 생성</td></tr><tr><td></td><td>하이브리드 메시징</td><td>동기/비동기 조합 사용</td><td>주문 요청은 동기, 후속 알림은 비동기</td></tr><tr><td><strong>라우팅 방식</strong></td><td>컨텐츠 기반 라우팅</td><td>메시지 본문의 내용에 따라 라우팅</td><td>규칙 엔진, 프로세스 오케스트레이션</td></tr><tr><td></td><td>헤더 기반 라우팅</td><td>메시지 헤더 정보 기반 라우팅</td><td>프로토콜 변환, API 버전 분리</td></tr><tr><td></td><td>키 기반 파티셔닝</td><td>파티션 키 기반 메시지 순서 및 그룹핑 보장</td><td>Kafka Order Stream 처리</td></tr><tr><td></td><td>토픽 기반 라우팅</td><td>토픽 명 기반 라우팅 및 소비자 그룹화</td><td>Kafka Topic 분기 처리</td></tr><tr><td><strong>아키텍처 스타일</strong></td><td>브로커 기반 (Brokered)</td><td>중앙 브로커를 통해 메시지를 송수신</td><td>RabbitMQ, Kafka</td></tr><tr><td></td><td>브로커리스 (Brokerless)</td><td>직접 메시지 교환, 경량 통신</td><td>ZeroMQ, gRPC P2P 메시징</td></tr><tr><td></td><td>이벤트 기반</td><td>상태 변경 이벤트 중심 설계 (Event-Driven)</td><td>DDD, CQRS, SAGA</td></tr><tr><td></td><td>명령 기반</td><td>명령형 메시지 중심 설계 (Command Message Pattern)</td><td>워커 처리 시스템</td></tr><tr><td></td><td>스트림 기반</td><td>지속적인 메시지 스트림 처리에 최적화</td><td>Kafka Streams, Flink</td></tr><tr><td><strong>운영 환경 및 배포 모델</strong></td><td>On-Premise</td><td>자체 인프라 기반 브로커 운영</td><td>대규모 기업 내부 통합 시스템</td></tr><tr><td></td><td>Cloud Managed Messaging</td><td>SQS, SNS, Pub/Sub 등 관리형 서비스</td><td>클라우드 네이티브 시스템</td></tr><tr><td></td><td>Hybrid</td><td>일부는 온프레미스, 일부는 클라우드</td><td>마이그레이션 환경</td></tr><tr><td></td><td>Serverless Messaging</td><td>Lambda + SQS/SNS, 이벤트 기반 FaaS</td><td>실시간 알림 시스템</td></tr><tr><td><strong>메시지 저장 특성</strong></td><td>Transient (휘발성)</td><td>메모리 기반 처리, 속도 빠르지만 유실 위험 존재</td><td>캐시 무효화, 로그 이벤트</td></tr><tr><td></td><td>Persistent (지속성)</td><td>디스크 기반 저장으로 유실 방지, 느리지만 안정적</td><td>트랜잭션 로그, 회계 데이터</td></tr><tr><td></td><td>Hybrid Persistence</td><td>메시지 등급에 따라 저장 방식 구분 (우선순위 기반 처리)</td><td>경고 메시지=지속성, 알림=휘발성</td></tr></tbody></table><h4 id=메시지-전달-모델>메시지 전달 모델<a hidden class=anchor aria-hidden=true href=#메시지-전달-모델>#</a></h4><p><strong>1. 점대점 (Point-to-Point) 패턴</strong></p><pre class=mermaid>graph LR
    S[Sender] --&gt; Q[Queue] --&gt; R[Receiver]
    style Q fill:#fbb,stroke:#333,stroke-width:2px
</pre><p>하나의 송신자가 하나의 수신자에게 메시지를 전송하는 가장 기본적인 패턴.</p><p><strong>2. 발행 - 구독 (Publish-Subscribe) 패턴</strong></p><pre class=mermaid>graph TD
    P[Publisher] --&gt; B[Broker/Topic]
    B --&gt; S1[Subscriber 1]
    B --&gt; S2[Subscriber 2] 
    B --&gt; S3[Subscriber 3]
    style B fill:#f9f,stroke:#333,stroke-width:2px
</pre><p>하나의 발행자가 여러 구독자에게 동시에 메시지를 전송하는 패턴.</p><p><strong>3. 요청 - 응답 (Request-Reply) 패턴</strong></p><pre class=mermaid>sequenceDiagram
    participant C as Client
    participant RQ as Request Queue
    participant S as Server
    participant RR as Reply Queue
    
    C-&gt;&gt;RQ: Request Message
    RQ-&gt;&gt;S: Deliver Request
    S-&gt;&gt;RR: Reply Message
    RR-&gt;&gt;C: Deliver Reply
</pre><p>비동기 환경에서 요청 - 응답 패턴을 구현하는 구조.</p><h4 id=운영-환경-및-배포-모델>운영 환경 및 배포 모델<a hidden class=anchor aria-hidden=true href=#운영-환경-및-배포-모델>#</a></h4><table><thead><tr><th>비교 항목</th><th>Cloud Managed (SNS/SQS, MSB, Pub/Sub)</th><th>On‑prem (Kafka, RabbitMQ, Pulsar)</th></tr></thead><tbody><tr><td><strong>운영 편의성</strong></td><td>자동 업그레이드, 장애 복구, 확장</td><td>구성/튜닝/백업 관리는 직접 수행</td></tr><tr><td><strong>비용 구조</strong></td><td>사용량 기반 과금, 예측 어려움</td><td>초기 인프라 투자, 운영비 예측 가능</td></tr><tr><td><strong>성능</strong></td><td>SLA 에 따라 다름, 지리적 지연 있음</td><td>낮은 지연·고성능, 최적화 가능</td></tr><tr><td><strong>기능 유연성</strong></td><td>제한된 설정 옵션, 네이티브 기능 중심</td><td>완전한 설정 제어 및 커스터마이징 가능</td></tr><tr><td><strong>보안/규정</strong></td><td>CSP 인증, IAM 통합, 리전별 저장</td><td>VPN, TLS, ACL 등 직접 구성 필요</td></tr><tr><td><strong>관리 복잡도</strong></td><td>낮음–CSP 책임</td><td>높음–인프라 설계·모니터링 필요</td></tr><tr><td><strong>인터그레이션</strong></td><td>CSP 생태계 통합 쉬움</td><td>다양한 외부 시스템 연동 가능</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>도메인</th><th>주요 기술 스택</th><th>주요 목적 / 사용 방식</th><th>실무 효과 및 성과</th></tr></thead><tbody><tr><td><strong>전자상거래</strong></td><td>Apache Kafka, Spring Boot, Microservices, Redis</td><td>주문 생성 → 재고 차감 → 결제 처리 → 배송 알림을 메시지로 분리/연동</td><td>처리 시간 50% 단축, 장애 격리, 독립 확장성 확보</td></tr><tr><td><strong>금융 서비스</strong></td><td>IBM MQ, Java EE, Event Sourcing</td><td>실시간 트랜잭션 처리, Fraud Detection, 리스크 분산, 거래 내역 메시징화</td><td>처리량 10 배 증가, 사기 탐지 정확도 95%, 장애 복원력 향상</td></tr><tr><td><strong>IoT / 스마트시티</strong></td><td>Kafka, Flink, MQTT, Cassandra, InfluxDB</td><td>실시간 센서 데이터 수집, 이상 감지, 교통·에너지 관리, Edge → Stream → Alert</td><td>초당 100 만 이벤트 처리, 에너지 효율 20% 향상</td></tr><tr><td><strong>물류 / 제조업</strong></td><td>RabbitMQ, Apache NiFi, MongoDB, Time Series DB, OPC UA</td><td>실시간 재고 동기화, 배송 추적, 예측 유지보수, 설비 모니터링</td><td>설비 가동률 95%, 재고 정확도 99.8%, 유지보수 비용 35% 절감</td></tr><tr><td><strong>소셜/미디어 플랫폼</strong></td><td>Kafka, Redis Streams, Node.js, Elasticsearch, GraphQL</td><td>실시간 피드, 알림, 사용자 활동 메시징, 추천 엔진 처리</td><td>응답 시간 200ms 이하, 시청 시간 20% 증가</td></tr><tr><td><strong>헬스케어</strong></td><td>ActiveMQ, Spring Cloud, FHIR</td><td>환자 데이터 통합, 의료진 알림, 실시간 진료 워크플로우</td><td>진료 지연 감소, 의료진 응답 시간 40% 단축</td></tr><tr><td><strong>게임 산업</strong></td><td>Apache Pulsar, Unity, Redis</td><td>매치메이킹, 이벤트 로그 처리, 리더보드 갱신을 실시간 메시지로 구성</td><td>동시 접속자 100 만 이상, 지연 50ms 이하 유지</td></tr><tr><td><strong>마이크로서비스 통합</strong></td><td>RabbitMQ,.NET Core, Go, Kubernetes, AWS SQS</td><td>서비스 간 통신 비동기화, API 호출 대체, 서비스 간 결합 제거</td><td>유연한 구조, 독립 배포, 장애 격리, 확장성 개선</td></tr><tr><td><strong>데이터 스트리밍 / 파이프라인</strong></td><td>Kafka, Flink, KSQL, Spring</td><td>ETL, 실시간 데이터 분석, 로그 파이프라인 자동화</td><td>지연시간 90% 감소, 대용량 이벤트 실시간 처리</td></tr><tr><td><strong>보안 / 인프라 모니터링</strong></td><td>ELK, Kafka, Prometheus, Fluent Bit, Loki</td><td>로그 수집, 보안 이상 탐지, 운영 시스템 이벤트 메시징 처리</td><td>실시간 경고 전송, 복구 시간 단축</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-주문-처리-시스템>사례 1: 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-주문-처리-시스템>#</a></h4><p><strong>시스템 구성:</strong></p><ul><li>주문 서비스 → 메시지 브로커 → 결제, 배송, 알림 서비스</li></ul><pre class=mermaid>graph LR
    A[주문 서비스] --&gt; B[메시지 브로커]
    B --&gt; C[결제 서비스]
    B --&gt; D[배송 서비스]
    B --&gt; E[알림 서비스]
</pre><p><strong>역할:</strong></p><ul><li>주문 서비스가 주문 메시지를 브로커에 발행하면, 브로커는 이를 결제, 배송, 알림 서비스에 비동기적으로 전달.</li></ul><p><strong>차이점:</strong></p><ul><li>메시지 기반 아키텍처가 없으면 서비스 간 직접 호출로 인해 결합도가 높아지고, 확장성과 장애 격리력이 떨어짐.</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 메시지 브로커 클래스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageBroker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic</span><span class=p>,</span> <span class=n>callback</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>topic</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>topic</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>topic</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>topic</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>callback</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>[</span><span class=n>topic</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>callback</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 발행자(주문 서비스)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>order_service</span><span class=p>(</span><span class=n>broker</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>broker</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=s1>&#39;order&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=mi>123</span><span class=p>,</span> <span class=s1>&#39;product&#39;</span><span class=p>:</span> <span class=s1>&#39;Laptop&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비자(결제, 배송, 알림 서비스)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>payment_service</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;결제 처리:&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delivery_service</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;배송 처리:&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>notification_service</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;알림 처리:&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 브로커 생성</span>
</span></span><span class=line><span class=cl><span class=n>broker</span> <span class=o>=</span> <span class=n>MessageBroker</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>broker</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s1>&#39;order&#39;</span><span class=p>,</span> <span class=n>payment_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>broker</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s1>&#39;order&#39;</span><span class=p>,</span> <span class=n>delivery_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>broker</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s1>&#39;order&#39;</span><span class=p>,</span> <span class=n>notification_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=n>order_service</span><span class=p>(</span><span class=n>broker</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-2-rabbitmq-기반-주문-처리-시스템>사례 2: RabbitMQ 기반 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-2-rabbitmq-기반-주문-처리-시스템>#</a></h4><p><strong>시스템 구성 및 워크플로우</strong>:</p><pre class=mermaid>flowchart TD
  User(사용자) --&gt; OrderSvc[Order Service]
  OrderSvc --&gt; RabbitMQ[Exchange/Order.Queue]
  RabbitMQ --&gt; InventorySvc[Inventory Service]
  RabbitMQ --&gt; NotificationSvc[Notification Service]
  InventorySvc --&gt; RabbitMQ[DLQ on failure]
  NotificationSvc --&gt; RabbitMQ[DLQ on failure]
</pre><ul><li><strong>Order Service</strong>는 주문 생성 시 메시지를 RabbitMQ Exchange 에 전송</li><li><strong>Inventory</strong>, <strong>Notification</strong> 서비스는 큐로 메시지를 수신하여 처리</li><li>Ack 기반의 신뢰성 보장, 실패 시 DLQ 로 메시지 이동</li></ul><p><strong>도입 전후 비교</strong>:</p><table><thead><tr><th>구분</th><th>도입 전 (동기 호출)</th><th>도입 후 (메시지 연결)</th></tr></thead><tbody><tr><td>결합도</td><td>높은 서비스 간 의존성</td><td>브로커 중심 느슨한 결합</td></tr><tr><td>장애 영향</td><td>서비스 단일 실패 시 전체 중단</td><td>일부 서비스 장애에도 시스템 유지</td></tr><tr><td>확장성</td><td>전체 구조 확장 어려움</td><td>소비자별 독립 확장 가능</td></tr><tr><td>테스트</td><td>종속성에 따른 어려움</td><td>독립 서비스 단위 테스트 가능</td></tr></tbody></table><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># producer.py - 주문 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>publish_order</span><span class=p>(</span><span class=n>order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_exchange&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_exchange&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 메시지 내구성</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>publish_order</span><span class=p>({</span><span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=s1>&#39;123&#39;</span><span class=p>,</span> <span class=s1>&#39;item&#39;</span><span class=p>:</span> <span class=s1>&#39;ABC&#39;</span><span class=p>,</span> <span class=s1>&#39;qty&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># consumer.py - 재고 서비스</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 처리: </span><span class=si>{</span><span class=n>order</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.dlq&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ch</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_exchange&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>ch</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>exclusive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>queue</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_exchange&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>q</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Producer</strong>: 주문 생성 시 메시지 durable 하게 발행</li><li><strong>Consumer</strong>: 메시지 처리 후 Ack 처리, 실패 시 DLQ 전송 기능 포함</li><li><strong>확장성 및 장애 대응</strong>을 내부 로직과 함께 보장</li></ul><h4 id=사례-3-netflix-의-마이크로서비스-아키텍처>사례 3: Netflix 의 마이크로서비스 아키텍처<a hidden class=anchor aria-hidden=true href=#사례-3-netflix-의-마이크로서비스-아키텍처>#</a></h4><p><strong>시스템 구성:</strong></p><pre class=mermaid>graph TB
    subgraph &#34;User Interface&#34;
        UI[Netflix Web/Mobile App]
    end
    
    subgraph &#34;API Gateway&#34;
        GW[Zuul Gateway]
    end
    
    subgraph &#34;Microservices&#34;
        US[User Service]
        CS[Content Service]
        RS[Recommendation Service]
        PS[Playback Service]
    end
    
    subgraph &#34;Message Infrastructure&#34;
        K[Apache Kafka]
        Q1[User Events Topic]
        Q2[Content Events Topic]
        Q3[Viewing Events Topic]
    end
    
    subgraph &#34;Data Processing&#34;
        SP[Stream Processing]
        ML[ML Pipeline]
        AN[Analytics Engine]
    end
    
    UI --&gt; GW
    GW --&gt; US
    GW --&gt; CS
    GW --&gt; RS
    GW --&gt; PS
    
    US --&gt; Q1
    CS --&gt; Q2
    PS --&gt; Q3
    
    Q1 --&gt; K
    Q2 --&gt; K
    Q3 --&gt; K
    
    K --&gt; SP
    K --&gt; ML
    K --&gt; AN
    
    ML --&gt; RS
</pre><p><strong>Workflow:</strong></p><ol><li><strong>사용자 행동 추적:</strong> 시청, 검색, 평가 등 모든 사용자 행동을 이벤트로 수집</li><li><strong>실시간 스트림 처리:</strong> Kafka 를 통해 수백만 개의 이벤트를 실시간으로 처리</li><li><strong>개인화 추천:</strong> 머신러닝 파이프라인이 사용자 이벤트를 기반으로 추천 모델 업데이트</li><li><strong>컨텐츠 배포:</strong> CDN 과 연동하여 최적의 컨텐츠 전송 경로 결정</li></ol><p><strong>Message-Driven Architecture 의 역할:</strong></p><ul><li><strong>서비스 간 결합도 제거:</strong> 각 마이크로서비스가 독립적으로 개발/배포 가능</li><li><strong>실시간 데이터 처리:</strong> 초당 수백만 개의 이벤트를 안정적으로 처리</li><li><strong>장애 격리:</strong> 개별 서비스 장애가 전체 시스템에 영향을 주지 않음</li></ul><p><strong>MDA 유무에 따른 차이점:</strong></p><ul><li><strong>MDA 적용 전:</strong> 동기적 API 호출로 인한 연쇄 장애, 확장성 제한</li><li><strong>MDA 적용 후:</strong> 99.99% 가용성 달성, 글로벌 확장 지원</li></ul><p><strong>구현 예시</strong>:</p><p>Netflix 사례를 기반으로 한 간소화된 영상 스트리밍 서비스 구현:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>  1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>  2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>  3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>  4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>  5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>  6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>  7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>  8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9>  9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10> 10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11> 11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12> 12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13> 13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14> 14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15> 15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16> 16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17> 17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18> 18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19> 19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20> 20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21> 21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22> 22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23> 23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24> 24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25> 25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26> 26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27> 27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28> 28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29> 29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30> 30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31> 31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32> 32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33> 33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34> 34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35> 35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36> 36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37> 37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38> 38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39> 39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40> 40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41> 41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42> 42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43> 43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44> 44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45> 45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46> 46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47> 47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48> 48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49> 49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50> 50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51> 51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52> 52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53> 53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54> 54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55> 55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56> 56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57> 57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58> 58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59> 59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60> 60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61> 61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62> 62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63> 63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64> 64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65> 65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66> 66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67> 67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68> 68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69> 69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70> 70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71> 71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72> 72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73> 73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74> 74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75> 75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76> 76</a>
</span><span class=lnt id=hl-16-77><a class=lnlinks href=#hl-16-77> 77</a>
</span><span class=lnt id=hl-16-78><a class=lnlinks href=#hl-16-78> 78</a>
</span><span class=lnt id=hl-16-79><a class=lnlinks href=#hl-16-79> 79</a>
</span><span class=lnt id=hl-16-80><a class=lnlinks href=#hl-16-80> 80</a>
</span><span class=lnt id=hl-16-81><a class=lnlinks href=#hl-16-81> 81</a>
</span><span class=lnt id=hl-16-82><a class=lnlinks href=#hl-16-82> 82</a>
</span><span class=lnt id=hl-16-83><a class=lnlinks href=#hl-16-83> 83</a>
</span><span class=lnt id=hl-16-84><a class=lnlinks href=#hl-16-84> 84</a>
</span><span class=lnt id=hl-16-85><a class=lnlinks href=#hl-16-85> 85</a>
</span><span class=lnt id=hl-16-86><a class=lnlinks href=#hl-16-86> 86</a>
</span><span class=lnt id=hl-16-87><a class=lnlinks href=#hl-16-87> 87</a>
</span><span class=lnt id=hl-16-88><a class=lnlinks href=#hl-16-88> 88</a>
</span><span class=lnt id=hl-16-89><a class=lnlinks href=#hl-16-89> 89</a>
</span><span class=lnt id=hl-16-90><a class=lnlinks href=#hl-16-90> 90</a>
</span><span class=lnt id=hl-16-91><a class=lnlinks href=#hl-16-91> 91</a>
</span><span class=lnt id=hl-16-92><a class=lnlinks href=#hl-16-92> 92</a>
</span><span class=lnt id=hl-16-93><a class=lnlinks href=#hl-16-93> 93</a>
</span><span class=lnt id=hl-16-94><a class=lnlinks href=#hl-16-94> 94</a>
</span><span class=lnt id=hl-16-95><a class=lnlinks href=#hl-16-95> 95</a>
</span><span class=lnt id=hl-16-96><a class=lnlinks href=#hl-16-96> 96</a>
</span><span class=lnt id=hl-16-97><a class=lnlinks href=#hl-16-97> 97</a>
</span><span class=lnt id=hl-16-98><a class=lnlinks href=#hl-16-98> 98</a>
</span><span class=lnt id=hl-16-99><a class=lnlinks href=#hl-16-99> 99</a>
</span><span class=lnt id=hl-16-100><a class=lnlinks href=#hl-16-100>100</a>
</span><span class=lnt id=hl-16-101><a class=lnlinks href=#hl-16-101>101</a>
</span><span class=lnt id=hl-16-102><a class=lnlinks href=#hl-16-102>102</a>
</span><span class=lnt id=hl-16-103><a class=lnlinks href=#hl-16-103>103</a>
</span><span class=lnt id=hl-16-104><a class=lnlinks href=#hl-16-104>104</a>
</span><span class=lnt id=hl-16-105><a class=lnlinks href=#hl-16-105>105</a>
</span><span class=lnt id=hl-16-106><a class=lnlinks href=#hl-16-106>106</a>
</span><span class=lnt id=hl-16-107><a class=lnlinks href=#hl-16-107>107</a>
</span><span class=lnt id=hl-16-108><a class=lnlinks href=#hl-16-108>108</a>
</span><span class=lnt id=hl-16-109><a class=lnlinks href=#hl-16-109>109</a>
</span><span class=lnt id=hl-16-110><a class=lnlinks href=#hl-16-110>110</a>
</span><span class=lnt id=hl-16-111><a class=lnlinks href=#hl-16-111>111</a>
</span><span class=lnt id=hl-16-112><a class=lnlinks href=#hl-16-112>112</a>
</span><span class=lnt id=hl-16-113><a class=lnlinks href=#hl-16-113>113</a>
</span><span class=lnt id=hl-16-114><a class=lnlinks href=#hl-16-114>114</a>
</span><span class=lnt id=hl-16-115><a class=lnlinks href=#hl-16-115>115</a>
</span><span class=lnt id=hl-16-116><a class=lnlinks href=#hl-16-116>116</a>
</span><span class=lnt id=hl-16-117><a class=lnlinks href=#hl-16-117>117</a>
</span><span class=lnt id=hl-16-118><a class=lnlinks href=#hl-16-118>118</a>
</span><span class=lnt id=hl-16-119><a class=lnlinks href=#hl-16-119>119</a>
</span><span class=lnt id=hl-16-120><a class=lnlinks href=#hl-16-120>120</a>
</span><span class=lnt id=hl-16-121><a class=lnlinks href=#hl-16-121>121</a>
</span><span class=lnt id=hl-16-122><a class=lnlinks href=#hl-16-122>122</a>
</span><span class=lnt id=hl-16-123><a class=lnlinks href=#hl-16-123>123</a>
</span><span class=lnt id=hl-16-124><a class=lnlinks href=#hl-16-124>124</a>
</span><span class=lnt id=hl-16-125><a class=lnlinks href=#hl-16-125>125</a>
</span><span class=lnt id=hl-16-126><a class=lnlinks href=#hl-16-126>126</a>
</span><span class=lnt id=hl-16-127><a class=lnlinks href=#hl-16-127>127</a>
</span><span class=lnt id=hl-16-128><a class=lnlinks href=#hl-16-128>128</a>
</span><span class=lnt id=hl-16-129><a class=lnlinks href=#hl-16-129>129</a>
</span><span class=lnt id=hl-16-130><a class=lnlinks href=#hl-16-130>130</a>
</span><span class=lnt id=hl-16-131><a class=lnlinks href=#hl-16-131>131</a>
</span><span class=lnt id=hl-16-132><a class=lnlinks href=#hl-16-132>132</a>
</span><span class=lnt id=hl-16-133><a class=lnlinks href=#hl-16-133>133</a>
</span><span class=lnt id=hl-16-134><a class=lnlinks href=#hl-16-134>134</a>
</span><span class=lnt id=hl-16-135><a class=lnlinks href=#hl-16-135>135</a>
</span><span class=lnt id=hl-16-136><a class=lnlinks href=#hl-16-136>136</a>
</span><span class=lnt id=hl-16-137><a class=lnlinks href=#hl-16-137>137</a>
</span><span class=lnt id=hl-16-138><a class=lnlinks href=#hl-16-138>138</a>
</span><span class=lnt id=hl-16-139><a class=lnlinks href=#hl-16-139>139</a>
</span><span class=lnt id=hl-16-140><a class=lnlinks href=#hl-16-140>140</a>
</span><span class=lnt id=hl-16-141><a class=lnlinks href=#hl-16-141>141</a>
</span><span class=lnt id=hl-16-142><a class=lnlinks href=#hl-16-142>142</a>
</span><span class=lnt id=hl-16-143><a class=lnlinks href=#hl-16-143>143</a>
</span><span class=lnt id=hl-16-144><a class=lnlinks href=#hl-16-144>144</a>
</span><span class=lnt id=hl-16-145><a class=lnlinks href=#hl-16-145>145</a>
</span><span class=lnt id=hl-16-146><a class=lnlinks href=#hl-16-146>146</a>
</span><span class=lnt id=hl-16-147><a class=lnlinks href=#hl-16-147>147</a>
</span><span class=lnt id=hl-16-148><a class=lnlinks href=#hl-16-148>148</a>
</span><span class=lnt id=hl-16-149><a class=lnlinks href=#hl-16-149>149</a>
</span><span class=lnt id=hl-16-150><a class=lnlinks href=#hl-16-150>150</a>
</span><span class=lnt id=hl-16-151><a class=lnlinks href=#hl-16-151>151</a>
</span><span class=lnt id=hl-16-152><a class=lnlinks href=#hl-16-152>152</a>
</span><span class=lnt id=hl-16-153><a class=lnlinks href=#hl-16-153>153</a>
</span><span class=lnt id=hl-16-154><a class=lnlinks href=#hl-16-154>154</a>
</span><span class=lnt id=hl-16-155><a class=lnlinks href=#hl-16-155>155</a>
</span><span class=lnt id=hl-16-156><a class=lnlinks href=#hl-16-156>156</a>
</span><span class=lnt id=hl-16-157><a class=lnlinks href=#hl-16-157>157</a>
</span><span class=lnt id=hl-16-158><a class=lnlinks href=#hl-16-158>158</a>
</span><span class=lnt id=hl-16-159><a class=lnlinks href=#hl-16-159>159</a>
</span><span class=lnt id=hl-16-160><a class=lnlinks href=#hl-16-160>160</a>
</span><span class=lnt id=hl-16-161><a class=lnlinks href=#hl-16-161>161</a>
</span><span class=lnt id=hl-16-162><a class=lnlinks href=#hl-16-162>162</a>
</span><span class=lnt id=hl-16-163><a class=lnlinks href=#hl-16-163>163</a>
</span><span class=lnt id=hl-16-164><a class=lnlinks href=#hl-16-164>164</a>
</span><span class=lnt id=hl-16-165><a class=lnlinks href=#hl-16-165>165</a>
</span><span class=lnt id=hl-16-166><a class=lnlinks href=#hl-16-166>166</a>
</span><span class=lnt id=hl-16-167><a class=lnlinks href=#hl-16-167>167</a>
</span><span class=lnt id=hl-16-168><a class=lnlinks href=#hl-16-168>168</a>
</span><span class=lnt id=hl-16-169><a class=lnlinks href=#hl-16-169>169</a>
</span><span class=lnt id=hl-16-170><a class=lnlinks href=#hl-16-170>170</a>
</span><span class=lnt id=hl-16-171><a class=lnlinks href=#hl-16-171>171</a>
</span><span class=lnt id=hl-16-172><a class=lnlinks href=#hl-16-172>172</a>
</span><span class=lnt id=hl-16-173><a class=lnlinks href=#hl-16-173>173</a>
</span><span class=lnt id=hl-16-174><a class=lnlinks href=#hl-16-174>174</a>
</span><span class=lnt id=hl-16-175><a class=lnlinks href=#hl-16-175>175</a>
</span><span class=lnt id=hl-16-176><a class=lnlinks href=#hl-16-176>176</a>
</span><span class=lnt id=hl-16-177><a class=lnlinks href=#hl-16-177>177</a>
</span><span class=lnt id=hl-16-178><a class=lnlinks href=#hl-16-178>178</a>
</span><span class=lnt id=hl-16-179><a class=lnlinks href=#hl-16-179>179</a>
</span><span class=lnt id=hl-16-180><a class=lnlinks href=#hl-16-180>180</a>
</span><span class=lnt id=hl-16-181><a class=lnlinks href=#hl-16-181>181</a>
</span><span class=lnt id=hl-16-182><a class=lnlinks href=#hl-16-182>182</a>
</span><span class=lnt id=hl-16-183><a class=lnlinks href=#hl-16-183>183</a>
</span><span class=lnt id=hl-16-184><a class=lnlinks href=#hl-16-184>184</a>
</span><span class=lnt id=hl-16-185><a class=lnlinks href=#hl-16-185>185</a>
</span><span class=lnt id=hl-16-186><a class=lnlinks href=#hl-16-186>186</a>
</span><span class=lnt id=hl-16-187><a class=lnlinks href=#hl-16-187>187</a>
</span><span class=lnt id=hl-16-188><a class=lnlinks href=#hl-16-188>188</a>
</span><span class=lnt id=hl-16-189><a class=lnlinks href=#hl-16-189>189</a>
</span><span class=lnt id=hl-16-190><a class=lnlinks href=#hl-16-190>190</a>
</span><span class=lnt id=hl-16-191><a class=lnlinks href=#hl-16-191>191</a>
</span><span class=lnt id=hl-16-192><a class=lnlinks href=#hl-16-192>192</a>
</span><span class=lnt id=hl-16-193><a class=lnlinks href=#hl-16-193>193</a>
</span><span class=lnt id=hl-16-194><a class=lnlinks href=#hl-16-194>194</a>
</span><span class=lnt id=hl-16-195><a class=lnlinks href=#hl-16-195>195</a>
</span><span class=lnt id=hl-16-196><a class=lnlinks href=#hl-16-196>196</a>
</span><span class=lnt id=hl-16-197><a class=lnlinks href=#hl-16-197>197</a>
</span><span class=lnt id=hl-16-198><a class=lnlinks href=#hl-16-198>198</a>
</span><span class=lnt id=hl-16-199><a class=lnlinks href=#hl-16-199>199</a>
</span><span class=lnt id=hl-16-200><a class=lnlinks href=#hl-16-200>200</a>
</span><span class=lnt id=hl-16-201><a class=lnlinks href=#hl-16-201>201</a>
</span><span class=lnt id=hl-16-202><a class=lnlinks href=#hl-16-202>202</a>
</span><span class=lnt id=hl-16-203><a class=lnlinks href=#hl-16-203>203</a>
</span><span class=lnt id=hl-16-204><a class=lnlinks href=#hl-16-204>204</a>
</span><span class=lnt id=hl-16-205><a class=lnlinks href=#hl-16-205>205</a>
</span><span class=lnt id=hl-16-206><a class=lnlinks href=#hl-16-206>206</a>
</span><span class=lnt id=hl-16-207><a class=lnlinks href=#hl-16-207>207</a>
</span><span class=lnt id=hl-16-208><a class=lnlinks href=#hl-16-208>208</a>
</span><span class=lnt id=hl-16-209><a class=lnlinks href=#hl-16-209>209</a>
</span><span class=lnt id=hl-16-210><a class=lnlinks href=#hl-16-210>210</a>
</span><span class=lnt id=hl-16-211><a class=lnlinks href=#hl-16-211>211</a>
</span><span class=lnt id=hl-16-212><a class=lnlinks href=#hl-16-212>212</a>
</span><span class=lnt id=hl-16-213><a class=lnlinks href=#hl-16-213>213</a>
</span><span class=lnt id=hl-16-214><a class=lnlinks href=#hl-16-214>214</a>
</span><span class=lnt id=hl-16-215><a class=lnlinks href=#hl-16-215>215</a>
</span><span class=lnt id=hl-16-216><a class=lnlinks href=#hl-16-216>216</a>
</span><span class=lnt id=hl-16-217><a class=lnlinks href=#hl-16-217>217</a>
</span><span class=lnt id=hl-16-218><a class=lnlinks href=#hl-16-218>218</a>
</span><span class=lnt id=hl-16-219><a class=lnlinks href=#hl-16-219>219</a>
</span><span class=lnt id=hl-16-220><a class=lnlinks href=#hl-16-220>220</a>
</span><span class=lnt id=hl-16-221><a class=lnlinks href=#hl-16-221>221</a>
</span><span class=lnt id=hl-16-222><a class=lnlinks href=#hl-16-222>222</a>
</span><span class=lnt id=hl-16-223><a class=lnlinks href=#hl-16-223>223</a>
</span><span class=lnt id=hl-16-224><a class=lnlinks href=#hl-16-224>224</a>
</span><span class=lnt id=hl-16-225><a class=lnlinks href=#hl-16-225>225</a>
</span><span class=lnt id=hl-16-226><a class=lnlinks href=#hl-16-226>226</a>
</span><span class=lnt id=hl-16-227><a class=lnlinks href=#hl-16-227>227</a>
</span><span class=lnt id=hl-16-228><a class=lnlinks href=#hl-16-228>228</a>
</span><span class=lnt id=hl-16-229><a class=lnlinks href=#hl-16-229>229</a>
</span><span class=lnt id=hl-16-230><a class=lnlinks href=#hl-16-230>230</a>
</span><span class=lnt id=hl-16-231><a class=lnlinks href=#hl-16-231>231</a>
</span><span class=lnt id=hl-16-232><a class=lnlinks href=#hl-16-232>232</a>
</span><span class=lnt id=hl-16-233><a class=lnlinks href=#hl-16-233>233</a>
</span><span class=lnt id=hl-16-234><a class=lnlinks href=#hl-16-234>234</a>
</span><span class=lnt id=hl-16-235><a class=lnlinks href=#hl-16-235>235</a>
</span><span class=lnt id=hl-16-236><a class=lnlinks href=#hl-16-236>236</a>
</span><span class=lnt id=hl-16-237><a class=lnlinks href=#hl-16-237>237</a>
</span><span class=lnt id=hl-16-238><a class=lnlinks href=#hl-16-238>238</a>
</span><span class=lnt id=hl-16-239><a class=lnlinks href=#hl-16-239>239</a>
</span><span class=lnt id=hl-16-240><a class=lnlinks href=#hl-16-240>240</a>
</span><span class=lnt id=hl-16-241><a class=lnlinks href=#hl-16-241>241</a>
</span><span class=lnt id=hl-16-242><a class=lnlinks href=#hl-16-242>242</a>
</span><span class=lnt id=hl-16-243><a class=lnlinks href=#hl-16-243>243</a>
</span><span class=lnt id=hl-16-244><a class=lnlinks href=#hl-16-244>244</a>
</span><span class=lnt id=hl-16-245><a class=lnlinks href=#hl-16-245>245</a>
</span><span class=lnt id=hl-16-246><a class=lnlinks href=#hl-16-246>246</a>
</span><span class=lnt id=hl-16-247><a class=lnlinks href=#hl-16-247>247</a>
</span><span class=lnt id=hl-16-248><a class=lnlinks href=#hl-16-248>248</a>
</span><span class=lnt id=hl-16-249><a class=lnlinks href=#hl-16-249>249</a>
</span><span class=lnt id=hl-16-250><a class=lnlinks href=#hl-16-250>250</a>
</span><span class=lnt id=hl-16-251><a class=lnlinks href=#hl-16-251>251</a>
</span><span class=lnt id=hl-16-252><a class=lnlinks href=#hl-16-252>252</a>
</span><span class=lnt id=hl-16-253><a class=lnlinks href=#hl-16-253>253</a>
</span><span class=lnt id=hl-16-254><a class=lnlinks href=#hl-16-254>254</a>
</span><span class=lnt id=hl-16-255><a class=lnlinks href=#hl-16-255>255</a>
</span><span class=lnt id=hl-16-256><a class=lnlinks href=#hl-16-256>256</a>
</span><span class=lnt id=hl-16-257><a class=lnlinks href=#hl-16-257>257</a>
</span><span class=lnt id=hl-16-258><a class=lnlinks href=#hl-16-258>258</a>
</span><span class=lnt id=hl-16-259><a class=lnlinks href=#hl-16-259>259</a>
</span><span class=lnt id=hl-16-260><a class=lnlinks href=#hl-16-260>260</a>
</span><span class=lnt id=hl-16-261><a class=lnlinks href=#hl-16-261>261</a>
</span><span class=lnt id=hl-16-262><a class=lnlinks href=#hl-16-262>262</a>
</span><span class=lnt id=hl-16-263><a class=lnlinks href=#hl-16-263>263</a>
</span><span class=lnt id=hl-16-264><a class=lnlinks href=#hl-16-264>264</a>
</span><span class=lnt id=hl-16-265><a class=lnlinks href=#hl-16-265>265</a>
</span><span class=lnt id=hl-16-266><a class=lnlinks href=#hl-16-266>266</a>
</span><span class=lnt id=hl-16-267><a class=lnlinks href=#hl-16-267>267</a>
</span><span class=lnt id=hl-16-268><a class=lnlinks href=#hl-16-268>268</a>
</span><span class=lnt id=hl-16-269><a class=lnlinks href=#hl-16-269>269</a>
</span><span class=lnt id=hl-16-270><a class=lnlinks href=#hl-16-270>270</a>
</span><span class=lnt id=hl-16-271><a class=lnlinks href=#hl-16-271>271</a>
</span><span class=lnt id=hl-16-272><a class=lnlinks href=#hl-16-272>272</a>
</span><span class=lnt id=hl-16-273><a class=lnlinks href=#hl-16-273>273</a>
</span><span class=lnt id=hl-16-274><a class=lnlinks href=#hl-16-274>274</a>
</span><span class=lnt id=hl-16-275><a class=lnlinks href=#hl-16-275>275</a>
</span><span class=lnt id=hl-16-276><a class=lnlinks href=#hl-16-276>276</a>
</span><span class=lnt id=hl-16-277><a class=lnlinks href=#hl-16-277>277</a>
</span><span class=lnt id=hl-16-278><a class=lnlinks href=#hl-16-278>278</a>
</span><span class=lnt id=hl-16-279><a class=lnlinks href=#hl-16-279>279</a>
</span><span class=lnt id=hl-16-280><a class=lnlinks href=#hl-16-280>280</a>
</span><span class=lnt id=hl-16-281><a class=lnlinks href=#hl-16-281>281</a>
</span><span class=lnt id=hl-16-282><a class=lnlinks href=#hl-16-282>282</a>
</span><span class=lnt id=hl-16-283><a class=lnlinks href=#hl-16-283>283</a>
</span><span class=lnt id=hl-16-284><a class=lnlinks href=#hl-16-284>284</a>
</span><span class=lnt id=hl-16-285><a class=lnlinks href=#hl-16-285>285</a>
</span><span class=lnt id=hl-16-286><a class=lnlinks href=#hl-16-286>286</a>
</span><span class=lnt id=hl-16-287><a class=lnlinks href=#hl-16-287>287</a>
</span><span class=lnt id=hl-16-288><a class=lnlinks href=#hl-16-288>288</a>
</span><span class=lnt id=hl-16-289><a class=lnlinks href=#hl-16-289>289</a>
</span><span class=lnt id=hl-16-290><a class=lnlinks href=#hl-16-290>290</a>
</span><span class=lnt id=hl-16-291><a class=lnlinks href=#hl-16-291>291</a>
</span><span class=lnt id=hl-16-292><a class=lnlinks href=#hl-16-292>292</a>
</span><span class=lnt id=hl-16-293><a class=lnlinks href=#hl-16-293>293</a>
</span><span class=lnt id=hl-16-294><a class=lnlinks href=#hl-16-294>294</a>
</span><span class=lnt id=hl-16-295><a class=lnlinks href=#hl-16-295>295</a>
</span><span class=lnt id=hl-16-296><a class=lnlinks href=#hl-16-296>296</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 사용자 서비스 - 사용자 행동 이벤트 발행</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aioredis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사용자 서비스 - 사용자 행동 추적 및 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        사용자 서비스 초기화
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            kafka_config: Kafka 브로커 설정
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>kafka_config</span><span class=p>[</span><span class=s1>&#39;brokers&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>key_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>k</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>track_user_activity</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>activity_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        사용자 활동 추적 및 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            user_id: 사용자 식별자
</span></span></span><span class=line><span class=cl><span class=s2>            activity_type: 활동 타입 (view, search, rate, etc.)
</span></span></span><span class=line><span class=cl><span class=s2>            content_id: 컨텐츠 식별자
</span></span></span><span class=line><span class=cl><span class=s2>            metadata: 추가 메타데이터
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 사용자 활동 이벤트 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_id&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>timestamp</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;activity_type&#39;</span><span class=p>:</span> <span class=n>activity_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;metadata&#39;</span><span class=p>:</span> <span class=n>metadata</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 토픽 결정 (활동 타입에 따라)</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;user-</span><span class=si>{</span><span class=n>activity_type</span><span class=si>}</span><span class=s2>-events&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 비동기 메시지 발행</span>
</span></span><span class=line><span class=cl>            <span class=n>future</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>  <span class=c1># 파티셔닝을 위한 키</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span><span class=o>=</span><span class=n>event_data</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 전송 결과 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>record_metadata</span> <span class=o>=</span> <span class=n>future</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;사용자 활동 이벤트 발행: </span><span class=si>{</span><span class=n>activity_type</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;Topic: </span><span class=si>{</span><span class=n>record_metadata</span><span class=o>.</span><span class=n>topic</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;Partition: </span><span class=si>{</span><span class=n>record_metadata</span><span class=o>.</span><span class=n>partition</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이벤트 발행 실패: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_viewing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>duration</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>position</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        시청 이벤트 처리 - 개인화 추천을 위한 중요 데이터
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            user_id: 사용자 ID
</span></span></span><span class=line><span class=cl><span class=s2>            content_id: 컨텐츠 ID  
</span></span></span><span class=line><span class=cl><span class=s2>            duration: 시청 시간 (초)
</span></span></span><span class=line><span class=cl><span class=s2>            position: 시청 위치 (초)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>viewing_metadata</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;duration_seconds&#39;</span><span class=p>:</span> <span class=n>duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;current_position&#39;</span><span class=p>:</span> <span class=n>position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;completion_rate&#39;</span><span class=p>:</span> <span class=n>position</span> <span class=o>/</span> <span class=n>duration</span> <span class=k>if</span> <span class=n>duration</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;device_type&#39;</span><span class=p>:</span> <span class=s1>&#39;web&#39;</span><span class=p>,</span>  <span class=c1># 실제로는 요청에서 추출</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;quality&#39;</span><span class=p>:</span> <span class=s1>&#39;1080p&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>track_user_activity</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>activity_type</span><span class=o>=</span><span class=s1>&#39;view&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>metadata</span><span class=o>=</span><span class=n>viewing_metadata</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;추천 서비스 - 사용자 이벤트 기반 실시간 추천&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span> <span class=n>redis_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        추천 서비스 초기화
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            kafka_config: Kafka 설정
</span></span></span><span class=line><span class=cl><span class=s2>            redis_config: Redis 설정 (캐싱용)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user-view-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user-search-events&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user-rate-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>kafka_config</span><span class=p>[</span><span class=s1>&#39;brokers&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;recommendation-service&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;latest&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_config</span> <span class=o>=</span> <span class=n>redis_config</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_event_processing</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 소비 및 추천 업데이트 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_client</span> <span class=o>=</span> <span class=k>await</span> <span class=n>aioredis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;redis://</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>redis_config</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>redis_config</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_user_event</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이벤트 처리 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_process_user_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                                <span class=n>redis_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        사용자 이벤트 처리 및 추천 모델 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            event_data: 사용자 이벤트 데이터
</span></span></span><span class=line><span class=cl><span class=s2>            redis_client: Redis 클라이언트
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>activity_type</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;activity_type&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;content_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>activity_type</span> <span class=o>==</span> <span class=s1>&#39;view&#39;</span> <span class=ow>and</span> <span class=n>content_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 시청 이벤트 기반 추천 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_viewing_history</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>user_id</span><span class=p>,</span> <span class=n>content_id</span><span class=p>,</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;metadata&#39;</span><span class=p>],</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실시간 추천 생성</span>
</span></span><span class=line><span class=cl>                <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>user_id</span><span class=p>,</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 추천 결과 캐싱</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=sa>f</span><span class=s2>&#34;recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=mi>3600</span><span class=p>,</span>  <span class=c1># 1시간 TTL</span>
</span></span><span class=line><span class=cl>                    <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=sa>f</span><span class=s2>&#34;추천 업데이트 완료: User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                    <span class=sa>f</span><span class=s2>&#34;추천 수: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>recommendations</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이벤트 처리 실패: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_update_viewing_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                    <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 시청 이력 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>viewing_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;completion_rate&#39;</span><span class=p>:</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;completion_rate&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis에 시청 이력 저장 (최근 100개 유지)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;viewing_history:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>viewing_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>ltrim</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;viewing_history:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>99</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_generate_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                      <span class=n>redis_client</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        사용자별 추천 생성 (간소화된 로직)
</span></span></span><span class=line><span class=cl><span class=s2>        실제로는 복잡한 ML 모델을 사용
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 사용자 시청 이력 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>viewing_history</span> <span class=o>=</span> <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>lrange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;viewing_history:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>viewing_history</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_popular_content</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 간단한 협업 필터링 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=n>viewed_content_ids</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>decode</span><span class=p>())[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>viewing_history</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 유사한 사용자들이 본 컨텐츠 추천 (실제로는 ML 모델)</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;rec_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;score&#39;</span><span class=p>:</span> <span class=mf>0.9</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>recommendations</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_popular_content</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;인기 컨텐츠 반환 (신규 사용자용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;popular_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;score&#39;</span><span class=p>:</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ContentDeliveryService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;컨텐츠 전송 서비스 - 시청 패턴 기반 최적화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user-view-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>kafka_config</span><span class=p>[</span><span class=s1>&#39;brokers&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;content-delivery-service&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>optimize_content_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 패턴 기반 컨텐츠 배포 최적화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>content_popularity</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;activity_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;view&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>content_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;content_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>content_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 컨텐츠 인기도 집계</span>
</span></span><span class=line><span class=cl>                    <span class=n>content_popularity</span><span class=p>[</span><span class=n>content_id</span><span class=p>]</span> <span class=o>=</span> \
</span></span><span class=line><span class=cl>                        <span class=n>content_popularity</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>content_id</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 임계치 도달 시 CDN 배포 최적화</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>content_popularity</span><span class=p>[</span><span class=n>content_id</span><span class=p>]</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimize_cdn_distribution</span><span class=p>(</span><span class=n>content_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_optimize_cdn_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;CDN 배포 최적화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;CDN 최적화 실행: </span><span class=si>{</span><span class=n>content_id</span><span class=si>}</span><span class=s2> - 인기도 증가로 인한 배포 확장&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제로는 CDN API 호출하여 복제본 생성/배포</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시 및 통합 실행</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메인 실행 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>kafka_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;brokers&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>redis_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=mi>6379</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 서비스 인스턴스 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>user_service</span> <span class=o>=</span> <span class=n>UserService</span><span class=p>(</span><span class=n>kafka_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendation_service</span> <span class=o>=</span> <span class=n>RecommendationService</span><span class=p>(</span><span class=n>kafka_config</span><span class=p>,</span> <span class=n>redis_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content_service</span> <span class=o>=</span> <span class=n>ContentDeliveryService</span><span class=p>(</span><span class=n>kafka_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 시뮬레이션: 사용자 시청 이벤트 발생</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>user_service</span><span class=o>.</span><span class=n>handle_user_viewing</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s1>&#39;user_123&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s1>&#39;movie_456&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>duration</span><span class=o>=</span><span class=mi>7200</span><span class=p>,</span>  <span class=c1># 2시간</span>
</span></span><span class=line><span class=cl>        <span class=n>position</span><span class=o>=</span><span class=mi>3600</span>   <span class=c1># 1시간 시청</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 추천 서비스와 컨텐츠 배포 서비스는 백그라운드에서 실행</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 환경에서는 별도 프로세스/컨테이너로 실행</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendation_service</span><span class=o>.</span><span class=n>start_event_processing</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>content_service</span><span class=o>.</span><span class=n>optimize_content_distribution</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>이 구현 예시는 Message-Driven Architecture 의 핵심 특징들을 보여줍니다:</p><ol><li><strong>비동기 메시지 처리:</strong> 사용자 이벤트가 즉시 처리되지 않고 큐를 통해 비동기적으로 처리</li><li><strong>서비스 간 결합도 완화:</strong> 각 서비스가 메시지 인터페이스를 통해서만 통신</li><li><strong>확장성:</strong> 각 서비스를 독립적으로 스케일링 가능</li><li><strong>장애 격리:</strong> 하나의 서비스 장애가 다른 서비스에 직접적 영향을 주지 않음</li></ol><h4 id=사례-4-마이크로서비스-기반-주문-처리-시스템>사례 4: 마이크로서비스 기반 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-4-마이크로서비스-기반-주문-처리-시스템>#</a></h4><p><strong>시스템 구성:</strong></p><ul><li>메시지 생산자: 주문 생성 서비스</li><li>메시지 브로커: RabbitMQ</li><li>메시지 소비자: 재고 관리, 결제, 배송 처리 서비스</li></ul><p><strong>워크플로우:</strong></p><ul><li>주문 생성 → RabbitMQ 로 메시지 발행 → 각 서비스가 메시지 구독 및 처리</li><li>주문 처리, 재고 차감, 결제, 배송 처리</li></ul><pre class=mermaid>flowchart TD
    A[Order Service] --&gt; B[RabbitMQ]
    B --&gt; C[Inventory Service]
    B --&gt; D[Payment Service]
    B --&gt; E[Shipping Service]
</pre><p><strong>MDA 의 역할:</strong></p><ul><li>실시간 주문 처리, 확장성, 통합, 데이터 일관성 보장</li></ul><p><strong>MDA 유무 차이:</strong></p><ul><li>MDA 미적용 시: 서비스 간 직접 호출로 인한 결합도 증가, 확장성 한계, 통합 어려움</li><li>MDA 적용 시: 실시간 처리, 확장성, 통합, 데이터 일관성 보장</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 생산자</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=s1>&#39;{&#34;order_id&#34;: &#34;ORD-12345&#34;}&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비자</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리: </span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-5-주문-보상-시스템>사례 5: 주문 보상 시스템<a hidden class=anchor aria-hidden=true href=#사례-5-주문-보상-시스템>#</a></h4><p><strong>시스템 구성</strong></p><pre class=mermaid>graph TB
  Producer[OrderService 발행: OrderCancelled] --&gt; Broker[(Kafka)]
  Broker --&gt; CompensationSvc[보상 처리 서비스]
  Broker --&gt; NotificationSvc[알림 서비스]
  CompensationSvc --&gt; Broker2[Kafka: CompensationCompleted]
  Broker2 --&gt; NotificationSvc
</pre><p><strong>Workflow 설명</strong>:</p><ol><li>주문 취소 이벤트 (<code>OrderCancelled</code>) 발행</li><li>보상 서비스와 알림 서비스가 해당 이벤트 수신 후 처리</li><li>보상 완료 시 (<code>CompensationCompleted</code>) 이벤트 재발행 → 알림 발행</li></ol><p><strong>차이점</strong>:</p><ul><li><strong>Message‑Driven 사용</strong>: 느슨한 결합으로 서비스 간 의존도 낮고, 장애 시 이벤트 재처리 보장</li><li><strong>미사용 시</strong>: 동기 호출 연결 → 타 서비스 장애 시 파급, 트랜잭션 복잡성 증가</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Producer – OrderCancelled 이벤트 발행</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka</span> <span class=kn>import</span> <span class=n>Producer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>({</span><span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>event</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span><span class=s1>&#39;user_cancel&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>produce</span><span class=p>(</span><span class=s1>&#39;OrderCancelled&#39;</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Consumer – CompensationSvc</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka</span> <span class=kn>import</span> <span class=n>Consumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>Consumer</span><span class=p>({</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;group.id&#39;</span><span class=p>:</span><span class=s1>&#39;compensation-svc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;auto.offset.reset&#39;</span><span class=p>:</span><span class=s1>&#39;earliest&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>.</span><span class=n>subscribe</span><span class=p>([</span><span class=s1>&#39;OrderCancelled&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>c</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1># 보상 로직 수행</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order </span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> compensation executed.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 보상 완료 이벤트 발행 생략 가능</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-6-e-commerce-주문-처리-시스템>사례 6: E-commerce 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-6-e-commerce-주문-처리-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li><strong>핵심 서비스들</strong>:<ul><li>주문 서비스 (Order Service)</li><li>재고 서비스 (Inventory Service)</li><li>결제 서비스 (Payment Service)</li><li>배송 서비스 (Shipping Service)</li><li>알림 서비스 (Notification Service)</li></ul></li><li><strong>메시지 인프라</strong>:<ul><li>Apache Kafka (메시지 브로커)</li><li>Apache Zookeeper (코디네이션)</li><li>Redis (캐싱 및 세션 관리)</li><li>PostgreSQL (트랜잭션 데이터)</li></ul></li></ul><pre class=mermaid>graph TB
    subgraph &#34;Frontend&#34;
        WEB[Web Application]
        MOBILE[Mobile App]
    end
    
    subgraph &#34;API Gateway&#34;
        GW[API Gateway]
    end
    
    subgraph &#34;Core Services&#34;
        OS[Order Service]
        IS[Inventory Service]
        PS[Payment Service]
        SS[Shipping Service]
        NS[Notification Service]
    end
    
    subgraph &#34;Message Infrastructure&#34;
        KAFKA[Apache Kafka]
        REDIS[Redis Cache]
    end
    
    subgraph &#34;Data Layer&#34;
        DB1[(Order DB)]
        DB2[(Inventory DB)]
        DB3[(Payment DB)]
        DB4[(Shipping DB)]
    end
    
    WEB --&gt; GW
    MOBILE --&gt; GW
    GW --&gt; OS
    
    OS &lt;--&gt; KAFKA
    IS &lt;--&gt; KAFKA
    PS &lt;--&gt; KAFKA
    SS &lt;--&gt; KAFKA
    NS &lt;--&gt; KAFKA
    
    OS --&gt; DB1
    IS --&gt; DB2
    PS --&gt; DB3
    SS --&gt; DB4
    
    KAFKA &lt;--&gt; REDIS
    
    style KAFKA fill:#f96,stroke:#333,stroke-width:3px
    style OS fill:#bbf,stroke:#333,stroke-width:2px
    style IS fill:#bbf,stroke:#333,stroke-width:2px
    style PS fill:#bbf,stroke:#333,stroke-width:2px
    style SS fill:#bbf,stroke:#333,stroke-width:2px
    style NS fill:#bbf,stroke:#333,stroke-width:2px
</pre><p><strong>활용 사례 Workflow</strong>:</p><pre class=mermaid>sequenceDiagram
    participant C as Customer
    participant O as Order Service
    participant K as Kafka
    participant I as Inventory Service
    participant P as Payment Service
    participant S as Shipping Service
    participant N as Notification Service
    
    C-&gt;&gt;O: Create Order
    O-&gt;&gt;O: Validate Order
    O-&gt;&gt;K: Publish OrderCreated Event
    O-&gt;&gt;C: Order Confirmation
    
    K-&gt;&gt;I: Deliver OrderCreated Event
    I-&gt;&gt;I: Check &amp; Reserve Inventory
    I-&gt;&gt;K: Publish InventoryReserved Event
    
    K-&gt;&gt;P: Deliver InventoryReserved Event
    P-&gt;&gt;P: Process Payment
    P-&gt;&gt;K: Publish PaymentCompleted Event
    
    K-&gt;&gt;S: Deliver PaymentCompleted Event
    S-&gt;&gt;S: Create Shipping Label
    S-&gt;&gt;K: Publish ShippingPrepared Event
    
    K-&gt;&gt;N: Deliver All Events
    N-&gt;&gt;N: Generate Notifications
    N-&gt;&gt;C: Send Email/SMS Updates
</pre><p><strong>Message-Driven Architecture 의 역할</strong>:</p><ol><li><p><strong>서비스 간 느슨한 결합</strong><br>각 서비스는 직접적인 API 호출 대신 이벤트를 통해 통신한다. 주문 서비스는 재고 서비스나 결제 서비스의 구체적인 구현을 알 필요가 없으며, 단지 적절한 이벤트를 발행하기만 하면 된다.</p></li><li><p><strong>확장성 및 성능 향상</strong><br>각 서비스는 독립적으로 확장할 수 있다. 특히 블랙 프라이데이 같은 대규모 이벤트 시에는 주문 서비스와 결제 서비스를 독립적으로 스케일링할 수 있다.</p></li><li><p><strong>장애 격리 및 복원력</strong><br>결제 서비스에 장애가 발생해도 주문 생성과 재고 확인은 정상적으로 처리되며, 메시지 큐에 결제 이벤트가 대기하다가 서비스 복구 후 처리된다.</p></li><li><p><strong>비즈니스 프로세스 투명성</strong><br>모든 비즈니스 이벤트가 메시지로 표현되어 주문 처리 과정을 명확하게 추적할 수 있다.</p></li></ol><p><strong>Message-Driven Architecture 유무에 따른 차이점</strong>:</p><ul><li><strong>Message-Driven Architecture 적용 전</strong>:<ul><li>동기식 API 호출로 인한 타이트 커플링</li><li>하나의 서비스 장애가 전체 주문 프로세스 중단</li><li>모든 서비스가 동시에 가용해야 함</li><li>확장 시 모든 서비스를 함께 고려해야 함</li><li>트랜잭션 경계가 여러 서비스에 걸쳐 복잡함</li></ul></li><li><strong>Message-Driven Architecture 적용 후</strong>:<ul><li>느슨한 결합으로 서비스 독립성 확보</li><li>장애 격리로 부분적 서비스 제공 가능</li><li>비동기 처리로 높은 처리량 달성</li><li>개별 서비스의 독립적 확장 가능</li><li>이벤트 기반 최종 일관성으로 복잡성 관리</li></ul></li></ul><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려사항</th><th>설명 및 위험 요소</th><th>권장사항 및 전략</th></tr></thead><tbody><tr><td><strong>1. 메시지 스키마 및 계약 관리</strong></td><td>메시지 스키마 정의 및 관리</td><td>스키마 변경 시 소비자 장애 발생, 스키마 불일치로 시스템 오류</td><td>Schema Registry 도입, JSON/Avro/Protobuf 활용, 호환성 체크 자동화, 버전 명시, AsyncAPI 문서화</td></tr><tr><td></td><td>메시지 타입 및 구조 표준화</td><td>이벤트, 명령, 문서 메시지 구분 미흡 시 처리 혼란</td><td>메시지 분류 체계 정의 (Event/Command/Document), 네이밍 규칙 통일</td></tr><tr><td></td><td>메시지 크기 관리</td><td>대용량 메시지로 인한 브로커 부하, 지연 증가</td><td>Payload 은 외부 저장소 (S3 등) 에 저장하고, 메타데이터만 메시지에 포함 (Reference Pattern)</td></tr><tr><td></td><td>계약 기반 개발 (Contract First)</td><td>Schema 불일치 발생 → 배포 충돌</td><td>Consumer-Driven Contract 테스트, CI 에서 계약 검증 수행</td></tr><tr><td><strong>2. 메시지 처리 신뢰성</strong></td><td>Ack / Retry / DLQ 관리</td><td>무한 재시도 또는 누락 시 시스템 지연/장애 발생</td><td>재시도 횟수 제한, TTL 설정, DLQ 구성, Circuit Breaker 패턴 도입</td></tr><tr><td></td><td>멱등성 보장</td><td>중복 메시지 처리로 인한 상태 오염 가능</td><td>메시지 ID + 멱등 처리 로직 구성 (idempotent consumer), Redis 등 캐시 활용</td></tr><tr><td></td><td>메시지 순서 보장 및 파티셔닝</td><td>순서 교란 시 데이터 무결성 저하</td><td>파티션 키 설계, FIFO 큐, 파티션 간 균형 조절, 순서 추적 메커니즘 구성</td></tr><tr><td></td><td>트랜잭션 처리 및 보상 전략</td><td>분산 환경에서 일관성 유지 어려움</td><td>Saga 패턴, 보상 트랜잭션 설계, Outbox 패턴 도입, 최소 일관성 모델 구성</td></tr><tr><td><strong>3. 모니터링 및 관찰 가능성</strong></td><td>메시지 흐름 추적 및 상관관계 관리</td><td>장애 원인 분석 어려움, 추적 불가 메시지 발생</td><td>Correlation ID 포함, Span 기반 트레이싱, OpenTelemetry, Jaeger/Zipkin 도입</td></tr><tr><td></td><td>시스템 메트릭 및 알람 구성</td><td>소비자 지연/에러율 탐지 어려움</td><td>Prometheus + Grafana, Broker 상태 모니터링, 자동 알림 설정</td></tr><tr><td></td><td>로그 및 메시지 시각화</td><td>로그 미분리 및 메시지 내역 확인 불가</td><td>구조화 로그 (JSON), ELK/EFK Stack, 메시지 필터링 로그 구성</td></tr><tr><td><strong>4. 보안 및 컴플라이언스</strong></td><td>데이터 유출 및 민감 정보 보호</td><td>메시지에 PII 또는 기밀 정보 포함 시 보안 사고 위험</td><td>End-to-End TLS, 메시지 암호화, Tokenization/Masking, 메시지 레벨 보안 적용</td></tr><tr><td></td><td>인증 및 접근 제어</td><td>무단 메시지 접근 가능성, API 접근 제어 부족</td><td>OAuth 2.0, RBAC, JWT, IAM 기반 인증/인가 통합</td></tr><tr><td></td><td>규정 준수 (GDPR, CCPA 등)</td><td>메시지 보관 주기/사용 목적 미준수 시 법적 리스크</td><td>메시지 보존 정책 수립, TTL/Retention 관리, 감사 로그 보관, 이벤트 로그 익명화 처리</td></tr><tr><td><strong>5. 운영 및 인프라 관리</strong></td><td>메시지 브로커 선정</td><td>성능/가용성/복잡도에 따라 선택 오류 가능</td><td>Kafka(대용량 처리), RabbitMQ(라우팅), AWS SQS(서버리스) 등 목적 기반 선택</td></tr><tr><td></td><td>오토스케일링 및 백프레셔 대응</td><td>소비자 리소스 부족 시 병목 발생</td><td>Auto Scaling Group 설정, Consumer Group 조정, 큐 기반 부하 제어</td></tr><tr><td></td><td>재해 복구 및 복원 전략</td><td>메시지 유실 및 장애 시 대응 전략 부족</td><td>브로커 복제, 다중 가용영역 배치, 메시지 백업 정책 구성, 복구 시나리오 테스트</td></tr><tr><td></td><td>비용 및 저장소 관리</td><td>장기 저장 또는 과도한 메시지로 스토리지 비용 증가</td><td>Tiered Storage, Retention 정책 설정, 메시지 압축 (COMPRESS) 적용</td></tr><tr><td><strong>6. 테스트 및 배포 전략</strong></td><td>메시지 기반 테스트 환경 구성</td><td>비동기 흐름 테스트 복잡도 증가</td><td>Testcontainers, Mock Broker, Consumer Stub 구성, Contract Test 도입</td></tr><tr><td></td><td>배포 전략</td><td>스키마 불일치 또는 메시지 호환성 문제로 서비스 중단 위험</td><td>Blue/Green 또는 카나리 배포, 메시지 호환성 검증 CI 파이프라인 적용</td></tr><tr><td></td><td>문서화 및 커뮤니케이션 체계</td><td>이벤트 플로우 불투명 → 온보딩 및 유지보수 어려움</td><td>AsyncAPI 기반 문서화, 메시지 카탈로그 (Event Catalog), 메시지 라우팅 다이어그램 제공</td></tr></tbody></table><h4 id=메시지-분류-체계-정의>메시지 분류 체계 정의<a hidden class=anchor aria-hidden=true href=#메시지-분류-체계-정의>#</a></h4><p>메시지 기반 시스템이나 이벤트 지향 아키텍처에서 <strong>Event</strong>, <strong>Command</strong>, <strong>Document</strong>는 메시지의 의도와 정보를 분류하는 핵심 패턴이다. 각 메시지 유형의 본질, 특징, 용도 차이를 명확히 이해하는 것은 견고하고 유지보수 가능한 분산 시스템 설계에 필수적이다.</p><table><thead><tr><th>항목</th><th><strong>Event</strong> (이벤트)</th><th><strong>Command</strong> (명령)</th><th><strong>Document</strong> (문서)</th></tr></thead><tbody><tr><td><strong>정의</strong></td><td>과거에 발생한 사실 또는 상태 변경을 나타냄</td><td>특정 작업을 수행하라는 요청 (요구 사항)</td><td>시스템 간 전달되는 구조화된 데이터 또는 전체 상태 스냅샷</td></tr><tr><td><strong>의도</strong></td><td>" 무엇이 일어났는가 " 를 알리기 위함</td><td>" 무엇을 하라 " 고 지시함</td><td>" 무엇이 존재하는가 " 를 공유함</td></tr><tr><td><strong>처리 주체</strong></td><td>수신자가 선택적으로 처리 (옵션)</td><td>반드시 특정 수신자가 처리해야 함</td><td>수신자가 자유롭게 해석 및 활용 가능</td></tr><tr><td><strong>결합도</strong></td><td>낮음 (발신자는 수신자를 모름)</td><td>상대적으로 높음 (발신자는 수신자의 존재를 전제로 함)</td><td>매우 낮음 (단순 데이터 공유, 비즈니스 의미 없음)</td></tr><tr><td><strong>전달 보장</strong></td><td>At-least-once 또는 Best-effort</td><td>Exactly-once 또는 At-least-once 요구됨</td><td>보장 없음 또는 일회성 데이터 전달</td></tr><tr><td><strong>예시</strong></td><td>주문이 생성됨, 결제가 완료됨, 재고가 소진됨 등</td><td>재고 차감 요청, 배송 시작 요청, 이메일 전송 요청 등</td><td>고객 정보 문서, 인보이스 PDF, JSON 기반의 주문 전체 내역 등</td></tr><tr><td><strong>순서 보장</strong></td><td>일반적으로 중요하지 않음</td><td>순서 보장 중요 (예: 동일 사용자에 대한 명령 순서)</td><td>순서 중요하지 않음 (스냅샷이므로 덮어쓰기됨)</td></tr><tr><td><strong>상태 변화 유도 여부</strong></td><td>수신자는 상태를 바꾸지 않을 수도 있음</td><td>반드시 상태 변경 또는 작업 수행</td><td>상태를 직접 바꾸기보다 상태를 " 알려주는 " 용도</td></tr><tr><td><strong>보통 사용하는 패턴</strong></td><td>이벤트 소싱, Pub/Sub, CQRS, Saga, EDA</td><td>Request-Reply, Command Bus, CQRS, Orchestration</td><td>데이터 전송, ETL 파이프라인, 문서 기반 API</td></tr><tr><td><strong>역할 중심 시스템 구조</strong></td><td>비동기 이벤트 리스너 중심 (반응형)</td><td>명령 처리 핸들러 중심 (지시형)</td><td>단순 데이터 소비 중심 (설명적)</td></tr></tbody></table><h5 id=추가-사례-및-설계-가이드>추가 사례 및 설계 가이드<a hidden class=anchor aria-hidden=true href=#추가-사례-및-설계-가이드>#</a></h5><ul><li><strong>Commands</strong>는 시스템 내에서 상태 변화를 요구하며, 일반적으로 명사 + 동사 (혹은 동사 + 명사) 패턴의 명확한 Naming 룰을 권장한다.</li><li><strong>Events</strong>는 시스템 변화의 결과로 자연스럽게 발생하며, 과거형 동사 (예: Ordered, Paid, Updated) 등의 명명이 바람직하다.</li><li><strong>Documents</strong>는 CRUD 기반 REST API 설계, 대량 데이터 송수신, 외부 시스템간 데이터 동기화 등에서 자주 쓰인다.</li></ul><h4 id=퍼블리싱-전달-보증-수준-delivery-guarantees>퍼블리싱 전달 보증 수준 (Delivery Guarantees)<a hidden class=anchor aria-hidden=true href=#퍼블리싱-전달-보증-수준-delivery-guarantees>#</a></h4><p>각 메시징 시스템은 서로 다른 전달 보증 수준을 제공하며, 보증 수준 설계 시 중요한 고려사항이다:</p><table><thead><tr><th>보증 수준</th><th>정의</th><th>보장 조건 및 전제</th><th>실현 메커니즘</th><th>대표 활용 시나리오</th><th>예시 기술</th></tr></thead><tbody><tr><td><strong>At-most-once</strong></td><td><strong>최대 한 번 전달</strong> (손실 허용)</td><td>네트워크 오류, Consumer 다운 시 손실 발생 가능</td><td>- 메시지 전송 후 즉시 삭제<br>Ack 없이 전송<br>Retry 없음</td><td>- 로그 전송<br>- 실시간 모니터링<br>Push 알림 등 손실 허용 가능한 상황</td><td>UDP 기반 전송<br>Kafka (acks=0)</td></tr><tr><td><strong>At-least-once</strong></td><td><strong>최소 한 번 이상 전달</strong> (중복 허용)</td><td>- 메시지 손실 없이 도착 보장<br>- 중복 발생 가능성 존재</td><td>- 메시지 재시도 (Retry)<br>Ack 기반 수신 확인<br>- 브로커 메시지 저장 유지</td><td>- 결제 처리<br>- 주문 시스템<br>- 데이터 적재 (중복 필터링 가능 시)</td><td>Kafka (acks=1), RabbitMQ, SQS</td></tr><tr><td><strong>Exactly-once</strong></td><td><strong>정확히 한 번 전달 보장</strong></td><td>- 메시지 중복도, 손실도 모두 방지<br>- 시스템 전반의 idempotency 필요</td><td>- Idempotent Producer 설정<br>Transactional Consumer<br>- 메시지 상태 관리, 중복 제거 로직 필요</td><td>- 금융 이체<br>- 분산 트랜잭션<br>- 이벤트 소싱 기반 영속성 처리</td><td>Kafka EOS<br>Kafka Streams<br>SQS FIFO + deduplication ID</td></tr></tbody></table><h5 id=핵심-비교-요약>핵심 비교 요약<a hidden class=anchor aria-hidden=true href=#핵심-비교-요약>#</a></h5><table><thead><tr><th>항목</th><th>At-most-once</th><th>At-least-once</th><th>Exactly-once</th></tr></thead><tbody><tr><td><strong>신뢰도</strong></td><td>낮음 (손실 가능)</td><td>중간 (중복 가능)</td><td>높음 (중복/손실 모두 방지)</td></tr><tr><td><strong>성능</strong></td><td>매우 빠름</td><td>중간</td><td>상대적으로 낮음 (복잡한 처리 필요)</td></tr><tr><td><strong>복잡도</strong></td><td>낮음</td><td>중간</td><td>높음</td></tr><tr><td><strong>실현 비용</strong></td><td>거의 없음</td><td>재시도, 저장소 필요</td><td>트랜잭션 로그, 상태 관리 등 부가 시스템 요구</td></tr><tr><td><strong>적합 용도</strong></td><td>비핵심 정보, 손실 허용</td><td>핵심 정보, 중복 허용</td><td>비즈니스 핵심 정보, 중복/손실 모두 금지</td></tr></tbody></table><h5 id=kafka---전달-보증-구현-방법>Kafka - 전달 보증 구현 방법<a hidden class=anchor aria-hidden=true href=#kafka---전달-보증-구현-방법>#</a></h5><table><thead><tr><th>보증 수준</th><th>설정 항목</th><th>설정 방법 및 설명</th></tr></thead><tbody><tr><td><strong>At-most-once</strong></td><td><code>acks=0</code></td><td>프로듀서가 메시지 전송 후 Ack 기다리지 않고 즉시 성공 처리 (손실 가능)</td></tr><tr><td></td><td><code>retries=0</code></td><td>재시도 없이 실패 시 메시지 손실 허용</td></tr><tr><td><strong>At-least-once</strong></td><td><code>acks=1</code> 또는 <code>acks=all</code></td><td>브로커가 수신 확인을 해야 전송 성공 처리 (<code>acks=all</code> 은 더 안정적)</td></tr><tr><td></td><td><code>enable.auto.commit=false</code></td><td>컨슈머가 명시적으로 오프셋 커밋 (처리 실패 시 재시도 가능)</td></tr><tr><td></td><td><code>retries > 0</code></td><td>메시지 전송 실패 시 자동 재시도</td></tr><tr><td><strong>Exactly-once</strong></td><td><code>enable.idempotence=true</code></td><td>동일 메시지 재전송 시 중복 방지</td></tr><tr><td></td><td><code>transactional.id</code></td><td>트랜잭션 기반으로 프로듀서 구성</td></tr><tr><td></td><td>컨슈머 측 <code>read_committed</code> 설정</td><td>커밋된 메시지만 읽도록 설정</td></tr></tbody></table><h5 id=rabbitmq---전달-보증-구현-방법>RabbitMQ - 전달 보증 구현 방법<a hidden class=anchor aria-hidden=true href=#rabbitmq---전달-보증-구현-방법>#</a></h5><table><thead><tr><th>보증 수준</th><th>설정 항목</th><th>설정 방법 및 설명</th></tr></thead><tbody><tr><td><strong>At-most-once</strong></td><td><code>auto-ack=true</code></td><td>컨슈머가 수신 즉시 Ack 전송 → 처리 실패 시 재시도 불가 (손실 허용)</td></tr><tr><td></td><td><code>durable=false</code>, <code>persistent=false</code></td><td>큐 및 메시지를 메모리 기반으로 유지</td></tr><tr><td><strong>At-least-once</strong></td><td><code>auto-ack=false</code></td><td>컨슈머가 처리 완료 후 수동 Ack 전송</td></tr><tr><td></td><td><code>durable=true</code>, <code>persistent=true</code></td><td>큐와 메시지를 디스크에 저장</td></tr><tr><td></td><td><code>prefetch > 0</code></td><td>QoS 제어로 병렬 처리 제어</td></tr><tr><td><strong>Exactly-once</strong></td><td>명시적 지원 없음 (RabbitMQ 자체 한계)</td><td>대신 <strong>중복 허용 후 Idempotent Consumer</strong> 로 구현 필요</td></tr><tr><td></td><td><code>message deduplication</code> 로직 수동 구현</td><td>메시지 ID 기반 중복 방지 (Redis/DB 활용 등)</td></tr></tbody></table><h4 id=메시징-아키텍처-성숙도-모델>메시징 아키텍처 성숙도 모델<a hidden class=anchor aria-hidden=true href=#메시징-아키텍처-성숙도-모델>#</a></h4><table><thead><tr><th>레벨</th><th>단계명</th><th>설명</th></tr></thead><tbody><tr><td>1</td><td><strong>기본 메시징</strong></td><td>단순한 Point-to-Point 메시징 구현직접적인 송신자 - 수신자 간 큐 연결</td></tr><tr><td>2</td><td><strong>이벤트 기반 메시징</strong></td><td>Pub/Sub 패턴 도입이벤트 중심 설계 (Event Storming) 적용토픽 기반 브로커 구조 사용</td></tr><tr><td>3</td><td><strong>반응형 시스템</strong></td><td>비동기 스트림 기반 처리 Backpressure, Resilience, Elasticity 등 반응형 시스템 원칙 적용</td></tr><tr><td>4</td><td><strong>지능형 메시징</strong></td><td>머신러닝/AI 기반 라우팅 및 처리 최적화실시간 라우팅 판단, 트래픽 예측, 적응형 QoS 적용</td></tr></tbody></table><h4 id=테스트-전략--qa>테스트 전략 & QA<a hidden class=anchor aria-hidden=true href=#테스트-전략--qa>#</a></h4><p><strong>멀티 레이어 테스트 전략</strong></p><ul><li><strong>유닛 테스트</strong>: 컨슈머/프로듀서 내 로직 단위 테스트 (mock broker 활용)</li><li><strong>컴포넌트/통합 테스트</strong>: 메시지 브로커와 실제 메시징 상호작용 테스트 (Testcontainers, in-memory broker)</li><li><strong>계약 테스트 (contract testing)</strong>: 프로듀서와 컨슈머 간 메시지 스키마 호환성 검증 (Pact, Spring Cloud Contract)</li><li><strong>E2E 테스트</strong>: 전체 메시지 워크플로우 시나리오 기반 검증 (Dogfood 브로커 또는 staging 환경)</li><li><strong>부하 및 성능 테스트</strong>: Gatling, k6 사용하여 큐 대기 시간/처리량 평가</li><li><strong>카오스 테스트</strong>: 장애 시 메시지 재처리, DLQ 전송 등 복원력 테스트 수행</li></ul><h5 id=테스트-코드-상세-및-모의-환경-설정>테스트 코드 상세 및 모의 환경 설정<a hidden class=anchor aria-hidden=true href=#테스트-코드-상세-및-모의-환경-설정>#</a></h5><p><strong>Java + Testcontainers 예시</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Testcontainers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>OrderServiceIntegrationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>static</span><span class=w> </span><span class=n>RabbitMQContainer</span><span class=w> </span><span class=n>rabbit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RabbitMQContainer</span><span class=p>(</span><span class=s>&#34;rabbitmq:3.11&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>withExchange</span><span class=p>(</span><span class=s>&#34;order.ex&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;fanout&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>withQueue</span><span class=p>(</span><span class=s>&#34;order.q&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>withBinding</span><span class=p>(</span><span class=s>&#34;order.ex&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;order.q&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// 바인딩 설정 :contentReference[oaicite:28]{index=28}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@BeforeAll</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setup</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* Spring 설정 조정 */</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>testOrderFlow</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// message publish → consumer logic → DB persistence 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>테스트 전략</strong>:</p><ul><li>컨테이너 기반 통합 테스트로 메시지 흐름 검증</li><li>JUnit5 + Spring Test 어노테이션 병행</li><li>DLQ/예외 흐름 테스트 포함</li></ul><h4 id=cicd-및-배포-전략>CI/CD 및 배포 전략<a hidden class=anchor aria-hidden=true href=#cicd-및-배포-전략>#</a></h4><p>CI/CD 파이프라인 설계 시, 메시지 기반 시스템의 비동기 특성을 고려해야 한다.</p><ul><li><strong>서비스별 파이프라인 분리</strong>: Build, 테스트 (E2E 포함), 릴리즈 각각 독립 구성</li><li><strong>이벤트 계약/스키마 관리</strong>: Schema Registry, AsyncAPI 문서화를 통한 호환성 확보</li><li><strong>이벤트 흐름 테스트</strong>: 시뮬레이터로 이벤트 퍼블리싱 및 소비 검증</li><li><strong>배포 방식</strong>: Canary/Blu​e‑Green 배포로 메시지 인증 테스트 후 점진적 서비스 이동</li><li><strong>모니터링 통합</strong>: 큐/토픽 깊이, 처리 지연, 에러 모니터링을 파이프라인에 포함</li><li><strong>롤백 지원</strong>: 메시지 흐름 중단 대비 배포 롤백 전략 수립</li><li><strong>보안 및 암호화</strong>: 메시지 사용자 인증 및 브로커 접근 정책 적용</li></ul><h5 id=cicd-사용-시나리오-예제>CI/CD 사용 시나리오 예제<a hidden class=anchor aria-hidden=true href=#cicd-사용-시나리오-예제>#</a></h5><table><thead><tr><th>단계</th><th>항목</th><th>CI/CD 구성 요소</th></tr></thead><tbody><tr><td>1</td><td>PR 생성</td><td>AsyncAPI 문서 + 코드 변경</td></tr><tr><td>2</td><td>컨트랙트 테스트</td><td>Pact, Specmatic 등</td></tr><tr><td>3</td><td>인프라 프로비저닝</td><td>Helm + ArgoCD 로 브로커 토픽 자동 생성</td></tr><tr><td>4</td><td>유닛/통합/E2E 테스트</td><td>Testcontainers 환경 실행</td></tr><tr><td>5</td><td>Canary 배포</td><td>메시지 흐름 검증 후 점진적 서비스 전환</td></tr><tr><td>6</td><td>모니터링</td><td>Prometheus, Grafana → 큐 지표, DLQ 알림</td></tr><tr><td>7</td><td>배포 롤백</td><td>오류 시 즉시 롤백 트리거 (GitOps 리포지토리 리버트 방식 적용)</td></tr></tbody></table><h4 id=배포-구성--운영-검증>배포 구성 & 운영 검증<a hidden class=anchor aria-hidden=true href=#배포-구성--운영-검증>#</a></h4><ul><li><strong>인프라 구성</strong>: Docker/Kubernetes 기반 메시지 브로커 클러스터 구성 (stateful sets, Helm chart 활용)</li><li><strong>버전 관리 시스템</strong>: 모든 메시지 핸들러/스크립트 GitOps 관리</li><li><strong>배포 자동화</strong>: Helm/Argo CD/Tekton 활용한 Git 기반 자동 배포</li><li><strong>성능 모니터링</strong>: Prometheus 수집 + Grafana 알림 설정 (대기 메시지 수, 처리 지연, DLQ 비율 등)</li><li><strong>분산 트레이싱</strong>: OpenTelemetry + Jaeger/x‑ray 통합으로 메시지 흐름 end‑to‑end 가시화</li><li><strong>DLQ 관리</strong>: 실패 메시지 자동 재처리 및 분석 워크플로우 설계</li><li><strong>보안</strong>: mTLS, OAuth2 또는 메시지 수준 암호화 적용 환경 구성</li></ul><h4 id=운영-모니터링-및-대응-전략>운영 모니터링 및 대응 전략<a hidden class=anchor aria-hidden=true href=#운영-모니터링-및-대응-전략>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>추천 도구/구성</th><th>주요 대응 시나리오</th></tr></thead><tbody><tr><td><strong>지표 (Metrics)</strong></td><td>큐 깊이 & 대기 시간</td><td>큐 적체 및 지연 발생 여부 모니터링</td><td>Prometheus + Grafana</td><td>큐 급증 시 컨슈머 자동 확장, QoS 조정</td></tr><tr><td></td><td>메시지 처리 속도</td><td>초당 처리량, 소비 지연 분석</td><td>Prometheus + Grafana</td><td>처리량 저하 시 컨슈머 리소스 점검, 배치 사이즈 조정 등</td></tr><tr><td></td><td>DLQ 비율</td><td>Dead Letter Queue 로 유입된 메시지 비율</td><td>Grafana Alert, DLQ 전용 대시보드 구성</td><td>DLQ 급증 시 메시지 패턴 변화 확인, 소비 로직 재검토</td></tr><tr><td></td><td>재시도/실패 로그 비율</td><td>Ack 실패, Retry 횟수 비율</td><td>ELK/EFK Stack, Fluent Bit, Loki</td><td>재시도 과다 시 네트워크 상태 점검, 소비자 로직 성능 개선</td></tr><tr><td></td><td>리소스 사용률</td><td>브로커 및 컨슈머의 CPU/Memory/Network I/O 사용량</td><td>Node Exporter, cAdvisor, Prometheus</td><td>리소스 한계 시 자동 스케일링, 리소스 분리, 워커 분산</td></tr><tr><td><strong>트레이싱</strong></td><td>메시지 흐름 추적</td><td>end-to-end 흐름 분석, 상관관계 파악</td><td>OpenTelemetry + Jaeger</td><td>병목 위치 식별, 순서 역전 원인 분석, 트랜잭션 지연 추적</td></tr><tr><td><strong>로깅</strong></td><td>메시지 수준 로그</td><td>메시지 처리 단계별 상세 기록</td><td>ELK Stack (Elasticsearch, Logstash, Kibana), Loki</td><td>오류 메시지 상세 분석, 재처리 기준 도출, 보안 로그 분석</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>세부 항목</th><th>주요 고려사항</th><th>권장 실행 방안</th></tr></thead><tbody><tr><td><strong>성능 최적화</strong></td><td>메시지 배치 처리</td><td>작은 메시지 전송의 오버헤드 감소, 처리량 증가</td><td>적절한 배치 크기 설정, 프로듀서 버퍼링, 컨슈머 batch fetch 활용</td></tr><tr><td></td><td>메시지 압축</td><td>네트워크 및 디스크 사용량 절감</td><td>Gzip, Snappy, LZ4 압축 사용, 메시지 크기 기반 자동 압축</td></tr><tr><td></td><td>직렬화 포맷 최적화</td><td>JSON 등 텍스트 포맷의 처리 비용 문제</td><td>Avro, Protobuf 등 바이너리 포맷 적용</td></tr><tr><td></td><td>비동기 I/O 처리</td><td>블로킹 I/O 로 인한 처리량 한계</td><td>async/await, 비동기 컨슈머 구성</td></tr><tr><td></td><td>커넥션 풀링</td><td>연결 생성/해제 오버헤드 절감</td><td>재사용 가능한 커넥션 풀 및 keep-alive 설정</td></tr><tr><td></td><td>Hot Partition 방지</td><td>특정 키에 메시지가 몰려 병목 발생</td><td>파티션 키 분산 전략, 라운드로빈 키 분배</td></tr><tr><td></td><td>멀티 워커 병렬 처리</td><td>단일 컨슈머의 처리 병목 해소</td><td>컨슈머 풀 구성 및 동시성 제어 적용</td></tr><tr><td><strong>리소스 최적화</strong></td><td>메시지 버퍼링 및 백프레셔</td><td>메모리 사용량 제한 및 느린 소비자 제어</td><td>prefetch 제한, Adaptive Flow Control</td></tr><tr><td></td><td>메타데이터/헤더 최적화</td><td>메시지 크기 줄이기 위한 불필요한 헤더 제거</td><td>필수 필드만 유지, 바이너리 헤더 사용</td></tr><tr><td></td><td>저장소 압축 및 분산</td><td>브로커의 디스크 압력 완화 및 메시지 관리</td><td>Tiered Storage, 아카이빙, TTL 정책</td></tr><tr><td></td><td>가비지 컬렉션 튜닝</td><td>GC Pause 시간 감소, 고성능 유지</td><td>오프힙 메모리 활용, G1/세대별 GC 설정</td></tr><tr><td><strong>확장성 최적화</strong></td><td>파티션 수 설계</td><td>병렬성 증가 및 트래픽 처리 분산</td><td>트래픽 예측 기반 파티션 수 설정 및 주기적 재조정</td></tr><tr><td></td><td>오토스케일링</td><td>트래픽 급증 시 자동 대응</td><td>Kubernetes HPA, Prometheus 기반 메트릭 스케일링</td></tr><tr><td></td><td>샤딩 및 멀티 테넌시</td><td>다중 사용자 환경 분리 및 리소스 효율 사용</td><td>Namespace 기반 분리, 범위 기반 샤딩</td></tr><tr><td>** 안정성 및 장애 회복**</td><td>멱등성 보장</td><td>메시지 중복으로 인한 로직 중복 방지</td><td>메시지 ID 기반 중복 제거, Redis 캐시 활용</td></tr><tr><td></td><td>DLQ 및 재처리 정책</td><td>실패 메시지 격리, 루프 방지</td><td>최대 재시도 횟수, Circuit Breaker, DLQ 격리 후 분석</td></tr><tr><td></td><td>연결 재시도 및 장애 감지</td><td>브로커 장애 시 자동 복구 설계</td><td>Retry with backoff, 재연결 로직, 장애 이벤트 알림</td></tr><tr><td></td><td>메시지 순서 보장</td><td>병렬 처리 시 순서 불일치 이슈</td><td>FIFO 큐, 파티션 키 고정, 순서 기반 consumer logic</td></tr><tr><td>** 운영 및 관측 최적화**</td><td>메트릭/로그 집계</td><td>관측성 확보 및 오버헤드 최소화</td><td>지연 집계, 샘플링, 구조화 로그 (JSON) 적용</td></tr><tr><td></td><td>분산 트레이싱 설정</td><td>메시지 흐름 추적 및 병목 지점 식별</td><td>OpenTelemetry, Correlation ID 삽입</td></tr><tr><td></td><td>성능 테스트 및 검증</td><td>병목 조기 식별 및 SLA 확인</td><td>Gatling, k6 등 시나리오 기반 부하 테스트 수행</td></tr><tr><td></td><td>알림 최적화</td><td>노이즈 감소, 중요한 이벤트에 집중</td><td>이상 탐지 ML 도입, 지능형 알람 룰 정의</td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>주제</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>아키텍처 특성</strong></td><td>메시지 기반 아키텍처</td><td>비동기성</td><td>메시지 전송과 처리의 시간적 분리로 비동기 통신 지원</td></tr><tr><td></td><td></td><td>확장성</td><td>소비자 추가/변경 용이, 수평적 확장 지원</td></tr><tr><td></td><td></td><td>장애 격리</td><td>큐/브로커 기반으로 장애 전파 최소화</td></tr><tr><td><strong>실시간 처리</strong></td><td>메시지 기반 아키텍처</td><td>실시간성</td><td>대량 트래픽 처리, 실시간 데이터 파이프라인 구현</td></tr><tr><td></td><td>성능 최적화</td><td>제로 카피</td><td>Kafka Zero-Copy 등 메모리 복사 없이 성능 최적화</td></tr><tr><td></td><td></td><td>백프레셔 제어</td><td>Reactive Streams 기반 흐름 제어</td></tr><tr><td><strong>분산 시스템</strong></td><td>메시지 기반 아키텍처</td><td>장애 격리 (재분류)</td><td>브로커 단위 장애 격리, 복원 탄력성 확보</td></tr><tr><td><strong>패턴</strong></td><td>명령/조회 분리</td><td>CQRS / Event Sourcing</td><td>읽기/쓰기 분리, 이벤트 기반 상태 관리</td></tr><tr><td></td><td>분산 트랜잭션</td><td>Saga / 2PC</td><td>분산 환경 일관성 유지 및 보상 트랜잭션 지원</td></tr><tr><td></td><td>메시지 전달 방식</td><td>Pub/Sub / Queue / Topic</td><td>발행 - 구독, 대기 큐, 토픽 단위 라우팅</td></tr><tr><td><strong>툴 & 플랫폼</strong></td><td>메시지 브로커</td><td>RabbitMQ / Kafka / Pulsar</td><td>RabbitMQ: 라우팅 우수, Kafka: 확장성 및 내구성, Pulsar: 테넌시·지리 분산 지원</td></tr><tr><td></td><td>스트림 처리</td><td>Kafka Streams / Pulsar IO</td><td>실시간 처리, 이벤트 변환, 복잡한 스트림 처리</td></tr><tr><td></td><td>서버리스 메시징</td><td>AWS EventBridge / Azure Event Grid</td><td>운영 부담 최소, 이벤트 라우팅 관리형 서비스</td></tr><tr><td></td><td>엣지 컴퓨팅 메시징</td><td>MQTT / LoRaWAN</td><td>IoT 환경서 저지연 메시징 지원</td></tr><tr><td></td><td>스키마 관리</td><td>Confluent Schema Registry</td><td>메시지 스키마 버전 관리 및 호환성 보장</td></tr><tr><td></td><td>플로우 시각화</td><td>Kafka Manager / RabbitMQ Management</td><td>메시지 흐름 모니터링 및 운영 도구</td></tr><tr><td></td><td>테스트</td><td>Testcontainers / Pact</td><td>컨테이너 기반 통합 테스트 및 계약 테스트</td></tr><tr><td><strong>표준 & 문서화</strong></td><td>이벤트 표준</td><td>CloudEvents / AsyncAPI</td><td>이벤트 형식과 비동기 API 문서화 기준 충족</td></tr><tr><td></td><td>프로토콜</td><td>MQTT 5.0</td><td>IoT 메시징 위한 최신 기능 및 확장성 제공</td></tr><tr><td><strong>보안</strong></td><td>보안 기술</td><td>TLS / mTLS / JWT / 메시지 레벨 암호화</td><td>전송 및 저장 중 데이터 보호, 인증 및 인가 체계 구축</td></tr><tr><td></td><td>제로 트러스트</td><td>Zero Trust Messaging</td><td>메시지 기반 보안 모델 적용</td></tr><tr><td><strong>운영 및 관찰성</strong></td><td>카오스 엔지니어링</td><td>Chaos Monkey / Gremlin</td><td>메시지 시스템 복원력 테스트</td></tr><tr><td></td><td>분산 추적</td><td>Jaeger / Zipkin</td><td>메시지 요청 및 지연 추적 가능</td></tr><tr><td></td><td>메트릭 수집</td><td>Prometheus / Micrometer</td><td>성능 지표 수집 및 모니터링 지원</td></tr></tbody></table><ul><li><strong>아키텍처 특성</strong>: 비동기성, 확장성, 장애 격리는 모든 메시지 시스템의 핵심 가치.</li><li><strong>성능 최적화</strong>: Zero‑copy, 백프레셔와 같은 기술은 사용자 경험과 안정성 향상을 위해 필수.</li><li><strong>패턴</strong>: CQRS, Saga, Pub/Sub 등은 이미 현업에서 검증된 아키텍처 패턴.</li><li><strong>툴 & 플랫폼</strong>: RabbitMQ, Kafka, Pulsar 외에도 서버리스와 IoT 메시징 스택을 포함.</li><li><strong>표준 & 문서화</strong>: CloudEvents 와 AsyncAPI 는 업계 표준으로 자리잡고 있다.</li><li><strong>보안 및 운영</strong>: 메시지 암호화, 인증, 카오스 테스트 및 추적 기능은 실제 적용에 필수.</li></ul><h3 id=반드시-학습해야할-내용들>반드시 학습해야할 내용들<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용들>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>주제</strong></th><th><strong>핵심 항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 이론 및 기본 개념</strong></td><td>분산 시스템 기초</td><td>CAP 정리, ACID vs BASE</td><td>분산 환경에서의 일관성, 가용성, 트랜잭션 전략 이해</td></tr><tr><td></td><td>동시성 이론</td><td>Actor Model, CSP</td><td>메시지 기반 병행 모델 및 메시지 순서 보장 개념</td></tr><tr><td></td><td>큐잉 이론</td><td>Little&rsquo;s Law, 대기열 모델</td><td>메시지 처리량, 대기 시간 분석 기초</td></tr><tr><td><strong>2. 아키텍처 원리</strong></td><td>Message-Driven Architecture</td><td>메시지, 비동기 통신, Producer/Consumer, 브로커 구조</td><td>메시지 중심 시스템의 핵심 구성 원리</td></tr><tr><td></td><td>비동기 통신 패턴</td><td>Pub/Sub, Point-to-Point, Request-Reply</td><td>시스템 디커플링 및 확장성 기반 통신 패턴</td></tr><tr><td></td><td>CQRS + Event Sourcing</td><td>명령/조회 분리, 상태 변화를 이벤트로 저장</td><td>읽기/쓰기 분리와 상태 복원성 확보 패턴</td></tr><tr><td><strong>3. 핵심 설계 패턴</strong></td><td>사가 패턴</td><td>Orchestration vs Choreography</td><td>보상 기반 분산 트랜잭션 관리 방식</td></tr><tr><td></td><td>EIP (Enterprise Integration Patterns)</td><td>메시지 라우팅, 필터링, 집계 등 통합 설계 패턴</td><td>실무에 검증된 65 가지 메시징 패턴의 적용</td></tr><tr><td></td><td>Exactly-Once Semantics</td><td>Idempotency, Transactional Producer</td><td>중복 없이 정확한 메시지 처리 보장 기법</td></tr><tr><td><strong>4. 메시지 브로커 기술</strong></td><td>Apache Kafka</td><td>Topic, Partition, Consumer Group, Offset</td><td>고성능 분산 스트리밍 메시지 플랫폼</td></tr><tr><td></td><td>RabbitMQ</td><td>Exchange, Queue, Binding, Routing Key</td><td>유연한 라우팅을 지원하는 메시지 브로커</td></tr><tr><td></td><td>Apache Pulsar</td><td>Multi-tenancy, Geo-replication</td><td>차세대 브로커로 고급 기능 제공 (Kafka + MQ 특성)</td></tr><tr><td><strong>5. 프로토콜 및 데이터 포맷</strong></td><td>메시징 프로토콜</td><td>AMQP, MQTT, STOMP</td><td>메시지 전송 표준 프로토콜 비교 및 선택 기준</td></tr><tr><td></td><td>데이터 직렬화 포맷</td><td>Apache Avro, Protocol Buffers, Apache Thrift</td><td>스키마 기반 데이터 구조화 및 경량 전송 형식</td></tr><tr><td></td><td>스키마 관리</td><td>Schema Registry</td><td>메시지 스키마의 버전 관리 및 유효성 검증</td></tr><tr><td><strong>6. 스트림 처리</strong></td><td>Kafka Streams</td><td>윈도우 함수, 상태 저장 Store, Join</td><td>Kafka 기반의 스트림 컴퓨팅</td></tr><tr><td></td><td>Apache Flink</td><td>이벤트 시간 처리, 워터마크, 복합 이벤트 처리</td><td>이벤트 기반 스트림 처리 프레임워크</td></tr><tr><td></td><td>Apache Storm</td><td>Spout, Bolt, Topology 구조</td><td>실시간 데이터 흐름 처리의 초기 프레임워크</td></tr><tr><td><strong>7. 운영 및 관측성</strong></td><td>분산 추적 및 상관관계 ID</td><td>OpenTelemetry, Correlation ID</td><td>메시지 흐름 추적 및 장애 분석 기반</td></tr><tr><td></td><td>메트릭/로그 수집 시스템</td><td>Prometheus, ELK Stack, Fluentd</td><td>운영 상태 실시간 확인 및 로깅 기반 복구 전략</td></tr><tr><td></td><td>통합 테스트</td><td>Testcontainers, LocalStack</td><td>실제 브로커를 활용한 메시징 E2E 테스트 자동화</td></tr><tr><td><strong>8. 보안 및 배포 자동화</strong></td><td>메시지 보안</td><td>TLS, 암호화, JWT, OAuth 2.0</td><td>데이터 전송 시 암호화, 인증/인가 구성</td></tr><tr><td></td><td>인프라 자동화</td><td>Docker, Kubernetes, Terraform, Ansible</td><td>브로커 및 관련 컴포넌트 자동화 배포 환경</td></tr><tr><td></td><td>CI/CD 파이프라인</td><td>Jenkins, GitHub Actions, GitLab CI</td><td>메시지 기반 시스템의 지속적 통합 및 배포 구현</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><h3 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>메시징 개념</td><td>Message Broker</td><td>메시지를 송수신 사이에서 중재·라우팅·보관하는 컴포넌트</td></tr><tr><td></td><td>Message Queue</td><td>FIFO 기반의 메시지 저장 구조, 대기 중인 메시지들을 보관</td></tr><tr><td></td><td>Topic</td><td>발행/구독 메시지를 구분하기 위한 논리적 채널</td></tr><tr><td></td><td>Partition</td><td>토픽을 분할하여 병렬 처리와 확장성을 높이기 위한 단위</td></tr><tr><td></td><td>Offset</td><td>파티션 내 메시지의 고유 순서 인덱스</td></tr></tbody></table><h3 id=구성-요소-및-역할>구성 요소 및 역할<a hidden class=anchor aria-hidden=true href=#구성-요소-및-역할>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>구성요소</td><td>Producer</td><td>메시지를 생성하고 브로커에 전송하는 발신자</td></tr><tr><td></td><td>Consumer</td><td>브로커로부터 메시지를 수신·처리하는 수신자</td></tr><tr><td></td><td>Consumer Group</td><td>하나의 토픽을 병렬로 처리하기 위한 소비자 집합</td></tr><tr><td></td><td>DLQ (Dead Letter Queue)</td><td>처리 실패한 메시지를 저장하여 후속 처리 가능하게 하는 큐</td></tr></tbody></table><h3 id=통신-패턴>통신 패턴<a hidden class=anchor aria-hidden=true href=#통신-패턴>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>메시징 패턴</td><td>Point-to-Point</td><td>하나의 Producer 가 하나의 Consumer 에게 메시지를 전달</td></tr><tr><td></td><td>Publish-Subscribe</td><td>하나의 Producer 가 여러 Consumer 에게 메시지를 브로드캐스트</td></tr><tr><td></td><td>Request-Reply</td><td>요청 - 응답 메시지를 교환하는 동기/비동기 패턴</td></tr><tr><td>이벤트 기반 아키텍처</td><td>Message-Driven Architecture</td><td>비동기 메시지 교환을 중심으로 구성된 시스템 아키텍처</td></tr></tbody></table><h3 id=메시지-타입-및-처리-전략>메시지 타입 및 처리 전략<a hidden class=anchor aria-hidden=true href=#메시지-타입-및-처리-전략>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>메시지 유형</td><td>Command Message</td><td>실행 명령을 담고 있는 메시지 (예: " 주문 생성 &ldquo;)</td></tr><tr><td></td><td>Event Message</td><td>상태 변화나 이벤트 발생을 알리는 메시지 (예: " 배송 완료 &ldquo;)</td></tr><tr><td></td><td>Document Message</td><td>데이터 자체를 전달하는 메시지 (예: JSON, XML)</td></tr><tr><td>처리 전략</td><td>Batching</td><td>다수의 메시지를 묶어 한 번에 처리하여 효율 증대</td></tr><tr><td></td><td>Compression</td><td>메시지를 압축하여 저장/전송 비용 절감</td></tr><tr><td></td><td>Tiered Storage</td><td>메시지를 저장하는 계층적 스토리지 전략 (핫/콜드)</td></tr></tbody></table><h3 id=메시지-전달-보장-수준-delivery-semantics>메시지 전달 보장 수준 (Delivery Semantics)<a hidden class=anchor aria-hidden=true href=#메시지-전달-보장-수준-delivery-semantics>#</a></h3><table><thead><tr><th><strong>보장 수준</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>At-Most-Once</td><td>메시지를 최대 한 번만 전송 (손실 가능성 있음, 중복 없음)</td></tr><tr><td>At-Least-Once</td><td>최소 한 번은 전달되도록 보장 (중복 가능, 손실 없음)</td></tr><tr><td>Exactly-Once</td><td>정확히 한 번만 전달됨을 보장 (중복/손실 모두 없음)</td></tr><tr><td>Idempotency</td><td>같은 메시지를 여러 번 처리해도 결과가 동일함을 보장하는 특성</td></tr></tbody></table><h3 id=트랜잭션-및-이벤트-패턴>트랜잭션 및 이벤트 패턴<a hidden class=anchor aria-hidden=true href=#트랜잭션-및-이벤트-패턴>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>분산 트랜잭션</td><td>Saga Pattern</td><td>여러 로컬 트랜잭션을 순차적으로 실행하고 실패 시 보상 트랜잭션 실행</td></tr><tr><td></td><td>2PC (Two-Phase Commit)</td><td>분산 시스템 간 원자성 보장을 위한 2 단계 트랜잭션 커밋 프로토콜</td></tr><tr><td>이벤트 처리 패턴</td><td>Event Sourcing</td><td>시스템 상태를 이벤트 시퀀스로 저장하여 복원/재구성 가능하게 하는 방식</td></tr><tr><td></td><td>CQRS</td><td>명령 (Command) 과 조회 (Query) 모델을 분리하는 설계 패턴</td></tr></tbody></table><h3 id=운영-및-품질-특성>운영 및 품질 특성<a hidden class=anchor aria-hidden=true href=#운영-및-품질-특성>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>운영</td><td>Backpressure</td><td>처리 지연 시 메시지 유입 속도를 제어하는 메커니즘</td></tr><tr><td></td><td>Consumer Lag</td><td>컨슈머가 처리하지 못한 대기 메시지 수량</td></tr><tr><td></td><td>Acknowledgment (ACK)</td><td>컨슈머가 메시지를 정상 처리했음을 브로커에 알리는 신호</td></tr><tr><td>관측성</td><td>Correlation ID</td><td>분산 트레이싱에서 메시지 간 연관성을 추적하기 위한 고유 식별자</td></tr><tr><td>내구성 특성</td><td>Durability</td><td>시스템 장애 발생 시에도 메시지를 안전하게 보관하는 특성</td></tr><tr><td>확장성 특성</td><td>Scalability</td><td>시스템이 부하 증가에 유연하게 대응할 수 있는 능력</td></tr></tbody></table><h3 id=메시징-기술-및-표준-도구>메시징 기술 및 표준 도구<a hidden class=anchor aria-hidden=true href=#메시징-기술-및-표준-도구>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>프로토콜</td><td>AMQP, MQTT</td><td>메시지 브로커와 통신하기 위한 표준 프로토콜</td></tr><tr><td>스키마 관리</td><td>Schema Registry</td><td>메시지 포맷의 버전 관리 및 유효성 검사 제공</td></tr><tr><td>문서화 도구</td><td>AsyncAPI</td><td>이벤트 기반 메시지 인터페이스 문서화 도구</td></tr><tr><td>브로커 예시</td><td>Apache Kafka</td><td>분산 스트리밍 메시지 플랫폼 (대용량, 고내구성)</td></tr><tr><td></td><td>RabbitMQ</td><td>경량화된 AMQP 기반 메시지 브로커 (빠른 처리, 유연한 라우팅)</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://kafka.apache.org/documentation/>Apache Kafka Documentation</a></li><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ Official Guide</a></li><li><a href=https://www.reactivemanifesto.org/>Reactive Manifesto</a></li><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Martin Fowler – Event Sourcing</a></li><li><a href=https://microservices.io/patterns/data/saga.html>Microservices.io – Saga Pattern</a></li><li><a href=https://cloudevents.io/>CloudEvents Specification</a></li><li><a href=https://www.asyncapi.com/>AsyncAPI Specification</a></li><li><a href=https://www.enterpriseintegrationpatterns.com/>Enterprise Integration Patterns</a></li><li><a href=https://www.oreilly.com/library/view/building-event-driven-microservices/9781492057888/>Building Event-Driven Microservices – O&rsquo;Reilly</a></li><li><a href=https://dataintensive.net/>Designing Data‑Intensive Applications – Martin Kleppmann</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>