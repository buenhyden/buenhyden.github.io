<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Messaging-Oriented Architecture | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Styles,Messaging-Oriented-Styles,Asynchronous-Communication"><meta name=description content="Messaging-Oriented Styles 는 메시지 기반 통신을 중심으로 하는 소프트웨어 아키텍처 스타일로, 분산 시스템에서 컴포넌트 간 비동기 통신과 느슨한 결합을 실현한다. Message-Oriented Middleware (MOM) 를 통해 구현되며, Publish-Subscribe, Request-Reply, Point-to-Point 등의 패턴을 포함하여 확장 가능하고 신뢰성 있는 엔터프라이즈 통합 솔루션을 제공한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Messaging-Oriented Architecture"><meta property="og:description" content="Messaging-Oriented Styles 는 메시지 기반 통신을 중심으로 하는 소프트웨어 아키텍처 스타일로, 분산 시스템에서 컴포넌트 간 비동기 통신과 느슨한 결합을 실현한다. Message-Oriented Middleware (MOM) 를 통해 구현되며, Publish-Subscribe, Request-Reply, Point-to-Point 등의 패턴을 포함하여 확장 가능하고 신뢰성 있는 엔터프라이즈 통합 솔루션을 제공한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Messaging-Oriented Architecture"><meta name=twitter:description content="Messaging-Oriented Styles 는 메시지 기반 통신을 중심으로 하는 소프트웨어 아키텍처 스타일로, 분산 시스템에서 컴포넌트 간 비동기 통신과 느슨한 결합을 실현한다. Message-Oriented Middleware (MOM) 를 통해 구현되며, Publish-Subscribe, Request-Reply, Point-to-Point 등의 패턴을 포함하여 확장 가능하고 신뢰성 있는 엔터프라이즈 통합 솔루션을 제공한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Messaging-Oriented Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Messaging-Oriented Architecture</h1><div class=post-description>Messaging-Oriented Styles 는 메시지 기반 통신을 중심으로 하는 소프트웨어 아키텍처 스타일로, 분산 시스템에서 컴포넌트 간 비동기 통신과 느슨한 결합을 실현한다. Message-Oriented Middleware (MOM) 를 통해 구현되며, Publish-Subscribe, Request-Reply, Point-to-Point 등의 패턴을 포함하여 확장 가능하고 신뢰성 있는 엔터프라이즈 통합 솔루션을 제공한다.</div></header><div class=post-content><h2 id=messaging-oriented-architecture>Messaging-Oriented Architecture<a hidden class=anchor aria-hidden=true href=#messaging-oriented-architecture>#</a></h2><p>Messaging‑Oriented Styles 는 메시지를 기반으로 서비스 간 통합 설계를 수행하는 아키텍처 패턴 그룹이다. 핵심 요소로는 프로듀서, 브로커, 큐/토픽, 컨슈머이며, 메시지 라우팅, 변환, 스키마, 에러 처리, 보안, 트랜잭션 등이 핵심 역할을 수행한다. 주요 모델인 Point‑to‑Point 및 Publish‑Subscribe 를 통해 다양한 통신 시나리오를 처리하며, RabbitMQ, Kafka, ActiveMQ, MQTT 등으로 구현된다. 이 스타일은 분산 환경에서 확장성, 유연성, 안정성을 보장하는 통합 설계의 핵심이다.</p><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Messaging-Oriented Styles 는 분산 컴퓨팅의 발전과 함께 등장한 아키텍처 스타일이다.</p><p><strong>역사적 배경</strong></p><ul><li>1960 년대 메인프레임 시대의 메시지 교환 시스템에서 시작</li><li>1980 년대 네트워크 컴퓨팅 확산과 함께 발전</li><li>1990 년대 인터넷과 웹의 등장으로 표준화 가속</li></ul><p><strong>기술적 배경</strong></p><ul><li>동기식 RPC (Remote Procedure Call) 의 한계 극복 필요<ul><li>네트워크 지연과 장애에 취약</li><li>시스템 간 강한 결합으로 인한 유연성 부족</li><li>확장성 제약</li></ul></li><li>분산 시스템의 복잡성 증가에 따른 새로운 통합 방식 요구<ul><li>서로 다른 플랫폼, 프로그래밍 언어, 프로토콜 간 통합 복잡성</li><li>데이터 포맷 불일치 문제</li></ul></li><li>비즈니스 프로세스의 유연성과 적응성 요구 증대</li></ul><p><strong>비즈니스 배경</strong></p><ul><li>글로벌화에 따른 시스템 간 통합 필요성 증대</li><li>실시간 데이터 처리와 이벤트 기반 비즈니스 프로세스 확산</li><li>클라우드 컴퓨팅과 마이크로서비스 아키텍처의 보편화</li></ul><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><h4 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h4><p><strong>분산 시스템 통합</strong></p><ul><li>이기종 시스템 간 원활한 데이터 교환</li><li>플랫폼과 언어에 독립적인 통신 제공</li><li>엔터프라이즈 애플리케이션 통합 (EAI) 실현</li></ul><p><strong>시스템 유연성 향상</strong></p><ul><li>컴포넌트의 독립적인 개발과 배포</li><li>비즈니스 요구사항 변화에 대한 신속한 대응</li><li>점진적 시스템 현대화 지원</li></ul><p><strong>성능 및 확장성 개선</strong></p><ul><li>비동기 처리를 통한 응답 시간 단축</li><li>메시지 큐를 통한 트래픽 부하 분산</li><li>수평적 확장을 통한 처리 용량 증대</li></ul><h4 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h4><p><strong>기술적 필요성</strong></p><ul><li>분산 환경에서의 안정적인 통신 보장</li><li>네트워크 장애와 시스템 오류에 대한 복원력 제공</li><li>대용량 데이터 처리와 실시간 이벤트 스트리밍 지원</li></ul><p><strong>비즈니스 필요성</strong></p><ul><li>디지털 전환 (Digital Transformation) 추진</li><li>고객 경험 개선을 위한 실시간 서비스 제공</li><li>운영 효율성과 비용 절감 달성</li></ul><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p><strong>Message-Oriented Architecture (MOA) 메시지 지향 아키텍처</strong>는 분산 시스템에서 컴포넌트 간 통신을 메시지 교환을 통해 수행하는 아키텍처 패턴이다.</p><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><p><strong>메시지 (Message)</strong></p><ul><li>시스템 간 정보 교환의 기본 단위</li><li>헤더, 속성, 페이로드로 구성</li><li>비즈니스 데이터나 이벤트 정보를 포함</li></ul><p><strong>메시지 기반 통신 (Message-Based Communication)</strong></p><ul><li>분산 시스템에서 컴포넌트 간 데이터 교환을 위한 기본 메커니즘</li><li>메시지는 독립적인 데이터 단위로 송신자, 수신자, 내용 정보를 포함</li><li>네트워크를 통한 안전하고 신뢰성 있는 정보 전달을 보장</li></ul><p><strong>비동기 메시징 (Asynchronous Messaging)</strong></p><ul><li>송신자와 수신자가 동시에 활성화될 필요가 없는 통신 방식</li><li>메시지 큐를 통한 임시 저장으로 시스템 간 독립성 보장</li><li>응답 대기 없이 연속적인 작업 처리 가능</li></ul><p><strong>느슨한 결합 (Loose Coupling)</strong></p><ul><li>시스템 컴포넌트 간 직접적인 의존성을 최소화</li><li>위치, 시간, 인터페이스 투명성 제공</li><li>독립적인 개발, 배포, 확장 지원</li></ul><h4 id=고급-개념>고급 개념<a hidden class=anchor aria-hidden=true href=#고급-개념>#</a></h4><p><strong>Message-Oriented Middleware (MOM)</strong></p><ul><li>분산 애플리케이션 간 메시지 송수신을 지원하는 소프트웨어 인프라</li><li>플랫폼 독립적인 통신 계층 제공</li><li>메시지 라우팅, 변환, 보안, 관리 기능 통합</li></ul><p><strong>Enterprise Integration Patterns</strong></p><ul><li>메시징 기반 통합 솔루션의 검증된 설계 패턴 집합</li><li>65 개 이상의 통합 패턴으로 구성된 패턴 언어</li><li>Channel, Message Construction, Routing, Transformation, Endpoint 패턴 포함</li></ul><p><strong>실무에서 구현 시 연관성</strong></p><ul><li><strong>확장성:</strong> 컴포넌트별 독립적 확장 가능.</li><li><strong>실시간 처리:</strong> 메시지 발생 즉시 처리 및 전파.</li><li><strong>결함 허용성:</strong> 메시지 브로커가 메시지를 버퍼링하여 장애 시 복구 지원.</li><li><strong>통합:</strong> 다양한 언어, 시스템, 프로토콜 간 통합 용이.</li><li><strong>유지보수:</strong> 디커플링으로 인해 변경 및 유지보수 용이.</li></ul><h4 id=실무-구현을-위한-연관성>실무 구현을 위한 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현을-위한-연관성>#</a></h4><p><strong>시스템 확장성 (Scalability) 측면</strong></p><ul><li>메시지 큐의 수평적 확장을 통한 처리량 증대</li><li>로드 밸런싱과 클러스터링 지원</li><li>클라우드 네이티브 환경에서의 자동 스케일링</li></ul><p><strong>신뢰성 (Reliability) 측면</strong></p><ul><li>메시지 지속성과 트랜잭션 지원</li><li>장애 복구와 메시지 재전송 메커니즘</li><li>Dead Letter Queue 를 통한 오류 처리</li></ul><p><strong>상호 운용성 (Interoperability) 측면</strong></p><ul><li>다양한 플랫폼과 프로토콜 지원</li><li>표준 기반 메시지 포맷 (XML, JSON, SOAP)</li><li>레거시 시스템과의 통합 용이성</li></ul><h4 id=실무-구현을-위한-연관-요소들>실무 구현을 위한 연관 요소들<a hidden class=anchor aria-hidden=true href=#실무-구현을-위한-연관-요소들>#</a></h4><p><strong>메시징 패턴 구현</strong>: Point-to-Point, Publish-Subscribe, Request-Reply 패턴을 통한 다양한 통신 방식 지원으로 비즈니스 요구사항에 맞는 통신 구조 설계</p><p><strong>메시지 브로커 선택</strong>: Apache Kafka, RabbitMQ, ActiveMQ 등 기술 스택에 적합한 메시지 브로커 선택을 통한 성능과 안정성 확보</p><p><strong>데이터 변환 및 라우팅</strong>: 메시지 포맷 변환, 콘텐츠 기반 라우팅을 통한 이기종 시스템 간 원활한 데이터 교환 구현</p><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><table><thead><tr><th>기능 카테고리</th><th>기능 항목</th><th>설명</th><th></th></tr></thead><tbody><tr><td><strong>메시지 라우팅</strong></td><td>콘텐츠 기반 라우팅</td><td>메시지 내용 (Content) 에 따라 대상 라우팅 결정 (Content-Based Router)</td><td></td></tr><tr><td></td><td>수신자 목록 라우팅</td><td>메시지를 여러 대상에게 분배 (Recipient List)</td><td></td></tr><tr><td></td><td>동적 라우팅</td><td>런타임 조건에 따라 라우팅 대상 변경 (Dynamic Router)</td><td></td></tr><tr><td></td><td>헤더/토픽 기반 라우팅</td><td>메시지 헤더 또는 주제 (topic) 에 따라 라우팅 결정</td><td></td></tr><tr><td><strong>메시지 변환/처리</strong></td><td>데이터 포맷 변환</td><td>JSON, XML, Avro 등 포맷 간 변환 수행</td><td></td></tr><tr><td></td><td>콘텐츠 보강 (Enrichment)</td><td>외부 데이터를 통해 메시지 내용 확장</td><td></td></tr><tr><td></td><td>콘텐츠 필터링</td><td>필요 없는 필드 제거로 메시지 크기 최적화</td><td></td></tr><tr><td></td><td>메시지 인코딩/디코딩</td><td>바이너리 ↔ 텍스트 전환, Base64 등 인코딩 적용</td><td></td></tr><tr><td><strong>신뢰성 및 지속성 보장</strong></td><td>메시지 지속성</td><td>디스크 기반 메시지 저장으로 장애 발생 시에도 데이터 보존</td><td></td></tr><tr><td></td><td>지속적 구독자 관리</td><td>Durable Subscriber, 장애 시에도 메시지 재처리 가능</td><td></td></tr><tr><td></td><td>메시지 순서 보장</td><td>FIFO 큐 또는 파티셔닝으로 순서 일관성 유지</td><td></td></tr><tr><td></td><td>트랜잭션 지원</td><td>메시지 Ack/Commit 기반 정확한 처리 보장</td><td></td></tr><tr><td></td><td>오류 처리 및 DLQ</td><td>Dead Letter Queue 를 통한 실패 메시지 격리 및 복구</td><td></td></tr><tr><td><strong>운영 및 보안 기능</strong></td><td>확장성</td><td>메시지 소비자 병렬 처리 구조로 고부하 대응</td><td></td></tr><tr><td></td><td>보안</td><td>TLS 암호화, 인증/인가, ACL 등</td><td></td></tr><tr><td></td><td>모니터링/추적</td><td>메시지 흐름 추적, Ack 상태 확인, 지연 측정 등</td><td></td></tr></tbody></table><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><p><strong>비동기 통신 (Asynchronous Communication)</strong></p><ul><li>송신자는 수신자의 응답을 기다리지 않음</li><li>메시지 큐를 통한 임시 저장</li><li>&ldquo;Fire-and-Forget&rdquo; 방식 지원</li></ul><p><strong>느슨한 결합 (Loose Coupling)</strong></p><pre class=mermaid>graph LR
    A[Producer] --&gt; B[Message Queue]
    B --&gt; C[Consumer 1]
    B --&gt; D[Consumer 2]
    B --&gt; E[Consumer 3]
</pre><ul><li>시간적 결합 해제: 송신자와 수신자가 동시에 활성화될 필요 없음</li><li>공간적 결합 해제: 서로의 위치나 신원을 모름</li><li>동기화 결합 해제: 서로의 실행 속도에 독립적</li></ul><p><strong>플랫폼 독립성 (Platform Independence)</strong></p><ul><li>운영체제, 프로그래밍 언어, 네트워크 프로토콜에 무관한 통신</li><li>표준 메시지 포맷과 프로토콜 지원</li><li>크로스 플랫폼 상호 운용성 보장</li></ul><p><strong>확장성 (Scalability)</strong></p><ul><li>수평적 확장을 통한 처리 용량 증대</li><li>로드 밸런싱과 클러스터링 지원</li><li>클라우드 환경에서의 탄력적 확장</li></ul><p><strong>신뢰성 (Reliability)</strong></p><ul><li>메시지 지속성과 트랜잭션 지원</li><li>장애 복구와 failover 메커니즘</li><li>메시지 순서 보장과 중복 제거</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><h4 id=설계-원칙>설계 원칙<a hidden class=anchor aria-hidden=true href=#설계-원칙>#</a></h4><ul><li><strong>Single Responsibility Principle in Messaging</strong><ul><li>각 메시지는 단일 목적과 의미를 가져야 함</li><li>메시지 타입별 명확한 역할 분담</li><li>메시지 스키마의 단순성과 명확성 유지</li></ul></li><li><strong>Publish-Subscribe Principle</strong><ul><li>발행자와 구독자의 완전한 분리</li><li>이벤트 기반 느슨한 결합 구현</li><li>다대다 통신 패턴 지원</li></ul></li><li><strong>Message Immutability Principle</strong><ul><li>메시지는 생성 후 변경 불가능</li><li>데이터 무결성과 동시성 보장</li><li>이벤트 소싱 패턴의 기반</li></ul></li></ul><h4 id=운영-원칙>운영 원칙<a hidden class=anchor aria-hidden=true href=#운영-원칙>#</a></h4><ul><li><strong>Eventual Consistency Principle</strong><ul><li>분산 환경에서의 일관성 관리</li><li>BASE (Basically Available, Soft state, Eventual consistency) 모델 적용</li><li>트레이드오프를 통한 가용성 우선</li></ul></li><li><strong>Idempotency Principle</strong><ul><li>메시지 중복 처리에 대한 안전성 보장</li><li>멱등성을 통한 시스템 안정성 확보</li><li>재시도 메커니즘의 안전한 구현</li></ul></li></ul><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><h4 id=통신-원리>통신 원리<a hidden class=anchor aria-hidden=true href=#통신-원리>#</a></h4><ul><li><strong>Message Passing Model</strong><ul><li>공유 메모리 대신 메시지 교환을 통한 통신</li><li>프로세스 간 데이터 복사를 통한 격리성 보장</li><li>분산 환경에서의 자연스러운 통신 방식</li></ul></li><li><strong>Store-and-Forward Mechanism</strong><ul><li>메시지의 임시 저장과 전달</li><li>네트워크 장애와 시스템 부하에 대한 복원력</li><li>비동기 처리를 통한 성능 최적화</li></ul></li></ul><h4 id=아키텍처-원리>아키텍처 원리<a hidden class=anchor aria-hidden=true href=#아키텍처-원리>#</a></h4><ul><li><strong>Pipes and Filters Architecture</strong><ul><li>메시지 처리 파이프라인 구성</li><li>각 필터의 독립적인 처리 로직</li><li>조합 가능한 메시지 처리 체인</li></ul></li><li><strong>Event-Driven Architecture</strong><ul><li>이벤트 발생과 처리의 분리</li><li>반응형 시스템 (Reactive System) 구현</li><li>실시간 이벤트 스트림 처리</li></ul></li></ul><pre class=mermaid>graph TB
    subgraph &#34;Messaging-Oriented Architecture Principles&#34;
        A[Message Producer] --&gt;|Publish| B[Message Channel]
        B --&gt; C[Message Router]
        C --&gt;|Route| D[Message Queue 1]
        C --&gt;|Route| E[Message Queue 2]
        C --&gt;|Route| F[Topic]
        D --&gt; G[Consumer 1]
        E --&gt; H[Consumer 2]
        F --&gt; I[Subscriber 1]
        F --&gt; J[Subscriber 2]
        F --&gt; K[Subscriber 3]
    end
    
    style A fill:#e1f5fe
    style G fill:#e8f5e8
    style H fill:#e8f5e8
    style I fill:#fff3e0
    style J fill:#fff3e0
    style K fill:#fff3e0
</pre><p>Message Producer 가 Message Channel 에 메시지를 발행하면, Message Router 가 이를 적절한 Queue 나 Topic 으로 라우팅한다. Point-to-Point 패턴 (Queue) 과 Publish-Subscribe 패턴 (Topic) 이 함께 구현되어 다양한 통신 요구사항을 지원한다.</p><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><h4 id=기본-작동-원리>기본 작동 원리<a hidden class=anchor aria-hidden=true href=#기본-작동-원리>#</a></h4><pre class=mermaid>sequenceDiagram
    participant Producer
    participant MessageBroker
    participant Queue
    participant Consumer
    
    Producer-&gt;&gt;MessageBroker: Send Message
    MessageBroker-&gt;&gt;Queue: Store Message
    MessageBroker--&gt;&gt;Producer: Acknowledge
    
    Consumer-&gt;&gt;MessageBroker: Poll for Messages
    MessageBroker-&gt;&gt;Queue: Retrieve Message
    Queue--&gt;&gt;MessageBroker: Return Message
    MessageBroker--&gt;&gt;Consumer: Deliver Message
    Consumer-&gt;&gt;MessageBroker: Acknowledge Processing
    MessageBroker-&gt;&gt;Queue: Remove Message
</pre><ol><li><p><strong>메시지 생성 및 발송</strong></p><ul><li>애플리케이션이 메시지 객체 생성</li><li>메시지 헤더와 페이로드 설정</li><li>Message Broker 에 메시지 전송</li><li>비동기 확인 (Acknowledgment) 수신</li></ul></li><li><p><strong>메시지 라우팅 및 저장</strong></p><ul><li>Message Router 가 라우팅 규칙 적용</li><li>적절한 메시지 큐 또는 토픽 선택</li><li>메시지 지속성 저장 (Persistent Storage)</li><li>구독자별 메시지 복사 (Publish-Subscribe)</li></ul></li><li><p><strong>메시지 소비 및 처리</strong></p><ul><li>Consumer 가 메시지 요청 또는 Push 수신</li><li>메시지 역직렬화 및 비즈니스 로직 실행</li><li>처리 완료 후 확인 메시지 전송</li><li>메시지 큐에서 메시지 제거</li></ul></li></ol><p><strong>고급 작동 메커니즘</strong></p><p><strong>Dead Letter Queue (DLQ) 처리</strong></p><ul><li>처리 실패한 메시지의 별도 큐 이동</li><li>오류 분석과 수동 재처리 지원</li><li>시스템 안정성과 모니터링 향상</li></ul><p><strong>Message Transformation Pipeline</strong></p><ul><li>메시지 내용의 동적 변환</li><li>스키마 매핑과 데이터 형식 변환</li><li>콘텐츠 enrichment 와 필터링</li></ul><h4 id=메시징-패턴별-작동-방식>메시징 패턴별 작동 방식<a hidden class=anchor aria-hidden=true href=#메시징-패턴별-작동-방식>#</a></h4><h5 id=point-to-point-점대점-패턴>Point-to-Point (점대점) 패턴<a hidden class=anchor aria-hidden=true href=#point-to-point-점대점-패턴>#</a></h5><pre class=mermaid>graph LR
    A[Sender] --&gt; B[Queue] --&gt; C[Receiver]
</pre><ul><li>하나의 송신자가 특정 수신자에게 메시지 전송</li><li>메시지 큐를 통한 일대일 통신</li><li>메시지는 한 번만 소비됨</li></ul><h5 id=publish-subscribe-게시---구독-패턴>Publish-Subscribe (게시 - 구독) 패턴<a hidden class=anchor aria-hidden=true href=#publish-subscribe-게시---구독-패턴>#</a></h5><pre class=mermaid>graph TB
    A[Publisher] --&gt; B[Topic]
    B --&gt; C[Subscriber 1]
    B --&gt; D[Subscriber 2]
    B --&gt; E[Subscriber 3]
</pre><ul><li>게시자가 토픽에 메시지 발행</li><li>구독자들이 관심 있는 토픽 구독</li><li>동일 메시지가 모든 구독자에게 전달</li></ul><h5 id=request-reply-요청---응답-패턴>Request-Reply (요청 - 응답) 패턴<a hidden class=anchor aria-hidden=true href=#request-reply-요청---응답-패턴>#</a></h5><pre class=mermaid>sequenceDiagram
    participant C as Client
    participant RQ as Request Queue
    participant S as Server
    participant RP as Reply Queue
    
    C-&gt;&gt;RQ: Request Message
    RQ-&gt;&gt;S: Deliver Request
    S-&gt;&gt;RP: Response Message
    RP-&gt;&gt;C: Deliver Response
</pre><ul><li>요청자가 요청 메시지 전송</li><li>처리자가 응답 메시지로 회신</li><li>동기식 통신을 비동기로 구현</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p>Messaging-Oriented Styles 의 구조는 여러 핵심 구성 요소들이 유기적으로 결합된 형태이다.</p><h4 id=전체-아키텍처>전체 아키텍처<a hidden class=anchor aria-hidden=true href=#전체-아키텍처>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;Message-Oriented Architecture&#34;
        subgraph &#34;Producer Layer&#34;
            P1[Application 1]
            P2[Application 2]
            P3[Service A]
        end
        
        subgraph &#34;Messaging Infrastructure&#34;
            subgraph &#34;Message Broker&#34;
                MR[Message Router]
                MT[Message Transformer]
                MM[Message Manager]
            end
            
            subgraph &#34;Message Channels&#34;
                PQ1[Point-to-Point Queue 1]
                PQ2[Point-to-Point Queue 2]
                PST[Publish-Subscribe Topic]
                DLQ[Dead Letter Queue]
            end
            
            subgraph &#34;Storage Layer&#34;
                MS[Message Store]
                ML[Message Log]
            end
        end
        
        subgraph &#34;Consumer Layer&#34;
            C1[Consumer Service 1]
            C2[Consumer Service 2]
            C3[Subscriber 1]
            C4[Subscriber 2]
        end
        
        subgraph &#34;Management Layer&#34;
            MON[Monitoring]
            SEC[Security]
            CFG[Configuration]
        end
    end
    
    P1 --&gt; MR
    P2 --&gt; MR
    P3 --&gt; MR
    
    MR --&gt; MT
    MT --&gt; PQ1
    MT --&gt; PQ2
    MT --&gt; PST
    MR --&gt; DLQ
    
    PQ1 --&gt; MS
    PQ2 --&gt; MS
    PST --&gt; MS
    MS --&gt; ML
    
    PQ1 --&gt; C1
    PQ2 --&gt; C2
    PST --&gt; C3
    PST --&gt; C4
    
    MON -.-&gt; MR
    SEC -.-&gt; MR
    CFG -.-&gt; MR
</pre><h4 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h4><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th><th>주요 특징</th></tr></thead><tbody><tr><td><strong>Message Broker</strong></td><td>메시지 중앙 허브</td><td>- 메시지 수신, 저장, 라우팅<br>- 포맷/프로토콜 변환<br>- 로드 밸런싱, 장애 처리</td><td>- 고가용성, 클러스터링<br>- 메시지 순서 및 트랜잭션 보장<br>- 다양한 패턴 지원</td></tr><tr><td><strong>Message Channels</strong></td><td>메시지 전송 경로 및 저장소</td><td>- P2P: 1:1 메시지 전달<br>- Pub/Sub: 1:N 브로드캐스트<br>- DLQ: 오류 처리</td><td>- 지속성 및 TTL 관리<br>- FIFO 또는 우선순위 처리<br>- 메시지 생명주기 관리</td></tr><tr><td><strong>Message Endpoints</strong></td><td>애플리케이션 ↔ 메시징 시스템 인터페이스</td><td>- Gateway: 외부 연동<br>- Adapter: 포맷/프로토콜 적응<br>- Activator: 서비스 호출</td><td>- 비동기/이벤트 기반 처리<br>- 다양한 포맷/프로토콜 지원<br>- 재시도 및 오류 처리</td></tr></tbody></table><h4 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h4><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th><th>주요 특징</th></tr></thead><tbody><tr><td><strong>Message Store</strong></td><td>메시지 저장 및 감사 추적</td><td>- 메시지 이력 저장<br>- 장애 복구 백업<br>- 감사/규정 준수 지원</td><td>- 메시지 압축/아카이빙<br>- 보존 정책 관리<br>- 검색 및 분석 기능</td></tr><tr><td><strong>Message Monitor</strong></td><td>시스템 상태 및 성능 모니터링</td><td>- 처리량, 지연 시간 모니터링<br>- 시스템 상태 감시/알림<br>- 용량 예측 지원</td><td>- 실시간 대시보드<br>- 알림 시스템<br>- 트렌드 분석 및 헬스체크</td></tr><tr><td><strong>Message Security</strong></td><td>메시지 보안</td><td>- 메시지 암호화<br>- 인증/인가<br>- 무결성 검증 및 서명</td><td>- 종단간 암호화<br>- JWT, OAuth 기반 인증<br>- 감사 로그 및 정책 준수 지원</td></tr></tbody></table><h4 id=아키텍처-패턴>아키텍처 패턴<a hidden class=anchor aria-hidden=true href=#아키텍처-패턴>#</a></h4><table><thead><tr><th>아키텍처 패턴</th><th>구조 개요</th><th>장점</th><th>단점</th><th>대표 사례 / 용도</th></tr></thead><tbody><tr><td><strong>Hub-and-Spoke</strong></td><td>중앙 허브 (Broker) 를 통해 모든 통신</td><td>- 구현 간단<br>- 통제 및 모니터링 용이<br>- 구성 변경 용이</td><td>- 중앙 장애 발생 시 전체 시스템 마비<br>- 스케일 아웃 어려움</td><td>기업 내부 시스템 통합 (EAI)<br>전통적인 ESB</td></tr><tr><td><strong>Bus Architecture</strong></td><td>브로커 또는 통신 채널이 분산된 버스 형태</td><td>- 고가용성<br>- 유연한 서비스 추가<br>- 확장성 우수</td><td>- 설정 및 관리 복잡<br>- QoS 정책 일관성 유지 어려움</td><td>마이크로서비스 메시지 버스<br>Kafka 기반 데이터 파이프라인</td></tr><tr><td><strong>Mesh Architecture</strong></td><td>노드 간 직접 연결 (P2P 네트워크)</td><td>- 높은 확장성<br>- 레이턴시 최소화<br>- 중앙 장애점 없음</td><td>- 토폴로지 복잡<br>- 연결 및 라우팅 최적화 필요</td><td>WebRTC 기반 실시간 통신<br>분산 파일 시스템 (IPFS 등)</td></tr></tbody></table><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><table><thead><tr><th><strong>구현 기법 유형</strong></th><th><strong>구현 방식</strong></th><th><strong>정의 및 목적</strong></th><th><strong>주요 구성 요소</strong></th><th><strong>활용 사례</strong></th></tr></thead><tbody><tr><td><strong>1. Message Queue (P2P)</strong></td><td>RabbitMQ, SQS, ActiveMQ</td><td>FIFO 기반으로 메시지를 순차 저장하고 하나의 소비자가 처리하는 방식. 일대일 비동기 처리 보장.</td><td>Queue Manager, Message Buffer, Queue Monitor</td><td>주문 처리, 영상 처리 워커, 결제 처리</td></tr><tr><td><strong>2. Publish-Subscribe</strong></td><td>Kafka, MQTT, Redis Pub/Sub</td><td>발행자가 메시지를 토픽에 전송하면, 다수의 구독자가 해당 메시지를 비동기적으로 수신. 이벤트 기반 아키텍처에 최적화.</td><td>Topic Manager, Subscription Manager, Dispatcher</td><td>실시간 알림, 뉴스 시스템, IoT 센서 이벤트</td></tr><tr><td><strong>3. Request-Reply (RPC)</strong></td><td>AMQP RPC, JMS Temp Queue, gRPC</td><td>요청 - 응답 방식의 메시지 처리. 클라이언트가 응답을 기다리는 동기 또는 반동기 구조.</td><td>Reply Queue, Correlation ID, Timeout Manager</td><td>사용자 프로필 조회, 재고 확인 등 동기 통신</td></tr><tr><td><strong>4. Message Routing</strong></td><td>Content-Based Router, Header Router</td><td>메시지 내용 또는 헤더 기반으로 라우팅 결정. 메시지를 목적지로 조건부 전송.</td><td>Routing Engine, Content Analyzer, Destination Resolver</td><td>주문 분류, 이벤트 분기 처리, 지역별 처리 분산</td></tr><tr><td><strong>5. Message Transformation</strong></td><td>Camel, Spring Integration, Custom Engine</td><td>서로 다른 시스템 간의 메시지 포맷 변환. JSON ↔ XML, ERP ↔ CRM 등 이기종 간 데이터 연동에 활용.</td><td>Transformer, Format Mapper, Rule Engine</td><td>시스템 통합, 포맷 변환, 이벤트 스키마 정규화</td></tr><tr><td><strong>6. Stream Processing</strong></td><td>Kafka Streams, Pulsar Functions</td><td>메시지를 수신하는 즉시 처리 (Transformation, Aggregation 등). 브로커와 처리 엔진의 통합 구조.</td><td>Stateless Processor, Window Operator, Join Engine</td><td>로그 집계, 실시간 모니터링, Fraud Detection</td></tr><tr><td><strong>7. Dead-Letter Handling</strong></td><td>DLQ, Retry Queue</td><td>처리 실패 메시지를 별도로 저장 후 재처리. 데이터 유실 방지와 장애 분석에 유용.</td><td>Error Handler, DLQ Queue, Retry Manager</td><td>에러 분석, 비정상 거래 탐지, 재처리 전략 구축</td></tr><tr><td><strong>8. Transactional Messaging</strong></td><td>Kafka Transaction API, JMS TX</td><td>메시지 전송과 소비가 하나의 트랜잭션 단위로 처리되어 일관성과 원자성 보장.</td><td>Producer TX Buffer, Commit/Abort Controller</td><td>금융 이체, 예약 시스템 등 정확성 보장 필요 시</td></tr></tbody></table><h4 id=message-queue>Message Queue<a hidden class=anchor aria-hidden=true href=#message-queue>#</a></h4><p><strong>정의</strong>: 메시지를 순차적으로 저장하고 처리하는 FIFO 기반 저장소</p><p><strong>구성 요소</strong>:</p><ul><li>Queue Manager: 큐 생성, 삭제, 관리</li><li>Message Buffer: 메모리 또는 디스크 기반 저장</li><li>Queue Monitor: 큐 상태와 성능 모니터링</li></ul><p><strong>목적</strong>:</p><ul><li>비동기 통신을 통한 시스템 분리</li><li>트래픽 버스팅과 로드 레벨링</li><li>메시지 순서 보장과 정확히 한 번 처리</li></ul><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33>33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34>34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35>35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36>36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37>37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38>38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39>39</a>
</span><span class=lnt id=hl-7-40><a class=lnlinks href=#hl-7-40>40</a>
</span><span class=lnt id=hl-7-41><a class=lnlinks href=#hl-7-41>41</a>
</span><span class=lnt id=hl-7-42><a class=lnlinks href=#hl-7-42>42</a>
</span><span class=lnt id=hl-7-43><a class=lnlinks href=#hl-7-43>43</a>
</span><span class=lnt id=hl-7-44><a class=lnlinks href=#hl-7-44>44</a>
</span><span class=lnt id=hl-7-45><a class=lnlinks href=#hl-7-45>45</a>
</span><span class=lnt id=hl-7-46><a class=lnlinks href=#hl-7-46>46</a>
</span><span class=lnt id=hl-7-47><a class=lnlinks href=#hl-7-47>47</a>
</span><span class=lnt id=hl-7-48><a class=lnlinks href=#hl-7-48>48</a>
</span><span class=lnt id=hl-7-49><a class=lnlinks href=#hl-7-49>49</a>
</span><span class=lnt id=hl-7-50><a class=lnlinks href=#hl-7-50>50</a>
</span><span class=lnt id=hl-7-51><a class=lnlinks href=#hl-7-51>51</a>
</span><span class=lnt id=hl-7-52><a class=lnlinks href=#hl-7-52>52</a>
</span><span class=lnt id=hl-7-53><a class=lnlinks href=#hl-7-53>53</a>
</span><span class=lnt id=hl-7-54><a class=lnlinks href=#hl-7-54>54</a>
</span><span class=lnt id=hl-7-55><a class=lnlinks href=#hl-7-55>55</a>
</span><span class=lnt id=hl-7-56><a class=lnlinks href=#hl-7-56>56</a>
</span><span class=lnt id=hl-7-57><a class=lnlinks href=#hl-7-57>57</a>
</span><span class=lnt id=hl-7-58><a class=lnlinks href=#hl-7-58>58</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// RabbitMQ를 사용한 메시지 큐 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MessageQueueManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>connectionUrl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>connectionUrl</span> <span class=o>=</span> <span class=nx>connectionUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>connect</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>connectionUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createQueue</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>queueOptions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>      <span class=c1>// 큐 지속성
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>exclusive</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>   <span class=c1>// 연결 전용 큐 여부
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>autoDelete</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>  <span class=c1>// 자동 삭제 여부
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=err>…</span><span class=nx>options</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=nx>queueOptions</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Queue </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb> created successfully`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>sendMessage</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>messageBuffer</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>message</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>messageOptions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>   <span class=c1>// 메시지 지속성
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>messageId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateMessageId</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=nx>messageBuffer</span><span class=p>,</span> <span class=nx>messageOptions</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Message sent to </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>:`</span><span class=p>,</span> <span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>consumeMessages</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=nx>processor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=nx>processor</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>  <span class=c1>// 메시지 처리 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Message processing failed:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>  <span class=c1>// Dead Letter Queue로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateMessageId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>)</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=publish-subscribe>Publish-Subscribe<a hidden class=anchor aria-hidden=true href=#publish-subscribe>#</a></h4><p><strong>정의</strong>: 발행자가 메시지를 토픽에 발행하고, 여러 구독자가 관심 있는 토픽을 구독하는 패턴</p><p><strong>구성 요소</strong>:</p><ul><li>Topic Manager: 토픽 생성과 관리</li><li>Subscription Manager: 구독 정보 관리</li><li>Message Dispatcher: 구독자별 메시지 배포</li></ul><p><strong>목적</strong>:</p><ul><li>1:N 통신을 통한 이벤트 기반 아키텍처 구현</li><li>발행자와 구독자의 완전한 분리</li><li>동적 구독과 확장 가능한 이벤트 처리</li></ul><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63>63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64>64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65>65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66>66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67>67</a>
</span><span class=lnt id=hl-8-68><a class=lnlinks href=#hl-8-68>68</a>
</span><span class=lnt id=hl-8-69><a class=lnlinks href=#hl-8-69>69</a>
</span><span class=lnt id=hl-8-70><a class=lnlinks href=#hl-8-70>70</a>
</span><span class=lnt id=hl-8-71><a class=lnlinks href=#hl-8-71>71</a>
</span><span class=lnt id=hl-8-72><a class=lnlinks href=#hl-8-72>72</a>
</span><span class=lnt id=hl-8-73><a class=lnlinks href=#hl-8-73>73</a>
</span><span class=lnt id=hl-8-74><a class=lnlinks href=#hl-8-74>74</a>
</span><span class=lnt id=hl-8-75><a class=lnlinks href=#hl-8-75>75</a>
</span><span class=lnt id=hl-8-76><a class=lnlinks href=#hl-8-76>76</a>
</span><span class=lnt id=hl-8-77><a class=lnlinks href=#hl-8-77>77</a>
</span><span class=lnt id=hl-8-78><a class=lnlinks href=#hl-8-78>78</a>
</span><span class=lnt id=hl-8-79><a class=lnlinks href=#hl-8-79>79</a>
</span><span class=lnt id=hl-8-80><a class=lnlinks href=#hl-8-80>80</a>
</span><span class=lnt id=hl-8-81><a class=lnlinks href=#hl-8-81>81</a>
</span><span class=lnt id=hl-8-82><a class=lnlinks href=#hl-8-82>82</a>
</span><span class=lnt id=hl-8-83><a class=lnlinks href=#hl-8-83>83</a>
</span><span class=lnt id=hl-8-84><a class=lnlinks href=#hl-8-84>84</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Apache Kafka를 사용한 Pub-Sub 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PubSubManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>brokers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;messaging-app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>brokers</span><span class=o>:</span> <span class=nx>brokers</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>producer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>admin</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span><span class=p>.</span><span class=nx>admin</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>initialize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>admin</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createTopic</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=nx>partitions</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>replicas</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>admin</span><span class=p>.</span><span class=nx>createTopics</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>topics</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>                <span class=nx>topic</span><span class=o>:</span> <span class=nx>topicName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>numPartitions</span><span class=o>:</span> <span class=nx>partitions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>replicationFactor</span><span class=o>:</span> <span class=nx>replicas</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>configEntries</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;cleanup.policy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>value</span><span class=o>:</span> <span class=s1>&#39;delete&#39;</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;retention.ms&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>value</span><span class=o>:</span> <span class=s1>&#39;86400000&#39;</span>  <span class=c1>// 24시간
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Topic </span><span class=si>${</span><span class=nx>topicName</span><span class=si>}</span><span class=sb> created`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>publishMessage</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>key</span> <span class=o>=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>topic</span><span class=o>:</span> <span class=nx>topicName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>messages</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>                <span class=nx>key</span><span class=o>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;content-type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;message-id&#39;</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateMessageId</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Message published to </span><span class=si>${</span><span class=nx>topicName</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createSubscriber</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=nx>groupId</span><span class=p>,</span> <span class=nx>messageHandler</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>consumer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topic</span><span class=o>:</span> <span class=nx>topicName</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=nx>messageHandler</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>partition</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>offset</span><span class=o>:</span> <span class=nx>message</span><span class=p>.</span><span class=nx>offset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>timestamp</span><span class=o>:</span> <span class=nx>message</span><span class=p>.</span><span class=nx>timestamp</span>
</span></span><span class=line><span class=cl>                    <span class=p>});</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Error processing message from </span><span class=si>${</span><span class=nx>topic</span><span class=si>}</span><span class=sb>:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 에러 처리 로직 (Dead Letter Topic으로 전송 등)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>consumer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateMessageId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>-</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>9</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=request-reply>Request-Reply<a hidden class=anchor aria-hidden=true href=#request-reply>#</a></h4><p><strong>정의</strong>: 요청 메시지에 대한 응답 메시지를 기대하는 동기식 통신 패턴</p><p><strong>구성 요소</strong>:</p><ul><li>Correlation ID Manager: 요청 - 응답 매칭</li><li>Reply Queue Manager: 응답 큐 관리</li><li>Timeout Manager: 응답 대기 시간 관리</li></ul><p><strong>목적</strong>:</p><ul><li>분산 환경에서의 동기식 호출 지원</li><li>서비스 간 데이터 요청/응답 처리</li><li>RPC 스타일 통신의 메시지 기반 구현</li></ul><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>  1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>  2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>  3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>  4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>  5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>  6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7>  7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8>  8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9>  9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10> 10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11> 11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12> 12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13> 13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14> 14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15> 15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16> 16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17> 17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18> 18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19> 19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20> 20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21> 21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22> 22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23> 23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24> 24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25> 25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26> 26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27> 27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28> 28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29> 29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30> 30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31> 31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32> 32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33> 33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34> 34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35> 35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36> 36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37> 37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38> 38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39> 39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40> 40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41> 41</a>
</span><span class=lnt id=hl-9-42><a class=lnlinks href=#hl-9-42> 42</a>
</span><span class=lnt id=hl-9-43><a class=lnlinks href=#hl-9-43> 43</a>
</span><span class=lnt id=hl-9-44><a class=lnlinks href=#hl-9-44> 44</a>
</span><span class=lnt id=hl-9-45><a class=lnlinks href=#hl-9-45> 45</a>
</span><span class=lnt id=hl-9-46><a class=lnlinks href=#hl-9-46> 46</a>
</span><span class=lnt id=hl-9-47><a class=lnlinks href=#hl-9-47> 47</a>
</span><span class=lnt id=hl-9-48><a class=lnlinks href=#hl-9-48> 48</a>
</span><span class=lnt id=hl-9-49><a class=lnlinks href=#hl-9-49> 49</a>
</span><span class=lnt id=hl-9-50><a class=lnlinks href=#hl-9-50> 50</a>
</span><span class=lnt id=hl-9-51><a class=lnlinks href=#hl-9-51> 51</a>
</span><span class=lnt id=hl-9-52><a class=lnlinks href=#hl-9-52> 52</a>
</span><span class=lnt id=hl-9-53><a class=lnlinks href=#hl-9-53> 53</a>
</span><span class=lnt id=hl-9-54><a class=lnlinks href=#hl-9-54> 54</a>
</span><span class=lnt id=hl-9-55><a class=lnlinks href=#hl-9-55> 55</a>
</span><span class=lnt id=hl-9-56><a class=lnlinks href=#hl-9-56> 56</a>
</span><span class=lnt id=hl-9-57><a class=lnlinks href=#hl-9-57> 57</a>
</span><span class=lnt id=hl-9-58><a class=lnlinks href=#hl-9-58> 58</a>
</span><span class=lnt id=hl-9-59><a class=lnlinks href=#hl-9-59> 59</a>
</span><span class=lnt id=hl-9-60><a class=lnlinks href=#hl-9-60> 60</a>
</span><span class=lnt id=hl-9-61><a class=lnlinks href=#hl-9-61> 61</a>
</span><span class=lnt id=hl-9-62><a class=lnlinks href=#hl-9-62> 62</a>
</span><span class=lnt id=hl-9-63><a class=lnlinks href=#hl-9-63> 63</a>
</span><span class=lnt id=hl-9-64><a class=lnlinks href=#hl-9-64> 64</a>
</span><span class=lnt id=hl-9-65><a class=lnlinks href=#hl-9-65> 65</a>
</span><span class=lnt id=hl-9-66><a class=lnlinks href=#hl-9-66> 66</a>
</span><span class=lnt id=hl-9-67><a class=lnlinks href=#hl-9-67> 67</a>
</span><span class=lnt id=hl-9-68><a class=lnlinks href=#hl-9-68> 68</a>
</span><span class=lnt id=hl-9-69><a class=lnlinks href=#hl-9-69> 69</a>
</span><span class=lnt id=hl-9-70><a class=lnlinks href=#hl-9-70> 70</a>
</span><span class=lnt id=hl-9-71><a class=lnlinks href=#hl-9-71> 71</a>
</span><span class=lnt id=hl-9-72><a class=lnlinks href=#hl-9-72> 72</a>
</span><span class=lnt id=hl-9-73><a class=lnlinks href=#hl-9-73> 73</a>
</span><span class=lnt id=hl-9-74><a class=lnlinks href=#hl-9-74> 74</a>
</span><span class=lnt id=hl-9-75><a class=lnlinks href=#hl-9-75> 75</a>
</span><span class=lnt id=hl-9-76><a class=lnlinks href=#hl-9-76> 76</a>
</span><span class=lnt id=hl-9-77><a class=lnlinks href=#hl-9-77> 77</a>
</span><span class=lnt id=hl-9-78><a class=lnlinks href=#hl-9-78> 78</a>
</span><span class=lnt id=hl-9-79><a class=lnlinks href=#hl-9-79> 79</a>
</span><span class=lnt id=hl-9-80><a class=lnlinks href=#hl-9-80> 80</a>
</span><span class=lnt id=hl-9-81><a class=lnlinks href=#hl-9-81> 81</a>
</span><span class=lnt id=hl-9-82><a class=lnlinks href=#hl-9-82> 82</a>
</span><span class=lnt id=hl-9-83><a class=lnlinks href=#hl-9-83> 83</a>
</span><span class=lnt id=hl-9-84><a class=lnlinks href=#hl-9-84> 84</a>
</span><span class=lnt id=hl-9-85><a class=lnlinks href=#hl-9-85> 85</a>
</span><span class=lnt id=hl-9-86><a class=lnlinks href=#hl-9-86> 86</a>
</span><span class=lnt id=hl-9-87><a class=lnlinks href=#hl-9-87> 87</a>
</span><span class=lnt id=hl-9-88><a class=lnlinks href=#hl-9-88> 88</a>
</span><span class=lnt id=hl-9-89><a class=lnlinks href=#hl-9-89> 89</a>
</span><span class=lnt id=hl-9-90><a class=lnlinks href=#hl-9-90> 90</a>
</span><span class=lnt id=hl-9-91><a class=lnlinks href=#hl-9-91> 91</a>
</span><span class=lnt id=hl-9-92><a class=lnlinks href=#hl-9-92> 92</a>
</span><span class=lnt id=hl-9-93><a class=lnlinks href=#hl-9-93> 93</a>
</span><span class=lnt id=hl-9-94><a class=lnlinks href=#hl-9-94> 94</a>
</span><span class=lnt id=hl-9-95><a class=lnlinks href=#hl-9-95> 95</a>
</span><span class=lnt id=hl-9-96><a class=lnlinks href=#hl-9-96> 96</a>
</span><span class=lnt id=hl-9-97><a class=lnlinks href=#hl-9-97> 97</a>
</span><span class=lnt id=hl-9-98><a class=lnlinks href=#hl-9-98> 98</a>
</span><span class=lnt id=hl-9-99><a class=lnlinks href=#hl-9-99> 99</a>
</span><span class=lnt id=hl-9-100><a class=lnlinks href=#hl-9-100>100</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Request-Reply 패턴 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>RequestReplyManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>messageQueueManager</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span> <span class=o>=</span> <span class=nx>messageQueueManager</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>pendingRequests</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>replyQueueName</span> <span class=o>=</span> <span class=s1>&#39;reply_queue_&#39;</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>initialize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>createQueue</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>replyQueueName</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>exclusive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>autoDelete</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 응답 메시지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>consumeMessages</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>replyQueueName</span><span class=p>,</span> <span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>handleReply</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>sendRequest</span><span class=p>(</span><span class=nx>targetQueue</span><span class=p>,</span> <span class=nx>requestData</span><span class=p>,</span> <span class=nx>timeout</span> <span class=o>=</span> <span class=mi>30000</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>correlationId</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateCorrelationId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>requestMessage</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=nx>requestData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>replyTo</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>replyQueueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>correlationId</span><span class=o>:</span> <span class=nx>correlationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 응답 대기 프로미스 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>responsePromise</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>pendingRequests</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>correlationId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Request timeout&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span> <span class=nx>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>pendingRequests</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>correlationId</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>resolve</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>reject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>timer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 요청 메시지 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>sendMessage</span><span class=p>(</span><span class=nx>targetQueue</span><span class=p>,</span> <span class=nx>requestMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Request sent with correlation ID: </span><span class=si>${</span><span class=nx>correlationId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>responsePromise</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>handleReply</span><span class=p>(</span><span class=nx>replyMessage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>correlationId</span> <span class=o>=</span> <span class=nx>replyMessage</span><span class=p>.</span><span class=nx>correlationId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>pendingRequest</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pendingRequests</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>correlationId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>pendingRequest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>pendingRequest</span><span class=p>.</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>pendingRequests</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>correlationId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>replyMessage</span><span class=p>.</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>pendingRequest</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=nx>replyMessage</span><span class=p>.</span><span class=nx>error</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>pendingRequest</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>replyMessage</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`Received reply for unknown correlation ID: </span><span class=si>${</span><span class=nx>correlationId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 서버 측 요청 처리기 등록
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>registerRequestHandler</span><span class=p>(</span><span class=nx>requestQueue</span><span class=p>,</span> <span class=nx>handler</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>createQueue</span><span class=p>(</span><span class=nx>requestQueue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>consumeMessages</span><span class=p>(</span><span class=nx>requestQueue</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>requestMessage</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>requestMessage</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>replyMessage</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>data</span><span class=o>:</span> <span class=nx>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>correlationId</span><span class=o>:</span> <span class=nx>requestMessage</span><span class=p>.</span><span class=nx>correlationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>};</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>sendMessage</span><span class=p>(</span><span class=nx>requestMessage</span><span class=p>.</span><span class=nx>replyTo</span><span class=p>,</span> <span class=nx>replyMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>errorReply</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>correlationId</span><span class=o>:</span> <span class=nx>requestMessage</span><span class=p>.</span><span class=nx>correlationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>};</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queueManager</span><span class=p>.</span><span class=nx>sendMessage</span><span class=p>(</span><span class=nx>requestMessage</span><span class=p>.</span><span class=nx>replyTo</span><span class=p>,</span> <span class=nx>errorReply</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateCorrelationId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>)</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=message-routing>Message Routing<a hidden class=anchor aria-hidden=true href=#message-routing>#</a></h4><p><strong>정의</strong>: 메시지 내용이나 헤더 정보를 기반으로 적절한 목적지로 메시지를 라우팅하는 기법</p><p><strong>구성 요소</strong>:</p><ul><li>Routing Engine: 라우팅 규칙 엔진</li><li>Content Analyzer: 메시지 내용 분석</li><li>Destination Resolver: 목적지 결정</li></ul><p><strong>목적</strong>:</p><ul><li>조건부 메시지 배포</li><li>컨텐츠 기반 라우팅</li><li>동적 라우팅 규칙 적용</li></ul><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>  1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>  2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>  3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>  4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>  5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>  6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>  7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8>  8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9>  9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10> 10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11> 11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12> 12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13> 13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14> 14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15> 15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16> 16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17> 17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18> 18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19> 19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20> 20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21> 21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22> 22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23> 23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24> 24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25> 25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26> 26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27> 27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28> 28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29> 29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30> 30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31> 31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32> 32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33> 33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34> 34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35> 35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36> 36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37> 37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38> 38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39> 39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40> 40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41> 41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42> 42</a>
</span><span class=lnt id=hl-10-43><a class=lnlinks href=#hl-10-43> 43</a>
</span><span class=lnt id=hl-10-44><a class=lnlinks href=#hl-10-44> 44</a>
</span><span class=lnt id=hl-10-45><a class=lnlinks href=#hl-10-45> 45</a>
</span><span class=lnt id=hl-10-46><a class=lnlinks href=#hl-10-46> 46</a>
</span><span class=lnt id=hl-10-47><a class=lnlinks href=#hl-10-47> 47</a>
</span><span class=lnt id=hl-10-48><a class=lnlinks href=#hl-10-48> 48</a>
</span><span class=lnt id=hl-10-49><a class=lnlinks href=#hl-10-49> 49</a>
</span><span class=lnt id=hl-10-50><a class=lnlinks href=#hl-10-50> 50</a>
</span><span class=lnt id=hl-10-51><a class=lnlinks href=#hl-10-51> 51</a>
</span><span class=lnt id=hl-10-52><a class=lnlinks href=#hl-10-52> 52</a>
</span><span class=lnt id=hl-10-53><a class=lnlinks href=#hl-10-53> 53</a>
</span><span class=lnt id=hl-10-54><a class=lnlinks href=#hl-10-54> 54</a>
</span><span class=lnt id=hl-10-55><a class=lnlinks href=#hl-10-55> 55</a>
</span><span class=lnt id=hl-10-56><a class=lnlinks href=#hl-10-56> 56</a>
</span><span class=lnt id=hl-10-57><a class=lnlinks href=#hl-10-57> 57</a>
</span><span class=lnt id=hl-10-58><a class=lnlinks href=#hl-10-58> 58</a>
</span><span class=lnt id=hl-10-59><a class=lnlinks href=#hl-10-59> 59</a>
</span><span class=lnt id=hl-10-60><a class=lnlinks href=#hl-10-60> 60</a>
</span><span class=lnt id=hl-10-61><a class=lnlinks href=#hl-10-61> 61</a>
</span><span class=lnt id=hl-10-62><a class=lnlinks href=#hl-10-62> 62</a>
</span><span class=lnt id=hl-10-63><a class=lnlinks href=#hl-10-63> 63</a>
</span><span class=lnt id=hl-10-64><a class=lnlinks href=#hl-10-64> 64</a>
</span><span class=lnt id=hl-10-65><a class=lnlinks href=#hl-10-65> 65</a>
</span><span class=lnt id=hl-10-66><a class=lnlinks href=#hl-10-66> 66</a>
</span><span class=lnt id=hl-10-67><a class=lnlinks href=#hl-10-67> 67</a>
</span><span class=lnt id=hl-10-68><a class=lnlinks href=#hl-10-68> 68</a>
</span><span class=lnt id=hl-10-69><a class=lnlinks href=#hl-10-69> 69</a>
</span><span class=lnt id=hl-10-70><a class=lnlinks href=#hl-10-70> 70</a>
</span><span class=lnt id=hl-10-71><a class=lnlinks href=#hl-10-71> 71</a>
</span><span class=lnt id=hl-10-72><a class=lnlinks href=#hl-10-72> 72</a>
</span><span class=lnt id=hl-10-73><a class=lnlinks href=#hl-10-73> 73</a>
</span><span class=lnt id=hl-10-74><a class=lnlinks href=#hl-10-74> 74</a>
</span><span class=lnt id=hl-10-75><a class=lnlinks href=#hl-10-75> 75</a>
</span><span class=lnt id=hl-10-76><a class=lnlinks href=#hl-10-76> 76</a>
</span><span class=lnt id=hl-10-77><a class=lnlinks href=#hl-10-77> 77</a>
</span><span class=lnt id=hl-10-78><a class=lnlinks href=#hl-10-78> 78</a>
</span><span class=lnt id=hl-10-79><a class=lnlinks href=#hl-10-79> 79</a>
</span><span class=lnt id=hl-10-80><a class=lnlinks href=#hl-10-80> 80</a>
</span><span class=lnt id=hl-10-81><a class=lnlinks href=#hl-10-81> 81</a>
</span><span class=lnt id=hl-10-82><a class=lnlinks href=#hl-10-82> 82</a>
</span><span class=lnt id=hl-10-83><a class=lnlinks href=#hl-10-83> 83</a>
</span><span class=lnt id=hl-10-84><a class=lnlinks href=#hl-10-84> 84</a>
</span><span class=lnt id=hl-10-85><a class=lnlinks href=#hl-10-85> 85</a>
</span><span class=lnt id=hl-10-86><a class=lnlinks href=#hl-10-86> 86</a>
</span><span class=lnt id=hl-10-87><a class=lnlinks href=#hl-10-87> 87</a>
</span><span class=lnt id=hl-10-88><a class=lnlinks href=#hl-10-88> 88</a>
</span><span class=lnt id=hl-10-89><a class=lnlinks href=#hl-10-89> 89</a>
</span><span class=lnt id=hl-10-90><a class=lnlinks href=#hl-10-90> 90</a>
</span><span class=lnt id=hl-10-91><a class=lnlinks href=#hl-10-91> 91</a>
</span><span class=lnt id=hl-10-92><a class=lnlinks href=#hl-10-92> 92</a>
</span><span class=lnt id=hl-10-93><a class=lnlinks href=#hl-10-93> 93</a>
</span><span class=lnt id=hl-10-94><a class=lnlinks href=#hl-10-94> 94</a>
</span><span class=lnt id=hl-10-95><a class=lnlinks href=#hl-10-95> 95</a>
</span><span class=lnt id=hl-10-96><a class=lnlinks href=#hl-10-96> 96</a>
</span><span class=lnt id=hl-10-97><a class=lnlinks href=#hl-10-97> 97</a>
</span><span class=lnt id=hl-10-98><a class=lnlinks href=#hl-10-98> 98</a>
</span><span class=lnt id=hl-10-99><a class=lnlinks href=#hl-10-99> 99</a>
</span><span class=lnt id=hl-10-100><a class=lnlinks href=#hl-10-100>100</a>
</span><span class=lnt id=hl-10-101><a class=lnlinks href=#hl-10-101>101</a>
</span><span class=lnt id=hl-10-102><a class=lnlinks href=#hl-10-102>102</a>
</span><span class=lnt id=hl-10-103><a class=lnlinks href=#hl-10-103>103</a>
</span><span class=lnt id=hl-10-104><a class=lnlinks href=#hl-10-104>104</a>
</span><span class=lnt id=hl-10-105><a class=lnlinks href=#hl-10-105>105</a>
</span><span class=lnt id=hl-10-106><a class=lnlinks href=#hl-10-106>106</a>
</span><span class=lnt id=hl-10-107><a class=lnlinks href=#hl-10-107>107</a>
</span><span class=lnt id=hl-10-108><a class=lnlinks href=#hl-10-108>108</a>
</span><span class=lnt id=hl-10-109><a class=lnlinks href=#hl-10-109>109</a>
</span><span class=lnt id=hl-10-110><a class=lnlinks href=#hl-10-110>110</a>
</span><span class=lnt id=hl-10-111><a class=lnlinks href=#hl-10-111>111</a>
</span><span class=lnt id=hl-10-112><a class=lnlinks href=#hl-10-112>112</a>
</span><span class=lnt id=hl-10-113><a class=lnlinks href=#hl-10-113>113</a>
</span><span class=lnt id=hl-10-114><a class=lnlinks href=#hl-10-114>114</a>
</span><span class=lnt id=hl-10-115><a class=lnlinks href=#hl-10-115>115</a>
</span><span class=lnt id=hl-10-116><a class=lnlinks href=#hl-10-116>116</a>
</span><span class=lnt id=hl-10-117><a class=lnlinks href=#hl-10-117>117</a>
</span><span class=lnt id=hl-10-118><a class=lnlinks href=#hl-10-118>118</a>
</span><span class=lnt id=hl-10-119><a class=lnlinks href=#hl-10-119>119</a>
</span><span class=lnt id=hl-10-120><a class=lnlinks href=#hl-10-120>120</a>
</span><span class=lnt id=hl-10-121><a class=lnlinks href=#hl-10-121>121</a>
</span><span class=lnt id=hl-10-122><a class=lnlinks href=#hl-10-122>122</a>
</span><span class=lnt id=hl-10-123><a class=lnlinks href=#hl-10-123>123</a>
</span><span class=lnt id=hl-10-124><a class=lnlinks href=#hl-10-124>124</a>
</span><span class=lnt id=hl-10-125><a class=lnlinks href=#hl-10-125>125</a>
</span><span class=lnt id=hl-10-126><a class=lnlinks href=#hl-10-126>126</a>
</span><span class=lnt id=hl-10-127><a class=lnlinks href=#hl-10-127>127</a>
</span><span class=lnt id=hl-10-128><a class=lnlinks href=#hl-10-128>128</a>
</span><span class=lnt id=hl-10-129><a class=lnlinks href=#hl-10-129>129</a>
</span><span class=lnt id=hl-10-130><a class=lnlinks href=#hl-10-130>130</a>
</span><span class=lnt id=hl-10-131><a class=lnlinks href=#hl-10-131>131</a>
</span><span class=lnt id=hl-10-132><a class=lnlinks href=#hl-10-132>132</a>
</span><span class=lnt id=hl-10-133><a class=lnlinks href=#hl-10-133>133</a>
</span><span class=lnt id=hl-10-134><a class=lnlinks href=#hl-10-134>134</a>
</span><span class=lnt id=hl-10-135><a class=lnlinks href=#hl-10-135>135</a>
</span><span class=lnt id=hl-10-136><a class=lnlinks href=#hl-10-136>136</a>
</span><span class=lnt id=hl-10-137><a class=lnlinks href=#hl-10-137>137</a>
</span><span class=lnt id=hl-10-138><a class=lnlinks href=#hl-10-138>138</a>
</span><span class=lnt id=hl-10-139><a class=lnlinks href=#hl-10-139>139</a>
</span><span class=lnt id=hl-10-140><a class=lnlinks href=#hl-10-140>140</a>
</span><span class=lnt id=hl-10-141><a class=lnlinks href=#hl-10-141>141</a>
</span><span class=lnt id=hl-10-142><a class=lnlinks href=#hl-10-142>142</a>
</span><span class=lnt id=hl-10-143><a class=lnlinks href=#hl-10-143>143</a>
</span><span class=lnt id=hl-10-144><a class=lnlinks href=#hl-10-144>144</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 메시지 라우팅 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RoutingStrategy</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;라우팅 전략 추상 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>determine_route</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;라우팅 대상 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ContentBasedRouter</span><span class=p>(</span><span class=n>RoutingStrategy</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;콘텐츠 기반 라우팅 전략&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_amount&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;high_value&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;threshold&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span> <span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;premium_processing&#34;</span><span class=p>,</span> <span class=s2>&#34;finance_review&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;standard&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;threshold&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span> <span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;standard_processing&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;low_value&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;threshold&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;automated_processing&#34;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;customer_tier&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;VIP&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;vip_processing&#34;</span><span class=p>,</span> <span class=s2>&#34;dedicated_support&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;PREMIUM&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;premium_processing&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;STANDARD&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;standard_processing&#34;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;region&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;US&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;us_processing_center&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EU&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;eu_processing_center&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ASIA&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;routes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;asia_processing_center&#34;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>determine_route</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 내용 기반 라우팅 대상 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>routes</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 금액 기반 라우팅</span>
</span></span><span class=line><span class=cl>        <span class=n>order_amount</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;order_amount&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>amount_routes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_amount_based_routes</span><span class=p>(</span><span class=n>order_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>routes</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>amount_routes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 고객 등급 기반 라우팅</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_tier</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;customer_tier&#34;</span><span class=p>,</span> <span class=s2>&#34;STANDARD&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>tier_routes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span><span class=p>[</span><span class=s2>&#34;customer_tier&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>customer_tier</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;routes&#34;</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>        <span class=n>routes</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>tier_routes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 지역 기반 라우팅</span>
</span></span><span class=line><span class=cl>        <span class=n>region</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;region&#34;</span><span class=p>,</span> <span class=s2>&#34;US&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>region_routes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span><span class=p>[</span><span class=s2>&#34;region&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>region</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;routes&#34;</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>        <span class=n>routes</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>region_routes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>routes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_amount_based_routes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 금액 기반 라우팅 규칙&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>amount</span> <span class=o>&gt;=</span> <span class=mi>1000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span><span class=p>[</span><span class=s2>&#34;order_amount&#34;</span><span class=p>][</span><span class=s2>&#34;high_value&#34;</span><span class=p>][</span><span class=s2>&#34;routes&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>amount</span> <span class=o>&gt;=</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span><span class=p>[</span><span class=s2>&#34;order_amount&#34;</span><span class=p>][</span><span class=s2>&#34;standard&#34;</span><span class=p>][</span><span class=s2>&#34;routes&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span><span class=p>[</span><span class=s2>&#34;order_amount&#34;</span><span class=p>][</span><span class=s2>&#34;low_value&#34;</span><span class=p>][</span><span class=s2>&#34;routes&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageRouter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메시지 라우터&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_strategy</span><span class=p>:</span> <span class=n>RoutingStrategy</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>routing_strategy</span> <span class=o>=</span> <span class=n>routing_strategy</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>route_handlers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>callable</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>routing_statistics</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_route_handler</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>route_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;라우팅 핸들러 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>route_handlers</span><span class=p>[</span><span class=n>route_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>handler</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>routing_statistics</span><span class=p>[</span><span class=n>route_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;message_count&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;success_count&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Registered handler for route: </span><span class=si>{</span><span class=n>route_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>route_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 라우팅 수행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 라우팅 대상 결정</span>
</span></span><span class=line><span class=cl>            <span class=n>target_routes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_strategy</span><span class=o>.</span><span class=n>determine_route</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>target_routes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=n>RoutingError</span><span class=p>(</span><span class=s2>&#34;No valid routes found for message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 각 라우팅 대상에 메시지 전달</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>route</span> <span class=ow>in</span> <span class=n>target_routes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_deliver_to_route</span><span class=p>(</span><span class=n>route</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>routing_results</span><span class=p>[</span><span class=n>route</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 통계 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>routing_statistics</span><span class=p>[</span><span class=n>route</span><span class=p>][</span><span class=s2>&#34;message_count&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>routing_statistics</span><span class=p>[</span><span class=n>route</span><span class=p>][</span><span class=s2>&#34;success_count&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;message_id&#34;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;message_id&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;routes_used&#34;</span><span class=p>:</span> <span class=n>target_routes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;routing_results&#34;</span><span class=p>:</span> <span class=n>routing_results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;routing_timestamp&#34;</span><span class=p>:</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>RoutingError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Message routing failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_deliver_to_route</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>route_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;특정 라우트로 메시지 전달&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>route_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>route_handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;No handler for route: </span><span class=si>{</span><span class=n>route_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>handler</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>route_handlers</span><span class=p>[</span><span class=n>route_name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>handler</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Message routed to </span><span class=si>{</span><span class=n>route_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;message_id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;result&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_routing_statistics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;라우팅 통계 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_statistics</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RoutingError</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;라우팅 오류 예외 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 라우팅 핸들러 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>premium_processing_handler</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;프리미엄 처리 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Premium processing: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 프리미엄 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;premium_processed&#34;</span><span class=p>,</span> <span class=s2>&#34;processing_time&#34;</span><span class=p>:</span> <span class=mf>0.2</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>standard_processing_handler</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;표준 처리 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Standard processing: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>  <span class=c1># 표준 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;standard_processed&#34;</span><span class=p>,</span> <span class=s2>&#34;processing_time&#34;</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=message-transformation>Message Transformation<a hidden class=anchor aria-hidden=true href=#message-transformation>#</a></h4><p><strong>정의</strong>: 서로 다른 시스템 간 메시지 포맷을 변환하는 기법</p><p><strong>구성</strong>: 변환 엔진, 매핑 규칙, 포맷 어댑터</p><p><strong>목적</strong>: 이기종 시스템 간 호환성 확보</p><p><strong>실제 예시</strong>:</p><ul><li><strong>시스템 구성</strong>: ERP 와 CRM 시스템 통합</li><li><strong>시나리오</strong>: ERP 고객 데이터 → 포맷 변환 → CRM 시스템 연동</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53>53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54>54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55>55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56>56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57>57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58>58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59>59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60>60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61>61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62>62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63>63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64>64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65>65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66>66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67>67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68>68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69>69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70>70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71>71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72>72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73>73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74>74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75>75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76>76</a>
</span><span class=lnt id=hl-11-77><a class=lnlinks href=#hl-11-77>77</a>
</span><span class=lnt id=hl-11-78><a class=lnlinks href=#hl-11-78>78</a>
</span><span class=lnt id=hl-11-79><a class=lnlinks href=#hl-11-79>79</a>
</span><span class=lnt id=hl-11-80><a class=lnlinks href=#hl-11-80>80</a>
</span><span class=lnt id=hl-11-81><a class=lnlinks href=#hl-11-81>81</a>
</span><span class=lnt id=hl-11-82><a class=lnlinks href=#hl-11-82>82</a>
</span><span class=lnt id=hl-11-83><a class=lnlinks href=#hl-11-83>83</a>
</span><span class=lnt id=hl-11-84><a class=lnlinks href=#hl-11-84>84</a>
</span><span class=lnt id=hl-11-85><a class=lnlinks href=#hl-11-85>85</a>
</span><span class=lnt id=hl-11-86><a class=lnlinks href=#hl-11-86>86</a>
</span><span class=lnt id=hl-11-87><a class=lnlinks href=#hl-11-87>87</a>
</span><span class=lnt id=hl-11-88><a class=lnlinks href=#hl-11-88>88</a>
</span><span class=lnt id=hl-11-89><a class=lnlinks href=#hl-11-89>89</a>
</span><span class=lnt id=hl-11-90><a class=lnlinks href=#hl-11-90>90</a>
</span><span class=lnt id=hl-11-91><a class=lnlinks href=#hl-11-91>91</a>
</span><span class=lnt id=hl-11-92><a class=lnlinks href=#hl-11-92>92</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 메시지 변환 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>xml.etree.ElementTree</span> <span class=k>as</span> <span class=nn>ET</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageTransformer</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메시지 변환기 추상 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 변환 추상 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ERPToCRMTransformer</span><span class=p>(</span><span class=n>MessageTransformer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ERP에서 CRM으로 고객 데이터 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>erp_message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;ERP 포맷을 CRM 포맷으로 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># ERP 포맷 (XML 기반) → CRM 포맷 (JSON 기반) 변환</span>
</span></span><span class=line><span class=cl>            <span class=n>crm_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;client_code&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;personal_info&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;full_name&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;first_name&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;last_name&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>strip</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;email&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;email_address&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;phone&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;contact_number&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;business_info&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;company&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;organization&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;industry&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;business_sector&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;annual_revenue&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;yearly_revenue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;account_status&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_map_status</span><span class=p>(</span><span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;status&#34;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;created_date&#34;</span><span class=p>:</span> <span class=n>erp_message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;registration_date&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;source_system&#34;</span><span class=p>:</span> <span class=s2>&#34;ERP&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>crm_message</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>TransformationError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ERP to CRM transformation failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_map_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>erp_status</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;ERP 상태를 CRM 상태로 매핑&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>status_mapping</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ACTIVE&#34;</span><span class=p>:</span> <span class=s2>&#34;active&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;INACTIVE&#34;</span><span class=p>:</span> <span class=s2>&#34;dormant&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SUSPENDED&#34;</span><span class=p>:</span> <span class=s2>&#34;suspended&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;TERMINATED&#34;</span><span class=p>:</span> <span class=s2>&#34;closed&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>status_mapping</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>erp_status</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TransformationError</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;변환 오류 예외 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageTransformationEngine</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메시지 변환 엔진&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>MessageTransformer</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transformation_rules</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_transformer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>source_format</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target_format</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>transformer</span><span class=p>:</span> <span class=n>MessageTransformer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;변환기 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>source_format</span><span class=si>}</span><span class=s2>_to_</span><span class=si>{</span><span class=n>target_format</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>transformer</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transformation_rules</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>source_format</span><span class=si>}</span><span class=s2> → </span><span class=si>{</span><span class=n>target_format</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Registered transformer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>transformation_rules</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transform_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span> <span class=n>source_format</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target_format</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 변환 수행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>source_format</span><span class=si>}</span><span class=s2>_to_</span><span class=si>{</span><span class=n>target_format</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>TransformationError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No transformer found for </span><span class=si>{</span><span class=n>source_format</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target_format</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>transformer</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>transformed_message</span> <span class=o>=</span> <span class=n>transformer</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Successfully transformed message from </span><span class=si>{</span><span class=n>source_format</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target_format</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>transformed_message</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>TransformationError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Transformation failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_supported_transformations</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;지원되는 변환 목록 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>transformation_rules</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>카테고리</th><th>장점 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>구조적 특성</strong></td><td>느슨한 결합</td><td>브로커 중개로 컴포넌트 간 의존성 제거 → 시스템 모듈화 용이</td></tr><tr><td></td><td>다중 패턴 지원</td><td>다양한 메시징 패턴 지원으로 아키텍처 구성의 유연성 확보</td></tr><tr><td><strong>확장성과 유연성</strong></td><td>확장성</td><td>컨슈머 추가로 수평적 확장 가능, 서비스 단위 확장 지원</td></tr><tr><td></td><td>라우팅 유연성</td><td>Content-based Router, Header Router 등으로 메시지 분기 가능</td></tr><tr><td><strong>내결함성과 안정성</strong></td><td>내결함성</td><td>메시지 지속성, 재시도, DLQ 등으로 장애 복원력 강화</td></tr><tr><td></td><td>부하 분산</td><td>컨슈머 그룹, 메시지 큐로 트래픽을 효율적으로 분산 처리</td></tr><tr><td><strong>운영 편의성</strong></td><td>모니터링 및 관리</td><td>브로커 기반으로 전체 메시지 흐름 시각화, 성능 모니터링 가능</td></tr><tr><td></td><td>실시간성</td><td>메시지 발생 → 전파까지 지연이 적고 반응 속도 우수</td></tr><tr><td><strong>기술 통합성</strong></td><td>통합 용이성</td><td>프로토콜 호환성, 포맷 변환으로 이기종 시스템 연동 가능</td></tr><tr><td><strong>처리 효율성</strong></td><td>비동기 처리</td><td>송신자와 수신자 간의 시간적 결합을 제거하여 응답 대기 없음</td></tr><tr><td><strong>신뢰성과 품질 보장</strong></td><td>신뢰성</td><td>Ack, Retry, 순서 보장, 지속성 저장 등을 통해 메시지 전달 품질 확보</td></tr></tbody></table><ul><li><p><strong>신뢰성 보장 요소</strong>:</p><ul><li>Exactly-once Delivery 지원 여부는 브로커 종류에 따라 제한됨 (ex: Kafka 는 트랜잭션 필요)</li><li>순서 보장은 Partition Key 전략이 수반되어야 함</li></ul></li><li><p><strong>확장성과 모니터링의 트레이드오프</strong>:</p><ul><li>수평 확장성은 분산 추적 (Distributed Tracing) 과의 연계가 필수</li></ul></li><li><p><strong>이기종 통합과 운영 자동화</strong>:</p><ul><li>Schema Registry 및 API Gateway 연동으로 메시지 통합 품질 유지</li><li>GitOps 기반 메시지 설정 변경 → 운영 자동화 강화 가능</li></ul></li></ul><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>항목</th><th>설명</th><th>주요 원인</th><th>해결 방안</th></tr></thead><tbody><tr><td><strong>아키텍처 복잡도 증가</strong></td><td>브로커, 스키마 레지스트리, DLQ 등 추가 요소 도입으로 시스템 구성 복잡화</td><td>미들웨어 추가, 표준 미정</td><td>IaC 도입, Helm/Ansible 통한 배포 자동화, 명확한 아키텍처 도식화 및 운영 문서 구축</td></tr><tr><td><strong>성능 오버헤드</strong></td><td>메시지 직렬화/역직렬화 및 네트워크 전송으로 인한 처리 지연</td><td>네트워크 I/O, 포맷 변환</td><td>Protocol Buffers/Avro 등 경량 포맷 사용, 배치 전송, 브로커 튜닝 (Kafka Compression 등)</td></tr><tr><td><strong>메시지 순서 보장 어려움</strong></td><td>병렬 소비, 파티션 설계 미흡으로 인해 순서 역전 발생 가능</td><td>잘못된 파티셔닝 또는 병렬 처리 설계</td><td>파티션 키 기반 처리, 순서 재정렬 큐, Kafka 의 consumer group 단일 처리 방식 적용</td></tr><tr><td><strong>디버깅 및 모니터링 어려움</strong></td><td>비동기 흐름으로 호출 흐름 추적 및 원인 분석이 어려움</td><td>메시지 비동기성</td><td>분산 트레이싱 도구 (Jaeger, Zipkin), Correlation ID, 중앙 집중식 로깅 도입</td></tr><tr><td><strong>운영/테스트 어려움</strong></td><td>시뮬레이션 테스트 어려움, 비동기성으로 인한 복잡한 테스트 시나리오 구성</td><td>멱등성/순서 보장 등 테스트 케이스 증가</td><td>Contract Testing (Pact), 메시지 시뮬레이터, Chaos 메시징 테스트 도입</td></tr><tr><td><strong>의존성 및 SPOF 문제</strong></td><td>브로커 장애 시 시스템 전체 통신 중단 위험</td><td>단일 인스턴스, 비이중화 구성</td><td>클러스터링 구성, 멀티 리전 배포, Active-Active 구성, Failover 컨슈머</td></tr><tr><td><strong>운영비용 증가</strong></td><td>자체 브로커 구축/유지에 인프라 자원 및 인력 소모</td><td>관리 복잡도, 수동 운영</td><td>AWS SQS/Kinesis, GCP PubSub 등 관리형 브로커 사용, Terraform 기반 운영 자동화</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>항목</th><th>설명</th><th>주요 원인</th><th>영향</th><th>탐지 및 진단 기법</th><th>예방 방법</th><th>해결 방법</th></tr></thead><tbody><tr><td><strong>메시지 중복 수신</strong></td><td>동일 메시지가 재처리되며 트랜잭션 중복, 데이터 불일치 유발</td><td>네트워크 재시도, ACK 누락, 중복 소비자 실행</td><td>데이터 무결성 훼손, 트랜잭션 오류</td><td>메시지 ID 해시 로그, 컨슈머 로그 분석</td><td>Idempotency 키, Exactly-once 처리 보장</td><td>메시지 Deduplication 로직, DB 유니크 제약, 중복 방지 키 활용</td></tr><tr><td><strong>메시지 유실</strong></td><td>전달 중 네트워크 오류 또는 브로커 장애로 메시지가 소실됨</td><td>ACK 미수신, 잘못된 QoS 설정, 브로커 다운</td><td>비즈니스 이벤트 손실, 상태 오류</td><td>DLQ 모니터링, 메시지 카운트/ACK 매트릭 분석</td><td>메시지 지속성 설정 (durable), 브로커 복제 구성</td><td>DLQ 재처리, 이벤트 재발행 시스템, 보상 트랜잭션</td></tr><tr><td><strong>메시지 순서 역전</strong></td><td>병렬 처리 시 메시지 순서 보장 실패로 로직 오류 발생</td><td>파티션 키 미설계, 클러스터 내 시간차, 재시도 로직</td><td>상태 비일관성, 사용자 혼란</td><td>메시지 시퀀스 번호 분석, 처리 순서 로그 추적</td><td>Key-based 파티셔닝, 단일 소비자 처리 방식</td><td>순서 재정렬 큐 구현, 이벤트 스토어 적용</td></tr><tr><td><strong>메시지 지연 및 큐 정체</strong></td><td>브로커 적재, 소비자 병목으로 인한 지연 축적</td><td>소비자 처리 속도 &lt; 생산자 속도, 파티션 불균형</td><td>SLA 위반, 시스템 응답 지연</td><td>큐 길이 및 처리 지연 모니터링, 소비자 처리 속도 메트릭</td><td>자동 스케일링, 컨슈머 수 조정, 배치 크기 최적화</td><td>Throttling, Backpressure 패턴, 큐 TTL/우선순위 정책</td></tr><tr><td><strong>메모리/디스크 폭주</strong></td><td>무한 큐 적재, DLQ 누적, 소비자 오류 시 메시지 적체</td><td>TTL 미설정, 처리 실패 반복, 리소스 제한 없음</td><td>장애 확산, 브로커 다운</td><td>브로커 메모리/디스크 모니터링, DLQ 크기 경고</td><td>TTL 설정, 큐 사이즈 제한, 메시지 만료 정책 도입</td><td>아카이빙 큐 구성, 자동 삭제, DLQ 수동 클린업</td></tr><tr><td><strong>보안 취약점</strong></td><td>메시지 전송 구간에서 암호화/인증 미비</td><td>TLS 미사용, 인증 미구현</td><td>데이터 유출, 위변조 가능성</td><td>전송 구간 암호화 여부 검사, 인증 로그 분석</td><td>TLS/SSL 적용, OAuth2/JWT 기반 인증 체계</td><td>메시지 암호화, 역할 기반 접근 제어 (RBAC), ACL 구성</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>도전 과제</strong></th><th><strong>원인</strong></th><th><strong>영향</strong></th><th><strong>탐지 및 진단</strong></th><th><strong>예방 및 해결 전략</strong></th></tr></thead><tbody><tr><td><strong>성능/확장성</strong></td><td>대용량 메시지 처리</td><td>IoT, 스트리밍 환경의 초당 수백만 메시지</td><td>시스템 부하, 지연, 데이터 유실</td><td>메시지 큐 길이, Throughput 모니터링</td><td>수평 스케일링, 메시지 배치 처리, 압축, 클러스터링</td></tr><tr><td></td><td>낮은 지연 시간 요구</td><td>실시간 거래, 게임, 센서 이벤트</td><td>사용자 응답 지연, SLA 미달</td><td>P99 지연 측정</td><td>인메모리 브로커, RDMA, 엣지 컴퓨팅</td></tr><tr><td></td><td>메시지 순서 보장</td><td>분산 처리로 인한 순서 왜곡</td><td>비즈니스 오류 발생</td><td>메시지 ID 기반 추적</td><td>파티션 키, 순서 큐, 트랜잭션 메시징</td></tr><tr><td></td><td>멀티클라우드 일관성</td><td>지연, 장애영역 분할 (partition)</td><td>메시지 중복/유실, 상태 불일치</td><td>컨슈머 간 상태 차이 분석</td><td>CRDT, 이벤트 소싱, 글로벌 오더링 제한</td></tr><tr><td><strong>신뢰성/정확성</strong></td><td>Exactly-once 보장</td><td>Kafka 등 대부분 at-least-once</td><td>중복 처리, 비즈니스 오류</td><td>메시지 중복 수신 감지</td><td>Idempotent 처리, Outbox 패턴, 트랜잭션 사용</td></tr><tr><td></td><td>메시지 유실 방지</td><td>네트워크 장애, 브로커 장애</td><td>데이터 손실</td><td>DLQ, 로그 미수신 감지</td><td>재시도 큐, 메시지 영속화, 브로커 이중화</td></tr><tr><td></td><td>에러 복구 및 재처리</td><td>비동기/비결정성 로직, 상태 누락</td><td>재처리 실패, 데이터 불일치</td><td>에러 로그, 상태 기반 리플레이</td><td>에러 큐, 재처리 자동화, 재처리 idempotency 보장</td></tr><tr><td><strong>운영/관찰성</strong></td><td>복잡성 증가</td><td>다양한 패턴, 브로커, 프로토콜 혼재</td><td>운영 복잡, 장애 분석 어려움</td><td>이벤트 흐름 시각화</td><td>표준 패턴 사용, 브로커 통합, 자동화 도구 도입</td></tr><tr><td></td><td>모니터링/추적 어려움</td><td>분산 구조, 상태 분산</td><td>문제 탐지 지연</td><td>Trace-context 추적</td><td>OpenTelemetry, 분산 트레이싱, 메트릭 통합</td></tr><tr><td></td><td>클러스터 운영/확장</td><td>수동 업그레이드, 노드 관리</td><td>가용성 저하, 유지보수 부담</td><td>브로커 상태 로그 분석</td><td>롤링 업그레이드 자동화, 오케스트레이션</td></tr><tr><td></td><td>자동 운영 필요</td><td>수많은 구성요소 수동 관리</td><td>운영 비용 증가, 장애 위험</td><td>이상 징후 탐지 정확도</td><td>AI 기반 자동복구, 예측적 스케일링, Rule 기반 트리거</td></tr><tr><td><strong>보안/거버넌스</strong></td><td>메시지 보안</td><td>민감정보 포함 메시지, 외부 노출 가능성</td><td>정보 유출</td><td>패킷 스니핑 감지, 암호화 여부 검사</td><td>TLS, 메시지 암호화, JWT, OAuth2</td></tr><tr><td></td><td>접근 제어/감사</td><td>멀티테넌시, 복수 소비자 존재</td><td>오용 위험, 추적 불가</td><td>인증 로그 분석</td><td>ACL, RBAC, 감사로그 중앙집중화</td></tr><tr><td></td><td>규정 준수 (GDPR 등)</td><td>개인정보 포함 메시지, 삭제/보존 이슈</td><td>법적 위반</td><td>데이터 추적 및 삭제 요청 관리</td><td>데이터 마스킹, 삭제 API, 저장소 분리</td></tr><tr><td><strong>데이터 계약 관리</strong></td><td>스키마 호환성</td><td>Protobuf/Avro 변경 시 다운스트림 오류</td><td>역직렬화 실패, 시스템 장애</td><td>스키마 mismatch 감지</td><td>Schema Registry 운영, backward compatible 설계</td></tr><tr><td><strong>트랜잭션 처리</strong></td><td>분산 트랜잭션</td><td>다수 서비스 간 상태 동기화 요구</td><td>원자성, 일관성 저해</td><td>이벤트 이상 탐지</td><td>Saga 패턴, 2PC, 보상 트랜잭션</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><h4 id=통신-패턴-communication-pattern>통신 패턴 (Communication Pattern)<a hidden class=anchor aria-hidden=true href=#통신-패턴-communication-pattern>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>특징 및 사용 사례</th></tr></thead><tbody><tr><td>Point-to-Point</td><td>1:1 큐 기반 메시지 전달</td><td>워커 풀 패턴, 작업 분산, 로드 밸런싱 가능</td></tr><tr><td>Publish-Subscribe</td><td>1:N 토픽 기반 브로드캐스트</td><td>이벤트 알림, 로그 수집, 다중 수신자 처리</td></tr><tr><td>Request-Reply</td><td>요청과 응답을 구분하는 패턴 (보통 임시 큐 사용)</td><td>RPC 스타일, 동기 호출 필요 시 사용</td></tr><tr><td>Fire-and-Forget</td><td>응답 없이 메시지만 전송</td><td>알림, 로깅, 성능 우선 처리</td></tr><tr><td>Push-Pull</td><td>MQ 기반으로 생산자 (Push), 소비자 (Pull) 분리</td><td>병렬 처리, 분산 처리에서 활용</td></tr></tbody></table><h4 id=메시지-전달-보장-수준-delivery-guarantee>메시지 전달 보장 수준 (Delivery Guarantee)<a hidden class=anchor aria-hidden=true href=#메시지-전달-보장-수준-delivery-guarantee>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>특징 및 적용 상황</th></tr></thead><tbody><tr><td>At-Most-Once</td><td>최대 한 번 전달</td><td>손실 가능성 있음, 중복 없음, 성능 최우선</td></tr><tr><td>At-Least-Once</td><td>최소 한 번 전달</td><td>손실 없음, 중복 가능, 멱등성 필요</td></tr><tr><td>Exactly-Once</td><td>정확히 한 번만 전달</td><td>손실 및 중복 없음, 트랜잭션 기반 처리, 높은 복잡도</td></tr></tbody></table><h4 id=메시지-순서-보장-방식-ordering-guarantee>메시지 순서 보장 방식 (Ordering Guarantee)<a hidden class=anchor aria-hidden=true href=#메시지-순서-보장-방식-ordering-guarantee>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>특징</th></tr></thead><tbody><tr><td>FIFO</td><td>큐 기반 순서 보장 (First-In First-Out)</td><td>단일 파티션 필수, 처리량 제한 가능</td></tr><tr><td>Partition + Key</td><td>키 기반 순서 보장</td><td>Kafka 등의 분산 시스템에서 일반적인 방식</td></tr><tr><td>Session-Based</td><td>세션을 통한 순서 보장</td><td>순서가 중요한 사용자 요청 흐름 등에 사용</td></tr><tr><td>Unordered</td><td>순서 미보장</td><td>처리량 극대화, 순서 무관한 로그/이벤트 수집</td></tr></tbody></table><h4 id=메시지-지속성-message-durability>메시지 지속성 (Message Durability)<a hidden class=anchor aria-hidden=true href=#메시지-지속성-message-durability>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>사용 사례 및 트레이드오프</th></tr></thead><tbody><tr><td>Persistent</td><td>디스크 저장, 장애 발생 시 복구 가능</td><td>금융, 주문 등 신뢰성 필요한 메시지</td></tr><tr><td>Non-Persistent</td><td>메모리 저장, 빠르지만 유실 가능</td><td>실시간 피드, 임시 이벤트 등</td></tr><tr><td>Mixed</td><td>메시지 단위로 지속성 옵션 선택 가능</td><td>유연한 성능 - 신뢰성 조정</td></tr></tbody></table><h4 id=라우팅-방식-routing-strategy>라우팅 방식 (Routing Strategy)<a hidden class=anchor aria-hidden=true href=#라우팅-방식-routing-strategy>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>사용 목적</th></tr></thead><tbody><tr><td>Topic-Based</td><td>토픽 이름 기반 라우팅</td><td>카테고리화된 이벤트 처리</td></tr><tr><td>Content-Based</td><td>메시지 내용에 따라 분기 처리</td><td>조건부 라우팅, DSL 기반 규칙 처리</td></tr><tr><td>Header-Based</td><td>메시지 헤더 값 기준 라우팅</td><td>우선순위, 사용자 타입 등에 따른 라우팅 분기 처리</td></tr></tbody></table><h4 id=아키텍처-토폴로지-topology-structure>아키텍처 토폴로지 (Topology Structure)<a hidden class=anchor aria-hidden=true href=#아키텍처-토폴로지-topology-structure>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>장점 / 단점</th></tr></thead><tbody><tr><td>Hub-and-Spoke</td><td>중앙 브로커 중심 구조</td><td>간단한 관리 / 단일 실패점 위험</td></tr><tr><td>Distributed (Mesh)</td><td>브로커 간 분산 구조</td><td>높은 확장성과 장애 내성 / 구성 복잡도 높음</td></tr><tr><td>Hybrid</td><td>중앙 집중 + 분산 브로커 혼합</td><td>유연한 마이그레이션 가능 / 복잡한 통합 로직 필요</td></tr></tbody></table><h4 id=배포-환경-deployment-model>배포 환경 (Deployment Model)<a hidden class=anchor aria-hidden=true href=#배포-환경-deployment-model>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>예시 및 특징</th></tr></thead><tbody><tr><td>On-Premise</td><td>자체 서버에 직접 브로커 설치 및 운영</td><td>ActiveMQ, RabbitMQ 등</td></tr><tr><td>Cloud Managed</td><td>클라우드 제공자의 관리형 메시징 서비스 사용</td><td>Amazon SQS, Google PubSub, Azure Service Bus 등</td></tr></tbody></table><h4 id=메시지-목적-message-semantic>메시지 목적 (Message Semantic)<a hidden class=anchor aria-hidden=true href=#메시지-목적-message-semantic>#</a></h4><table><thead><tr><th>유형</th><th>설명</th><th>사용 사례</th></tr></thead><tbody><tr><td>Command</td><td>명령형 메시지, 액션 트리거 목적</td><td>워크플로우 명령 전파, 트랜잭션 시작</td></tr><tr><td>Event</td><td>상태 변화 이벤트 전달 목적</td><td>사용자 행동 로그, 상태 동기화</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>사용 목적</strong></th><th><strong>기술 스택 예시</strong></th><th><strong>효과</strong></th><th><strong>대표 시나리오</strong></th></tr></thead><tbody><tr><td><strong>1. 서비스 통신</strong></td><td>마이크로서비스 간 비동기 통신</td><td>Kafka, RabbitMQ, AMQP, gRPC, API Gateway</td><td>느슨한 결합, 독립 배포, 장애 격리</td><td>Netflix 서비스 간 통신, 주문 처리, 인증 등</td></tr><tr><td><strong>2. 실시간 스트리밍</strong></td><td>실시간 데이터 처리 및 분석</td><td>Apache Kafka, Flink, Pulsar, Storm, Elasticsearch</td><td>초당 수백만 건 처리, 이벤트 기반 대응, 로그 분석</td><td>Twitter 트렌딩 분석, LinkedIn 피드</td></tr><tr><td><strong>3. IoT/텔레메트리</strong></td><td>센서/디바이스 이벤트 수집 및 처리</td><td>MQTT, Kafka, Apache NiFi, InfluxDB, TimescaleDB</td><td>경량 메시징, 실시간 상태 모니터링, 이상 감지</td><td>Tesla 차량 데이터 수집, 스마트 시티 센서 네트워크</td></tr><tr><td><strong>4. 주문/결제 처리</strong></td><td>이벤트 기반 주문 및 후속 처리</td><td>RabbitMQ, Redis Queue, Celery, Spring Boot</td><td>주문 - 결제 - 배송 간 병렬 처리, 확장성 높은 처리 구조</td><td>이커머스 플랫폼의 주문 처리 워크플로우</td></tr><tr><td><strong>5. 알림/메시징</strong></td><td>실시간 알림/푸시 메시지 전송</td><td>Firebase, Redis Pub/Sub, WebSocket, SMS Gateway</td><td>빠른 응답성, 다채널 대응, 사용자 맞춤 메시징</td><td>모바일 푸시, 경고 알림, 사용자 알림 시스템</td></tr><tr><td><strong>6. 로그/모니터링</strong></td><td>서비스 로깅 및 시스템 모니터링</td><td>ELK Stack, Fluentd, Prometheus, Loki, OpenTelemetry</td><td>중앙 집중 수집, 시각화, 시스템 상태 분석</td><td>애플리케이션 로그 수집, 장애 탐지, 운영 대시보드 구축</td></tr><tr><td><strong>7. 배치/작업 큐</strong></td><td>비동기 백그라운드 작업 처리</td><td>Celery, Kafka, AWS SQS, Google Pub/Sub, Airflow</td><td>스케줄링, 병렬 처리, 안정적인 백엔드 워크플로우 관리</td><td>이미지 처리, 리포트 생성, 대용량 ETL 작업</td></tr><tr><td><strong>8. 이벤트 소싱/CQRS</strong></td><td>이벤트 저장/이벤트 기반 모델 구현</td><td>EventStore, Kafka, Axon, Domain Events, Akka</td><td>감사 추적, 데이터 복원, 도메인 기반 아키텍처 지원</td><td>금융 거래 이벤트, 전자상거래 주문 변경 이력 추적</td></tr><tr><td><strong>9. 게임/멀티미디어</strong></td><td>실시간 동기화, 콘텐츠 전송</td><td>WebSocket, Redis Streams, FFmpeg, CDN, Unity</td><td>실시간 상태 공유, 낮은 지연, 대규모 사용자 확장</td><td>실시간 채팅, 멀티플레이어 게임, 영상 스트리밍</td></tr><tr><td><strong>10. 시스템 통합</strong></td><td>이기종 시스템 간 통합</td><td>Kafka Connect, Camel, MuleSoft, API Gateway</td><td>언어/플랫폼 간 통합, 메시지 변환, 라우팅 자동화</td><td>레거시 ↔ 클라우드 통합, 온프레미스 ↔ SaaS 연동</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-마이크로서비스-기반-주문-처리-시스템>사례 1: 마이크로서비스 기반 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-마이크로서비스-기반-주문-처리-시스템>#</a></h4><p><strong>시스템 구성:</strong></p><ul><li>메시지 생산자: 주문 생성 서비스</li><li>메시지 브로커: RabbitMQ</li><li>메시지 소비자: 재고 관리, 결제, 배송 처리 서비스</li></ul><pre class=mermaid>flowchart TD
    A[Order Service] --&gt; B[RabbitMQ]
    B --&gt; C[Inventory Service]
    B --&gt; D[Payment Service]
    B --&gt; E[Shipping Service]
</pre><p><strong>워크플로우:</strong></p><ul><li>주문 생성 → RabbitMQ 로 메시지 발행 → 각 서비스가 메시지 구독 및 처리</li><li>주문 처리, 재고 차감, 결제, 배송 처리</li></ul><p><strong>Messaging-Oriented Styles 의 역할:</strong></p><ul><li>실시간 주문 처리, 확장성, 통합, 데이터 일관성 보장</li></ul><p><strong>Messaging-Oriented Styles 유무 차이:</strong></p><ul><li>미적용 시: 서비스 간 직접 호출로 인한 결합도 증가, 확장성 한계, 통합 어려움</li><li>적용 시: 실시간 처리, 확장性, 통합, 데이터 일관성 보장</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 생산자</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=s1>&#39;{&#34;order_id&#34;: &#34;ORD-12345&#34;}&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비자</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리: </span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>Pika</strong>는 파이썬에서 RabbitMQ 와 같은 메시지 브로커와 통신할 수 있도록 해주는, 순수 파이썬 (Pure-Python) 기반의 <strong>AMQP 0-9-1 프로토콜</strong> 클라이언트 라이브러리</p></blockquote><h4 id=사례-2-kafka-기반-마이크로서비스>사례 2: Kafka 기반 마이크로서비스<a hidden class=anchor aria-hidden=true href=#사례-2-kafka-기반-마이크로서비스>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li><strong>Producer 서비스</strong>: 사용자 이벤트 생성</li><li><strong>Kafka Broker</strong>: Topic 별 메시지 중계, 분산 저장</li><li><strong>Consumer 서비스</strong>: 이벤트 수신 및 처리</li><li><strong>Monitoring</strong>: Prometheus + Grafana 메트릭</li></ul><p><strong>Workflow</strong>:</p><pre class=mermaid>graph LR
  UserAction --&gt; Producer
  Producer --&gt;|send event| Kafka[Topic: user.events]
  Kafka --&gt; ConsumerA[Analytics Service]
  Kafka --&gt; ConsumerB[Notification Service]
</pre><ul><li><strong>Producer</strong>: 이벤트 생성 및 발행</li><li><strong>Kafka Broker</strong>: 메시지 큐잉 및 분산 보관</li><li><strong>Consumers</strong>: 독립 서비스로 병렬 소비<br>→ 느슨한 결합 기반에 확장성, 장애 격리 구현</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Producer</span>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;kafka:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;user.events&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;user_id&#39;</span><span class=p>:</span><span class=mi>123</span><span class=p>,</span> <span class=s1>&#39;action&#39;</span><span class=p>:</span><span class=s1>&#39;login&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Consumer</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=s1>&#39;user.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;kafka:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                         <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;analytics-group&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=n>process_login_event</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>  <span class=c1># 이벤트 처리 함수</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>토픽 기반 Pub/Sub 모델</li><li><code>group_id</code> 로 소비자 그룹 구성</li><li>JSON 직렬화/역직렬화 포함</li></ul><h4 id=사례-3-전자상거래-플랫폼의-주문-처리-시스템>사례 3: 전자상거래 플랫폼의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-전자상거래-플랫폼의-주문-처리-시스템>#</a></h4><p>Amazon 과 같은 대규모 전자상거래 플랫폼에서 Messaging-Oriented Styles 를 활용한 주문 처리 시스템을 분석.</p><p><strong>시스템 구성</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;E-commerce Order Processing System&#34;
        subgraph &#34;Frontend Layer&#34;
            WEB[Web Application]
            MOBILE[Mobile App]
            API[API Gateway]
        end
        
        subgraph &#34;Message Broker Layer&#34;
            BROKER[Apache Kafka Cluster]
            subgraph &#34;Topics&#34;
                ORDER_TOPIC[order.events]
                PAYMENT_TOPIC[payment.events]
                INVENTORY_TOPIC[inventory.events]
                SHIPPING_TOPIC[shipping.events]
                NOTIFICATION_TOPIC[notification.events]
            end
        end
        
        subgraph &#34;Microservices Layer&#34;
            ORDER_SVC[Order Service]
            PAYMENT_SVC[Payment Service]
            INVENTORY_SVC[Inventory Service]
            SHIPPING_SVC[Shipping Service]
            NOTIFICATION_SVC[Notification Service]
            ANALYTICS_SVC[Analytics Service]
        end
        
        subgraph &#34;Data Layer&#34;
            ORDER_DB[(Order DB)]
            PAYMENT_DB[(Payment DB)]
            INVENTORY_DB[(Inventory DB)]
            SHIPPING_DB[(Shipping DB)]
        end
    end
    
    WEB --&gt; API
    MOBILE --&gt; API
    API --&gt; ORDER_SVC
    
    ORDER_SVC --&gt; BROKER
    BROKER --&gt; ORDER_TOPIC
    BROKER --&gt; PAYMENT_TOPIC
    BROKER --&gt; INVENTORY_TOPIC
    BROKER --&gt; SHIPPING_TOPIC
    BROKER --&gt; NOTIFICATION_TOPIC
    
    ORDER_TOPIC --&gt; ORDER_SVC
    PAYMENT_TOPIC --&gt; PAYMENT_SVC
    INVENTORY_TOPIC --&gt; INVENTORY_SVC
    SHIPPING_TOPIC --&gt; SHIPPING_SVC
    NOTIFICATION_TOPIC --&gt; NOTIFICATION_SVC
    
    ORDER_TOPIC --&gt; ANALYTICS_SVC
    PAYMENT_TOPIC --&gt; ANALYTICS_SVC
    
    ORDER_SVC --&gt; ORDER_DB
    PAYMENT_SVC --&gt; PAYMENT_DB
    INVENTORY_SVC --&gt; INVENTORY_DB
    SHIPPING_SVC --&gt; SHIPPING_DB
</pre><p><strong>Workflow</strong></p><pre class=mermaid>sequenceDiagram
    participant Customer
    participant OrderService
    participant MessageBroker
    participant PaymentService
    participant InventoryService
    participant ShippingService
    participant NotificationService
    
    Customer-&gt;&gt;OrderService: Place Order
    OrderService-&gt;&gt;MessageBroker: Publish OrderCreated Event
    OrderService--&gt;&gt;Customer: Order Confirmation
    
    MessageBroker-&gt;&gt;PaymentService: OrderCreated Event
    MessageBroker-&gt;&gt;InventoryService: OrderCreated Event
    
    PaymentService-&gt;&gt;MessageBroker: Publish PaymentProcessing Event
    InventoryService-&gt;&gt;MessageBroker: Publish InventoryReserved Event
    
    MessageBroker-&gt;&gt;PaymentService: InventoryReserved Event
    PaymentService-&gt;&gt;MessageBroker: Publish PaymentCompleted Event
    
    MessageBroker-&gt;&gt;ShippingService: PaymentCompleted Event
    MessageBroker-&gt;&gt;NotificationService: PaymentCompleted Event
    
    ShippingService-&gt;&gt;MessageBroker: Publish ShippingStarted Event
    MessageBroker-&gt;&gt;NotificationService: ShippingStarted Event
    
    NotificationService-&gt;&gt;Customer: Order Shipped Notification
</pre><p><strong>Messaging-Oriented Styles 의 역할</strong>:</p><ul><li><strong>이벤트 기반 오케스트레이션</strong><ul><li>주문 생성 이벤트를 통한 후속 프로세스 자동 시작</li><li>각 서비스의 독립적인 비즈니스 로직 처리</li><li>이벤트 소싱을 통한 전체 주문 상태 추적</li></ul></li><li><strong>비동기 처리를 통한 성능 향상</strong><ul><li>고객은 즉시 주문 확인을 받고 나머지 처리는 백그라운드에서 진행</li><li>결제, 재고확인, 배송준비가 병렬로 처리되어 전체 처리 시간 단축</li><li>시스템 부하 분산을 통한 안정적인 서비스 제공</li></ul></li><li><strong>장애 격리 및 복원력</strong><ul><li>한 서비스의 장애가 전체 시스템에 영향을 주지 않음</li><li>메시지 재시도와 Dead Letter Queue 를 통한 오류 처리</li><li>서비스별 독립적인 스케일링과 배포</li></ul></li><li><strong>실시간 분석 및 모니터링</strong><ul><li>모든 이벤트가 메시지로 기록되어 실시간 분석 가능</li><li>비즈니스 메트릭과 운영 메트릭의 실시간 추적</li><li>고객 행동 패턴 분석과 개인화 서비스 제공</li></ul></li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span><span class=lnt id=hl-18-159><a class=lnlinks href=#hl-18-159>159</a>
</span><span class=lnt id=hl-18-160><a class=lnlinks href=#hl-18-160>160</a>
</span><span class=lnt id=hl-18-161><a class=lnlinks href=#hl-18-161>161</a>
</span><span class=lnt id=hl-18-162><a class=lnlinks href=#hl-18-162>162</a>
</span><span class=lnt id=hl-18-163><a class=lnlinks href=#hl-18-163>163</a>
</span><span class=lnt id=hl-18-164><a class=lnlinks href=#hl-18-164>164</a>
</span><span class=lnt id=hl-18-165><a class=lnlinks href=#hl-18-165>165</a>
</span><span class=lnt id=hl-18-166><a class=lnlinks href=#hl-18-166>166</a>
</span><span class=lnt id=hl-18-167><a class=lnlinks href=#hl-18-167>167</a>
</span><span class=lnt id=hl-18-168><a class=lnlinks href=#hl-18-168>168</a>
</span><span class=lnt id=hl-18-169><a class=lnlinks href=#hl-18-169>169</a>
</span><span class=lnt id=hl-18-170><a class=lnlinks href=#hl-18-170>170</a>
</span><span class=lnt id=hl-18-171><a class=lnlinks href=#hl-18-171>171</a>
</span><span class=lnt id=hl-18-172><a class=lnlinks href=#hl-18-172>172</a>
</span><span class=lnt id=hl-18-173><a class=lnlinks href=#hl-18-173>173</a>
</span><span class=lnt id=hl-18-174><a class=lnlinks href=#hl-18-174>174</a>
</span><span class=lnt id=hl-18-175><a class=lnlinks href=#hl-18-175>175</a>
</span><span class=lnt id=hl-18-176><a class=lnlinks href=#hl-18-176>176</a>
</span><span class=lnt id=hl-18-177><a class=lnlinks href=#hl-18-177>177</a>
</span><span class=lnt id=hl-18-178><a class=lnlinks href=#hl-18-178>178</a>
</span><span class=lnt id=hl-18-179><a class=lnlinks href=#hl-18-179>179</a>
</span><span class=lnt id=hl-18-180><a class=lnlinks href=#hl-18-180>180</a>
</span><span class=lnt id=hl-18-181><a class=lnlinks href=#hl-18-181>181</a>
</span><span class=lnt id=hl-18-182><a class=lnlinks href=#hl-18-182>182</a>
</span><span class=lnt id=hl-18-183><a class=lnlinks href=#hl-18-183>183</a>
</span><span class=lnt id=hl-18-184><a class=lnlinks href=#hl-18-184>184</a>
</span><span class=lnt id=hl-18-185><a class=lnlinks href=#hl-18-185>185</a>
</span><span class=lnt id=hl-18-186><a class=lnlinks href=#hl-18-186>186</a>
</span><span class=lnt id=hl-18-187><a class=lnlinks href=#hl-18-187>187</a>
</span><span class=lnt id=hl-18-188><a class=lnlinks href=#hl-18-188>188</a>
</span><span class=lnt id=hl-18-189><a class=lnlinks href=#hl-18-189>189</a>
</span><span class=lnt id=hl-18-190><a class=lnlinks href=#hl-18-190>190</a>
</span><span class=lnt id=hl-18-191><a class=lnlinks href=#hl-18-191>191</a>
</span><span class=lnt id=hl-18-192><a class=lnlinks href=#hl-18-192>192</a>
</span><span class=lnt id=hl-18-193><a class=lnlinks href=#hl-18-193>193</a>
</span><span class=lnt id=hl-18-194><a class=lnlinks href=#hl-18-194>194</a>
</span><span class=lnt id=hl-18-195><a class=lnlinks href=#hl-18-195>195</a>
</span><span class=lnt id=hl-18-196><a class=lnlinks href=#hl-18-196>196</a>
</span><span class=lnt id=hl-18-197><a class=lnlinks href=#hl-18-197>197</a>
</span><span class=lnt id=hl-18-198><a class=lnlinks href=#hl-18-198>198</a>
</span><span class=lnt id=hl-18-199><a class=lnlinks href=#hl-18-199>199</a>
</span><span class=lnt id=hl-18-200><a class=lnlinks href=#hl-18-200>200</a>
</span><span class=lnt id=hl-18-201><a class=lnlinks href=#hl-18-201>201</a>
</span><span class=lnt id=hl-18-202><a class=lnlinks href=#hl-18-202>202</a>
</span><span class=lnt id=hl-18-203><a class=lnlinks href=#hl-18-203>203</a>
</span><span class=lnt id=hl-18-204><a class=lnlinks href=#hl-18-204>204</a>
</span><span class=lnt id=hl-18-205><a class=lnlinks href=#hl-18-205>205</a>
</span><span class=lnt id=hl-18-206><a class=lnlinks href=#hl-18-206>206</a>
</span><span class=lnt id=hl-18-207><a class=lnlinks href=#hl-18-207>207</a>
</span><span class=lnt id=hl-18-208><a class=lnlinks href=#hl-18-208>208</a>
</span><span class=lnt id=hl-18-209><a class=lnlinks href=#hl-18-209>209</a>
</span><span class=lnt id=hl-18-210><a class=lnlinks href=#hl-18-210>210</a>
</span><span class=lnt id=hl-18-211><a class=lnlinks href=#hl-18-211>211</a>
</span><span class=lnt id=hl-18-212><a class=lnlinks href=#hl-18-212>212</a>
</span><span class=lnt id=hl-18-213><a class=lnlinks href=#hl-18-213>213</a>
</span><span class=lnt id=hl-18-214><a class=lnlinks href=#hl-18-214>214</a>
</span><span class=lnt id=hl-18-215><a class=lnlinks href=#hl-18-215>215</a>
</span><span class=lnt id=hl-18-216><a class=lnlinks href=#hl-18-216>216</a>
</span><span class=lnt id=hl-18-217><a class=lnlinks href=#hl-18-217>217</a>
</span><span class=lnt id=hl-18-218><a class=lnlinks href=#hl-18-218>218</a>
</span><span class=lnt id=hl-18-219><a class=lnlinks href=#hl-18-219>219</a>
</span><span class=lnt id=hl-18-220><a class=lnlinks href=#hl-18-220>220</a>
</span><span class=lnt id=hl-18-221><a class=lnlinks href=#hl-18-221>221</a>
</span><span class=lnt id=hl-18-222><a class=lnlinks href=#hl-18-222>222</a>
</span><span class=lnt id=hl-18-223><a class=lnlinks href=#hl-18-223>223</a>
</span><span class=lnt id=hl-18-224><a class=lnlinks href=#hl-18-224>224</a>
</span><span class=lnt id=hl-18-225><a class=lnlinks href=#hl-18-225>225</a>
</span><span class=lnt id=hl-18-226><a class=lnlinks href=#hl-18-226>226</a>
</span><span class=lnt id=hl-18-227><a class=lnlinks href=#hl-18-227>227</a>
</span><span class=lnt id=hl-18-228><a class=lnlinks href=#hl-18-228>228</a>
</span><span class=lnt id=hl-18-229><a class=lnlinks href=#hl-18-229>229</a>
</span><span class=lnt id=hl-18-230><a class=lnlinks href=#hl-18-230>230</a>
</span><span class=lnt id=hl-18-231><a class=lnlinks href=#hl-18-231>231</a>
</span><span class=lnt id=hl-18-232><a class=lnlinks href=#hl-18-232>232</a>
</span><span class=lnt id=hl-18-233><a class=lnlinks href=#hl-18-233>233</a>
</span><span class=lnt id=hl-18-234><a class=lnlinks href=#hl-18-234>234</a>
</span><span class=lnt id=hl-18-235><a class=lnlinks href=#hl-18-235>235</a>
</span><span class=lnt id=hl-18-236><a class=lnlinks href=#hl-18-236>236</a>
</span><span class=lnt id=hl-18-237><a class=lnlinks href=#hl-18-237>237</a>
</span><span class=lnt id=hl-18-238><a class=lnlinks href=#hl-18-238>238</a>
</span><span class=lnt id=hl-18-239><a class=lnlinks href=#hl-18-239>239</a>
</span><span class=lnt id=hl-18-240><a class=lnlinks href=#hl-18-240>240</a>
</span><span class=lnt id=hl-18-241><a class=lnlinks href=#hl-18-241>241</a>
</span><span class=lnt id=hl-18-242><a class=lnlinks href=#hl-18-242>242</a>
</span><span class=lnt id=hl-18-243><a class=lnlinks href=#hl-18-243>243</a>
</span><span class=lnt id=hl-18-244><a class=lnlinks href=#hl-18-244>244</a>
</span><span class=lnt id=hl-18-245><a class=lnlinks href=#hl-18-245>245</a>
</span><span class=lnt id=hl-18-246><a class=lnlinks href=#hl-18-246>246</a>
</span><span class=lnt id=hl-18-247><a class=lnlinks href=#hl-18-247>247</a>
</span><span class=lnt id=hl-18-248><a class=lnlinks href=#hl-18-248>248</a>
</span><span class=lnt id=hl-18-249><a class=lnlinks href=#hl-18-249>249</a>
</span><span class=lnt id=hl-18-250><a class=lnlinks href=#hl-18-250>250</a>
</span><span class=lnt id=hl-18-251><a class=lnlinks href=#hl-18-251>251</a>
</span><span class=lnt id=hl-18-252><a class=lnlinks href=#hl-18-252>252</a>
</span><span class=lnt id=hl-18-253><a class=lnlinks href=#hl-18-253>253</a>
</span><span class=lnt id=hl-18-254><a class=lnlinks href=#hl-18-254>254</a>
</span><span class=lnt id=hl-18-255><a class=lnlinks href=#hl-18-255>255</a>
</span><span class=lnt id=hl-18-256><a class=lnlinks href=#hl-18-256>256</a>
</span><span class=lnt id=hl-18-257><a class=lnlinks href=#hl-18-257>257</a>
</span><span class=lnt id=hl-18-258><a class=lnlinks href=#hl-18-258>258</a>
</span><span class=lnt id=hl-18-259><a class=lnlinks href=#hl-18-259>259</a>
</span><span class=lnt id=hl-18-260><a class=lnlinks href=#hl-18-260>260</a>
</span><span class=lnt id=hl-18-261><a class=lnlinks href=#hl-18-261>261</a>
</span><span class=lnt id=hl-18-262><a class=lnlinks href=#hl-18-262>262</a>
</span><span class=lnt id=hl-18-263><a class=lnlinks href=#hl-18-263>263</a>
</span><span class=lnt id=hl-18-264><a class=lnlinks href=#hl-18-264>264</a>
</span><span class=lnt id=hl-18-265><a class=lnlinks href=#hl-18-265>265</a>
</span><span class=lnt id=hl-18-266><a class=lnlinks href=#hl-18-266>266</a>
</span><span class=lnt id=hl-18-267><a class=lnlinks href=#hl-18-267>267</a>
</span><span class=lnt id=hl-18-268><a class=lnlinks href=#hl-18-268>268</a>
</span><span class=lnt id=hl-18-269><a class=lnlinks href=#hl-18-269>269</a>
</span><span class=lnt id=hl-18-270><a class=lnlinks href=#hl-18-270>270</a>
</span><span class=lnt id=hl-18-271><a class=lnlinks href=#hl-18-271>271</a>
</span><span class=lnt id=hl-18-272><a class=lnlinks href=#hl-18-272>272</a>
</span><span class=lnt id=hl-18-273><a class=lnlinks href=#hl-18-273>273</a>
</span><span class=lnt id=hl-18-274><a class=lnlinks href=#hl-18-274>274</a>
</span><span class=lnt id=hl-18-275><a class=lnlinks href=#hl-18-275>275</a>
</span><span class=lnt id=hl-18-276><a class=lnlinks href=#hl-18-276>276</a>
</span><span class=lnt id=hl-18-277><a class=lnlinks href=#hl-18-277>277</a>
</span><span class=lnt id=hl-18-278><a class=lnlinks href=#hl-18-278>278</a>
</span><span class=lnt id=hl-18-279><a class=lnlinks href=#hl-18-279>279</a>
</span><span class=lnt id=hl-18-280><a class=lnlinks href=#hl-18-280>280</a>
</span><span class=lnt id=hl-18-281><a class=lnlinks href=#hl-18-281>281</a>
</span><span class=lnt id=hl-18-282><a class=lnlinks href=#hl-18-282>282</a>
</span><span class=lnt id=hl-18-283><a class=lnlinks href=#hl-18-283>283</a>
</span><span class=lnt id=hl-18-284><a class=lnlinks href=#hl-18-284>284</a>
</span><span class=lnt id=hl-18-285><a class=lnlinks href=#hl-18-285>285</a>
</span><span class=lnt id=hl-18-286><a class=lnlinks href=#hl-18-286>286</a>
</span><span class=lnt id=hl-18-287><a class=lnlinks href=#hl-18-287>287</a>
</span><span class=lnt id=hl-18-288><a class=lnlinks href=#hl-18-288>288</a>
</span><span class=lnt id=hl-18-289><a class=lnlinks href=#hl-18-289>289</a>
</span><span class=lnt id=hl-18-290><a class=lnlinks href=#hl-18-290>290</a>
</span><span class=lnt id=hl-18-291><a class=lnlinks href=#hl-18-291>291</a>
</span><span class=lnt id=hl-18-292><a class=lnlinks href=#hl-18-292>292</a>
</span><span class=lnt id=hl-18-293><a class=lnlinks href=#hl-18-293>293</a>
</span><span class=lnt id=hl-18-294><a class=lnlinks href=#hl-18-294>294</a>
</span><span class=lnt id=hl-18-295><a class=lnlinks href=#hl-18-295>295</a>
</span><span class=lnt id=hl-18-296><a class=lnlinks href=#hl-18-296>296</a>
</span><span class=lnt id=hl-18-297><a class=lnlinks href=#hl-18-297>297</a>
</span><span class=lnt id=hl-18-298><a class=lnlinks href=#hl-18-298>298</a>
</span><span class=lnt id=hl-18-299><a class=lnlinks href=#hl-18-299>299</a>
</span><span class=lnt id=hl-18-300><a class=lnlinks href=#hl-18-300>300</a>
</span><span class=lnt id=hl-18-301><a class=lnlinks href=#hl-18-301>301</a>
</span><span class=lnt id=hl-18-302><a class=lnlinks href=#hl-18-302>302</a>
</span><span class=lnt id=hl-18-303><a class=lnlinks href=#hl-18-303>303</a>
</span><span class=lnt id=hl-18-304><a class=lnlinks href=#hl-18-304>304</a>
</span><span class=lnt id=hl-18-305><a class=lnlinks href=#hl-18-305>305</a>
</span><span class=lnt id=hl-18-306><a class=lnlinks href=#hl-18-306>306</a>
</span><span class=lnt id=hl-18-307><a class=lnlinks href=#hl-18-307>307</a>
</span><span class=lnt id=hl-18-308><a class=lnlinks href=#hl-18-308>308</a>
</span><span class=lnt id=hl-18-309><a class=lnlinks href=#hl-18-309>309</a>
</span><span class=lnt id=hl-18-310><a class=lnlinks href=#hl-18-310>310</a>
</span><span class=lnt id=hl-18-311><a class=lnlinks href=#hl-18-311>311</a>
</span><span class=lnt id=hl-18-312><a class=lnlinks href=#hl-18-312>312</a>
</span><span class=lnt id=hl-18-313><a class=lnlinks href=#hl-18-313>313</a>
</span><span class=lnt id=hl-18-314><a class=lnlinks href=#hl-18-314>314</a>
</span><span class=lnt id=hl-18-315><a class=lnlinks href=#hl-18-315>315</a>
</span><span class=lnt id=hl-18-316><a class=lnlinks href=#hl-18-316>316</a>
</span><span class=lnt id=hl-18-317><a class=lnlinks href=#hl-18-317>317</a>
</span><span class=lnt id=hl-18-318><a class=lnlinks href=#hl-18-318>318</a>
</span><span class=lnt id=hl-18-319><a class=lnlinks href=#hl-18-319>319</a>
</span><span class=lnt id=hl-18-320><a class=lnlinks href=#hl-18-320>320</a>
</span><span class=lnt id=hl-18-321><a class=lnlinks href=#hl-18-321>321</a>
</span><span class=lnt id=hl-18-322><a class=lnlinks href=#hl-18-322>322</a>
</span><span class=lnt id=hl-18-323><a class=lnlinks href=#hl-18-323>323</a>
</span><span class=lnt id=hl-18-324><a class=lnlinks href=#hl-18-324>324</a>
</span><span class=lnt id=hl-18-325><a class=lnlinks href=#hl-18-325>325</a>
</span><span class=lnt id=hl-18-326><a class=lnlinks href=#hl-18-326>326</a>
</span><span class=lnt id=hl-18-327><a class=lnlinks href=#hl-18-327>327</a>
</span><span class=lnt id=hl-18-328><a class=lnlinks href=#hl-18-328>328</a>
</span><span class=lnt id=hl-18-329><a class=lnlinks href=#hl-18-329>329</a>
</span><span class=lnt id=hl-18-330><a class=lnlinks href=#hl-18-330>330</a>
</span><span class=lnt id=hl-18-331><a class=lnlinks href=#hl-18-331>331</a>
</span><span class=lnt id=hl-18-332><a class=lnlinks href=#hl-18-332>332</a>
</span><span class=lnt id=hl-18-333><a class=lnlinks href=#hl-18-333>333</a>
</span><span class=lnt id=hl-18-334><a class=lnlinks href=#hl-18-334>334</a>
</span><span class=lnt id=hl-18-335><a class=lnlinks href=#hl-18-335>335</a>
</span><span class=lnt id=hl-18-336><a class=lnlinks href=#hl-18-336>336</a>
</span><span class=lnt id=hl-18-337><a class=lnlinks href=#hl-18-337>337</a>
</span><span class=lnt id=hl-18-338><a class=lnlinks href=#hl-18-338>338</a>
</span><span class=lnt id=hl-18-339><a class=lnlinks href=#hl-18-339>339</a>
</span><span class=lnt id=hl-18-340><a class=lnlinks href=#hl-18-340>340</a>
</span><span class=lnt id=hl-18-341><a class=lnlinks href=#hl-18-341>341</a>
</span><span class=lnt id=hl-18-342><a class=lnlinks href=#hl-18-342>342</a>
</span><span class=lnt id=hl-18-343><a class=lnlinks href=#hl-18-343>343</a>
</span><span class=lnt id=hl-18-344><a class=lnlinks href=#hl-18-344>344</a>
</span><span class=lnt id=hl-18-345><a class=lnlinks href=#hl-18-345>345</a>
</span><span class=lnt id=hl-18-346><a class=lnlinks href=#hl-18-346>346</a>
</span><span class=lnt id=hl-18-347><a class=lnlinks href=#hl-18-347>347</a>
</span><span class=lnt id=hl-18-348><a class=lnlinks href=#hl-18-348>348</a>
</span><span class=lnt id=hl-18-349><a class=lnlinks href=#hl-18-349>349</a>
</span><span class=lnt id=hl-18-350><a class=lnlinks href=#hl-18-350>350</a>
</span><span class=lnt id=hl-18-351><a class=lnlinks href=#hl-18-351>351</a>
</span><span class=lnt id=hl-18-352><a class=lnlinks href=#hl-18-352>352</a>
</span><span class=lnt id=hl-18-353><a class=lnlinks href=#hl-18-353>353</a>
</span><span class=lnt id=hl-18-354><a class=lnlinks href=#hl-18-354>354</a>
</span><span class=lnt id=hl-18-355><a class=lnlinks href=#hl-18-355>355</a>
</span><span class=lnt id=hl-18-356><a class=lnlinks href=#hl-18-356>356</a>
</span><span class=lnt id=hl-18-357><a class=lnlinks href=#hl-18-357>357</a>
</span><span class=lnt id=hl-18-358><a class=lnlinks href=#hl-18-358>358</a>
</span><span class=lnt id=hl-18-359><a class=lnlinks href=#hl-18-359>359</a>
</span><span class=lnt id=hl-18-360><a class=lnlinks href=#hl-18-360>360</a>
</span><span class=lnt id=hl-18-361><a class=lnlinks href=#hl-18-361>361</a>
</span><span class=lnt id=hl-18-362><a class=lnlinks href=#hl-18-362>362</a>
</span><span class=lnt id=hl-18-363><a class=lnlinks href=#hl-18-363>363</a>
</span><span class=lnt id=hl-18-364><a class=lnlinks href=#hl-18-364>364</a>
</span><span class=lnt id=hl-18-365><a class=lnlinks href=#hl-18-365>365</a>
</span><span class=lnt id=hl-18-366><a class=lnlinks href=#hl-18-366>366</a>
</span><span class=lnt id=hl-18-367><a class=lnlinks href=#hl-18-367>367</a>
</span><span class=lnt id=hl-18-368><a class=lnlinks href=#hl-18-368>368</a>
</span><span class=lnt id=hl-18-369><a class=lnlinks href=#hl-18-369>369</a>
</span><span class=lnt id=hl-18-370><a class=lnlinks href=#hl-18-370>370</a>
</span><span class=lnt id=hl-18-371><a class=lnlinks href=#hl-18-371>371</a>
</span><span class=lnt id=hl-18-372><a class=lnlinks href=#hl-18-372>372</a>
</span><span class=lnt id=hl-18-373><a class=lnlinks href=#hl-18-373>373</a>
</span><span class=lnt id=hl-18-374><a class=lnlinks href=#hl-18-374>374</a>
</span><span class=lnt id=hl-18-375><a class=lnlinks href=#hl-18-375>375</a>
</span><span class=lnt id=hl-18-376><a class=lnlinks href=#hl-18-376>376</a>
</span><span class=lnt id=hl-18-377><a class=lnlinks href=#hl-18-377>377</a>
</span><span class=lnt id=hl-18-378><a class=lnlinks href=#hl-18-378>378</a>
</span><span class=lnt id=hl-18-379><a class=lnlinks href=#hl-18-379>379</a>
</span><span class=lnt id=hl-18-380><a class=lnlinks href=#hl-18-380>380</a>
</span><span class=lnt id=hl-18-381><a class=lnlinks href=#hl-18-381>381</a>
</span><span class=lnt id=hl-18-382><a class=lnlinks href=#hl-18-382>382</a>
</span><span class=lnt id=hl-18-383><a class=lnlinks href=#hl-18-383>383</a>
</span><span class=lnt id=hl-18-384><a class=lnlinks href=#hl-18-384>384</a>
</span><span class=lnt id=hl-18-385><a class=lnlinks href=#hl-18-385>385</a>
</span><span class=lnt id=hl-18-386><a class=lnlinks href=#hl-18-386>386</a>
</span><span class=lnt id=hl-18-387><a class=lnlinks href=#hl-18-387>387</a>
</span><span class=lnt id=hl-18-388><a class=lnlinks href=#hl-18-388>388</a>
</span><span class=lnt id=hl-18-389><a class=lnlinks href=#hl-18-389>389</a>
</span><span class=lnt id=hl-18-390><a class=lnlinks href=#hl-18-390>390</a>
</span><span class=lnt id=hl-18-391><a class=lnlinks href=#hl-18-391>391</a>
</span><span class=lnt id=hl-18-392><a class=lnlinks href=#hl-18-392>392</a>
</span><span class=lnt id=hl-18-393><a class=lnlinks href=#hl-18-393>393</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 전자상거래 주문 처리 시스템 - Messaging-Oriented Styles 구현
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>EventEmitter</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 메시지 브로커 클래스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>MessageBroker</span> <span class=kr>extends</span> <span class=nx>EventEmitter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>topics</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>subscribers</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>messageHistory</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 토픽 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>createTopic</span><span class=p>(</span><span class=nx>topicName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>topics</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>topicName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>topics</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>subscribers</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Topic &#39;</span><span class=si>${</span><span class=nx>topicName</span><span class=si>}</span><span class=sb>&#39; created`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 구독자 등록
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>subscribe</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=nx>subscriberId</span><span class=p>,</span> <span class=nx>handler</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=nx>topicName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>subscribers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>topicName</span><span class=p>).</span><span class=nx>add</span><span class=p>({</span> <span class=nx>subscriberId</span><span class=p>,</span> <span class=nx>handler</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>subscriberId</span><span class=si>}</span><span class=sb> subscribed to &#39;</span><span class=si>${</span><span class=nx>topicName</span><span class=si>}</span><span class=sb>&#39;`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메시지 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>publish</span><span class=p>(</span><span class=nx>topicName</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>topics</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>topicName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`Topic &#39;</span><span class=si>${</span><span class=nx>topicName</span><span class=si>}</span><span class=sb>&#39; does not exist`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>enrichedMessage</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=err>…</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>messageId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateMessageId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>topic</span><span class=o>:</span> <span class=nx>topicName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 메시지 히스토리 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>messageHistory</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>enrichedMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Message published to &#39;</span><span class=si>${</span><span class=nx>topicName</span><span class=si>}</span><span class=sb>&#39;:`</span><span class=p>,</span> <span class=nx>enrichedMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 구독자들에게 메시지 전달
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>subscribers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>subscribers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>topicName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>subscriber</span> <span class=k>of</span> <span class=nx>subscribers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=nx>subscriber</span><span class=p>.</span><span class=nx>handler</span><span class=p>(</span><span class=nx>enrichedMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Error in subscriber </span><span class=si>${</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>subscriberId</span><span class=si>}</span><span class=sb>:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Dead Letter Queue로 이동 (실제 구현에서는 별도 처리)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleFailedMessage</span><span class=p>(</span><span class=nx>enrichedMessage</span><span class=p>,</span> <span class=nx>subscriber</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleFailedMessage</span><span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>subscriber</span><span class=p>,</span> <span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Moving message to DLQ for subscriber </span><span class=si>${</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>subscriberId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Dead Letter Queue 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateMessageId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`msg_</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>9</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 주문 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>messageBroker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span> <span class=o>=</span> <span class=nx>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orders</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;payment.completed&#39;</span><span class=p>,</span> <span class=s1>&#39;OrderService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handlePaymentCompleted</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;inventory.reserved&#39;</span><span class=p>,</span> <span class=s1>&#39;OrderService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleInventoryReserved</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;shipping.started&#39;</span><span class=p>,</span> <span class=s1>&#39;OrderService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleShippingStarted</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateOrderId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAmount</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>calculateTotal</span><span class=p>(</span><span class=nx>items</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>createdAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Order Created 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>eventType</span><span class=o>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAmount</span><span class=o>:</span> <span class=nx>order</span><span class=p>.</span><span class=nx>totalAmount</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb> created for customer </span><span class=si>${</span><span class=nx>customerId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;processing&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handlePaymentCompleted</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>orderId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;payment_completed&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>paymentCompletedAt</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Payment completed for order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleInventoryReserved</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>orderId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;inventory_reserved&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>inventoryReservedAt</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Inventory reserved for order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleShippingStarted</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>trackingNumber</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>orderId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;shipped&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>trackingNumber</span> <span class=o>=</span> <span class=nx>trackingNumber</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>order</span><span class=p>.</span><span class=nx>shippedAt</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb> shipped with tracking </span><span class=si>${</span><span class=nx>trackingNumber</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>calculateTotal</span><span class=p>(</span><span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>items</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>total</span><span class=p>,</span> <span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>total</span> <span class=o>+</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>price</span> <span class=o>*</span> <span class=nx>item</span><span class=p>.</span><span class=nx>quantity</span><span class=p>),</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateOrderId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`ORDER_</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>6</span><span class=p>).</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>getOrder</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 결제 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>PaymentService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>messageBroker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span> <span class=o>=</span> <span class=nx>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>payments</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Order Created 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span> <span class=s1>&#39;PaymentService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleOrderCreated</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderCreated</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>totalAmount</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Processing payment for order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>, amount: $</span><span class=si>${</span><span class=nx>totalAmount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 결제 처리 시뮬레이션 (비동기 처리)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>paymentResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processPayment</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>totalAmount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>payments</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>paymentResult</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// Payment Completed 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;payment.completed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>eventType</span><span class=o>:</span> <span class=s1>&#39;PaymentCompleted&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>paymentId</span><span class=o>:</span> <span class=nx>paymentResult</span><span class=p>.</span><span class=nx>paymentId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>amount</span><span class=o>:</span> <span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>paymentMethod</span><span class=o>:</span> <span class=nx>paymentResult</span><span class=p>.</span><span class=nx>paymentMethod</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Payment Failed 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;payment.failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>eventType</span><span class=o>:</span> <span class=s1>&#39;PaymentFailed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span> <span class=c1>// 1초 후 결제 완료 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 결제 처리 로직 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 90% 성공률
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>paymentId</span><span class=o>:</span> <span class=sb>`PAY_</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>paymentMethod</span><span class=o>:</span> <span class=s1>&#39;credit_card&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;completed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>processedAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Payment processing failed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 재고 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>InventoryService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>messageBroker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span> <span class=o>=</span> <span class=nx>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>inventory</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;ITEM_001&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>quantity</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span> <span class=nx>reserved</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;ITEM_002&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>quantity</span><span class=o>:</span> <span class=mi>50</span><span class=p>,</span> <span class=nx>reserved</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;ITEM_003&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>quantity</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span> <span class=nx>reserved</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>        <span class=p>]);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Order Created 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span> <span class=s1>&#39;InventoryService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleOrderCreated</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderCreated</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>items</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Checking inventory for order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 재고 확인 및 예약
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>item</span> <span class=k>of</span> <span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>reserveInventory</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>itemId</span><span class=p>,</span> <span class=nx>item</span><span class=p>.</span><span class=nx>quantity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// Inventory Reserved 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;inventory.reserved&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>eventType</span><span class=o>:</span> <span class=s1>&#39;InventoryReserved&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>reservedAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Inventory Insufficient 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;inventory.insufficient&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>eventType</span><span class=o>:</span> <span class=s1>&#39;InventoryInsufficient&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>reserveInventory</span><span class=p>(</span><span class=nx>itemId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>item</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>inventory</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>itemId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`Item </span><span class=si>${</span><span class=nx>itemId</span><span class=si>}</span><span class=sb> not found`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>quantity</span> <span class=o>-</span> <span class=nx>item</span><span class=p>.</span><span class=nx>reserved</span> <span class=o>&lt;</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`Insufficient inventory for item </span><span class=si>${</span><span class=nx>itemId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>item</span><span class=p>.</span><span class=nx>reserved</span> <span class=o>+=</span> <span class=nx>quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Reserved </span><span class=si>${</span><span class=nx>quantity</span><span class=si>}</span><span class=sb> units of </span><span class=si>${</span><span class=nx>itemId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 배송 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>ShippingService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>messageBroker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span> <span class=o>=</span> <span class=nx>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>shipments</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Payment Completed 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;payment.completed&#39;</span><span class=p>,</span> <span class=s1>&#39;ShippingService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handlePaymentCompleted</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handlePaymentCompleted</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Preparing shipment for order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 배송 준비 시뮬레이션 (비동기 처리)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>trackingNumber</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateTrackingNumber</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>shipments</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>trackingNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;shipped&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>shippedAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// Shipping Started 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;shipping.started&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>eventType</span><span class=o>:</span> <span class=s1>&#39;ShippingStarted&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>trackingNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>estimatedDelivery</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>+</span> <span class=p>(</span><span class=mi>3</span> <span class=o>*</span> <span class=mi>24</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span> <span class=c1>// 3일 후
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span> <span class=c1>// 2초 후 배송 시작 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateTrackingNumber</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`TRK_</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 알림 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>NotificationService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>messageBroker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span> <span class=o>=</span> <span class=nx>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 다양한 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span> <span class=s1>&#39;NotificationService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleOrderCreated</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;payment.completed&#39;</span><span class=p>,</span> <span class=s1>&#39;NotificationService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handlePaymentCompleted</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>broker</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;shipping.started&#39;</span><span class=p>,</span> <span class=s1>&#39;NotificationService&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleShippingStarted</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderCreated</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendNotification</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=s1>&#39;order_created&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=sb>`Your order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb> has been received and is being processed.`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handlePaymentCompleted</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendNotification</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=s1>&#39;payment_completed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=sb>`Payment for order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb> has been successfully processed.`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleShippingStarted</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>trackingNumber</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendNotification</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=s1>&#39;shipping_started&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=sb>`Your order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb> has been shipped. Tracking number: </span><span class=si>${</span><span class=nx>trackingNumber</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>sendNotification</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>type</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📧 NOTIFICATION [</span><span class=si>${</span><span class=nx>type</span><span class=si>}</span><span class=sb>] to customer </span><span class=si>${</span><span class=nx>customerId</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 구현에서는 이메일, SMS, 푸시 알림 등을 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 시스템 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>runECommerceSimulation</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;🚀 Starting E-commerce Order Processing System with Messaging-Oriented Styles\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메시지 브로커 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>broker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MessageBroker</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 토픽 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>broker</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=s1>&#39;order.created&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>broker</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=s1>&#39;payment.completed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>broker</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=s1>&#39;payment.failed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>broker</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=s1>&#39;inventory.reserved&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>broker</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=s1>&#39;inventory.insufficient&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>broker</span><span class=p>.</span><span class=nx>createTopic</span><span class=p>(</span><span class=s1>&#39;shipping.started&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 서비스 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>orderService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderService</span><span class=p>(</span><span class=nx>broker</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>paymentService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PaymentService</span><span class=p>(</span><span class=nx>broker</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>inventoryService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryService</span><span class=p>(</span><span class=nx>broker</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>shippingService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ShippingService</span><span class=p>(</span><span class=nx>broker</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>notificationService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NotificationService</span><span class=p>(</span><span class=nx>broker</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n✅ All services initialized and subscribed to events\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 생성 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>customerOrder</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>orderService</span><span class=p>.</span><span class=nx>createOrder</span><span class=p>(</span><span class=s1>&#39;CUSTOMER_001&#39;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>itemId</span><span class=o>:</span> <span class=s1>&#39;ITEM_001&#39;</span><span class=p>,</span> <span class=nx>quantity</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>price</span><span class=o>:</span> <span class=mf>29.99</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>itemId</span><span class=o>:</span> <span class=s1>&#39;ITEM_002&#39;</span><span class=p>,</span> <span class=nx>quantity</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>price</span><span class=o>:</span> <span class=mf>49.99</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;📦 Order created:&#39;</span><span class=p>,</span> <span class=nx>customerOrder</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 시스템 상태 확인 (5초 후)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n📊 Final Order Status:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>finalOrder</span> <span class=o>=</span> <span class=nx>orderService</span><span class=p>.</span><span class=nx>getOrder</span><span class=p>(</span><span class=nx>customerOrder</span><span class=p>.</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>finalOrder</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n📈 Message History:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>broker</span><span class=p>.</span><span class=nx>messageHistory</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>msg</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=sb>. [</span><span class=si>${</span><span class=nx>msg</span><span class=p>.</span><span class=nx>topic</span><span class=si>}</span><span class=sb>] </span><span class=si>${</span><span class=nx>msg</span><span class=p>.</span><span class=nx>eventType</span><span class=si>}</span><span class=sb> at </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>).</span><span class=nx>toISOString</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 시뮬레이션 실행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>runECommerceSimulation</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-4-netflix-의-마이크로서비스-간-통신-시스템>사례 4: Netflix 의 마이크로서비스 간 통신 시스템<a hidden class=anchor aria-hidden=true href=#사례-4-netflix-의-마이크로서비스-간-통신-시스템>#</a></h4><p><strong>시스템 구성</strong><br>Netflix 는 수백 개의 마이크로서비스로 구성된 시스템에서 Messaging-Oriented Architecture 를 핵심으로 활용하고 있다.</p><pre class=mermaid>graph TB
    subgraph &#34;User Interface Layer&#34;
        UI[Netflix UI]
        API[API Gateway]
    end
    
    subgraph &#34;Messaging Infrastructure&#34;
        MB[Message Broker - Apache Kafka]
        ES[Event Store]
    end
    
    subgraph &#34;Core Services&#34;
        US[User Service]
        CS[Content Service]
        RS[Recommendation Service]
        VS[Viewing Service]
    end
    
    subgraph &#34;Analytics &amp; ML&#34;
        AS[Analytics Service]
        ML[ML Pipeline]
        DS[Data Science]
    end
    
    subgraph &#34;Infrastructure Services&#34;
        LS[Logging Service]
        MS[Monitoring Service]
        NS[Notification Service]
    end
    
    UI --&gt; API
    API --&gt; US
    API --&gt; CS
    
    US --&gt; MB
    CS --&gt; MB
    RS --&gt; MB
    VS --&gt; MB
    
    MB --&gt; AS
    MB --&gt; ML
    MB --&gt; LS
    MB --&gt; MS
    MB --&gt; NS
    
    ES --&gt; MB
</pre><p><strong>활용 사례 Workflow</strong>:</p><ol><li><p><strong>사용자 행동 이벤트 수집</strong></p><ul><li>사용자가 콘텐츠를 시청하면 Viewing Service 가 이벤트 생성</li><li>Apache Kafka 를 통해 다양한 서비스로 이벤트 전파</li></ul></li><li><p><strong>실시간 추천 시스템 업데이트</strong></p><ul><li>시청 이벤트를 Recommendation Service 가 수신</li><li>머신러닝 모델을 실시간으로 업데이트</li><li>개인화된 추천 목록 갱신</li></ul></li><li><p><strong>분석 데이터 파이프라인</strong></p><ul><li>모든 사용자 행동이 Analytics Service 로 스트리밍</li><li>실시간 지표 계산 및 대시보드 업데이트</li></ul></li></ol><p><strong>MOA 의 역할</strong>:</p><ul><li><strong>이벤트 기반 아키텍처</strong>: 사용자 행동을 이벤트로 처리하여 실시간 반응</li><li><strong>서비스 간 분리</strong>: 각 마이크로서비스가 독립적으로 개발과 배포 가능</li><li><strong>확장성</strong>: 트래픽 증가에 따른 동적 스케일링 지원</li></ul><p><strong>MOA 유무에 따른 차이점</strong>:</p><ul><li><strong>MOA 적용 전 (동기식 통신)</strong><ul><li>사용자 시청 → User Service 호출 → Recommendation Service 직접 호출 → Analytics Service 직접 호출</li><li>장애 전파: 하나의 서비스 장애가 전체 시스템 영향</li><li>확장성 제약: 모든 서비스가 동시에 처리 능력을 갖춰야 함</li></ul></li><li><strong>MOA 적용 후 (메시지 기반 통신)</strong><ul><li>사용자 시청 → 이벤트 발행 → 각 서비스가 독립적으로 이벤트 처리</li><li>장애 격리: 개별 서비스 장애가 다른 서비스에 미치는 영향 최소화</li><li>탄력적 확장: 서비스별 독립적인 스케일링 가능</li></ul></li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>  1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>  2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>  3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>  4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>  5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>  6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>  7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>  8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9>  9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10> 10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11> 11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12> 12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13> 13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14> 14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15> 15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16> 16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17> 17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18> 18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19> 19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20> 20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21> 21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22> 22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23> 23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24> 24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25> 25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26> 26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27> 27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28> 28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29> 29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30> 30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31> 31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32> 32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33> 33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34> 34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35> 35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36> 36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37> 37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38> 38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39> 39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40> 40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41> 41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42> 42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43> 43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44> 44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45> 45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46> 46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47> 47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48> 48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49> 49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50> 50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51> 51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52> 52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53> 53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54> 54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55> 55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56> 56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57> 57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58> 58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59> 59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60> 60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61> 61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62> 62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63> 63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64> 64</a>
</span><span class=lnt id=hl-20-65><a class=lnlinks href=#hl-20-65> 65</a>
</span><span class=lnt id=hl-20-66><a class=lnlinks href=#hl-20-66> 66</a>
</span><span class=lnt id=hl-20-67><a class=lnlinks href=#hl-20-67> 67</a>
</span><span class=lnt id=hl-20-68><a class=lnlinks href=#hl-20-68> 68</a>
</span><span class=lnt id=hl-20-69><a class=lnlinks href=#hl-20-69> 69</a>
</span><span class=lnt id=hl-20-70><a class=lnlinks href=#hl-20-70> 70</a>
</span><span class=lnt id=hl-20-71><a class=lnlinks href=#hl-20-71> 71</a>
</span><span class=lnt id=hl-20-72><a class=lnlinks href=#hl-20-72> 72</a>
</span><span class=lnt id=hl-20-73><a class=lnlinks href=#hl-20-73> 73</a>
</span><span class=lnt id=hl-20-74><a class=lnlinks href=#hl-20-74> 74</a>
</span><span class=lnt id=hl-20-75><a class=lnlinks href=#hl-20-75> 75</a>
</span><span class=lnt id=hl-20-76><a class=lnlinks href=#hl-20-76> 76</a>
</span><span class=lnt id=hl-20-77><a class=lnlinks href=#hl-20-77> 77</a>
</span><span class=lnt id=hl-20-78><a class=lnlinks href=#hl-20-78> 78</a>
</span><span class=lnt id=hl-20-79><a class=lnlinks href=#hl-20-79> 79</a>
</span><span class=lnt id=hl-20-80><a class=lnlinks href=#hl-20-80> 80</a>
</span><span class=lnt id=hl-20-81><a class=lnlinks href=#hl-20-81> 81</a>
</span><span class=lnt id=hl-20-82><a class=lnlinks href=#hl-20-82> 82</a>
</span><span class=lnt id=hl-20-83><a class=lnlinks href=#hl-20-83> 83</a>
</span><span class=lnt id=hl-20-84><a class=lnlinks href=#hl-20-84> 84</a>
</span><span class=lnt id=hl-20-85><a class=lnlinks href=#hl-20-85> 85</a>
</span><span class=lnt id=hl-20-86><a class=lnlinks href=#hl-20-86> 86</a>
</span><span class=lnt id=hl-20-87><a class=lnlinks href=#hl-20-87> 87</a>
</span><span class=lnt id=hl-20-88><a class=lnlinks href=#hl-20-88> 88</a>
</span><span class=lnt id=hl-20-89><a class=lnlinks href=#hl-20-89> 89</a>
</span><span class=lnt id=hl-20-90><a class=lnlinks href=#hl-20-90> 90</a>
</span><span class=lnt id=hl-20-91><a class=lnlinks href=#hl-20-91> 91</a>
</span><span class=lnt id=hl-20-92><a class=lnlinks href=#hl-20-92> 92</a>
</span><span class=lnt id=hl-20-93><a class=lnlinks href=#hl-20-93> 93</a>
</span><span class=lnt id=hl-20-94><a class=lnlinks href=#hl-20-94> 94</a>
</span><span class=lnt id=hl-20-95><a class=lnlinks href=#hl-20-95> 95</a>
</span><span class=lnt id=hl-20-96><a class=lnlinks href=#hl-20-96> 96</a>
</span><span class=lnt id=hl-20-97><a class=lnlinks href=#hl-20-97> 97</a>
</span><span class=lnt id=hl-20-98><a class=lnlinks href=#hl-20-98> 98</a>
</span><span class=lnt id=hl-20-99><a class=lnlinks href=#hl-20-99> 99</a>
</span><span class=lnt id=hl-20-100><a class=lnlinks href=#hl-20-100>100</a>
</span><span class=lnt id=hl-20-101><a class=lnlinks href=#hl-20-101>101</a>
</span><span class=lnt id=hl-20-102><a class=lnlinks href=#hl-20-102>102</a>
</span><span class=lnt id=hl-20-103><a class=lnlinks href=#hl-20-103>103</a>
</span><span class=lnt id=hl-20-104><a class=lnlinks href=#hl-20-104>104</a>
</span><span class=lnt id=hl-20-105><a class=lnlinks href=#hl-20-105>105</a>
</span><span class=lnt id=hl-20-106><a class=lnlinks href=#hl-20-106>106</a>
</span><span class=lnt id=hl-20-107><a class=lnlinks href=#hl-20-107>107</a>
</span><span class=lnt id=hl-20-108><a class=lnlinks href=#hl-20-108>108</a>
</span><span class=lnt id=hl-20-109><a class=lnlinks href=#hl-20-109>109</a>
</span><span class=lnt id=hl-20-110><a class=lnlinks href=#hl-20-110>110</a>
</span><span class=lnt id=hl-20-111><a class=lnlinks href=#hl-20-111>111</a>
</span><span class=lnt id=hl-20-112><a class=lnlinks href=#hl-20-112>112</a>
</span><span class=lnt id=hl-20-113><a class=lnlinks href=#hl-20-113>113</a>
</span><span class=lnt id=hl-20-114><a class=lnlinks href=#hl-20-114>114</a>
</span><span class=lnt id=hl-20-115><a class=lnlinks href=#hl-20-115>115</a>
</span><span class=lnt id=hl-20-116><a class=lnlinks href=#hl-20-116>116</a>
</span><span class=lnt id=hl-20-117><a class=lnlinks href=#hl-20-117>117</a>
</span><span class=lnt id=hl-20-118><a class=lnlinks href=#hl-20-118>118</a>
</span><span class=lnt id=hl-20-119><a class=lnlinks href=#hl-20-119>119</a>
</span><span class=lnt id=hl-20-120><a class=lnlinks href=#hl-20-120>120</a>
</span><span class=lnt id=hl-20-121><a class=lnlinks href=#hl-20-121>121</a>
</span><span class=lnt id=hl-20-122><a class=lnlinks href=#hl-20-122>122</a>
</span><span class=lnt id=hl-20-123><a class=lnlinks href=#hl-20-123>123</a>
</span><span class=lnt id=hl-20-124><a class=lnlinks href=#hl-20-124>124</a>
</span><span class=lnt id=hl-20-125><a class=lnlinks href=#hl-20-125>125</a>
</span><span class=lnt id=hl-20-126><a class=lnlinks href=#hl-20-126>126</a>
</span><span class=lnt id=hl-20-127><a class=lnlinks href=#hl-20-127>127</a>
</span><span class=lnt id=hl-20-128><a class=lnlinks href=#hl-20-128>128</a>
</span><span class=lnt id=hl-20-129><a class=lnlinks href=#hl-20-129>129</a>
</span><span class=lnt id=hl-20-130><a class=lnlinks href=#hl-20-130>130</a>
</span><span class=lnt id=hl-20-131><a class=lnlinks href=#hl-20-131>131</a>
</span><span class=lnt id=hl-20-132><a class=lnlinks href=#hl-20-132>132</a>
</span><span class=lnt id=hl-20-133><a class=lnlinks href=#hl-20-133>133</a>
</span><span class=lnt id=hl-20-134><a class=lnlinks href=#hl-20-134>134</a>
</span><span class=lnt id=hl-20-135><a class=lnlinks href=#hl-20-135>135</a>
</span><span class=lnt id=hl-20-136><a class=lnlinks href=#hl-20-136>136</a>
</span><span class=lnt id=hl-20-137><a class=lnlinks href=#hl-20-137>137</a>
</span><span class=lnt id=hl-20-138><a class=lnlinks href=#hl-20-138>138</a>
</span><span class=lnt id=hl-20-139><a class=lnlinks href=#hl-20-139>139</a>
</span><span class=lnt id=hl-20-140><a class=lnlinks href=#hl-20-140>140</a>
</span><span class=lnt id=hl-20-141><a class=lnlinks href=#hl-20-141>141</a>
</span><span class=lnt id=hl-20-142><a class=lnlinks href=#hl-20-142>142</a>
</span><span class=lnt id=hl-20-143><a class=lnlinks href=#hl-20-143>143</a>
</span><span class=lnt id=hl-20-144><a class=lnlinks href=#hl-20-144>144</a>
</span><span class=lnt id=hl-20-145><a class=lnlinks href=#hl-20-145>145</a>
</span><span class=lnt id=hl-20-146><a class=lnlinks href=#hl-20-146>146</a>
</span><span class=lnt id=hl-20-147><a class=lnlinks href=#hl-20-147>147</a>
</span><span class=lnt id=hl-20-148><a class=lnlinks href=#hl-20-148>148</a>
</span><span class=lnt id=hl-20-149><a class=lnlinks href=#hl-20-149>149</a>
</span><span class=lnt id=hl-20-150><a class=lnlinks href=#hl-20-150>150</a>
</span><span class=lnt id=hl-20-151><a class=lnlinks href=#hl-20-151>151</a>
</span><span class=lnt id=hl-20-152><a class=lnlinks href=#hl-20-152>152</a>
</span><span class=lnt id=hl-20-153><a class=lnlinks href=#hl-20-153>153</a>
</span><span class=lnt id=hl-20-154><a class=lnlinks href=#hl-20-154>154</a>
</span><span class=lnt id=hl-20-155><a class=lnlinks href=#hl-20-155>155</a>
</span><span class=lnt id=hl-20-156><a class=lnlinks href=#hl-20-156>156</a>
</span><span class=lnt id=hl-20-157><a class=lnlinks href=#hl-20-157>157</a>
</span><span class=lnt id=hl-20-158><a class=lnlinks href=#hl-20-158>158</a>
</span><span class=lnt id=hl-20-159><a class=lnlinks href=#hl-20-159>159</a>
</span><span class=lnt id=hl-20-160><a class=lnlinks href=#hl-20-160>160</a>
</span><span class=lnt id=hl-20-161><a class=lnlinks href=#hl-20-161>161</a>
</span><span class=lnt id=hl-20-162><a class=lnlinks href=#hl-20-162>162</a>
</span><span class=lnt id=hl-20-163><a class=lnlinks href=#hl-20-163>163</a>
</span><span class=lnt id=hl-20-164><a class=lnlinks href=#hl-20-164>164</a>
</span><span class=lnt id=hl-20-165><a class=lnlinks href=#hl-20-165>165</a>
</span><span class=lnt id=hl-20-166><a class=lnlinks href=#hl-20-166>166</a>
</span><span class=lnt id=hl-20-167><a class=lnlinks href=#hl-20-167>167</a>
</span><span class=lnt id=hl-20-168><a class=lnlinks href=#hl-20-168>168</a>
</span><span class=lnt id=hl-20-169><a class=lnlinks href=#hl-20-169>169</a>
</span><span class=lnt id=hl-20-170><a class=lnlinks href=#hl-20-170>170</a>
</span><span class=lnt id=hl-20-171><a class=lnlinks href=#hl-20-171>171</a>
</span><span class=lnt id=hl-20-172><a class=lnlinks href=#hl-20-172>172</a>
</span><span class=lnt id=hl-20-173><a class=lnlinks href=#hl-20-173>173</a>
</span><span class=lnt id=hl-20-174><a class=lnlinks href=#hl-20-174>174</a>
</span><span class=lnt id=hl-20-175><a class=lnlinks href=#hl-20-175>175</a>
</span><span class=lnt id=hl-20-176><a class=lnlinks href=#hl-20-176>176</a>
</span><span class=lnt id=hl-20-177><a class=lnlinks href=#hl-20-177>177</a>
</span><span class=lnt id=hl-20-178><a class=lnlinks href=#hl-20-178>178</a>
</span><span class=lnt id=hl-20-179><a class=lnlinks href=#hl-20-179>179</a>
</span><span class=lnt id=hl-20-180><a class=lnlinks href=#hl-20-180>180</a>
</span><span class=lnt id=hl-20-181><a class=lnlinks href=#hl-20-181>181</a>
</span><span class=lnt id=hl-20-182><a class=lnlinks href=#hl-20-182>182</a>
</span><span class=lnt id=hl-20-183><a class=lnlinks href=#hl-20-183>183</a>
</span><span class=lnt id=hl-20-184><a class=lnlinks href=#hl-20-184>184</a>
</span><span class=lnt id=hl-20-185><a class=lnlinks href=#hl-20-185>185</a>
</span><span class=lnt id=hl-20-186><a class=lnlinks href=#hl-20-186>186</a>
</span><span class=lnt id=hl-20-187><a class=lnlinks href=#hl-20-187>187</a>
</span><span class=lnt id=hl-20-188><a class=lnlinks href=#hl-20-188>188</a>
</span><span class=lnt id=hl-20-189><a class=lnlinks href=#hl-20-189>189</a>
</span><span class=lnt id=hl-20-190><a class=lnlinks href=#hl-20-190>190</a>
</span><span class=lnt id=hl-20-191><a class=lnlinks href=#hl-20-191>191</a>
</span><span class=lnt id=hl-20-192><a class=lnlinks href=#hl-20-192>192</a>
</span><span class=lnt id=hl-20-193><a class=lnlinks href=#hl-20-193>193</a>
</span><span class=lnt id=hl-20-194><a class=lnlinks href=#hl-20-194>194</a>
</span><span class=lnt id=hl-20-195><a class=lnlinks href=#hl-20-195>195</a>
</span><span class=lnt id=hl-20-196><a class=lnlinks href=#hl-20-196>196</a>
</span><span class=lnt id=hl-20-197><a class=lnlinks href=#hl-20-197>197</a>
</span><span class=lnt id=hl-20-198><a class=lnlinks href=#hl-20-198>198</a>
</span><span class=lnt id=hl-20-199><a class=lnlinks href=#hl-20-199>199</a>
</span><span class=lnt id=hl-20-200><a class=lnlinks href=#hl-20-200>200</a>
</span><span class=lnt id=hl-20-201><a class=lnlinks href=#hl-20-201>201</a>
</span><span class=lnt id=hl-20-202><a class=lnlinks href=#hl-20-202>202</a>
</span><span class=lnt id=hl-20-203><a class=lnlinks href=#hl-20-203>203</a>
</span><span class=lnt id=hl-20-204><a class=lnlinks href=#hl-20-204>204</a>
</span><span class=lnt id=hl-20-205><a class=lnlinks href=#hl-20-205>205</a>
</span><span class=lnt id=hl-20-206><a class=lnlinks href=#hl-20-206>206</a>
</span><span class=lnt id=hl-20-207><a class=lnlinks href=#hl-20-207>207</a>
</span><span class=lnt id=hl-20-208><a class=lnlinks href=#hl-20-208>208</a>
</span><span class=lnt id=hl-20-209><a class=lnlinks href=#hl-20-209>209</a>
</span><span class=lnt id=hl-20-210><a class=lnlinks href=#hl-20-210>210</a>
</span><span class=lnt id=hl-20-211><a class=lnlinks href=#hl-20-211>211</a>
</span><span class=lnt id=hl-20-212><a class=lnlinks href=#hl-20-212>212</a>
</span><span class=lnt id=hl-20-213><a class=lnlinks href=#hl-20-213>213</a>
</span><span class=lnt id=hl-20-214><a class=lnlinks href=#hl-20-214>214</a>
</span><span class=lnt id=hl-20-215><a class=lnlinks href=#hl-20-215>215</a>
</span><span class=lnt id=hl-20-216><a class=lnlinks href=#hl-20-216>216</a>
</span><span class=lnt id=hl-20-217><a class=lnlinks href=#hl-20-217>217</a>
</span><span class=lnt id=hl-20-218><a class=lnlinks href=#hl-20-218>218</a>
</span><span class=lnt id=hl-20-219><a class=lnlinks href=#hl-20-219>219</a>
</span><span class=lnt id=hl-20-220><a class=lnlinks href=#hl-20-220>220</a>
</span><span class=lnt id=hl-20-221><a class=lnlinks href=#hl-20-221>221</a>
</span><span class=lnt id=hl-20-222><a class=lnlinks href=#hl-20-222>222</a>
</span><span class=lnt id=hl-20-223><a class=lnlinks href=#hl-20-223>223</a>
</span><span class=lnt id=hl-20-224><a class=lnlinks href=#hl-20-224>224</a>
</span><span class=lnt id=hl-20-225><a class=lnlinks href=#hl-20-225>225</a>
</span><span class=lnt id=hl-20-226><a class=lnlinks href=#hl-20-226>226</a>
</span><span class=lnt id=hl-20-227><a class=lnlinks href=#hl-20-227>227</a>
</span><span class=lnt id=hl-20-228><a class=lnlinks href=#hl-20-228>228</a>
</span><span class=lnt id=hl-20-229><a class=lnlinks href=#hl-20-229>229</a>
</span><span class=lnt id=hl-20-230><a class=lnlinks href=#hl-20-230>230</a>
</span><span class=lnt id=hl-20-231><a class=lnlinks href=#hl-20-231>231</a>
</span><span class=lnt id=hl-20-232><a class=lnlinks href=#hl-20-232>232</a>
</span><span class=lnt id=hl-20-233><a class=lnlinks href=#hl-20-233>233</a>
</span><span class=lnt id=hl-20-234><a class=lnlinks href=#hl-20-234>234</a>
</span><span class=lnt id=hl-20-235><a class=lnlinks href=#hl-20-235>235</a>
</span><span class=lnt id=hl-20-236><a class=lnlinks href=#hl-20-236>236</a>
</span><span class=lnt id=hl-20-237><a class=lnlinks href=#hl-20-237>237</a>
</span><span class=lnt id=hl-20-238><a class=lnlinks href=#hl-20-238>238</a>
</span><span class=lnt id=hl-20-239><a class=lnlinks href=#hl-20-239>239</a>
</span><span class=lnt id=hl-20-240><a class=lnlinks href=#hl-20-240>240</a>
</span><span class=lnt id=hl-20-241><a class=lnlinks href=#hl-20-241>241</a>
</span><span class=lnt id=hl-20-242><a class=lnlinks href=#hl-20-242>242</a>
</span><span class=lnt id=hl-20-243><a class=lnlinks href=#hl-20-243>243</a>
</span><span class=lnt id=hl-20-244><a class=lnlinks href=#hl-20-244>244</a>
</span><span class=lnt id=hl-20-245><a class=lnlinks href=#hl-20-245>245</a>
</span><span class=lnt id=hl-20-246><a class=lnlinks href=#hl-20-246>246</a>
</span><span class=lnt id=hl-20-247><a class=lnlinks href=#hl-20-247>247</a>
</span><span class=lnt id=hl-20-248><a class=lnlinks href=#hl-20-248>248</a>
</span><span class=lnt id=hl-20-249><a class=lnlinks href=#hl-20-249>249</a>
</span><span class=lnt id=hl-20-250><a class=lnlinks href=#hl-20-250>250</a>
</span><span class=lnt id=hl-20-251><a class=lnlinks href=#hl-20-251>251</a>
</span><span class=lnt id=hl-20-252><a class=lnlinks href=#hl-20-252>252</a>
</span><span class=lnt id=hl-20-253><a class=lnlinks href=#hl-20-253>253</a>
</span><span class=lnt id=hl-20-254><a class=lnlinks href=#hl-20-254>254</a>
</span><span class=lnt id=hl-20-255><a class=lnlinks href=#hl-20-255>255</a>
</span><span class=lnt id=hl-20-256><a class=lnlinks href=#hl-20-256>256</a>
</span><span class=lnt id=hl-20-257><a class=lnlinks href=#hl-20-257>257</a>
</span><span class=lnt id=hl-20-258><a class=lnlinks href=#hl-20-258>258</a>
</span><span class=lnt id=hl-20-259><a class=lnlinks href=#hl-20-259>259</a>
</span><span class=lnt id=hl-20-260><a class=lnlinks href=#hl-20-260>260</a>
</span><span class=lnt id=hl-20-261><a class=lnlinks href=#hl-20-261>261</a>
</span><span class=lnt id=hl-20-262><a class=lnlinks href=#hl-20-262>262</a>
</span><span class=lnt id=hl-20-263><a class=lnlinks href=#hl-20-263>263</a>
</span><span class=lnt id=hl-20-264><a class=lnlinks href=#hl-20-264>264</a>
</span><span class=lnt id=hl-20-265><a class=lnlinks href=#hl-20-265>265</a>
</span><span class=lnt id=hl-20-266><a class=lnlinks href=#hl-20-266>266</a>
</span><span class=lnt id=hl-20-267><a class=lnlinks href=#hl-20-267>267</a>
</span><span class=lnt id=hl-20-268><a class=lnlinks href=#hl-20-268>268</a>
</span><span class=lnt id=hl-20-269><a class=lnlinks href=#hl-20-269>269</a>
</span><span class=lnt id=hl-20-270><a class=lnlinks href=#hl-20-270>270</a>
</span><span class=lnt id=hl-20-271><a class=lnlinks href=#hl-20-271>271</a>
</span><span class=lnt id=hl-20-272><a class=lnlinks href=#hl-20-272>272</a>
</span><span class=lnt id=hl-20-273><a class=lnlinks href=#hl-20-273>273</a>
</span><span class=lnt id=hl-20-274><a class=lnlinks href=#hl-20-274>274</a>
</span><span class=lnt id=hl-20-275><a class=lnlinks href=#hl-20-275>275</a>
</span><span class=lnt id=hl-20-276><a class=lnlinks href=#hl-20-276>276</a>
</span><span class=lnt id=hl-20-277><a class=lnlinks href=#hl-20-277>277</a>
</span><span class=lnt id=hl-20-278><a class=lnlinks href=#hl-20-278>278</a>
</span><span class=lnt id=hl-20-279><a class=lnlinks href=#hl-20-279>279</a>
</span><span class=lnt id=hl-20-280><a class=lnlinks href=#hl-20-280>280</a>
</span><span class=lnt id=hl-20-281><a class=lnlinks href=#hl-20-281>281</a>
</span><span class=lnt id=hl-20-282><a class=lnlinks href=#hl-20-282>282</a>
</span><span class=lnt id=hl-20-283><a class=lnlinks href=#hl-20-283>283</a>
</span><span class=lnt id=hl-20-284><a class=lnlinks href=#hl-20-284>284</a>
</span><span class=lnt id=hl-20-285><a class=lnlinks href=#hl-20-285>285</a>
</span><span class=lnt id=hl-20-286><a class=lnlinks href=#hl-20-286>286</a>
</span><span class=lnt id=hl-20-287><a class=lnlinks href=#hl-20-287>287</a>
</span><span class=lnt id=hl-20-288><a class=lnlinks href=#hl-20-288>288</a>
</span><span class=lnt id=hl-20-289><a class=lnlinks href=#hl-20-289>289</a>
</span><span class=lnt id=hl-20-290><a class=lnlinks href=#hl-20-290>290</a>
</span><span class=lnt id=hl-20-291><a class=lnlinks href=#hl-20-291>291</a>
</span><span class=lnt id=hl-20-292><a class=lnlinks href=#hl-20-292>292</a>
</span><span class=lnt id=hl-20-293><a class=lnlinks href=#hl-20-293>293</a>
</span><span class=lnt id=hl-20-294><a class=lnlinks href=#hl-20-294>294</a>
</span><span class=lnt id=hl-20-295><a class=lnlinks href=#hl-20-295>295</a>
</span><span class=lnt id=hl-20-296><a class=lnlinks href=#hl-20-296>296</a>
</span><span class=lnt id=hl-20-297><a class=lnlinks href=#hl-20-297>297</a>
</span><span class=lnt id=hl-20-298><a class=lnlinks href=#hl-20-298>298</a>
</span><span class=lnt id=hl-20-299><a class=lnlinks href=#hl-20-299>299</a>
</span><span class=lnt id=hl-20-300><a class=lnlinks href=#hl-20-300>300</a>
</span><span class=lnt id=hl-20-301><a class=lnlinks href=#hl-20-301>301</a>
</span><span class=lnt id=hl-20-302><a class=lnlinks href=#hl-20-302>302</a>
</span><span class=lnt id=hl-20-303><a class=lnlinks href=#hl-20-303>303</a>
</span><span class=lnt id=hl-20-304><a class=lnlinks href=#hl-20-304>304</a>
</span><span class=lnt id=hl-20-305><a class=lnlinks href=#hl-20-305>305</a>
</span><span class=lnt id=hl-20-306><a class=lnlinks href=#hl-20-306>306</a>
</span><span class=lnt id=hl-20-307><a class=lnlinks href=#hl-20-307>307</a>
</span><span class=lnt id=hl-20-308><a class=lnlinks href=#hl-20-308>308</a>
</span><span class=lnt id=hl-20-309><a class=lnlinks href=#hl-20-309>309</a>
</span><span class=lnt id=hl-20-310><a class=lnlinks href=#hl-20-310>310</a>
</span><span class=lnt id=hl-20-311><a class=lnlinks href=#hl-20-311>311</a>
</span><span class=lnt id=hl-20-312><a class=lnlinks href=#hl-20-312>312</a>
</span><span class=lnt id=hl-20-313><a class=lnlinks href=#hl-20-313>313</a>
</span><span class=lnt id=hl-20-314><a class=lnlinks href=#hl-20-314>314</a>
</span><span class=lnt id=hl-20-315><a class=lnlinks href=#hl-20-315>315</a>
</span><span class=lnt id=hl-20-316><a class=lnlinks href=#hl-20-316>316</a>
</span><span class=lnt id=hl-20-317><a class=lnlinks href=#hl-20-317>317</a>
</span><span class=lnt id=hl-20-318><a class=lnlinks href=#hl-20-318>318</a>
</span><span class=lnt id=hl-20-319><a class=lnlinks href=#hl-20-319>319</a>
</span><span class=lnt id=hl-20-320><a class=lnlinks href=#hl-20-320>320</a>
</span><span class=lnt id=hl-20-321><a class=lnlinks href=#hl-20-321>321</a>
</span><span class=lnt id=hl-20-322><a class=lnlinks href=#hl-20-322>322</a>
</span><span class=lnt id=hl-20-323><a class=lnlinks href=#hl-20-323>323</a>
</span><span class=lnt id=hl-20-324><a class=lnlinks href=#hl-20-324>324</a>
</span><span class=lnt id=hl-20-325><a class=lnlinks href=#hl-20-325>325</a>
</span><span class=lnt id=hl-20-326><a class=lnlinks href=#hl-20-326>326</a>
</span><span class=lnt id=hl-20-327><a class=lnlinks href=#hl-20-327>327</a>
</span><span class=lnt id=hl-20-328><a class=lnlinks href=#hl-20-328>328</a>
</span><span class=lnt id=hl-20-329><a class=lnlinks href=#hl-20-329>329</a>
</span><span class=lnt id=hl-20-330><a class=lnlinks href=#hl-20-330>330</a>
</span><span class=lnt id=hl-20-331><a class=lnlinks href=#hl-20-331>331</a>
</span><span class=lnt id=hl-20-332><a class=lnlinks href=#hl-20-332>332</a>
</span><span class=lnt id=hl-20-333><a class=lnlinks href=#hl-20-333>333</a>
</span><span class=lnt id=hl-20-334><a class=lnlinks href=#hl-20-334>334</a>
</span><span class=lnt id=hl-20-335><a class=lnlinks href=#hl-20-335>335</a>
</span><span class=lnt id=hl-20-336><a class=lnlinks href=#hl-20-336>336</a>
</span><span class=lnt id=hl-20-337><a class=lnlinks href=#hl-20-337>337</a>
</span><span class=lnt id=hl-20-338><a class=lnlinks href=#hl-20-338>338</a>
</span><span class=lnt id=hl-20-339><a class=lnlinks href=#hl-20-339>339</a>
</span><span class=lnt id=hl-20-340><a class=lnlinks href=#hl-20-340>340</a>
</span><span class=lnt id=hl-20-341><a class=lnlinks href=#hl-20-341>341</a>
</span><span class=lnt id=hl-20-342><a class=lnlinks href=#hl-20-342>342</a>
</span><span class=lnt id=hl-20-343><a class=lnlinks href=#hl-20-343>343</a>
</span><span class=lnt id=hl-20-344><a class=lnlinks href=#hl-20-344>344</a>
</span><span class=lnt id=hl-20-345><a class=lnlinks href=#hl-20-345>345</a>
</span><span class=lnt id=hl-20-346><a class=lnlinks href=#hl-20-346>346</a>
</span><span class=lnt id=hl-20-347><a class=lnlinks href=#hl-20-347>347</a>
</span><span class=lnt id=hl-20-348><a class=lnlinks href=#hl-20-348>348</a>
</span><span class=lnt id=hl-20-349><a class=lnlinks href=#hl-20-349>349</a>
</span><span class=lnt id=hl-20-350><a class=lnlinks href=#hl-20-350>350</a>
</span><span class=lnt id=hl-20-351><a class=lnlinks href=#hl-20-351>351</a>
</span><span class=lnt id=hl-20-352><a class=lnlinks href=#hl-20-352>352</a>
</span><span class=lnt id=hl-20-353><a class=lnlinks href=#hl-20-353>353</a>
</span><span class=lnt id=hl-20-354><a class=lnlinks href=#hl-20-354>354</a>
</span><span class=lnt id=hl-20-355><a class=lnlinks href=#hl-20-355>355</a>
</span><span class=lnt id=hl-20-356><a class=lnlinks href=#hl-20-356>356</a>
</span><span class=lnt id=hl-20-357><a class=lnlinks href=#hl-20-357>357</a>
</span><span class=lnt id=hl-20-358><a class=lnlinks href=#hl-20-358>358</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Netflix 스타일 이벤트 기반 추천 시스템 구현</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>asdict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Set</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ViewingEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사용자 시청 이벤트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_type</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># movie, series, documentary</span>
</span></span><span class=line><span class=cl>    <span class=n>genre</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>duration_watched</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># seconds</span>
</span></span><span class=line><span class=cl>    <span class=n>total_duration</span><span class=p>:</span> <span class=nb>int</span>   <span class=c1># seconds</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>device_type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>completion_rate</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_message</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 메시지로 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;viewing_event&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>content_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>asdict</span><span class=p>(</span><span class=bp>self</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;중앙 이벤트 버스 - Apache Kafka 역할&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>callable</span><span class=p>]]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;토픽 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topics</span><span class=p>[</span><span class=n>topic</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Handler subscribed to topic: </span><span class=si>{</span><span class=n>topic</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_history</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;topic&#34;</span><span class=p>:</span> <span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 구독자에게 비동기적으로 메시지 전달</span>
</span></span><span class=line><span class=cl>        <span class=n>handlers</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>topics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>topic</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=n>handler</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=n>handlers</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>,</span> <span class=n>return_exceptions</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Published to </span><span class=si>{</span><span class=n>topic</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_type&#39;</span><span class=p>,</span> <span class=s1>&#39;unknown&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ViewingService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;시청 서비스 - 사용자 시청 행동 추적&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>:</span> <span class=n>EventBus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_viewing_session</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                  <span class=n>content_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>genre</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                                  <span class=n>total_duration</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>device_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 세션 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>session_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>content_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>[</span><span class=n>session_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content_type&#34;</span><span class=p>:</span> <span class=n>content_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;genre&#34;</span><span class=p>:</span> <span class=n>genre</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_duration&#34;</span><span class=p>:</span> <span class=n>total_duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;device_type&#34;</span><span class=p>:</span> <span class=n>device_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;start_time&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;duration_watched&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Started viewing session: </span><span class=si>{</span><span class=n>session_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>session_id</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_viewing_progress</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>duration_watched</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 진행 상황 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>session_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>[</span><span class=n>session_id</span><span class=p>][</span><span class=s2>&#34;duration_watched&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>duration_watched</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>end_viewing_session</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 세션 종료 및 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>session_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>[</span><span class=n>session_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>completion_rate</span> <span class=o>=</span> <span class=n>session</span><span class=p>[</span><span class=s2>&#34;duration_watched&#34;</span><span class=p>]</span> <span class=o>/</span> <span class=n>session</span><span class=p>[</span><span class=s2>&#34;total_duration&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시청 이벤트 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>viewing_event</span> <span class=o>=</span> <span class=n>ViewingEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;content_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>content_type</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;content_type&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>genre</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;genre&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>duration_watched</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;duration_watched&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>total_duration</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;total_duration&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>device_type</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s2>&#34;device_type&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>completion_rate</span><span class=o>=</span><span class=n>completion_rate</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 버스에 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=s2>&#34;viewing_events&#34;</span><span class=p>,</span> <span class=n>viewing_event</span><span class=o>.</span><span class=n>to_message</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 세션 정리</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sessions</span><span class=p>[</span><span class=n>session_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Ended viewing session: </span><span class=si>{</span><span class=n>session_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;추천 서비스 - 실시간 개인화 추천&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>:</span> <span class=n>EventBus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>user_preferences</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;preferred_genres&#34;</span><span class=p>:</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>float</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content_types&#34;</span><span class=p>:</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>float</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;viewing_patterns&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;last_updated&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시청 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;viewing_events&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_viewing_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_viewing_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 이벤트 처리하여 추천 모델 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 사용자 선호도 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_user_preferences</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실시간 추천 목록 갱신</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_refresh_recommendations</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Updated recommendations for user: </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error processing viewing event: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_update_user_preferences</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 선호도 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>prefs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_preferences</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 장르 선호도 업데이트 (완시청률 기반 가중치)</span>
</span></span><span class=line><span class=cl>        <span class=n>completion_rate</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;completion_rate&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>genre</span> <span class=ow>in</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;genre&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_score</span> <span class=o>=</span> <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;preferred_genres&#34;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=c1># 완시청률이 높을수록 선호도 증가</span>
</span></span><span class=line><span class=cl>            <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;preferred_genres&#34;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span> <span class=o>=</span> <span class=n>current_score</span> <span class=o>+</span> <span class=n>completion_rate</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 콘텐츠 타입 선호도 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>content_type</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;content_type&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;content_types&#34;</span><span class=p>][</span><span class=n>content_type</span><span class=p>]</span> <span class=o>+=</span> <span class=n>completion_rate</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시청 패턴 기록 (최근 100개만 유지)</span>
</span></span><span class=line><span class=cl>        <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;viewing_patterns&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;timestamp&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;completion_rate&#34;</span><span class=p>:</span> <span class=n>completion_rate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;device_type&#34;</span><span class=p>:</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;device_type&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;viewing_patterns&#34;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;viewing_patterns&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;viewing_patterns&#34;</span><span class=p>][</span><span class=o>-</span><span class=mi>100</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;last_updated&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_refresh_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자별 추천 목록 갱신&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>prefs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_preferences</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 선호 장르 기반 추천 (간단한 규칙 기반)</span>
</span></span><span class=line><span class=cl>        <span class=n>top_genres</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;preferred_genres&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)[:</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 목록 생성 (실제로는 더 복잡한 ML 모델 사용)</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>genre</span><span class=p>,</span> <span class=n>score</span> <span class=ow>in</span> <span class=n>top_genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>recommendations</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;content_</span><span class=si>{</span><span class=n>genre</span><span class=si>}</span><span class=s2>_1&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;content_</span><span class=si>{</span><span class=n>genre</span><span class=si>}</span><span class=s2>_2&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;content_</span><span class=si>{</span><span class=n>genre</span><span class=si>}</span><span class=s2>_3&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 결과를 다른 서비스에 알림</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendation_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;recommendations_updated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=p>[:</span><span class=mi>10</span><span class=p>],</span>  <span class=c1># 상위 10개</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=s2>&#34;recommendation_updates&#34;</span><span class=p>,</span> <span class=n>recommendation_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_user_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 추천 목록 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>prefs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_preferences</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;preferred_genres&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[</span><span class=s2>&#34;popular_content_1&#34;</span><span class=p>,</span> <span class=s2>&#34;popular_content_2&#34;</span><span class=p>,</span> <span class=s2>&#34;popular_content_3&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 선호도 기반 추천 반환</span>
</span></span><span class=line><span class=cl>        <span class=n>top_genres</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>prefs</span><span class=p>[</span><span class=s2>&#34;preferred_genres&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> 
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)[:</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>genre</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>top_genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>recommendations</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;recommended_</span><span class=si>{</span><span class=n>genre</span><span class=si>}</span><span class=s2>_content_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>recommendations</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AnalyticsService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;분석 서비스 - 실시간 시청 분석&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>:</span> <span class=n>EventBus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_views&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;genre_popularity&#34;</span><span class=p>:</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;device_usage&#34;</span><span class=p>:</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;completion_rates&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;popular_content&#34;</span><span class=p>:</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;viewing_events&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_viewing_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;recommendation_updates&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_recommendation_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_viewing_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 이벤트 분석&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_data</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 전체 시청 수 증가</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;total_views&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 장르별 인기도 집계</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>genre</span> <span class=ow>in</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;genre&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;genre_popularity&#34;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 디바이스 사용 통계</span>
</span></span><span class=line><span class=cl>            <span class=n>device</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;device_type&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;device_usage&#34;</span><span class=p>][</span><span class=n>device</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 완시청률 통계</span>
</span></span><span class=line><span class=cl>            <span class=n>completion_rate</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;completion_rate&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>completion_rate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>1000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>][</span><span class=o>-</span><span class=mi>1000</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 콘텐츠 인기도</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s2>&#34;content_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;popular_content&#34;</span><span class=p>][</span><span class=n>content_id</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Analytics updated - Total views: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s1>&#39;total_views&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error in analytics processing: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_recommendation_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;추천 업데이트 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s2>&#34;recommendations&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Recommendation analytics for user </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>recommendations</span><span class=p>)</span><span class=si>}</span><span class=s2> items&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_analytics_summary</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분석 요약 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_completion</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>sum</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>])</span> <span class=o>/</span> 
</span></span><span class=line><span class=cl>            <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;completion_rates&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_views&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;total_views&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;average_completion_rate&#34;</span><span class=p>:</span> <span class=nb>round</span><span class=p>(</span><span class=n>avg_completion</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;top_genres&#34;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;genre_popularity&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=p>)[:</span><span class=mi>5</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;device_distribution&#34;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;device_usage&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;popular_content&#34;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>viewing_stats</span><span class=p>[</span><span class=s2>&#34;popular_content&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=p>)[:</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 시스템 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>simulate_netflix_system</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Netflix 시스템 시뮬레이션&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 버스 및 서비스 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>viewing_service</span> <span class=o>=</span> <span class=n>ViewingService</span><span class=p>(</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendation_service</span> <span class=o>=</span> <span class=n>RecommendationService</span><span class=p>(</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>analytics_service</span> <span class=o>=</span> <span class=n>AnalyticsService</span><span class=p>(</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== Netflix MOA System Simulation ===</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 사용자 시청 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=n>users</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;user_1&#34;</span><span class=p>,</span> <span class=s2>&#34;user_2&#34;</span><span class=p>,</span> <span class=s2>&#34;user_3&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>contents</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;movie_action_1&#34;</span><span class=p>,</span> <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;movie&#34;</span><span class=p>,</span> <span class=s2>&#34;genre&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;action&#34;</span><span class=p>,</span> <span class=s2>&#34;thriller&#34;</span><span class=p>],</span> <span class=s2>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>7200</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;series_drama_1&#34;</span><span class=p>,</span> <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;series&#34;</span><span class=p>,</span> <span class=s2>&#34;genre&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;drama&#34;</span><span class=p>,</span> <span class=s2>&#34;romance&#34;</span><span class=p>],</span> <span class=s2>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>3600</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;doc_nature_1&#34;</span><span class=p>,</span> <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;documentary&#34;</span><span class=p>,</span> <span class=s2>&#34;genre&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;nature&#34;</span><span class=p>,</span> <span class=s2>&#34;education&#34;</span><span class=p>],</span> <span class=s2>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>5400</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 여러 시청 세션 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=n>sessions</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>contents</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session_id</span> <span class=o>=</span> <span class=k>await</span> <span class=n>viewing_service</span><span class=o>.</span><span class=n>start_viewing_session</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>user_id</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>content_id</span><span class=o>=</span><span class=n>content</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>content_type</span><span class=o>=</span><span class=n>content</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>genre</span><span class=o>=</span><span class=n>content</span><span class=p>[</span><span class=s2>&#34;genre&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>total_duration</span><span class=o>=</span><span class=n>content</span><span class=p>[</span><span class=s2>&#34;duration&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>device_type</span><span class=o>=</span><span class=s2>&#34;smart_tv&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>sessions</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>session_id</span><span class=p>,</span> <span class=n>content</span><span class=p>[</span><span class=s2>&#34;duration&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 시청 진행 시뮬레이션</span>
</span></span><span class=line><span class=cl>            <span class=n>watched_duration</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>content</span><span class=p>[</span><span class=s2>&#34;duration&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>+</span> <span class=p>(</span><span class=nb>hash</span><span class=p>(</span><span class=n>user</span> <span class=o>+</span> <span class=n>content</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>])</span> <span class=o>%</span> <span class=mi>50</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>viewing_service</span><span class=o>.</span><span class=n>update_viewing_progress</span><span class=p>(</span><span class=n>session_id</span><span class=p>,</span> <span class=n>watched_duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 잠시 대기</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 시청 세션 종료</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>session_id</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>sessions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>viewing_service</span><span class=o>.</span><span class=n>end_viewing_session</span><span class=p>(</span><span class=n>session_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 이벤트 처리 대기</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 결과 확인</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== Analytics Summary ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>analytics_summary</span> <span class=o>=</span> <span class=n>analytics_service</span><span class=o>.</span><span class=n>get_analytics_summary</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>analytics_summary</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== User Recommendations ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=n>recommendation_service</span><span class=o>.</span><span class=n>get_user_recommendations</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>user</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>recommendations</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>simulate_netflix_system</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=글로벌-분산-메시징-설계--실행-아키텍처-구성>글로벌 분산 메시징 설계 / 실행 아키텍처 구성<a hidden class=anchor aria-hidden=true href=#글로벌-분산-메시징-설계--실행-아키텍처-구성>#</a></h3><p>메시징 서비스가 여러 리전 (지역) 및 데이터 센터에 분포되어 높은 가용성과 지연 저감을 목표로 하는 아키텍처이다. 지리적으로 분리된 시스템 간 데이터 전달을 위해 Geo-replication, 로컬 처리, 장애 대비 전략이 필수이다.</p><h4 id=아키텍처-기본-요소>아키텍처 기본 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-기본-요소>#</a></h4><pre class=mermaid>graph LR
  subgraph Region A
    AProd[Producer A] --&gt; ABrk[(Broker A)]
    ABrk --&gt; ACons[Consumer A]
  end
  subgraph Region B
    BProd[Producer B] --&gt; BBrk[(Broker B)]
    BBrk --&gt; BCons[Consumer B]
  end
  ABrk &lt;--&gt; BBrk
  style ABrk fill:#eef
  style BBrk fill:#eef
</pre><p><strong>핵심 구성 요소</strong>:</p><ul><li><strong>Broker 클러스터</strong>: 각 리전의 메시지 중계 및 저장</li><li><strong>Geo-replication</strong>: 리전 간 메시지 복제 및 지연 모니터링</li><li><strong>Conflict 해결</strong>: CRDT, idempotent producer/consumer 적용</li></ul><h4 id=주요-고려사항>주요 고려사항<a hidden class=anchor aria-hidden=true href=#주요-고려사항>#</a></h4><ul><li><strong>Replication lag</strong>: 지연 감시 필요</li><li><strong>Consistency 모델</strong>: eventual consistency vs strong consistency</li><li><strong>로드/라우팅 정책</strong>: 지역선택, 백업 리전 자동 전환</li><li><strong>보안·컴플라이언스</strong>: 리전별 암호화·격리, 규정 준수</li></ul><h3 id=메시지-기반-분산-트랜잭션>메시지 기반 분산 트랜잭션<a hidden class=anchor aria-hidden=true href=#메시지-기반-분산-트랜잭션>#</a></h3><p>분산 트랜잭션 처리를 위해 작업을 여러 로컬 트랜잭션으로 나누고, 실패 시 보상 트랜잭션으로 복원한다.</p><h4 id=유형>유형<a hidden class=anchor aria-hidden=true href=#유형>#</a></h4><table><thead><tr><th>방식</th><th>특징</th></tr></thead><tbody><tr><td><strong>Choreography</strong></td><td>각 서비스가 이벤트를 발행/구독하며 흐름 제어<br>중앙 조정자 없음</td></tr><tr><td><strong>Orchestration</strong></td><td>중앙 조정자 (예: AWS Step Functions) 가 흐름 제어 및 상태 관리</td></tr></tbody></table><h4 id=흐름-예시-choreography>흐름 예시 (Choreography)<a hidden class=anchor aria-hidden=true href=#흐름-예시-choreography>#</a></h4><pre class=mermaid>sequenceDiagram
  OrderService -&gt;&gt; Broker: publish(OrderCreated)
  InventorySvc -&gt;&gt; Broker: publish(InventoryReserved)
  PaymentSvc -&gt;&gt; Broker: publish(PaymentProcessed)
  NotificationSvc -&gt;&gt; Broker: send(Notification)
</pre><h4 id=보상-트랜잭션>보상 트랜잭션<a hidden class=anchor aria-hidden=true href=#보상-트랜잭션>#</a></h4><ul><li>실패 시 <code>CancelInventory</code>, <code>RefundPayment</code> 같은 보상 메시지를 발행해 이전 단계 롤백 처리.</li></ul><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려 영역</th><th>주요 이슈 / 설명</th><th>권장 사항</th></tr></thead><tbody><tr><td><strong>1. 메시지 설계 및 관리</strong></td><td>메시지 정의 표준화</td><td>메시지 구조/포맷/네이밍 불일치로 인한 통합 실패</td><td>표준 스키마 정의, 메시지 포털 운영, 명세 문서화</td></tr><tr><td></td><td>스키마 진화</td><td>버전 불일치, 하위 호환성 문제</td><td>Schema Registry 도입, 버전 관리, CI 기반 자동 검증</td></tr><tr><td></td><td>메시지 크기 최적화</td><td>대용량 메시지 전송으로 인한 네트워크 부하</td><td>외부 저장소 (S3 등) 참조 방식, 메시지 압축 적용</td></tr><tr><td></td><td>메시지 순서 보장</td><td>순서 민감 시스템에서 처리 오류 발생</td><td>파티션 키, 세션 기반 처리, FIFO 큐 사용</td></tr><tr><td></td><td>멱등성 처리</td><td>중복 메시지 수신 시 부작용</td><td>메시지 ID, Redis/DB 기반 Deduplication 로직 구현</td></tr><tr><td><strong>2. 아키텍처 설계 전략</strong></td><td>메시지 경계 설계</td><td>잘못된 메시지 분리로 서비스간 강결합 발생</td><td>Bounded Context 기반 설계, DDD 기반 메시지 정의</td></tr><tr><td></td><td>메시징 토폴로지</td><td>초기 설계 시 허브 구조 집중으로 병목 발생 가능</td><td>Hub-and-Spoke → 분산 구조로 점진적 전환 고려</td></tr><tr><td></td><td>메시지 흐름 패턴</td><td>과도한 Request-Reply 로 인한 동기화</td><td>비동기 Pub/Sub 구조 선호, 필요 시 Reply Queue 병행 사용</td></tr><tr><td></td><td>메시지 보존 전략</td><td>장기 보존 시 비용 증가</td><td>TTL 설정, Retention 주기 관리, Tiered Storage 활용</td></tr><tr><td><strong>3. 성능 최적화 및 확장성</strong></td><td>파티셔닝 전략</td><td>특정 키 쏠림 → 핫 파티션 발생</td><td>고른 키 분포, 리밸런싱 자동화, 병렬 처리 구조 설계</td></tr><tr><td></td><td>백프레셔 처리</td><td>소비자 부족 시 메시지 지연</td><td>QoS 설정, Consumer Group Auto Scaling, Throttling</td></tr><tr><td></td><td>배치 처리</td><td>실시간 처리에 부담 가중</td><td>적절한 배치 크기 설정, 처리량 vs 지연 균형 조절</td></tr><tr><td></td><td>메시지 압축</td><td>네트워크/스토리지 자원 절약</td><td>gzip, LZ4 등 성능 균형 고려하여 적용</td></tr><tr><td></td><td>DLQ 구성</td><td>무한 재시도로 리소스 낭비</td><td>재시도 제한, TTL 설정, DLQ + 알림 시스템 병행</td></tr><tr><td><strong>4. 운영 및 가시성</strong></td><td>모니터링 체계</td><td>시스템 병목, 지연 시간 파악 어려움</td><td>Prometheus + Grafana 기반 메트릭 수집, lag 모니터링</td></tr><tr><td></td><td>분산 추적</td><td>메시지 흐름 전파 경로 파악 어려움</td><td>OpenTelemetry, Jaeger, TraceContext 전파 구현</td></tr><tr><td></td><td>장애 대응</td><td>브로커 장애 시 메시지 유실 위험</td><td>이중화 구성, 자동 장애 조치, 백업/복구 정책 수립</td></tr><tr><td></td><td>용량 계획</td><td>트래픽 급증에 따른 과부하</td><td>트래픽 예측 기반 사전 확장 정책 수립, 스케일링 자동화</td></tr><tr><td><strong>5. 보안 및 규정 준수</strong></td><td>암호화 및 인증</td><td>민감 데이터 노출</td><td>TLS 적용, 종단 간 암호화, OAuth2.0, mTLS 구성</td></tr><tr><td></td><td>접근 제어</td><td>비인가 사용자 접근 우려</td><td>IAM, RBAC, 토큰 기반 인증, ACL 설정</td></tr><tr><td></td><td>감사 및 규정 대응</td><td>변경 내역 추적, 사고 대응력 부족</td><td>감사 로그 관리, 장기 보관 정책, 감사 시스템 연동</td></tr><tr><td><strong>6. 테스트 및 운영 안정성</strong></td><td>계약 테스트</td><td>인터페이스 변경 시 장애 발생</td><td>AsyncAPI, Pact 기반 Contract Testing 도입</td></tr><tr><td></td><td>메시지 재처리</td><td>오류 메시지 누락 혹은 중복 발생</td><td>재처리 로직 구현, DLQ 재전송 정책 설정</td></tr><tr><td></td><td>장애 시뮬레이션</td><td>운영 환경 장애 대응력 부족</td><td>Chaos Messaging 테스트 도입, 장애 주입 실험 환경 구성</td></tr></tbody></table><h4 id=메시징-아키텍처-성숙도-모델-및-도입-전략>메시징 아키텍처 성숙도 모델 및 도입 전략<a hidden class=anchor aria-hidden=true href=#메시징-아키텍처-성숙도-모델-및-도입-전략>#</a></h4><table><thead><tr><th><strong>성숙도 레벨</strong></th><th><strong>핵심 특징</strong></th><th><strong>도입 전략 및 주요 요소</strong></th></tr></thead><tbody><tr><td><strong>Level 1</strong><br>기본 메시징</td><td>- Point-to-Point 큐 기반<br>- 부분적 비동기화</td><td>- 단일 브로커 환경에서 시작<br>- 동기 시스템에 메시지 큐 도입하여 비동기화 시도</td></tr><tr><td><strong>Level 2</strong><br>이벤트 기반 아키텍처</td><td>- Publish-Subscribe 패턴<br>- 도메인 이벤트 사용</td><td>- 이벤트 스토밍 도입<br>- 서비스 간 비동기 이벤트 기반 통신<br>- 이벤트 처리 로직 분리 및 최소화</td></tr><tr><td><strong>Level 3</strong><br>엔터프라이즈 통합</td><td>- 통합 패턴 전면 적용<br>- 복합 이벤트 처리 (CEP)</td><td>- EIP (Enterprise Integration Patterns) 설계 반영<br>- 이벤트 시퀀싱, 변환, 라우팅 구성<br>- 크로스 시스템 오케스트레이션 적용</td></tr><tr><td><strong>Level 4</strong><br>플랫폼 수준 메시징</td><td>- 메시징 플랫폼화<br>- 조직 수준 거버넌스</td><td>- 메시징 인프라를 플랫폼으로 전환<br>- 메시징 서비스 셀프 서비스화<br>- 메시징 표준, 권한, 관측 가능성 거버넌스 체계 구축</td></tr></tbody></table><h4 id=클라우드-관리형-메시징-vs-자체-구축-onprem>클라우드 관리형 메시징 vs. 자체 구축 (On‑prem)<a hidden class=anchor aria-hidden=true href=#클라우드-관리형-메시징-vs-자체-구축-onprem>#</a></h4><table><thead><tr><th>항목</th><th>Cloud Managed (예: AWS SQS/SNS)</th><th>On‑prem (Kafka, RabbitMQ, Pulsar 등)</th></tr></thead><tbody><tr><td><strong>운영 편의성</strong></td><td>완전 자동화, SLA/Uptime 보장</td><td>직접 설정·모니터링·백업 필요</td></tr><tr><td><strong>비용 구조</strong></td><td>사용량 기반 과금</td><td>초기 투자, 예측 가능한 고정 비용</td></tr><tr><td><strong>성능 및 지연</strong></td><td>SLA 에 따라, 리전 간 지연 존재</td><td>최저 레이턴시, 직접 튜닝 가능</td></tr><tr><td><strong>기능 유연성</strong></td><td>CSP 제공 기능 중심, 설정 옵션 제한</td><td>브로커 구조 및 코드 수준 커스터마이징 가능</td></tr><tr><td><strong>보안/컴플라이언스</strong></td><td>IAM, VPC 내 보안, 인증된 환경 제공</td><td>TLS, ACL, VPN, 물리적 접근 제어 직접 구현 필요</td></tr><tr><td><strong>생태계 연동</strong></td><td>CSP 서비스 (S3, Lambda 등) 와 통합 용이</td><td>오픈소스·커스텀 통합 자유도 높음</td></tr></tbody></table><h4 id=메시지-테스트-전략>메시지 테스트 전략<a hidden class=anchor aria-hidden=true href=#메시지-테스트-전략>#</a></h4><table><thead><tr><th>테스트 수준</th><th>목적</th><th>방법 및 도구</th></tr></thead><tbody><tr><td><strong>단위 테스트</strong></td><td>Producer/Consumer 내 메시지 로직 검증</td><td>Mock 브로커 라이브러리 (예: Mockito, fake-kafka), 메시지 생성/처리 로직 독립 테스트</td></tr><tr><td><strong>통합 테스트</strong></td><td>메시지 흐름 E2E 검증</td><td>Docker Testcontainers 사용 Kafka/RabbitMQ 포함한 테스트 환경 구축</td></tr><tr><td><strong>계약 테스트</strong></td><td>메시지 스키마 계약 (Auto-forward/back compatibility) 보장</td><td>Pact, Kafka Schema Registry 테스트 자동화</td></tr><tr><td><strong>성능 테스트</strong></td><td>처리량, 레이턴시, 지연 확인</td><td>k6, JMeter, Gatling 등으로 지속 부하 성능 평가</td></tr><tr><td><strong>혼합/Chaos 테스트</strong></td><td>메시지 시스템 장애 복원력 평가</td><td>Gremlin, Chaos Monkey 로 브로커/네트워크 장애 시나리오 실험</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>최적화 요소</strong></th><th><strong>설명</strong></th><th><strong>주의할 점</strong></th><th><strong>권장 사항</strong></th></tr></thead><tbody><tr><td><strong>1. 성능 최적화</strong></td><td>직렬화 최적화</td><td>메시지 인코딩/디코딩 비용 최소화</td><td>텍스트 포맷 (JSON 등) 은 CPU 부하 발생</td><td><strong>Avro, Protobuf, MessagePack</strong> 사용</td></tr><tr><td></td><td>비동기 I/O</td><td>논블로킹 방식으로 처리량 극대화</td><td>이벤트 루프 병목 가능성</td><td><strong>NIO 기반 클라이언트 라이브러리</strong> 사용</td></tr><tr><td></td><td>메시지 배치 전송</td><td>송수신 효율성 향상 (RTT 최소화)</td><td>대기 시간 증가로 인한 레이턴시 상승</td><td><strong>적응형 배치 크기</strong> 설정</td></tr><tr><td></td><td>연결 풀링</td><td>연결 비용 절감 및 커넥션 재사용</td><td>풀 과도 생성 시 오히려 리소스 낭비</td><td><strong>Keep-Alive, 커넥션 재활용</strong></td></tr><tr><td></td><td>메시지 병렬 처리</td><td>다중 Consumer 가 동시에 처리하여 Throughput 향상</td><td>순서 보장이 필요한 경우 충돌 발생 가능성</td><td><strong>파티셔닝 기반 병렬 처리</strong> 적용</td></tr><tr><td><strong>2. 메모리 최적화</strong></td><td>메시지 버퍼링</td><td>처리량 및 메모리 소비 간 균형 확보</td><td>버퍼 포화 시 백프레셔 발생 가능성</td><td><strong>동적 버퍼 크기 + 모니터링</strong></td></tr><tr><td></td><td>오프힙 메모리 활용</td><td>GC 오버헤드 감소</td><td>복잡한 메모리 매핑 관리 필요</td><td><strong>Chronicle Map, mmap</strong> 등 활용</td></tr><tr><td></td><td>가비지 컬렉션 튜닝</td><td>GC 시간 최적화로 짧은 응답시간 확보</td><td>튜닝 실패 시 일시적 중단 및 응답 지연</td><td><strong>G1GC + 힙/영역 크기 튜닝</strong></td></tr><tr><td></td><td>메시지 풀링 및 재사용</td><td>객체 재할당 감소로 GC 비용 줄이기</td><td>누수 발생 시 OOM 위험</td><td><strong>메시지 객체 풀링, WeakRef 고려</strong></td></tr><tr><td><strong>3. 네트워크 최적화</strong></td><td>메시지 압축</td><td>네트워크 트래픽 감소</td><td>과도한 압축 시 CPU 부하 발생</td><td><strong>압축 레벨 자동 조정 (ex: LZ4)</strong></td></tr><tr><td></td><td>데이터 지역성 활용</td><td>지연 시간 및 전송 거리 최소화</td><td>데이터 분산 전략이 잘못될 경우 네트워크 역효과</td><td><strong>브로커 - 컨슈머 지역 배치, CDN, 엣지 활용</strong></td></tr><tr><td></td><td>TCP 커넥션 최적화</td><td>연결 설정 시간 및 왕복 시간 단축</td><td>TCP 소켓 과다 생성 시 커널 자원 낭비</td><td><strong>파이프라이닝, Keep-Alive, SO_REUSEADDR</strong> 설정</td></tr><tr><td><strong>4. 확장성 최적화</strong></td><td>파티셔닝 및 샤딩</td><td>부하를 균등하게 분산하여 수평 확장성 확보</td><td>키 불균형 시 핫스팟 발생</td><td><strong>일관 해싱, 범위 + 해시 복합 전략</strong></td></tr><tr><td></td><td>자동 스케일링</td><td>트래픽 증가 시 자동으로 인스턴스 확장</td><td>스케일 급증 시 설정 불안정성</td><td><strong>HPA + 메트릭 기반 예측 스케일링</strong></td></tr><tr><td></td><td>리밸런싱 전략</td><td>파티션 재분배 시 클러스터 안정성 유지</td><td>실시간 리밸런싱 중 처리 지연 발생 가능성</td><td><strong>오프피크 시간대 또는 단계적 리밸런싱 적용</strong></td></tr><tr><td><strong>5. 가용성 최적화</strong></td><td>다중 리전/데이터센터 구성</td><td>장애 도메인 분리로 복원력 확보</td><td>데이터 복제 지연, 네트워크 비용 증가</td><td><strong>Active-Active 또는 Geo-Replication 구성</strong></td></tr><tr><td></td><td>장애 감지 및 복구</td><td>시스템 장애 감지 후 자동 복구</td><td>과도한 장애 전이 가능성</td><td><strong>헬스체크 + 자동 Failover + DLQ 설정</strong></td></tr><tr><td></td><td>백업 및 복원</td><td>데이터 손실 없이 복구 가능</td><td>검증되지 않은 백업은 무용지물</td><td><strong>증분 백업 + 주기적 복원 테스트</strong></td></tr><tr><td><strong>6. 저장소 최적화</strong></td><td>파티셔닝 + 인덱싱 전략</td><td>디스크 I/O 분산과 조회 최적화</td><td>인덱스 과잉 시 쓰기 성능 저하</td><td><strong>읽기 vs 쓰기 비율 기반 인덱스 구성</strong></td></tr><tr><td></td><td>메시지 필터링 및 압축</td><td>메시지 유효성 판단 후 유효 데이터만 저장</td><td>과도한 필터링으로 중요 데이터 유실 가능성</td><td><strong>Kafka Streams 등으로 Preprocessing</strong></td></tr><tr><td><strong>7. 운영 및 튜닝</strong></td><td>JVM 및 OS 레벨 튜닝</td><td>리소스 효율적 사용 및 예측 가능한 성능 확보</td><td>플랫폼 종속성 주의</td><td><strong>GC 정책, File Handle 수, IRQ 우선순위 설정</strong></td></tr><tr><td></td><td>모니터링 및 Alerting</td><td>이상 징후 조기 탐지</td><td>과도한 알림은 운영 리소스 낭비</td><td><strong>Prometheus + Alertmanager 연계</strong></td></tr><tr><td></td><td>부하 테스트 자동화</td><td>처리 한계 및 병목점 사전 식별</td><td>테스트 환경과 운영 환경 차이 존재</td><td><strong>Locust, K6, Chaos Toolkit 활용</strong></td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>주제</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 아키텍처 원칙</strong></td><td>메시지 지향 아키텍처 (MOA)</td><td>느슨한 결합</td><td>컴포넌트 간 직접 호출을 제거하여 독립성과 유지보수성을 향상</td></tr><tr><td></td><td></td><td>확장성</td><td>Producer/Consumer 를 동적으로 추가 가능</td></tr><tr><td></td><td></td><td>비동기 통신</td><td>송수신의 시간적 독립성으로 고성능 처리 가능</td></tr><tr><td></td><td></td><td>분산 처리</td><td>여러 노드 간 메시지 기반 협업 수행</td></tr><tr><td></td><td>Enterprise Integration Patterns</td><td>Message Router</td><td>메시지 내용을 기반으로 동적 라우팅 수행</td></tr><tr><td></td><td></td><td>Message Translator</td><td>메시지 포맷 변환 처리 (예: JSON ↔ XML)</td></tr><tr><td></td><td></td><td>Pipes and Filters</td><td>처리 단계를 필터 체인으로 구성하는 방식</td></tr><tr><td><strong>2. 통신 방식 및 패턴</strong></td><td>통신 모델</td><td>Request-Reply</td><td>동기 요청/응답 처리 모델</td></tr><tr><td></td><td></td><td>Fire-and-Forget</td><td>응답을 기다리지 않는 비동기 전송 방식</td></tr><tr><td></td><td></td><td>Publish-Subscribe (Pub/Sub)</td><td>이벤트 기반 1:N 메시지 브로드캐스트 방식</td></tr><tr><td></td><td></td><td>Point-to-Point (P2P)</td><td>큐 기반 1:1 메시지 전송 방식</td></tr><tr><td><strong>3. 메시지 전달 보장</strong></td><td>Delivery Guarantees</td><td>At-Most-Once</td><td>메시지를 최대 한 번만 전달 (손실 허용, 성능 우선)</td></tr><tr><td></td><td></td><td>At-Least-Once</td><td>최소 한 번 전달 보장 (중복 가능성 존재, 안정성 우선)</td></tr><tr><td></td><td></td><td>Exactly-Once</td><td>메시지가 정확히 한 번만 처리되도록 보장</td></tr><tr><td></td><td>신뢰성 보장</td><td>Acknowledgment (Ack)</td><td>메시지 수신 후 성공 응답 처리</td></tr><tr><td></td><td></td><td>Durable Subscription</td><td>오프라인 동안 메시지를 유지해주는 지속 구독 방식</td></tr><tr><td></td><td></td><td>Dead Letter Queue (DLQ)</td><td>실패 메시지를 별도 저장 후 재처리 가능</td></tr><tr><td><strong>4. 구현 도구</strong></td><td>메시지 브로커</td><td>RabbitMQ</td><td>AMQP 기반, 안정적인 엔터프라이즈 메시징</td></tr><tr><td></td><td></td><td>Apache Kafka</td><td>분산 로그 기반, 고속 스트리밍 처리</td></tr><tr><td></td><td></td><td>Apache Pulsar</td><td>다중 테넌시, 인메모리 고성능 메시징</td></tr><tr><td></td><td></td><td>Amazon SQS</td><td>AWS 관리형 큐 서비스</td></tr><tr><td></td><td></td><td>ActiveMQ / NATS</td><td>경량/중간 복잡도 메시징용 미들웨어</td></tr><tr><td><strong>5. 최신 기술 트렌드</strong></td><td>서버리스 메시징</td><td>AWS EventBridge, Azure Event Grid</td><td>완전관리형 이벤트 기반 아키텍처 플랫폼</td></tr><tr><td></td><td>엣지 메시징</td><td>Edge Native Messaging</td><td>엣지/IoT 환경에 최적화된 경량 메시징</td></tr><tr><td></td><td>AI 기반 운영</td><td>AIOps, Predictive Scaling</td><td>머신러닝 기반의 자동화된 성능 조정</td></tr><tr><td></td><td>GitOps 연동</td><td>ArgoCD, Flux</td><td>선언적 메시징 설정 및 배포 자동화</td></tr><tr><td><strong>6. 성능 최적화</strong></td><td>스트리밍 처리</td><td>Kafka Streams, Kinesis</td><td>실시간 대용량 스트림 처리 엔진</td></tr><tr><td></td><td>인메모리 메시징</td><td>Pulsar, NATS</td><td>마이크로초 수준 저지연 처리</td></tr><tr><td></td><td>메시지 파티셔닝</td><td>Partitioning</td><td>병렬성 향상 및 부하 균형을 위한 메시지 분산</td></tr><tr><td></td><td>메시지 배치 처리</td><td>Message Batching</td><td>처리량 향상을 위한 메시지 묶음 처리</td></tr><tr><td><strong>7. 보안 및 거버넌스</strong></td><td>메시지 보안</td><td>End-to-End Encryption</td><td>메시지의 종단 간 암호화를 통한 기밀성 보장</td></tr><tr><td></td><td></td><td>Access Control (RBAC/ACL)</td><td>인증/인가 기반 접근 통제</td></tr><tr><td></td><td></td><td>Audit Logging</td><td>메시지 전송/수신에 대한 추적 가능성 확보</td></tr><tr><td></td><td>제로 트러스트 메시징</td><td>mTLS, SPIFFE/SPIRE</td><td>모든 경로에서 강력한 인증/암호화 보장</td></tr><tr><td><strong>8. 관찰 가능성 및 운영</strong></td><td>관찰성 (Observability)</td><td>Distributed Tracing</td><td>메시지 흐름과 병목 구간의 시각화 및 추적</td></tr><tr><td></td><td></td><td>Metrics Collection</td><td>처리량, 지연시간, 오류율 등 메트릭 수집</td></tr><tr><td></td><td></td><td>Alert Management</td><td>임계치 기반 자동 알림 및 장애 탐지 대응</td></tr></tbody></table><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>세부 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 메시징 이론 및 개념</strong></td><td>CAP Theorem</td><td>일관성, 가용성, 파티션 허용성</td><td>분산 시스템의 기본 제약 조건</td></tr><tr><td></td><td>ACID vs BASE</td><td>강한 일관성과 최종 일관성 비교</td><td>트랜잭션 모델의 비교 관점</td></tr><tr><td></td><td>Consensus Algorithm</td><td>Raft, PBFT 등</td><td>메시징 기반 시스템의 합의 필요 시 활용</td></tr><tr><td></td><td>Messaging Fundamentals</td><td>Producer, Broker, Consumer, Message</td><td>메시지 구성 요소와 역할</td></tr><tr><td></td><td>Messaging Pattern</td><td>Pub/Sub, Queue, Point-to-Point</td><td>메시지 전달 방식의 패턴</td></tr><tr><td></td><td>Messaging Semantics</td><td>At-least-once, Exactly-once 등</td><td>메시지 전달 보장 수준의 구분</td></tr><tr><td><strong>2. 메시징 아키텍처 패턴 및 설계</strong></td><td>CQRS</td><td>명령과 조회 분리</td><td>확장성과 성능 향상 목적의 아키텍처 패턴</td></tr><tr><td></td><td>Event Sourcing</td><td>상태 변경 이벤트 저장</td><td>데이터 이력 기반 재구성 가능</td></tr><tr><td></td><td>Saga Pattern</td><td>Orchestration / Choreography</td><td>분산 트랜잭션 처리 흐름 제어</td></tr><tr><td></td><td>Message-Driven Architecture</td><td>비동기 통신, 디커플링 구조</td><td>느슨한 결합을 통한 확장성 확보</td></tr><tr><td></td><td>Pipe-and-Filter, Data Flow</td><td>필터 기반 메시지 스트림 처리</td><td>스트림 또는 배치 기반 구성 가능</td></tr><tr><td><strong>3. 메시징 시스템 및 프로토콜</strong></td><td>Kafka / RabbitMQ / NATS</td><td>메시징 미들웨어 비교</td><td>기능, 확장성, 전달 방식 등의 차이</td></tr><tr><td></td><td>AMQP / MQTT / STOMP</td><td>메시징 프로토콜 비교</td><td>경량성, QoS, 브로커 요구사항 차이</td></tr><tr><td></td><td>Cloud Messaging Services</td><td>SQS, SNS, EventBridge 등</td><td>클라우드 기반 메시징 인프라</td></tr><tr><td></td><td>Message Serialization</td><td>Protobuf, Avro, MessagePack</td><td>메시지 직렬화 포맷 및 성능 최적화</td></tr><tr><td><strong>4. 운영 및 성능 최적화</strong></td><td>Connection Pooling</td><td>연결 재사용</td><td>성능 향상 및 리소스 절감</td></tr><tr><td></td><td>Backpressure Handling</td><td>과부하 제어</td><td>소비자 처리 불능 시 흐름 제어</td></tr><tr><td></td><td>Monitoring & Observability</td><td>Prometheus, Grafana, Jaeger</td><td>메시지 흐름 추적 및 성능 분석</td></tr><tr><td></td><td>Distributed Tracing</td><td>OpenTelemetry, Zipkin</td><td>메시지 흐름 병목 파악</td></tr><tr><td></td><td>Schema Registry</td><td>스키마 버전 관리</td><td>직렬화 포맷의 스키마 진화 대응</td></tr><tr><td><strong>5. 보안 및 신뢰성 보장</strong></td><td>TLS/SSL</td><td>메시지 전송 암호화</td><td>네트워크 보안 확보</td></tr><tr><td></td><td>OAuth 2.0 / JWT</td><td>인증 및 인가</td><td>메시징 연동 서비스의 인증 처리</td></tr><tr><td></td><td>Key Management</td><td>키 생성 및 회전 정책</td><td>보안 메커니즘의 핵심 구성요소</td></tr><tr><td></td><td>Error Handling / Retry</td><td>메시지 재처리 전략</td><td>장애 발생 시 복구 시나리오 구현</td></tr><tr><td><strong>6. 테스트 및 품질 확보</strong></td><td>Contract Testing</td><td>비동기 메시지 계약 검증</td><td>생산자/소비자 간 통신 안정성 확보</td></tr><tr><td></td><td>Chaos Messaging Test</td><td>장애 주입 실험</td><td>메시징 인프라 복원력 검증</td></tr><tr><td></td><td>Message Replay / DLQ</td><td>실패 메시지 분석 및 복구</td><td>Dead Letter Queue 등 활용 전략</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 핵심 개념</strong></td><td><strong>Message Broker</strong></td><td>송신자와 수신자 간 메시지를 중계하고 큐잉 및 라우팅을 담당하는 컴포넌트</td></tr><tr><td></td><td><strong>Message Queue</strong></td><td>메시지를 순차 저장하는 FIFO 방식 데이터 구조 (P2P 에서 사용)</td></tr><tr><td></td><td><strong>Topic</strong></td><td>메시지를 발행/구독 기반으로 전달하는 논리 채널 (Pub/Sub 에서 사용)</td></tr><tr><td></td><td><strong>Dead Letter Queue (DLQ)</strong></td><td>처리 실패 메시지를 저장하는 특수 큐로 재처리나 감사용으로 사용</td></tr><tr><td></td><td><strong>Backpressure</strong></td><td>소비자가 생산자의 속도를 따라가지 못할 때 발생하는 흐름 제어 문제</td></tr><tr><td></td><td><strong>Idempotency (멱등성)</strong></td><td>메시지를 중복 처리해도 결과가 변하지 않는 성질</td></tr><tr><td></td><td><strong>Message Transformation</strong></td><td>포맷이나 콘텐츠를 브로커 내에서 변환하는 처리 기법</td></tr><tr><td></td><td><strong>Schema Registry</strong></td><td>메시지 스키마를 중앙에서 관리하고 버전을 통제하는 시스템</td></tr><tr><td><strong>2. 구성 요소</strong></td><td><strong>Producer</strong></td><td>메시지를 생성 및 브로커에 발행하는 역할의 컴포넌트</td></tr><tr><td></td><td><strong>Consumer</strong></td><td>브로커로부터 메시지를 구독/수신하여 처리하는 역할의 컴포넌트</td></tr><tr><td></td><td><strong>Exchange</strong></td><td>메시지를 큐나 토픽으로 라우팅하기 위한 논리적 브로커 단위 (ex: RabbitMQ)</td></tr><tr><td><strong>3. 통신 패턴</strong></td><td><strong>Point-to-Point (P2P)</strong></td><td>1:1 메시징 모델로 큐 기반의 단일 소비 방식</td></tr><tr><td></td><td><strong>Publish-Subscribe (Pub/Sub)</strong></td><td>N:N 모델로 토픽 기반 다중 소비 방식</td></tr><tr><td></td><td><strong>Request-Reply</strong></td><td>동기식 요청/응답 기반 메시징 패턴</td></tr><tr><td></td><td><strong>Fire-and-Forget</strong></td><td>응답 없이 메시지를 전송하는 비동기 패턴</td></tr><tr><td></td><td><strong>Fan-out / Fan-in</strong></td><td>다수에게 메시지 분산 / 다수에서 메시지 수집하는 처리 방식</td></tr><tr><td></td><td><strong>Scatter-Gather</strong></td><td>메시지를 분산 전송 후 결과를 집계하는 패턴</td></tr><tr><td></td><td><strong>Content-Based Routing</strong></td><td>메시지 내용을 기준으로 라우팅하는 EIP 패턴</td></tr><tr><td><strong>4. 품질 속성</strong></td><td><strong>Durability</strong></td><td>메시지를 디스크 등에 영속 저장하여 데이터 손실 방지</td></tr><tr><td></td><td><strong>Exactly-Once Delivery</strong></td><td>메시지가 수신자에게 정확히 한 번만 전달되는 특성</td></tr><tr><td></td><td><strong>Acknowledgment (Ack)</strong></td><td>메시지를 성공적으로 수신·처리했음을 브로커에 알리는 확인 신호</td></tr><tr><td></td><td><strong>Eventual Consistency</strong></td><td>시간이 지나 모든 노드가 동일 상태가 되는 일관성 모델</td></tr><tr><td></td><td><strong>Reliable Delivery</strong></td><td>메시지 유실 없이 안정적으로 전달되는 보장 메커니즘</td></tr><tr><td><strong>5. 성능 최적화</strong></td><td><strong>Partitioning</strong></td><td>메시지를 논리 파티션으로 나눠 병렬 처리 및 부하 분산</td></tr><tr><td></td><td><strong>Message Batching</strong></td><td>다수 메시지를 묶어서 처리하여 처리 효율 개선</td></tr><tr><td></td><td><strong>Connection Pooling</strong></td><td>연결을 재사용하여 네트워크 비용 및 지연 최소화</td></tr><tr><td><strong>6. 보안</strong></td><td><strong>TLS/mTLS</strong></td><td>메시지 전송 시 보안을 위한 암호화 및 상호 인증 프로토콜</td></tr><tr><td></td><td><strong>RBAC (Role-Based Access Control)</strong></td><td>역할 기반의 인증/인가 접근 제어 방식</td></tr><tr><td></td><td><strong>ACL (Access Control List)</strong></td><td>개별 주체별 자원 접근 권한 제어 리스트</td></tr><tr><td><strong>7. 모니터링 & 관찰성</strong></td><td><strong>Tracing / Distributed Tracing</strong></td><td>메시지 흐름과 지연, 병목을 추적하는 도구 기반 진단 방식 (ex: OpenTelemetry, Zipkin)</td></tr><tr><td></td><td><strong>Metrics Collection</strong></td><td>처리량, 지연시간, 큐 길이 등 성능 메트릭 수집</td></tr><tr><td><strong>8. 구현 기술 & 프로토콜</strong></td><td><strong>AMQP (Advanced Message Queuing Protocol)</strong></td><td>고기능, 상호운용 메시지 프로토콜 (RabbitMQ 등)</td></tr><tr><td></td><td><strong>MQTT</strong></td><td>IoT 환경에 최적화된 경량 메시징 프로토콜</td></tr><tr><td></td><td><strong>JMS (Java Message Service)</strong></td><td>자바 플랫폼용 메시징 API 표준</td></tr><tr><td></td><td><strong>STOMP</strong></td><td>텍스트 기반 메시징 프로토콜 (WebSocket 과 연동 용이)</td></tr><tr><td></td><td><strong>Apache Kafka</strong></td><td>대용량 메시지 스트리밍 및 로그 수집 플랫폼</td></tr><tr><td></td><td><strong>RabbitMQ</strong></td><td>실시간 메시지 브로커, AMQP 기반</td></tr><tr><td></td><td><strong>ActiveMQ / NATS / Pulsar</strong></td><td>다양한 메시징 미들웨어 대안</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.enterpriseintegrationpatterns.com/patterns/messaging/>Messaging Patterns – Enterprise Integration Patterns</a></li><li><a href=https://en.wikipedia.org/wiki/Message-oriented_middleware>Message-Oriented Middleware – Wikipedia</a></li><li><a href=https://www.redhat.com/en/blog/architectural-messaging-patterns>Architectural Messaging Patterns – Red Hat</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/event-driven>Event-Driven Architecture Style – Azure Architecture Center</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/publisher-subscriber>Publisher‑Subscriber Pattern – Azure Architecture Center</a></li><li><a href=https://solace.com/blog/messaging-patterns-for-event-driven-microservices/>Messaging Patterns for Event‑Driven Microservices – Solace</a></li><li><a href=https://www.geeksforgeeks.org/what-is-message-oriented-middleware-mom/>What is Message Oriented Middleware (MOM)? – GeeksforGeeks</a></li><li><a href=https://docs.oracle.com/cd/E19340-01/820-6424/aeraq/index.html>Message‑Oriented Middleware – Oracle Documentation</a></li><li><a href=https://developer.ibm.com/articles/mom/>Messaging‑Oriented Architecture – IBM Developer</a></li><li><a href=https://www.rabbitmq.com/>RabbitMQ – Official Documentation</a></li><li><a href=https://kafka.apache.org/>Apache Kafka – Official Documentation</a></li><li><a href=https://aws.amazon.com/messaging/>AWS Messaging Services</a></li><li><a href=https://azure.microsoft.com/en-us/products/service-bus/>Microsoft Azure Service Bus</a></li><li><a href=https://cloud.google.com/pubsub/docs>Google Cloud Pub/Sub</a></li><li><a href=https://victorleungtw.com/2024/03/08/message-driven-architecture/>Messaging‑Driven Architecture: Pros and Cons – Continuous Improvement</a></li><li><a href=https://medium.com/keployio/understanding-message-queues-a-comprehensive-guide-7e9f94a7d351>Understanding Message Queues: A Comprehensive Guide – Medium</a></li></ul><hr></div><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Message-Driven vs. Event-Driven Architecture</h2></header><div class=entry-content><p>Message-Driven vs. Event-Driven Architecture 메시지 기반 (Message‑Driven) 과 이벤트 기반 (Event‑Driven) 은 비동기 통신을 통한 분산 시스템 설계 방식이다.
메시지 기반 (Message‑Driven) 는 명령 (Command) 또는 Request-Response 워크플로우 중심이며 수신자 주소를 알고 직접 메시지를 주고 받는다. 반면 이벤트 기반 (Event‑Driven) 는 상태 변화 (State Change) 를 이벤트로 정의하고 Publish-Subscribe (pub/sub) 나 Event Bus 로 브로드캐스트 (Broadcast) 하며, 소비자 목록을 알 필요 없이 느슨하게 결합된 구조로 동작한다.
두 방식은 구현 목적, 응답 실시간성, 확장성, 복잡성 등에서 차이를 보이며, 실무에서는 상호 보완적으로 병용되기도 한다.
...</p></div><footer class=entry-footer><span title='2025-06-23 12:02:00 +0000 UTC'>June 23, 2025</span>&nbsp;·&nbsp;39 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Message-Driven vs. Event-Driven Architecture" href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-vs-event-driven-architecture/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Message-Driven Architecture</h2></header><div class=entry-content><p>Message-Driven Architecture Message‑Driven Architecture 는 메시지 브로커 또는 버스를 통해 송신자 (Producer) 와 수신자 (Consumer) 가 메시지를 비동기 방식으로 주고받는 설계 방식이다. 주요 구성 요소는 Producer, Broker, Consumer, Queue/Topic 이며 선택적으로 스키마 레지스트리, DLQ, 메시지 변환기 등을 포함한다. RabbitMQ, Kafka, ActiveMQ 등이 대표 브로커이며, 구조적으로 느슨한 결합, 확장성과 고가용성을 확보할 수 있는 동시에, 메시지 순서 보장, 멱등성, 트레이싱 같은 운영 및 안정성 요소도 고려해야 한다.
배경 역사적 배경 1970 년대 - 액터 모델 (Actor Model):
Carl Hewitt 이 제안한 액터 모델이 메시지 기반 아키텍처의 이론적 기반을 제공했다. 각 액터는 메시지를 통해서만 상호작용하며, 상태를 캡슐화하는 개념을 도입했다.
...</p></div><footer class=entry-footer><span title='2025-06-23 02:57:00 +0000 UTC'>June 23, 2025</span>&nbsp;·&nbsp;54 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Message-Driven Architecture" href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/messaging-oriented/message-driven-architecture/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>