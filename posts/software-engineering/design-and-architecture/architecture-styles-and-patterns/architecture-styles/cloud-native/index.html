<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cloud-Native Architecture | hyunyoun's Blog</title><meta name=keywords content="System-and-Software-Architecture,Architecture,Architecture-Styles,Cloud-Native-Architecture,Microservices,Container-Orchestration"><meta name=description content="Cloud‑Native Architecture 는 컨테이너, 마이크로서비스, 자동화, 선언형 인터페이스를 이용해 클라우드의 유연성, 확장성, 관찰성, 복원력을 최대한 활용하는 현대 애플리케이션 설계 방식이다. 이를 통해 빠른 배포, 운영 자동화, 장애 복구, 비용 최적화를 지원한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Cloud-Native Architecture"><meta property="og:description" content="Cloud‑Native Architecture 는 컨테이너, 마이크로서비스, 자동화, 선언형 인터페이스를 이용해 클라우드의 유연성, 확장성, 관찰성, 복원력을 최대한 활용하는 현대 애플리케이션 설계 방식이다. 이를 통해 빠른 배포, 운영 자동화, 장애 복구, 비용 최적화를 지원한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Cloud-Native Architecture"><meta name=twitter:description content="Cloud‑Native Architecture 는 컨테이너, 마이크로서비스, 자동화, 선언형 인터페이스를 이용해 클라우드의 유연성, 확장성, 관찰성, 복원력을 최대한 활용하는 현대 애플리케이션 설계 방식이다. 이를 통해 빠른 배포, 운영 자동화, 장애 복구, 비용 최적화를 지원한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Cloud-Native Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Cloud-Native Architecture</h1><div class=post-description>Cloud‑Native Architecture 는 컨테이너, 마이크로서비스, 자동화, 선언형 인터페이스를 이용해 클라우드의 유연성, 확장성, 관찰성, 복원력을 최대한 활용하는 현대 애플리케이션 설계 방식이다. 이를 통해 빠른 배포, 운영 자동화, 장애 복구, 비용 최적화를 지원한다.</div></header><div class=post-content><h2 id=cloud-native-architecture>Cloud-Native Architecture<a hidden class=anchor aria-hidden=true href=#cloud-native-architecture>#</a></h2><p>Cloud-Native Architecture 는 클라우드 컴퓨팅의 분산형, 동적, 탄력적 특성을 활용하여 현대적인 애플리케이션을 설계하고 운영하는 포괄적인 방법론이다. 전통적인 모놀리식 아키텍처와 달리 마이크로서비스로 분해된 애플리케이션을 컨테이너로 패키징하고, Kubernetes 와 같은 오케스트레이션 플랫폼에서 실행한다. 자동화, 관찰가능성, 무결성 인프라스트럭처를 통해 고가용성과 확장성을 보장하며, DevOps 문화와 긴밀히 연계되어 지속적인 통합 및 배포를 실현한다.</p><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Cloud-Native Architecture 의 등장 배경은 전통적인 IT 인프라스트럭처와 애플리케이션 개발 방식의 한계에서 시작된다.</p><h4 id=전통적-아키텍처의-한계>전통적 아키텍처의 한계<a hidden class=anchor aria-hidden=true href=#전통적-아키텍처의-한계>#</a></h4><p><strong>모놀리식 애플리케이션의 문제점</strong></p><ul><li>대규모 단일 코드베이스로 인한 개발 및 유지보수의 복잡성</li><li>부분적 확장의 어려움 (전체 애플리케이션을 스케일링해야 함)</li><li>단일 장애점으로 인한 전체 시스템 다운 위험</li><li>기술 스택 변경의 어려움</li></ul><p><strong>온프레미스 인프라스트럭처의 제약</strong></p><ul><li>고정된 하드웨어 리소스로 인한 비효율성</li><li>수동적인 인프라 관리로 인한 높은 운영 비용</li><li>확장성과 탄력성의 부족</li><li>장시간의 배포 및 복구 프로세스</li></ul><h4 id=클라우드-컴퓨팅의-등장>클라우드 컴퓨팅의 등장<a hidden class=anchor aria-hidden=true href=#클라우드-컴퓨팅의-등장>#</a></h4><p><strong>클라우드의 혁신적 특성</strong></p><ul><li>온디맨드 리소스 프로비저닝</li><li>사용량 기반 과금 모델</li><li>글로벌 분산 인프라스트럭처</li><li>관리형 서비스의 풍부한 생태계</li></ul><p><strong>대규모 인터넷 기업들의 선도적 사례</strong></p><ul><li>Google 의 Borg 시스템 (Kubernetes 의 전신)</li><li>Netflix 의 Hystrix 와 마이크로서비스 아키텍처</li><li>Twitter 의 Finagle 라이브러리</li><li>Amazon 의 SOA (Service-Oriented Architecture) 전환</li></ul><h4 id=기술적-진화의-촉진-요인>기술적 진화의 촉진 요인<a hidden class=anchor aria-hidden=true href=#기술적-진화의-촉진-요인>#</a></h4><p><strong>컨테이너화 기술의 성숙</strong></p><ul><li>Docker 의 등장으로 애플리케이션 패키징 혁신</li><li>경량화된 가상화 기술의 대중화</li><li>개발과 운영 환경의 일관성 확보</li></ul><p><strong>오픈소스 생태계의 발전</strong></p><ul><li>Cloud Native Computing Foundation (CNCF) 의 설립 (2015 년)</li><li>Kubernetes 의 오픈소스화 및 표준화</li><li>다양한 클라우드 네이티브 도구들의 성숙</li></ul><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><h4 id=비즈니스-목적>비즈니스 목적<a hidden class=anchor aria-hidden=true href=#비즈니스-목적>#</a></h4><p><strong>민첩성 향상</strong></p><ul><li>빠른 기능 개발 및 배포를 통한 시장 대응력 강화</li><li>독립적인 팀 운영으로 개발 속도 가속화</li><li>실험과 혁신을 위한 안전한 환경 제공</li></ul><p><strong>운영 효율성 증대</strong></p><ul><li>자동화를 통한 운영 비용 절감</li><li>리소스 사용량 최적화로 인한 비용 효율성</li><li>장애 복구 시간 단축</li></ul><p><strong>확장성 확보</strong></p><ul><li>비즈니스 성장에 따른 유연한 시스템 확장</li><li>글로벌 서비스 제공을 위한 지리적 분산</li><li>피크 트래픽 대응 능력 향상</li></ul><h4 id=기술적-필요성>기술적 필요성<a hidden class=anchor aria-hidden=true href=#기술적-필요성>#</a></h4><p><strong>복잡성 관리</strong></p><ul><li>대규모 시스템을 관리 가능한 단위로 분해</li><li>각 서비스별 독립적인 기술 스택 선택 가능</li><li>팀별 책임 영역 명확화</li></ul><p><strong>안정성 및 복원력</strong></p><ul><li>분산 시스템의 장애 격리</li><li>자동 복구 및 자가 치유 능력</li><li>무중단 배포 및 롤백 기능</li></ul><p><strong>보안 강화</strong></p><ul><li>제로 트러스트 보안 모델 구현</li><li>마이크로세그멘테이션을 통한 공격 표면 최소화</li><li>컴플라이언스 요구사항 충족</li></ul><h4 id=현대적-개발-문화-지원>현대적 개발 문화 지원<a hidden class=anchor aria-hidden=true href=#현대적-개발-문화-지원>#</a></h4><p><strong>DevOps 문화 활성화</strong></p><ul><li>개발과 운영의 협업 강화</li><li>지속적 통합 및 배포 (CI/CD) 문화 정착</li><li>피드백 기반의 지속적 개선</li></ul><p><strong>개발자 경험 향상</strong></p><ul><li>개발 환경과 운영 환경의 일관성</li><li>인프라 관리 부담 경감</li><li>비즈니스 로직에 집중할 수 있는 환경</li></ul><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p><strong>Cloud-Native Architecture</strong>는 클라우드 환경에서 애플리케이션을 설계, 개발, 배포하는 아키텍처 스타일로, 확장성, 유연성, 자동화, 마이크로서비스, 컨테이너화 등을 특징으로 한다.</p><h4 id=기본-핵심-개념>기본 핵심 개념<a hidden class=anchor aria-hidden=true href=#기본-핵심-개념>#</a></h4><p><strong>마이크로서비스 아키텍처 (Microservices Architecture)</strong></p><ul><li>애플리케이션을 독립적으로 배포 가능한 작은 서비스들로 분해</li><li>각 서비스는 단일 비즈니스 기능에 집중</li><li>API 를 통한 느슨한 결합 (Loose Coupling) 구현</li></ul><p><strong>컨테이너화 (Containerization)</strong></p><ul><li>애플리케이션과 그 종속성을 하나의 패키지로 묶는 기술</li><li>운영체제와 하드웨어로부터 독립성 제공</li><li>Docker 와 같은 컨테이너 런타임 활용</li></ul><p><strong>컨테이너 오케스트레이션 (Container Orchestration)</strong></p><ul><li>컨테이너의 배포, 확장, 관리를 자동화</li><li>Kubernetes 가 사실상의 표준</li><li>서비스 디스커버리, 로드 밸런싱, 자동 복구 기능 제공</li></ul><p><strong>무상태 설계 (Stateless Design)</strong></p><ul><li>서버가 클라이언트의 상태 정보를 저장하지 않음</li><li>수평 확장과 장애 복구를 용이하게 함</li><li>세션 데이터는 외부 저장소에 분리 보관</li></ul><h4 id=심화-핵심-개념>심화 핵심 개념<a hidden class=anchor aria-hidden=true href=#심화-핵심-개념>#</a></h4><p><strong>서비스 메시 (Service Mesh)</strong></p><ul><li>마이크로서비스 간 통신을 관리하는 전용 인프라스트럭처 계층</li><li>사이드카 패턴을 통한 네트워크 프록시 구현</li><li>보안, 관찰가능성, 트래픽 관리 기능 제공</li></ul><p><strong>불변 인프라스트럭처 (Immutable Infrastructure)</strong></p><ul><li>배포 후 서버나 컨테이너를 변경하지 않는 원칙</li><li>문제 발생 시 기존 인스턴스를 폐기하고 새로운 인스턴스로 교체</li><li>보안성과 일관성 향상</li></ul><p><strong>선언적 API (Declarative APIs)</strong></p><ul><li>원하는 상태를 선언하여 시스템이 자동으로 해당 상태로 수렴</li><li>Kubernetes 의 YAML 매니페스트가 대표적 예시</li><li>GitOps 와 Infrastructure as Code (IaC) 활성화</li></ul><p><strong>방어 심층 보안 (Defense in Depth)</strong></p><ul><li>모든 구성 요소 간 인증 및 암호화 적용</li><li>Zero Trust 보안 모델 구현</li><li>내부와 외부 구분 없이 모든 통신을 검증</li></ul><h4 id=실무-구현을-위한-연관-개념>실무 구현을 위한 연관 개념<a hidden class=anchor aria-hidden=true href=#실무-구현을-위한-연관-개념>#</a></h4><p><strong>DevOps 및 CI/CD</strong></p><ul><li>개발과 운영의 통합을 통한 지속적 배포</li><li>자동화된 테스트, 빌드, 배포 파이프라인</li><li>피드백 루프를 통한 빠른 개선 사이클</li></ul><p><strong>관찰가능성 (Observability)</strong></p><ul><li>메트릭, 로그, 분산 추적을 통한 시스템 모니터링</li><li>Prometheus, Grafana, Jaeger 등의 도구 활용</li><li>시스템 상태의 실시간 가시성 확보</li></ul><p><strong>Infrastructure as Code (IaC)</strong></p><ul><li>인프라스트럭처를 코드로 정의하고 관리</li><li>Terraform, Ansible, Helm 등의 도구 사용</li><li>버전 관리와 재현 가능한 환경 구축</li></ul><h4 id=실무에서-구현하기-위해-필요한-내용>실무에서 구현하기 위해 필요한 내용<a hidden class=anchor aria-hidden=true href=#실무에서-구현하기-위해-필요한-내용>#</a></h4><ul><li><strong>마이크로서비스 설계:</strong> 독립적 서비스 단위로 분리 및 경계 설정.</li><li><strong>컨테이너 및 오케스트레이션:</strong> 컨테이너 기반 배포, Kubernetes 등 오케스트레이션 도구 활용.</li><li><strong>CI/CD 파이프라인:</strong> 자동화된 빌드, 테스트, 배포.</li><li><strong>관측성:</strong> 모니터링, 로깅, 트레이싱 통합.</li><li><strong>보안 및 규정 준수:</strong> 서비스 간 통신, 데이터 보호, 인증/인가 강화.</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><p><strong>핵심 기능</strong>:</p><ul><li><strong>자동 확장 (Auto-scaling)</strong>: 부하에 따른 자동 리소스 조정</li><li><strong>장애 복구 (Fault Recovery)</strong>: 자동 장애 감지 및 복구</li><li><strong>서비스 디스커버리 (Service Discovery)</strong>: 동적 서비스 위치 발견</li><li><strong>로드 밸런싱 (Load Balancing)</strong>: 트래픽 분산 처리</li></ul><p><strong>주요 역할</strong>:</p><ul><li><strong>개발 생산성 향상</strong>: 개발자가 비즈니스 로직에 집중 가능</li><li><strong>운영 안정성 보장</strong>: 자동화를 통한 휴먼 에러 감소</li><li><strong>확장성 제공</strong>: 수요 변화에 따른 유연한 리소스 관리</li><li><strong>비용 효율성</strong>: 필요한 만큼만 리소스 사용</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><p><strong>기술적 특징</strong>:</p><ul><li><strong>느슨한 결합 (Loosely Coupled)</strong>: 서비스 간 독립성 보장</li><li><strong>상태 비저장 (Stateless)</strong>: 서비스 인스턴스 간 상태 공유 없음</li><li><strong>탄력적 (Elastic)</strong>: 수요에 따른 자동 확장/축소</li><li><strong>복원력 (Resilient)</strong>: 장애 상황에서도 서비스 지속성 유지</li></ul><p><strong>운영적 특징</strong>:</p><ul><li><strong>자동화 중심</strong>: 수동 개입 최소화</li><li><strong>지속적 배포</strong>: 빈번하고 안정적인 릴리스</li><li><strong>관찰가능성</strong>: 시스템 상태의 실시간 모니터링</li><li><strong>보안 내재화</strong>: 개발 프로세스에 보안 통합</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><table><thead><tr><th>분류</th><th>원칙</th><th>설명</th></tr></thead><tbody><tr><td><strong>설계 원칙</strong></td><td>클라우드 우선 설계 (Design for Cloud)</td><td>분산·탄력적 특성을 활용하고, 온디맨드 리소스 및 관리형 서비스 기반 설계</td></tr><tr><td></td><td>마이크로서비스 분해 (Microservices Decomposition)</td><td>단일 책임 원칙 기반의 도메인 분리, DDD 및 API 우선 설계 적용</td></tr><tr><td></td><td>무상태 설계 (Stateless Design)</td><td>상태 외부화 및 세션 분리 저장을 통해 수평 확장이 가능한 구조 구현</td></tr><tr><td><strong>운영 원칙</strong></td><td>자동화 우선 (Automation First)</td><td>IaC 기반 운영 자동화 및 반복 작업의 스크립팅, 선언형 구성 적용</td></tr><tr><td></td><td>방어 심층 보안 (Defense in Depth)</td><td>제로 트러스트 보안, 암호화, 네트워크 세분화, 구성 요소 간 상호 인증</td></tr><tr><td></td><td>관찰가능성 내장 (Built-in Observability)</td><td>메트릭, 로그, 트레이싱 표준화 및 실시간 모니터링 내장 설계</td></tr><tr><td><strong>문화 원칙</strong></td><td>지속적 진화 (Continuous Evolution)</td><td>CI/CD 기반 반복적 개선, 실험과 피드백을 통한 진화적 개발</td></tr><tr><td></td><td>팀 자율성 (Team Autonomy)</td><td>독립적인 팀 운영, 기술 스택 선택 자율성, 책임과 권한의 균형</td></tr></tbody></table><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><p>Cloud-Native 아키텍처는 마이크로서비스를 컨테이너로 패키징되고, Kubernetes 등 오케스트레이션 도구를 통해 배포·확장·복구가 자동화된다. CI/CD 파이프라인을 통해 자동 배포 및 테스트가 이루어지며, 모니터링/로깅, 서비스 메시/API 게이트웨이를 통해 서비스 간 통신과 관측성이 관리된다.</p><pre class=mermaid>graph TD
    A[Developer] --&gt;|Code Push| B[Git Repository]
    B --&gt; C[CI/CD Pipeline]
    C --&gt; D[Container Build]
    D --&gt; E[Container Registry]
    E --&gt; F[Kubernetes Orchestrator]
    F --&gt; G[Service Mesh]
    G --&gt; H[Microservices]
    H --&gt; I[Data Storage]
    
    J[Load Balancer] --&gt; G
    K[Monitoring] --&gt; H
    L[Logging] --&gt; H
    M[Service Discovery] --&gt; H
    
    style F fill:#e1f5fe
    style G fill:#f3e5f5
    style H fill:#e8f5e8
</pre><ol><li><strong>코드 커밋</strong>: 개발자가 변경사항을 버전 관리 시스템에 커밋</li><li><strong>자동 빌드</strong>: CI/CD 파이프라인이 자동으로 컨테이너 이미지 생성</li><li><strong>배포</strong>: 오케스트레이터가 컨테이너를 적절한 노드에 배포</li><li><strong>서비스 통신</strong>: 서비스 메시를 통한 안전한 마이크로서비스 간 통신</li><li><strong>모니터링</strong>: 실시간 시스템 상태 관찰 및 대응</li></ol><h4 id=전체-작동-원리>전체 작동 원리<a hidden class=anchor aria-hidden=true href=#전체-작동-원리>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;클라이언트 계층&#34;
        A[웹 브라우저]
        B[모바일 앱]
        C[외부 API]
    end
    
    subgraph &#34;API 게이트웨이 계층&#34;
        D[API Gateway]
        E[로드 밸런서]
    end
    
    subgraph &#34;서비스 메시 계층&#34;
        F[사이드카 프록시]
        G[서비스 디스커버리]
        H[보안 정책]
    end
    
    subgraph &#34;마이크로서비스 계층&#34;
        I[사용자 서비스]
        J[주문 서비스]
        K[결제 서비스]
        L[알림 서비스]
    end
    
    subgraph &#34;데이터 계층&#34;
        M[사용자 DB]
        N[주문 DB]
        O[결제 DB]
        P[메시지 큐]
    end
    
    subgraph &#34;인프라 계층&#34;
        Q[Kubernetes 클러스터]
        R[컨테이너 레지스트리]
        S[모니터링 시스템]
    end
    
    A --&gt; D
    B --&gt; D
    C --&gt; D
    D --&gt; E
    E --&gt; F
    F --&gt; G
    F --&gt; H
    G --&gt; I
    G --&gt; J
    G --&gt; K
    G --&gt; L
    I --&gt; M
    J --&gt; N
    K --&gt; O
    L --&gt; P
    I --&gt; Q
    J --&gt; Q
    K --&gt; Q
    L --&gt; Q
    Q --&gt; R
    Q --&gt; S
</pre><h4 id=요청-처리-플로우>요청 처리 플로우<a hidden class=anchor aria-hidden=true href=#요청-처리-플로우>#</a></h4><ol><li><p><strong>요청 수신 및 라우팅</strong></p><ul><li>클라이언트 요청이 API 게이트웨이로 전달</li><li>인증, 인가, 레이트 리미팅 적용</li><li>적절한 마이크로서비스로 라우팅</li></ul></li><li><p><strong>서비스 메시를 통한 통신</strong></p><ul><li>사이드카 프록시가 서비스 간 통신 중재</li><li>로드 밸런싱, 서킷 브레이커, 재시도 로직 적용</li><li>분산 추적 및 메트릭 수집</li></ul></li><li><p><strong>마이크로서비스 처리</strong></p><ul><li>각 서비스가 독립적으로 비즈니스 로직 수행</li><li>필요시 다른 서비스와의 동기/비동기 통신</li><li>상태 정보는 외부 데이터 저장소에 유지</li></ul></li><li><p><strong>응답 반환 및 모니터링</strong></p><ul><li>처리 결과를 클라이언트로 반환</li><li>요청 플로우 전체에 대한 추적 정보 수집</li><li>성능 메트릭 및 오류 로그 기록</li></ul></li></ol><h4 id=자동화-워크플로우>자동화 워크플로우<a hidden class=anchor aria-hidden=true href=#자동화-워크플로우>#</a></h4><pre class=mermaid>sequenceDiagram
    participant Dev as 개발자
    participant Git as Git Repository
    participant CI as CI Pipeline
    participant CD as CD Pipeline
    participant K8s as Kubernetes
    participant Mon as Monitoring
    
    Dev-&gt;&gt;Git: 코드 커밋
    Git-&gt;&gt;CI: 웹훅 트리거
    CI-&gt;&gt;CI: 코드 빌드 및 테스트
    CI-&gt;&gt;CI: 컨테이너 이미지 생성
    CI-&gt;&gt;CD: 배포 트리거
    CD-&gt;&gt;K8s: 새 버전 배포
    K8s-&gt;&gt;K8s: 롤링 업데이트 수행
    K8s-&gt;&gt;Mon: 배포 상태 전송
    Mon-&gt;&gt;Dev: 배포 결과 알림
</pre><p>이 시퀀스 다이어그램은 개발자의 코드 커밋부터 운영 환경 배포까지의 자동화된 워크플로우를 보여줍니다. CI/CD 파이프라인을 통해 코드 변경사항이 자동으로 테스트되고 배포되며, 모니터링 시스템이 전체 프로세스를 추적합니다.</p><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><h4 id=아키텍처-원리>아키텍처 원리<a hidden class=anchor aria-hidden=true href=#아키텍처-원리>#</a></h4><p><strong>서비스 분해 원리</strong></p><pre class=mermaid>graph TD
    A[모놀리식 애플리케이션] --&gt; B[도메인 분석]
    B --&gt; C[바운디드 컨텍스트 식별]
    C --&gt; D[마이크로서비스 정의]
    D --&gt; E[API 설계]
    E --&gt; F[독립 배포 가능한 서비스]
    
    G[사용자 관리] --&gt; H[주문 처리]
    H --&gt; I[결제 처리]
    I --&gt; J[배송 관리]
    J --&gt; K[재고 관리]
</pre><p>위 다이어그램은 모놀리식 애플리케이션을 마이크로서비스로 분해하는 과정을 보여준다. 도메인 분석을 통해 바운디드 컨텍스트를 식별하고, 각각을 독립적인 마이크로서비스로 구현한다.</p><p><strong>통신 패턴 원리</strong></p><ul><li>동기 통신: HTTP/REST API, gRPC</li><li>비동기 통신: 메시지 큐, 이벤트 스트리밍</li><li>사이드카 패턴: 서비스 메시 구현</li></ul><h4 id=데이터-관리-원리>데이터 관리 원리<a hidden class=anchor aria-hidden=true href=#데이터-관리-원리>#</a></h4><p><strong>데이터베이스 분리 원리</strong></p><ul><li>각 마이크로서비스는 고유한 데이터베이스 보유</li><li>서비스 간 데이터 공유는 API 를 통해서만 수행</li><li>이벤트 소싱을 통한 데이터 일관성 관리</li></ul><p><strong>CQRS (Command Query Responsibility Segregation) 원리</strong></p><ul><li>명령 (쓰기) 과 조회 (읽기) 모델의 분리</li><li>각각에 최적화된 데이터 저장소 사용</li><li>읽기 성능과 쓰기 성능의 독립적 최적화</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p>Cloud-Native Architecture 는 여러 계층으로 구성된 분산 시스템이다. 각 계층은 특정한 역할과 책임을 가지며, 서로 느슨하게 결합되어 있다.</p><pre class=mermaid>graph TD

%% Entry Layer
User[사용자] --&gt; Gateway[&#34;API Gateway (NGINX / Kong)&#34;]

%% Service Layer
Gateway --&gt; SVC1[User Service]
Gateway --&gt; SVC2[Order Service]
Gateway --&gt; SVC3[Product Service]

%% Service Mesh &amp; Observability
SVC1 --&gt; SM[&#34;Service Mesh (Istio)&#34;]
SVC2 --&gt; SM
SVC3 --&gt; SM
SM --&gt; OB[&#34;Observability (Prometheus + Jaeger + Grafana)&#34;]

%% Message Bus
SVC1 --&gt; MQ[&#34;Message Broker (Kafka / RabbitMQ)&#34;]
SVC2 --&gt; MQ
SVC3 --&gt; MQ

%% Storage
SVC1 --&gt; DB1[&#34;(PostgreSQL)&#34;]
SVC2 --&gt; DB2[&#34;(MongoDB)&#34;]
SVC3 --&gt; Cache[Redis]

%% CI/CD &amp; Infra
Dev[Developer] --&gt; CI[&#34;CI/CD Pipeline (GitLab CI / ArgoCD)&#34;]
CI --&gt; K8s[Kubernetes Cluster]
K8s --&gt; SVC1
K8s --&gt; SVC2
K8s --&gt; SVC3
</pre><h4 id=구성요소>구성요소<a hidden class=anchor aria-hidden=true href=#구성요소>#</a></h4><table><thead><tr><th>구분</th><th>구성요소</th><th>기능</th><th>역할</th><th>특징 / 기술 예시</th><th>적용 시나리오 또는 조건</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td><strong>컨테이너 런타임</strong></td><td>컨테이너 이미지 실행 및 관리</td><td>라이프사이클 관리, 리소스 격리, 이미지 캐싱</td><td>Docker, containerd, CRI-O 등</td><td>모든 컨테이너 기반 아키텍처의 기본 기반</td></tr><tr><td></td><td><strong>컨테이너 오케스트레이션</strong></td><td>컨테이너 클러스터 관리 및 스케줄링</td><td>배치, 디스커버리, 로드 밸런싱, 스케일링, 장애 복구</td><td>Kubernetes (표준), 선언적 API</td><td>수백 개 이상의 컨테이너/서비스 관리 필요 시</td></tr><tr><td></td><td><strong>마이크로서비스</strong></td><td>비즈니스 로직 단위의 독립적 서비스</td><td>도메인 기능 담당, 독립 배포, API 통신</td><td>단일 책임 원칙, DB 분리, 확장성 우수</td><td>유연한 배포, 독립 확장성, 도메인 기반 구조 필요 시</td></tr><tr><td></td><td><strong>API 게이트웨이</strong></td><td>외부 요청의 통합 진입점 제공</td><td>인증, 인가, 요청 라우팅/집계, 속도 제한</td><td>NGINX, Kong, Ambassador 등</td><td>외부 API 제어, 보안, 요청 관리가 필요한 구조</td></tr><tr><td><strong>선택</strong></td><td><strong>서비스 메시</strong></td><td>마이크로서비스 간 통신 제어 및 보안</td><td>트래픽 제어, 관찰성, 정책 관리, mTLS 적용</td><td>Istio, Linkerd, Consul Connect 등</td><td>트래픽 라우팅, 사이드카 기반 보안 통신, 메쉬 통신 제어 필요 시</td></tr><tr><td></td><td><strong>메시지 브로커</strong></td><td>비동기 메시징 및 이벤트 기반 통신</td><td>서비스 간 결합 최소화, 이벤트 처리, 순서 보장</td><td>Apache Kafka, RabbitMQ, Amazon SQS 등</td><td>이벤트 기반 처리, 데이터 스트리밍, 확장성 필요한 시스템</td></tr><tr><td></td><td><strong>분산 캐시</strong></td><td>고속 데이터 접근을 위한 캐싱</td><td>DB 부하 감소, 응답 속도 향상, 세션 공유</td><td>Redis, Memcached, Hazelcast 등</td><td>읽기 많은 트래픽, 응답 지연 최소화 필요 시</td></tr><tr><td></td><td><strong>관찰가능성 스택</strong></td><td>시스템 상태 추적 및 분석</td><td>메트릭 수집, 로그 집계, 분산 트레이싱</td><td>Prometheus, Grafana, ELK Stack, Jaeger 등</td><td>장애 분석, 성능 모니터링, 운영 자동화 필요한 환경</td></tr></tbody></table><h4 id=구성요소별-기술-스택-매핑>구성요소별 기술 스택 매핑<a hidden class=anchor aria-hidden=true href=#구성요소별-기술-스택-매핑>#</a></h4><table><thead><tr><th>구성요소</th><th>기능 요약</th><th>주요 스택 예시</th><th>선택 기준 요약</th></tr></thead><tbody><tr><td><strong>API Gateway</strong></td><td>외부 요청 라우팅 및 정책 적용</td><td>NGINX, Envoy, Kong, Ambassador, AWS/GCP Gateway</td><td>오픈소스 여부, 인증/인가, 성능, 통합 기능 여부</td></tr><tr><td><strong>Service Mesh</strong></td><td>서비스 간 트래픽 제어 및 보안</td><td>Istio, Linkerd, Consul Connect, Kuma</td><td>정책 관리 필요 여부, 리소스 오버헤드, 설치 난이도, 운영 UI 지원 여부</td></tr><tr><td><strong>Message Broker</strong></td><td>비동기 이벤트 및 메시지 전달</td><td>Apache Kafka, RabbitMQ, NATS, Amazon SQS</td><td>Throughput, 내구성, 순서 보장 여부, 운영 복잡도</td></tr><tr><td><strong>Container Runtime</strong></td><td>애플리케이션 실행 환경</td><td>Docker, containerd, CRI-O</td><td>보안 격리 수준, 커뮤니티 지원, 오케스트레이터 호환성</td></tr><tr><td><strong>Orchestration</strong></td><td>컨테이너 관리 및 배치</td><td>Kubernetes, OpenShift, Rancher</td><td>멀티 클러스터 관리, 선언형 지원, 보안/네트워크 통합성</td></tr><tr><td><strong>Observability</strong></td><td>모니터링, 로깅, 추적 통합</td><td>Prometheus, Grafana, ELK Stack, Jaeger, Loki</td><td>메트릭 정밀도, 시각화 도구 통합, 분산 추적 필요 여부</td></tr><tr><td><strong>CI/CD</strong></td><td>자동 빌드, 테스트, 배포</td><td>Jenkins, GitLab CI/CD, ArgoCD, Tekton</td><td>선언형 배포 필요성, GitOps 여부, 확장성</td></tr><tr><td><strong>Secret Management</strong></td><td>보안 구성요소의 저장 및 접근 제어</td><td>HashiCorp Vault, AWS Secrets Manager, Sealed Secrets</td><td>외부 통합 여부, 감사 로그, 자동화 지원 여부</td></tr><tr><td><strong>Distributed Cache</strong></td><td>데이터 캐싱 및 성능 향상</td><td>Redis, Memcached, Hazelcast</td><td>읽기 집중 시스템 여부, 세션 공유 필요 여부</td></tr></tbody></table><h4 id=도입-판단-기준-체크리스트>도입 판단 기준 체크리스트<a hidden class=anchor aria-hidden=true href=#도입-판단-기준-체크리스트>#</a></h4><table><thead><tr><th>구성요소</th><th>판단 기준 질문</th><th>도입 권장 조건 요약</th></tr></thead><tbody><tr><td><strong>API Gateway</strong></td><td>인증, 속도 제한, 트래픽 라우팅이 필요한가?</td><td>다양한 API 엔드포인트 노출 및 인증/정책 통합 필요 시</td></tr><tr><td><strong>Service Mesh</strong></td><td>mTLS, 트래픽 셰이핑, A/B 테스팅 필요성 있는가?</td><td>서비스 간 트래픽 보안, 라우팅 정책, 관찰성 향상이 중요한 경우</td></tr><tr><td><strong>Message Broker</strong></td><td>서비스 간 느슨한 결합이 필요한가?대용량 이벤트를 처리해야 하는가?</td><td>비동기 처리, 이벤트 기반 구조 필요 시</td></tr><tr><td><strong>CI/CD</strong></td><td>수동 배포로 인한 장애/지연이 발생하는가?자동 테스트와 롤백이 필요한가?</td><td>빈번한 배포, 자동화 기반 릴리즈 파이프라인 필요 시</td></tr><tr><td><strong>Observability</strong></td><td>분산 환경에서 원인 분석이 어려운가?장애 대응 속도에 문제가 있는가?</td><td>모니터링/로깅/트레이싱 통합 필요 시</td></tr><tr><td><strong>Secret 관리</strong></td><td>민감한 정보가 코드에 하드코딩되고 있는가?권한 관리와 감사 로그가 필요한가?</td><td>보안 감사, 키 관리 체계화, 운영/개발 분리 필요 시</td></tr><tr><td><strong>Orchestration</strong></td><td>수백 개 이상의 컨테이너 관리가 필요한가?자동 복구와 스케일링이 요구되는가?</td><td>다수의 서비스 운영, 자원 자동 조정 및 탄력성이 필요한 경우</td></tr><tr><td><strong>Cache</strong></td><td>응답 속도 향상이 필요한가?읽기 요청 비중이 높은가?</td><td>세션 공유, 데이터베이스 부하 감소 필요 시</td></tr></tbody></table><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th><th><strong>주요 기술 요소</strong></th></tr></thead><tbody><tr><td><strong>확장성과 유연성</strong></td><td><strong>확장성 (Scalability)</strong></td><td>서비스 단위 수평 확장 가능, 트래픽 증가에 따라 자동 확장 (Auto-scaling)</td><td>마이크로서비스, 컨테이너, Kubernetes, HPA</td></tr><tr><td></td><td><strong>유연성 (Flexibility)</strong></td><td>서비스 단위 배포/업데이트 가능, 변경에 따른 영향 최소화</td><td>독립 배포, 도메인 주도 설계</td></tr><tr><td><strong>복원력</strong></td><td><strong>탄력성 (Resilience)</strong></td><td>장애 격리 및 자동 복구 기능을 통해 시스템 전체로의 장애 전파 방지</td><td>서킷 브레이커, 헬스체크, Kubernetes 복구</td></tr><tr><td></td><td><strong>복원력 (Recoverability)</strong></td><td>자동 재시작, 상태 비저장 (stateless) 설계로 고가용성 보장</td><td>Liveness/Readiness Probe, Stateless Design</td></tr><tr><td><strong>개발 생산성</strong></td><td><strong>배포 민첩성 (Deployment Agility)</strong></td><td>빠른 배포, 롤백, 테스트 가능. 기능 단위로 CI/CD 파이프라인 자동화</td><td>CI/CD, GitOps, ArgoCD, Tekton</td></tr><tr><td></td><td><strong>개발 속도 향상</strong></td><td>팀별 독립 개발 및 기술 선택 가능, 반복적 기능 출시 속도 증가</td><td>팀별 마이크로서비스, DevOps 문화</td></tr><tr><td><strong>기술 다양성</strong></td><td><strong>기술 이기종성 지원</strong></td><td>서비스별 최적 기술 스택 사용 가능 (ex. Node.js, Go, Python, Rust 등 혼합)</td><td>Polyglot Architecture</td></tr><tr><td><strong>운영 효율성</strong></td><td><strong>인프라 효율성</strong></td><td>불변 인프라, IaC 기반 운영 자동화, 반복 가능하고 안정적인 배포 가능</td><td>Terraform, Helm, Kustomize, Immutable Infra</td></tr><tr><td></td><td><strong>운영 자동화</strong></td><td>운영 비용 절감, 인적 오류 감소</td><td>IaC, 오케스트레이션, 자동화 스크립트</td></tr><tr><td><strong>이식성</strong></td><td><strong>환경 독립성 (Portability)</strong></td><td>컨테이너화를 통해 멀티 클라우드, 하이브리드 클라우드 간 이동 및 실행 환경 일관성 확보</td><td>Docker, Kubernetes, OCI</td></tr><tr><td><strong>관찰가능성</strong></td><td><strong>관측성 (Observability)</strong></td><td>모니터링, 로깅, 트레이싱 통합으로 문제 원인 추적 용이, 시스템 상태 실시간 확인 가능</td><td>OpenTelemetry, Prometheus, Grafana, Jaeger</td></tr><tr><td><strong>보안성</strong></td><td><strong>보안 강화</strong></td><td>마이크로세그멘테이션, 제로 트러스트 모델, mTLS 적용으로 보안 정책 세분화 및 공격 표면 최소화</td><td>Zero Trust, mTLS, OPA, 서비스 메시</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>해결책/완화 전략</th></tr></thead><tbody><tr><td><strong>설계 복잡성</strong></td><td>아키텍처 복잡성</td><td>마이크로서비스 분리, 서비스 메시, 이벤트 브로커 등 다양한 요소 도입으로 전체 구조 복잡</td><td>표준화된 설계 가이드 도입, 마이크로서비스 분리 기준 정립, DDD 적용</td></tr><tr><td><strong>초기 투자</strong></td><td>도입 비용</td><td>인프라 구성, 학습 및 도구 도입에 따른 초기 진입 장벽 존재</td><td>클라우드 매니지드 서비스 활용, 오픈소스 도구 중심의 도입, 단계적 확산</td></tr><tr><td><strong>운영 복잡성</strong></td><td>배포 및 모니터링 오버헤드</td><td>CI/CD, 모니터링, 로깅, 트레이싱 등 다수의 운영 요소 관리 필요</td><td>통합 DevOps 플랫폼 도입, GitOps, 자동화 파이프라인 설계</td></tr><tr><td><strong>성능 문제</strong></td><td>네트워크 지연</td><td>서비스 간 통신 증가로 인한 네트워크 지연 시간 누적</td><td>gRPC 채택, 캐싱, 메시지 버퍼링, 로컬 처리 로직 추가</td></tr><tr><td><strong>데이터 처리</strong></td><td>일관성 유지 어려움</td><td>분산 DB 및 상태 관리로 인한 트랜잭션 및 정합성 처리 복잡성</td><td>Event Sourcing, Saga, CQRS, 최종 일관성 수용</td></tr><tr><td><strong>리소스 관리</strong></td><td>리소스 과소/과다 할당</td><td>수많은 컨테이너의 리소스 제어 어려움으로 인한 오버헤드 가능성</td><td>HPA/VPA 활용, 클러스터 오토스케일링, 프로파일링 도입</td></tr><tr><td><strong>보안 부담</strong></td><td>확장된 공격 표면</td><td>서비스 수 증가 → 인증·인가, 통신 암호화, 이미지 보안 등 고려 영역 증가</td><td>DevSecOps, mTLS, 취약점 스캐닝 자동화, 사이드카 보안 적용</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>카테고리</th><th>문제 항목</th><th>원인</th><th>영향</th><th>탐지 및 진단 도구</th><th>예방 전략</th><th>해결 전략</th></tr></thead><tbody><tr><td><strong>성능 문제</strong></td><td>네트워크 지연</td><td>서비스 간 과도한 호출, 프록시 레이어 증가</td><td>처리 지연, 응답 시간 증가</td><td>Prometheus, Grafana, APM</td><td>캐싱 도입, gRPC 사용, 호출 횟수 제한</td><td>서비스 메시 최적화, 호출 최소화</td></tr><tr><td><strong>시스템 안정성</strong></td><td>분산 시스템 카오스</td><td>네트워크 단절, 의존성 고리 증가로 인한 장애 전파</td><td>연쇄 장애, 시스템 불안정</td><td>서비스 맵, 분산 추적, 카오스 테스트 도구</td><td>서킷 브레이커, 타임아웃 설정</td><td>장애 격리 패턴, 카오스 엔지니어링 적용</td></tr><tr><td><strong>리소스 충돌</strong></td><td>컨테이너 리소스 경합</td><td>CPU, Memory 할당 미흡 또는 과다 설정</td><td>OOM, 스로틀링, 시스템 과부하</td><td>kube-metrics-server, APM, cAdvisor</td><td>수직 확장, 자원 자동 조정 정책 적용</td><td>자원 제한 재조정, 클러스터 오토스케일링</td></tr><tr><td><strong>데이터 문제</strong></td><td>데이터 불일치</td><td>네트워크 파티션, 중복 요청, 동시성 처리 실패</td><td>데이터 무결성 훼손, 사용자 혼란</td><td>데이터 무결성 검증, 로그 분석, 보상 트랜잭션 모니터링</td><td>멱등성 처리, 이벤트 소싱, 트랜잭션 보상 처리</td><td>복구 프로세스 설계, 운영자 승인 기반 수동 처리</td></tr><tr><td><strong>보안 이슈</strong></td><td>보안 취약점</td><td>이미지 취약점, 네트워크 노출, 인증·인가 누락</td><td>데이터 유출, 악성 침입</td><td>취약점 스캐너 (Trivy, Snyk), 감사 로그 분석</td><td>보안 코드 리뷰, 네트워크 정책 적용, mTLS</td><td>자동 패치 시스템, 정기 보안 감사</td></tr><tr><td><strong>관측성 부족</strong></td><td>장애 원인 불분명</td><td>분산 시스템의 복잡성으로 인한 로그, 메트릭, 트레이스 통합 어려움</td><td>문제 진단 지연, MTTR 증가</td><td>OpenTelemetry, Jaeger, Loki, Kibana</td><td>표준 로깅/트레이싱 포맷 통일, 로그 집계 시스템 구성</td><td>관측성 강화, 서비스 별 상태 시각화 대시보드 구축</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>도전 과제</strong></th><th><strong>원인/설명</strong></th><th><strong>해결책/전략</strong></th><th></th></tr></thead><tbody><tr><td><strong>기술적 과제</strong></td><td><strong>데이터 일관성</strong></td><td>마이크로서비스 간 개별 DB 사용, 분산 트랜잭션 부재</td><td>이벤트 소싱, CQRS, SAGA 패턴, 최종 일관성 모델 적용</td><td></td></tr><tr><td></td><td><strong>분산 시스템 복잡성</strong></td><td>수십~수백 개 서비스, 오케스트레이션 복잡도 증가</td><td>서비스 메시, 통합 오케스트레이션 (Kubernetes), IaC 기반 자동화</td><td></td></tr><tr><td></td><td><strong>서비스 간 통신 지연/오버헤드</strong></td><td>HTTP/JSON 직렬화, 네트워크 지연, 불필요한 연쇄 호출</td><td>gRPC 도입, 비동기 메시징, 캐시 레이어, 서비스 콜로케이션</td><td></td></tr><tr><td></td><td><strong>멀티 클라우드 관리</strong></td><td>서로 다른 API 및 서비스 모델, 벤더 종속성</td><td>Terraform/Pulumi, Anthos/Azure Arc, Helm/Kustomize 등 추상화 도구 활용</td><td></td></tr><tr><td></td><td><strong>관찰가능성 확보</strong></td><td>서비스 간 상호작용이 복잡, 문제 원인 파악 어려움</td><td>OpenTelemetry, 통합 모니터링 스택 (Prometheus, Grafana, ELK), 이상 탐지 시스템 구축</td><td></td></tr><tr><td></td><td><strong>보안 관리</strong></td><td>다중 API 및 통신 채널, 인증/인가 정책 복잡도</td><td>DevSecOps 도입, mTLS, 중앙 인증 시스템 (OAuth2/OpenID), 정기 취약점 스캔 자동화</td><td></td></tr><tr><td><strong>운영적 과제</strong></td><td><strong>운영 자동화 및 관리 난이도</strong></td><td>서비스/컨테이너 증가 → 인프라/배포 복잡도 증가</td><td>GitOps, ArgoCD, Tekton, 자동 스케일링/복구 도입</td><td></td></tr><tr><td></td><td><strong>비용 최적화</strong></td><td>리소스 과다 할당, 무분별한 확장 → 비용 증가</td><td>비용 할당 모니터링, HPA/스팟 인스턴스, 자동 스케일링 정책 개선</td><td></td></tr><tr><td></td><td><strong>레거시 시스템과 통합</strong></td><td>온프레미스 - 클라우드 이질성, 기존 자산 활용 요구</td><td>하이브리드 클라우드 전략, API 게이트웨이, 점진적 마이그레이션 (스트랭글러 패턴)</td><td></td></tr><tr><td></td><td><strong>실시간 대응/회복력 부족</strong></td><td>장애 발생 시 원인 파악/복구 지연</td><td>MTTR 기반 운영지표 도입, 자동 복구 설정, 카오스 엔지니어링 테스트</td><td></td></tr><tr><td><strong>조직적 과제</strong></td><td><strong>DevOps 문화 정착</strong></td><td>전통적 개발/운영 분리, 책임 영역 충돌</td><td>크로스 펑셔널 팀 구성, 지속적 교육, 점진적 조직 구조 전환</td><td></td></tr><tr><td></td><td><strong>스킬 격차</strong></td><td>최신 기술 스택에 대한 경험 부족</td><td>내부 교육/멘토링, 외부 전문가 도입, 커뮤니티 활동 활성화</td><td></td></tr><tr><td></td><td><strong>규정 준수/보안 인증</strong></td><td>산업별 법적 규제, 보안 정책 강화 필요</td><td>정책 코드화 (OPA), 감사 로그 저장, PCI-DSS/HIPAA 등 표준 대응</td><td></td></tr></tbody></table><ul><li>기술적 도전 과제는 대부분 <strong>아키텍처 설계·구현의 선택</strong>과 직결되며, 설계 단계에서 미리 해결책을 통합하는 것이 중요.</li><li>운영적 과제는 <strong>자동화와 가시성 확보</strong>가 핵심이며, 오케스트레이션과 관찰가능성 도구가 필수.</li><li>조직적 과제는 기술보다 <strong>문화와 협업 방식의 변화</strong>가 요구되며, DevOps/Platform Engineering 기반의 접근이 필요.</li></ul><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형/모델</th><th>설명 및 특징</th><th>대표 예시</th></tr></thead><tbody><tr><td><strong>배포 환경</strong></td><td>퍼블릭 클라우드</td><td>공개 클라우드 환경에서 운영</td><td>AWS, GCP, Azure</td></tr><tr><td></td><td>프라이빗 클라우드</td><td>온프레미스 또는 전용 클라우드 인프라에서 운영</td><td>OpenStack, VMware vSphere</td></tr><tr><td></td><td>하이브리드 클라우드</td><td>퍼블릭과 프라이빗 클라우드 혼합 운영</td><td>Red Hat OpenShift, Azure Arc</td></tr><tr><td></td><td>멀티 클라우드</td><td>복수의 퍼블릭 클라우드를 병렬로 활용</td><td>AWS + GCP 조합 운영</td></tr><tr><td></td><td>매니지드 서비스</td><td>클라우드 벤더에서 제공하는 관리형 플랫폼 사용</td><td>GKE, EKS, AKS</td></tr><tr><td></td><td>셀프 매니지드</td><td>자체적으로 Kubernetes 등을 설치·운영</td><td>kubeadm, Rancher</td></tr><tr><td><strong>서비스 구조</strong></td><td>마이크로서비스</td><td>독립적으로 배포 및 확장 가능한 작은 서비스 단위로 구성</td><td>Netflix, Amazon</td></tr><tr><td></td><td>미니 서비스</td><td>마이크로서비스보다 큰 단위로 적절히 나눈 중간 크기의 서비스 단위</td><td>일부 기업의 내부 BFF 서비스 구조</td></tr><tr><td></td><td>모듈러 모놀리스</td><td>단일 애플리케이션이지만 내부를 모듈화해 독립성 유지</td><td>초기 단계 스타트업, 단계적 마이그레이션 구조</td></tr><tr><td><strong>컴퓨팅 모델</strong></td><td>컨테이너 기반</td><td>컨테이너화된 애플리케이션과 런타임을 통해 일관성 있고 이식 가능한 배포 가능</td><td>Docker, Kubernetes, containerd</td></tr><tr><td></td><td>서버리스</td><td>인프라를 숨기고 함수 단위로 실행, 이벤트 기반 트리거 지원</td><td>AWS Lambda, Azure Functions</td></tr><tr><td></td><td>불변 인프라</td><td>코드로 정의된 인프라를 배포 후 변경하지 않고 재생성</td><td>Terraform, Pulumi, Immutable AMI</td></tr><tr><td><strong>통신 방식</strong></td><td>동기 통신</td><td>요청 - 응답 기반의 직접 API 호출</td><td>REST, gRPC</td></tr><tr><td></td><td>비동기 통신</td><td>메시지 브로커를 통한 비동기 메시지 전달</td><td>Kafka, RabbitMQ</td></tr><tr><td></td><td>이벤트 기반</td><td>이벤트 발행 - 구독을 중심으로 상태 변화 모델링</td><td>Event Sourcing, CQRS</td></tr><tr><td></td><td>직접 통신</td><td>API Gateway 없이 서비스 간 직접 호출</td><td>내부 서비스 API 통신</td></tr><tr><td><strong>데이터 관리</strong></td><td>서비스별 데이터베이스 분리</td><td>각 서비스가 고유한 데이터베이스를 가짐</td><td>Microservices with DB-per-service</td></tr><tr><td></td><td>공유 데이터베이스</td><td>여러 서비스가 하나의 데이터베이스를 공유</td><td>기존 모놀리스 시스템에서 마이그레이션 중인 구조</td></tr><tr><td></td><td>이벤트 기반 데이터 동기화</td><td>이벤트 로그를 기반으로 상태를 동기화, 복구도 가능</td><td>Kafka + Event Sourcing</td></tr><tr><td><strong>네트워킹 구조</strong></td><td>서비스 메시</td><td>서비스 간 트래픽 관리, 보안, 정책 적용 등을 위한 전용 계층 구성</td><td>Istio, Linkerd</td></tr><tr><td></td><td>API 게이트웨이</td><td>외부 요청의 단일 진입점, 인증/인가, 라우팅 정책 적용</td><td>Kong, Envoy, AWS API Gateway</td></tr><tr><td></td><td>직접 통신</td><td>서비스 간 직접 API 호출, 간단한 구조, 낮은 지연 시간</td><td>REST/gRPC 호출</td></tr><tr><td><strong>클라우드 적합도</strong></td><td>클라우드 네이티브</td><td>처음부터 클라우드를 위해 설계됨</td><td>12-Factor App, Kubernetes-native 구조</td></tr><tr><td></td><td>클라우드 지원</td><td>기존 앱을 클라우드 환경으로 포팅함</td><td>모놀리스 앱을 Lift-and-Shift 방식으로 이전</td></tr><tr><td></td><td>클라우드 최적화</td><td>클라우드 특성을 일부 반영해 구조 개선</td><td>DB 연결 풀링, S3 등 관리형 서비스로 전환</td></tr></tbody></table><ul><li><strong>배포/환경 관점</strong>: 클라우드 운영 형태 (퍼블릭, 프라이빗, 하이브리드, 매니지드, 셀프 매니지드)</li><li><strong>구조적 관점</strong>: 마이크로서비스, 서버리스, 컨테이너화, 이벤트 기반, 직접 통신</li><li><strong>운영/전환 관점</strong>: 클라우드 네이티브 ↔ 지원 ↔ 최적화 / 불변 인프라 전략</li><li><strong>데이터/통신 관점</strong>: 동기/비동기, 데이터베이스 구조, 이벤트 기반 처리</li></ul><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th><strong>분야</strong></th><th><strong>사례/적용 예시</strong></th><th><strong>주요 목적</strong></th><th><strong>기술 스택</strong></th><th><strong>기대 효과</strong></th></tr></thead><tbody><tr><td><strong>전자상거래</strong></td><td>쇼핑몰 플랫폼 (예: Shopify, Amazon, 11 번가)</td><td>고가용성, 빠른 배포, 트래픽 대응</td><td>React, Node.js, MongoDB, Redis, Kubernetes, 서버리스</td><td>99.9% 가용성, 피크 트래픽 처리, 신속한 기능 릴리즈</td></tr><tr><td><strong>금융/핀테크</strong></td><td>결제 및 뱅킹 시스템 (예: Capital One, 카카오뱅크)</td><td>실시간 트랜잭션 처리, 보안 강화</td><td>Spring Boot, PostgreSQL, Kafka, API Gateway, Serverless</td><td>초당 수만 건 처리, PCI DSS/HIPAA 준수, 규제 대응</td></tr><tr><td><strong>미디어/스트리밍</strong></td><td>글로벌 스트리밍 플랫폼 (예: Netflix, YouTube)</td><td>대규모 콘텐츠 전송, 글로벌 확장</td><td>Golang, Cassandra, CDN, S3, Chaos Engineering, Kubernetes</td><td>글로벌 사용자 동시 접속 처리, 무중단 스트리밍</td></tr><tr><td><strong>IoT/센서 데이터</strong></td><td>실시간 IoT 플랫폼</td><td>고빈도 이벤트 수집 및 분석</td><td>Python, Apache Pulsar, InfluxDB, Grafana</td><td>초당 백만 건 데이터 수집, 실시간 분석 및 시각화</td></tr><tr><td><strong>소셜 플랫폼</strong></td><td>SNS/메신저 시스템 (예: Slack, Twitter)</td><td>콘텐츠 생성/알림, 관계 중심 데이터 관리</td><td>React Native, GraphQL, Neo4j, Redis, ElasticSearch</td><td>개인화 피드, 빠른 알림 전파, 확장성 높은 구조</td></tr><tr><td><strong>게임/실시간 엔터테인먼트</strong></td><td>멀티플레이어 게임 백엔드</td><td>실시간 상태 동기화, 전역 통신</td><td>Unity, C#, Redis Cluster, WebSocket, Leaderboard</td><td>게임 내 실시간 반응, 글로벌 매치 지원</td></tr><tr><td><strong>헬스케어</strong></td><td>의료 정보 시스템 (예: Philips HealthSuite)</td><td>데이터 연계, 개인정보 보호, 원격 모니터링</td><td>Java, FHIR, Apache Kafka, PostgreSQL, 인증 시스템</td><td>HIPAA 대응, 안전한 데이터 교환, 환자 맞춤형 서비스</td></tr><tr><td><strong>교육/에듀테크</strong></td><td>온라인 학습 플랫폼</td><td>다중 사용자 수업 지원, 콘텐츠 분배, 실시간 피드백</td><td>Vue.js, Laravel, MySQL, WebRTC</td><td>학습 진도 추적, 실시간 수업, 유연한 콘텐츠 운영</td></tr><tr><td><strong>DevOps 플랫폼</strong></td><td>SaaS/배포 자동화</td><td>CI/CD 통합, 운영 자동화</td><td>Docker, Jenkins, Terraform, ArgoCD</td><td>빠른 릴리즈, 오류 최소화, 협업 가속화</td></tr><tr><td><strong>공공/정부 시스템</strong></td><td>클라우드 기반 민원 처리 시스템</td><td>대국민 안정적 서비스, API 기반 통합</td><td>Kubernetes, API Gateway, OAuth, OpenID</td><td>확장성, 보안성, 다양한 디바이스 대응</td></tr><tr><td><strong>실시간 데이터 처리</strong></td><td>데이터 흐름 처리 파이프라인</td><td>스트림 분석, 이벤트 기반 마이크로서비스</td><td>Kafka, Flink, ArgoCD, CQRS, Event Sourcing</td><td>낮은 지연, 높은 처리량, 유연한 데이터 분리 구조</td></tr></tbody></table><ul><li><strong>도메인 다양성</strong>: 금융, 이커머스, 게임, IoT, 헬스케어 등 다양한 산업군에서 활용.</li><li><strong>기술 스택 조합</strong>: 전통적인 백엔드 언어부터 최신 클라우드 네이티브 기술까지 혼합.</li><li><strong>공통 패턴</strong>: 마이크로서비스, Kafka, API Gateway, 서버리스, Kubernetes, CI/CD.</li><li><strong>핵심 효과</strong>: 실시간성, 고가용성, 확장성, 컴플라이언스 대응, 자동화.</li></ul><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-쿠팡의-주문-처리-시스템>사례 1: 쿠팡의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-쿠팡의-주문-처리-시스템>#</a></h4><p><strong>구성 요소</strong>: 사용자 서비스 → 주문 마이크로서비스 → 재고 관리 → 결제 시스템</p><p><strong>아키텍처</strong>:</p><pre class=mermaid>graph LR
A[User Frontend] --&gt; B[Order Service]
B --&gt; C[Inventory Service]
B --&gt; D[Payment Service]
C --&gt; E[Database]
D --&gt; F[Payment Gateway]
</pre><p><strong>Workflow</strong>: 사용자 주문 → 주문 서비스 처리 → 재고 확인 → 결제 → 완료</p><p><strong>Cloud-Native 요소</strong>: 모든 서비스는 Docker + Kubernetes 로 구성되며, 이벤트 브로커 (Kafka) 를 통해 비동기 처리</p><p><strong>비교</strong>: 기존 모놀리식 대비 장애 분리 가능, 배포 속도 증가, 트래픽 피크 대응 유리</p><h4 id=사례-2-이커머스-플랫폼의-cloud-native-도입>사례 2: 이커머스 플랫폼의 Cloud-Native 도입<a hidden class=anchor aria-hidden=true href=#사례-2-이커머스-플랫폼의-cloud-native-도입>#</a></h4><p><strong>적용 목적</strong>: 유연한 트래픽 대응, 빠른 신규 기능 롤아웃, 장애 복원력 확보</p><p><strong>시스템 구성도</strong>:</p><pre class=mermaid>graph LR
  UI[Frontend]
  UI --&gt; APIGW[API Gateway]
  APIGW --&gt; Order[Order Service]
  APIGW --&gt; Payment[Payment Service]
  APIGW --&gt; Product[Product Service]
  Order --&gt; OrderDB[(Order DB)]
  Payment --&gt; PaymentDB[(Payment DB)]
  Product --&gt; ProductDB[(Product DB)]
</pre><p><strong>워크플로우</strong>:</p><ol><li>사용자가 주문 요청을 API Gateway 로 전송</li><li>Gateway 는 Order Service 로 전달</li><li>Order Service 는 주문 정보 저장 및 이벤트 발행 (예: Kafka)</li><li>Payment Service 는 이벤트 수신 후 결제 처리</li><li>처리 후 결과를 API Gateway 를 통해 사용자에게 응답</li></ol><p><strong>역할 분담</strong>:</p><ul><li>Frontend: 사용자 요청 입력</li><li>API Gateway: 요청 라우팅 및 인증</li><li>각 Service: 독립된 도메인 기능 처리</li><li>DB: 서비스별 데이터 저장소로 분리</li></ul><h4 id=사례-3-netflix-클라우드-네이티브-전환>사례 3: Netflix 클라우드 네이티브 전환<a hidden class=anchor aria-hidden=true href=#사례-3-netflix-클라우드-네이티브-전환>#</a></h4><p>Netflix 는 2008 년 데이터 센터 장애를 겪은 후 2009 년부터 7 년에 걸쳐 클라우드 네이티브 아키텍처로 완전 전환했다. 현재 전 세계 190 개국에서 2 억 명 이상의 사용자에게 서비스를 제공하며, 일일 시청 시간 10 억 시간을 처리하는 대규모 클라우드 네이티브 시스템을 운영하고 있다.</p><p><strong>시스템 구성</strong></p><ul><li>고수준 아키텍처</li></ul><pre class=mermaid>graph TB
    subgraph &#34;CDN Layer&#34;
        CDN[Open Connect CDN]
    end
    
    subgraph &#34;AWS Cloud&#34;
        subgraph &#34;Frontend Services&#34;
            UI[User Interface]
            API[API Gateway]
        end
        
        subgraph &#34;Core Microservices&#34;
            USER[User Service]
            RECO[Recommendation Engine]
            PLAY[Playback Service]
            META[Metadata Service]
            BILL[Billing Service]
        end
        
        subgraph &#34;Data Layer&#34;
            CASS[Cassandra]
            ES[Elasticsearch]
            REDIS[Redis Cache]
        end
        
        subgraph &#34;Platform Services&#34;
            EUREKA[Service Discovery]
            ZUUL[Load Balancer]
            HYSTRIX[Circuit Breaker]
        end
        
        subgraph &#34;Analytics&#34;
            KAFKA[Kafka Streams]
            SPARK[Spark Analytics]
            S3[Data Lake S3]
        end
    end
    
    CDN --&gt; UI
    UI --&gt; API
    API --&gt; USER
    API --&gt; RECO
    API --&gt; PLAY
    API --&gt; META
    API --&gt; BILL
    
    USER --&gt; CASS
    RECO --&gt; ES
    PLAY --&gt; REDIS
    
    EUREKA --&gt; USER
    EUREKA --&gt; RECO
    EUREKA --&gt; PLAY
    
    ZUUL --&gt; USER
    ZUUL --&gt; RECO
    
    HYSTRIX --&gt; USER
    HYSTRIX --&gt; RECO
    
    KAFKA --&gt; SPARK
    SPARK --&gt; S3
</pre><p><strong>활용 사례 Workflow</strong>:</p><ul><li>사용자 콘텐츠 추천 워크플로우</li></ul><pre class=mermaid>sequenceDiagram
    participant User as 사용자
    participant CDN as CDN
    participant Gateway as API Gateway
    participant Auth as 인증 서비스
    participant Profile as 프로필 서비스
    participant Reco as 추천 엔진
    participant Content as 콘텐츠 서비스
    participant Analytics as 분석 서비스
    
    User-&gt;&gt;CDN: 웹/앱 접속
    CDN-&gt;&gt;Gateway: 요청 전달
    Gateway-&gt;&gt;Auth: 사용자 인증
    Auth--&gt;&gt;Gateway: 인증 토큰
    Gateway-&gt;&gt;Profile: 사용자 프로필 조회
    Profile--&gt;&gt;Gateway: 시청 이력, 선호도
    Gateway-&gt;&gt;Reco: 추천 요청
    Reco-&gt;&gt;Content: 콘텐츠 메타데이터 조회
    Content--&gt;&gt;Reco: 콘텐츠 정보
    Reco--&gt;&gt;Gateway: 개인화된 추천 목록
    Gateway--&gt;&gt;CDN: 추천 결과
    CDN--&gt;&gt;User: 개인화된 홈화면
    
    Note over Analytics: 실시간 사용자 행동 분석
    User-&gt;&gt;Analytics: 클릭, 시청 이벤트
</pre><h4 id=사례-4-글로벌-전자상거래-플랫폼>사례 4: 글로벌 전자상거래 플랫폼<a hidden class=anchor aria-hidden=true href=#사례-4-글로벌-전자상거래-플랫폼>#</a></h4><p>대규모 온라인 쇼핑몰에서 Cloud-Native Architecture 를 도입하여 트래픽 급증과 글로벌 확장에 대응한 사례</p><p><strong>시스템 구성</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;외부 사용자&#34;
        A[웹 브라우저]
        B[모바일 앱]
        C[파트너 API]
    end
    
    subgraph &#34;CDN 및 로드밸런서&#34;
        D[CloudFlare CDN]
        E[AWS ALB]
    end
    
    subgraph &#34;API 게이트웨이&#34;
        F[Kong Gateway]
        G[인증 서비스]
    end
    
    subgraph &#34;마이크로서비스 (Kubernetes)&#34;
        H[사용자 서비스]
        I[상품 서비스]
        J[주문 서비스]
        K[결제 서비스]
        L[배송 서비스]
        M[알림 서비스]
    end
    
    subgraph &#34;데이터 계층&#34;
        N[PostgreSQL&lt;br/&gt;사용자/주문]
        O[MongoDB&lt;br/&gt;상품 카탈로그]
        P[Redis&lt;br/&gt;세션/캐시]
        Q[Elasticsearch&lt;br/&gt;검색]
    end
    
    subgraph &#34;메시징&#34;
        R[Apache Kafka&lt;br/&gt;이벤트 스트림]
    end
    
    subgraph &#34;서비스 메시&#34;
        S[Istio Control Plane]
        T[Envoy Proxies]
    end
    
    A --&gt; D
    B --&gt; D
    C --&gt; E
    D --&gt; E
    E --&gt; F
    F --&gt; G
    G --&gt; H
    G --&gt; I
    G --&gt; J
    G --&gt; K
    G --&gt; L
    G --&gt; M
    
    H --&gt; N
    I --&gt; O
    J --&gt; N
    K --&gt; N
    L --&gt; N
    M --&gt; P
    I --&gt; Q
    
    J --&gt; R
    K --&gt; R
    L --&gt; R
    M --&gt; R
    
    S --&gt; T
    T --&gt; H
    T --&gt; I
    T --&gt; J
    T --&gt; K
    T --&gt; L
    T --&gt; M
</pre><p><strong>워크플로우</strong>:</p><ul><li>주문 처리 워크플로우</li></ul><pre class=mermaid>sequenceDiagram
    participant U as 사용자
    participant G as API Gateway
    participant US as 사용자 서비스
    participant PS as 상품 서비스
    participant OS as 주문 서비스
    participant PayS as 결제 서비스
    participant SS as 배송 서비스
    participant NS as 알림 서비스
    participant K as Kafka

    U-&gt;&gt;G: 주문 요청
    G-&gt;&gt;US: 사용자 인증 확인
    US--&gt;&gt;G: 인증 성공
    G-&gt;&gt;PS: 상품 재고 확인
    PS--&gt;&gt;G: 재고 확인됨
    G-&gt;&gt;OS: 주문 생성
    OS-&gt;&gt;K: 주문 생성 이벤트 발행
    OS--&gt;&gt;G: 주문 ID 반환
    G--&gt;&gt;U: 주문 확인
    
    K-&gt;&gt;PayS: 결제 처리 요청
    PayS-&gt;&gt;K: 결제 완료 이벤트
    
    K-&gt;&gt;SS: 배송 준비 요청
    SS-&gt;&gt;K: 배송 시작 이벤트
    
    K-&gt;&gt;NS: 알림 발송 요청
    NS-&gt;&gt;U: 주문 확인 알림
</pre><p><strong>Cloud-Native Architecture 의 역할</strong>:</p><ol><li><p><strong>트래픽 급증 대응</strong></p><ul><li>자동 스케일링으로 블랙 프라이데이 300% 트래픽 증가 처리</li><li>마이크로서비스별 독립적 확장으로 리소스 효율성 달성</li><li>CDN 과 캐싱 전략으로 응답 시간 50% 개선</li></ul></li><li><p><strong>글로벌 서비스 제공</strong></p><ul><li>멀티 리전 배포로 지역별 데이터 센터 운영</li><li>지역별 데이터 컴플라이언스 요구사항 충족</li><li>24/7 무중단 서비스 운영</li></ul></li><li><p><strong>개발 생산성 향상</strong></p><ul><li>마이크로서비스별 독립 개발팀 운영</li><li>CI/CD 파이프라인으로 일 평균 50 회 배포</li><li>기능별 A/B 테스트 및 카나리 배포</li></ul></li></ol><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><p><strong>전자상거래 플랫폼의 주문 처리 마이크로서비스</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 전체 마이크로서비스 아키텍처 구성도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Client → API Gateway (Kong) → Service Mesh (Istio) → Order Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                              ↓</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                         User Service, Product Service, Payment Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                              ↓</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                         Database Layer (PostgreSQL)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                              ↓</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                         Cache Layer (Redis)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                              ↓</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#                         Message Queue (Kafka)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이러한 구조는 <strong>마이크로서비스 아키텍처의 핵심 원칙</strong>들을 따른다:</p><ol><li><strong>단일 책임 원칙</strong>: 각 모듈과 서비스가 명확한 역할을 가진다.</li><li><strong>느슨한 결합</strong>: 인터페이스를 통한 통신으로 의존성을 최소화한다.</li><li><strong>높은 응집도</strong>: 관련된 기능들이 하나의 모듈에 응집되어 있다.</li><li><strong>확장성</strong>: 수평적 스케일링과 로드 밸런싱을 지원한다.</li><li><strong>장애 격리</strong>: 서킷 브레이커, 재시도, 타임아웃 등으로 장애 전파를 방지한다.</li><li><strong>관찰 가능성</strong>: 로깅, 메트릭, 트레이싱을 통한 시스템 가시성을 제공한다.</li><li><strong>보안</strong>: 네트워크 정책, RBAC, 시크릿 관리를 통한 다층 보안을 구현한다.</li></ol><h4 id=설정-관리-레이어-configuration-layer>설정 관리 레이어 (Configuration Layer)<a hidden class=anchor aria-hidden=true href=#설정-관리-레이어-configuration-layer>#</a></h4><h5 id=configpy>config.py<a hidden class=anchor aria-hidden=true href=#configpy>#</a></h5><p>애플리케이션의 모든 설정을 중앙화하여 관리하는 모듈. 데이터베이스, Redis, Kafka, 외부 서비스 등의 연결 설정을 환경 변수로부터 읽어와 Pydantic BaseSettings 를 통해 검증하고 타입 안전성을 보장한다. 개발/운영 환경 구분과 설정 검증 기능을 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34>34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35>35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36>36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37>37</a>
</span><span class=lnt id=hl-12-38><a class=lnlinks href=#hl-12-38>38</a>
</span><span class=lnt id=hl-12-39><a class=lnlinks href=#hl-12-39>39</a>
</span><span class=lnt id=hl-12-40><a class=lnlinks href=#hl-12-40>40</a>
</span><span class=lnt id=hl-12-41><a class=lnlinks href=#hl-12-41>41</a>
</span><span class=lnt id=hl-12-42><a class=lnlinks href=#hl-12-42>42</a>
</span><span class=lnt id=hl-12-43><a class=lnlinks href=#hl-12-43>43</a>
</span><span class=lnt id=hl-12-44><a class=lnlinks href=#hl-12-44>44</a>
</span><span class=lnt id=hl-12-45><a class=lnlinks href=#hl-12-45>45</a>
</span><span class=lnt id=hl-12-46><a class=lnlinks href=#hl-12-46>46</a>
</span><span class=lnt id=hl-12-47><a class=lnlinks href=#hl-12-47>47</a>
</span><span class=lnt id=hl-12-48><a class=lnlinks href=#hl-12-48>48</a>
</span><span class=lnt id=hl-12-49><a class=lnlinks href=#hl-12-49>49</a>
</span><span class=lnt id=hl-12-50><a class=lnlinks href=#hl-12-50>50</a>
</span><span class=lnt id=hl-12-51><a class=lnlinks href=#hl-12-51>51</a>
</span><span class=lnt id=hl-12-52><a class=lnlinks href=#hl-12-52>52</a>
</span><span class=lnt id=hl-12-53><a class=lnlinks href=#hl-12-53>53</a>
</span><span class=lnt id=hl-12-54><a class=lnlinks href=#hl-12-54>54</a>
</span><span class=lnt id=hl-12-55><a class=lnlinks href=#hl-12-55>55</a>
</span><span class=lnt id=hl-12-56><a class=lnlinks href=#hl-12-56>56</a>
</span><span class=lnt id=hl-12-57><a class=lnlinks href=#hl-12-57>57</a>
</span><span class=lnt id=hl-12-58><a class=lnlinks href=#hl-12-58>58</a>
</span><span class=lnt id=hl-12-59><a class=lnlinks href=#hl-12-59>59</a>
</span><span class=lnt id=hl-12-60><a class=lnlinks href=#hl-12-60>60</a>
</span><span class=lnt id=hl-12-61><a class=lnlinks href=#hl-12-61>61</a>
</span><span class=lnt id=hl-12-62><a class=lnlinks href=#hl-12-62>62</a>
</span><span class=lnt id=hl-12-63><a class=lnlinks href=#hl-12-63>63</a>
</span><span class=lnt id=hl-12-64><a class=lnlinks href=#hl-12-64>64</a>
</span><span class=lnt id=hl-12-65><a class=lnlinks href=#hl-12-65>65</a>
</span><span class=lnt id=hl-12-66><a class=lnlinks href=#hl-12-66>66</a>
</span><span class=lnt id=hl-12-67><a class=lnlinks href=#hl-12-67>67</a>
</span><span class=lnt id=hl-12-68><a class=lnlinks href=#hl-12-68>68</a>
</span><span class=lnt id=hl-12-69><a class=lnlinks href=#hl-12-69>69</a>
</span><span class=lnt id=hl-12-70><a class=lnlinks href=#hl-12-70>70</a>
</span><span class=lnt id=hl-12-71><a class=lnlinks href=#hl-12-71>71</a>
</span><span class=lnt id=hl-12-72><a class=lnlinks href=#hl-12-72>72</a>
</span><span class=lnt id=hl-12-73><a class=lnlinks href=#hl-12-73>73</a>
</span><span class=lnt id=hl-12-74><a class=lnlinks href=#hl-12-74>74</a>
</span><span class=lnt id=hl-12-75><a class=lnlinks href=#hl-12-75>75</a>
</span><span class=lnt id=hl-12-76><a class=lnlinks href=#hl-12-76>76</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 환경 설정 및 구성 관리 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># 모든 환경 변수와 애플리케이션 설정을 중앙화하여 관리</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseSettings</span><span class=p>,</span> <span class=n>Field</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DatabaseConfig</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;데이터베이스 연결 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;postgresql://user:password@localhost/orderdb&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;DATABASE_URL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pool_pre_ping</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>pool_recycle</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>300</span>
</span></span><span class=line><span class=cl>    <span class=n>echo</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;DB_ECHO&#34;</span><span class=p>)</span>  <span class=c1># SQL 쿼리 로깅</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedisConfig</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Redis 캐시 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;redis://localhost:6379&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;REDIS_URL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decode_responses</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>socket_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=n>socket_connect_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=n>default_ttl</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>300</span>  <span class=c1># 기본 캐시 만료 시간 (초)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaConfig</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka 메시징 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;localhost:9092&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;KAFKA_SERVERS&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>topic_prefix</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;ecommerce&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;KAFKA_TOPIC_PREFIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_events_topic</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;order-events&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>retry_backoff_ms</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>    <span class=n>request_timeout_ms</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ExternalServiceConfig</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;외부 서비스 연결 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>user_service_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;http://user-service:8080&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;USER_SERVICE_URL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_service_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;http://product-service:8080&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;PRODUCT_SERVICE_URL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payment_service_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;http://payment-service:8080&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;PAYMENT_SERVICE_URL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>http_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span>  <span class=c1># HTTP 요청 타임아웃 (초)</span>
</span></span><span class=line><span class=cl>    <span class=n>retry_attempts</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>  <span class=c1># 재시도 횟수</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ApplicationConfig</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;애플리케이션 전역 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>app_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;Order Service&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>app_version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>environment</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;development&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;ENVIRONMENT&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_level</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;INFO&#34;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;LOG_LEVEL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>debug</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&#34;DEBUG&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># API 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>api_prefix</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;/api/v1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>docs_url</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;/docs&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>redoc_url</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;/redoc&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 보안 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>cors_origins</span><span class=p>:</span> <span class=nb>list</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span>  <span class=c1># 운영환경에서는 특정 도메인으로 제한</span>
</span></span><span class=line><span class=cl>    <span class=n>cors_methods</span><span class=p>:</span> <span class=nb>list</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>cors_headers</span><span class=p>:</span> <span class=nb>list</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Settings</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;통합 설정 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>database</span> <span class=o>=</span> <span class=n>DatabaseConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>RedisConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka</span> <span class=o>=</span> <span class=n>KafkaConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>external_services</span> <span class=o>=</span> <span class=n>ExternalServiceConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>app</span> <span class=o>=</span> <span class=n>ApplicationConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>is_production</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;운영 환경 여부 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>environment</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;production&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>is_development</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;개발 환경 여부 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>environment</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;development&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 설정 인스턴스</span>
</span></span><span class=line><span class=cl><span class=n>settings</span> <span class=o>=</span> <span class=n>Settings</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=utilspy>utils.py<a hidden class=anchor aria-hidden=true href=#utilspy>#</a></h5><p>공통 유틸리티 기능들을 제공하는 모듈. 구조화된 JSON 로깅, 메트릭 수집, 실행 시간 측정 데코레이터, 헬스 체크 관리 등의 기능을 포함한다. 특히 StructuredLogger 는 마이크로서비스 환경에서 로그 분석을 용이하게 하는 JSON 형태의 로그를 생성한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>  1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>  2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>  3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>  4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>  5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>  6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>  7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>  8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9>  9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10> 10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11> 11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12> 12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13> 13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14> 14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15> 15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16> 16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17> 17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18> 18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19> 19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20> 20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21> 21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22> 22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23> 23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24> 24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25> 25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26> 26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27> 27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28> 28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29> 29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30> 30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31> 31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32> 32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33> 33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34> 34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35> 35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36> 36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37> 37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38> 38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39> 39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40> 40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41> 41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42> 42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43> 43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44> 44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45> 45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46> 46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47> 47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48> 48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49> 49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50> 50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51> 51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52> 52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53> 53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54> 54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55> 55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56> 56</a>
</span><span class=lnt id=hl-13-57><a class=lnlinks href=#hl-13-57> 57</a>
</span><span class=lnt id=hl-13-58><a class=lnlinks href=#hl-13-58> 58</a>
</span><span class=lnt id=hl-13-59><a class=lnlinks href=#hl-13-59> 59</a>
</span><span class=lnt id=hl-13-60><a class=lnlinks href=#hl-13-60> 60</a>
</span><span class=lnt id=hl-13-61><a class=lnlinks href=#hl-13-61> 61</a>
</span><span class=lnt id=hl-13-62><a class=lnlinks href=#hl-13-62> 62</a>
</span><span class=lnt id=hl-13-63><a class=lnlinks href=#hl-13-63> 63</a>
</span><span class=lnt id=hl-13-64><a class=lnlinks href=#hl-13-64> 64</a>
</span><span class=lnt id=hl-13-65><a class=lnlinks href=#hl-13-65> 65</a>
</span><span class=lnt id=hl-13-66><a class=lnlinks href=#hl-13-66> 66</a>
</span><span class=lnt id=hl-13-67><a class=lnlinks href=#hl-13-67> 67</a>
</span><span class=lnt id=hl-13-68><a class=lnlinks href=#hl-13-68> 68</a>
</span><span class=lnt id=hl-13-69><a class=lnlinks href=#hl-13-69> 69</a>
</span><span class=lnt id=hl-13-70><a class=lnlinks href=#hl-13-70> 70</a>
</span><span class=lnt id=hl-13-71><a class=lnlinks href=#hl-13-71> 71</a>
</span><span class=lnt id=hl-13-72><a class=lnlinks href=#hl-13-72> 72</a>
</span><span class=lnt id=hl-13-73><a class=lnlinks href=#hl-13-73> 73</a>
</span><span class=lnt id=hl-13-74><a class=lnlinks href=#hl-13-74> 74</a>
</span><span class=lnt id=hl-13-75><a class=lnlinks href=#hl-13-75> 75</a>
</span><span class=lnt id=hl-13-76><a class=lnlinks href=#hl-13-76> 76</a>
</span><span class=lnt id=hl-13-77><a class=lnlinks href=#hl-13-77> 77</a>
</span><span class=lnt id=hl-13-78><a class=lnlinks href=#hl-13-78> 78</a>
</span><span class=lnt id=hl-13-79><a class=lnlinks href=#hl-13-79> 79</a>
</span><span class=lnt id=hl-13-80><a class=lnlinks href=#hl-13-80> 80</a>
</span><span class=lnt id=hl-13-81><a class=lnlinks href=#hl-13-81> 81</a>
</span><span class=lnt id=hl-13-82><a class=lnlinks href=#hl-13-82> 82</a>
</span><span class=lnt id=hl-13-83><a class=lnlinks href=#hl-13-83> 83</a>
</span><span class=lnt id=hl-13-84><a class=lnlinks href=#hl-13-84> 84</a>
</span><span class=lnt id=hl-13-85><a class=lnlinks href=#hl-13-85> 85</a>
</span><span class=lnt id=hl-13-86><a class=lnlinks href=#hl-13-86> 86</a>
</span><span class=lnt id=hl-13-87><a class=lnlinks href=#hl-13-87> 87</a>
</span><span class=lnt id=hl-13-88><a class=lnlinks href=#hl-13-88> 88</a>
</span><span class=lnt id=hl-13-89><a class=lnlinks href=#hl-13-89> 89</a>
</span><span class=lnt id=hl-13-90><a class=lnlinks href=#hl-13-90> 90</a>
</span><span class=lnt id=hl-13-91><a class=lnlinks href=#hl-13-91> 91</a>
</span><span class=lnt id=hl-13-92><a class=lnlinks href=#hl-13-92> 92</a>
</span><span class=lnt id=hl-13-93><a class=lnlinks href=#hl-13-93> 93</a>
</span><span class=lnt id=hl-13-94><a class=lnlinks href=#hl-13-94> 94</a>
</span><span class=lnt id=hl-13-95><a class=lnlinks href=#hl-13-95> 95</a>
</span><span class=lnt id=hl-13-96><a class=lnlinks href=#hl-13-96> 96</a>
</span><span class=lnt id=hl-13-97><a class=lnlinks href=#hl-13-97> 97</a>
</span><span class=lnt id=hl-13-98><a class=lnlinks href=#hl-13-98> 98</a>
</span><span class=lnt id=hl-13-99><a class=lnlinks href=#hl-13-99> 99</a>
</span><span class=lnt id=hl-13-100><a class=lnlinks href=#hl-13-100>100</a>
</span><span class=lnt id=hl-13-101><a class=lnlinks href=#hl-13-101>101</a>
</span><span class=lnt id=hl-13-102><a class=lnlinks href=#hl-13-102>102</a>
</span><span class=lnt id=hl-13-103><a class=lnlinks href=#hl-13-103>103</a>
</span><span class=lnt id=hl-13-104><a class=lnlinks href=#hl-13-104>104</a>
</span><span class=lnt id=hl-13-105><a class=lnlinks href=#hl-13-105>105</a>
</span><span class=lnt id=hl-13-106><a class=lnlinks href=#hl-13-106>106</a>
</span><span class=lnt id=hl-13-107><a class=lnlinks href=#hl-13-107>107</a>
</span><span class=lnt id=hl-13-108><a class=lnlinks href=#hl-13-108>108</a>
</span><span class=lnt id=hl-13-109><a class=lnlinks href=#hl-13-109>109</a>
</span><span class=lnt id=hl-13-110><a class=lnlinks href=#hl-13-110>110</a>
</span><span class=lnt id=hl-13-111><a class=lnlinks href=#hl-13-111>111</a>
</span><span class=lnt id=hl-13-112><a class=lnlinks href=#hl-13-112>112</a>
</span><span class=lnt id=hl-13-113><a class=lnlinks href=#hl-13-113>113</a>
</span><span class=lnt id=hl-13-114><a class=lnlinks href=#hl-13-114>114</a>
</span><span class=lnt id=hl-13-115><a class=lnlinks href=#hl-13-115>115</a>
</span><span class=lnt id=hl-13-116><a class=lnlinks href=#hl-13-116>116</a>
</span><span class=lnt id=hl-13-117><a class=lnlinks href=#hl-13-117>117</a>
</span><span class=lnt id=hl-13-118><a class=lnlinks href=#hl-13-118>118</a>
</span><span class=lnt id=hl-13-119><a class=lnlinks href=#hl-13-119>119</a>
</span><span class=lnt id=hl-13-120><a class=lnlinks href=#hl-13-120>120</a>
</span><span class=lnt id=hl-13-121><a class=lnlinks href=#hl-13-121>121</a>
</span><span class=lnt id=hl-13-122><a class=lnlinks href=#hl-13-122>122</a>
</span><span class=lnt id=hl-13-123><a class=lnlinks href=#hl-13-123>123</a>
</span><span class=lnt id=hl-13-124><a class=lnlinks href=#hl-13-124>124</a>
</span><span class=lnt id=hl-13-125><a class=lnlinks href=#hl-13-125>125</a>
</span><span class=lnt id=hl-13-126><a class=lnlinks href=#hl-13-126>126</a>
</span><span class=lnt id=hl-13-127><a class=lnlinks href=#hl-13-127>127</a>
</span><span class=lnt id=hl-13-128><a class=lnlinks href=#hl-13-128>128</a>
</span><span class=lnt id=hl-13-129><a class=lnlinks href=#hl-13-129>129</a>
</span><span class=lnt id=hl-13-130><a class=lnlinks href=#hl-13-130>130</a>
</span><span class=lnt id=hl-13-131><a class=lnlinks href=#hl-13-131>131</a>
</span><span class=lnt id=hl-13-132><a class=lnlinks href=#hl-13-132>132</a>
</span><span class=lnt id=hl-13-133><a class=lnlinks href=#hl-13-133>133</a>
</span><span class=lnt id=hl-13-134><a class=lnlinks href=#hl-13-134>134</a>
</span><span class=lnt id=hl-13-135><a class=lnlinks href=#hl-13-135>135</a>
</span><span class=lnt id=hl-13-136><a class=lnlinks href=#hl-13-136>136</a>
</span><span class=lnt id=hl-13-137><a class=lnlinks href=#hl-13-137>137</a>
</span><span class=lnt id=hl-13-138><a class=lnlinks href=#hl-13-138>138</a>
</span><span class=lnt id=hl-13-139><a class=lnlinks href=#hl-13-139>139</a>
</span><span class=lnt id=hl-13-140><a class=lnlinks href=#hl-13-140>140</a>
</span><span class=lnt id=hl-13-141><a class=lnlinks href=#hl-13-141>141</a>
</span><span class=lnt id=hl-13-142><a class=lnlinks href=#hl-13-142>142</a>
</span><span class=lnt id=hl-13-143><a class=lnlinks href=#hl-13-143>143</a>
</span><span class=lnt id=hl-13-144><a class=lnlinks href=#hl-13-144>144</a>
</span><span class=lnt id=hl-13-145><a class=lnlinks href=#hl-13-145>145</a>
</span><span class=lnt id=hl-13-146><a class=lnlinks href=#hl-13-146>146</a>
</span><span class=lnt id=hl-13-147><a class=lnlinks href=#hl-13-147>147</a>
</span><span class=lnt id=hl-13-148><a class=lnlinks href=#hl-13-148>148</a>
</span><span class=lnt id=hl-13-149><a class=lnlinks href=#hl-13-149>149</a>
</span><span class=lnt id=hl-13-150><a class=lnlinks href=#hl-13-150>150</a>
</span><span class=lnt id=hl-13-151><a class=lnlinks href=#hl-13-151>151</a>
</span><span class=lnt id=hl-13-152><a class=lnlinks href=#hl-13-152>152</a>
</span><span class=lnt id=hl-13-153><a class=lnlinks href=#hl-13-153>153</a>
</span><span class=lnt id=hl-13-154><a class=lnlinks href=#hl-13-154>154</a>
</span><span class=lnt id=hl-13-155><a class=lnlinks href=#hl-13-155>155</a>
</span><span class=lnt id=hl-13-156><a class=lnlinks href=#hl-13-156>156</a>
</span><span class=lnt id=hl-13-157><a class=lnlinks href=#hl-13-157>157</a>
</span><span class=lnt id=hl-13-158><a class=lnlinks href=#hl-13-158>158</a>
</span><span class=lnt id=hl-13-159><a class=lnlinks href=#hl-13-159>159</a>
</span><span class=lnt id=hl-13-160><a class=lnlinks href=#hl-13-160>160</a>
</span><span class=lnt id=hl-13-161><a class=lnlinks href=#hl-13-161>161</a>
</span><span class=lnt id=hl-13-162><a class=lnlinks href=#hl-13-162>162</a>
</span><span class=lnt id=hl-13-163><a class=lnlinks href=#hl-13-163>163</a>
</span><span class=lnt id=hl-13-164><a class=lnlinks href=#hl-13-164>164</a>
</span><span class=lnt id=hl-13-165><a class=lnlinks href=#hl-13-165>165</a>
</span><span class=lnt id=hl-13-166><a class=lnlinks href=#hl-13-166>166</a>
</span><span class=lnt id=hl-13-167><a class=lnlinks href=#hl-13-167>167</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 공통 유틸리티 및 로깅 설정 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># 구조화된 로그, 헬스 체크, 메트릭 수집 등 공통 기능 제공</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>wraps</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>StructuredLogger</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;구조화된 JSON 로그 생성기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>service_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;order-service&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>service_name</span> <span class=o>=</span> <span class=n>service_name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=n>service_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 로그 핸들러 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>StreamHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>formatter</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=nb>getattr</span><span class=p>(</span><span class=n>logging</span><span class=p>,</span> <span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>log_level</span><span class=o>.</span><span class=n>upper</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_format_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;로그 메시지를 JSON 형태로 포맷팅&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>log_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;level&#34;</span><span class=p>:</span> <span class=n>level</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;service&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>service_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;environment&#34;</span><span class=p>:</span> <span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>environment</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추가 컨텍스트 정보 포함</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>kwargs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>log_data</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>log_data</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;정보 레벨 로그&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_format_log</span><span class=p>(</span><span class=s2>&#34;INFO&#34;</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>error</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;에러 레벨 로그&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_format_log</span><span class=p>(</span><span class=s2>&#34;ERROR&#34;</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>warning</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;경고 레벨 로그&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_format_log</span><span class=p>(</span><span class=s2>&#34;WARNING&#34;</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>debug</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;디버그 레벨 로그&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_format_log</span><span class=p>(</span><span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 로거 인스턴스</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>StructuredLogger</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MetricsCollector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;애플리케이션 메트릭 수집기 (Prometheus 연동)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>increment_counter</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metric_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>labels</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;카운터 메트릭 증가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>metric_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>labels</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>if</span> <span class=n>labels</span> <span class=k>else</span> <span class=n>metric_name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_histogram</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metric_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>labels</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;히스토그램 메트릭 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>metric_name</span><span class=si>}</span><span class=s2>_histogram_</span><span class=si>{</span><span class=n>labels</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>if</span> <span class=n>labels</span> <span class=k>else</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>metric_name</span><span class=si>}</span><span class=s2>_histogram&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;수집된 메트릭 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;uptime_seconds&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;metrics&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 메트릭 수집기</span>
</span></span><span class=line><span class=cl><span class=n>metrics</span> <span class=o>=</span> <span class=n>MetricsCollector</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log_execution_time</span><span class=p>(</span><span class=n>operation_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;함수 실행 시간을 로그로 기록하는 데코레이터&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>execution_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2> 실행 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>execution_time</span><span class=o>=</span><span class=n>execution_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>function</span><span class=o>=</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 메트릭 기록</span>
</span></span><span class=line><span class=cl>                <span class=n>metrics</span><span class=o>.</span><span class=n>record_histogram</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2>_duration&#34;</span><span class=p>,</span> <span class=n>execution_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2>_total&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>execution_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2> 실행 실패&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>execution_time</span><span class=o>=</span><span class=n>execution_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>function</span><span class=o>=</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 에러 메트릭 기록</span>
</span></span><span class=line><span class=cl>                <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2>_errors&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>wrapper</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decorator</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HealthChecker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;헬스 체크 관리 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>checks</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>check_func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;헬스 체크 함수 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>checks</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>check_func</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>run_checks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;모든 헬스 체크 실행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;healthy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;checks&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>overall_status</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>check_func</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>checks</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>check_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>check_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=s2>&#34;checks&#34;</span><span class=p>][</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;healthy&#34;</span> <span class=k>if</span> <span class=n>check_result</span> <span class=k>else</span> <span class=s2>&#34;unhealthy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;details&#34;</span><span class=p>:</span> <span class=n>check_result</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>check_result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>overall_status</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=s2>&#34;checks&#34;</span><span class=p>][</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;unhealthy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>overall_status</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=s2>&#34;status&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;healthy&#34;</span> <span class=k>if</span> <span class=n>overall_status</span> <span class=k>else</span> <span class=s2>&#34;unhealthy&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 헬스 체커</span>
</span></span><span class=line><span class=cl><span class=n>health_checker</span> <span class=o>=</span> <span class=n>HealthChecker</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=데이터베이스-레이어-database-layer>데이터베이스 레이어 (Database Layer)<a hidden class=anchor aria-hidden=true href=#데이터베이스-레이어-database-layer>#</a></h4><h5 id=databasepy>database.py<a hidden class=anchor aria-hidden=true href=#databasepy>#</a></h5><p>SQLAlchemy 를 사용한 데이터베이스 연결 및 세션 관리를 담당. 연결 풀 관리, 트랜잭션 처리, 컨텍스트 매니저를 통한 안전한 세션 관리 기능을 제공한다. 데이터베이스 이벤트 리스너를 통해 연결 최적화와 쿼리 로깅을 수행한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>  1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>  2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>  3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>  4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>  5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>  6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>  7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>  8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>  9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10> 10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11> 11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12> 12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13> 13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14> 14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15> 15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16> 16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17> 17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18> 18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19> 19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20> 20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21> 21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22> 22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23> 23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24> 24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25> 25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26> 26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27> 27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28> 28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29> 29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30> 30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31> 31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32> 32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33> 33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34> 34</a>
</span><span class=lnt id=hl-14-35><a class=lnlinks href=#hl-14-35> 35</a>
</span><span class=lnt id=hl-14-36><a class=lnlinks href=#hl-14-36> 36</a>
</span><span class=lnt id=hl-14-37><a class=lnlinks href=#hl-14-37> 37</a>
</span><span class=lnt id=hl-14-38><a class=lnlinks href=#hl-14-38> 38</a>
</span><span class=lnt id=hl-14-39><a class=lnlinks href=#hl-14-39> 39</a>
</span><span class=lnt id=hl-14-40><a class=lnlinks href=#hl-14-40> 40</a>
</span><span class=lnt id=hl-14-41><a class=lnlinks href=#hl-14-41> 41</a>
</span><span class=lnt id=hl-14-42><a class=lnlinks href=#hl-14-42> 42</a>
</span><span class=lnt id=hl-14-43><a class=lnlinks href=#hl-14-43> 43</a>
</span><span class=lnt id=hl-14-44><a class=lnlinks href=#hl-14-44> 44</a>
</span><span class=lnt id=hl-14-45><a class=lnlinks href=#hl-14-45> 45</a>
</span><span class=lnt id=hl-14-46><a class=lnlinks href=#hl-14-46> 46</a>
</span><span class=lnt id=hl-14-47><a class=lnlinks href=#hl-14-47> 47</a>
</span><span class=lnt id=hl-14-48><a class=lnlinks href=#hl-14-48> 48</a>
</span><span class=lnt id=hl-14-49><a class=lnlinks href=#hl-14-49> 49</a>
</span><span class=lnt id=hl-14-50><a class=lnlinks href=#hl-14-50> 50</a>
</span><span class=lnt id=hl-14-51><a class=lnlinks href=#hl-14-51> 51</a>
</span><span class=lnt id=hl-14-52><a class=lnlinks href=#hl-14-52> 52</a>
</span><span class=lnt id=hl-14-53><a class=lnlinks href=#hl-14-53> 53</a>
</span><span class=lnt id=hl-14-54><a class=lnlinks href=#hl-14-54> 54</a>
</span><span class=lnt id=hl-14-55><a class=lnlinks href=#hl-14-55> 55</a>
</span><span class=lnt id=hl-14-56><a class=lnlinks href=#hl-14-56> 56</a>
</span><span class=lnt id=hl-14-57><a class=lnlinks href=#hl-14-57> 57</a>
</span><span class=lnt id=hl-14-58><a class=lnlinks href=#hl-14-58> 58</a>
</span><span class=lnt id=hl-14-59><a class=lnlinks href=#hl-14-59> 59</a>
</span><span class=lnt id=hl-14-60><a class=lnlinks href=#hl-14-60> 60</a>
</span><span class=lnt id=hl-14-61><a class=lnlinks href=#hl-14-61> 61</a>
</span><span class=lnt id=hl-14-62><a class=lnlinks href=#hl-14-62> 62</a>
</span><span class=lnt id=hl-14-63><a class=lnlinks href=#hl-14-63> 63</a>
</span><span class=lnt id=hl-14-64><a class=lnlinks href=#hl-14-64> 64</a>
</span><span class=lnt id=hl-14-65><a class=lnlinks href=#hl-14-65> 65</a>
</span><span class=lnt id=hl-14-66><a class=lnlinks href=#hl-14-66> 66</a>
</span><span class=lnt id=hl-14-67><a class=lnlinks href=#hl-14-67> 67</a>
</span><span class=lnt id=hl-14-68><a class=lnlinks href=#hl-14-68> 68</a>
</span><span class=lnt id=hl-14-69><a class=lnlinks href=#hl-14-69> 69</a>
</span><span class=lnt id=hl-14-70><a class=lnlinks href=#hl-14-70> 70</a>
</span><span class=lnt id=hl-14-71><a class=lnlinks href=#hl-14-71> 71</a>
</span><span class=lnt id=hl-14-72><a class=lnlinks href=#hl-14-72> 72</a>
</span><span class=lnt id=hl-14-73><a class=lnlinks href=#hl-14-73> 73</a>
</span><span class=lnt id=hl-14-74><a class=lnlinks href=#hl-14-74> 74</a>
</span><span class=lnt id=hl-14-75><a class=lnlinks href=#hl-14-75> 75</a>
</span><span class=lnt id=hl-14-76><a class=lnlinks href=#hl-14-76> 76</a>
</span><span class=lnt id=hl-14-77><a class=lnlinks href=#hl-14-77> 77</a>
</span><span class=lnt id=hl-14-78><a class=lnlinks href=#hl-14-78> 78</a>
</span><span class=lnt id=hl-14-79><a class=lnlinks href=#hl-14-79> 79</a>
</span><span class=lnt id=hl-14-80><a class=lnlinks href=#hl-14-80> 80</a>
</span><span class=lnt id=hl-14-81><a class=lnlinks href=#hl-14-81> 81</a>
</span><span class=lnt id=hl-14-82><a class=lnlinks href=#hl-14-82> 82</a>
</span><span class=lnt id=hl-14-83><a class=lnlinks href=#hl-14-83> 83</a>
</span><span class=lnt id=hl-14-84><a class=lnlinks href=#hl-14-84> 84</a>
</span><span class=lnt id=hl-14-85><a class=lnlinks href=#hl-14-85> 85</a>
</span><span class=lnt id=hl-14-86><a class=lnlinks href=#hl-14-86> 86</a>
</span><span class=lnt id=hl-14-87><a class=lnlinks href=#hl-14-87> 87</a>
</span><span class=lnt id=hl-14-88><a class=lnlinks href=#hl-14-88> 88</a>
</span><span class=lnt id=hl-14-89><a class=lnlinks href=#hl-14-89> 89</a>
</span><span class=lnt id=hl-14-90><a class=lnlinks href=#hl-14-90> 90</a>
</span><span class=lnt id=hl-14-91><a class=lnlinks href=#hl-14-91> 91</a>
</span><span class=lnt id=hl-14-92><a class=lnlinks href=#hl-14-92> 92</a>
</span><span class=lnt id=hl-14-93><a class=lnlinks href=#hl-14-93> 93</a>
</span><span class=lnt id=hl-14-94><a class=lnlinks href=#hl-14-94> 94</a>
</span><span class=lnt id=hl-14-95><a class=lnlinks href=#hl-14-95> 95</a>
</span><span class=lnt id=hl-14-96><a class=lnlinks href=#hl-14-96> 96</a>
</span><span class=lnt id=hl-14-97><a class=lnlinks href=#hl-14-97> 97</a>
</span><span class=lnt id=hl-14-98><a class=lnlinks href=#hl-14-98> 98</a>
</span><span class=lnt id=hl-14-99><a class=lnlinks href=#hl-14-99> 99</a>
</span><span class=lnt id=hl-14-100><a class=lnlinks href=#hl-14-100>100</a>
</span><span class=lnt id=hl-14-101><a class=lnlinks href=#hl-14-101>101</a>
</span><span class=lnt id=hl-14-102><a class=lnlinks href=#hl-14-102>102</a>
</span><span class=lnt id=hl-14-103><a class=lnlinks href=#hl-14-103>103</a>
</span><span class=lnt id=hl-14-104><a class=lnlinks href=#hl-14-104>104</a>
</span><span class=lnt id=hl-14-105><a class=lnlinks href=#hl-14-105>105</a>
</span><span class=lnt id=hl-14-106><a class=lnlinks href=#hl-14-106>106</a>
</span><span class=lnt id=hl-14-107><a class=lnlinks href=#hl-14-107>107</a>
</span><span class=lnt id=hl-14-108><a class=lnlinks href=#hl-14-108>108</a>
</span><span class=lnt id=hl-14-109><a class=lnlinks href=#hl-14-109>109</a>
</span><span class=lnt id=hl-14-110><a class=lnlinks href=#hl-14-110>110</a>
</span><span class=lnt id=hl-14-111><a class=lnlinks href=#hl-14-111>111</a>
</span><span class=lnt id=hl-14-112><a class=lnlinks href=#hl-14-112>112</a>
</span><span class=lnt id=hl-14-113><a class=lnlinks href=#hl-14-113>113</a>
</span><span class=lnt id=hl-14-114><a class=lnlinks href=#hl-14-114>114</a>
</span><span class=lnt id=hl-14-115><a class=lnlinks href=#hl-14-115>115</a>
</span><span class=lnt id=hl-14-116><a class=lnlinks href=#hl-14-116>116</a>
</span><span class=lnt id=hl-14-117><a class=lnlinks href=#hl-14-117>117</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 데이터베이스 연결 및 세션 관리 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># SQLAlchemy ORM 설정과 데이터베이스 연결 풀 관리</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span><span class=p>,</span> <span class=n>event</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.ext.declarative</span> <span class=kn>import</span> <span class=n>declarative_base</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span><span class=p>,</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.pool</span> <span class=kn>import</span> <span class=n>QueuePool</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>utils</span> <span class=kn>import</span> <span class=n>logger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DatabaseManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;데이터베이스 연결 및 세션 관리 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>engine</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>SessionLocal</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Base</span> <span class=o>=</span> <span class=n>declarative_base</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_engine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_initialize_engine</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;SQLAlchemy 엔진 초기화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>settings</span><span class=o>.</span><span class=n>database</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>poolclass</span><span class=o>=</span><span class=n>QueuePool</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_size</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>              <span class=c1># 기본 연결 풀 크기</span>
</span></span><span class=line><span class=cl>            <span class=n>max_overflow</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>           <span class=c1># 최대 오버플로우 연결 수</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_pre_ping</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>database</span><span class=o>.</span><span class=n>pool_pre_ping</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_recycle</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>database</span><span class=o>.</span><span class=n>pool_recycle</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>database</span><span class=o>.</span><span class=n>echo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>           <span class=c1># 연결 대기 타임아웃</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_reset_on_return</span><span class=o>=</span><span class=s1>&#39;commit&#39;</span>  <span class=c1># 연결 반환 시 커밋</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 데이터베이스 연결 이벤트 리스너 등록</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_register_event_listeners</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 세션 팩토리 생성</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>SessionLocal</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoflush</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>bind</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>expire_on_commit</span><span class=o>=</span><span class=kc>False</span>     <span class=c1># 커밋 후 객체 만료 방지</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;데이터베이스 엔진 초기화 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_register_event_listeners</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터베이스 이벤트 리스너 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nd>@event.listens_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>,</span> <span class=s2>&#34;connect&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>set_sqlite_pragma</span><span class=p>(</span><span class=n>dbapi_connection</span><span class=p>,</span> <span class=n>connection_record</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;연결 시 데이터베이스별 설정 적용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;sqlite&#34;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>dbapi_connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span> <span class=o>=</span> <span class=n>dbapi_connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;PRAGMA foreign_keys=ON&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nd>@event.listens_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>,</span> <span class=s2>&#34;before_cursor_execute&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>receive_before_cursor_execute</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>cursor</span><span class=p>,</span> <span class=n>statement</span><span class=p>,</span> <span class=n>parameters</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>executemany</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;쿼리 실행 전 로깅&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>settings</span><span class=o>.</span><span class=n>database</span><span class=o>.</span><span class=n>echo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&#34;SQL 쿼리 실행&#34;</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=n>statement</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>parameters</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_tables</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터베이스 테이블 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>Base</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;데이터베이스 테이블 생성 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;데이터베이스 테이블 생성 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_session</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터베이스 세션 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>SessionLocal</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_session_context</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;컨텍스트 매니저를 사용한 세션 관리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>session</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;데이터베이스 트랜잭션 롤백&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>health_check</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터베이스 연결 상태 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_session_context</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;데이터베이스 헬스 체크 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터베이스 연결 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=o>.</span><span class=n>dispose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;데이터베이스 연결 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 데이터베이스 매니저 인스턴스</span>
</span></span><span class=line><span class=cl><span class=n>db_manager</span> <span class=o>=</span> <span class=n>DatabaseManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 의존성 주입용 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_db</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;FastAPI 의존성 주입용 데이터베이스 세션 생성 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>get_session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>session</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=modelspy>models.py<a hidden class=anchor aria-hidden=true href=#modelspy>#</a></h5><p>데이터베이스 모델 (SQLAlchemy ORM) 과 API 스키마 (Pydantic) 를 정의한다. 주문 상태 열거형, 주문 및 주문 아이템 모델, 요청/응답 스키마들을 포함한다. 데이터 검증, 직렬화/역직렬화, 인덱스 최적화 등의 기능을 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>  1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>  2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>  3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>  4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>  5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>  6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>  7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>  8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>  9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10> 10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11> 11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12> 12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13> 13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14> 14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15> 15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16> 16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17> 17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18> 18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19> 19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20> 20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21> 21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22> 22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23> 23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24> 24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25> 25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26> 26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27> 27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28> 28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29> 29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30> 30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31> 31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32> 32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33> 33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34> 34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35> 35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36> 36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37> 37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38> 38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39> 39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40> 40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41> 41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42> 42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43> 43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44> 44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45> 45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46> 46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47> 47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48> 48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49> 49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50> 50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51> 51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52> 52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53> 53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54> 54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55> 55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56> 56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57> 57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58> 58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59> 59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60> 60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61> 61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62> 62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63> 63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64> 64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65> 65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66> 66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67> 67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68> 68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69> 69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70> 70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71> 71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72> 72</a>
</span><span class=lnt id=hl-15-73><a class=lnlinks href=#hl-15-73> 73</a>
</span><span class=lnt id=hl-15-74><a class=lnlinks href=#hl-15-74> 74</a>
</span><span class=lnt id=hl-15-75><a class=lnlinks href=#hl-15-75> 75</a>
</span><span class=lnt id=hl-15-76><a class=lnlinks href=#hl-15-76> 76</a>
</span><span class=lnt id=hl-15-77><a class=lnlinks href=#hl-15-77> 77</a>
</span><span class=lnt id=hl-15-78><a class=lnlinks href=#hl-15-78> 78</a>
</span><span class=lnt id=hl-15-79><a class=lnlinks href=#hl-15-79> 79</a>
</span><span class=lnt id=hl-15-80><a class=lnlinks href=#hl-15-80> 80</a>
</span><span class=lnt id=hl-15-81><a class=lnlinks href=#hl-15-81> 81</a>
</span><span class=lnt id=hl-15-82><a class=lnlinks href=#hl-15-82> 82</a>
</span><span class=lnt id=hl-15-83><a class=lnlinks href=#hl-15-83> 83</a>
</span><span class=lnt id=hl-15-84><a class=lnlinks href=#hl-15-84> 84</a>
</span><span class=lnt id=hl-15-85><a class=lnlinks href=#hl-15-85> 85</a>
</span><span class=lnt id=hl-15-86><a class=lnlinks href=#hl-15-86> 86</a>
</span><span class=lnt id=hl-15-87><a class=lnlinks href=#hl-15-87> 87</a>
</span><span class=lnt id=hl-15-88><a class=lnlinks href=#hl-15-88> 88</a>
</span><span class=lnt id=hl-15-89><a class=lnlinks href=#hl-15-89> 89</a>
</span><span class=lnt id=hl-15-90><a class=lnlinks href=#hl-15-90> 90</a>
</span><span class=lnt id=hl-15-91><a class=lnlinks href=#hl-15-91> 91</a>
</span><span class=lnt id=hl-15-92><a class=lnlinks href=#hl-15-92> 92</a>
</span><span class=lnt id=hl-15-93><a class=lnlinks href=#hl-15-93> 93</a>
</span><span class=lnt id=hl-15-94><a class=lnlinks href=#hl-15-94> 94</a>
</span><span class=lnt id=hl-15-95><a class=lnlinks href=#hl-15-95> 95</a>
</span><span class=lnt id=hl-15-96><a class=lnlinks href=#hl-15-96> 96</a>
</span><span class=lnt id=hl-15-97><a class=lnlinks href=#hl-15-97> 97</a>
</span><span class=lnt id=hl-15-98><a class=lnlinks href=#hl-15-98> 98</a>
</span><span class=lnt id=hl-15-99><a class=lnlinks href=#hl-15-99> 99</a>
</span><span class=lnt id=hl-15-100><a class=lnlinks href=#hl-15-100>100</a>
</span><span class=lnt id=hl-15-101><a class=lnlinks href=#hl-15-101>101</a>
</span><span class=lnt id=hl-15-102><a class=lnlinks href=#hl-15-102>102</a>
</span><span class=lnt id=hl-15-103><a class=lnlinks href=#hl-15-103>103</a>
</span><span class=lnt id=hl-15-104><a class=lnlinks href=#hl-15-104>104</a>
</span><span class=lnt id=hl-15-105><a class=lnlinks href=#hl-15-105>105</a>
</span><span class=lnt id=hl-15-106><a class=lnlinks href=#hl-15-106>106</a>
</span><span class=lnt id=hl-15-107><a class=lnlinks href=#hl-15-107>107</a>
</span><span class=lnt id=hl-15-108><a class=lnlinks href=#hl-15-108>108</a>
</span><span class=lnt id=hl-15-109><a class=lnlinks href=#hl-15-109>109</a>
</span><span class=lnt id=hl-15-110><a class=lnlinks href=#hl-15-110>110</a>
</span><span class=lnt id=hl-15-111><a class=lnlinks href=#hl-15-111>111</a>
</span><span class=lnt id=hl-15-112><a class=lnlinks href=#hl-15-112>112</a>
</span><span class=lnt id=hl-15-113><a class=lnlinks href=#hl-15-113>113</a>
</span><span class=lnt id=hl-15-114><a class=lnlinks href=#hl-15-114>114</a>
</span><span class=lnt id=hl-15-115><a class=lnlinks href=#hl-15-115>115</a>
</span><span class=lnt id=hl-15-116><a class=lnlinks href=#hl-15-116>116</a>
</span><span class=lnt id=hl-15-117><a class=lnlinks href=#hl-15-117>117</a>
</span><span class=lnt id=hl-15-118><a class=lnlinks href=#hl-15-118>118</a>
</span><span class=lnt id=hl-15-119><a class=lnlinks href=#hl-15-119>119</a>
</span><span class=lnt id=hl-15-120><a class=lnlinks href=#hl-15-120>120</a>
</span><span class=lnt id=hl-15-121><a class=lnlinks href=#hl-15-121>121</a>
</span><span class=lnt id=hl-15-122><a class=lnlinks href=#hl-15-122>122</a>
</span><span class=lnt id=hl-15-123><a class=lnlinks href=#hl-15-123>123</a>
</span><span class=lnt id=hl-15-124><a class=lnlinks href=#hl-15-124>124</a>
</span><span class=lnt id=hl-15-125><a class=lnlinks href=#hl-15-125>125</a>
</span><span class=lnt id=hl-15-126><a class=lnlinks href=#hl-15-126>126</a>
</span><span class=lnt id=hl-15-127><a class=lnlinks href=#hl-15-127>127</a>
</span><span class=lnt id=hl-15-128><a class=lnlinks href=#hl-15-128>128</a>
</span><span class=lnt id=hl-15-129><a class=lnlinks href=#hl-15-129>129</a>
</span><span class=lnt id=hl-15-130><a class=lnlinks href=#hl-15-130>130</a>
</span><span class=lnt id=hl-15-131><a class=lnlinks href=#hl-15-131>131</a>
</span><span class=lnt id=hl-15-132><a class=lnlinks href=#hl-15-132>132</a>
</span><span class=lnt id=hl-15-133><a class=lnlinks href=#hl-15-133>133</a>
</span><span class=lnt id=hl-15-134><a class=lnlinks href=#hl-15-134>134</a>
</span><span class=lnt id=hl-15-135><a class=lnlinks href=#hl-15-135>135</a>
</span><span class=lnt id=hl-15-136><a class=lnlinks href=#hl-15-136>136</a>
</span><span class=lnt id=hl-15-137><a class=lnlinks href=#hl-15-137>137</a>
</span><span class=lnt id=hl-15-138><a class=lnlinks href=#hl-15-138>138</a>
</span><span class=lnt id=hl-15-139><a class=lnlinks href=#hl-15-139>139</a>
</span><span class=lnt id=hl-15-140><a class=lnlinks href=#hl-15-140>140</a>
</span><span class=lnt id=hl-15-141><a class=lnlinks href=#hl-15-141>141</a>
</span><span class=lnt id=hl-15-142><a class=lnlinks href=#hl-15-142>142</a>
</span><span class=lnt id=hl-15-143><a class=lnlinks href=#hl-15-143>143</a>
</span><span class=lnt id=hl-15-144><a class=lnlinks href=#hl-15-144>144</a>
</span><span class=lnt id=hl-15-145><a class=lnlinks href=#hl-15-145>145</a>
</span><span class=lnt id=hl-15-146><a class=lnlinks href=#hl-15-146>146</a>
</span><span class=lnt id=hl-15-147><a class=lnlinks href=#hl-15-147>147</a>
</span><span class=lnt id=hl-15-148><a class=lnlinks href=#hl-15-148>148</a>
</span><span class=lnt id=hl-15-149><a class=lnlinks href=#hl-15-149>149</a>
</span><span class=lnt id=hl-15-150><a class=lnlinks href=#hl-15-150>150</a>
</span><span class=lnt id=hl-15-151><a class=lnlinks href=#hl-15-151>151</a>
</span><span class=lnt id=hl-15-152><a class=lnlinks href=#hl-15-152>152</a>
</span><span class=lnt id=hl-15-153><a class=lnlinks href=#hl-15-153>153</a>
</span><span class=lnt id=hl-15-154><a class=lnlinks href=#hl-15-154>154</a>
</span><span class=lnt id=hl-15-155><a class=lnlinks href=#hl-15-155>155</a>
</span><span class=lnt id=hl-15-156><a class=lnlinks href=#hl-15-156>156</a>
</span><span class=lnt id=hl-15-157><a class=lnlinks href=#hl-15-157>157</a>
</span><span class=lnt id=hl-15-158><a class=lnlinks href=#hl-15-158>158</a>
</span><span class=lnt id=hl-15-159><a class=lnlinks href=#hl-15-159>159</a>
</span><span class=lnt id=hl-15-160><a class=lnlinks href=#hl-15-160>160</a>
</span><span class=lnt id=hl-15-161><a class=lnlinks href=#hl-15-161>161</a>
</span><span class=lnt id=hl-15-162><a class=lnlinks href=#hl-15-162>162</a>
</span><span class=lnt id=hl-15-163><a class=lnlinks href=#hl-15-163>163</a>
</span><span class=lnt id=hl-15-164><a class=lnlinks href=#hl-15-164>164</a>
</span><span class=lnt id=hl-15-165><a class=lnlinks href=#hl-15-165>165</a>
</span><span class=lnt id=hl-15-166><a class=lnlinks href=#hl-15-166>166</a>
</span><span class=lnt id=hl-15-167><a class=lnlinks href=#hl-15-167>167</a>
</span><span class=lnt id=hl-15-168><a class=lnlinks href=#hl-15-168>168</a>
</span><span class=lnt id=hl-15-169><a class=lnlinks href=#hl-15-169>169</a>
</span><span class=lnt id=hl-15-170><a class=lnlinks href=#hl-15-170>170</a>
</span><span class=lnt id=hl-15-171><a class=lnlinks href=#hl-15-171>171</a>
</span><span class=lnt id=hl-15-172><a class=lnlinks href=#hl-15-172>172</a>
</span><span class=lnt id=hl-15-173><a class=lnlinks href=#hl-15-173>173</a>
</span><span class=lnt id=hl-15-174><a class=lnlinks href=#hl-15-174>174</a>
</span><span class=lnt id=hl-15-175><a class=lnlinks href=#hl-15-175>175</a>
</span><span class=lnt id=hl-15-176><a class=lnlinks href=#hl-15-176>176</a>
</span><span class=lnt id=hl-15-177><a class=lnlinks href=#hl-15-177>177</a>
</span><span class=lnt id=hl-15-178><a class=lnlinks href=#hl-15-178>178</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 데이터베이스 모델 및 API 스키마 정의 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># SQLAlchemy ORM 모델과 Pydantic 스키마를 분리하여 관리</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>Column</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>String</span><span class=p>,</span> <span class=n>Float</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>,</span> <span class=n>Enum</span><span class=p>,</span> <span class=n>Index</span><span class=p>,</span> <span class=n>ForeignKey</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>relationship</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>Field</span><span class=p>,</span> <span class=n>validator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>database</span> <span class=kn>import</span> <span class=n>db_manager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SQLAlchemy 베이스 클래스</span>
</span></span><span class=line><span class=cl><span class=n>Base</span> <span class=o>=</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>Base</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 상태 열거형</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderStatus</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>enum</span><span class=o>.</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 상태 정의&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>PENDING</span> <span class=o>=</span> <span class=s2>&#34;pending&#34;</span>           <span class=c1># 주문 대기</span>
</span></span><span class=line><span class=cl>    <span class=n>CONFIRMED</span> <span class=o>=</span> <span class=s2>&#34;confirmed&#34;</span>       <span class=c1># 주문 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>PAID</span> <span class=o>=</span> <span class=s2>&#34;paid&#34;</span>                <span class=c1># 결제 완료</span>
</span></span><span class=line><span class=cl>    <span class=n>PROCESSING</span> <span class=o>=</span> <span class=s2>&#34;processing&#34;</span>     <span class=c1># 주문 처리 중</span>
</span></span><span class=line><span class=cl>    <span class=n>SHIPPED</span> <span class=o>=</span> <span class=s2>&#34;shipped&#34;</span>          <span class=c1># 배송 중</span>
</span></span><span class=line><span class=cl>    <span class=n>DELIVERED</span> <span class=o>=</span> <span class=s2>&#34;delivered&#34;</span>      <span class=c1># 배송 완료</span>
</span></span><span class=line><span class=cl>    <span class=n>CANCELLED</span> <span class=o>=</span> <span class=s2>&#34;cancelled&#34;</span>      <span class=c1># 주문 취소</span>
</span></span><span class=line><span class=cl>    <span class=n>REFUNDED</span> <span class=o>=</span> <span class=s2>&#34;refunded&#34;</span>        <span class=c1># 환불 완료</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentStatus</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>enum</span><span class=o>.</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 상태 정의&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>PENDING</span> <span class=o>=</span> <span class=s2>&#34;pending&#34;</span>          <span class=c1># 결제 대기</span>
</span></span><span class=line><span class=cl>    <span class=n>PROCESSING</span> <span class=o>=</span> <span class=s2>&#34;processing&#34;</span>    <span class=c1># 결제 처리 중</span>
</span></span><span class=line><span class=cl>    <span class=n>COMPLETED</span> <span class=o>=</span> <span class=s2>&#34;completed&#34;</span>      <span class=c1># 결제 완료</span>
</span></span><span class=line><span class=cl>    <span class=n>FAILED</span> <span class=o>=</span> <span class=s2>&#34;failed&#34;</span>           <span class=c1># 결제 실패</span>
</span></span><span class=line><span class=cl>    <span class=n>CANCELLED</span> <span class=o>=</span> <span class=s2>&#34;cancelled&#34;</span>     <span class=c1># 결제 취소</span>
</span></span><span class=line><span class=cl>    <span class=n>REFUNDED</span> <span class=o>=</span> <span class=s2>&#34;refunded&#34;</span>       <span class=c1># 환불 완료</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SQLAlchemy 모델 정의</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderModel</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 정보 데이터베이스 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;orders&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 기본 필드</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_number</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 번호&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;사용자 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 상세 정보</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;상품 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_name</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;상품명&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_price</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Float</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;상품 단가&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 수량&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Float</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;총 주문 금액&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 상태 및 메타데이터</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Enum</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>),</span> <span class=n>default</span><span class=o>=</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 상태&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payment_status</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Enum</span><span class=p>(</span><span class=n>PaymentStatus</span><span class=p>),</span> <span class=n>default</span><span class=o>=</span><span class=n>PaymentStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;결제 상태&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주소 정보</span>
</span></span><span class=line><span class=cl>    <span class=n>shipping_address</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>500</span><span class=p>),</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;배송 주소&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>billing_address</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>500</span><span class=p>),</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;청구지 주소&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 추가 정보</span>
</span></span><span class=line><span class=cl>    <span class=n>notes</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>1000</span><span class=p>),</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 메모&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>metadata</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>2000</span><span class=p>),</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;추가 메타데이터 (JSON)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 타임스탬프</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;생성 시간&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>updated_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>,</span> <span class=n>onupdate</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;수정 시간&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>confirmed_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 확인 시간&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>shipped_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;배송 시작 시간&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>delivered_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;배송 완료 시간&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cancelled_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;취소 시간&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 인덱스 정의 (쿼리 성능 최적화)</span>
</span></span><span class=line><span class=cl>    <span class=n>__table_args__</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>Index</span><span class=p>(</span><span class=s1>&#39;idx_user_created&#39;</span><span class=p>,</span> <span class=s1>&#39;user_id&#39;</span><span class=p>,</span> <span class=s1>&#39;created_at&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>Index</span><span class=p>(</span><span class=s1>&#39;idx_status_created&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;created_at&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>Index</span><span class=p>(</span><span class=s1>&#39;idx_payment_status&#39;</span><span class=p>,</span> <span class=s1>&#39;payment_status&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderItemModel</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 아이템 상세 정보 모델 (다중 상품 주문 지원)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;order_items&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;orders.id&#39;</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;주문 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;상품 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_name</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;상품명&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_sku</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;상품 SKU&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>unit_price</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Float</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;단가&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;수량&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>subtotal</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Float</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>comment</span><span class=o>=</span><span class=s2>&#34;소계&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 관계 정의</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&#34;OrderModel&#34;</span><span class=p>,</span> <span class=n>backref</span><span class=o>=</span><span class=s2>&#34;items&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Pydantic 스키마 정의 (API 요청/응답)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreateRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 생성 요청 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;사용자 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;상품 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>le</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문 수량&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>shipping_address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;배송 주소&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>billing_address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;청구지 주소&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>notes</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문 메모&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@validator</span><span class=p>(</span><span class=s1>&#39;quantity&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>validate_quantity</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>v</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;수량 유효성 검증&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>v</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;수량은 0보다 커야 합니다&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>v</span> <span class=o>&gt;</span> <span class=mi>1000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;수량은 1000개를 초과할 수 없습니다&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderItemCreate</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 아이템 생성 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;상품 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;수량&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MultiOrderCreateRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;다중 상품 주문 생성 요청 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;사용자 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderItemCreate</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>min_items</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_items</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문 아이템 목록&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>shipping_address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;배송 주소&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>billing_address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;청구지 주소&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>notes</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문 메모&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderStatusUpdateRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 상태 업데이트 요청 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=n>OrderStatus</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;변경할 주문 상태&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>notes</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;상태 변경 사유&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentStatusUpdateRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 상태 업데이트 요청 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>payment_status</span><span class=p>:</span> <span class=n>PaymentStatus</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;변경할 결제 상태&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>transaction_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;결제 거래 ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderResponse</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 응답 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>order_number</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>product_name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>product_price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=n>OrderStatus</span>
</span></span><span class=line><span class=cl>    <span class=n>payment_status</span><span class=p>:</span> <span class=n>PaymentStatus</span>
</span></span><span class=line><span class=cl>    <span class=n>shipping_address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>billing_address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>notes</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>updated_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>confirmed_at</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>shipped_at</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>delivered_at</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>cancelled_at</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Config</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>from_attributes</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderListResponse</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 목록 응답 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>orders</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderResponse</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>total_count</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>page_size</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>has_next</span><span class=p>:</span> <span class=nb>bool</span>
</span></span><span class=line><span class=cl>    <span class=n>has_previous</span><span class=p>:</span> <span class=nb>bool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderSummaryResponse</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 요약 응답 스키마&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>total_orders</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>pending_orders</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>completed_orders</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>cancelled_orders</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>total_revenue</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>average_order_value</span><span class=p>:</span> <span class=nb>float</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=캐시-레이어-cache-layer>캐시 레이어 (Cache Layer)<a hidden class=anchor aria-hidden=true href=#캐시-레이어-cache-layer>#</a></h4><h5 id=cachepy>cache.py<a hidden class=anchor aria-hidden=true href=#cachepy>#</a></h5><p>Redis 를 활용한 캐시 관리 시스템. 주문 정보 캐싱, 분산 락 구현, 세션 관리 기능을 제공한다. Cache-Aside 패턴을 구현하여 데이터베이스 부하를 줄이고 응답 시간을 개선한다. 분산 락은 동시성 제어를 위해 Lua 스크립트를 사용하여 원자적 연산을 보장한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>  1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>  2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>  3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>  4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>  5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>  6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>  7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>  8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9>  9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10> 10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11> 11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12> 12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13> 13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14> 14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15> 15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16> 16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17> 17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18> 18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19> 19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20> 20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21> 21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22> 22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23> 23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24> 24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25> 25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26> 26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27> 27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28> 28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29> 29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30> 30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31> 31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32> 32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33> 33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34> 34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35> 35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36> 36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37> 37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38> 38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39> 39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40> 40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41> 41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42> 42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43> 43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44> 44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45> 45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46> 46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47> 47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48> 48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49> 49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50> 50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51> 51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52> 52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53> 53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54> 54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55> 55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56> 56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57> 57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58> 58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59> 59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60> 60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61> 61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62> 62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63> 63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64> 64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65> 65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66> 66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67> 67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68> 68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69> 69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70> 70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71> 71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72> 72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73> 73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74> 74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75> 75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76> 76</a>
</span><span class=lnt id=hl-16-77><a class=lnlinks href=#hl-16-77> 77</a>
</span><span class=lnt id=hl-16-78><a class=lnlinks href=#hl-16-78> 78</a>
</span><span class=lnt id=hl-16-79><a class=lnlinks href=#hl-16-79> 79</a>
</span><span class=lnt id=hl-16-80><a class=lnlinks href=#hl-16-80> 80</a>
</span><span class=lnt id=hl-16-81><a class=lnlinks href=#hl-16-81> 81</a>
</span><span class=lnt id=hl-16-82><a class=lnlinks href=#hl-16-82> 82</a>
</span><span class=lnt id=hl-16-83><a class=lnlinks href=#hl-16-83> 83</a>
</span><span class=lnt id=hl-16-84><a class=lnlinks href=#hl-16-84> 84</a>
</span><span class=lnt id=hl-16-85><a class=lnlinks href=#hl-16-85> 85</a>
</span><span class=lnt id=hl-16-86><a class=lnlinks href=#hl-16-86> 86</a>
</span><span class=lnt id=hl-16-87><a class=lnlinks href=#hl-16-87> 87</a>
</span><span class=lnt id=hl-16-88><a class=lnlinks href=#hl-16-88> 88</a>
</span><span class=lnt id=hl-16-89><a class=lnlinks href=#hl-16-89> 89</a>
</span><span class=lnt id=hl-16-90><a class=lnlinks href=#hl-16-90> 90</a>
</span><span class=lnt id=hl-16-91><a class=lnlinks href=#hl-16-91> 91</a>
</span><span class=lnt id=hl-16-92><a class=lnlinks href=#hl-16-92> 92</a>
</span><span class=lnt id=hl-16-93><a class=lnlinks href=#hl-16-93> 93</a>
</span><span class=lnt id=hl-16-94><a class=lnlinks href=#hl-16-94> 94</a>
</span><span class=lnt id=hl-16-95><a class=lnlinks href=#hl-16-95> 95</a>
</span><span class=lnt id=hl-16-96><a class=lnlinks href=#hl-16-96> 96</a>
</span><span class=lnt id=hl-16-97><a class=lnlinks href=#hl-16-97> 97</a>
</span><span class=lnt id=hl-16-98><a class=lnlinks href=#hl-16-98> 98</a>
</span><span class=lnt id=hl-16-99><a class=lnlinks href=#hl-16-99> 99</a>
</span><span class=lnt id=hl-16-100><a class=lnlinks href=#hl-16-100>100</a>
</span><span class=lnt id=hl-16-101><a class=lnlinks href=#hl-16-101>101</a>
</span><span class=lnt id=hl-16-102><a class=lnlinks href=#hl-16-102>102</a>
</span><span class=lnt id=hl-16-103><a class=lnlinks href=#hl-16-103>103</a>
</span><span class=lnt id=hl-16-104><a class=lnlinks href=#hl-16-104>104</a>
</span><span class=lnt id=hl-16-105><a class=lnlinks href=#hl-16-105>105</a>
</span><span class=lnt id=hl-16-106><a class=lnlinks href=#hl-16-106>106</a>
</span><span class=lnt id=hl-16-107><a class=lnlinks href=#hl-16-107>107</a>
</span><span class=lnt id=hl-16-108><a class=lnlinks href=#hl-16-108>108</a>
</span><span class=lnt id=hl-16-109><a class=lnlinks href=#hl-16-109>109</a>
</span><span class=lnt id=hl-16-110><a class=lnlinks href=#hl-16-110>110</a>
</span><span class=lnt id=hl-16-111><a class=lnlinks href=#hl-16-111>111</a>
</span><span class=lnt id=hl-16-112><a class=lnlinks href=#hl-16-112>112</a>
</span><span class=lnt id=hl-16-113><a class=lnlinks href=#hl-16-113>113</a>
</span><span class=lnt id=hl-16-114><a class=lnlinks href=#hl-16-114>114</a>
</span><span class=lnt id=hl-16-115><a class=lnlinks href=#hl-16-115>115</a>
</span><span class=lnt id=hl-16-116><a class=lnlinks href=#hl-16-116>116</a>
</span><span class=lnt id=hl-16-117><a class=lnlinks href=#hl-16-117>117</a>
</span><span class=lnt id=hl-16-118><a class=lnlinks href=#hl-16-118>118</a>
</span><span class=lnt id=hl-16-119><a class=lnlinks href=#hl-16-119>119</a>
</span><span class=lnt id=hl-16-120><a class=lnlinks href=#hl-16-120>120</a>
</span><span class=lnt id=hl-16-121><a class=lnlinks href=#hl-16-121>121</a>
</span><span class=lnt id=hl-16-122><a class=lnlinks href=#hl-16-122>122</a>
</span><span class=lnt id=hl-16-123><a class=lnlinks href=#hl-16-123>123</a>
</span><span class=lnt id=hl-16-124><a class=lnlinks href=#hl-16-124>124</a>
</span><span class=lnt id=hl-16-125><a class=lnlinks href=#hl-16-125>125</a>
</span><span class=lnt id=hl-16-126><a class=lnlinks href=#hl-16-126>126</a>
</span><span class=lnt id=hl-16-127><a class=lnlinks href=#hl-16-127>127</a>
</span><span class=lnt id=hl-16-128><a class=lnlinks href=#hl-16-128>128</a>
</span><span class=lnt id=hl-16-129><a class=lnlinks href=#hl-16-129>129</a>
</span><span class=lnt id=hl-16-130><a class=lnlinks href=#hl-16-130>130</a>
</span><span class=lnt id=hl-16-131><a class=lnlinks href=#hl-16-131>131</a>
</span><span class=lnt id=hl-16-132><a class=lnlinks href=#hl-16-132>132</a>
</span><span class=lnt id=hl-16-133><a class=lnlinks href=#hl-16-133>133</a>
</span><span class=lnt id=hl-16-134><a class=lnlinks href=#hl-16-134>134</a>
</span><span class=lnt id=hl-16-135><a class=lnlinks href=#hl-16-135>135</a>
</span><span class=lnt id=hl-16-136><a class=lnlinks href=#hl-16-136>136</a>
</span><span class=lnt id=hl-16-137><a class=lnlinks href=#hl-16-137>137</a>
</span><span class=lnt id=hl-16-138><a class=lnlinks href=#hl-16-138>138</a>
</span><span class=lnt id=hl-16-139><a class=lnlinks href=#hl-16-139>139</a>
</span><span class=lnt id=hl-16-140><a class=lnlinks href=#hl-16-140>140</a>
</span><span class=lnt id=hl-16-141><a class=lnlinks href=#hl-16-141>141</a>
</span><span class=lnt id=hl-16-142><a class=lnlinks href=#hl-16-142>142</a>
</span><span class=lnt id=hl-16-143><a class=lnlinks href=#hl-16-143>143</a>
</span><span class=lnt id=hl-16-144><a class=lnlinks href=#hl-16-144>144</a>
</span><span class=lnt id=hl-16-145><a class=lnlinks href=#hl-16-145>145</a>
</span><span class=lnt id=hl-16-146><a class=lnlinks href=#hl-16-146>146</a>
</span><span class=lnt id=hl-16-147><a class=lnlinks href=#hl-16-147>147</a>
</span><span class=lnt id=hl-16-148><a class=lnlinks href=#hl-16-148>148</a>
</span><span class=lnt id=hl-16-149><a class=lnlinks href=#hl-16-149>149</a>
</span><span class=lnt id=hl-16-150><a class=lnlinks href=#hl-16-150>150</a>
</span><span class=lnt id=hl-16-151><a class=lnlinks href=#hl-16-151>151</a>
</span><span class=lnt id=hl-16-152><a class=lnlinks href=#hl-16-152>152</a>
</span><span class=lnt id=hl-16-153><a class=lnlinks href=#hl-16-153>153</a>
</span><span class=lnt id=hl-16-154><a class=lnlinks href=#hl-16-154>154</a>
</span><span class=lnt id=hl-16-155><a class=lnlinks href=#hl-16-155>155</a>
</span><span class=lnt id=hl-16-156><a class=lnlinks href=#hl-16-156>156</a>
</span><span class=lnt id=hl-16-157><a class=lnlinks href=#hl-16-157>157</a>
</span><span class=lnt id=hl-16-158><a class=lnlinks href=#hl-16-158>158</a>
</span><span class=lnt id=hl-16-159><a class=lnlinks href=#hl-16-159>159</a>
</span><span class=lnt id=hl-16-160><a class=lnlinks href=#hl-16-160>160</a>
</span><span class=lnt id=hl-16-161><a class=lnlinks href=#hl-16-161>161</a>
</span><span class=lnt id=hl-16-162><a class=lnlinks href=#hl-16-162>162</a>
</span><span class=lnt id=hl-16-163><a class=lnlinks href=#hl-16-163>163</a>
</span><span class=lnt id=hl-16-164><a class=lnlinks href=#hl-16-164>164</a>
</span><span class=lnt id=hl-16-165><a class=lnlinks href=#hl-16-165>165</a>
</span><span class=lnt id=hl-16-166><a class=lnlinks href=#hl-16-166>166</a>
</span><span class=lnt id=hl-16-167><a class=lnlinks href=#hl-16-167>167</a>
</span><span class=lnt id=hl-16-168><a class=lnlinks href=#hl-16-168>168</a>
</span><span class=lnt id=hl-16-169><a class=lnlinks href=#hl-16-169>169</a>
</span><span class=lnt id=hl-16-170><a class=lnlinks href=#hl-16-170>170</a>
</span><span class=lnt id=hl-16-171><a class=lnlinks href=#hl-16-171>171</a>
</span><span class=lnt id=hl-16-172><a class=lnlinks href=#hl-16-172>172</a>
</span><span class=lnt id=hl-16-173><a class=lnlinks href=#hl-16-173>173</a>
</span><span class=lnt id=hl-16-174><a class=lnlinks href=#hl-16-174>174</a>
</span><span class=lnt id=hl-16-175><a class=lnlinks href=#hl-16-175>175</a>
</span><span class=lnt id=hl-16-176><a class=lnlinks href=#hl-16-176>176</a>
</span><span class=lnt id=hl-16-177><a class=lnlinks href=#hl-16-177>177</a>
</span><span class=lnt id=hl-16-178><a class=lnlinks href=#hl-16-178>178</a>
</span><span class=lnt id=hl-16-179><a class=lnlinks href=#hl-16-179>179</a>
</span><span class=lnt id=hl-16-180><a class=lnlinks href=#hl-16-180>180</a>
</span><span class=lnt id=hl-16-181><a class=lnlinks href=#hl-16-181>181</a>
</span><span class=lnt id=hl-16-182><a class=lnlinks href=#hl-16-182>182</a>
</span><span class=lnt id=hl-16-183><a class=lnlinks href=#hl-16-183>183</a>
</span><span class=lnt id=hl-16-184><a class=lnlinks href=#hl-16-184>184</a>
</span><span class=lnt id=hl-16-185><a class=lnlinks href=#hl-16-185>185</a>
</span><span class=lnt id=hl-16-186><a class=lnlinks href=#hl-16-186>186</a>
</span><span class=lnt id=hl-16-187><a class=lnlinks href=#hl-16-187>187</a>
</span><span class=lnt id=hl-16-188><a class=lnlinks href=#hl-16-188>188</a>
</span><span class=lnt id=hl-16-189><a class=lnlinks href=#hl-16-189>189</a>
</span><span class=lnt id=hl-16-190><a class=lnlinks href=#hl-16-190>190</a>
</span><span class=lnt id=hl-16-191><a class=lnlinks href=#hl-16-191>191</a>
</span><span class=lnt id=hl-16-192><a class=lnlinks href=#hl-16-192>192</a>
</span><span class=lnt id=hl-16-193><a class=lnlinks href=#hl-16-193>193</a>
</span><span class=lnt id=hl-16-194><a class=lnlinks href=#hl-16-194>194</a>
</span><span class=lnt id=hl-16-195><a class=lnlinks href=#hl-16-195>195</a>
</span><span class=lnt id=hl-16-196><a class=lnlinks href=#hl-16-196>196</a>
</span><span class=lnt id=hl-16-197><a class=lnlinks href=#hl-16-197>197</a>
</span><span class=lnt id=hl-16-198><a class=lnlinks href=#hl-16-198>198</a>
</span><span class=lnt id=hl-16-199><a class=lnlinks href=#hl-16-199>199</a>
</span><span class=lnt id=hl-16-200><a class=lnlinks href=#hl-16-200>200</a>
</span><span class=lnt id=hl-16-201><a class=lnlinks href=#hl-16-201>201</a>
</span><span class=lnt id=hl-16-202><a class=lnlinks href=#hl-16-202>202</a>
</span><span class=lnt id=hl-16-203><a class=lnlinks href=#hl-16-203>203</a>
</span><span class=lnt id=hl-16-204><a class=lnlinks href=#hl-16-204>204</a>
</span><span class=lnt id=hl-16-205><a class=lnlinks href=#hl-16-205>205</a>
</span><span class=lnt id=hl-16-206><a class=lnlinks href=#hl-16-206>206</a>
</span><span class=lnt id=hl-16-207><a class=lnlinks href=#hl-16-207>207</a>
</span><span class=lnt id=hl-16-208><a class=lnlinks href=#hl-16-208>208</a>
</span><span class=lnt id=hl-16-209><a class=lnlinks href=#hl-16-209>209</a>
</span><span class=lnt id=hl-16-210><a class=lnlinks href=#hl-16-210>210</a>
</span><span class=lnt id=hl-16-211><a class=lnlinks href=#hl-16-211>211</a>
</span><span class=lnt id=hl-16-212><a class=lnlinks href=#hl-16-212>212</a>
</span><span class=lnt id=hl-16-213><a class=lnlinks href=#hl-16-213>213</a>
</span><span class=lnt id=hl-16-214><a class=lnlinks href=#hl-16-214>214</a>
</span><span class=lnt id=hl-16-215><a class=lnlinks href=#hl-16-215>215</a>
</span><span class=lnt id=hl-16-216><a class=lnlinks href=#hl-16-216>216</a>
</span><span class=lnt id=hl-16-217><a class=lnlinks href=#hl-16-217>217</a>
</span><span class=lnt id=hl-16-218><a class=lnlinks href=#hl-16-218>218</a>
</span><span class=lnt id=hl-16-219><a class=lnlinks href=#hl-16-219>219</a>
</span><span class=lnt id=hl-16-220><a class=lnlinks href=#hl-16-220>220</a>
</span><span class=lnt id=hl-16-221><a class=lnlinks href=#hl-16-221>221</a>
</span><span class=lnt id=hl-16-222><a class=lnlinks href=#hl-16-222>222</a>
</span><span class=lnt id=hl-16-223><a class=lnlinks href=#hl-16-223>223</a>
</span><span class=lnt id=hl-16-224><a class=lnlinks href=#hl-16-224>224</a>
</span><span class=lnt id=hl-16-225><a class=lnlinks href=#hl-16-225>225</a>
</span><span class=lnt id=hl-16-226><a class=lnlinks href=#hl-16-226>226</a>
</span><span class=lnt id=hl-16-227><a class=lnlinks href=#hl-16-227>227</a>
</span><span class=lnt id=hl-16-228><a class=lnlinks href=#hl-16-228>228</a>
</span><span class=lnt id=hl-16-229><a class=lnlinks href=#hl-16-229>229</a>
</span><span class=lnt id=hl-16-230><a class=lnlinks href=#hl-16-230>230</a>
</span><span class=lnt id=hl-16-231><a class=lnlinks href=#hl-16-231>231</a>
</span><span class=lnt id=hl-16-232><a class=lnlinks href=#hl-16-232>232</a>
</span><span class=lnt id=hl-16-233><a class=lnlinks href=#hl-16-233>233</a>
</span><span class=lnt id=hl-16-234><a class=lnlinks href=#hl-16-234>234</a>
</span><span class=lnt id=hl-16-235><a class=lnlinks href=#hl-16-235>235</a>
</span><span class=lnt id=hl-16-236><a class=lnlinks href=#hl-16-236>236</a>
</span><span class=lnt id=hl-16-237><a class=lnlinks href=#hl-16-237>237</a>
</span><span class=lnt id=hl-16-238><a class=lnlinks href=#hl-16-238>238</a>
</span><span class=lnt id=hl-16-239><a class=lnlinks href=#hl-16-239>239</a>
</span><span class=lnt id=hl-16-240><a class=lnlinks href=#hl-16-240>240</a>
</span><span class=lnt id=hl-16-241><a class=lnlinks href=#hl-16-241>241</a>
</span><span class=lnt id=hl-16-242><a class=lnlinks href=#hl-16-242>242</a>
</span><span class=lnt id=hl-16-243><a class=lnlinks href=#hl-16-243>243</a>
</span><span class=lnt id=hl-16-244><a class=lnlinks href=#hl-16-244>244</a>
</span><span class=lnt id=hl-16-245><a class=lnlinks href=#hl-16-245>245</a>
</span><span class=lnt id=hl-16-246><a class=lnlinks href=#hl-16-246>246</a>
</span><span class=lnt id=hl-16-247><a class=lnlinks href=#hl-16-247>247</a>
</span><span class=lnt id=hl-16-248><a class=lnlinks href=#hl-16-248>248</a>
</span><span class=lnt id=hl-16-249><a class=lnlinks href=#hl-16-249>249</a>
</span><span class=lnt id=hl-16-250><a class=lnlinks href=#hl-16-250>250</a>
</span><span class=lnt id=hl-16-251><a class=lnlinks href=#hl-16-251>251</a>
</span><span class=lnt id=hl-16-252><a class=lnlinks href=#hl-16-252>252</a>
</span><span class=lnt id=hl-16-253><a class=lnlinks href=#hl-16-253>253</a>
</span><span class=lnt id=hl-16-254><a class=lnlinks href=#hl-16-254>254</a>
</span><span class=lnt id=hl-16-255><a class=lnlinks href=#hl-16-255>255</a>
</span><span class=lnt id=hl-16-256><a class=lnlinks href=#hl-16-256>256</a>
</span><span class=lnt id=hl-16-257><a class=lnlinks href=#hl-16-257>257</a>
</span><span class=lnt id=hl-16-258><a class=lnlinks href=#hl-16-258>258</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Redis 캐시 관리 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># 주문 정보 캐싱, 세션 관리, 분산 락 구현</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>utils</span> <span class=kn>import</span> <span class=n>logger</span><span class=p>,</span> <span class=n>log_execution_time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CacheManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Redis 캐시 관리 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_client</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_initialize_client</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Redis 클라이언트 초기화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>settings</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>decode_responses</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>decode_responses</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>socket_timeout</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>socket_timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>socket_connect_timeout</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>socket_connect_timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>retry_on_timeout</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>health_check_interval</span><span class=o>=</span><span class=mi>30</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 연결 테스트</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>ping</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Redis 클라이언트 초기화 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Redis 연결 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCacheService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 정보 캐시 서비스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cache_manager</span><span class=p>:</span> <span class=n>CacheManager</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=n>cache_manager</span><span class=o>.</span><span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>default_ttl</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>default_ttl</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_order_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 캐시 키 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;order:</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_user_orders_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 주문 목록 캐시 키 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;user_orders:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;cache_order_set&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>set_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>ttl</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 정보 캐시 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_order_key</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ttl</span> <span class=o>=</span> <span class=n>ttl</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>default_ttl</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 데이터 직렬화 (datetime 객체 처리)</span>
</span></span><span class=line><span class=cl>            <span class=n>serialized_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order_data</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>ttl</span><span class=p>,</span> <span class=n>serialized_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;주문 캐시 저장 완료&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=n>ttl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 캐시 저장 실패&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;cache_order_get&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 정보 캐시 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_order_key</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cached_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>cached_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;캐시에서 주문 조회 성공&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cached_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&#34;캐시에서 주문 정보 없음&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 캐시 조회 실패&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;cache_order_delete&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>delete_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 정보 캐시 삭제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_order_key</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;주문 캐시 삭제 완료&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 캐시 삭제 실패&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>set_user_orders</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>order_list</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span> <span class=n>ttl</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 주문 목록 캐시 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_user_orders_key</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ttl</span> <span class=o>=</span> <span class=n>ttl</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>default_ttl</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>serialized_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order_list</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>ttl</span><span class=p>,</span> <span class=n>serialized_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;사용자 주문 목록 캐시 저장 완료&#34;</span><span class=p>,</span> <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span> <span class=n>count</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>order_list</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;사용자 주문 목록 캐시 저장 실패&#34;</span><span class=p>,</span> <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_user_orders</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 주문 목록 캐시 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_user_orders_key</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cached_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>cached_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;캐시에서 사용자 주문 목록 조회 성공&#34;</span><span class=p>,</span> <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cached_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;사용자 주문 목록 캐시 조회 실패&#34;</span><span class=p>,</span> <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedLockService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;분산 락 서비스 (동시성 제어)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cache_manager</span><span class=p>:</span> <span class=n>CacheManager</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=n>cache_manager</span><span class=o>.</span><span class=n>redis_client</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>acquire_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>resource_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span> <span class=n>blocking_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;lock:</span><span class=si>{</span><span class=n>resource_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_value</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>resource_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 논블로킹 락 시도</span>
</span></span><span class=line><span class=cl>            <span class=n>acquired</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>lock_value</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;분산 락 획득 성공&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>,</span> <span class=n>lock_value</span><span class=o>=</span><span class=n>lock_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>lock_value</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 블로킹 락 시도</span>
</span></span><span class=line><span class=cl>            <span class=n>start_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>blocking_timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>acquired</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>lock_value</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;분산 락 획득 성공 (블로킹)&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>lock_value</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;분산 락 획득 타임아웃&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;분산 락 획득 실패&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>release_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>resource_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>lock_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;lock:</span><span class=si>{</span><span class=n>resource_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Lua 스크립트를 사용한 원자적 락 해제</span>
</span></span><span class=line><span class=cl>            <span class=n>lua_script</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            if redis.call(&#34;get&#34;, KEYS[1]) == ARGV[1] then
</span></span></span><span class=line><span class=cl><span class=s2>                return redis.call(&#34;del&#34;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=s2>            else
</span></span></span><span class=line><span class=cl><span class=s2>                return 0
</span></span></span><span class=line><span class=cl><span class=s2>            end
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>eval</span><span class=p>(</span><span class=n>lua_script</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>lock_key</span><span class=p>,</span> <span class=n>lock_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;분산 락 해제 완료&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;분산 락 해제 실패 - 잘못된 락 값&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;분산 락 해제 실패&#34;</span><span class=p>,</span> <span class=n>resource_id</span><span class=o>=</span><span class=n>resource_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SessionCacheService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;세션 캐시 서비스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cache_manager</span><span class=p>:</span> <span class=n>CacheManager</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=n>cache_manager</span><span class=o>.</span><span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session_ttl</span> <span class=o>=</span> <span class=mi>3600</span>  <span class=c1># 1시간</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>set_session</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>session_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;세션 데이터 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;session:</span><span class=si>{</span><span class=n>session_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>serialized_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>session_data</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_ttl</span><span class=p>,</span> <span class=n>serialized_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;세션 저장 완료&#34;</span><span class=p>,</span> <span class=n>session_id</span><span class=o>=</span><span class=n>session_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;세션 저장 실패&#34;</span><span class=p>,</span> <span class=n>session_id</span><span class=o>=</span><span class=n>session_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_session</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;세션 데이터 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;session:</span><span class=si>{</span><span class=n>session_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>cached_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>cached_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># TTL 갱신</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_ttl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cached_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;세션 조회 실패&#34;</span><span class=p>,</span> <span class=n>session_id</span><span class=o>=</span><span class=n>session_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 캐시 서비스 인스턴스</span>
</span></span><span class=line><span class=cl><span class=n>cache_manager</span> <span class=o>=</span> <span class=n>CacheManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>order_cache</span> <span class=o>=</span> <span class=n>OrderCacheService</span><span class=p>(</span><span class=n>cache_manager</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>distributed_lock</span> <span class=o>=</span> <span class=n>DistributedLockService</span><span class=p>(</span><span class=n>cache_manager</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>session_cache</span> <span class=o>=</span> <span class=n>SessionCacheService</span><span class=p>(</span><span class=n>cache_manager</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>health_check_redis</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Redis 헬스 체크&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cache_manager</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>ping</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Redis 헬스 체크 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=메시징-레이어-messaging-layer>메시징 레이어 (Messaging Layer)<a hidden class=anchor aria-hidden=true href=#메시징-레이어-messaging-layer>#</a></h4><h5 id=messagingpy>messaging.py<a hidden class=anchor aria-hidden=true href=#messagingpy>#</a></h5><p>Kafka 를 통한 비동기 이벤트 기반 아키텍처를 구현한다. 이벤트 발행자 (Publisher) 와 구독자 (Consumer) 를 제공하며, 주문 생성, 상태 변경, 결제 완료 등의 도메인 이벤트를 처리한다. 재시도 로직, 멱등성 보장, 이벤트 순서 보장 등의 기능을 포함한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>  1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>  2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>  3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>  4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>  5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>  6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>  7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>  8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>  9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10> 10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11> 11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12> 12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13> 13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14> 14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15> 15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16> 16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17> 17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18> 18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19> 19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20> 20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21> 21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22> 22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23> 23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24> 24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25> 25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26> 26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27> 27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28> 28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29> 29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30> 30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31> 31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32> 32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33> 33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34> 34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35> 35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36> 36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37> 37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38> 38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39> 39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40> 40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41> 41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42> 42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43> 43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44> 44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45> 45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46> 46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47> 47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48> 48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49> 49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50> 50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51> 51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52> 52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53> 53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54> 54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55> 55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56> 56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57> 57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58> 58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59> 59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60> 60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61> 61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62> 62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63> 63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64> 64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65> 65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66> 66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67> 67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68> 68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69> 69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70> 70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71> 71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72> 72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73> 73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74> 74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75> 75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76> 76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77> 77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78> 78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79> 79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80> 80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81> 81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82> 82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83> 83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84> 84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85> 85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86> 86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87> 87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88> 88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89> 89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90> 90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91> 91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92> 92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93> 93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94> 94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95> 95</a>
</span><span class=lnt id=hl-17-96><a class=lnlinks href=#hl-17-96> 96</a>
</span><span class=lnt id=hl-17-97><a class=lnlinks href=#hl-17-97> 97</a>
</span><span class=lnt id=hl-17-98><a class=lnlinks href=#hl-17-98> 98</a>
</span><span class=lnt id=hl-17-99><a class=lnlinks href=#hl-17-99> 99</a>
</span><span class=lnt id=hl-17-100><a class=lnlinks href=#hl-17-100>100</a>
</span><span class=lnt id=hl-17-101><a class=lnlinks href=#hl-17-101>101</a>
</span><span class=lnt id=hl-17-102><a class=lnlinks href=#hl-17-102>102</a>
</span><span class=lnt id=hl-17-103><a class=lnlinks href=#hl-17-103>103</a>
</span><span class=lnt id=hl-17-104><a class=lnlinks href=#hl-17-104>104</a>
</span><span class=lnt id=hl-17-105><a class=lnlinks href=#hl-17-105>105</a>
</span><span class=lnt id=hl-17-106><a class=lnlinks href=#hl-17-106>106</a>
</span><span class=lnt id=hl-17-107><a class=lnlinks href=#hl-17-107>107</a>
</span><span class=lnt id=hl-17-108><a class=lnlinks href=#hl-17-108>108</a>
</span><span class=lnt id=hl-17-109><a class=lnlinks href=#hl-17-109>109</a>
</span><span class=lnt id=hl-17-110><a class=lnlinks href=#hl-17-110>110</a>
</span><span class=lnt id=hl-17-111><a class=lnlinks href=#hl-17-111>111</a>
</span><span class=lnt id=hl-17-112><a class=lnlinks href=#hl-17-112>112</a>
</span><span class=lnt id=hl-17-113><a class=lnlinks href=#hl-17-113>113</a>
</span><span class=lnt id=hl-17-114><a class=lnlinks href=#hl-17-114>114</a>
</span><span class=lnt id=hl-17-115><a class=lnlinks href=#hl-17-115>115</a>
</span><span class=lnt id=hl-17-116><a class=lnlinks href=#hl-17-116>116</a>
</span><span class=lnt id=hl-17-117><a class=lnlinks href=#hl-17-117>117</a>
</span><span class=lnt id=hl-17-118><a class=lnlinks href=#hl-17-118>118</a>
</span><span class=lnt id=hl-17-119><a class=lnlinks href=#hl-17-119>119</a>
</span><span class=lnt id=hl-17-120><a class=lnlinks href=#hl-17-120>120</a>
</span><span class=lnt id=hl-17-121><a class=lnlinks href=#hl-17-121>121</a>
</span><span class=lnt id=hl-17-122><a class=lnlinks href=#hl-17-122>122</a>
</span><span class=lnt id=hl-17-123><a class=lnlinks href=#hl-17-123>123</a>
</span><span class=lnt id=hl-17-124><a class=lnlinks href=#hl-17-124>124</a>
</span><span class=lnt id=hl-17-125><a class=lnlinks href=#hl-17-125>125</a>
</span><span class=lnt id=hl-17-126><a class=lnlinks href=#hl-17-126>126</a>
</span><span class=lnt id=hl-17-127><a class=lnlinks href=#hl-17-127>127</a>
</span><span class=lnt id=hl-17-128><a class=lnlinks href=#hl-17-128>128</a>
</span><span class=lnt id=hl-17-129><a class=lnlinks href=#hl-17-129>129</a>
</span><span class=lnt id=hl-17-130><a class=lnlinks href=#hl-17-130>130</a>
</span><span class=lnt id=hl-17-131><a class=lnlinks href=#hl-17-131>131</a>
</span><span class=lnt id=hl-17-132><a class=lnlinks href=#hl-17-132>132</a>
</span><span class=lnt id=hl-17-133><a class=lnlinks href=#hl-17-133>133</a>
</span><span class=lnt id=hl-17-134><a class=lnlinks href=#hl-17-134>134</a>
</span><span class=lnt id=hl-17-135><a class=lnlinks href=#hl-17-135>135</a>
</span><span class=lnt id=hl-17-136><a class=lnlinks href=#hl-17-136>136</a>
</span><span class=lnt id=hl-17-137><a class=lnlinks href=#hl-17-137>137</a>
</span><span class=lnt id=hl-17-138><a class=lnlinks href=#hl-17-138>138</a>
</span><span class=lnt id=hl-17-139><a class=lnlinks href=#hl-17-139>139</a>
</span><span class=lnt id=hl-17-140><a class=lnlinks href=#hl-17-140>140</a>
</span><span class=lnt id=hl-17-141><a class=lnlinks href=#hl-17-141>141</a>
</span><span class=lnt id=hl-17-142><a class=lnlinks href=#hl-17-142>142</a>
</span><span class=lnt id=hl-17-143><a class=lnlinks href=#hl-17-143>143</a>
</span><span class=lnt id=hl-17-144><a class=lnlinks href=#hl-17-144>144</a>
</span><span class=lnt id=hl-17-145><a class=lnlinks href=#hl-17-145>145</a>
</span><span class=lnt id=hl-17-146><a class=lnlinks href=#hl-17-146>146</a>
</span><span class=lnt id=hl-17-147><a class=lnlinks href=#hl-17-147>147</a>
</span><span class=lnt id=hl-17-148><a class=lnlinks href=#hl-17-148>148</a>
</span><span class=lnt id=hl-17-149><a class=lnlinks href=#hl-17-149>149</a>
</span><span class=lnt id=hl-17-150><a class=lnlinks href=#hl-17-150>150</a>
</span><span class=lnt id=hl-17-151><a class=lnlinks href=#hl-17-151>151</a>
</span><span class=lnt id=hl-17-152><a class=lnlinks href=#hl-17-152>152</a>
</span><span class=lnt id=hl-17-153><a class=lnlinks href=#hl-17-153>153</a>
</span><span class=lnt id=hl-17-154><a class=lnlinks href=#hl-17-154>154</a>
</span><span class=lnt id=hl-17-155><a class=lnlinks href=#hl-17-155>155</a>
</span><span class=lnt id=hl-17-156><a class=lnlinks href=#hl-17-156>156</a>
</span><span class=lnt id=hl-17-157><a class=lnlinks href=#hl-17-157>157</a>
</span><span class=lnt id=hl-17-158><a class=lnlinks href=#hl-17-158>158</a>
</span><span class=lnt id=hl-17-159><a class=lnlinks href=#hl-17-159>159</a>
</span><span class=lnt id=hl-17-160><a class=lnlinks href=#hl-17-160>160</a>
</span><span class=lnt id=hl-17-161><a class=lnlinks href=#hl-17-161>161</a>
</span><span class=lnt id=hl-17-162><a class=lnlinks href=#hl-17-162>162</a>
</span><span class=lnt id=hl-17-163><a class=lnlinks href=#hl-17-163>163</a>
</span><span class=lnt id=hl-17-164><a class=lnlinks href=#hl-17-164>164</a>
</span><span class=lnt id=hl-17-165><a class=lnlinks href=#hl-17-165>165</a>
</span><span class=lnt id=hl-17-166><a class=lnlinks href=#hl-17-166>166</a>
</span><span class=lnt id=hl-17-167><a class=lnlinks href=#hl-17-167>167</a>
</span><span class=lnt id=hl-17-168><a class=lnlinks href=#hl-17-168>168</a>
</span><span class=lnt id=hl-17-169><a class=lnlinks href=#hl-17-169>169</a>
</span><span class=lnt id=hl-17-170><a class=lnlinks href=#hl-17-170>170</a>
</span><span class=lnt id=hl-17-171><a class=lnlinks href=#hl-17-171>171</a>
</span><span class=lnt id=hl-17-172><a class=lnlinks href=#hl-17-172>172</a>
</span><span class=lnt id=hl-17-173><a class=lnlinks href=#hl-17-173>173</a>
</span><span class=lnt id=hl-17-174><a class=lnlinks href=#hl-17-174>174</a>
</span><span class=lnt id=hl-17-175><a class=lnlinks href=#hl-17-175>175</a>
</span><span class=lnt id=hl-17-176><a class=lnlinks href=#hl-17-176>176</a>
</span><span class=lnt id=hl-17-177><a class=lnlinks href=#hl-17-177>177</a>
</span><span class=lnt id=hl-17-178><a class=lnlinks href=#hl-17-178>178</a>
</span><span class=lnt id=hl-17-179><a class=lnlinks href=#hl-17-179>179</a>
</span><span class=lnt id=hl-17-180><a class=lnlinks href=#hl-17-180>180</a>
</span><span class=lnt id=hl-17-181><a class=lnlinks href=#hl-17-181>181</a>
</span><span class=lnt id=hl-17-182><a class=lnlinks href=#hl-17-182>182</a>
</span><span class=lnt id=hl-17-183><a class=lnlinks href=#hl-17-183>183</a>
</span><span class=lnt id=hl-17-184><a class=lnlinks href=#hl-17-184>184</a>
</span><span class=lnt id=hl-17-185><a class=lnlinks href=#hl-17-185>185</a>
</span><span class=lnt id=hl-17-186><a class=lnlinks href=#hl-17-186>186</a>
</span><span class=lnt id=hl-17-187><a class=lnlinks href=#hl-17-187>187</a>
</span><span class=lnt id=hl-17-188><a class=lnlinks href=#hl-17-188>188</a>
</span><span class=lnt id=hl-17-189><a class=lnlinks href=#hl-17-189>189</a>
</span><span class=lnt id=hl-17-190><a class=lnlinks href=#hl-17-190>190</a>
</span><span class=lnt id=hl-17-191><a class=lnlinks href=#hl-17-191>191</a>
</span><span class=lnt id=hl-17-192><a class=lnlinks href=#hl-17-192>192</a>
</span><span class=lnt id=hl-17-193><a class=lnlinks href=#hl-17-193>193</a>
</span><span class=lnt id=hl-17-194><a class=lnlinks href=#hl-17-194>194</a>
</span><span class=lnt id=hl-17-195><a class=lnlinks href=#hl-17-195>195</a>
</span><span class=lnt id=hl-17-196><a class=lnlinks href=#hl-17-196>196</a>
</span><span class=lnt id=hl-17-197><a class=lnlinks href=#hl-17-197>197</a>
</span><span class=lnt id=hl-17-198><a class=lnlinks href=#hl-17-198>198</a>
</span><span class=lnt id=hl-17-199><a class=lnlinks href=#hl-17-199>199</a>
</span><span class=lnt id=hl-17-200><a class=lnlinks href=#hl-17-200>200</a>
</span><span class=lnt id=hl-17-201><a class=lnlinks href=#hl-17-201>201</a>
</span><span class=lnt id=hl-17-202><a class=lnlinks href=#hl-17-202>202</a>
</span><span class=lnt id=hl-17-203><a class=lnlinks href=#hl-17-203>203</a>
</span><span class=lnt id=hl-17-204><a class=lnlinks href=#hl-17-204>204</a>
</span><span class=lnt id=hl-17-205><a class=lnlinks href=#hl-17-205>205</a>
</span><span class=lnt id=hl-17-206><a class=lnlinks href=#hl-17-206>206</a>
</span><span class=lnt id=hl-17-207><a class=lnlinks href=#hl-17-207>207</a>
</span><span class=lnt id=hl-17-208><a class=lnlinks href=#hl-17-208>208</a>
</span><span class=lnt id=hl-17-209><a class=lnlinks href=#hl-17-209>209</a>
</span><span class=lnt id=hl-17-210><a class=lnlinks href=#hl-17-210>210</a>
</span><span class=lnt id=hl-17-211><a class=lnlinks href=#hl-17-211>211</a>
</span><span class=lnt id=hl-17-212><a class=lnlinks href=#hl-17-212>212</a>
</span><span class=lnt id=hl-17-213><a class=lnlinks href=#hl-17-213>213</a>
</span><span class=lnt id=hl-17-214><a class=lnlinks href=#hl-17-214>214</a>
</span><span class=lnt id=hl-17-215><a class=lnlinks href=#hl-17-215>215</a>
</span><span class=lnt id=hl-17-216><a class=lnlinks href=#hl-17-216>216</a>
</span><span class=lnt id=hl-17-217><a class=lnlinks href=#hl-17-217>217</a>
</span><span class=lnt id=hl-17-218><a class=lnlinks href=#hl-17-218>218</a>
</span><span class=lnt id=hl-17-219><a class=lnlinks href=#hl-17-219>219</a>
</span><span class=lnt id=hl-17-220><a class=lnlinks href=#hl-17-220>220</a>
</span><span class=lnt id=hl-17-221><a class=lnlinks href=#hl-17-221>221</a>
</span><span class=lnt id=hl-17-222><a class=lnlinks href=#hl-17-222>222</a>
</span><span class=lnt id=hl-17-223><a class=lnlinks href=#hl-17-223>223</a>
</span><span class=lnt id=hl-17-224><a class=lnlinks href=#hl-17-224>224</a>
</span><span class=lnt id=hl-17-225><a class=lnlinks href=#hl-17-225>225</a>
</span><span class=lnt id=hl-17-226><a class=lnlinks href=#hl-17-226>226</a>
</span><span class=lnt id=hl-17-227><a class=lnlinks href=#hl-17-227>227</a>
</span><span class=lnt id=hl-17-228><a class=lnlinks href=#hl-17-228>228</a>
</span><span class=lnt id=hl-17-229><a class=lnlinks href=#hl-17-229>229</a>
</span><span class=lnt id=hl-17-230><a class=lnlinks href=#hl-17-230>230</a>
</span><span class=lnt id=hl-17-231><a class=lnlinks href=#hl-17-231>231</a>
</span><span class=lnt id=hl-17-232><a class=lnlinks href=#hl-17-232>232</a>
</span><span class=lnt id=hl-17-233><a class=lnlinks href=#hl-17-233>233</a>
</span><span class=lnt id=hl-17-234><a class=lnlinks href=#hl-17-234>234</a>
</span><span class=lnt id=hl-17-235><a class=lnlinks href=#hl-17-235>235</a>
</span><span class=lnt id=hl-17-236><a class=lnlinks href=#hl-17-236>236</a>
</span><span class=lnt id=hl-17-237><a class=lnlinks href=#hl-17-237>237</a>
</span><span class=lnt id=hl-17-238><a class=lnlinks href=#hl-17-238>238</a>
</span><span class=lnt id=hl-17-239><a class=lnlinks href=#hl-17-239>239</a>
</span><span class=lnt id=hl-17-240><a class=lnlinks href=#hl-17-240>240</a>
</span><span class=lnt id=hl-17-241><a class=lnlinks href=#hl-17-241>241</a>
</span><span class=lnt id=hl-17-242><a class=lnlinks href=#hl-17-242>242</a>
</span><span class=lnt id=hl-17-243><a class=lnlinks href=#hl-17-243>243</a>
</span><span class=lnt id=hl-17-244><a class=lnlinks href=#hl-17-244>244</a>
</span><span class=lnt id=hl-17-245><a class=lnlinks href=#hl-17-245>245</a>
</span><span class=lnt id=hl-17-246><a class=lnlinks href=#hl-17-246>246</a>
</span><span class=lnt id=hl-17-247><a class=lnlinks href=#hl-17-247>247</a>
</span><span class=lnt id=hl-17-248><a class=lnlinks href=#hl-17-248>248</a>
</span><span class=lnt id=hl-17-249><a class=lnlinks href=#hl-17-249>249</a>
</span><span class=lnt id=hl-17-250><a class=lnlinks href=#hl-17-250>250</a>
</span><span class=lnt id=hl-17-251><a class=lnlinks href=#hl-17-251>251</a>
</span><span class=lnt id=hl-17-252><a class=lnlinks href=#hl-17-252>252</a>
</span><span class=lnt id=hl-17-253><a class=lnlinks href=#hl-17-253>253</a>
</span><span class=lnt id=hl-17-254><a class=lnlinks href=#hl-17-254>254</a>
</span><span class=lnt id=hl-17-255><a class=lnlinks href=#hl-17-255>255</a>
</span><span class=lnt id=hl-17-256><a class=lnlinks href=#hl-17-256>256</a>
</span><span class=lnt id=hl-17-257><a class=lnlinks href=#hl-17-257>257</a>
</span><span class=lnt id=hl-17-258><a class=lnlinks href=#hl-17-258>258</a>
</span><span class=lnt id=hl-17-259><a class=lnlinks href=#hl-17-259>259</a>
</span><span class=lnt id=hl-17-260><a class=lnlinks href=#hl-17-260>260</a>
</span><span class=lnt id=hl-17-261><a class=lnlinks href=#hl-17-261>261</a>
</span><span class=lnt id=hl-17-262><a class=lnlinks href=#hl-17-262>262</a>
</span><span class=lnt id=hl-17-263><a class=lnlinks href=#hl-17-263>263</a>
</span><span class=lnt id=hl-17-264><a class=lnlinks href=#hl-17-264>264</a>
</span><span class=lnt id=hl-17-265><a class=lnlinks href=#hl-17-265>265</a>
</span><span class=lnt id=hl-17-266><a class=lnlinks href=#hl-17-266>266</a>
</span><span class=lnt id=hl-17-267><a class=lnlinks href=#hl-17-267>267</a>
</span><span class=lnt id=hl-17-268><a class=lnlinks href=#hl-17-268>268</a>
</span><span class=lnt id=hl-17-269><a class=lnlinks href=#hl-17-269>269</a>
</span><span class=lnt id=hl-17-270><a class=lnlinks href=#hl-17-270>270</a>
</span><span class=lnt id=hl-17-271><a class=lnlinks href=#hl-17-271>271</a>
</span><span class=lnt id=hl-17-272><a class=lnlinks href=#hl-17-272>272</a>
</span><span class=lnt id=hl-17-273><a class=lnlinks href=#hl-17-273>273</a>
</span><span class=lnt id=hl-17-274><a class=lnlinks href=#hl-17-274>274</a>
</span><span class=lnt id=hl-17-275><a class=lnlinks href=#hl-17-275>275</a>
</span><span class=lnt id=hl-17-276><a class=lnlinks href=#hl-17-276>276</a>
</span><span class=lnt id=hl-17-277><a class=lnlinks href=#hl-17-277>277</a>
</span><span class=lnt id=hl-17-278><a class=lnlinks href=#hl-17-278>278</a>
</span><span class=lnt id=hl-17-279><a class=lnlinks href=#hl-17-279>279</a>
</span><span class=lnt id=hl-17-280><a class=lnlinks href=#hl-17-280>280</a>
</span><span class=lnt id=hl-17-281><a class=lnlinks href=#hl-17-281>281</a>
</span><span class=lnt id=hl-17-282><a class=lnlinks href=#hl-17-282>282</a>
</span><span class=lnt id=hl-17-283><a class=lnlinks href=#hl-17-283>283</a>
</span><span class=lnt id=hl-17-284><a class=lnlinks href=#hl-17-284>284</a>
</span><span class=lnt id=hl-17-285><a class=lnlinks href=#hl-17-285>285</a>
</span><span class=lnt id=hl-17-286><a class=lnlinks href=#hl-17-286>286</a>
</span><span class=lnt id=hl-17-287><a class=lnlinks href=#hl-17-287>287</a>
</span><span class=lnt id=hl-17-288><a class=lnlinks href=#hl-17-288>288</a>
</span><span class=lnt id=hl-17-289><a class=lnlinks href=#hl-17-289>289</a>
</span><span class=lnt id=hl-17-290><a class=lnlinks href=#hl-17-290>290</a>
</span><span class=lnt id=hl-17-291><a class=lnlinks href=#hl-17-291>291</a>
</span><span class=lnt id=hl-17-292><a class=lnlinks href=#hl-17-292>292</a>
</span><span class=lnt id=hl-17-293><a class=lnlinks href=#hl-17-293>293</a>
</span><span class=lnt id=hl-17-294><a class=lnlinks href=#hl-17-294>294</a>
</span><span class=lnt id=hl-17-295><a class=lnlinks href=#hl-17-295>295</a>
</span><span class=lnt id=hl-17-296><a class=lnlinks href=#hl-17-296>296</a>
</span><span class=lnt id=hl-17-297><a class=lnlinks href=#hl-17-297>297</a>
</span><span class=lnt id=hl-17-298><a class=lnlinks href=#hl-17-298>298</a>
</span><span class=lnt id=hl-17-299><a class=lnlinks href=#hl-17-299>299</a>
</span><span class=lnt id=hl-17-300><a class=lnlinks href=#hl-17-300>300</a>
</span><span class=lnt id=hl-17-301><a class=lnlinks href=#hl-17-301>301</a>
</span><span class=lnt id=hl-17-302><a class=lnlinks href=#hl-17-302>302</a>
</span><span class=lnt id=hl-17-303><a class=lnlinks href=#hl-17-303>303</a>
</span><span class=lnt id=hl-17-304><a class=lnlinks href=#hl-17-304>304</a>
</span><span class=lnt id=hl-17-305><a class=lnlinks href=#hl-17-305>305</a>
</span><span class=lnt id=hl-17-306><a class=lnlinks href=#hl-17-306>306</a>
</span><span class=lnt id=hl-17-307><a class=lnlinks href=#hl-17-307>307</a>
</span><span class=lnt id=hl-17-308><a class=lnlinks href=#hl-17-308>308</a>
</span><span class=lnt id=hl-17-309><a class=lnlinks href=#hl-17-309>309</a>
</span><span class=lnt id=hl-17-310><a class=lnlinks href=#hl-17-310>310</a>
</span><span class=lnt id=hl-17-311><a class=lnlinks href=#hl-17-311>311</a>
</span><span class=lnt id=hl-17-312><a class=lnlinks href=#hl-17-312>312</a>
</span><span class=lnt id=hl-17-313><a class=lnlinks href=#hl-17-313>313</a>
</span><span class=lnt id=hl-17-314><a class=lnlinks href=#hl-17-314>314</a>
</span><span class=lnt id=hl-17-315><a class=lnlinks href=#hl-17-315>315</a>
</span><span class=lnt id=hl-17-316><a class=lnlinks href=#hl-17-316>316</a>
</span><span class=lnt id=hl-17-317><a class=lnlinks href=#hl-17-317>317</a>
</span><span class=lnt id=hl-17-318><a class=lnlinks href=#hl-17-318>318</a>
</span><span class=lnt id=hl-17-319><a class=lnlinks href=#hl-17-319>319</a>
</span><span class=lnt id=hl-17-320><a class=lnlinks href=#hl-17-320>320</a>
</span><span class=lnt id=hl-17-321><a class=lnlinks href=#hl-17-321>321</a>
</span><span class=lnt id=hl-17-322><a class=lnlinks href=#hl-17-322>322</a>
</span><span class=lnt id=hl-17-323><a class=lnlinks href=#hl-17-323>323</a>
</span><span class=lnt id=hl-17-324><a class=lnlinks href=#hl-17-324>324</a>
</span><span class=lnt id=hl-17-325><a class=lnlinks href=#hl-17-325>325</a>
</span><span class=lnt id=hl-17-326><a class=lnlinks href=#hl-17-326>326</a>
</span><span class=lnt id=hl-17-327><a class=lnlinks href=#hl-17-327>327</a>
</span><span class=lnt id=hl-17-328><a class=lnlinks href=#hl-17-328>328</a>
</span><span class=lnt id=hl-17-329><a class=lnlinks href=#hl-17-329>329</a>
</span><span class=lnt id=hl-17-330><a class=lnlinks href=#hl-17-330>330</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kafka 이벤트 메시징 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># 비동기 이벤트 발행 및 구독을 통한 마이크로서비스 간 통신</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Callable</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aiokafka</span> <span class=kn>import</span> <span class=n>AIOKafkaProducer</span><span class=p>,</span> <span class=n>AIOKafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aiokafka.errors</span> <span class=kn>import</span> <span class=n>KafkaError</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>utils</span> <span class=kn>import</span> <span class=n>logger</span><span class=p>,</span> <span class=n>log_execution_time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventPublisher</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka 이벤트 발행자&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AIOKafkaProducer</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 프로듀서 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>AIOKafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value_serializer</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_serialize_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key_serializer</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_serialize_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>retry_backoff_ms</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>retry_backoff_ms</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>request_timeout_ms</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>request_timeout_ms</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>acks</span><span class=o>=</span><span class=s1>&#39;all&#39;</span><span class=p>,</span>  <span class=c1># 모든 리플리카에서 확인</span>
</span></span><span class=line><span class=cl>                <span class=n>enable_idempotence</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># 멱등성 보장</span>
</span></span><span class=line><span class=cl>                <span class=n>max_in_flight_requests_per_connection</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>  <span class=c1># 순서 보장</span>
</span></span><span class=line><span class=cl>                <span class=n>compression_type</span><span class=o>=</span><span class=s1>&#39;gzip&#39;</span>  <span class=c1># 압축</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 프로듀서 시작 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Kafka 프로듀서 시작 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 프로듀서 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 프로듀서 종료 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_serialize_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 값 직렬화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_serialize_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 키 직렬화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>key</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;kafka_publish_event&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Kafka 프로듀서가 시작되지 않음&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 메시지 구성</span>
</span></span><span class=line><span class=cl>            <span class=n>event_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=nb>id</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;correlation_id&#34;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;correlation_id&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;trace_id&#34;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;trace_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 토픽에 메시지 전송</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span><span class=o>=</span><span class=n>event_message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>key</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 버퍼 플러시 (즉시 전송 보장)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;이벤트 발행 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>event_id</span><span class=o>=</span><span class=n>event_message</span><span class=p>[</span><span class=s2>&#34;event_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>key</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>KafkaError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Kafka 이벤트 발행 실패&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;이벤트 발행 중 예외 발생&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka 이벤트 구독자&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>group_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>group_id</span> <span class=o>=</span> <span class=n>group_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AIOKafkaConsumer</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_handlers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_handler</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>Callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 핸들러 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=n>handler</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;이벤트 핸들러 등록&#34;</span><span class=p>,</span> <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span> <span class=n>handler</span><span class=o>=</span><span class=n>handler</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topics</span><span class=p>:</span> <span class=nb>list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 컨슈머 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>AIOKafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=n>topics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value_deserializer</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_deserialize_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key_deserializer</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_deserialize_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># 수동 커밋</span>
</span></span><span class=line><span class=cl>                <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>session_timeout_ms</span><span class=o>=</span><span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>heartbeat_interval_ms</span><span class=o>=</span><span class=mi>10000</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 컨슈머 시작 완료&#34;</span><span class=p>,</span> <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>,</span> <span class=n>topics</span><span class=o>=</span><span class=n>topics</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Kafka 컨슈머 시작 실패&#34;</span><span class=p>,</span> <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 컨슈머 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 컨슈머 종료 완료&#34;</span><span class=p>,</span> <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_deserialize_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 값 역직렬화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_deserialize_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 키 역직렬화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>key</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=n>key</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>consume_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 소비 및 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_started</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Kafka 컨슈머가 시작되지 않음&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;이벤트 소비 중 예외 발생&#34;</span><span class=p>,</span> <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;event_type&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;이벤트 수신&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>message</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>partition</span><span class=o>=</span><span class=n>message</span><span class=o>.</span><span class=n>partition</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>offset</span><span class=o>=</span><span class=n>message</span><span class=o>.</span><span class=n>offset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>event_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;event_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 핸들러 실행</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event_type</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>handler</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 처리 완료 후 커밋</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;이벤트 처리 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>handler</span><span class=o>=</span><span class=n>handler</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;등록되지 않은 이벤트 타입&#34;</span><span class=p>,</span> <span class=n>event_type</span><span class=o>=</span><span class=n>event_type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리할 수 없는 메시지도 커밋 (DLQ로 보내거나 로그만 남김)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;메시지 처리 실패&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=n>message</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>offset</span><span class=o>=</span><span class=n>message</span><span class=o>.</span><span class=n>offset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 에러 발생 시 커밋하지 않음 (재처리 대상)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderEventService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 관련 이벤트 서비스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_publisher</span><span class=p>:</span> <span class=n>EventPublisher</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>publisher</span> <span class=o>=</span> <span class=n>event_publisher</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>topic_prefix</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>order_events_topic</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;order_created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>order_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_order_updated</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 업데이트 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;order_updated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>order_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_order_status_changed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 상태 변경 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;order_status_changed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>order_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_order_cancelled</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 취소 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;order_cancelled&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>order_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_payment_completed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 완료 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;payment_completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>payment_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>payment_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;order_id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 이벤트 서비스 인스턴스</span>
</span></span><span class=line><span class=cl><span class=n>event_publisher</span> <span class=o>=</span> <span class=n>EventPublisher</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>order_event_service</span> <span class=o>=</span> <span class=n>OrderEventService</span><span class=p>(</span><span class=n>event_publisher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 핸들러 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>handle_payment_completed</span><span class=p>(</span><span class=n>event</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 완료 이벤트 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payment_data</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>payment_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;order_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;결제 완료 이벤트 처리 시작&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 상태를 &#39;결제 완료&#39;로 업데이트하는 로직</span>
</span></span><span class=line><span class=cl>        <span class=c1># (실제 구현에서는 서비스 레이어 호출)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;결제 완료 이벤트 처리 완료&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;결제 완료 이벤트 처리 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>handle_inventory_updated</span><span class=p>(</span><span class=n>event</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재고 업데이트 이벤트 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>inventory_data</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>product_id</span> <span class=o>=</span> <span class=n>inventory_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>available_quantity</span> <span class=o>=</span> <span class=n>inventory_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;available_quantity&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;재고 업데이트 이벤트 처리&#34;</span><span class=p>,</span> <span class=n>product_id</span><span class=o>=</span><span class=n>product_id</span><span class=p>,</span> <span class=n>quantity</span><span class=o>=</span><span class=n>available_quantity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재고 부족 시 대기 중인 주문 처리 로직</span>
</span></span><span class=line><span class=cl>        <span class=c1># (실제 구현에서는 서비스 레이어 호출)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;재고 업데이트 이벤트 처리 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 컨슈머 설정 (백그라운드 태스크로 실행)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>setup_event_consumers</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이벤트 컨슈머 설정 및 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 주문 서비스 컨슈머</span>
</span></span><span class=line><span class=cl>    <span class=n>order_consumer</span> <span class=o>=</span> <span class=n>EventConsumer</span><span class=p>(</span><span class=s2>&#34;order-service-group&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_consumer</span><span class=o>.</span><span class=n>register_handler</span><span class=p>(</span><span class=s2>&#34;payment_completed&#34;</span><span class=p>,</span> <span class=n>handle_payment_completed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_consumer</span><span class=o>.</span><span class=n>register_handler</span><span class=p>(</span><span class=s2>&#34;inventory_updated&#34;</span><span class=p>,</span> <span class=n>handle_inventory_updated</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 컨슈머 시작</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>order_consumer</span><span class=o>.</span><span class=n>start</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>topic_prefix</span><span class=si>}</span><span class=s2>.payment-events&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>settings</span><span class=o>.</span><span class=n>kafka</span><span class=o>.</span><span class=n>topic_prefix</span><span class=si>}</span><span class=s2>.inventory-events&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 백그라운드에서 이벤트 소비</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>order_consumer</span><span class=o>.</span><span class=n>consume_events</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>order_consumer</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=서비스-레이어-service-layer>서비스 레이어 (Service Layer)<a hidden class=anchor aria-hidden=true href=#서비스-레이어-service-layer>#</a></h4><h5 id=servicespy>services.py<a hidden class=anchor aria-hidden=true href=#servicespy>#</a></h5><p>핵심 비즈니스 로직을 담당하는 서비스 계층. 외부 서비스 통신, 주문 생성/조회/업데이트, 상태 전환 검증, 트랜잭션 관리 등을 처리한다. 분산 락을 사용한 동시성 제어, 재고 예약, 결제 연동 등의 복잡한 비즈니스 프로세스를 구현한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span><span class=lnt id=hl-18-159><a class=lnlinks href=#hl-18-159>159</a>
</span><span class=lnt id=hl-18-160><a class=lnlinks href=#hl-18-160>160</a>
</span><span class=lnt id=hl-18-161><a class=lnlinks href=#hl-18-161>161</a>
</span><span class=lnt id=hl-18-162><a class=lnlinks href=#hl-18-162>162</a>
</span><span class=lnt id=hl-18-163><a class=lnlinks href=#hl-18-163>163</a>
</span><span class=lnt id=hl-18-164><a class=lnlinks href=#hl-18-164>164</a>
</span><span class=lnt id=hl-18-165><a class=lnlinks href=#hl-18-165>165</a>
</span><span class=lnt id=hl-18-166><a class=lnlinks href=#hl-18-166>166</a>
</span><span class=lnt id=hl-18-167><a class=lnlinks href=#hl-18-167>167</a>
</span><span class=lnt id=hl-18-168><a class=lnlinks href=#hl-18-168>168</a>
</span><span class=lnt id=hl-18-169><a class=lnlinks href=#hl-18-169>169</a>
</span><span class=lnt id=hl-18-170><a class=lnlinks href=#hl-18-170>170</a>
</span><span class=lnt id=hl-18-171><a class=lnlinks href=#hl-18-171>171</a>
</span><span class=lnt id=hl-18-172><a class=lnlinks href=#hl-18-172>172</a>
</span><span class=lnt id=hl-18-173><a class=lnlinks href=#hl-18-173>173</a>
</span><span class=lnt id=hl-18-174><a class=lnlinks href=#hl-18-174>174</a>
</span><span class=lnt id=hl-18-175><a class=lnlinks href=#hl-18-175>175</a>
</span><span class=lnt id=hl-18-176><a class=lnlinks href=#hl-18-176>176</a>
</span><span class=lnt id=hl-18-177><a class=lnlinks href=#hl-18-177>177</a>
</span><span class=lnt id=hl-18-178><a class=lnlinks href=#hl-18-178>178</a>
</span><span class=lnt id=hl-18-179><a class=lnlinks href=#hl-18-179>179</a>
</span><span class=lnt id=hl-18-180><a class=lnlinks href=#hl-18-180>180</a>
</span><span class=lnt id=hl-18-181><a class=lnlinks href=#hl-18-181>181</a>
</span><span class=lnt id=hl-18-182><a class=lnlinks href=#hl-18-182>182</a>
</span><span class=lnt id=hl-18-183><a class=lnlinks href=#hl-18-183>183</a>
</span><span class=lnt id=hl-18-184><a class=lnlinks href=#hl-18-184>184</a>
</span><span class=lnt id=hl-18-185><a class=lnlinks href=#hl-18-185>185</a>
</span><span class=lnt id=hl-18-186><a class=lnlinks href=#hl-18-186>186</a>
</span><span class=lnt id=hl-18-187><a class=lnlinks href=#hl-18-187>187</a>
</span><span class=lnt id=hl-18-188><a class=lnlinks href=#hl-18-188>188</a>
</span><span class=lnt id=hl-18-189><a class=lnlinks href=#hl-18-189>189</a>
</span><span class=lnt id=hl-18-190><a class=lnlinks href=#hl-18-190>190</a>
</span><span class=lnt id=hl-18-191><a class=lnlinks href=#hl-18-191>191</a>
</span><span class=lnt id=hl-18-192><a class=lnlinks href=#hl-18-192>192</a>
</span><span class=lnt id=hl-18-193><a class=lnlinks href=#hl-18-193>193</a>
</span><span class=lnt id=hl-18-194><a class=lnlinks href=#hl-18-194>194</a>
</span><span class=lnt id=hl-18-195><a class=lnlinks href=#hl-18-195>195</a>
</span><span class=lnt id=hl-18-196><a class=lnlinks href=#hl-18-196>196</a>
</span><span class=lnt id=hl-18-197><a class=lnlinks href=#hl-18-197>197</a>
</span><span class=lnt id=hl-18-198><a class=lnlinks href=#hl-18-198>198</a>
</span><span class=lnt id=hl-18-199><a class=lnlinks href=#hl-18-199>199</a>
</span><span class=lnt id=hl-18-200><a class=lnlinks href=#hl-18-200>200</a>
</span><span class=lnt id=hl-18-201><a class=lnlinks href=#hl-18-201>201</a>
</span><span class=lnt id=hl-18-202><a class=lnlinks href=#hl-18-202>202</a>
</span><span class=lnt id=hl-18-203><a class=lnlinks href=#hl-18-203>203</a>
</span><span class=lnt id=hl-18-204><a class=lnlinks href=#hl-18-204>204</a>
</span><span class=lnt id=hl-18-205><a class=lnlinks href=#hl-18-205>205</a>
</span><span class=lnt id=hl-18-206><a class=lnlinks href=#hl-18-206>206</a>
</span><span class=lnt id=hl-18-207><a class=lnlinks href=#hl-18-207>207</a>
</span><span class=lnt id=hl-18-208><a class=lnlinks href=#hl-18-208>208</a>
</span><span class=lnt id=hl-18-209><a class=lnlinks href=#hl-18-209>209</a>
</span><span class=lnt id=hl-18-210><a class=lnlinks href=#hl-18-210>210</a>
</span><span class=lnt id=hl-18-211><a class=lnlinks href=#hl-18-211>211</a>
</span><span class=lnt id=hl-18-212><a class=lnlinks href=#hl-18-212>212</a>
</span><span class=lnt id=hl-18-213><a class=lnlinks href=#hl-18-213>213</a>
</span><span class=lnt id=hl-18-214><a class=lnlinks href=#hl-18-214>214</a>
</span><span class=lnt id=hl-18-215><a class=lnlinks href=#hl-18-215>215</a>
</span><span class=lnt id=hl-18-216><a class=lnlinks href=#hl-18-216>216</a>
</span><span class=lnt id=hl-18-217><a class=lnlinks href=#hl-18-217>217</a>
</span><span class=lnt id=hl-18-218><a class=lnlinks href=#hl-18-218>218</a>
</span><span class=lnt id=hl-18-219><a class=lnlinks href=#hl-18-219>219</a>
</span><span class=lnt id=hl-18-220><a class=lnlinks href=#hl-18-220>220</a>
</span><span class=lnt id=hl-18-221><a class=lnlinks href=#hl-18-221>221</a>
</span><span class=lnt id=hl-18-222><a class=lnlinks href=#hl-18-222>222</a>
</span><span class=lnt id=hl-18-223><a class=lnlinks href=#hl-18-223>223</a>
</span><span class=lnt id=hl-18-224><a class=lnlinks href=#hl-18-224>224</a>
</span><span class=lnt id=hl-18-225><a class=lnlinks href=#hl-18-225>225</a>
</span><span class=lnt id=hl-18-226><a class=lnlinks href=#hl-18-226>226</a>
</span><span class=lnt id=hl-18-227><a class=lnlinks href=#hl-18-227>227</a>
</span><span class=lnt id=hl-18-228><a class=lnlinks href=#hl-18-228>228</a>
</span><span class=lnt id=hl-18-229><a class=lnlinks href=#hl-18-229>229</a>
</span><span class=lnt id=hl-18-230><a class=lnlinks href=#hl-18-230>230</a>
</span><span class=lnt id=hl-18-231><a class=lnlinks href=#hl-18-231>231</a>
</span><span class=lnt id=hl-18-232><a class=lnlinks href=#hl-18-232>232</a>
</span><span class=lnt id=hl-18-233><a class=lnlinks href=#hl-18-233>233</a>
</span><span class=lnt id=hl-18-234><a class=lnlinks href=#hl-18-234>234</a>
</span><span class=lnt id=hl-18-235><a class=lnlinks href=#hl-18-235>235</a>
</span><span class=lnt id=hl-18-236><a class=lnlinks href=#hl-18-236>236</a>
</span><span class=lnt id=hl-18-237><a class=lnlinks href=#hl-18-237>237</a>
</span><span class=lnt id=hl-18-238><a class=lnlinks href=#hl-18-238>238</a>
</span><span class=lnt id=hl-18-239><a class=lnlinks href=#hl-18-239>239</a>
</span><span class=lnt id=hl-18-240><a class=lnlinks href=#hl-18-240>240</a>
</span><span class=lnt id=hl-18-241><a class=lnlinks href=#hl-18-241>241</a>
</span><span class=lnt id=hl-18-242><a class=lnlinks href=#hl-18-242>242</a>
</span><span class=lnt id=hl-18-243><a class=lnlinks href=#hl-18-243>243</a>
</span><span class=lnt id=hl-18-244><a class=lnlinks href=#hl-18-244>244</a>
</span><span class=lnt id=hl-18-245><a class=lnlinks href=#hl-18-245>245</a>
</span><span class=lnt id=hl-18-246><a class=lnlinks href=#hl-18-246>246</a>
</span><span class=lnt id=hl-18-247><a class=lnlinks href=#hl-18-247>247</a>
</span><span class=lnt id=hl-18-248><a class=lnlinks href=#hl-18-248>248</a>
</span><span class=lnt id=hl-18-249><a class=lnlinks href=#hl-18-249>249</a>
</span><span class=lnt id=hl-18-250><a class=lnlinks href=#hl-18-250>250</a>
</span><span class=lnt id=hl-18-251><a class=lnlinks href=#hl-18-251>251</a>
</span><span class=lnt id=hl-18-252><a class=lnlinks href=#hl-18-252>252</a>
</span><span class=lnt id=hl-18-253><a class=lnlinks href=#hl-18-253>253</a>
</span><span class=lnt id=hl-18-254><a class=lnlinks href=#hl-18-254>254</a>
</span><span class=lnt id=hl-18-255><a class=lnlinks href=#hl-18-255>255</a>
</span><span class=lnt id=hl-18-256><a class=lnlinks href=#hl-18-256>256</a>
</span><span class=lnt id=hl-18-257><a class=lnlinks href=#hl-18-257>257</a>
</span><span class=lnt id=hl-18-258><a class=lnlinks href=#hl-18-258>258</a>
</span><span class=lnt id=hl-18-259><a class=lnlinks href=#hl-18-259>259</a>
</span><span class=lnt id=hl-18-260><a class=lnlinks href=#hl-18-260>260</a>
</span><span class=lnt id=hl-18-261><a class=lnlinks href=#hl-18-261>261</a>
</span><span class=lnt id=hl-18-262><a class=lnlinks href=#hl-18-262>262</a>
</span><span class=lnt id=hl-18-263><a class=lnlinks href=#hl-18-263>263</a>
</span><span class=lnt id=hl-18-264><a class=lnlinks href=#hl-18-264>264</a>
</span><span class=lnt id=hl-18-265><a class=lnlinks href=#hl-18-265>265</a>
</span><span class=lnt id=hl-18-266><a class=lnlinks href=#hl-18-266>266</a>
</span><span class=lnt id=hl-18-267><a class=lnlinks href=#hl-18-267>267</a>
</span><span class=lnt id=hl-18-268><a class=lnlinks href=#hl-18-268>268</a>
</span><span class=lnt id=hl-18-269><a class=lnlinks href=#hl-18-269>269</a>
</span><span class=lnt id=hl-18-270><a class=lnlinks href=#hl-18-270>270</a>
</span><span class=lnt id=hl-18-271><a class=lnlinks href=#hl-18-271>271</a>
</span><span class=lnt id=hl-18-272><a class=lnlinks href=#hl-18-272>272</a>
</span><span class=lnt id=hl-18-273><a class=lnlinks href=#hl-18-273>273</a>
</span><span class=lnt id=hl-18-274><a class=lnlinks href=#hl-18-274>274</a>
</span><span class=lnt id=hl-18-275><a class=lnlinks href=#hl-18-275>275</a>
</span><span class=lnt id=hl-18-276><a class=lnlinks href=#hl-18-276>276</a>
</span><span class=lnt id=hl-18-277><a class=lnlinks href=#hl-18-277>277</a>
</span><span class=lnt id=hl-18-278><a class=lnlinks href=#hl-18-278>278</a>
</span><span class=lnt id=hl-18-279><a class=lnlinks href=#hl-18-279>279</a>
</span><span class=lnt id=hl-18-280><a class=lnlinks href=#hl-18-280>280</a>
</span><span class=lnt id=hl-18-281><a class=lnlinks href=#hl-18-281>281</a>
</span><span class=lnt id=hl-18-282><a class=lnlinks href=#hl-18-282>282</a>
</span><span class=lnt id=hl-18-283><a class=lnlinks href=#hl-18-283>283</a>
</span><span class=lnt id=hl-18-284><a class=lnlinks href=#hl-18-284>284</a>
</span><span class=lnt id=hl-18-285><a class=lnlinks href=#hl-18-285>285</a>
</span><span class=lnt id=hl-18-286><a class=lnlinks href=#hl-18-286>286</a>
</span><span class=lnt id=hl-18-287><a class=lnlinks href=#hl-18-287>287</a>
</span><span class=lnt id=hl-18-288><a class=lnlinks href=#hl-18-288>288</a>
</span><span class=lnt id=hl-18-289><a class=lnlinks href=#hl-18-289>289</a>
</span><span class=lnt id=hl-18-290><a class=lnlinks href=#hl-18-290>290</a>
</span><span class=lnt id=hl-18-291><a class=lnlinks href=#hl-18-291>291</a>
</span><span class=lnt id=hl-18-292><a class=lnlinks href=#hl-18-292>292</a>
</span><span class=lnt id=hl-18-293><a class=lnlinks href=#hl-18-293>293</a>
</span><span class=lnt id=hl-18-294><a class=lnlinks href=#hl-18-294>294</a>
</span><span class=lnt id=hl-18-295><a class=lnlinks href=#hl-18-295>295</a>
</span><span class=lnt id=hl-18-296><a class=lnlinks href=#hl-18-296>296</a>
</span><span class=lnt id=hl-18-297><a class=lnlinks href=#hl-18-297>297</a>
</span><span class=lnt id=hl-18-298><a class=lnlinks href=#hl-18-298>298</a>
</span><span class=lnt id=hl-18-299><a class=lnlinks href=#hl-18-299>299</a>
</span><span class=lnt id=hl-18-300><a class=lnlinks href=#hl-18-300>300</a>
</span><span class=lnt id=hl-18-301><a class=lnlinks href=#hl-18-301>301</a>
</span><span class=lnt id=hl-18-302><a class=lnlinks href=#hl-18-302>302</a>
</span><span class=lnt id=hl-18-303><a class=lnlinks href=#hl-18-303>303</a>
</span><span class=lnt id=hl-18-304><a class=lnlinks href=#hl-18-304>304</a>
</span><span class=lnt id=hl-18-305><a class=lnlinks href=#hl-18-305>305</a>
</span><span class=lnt id=hl-18-306><a class=lnlinks href=#hl-18-306>306</a>
</span><span class=lnt id=hl-18-307><a class=lnlinks href=#hl-18-307>307</a>
</span><span class=lnt id=hl-18-308><a class=lnlinks href=#hl-18-308>308</a>
</span><span class=lnt id=hl-18-309><a class=lnlinks href=#hl-18-309>309</a>
</span><span class=lnt id=hl-18-310><a class=lnlinks href=#hl-18-310>310</a>
</span><span class=lnt id=hl-18-311><a class=lnlinks href=#hl-18-311>311</a>
</span><span class=lnt id=hl-18-312><a class=lnlinks href=#hl-18-312>312</a>
</span><span class=lnt id=hl-18-313><a class=lnlinks href=#hl-18-313>313</a>
</span><span class=lnt id=hl-18-314><a class=lnlinks href=#hl-18-314>314</a>
</span><span class=lnt id=hl-18-315><a class=lnlinks href=#hl-18-315>315</a>
</span><span class=lnt id=hl-18-316><a class=lnlinks href=#hl-18-316>316</a>
</span><span class=lnt id=hl-18-317><a class=lnlinks href=#hl-18-317>317</a>
</span><span class=lnt id=hl-18-318><a class=lnlinks href=#hl-18-318>318</a>
</span><span class=lnt id=hl-18-319><a class=lnlinks href=#hl-18-319>319</a>
</span><span class=lnt id=hl-18-320><a class=lnlinks href=#hl-18-320>320</a>
</span><span class=lnt id=hl-18-321><a class=lnlinks href=#hl-18-321>321</a>
</span><span class=lnt id=hl-18-322><a class=lnlinks href=#hl-18-322>322</a>
</span><span class=lnt id=hl-18-323><a class=lnlinks href=#hl-18-323>323</a>
</span><span class=lnt id=hl-18-324><a class=lnlinks href=#hl-18-324>324</a>
</span><span class=lnt id=hl-18-325><a class=lnlinks href=#hl-18-325>325</a>
</span><span class=lnt id=hl-18-326><a class=lnlinks href=#hl-18-326>326</a>
</span><span class=lnt id=hl-18-327><a class=lnlinks href=#hl-18-327>327</a>
</span><span class=lnt id=hl-18-328><a class=lnlinks href=#hl-18-328>328</a>
</span><span class=lnt id=hl-18-329><a class=lnlinks href=#hl-18-329>329</a>
</span><span class=lnt id=hl-18-330><a class=lnlinks href=#hl-18-330>330</a>
</span><span class=lnt id=hl-18-331><a class=lnlinks href=#hl-18-331>331</a>
</span><span class=lnt id=hl-18-332><a class=lnlinks href=#hl-18-332>332</a>
</span><span class=lnt id=hl-18-333><a class=lnlinks href=#hl-18-333>333</a>
</span><span class=lnt id=hl-18-334><a class=lnlinks href=#hl-18-334>334</a>
</span><span class=lnt id=hl-18-335><a class=lnlinks href=#hl-18-335>335</a>
</span><span class=lnt id=hl-18-336><a class=lnlinks href=#hl-18-336>336</a>
</span><span class=lnt id=hl-18-337><a class=lnlinks href=#hl-18-337>337</a>
</span><span class=lnt id=hl-18-338><a class=lnlinks href=#hl-18-338>338</a>
</span><span class=lnt id=hl-18-339><a class=lnlinks href=#hl-18-339>339</a>
</span><span class=lnt id=hl-18-340><a class=lnlinks href=#hl-18-340>340</a>
</span><span class=lnt id=hl-18-341><a class=lnlinks href=#hl-18-341>341</a>
</span><span class=lnt id=hl-18-342><a class=lnlinks href=#hl-18-342>342</a>
</span><span class=lnt id=hl-18-343><a class=lnlinks href=#hl-18-343>343</a>
</span><span class=lnt id=hl-18-344><a class=lnlinks href=#hl-18-344>344</a>
</span><span class=lnt id=hl-18-345><a class=lnlinks href=#hl-18-345>345</a>
</span><span class=lnt id=hl-18-346><a class=lnlinks href=#hl-18-346>346</a>
</span><span class=lnt id=hl-18-347><a class=lnlinks href=#hl-18-347>347</a>
</span><span class=lnt id=hl-18-348><a class=lnlinks href=#hl-18-348>348</a>
</span><span class=lnt id=hl-18-349><a class=lnlinks href=#hl-18-349>349</a>
</span><span class=lnt id=hl-18-350><a class=lnlinks href=#hl-18-350>350</a>
</span><span class=lnt id=hl-18-351><a class=lnlinks href=#hl-18-351>351</a>
</span><span class=lnt id=hl-18-352><a class=lnlinks href=#hl-18-352>352</a>
</span><span class=lnt id=hl-18-353><a class=lnlinks href=#hl-18-353>353</a>
</span><span class=lnt id=hl-18-354><a class=lnlinks href=#hl-18-354>354</a>
</span><span class=lnt id=hl-18-355><a class=lnlinks href=#hl-18-355>355</a>
</span><span class=lnt id=hl-18-356><a class=lnlinks href=#hl-18-356>356</a>
</span><span class=lnt id=hl-18-357><a class=lnlinks href=#hl-18-357>357</a>
</span><span class=lnt id=hl-18-358><a class=lnlinks href=#hl-18-358>358</a>
</span><span class=lnt id=hl-18-359><a class=lnlinks href=#hl-18-359>359</a>
</span><span class=lnt id=hl-18-360><a class=lnlinks href=#hl-18-360>360</a>
</span><span class=lnt id=hl-18-361><a class=lnlinks href=#hl-18-361>361</a>
</span><span class=lnt id=hl-18-362><a class=lnlinks href=#hl-18-362>362</a>
</span><span class=lnt id=hl-18-363><a class=lnlinks href=#hl-18-363>363</a>
</span><span class=lnt id=hl-18-364><a class=lnlinks href=#hl-18-364>364</a>
</span><span class=lnt id=hl-18-365><a class=lnlinks href=#hl-18-365>365</a>
</span><span class=lnt id=hl-18-366><a class=lnlinks href=#hl-18-366>366</a>
</span><span class=lnt id=hl-18-367><a class=lnlinks href=#hl-18-367>367</a>
</span><span class=lnt id=hl-18-368><a class=lnlinks href=#hl-18-368>368</a>
</span><span class=lnt id=hl-18-369><a class=lnlinks href=#hl-18-369>369</a>
</span><span class=lnt id=hl-18-370><a class=lnlinks href=#hl-18-370>370</a>
</span><span class=lnt id=hl-18-371><a class=lnlinks href=#hl-18-371>371</a>
</span><span class=lnt id=hl-18-372><a class=lnlinks href=#hl-18-372>372</a>
</span><span class=lnt id=hl-18-373><a class=lnlinks href=#hl-18-373>373</a>
</span><span class=lnt id=hl-18-374><a class=lnlinks href=#hl-18-374>374</a>
</span><span class=lnt id=hl-18-375><a class=lnlinks href=#hl-18-375>375</a>
</span><span class=lnt id=hl-18-376><a class=lnlinks href=#hl-18-376>376</a>
</span><span class=lnt id=hl-18-377><a class=lnlinks href=#hl-18-377>377</a>
</span><span class=lnt id=hl-18-378><a class=lnlinks href=#hl-18-378>378</a>
</span><span class=lnt id=hl-18-379><a class=lnlinks href=#hl-18-379>379</a>
</span><span class=lnt id=hl-18-380><a class=lnlinks href=#hl-18-380>380</a>
</span><span class=lnt id=hl-18-381><a class=lnlinks href=#hl-18-381>381</a>
</span><span class=lnt id=hl-18-382><a class=lnlinks href=#hl-18-382>382</a>
</span><span class=lnt id=hl-18-383><a class=lnlinks href=#hl-18-383>383</a>
</span><span class=lnt id=hl-18-384><a class=lnlinks href=#hl-18-384>384</a>
</span><span class=lnt id=hl-18-385><a class=lnlinks href=#hl-18-385>385</a>
</span><span class=lnt id=hl-18-386><a class=lnlinks href=#hl-18-386>386</a>
</span><span class=lnt id=hl-18-387><a class=lnlinks href=#hl-18-387>387</a>
</span><span class=lnt id=hl-18-388><a class=lnlinks href=#hl-18-388>388</a>
</span><span class=lnt id=hl-18-389><a class=lnlinks href=#hl-18-389>389</a>
</span><span class=lnt id=hl-18-390><a class=lnlinks href=#hl-18-390>390</a>
</span><span class=lnt id=hl-18-391><a class=lnlinks href=#hl-18-391>391</a>
</span><span class=lnt id=hl-18-392><a class=lnlinks href=#hl-18-392>392</a>
</span><span class=lnt id=hl-18-393><a class=lnlinks href=#hl-18-393>393</a>
</span><span class=lnt id=hl-18-394><a class=lnlinks href=#hl-18-394>394</a>
</span><span class=lnt id=hl-18-395><a class=lnlinks href=#hl-18-395>395</a>
</span><span class=lnt id=hl-18-396><a class=lnlinks href=#hl-18-396>396</a>
</span><span class=lnt id=hl-18-397><a class=lnlinks href=#hl-18-397>397</a>
</span><span class=lnt id=hl-18-398><a class=lnlinks href=#hl-18-398>398</a>
</span><span class=lnt id=hl-18-399><a class=lnlinks href=#hl-18-399>399</a>
</span><span class=lnt id=hl-18-400><a class=lnlinks href=#hl-18-400>400</a>
</span><span class=lnt id=hl-18-401><a class=lnlinks href=#hl-18-401>401</a>
</span><span class=lnt id=hl-18-402><a class=lnlinks href=#hl-18-402>402</a>
</span><span class=lnt id=hl-18-403><a class=lnlinks href=#hl-18-403>403</a>
</span><span class=lnt id=hl-18-404><a class=lnlinks href=#hl-18-404>404</a>
</span><span class=lnt id=hl-18-405><a class=lnlinks href=#hl-18-405>405</a>
</span><span class=lnt id=hl-18-406><a class=lnlinks href=#hl-18-406>406</a>
</span><span class=lnt id=hl-18-407><a class=lnlinks href=#hl-18-407>407</a>
</span><span class=lnt id=hl-18-408><a class=lnlinks href=#hl-18-408>408</a>
</span><span class=lnt id=hl-18-409><a class=lnlinks href=#hl-18-409>409</a>
</span><span class=lnt id=hl-18-410><a class=lnlinks href=#hl-18-410>410</a>
</span><span class=lnt id=hl-18-411><a class=lnlinks href=#hl-18-411>411</a>
</span><span class=lnt id=hl-18-412><a class=lnlinks href=#hl-18-412>412</a>
</span><span class=lnt id=hl-18-413><a class=lnlinks href=#hl-18-413>413</a>
</span><span class=lnt id=hl-18-414><a class=lnlinks href=#hl-18-414>414</a>
</span><span class=lnt id=hl-18-415><a class=lnlinks href=#hl-18-415>415</a>
</span><span class=lnt id=hl-18-416><a class=lnlinks href=#hl-18-416>416</a>
</span><span class=lnt id=hl-18-417><a class=lnlinks href=#hl-18-417>417</a>
</span><span class=lnt id=hl-18-418><a class=lnlinks href=#hl-18-418>418</a>
</span><span class=lnt id=hl-18-419><a class=lnlinks href=#hl-18-419>419</a>
</span><span class=lnt id=hl-18-420><a class=lnlinks href=#hl-18-420>420</a>
</span><span class=lnt id=hl-18-421><a class=lnlinks href=#hl-18-421>421</a>
</span><span class=lnt id=hl-18-422><a class=lnlinks href=#hl-18-422>422</a>
</span><span class=lnt id=hl-18-423><a class=lnlinks href=#hl-18-423>423</a>
</span><span class=lnt id=hl-18-424><a class=lnlinks href=#hl-18-424>424</a>
</span><span class=lnt id=hl-18-425><a class=lnlinks href=#hl-18-425>425</a>
</span><span class=lnt id=hl-18-426><a class=lnlinks href=#hl-18-426>426</a>
</span><span class=lnt id=hl-18-427><a class=lnlinks href=#hl-18-427>427</a>
</span><span class=lnt id=hl-18-428><a class=lnlinks href=#hl-18-428>428</a>
</span><span class=lnt id=hl-18-429><a class=lnlinks href=#hl-18-429>429</a>
</span><span class=lnt id=hl-18-430><a class=lnlinks href=#hl-18-430>430</a>
</span><span class=lnt id=hl-18-431><a class=lnlinks href=#hl-18-431>431</a>
</span><span class=lnt id=hl-18-432><a class=lnlinks href=#hl-18-432>432</a>
</span><span class=lnt id=hl-18-433><a class=lnlinks href=#hl-18-433>433</a>
</span><span class=lnt id=hl-18-434><a class=lnlinks href=#hl-18-434>434</a>
</span><span class=lnt id=hl-18-435><a class=lnlinks href=#hl-18-435>435</a>
</span><span class=lnt id=hl-18-436><a class=lnlinks href=#hl-18-436>436</a>
</span><span class=lnt id=hl-18-437><a class=lnlinks href=#hl-18-437>437</a>
</span><span class=lnt id=hl-18-438><a class=lnlinks href=#hl-18-438>438</a>
</span><span class=lnt id=hl-18-439><a class=lnlinks href=#hl-18-439>439</a>
</span><span class=lnt id=hl-18-440><a class=lnlinks href=#hl-18-440>440</a>
</span><span class=lnt id=hl-18-441><a class=lnlinks href=#hl-18-441>441</a>
</span><span class=lnt id=hl-18-442><a class=lnlinks href=#hl-18-442>442</a>
</span><span class=lnt id=hl-18-443><a class=lnlinks href=#hl-18-443>443</a>
</span><span class=lnt id=hl-18-444><a class=lnlinks href=#hl-18-444>444</a>
</span><span class=lnt id=hl-18-445><a class=lnlinks href=#hl-18-445>445</a>
</span><span class=lnt id=hl-18-446><a class=lnlinks href=#hl-18-446>446</a>
</span><span class=lnt id=hl-18-447><a class=lnlinks href=#hl-18-447>447</a>
</span><span class=lnt id=hl-18-448><a class=lnlinks href=#hl-18-448>448</a>
</span><span class=lnt id=hl-18-449><a class=lnlinks href=#hl-18-449>449</a>
</span><span class=lnt id=hl-18-450><a class=lnlinks href=#hl-18-450>450</a>
</span><span class=lnt id=hl-18-451><a class=lnlinks href=#hl-18-451>451</a>
</span><span class=lnt id=hl-18-452><a class=lnlinks href=#hl-18-452>452</a>
</span><span class=lnt id=hl-18-453><a class=lnlinks href=#hl-18-453>453</a>
</span><span class=lnt id=hl-18-454><a class=lnlinks href=#hl-18-454>454</a>
</span><span class=lnt id=hl-18-455><a class=lnlinks href=#hl-18-455>455</a>
</span><span class=lnt id=hl-18-456><a class=lnlinks href=#hl-18-456>456</a>
</span><span class=lnt id=hl-18-457><a class=lnlinks href=#hl-18-457>457</a>
</span><span class=lnt id=hl-18-458><a class=lnlinks href=#hl-18-458>458</a>
</span><span class=lnt id=hl-18-459><a class=lnlinks href=#hl-18-459>459</a>
</span><span class=lnt id=hl-18-460><a class=lnlinks href=#hl-18-460>460</a>
</span><span class=lnt id=hl-18-461><a class=lnlinks href=#hl-18-461>461</a>
</span><span class=lnt id=hl-18-462><a class=lnlinks href=#hl-18-462>462</a>
</span><span class=lnt id=hl-18-463><a class=lnlinks href=#hl-18-463>463</a>
</span><span class=lnt id=hl-18-464><a class=lnlinks href=#hl-18-464>464</a>
</span><span class=lnt id=hl-18-465><a class=lnlinks href=#hl-18-465>465</a>
</span><span class=lnt id=hl-18-466><a class=lnlinks href=#hl-18-466>466</a>
</span><span class=lnt id=hl-18-467><a class=lnlinks href=#hl-18-467>467</a>
</span><span class=lnt id=hl-18-468><a class=lnlinks href=#hl-18-468>468</a>
</span><span class=lnt id=hl-18-469><a class=lnlinks href=#hl-18-469>469</a>
</span><span class=lnt id=hl-18-470><a class=lnlinks href=#hl-18-470>470</a>
</span><span class=lnt id=hl-18-471><a class=lnlinks href=#hl-18-471>471</a>
</span><span class=lnt id=hl-18-472><a class=lnlinks href=#hl-18-472>472</a>
</span><span class=lnt id=hl-18-473><a class=lnlinks href=#hl-18-473>473</a>
</span><span class=lnt id=hl-18-474><a class=lnlinks href=#hl-18-474>474</a>
</span><span class=lnt id=hl-18-475><a class=lnlinks href=#hl-18-475>475</a>
</span><span class=lnt id=hl-18-476><a class=lnlinks href=#hl-18-476>476</a>
</span><span class=lnt id=hl-18-477><a class=lnlinks href=#hl-18-477>477</a>
</span><span class=lnt id=hl-18-478><a class=lnlinks href=#hl-18-478>478</a>
</span><span class=lnt id=hl-18-479><a class=lnlinks href=#hl-18-479>479</a>
</span><span class=lnt id=hl-18-480><a class=lnlinks href=#hl-18-480>480</a>
</span><span class=lnt id=hl-18-481><a class=lnlinks href=#hl-18-481>481</a>
</span><span class=lnt id=hl-18-482><a class=lnlinks href=#hl-18-482>482</a>
</span><span class=lnt id=hl-18-483><a class=lnlinks href=#hl-18-483>483</a>
</span><span class=lnt id=hl-18-484><a class=lnlinks href=#hl-18-484>484</a>
</span><span class=lnt id=hl-18-485><a class=lnlinks href=#hl-18-485>485</a>
</span><span class=lnt id=hl-18-486><a class=lnlinks href=#hl-18-486>486</a>
</span><span class=lnt id=hl-18-487><a class=lnlinks href=#hl-18-487>487</a>
</span><span class=lnt id=hl-18-488><a class=lnlinks href=#hl-18-488>488</a>
</span><span class=lnt id=hl-18-489><a class=lnlinks href=#hl-18-489>489</a>
</span><span class=lnt id=hl-18-490><a class=lnlinks href=#hl-18-490>490</a>
</span><span class=lnt id=hl-18-491><a class=lnlinks href=#hl-18-491>491</a>
</span><span class=lnt id=hl-18-492><a class=lnlinks href=#hl-18-492>492</a>
</span><span class=lnt id=hl-18-493><a class=lnlinks href=#hl-18-493>493</a>
</span><span class=lnt id=hl-18-494><a class=lnlinks href=#hl-18-494>494</a>
</span><span class=lnt id=hl-18-495><a class=lnlinks href=#hl-18-495>495</a>
</span><span class=lnt id=hl-18-496><a class=lnlinks href=#hl-18-496>496</a>
</span><span class=lnt id=hl-18-497><a class=lnlinks href=#hl-18-497>497</a>
</span><span class=lnt id=hl-18-498><a class=lnlinks href=#hl-18-498>498</a>
</span><span class=lnt id=hl-18-499><a class=lnlinks href=#hl-18-499>499</a>
</span><span class=lnt id=hl-18-500><a class=lnlinks href=#hl-18-500>500</a>
</span><span class=lnt id=hl-18-501><a class=lnlinks href=#hl-18-501>501</a>
</span><span class=lnt id=hl-18-502><a class=lnlinks href=#hl-18-502>502</a>
</span><span class=lnt id=hl-18-503><a class=lnlinks href=#hl-18-503>503</a>
</span><span class=lnt id=hl-18-504><a class=lnlinks href=#hl-18-504>504</a>
</span><span class=lnt id=hl-18-505><a class=lnlinks href=#hl-18-505>505</a>
</span><span class=lnt id=hl-18-506><a class=lnlinks href=#hl-18-506>506</a>
</span><span class=lnt id=hl-18-507><a class=lnlinks href=#hl-18-507>507</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 비즈니스 로직 서비스 레이어 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># 주문 처리, 외부 서비스 통신, 트랜잭션 관리를 담당</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>httpx</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Tuple</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>and_</span><span class=p>,</span> <span class=n>or_</span><span class=p>,</span> <span class=n>desc</span><span class=p>,</span> <span class=n>func</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>models</span> <span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>OrderModel</span><span class=p>,</span> <span class=n>OrderCreateRequest</span><span class=p>,</span> <span class=n>OrderResponse</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>PaymentStatus</span><span class=p>,</span> <span class=n>OrderStatusUpdateRequest</span><span class=p>,</span> <span class=n>MultiOrderCreateRequest</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>database</span> <span class=kn>import</span> <span class=n>db_manager</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cache</span> <span class=kn>import</span> <span class=n>order_cache</span><span class=p>,</span> <span class=n>distributed_lock</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>messaging</span> <span class=kn>import</span> <span class=n>order_event_service</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>utils</span> <span class=kn>import</span> <span class=n>logger</span><span class=p>,</span> <span class=n>log_execution_time</span><span class=p>,</span> <span class=n>metrics</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ExternalServiceClient</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;외부 서비스 통신 클라이언트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Timeout</span><span class=p>(</span><span class=n>settings</span><span class=o>.</span><span class=n>external_services</span><span class=o>.</span><span class=n>http_timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_attempts</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>external_services</span><span class=o>.</span><span class=n>retry_attempts</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_make_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>httpx</span><span class=o>.</span><span class=n>Response</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;HTTP 요청 실행 (재시도 로직 포함)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_attempts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>async</span> <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>timeout</span><span class=p>)</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>httpx</span><span class=o>.</span><span class=n>HTTPStatusError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>&lt;</span> <span class=mi>500</span><span class=p>:</span>  <span class=c1># 4xx 에러는 재시도하지 않음</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;클라이언트 에러 - 재시도 안함&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>status_code</span><span class=o>=</span><span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>attempt</span><span class=o>=</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_attempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;최대 재시도 횟수 초과&#34;</span><span class=p>,</span> <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>attempt</span><span class=o>=</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 지수 백오프 재시도</span>
</span></span><span class=line><span class=cl>                <span class=n>wait_time</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;서버 에러 - 재시도 예정&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>status_code</span><span class=o>=</span><span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>attempt</span><span class=o>=</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>wait_time</span><span class=o>=</span><span class=n>wait_time</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_attempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;HTTP 요청 실패&#34;</span><span class=p>,</span> <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>attempt</span><span class=o>=</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>wait_time</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사용자 서비스 클라이언트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>:</span> <span class=n>ExternalServiceClient</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>external_services</span><span class=o>.</span><span class=n>user_service_url</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;user_service_verify&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>verify_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 존재 여부 검증&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/users/</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>_make_request</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;사용자 검증 성공&#34;</span><span class=p>,</span> <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;사용자 검증 실패&#34;</span><span class=p>,</span> <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_user_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 정보 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/users/</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>_make_request</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProductService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;상품 서비스 클라이언트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>:</span> <span class=n>ExternalServiceClient</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>external_services</span><span class=o>.</span><span class=n>product_service_url</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;product_service_get_price&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_product_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;상품 정보 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/products/</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>_make_request</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>product_info</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;상품 정보 조회 성공&#34;</span><span class=p>,</span> <span class=n>product_id</span><span class=o>=</span><span class=n>product_id</span><span class=p>,</span> <span class=n>price</span><span class=o>=</span><span class=n>product_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;price&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>product_info</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;상품 정보 조회 실패&#34;</span><span class=p>,</span> <span class=n>product_id</span><span class=o>=</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 확인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/products/</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>/inventory&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>_make_request</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>inventory_info</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>available_quantity</span> <span class=o>=</span> <span class=n>inventory_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;available_quantity&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>available_quantity</span> <span class=o>&gt;=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>reserve_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>reservation_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 예약&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/products/</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>/reserve&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;reservation_id&#34;</span><span class=p>:</span> <span class=n>reservation_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;expires_at&#34;</span><span class=p>:</span> <span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>15</span><span class=p>))</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>_make_request</span><span class=p>(</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;결제 서비스 클라이언트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>:</span> <span class=n>ExternalServiceClient</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>external_services</span><span class=o>.</span><span class=n>payment_service_url</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/payments&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;currency&#34;</span><span class=p>:</span> <span class=s2>&#34;KRW&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>_make_request</span><span class=p>(</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>201</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>payment_info</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>payment_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;payment_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 처리 핵심 서비스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>external_client</span> <span class=o>=</span> <span class=n>ExternalServiceClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>user_service</span> <span class=o>=</span> <span class=n>UserService</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>external_client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_service</span> <span class=o>=</span> <span class=n>ProductService</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>external_client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment_service</span> <span class=o>=</span> <span class=n>PaymentService</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>external_client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_generate_order_number</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 번호 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y%m</span><span class=si>%d</span><span class=s2>%H%M%S&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>unique_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;-&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)[:</span><span class=mi>8</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;ORD</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>unique_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;order_creation&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_request</span><span class=p>:</span> <span class=n>OrderCreateRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>OrderResponse</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;새 주문 생성 (단일 상품)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 분산 락을 사용한 동시성 제어</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_resource</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;order_creation_user_</span><span class=si>{</span><span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_value</span> <span class=o>=</span> <span class=k>await</span> <span class=n>distributed_lock</span><span class=o>.</span><span class=n>acquire_lock</span><span class=p>(</span><span class=n>lock_resource</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>lock_value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;주문 생성 중 동시성 제어 실패 - 잠시 후 다시 시도해주세요&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1. 사용자 검증</span>
</span></span><span class=line><span class=cl>            <span class=n>user_exists</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_service</span><span class=o>.</span><span class=n>verify_user</span><span class=p>(</span><span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>user_exists</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;존재하지 않는 사용자입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2. 상품 정보 조회</span>
</span></span><span class=line><span class=cl>            <span class=n>product_info</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_service</span><span class=o>.</span><span class=n>get_product_info</span><span class=p>(</span><span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>product_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;존재하지 않는 상품입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3. 재고 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>inventory_available</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_service</span><span class=o>.</span><span class=n>check_inventory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>order_request</span><span class=o>.</span><span class=n>quantity</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>inventory_available</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;재고가 부족합니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 4. 총 금액 계산</span>
</span></span><span class=line><span class=cl>            <span class=n>product_price</span> <span class=o>=</span> <span class=n>product_info</span><span class=p>[</span><span class=s2>&#34;price&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>total_amount</span> <span class=o>=</span> <span class=n>product_price</span> <span class=o>*</span> <span class=n>order_request</span><span class=o>.</span><span class=n>quantity</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 5. 재고 예약</span>
</span></span><span class=line><span class=cl>            <span class=n>reservation_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>reservation_success</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_service</span><span class=o>.</span><span class=n>reserve_inventory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>order_request</span><span class=o>.</span><span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>reservation_id</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>reservation_success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;재고 예약에 실패했습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 6. 데이터베이스 트랜잭션으로 주문 생성</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>get_session_context</span><span class=p>()</span> <span class=k>as</span> <span class=n>db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>order_number</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_order_number</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>db_order</span> <span class=o>=</span> <span class=n>OrderModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>order_number</span><span class=o>=</span><span class=n>order_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>user_id</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>product_id</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>product_name</span><span class=o>=</span><span class=n>product_info</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=n>product_price</span><span class=o>=</span><span class=n>product_price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>quantity</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>total_amount</span><span class=o>=</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>status</span><span class=o>=</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>payment_status</span><span class=o>=</span><span class=n>PaymentStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>shipping_address</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>shipping_address</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>billing_address</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>billing_address</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>notes</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>notes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>metadata</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;reservation_id&#34;</span><span class=p>:</span> <span class=n>reservation_id</span><span class=p>})</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>db</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>db</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>  <span class=c1># ID 생성을 위한 플러시</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 7. 결제 생성</span>
</span></span><span class=line><span class=cl>                <span class=n>payment_id</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>payment_service</span><span class=o>.</span><span class=n>create_payment</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>db_order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>payment_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 ID를 메타데이터에 추가</span>
</span></span><span class=line><span class=cl>                    <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>db_order</span><span class=o>.</span><span class=n>metadata</span> <span class=ow>or</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>metadata</span><span class=p>[</span><span class=s2>&#34;payment_id&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>payment_id</span>
</span></span><span class=line><span class=cl>                    <span class=n>db_order</span><span class=o>.</span><span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>db</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>db</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 8. 응답 데이터 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>order_response</span> <span class=o>=</span> <span class=n>OrderResponse</span><span class=o>.</span><span class=n>from_orm</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 9. 캐시 저장</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>set_order</span><span class=p>(</span><span class=n>db_order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>order_response</span><span class=o>.</span><span class=n>dict</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 10. 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>order_event_service</span><span class=o>.</span><span class=n>publish_order_created</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;order_number&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>order_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;total_amount&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;payment_id&#34;</span><span class=p>:</span> <span class=n>payment_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;reservation_id&#34;</span><span class=p>:</span> <span class=n>reservation_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;created_at&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>created_at</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 11. 메트릭 기록</span>
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;orders_created_total&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;orders_by_status&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;주문 생성 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>order_id</span><span class=o>=</span><span class=n>db_order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>order_number</span><span class=o>=</span><span class=n>order_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>user_id</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>total_amount</span><span class=o>=</span><span class=n>total_amount</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 분산 락 해제</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>distributed_lock</span><span class=o>.</span><span class=n>release_lock</span><span class=p>(</span><span class=n>lock_resource</span><span class=p>,</span> <span class=n>lock_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;order_retrieval&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>OrderResponse</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 조회 (캐시 우선)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 1. 캐시에서 먼저 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>cached_order</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>cached_order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;cache_hits&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;order&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>OrderResponse</span><span class=p>(</span><span class=o>**</span><span class=n>cached_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 2. 데이터베이스에서 조회</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>get_session_context</span><span class=p>()</span> <span class=k>as</span> <span class=n>db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>OrderModel</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>order_id</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>db_order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>order_response</span> <span class=o>=</span> <span class=n>OrderResponse</span><span class=o>.</span><span class=n>from_orm</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3. 캐시에 저장</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>set_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>order_response</span><span class=o>.</span><span class=n>dict</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;cache_misses&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;order&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;orders_retrieved_total&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@log_execution_time</span><span class=p>(</span><span class=s2>&#34;order_status_update&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_order_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>status_update</span><span class=p>:</span> <span class=n>OrderStatusUpdateRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>OrderResponse</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 상태 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>get_session_context</span><span class=p>()</span> <span class=k>as</span> <span class=n>db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>OrderModel</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>order_id</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>db_order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;주문을 찾을 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태 변경 검증 로직</span>
</span></span><span class=line><span class=cl>            <span class=n>old_status</span> <span class=o>=</span> <span class=n>db_order</span><span class=o>.</span><span class=n>status</span>
</span></span><span class=line><span class=cl>            <span class=n>new_status</span> <span class=o>=</span> <span class=n>status_update</span><span class=o>.</span><span class=n>status</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_valid_status_transition</span><span class=p>(</span><span class=n>old_status</span><span class=p>,</span> <span class=n>new_status</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;잘못된 상태 전환: </span><span class=si>{</span><span class=n>old_status</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>new_status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>new_status</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span><span class=o>.</span><span class=n>updated_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태별 타임스탬프 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>new_status</span> <span class=o>==</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>db_order</span><span class=o>.</span><span class=n>confirmed_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>new_status</span> <span class=o>==</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>SHIPPED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>db_order</span><span class=o>.</span><span class=n>shipped_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>new_status</span> <span class=o>==</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>DELIVERED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>db_order</span><span class=o>.</span><span class=n>delivered_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>new_status</span> <span class=o>==</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>db_order</span><span class=o>.</span><span class=n>cancelled_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>status_update</span><span class=o>.</span><span class=n>notes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>existing_notes</span> <span class=o>=</span> <span class=n>db_order</span><span class=o>.</span><span class=n>notes</span> <span class=ow>or</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>db_order</span><span class=o>.</span><span class=n>notes</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>existing_notes</span><span class=si>}</span><span class=se>\n</span><span class=s2>[</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>] </span><span class=si>{</span><span class=n>status_update</span><span class=o>.</span><span class=n>notes</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>db</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>db</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 캐시 무효화</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>delete_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>order_response</span> <span class=o>=</span> <span class=n>OrderResponse</span><span class=o>.</span><span class=n>from_orm</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>order_event_service</span><span class=o>.</span><span class=n>publish_order_status_changed</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_number&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>order_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;old_status&#34;</span><span class=p>:</span> <span class=n>old_status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;new_status&#34;</span><span class=p>:</span> <span class=n>new_status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;updated_at&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>updated_at</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;notes&#34;</span><span class=p>:</span> <span class=n>status_update</span><span class=o>.</span><span class=n>notes</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메트릭 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;order_status_updates_total&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;orders_by_status&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=n>new_status</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;주문 상태 업데이트 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>old_status</span><span class=o>=</span><span class=n>old_status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>new_status</span><span class=o>=</span><span class=n>new_status</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_is_valid_status_transition</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>old_status</span><span class=p>:</span> <span class=n>OrderStatus</span><span class=p>,</span> <span class=n>new_status</span><span class=p>:</span> <span class=n>OrderStatus</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 상태 전환 유효성 검증&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>valid_transitions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>:</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span><span class=p>:</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>PAID</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>PAID</span><span class=p>:</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>PROCESSING</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>PROCESSING</span><span class=p>:</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>SHIPPED</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>SHIPPED</span><span class=p>:</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>DELIVERED</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>DELIVERED</span><span class=p>:</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>REFUNDED</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span><span class=o>.</span><span class=n>REFUNDED</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>new_status</span> <span class=ow>in</span> <span class=n>valid_transitions</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>old_status</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>list_orders</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>OrderStatus</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>OrderResponse</span><span class=p>],</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 목록 조회 (필터링 및 페이징)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>get_session_context</span><span class=p>()</span> <span class=k>as</span> <span class=n>db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 기본 쿼리</span>
</span></span><span class=line><span class=cl>            <span class=n>query</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>OrderModel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>count_query</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>func</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 필터 적용</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>user_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>user_id</span> <span class=o>==</span> <span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>count_query</span> <span class=o>=</span> <span class=n>count_query</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>user_id</span> <span class=o>==</span> <span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>status</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=n>status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>count_query</span> <span class=o>=</span> <span class=n>count_query</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=n>status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 총 개수 조회</span>
</span></span><span class=line><span class=cl>            <span class=n>total_count</span> <span class=o>=</span> <span class=n>count_query</span><span class=o>.</span><span class=n>scalar</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 페이징 및 정렬</span>
</span></span><span class=line><span class=cl>            <span class=n>orders</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>query</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=n>desc</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>created_at</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>order_responses</span> <span class=o>=</span> <span class=p>[</span><span class=n>OrderResponse</span><span class=o>.</span><span class=n>from_orm</span><span class=p>(</span><span class=n>order</span><span class=p>)</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=n>orders</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;order_list_queries_total&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>order_responses</span><span class=p>,</span> <span class=n>total_count</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>cancel_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>OrderResponse</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 취소&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>get_session_context</span><span class=p>()</span> <span class=k>as</span> <span class=n>db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>OrderModel</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>OrderModel</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>order_id</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>db_order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;주문을 찾을 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>db_order</span><span class=o>.</span><span class=n>status</span> <span class=ow>in</span> <span class=p>[</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>DELIVERED</span><span class=p>,</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>REFUNDED</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;취소할 수 없는 주문 상태입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 주문 취소 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CANCELLED</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span><span class=o>.</span><span class=n>cancelled_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span><span class=o>.</span><span class=n>updated_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 취소 사유 추가</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cancel_note</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>] 주문 취소: </span><span class=si>{</span><span class=n>reason</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>existing_notes</span> <span class=o>=</span> <span class=n>db_order</span><span class=o>.</span><span class=n>notes</span> <span class=ow>or</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>db_order</span><span class=o>.</span><span class=n>notes</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>existing_notes</span><span class=si>}</span><span class=se>\n</span><span class=si>{</span><span class=n>cancel_note</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>db</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>db</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 캐시 무효화</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>delete_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재고 해제 및 결제 취소를 위한 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>order_event_service</span><span class=o>.</span><span class=n>publish_order_cancelled</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_number&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>order_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=n>reason</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;cancelled_at&#34;</span><span class=p>:</span> <span class=n>db_order</span><span class=o>.</span><span class=n>cancelled_at</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order_response</span> <span class=o>=</span> <span class=n>OrderResponse</span><span class=o>.</span><span class=n>from_orm</span><span class=p>(</span><span class=n>db_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;주문 취소 완료&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>,</span> <span class=n>reason</span><span class=o>=</span><span class=n>reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전역 서비스 인스턴스</span>
</span></span><span class=line><span class=cl><span class=n>order_service</span> <span class=o>=</span> <span class=n>OrderService</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=api-레이어-api-layer>API 레이어 (API Layer)<a hidden class=anchor aria-hidden=true href=#api-레이어-api-layer>#</a></h4><h5 id=mainpy>main.py<a hidden class=anchor aria-hidden=true href=#mainpy>#</a></h5><p>FastAPI 기반의 REST API 엔드포인트를 정의한다. HTTP 미들웨어, 에러 핸들링, 의존성 주입, 헬스 체크, 메트릭 수집 등의 기능을 포함한다. OpenAPI 문서 자동 생성, CORS 설정, 보안 미들웨어 등 웹 애플리케이션에 필요한 모든 기능을 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>  1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>  2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>  3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>  4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>  5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>  6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>  7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>  8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>  9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10> 10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11> 11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12> 12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13> 13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14> 14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15> 15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16> 16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17> 17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18> 18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19> 19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20> 20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21> 21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22> 22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23> 23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24> 24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25> 25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26> 26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27> 27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28> 28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29> 29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30> 30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31> 31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32> 32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33> 33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34> 34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35> 35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36> 36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37> 37</a>
</span><span class=lnt id=hl-19-38><a class=lnlinks href=#hl-19-38> 38</a>
</span><span class=lnt id=hl-19-39><a class=lnlinks href=#hl-19-39> 39</a>
</span><span class=lnt id=hl-19-40><a class=lnlinks href=#hl-19-40> 40</a>
</span><span class=lnt id=hl-19-41><a class=lnlinks href=#hl-19-41> 41</a>
</span><span class=lnt id=hl-19-42><a class=lnlinks href=#hl-19-42> 42</a>
</span><span class=lnt id=hl-19-43><a class=lnlinks href=#hl-19-43> 43</a>
</span><span class=lnt id=hl-19-44><a class=lnlinks href=#hl-19-44> 44</a>
</span><span class=lnt id=hl-19-45><a class=lnlinks href=#hl-19-45> 45</a>
</span><span class=lnt id=hl-19-46><a class=lnlinks href=#hl-19-46> 46</a>
</span><span class=lnt id=hl-19-47><a class=lnlinks href=#hl-19-47> 47</a>
</span><span class=lnt id=hl-19-48><a class=lnlinks href=#hl-19-48> 48</a>
</span><span class=lnt id=hl-19-49><a class=lnlinks href=#hl-19-49> 49</a>
</span><span class=lnt id=hl-19-50><a class=lnlinks href=#hl-19-50> 50</a>
</span><span class=lnt id=hl-19-51><a class=lnlinks href=#hl-19-51> 51</a>
</span><span class=lnt id=hl-19-52><a class=lnlinks href=#hl-19-52> 52</a>
</span><span class=lnt id=hl-19-53><a class=lnlinks href=#hl-19-53> 53</a>
</span><span class=lnt id=hl-19-54><a class=lnlinks href=#hl-19-54> 54</a>
</span><span class=lnt id=hl-19-55><a class=lnlinks href=#hl-19-55> 55</a>
</span><span class=lnt id=hl-19-56><a class=lnlinks href=#hl-19-56> 56</a>
</span><span class=lnt id=hl-19-57><a class=lnlinks href=#hl-19-57> 57</a>
</span><span class=lnt id=hl-19-58><a class=lnlinks href=#hl-19-58> 58</a>
</span><span class=lnt id=hl-19-59><a class=lnlinks href=#hl-19-59> 59</a>
</span><span class=lnt id=hl-19-60><a class=lnlinks href=#hl-19-60> 60</a>
</span><span class=lnt id=hl-19-61><a class=lnlinks href=#hl-19-61> 61</a>
</span><span class=lnt id=hl-19-62><a class=lnlinks href=#hl-19-62> 62</a>
</span><span class=lnt id=hl-19-63><a class=lnlinks href=#hl-19-63> 63</a>
</span><span class=lnt id=hl-19-64><a class=lnlinks href=#hl-19-64> 64</a>
</span><span class=lnt id=hl-19-65><a class=lnlinks href=#hl-19-65> 65</a>
</span><span class=lnt id=hl-19-66><a class=lnlinks href=#hl-19-66> 66</a>
</span><span class=lnt id=hl-19-67><a class=lnlinks href=#hl-19-67> 67</a>
</span><span class=lnt id=hl-19-68><a class=lnlinks href=#hl-19-68> 68</a>
</span><span class=lnt id=hl-19-69><a class=lnlinks href=#hl-19-69> 69</a>
</span><span class=lnt id=hl-19-70><a class=lnlinks href=#hl-19-70> 70</a>
</span><span class=lnt id=hl-19-71><a class=lnlinks href=#hl-19-71> 71</a>
</span><span class=lnt id=hl-19-72><a class=lnlinks href=#hl-19-72> 72</a>
</span><span class=lnt id=hl-19-73><a class=lnlinks href=#hl-19-73> 73</a>
</span><span class=lnt id=hl-19-74><a class=lnlinks href=#hl-19-74> 74</a>
</span><span class=lnt id=hl-19-75><a class=lnlinks href=#hl-19-75> 75</a>
</span><span class=lnt id=hl-19-76><a class=lnlinks href=#hl-19-76> 76</a>
</span><span class=lnt id=hl-19-77><a class=lnlinks href=#hl-19-77> 77</a>
</span><span class=lnt id=hl-19-78><a class=lnlinks href=#hl-19-78> 78</a>
</span><span class=lnt id=hl-19-79><a class=lnlinks href=#hl-19-79> 79</a>
</span><span class=lnt id=hl-19-80><a class=lnlinks href=#hl-19-80> 80</a>
</span><span class=lnt id=hl-19-81><a class=lnlinks href=#hl-19-81> 81</a>
</span><span class=lnt id=hl-19-82><a class=lnlinks href=#hl-19-82> 82</a>
</span><span class=lnt id=hl-19-83><a class=lnlinks href=#hl-19-83> 83</a>
</span><span class=lnt id=hl-19-84><a class=lnlinks href=#hl-19-84> 84</a>
</span><span class=lnt id=hl-19-85><a class=lnlinks href=#hl-19-85> 85</a>
</span><span class=lnt id=hl-19-86><a class=lnlinks href=#hl-19-86> 86</a>
</span><span class=lnt id=hl-19-87><a class=lnlinks href=#hl-19-87> 87</a>
</span><span class=lnt id=hl-19-88><a class=lnlinks href=#hl-19-88> 88</a>
</span><span class=lnt id=hl-19-89><a class=lnlinks href=#hl-19-89> 89</a>
</span><span class=lnt id=hl-19-90><a class=lnlinks href=#hl-19-90> 90</a>
</span><span class=lnt id=hl-19-91><a class=lnlinks href=#hl-19-91> 91</a>
</span><span class=lnt id=hl-19-92><a class=lnlinks href=#hl-19-92> 92</a>
</span><span class=lnt id=hl-19-93><a class=lnlinks href=#hl-19-93> 93</a>
</span><span class=lnt id=hl-19-94><a class=lnlinks href=#hl-19-94> 94</a>
</span><span class=lnt id=hl-19-95><a class=lnlinks href=#hl-19-95> 95</a>
</span><span class=lnt id=hl-19-96><a class=lnlinks href=#hl-19-96> 96</a>
</span><span class=lnt id=hl-19-97><a class=lnlinks href=#hl-19-97> 97</a>
</span><span class=lnt id=hl-19-98><a class=lnlinks href=#hl-19-98> 98</a>
</span><span class=lnt id=hl-19-99><a class=lnlinks href=#hl-19-99> 99</a>
</span><span class=lnt id=hl-19-100><a class=lnlinks href=#hl-19-100>100</a>
</span><span class=lnt id=hl-19-101><a class=lnlinks href=#hl-19-101>101</a>
</span><span class=lnt id=hl-19-102><a class=lnlinks href=#hl-19-102>102</a>
</span><span class=lnt id=hl-19-103><a class=lnlinks href=#hl-19-103>103</a>
</span><span class=lnt id=hl-19-104><a class=lnlinks href=#hl-19-104>104</a>
</span><span class=lnt id=hl-19-105><a class=lnlinks href=#hl-19-105>105</a>
</span><span class=lnt id=hl-19-106><a class=lnlinks href=#hl-19-106>106</a>
</span><span class=lnt id=hl-19-107><a class=lnlinks href=#hl-19-107>107</a>
</span><span class=lnt id=hl-19-108><a class=lnlinks href=#hl-19-108>108</a>
</span><span class=lnt id=hl-19-109><a class=lnlinks href=#hl-19-109>109</a>
</span><span class=lnt id=hl-19-110><a class=lnlinks href=#hl-19-110>110</a>
</span><span class=lnt id=hl-19-111><a class=lnlinks href=#hl-19-111>111</a>
</span><span class=lnt id=hl-19-112><a class=lnlinks href=#hl-19-112>112</a>
</span><span class=lnt id=hl-19-113><a class=lnlinks href=#hl-19-113>113</a>
</span><span class=lnt id=hl-19-114><a class=lnlinks href=#hl-19-114>114</a>
</span><span class=lnt id=hl-19-115><a class=lnlinks href=#hl-19-115>115</a>
</span><span class=lnt id=hl-19-116><a class=lnlinks href=#hl-19-116>116</a>
</span><span class=lnt id=hl-19-117><a class=lnlinks href=#hl-19-117>117</a>
</span><span class=lnt id=hl-19-118><a class=lnlinks href=#hl-19-118>118</a>
</span><span class=lnt id=hl-19-119><a class=lnlinks href=#hl-19-119>119</a>
</span><span class=lnt id=hl-19-120><a class=lnlinks href=#hl-19-120>120</a>
</span><span class=lnt id=hl-19-121><a class=lnlinks href=#hl-19-121>121</a>
</span><span class=lnt id=hl-19-122><a class=lnlinks href=#hl-19-122>122</a>
</span><span class=lnt id=hl-19-123><a class=lnlinks href=#hl-19-123>123</a>
</span><span class=lnt id=hl-19-124><a class=lnlinks href=#hl-19-124>124</a>
</span><span class=lnt id=hl-19-125><a class=lnlinks href=#hl-19-125>125</a>
</span><span class=lnt id=hl-19-126><a class=lnlinks href=#hl-19-126>126</a>
</span><span class=lnt id=hl-19-127><a class=lnlinks href=#hl-19-127>127</a>
</span><span class=lnt id=hl-19-128><a class=lnlinks href=#hl-19-128>128</a>
</span><span class=lnt id=hl-19-129><a class=lnlinks href=#hl-19-129>129</a>
</span><span class=lnt id=hl-19-130><a class=lnlinks href=#hl-19-130>130</a>
</span><span class=lnt id=hl-19-131><a class=lnlinks href=#hl-19-131>131</a>
</span><span class=lnt id=hl-19-132><a class=lnlinks href=#hl-19-132>132</a>
</span><span class=lnt id=hl-19-133><a class=lnlinks href=#hl-19-133>133</a>
</span><span class=lnt id=hl-19-134><a class=lnlinks href=#hl-19-134>134</a>
</span><span class=lnt id=hl-19-135><a class=lnlinks href=#hl-19-135>135</a>
</span><span class=lnt id=hl-19-136><a class=lnlinks href=#hl-19-136>136</a>
</span><span class=lnt id=hl-19-137><a class=lnlinks href=#hl-19-137>137</a>
</span><span class=lnt id=hl-19-138><a class=lnlinks href=#hl-19-138>138</a>
</span><span class=lnt id=hl-19-139><a class=lnlinks href=#hl-19-139>139</a>
</span><span class=lnt id=hl-19-140><a class=lnlinks href=#hl-19-140>140</a>
</span><span class=lnt id=hl-19-141><a class=lnlinks href=#hl-19-141>141</a>
</span><span class=lnt id=hl-19-142><a class=lnlinks href=#hl-19-142>142</a>
</span><span class=lnt id=hl-19-143><a class=lnlinks href=#hl-19-143>143</a>
</span><span class=lnt id=hl-19-144><a class=lnlinks href=#hl-19-144>144</a>
</span><span class=lnt id=hl-19-145><a class=lnlinks href=#hl-19-145>145</a>
</span><span class=lnt id=hl-19-146><a class=lnlinks href=#hl-19-146>146</a>
</span><span class=lnt id=hl-19-147><a class=lnlinks href=#hl-19-147>147</a>
</span><span class=lnt id=hl-19-148><a class=lnlinks href=#hl-19-148>148</a>
</span><span class=lnt id=hl-19-149><a class=lnlinks href=#hl-19-149>149</a>
</span><span class=lnt id=hl-19-150><a class=lnlinks href=#hl-19-150>150</a>
</span><span class=lnt id=hl-19-151><a class=lnlinks href=#hl-19-151>151</a>
</span><span class=lnt id=hl-19-152><a class=lnlinks href=#hl-19-152>152</a>
</span><span class=lnt id=hl-19-153><a class=lnlinks href=#hl-19-153>153</a>
</span><span class=lnt id=hl-19-154><a class=lnlinks href=#hl-19-154>154</a>
</span><span class=lnt id=hl-19-155><a class=lnlinks href=#hl-19-155>155</a>
</span><span class=lnt id=hl-19-156><a class=lnlinks href=#hl-19-156>156</a>
</span><span class=lnt id=hl-19-157><a class=lnlinks href=#hl-19-157>157</a>
</span><span class=lnt id=hl-19-158><a class=lnlinks href=#hl-19-158>158</a>
</span><span class=lnt id=hl-19-159><a class=lnlinks href=#hl-19-159>159</a>
</span><span class=lnt id=hl-19-160><a class=lnlinks href=#hl-19-160>160</a>
</span><span class=lnt id=hl-19-161><a class=lnlinks href=#hl-19-161>161</a>
</span><span class=lnt id=hl-19-162><a class=lnlinks href=#hl-19-162>162</a>
</span><span class=lnt id=hl-19-163><a class=lnlinks href=#hl-19-163>163</a>
</span><span class=lnt id=hl-19-164><a class=lnlinks href=#hl-19-164>164</a>
</span><span class=lnt id=hl-19-165><a class=lnlinks href=#hl-19-165>165</a>
</span><span class=lnt id=hl-19-166><a class=lnlinks href=#hl-19-166>166</a>
</span><span class=lnt id=hl-19-167><a class=lnlinks href=#hl-19-167>167</a>
</span><span class=lnt id=hl-19-168><a class=lnlinks href=#hl-19-168>168</a>
</span><span class=lnt id=hl-19-169><a class=lnlinks href=#hl-19-169>169</a>
</span><span class=lnt id=hl-19-170><a class=lnlinks href=#hl-19-170>170</a>
</span><span class=lnt id=hl-19-171><a class=lnlinks href=#hl-19-171>171</a>
</span><span class=lnt id=hl-19-172><a class=lnlinks href=#hl-19-172>172</a>
</span><span class=lnt id=hl-19-173><a class=lnlinks href=#hl-19-173>173</a>
</span><span class=lnt id=hl-19-174><a class=lnlinks href=#hl-19-174>174</a>
</span><span class=lnt id=hl-19-175><a class=lnlinks href=#hl-19-175>175</a>
</span><span class=lnt id=hl-19-176><a class=lnlinks href=#hl-19-176>176</a>
</span><span class=lnt id=hl-19-177><a class=lnlinks href=#hl-19-177>177</a>
</span><span class=lnt id=hl-19-178><a class=lnlinks href=#hl-19-178>178</a>
</span><span class=lnt id=hl-19-179><a class=lnlinks href=#hl-19-179>179</a>
</span><span class=lnt id=hl-19-180><a class=lnlinks href=#hl-19-180>180</a>
</span><span class=lnt id=hl-19-181><a class=lnlinks href=#hl-19-181>181</a>
</span><span class=lnt id=hl-19-182><a class=lnlinks href=#hl-19-182>182</a>
</span><span class=lnt id=hl-19-183><a class=lnlinks href=#hl-19-183>183</a>
</span><span class=lnt id=hl-19-184><a class=lnlinks href=#hl-19-184>184</a>
</span><span class=lnt id=hl-19-185><a class=lnlinks href=#hl-19-185>185</a>
</span><span class=lnt id=hl-19-186><a class=lnlinks href=#hl-19-186>186</a>
</span><span class=lnt id=hl-19-187><a class=lnlinks href=#hl-19-187>187</a>
</span><span class=lnt id=hl-19-188><a class=lnlinks href=#hl-19-188>188</a>
</span><span class=lnt id=hl-19-189><a class=lnlinks href=#hl-19-189>189</a>
</span><span class=lnt id=hl-19-190><a class=lnlinks href=#hl-19-190>190</a>
</span><span class=lnt id=hl-19-191><a class=lnlinks href=#hl-19-191>191</a>
</span><span class=lnt id=hl-19-192><a class=lnlinks href=#hl-19-192>192</a>
</span><span class=lnt id=hl-19-193><a class=lnlinks href=#hl-19-193>193</a>
</span><span class=lnt id=hl-19-194><a class=lnlinks href=#hl-19-194>194</a>
</span><span class=lnt id=hl-19-195><a class=lnlinks href=#hl-19-195>195</a>
</span><span class=lnt id=hl-19-196><a class=lnlinks href=#hl-19-196>196</a>
</span><span class=lnt id=hl-19-197><a class=lnlinks href=#hl-19-197>197</a>
</span><span class=lnt id=hl-19-198><a class=lnlinks href=#hl-19-198>198</a>
</span><span class=lnt id=hl-19-199><a class=lnlinks href=#hl-19-199>199</a>
</span><span class=lnt id=hl-19-200><a class=lnlinks href=#hl-19-200>200</a>
</span><span class=lnt id=hl-19-201><a class=lnlinks href=#hl-19-201>201</a>
</span><span class=lnt id=hl-19-202><a class=lnlinks href=#hl-19-202>202</a>
</span><span class=lnt id=hl-19-203><a class=lnlinks href=#hl-19-203>203</a>
</span><span class=lnt id=hl-19-204><a class=lnlinks href=#hl-19-204>204</a>
</span><span class=lnt id=hl-19-205><a class=lnlinks href=#hl-19-205>205</a>
</span><span class=lnt id=hl-19-206><a class=lnlinks href=#hl-19-206>206</a>
</span><span class=lnt id=hl-19-207><a class=lnlinks href=#hl-19-207>207</a>
</span><span class=lnt id=hl-19-208><a class=lnlinks href=#hl-19-208>208</a>
</span><span class=lnt id=hl-19-209><a class=lnlinks href=#hl-19-209>209</a>
</span><span class=lnt id=hl-19-210><a class=lnlinks href=#hl-19-210>210</a>
</span><span class=lnt id=hl-19-211><a class=lnlinks href=#hl-19-211>211</a>
</span><span class=lnt id=hl-19-212><a class=lnlinks href=#hl-19-212>212</a>
</span><span class=lnt id=hl-19-213><a class=lnlinks href=#hl-19-213>213</a>
</span><span class=lnt id=hl-19-214><a class=lnlinks href=#hl-19-214>214</a>
</span><span class=lnt id=hl-19-215><a class=lnlinks href=#hl-19-215>215</a>
</span><span class=lnt id=hl-19-216><a class=lnlinks href=#hl-19-216>216</a>
</span><span class=lnt id=hl-19-217><a class=lnlinks href=#hl-19-217>217</a>
</span><span class=lnt id=hl-19-218><a class=lnlinks href=#hl-19-218>218</a>
</span><span class=lnt id=hl-19-219><a class=lnlinks href=#hl-19-219>219</a>
</span><span class=lnt id=hl-19-220><a class=lnlinks href=#hl-19-220>220</a>
</span><span class=lnt id=hl-19-221><a class=lnlinks href=#hl-19-221>221</a>
</span><span class=lnt id=hl-19-222><a class=lnlinks href=#hl-19-222>222</a>
</span><span class=lnt id=hl-19-223><a class=lnlinks href=#hl-19-223>223</a>
</span><span class=lnt id=hl-19-224><a class=lnlinks href=#hl-19-224>224</a>
</span><span class=lnt id=hl-19-225><a class=lnlinks href=#hl-19-225>225</a>
</span><span class=lnt id=hl-19-226><a class=lnlinks href=#hl-19-226>226</a>
</span><span class=lnt id=hl-19-227><a class=lnlinks href=#hl-19-227>227</a>
</span><span class=lnt id=hl-19-228><a class=lnlinks href=#hl-19-228>228</a>
</span><span class=lnt id=hl-19-229><a class=lnlinks href=#hl-19-229>229</a>
</span><span class=lnt id=hl-19-230><a class=lnlinks href=#hl-19-230>230</a>
</span><span class=lnt id=hl-19-231><a class=lnlinks href=#hl-19-231>231</a>
</span><span class=lnt id=hl-19-232><a class=lnlinks href=#hl-19-232>232</a>
</span><span class=lnt id=hl-19-233><a class=lnlinks href=#hl-19-233>233</a>
</span><span class=lnt id=hl-19-234><a class=lnlinks href=#hl-19-234>234</a>
</span><span class=lnt id=hl-19-235><a class=lnlinks href=#hl-19-235>235</a>
</span><span class=lnt id=hl-19-236><a class=lnlinks href=#hl-19-236>236</a>
</span><span class=lnt id=hl-19-237><a class=lnlinks href=#hl-19-237>237</a>
</span><span class=lnt id=hl-19-238><a class=lnlinks href=#hl-19-238>238</a>
</span><span class=lnt id=hl-19-239><a class=lnlinks href=#hl-19-239>239</a>
</span><span class=lnt id=hl-19-240><a class=lnlinks href=#hl-19-240>240</a>
</span><span class=lnt id=hl-19-241><a class=lnlinks href=#hl-19-241>241</a>
</span><span class=lnt id=hl-19-242><a class=lnlinks href=#hl-19-242>242</a>
</span><span class=lnt id=hl-19-243><a class=lnlinks href=#hl-19-243>243</a>
</span><span class=lnt id=hl-19-244><a class=lnlinks href=#hl-19-244>244</a>
</span><span class=lnt id=hl-19-245><a class=lnlinks href=#hl-19-245>245</a>
</span><span class=lnt id=hl-19-246><a class=lnlinks href=#hl-19-246>246</a>
</span><span class=lnt id=hl-19-247><a class=lnlinks href=#hl-19-247>247</a>
</span><span class=lnt id=hl-19-248><a class=lnlinks href=#hl-19-248>248</a>
</span><span class=lnt id=hl-19-249><a class=lnlinks href=#hl-19-249>249</a>
</span><span class=lnt id=hl-19-250><a class=lnlinks href=#hl-19-250>250</a>
</span><span class=lnt id=hl-19-251><a class=lnlinks href=#hl-19-251>251</a>
</span><span class=lnt id=hl-19-252><a class=lnlinks href=#hl-19-252>252</a>
</span><span class=lnt id=hl-19-253><a class=lnlinks href=#hl-19-253>253</a>
</span><span class=lnt id=hl-19-254><a class=lnlinks href=#hl-19-254>254</a>
</span><span class=lnt id=hl-19-255><a class=lnlinks href=#hl-19-255>255</a>
</span><span class=lnt id=hl-19-256><a class=lnlinks href=#hl-19-256>256</a>
</span><span class=lnt id=hl-19-257><a class=lnlinks href=#hl-19-257>257</a>
</span><span class=lnt id=hl-19-258><a class=lnlinks href=#hl-19-258>258</a>
</span><span class=lnt id=hl-19-259><a class=lnlinks href=#hl-19-259>259</a>
</span><span class=lnt id=hl-19-260><a class=lnlinks href=#hl-19-260>260</a>
</span><span class=lnt id=hl-19-261><a class=lnlinks href=#hl-19-261>261</a>
</span><span class=lnt id=hl-19-262><a class=lnlinks href=#hl-19-262>262</a>
</span><span class=lnt id=hl-19-263><a class=lnlinks href=#hl-19-263>263</a>
</span><span class=lnt id=hl-19-264><a class=lnlinks href=#hl-19-264>264</a>
</span><span class=lnt id=hl-19-265><a class=lnlinks href=#hl-19-265>265</a>
</span><span class=lnt id=hl-19-266><a class=lnlinks href=#hl-19-266>266</a>
</span><span class=lnt id=hl-19-267><a class=lnlinks href=#hl-19-267>267</a>
</span><span class=lnt id=hl-19-268><a class=lnlinks href=#hl-19-268>268</a>
</span><span class=lnt id=hl-19-269><a class=lnlinks href=#hl-19-269>269</a>
</span><span class=lnt id=hl-19-270><a class=lnlinks href=#hl-19-270>270</a>
</span><span class=lnt id=hl-19-271><a class=lnlinks href=#hl-19-271>271</a>
</span><span class=lnt id=hl-19-272><a class=lnlinks href=#hl-19-272>272</a>
</span><span class=lnt id=hl-19-273><a class=lnlinks href=#hl-19-273>273</a>
</span><span class=lnt id=hl-19-274><a class=lnlinks href=#hl-19-274>274</a>
</span><span class=lnt id=hl-19-275><a class=lnlinks href=#hl-19-275>275</a>
</span><span class=lnt id=hl-19-276><a class=lnlinks href=#hl-19-276>276</a>
</span><span class=lnt id=hl-19-277><a class=lnlinks href=#hl-19-277>277</a>
</span><span class=lnt id=hl-19-278><a class=lnlinks href=#hl-19-278>278</a>
</span><span class=lnt id=hl-19-279><a class=lnlinks href=#hl-19-279>279</a>
</span><span class=lnt id=hl-19-280><a class=lnlinks href=#hl-19-280>280</a>
</span><span class=lnt id=hl-19-281><a class=lnlinks href=#hl-19-281>281</a>
</span><span class=lnt id=hl-19-282><a class=lnlinks href=#hl-19-282>282</a>
</span><span class=lnt id=hl-19-283><a class=lnlinks href=#hl-19-283>283</a>
</span><span class=lnt id=hl-19-284><a class=lnlinks href=#hl-19-284>284</a>
</span><span class=lnt id=hl-19-285><a class=lnlinks href=#hl-19-285>285</a>
</span><span class=lnt id=hl-19-286><a class=lnlinks href=#hl-19-286>286</a>
</span><span class=lnt id=hl-19-287><a class=lnlinks href=#hl-19-287>287</a>
</span><span class=lnt id=hl-19-288><a class=lnlinks href=#hl-19-288>288</a>
</span><span class=lnt id=hl-19-289><a class=lnlinks href=#hl-19-289>289</a>
</span><span class=lnt id=hl-19-290><a class=lnlinks href=#hl-19-290>290</a>
</span><span class=lnt id=hl-19-291><a class=lnlinks href=#hl-19-291>291</a>
</span><span class=lnt id=hl-19-292><a class=lnlinks href=#hl-19-292>292</a>
</span><span class=lnt id=hl-19-293><a class=lnlinks href=#hl-19-293>293</a>
</span><span class=lnt id=hl-19-294><a class=lnlinks href=#hl-19-294>294</a>
</span><span class=lnt id=hl-19-295><a class=lnlinks href=#hl-19-295>295</a>
</span><span class=lnt id=hl-19-296><a class=lnlinks href=#hl-19-296>296</a>
</span><span class=lnt id=hl-19-297><a class=lnlinks href=#hl-19-297>297</a>
</span><span class=lnt id=hl-19-298><a class=lnlinks href=#hl-19-298>298</a>
</span><span class=lnt id=hl-19-299><a class=lnlinks href=#hl-19-299>299</a>
</span><span class=lnt id=hl-19-300><a class=lnlinks href=#hl-19-300>300</a>
</span><span class=lnt id=hl-19-301><a class=lnlinks href=#hl-19-301>301</a>
</span><span class=lnt id=hl-19-302><a class=lnlinks href=#hl-19-302>302</a>
</span><span class=lnt id=hl-19-303><a class=lnlinks href=#hl-19-303>303</a>
</span><span class=lnt id=hl-19-304><a class=lnlinks href=#hl-19-304>304</a>
</span><span class=lnt id=hl-19-305><a class=lnlinks href=#hl-19-305>305</a>
</span><span class=lnt id=hl-19-306><a class=lnlinks href=#hl-19-306>306</a>
</span><span class=lnt id=hl-19-307><a class=lnlinks href=#hl-19-307>307</a>
</span><span class=lnt id=hl-19-308><a class=lnlinks href=#hl-19-308>308</a>
</span><span class=lnt id=hl-19-309><a class=lnlinks href=#hl-19-309>309</a>
</span><span class=lnt id=hl-19-310><a class=lnlinks href=#hl-19-310>310</a>
</span><span class=lnt id=hl-19-311><a class=lnlinks href=#hl-19-311>311</a>
</span><span class=lnt id=hl-19-312><a class=lnlinks href=#hl-19-312>312</a>
</span><span class=lnt id=hl-19-313><a class=lnlinks href=#hl-19-313>313</a>
</span><span class=lnt id=hl-19-314><a class=lnlinks href=#hl-19-314>314</a>
</span><span class=lnt id=hl-19-315><a class=lnlinks href=#hl-19-315>315</a>
</span><span class=lnt id=hl-19-316><a class=lnlinks href=#hl-19-316>316</a>
</span><span class=lnt id=hl-19-317><a class=lnlinks href=#hl-19-317>317</a>
</span><span class=lnt id=hl-19-318><a class=lnlinks href=#hl-19-318>318</a>
</span><span class=lnt id=hl-19-319><a class=lnlinks href=#hl-19-319>319</a>
</span><span class=lnt id=hl-19-320><a class=lnlinks href=#hl-19-320>320</a>
</span><span class=lnt id=hl-19-321><a class=lnlinks href=#hl-19-321>321</a>
</span><span class=lnt id=hl-19-322><a class=lnlinks href=#hl-19-322>322</a>
</span><span class=lnt id=hl-19-323><a class=lnlinks href=#hl-19-323>323</a>
</span><span class=lnt id=hl-19-324><a class=lnlinks href=#hl-19-324>324</a>
</span><span class=lnt id=hl-19-325><a class=lnlinks href=#hl-19-325>325</a>
</span><span class=lnt id=hl-19-326><a class=lnlinks href=#hl-19-326>326</a>
</span><span class=lnt id=hl-19-327><a class=lnlinks href=#hl-19-327>327</a>
</span><span class=lnt id=hl-19-328><a class=lnlinks href=#hl-19-328>328</a>
</span><span class=lnt id=hl-19-329><a class=lnlinks href=#hl-19-329>329</a>
</span><span class=lnt id=hl-19-330><a class=lnlinks href=#hl-19-330>330</a>
</span><span class=lnt id=hl-19-331><a class=lnlinks href=#hl-19-331>331</a>
</span><span class=lnt id=hl-19-332><a class=lnlinks href=#hl-19-332>332</a>
</span><span class=lnt id=hl-19-333><a class=lnlinks href=#hl-19-333>333</a>
</span><span class=lnt id=hl-19-334><a class=lnlinks href=#hl-19-334>334</a>
</span><span class=lnt id=hl-19-335><a class=lnlinks href=#hl-19-335>335</a>
</span><span class=lnt id=hl-19-336><a class=lnlinks href=#hl-19-336>336</a>
</span><span class=lnt id=hl-19-337><a class=lnlinks href=#hl-19-337>337</a>
</span><span class=lnt id=hl-19-338><a class=lnlinks href=#hl-19-338>338</a>
</span><span class=lnt id=hl-19-339><a class=lnlinks href=#hl-19-339>339</a>
</span><span class=lnt id=hl-19-340><a class=lnlinks href=#hl-19-340>340</a>
</span><span class=lnt id=hl-19-341><a class=lnlinks href=#hl-19-341>341</a>
</span><span class=lnt id=hl-19-342><a class=lnlinks href=#hl-19-342>342</a>
</span><span class=lnt id=hl-19-343><a class=lnlinks href=#hl-19-343>343</a>
</span><span class=lnt id=hl-19-344><a class=lnlinks href=#hl-19-344>344</a>
</span><span class=lnt id=hl-19-345><a class=lnlinks href=#hl-19-345>345</a>
</span><span class=lnt id=hl-19-346><a class=lnlinks href=#hl-19-346>346</a>
</span><span class=lnt id=hl-19-347><a class=lnlinks href=#hl-19-347>347</a>
</span><span class=lnt id=hl-19-348><a class=lnlinks href=#hl-19-348>348</a>
</span><span class=lnt id=hl-19-349><a class=lnlinks href=#hl-19-349>349</a>
</span><span class=lnt id=hl-19-350><a class=lnlinks href=#hl-19-350>350</a>
</span><span class=lnt id=hl-19-351><a class=lnlinks href=#hl-19-351>351</a>
</span><span class=lnt id=hl-19-352><a class=lnlinks href=#hl-19-352>352</a>
</span><span class=lnt id=hl-19-353><a class=lnlinks href=#hl-19-353>353</a>
</span><span class=lnt id=hl-19-354><a class=lnlinks href=#hl-19-354>354</a>
</span><span class=lnt id=hl-19-355><a class=lnlinks href=#hl-19-355>355</a>
</span><span class=lnt id=hl-19-356><a class=lnlinks href=#hl-19-356>356</a>
</span><span class=lnt id=hl-19-357><a class=lnlinks href=#hl-19-357>357</a>
</span><span class=lnt id=hl-19-358><a class=lnlinks href=#hl-19-358>358</a>
</span><span class=lnt id=hl-19-359><a class=lnlinks href=#hl-19-359>359</a>
</span><span class=lnt id=hl-19-360><a class=lnlinks href=#hl-19-360>360</a>
</span><span class=lnt id=hl-19-361><a class=lnlinks href=#hl-19-361>361</a>
</span><span class=lnt id=hl-19-362><a class=lnlinks href=#hl-19-362>362</a>
</span><span class=lnt id=hl-19-363><a class=lnlinks href=#hl-19-363>363</a>
</span><span class=lnt id=hl-19-364><a class=lnlinks href=#hl-19-364>364</a>
</span><span class=lnt id=hl-19-365><a class=lnlinks href=#hl-19-365>365</a>
</span><span class=lnt id=hl-19-366><a class=lnlinks href=#hl-19-366>366</a>
</span><span class=lnt id=hl-19-367><a class=lnlinks href=#hl-19-367>367</a>
</span><span class=lnt id=hl-19-368><a class=lnlinks href=#hl-19-368>368</a>
</span><span class=lnt id=hl-19-369><a class=lnlinks href=#hl-19-369>369</a>
</span><span class=lnt id=hl-19-370><a class=lnlinks href=#hl-19-370>370</a>
</span><span class=lnt id=hl-19-371><a class=lnlinks href=#hl-19-371>371</a>
</span><span class=lnt id=hl-19-372><a class=lnlinks href=#hl-19-372>372</a>
</span><span class=lnt id=hl-19-373><a class=lnlinks href=#hl-19-373>373</a>
</span><span class=lnt id=hl-19-374><a class=lnlinks href=#hl-19-374>374</a>
</span><span class=lnt id=hl-19-375><a class=lnlinks href=#hl-19-375>375</a>
</span><span class=lnt id=hl-19-376><a class=lnlinks href=#hl-19-376>376</a>
</span><span class=lnt id=hl-19-377><a class=lnlinks href=#hl-19-377>377</a>
</span><span class=lnt id=hl-19-378><a class=lnlinks href=#hl-19-378>378</a>
</span><span class=lnt id=hl-19-379><a class=lnlinks href=#hl-19-379>379</a>
</span><span class=lnt id=hl-19-380><a class=lnlinks href=#hl-19-380>380</a>
</span><span class=lnt id=hl-19-381><a class=lnlinks href=#hl-19-381>381</a>
</span><span class=lnt id=hl-19-382><a class=lnlinks href=#hl-19-382>382</a>
</span><span class=lnt id=hl-19-383><a class=lnlinks href=#hl-19-383>383</a>
</span><span class=lnt id=hl-19-384><a class=lnlinks href=#hl-19-384>384</a>
</span><span class=lnt id=hl-19-385><a class=lnlinks href=#hl-19-385>385</a>
</span><span class=lnt id=hl-19-386><a class=lnlinks href=#hl-19-386>386</a>
</span><span class=lnt id=hl-19-387><a class=lnlinks href=#hl-19-387>387</a>
</span><span class=lnt id=hl-19-388><a class=lnlinks href=#hl-19-388>388</a>
</span><span class=lnt id=hl-19-389><a class=lnlinks href=#hl-19-389>389</a>
</span><span class=lnt id=hl-19-390><a class=lnlinks href=#hl-19-390>390</a>
</span><span class=lnt id=hl-19-391><a class=lnlinks href=#hl-19-391>391</a>
</span><span class=lnt id=hl-19-392><a class=lnlinks href=#hl-19-392>392</a>
</span><span class=lnt id=hl-19-393><a class=lnlinks href=#hl-19-393>393</a>
</span><span class=lnt id=hl-19-394><a class=lnlinks href=#hl-19-394>394</a>
</span><span class=lnt id=hl-19-395><a class=lnlinks href=#hl-19-395>395</a>
</span><span class=lnt id=hl-19-396><a class=lnlinks href=#hl-19-396>396</a>
</span><span class=lnt id=hl-19-397><a class=lnlinks href=#hl-19-397>397</a>
</span><span class=lnt id=hl-19-398><a class=lnlinks href=#hl-19-398>398</a>
</span><span class=lnt id=hl-19-399><a class=lnlinks href=#hl-19-399>399</a>
</span><span class=lnt id=hl-19-400><a class=lnlinks href=#hl-19-400>400</a>
</span><span class=lnt id=hl-19-401><a class=lnlinks href=#hl-19-401>401</a>
</span><span class=lnt id=hl-19-402><a class=lnlinks href=#hl-19-402>402</a>
</span><span class=lnt id=hl-19-403><a class=lnlinks href=#hl-19-403>403</a>
</span><span class=lnt id=hl-19-404><a class=lnlinks href=#hl-19-404>404</a>
</span><span class=lnt id=hl-19-405><a class=lnlinks href=#hl-19-405>405</a>
</span><span class=lnt id=hl-19-406><a class=lnlinks href=#hl-19-406>406</a>
</span><span class=lnt id=hl-19-407><a class=lnlinks href=#hl-19-407>407</a>
</span><span class=lnt id=hl-19-408><a class=lnlinks href=#hl-19-408>408</a>
</span><span class=lnt id=hl-19-409><a class=lnlinks href=#hl-19-409>409</a>
</span><span class=lnt id=hl-19-410><a class=lnlinks href=#hl-19-410>410</a>
</span><span class=lnt id=hl-19-411><a class=lnlinks href=#hl-19-411>411</a>
</span><span class=lnt id=hl-19-412><a class=lnlinks href=#hl-19-412>412</a>
</span><span class=lnt id=hl-19-413><a class=lnlinks href=#hl-19-413>413</a>
</span><span class=lnt id=hl-19-414><a class=lnlinks href=#hl-19-414>414</a>
</span><span class=lnt id=hl-19-415><a class=lnlinks href=#hl-19-415>415</a>
</span><span class=lnt id=hl-19-416><a class=lnlinks href=#hl-19-416>416</a>
</span><span class=lnt id=hl-19-417><a class=lnlinks href=#hl-19-417>417</a>
</span><span class=lnt id=hl-19-418><a class=lnlinks href=#hl-19-418>418</a>
</span><span class=lnt id=hl-19-419><a class=lnlinks href=#hl-19-419>419</a>
</span><span class=lnt id=hl-19-420><a class=lnlinks href=#hl-19-420>420</a>
</span><span class=lnt id=hl-19-421><a class=lnlinks href=#hl-19-421>421</a>
</span><span class=lnt id=hl-19-422><a class=lnlinks href=#hl-19-422>422</a>
</span><span class=lnt id=hl-19-423><a class=lnlinks href=#hl-19-423>423</a>
</span><span class=lnt id=hl-19-424><a class=lnlinks href=#hl-19-424>424</a>
</span><span class=lnt id=hl-19-425><a class=lnlinks href=#hl-19-425>425</a>
</span><span class=lnt id=hl-19-426><a class=lnlinks href=#hl-19-426>426</a>
</span><span class=lnt id=hl-19-427><a class=lnlinks href=#hl-19-427>427</a>
</span><span class=lnt id=hl-19-428><a class=lnlinks href=#hl-19-428>428</a>
</span><span class=lnt id=hl-19-429><a class=lnlinks href=#hl-19-429>429</a>
</span><span class=lnt id=hl-19-430><a class=lnlinks href=#hl-19-430>430</a>
</span><span class=lnt id=hl-19-431><a class=lnlinks href=#hl-19-431>431</a>
</span><span class=lnt id=hl-19-432><a class=lnlinks href=#hl-19-432>432</a>
</span><span class=lnt id=hl-19-433><a class=lnlinks href=#hl-19-433>433</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># FastAPI 메인 애플리케이션 모듈</span>
</span></span><span class=line><span class=cl><span class=c1># HTTP API 엔드포인트, 미들웨어, 의존성 주입 설정</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>HTTPException</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>status</span><span class=p>,</span> <span class=n>Request</span><span class=p>,</span> <span class=n>BackgroundTasks</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.middleware.cors</span> <span class=kn>import</span> <span class=n>CORSMiddleware</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.middleware.trustedhost</span> <span class=kn>import</span> <span class=n>TrustedHostMiddleware</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.responses</span> <span class=kn>import</span> <span class=n>JSONResponse</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.exceptions</span> <span class=kn>import</span> <span class=n>RequestValidationError</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>traceback</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>database</span> <span class=kn>import</span> <span class=n>db_manager</span><span class=p>,</span> <span class=n>get_db</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>models</span> <span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>OrderCreateRequest</span><span class=p>,</span> <span class=n>OrderResponse</span><span class=p>,</span> <span class=n>OrderStatusUpdateRequest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>OrderListResponse</span><span class=p>,</span> <span class=n>OrderSummaryResponse</span><span class=p>,</span> <span class=n>OrderStatus</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>services</span> <span class=kn>import</span> <span class=n>order_service</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cache</span> <span class=kn>import</span> <span class=n>health_check_redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>messaging</span> <span class=kn>import</span> <span class=n>event_publisher</span><span class=p>,</span> <span class=n>setup_event_consumers</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>utils</span> <span class=kn>import</span> <span class=n>logger</span><span class=p>,</span> <span class=n>metrics</span><span class=p>,</span> <span class=n>health_checker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FastAPI 애플리케이션 생성</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>app_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;클라우드 네이티브 주문 처리 마이크로서비스 - 확장 가능하고 안정적인 전자상거래 주문 관리&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>app_version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>docs_url</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>docs_url</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>settings</span><span class=o>.</span><span class=n>is_production</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>redoc_url</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>redoc_url</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>settings</span><span class=o>.</span><span class=n>is_production</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>openapi_url</span><span class=o>=</span><span class=s2>&#34;/openapi.json&#34;</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>settings</span><span class=o>.</span><span class=n>is_production</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 미들웨어 설정</span>
</span></span><span class=line><span class=cl><span class=nd>@app.middleware</span><span class=p>(</span><span class=s2>&#34;http&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>request_middleware</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;요청 처리 미들웨어 (로깅, 메트릭, 성능 측정)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>request_id</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;X-Request-ID&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;req_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 요청 로깅</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;HTTP 요청 시작&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>method</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>request_id</span><span class=o>=</span><span class=n>request_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>user_agent</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;user-agent&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>remote_addr</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>host</span> <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>client</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 요청 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 처리 시간 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>process_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 헤더 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;X-Request-ID&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request_id</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;X-Process-Time&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>process_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메트릭 기록</span>
</span></span><span class=line><span class=cl>        <span class=n>metrics</span><span class=o>.</span><span class=n>record_histogram</span><span class=p>(</span><span class=s2>&#34;http_request_duration&#34;</span><span class=p>,</span> <span class=n>process_time</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status_code&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;http_requests_total&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status_code&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 로깅</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;HTTP 요청 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>method</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>process_time</span><span class=o>=</span><span class=n>process_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>request_id</span><span class=o>=</span><span class=n>request_id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>process_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 에러 메트릭 기록</span>
</span></span><span class=line><span class=cl>        <span class=n>metrics</span><span class=o>.</span><span class=n>increment_counter</span><span class=p>(</span><span class=s2>&#34;http_request_errors_total&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;error_type&#34;</span><span class=p>:</span> <span class=nb>type</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 에러 로깅</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;HTTP 요청 에러&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>method</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>process_time</span><span class=o>=</span><span class=n>process_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>request_id</span><span class=o>=</span><span class=n>request_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>traceback</span><span class=o>=</span><span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CORS 미들웨어</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>add_middleware</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>CORSMiddleware</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_origins</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>cors_origins</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_credentials</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_methods</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>cors_methods</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>allow_headers</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>cors_headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 신뢰할 수 있는 호스트 미들웨어 (운영 환경)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>settings</span><span class=o>.</span><span class=n>is_production</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>add_middleware</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>TrustedHostMiddleware</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>allowed_hosts</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;*.example.com&#34;</span><span class=p>,</span> <span class=s2>&#34;localhost&#34;</span><span class=p>]</span>  <span class=c1># 실제 도메인으로 변경</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애플리케이션 시작/종료 이벤트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;startup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>startup_event</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;애플리케이션 시작 시 초기화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 데이터베이스 테이블 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>db_manager</span><span class=o>.</span><span class=n>create_tables</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Kafka 프로듀서 시작</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>event_publisher</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 컨슈머 설정 (백그라운드 태스크)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>setup_event_consumers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 헬스 체크 등록</span>
</span></span><span class=line><span class=cl>        <span class=n>health_checker</span><span class=o>.</span><span class=n>register_check</span><span class=p>(</span><span class=s2>&#34;database&#34;</span><span class=p>,</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>health_check</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>health_checker</span><span class=o>.</span><span class=n>register_check</span><span class=p>(</span><span class=s2>&#34;redis&#34;</span><span class=p>,</span> <span class=n>health_check_redis</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Order Service 시작 완료&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>environment</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>environment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>version</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>app_version</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;애플리케이션 시작 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;shutdown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>shutdown_event</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;애플리케이션 종료 시 정리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Kafka 프로듀서 종료</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>event_publisher</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 데이터베이스 연결 종료</span>
</span></span><span class=line><span class=cl>        <span class=n>db_manager</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Order Service 종료 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;애플리케이션 종료 중 에러&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 에러 핸들러</span>
</span></span><span class=line><span class=cl><span class=nd>@app.exception_handler</span><span class=p>(</span><span class=n>HTTPException</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>http_exception_handler</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>HTTPException</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;HTTP 예외 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>status_code</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=n>exc</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=n>exc</span><span class=o>.</span><span class=n>detail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.exception_handler</span><span class=p>(</span><span class=n>RequestValidationError</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>validation_exception_handler</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>RequestValidationError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;요청 검증 예외 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_422_UNPROCESSABLE_ENTITY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>422</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;요청 데이터 검증 실패&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;details&#34;</span><span class=p>:</span> <span class=n>exc</span><span class=o>.</span><span class=n>errors</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.exception_handler</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>general_exception_handler</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;일반 예외 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;예상치 못한 에러 발생&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>traceback</span><span class=o>=</span><span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_500_INTERNAL_SERVER_ERROR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;내부 서버 오류가 발생했습니다&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 헬스 체크 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/health&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Health&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>health_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;헬스 체크 엔드포인트 (Kubernetes Liveness/Readiness Probe)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>health_results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>health_checker</span><span class=o>.</span><span class=n>run_checks</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>health_results</span><span class=p>[</span><span class=s2>&#34;status&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;healthy&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>health_results</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_503_SERVICE_UNAVAILABLE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>detail</span><span class=o>=</span><span class=n>health_results</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;헬스 체크 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_503_SERVICE_UNAVAILABLE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;unhealthy&#34;</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/metrics&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Monitoring&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_metrics</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메트릭 엔드포인트 (Prometheus 수집용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>metrics</span><span class=o>.</span><span class=n>get_metrics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/info&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Info&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_info</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;서비스 정보 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;service&#34;</span><span class=p>:</span> <span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>app_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>app_version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;environment&#34;</span><span class=p>:</span> <span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>environment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 API 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>OrderResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_201_CREATED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Orders&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;새 주문 생성&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;사용자가 상품을 주문할 때 새로운 주문을 생성합니다. 사용자 검증, 상품 확인, 재고 체크를 포함합니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=n>order_request</span><span class=p>:</span> <span class=n>OrderCreateRequest</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;새 주문 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>order_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=n>order_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 생성 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>user_id</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_400_BAD_REQUEST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>OrderResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Orders&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;주문 조회&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문 ID로 특정 주문의 상세 정보를 조회합니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 상세 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>order_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>order_response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_404_NOT_FOUND</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;주문을 찾을 수 없습니다&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.put</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>/status&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>OrderResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Orders&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;주문 상태 업데이트&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문의 상태를 업데이트합니다. 상태 전환 규칙에 따라 유효성을 검증합니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>update_order_status</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>status_update</span><span class=p>:</span> <span class=n>OrderStatusUpdateRequest</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 상태 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>order_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>update_order_status</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>status_update</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 상태 업데이트 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_400_BAD_REQUEST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>OrderListResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Orders&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;주문 목록 조회&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;필터링과 페이징을 지원하는 주문 목록을 조회합니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>list_orders</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>OrderStatus</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>page_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 목록 조회 (필터링 및 페이징)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>page</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>page_size</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=ow>or</span> <span class=n>page_size</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>page_size</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>offset</span> <span class=o>=</span> <span class=p>(</span><span class=n>page</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>page_size</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>orders</span><span class=p>,</span> <span class=n>total_count</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>list_orders</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>limit</span><span class=o>=</span><span class=n>page_size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>offset</span><span class=o>=</span><span class=n>offset</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>has_next</span> <span class=o>=</span> <span class=n>offset</span> <span class=o>+</span> <span class=n>page_size</span> <span class=o>&lt;</span> <span class=n>total_count</span>
</span></span><span class=line><span class=cl>        <span class=n>has_previous</span> <span class=o>=</span> <span class=n>page</span> <span class=o>&gt;</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>OrderListResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>orders</span><span class=o>=</span><span class=n>orders</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>total_count</span><span class=o>=</span><span class=n>total_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>page</span><span class=o>=</span><span class=n>page</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>page_size</span><span class=o>=</span><span class=n>page_size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>has_next</span><span class=o>=</span><span class=n>has_next</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>has_previous</span><span class=o>=</span><span class=n>has_previous</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 목록 조회 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_500_INTERNAL_SERVER_ERROR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;주문 목록 조회 중 오류가 발생했습니다&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.delete</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>OrderResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Orders&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;주문 취소&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;주문을 취소합니다. 취소 가능한 상태의 주문만 취소할 수 있습니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>cancel_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;사용자 요청&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 취소&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>order_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_service</span><span class=o>.</span><span class=n>cancel_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_response</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;주문 취소 실패&#34;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>order_id</span><span class=o>=</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_400_BAD_REQUEST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/orders/summary&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>response_model</span><span class=o>=</span><span class=n>OrderSummaryResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Analytics&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=s2>&#34;주문 요약 통계&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;전체 주문 통계 정보를 제공합니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_order_summary</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 요약 통계&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이 기능은 실제 구현에서는 별도의 분석 서비스나 읽기 전용 복제본을 사용하는 것이 좋습니다</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>OrderSummaryResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>total_orders</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pending_orders</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>completed_orders</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>cancelled_orders</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>total_revenue</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>average_order_value</span><span class=o>=</span><span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 개발 환경에서만 사용하는 디버그 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>settings</span><span class=o>.</span><span class=n>is_development</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/debug/cache/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Debug&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>debug_get_cache</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;캐시 디버그 조회 (개발 환경 전용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>cache</span> <span class=kn>import</span> <span class=n>order_cache</span>
</span></span><span class=line><span class=cl>        <span class=n>cached_data</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;cached_data&#34;</span><span class=p>:</span> <span class=n>cached_data</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@app.delete</span><span class=p>(</span><span class=s2>&#34;/debug/cache/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;Debug&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>debug_clear_cache</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;캐시 디버그 삭제 (개발 환경 전용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>cache</span> <span class=kn>import</span> <span class=n>order_cache</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>order_cache</span><span class=o>.</span><span class=n>delete_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;deleted&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>uvicorn</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 개발 환경에서는 uvicorn으로 직접 실행</span>
</span></span><span class=line><span class=cl>    <span class=c1># 운영 환경에서는 Gunicorn + Uvicorn 조합 사용 권장</span>
</span></span><span class=line><span class=cl>    <span class=n>uvicorn</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;main:app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>port</span><span class=o>=</span><span class=mi>8000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>reload</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>is_development</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>log_level</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>log_level</span><span class=o>.</span><span class=n>lower</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>access_log</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=쿠버네티스-매니페스트-파일들>쿠버네티스 매니페스트 파일들<a hidden class=anchor aria-hidden=true href=#쿠버네티스-매니페스트-파일들>#</a></h4><h5 id=네임스페이스-및-리소스-관리>네임스페이스 및 리소스 관리<a hidden class=anchor aria-hidden=true href=#네임스페이스-및-리소스-관리>#</a></h5><p><strong>k8s/namespace.yaml</strong>: 서비스들을 격리하고 리소스 쿼터를 설정하여 멀티테넌시를 지원한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 네임스페이스 정의 - 리소스 격리 및 관리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Namespace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>managed-by</span><span class=p>:</span><span class=w> </span><span class=l>kubectl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;전자상거래 마이크로서비스를 위한 네임스페이스&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 리소스 쿼터 설정 - 네임스페이스별 리소스 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ResourceQuota</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce-quota</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hard</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests.cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4&#34;</span><span class=w>      </span><span class=c># 총 CPU 요청량 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests.memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8Gi&#34;</span><span class=w> </span><span class=c># 총 메모리 요청량 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limits.cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>        </span><span class=c># 총 CPU 제한량</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limits.memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;16Gi&#34;</span><span class=w>  </span><span class=c># 총 메모리 제한량</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pods</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;20&#34;</span><span class=w>             </span><span class=c># 최대 Pod 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>services</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10&#34;</span><span class=w>         </span><span class=c># 최대 Service 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>persistentvolumeclaims</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;5&#34;</span><span class=w>  </span><span class=c># 최대 PVC 수</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=order-service-배포>Order Service 배포<a hidden class=anchor aria-hidden=true href=#order-service-배포>#</a></h5><p><strong>k8s/order-service/configmap.yaml</strong>: 환경별 설정 정보를 외부화하여 컨테이너 이미지 재빌드 없이 설정 변경이 가능하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37>37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Order Service 설정 정보 ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 데이터베이스 연결 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;postgresql://orderuser@postgres-service:5432/orderdb&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DB_ECHO</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Redis 캐시 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>REDIS_URL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redis://redis-service:6379/0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Kafka 메시징 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>KAFKA_SERVERS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kafka-service:9092&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>KAFKA_TOPIC_PREFIX</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ecommerce&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 외부 서비스 URL 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>USER_SERVICE_URL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://user-service:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PRODUCT_SERVICE_URL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://product-service:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PAYMENT_SERVICE_URL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://payment-service:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 애플리케이션 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ENVIRONMENT</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;production&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>LOG_LEVEL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INFO&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DEBUG</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># API 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>API_PREFIX</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/api/v1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 타임아웃 및 재시도 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>HTTP_TIMEOUT</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;30&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>RETRY_ATTEMPTS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CACHE_TTL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;300&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/order-service/secret.yaml</strong>: 데이터베이스 비밀번호, API 키 등 민감한 정보를 Base64 로 인코딩하여 안전하게 저장한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Order Service 민감 정보 Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 데이터베이스 비밀번호 (base64 인코딩)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DB_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>cGFzc3dvcmQxMjM= </span><span class=w> </span><span class=c># password123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Kafka 인증 정보</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>KAFKA_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>a2Fma2Ffa2V5XzEyMw== </span><span class=w> </span><span class=c># kafka_key_123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>KAFKA_API_SECRET</span><span class=p>:</span><span class=w> </span><span class=l>a2Fma2Ffc2VjcmV0XzEyMw== </span><span class=w> </span><span class=c># kafka_secret_123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 외부 서비스 API 키</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>USER_SERVICE_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>dXNlcl9hcGlfa2V5XzEyMw== </span><span class=w> </span><span class=c># user_api_key_123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PRODUCT_SERVICE_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>cHJvZHVjdF9hcGlfa2V5XzEyMw== </span><span class=w> </span><span class=c># product_api_key_123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PAYMENT_SERVICE_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>cGF5bWVudF9hcGlfa2V5XzEyMw== </span><span class=w> </span><span class=c># payment_api_key_123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># JWT 시크릿 키</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>JWT_SECRET</span><span class=p>:</span><span class=w> </span><span class=l>and0X3NlY3JldF9rZXlfMTIz </span><span class=w> </span><span class=c># jwt_secret_key_123</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/order-service/deployment.yaml</strong>: 애플리케이션의 배포 전략, 리소스 제한, 헬스 체크, 보안 설정을 정의한다. 무중단 배포 (Rolling Update) 와 Pod 분산 배치를 지원한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>  1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>  2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>  3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>  4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>  5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>  6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>  7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>  8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>  9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10> 10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11> 11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12> 12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13> 13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14> 14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15> 15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16> 16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17> 17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18> 18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19> 19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20> 20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21> 21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22> 22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23> 23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24> 24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25> 25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26> 26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27> 27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28> 28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29> 29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30> 30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31> 31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32> 32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33> 33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34> 34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35> 35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36> 36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37> 37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38> 38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39> 39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40> 40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41> 41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42> 42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43> 43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44> 44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45> 45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46> 46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47> 47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48> 48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49> 49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50> 50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51> 51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52> 52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53> 53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54> 54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55> 55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56> 56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57> 57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58> 58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59> 59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60> 60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61> 61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62> 62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63> 63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64> 64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65> 65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66> 66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67> 67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68> 68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69> 69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70> 70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71> 71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72> 72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73> 73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74> 74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75> 75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76> 76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77> 77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78> 78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79> 79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80> 80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81> 81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82> 82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83> 83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84> 84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85> 85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86> 86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87> 87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88> 88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89> 89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90> 90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91> 91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92> 92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93> 93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94> 94</a>
</span><span class=lnt id=hl-23-95><a class=lnlinks href=#hl-23-95> 95</a>
</span><span class=lnt id=hl-23-96><a class=lnlinks href=#hl-23-96> 96</a>
</span><span class=lnt id=hl-23-97><a class=lnlinks href=#hl-23-97> 97</a>
</span><span class=lnt id=hl-23-98><a class=lnlinks href=#hl-23-98> 98</a>
</span><span class=lnt id=hl-23-99><a class=lnlinks href=#hl-23-99> 99</a>
</span><span class=lnt id=hl-23-100><a class=lnlinks href=#hl-23-100>100</a>
</span><span class=lnt id=hl-23-101><a class=lnlinks href=#hl-23-101>101</a>
</span><span class=lnt id=hl-23-102><a class=lnlinks href=#hl-23-102>102</a>
</span><span class=lnt id=hl-23-103><a class=lnlinks href=#hl-23-103>103</a>
</span><span class=lnt id=hl-23-104><a class=lnlinks href=#hl-23-104>104</a>
</span><span class=lnt id=hl-23-105><a class=lnlinks href=#hl-23-105>105</a>
</span><span class=lnt id=hl-23-106><a class=lnlinks href=#hl-23-106>106</a>
</span><span class=lnt id=hl-23-107><a class=lnlinks href=#hl-23-107>107</a>
</span><span class=lnt id=hl-23-108><a class=lnlinks href=#hl-23-108>108</a>
</span><span class=lnt id=hl-23-109><a class=lnlinks href=#hl-23-109>109</a>
</span><span class=lnt id=hl-23-110><a class=lnlinks href=#hl-23-110>110</a>
</span><span class=lnt id=hl-23-111><a class=lnlinks href=#hl-23-111>111</a>
</span><span class=lnt id=hl-23-112><a class=lnlinks href=#hl-23-112>112</a>
</span><span class=lnt id=hl-23-113><a class=lnlinks href=#hl-23-113>113</a>
</span><span class=lnt id=hl-23-114><a class=lnlinks href=#hl-23-114>114</a>
</span><span class=lnt id=hl-23-115><a class=lnlinks href=#hl-23-115>115</a>
</span><span class=lnt id=hl-23-116><a class=lnlinks href=#hl-23-116>116</a>
</span><span class=lnt id=hl-23-117><a class=lnlinks href=#hl-23-117>117</a>
</span><span class=lnt id=hl-23-118><a class=lnlinks href=#hl-23-118>118</a>
</span><span class=lnt id=hl-23-119><a class=lnlinks href=#hl-23-119>119</a>
</span><span class=lnt id=hl-23-120><a class=lnlinks href=#hl-23-120>120</a>
</span><span class=lnt id=hl-23-121><a class=lnlinks href=#hl-23-121>121</a>
</span><span class=lnt id=hl-23-122><a class=lnlinks href=#hl-23-122>122</a>
</span><span class=lnt id=hl-23-123><a class=lnlinks href=#hl-23-123>123</a>
</span><span class=lnt id=hl-23-124><a class=lnlinks href=#hl-23-124>124</a>
</span><span class=lnt id=hl-23-125><a class=lnlinks href=#hl-23-125>125</a>
</span><span class=lnt id=hl-23-126><a class=lnlinks href=#hl-23-126>126</a>
</span><span class=lnt id=hl-23-127><a class=lnlinks href=#hl-23-127>127</a>
</span><span class=lnt id=hl-23-128><a class=lnlinks href=#hl-23-128>128</a>
</span><span class=lnt id=hl-23-129><a class=lnlinks href=#hl-23-129>129</a>
</span><span class=lnt id=hl-23-130><a class=lnlinks href=#hl-23-130>130</a>
</span><span class=lnt id=hl-23-131><a class=lnlinks href=#hl-23-131>131</a>
</span><span class=lnt id=hl-23-132><a class=lnlinks href=#hl-23-132>132</a>
</span><span class=lnt id=hl-23-133><a class=lnlinks href=#hl-23-133>133</a>
</span><span class=lnt id=hl-23-134><a class=lnlinks href=#hl-23-134>134</a>
</span><span class=lnt id=hl-23-135><a class=lnlinks href=#hl-23-135>135</a>
</span><span class=lnt id=hl-23-136><a class=lnlinks href=#hl-23-136>136</a>
</span><span class=lnt id=hl-23-137><a class=lnlinks href=#hl-23-137>137</a>
</span><span class=lnt id=hl-23-138><a class=lnlinks href=#hl-23-138>138</a>
</span><span class=lnt id=hl-23-139><a class=lnlinks href=#hl-23-139>139</a>
</span><span class=lnt id=hl-23-140><a class=lnlinks href=#hl-23-140>140</a>
</span><span class=lnt id=hl-23-141><a class=lnlinks href=#hl-23-141>141</a>
</span><span class=lnt id=hl-23-142><a class=lnlinks href=#hl-23-142>142</a>
</span><span class=lnt id=hl-23-143><a class=lnlinks href=#hl-23-143>143</a>
</span><span class=lnt id=hl-23-144><a class=lnlinks href=#hl-23-144>144</a>
</span><span class=lnt id=hl-23-145><a class=lnlinks href=#hl-23-145>145</a>
</span><span class=lnt id=hl-23-146><a class=lnlinks href=#hl-23-146>146</a>
</span><span class=lnt id=hl-23-147><a class=lnlinks href=#hl-23-147>147</a>
</span><span class=lnt id=hl-23-148><a class=lnlinks href=#hl-23-148>148</a>
</span><span class=lnt id=hl-23-149><a class=lnlinks href=#hl-23-149>149</a>
</span><span class=lnt id=hl-23-150><a class=lnlinks href=#hl-23-150>150</a>
</span><span class=lnt id=hl-23-151><a class=lnlinks href=#hl-23-151>151</a>
</span><span class=lnt id=hl-23-152><a class=lnlinks href=#hl-23-152>152</a>
</span><span class=lnt id=hl-23-153><a class=lnlinks href=#hl-23-153>153</a>
</span><span class=lnt id=hl-23-154><a class=lnlinks href=#hl-23-154>154</a>
</span><span class=lnt id=hl-23-155><a class=lnlinks href=#hl-23-155>155</a>
</span><span class=lnt id=hl-23-156><a class=lnlinks href=#hl-23-156>156</a>
</span><span class=lnt id=hl-23-157><a class=lnlinks href=#hl-23-157>157</a>
</span><span class=lnt id=hl-23-158><a class=lnlinks href=#hl-23-158>158</a>
</span><span class=lnt id=hl-23-159><a class=lnlinks href=#hl-23-159>159</a>
</span><span class=lnt id=hl-23-160><a class=lnlinks href=#hl-23-160>160</a>
</span><span class=lnt id=hl-23-161><a class=lnlinks href=#hl-23-161>161</a>
</span><span class=lnt id=hl-23-162><a class=lnlinks href=#hl-23-162>162</a>
</span><span class=lnt id=hl-23-163><a class=lnlinks href=#hl-23-163>163</a>
</span><span class=lnt id=hl-23-164><a class=lnlinks href=#hl-23-164>164</a>
</span><span class=lnt id=hl-23-165><a class=lnlinks href=#hl-23-165>165</a>
</span><span class=lnt id=hl-23-166><a class=lnlinks href=#hl-23-166>166</a>
</span><span class=lnt id=hl-23-167><a class=lnlinks href=#hl-23-167>167</a>
</span><span class=lnt id=hl-23-168><a class=lnlinks href=#hl-23-168>168</a>
</span><span class=lnt id=hl-23-169><a class=lnlinks href=#hl-23-169>169</a>
</span><span class=lnt id=hl-23-170><a class=lnlinks href=#hl-23-170>170</a>
</span><span class=lnt id=hl-23-171><a class=lnlinks href=#hl-23-171>171</a>
</span><span class=lnt id=hl-23-172><a class=lnlinks href=#hl-23-172>172</a>
</span><span class=lnt id=hl-23-173><a class=lnlinks href=#hl-23-173>173</a>
</span><span class=lnt id=hl-23-174><a class=lnlinks href=#hl-23-174>174</a>
</span><span class=lnt id=hl-23-175><a class=lnlinks href=#hl-23-175>175</a>
</span><span class=lnt id=hl-23-176><a class=lnlinks href=#hl-23-176>176</a>
</span><span class=lnt id=hl-23-177><a class=lnlinks href=#hl-23-177>177</a>
</span><span class=lnt id=hl-23-178><a class=lnlinks href=#hl-23-178>178</a>
</span><span class=lnt id=hl-23-179><a class=lnlinks href=#hl-23-179>179</a>
</span><span class=lnt id=hl-23-180><a class=lnlinks href=#hl-23-180>180</a>
</span><span class=lnt id=hl-23-181><a class=lnlinks href=#hl-23-181>181</a>
</span><span class=lnt id=hl-23-182><a class=lnlinks href=#hl-23-182>182</a>
</span><span class=lnt id=hl-23-183><a class=lnlinks href=#hl-23-183>183</a>
</span><span class=lnt id=hl-23-184><a class=lnlinks href=#hl-23-184>184</a>
</span><span class=lnt id=hl-23-185><a class=lnlinks href=#hl-23-185>185</a>
</span><span class=lnt id=hl-23-186><a class=lnlinks href=#hl-23-186>186</a>
</span><span class=lnt id=hl-23-187><a class=lnlinks href=#hl-23-187>187</a>
</span><span class=lnt id=hl-23-188><a class=lnlinks href=#hl-23-188>188</a>
</span><span class=lnt id=hl-23-189><a class=lnlinks href=#hl-23-189>189</a>
</span><span class=lnt id=hl-23-190><a class=lnlinks href=#hl-23-190>190</a>
</span><span class=lnt id=hl-23-191><a class=lnlinks href=#hl-23-191>191</a>
</span><span class=lnt id=hl-23-192><a class=lnlinks href=#hl-23-192>192</a>
</span><span class=lnt id=hl-23-193><a class=lnlinks href=#hl-23-193>193</a>
</span><span class=lnt id=hl-23-194><a class=lnlinks href=#hl-23-194>194</a>
</span><span class=lnt id=hl-23-195><a class=lnlinks href=#hl-23-195>195</a>
</span><span class=lnt id=hl-23-196><a class=lnlinks href=#hl-23-196>196</a>
</span><span class=lnt id=hl-23-197><a class=lnlinks href=#hl-23-197>197</a>
</span><span class=lnt id=hl-23-198><a class=lnlinks href=#hl-23-198>198</a>
</span><span class=lnt id=hl-23-199><a class=lnlinks href=#hl-23-199>199</a>
</span><span class=lnt id=hl-23-200><a class=lnlinks href=#hl-23-200>200</a>
</span><span class=lnt id=hl-23-201><a class=lnlinks href=#hl-23-201>201</a>
</span><span class=lnt id=hl-23-202><a class=lnlinks href=#hl-23-202>202</a>
</span><span class=lnt id=hl-23-203><a class=lnlinks href=#hl-23-203>203</a>
</span><span class=lnt id=hl-23-204><a class=lnlinks href=#hl-23-204>204</a>
</span><span class=lnt id=hl-23-205><a class=lnlinks href=#hl-23-205>205</a>
</span><span class=lnt id=hl-23-206><a class=lnlinks href=#hl-23-206>206</a>
</span><span class=lnt id=hl-23-207><a class=lnlinks href=#hl-23-207>207</a>
</span><span class=lnt id=hl-23-208><a class=lnlinks href=#hl-23-208>208</a>
</span><span class=lnt id=hl-23-209><a class=lnlinks href=#hl-23-209>209</a>
</span><span class=lnt id=hl-23-210><a class=lnlinks href=#hl-23-210>210</a>
</span><span class=lnt id=hl-23-211><a class=lnlinks href=#hl-23-211>211</a>
</span><span class=lnt id=hl-23-212><a class=lnlinks href=#hl-23-212>212</a>
</span><span class=lnt id=hl-23-213><a class=lnlinks href=#hl-23-213>213</a>
</span><span class=lnt id=hl-23-214><a class=lnlinks href=#hl-23-214>214</a>
</span><span class=lnt id=hl-23-215><a class=lnlinks href=#hl-23-215>215</a>
</span><span class=lnt id=hl-23-216><a class=lnlinks href=#hl-23-216>216</a>
</span><span class=lnt id=hl-23-217><a class=lnlinks href=#hl-23-217>217</a>
</span><span class=lnt id=hl-23-218><a class=lnlinks href=#hl-23-218>218</a>
</span><span class=lnt id=hl-23-219><a class=lnlinks href=#hl-23-219>219</a>
</span><span class=lnt id=hl-23-220><a class=lnlinks href=#hl-23-220>220</a>
</span><span class=lnt id=hl-23-221><a class=lnlinks href=#hl-23-221>221</a>
</span><span class=lnt id=hl-23-222><a class=lnlinks href=#hl-23-222>222</a>
</span><span class=lnt id=hl-23-223><a class=lnlinks href=#hl-23-223>223</a>
</span><span class=lnt id=hl-23-224><a class=lnlinks href=#hl-23-224>224</a>
</span><span class=lnt id=hl-23-225><a class=lnlinks href=#hl-23-225>225</a>
</span><span class=lnt id=hl-23-226><a class=lnlinks href=#hl-23-226>226</a>
</span><span class=lnt id=hl-23-227><a class=lnlinks href=#hl-23-227>227</a>
</span><span class=lnt id=hl-23-228><a class=lnlinks href=#hl-23-228>228</a>
</span><span class=lnt id=hl-23-229><a class=lnlinks href=#hl-23-229>229</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Order Service 애플리케이션 배포 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>  </span><span class=c># 무중단 배포 보장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># Istio 사이드카 주입</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>sidecar.istio.io/inject</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># Prometheus 스크래핑 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>prometheus.io/scrape</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>prometheus.io/port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>prometheus.io/path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/metrics&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 설정 체크섬 (ConfigMap 변경 감지)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>checksum/config</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ .Values.configChecksum }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>order-service-sa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 초기화 컨테이너 (데이터베이스 마이그레이션)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initContainers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myregistry/order-service:v1.2.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-c&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;from database import db_manager; db_manager.create_tables()&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DB_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>DB_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;128Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myregistry/order-service:v1.2.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 환경 변수 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># ConfigMap에서 주입</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>REDIS_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>REDIS_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_SERVERS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_SERVERS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ENVIRONMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>ENVIRONMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>LOG_LEVEL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>LOG_LEVEL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># Secret에서 주입</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DB_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>DB_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_API_KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_API_KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 리소스 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1Gi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1000m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 헬스 체크 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>successThreshold</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>successThreshold</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 시작 프로브 (느린 시작 대응)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>startupProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 보안 컨텍스트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>allowPrivilegeEscalation</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>runAsNonRoot</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>runAsUser</span><span class=p>:</span><span class=w> </span><span class=m>1001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>runAsGroup</span><span class=p>:</span><span class=w> </span><span class=m>1001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>readOnlyRootFilesystem</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>capabilities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>drop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>ALL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 볼륨 마운트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>tmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/tmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/app/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/app/cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 볼륨 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>tmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>sizeLimit</span><span class=p>:</span><span class=w> </span><span class=l>100Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>sizeLimit</span><span class=p>:</span><span class=w> </span><span class=l>500Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>sizeLimit</span><span class=p>:</span><span class=w> </span><span class=l>200Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Pod 스케줄링 및 보안 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fsGroup</span><span class=p>:</span><span class=w> </span><span class=m>1001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>runAsNonRoot</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Node 선택 및 톨러레이션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodeSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>kubernetes.io/arch</span><span class=p>:</span><span class=w> </span><span class=l>amd64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>node-type</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Pod 분산 배치 (고가용성)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>preferredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>podAffinityTerm</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span>- <span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes.io/hostname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>nodeAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>preferredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>preference</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node-type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 톨러레이션 (특정 노드에서 실행 허용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tolerations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node.kubernetes.io/not-ready</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>Exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoExecute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>tolerationSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node.kubernetes.io/unreachable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>Exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoExecute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>tolerationSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/order-service/service.yaml</strong>: 네트워크 서비스 디스커버리와 로드 밸런싱을 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Order Service 네트워크 서비스 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service.beta.kubernetes.io/aws-load-balancer-type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;nlb&#34;</span><span class=w>  </span><span class=c># AWS NLB 사용 시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP </span><span class=w> </span><span class=c># 클러스터 내부 전용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sessionAffinity</span><span class=p>:</span><span class=w> </span><span class=l>None </span><span class=w> </span><span class=c># 세션 고정 없음 (스테이트리스)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>        </span><span class=c># 서비스 포트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>  </span><span class=c># 컨테이너 포트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 헤드리스 서비스 (서비스 디스커버리용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-headless</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>order-service-headless</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=l>None </span><span class=w> </span><span class=c># 헤드리스 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/order-service/hpa.yaml</strong>: CPU, 메모리, 커스텀 메트릭 기반의 자동 스케일링을 설정한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52>52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53>53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54>54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55>55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56>56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57>57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58>58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59>59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60>60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61>61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62>62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63>63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64>64</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 수평적 Pod 자동 스케일러 (HPA)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-hpa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 스케일링 메트릭</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>70</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 커스텀 메트릭 (Prometheus 기반)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Pods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pods</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>metric</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http_requests_per_second</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>AverageValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageValue</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100&#34;</span><span class=w>  </span><span class=c># 초당 100 요청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 스케일링 동작 제어</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>behavior</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scaleUp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>stabilizationWindowSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>   </span><span class=c># 60초 안정화 기간</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>policies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Percent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>                      </span><span class=c># 50% 증가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Pods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>                       </span><span class=c># 최대 2개 Pod 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>selectPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Max               </span><span class=w> </span><span class=c># 더 큰 값 선택</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scaleDown</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>stabilizationWindowSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>  </span><span class=c># 5분 안정화 기간</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>policies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Percent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>25</span><span class=w>                      </span><span class=c># 25% 감소</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Pods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>                       </span><span class=c># 최대 1개 Pod 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>selectPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Min               </span><span class=w> </span><span class=c># 더 작은 값 선택</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/order-service/pdb.yaml</strong>: 클러스터 유지보수 중에도 최소한의 서비스 가용성을 보장한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Pod 중단 예산 (Pod Disruption Budget)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>policy/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PodDisruptionBudget</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-pdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minAvailable</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>  </span><span class=c># 최소 2개 Pod 유지</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 또는 maxUnavailable: 1  # 최대 1개 Pod 중단 허용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=모니터링>모니터링<a hidden class=anchor aria-hidden=true href=#모니터링>#</a></h5><p><strong>k8s/order-service/servicemonitor.yaml</strong>: Prometheus 메트릭 수집 설정을 통해 애플리케이션 성능과 상태를 모니터링한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29>29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30>30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Prometheus ServiceMonitor (메트릭 수집)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>monitoring.coreos.com/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceMonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-monitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prometheus</span><span class=p>:</span><span class=w> </span><span class=l>monitoring</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapeTimeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>honorLabels</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 메트릭 재라벨링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metricRelabelings</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>sourceLabels</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>__name__]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>regex</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;http_request_duration_bucket&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetLabel</span><span class=p>:</span><span class=w> </span><span class=l>__name__</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>replacement</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;order_service_http_request_duration_bucket&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 샘플 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sampleLimit</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetLimit</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=데이터베이스-postgresql>데이터베이스 (PostgreSQL)<a hidden class=anchor aria-hidden=true href=#데이터베이스-postgresql>#</a></h5><p><strong>k8s/postgres/configmap.yaml</strong>: PostgreSQL 최적화 설정과 보안 규칙을 정의한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43>43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44>44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45>45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46>46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47>47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48>48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49>49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50>50</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># PostgreSQL 설정 ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;orderdb&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;orderuser&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PGDATA</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/var/lib/postgresql/data/pgdata&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># PostgreSQL 설정 파일</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgresql.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 연결 설정
</span></span></span><span class=line><span class=cl><span class=sd>    listen_addresses = &#39;*&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    port = 5432
</span></span></span><span class=line><span class=cl><span class=sd>    max_connections = 200
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 메모리 설정
</span></span></span><span class=line><span class=cl><span class=sd>    shared_buffers = &#39;256MB&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    effective_cache_size = &#39;1GB&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    work_mem = &#39;4MB&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    maintenance_work_mem = &#39;64MB&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # WAL 설정
</span></span></span><span class=line><span class=cl><span class=sd>    wal_level = replica
</span></span></span><span class=line><span class=cl><span class=sd>    max_wal_size = &#39;1GB&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    min_wal_size = &#39;80MB&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    checkpoint_completion_target = 0.9
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 로깅 설정
</span></span></span><span class=line><span class=cl><span class=sd>    log_destination = &#39;stderr&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    logging_collector = on
</span></span></span><span class=line><span class=cl><span class=sd>    log_directory = &#39;/var/log/postgresql&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    log_filename = &#39;postgresql-%Y-%m-%d_%H%M%S.log&#39;
</span></span></span><span class=line><span class=cl><span class=sd>    log_min_duration_statement = 1000
</span></span></span><span class=line><span class=cl><span class=sd>    log_line_prefix = &#39;%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h &#39;
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 성능 튜닝
</span></span></span><span class=line><span class=cl><span class=sd>    random_page_cost = 1.1
</span></span></span><span class=line><span class=cl><span class=sd>    effective_io_concurrency = 200
</span></span></span><span class=line><span class=cl><span class=sd>    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pg_hba.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # TYPE  DATABASE        USER            ADDRESS                 METHOD
</span></span></span><span class=line><span class=cl><span class=sd>    local   all             all                                     trust
</span></span></span><span class=line><span class=cl><span class=sd>    host    all             all             127.0.0.1/32            md5
</span></span></span><span class=line><span class=cl><span class=sd>    host    all             all             ::1/128                 md5
</span></span></span><span class=line><span class=cl><span class=sd>    host    all             all             0.0.0.0/0               md5</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/postgres/secret.yaml</strong>: 데이터베이스 비밀번호, API 키 등 민감한 정보를 Base64 로 인코딩하여 안전하게 저장한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># PostgreSQL 비밀번호 Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>cGFzc3dvcmQxMjM= </span><span class=w> </span><span class=c># password123 (base64)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>cm9vdHBhc3N3b3JkMTIz </span><span class=w> </span><span class=c># rootpassword123 (base64)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/postgres/statefulset.yaml</strong>: 상태 보존이 필요한 데이터베이스를 위한 StatefulSet 을 사용하여 영구 스토리지와 안정적인 네트워크 식별자를 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>  1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>  2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>  3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>  4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5>  5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6>  6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7>  7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8>  8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9>  9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10> 10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11> 11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12> 12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13> 13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14> 14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15> 15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16> 16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17> 17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18> 18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19> 19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20> 20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21> 21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22> 22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23> 23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24> 24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25> 25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26> 26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27> 27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28> 28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29> 29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30> 30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31> 31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32> 32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33> 33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34> 34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35> 35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36> 36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37> 37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38> 38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39> 39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40> 40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41> 41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42> 42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43> 43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44> 44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45> 45</a>
</span><span class=lnt id=hl-30-46><a class=lnlinks href=#hl-30-46> 46</a>
</span><span class=lnt id=hl-30-47><a class=lnlinks href=#hl-30-47> 47</a>
</span><span class=lnt id=hl-30-48><a class=lnlinks href=#hl-30-48> 48</a>
</span><span class=lnt id=hl-30-49><a class=lnlinks href=#hl-30-49> 49</a>
</span><span class=lnt id=hl-30-50><a class=lnlinks href=#hl-30-50> 50</a>
</span><span class=lnt id=hl-30-51><a class=lnlinks href=#hl-30-51> 51</a>
</span><span class=lnt id=hl-30-52><a class=lnlinks href=#hl-30-52> 52</a>
</span><span class=lnt id=hl-30-53><a class=lnlinks href=#hl-30-53> 53</a>
</span><span class=lnt id=hl-30-54><a class=lnlinks href=#hl-30-54> 54</a>
</span><span class=lnt id=hl-30-55><a class=lnlinks href=#hl-30-55> 55</a>
</span><span class=lnt id=hl-30-56><a class=lnlinks href=#hl-30-56> 56</a>
</span><span class=lnt id=hl-30-57><a class=lnlinks href=#hl-30-57> 57</a>
</span><span class=lnt id=hl-30-58><a class=lnlinks href=#hl-30-58> 58</a>
</span><span class=lnt id=hl-30-59><a class=lnlinks href=#hl-30-59> 59</a>
</span><span class=lnt id=hl-30-60><a class=lnlinks href=#hl-30-60> 60</a>
</span><span class=lnt id=hl-30-61><a class=lnlinks href=#hl-30-61> 61</a>
</span><span class=lnt id=hl-30-62><a class=lnlinks href=#hl-30-62> 62</a>
</span><span class=lnt id=hl-30-63><a class=lnlinks href=#hl-30-63> 63</a>
</span><span class=lnt id=hl-30-64><a class=lnlinks href=#hl-30-64> 64</a>
</span><span class=lnt id=hl-30-65><a class=lnlinks href=#hl-30-65> 65</a>
</span><span class=lnt id=hl-30-66><a class=lnlinks href=#hl-30-66> 66</a>
</span><span class=lnt id=hl-30-67><a class=lnlinks href=#hl-30-67> 67</a>
</span><span class=lnt id=hl-30-68><a class=lnlinks href=#hl-30-68> 68</a>
</span><span class=lnt id=hl-30-69><a class=lnlinks href=#hl-30-69> 69</a>
</span><span class=lnt id=hl-30-70><a class=lnlinks href=#hl-30-70> 70</a>
</span><span class=lnt id=hl-30-71><a class=lnlinks href=#hl-30-71> 71</a>
</span><span class=lnt id=hl-30-72><a class=lnlinks href=#hl-30-72> 72</a>
</span><span class=lnt id=hl-30-73><a class=lnlinks href=#hl-30-73> 73</a>
</span><span class=lnt id=hl-30-74><a class=lnlinks href=#hl-30-74> 74</a>
</span><span class=lnt id=hl-30-75><a class=lnlinks href=#hl-30-75> 75</a>
</span><span class=lnt id=hl-30-76><a class=lnlinks href=#hl-30-76> 76</a>
</span><span class=lnt id=hl-30-77><a class=lnlinks href=#hl-30-77> 77</a>
</span><span class=lnt id=hl-30-78><a class=lnlinks href=#hl-30-78> 78</a>
</span><span class=lnt id=hl-30-79><a class=lnlinks href=#hl-30-79> 79</a>
</span><span class=lnt id=hl-30-80><a class=lnlinks href=#hl-30-80> 80</a>
</span><span class=lnt id=hl-30-81><a class=lnlinks href=#hl-30-81> 81</a>
</span><span class=lnt id=hl-30-82><a class=lnlinks href=#hl-30-82> 82</a>
</span><span class=lnt id=hl-30-83><a class=lnlinks href=#hl-30-83> 83</a>
</span><span class=lnt id=hl-30-84><a class=lnlinks href=#hl-30-84> 84</a>
</span><span class=lnt id=hl-30-85><a class=lnlinks href=#hl-30-85> 85</a>
</span><span class=lnt id=hl-30-86><a class=lnlinks href=#hl-30-86> 86</a>
</span><span class=lnt id=hl-30-87><a class=lnlinks href=#hl-30-87> 87</a>
</span><span class=lnt id=hl-30-88><a class=lnlinks href=#hl-30-88> 88</a>
</span><span class=lnt id=hl-30-89><a class=lnlinks href=#hl-30-89> 89</a>
</span><span class=lnt id=hl-30-90><a class=lnlinks href=#hl-30-90> 90</a>
</span><span class=lnt id=hl-30-91><a class=lnlinks href=#hl-30-91> 91</a>
</span><span class=lnt id=hl-30-92><a class=lnlinks href=#hl-30-92> 92</a>
</span><span class=lnt id=hl-30-93><a class=lnlinks href=#hl-30-93> 93</a>
</span><span class=lnt id=hl-30-94><a class=lnlinks href=#hl-30-94> 94</a>
</span><span class=lnt id=hl-30-95><a class=lnlinks href=#hl-30-95> 95</a>
</span><span class=lnt id=hl-30-96><a class=lnlinks href=#hl-30-96> 96</a>
</span><span class=lnt id=hl-30-97><a class=lnlinks href=#hl-30-97> 97</a>
</span><span class=lnt id=hl-30-98><a class=lnlinks href=#hl-30-98> 98</a>
</span><span class=lnt id=hl-30-99><a class=lnlinks href=#hl-30-99> 99</a>
</span><span class=lnt id=hl-30-100><a class=lnlinks href=#hl-30-100>100</a>
</span><span class=lnt id=hl-30-101><a class=lnlinks href=#hl-30-101>101</a>
</span><span class=lnt id=hl-30-102><a class=lnlinks href=#hl-30-102>102</a>
</span><span class=lnt id=hl-30-103><a class=lnlinks href=#hl-30-103>103</a>
</span><span class=lnt id=hl-30-104><a class=lnlinks href=#hl-30-104>104</a>
</span><span class=lnt id=hl-30-105><a class=lnlinks href=#hl-30-105>105</a>
</span><span class=lnt id=hl-30-106><a class=lnlinks href=#hl-30-106>106</a>
</span><span class=lnt id=hl-30-107><a class=lnlinks href=#hl-30-107>107</a>
</span><span class=lnt id=hl-30-108><a class=lnlinks href=#hl-30-108>108</a>
</span><span class=lnt id=hl-30-109><a class=lnlinks href=#hl-30-109>109</a>
</span><span class=lnt id=hl-30-110><a class=lnlinks href=#hl-30-110>110</a>
</span><span class=lnt id=hl-30-111><a class=lnlinks href=#hl-30-111>111</a>
</span><span class=lnt id=hl-30-112><a class=lnlinks href=#hl-30-112>112</a>
</span><span class=lnt id=hl-30-113><a class=lnlinks href=#hl-30-113>113</a>
</span><span class=lnt id=hl-30-114><a class=lnlinks href=#hl-30-114>114</a>
</span><span class=lnt id=hl-30-115><a class=lnlinks href=#hl-30-115>115</a>
</span><span class=lnt id=hl-30-116><a class=lnlinks href=#hl-30-116>116</a>
</span><span class=lnt id=hl-30-117><a class=lnlinks href=#hl-30-117>117</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># PostgreSQL StatefulSet (상태 보존 워크로드)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>postgres-headless</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>  </span><span class=c># 단일 인스턴스 (고가용성을 위해서는 PostgreSQL 클러스터 구성 필요)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_USER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_USER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PGDATA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>PGDATA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 리소스 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2Gi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1000m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 헬스 체크</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>pg_isready -U $POSTGRES_USER -d $POSTGRES_DB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>pg_isready -U $POSTGRES_USER -d $POSTGRES_DB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 볼륨 마운트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/postgresql/postgresql.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class=l>postgresql.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/postgresql/pg_hba.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class=l>pg_hba.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/log/postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 보안 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fsGroup</span><span class=p>:</span><span class=w> </span><span class=m>999</span><span class=w>  </span><span class=c># postgres 그룹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 영구 볼륨 클레임 템플릿</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumeClaimTemplates</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>accessModes</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;fast-ssd&#34;</span><span class=w>  </span><span class=c># 실제 스토리지 클래스로 변경</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>20Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/postgres/service.yaml</strong>: 네트워크 서비스 디스커버리와 로드 밸런싱을 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16>16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17>17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18>18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19>19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20>20</a>
</span><span class=lnt id=hl-31-21><a class=lnlinks href=#hl-31-21>21</a>
</span><span class=lnt id=hl-31-22><a class=lnlinks href=#hl-31-22>22</a>
</span><span class=lnt id=hl-31-23><a class=lnlinks href=#hl-31-23>23</a>
</span><span class=lnt id=hl-31-24><a class=lnlinks href=#hl-31-24>24</a>
</span><span class=lnt id=hl-31-25><a class=lnlinks href=#hl-31-25>25</a>
</span><span class=lnt id=hl-31-26><a class=lnlinks href=#hl-31-26>26</a>
</span><span class=lnt id=hl-31-27><a class=lnlinks href=#hl-31-27>27</a>
</span><span class=lnt id=hl-31-28><a class=lnlinks href=#hl-31-28>28</a>
</span><span class=lnt id=hl-31-29><a class=lnlinks href=#hl-31-29>29</a>
</span><span class=lnt id=hl-31-30><a class=lnlinks href=#hl-31-30>30</a>
</span><span class=lnt id=hl-31-31><a class=lnlinks href=#hl-31-31>31</a>
</span><span class=lnt id=hl-31-32><a class=lnlinks href=#hl-31-32>32</a>
</span><span class=lnt id=hl-31-33><a class=lnlinks href=#hl-31-33>33</a>
</span><span class=lnt id=hl-31-34><a class=lnlinks href=#hl-31-34>34</a>
</span><span class=lnt id=hl-31-35><a class=lnlinks href=#hl-31-35>35</a>
</span><span class=lnt id=hl-31-36><a class=lnlinks href=#hl-31-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># PostgreSQL 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># PostgreSQL 헤드리스 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-headless</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=l>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=캐시-redis>캐시 (Redis)<a hidden class=anchor aria-hidden=true href=#캐시-redis>#</a></h5><ul><li><strong>deployment.yaml</strong>:</li><li><strong>configmap.yaml</strong>:</li></ul><p><strong>k8s/redis/configmap.yaml</strong>: Redis 성능 튜닝과 지속성 설정을 포함한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32>32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33>33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34>34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35>35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36>36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37>37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38>38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39>39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40>40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41>41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42>42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43>43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44>44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Redis 설정 ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 네트워크 설정
</span></span></span><span class=line><span class=cl><span class=sd>    bind 0.0.0.0
</span></span></span><span class=line><span class=cl><span class=sd>    port 6379
</span></span></span><span class=line><span class=cl><span class=sd>    protected-mode no
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 메모리 설정
</span></span></span><span class=line><span class=cl><span class=sd>    maxmemory 512mb
</span></span></span><span class=line><span class=cl><span class=sd>    maxmemory-policy allkeys-lru
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 지속성 설정 (AOF)
</span></span></span><span class=line><span class=cl><span class=sd>    appendonly yes
</span></span></span><span class=line><span class=cl><span class=sd>    appendfsync everysec
</span></span></span><span class=line><span class=cl><span class=sd>    no-appendfsync-on-rewrite no
</span></span></span><span class=line><span class=cl><span class=sd>    auto-aof-rewrite-percentage 100
</span></span></span><span class=line><span class=cl><span class=sd>    auto-aof-rewrite-min-size 64mb
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # RDB 설정
</span></span></span><span class=line><span class=cl><span class=sd>    save 900 1
</span></span></span><span class=line><span class=cl><span class=sd>    save 300 10
</span></span></span><span class=line><span class=cl><span class=sd>    save 60 10000
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 로깅
</span></span></span><span class=line><span class=cl><span class=sd>    loglevel notice
</span></span></span><span class=line><span class=cl><span class=sd>    logfile &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 클라이언트 설정
</span></span></span><span class=line><span class=cl><span class=sd>    timeout 300
</span></span></span><span class=line><span class=cl><span class=sd>    tcp-keepalive 60
</span></span></span><span class=line><span class=cl><span class=sd>    tcp-backlog 511
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 성능 튜닝
</span></span></span><span class=line><span class=cl><span class=sd>    hz 10
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 보안 (실제 운영에서는 비밀번호 설정 필요)
</span></span></span><span class=line><span class=cl><span class=sd>    # requirepass yourpassword</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/redis/deployment.yaml</strong>: 인메모리 캐시 서버의 배포와 설정을 관리한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26>26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27>27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28>28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29>29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30>30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31>31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32>32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33>33</a>
</span><span class=lnt id=hl-33-34><a class=lnlinks href=#hl-33-34>34</a>
</span><span class=lnt id=hl-33-35><a class=lnlinks href=#hl-33-35>35</a>
</span><span class=lnt id=hl-33-36><a class=lnlinks href=#hl-33-36>36</a>
</span><span class=lnt id=hl-33-37><a class=lnlinks href=#hl-33-37>37</a>
</span><span class=lnt id=hl-33-38><a class=lnlinks href=#hl-33-38>38</a>
</span><span class=lnt id=hl-33-39><a class=lnlinks href=#hl-33-39>39</a>
</span><span class=lnt id=hl-33-40><a class=lnlinks href=#hl-33-40>40</a>
</span><span class=lnt id=hl-33-41><a class=lnlinks href=#hl-33-41>41</a>
</span><span class=lnt id=hl-33-42><a class=lnlinks href=#hl-33-42>42</a>
</span><span class=lnt id=hl-33-43><a class=lnlinks href=#hl-33-43>43</a>
</span><span class=lnt id=hl-33-44><a class=lnlinks href=#hl-33-44>44</a>
</span><span class=lnt id=hl-33-45><a class=lnlinks href=#hl-33-45>45</a>
</span><span class=lnt id=hl-33-46><a class=lnlinks href=#hl-33-46>46</a>
</span><span class=lnt id=hl-33-47><a class=lnlinks href=#hl-33-47>47</a>
</span><span class=lnt id=hl-33-48><a class=lnlinks href=#hl-33-48>48</a>
</span><span class=lnt id=hl-33-49><a class=lnlinks href=#hl-33-49>49</a>
</span><span class=lnt id=hl-33-50><a class=lnlinks href=#hl-33-50>50</a>
</span><span class=lnt id=hl-33-51><a class=lnlinks href=#hl-33-51>51</a>
</span><span class=lnt id=hl-33-52><a class=lnlinks href=#hl-33-52>52</a>
</span><span class=lnt id=hl-33-53><a class=lnlinks href=#hl-33-53>53</a>
</span><span class=lnt id=hl-33-54><a class=lnlinks href=#hl-33-54>54</a>
</span><span class=lnt id=hl-33-55><a class=lnlinks href=#hl-33-55>55</a>
</span><span class=lnt id=hl-33-56><a class=lnlinks href=#hl-33-56>56</a>
</span><span class=lnt id=hl-33-57><a class=lnlinks href=#hl-33-57>57</a>
</span><span class=lnt id=hl-33-58><a class=lnlinks href=#hl-33-58>58</a>
</span><span class=lnt id=hl-33-59><a class=lnlinks href=#hl-33-59>59</a>
</span><span class=lnt id=hl-33-60><a class=lnlinks href=#hl-33-60>60</a>
</span><span class=lnt id=hl-33-61><a class=lnlinks href=#hl-33-61>61</a>
</span><span class=lnt id=hl-33-62><a class=lnlinks href=#hl-33-62>62</a>
</span><span class=lnt id=hl-33-63><a class=lnlinks href=#hl-33-63>63</a>
</span><span class=lnt id=hl-33-64><a class=lnlinks href=#hl-33-64>64</a>
</span><span class=lnt id=hl-33-65><a class=lnlinks href=#hl-33-65>65</a>
</span><span class=lnt id=hl-33-66><a class=lnlinks href=#hl-33-66>66</a>
</span><span class=lnt id=hl-33-67><a class=lnlinks href=#hl-33-67>67</a>
</span><span class=lnt id=hl-33-68><a class=lnlinks href=#hl-33-68>68</a>
</span><span class=lnt id=hl-33-69><a class=lnlinks href=#hl-33-69>69</a>
</span><span class=lnt id=hl-33-70><a class=lnlinks href=#hl-33-70>70</a>
</span><span class=lnt id=hl-33-71><a class=lnlinks href=#hl-33-71>71</a>
</span><span class=lnt id=hl-33-72><a class=lnlinks href=#hl-33-72>72</a>
</span><span class=lnt id=hl-33-73><a class=lnlinks href=#hl-33-73>73</a>
</span><span class=lnt id=hl-33-74><a class=lnlinks href=#hl-33-74>74</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Redis 배포 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>  </span><span class=c># Redis는 단일 인스턴스 (클러스터 구성 시 변경)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:7-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>redis-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>/etc/redis/redis.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 리소스 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;250m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 헬스 체크</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>redis-cli</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>ping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>redis-cli</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>ping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 볼륨 마운트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/redis/redis.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class=l>redis.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>  </span><span class=c># 실제 운영에서는 PVC 사용 권장</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/redis/service.yaml</strong>: 네트워크 서비스 디스커버리와 로드 밸런싱을 제공한다</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Redis 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=메시징-kafka>메시징 (Kafka)<a hidden class=anchor aria-hidden=true href=#메시징-kafka>#</a></h5><p><strong>k8s/kafka/configmap.yaml</strong>: 토픽 설정, 파티셔닝, 복제 등의 Kafka 클러스터 설정을 관리한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span><span class=lnt id=hl-35-41><a class=lnlinks href=#hl-35-41>41</a>
</span><span class=lnt id=hl-35-42><a class=lnlinks href=#hl-35-42>42</a>
</span><span class=lnt id=hl-35-43><a class=lnlinks href=#hl-35-43>43</a>
</span><span class=lnt id=hl-35-44><a class=lnlinks href=#hl-35-44>44</a>
</span><span class=lnt id=hl-35-45><a class=lnlinks href=#hl-35-45>45</a>
</span><span class=lnt id=hl-35-46><a class=lnlinks href=#hl-35-46>46</a>
</span><span class=lnt id=hl-35-47><a class=lnlinks href=#hl-35-47>47</a>
</span><span class=lnt id=hl-35-48><a class=lnlinks href=#hl-35-48>48</a>
</span><span class=lnt id=hl-35-49><a class=lnlinks href=#hl-35-49>49</a>
</span><span class=lnt id=hl-35-50><a class=lnlinks href=#hl-35-50>50</a>
</span><span class=lnt id=hl-35-51><a class=lnlinks href=#hl-35-51>51</a>
</span><span class=lnt id=hl-35-52><a class=lnlinks href=#hl-35-52>52</a>
</span><span class=lnt id=hl-35-53><a class=lnlinks href=#hl-35-53>53</a>
</span><span class=lnt id=hl-35-54><a class=lnlinks href=#hl-35-54>54</a>
</span><span class=lnt id=hl-35-55><a class=lnlinks href=#hl-35-55>55</a>
</span><span class=lnt id=hl-35-56><a class=lnlinks href=#hl-35-56>56</a>
</span><span class=lnt id=hl-35-57><a class=lnlinks href=#hl-35-57>57</a>
</span><span class=lnt id=hl-35-58><a class=lnlinks href=#hl-35-58>58</a>
</span><span class=lnt id=hl-35-59><a class=lnlinks href=#hl-35-59>59</a>
</span><span class=lnt id=hl-35-60><a class=lnlinks href=#hl-35-60>60</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Kafka 설정 ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>server.properties</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 브로커 설정
</span></span></span><span class=line><span class=cl><span class=sd>    broker.id=1
</span></span></span><span class=line><span class=cl><span class=sd>    listeners=PLAINTEXT://0.0.0.0:9092
</span></span></span><span class=line><span class=cl><span class=sd>    advertised.listeners=PLAINTEXT://kafka-service:9092
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 로그 설정
</span></span></span><span class=line><span class=cl><span class=sd>    log.dirs=/opt/kafka/logs
</span></span></span><span class=line><span class=cl><span class=sd>    num.network.threads=3
</span></span></span><span class=line><span class=cl><span class=sd>    num.io.threads=8
</span></span></span><span class=line><span class=cl><span class=sd>    socket.send.buffer.bytes=102400
</span></span></span><span class=line><span class=cl><span class=sd>    socket.receive.buffer.bytes=102400
</span></span></span><span class=line><span class=cl><span class=sd>    socket.request.max.bytes=104857600
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 토픽 설정
</span></span></span><span class=line><span class=cl><span class=sd>    num.partitions=3
</span></span></span><span class=line><span class=cl><span class=sd>    default.replication.factor=1
</span></span></span><span class=line><span class=cl><span class=sd>    min.insync.replicas=1
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 로그 보존 설정
</span></span></span><span class=line><span class=cl><span class=sd>    log.retention.hours=168
</span></span></span><span class=line><span class=cl><span class=sd>    log.segment.bytes=1073741824
</span></span></span><span class=line><span class=cl><span class=sd>    log.retention.check.interval.ms=300000
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # Zookeeper 연결
</span></span></span><span class=line><span class=cl><span class=sd>    zookeeper.connect=zookeeper-service:2181
</span></span></span><span class=line><span class=cl><span class=sd>    zookeeper.connection.timeout.ms=18000
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 기타 설정
</span></span></span><span class=line><span class=cl><span class=sd>    group.initial.rebalance.delay.ms=0
</span></span></span><span class=line><span class=cl><span class=sd>    offsets.topic.replication.factor=1
</span></span></span><span class=line><span class=cl><span class=sd>    transaction.state.log.replication.factor=1
</span></span></span><span class=line><span class=cl><span class=sd>    transaction.state.log.min.isr=1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Zookeeper 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zoo.cfg</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    tickTime=2000
</span></span></span><span class=line><span class=cl><span class=sd>    dataDir=/opt/zookeeper/data
</span></span></span><span class=line><span class=cl><span class=sd>    dataLogDir=/opt/zookeeper/logs
</span></span></span><span class=line><span class=cl><span class=sd>    clientPort=2181
</span></span></span><span class=line><span class=cl><span class=sd>    initLimit=5
</span></span></span><span class=line><span class=cl><span class=sd>    syncLimit=2
</span></span></span><span class=line><span class=cl><span class=sd>    server.1=0.0.0.0:2888:3888</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/kafka/deployment.yaml</strong>: Kafka 와 Zookeeper 의 배포를 정의하며, 이벤트 스트리밍을 위한 설정을 포함한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>  1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>  2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>  3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4>  4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5>  5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6>  6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7>  7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8>  8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9>  9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10> 10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11> 11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12> 12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13> 13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14> 14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15> 15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16> 16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17> 17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18> 18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19> 19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20> 20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21> 21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22> 22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23> 23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24> 24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25> 25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26> 26</a>
</span><span class=lnt id=hl-36-27><a class=lnlinks href=#hl-36-27> 27</a>
</span><span class=lnt id=hl-36-28><a class=lnlinks href=#hl-36-28> 28</a>
</span><span class=lnt id=hl-36-29><a class=lnlinks href=#hl-36-29> 29</a>
</span><span class=lnt id=hl-36-30><a class=lnlinks href=#hl-36-30> 30</a>
</span><span class=lnt id=hl-36-31><a class=lnlinks href=#hl-36-31> 31</a>
</span><span class=lnt id=hl-36-32><a class=lnlinks href=#hl-36-32> 32</a>
</span><span class=lnt id=hl-36-33><a class=lnlinks href=#hl-36-33> 33</a>
</span><span class=lnt id=hl-36-34><a class=lnlinks href=#hl-36-34> 34</a>
</span><span class=lnt id=hl-36-35><a class=lnlinks href=#hl-36-35> 35</a>
</span><span class=lnt id=hl-36-36><a class=lnlinks href=#hl-36-36> 36</a>
</span><span class=lnt id=hl-36-37><a class=lnlinks href=#hl-36-37> 37</a>
</span><span class=lnt id=hl-36-38><a class=lnlinks href=#hl-36-38> 38</a>
</span><span class=lnt id=hl-36-39><a class=lnlinks href=#hl-36-39> 39</a>
</span><span class=lnt id=hl-36-40><a class=lnlinks href=#hl-36-40> 40</a>
</span><span class=lnt id=hl-36-41><a class=lnlinks href=#hl-36-41> 41</a>
</span><span class=lnt id=hl-36-42><a class=lnlinks href=#hl-36-42> 42</a>
</span><span class=lnt id=hl-36-43><a class=lnlinks href=#hl-36-43> 43</a>
</span><span class=lnt id=hl-36-44><a class=lnlinks href=#hl-36-44> 44</a>
</span><span class=lnt id=hl-36-45><a class=lnlinks href=#hl-36-45> 45</a>
</span><span class=lnt id=hl-36-46><a class=lnlinks href=#hl-36-46> 46</a>
</span><span class=lnt id=hl-36-47><a class=lnlinks href=#hl-36-47> 47</a>
</span><span class=lnt id=hl-36-48><a class=lnlinks href=#hl-36-48> 48</a>
</span><span class=lnt id=hl-36-49><a class=lnlinks href=#hl-36-49> 49</a>
</span><span class=lnt id=hl-36-50><a class=lnlinks href=#hl-36-50> 50</a>
</span><span class=lnt id=hl-36-51><a class=lnlinks href=#hl-36-51> 51</a>
</span><span class=lnt id=hl-36-52><a class=lnlinks href=#hl-36-52> 52</a>
</span><span class=lnt id=hl-36-53><a class=lnlinks href=#hl-36-53> 53</a>
</span><span class=lnt id=hl-36-54><a class=lnlinks href=#hl-36-54> 54</a>
</span><span class=lnt id=hl-36-55><a class=lnlinks href=#hl-36-55> 55</a>
</span><span class=lnt id=hl-36-56><a class=lnlinks href=#hl-36-56> 56</a>
</span><span class=lnt id=hl-36-57><a class=lnlinks href=#hl-36-57> 57</a>
</span><span class=lnt id=hl-36-58><a class=lnlinks href=#hl-36-58> 58</a>
</span><span class=lnt id=hl-36-59><a class=lnlinks href=#hl-36-59> 59</a>
</span><span class=lnt id=hl-36-60><a class=lnlinks href=#hl-36-60> 60</a>
</span><span class=lnt id=hl-36-61><a class=lnlinks href=#hl-36-61> 61</a>
</span><span class=lnt id=hl-36-62><a class=lnlinks href=#hl-36-62> 62</a>
</span><span class=lnt id=hl-36-63><a class=lnlinks href=#hl-36-63> 63</a>
</span><span class=lnt id=hl-36-64><a class=lnlinks href=#hl-36-64> 64</a>
</span><span class=lnt id=hl-36-65><a class=lnlinks href=#hl-36-65> 65</a>
</span><span class=lnt id=hl-36-66><a class=lnlinks href=#hl-36-66> 66</a>
</span><span class=lnt id=hl-36-67><a class=lnlinks href=#hl-36-67> 67</a>
</span><span class=lnt id=hl-36-68><a class=lnlinks href=#hl-36-68> 68</a>
</span><span class=lnt id=hl-36-69><a class=lnlinks href=#hl-36-69> 69</a>
</span><span class=lnt id=hl-36-70><a class=lnlinks href=#hl-36-70> 70</a>
</span><span class=lnt id=hl-36-71><a class=lnlinks href=#hl-36-71> 71</a>
</span><span class=lnt id=hl-36-72><a class=lnlinks href=#hl-36-72> 72</a>
</span><span class=lnt id=hl-36-73><a class=lnlinks href=#hl-36-73> 73</a>
</span><span class=lnt id=hl-36-74><a class=lnlinks href=#hl-36-74> 74</a>
</span><span class=lnt id=hl-36-75><a class=lnlinks href=#hl-36-75> 75</a>
</span><span class=lnt id=hl-36-76><a class=lnlinks href=#hl-36-76> 76</a>
</span><span class=lnt id=hl-36-77><a class=lnlinks href=#hl-36-77> 77</a>
</span><span class=lnt id=hl-36-78><a class=lnlinks href=#hl-36-78> 78</a>
</span><span class=lnt id=hl-36-79><a class=lnlinks href=#hl-36-79> 79</a>
</span><span class=lnt id=hl-36-80><a class=lnlinks href=#hl-36-80> 80</a>
</span><span class=lnt id=hl-36-81><a class=lnlinks href=#hl-36-81> 81</a>
</span><span class=lnt id=hl-36-82><a class=lnlinks href=#hl-36-82> 82</a>
</span><span class=lnt id=hl-36-83><a class=lnlinks href=#hl-36-83> 83</a>
</span><span class=lnt id=hl-36-84><a class=lnlinks href=#hl-36-84> 84</a>
</span><span class=lnt id=hl-36-85><a class=lnlinks href=#hl-36-85> 85</a>
</span><span class=lnt id=hl-36-86><a class=lnlinks href=#hl-36-86> 86</a>
</span><span class=lnt id=hl-36-87><a class=lnlinks href=#hl-36-87> 87</a>
</span><span class=lnt id=hl-36-88><a class=lnlinks href=#hl-36-88> 88</a>
</span><span class=lnt id=hl-36-89><a class=lnlinks href=#hl-36-89> 89</a>
</span><span class=lnt id=hl-36-90><a class=lnlinks href=#hl-36-90> 90</a>
</span><span class=lnt id=hl-36-91><a class=lnlinks href=#hl-36-91> 91</a>
</span><span class=lnt id=hl-36-92><a class=lnlinks href=#hl-36-92> 92</a>
</span><span class=lnt id=hl-36-93><a class=lnlinks href=#hl-36-93> 93</a>
</span><span class=lnt id=hl-36-94><a class=lnlinks href=#hl-36-94> 94</a>
</span><span class=lnt id=hl-36-95><a class=lnlinks href=#hl-36-95> 95</a>
</span><span class=lnt id=hl-36-96><a class=lnlinks href=#hl-36-96> 96</a>
</span><span class=lnt id=hl-36-97><a class=lnlinks href=#hl-36-97> 97</a>
</span><span class=lnt id=hl-36-98><a class=lnlinks href=#hl-36-98> 98</a>
</span><span class=lnt id=hl-36-99><a class=lnlinks href=#hl-36-99> 99</a>
</span><span class=lnt id=hl-36-100><a class=lnlinks href=#hl-36-100>100</a>
</span><span class=lnt id=hl-36-101><a class=lnlinks href=#hl-36-101>101</a>
</span><span class=lnt id=hl-36-102><a class=lnlinks href=#hl-36-102>102</a>
</span><span class=lnt id=hl-36-103><a class=lnlinks href=#hl-36-103>103</a>
</span><span class=lnt id=hl-36-104><a class=lnlinks href=#hl-36-104>104</a>
</span><span class=lnt id=hl-36-105><a class=lnlinks href=#hl-36-105>105</a>
</span><span class=lnt id=hl-36-106><a class=lnlinks href=#hl-36-106>106</a>
</span><span class=lnt id=hl-36-107><a class=lnlinks href=#hl-36-107>107</a>
</span><span class=lnt id=hl-36-108><a class=lnlinks href=#hl-36-108>108</a>
</span><span class=lnt id=hl-36-109><a class=lnlinks href=#hl-36-109>109</a>
</span><span class=lnt id=hl-36-110><a class=lnlinks href=#hl-36-110>110</a>
</span><span class=lnt id=hl-36-111><a class=lnlinks href=#hl-36-111>111</a>
</span><span class=lnt id=hl-36-112><a class=lnlinks href=#hl-36-112>112</a>
</span><span class=lnt id=hl-36-113><a class=lnlinks href=#hl-36-113>113</a>
</span><span class=lnt id=hl-36-114><a class=lnlinks href=#hl-36-114>114</a>
</span><span class=lnt id=hl-36-115><a class=lnlinks href=#hl-36-115>115</a>
</span><span class=lnt id=hl-36-116><a class=lnlinks href=#hl-36-116>116</a>
</span><span class=lnt id=hl-36-117><a class=lnlinks href=#hl-36-117>117</a>
</span><span class=lnt id=hl-36-118><a class=lnlinks href=#hl-36-118>118</a>
</span><span class=lnt id=hl-36-119><a class=lnlinks href=#hl-36-119>119</a>
</span><span class=lnt id=hl-36-120><a class=lnlinks href=#hl-36-120>120</a>
</span><span class=lnt id=hl-36-121><a class=lnlinks href=#hl-36-121>121</a>
</span><span class=lnt id=hl-36-122><a class=lnlinks href=#hl-36-122>122</a>
</span><span class=lnt id=hl-36-123><a class=lnlinks href=#hl-36-123>123</a>
</span><span class=lnt id=hl-36-124><a class=lnlinks href=#hl-36-124>124</a>
</span><span class=lnt id=hl-36-125><a class=lnlinks href=#hl-36-125>125</a>
</span><span class=lnt id=hl-36-126><a class=lnlinks href=#hl-36-126>126</a>
</span><span class=lnt id=hl-36-127><a class=lnlinks href=#hl-36-127>127</a>
</span><span class=lnt id=hl-36-128><a class=lnlinks href=#hl-36-128>128</a>
</span><span class=lnt id=hl-36-129><a class=lnlinks href=#hl-36-129>129</a>
</span><span class=lnt id=hl-36-130><a class=lnlinks href=#hl-36-130>130</a>
</span><span class=lnt id=hl-36-131><a class=lnlinks href=#hl-36-131>131</a>
</span><span class=lnt id=hl-36-132><a class=lnlinks href=#hl-36-132>132</a>
</span><span class=lnt id=hl-36-133><a class=lnlinks href=#hl-36-133>133</a>
</span><span class=lnt id=hl-36-134><a class=lnlinks href=#hl-36-134>134</a>
</span><span class=lnt id=hl-36-135><a class=lnlinks href=#hl-36-135>135</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Zookeeper 배포 (Kafka 의존성)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-zookeeper:7.4.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>2888</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3888</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>leader-election</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ZOOKEEPER_CLIENT_PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ZOOKEEPER_TICK_TIME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ZOOKEEPER_SERVER_ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;250m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/opt/zookeeper/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper-logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/opt/zookeeper/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper-logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Kafka 배포</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-kafka:7.4.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_BROKER_ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_ZOOKEEPER_CONNECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zookeeper-service:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_ADVERTISED_LISTENERS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;PLAINTEXT://kafka-service:9092&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KAFKA_TRANSACTION_STATE_LOG_MIN_ISR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1Gi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1000m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;kafka-broker-api-versions --bootstrap-server localhost:9092&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;kafka-broker-api-versions --bootstrap-server localhost:9092&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/opt/kafka/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/kafka/service.yaml</strong>: 네트워크 서비스 디스커버리와 로드 밸런싱을 제공한다</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26>26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27>27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28>28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29>29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30>30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31>31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32>32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33>33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34>34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Zookeeper 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Kafka 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=보안-및-네트워킹>보안 및 네트워킹<a hidden class=anchor aria-hidden=true href=#보안-및-네트워킹>#</a></h5><p><strong>k8s/rbac.yaml</strong>: 서비스 계정과 권한을 정의하여 최소 권한 원칙을 적용한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span><span class=lnt id=hl-38-27><a class=lnlinks href=#hl-38-27>27</a>
</span><span class=lnt id=hl-38-28><a class=lnlinks href=#hl-38-28>28</a>
</span><span class=lnt id=hl-38-29><a class=lnlinks href=#hl-38-29>29</a>
</span><span class=lnt id=hl-38-30><a class=lnlinks href=#hl-38-30>30</a>
</span><span class=lnt id=hl-38-31><a class=lnlinks href=#hl-38-31>31</a>
</span><span class=lnt id=hl-38-32><a class=lnlinks href=#hl-38-32>32</a>
</span><span class=lnt id=hl-38-33><a class=lnlinks href=#hl-38-33>33</a>
</span><span class=lnt id=hl-38-34><a class=lnlinks href=#hl-38-34>34</a>
</span><span class=lnt id=hl-38-35><a class=lnlinks href=#hl-38-35>35</a>
</span><span class=lnt id=hl-38-36><a class=lnlinks href=#hl-38-36>36</a>
</span><span class=lnt id=hl-38-37><a class=lnlinks href=#hl-38-37>37</a>
</span><span class=lnt id=hl-38-38><a class=lnlinks href=#hl-38-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 서비스 계정 및 RBAC 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-sa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 클러스터 역할 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-role</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;configmaps&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;secrets&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;apps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;deployments&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 클러스터 역할 바인딩</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-binding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-role</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-sa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>k8s/network-policy.yaml</strong>: 네트워크 보안 정책을 통해 Pod 간 통신을 제어하고 제로 트러스트 네트워킹을 구현한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15>15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16>16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17>17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18>18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19>19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20>20</a>
</span><span class=lnt id=hl-39-21><a class=lnlinks href=#hl-39-21>21</a>
</span><span class=lnt id=hl-39-22><a class=lnlinks href=#hl-39-22>22</a>
</span><span class=lnt id=hl-39-23><a class=lnlinks href=#hl-39-23>23</a>
</span><span class=lnt id=hl-39-24><a class=lnlinks href=#hl-39-24>24</a>
</span><span class=lnt id=hl-39-25><a class=lnlinks href=#hl-39-25>25</a>
</span><span class=lnt id=hl-39-26><a class=lnlinks href=#hl-39-26>26</a>
</span><span class=lnt id=hl-39-27><a class=lnlinks href=#hl-39-27>27</a>
</span><span class=lnt id=hl-39-28><a class=lnlinks href=#hl-39-28>28</a>
</span><span class=lnt id=hl-39-29><a class=lnlinks href=#hl-39-29>29</a>
</span><span class=lnt id=hl-39-30><a class=lnlinks href=#hl-39-30>30</a>
</span><span class=lnt id=hl-39-31><a class=lnlinks href=#hl-39-31>31</a>
</span><span class=lnt id=hl-39-32><a class=lnlinks href=#hl-39-32>32</a>
</span><span class=lnt id=hl-39-33><a class=lnlinks href=#hl-39-33>33</a>
</span><span class=lnt id=hl-39-34><a class=lnlinks href=#hl-39-34>34</a>
</span><span class=lnt id=hl-39-35><a class=lnlinks href=#hl-39-35>35</a>
</span><span class=lnt id=hl-39-36><a class=lnlinks href=#hl-39-36>36</a>
</span><span class=lnt id=hl-39-37><a class=lnlinks href=#hl-39-37>37</a>
</span><span class=lnt id=hl-39-38><a class=lnlinks href=#hl-39-38>38</a>
</span><span class=lnt id=hl-39-39><a class=lnlinks href=#hl-39-39>39</a>
</span><span class=lnt id=hl-39-40><a class=lnlinks href=#hl-39-40>40</a>
</span><span class=lnt id=hl-39-41><a class=lnlinks href=#hl-39-41>41</a>
</span><span class=lnt id=hl-39-42><a class=lnlinks href=#hl-39-42>42</a>
</span><span class=lnt id=hl-39-43><a class=lnlinks href=#hl-39-43>43</a>
</span><span class=lnt id=hl-39-44><a class=lnlinks href=#hl-39-44>44</a>
</span><span class=lnt id=hl-39-45><a class=lnlinks href=#hl-39-45>45</a>
</span><span class=lnt id=hl-39-46><a class=lnlinks href=#hl-39-46>46</a>
</span><span class=lnt id=hl-39-47><a class=lnlinks href=#hl-39-47>47</a>
</span><span class=lnt id=hl-39-48><a class=lnlinks href=#hl-39-48>48</a>
</span><span class=lnt id=hl-39-49><a class=lnlinks href=#hl-39-49>49</a>
</span><span class=lnt id=hl-39-50><a class=lnlinks href=#hl-39-50>50</a>
</span><span class=lnt id=hl-39-51><a class=lnlinks href=#hl-39-51>51</a>
</span><span class=lnt id=hl-39-52><a class=lnlinks href=#hl-39-52>52</a>
</span><span class=lnt id=hl-39-53><a class=lnlinks href=#hl-39-53>53</a>
</span><span class=lnt id=hl-39-54><a class=lnlinks href=#hl-39-54>54</a>
</span><span class=lnt id=hl-39-55><a class=lnlinks href=#hl-39-55>55</a>
</span><span class=lnt id=hl-39-56><a class=lnlinks href=#hl-39-56>56</a>
</span><span class=lnt id=hl-39-57><a class=lnlinks href=#hl-39-57>57</a>
</span><span class=lnt id=hl-39-58><a class=lnlinks href=#hl-39-58>58</a>
</span><span class=lnt id=hl-39-59><a class=lnlinks href=#hl-39-59>59</a>
</span><span class=lnt id=hl-39-60><a class=lnlinks href=#hl-39-60>60</a>
</span><span class=lnt id=hl-39-61><a class=lnlinks href=#hl-39-61>61</a>
</span><span class=lnt id=hl-39-62><a class=lnlinks href=#hl-39-62>62</a>
</span><span class=lnt id=hl-39-63><a class=lnlinks href=#hl-39-63>63</a>
</span><span class=lnt id=hl-39-64><a class=lnlinks href=#hl-39-64>64</a>
</span><span class=lnt id=hl-39-65><a class=lnlinks href=#hl-39-65>65</a>
</span><span class=lnt id=hl-39-66><a class=lnlinks href=#hl-39-66>66</a>
</span><span class=lnt id=hl-39-67><a class=lnlinks href=#hl-39-67>67</a>
</span><span class=lnt id=hl-39-68><a class=lnlinks href=#hl-39-68>68</a>
</span><span class=lnt id=hl-39-69><a class=lnlinks href=#hl-39-69>69</a>
</span><span class=lnt id=hl-39-70><a class=lnlinks href=#hl-39-70>70</a>
</span><span class=lnt id=hl-39-71><a class=lnlinks href=#hl-39-71>71</a>
</span><span class=lnt id=hl-39-72><a class=lnlinks href=#hl-39-72>72</a>
</span><span class=lnt id=hl-39-73><a class=lnlinks href=#hl-39-73>73</a>
</span><span class=lnt id=hl-39-74><a class=lnlinks href=#hl-39-74>74</a>
</span><span class=lnt id=hl-39-75><a class=lnlinks href=#hl-39-75>75</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 네트워크 보안 정책</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkPolicy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-network-policy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>policyTypes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>Egress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 인그레스 규칙 (들어오는 트래픽)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ingress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>from</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>istio-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>monitoring</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 이그레스 규칙 (나가는 트래픽)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>egress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 같은 네임스페이스 내 서비스 통신</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>  </span><span class=c># PostgreSQL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>  </span><span class=c># Redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>9092</span><span class=w>  </span><span class=c># Kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>2181</span><span class=w>  </span><span class=c># Zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 외부 서비스 통신 (다른 마이크로서비스)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>user-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>product-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>payment-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># DNS 조회 허용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>UDP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>53</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>53</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># HTTPS 외부 통신 (모니터링, 로깅 등)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려사항 / 주제</th><th>설명</th><th>권장사항 / 전략</th></tr></thead><tbody><tr><td><strong>아키텍처 설계</strong></td><td>서비스 경계 정의</td><td>비즈니스 도메인 기반의 독립적 서비스 분리 필요</td><td>도메인 주도 설계 (DDD), Bounded Context 적용</td></tr><tr><td></td><td>통신 방식 선택</td><td>서비스 간 통신 방식 (REST/gRPC 등) 에 따른 성능·복잡도 영향</td><td>고성능 요구 시 gRPC, API Gateway 활용</td></tr><tr><td></td><td>마이그레이션 전략</td><td>레거시 시스템과의 공존 및 단계적 전환 필요</td><td>Strangler Fig 패턴, 하이브리드·멀티클라우드 전략 적용</td></tr><tr><td><strong>CI/CD & 자동화</strong></td><td>자동화된 배포 파이프라인 구축</td><td>신속하고 신뢰성 있는 배포 체계 필수</td><td>GitOps, Jenkins, GitLab, Canary/Rolling 배포 적용</td></tr><tr><td></td><td>테스트 자동화</td><td>배포 전 안정성 확보 필요</td><td>통합 테스트, Mock/Stub 테스트, E2E 테스트 자동화</td></tr><tr><td></td><td>IaC 도입</td><td>인프라 구성의 재현성과 자동화 필수</td><td>Terraform, Pulumi 등 IaC 도구 활용</td></tr><tr><td><strong>관찰가능성</strong></td><td>통합 모니터링 구성</td><td>로그, 메트릭, 트레이싱 통합이 필수</td><td>Prometheus, Grafana, ELK, Jaeger, OpenTelemetry 도입</td></tr><tr><td></td><td>장애 추적 및 분석</td><td>분산 환경에서 원인 탐색이 어려움</td><td>분산 추적 시스템 구축, APM 도구 활용</td></tr><tr><td><strong>보안</strong></td><td>서비스 간 통신 보안</td><td>네트워크 상에서의 안전한 데이터 전송 필요</td><td>mTLS, RBAC, OPA, 네트워크 정책 구성</td></tr><tr><td></td><td>인증/인가 강화</td><td>리소스 접근 통제 및 최소 권한 정책 필요</td><td>Zero Trust 모델, OAuth2, 정기 보안 감사</td></tr><tr><td></td><td>DevSecOps 문화 정착</td><td>개발 - 운영 - 보안 연계의 자동화 및 조기 통합</td><td>보안 자동화 툴 통합, 이미지 스캔, SBoM 관리</td></tr><tr><td><strong>조직 및 문화</strong></td><td>DevOps 문화 구축</td><td>사일로 조직 탈피 및 협업 문화 필요</td><td>크로스 펀셔널 팀 구성, 자율성 부여, 실패 수용 문화 조성</td></tr><tr><td></td><td>기술 학습 및 도입 관리</td><td>새로운 기술 도입 시 학습 곡선 존재</td><td>단계적 학습 프로그램, PoC 기반 적용, 내부 교육 체계 운영</td></tr><tr><td><strong>운영 및 복원력</strong></td><td>장애 대응 전략</td><td>서비스 실패 발생 시 자동 복구 필요</td><td>Kubernetes Self-healing, Auto-scaling, Chaos Engineering 적용</td></tr><tr><td></td><td>시스템 복원력 검증</td><td>장애 상황에서의 탄력성 확보</td><td>카오스 테스트, 롤백 전략 수립, 인시던트 대응 프로세스 표준화</td></tr><tr><td></td><td>정기 아키텍처 리뷰</td><td>기술 부채 누적 방지 및 개선</td><td>리뷰 프로세스 도입, 기술 우선순위 정의, 기술 부채 관리</td></tr><tr><td><strong>데이터 관리</strong></td><td>일관성 모델 설계</td><td>분산 환경에서 ACID 유지의 어려움</td><td>최종 일관성 기반 설계, Event Sourcing, CQRS, SAGA 패턴 도입</td></tr><tr><td></td><td>데이터 보안 및 접근 제어</td><td>민감 정보 처리 시 암호화와 접근 통제가 필요</td><td>데이터 암호화, 비밀 관리 솔루션 (e.g., Vault), 감사 로깅</td></tr><tr><td><strong>네트워크 및 메시</strong></td><td>서비스 메시 구성</td><td>트래픽 제어 및 보안 정책 적용 필요</td><td>Istio/Linkerd 기반 트래픽 제어, 정책 관리</td></tr><tr><td></td><td>네트워크 지연 최소화</td><td>서비스 간 통신으로 인한 레이턴시 증가</td><td>비동기 통신, 로컬 캐싱, 데이터 지역성 고려</td></tr><tr><td><strong>비용 최적화</strong></td><td>자원 사용 관리</td><td>과도한 리소스 사용은 비용 상승 유발</td><td>HPA/VPA 기반 자동 스케일링, FinOps, 예약/스팟 인스턴스 전략</td></tr><tr><td></td><td>운영비용 모니터링</td><td>실시간 비용 추적 및 예측 필요</td><td>클라우드 비용 분석 도구 활용, 태그 기반 비용 추적, 알람 설정</td></tr></tbody></table><h4 id=적용-시-주의할-점-요약>적용 시 주의할 점 요약<a hidden class=anchor aria-hidden=true href=#적용-시-주의할-점-요약>#</a></h4><table><thead><tr><th>항목</th><th>주의 사항</th><th>회피 전략</th></tr></thead><tbody><tr><td>과도한 마이크로서비스 분해</td><td>복잡도 및 관리 포인트 증가</td><td>서비스 분리 기준 명확히 수립, 최소 실행 단위로 설계</td></tr><tr><td>중앙 집중식 조직 구조</td><td>자율성 결여, 병목 발생 가능성</td><td>도메인 기반 크로스 펀셔널 팀 구성</td></tr><tr><td>무계획 기술 도입</td><td>기술 부채 유발, 운영 복잡성 증가</td><td>PoC 기반 검증 → 중요도 낮은 서비스부터 도입</td></tr><tr><td>비용 관리 부재</td><td>클라우드 사용량 증가로 인한 과금 급증</td><td>모니터링, 자동 종료 정책, 비용 리포팅 도입</td></tr><tr><td>보안 정책 일관성 부족</td><td>환경별 정책 상이, 보안 공백 발생</td><td>정책 템플릿화, 보안 자동화 및 DevSecOps 연동</td></tr></tbody></table><h4 id=클라우드-네이티브-환경에서-발생-가능한-문제>클라우드 네이티브 환경에서 발생 가능한 문제<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-환경에서-발생-가능한-문제>#</a></h4><table><thead><tr><th>문제 유형</th><th>원인 요약</th><th>탐지 및 진단 기법</th><th>예방 방법</th><th>해결 방법</th></tr></thead><tbody><tr><td><strong>분산 시스템 장애</strong></td><td>- 네트워크 분할<br>- 서비스 간 의존성 연쇄 실패<br>- 부분 장애</td><td>- Circuit Breaker 이벤트 로그<br>- 헬스체크<br>- 타임아웃 모니터링</td><td>- 회로 차단기 패턴 (Circuit Breaker)<br>- 재시도 + 백오프<br>- 헬스체크 엔드포인트 구축</td><td>- Bulkhead 패턴<br>- 비동기 메시징 도입<br>- 자동 장애 조치 (Auto-failover)<br>- 카오스 테스트</td></tr><tr><td><strong>데이터 일관성 문제</strong></td><td>- 분산 트랜잭션<br>- 비동기 처리 지연<br>- 마이크로서비스별 데이터베이스</td><td>- 무결성 검증 스크립트<br>- 이벤트 소싱 감사 로그<br>- 실시간 상태 감시</td><td>- 이벤트 기반 처리 구조<br>SAGA 패턴<br>- 최종 일관성 기반 모델 도입</td><td>- 보상 트랜잭션 실행<br>- 이벤트 재처리<br>- 수동 정합성 검증 및 수동 수정</td></tr><tr><td><strong>컨테이너 보안 취약점</strong></td><td>- 취약 이미지 사용<br>- 과도 권한 설정<br>- 설정 오류</td><td>- 이미지 스캔 도구<br>PodSecurityPolicy 감시<br>- 네트워크 정책 로그</td><td>- 취약점 정기 스캔<br>- 최소 권한 원칙 적용<br>- 네트워크 격리 및 시크릿 암호화</td><td>- 취약 컨테이너 격리<br>- 패치 이미지로 롤아웃<br>- 보안 사고 대응 프로세스 가동</td></tr><tr><td><strong>리소스 고갈 (과부하)</strong></td><td>- 리소스 제한 미설정<br>- 메모리 누수<br>- 트래픽 급증</td><td>- 리소스 모니터링 (CPU/Mem)<br>- 임계치 알람 설정<br>- 프로파일링</td><td>- HPA 설정<br>- 리소스 요청/제한 설정<br>- 로드 테스트 주기 실행</td><td>- 긴급 확장 (스케일업/스케일아웃)<br>- 트래픽 제한<br>- 백그라운드 서비스 중단</td></tr></tbody></table><h5 id=참고-키워드-및-관련-기술>참고 키워드 및 관련 기술<a hidden class=anchor aria-hidden=true href=#참고-키워드-및-관련-기술>#</a></h5><table><thead><tr><th>개념</th><th>설명</th><th>주요 도구/패턴</th></tr></thead><tbody><tr><td><strong>회로 차단기 패턴</strong></td><td>장애 발생 시 일시적으로 요청 차단</td><td><code>opossum</code>, <code>resilience4j</code>, <code>Hystrix</code></td></tr><tr><td><strong>Bulkhead 패턴</strong></td><td>장애가 다른 영역으로 확산되지 않도록 격리</td><td>Thread Pool, Worker Queue 등 격리 구간 운영</td></tr><tr><td><strong>SAGA 패턴</strong></td><td>분산 트랜잭션 대체 전략, 보상 트랜잭션 포함</td><td>Event Choreography, Command Orchestration</td></tr><tr><td><strong>최종 일관성 모델</strong></td><td>eventual consistency 를 기본으로 동작하는 데이터 모델</td><td>Event Sourcing, NoSQL</td></tr><tr><td><strong>PodSecurityPolicy</strong></td><td>Kubernetes 의 기본적인 보안 정책 도구</td><td><code>psp</code>, <code>OPA</code>, <code>Kyverno</code>, <code>PodSecurity</code></td></tr><tr><td><strong>HPA/VPA</strong></td><td>수평/수직 자동 스케일링 정책</td><td>Kubernetes Autoscaler</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>최적화 영역</th><th>고려사항 / 주의점</th><th>권장사항 또는 전략</th></tr></thead><tbody><tr><td><strong>성능 최적화</strong></td><td>캐싱 전략</td><td>캐시 무효화 복잡성, 불필요한 외부 호출</td><td>다층 캐시 구조, TTL 정책, Redis 활용</td></tr><tr><td></td><td>컨테이너 성능</td><td>오버헤드 증가, 이미지 부피 과다</td><td>Multi-stage build, Alpine 기반 이미지, 성능 프로파일링</td></tr><tr><td></td><td>JVM/Garbage GC</td><td>Java 기반 앱 성능 저하 가능</td><td>GC 튜닝, JVM 설정 최적화</td></tr><tr><td></td><td>네트워크 지연</td><td>서비스 간 통신 지연, 사이드카 오버헤드</td><td>gRPC 사용, 서비스 메시 최적화, 지역성 고려 배치</td></tr><tr><td><strong>스케일링 최적화</strong></td><td>오토스케일링</td><td>지연, 과다 확장, 과소 프로비저닝</td><td>HPA/VPA 조합, 커스텀 메트릭 기반 스케일링, 예측 + 반응 조합 스케일링</td></tr><tr><td></td><td>상태 비저장화</td><td>세션 정보가 로컬에 존재 시 확장성 저하</td><td>Redis 등 외부 세션 스토리지 사용</td></tr><tr><td><strong>가용성 & 장애 대응</strong></td><td>다중 리전 운영</td><td>데이터 동기화 지연, 장애 발생 시 복구 지연</td><td>비동기 복제, 멀티 AZ 배포, 자동 장애 조치 구성</td></tr><tr><td></td><td>장애 감지 및 회복</td><td>장애 전파, 롤백 실패 가능성</td><td>헬스체크, 롤링 업데이트, 서킷 브레이커 적용, 자동 복구 플로우 구성</td></tr><tr><td><strong>보안 최적화</strong></td><td>컨테이너 및 이미지 보안</td><td>런타임 공격, 취약한 이미지 사용</td><td>이미지 스캐닝, SBoM, 런타임 보안 모니터링</td></tr><tr><td></td><td>네트워크 보안</td><td>허술한 정책으로 인한 공격 노출</td><td>Zero Trust 모델, mTLS, NetworkPolicy 적용</td></tr><tr><td></td><td>정책 및 인증</td><td>RBAC/OAuth 설정 부재 또는 과도 설정</td><td>세밀한 RBAC 설계, 자동화된 보안 검사, OPA 기반 정책 구성</td></tr><tr><td><strong>배포 전략 최적화</strong></td><td>점진적 배포</td><td>블루/그린 배포 중 다운타임 발생 가능</td><td>카나리 배포, 트래픽 점진 전환, 자동 롤백 구성</td></tr><tr><td></td><td>CI/CD 병목</td><td>빌드 시간 과도, 테스트 병렬화 실패</td><td>증분 빌드, 병렬 테스트 실행, 테스트 캐시 활용</td></tr><tr><td></td><td>GitOps 배포</td><td>선언형과 실제 상태 불일치</td><td>ArgoCD/Flux 상태 싱크 알림 설정, 자동 재조정</td></tr><tr><td><strong>리소스 최적화</strong></td><td>컨테이너 자원 할당</td><td>과소/과대 할당으로 인한 비용 증가</td><td>리소스 요청/제한 최적화, VPA 적용, 자원 프로파일링</td></tr><tr><td></td><td>비용 최적화</td><td>예약 인스턴스 누락, 스팟 인스턴스 미활용</td><td>스팟 인스턴스, 자동 종료 정책, 비용 추적 시스템 도입</td></tr><tr><td><strong>데이터 최적화</strong></td><td>파티셔닝 & 샤딩</td><td>핫스팟 발생, 쏠림 문제</td><td>데이터 샤딩, 해시 기반 로드 밸런싱, 분산 쿼리 최적화</td></tr><tr><td></td><td>이벤트 기반 저장</td><td>이벤트 일관성 유지, 스냅샷 관리</td><td>Event Sourcing + CQRS 적용, 이벤트 리플레이 전략 수립</td></tr><tr><td><strong>관찰가능성 최적화</strong></td><td>메트릭 수집</td><td>메트릭 오버헤드, 무분별한 수집</td><td>샘플링, 메트릭 수명 관리, 핵심 메트릭만 집중 수집</td></tr><tr><td></td><td>로깅</td><td>과도한 로그로 인한 저장 비용 증가</td><td>로그 레벨 조정, Fluentd 필터링, 중앙화 로그 저장소 사용</td></tr><tr><td></td><td>분산 추적</td><td>스팬 누락, 성능 오버헤드</td><td>Jaeger/Zipkin 샘플링 조정, context 전파 최적화</td></tr><tr><td><strong>테스트 & 문서화</strong></td><td>테스트 자동화</td><td>E2E 테스트 병목, Mock/Stub 부족</td><td>테스트 병렬화, CI 통합, 테스트 시나리오 다양화</td></tr><tr><td></td><td>운영 문서화</td><td>문서 부재 또는 업데이트 누락</td><td>Swagger/OpenAPI 활용, 운영 위키화, 자동 문서 생성 파이프라인</td></tr><tr><td><strong>아키텍처 개선</strong></td><td>기술 부채 누적</td><td>구식 라이브러리, 설계 오류 축적</td><td>정기 아키텍처 리뷰, 리팩토링 주기화, 신규 기술/패턴 도입 프로세스 운영</td></tr></tbody></table><ul><li><strong>HPA/VPA</strong>: Horizontal/Vertical Pod Autoscaler</li><li><strong>OPA</strong>: Open Policy Agent</li><li><strong>gRPC</strong>: 고성능 통신을 위한 Google RPC</li><li><strong>Service Mesh</strong>: Istio/Linkerd 등 통신 관리 계층</li><li><strong>Zero Trust</strong>: 인증 중심의 경계 없는 보안 모델</li></ul><h3 id=주제와-관련하여-주목할-내용들>주제와 관련하여 주목할 내용들<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용들>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>ア키텍처 원칙</strong></td><td>12-Factor App</td><td>클라우드 네이티브 환경에 최적화된 앱 개발 원칙</td></tr><tr><td></td><td>마이크로서비스</td><td>독립적으로 배포 및 확장 가능한 서비스 단위 구성</td></tr><tr><td></td><td>서버리스 (Serverless)</td><td>인프라 추상화를 통해 코드 실행에 집중</td></tr><tr><td></td><td>Cloud-Native</td><td>클라우드 환경에 최적화된 아키텍처 스타일</td></tr><tr><td></td><td>API Gateway</td><td>서비스 통합 진입점으로 인증, 라우팅, 트래픽 제어 수행</td></tr><tr><td><strong>컨테이너/인프라</strong></td><td>컨테이너 (Container)</td><td>실행 환경의 격리 및 이식성 제공</td></tr><tr><td></td><td>Kubernetes</td><td>컨테이너 오케스트레이션 플랫폼, 자동화된 배포/확장/복구 기능 제공</td></tr><tr><td></td><td>Sidecar Pattern</td><td>보조 기능을 제공하는 별도 컨테이너를 함께 배포하는 패턴</td></tr><tr><td></td><td>Rook</td><td>Kubernetes 네이티브 분산 스토리지 운영 (Ceph 등 지원)</td></tr><tr><td></td><td>Vitess</td><td>MySQL 기반의 수평 확장 샤딩 솔루션</td></tr><tr><td><strong>오케스트레이션</strong></td><td>KEDA</td><td>이벤트 기반 Kubernetes 오토스케일링 도구</td></tr><tr><td></td><td>Crossplane</td><td>클라우드 인프라를 Kubernetes API 기반으로 관리</td></tr><tr><td><strong>DevOps/자동화</strong></td><td>CI/CD</td><td>지속적 통합/배포를 통해 자동화된 개발 파이프라인 구축</td></tr><tr><td></td><td>ArgoCD + ApplicationSet</td><td>GitOps 기반 다중 클러스터 자동 배포</td></tr><tr><td></td><td>Tekton</td><td>Kubernetes 네이티브 CI/CD 파이프라인 구성</td></tr><tr><td></td><td>IaC (Infrastructure as Code)</td><td>Terraform, Pulumi 등으로 코드 기반 인프라 자동화</td></tr><tr><td></td><td>GitOps</td><td>Git 저장소 기반 선언형 배포 방식</td></tr><tr><td><strong>서비스 메시</strong></td><td>Istio</td><td>트래픽 제어, 보안, 관측성 등을 위한 강력한 메시 인프라</td></tr><tr><td></td><td>Ambient Mesh</td><td>사이드카 없는 경량 메시 아키텍처 구현 (Istio 기반)</td></tr><tr><td></td><td>Linkerd</td><td>경량화된 서비스 메시, Rust 기반 프록시 (Linkerd2-proxy) 포함</td></tr><tr><td><strong>보안</strong></td><td>Zero Trust</td><td>내부/외부 구분 없는 무조건 검증 기반의 보안 모델</td></tr><tr><td></td><td>mTLS (Mutual TLS)</td><td>클라이언트와 서버 간의 상호 인증 제공</td></tr><tr><td></td><td>OPA Gatekeeper</td><td>Kubernetes 정책을 코드로 정의하고 통제 (Policy as Code)</td></tr><tr><td></td><td>Falco</td><td>컨테이너 런타임 보안 모니터링 및 위협 탐지</td></tr><tr><td><strong>관찰가능성</strong></td><td>Observability Stack</td><td>Prometheus, Grafana, ELK 등 통합 모니터링 체계</td></tr><tr><td></td><td>OpenTelemetry</td><td>분산 트레이싱, 메트릭, 로그 수집을 위한 표준 오픈소스 프레임워크</td></tr><tr><td></td><td>Auto-instrumentation</td><td>코드 변경 없이 자동 계측 기능 지원</td></tr><tr><td></td><td>Jaeger + Adaptive Sampling</td><td>트래픽 양에 따른 동적 샘플링을 통해 효율적 분산 추적 가능</td></tr><tr><td><strong>네트워킹</strong></td><td>Cilium</td><td>eBPF 기반 고성능 CNI (네트워크 플러그인), 관측성 및 보안 기능 강화</td></tr><tr><td></td><td>Envoy Gateway</td><td>Envoy 기반 Kubernetes 네이티브 API Gateway</td></tr><tr><td><strong>데이터</strong></td><td>Apache Pinot</td><td>실시간 분석용 OLAP 엔진 (초고속 쿼리 처리)</td></tr><tr><td></td><td>CQRS</td><td>명령과 조회 책임을 분리하여 성능과 확장성 개선</td></tr><tr><td></td><td>Event Sourcing</td><td>상태 변경 이력을 이벤트 시퀀스로 저장</td></tr><tr><td><strong>메시징</strong></td><td>NATS</td><td>경량, 고성능의 클라우드 네이티브 메시징 시스템</td></tr></tbody></table><h3 id=주제-관련-추가-학습-필요-항목>주제 관련 추가 학습 필요 항목<a hidden class=anchor aria-hidden=true href=#주제-관련-추가-학습-필요-항목>#</a></h3><table><thead><tr><th>대분류</th><th>주제</th><th>세부 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>개발 원칙</strong></td><td>애플리케이션 설계</td><td>12-Factor App</td><td>클라우드 환경에 최적화된 앱 설계 원칙 (환경 구성, 릴리즈, 로깅 등)</td></tr><tr><td></td><td>마이크로서비스 설계</td><td>단일 책임, 느슨한 결합, 높은 응집도</td><td>독립적 배포와 유지보수를 위한 서비스 분해 원칙</td></tr><tr><td></td><td>API 설계</td><td>REST, GraphQL, API 버저닝 등</td><td>확장성과 보안 고려한 API 중심 설계 전략</td></tr><tr><td><strong>인프라 관리</strong></td><td>IaC</td><td>Terraform, Pulumi, Ansible</td><td>인프라 코드화를 통한 자동화, 버전관리</td></tr><tr><td></td><td>클라우드 플랫폼</td><td>AWS, Azure, GCP</td><td>주요 클라우드 환경에서 제공하는 관리형 서비스 활용</td></tr><tr><td></td><td>오케스트레이션</td><td>Kubernetes, containerd</td><td>컨테이너 스케줄링, 서비스 배포/확장/복구 등 관리</td></tr><tr><td><strong>운영 모델</strong></td><td>GitOps</td><td>ArgoCD, Flux</td><td>Git 기반 선언형 배포 모델로 운영 일관성 확보</td></tr><tr><td></td><td>CI/CD 파이프라인</td><td>Jenkins, GitLab CI 등</td><td>코드 빌드, 테스트, 배포 자동화</td></tr><tr><td><strong>보안</strong></td><td>제로 트러스트</td><td>mTLS, RBAC, 정책 엔진 등</td><td>인증·인가·통신 보안 강화 (서비스 간 보안 경계 강화)</td></tr><tr><td></td><td>컨테이너 보안</td><td>이미지 스캔, 런타임 보안 도구</td><td>보안 위협 대응을 위한 컨테이너 기반 공격 탐지 및 방어</td></tr><tr><td></td><td>정책 기반 보안</td><td>OPA, Kyverno</td><td>보안 정책 적용 및 검증 자동화</td></tr><tr><td><strong>데이터 처리</strong></td><td>이벤트 기반 처리</td><td>Event Sourcing, CQRS</td><td>상태 변경 이벤트 기록 기반 아키텍처 (복구, 트레이싱)</td></tr><tr><td></td><td>분산 데이터 관리</td><td>CAP 이론, BASE/ACID 트랜잭션</td><td>데이터 일관성 모델, 분산 트랜잭션 처리 전략</td></tr><tr><td><strong>네트워킹</strong></td><td>서비스 디스커버리</td><td>DNS, Consul, Service Mesh</td><td>동적 서비스 탐색 및 로드 밸런싱 구현</td></tr><tr><td></td><td>서비스 메시</td><td>Istio, Linkerd</td><td>트래픽 라우팅, 관찰가능성, mTLS 기반 보안 통신</td></tr><tr><td><strong>관찰가능성</strong></td><td>메트릭 수집</td><td>Prometheus, Grafana</td><td>메트릭 기반 모니터링 및 시각화</td></tr><tr><td></td><td>로깅</td><td>ELK Stack, Fluentd</td><td>로그 수집, 중앙화, 파싱 및 검색</td></tr><tr><td></td><td>분산 추적</td><td>Jaeger, Zipkin</td><td>트랜잭션 추적 및 성능 병목 지점 분석</td></tr><tr><td><strong>서비스 모델</strong></td><td>서버리스</td><td>AWS Lambda, Google Cloud Func</td><td>이벤트 기반 실행, 인프라 관리 최소화</td></tr><tr><td></td><td>하이브리드/멀티클라우드</td><td>온프레미스 + 퍼블릭 클라우드</td><td>여러 클라우드 환경 통합 운영 전략</td></tr><tr><td><strong>보안운영</strong></td><td>DevSecOps</td><td>자동화된 보안, 취약점 분석</td><td>CI/CD 파이프라인에서 보안 검사 자동화, 통합 운영</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>아키텍처 스타일</strong></td><td>클라우드 네이티브 (Cloud-Native)</td><td>클라우드에 최적화된 애플리케이션 아키텍처 설계 및 운영 방식</td></tr><tr><td></td><td>마이크로서비스 (Microservices)</td><td>독립적으로 배포 가능한 작고 기능 중심의 서비스 단위로 구성된 아키텍처</td></tr><tr><td></td><td>서버리스 (Serverless)</td><td>서버 관리 없이 이벤트 기반으로 코드 실행하는 컴퓨팅 모델</td></tr><tr><td></td><td>API 게이트웨이 (API Gateway)</td><td>클라이언트 요청을 통합 처리하는 단일 진입점 서비스</td></tr><tr><td></td><td>서비스 메시 (Service Mesh)</td><td>마이크로서비스 간의 통신, 보안, 트래픽을 제어하는 인프라 계층</td></tr><tr><td></td><td>사이드카 패턴 (Sidecar Pattern)</td><td>애플리케이션과 함께 배포되는 독립 실행 보조 컨테이너</td></tr><tr><td></td><td>스트랭글러 피그 (Strangler Fig)</td><td>레거시 시스템을 점진적으로 대체하는 마이그레이션 전략</td></tr><tr><td><strong>운영 방법론</strong></td><td>DevOps</td><td>개발과 운영의 통합 및 자동화를 통한 협업 중심 개발 문화</td></tr><tr><td></td><td>GitOps</td><td>Git 저장소를 운영 소스로 삼아 인프라와 앱을 선언형으로 자동 배포하는 방식</td></tr><tr><td></td><td>불변 인프라 (Immutable Infrastructure)</td><td>인프라 구성 변경 대신 전체 교체로 상태 일관성을 유지하는 방식</td></tr><tr><td></td><td>CI/CD</td><td>지속적 통합 및 지속적 배포를 자동화하는 개발 파이프라인</td></tr><tr><td></td><td>IaC (Infrastructure as Code)</td><td>인프라 구성을 코드로 정의하고 관리하는 방법</td></tr><tr><td><strong>컨테이너 기술</strong></td><td>컨테이너 (Container)</td><td>실행 환경을 이식성과 일관성 있게 제공하는 경량화된 패키징 기술</td></tr><tr><td></td><td>Kubernetes</td><td>컨테이너 오케스트레이션 플랫폼으로 자동 배포, 확장, 복구 지원</td></tr><tr><td></td><td>오케스트레이션 (Orchestration)</td><td>컨테이너의 전체 라이프사이클 (배포, 확장, 복구 등) 자동화 관리</td></tr><tr><td><strong>배포 전략</strong></td><td>카나리 배포 (Canary Deployment)</td><td>일부 사용자에게만 새 버전을 배포해 위험을 점진적으로 평가하는 전략</td></tr><tr><td></td><td>블루 - 그린 배포 (Blue-Green Deployment)</td><td>두 개의 환경을 번갈아 사용하여 배포 중 다운타임을 최소화하는 전략</td></tr><tr><td></td><td></td><td></td></tr><tr><td><strong>모니터링/관찰성</strong></td><td>관찰가능성 (Observability)</td><td>로그, 메트릭, 트레이싱 등으로 시스템 내부 상태를 추론하는 능력</td></tr><tr><td></td><td>분산 추적 (Distributed Tracing)</td><td>여러 서비스에 걸친 요청 경로 추적 (예: OpenTelemetry, Jaeger)</td></tr><tr><td></td><td>SLI / SLO / SLA</td><td>서비스 품질 관리 지표: 지표/목표/계약 기반의 가시성 제공</td></tr><tr><td><strong>보안</strong></td><td>제로 트러스트 (Zero Trust)</td><td>내부/외부 구분 없이 모든 접속을 검증하는 보안 모델</td></tr><tr><td></td><td>mTLS (Mutual TLS)</td><td>클라이언트 - 서버 간 상호 인증을 지원하는 TLS 프로토콜</td></tr><tr><td></td><td>RBAC (Role-Based Access Control)</td><td>역할 기반 권한 부여 시스템으로 리소스 접근 제어</td></tr><tr><td><strong>데이터 아키텍처</strong></td><td>이벤트 소싱 (Event Sourcing)</td><td>상태 변경을 이벤트로 저장하고 복원하는 방식</td></tr><tr><td></td><td>CQRS</td><td>Command(쓰기) 와 Query(읽기) 의 책임을 분리하는 아키텍처 패턴</td></tr><tr><td></td><td>결과적 일관성 (Eventual Consistency)</td><td>분산 환경에서 일정 시간 후에 데이터 일관성을 보장하는 모델</td></tr><tr><td></td><td>SAGA 패턴</td><td>마이크로서비스 간 분산 트랜잭션을 관리하는 패턴</td></tr><tr><td><strong>복원력/장애대응</strong></td><td>회로 차단기 (Circuit Breaker)</td><td>장애 전파를 방지하기 위한 트래픽 차단 및 복구 전략</td></tr><tr><td></td><td>벌크헤드 (Bulkhead)</td><td>시스템을 격리해 특정 부분의 장애가 전체로 확산되는 것을 방지하는 구조</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><h3 id=클라우드-네이티브-아키텍처-개요-및-원칙>클라우드 네이티브 아키텍처 개요 및 원칙<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-아키텍처-개요-및-원칙>#</a></h3><ul><li><a href=https://cloud.google.com/blog/products/application-development/5-principles-for-cloud-native-architecture-what-it-is-and-how-to-master-it>클라우드 네이티브 아키텍처 5가지 원칙 - Google Cloud</a></li><li><a href=https://www.cncf.io/>클라우드 네이티브 정의 - CNCF</a></li><li><a href=https://12factor.net/>12-Factor App 방법론</a></li><li><a href=https://aws.amazon.com/what-is/cloud-native/>클라우드 네이티브란? - AWS</a></li><li><a href=https://www.redhat.com/en/topics/cloud-native-apps/what-is-cloud-native>클라우드 네이티브 애플리케이션 개요 - Red Hat</a></li></ul><h3 id=마이크로서비스-및-구현-사례>마이크로서비스 및 구현 사례<a hidden class=anchor aria-hidden=true href=#마이크로서비스-및-구현-사례>#</a></h3><ul><li><a href=https://learn.microsoft.com/en-us/dotnet/architecture/cloud-native/definition>마이크로서비스 아키텍처 정의 및 가이드 - Microsoft Learn</a></li><li><a href=https://aws.amazon.com/solutions/case-studies/netflix-case-study/>Netflix 클라우드 네이티브 사례 연구 - AWS</a></li><li><a href=https://www.oreilly.com/library/view/cloud-native-patterns/9781492057893/>Cloud Native Patterns - O&rsquo;Reilly</a></li><li><a href=https://microservices.io/patterns/index.html>Microservices Patterns - Chris Richardson</a></li></ul><h3 id=기술-요소-및-플랫폼>기술 요소 및 플랫폼<a hidden class=anchor aria-hidden=true href=#기술-요소-및-플랫폼>#</a></h3><ul><li><a href=https://kubernetes.io/>Kubernetes 공식 문서</a></li><li><a href=https://istio.io/latest/docs/concepts/>Istio 서비스 메시 개념 문서</a></li><li><a href=https://docs.docker.com/engine/security/>Docker 보안 가이드</a></li><li><a href=https://opentelemetry.io/docs/>OpenTelemetry 공식 문서</a></li><li><a href=https://prometheus.io/docs/>Prometheus 공식 문서</a></li></ul><h3 id=보안-및-표준>보안 및 표준<a hidden class=anchor aria-hidden=true href=#보안-및-표준>#</a></h3><ul><li><a href=https://csrc.nist.gov/publications/detail/sp/800-204/final>클라우드 네이티브 보안 가이드 - NIST SP 800-204</a></li></ul><h3 id=아키텍처-레퍼런스-및-설문-보고서>아키텍처 레퍼런스 및 설문 보고서<a hidden class=anchor aria-hidden=true href=#아키텍처-레퍼런스-및-설문-보고서>#</a></h3><ul><li><a href=https://aws.amazon.com/architecture/cloud-native/>AWS Cloud-Native Reference Architecture</a></li><li><a href=https://cloud.google.com/architecture>Google Cloud Architecture Center</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/>Azure Architecture Center</a></li><li><a href=https://aws.amazon.com/architecture/well-architected/>AWS Well-Architected Framework</a></li><li><a href=https://www.cncf.io/reports/cncf-annual-survey-2024/>CNCF Annual Survey</a></li><li><a href=https://cloud.google.com/devops/state-of-devops>State of DevOps Report - Google Cloud</a></li><li><a href=https://www.redhat.com/en/resources/kubernetes-adoption-security-market-trends-2024-overview>Kubernetes Adoption and Security Report - Red Hat</a></li></ul><hr></div><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Multi-Cloud Architecture</h2></header><div class=entry-content><p>Multi-Cloud Architecture 멀티클라우드 아키텍처는 AWS, Azure, Google Cloud 등 여러 클라우드 제공자의 서비스를 조합해 애플리케이션 및 데이터를 분산 운영하는 전략적 접근 방식이다. 이를 통해 각 클라우드의 장점을 극대화하고, 장애·보안·규제 등 다양한 리스크를 분산시켜 비즈니스 연속성, 확장성, 비용 효율성, 혁신성을 높인다. 그러나 관리 복잡성, 네트워크 설계, 보안 정책 통합 등 실무적 과제가 존재하며, 이를 극복하기 위한 자동화·통합 관리·표준화 전략이 필수적이다.
핵심 개념 멀티클라우드 아키텍처 (Multi-Cloud Architecture) 는 둘 이상의 퍼블릭 클라우드 (예: AWS, Azure, Google Cloud) 를 활용해 애플리케이션, 데이터, 서비스를 분산 배치·운영하는 IT 아키텍처를 의미한다.
...</p></div><footer class=entry-footer><span title='2025-07-06 02:10:00 +0000 UTC'>July 6, 2025</span>&nbsp;·&nbsp;27 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Multi-Cloud Architecture" href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/multi-cloud-architecture/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Serverless Architecture</h2></header><div class=entry-content><p>Serverless Architecture Serverless Architecture(서버리스 아키텍처) 는 개발자가 서버 인프라를 직접 관리하지 않고, 클라우드 서비스 제공자가 컴퓨팅 리소스의 프로비저닝, 확장, 운영을 자동으로 처리하는 현대적 아키텍처 스타일이다. 대표적으로 Function as a Service(FaaS, 함수형 서비스) 와 Backend as a Service(BaaS, 백엔드 서비스) 가 있으며, 이벤트 기반 트리거, 자동 확장, 사용량 기반 과금, 빠른 배포와 높은 확장성을 특징으로 한다. 이로 인해 개발자는 비즈니스 로직 구현에 집중할 수 있다.
핵심 개념 Serverless Architecture(서버리스 아키텍처) 는 서버 인프라 관리 없이, 클라우드 서비스 제공자가 모든 인프라 운영을 책임지고, 개발자는 코드 (주로 함수 단위) 만 작성하여 배포하는 아키텍처 스타일이다.
...</p></div><footer class=entry-footer><span title='2025-03-19 12:08:00 +0000 UTC'>March 19, 2025</span>&nbsp;·&nbsp;21 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Serverless Architecture" href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/serverless-architecture/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Microservices Architecture</h2></header><div class=entry-content><p>Microservices Architecture Microservices Architecture(마이크로서비스 아키텍처) 는 복잡한 애플리케이션을 작고 독립적으로 배포 가능한 서비스 단위로 분해하여, 각 서비스가 자체 데이터와 비즈니스 로직을 관리하고, API 를 통해 상호작용하는 아키텍처 스타일이다. 이 구조는 확장성과 장애 격리, 빠른 배포, 기술 스택의 다양화, 팀별 독립 개발 등 다양한 이점을 제공한다. 반면, 서비스 간 통신, 데이터 일관성, 운영 관리 복잡성 등 새로운 도전 과제도 동반한다. Netflix, Amazon 등 글로벌 IT 기업들이 대표적으로 적용하고 있다.
배경 모놀리식 아키텍처의 한계:
...</p></div><footer class=entry-footer><span title='2025-02-01 03:24:00 +0000 UTC'>February 1, 2025</span>&nbsp;·&nbsp;49 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Microservices Architecture" href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/cloud-native/microservices-architecture/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>