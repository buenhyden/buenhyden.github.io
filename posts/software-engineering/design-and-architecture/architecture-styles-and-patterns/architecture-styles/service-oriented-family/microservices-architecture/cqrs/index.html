<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CQRS | hyunyoun's Blog</title><meta name=keywords content="System-and-Software-Architecture,Architectural-Patterns,CQRS"><meta name=description content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/cqrs/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/cqrs/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/cqrs/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/cqrs/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="CQRS"><meta property="og:description" content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="CQRS"><meta name=twitter:description content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":4,"name":"Architecture Styles and Patterns","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/"},{"@type":"ListItem","position":5,"name":"Architectue Styles","item":""},{"@type":"ListItem","position":6,"name":"Service-Oriented","item":""},{"@type":"ListItem","position":7,"name":"Microservices Architecture","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/"},{"@type":"ListItem","position":8,"name":"CQRS","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/cqrs/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/>Architecture Styles and Patterns</a>&nbsp;»&nbsp;<a href>Architectue Styles</a>&nbsp;»&nbsp;<a href>Service-Oriented</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-styles/service-oriented-family/microservices-architecture/>Microservices Architecture</a></div><h1>CQRS</h1><div class=post-description>CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다.</div></header><div class=post-content><h2 id=cqrs>CQRS<a hidden class=anchor aria-hidden=true href=#cqrs>#</a></h2><p>아래는 “CQRS(Command Query Responsibility Segregation)”에 대한 체계적이고 포괄적인 조사 결과입니다.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li><strong>CQRS-Pattern</strong></li><li><strong>Command-Query-Separation</strong></li><li><strong>Event-Sourcing</strong></li><li><strong>Scalable-Architecture</strong></li></ul><hr><h2 id=2-분류-구조-분석>2. 분류 구조 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석>#</a></h2><p><strong>계층 구조:</strong><br>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Styles and Patterns > Architecture Patterns > Data Management</p><p><strong>분석 및 근거:</strong><br>CQRS는 소프트웨어 아키텍처 패턴으로, 데이터 읽기(Query)와 쓰기(Command) 작업을 분리하여 각각 최적화된 모델로 처리하는 설계 원칙입니다. 이는 “Architecture Styles and Patterns” 하위의 “Architecture Patterns”에 적합하게 분류되며, 데이터 관리(Data Management)와도 밀접하게 연관되어 있으므로 하위로 포함하는 것이 타당합니다. 실제로 CQRS는 도메인 주도 설계(DDD), 이벤트 소싱(Event Sourcing)과 함께 사용되어 데이터 처리와 확장성, 유지보수성을 높이는 데 활용됩니다<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">1</a><a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation?utm_source=chatgpt.com" title="Command–query separation">3</a>.</p><hr><h2 id=3-요약200자-내외>3. 요약(200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약200자-내외>#</a></h2><p>CQRS는 데이터 읽기와 쓰기 작업을 분리해 각각의 모델과 저장소로 처리함으로써 성능, 확장성, 유지보수성을 높이는 소프트웨어 아키텍처 패턴이다<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html?utm_source=chatgpt.com" title="CQRS pattern - AWS Prescriptive Guidance">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">2</a>.</p><hr><h2 id=4-개요250자-내외>4. 개요(250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요250자-내외>#</a></h2><p>CQRS는 애플리케이션의 데이터 읽기(Query)와 쓰기(Command) 작업을 별도의 모델과 저장소로 분리하여, 각 작업에 최적화된 처리와 독립적 확장이 가능하도록 설계하는 아키텍처 패턴이다. 이를 통해 복잡한 도메인에서 성능, 확장성, 유지보수성을 크게 향상시킬 수 있다<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html?utm_source=chatgpt.com" title="CQRS pattern - AWS Prescriptive Guidance">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">2</a>.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>명령(Command):</strong> 시스템의 상태를 변경하는 작업(예: 생성, 수정, 삭제).</li><li><strong>쿼리(Query):</strong> 시스템의 상태를 변경하지 않고 데이터를 조회하는 작업.</li><li><strong>책임 분리:</strong> 읽기와 쓰기 작업을 완전히 분리하여 각각의 모델과 저장소를 사용.</li><li><strong>독립적 최적화:</strong> 읽기와 쓰기 모델을 각각의 목적에 맞게 최적화.</li><li><strong>이벤트 소싱:</strong> 상태 변경 이벤트를 저장하여 복원 및 감사, 도메인 모델링에 활용 가능.</li></ul><p><strong>실무 구현 요소</strong></p><ul><li><strong>Command Handler:</strong> 명령을 처리하는 핸들러.</li><li><strong>Query Handler:</strong> 쿼리를 처리하는 핸들러.</li><li><strong>Command Model:</strong> 쓰기 작업에 최적화된 데이터 모델.</li><li><strong>Query Model:</strong> 읽기 작업에 최적화된 데이터 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트를 저장하는 저장소(선택).</li><li><strong>Synchronization Mechanism:</strong> Command와 Query 모델 간 데이터 동기화(필요 시).</li></ul><hr><h2 id=6-조사-내용주요-항목별-정리>6. 조사 내용(주요 항목별 정리)<a hidden class=anchor aria-hidden=true href=#6-조사-내용주요-항목별-정리>#</a></h2><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>CQRS는 기존 CRUD 기반 아키텍처에서 복잡성이 증가하고, 읽기와 쓰기 작업의 요구사항이 달라지면서 각각의 작업에 최적화된 처리가 필요해진 데서 등장했습니다. 이로 인해 유지보수성, 확장성, 성능 문제가 해결되고 있습니다<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">5</a><a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">6</a>.</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li><strong>성능 및 확장성:</strong> 읽기와 쓰기 작업을 독립적으로 확장 및 최적화.</li><li><strong>복잡성 관리:</strong> 도메인 복잡성 증가 시 유지보수성 향상.</li><li><strong>보안:</strong> 읽기와 쓰기 권한을 분리하여 보안 강화<a href="https://microservices.io/patterns/data/cqrs.html?utm_source=chatgpt.com" title="Pattern: Command Query Responsibility Segregation (CQRS)">1</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html?utm_source=chatgpt.com" title="CQRS pattern - AWS Prescriptive Guidance">4</a>.</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li><strong>Command Side:</strong> 데이터 생성, 수정, 삭제.</li><li><strong>Query Side:</strong> 데이터 조회.</li><li><strong>Event Sourcing:</strong> 상태 변경 이벤트 저장 및 재생(선택).</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>읽기/쓰기 분리:</strong> 각각의 모델과 저장소 사용.</li><li><strong>독립적 확장:</strong> 읽기와 쓰기 작업을 독립적으로 확장.</li><li><strong>이벤트 기반:</strong> 상태 변경 이벤트 저장 및 활용(선택).</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ul><li><strong>단일 책임:</strong> 명령(Command)과 쿼리(Query)는 각각 단일 책임.</li><li><strong>독립적 최적화:</strong> 읽기와 쓰기 모델을 각각 최적화.</li><li><strong>이벤트 기반:</strong> 상태 변경 이벤트 저장 및 활용(선택)<a href="https://www.confluent.io/learn/cqrs/?utm_source=chatgpt.com" title="Command Query Responsibility Segregation (CQRS) - Confluent">8</a><a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">10</a>.</li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7>7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Diagram: CQRS Architecture]
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│  CLIENTS    │ → │ COMMAND API │ → │ WRITE MODEL │
</span></span><span class=line><span class=cl>│             │   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>│ APPLICATION │ ← │  QUERY API  │ ← │ READ MODEL  │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(Optional: Event Store for Command side)
</span></span></code></pre></td></tr></table></div></div><p>읽기와 쓰기 작업이 완전히 분리되어 있으며, 명령은 쓰기 모델에, 쿼리는 읽기 모델에 접근합니다. 필요 시 이벤트 소싱을 통해 상태 변경 이벤트를 저장하고 재생할 수 있습니다<a href="https://www.confluent.io/learn/cqrs/?utm_source=chatgpt.com" title="Command Query Responsibility Segregation (CQRS) - Confluent">2</a><a href="https://medium.com/%40joudwawad/implement-cqrs-architecture-on-aws-c9c8c92bcaff?utm_source=chatgpt.com" title="Implement CQRS Architecture on AWS | Joud W. Awad - Medium">11</a>.</p><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><ul><li><strong>Command Side:</strong> 명령 처리, 쓰기 모델, 이벤트 저장(선택).</li><li><strong>Query Side:</strong> 쿼리 처리, 읽기 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트 저장(선택).</li><li><strong>Synchronization Mechanism:</strong> Command와 Query 모델 간 데이터 동기화(필요 시).</li></ul><p><strong>각 구성요소의 기능과 역할</strong></p><ul><li><strong>Command Handler:</strong> 명령을 받아 처리하고, 쓰기 모델에 반영.</li><li><strong>Query Handler:</strong> 쿼리를 받아 읽기 모델에서 데이터 조회.</li><li><strong>Write Model:</strong> 데이터 생성, 수정, 삭제에 최적화된 모델.</li><li><strong>Read Model:</strong> 데이터 조회에 최적화된 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트 저장(선택, 이벤트 소싱 사용 시).</li><li><strong>Synchronization Mechanism:</strong> 쓰기 모델의 변경을 읽기 모델에 반영(필요 시).</li></ul><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><ul><li><strong>분리된 모델:</strong> 읽기와 쓰기 모델을 완전히 분리.</li><li><strong>이벤트 소싱:</strong> 상태 변경 이벤트를 저장하여 재생 및 감사 가능.</li><li><strong>메시지 큐/브로커:</strong> 명령 처리 결과를 이벤트로 발행, 읽기 모델에 반영.</li><li><strong>독립적 저장소:</strong> 읽기와 쓰기 모델에 각각 최적화된 저장소 사용.</li><li><strong>동기화:</strong> 쓰기 모델의 변경을 읽기 모델에 반영하는 동기화 메커니즘 구현.</li></ul><p><strong>실제 예시(시나리오):</strong></p><ul><li><strong>쓰기:</strong> 주문 생성 명령 → Command Handler → Write Model(주문 저장) → Event Store(주문 생성 이벤트 저장) → Message Queue(이벤트 발행).</li><li><strong>읽기:</strong> 주문 조회 쿼리 → Query Handler → Read Model(주문 조회).</li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 원인</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 작업을 독립적으로 확장 가능</td><td>읽기/쓰기 분리</td></tr><tr><td>장점</td><td>성능</td><td>각 작업에 최적화된 모델과 저장소 사용</td><td>독립적 최적화</td></tr><tr><td>장점</td><td>유지보수성</td><td>코드가 분리되어 유지보수 용이</td><td>책임 분리</td></tr><tr><td>장점</td><td>보안</td><td>읽기와 쓰기 권한 분리로 보안 강화</td><td>책임 분리</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>시스템 구성이 복잡해짐</td><td>경험 축적, 문서화</td></tr><tr><td>단점</td><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 데이터 불일치 가능</td><td>동기화 메커니즘, 이벤트 기반 처리</td></tr></tbody></table><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 불일치</td><td>동기화 지연, 이벤트 처리 실패</td><td>사용자 경험 저하</td><td>모니터링, 로그 분석</td><td>이벤트 처리 신뢰성 강화</td><td>이벤트 재처리, 동기화 메커니즘 강화</td></tr><tr><td>문제점</td><td>과도한 복잡성</td><td>불필요한 CQRS 적용</td><td>개발 및 유지보수 비용 증가</td><td>코드 리뷰, 아키텍처 리뷰</td><td>CQRS 필요성 평가</td><td>CRUD로 복귀, 도메인 단위로 CQRS 적용</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>도전 과제</td><td>대규모 시스템 적용</td><td>동기화 및 이벤트 처리 복잡성</td><td>시스템 안정성 저하</td><td>모니터링, 테스트</td><td>모듈화, 마이크로서비스 전환</td><td>이벤트 기반 아키텍처, 분산 트랜잭션 관리</td></tr><tr><td>도전 과제</td><td>팀 온보딩 및 코드 관리</td><td>아키텍처 복잡성, 팀원 이해 부족</td><td>개발 비용 증가, 일관성 저하</td><td>코드 리뷰, 문서화</td><td>교육, 예시 코드 제공</td><td>문서화, 코드 리뷰, 멘토링</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th></tr></thead><tbody><tr><td>분리 수준</td><td>클래스 분리</td><td>읽기와 쓰기 클래스만 분리</td></tr><tr><td>분리 수준</td><td>모델 분리</td><td>읽기와 쓰기 모델 분리</td></tr><tr><td>분리 수준</td><td>저장소 분리</td><td>읽기와 쓰기 저장소 분리(진정한 CQRS)</td></tr><tr><td>적용 범위</td><td>전체 시스템</td><td>시스템 전체에 CQRS 적용</td></tr><tr><td>적용 범위</td><td>도메인 단위</td><td>특정 도메인에만 CQRS 적용</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td>확장성</td><td>Spring, Node.js, Kafka</td><td>읽기와 쓰기 독립적 확장</td></tr><tr><td>성능</td><td>Redis, MongoDB, PostgreSQL</td><td>각 작업에 최적화된 저장소 사용</td></tr><tr><td>유지보수성</td><td>DDD, Event Sourcing</td><td>코드 분리로 유지보수성 향상</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><p><strong>RisingStack Node.js 모니터링 툴:</strong><br>CQRS를 적용해 데이터 수집(Command)과 데이터 시각화(Query)를 분리.</p><ul><li><strong>시스템 구성:</strong><ul><li>Command Side: 데이터 수집 API, 메시지 큐, 작업자(Worker), 쓰기 모델(데이터베이스)</li><li>Query Side: 읽기 모델(데이터베이스 복제본), 시각화 API</li></ul></li><li><strong>Workflow:</strong><ul><li>데이터 수집 → Command API → 메시지 큐 → 작업자 → 쓰기 모델</li><li>데이터 시각화 → Query API → 읽기 모델</li></ul></li><li><strong>역할:</strong><ul><li>Command Side: 데이터 수집 및 저장</li><li>Query Side: 데이터 조회 및 시각화</li></ul></li><li><strong>차이점:</strong><ul><li>기존 CRUD 방식은 읽기와 쓰기 작업이 동일 모델과 저장소에서 처리되어 성능 병목 및 복잡성 증가.</li><li>CQRS는 읽기와 쓰기를 분리해 각각 최적화되어 성능과 확장성 향상[12].</li></ul></li></ul><h3 id=구현-예시-python>구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35>35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Side</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Validate and process command</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=s2>&#34;order_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Side</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>read_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=n>read_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Usage</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>read_model</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>(</span><span class=n>read_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>order_id</span> <span class=o>=</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>create_order</span><span class=p>({</span><span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;Laptop&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>  <span class=c1># None (initially, read model is not synced)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Simulate event processing to update read model</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>read_model</span><span class=p>[</span><span class=n>event</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>  <span class=c1># {&#39;product&#39;: &#39;Laptop&#39;, &#39;quantity&#39;: 1}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에만 적용</td><td>CRUD로 충분한 경우 CQRS 적용 지양</td></tr><tr><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 동기화 필수</td><td>이벤트 기반 동기화, 신뢰성 강화</td></tr><tr><td>이벤트 처리</td><td>이벤트 처리 실패 시 복구 필요</td><td>이벤트 재처리, 장애 복구 메커니즘</td></tr><tr><td>문서화</td><td>아키텍처 및 코드 문서화</td><td>문서화, 예시 코드 제공</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>저장소 선택</td><td>읽기와 쓰기 모델에 최적화된 저장소 사용</td><td>Redis, MongoDB, PostgreSQL 등 상황에 맞는 저장소 선택</td></tr><tr><td>캐싱</td><td>읽기 모델에 캐싱 적용</td><td>캐싱 전략 적용</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 시 성능 고려</td><td>이벤트 배치 처리, 스트리밍 처리</td></tr><tr><td>모니터링</td><td>데이터 동기화 및 이벤트 처리 모니터링</td><td>모니터링, 로그 분석</td></tr></tbody></table><h3 id=기타-사항>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항>#</a></h3><ul><li><strong>이벤트 소싱과의 연계:</strong> CQRS는 이벤트 소싱과 함께 사용될 때 가장 큰 효과를 발휘합니다. 상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용할 수 있습니다[8]<a href="https://medium.com/%40joudwawad/implement-cqrs-architecture-on-aws-c9c8c92bcaff?utm_source=chatgpt.com" title="Implement CQRS Architecture on AWS | Joud W. Awad - Medium">13</a>.</li><li><strong>마이크로서비스와의 연계:</strong> CQRS는 마이크로서비스 환경에서 각 서비스의 독립적 확장과 유지보수성 향상에 유리합니다[8][14].</li><li><strong>적용 범위:</strong> 전체 시스템이 아닌, 복잡한 도메인이나 확장성이 중요한 부분에만 적용하는 것이 바람직합니다[15][16].</li></ul><hr><h2 id=7-추가-조사-내용>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용>#</a></h2><ul><li><strong>CQRS와 CRUD 비교:</strong><ul><li><strong>CRUD:</strong> 읽기와 쓰기 작업이 동일 모델과 저장소에서 처리. 단순하지만 복잡한 도메인에서는 성능 및 확장성 문제 발생.</li><li><strong>CQRS:</strong> 읽기와 쓰기 작업을 분리하여 각각 최적화. 복잡한 도메인, 대규모 시스템에 적합<a href="https://www.linkedin.com/posts/theburningmonk_cqrs-explained-in-4-mins-what-is-cqrs-activity-7273276195960492032-gK_Y?utm_source=chatgpt.com" title="CQRS Explained in 4 Mins | What is CQRS? Pros & Cons | Yan Cui">1</a><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">2</a>.</li></ul></li><li><strong>이벤트 소싱:</strong><ul><li>상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용.</li><li>CQRS와 함께 사용 시 시스템의 유연성과 확장성 극대화[8]<a href="https://medium.com/%40joudwawad/implement-cqrs-architecture-on-aws-c9c8c92bcaff?utm_source=chatgpt.com" title="Implement CQRS Architecture on AWS | Joud W. Awad - Medium">13</a>.</li></ul></li><li><strong>적용 범위:</strong><ul><li>전체 시스템이 아닌, 복잡한 도메인이나 확장성이 중요한 부분에만 적용.</li><li>도메인 주도 설계(DDD)와 함께 사용 시 효과적[15][16][14].</li></ul></li></ul><hr><h2 id=8-주목할-내용>8. 주목할 내용<a hidden class=anchor aria-hidden=true href=#8-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>CQRS</td><td>읽기/쓰기 분리</td><td>데이터 읽기와 쓰기 작업을 분리하여 각각 최적화</td></tr><tr><td>설계 패턴</td><td>CQRS</td><td>이벤트 소싱</td><td>상태 변경 이벤트 저장 및 재생, 감사, 도메인 모델링</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>마이크로서비스</td><td>독립적 확장, 유지보수성 향상</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>도메인 주도 설계</td><td>복잡한 도메인에서 효과적</td></tr></tbody></table><hr><h2 id=9-반드시-학습해야-할-내용>9. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#9-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 원칙</td><td>CQRS</td><td>책임 분리</td><td>읽기와 쓰기 작업을 분리하여 각각 최적화</td></tr><tr><td>설계 원칙</td><td>CQRS</td><td>이벤트 소싱</td><td>상태 변경 이벤트 저장 및 재생</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>도메인 주도 설계</td><td>복잡한 도메인에서 효과적</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 데이터 동기화 메커니즘</td></tr></tbody></table><hr><h2 id=10-용어-정리>10. 용어 정리<a hidden class=anchor aria-hidden=true href=#10-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>CQRS</td><td>데이터 읽기와 쓰기 작업을 분리하여 각각 최적화된 모델과 저장소로 처리하는 아키텍처 패턴</td></tr><tr><td>설계 원칙</td><td>Command</td><td>시스템의 상태를 변경하는 작업(생성, 수정, 삭제)</td></tr><tr><td>설계 원칙</td><td>Query</td><td>시스템의 상태를 변경하지 않고 데이터를 조회하는 작업</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용</td></tr><tr><td>실무 적용</td><td>Read Model</td><td>데이터 조회에 최적화된 모델</td></tr><tr><td>실무 적용</td><td>Write Model</td><td>데이터 생성, 수정, 삭제에 최적화된 모델</td></tr></tbody></table><hr><h2 id=11-참고-및-출처>11. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#11-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center | Microsoft Learn</a></li><li><a href=https://dokhakbaksa.tistory.com/101>CQRS 패턴 - 짱구 - 티스토리</a></li><li><a href=https://www.linkedin.com/pulse/what-purpose-cqrs-pavan-kumar-devulapalli-v7crc>What is the purpose of CQRS? - LinkedIn</a></li><li><a href=https://www.advanceworks.ai/command-query-responsibility-segregation-cqrs/>Command Query Responsibility Segregation (CQRS) - AdvanceWorks</a></li><li><a href=https://www.redhat.com/ko/blog/illustrated-cqrs>An illustrated guide to CQRS data patterns - Red Hat</a></li><li><a href=https://blog.naver.com/seek316/223247564137>CQRS(Command Query Responsibility Segregation) 개념 - 네이버 블로그</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li><li><a href=https://www.graphapp.ai/blog/understanding-the-cqrs-pattern-benefits-and-implementation-strategies>Understanding the CQRS Pattern: Benefits and Implementation Strategies - GraphApp</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>The CQRS Pattern - System Design School</a></li><li><a href=https://blog.devops.dev/understanding-cqrs-pattern-pros-cons-and-a-spring-boot-example-69138eef603f>Understanding CQRS Pattern: Pros, Cons, and a Spring Boot Example - DevOps.dev</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/tip/Common-CQRS-pattern-problems-and-how-teams-can-avoid-them>Common CQRS pattern problems, and how teams can avoid them - TechTarget</a></li><li><a href=https://martinfowler.com/bliki/CQRS.html>CQRS - Martin Fowler</a></li><li><a href=https://enterprisecraftsmanship.com/posts/types-of-cqrs/>Types of CQRS - Enterprise Craftsmanship</a></li><li><a href=https://www.rootstrap.com/blog/demystifying-cqrs-a-practical-approach---simple-cqrs-part-1>Demystifying CQRS: A Practical Approach – Simple CQRS [Part 1] - Rootstrap</a></li><li><a href=https://blog.risingstack.com/cqrs-explained-node-js-at-scale/>CQRS Explained - RisingStack Engineering</a></li><li><a href=https://blog.nashtechglobal.com/introduction-to-cqrs/>Introduction to CQRS(Working, Uses, Benefits) - NashTech Blog</a></li><li><a href=https://github.com/slashdotdash/cqrs-best-practices>CQRS/ES best practices - GitHub</a></li><li><a href=https://blog.bytedoodle.com/cqrs-schema-design-synchronization-and-consistency-considerations/>CQRS : Schema Design, Synchronization and Consistency Considerations - ByeDoodle</a>
아래는 <strong>CQRS(Command‑Query Responsibility Segregation)</strong> 아키텍처에 대한 1차 정리입니다. 이후 원하시면 단계별로 세부 내용을 더 깊이 다룰 수 있습니다!</li></ul><hr><h2 id=1-태그-1>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-1>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CQRS, Command‑Query‑Segregation, Event‑Sourcing‑Integration, Data‑Models‑Separation
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-분류-계층-적절성-분석>2. 분류 계층 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-계층-적절성-분석>#</a></h2><ul><li><p>현 분류:</p><blockquote><p>Computer Science and Engineering → Software Engineering → Design and Architecture → Architecture Styles and Patterns → Architecture Patterns → Data Management</p></blockquote></li><li><p><strong>분석</strong>: 적합합니다.
CQRS는 데이터 모델과 책임 분리 아키텍처로, 대규모 데이터 시스템 및 이벤트 기반 설계에 중요하며, ‘Data Management’ 하위에 위치하는 것이 타당합니다. (<a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">en.wikipedia.org</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>)</p></li></ul><hr><h2 id=3-200자-요약>3. 200자 요약<a hidden class=anchor aria-hidden=true href=#3-200자-요약>#</a></h2><p>CQRS는 명령(Command, 쓰기)과 조회(Query, 읽기)를 분리해 각각의 흐름과 데이터 모델을 독립적으로 최적화하는 패턴입니다. 이를 통해 읽기 성능 향상, 스케일 독립성, 보안 강화, 그리고 복잡한 도메인 로직을 명확히 관리할 수 있습니다. Event Sourcing과 결합하면 이력감사, 비동기 업데이트, 강력한 트랜잭션 모델 제공도 가능합니다.</p><hr><h2 id=4-250자-개요>4. 250자 개요<a hidden class=anchor aria-hidden=true href=#4-250자-개요>#</a></h2><p>CQRS는 시스템의 쓰기(Command)와 읽기(Query) 요청을 논리적으로 분리하여 처리하는 아키텍처 패턴입니다. 쓰기 모델은 복잡한 도메인 로직과 비즈니스 규칙 처리를 담당하고, 읽기 모델은 데이터 조회에 최적화된 경량 모델로 설계됩니다. 두 모델은 동일하거나 분리된 데이터 저장소를 사용하며, Event Sourcing 이벤트를 통해 읽기 모델이 업데이트되고, 처리량, 보안, 유지보수성을 크게 개선할 수 있습니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>)</p><hr><h2 id=5-핵심-개념-및-실무-구현-요소>5. 핵심 개념 및 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-및-실무-구현-요소>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li><strong>Command vs Query</strong>: 상태 변경 <strong>Command</strong>는 결과 미반환, <strong>Query</strong>는 정보 반환만 수행 (<a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation?utm_source=chatgpt.com" title="Command–query separation">en.wikipedia.org</a>)</li><li><strong>쓰기 모델 (Write Model)</strong>: 비즈니스 로직 처리, 트랜잭션 관리</li><li><strong>읽기 모델 (Read Model)</strong>: 조회 최적화, DTO/Projections 생성</li><li><strong>데이터 저장소 분리</strong>: 동일 DB 또는 RDBMS와 NoSQL 등 별도 사용 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html?utm_source=chatgpt.com" title="CQRS pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>)</li><li><strong>Event Sourcing 통합</strong>: 상태 변경을 이벤트 스트림으로 저장, 읽기 모델로 비동기 업데이트 (<a href="https://www.linkedin.com/posts/theburningmonk_cqrs-explained-in-4-mins-what-is-cqrs-activity-7273276195960492032-gK_Y?utm_source=chatgpt.com" title="CQRS Explained in 4 Mins | What is CQRS? Pros & Cons | Yan Cui">linkedin.com</a>)</li></ul><h3 id=51-실무-구현-요소>5.1 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#51-실무-구현-요소>#</a></h3><ul><li><strong>Command Handler</strong> 구현 및 Command 객체정의</li><li><strong>Query Handler</strong> 구현 및 DTO 또는 projection 설계</li><li><strong>Event</strong> 발행 및 구독자(subscription) 구조 구축</li><li><strong>데이터베이스</strong> 설계: 복합/단독 DB 또는 복수 DB</li><li><strong>메시징</strong>: Kafka, RabbitMQ 등 이벤트 전달용 인프라</li><li><strong>동기화 메커니즘</strong>: 이벤트 소비자(consumers) 구성 및 eventual consistency 확보</li><li><strong>테스트 전략</strong>: Command/Query 유닛 테스트, 통합 테스트, 컨트랙트 테스트</li></ul><hr><p>다음 단계로 작성하기 좋은 항목을 골라주세요:</p><ul><li>A. “구조 및 아키텍처 + 구성 요소” + Mermaid 다이어그램</li><li>B. “주요 원리 & 작동 원리” 시각화</li><li>C. “장단점 분석” 및 “문제점 상세 분석”</li><li>D. “실무 사용 예시” 및 “활용 사례”</li><li>E. “구현 예시(Python/JS 코드)”</li></ul><p>원하시는 순서를 선택해 주세요!</p><p><a href=https://www.codeproject.com/articles/555855/introduction-to-cqrs><figure><img alt="Introduction to CQRS- CodeProject" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.5VvG29FDkUU3E8TaJqDVFwHaGr\\&r=0\\&pid=Api"></figure></a></p><hr><h2 id=-5-구조-및-아키텍처-structure--architecture>🚦 5. 구조 및 아키텍처 (Structure & Architecture)<a hidden class=anchor aria-hidden=true href=#-5-구조-및-아키텍처-structure--architecture>#</a></h2><p>CQRS는 <strong>Command(쓰기)</strong> 와 <strong>Query(읽기)</strong> 책임을 분리하며, 종종 <strong>Event Sourcing</strong>과 결합해 구현됩니다. 핵심 구성 요소는 아래와 같습니다:</p><pre class=mermaid>flowchart LR
  subgraph Write Side
    UI(UI/API) --&gt; CB[Command Bus/Facade]
    CB --&gt; CH[Command Handler]
    CH --&gt; DM[Domain Model / Aggregates]
    DM --&gt; ES[Event Store] --&gt; EB[Event Bus]
  end

  subgraph Read Side
    EB --&gt; EH[Event Handler / Projector]
    EH --&gt; RD[Read Database / Materialized View]
    UI --&gt; QF[Query Facade] --&gt; RD
  end
</pre><ul><li><strong>UI/API</strong>: 사용자의 명령(Command)과 조회(Query)를 입력받습니다. (<a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">martinfowler.com</a>)</li><li><strong>Command Bus / Facade & Handler</strong>: Command를 수신하고 도메인에 전달 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">rabbitstack.github.io</a>)</li><li><strong>Domain Model / Aggregates</strong>: 비즈니스 규칙을 처리하고 Event를 생성합니다 (<a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation?utm_source=chatgpt.com" title="Command–query separation">ibm-cloud-architecture.github.io</a>)</li><li><strong>Event Store</strong>: 이벤트를 저장하는 append-only 저장소 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html?utm_source=chatgpt.com" title="CQRS pattern - AWS Prescriptive Guidance">red-gate.com</a>)</li><li><strong>Event Bus</strong>: 이벤트를 발행하고 구독하도록 브로드캐스트합니다 (<a href="https://www.linkedin.com/posts/theburningmonk_cqrs-explained-in-4-mins-what-is-cqrs-activity-7273276195960492032-gK_Y?utm_source=chatgpt.com" title="CQRS Explained in 4 Mins | What is CQRS? Pros & Cons | Yan Cui">codeproject.com</a>)</li><li><strong>Event Handler / Projector</strong>: 이벤트를 소비해 Read DB를 업데이트하며, Projection 역할 수행 (<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">upsolver.com</a>)</li><li><strong>Read Database</strong>: 조회에 최적화된 뷰(view)를 제공하는 DB (<a href="https://microservices.io/patterns/data/cqrs.html?utm_source=chatgpt.com" title="Pattern: Command Query Responsibility Segregation (CQRS)">microservices.io</a>)</li><li><strong>Query Facade/Service</strong>: 사용자 요청(Query)을 수신하고 Read DB에서 응답합니다 </li></ul><hr><h3 id=-필수-구성-요소-vs-선택-구성-요소>📘 필수 구성 요소 vs 선택 구성 요소<a hidden class=anchor aria-hidden=true href=#-필수-구성-요소-vs-선택-구성-요소>#</a></h3><table><thead><tr><th>구분</th><th>구성 요소</th><th>역할</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td>Command Handler, Query Handler, Read DB, Write DB or Event Store, Domain Model</td><td>읽기·쓰기 분리 구조 완성</td></tr><tr><td><strong>선택</strong></td><td>Event Store, Event Bus, Event Handlers, Message Broker</td><td>Event Sourcing, 비동기 복제, 마이크로서비스 확장성 확보</td></tr></tbody></table><hr><h2 id=-6-주요-원리--작동-원리>🔁 6. 주요 원리 & 작동 원리<a hidden class=anchor aria-hidden=true href=#-6-주요-원리--작동-원리>#</a></h2><ul><li><strong>Command-Query 분리 (CQS 준수)</strong>: 명령(Command)은 상태 변경만, 조회(Query)는 정보만 반환합니다 (<a href="https://www.kurrent.io/cqrs-pattern?utm_source=chatgpt.com" title="A Beginner's Guide to CQRS - Kurrent">kurrent.io</a>, <a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">martinfowler.com</a>, <a href="https://www.confluent.io/learn/cqrs/?utm_source=chatgpt.com" title="Command Query Responsibility Segregation (CQRS) - Confluent">confluent.io</a>, <a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">en.wikipedia.org</a>)</li><li><strong>각 모델 독립 최적화</strong>: Write 모델은 도메인 로직 중심, Read 모델은 성능 중심 설계 </li><li><strong>Event 브로드캐스팅 & Projection</strong>: Write가 발생한 Event는 비동기적으로 Read 모델에 반영 </li><li><strong>Eventual Consistency (점진 일관성)</strong>: Command 완료 후 Read DB 반영까지 지연될 수 있습니다 (<a href="https://medium.com/%40joudwawad/implement-cqrs-architecture-on-aws-c9c8c92bcaff?utm_source=chatgpt.com" title="Implement CQRS Architecture on AWS | Joud W. Awad - Medium">medium.com</a>)</li></ul><hr><h3 id=-실행-흐름>💡 실행 흐름<a hidden class=anchor aria-hidden=true href=#-실행-흐름>#</a></h3><ol><li><strong>쓰기 요청</strong>: 유저 UI/API → Command → Command Handler</li><li><strong>도메인 처리</strong>: Command Handler → Domain Model → Event 생성</li><li><strong>이벤트 저장 및 발행</strong>: Event Store에 쓰고 Event Bus 통해 전달</li><li><strong>Projection 처리</strong>: Event Handler가 Read DB 업데이트</li><li><strong>조회 요청</strong>: 유저 → Query Handler → Read DB → 결과 반환</li></ol><p>이 구조는 읽기·쓰기 책임을 분리하면서 성능과 확장성을 극대화하고, 복잡한 도메인 로직도 깔끔하게 관리할 수 있습니다.</p><hr><p>다음으로 어떤 부분을 상세하게 다뤄볼까요?</p><ul><li>A. <strong>장단점 분석 + 문제점 정리</strong></li><li>B. <strong>실무 사용 예시 + 활용 사례</strong></li><li>C. <strong>구현 예시 (Python / JS 코드)</strong></li></ul><p>선택하시면, 다음 단계로 진행하겠습니다!</p><p><a href=https://www.codeproject.com/articles/555855/introduction-to-cqrs><figure><img alt="Introduction to CQRS- CodeProject" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.5VvG29FDkUU3E8TaJqDVFwHaGr\\&r=0\\&pid=Api"></figure></a></p><p>아래는 <strong>CQRS의 실무 사용 예시</strong>와 <strong>활용 사례 분석</strong>, 그리고 **코드 구현 예시(Python)**입니다.</p><hr><h2 id=-11-실무-사용-예시>🧪 11. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#-11-실무-사용-예시>#</a></h2><table><thead><tr><th>기술 스택</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Java Spring + Axon Framework</td><td>이벤트 소싱 기반 주문/결제 시스템 구현</td><td>명령·조회 분리, 이벤트 기반 확장 및 감사 기능 (<a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">medium.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">github.com</a>, <a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation?utm_source=chatgpt.com" title="Command–query separation">reddit.com</a>)</td></tr><tr><td>.NET + Marten (PostgreSQL 기반 Event Sourcing)</td><td>의료 예약 시스템 등에서 상태 이력 관리</td><td>도메인 상태 재생, 일관성 보강</td></tr><tr><td>Go + RabbitMQ + Postgres + EventStoreDB</td><td>전자 상거래 마이크로서비스</td><td>Vertical Slice + CQRS + 이벤트 아키텍처 통합</td></tr><tr><td>Laravel + MySQL + MongoDB</td><td>PHP 기반 애플리케이션에서 읽기/쓰기 DB 분리</td><td>조회 성능 개선, 쓰기 로직 분리</td></tr><tr><td>FastAPI/Python + python-cqrs</td><td>CQRS 패턴 실험 및 PoC</td><td>Python 환경에서 CQRS 도입 가능성 확인</td></tr></tbody></table><hr><h2 id=-12-활용-사례-전자상거래-마이크로서비스>📦 12. 활용 사례: 전자상거래 마이크로서비스<a hidden class=anchor aria-hidden=true href=#-12-활용-사례-전자상거래-마이크로서비스>#</a></h2><h3 id=-시스템-구성도>🏗️ 시스템 구성도<a hidden class=anchor aria-hidden=true href=#-시스템-구성도>#</a></h3><pre class=mermaid>flowchart LR
  subgraph Write Side
    UI --&gt; CmdAPI[Command API]
    CmdAPI --&gt; CH[Command Handler]
    CH --&gt; DM[Order Aggregate]
    DM --&gt; ES[Event Store]
    ES --&gt; EB[Event Bus]
  end

  subgraph Read Side
    EB --&gt; PH[Projector/Event Handler]
    PH --&gt; RDB[(Read DB)]
    UI --&gt; QueryAPI[Query API] --&gt; RDB
  end
</pre><ul><li><strong>Write Side</strong>: 사용자가 주문 요청 → Command Handler 실행 → Order Aggregate 처리 → 이벤트 저장 → 이벤트 버스로 전파</li><li><strong>Event Store</strong>: 상태 변화 이력을 보관하며, 모든 Command가 이벤트 형태로 축적됨</li><li><strong>Event Bus</strong>: 이벤트를 읽기 측으로 전송</li><li><strong>Projector</strong>: 이벤트 소비 후 Read DB에 데이터 반영 (Materialized View)</li><li><strong>Read Side</strong>: UI/Query API가 연결되어 빠른 조회 제공</li></ul><p>이 구조는 조회와 쓰기가 분리돼 <strong>읽기 성능 최적화</strong>, <strong>이벤트 감사 기능 확보</strong>, <strong>도메인 복잡도 관리 용이</strong> 등의 장점을 제공합니다.</p><hr><h2 id=-13-구현-예시-python--fastapi--python-cqrs>💻 13. 구현 예시 (Python + FastAPI + python-cqrs)<a hidden class=anchor aria-hidden=true href=#-13-구현-예시-python--fastapi--python-cqrs>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># command.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cqrs</span> <span class=kn>import</span> <span class=n>Command</span><span class=p>,</span> <span class=n>CommandHandler</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaceOrder</span><span class=p>(</span><span class=n>Command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaceOrderHandler</span><span class=p>(</span><span class=n>CommandHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cmd</span><span class=p>:</span> <span class=n>PlaceOrder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 도메인 처리 예: 재고/결제 검증 후 OrderPlaced 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># query.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cqrs</span> <span class=kn>import</span> <span class=n>Query</span><span class=p>,</span> <span class=n>QueryHandler</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrder</span><span class=p>(</span><span class=n>Query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrderHandler</span><span class=p>(</span><span class=n>QueryHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>qry</span><span class=p>:</span> <span class=n>GetOrder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 읽기 DB 호출</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>qry</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;PLACED&#34;</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># app.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>command</span> <span class=kn>import</span> <span class=n>PlaceOrder</span><span class=p>,</span> <span class=n>PlaceOrderHandler</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>query</span> <span class=kn>import</span> <span class=n>GetOrder</span><span class=p>,</span> <span class=n>GetOrderHandler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cmd_handler</span> <span class=o>=</span> <span class=n>PlaceOrderHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>qry_handler</span> <span class=o>=</span> <span class=n>GetOrderHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>place_order</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span> <span class=o>=</span> <span class=n>PlaceOrder</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>evt</span> <span class=o>=</span> <span class=n>cmd_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 시스템은 EventBus 전송 필요</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>evt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>qry</span> <span class=o>=</span> <span class=n>GetOrder</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>qry_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>qry</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Command Handler</strong>: 쓰기 이벤트 처리 담당</li><li><strong>Query Handler</strong>: 읽기 요청 처리</li><li><strong>python‑cqrs</strong> 라이브러리를 통해 패턴 구현 기초 수월화 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html?utm_source=chatgpt.com" title="CQRS pattern - AWS Prescriptive Guidance">linkedin.com</a>, <a href="https://www.linkedin.com/posts/theburningmonk_cqrs-explained-in-4-mins-what-is-cqrs-activity-7273276195960492032-gK_Y?utm_source=chatgpt.com" title="CQRS Explained in 4 Mins | What is CQRS? Pros & Cons | Yan Cui">geeksforgeeks.org</a>, <a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">developer.confluent.io</a>, <a href="https://microservices.io/patterns/data/cqrs.html?utm_source=chatgpt.com" title="Pattern: Command Query Responsibility Segregation (CQRS)">pypi.org</a>, <a href="https://www.kurrent.io/cqrs-pattern?utm_source=chatgpt.com" title="A Beginner's Guide to CQRS - Kurrent">arxiv.org</a>)</li></ul><hr><h3 id=-요약>✅ 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h3><ul><li><strong>실무 예시</strong>: 마이크로서비스, 이벤트 소싱, 성능 및 감사 요구에 대응</li><li><strong>활용 사례</strong>: 전자상거래 마이크로서비스 아키텍처에서 CQRS + Event Sourcing 결합</li><li><strong>코드 예</strong>: FastAPI 기반 실험적인 CQRS 구조로 개념 실현 가능</li></ul><p>다음 단계로 <strong>실무에서의 적용 포인트 및 최적화 권장 사항</strong>, <strong>용어 정리/참고 출처</strong> 등 전달해드릴까요? 원하는 항목을 말씀해주세요!</p><p>아래는 <strong>CQRS</strong>의 마지막 정리 단계입니다.</p><hr><h2 id=-14-실무에서-적용-시-고려사항-및-주의할-점>📋 14. 실무에서 적용 시 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#-14-실무에서-적용-시-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 일관성</td><td>Eventually consistent 구조는 즉시 반영되지 않음</td><td>사용자에게 <em>일시적 지연</em> 안내, Polling/재시도 UX 제공</td></tr><tr><td>장애 복구</td><td>메시지 누락·중복 가능성 존재</td><td>Idempotent 처리, Outbox 패턴, Dead-letter 큐 도입</td></tr><tr><td>모니터링</td><td>메트릭 수집 없으면 지연 원인 파악 어려움</td><td>Lag, 이벤트 처리율, 오류율 모니터링 구성</td></tr><tr><td>보안</td><td>쓰기/읽기 API 분리로 권한 제어 추가 필요</td><td>권한 체크, 감사 로그, Command 추적 설계</td></tr><tr><td>스키마 변경</td><td>읽기/쓰기 모델 다른 스키마 버전 문제</td><td>Event 버전 관리, Projection 리컴패일 설계</td></tr><tr><td>테스트</td><td>Command/Query/Projection 모두 커버해야 함</td><td>Contract 테스트, E2E 시나리오 테스트 포함</td></tr></tbody></table><p><strong>권장 요약</strong>:
적용 전 반드시 스케일, 성능 요구, 팀 기술 역량, 도메인 복잡도를 고려하고, 초기에는 단순 CQRS 구조로 도입한 후 필요에 따라 Event Sourcing 또는 분산 트랜잭션 지원 구조로 확장하세요.</p><hr><h2 id=-15-최적화를-위한-고려사항-및-주의할-점>⚙️ 15. 최적화를 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#-15-최적화를-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>DB 최적화</td><td>Projection 대상 데이터는 큼직하게 될 수 있음</td><td>인덱싱, 파티셔닝, 정기 아카이빙 전략 적용</td></tr><tr><td>이벤트 관리</td><td>이벤트 수/크기 급증시 처리 지연 우려</td><td>Snapshot, 이벤트 압축, TTL 설정 적용</td></tr><tr><td>인프라 비용</td><td>브로커, 이벤트 저장소 등 비용 증가</td><td>필요 수준 평가 후 구성, 서버리스 등 고려</td></tr><tr><td>멀티 테넌시</td><td>테넌트별 데이터 격리 필요</td><td>스키마 격리, 네임스페이스 설계 유의</td></tr><tr><td>메시징 성능</td><td>동기 처리 시 지연 걱정</td><td>배치, 비동기 소비, Backpressure 대책 유효화</td></tr></tbody></table><hr><h2 id=-16-용어-정리>🧾 16. 용어 정리<a hidden class=anchor aria-hidden=true href=#-16-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>핵심 개념</td><td>Command</td><td>상태 변경 요청을 표현하는 객체 또는 메시지</td></tr><tr><td></td><td>Query</td><td>데이터를 조회하기 위한 요청</td></tr><tr><td></td><td>Command Handler</td><td>Command를 처리하는 비즈니스 로직 엔진</td></tr><tr><td></td><td>Query Handler</td><td>조회 요청을 처리하는 컴포넌트</td></tr><tr><td>아키텍처</td><td>Event Sourcing</td><td>상태 변경을 이벤트로 저장하고, 이를 통해 상태 재구성 방식 사용</td></tr><tr><td></td><td>Projection</td><td>이벤트를 기반으로 Read 모델을 구성하기 위한 View</td></tr><tr><td>패턴</td><td>Outbox Pattern</td><td>DB와 메시지 브로커 간의 트랜잭션 일관성 유지 전략</td></tr><tr><td>용어</td><td>Idempotence</td><td>중복 메시지(요청)에 대해 상태를 안전하게 처리하는 보장 방식</td></tr></tbody></table><hr><h2 id=-참고-및-출처>📚 참고 및 출처<a hidden class=anchor aria-hidden=true href=#-참고-및-출처>#</a></h2><ul><li>“CQRS pattern”, Microsoft docs</li><li>Greg Young, “Introduction to CQRS and Event Sourcing”</li><li>Udi Dahan, “CQRS and the Monolithic Mindset”</li><li>Microservices Patterns, Chris Richardson – CQRS 챕터</li><li>Axon Framework 문서 – Java/CQRS & Event Sourcing</li></ul><hr><p>🎯 <strong>정리 완료:</strong>
CQRS의 핵심 개념, 구조, 역할, 장단점부터 실무 고려사항, 최적화 지침, 용어 정의까지 정리했습니다.
추가로 프레임워크별 적용 가이드(.NET, Spring, Go 등)나 특정 사용 사례 코드가 필요하시면 언제든 요청하세요!</p><hr><h2 id=-장점-advantages>✅ 장점 (Advantages)<a hidden class=anchor aria-hidden=true href=#-장점-advantages>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>독립적 모델링</td><td>쓰기(도메인 로직)와 읽기(조회용 뷰) 모델을 분리하여 각각 최적화할 수 있습니다 (<a href="https://en.wikipedia.org/wiki/Command_Query_Responsibility_Segregation?utm_source=chatgpt.com" title="Command Query Responsibility Segregation">redhat.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">medium.com</a>)</td></tr><tr><td></td><td>성능 및 스케일</td><td>읽기/쓰기 작업을 독립적으로 확장 가능하며, 위치 기반 복제 통해 지연 감소</td></tr><tr><td></td><td>보안 강화</td><td>쓰기 모델 접근을 제한함으로써 보안 정책 적용이 용이해집니다</td></tr><tr><td></td><td>도메인 명확화</td><td>도메인 모델과 읽기 모델 분리를 통해 비즈니스 로직이 더욱 명료해집니다</td></tr><tr><td></td><td>유연성</td><td>데이터 저장소를 읽기/쓰기에 맞게 다르게 구성할 수 있으며, CQRS와 Event Sourcing 결합 시 강력한 로그·이력 관리 가능</td></tr></tbody></table><hr><h2 id=-단점-drawbacks>❌ 단점 (Drawbacks)<a hidden class=anchor aria-hidden=true href=#-단점-drawbacks>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡도 증가</td><td>구조가 복잡해지고, 개발·운영 비용이 상승합니다 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">medium.com</a>)</td><td>점진적 도입, 단순화 버전 사용, 내부 문서화</td></tr><tr><td></td><td>일관성 지연 (Eventual Consistency)</td><td>읽기 데이터가 즉시 반영되지 않아 사용자 경험에 지연 발생 가능</td><td>상태 표시 UI 제공, 보상 트랜잭션, 성숙한 이벤트 처리 설계</td></tr><tr><td></td><td>기술 중복</td><td>별도 저장소 및 이벤트 메시징 도입으로 기술 스택이 복잡해지고 장애 지점 증가</td><td>프레임워크 활용, 메시징 트랜잭션 안정성 고려, 모니터링 강화</td></tr><tr><td></td><td>추가 유지보수</td><td>읽기/쓰기와 이벤트 흐름 추가 구성 요소 관리 필요</td><td>자동화 테스트, Contract Testing, 로그 기반 추적</td></tr></tbody></table><hr><h2 id=-문제점-상세-분석-issue-breakdown>⚠️ 문제점 상세 분석 (Issue Breakdown)<a hidden class=anchor aria-hidden=true href=#-문제점-상세-분석-issue-breakdown>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제</td><td>지연 일관성</td><td>읽기 모델 비동기 업데이트</td><td>사용자 혼란, 데이터 불일치</td><td>지연 모니터링, UX 이슈</td><td>예측 가능한 UI, 보상 트랜잭션</td><td>예상 가능한 일관성 확보, 롤백/보상 로직</td></tr><tr><td>문제</td><td>메시지 실패/중복</td><td>네트워크 장애, 중복 수신</td><td>상태 불일치, 중복 작업</td><td>메시지 상태 추적</td><td>Exactly-once 처리 전략, 메시지 idempotence</td><td>중복 처리 로직, 2단계 커밋, Outbox 패턴</td></tr><tr><td>문제</td><td>물리적 인프라 증가</td><td>다중 DB, 브로커 도입</td><td>장애 지점 증가, 운영 비용 상승</td><td>장애 빈도 및 장애 시 영향 확인</td><td>간소화 아키텍처, 인프라 IaC 구축</td><td>지역 이중화, 자동 복구 환경 마련</td></tr><tr><td>문제</td><td>Event Store 과잉</td><td>이벤트 이력 지나치게 커짐</td><td>스토리지 과부하, 복구 지연</td><td>스토리지 용량 로그</td><td>Snapshot, 아카이빙 전략</td><td>정기 아카이빙, Snapshot 기반 리커버리</td></tr></tbody></table><hr><p>다음 단계는 무엇을 원하시나요?</p><ul><li><strong>A</strong>: 실무 사용 예시 + 활용 사례</li><li><strong>B</strong>: 구현 예시 (Python or JS 코드)</li><li><strong>C</strong>: 실무 적용 고려사항 및 최적화 권장 사항 정리</li></ul><p>원하시는 부분을 말씀해주시면 바로 이어서 작성해드리겠습니다!</p><p>안녕하세요! CQRS (Command Query Responsibility Segregation)에 대한 포괄적인 조사를 진행하겠습니다. 단계별로 체계적으로 분석해보겠습니다.이제 충분한 정보를 수집했으므로 CQRS에 대한 포괄적인 분석을 시작하겠습니다.</p><h1 id=cqrs-command-query-responsibility-segregation-조사-결과>CQRS (Command Query Responsibility Segregation) 조사 결과<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-조사-결과>#</a></h1><h2 id=1-태그-및-분류>1. 태그 및 분류<a hidden class=anchor aria-hidden=true href=#1-태그-및-분류>#</a></h2><p><strong>태그</strong>: Command-Query-Responsibility-Segregation, Software-Architecture-Pattern, Event-Driven-Architecture, Distributed-Systems</p><p><strong>주제의 분류 적절성 분석</strong>:
제시된 분류 &ldquo;Computer Science and Engineering&rdquo; > &ldquo;Software Engineering&rdquo; > &ldquo;Design and Architecture&rdquo; > &ldquo;Architecture Styles and Patterns&rdquo; > &ldquo;Architecture Patterns&rdquo; > &ldquo;Data Management"는 <strong>적절합니다</strong>.</p><p><strong>근거</strong>:</p><ul><li>CQRS는 소프트웨어 아키텍처 패턴으로, 데이터 관리와 관련된 설계 접근방식입니다</li><li>소프트웨어 엔지니어링의 설계 및 아키텍처 영역에서 활용되는 패턴입니다</li><li>시스템의 읽기와 쓰기 책임을 분리하는 아키텍처 패턴으로 분류됩니다</li></ul><h2 id=2-요약-설명>2. 요약 설명<a hidden class=anchor aria-hidden=true href=#2-요약-설명>#</a></h2><p>CQRS는 Command와 Query의 책임을 분리하여 읽기와 쓰기 작업을 별도의 모델로 처리하는 아키텍처 패턴으로, 복잡한 도메인과 고성능이 요구되는 시스템에서 확장성과 성능을 향상시키는 설계 접근방식입니다.</p><h2 id=3-전체-개요>3. 전체 개요<a hidden class=anchor aria-hidden=true href=#3-전체-개요>#</a></h2><p>CQRS는 전통적인 CRUD 아키텍처의 한계를 극복하기 위해 개발된 소프트웨어 아키텍처 패턴으로, 시스템의 Command(명령) 처리와 Query(조회) 처리를 분리하여 각각을 최적화할 수 있게 합니다. Event Sourcing과 함께 사용되어 복잡한 비즈니스 로직과 높은 확장성이 요구되는 시스템에서 효과적입니다.</p><hr><h2 id=4-핵심-개념>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념>#</a></h2><h3 id=기본-핵심-개념>기본 핵심 개념<a hidden class=anchor aria-hidden=true href=#기본-핵심-개념>#</a></h3><ul><li><strong>Command Query Separation (CQS)</strong>: CQRS의 기반이 되는 개념으로, 상태를 변경하는 명령과 데이터를 조회하는 쿼리를 분리하는 원칙</li><li><strong>Command (명령)</strong>: 시스템의 상태를 변경하는 작업을 나타내며, 결과값을 반환하지 않음</li><li><strong>Query (조회)</strong>: 시스템의 상태를 조회하는 작업으로, 시스템 상태를 변경하지 않음</li><li><strong>Write Model (쓰기 모델)</strong>: 명령을 처리하고 비즈니스 로직을 실행하는 모델</li><li><strong>Read Model (읽기 모델)</strong>: 조회 요청을 처리하고 최적화된 데이터를 제공하는 모델</li><li><strong>Eventual Consistency (최종 일관성)</strong>: 읽기와 쓰기 모델 간의 동기화가 즉시 이루어지지 않는 일관성 모델</li></ul><h3 id=실무-구현-요소>실무 구현 요소<a hidden class=anchor aria-hidden=true href=#실무-구현-요소>#</a></h3><ul><li><strong>Command Handler (명령 처리기)</strong>: Command를 받아 비즈니스 로직을 실행하고 상태를 변경하는 컴포넌트</li><li><strong>Query Handler (조회 처리기)</strong>: Query를 받아 Read Model에서 데이터를 조회하는 컴포넌트</li><li><strong>Event Store (이벤트 저장소)</strong>: Event Sourcing과 함께 사용될 때 모든 도메인 이벤트를 저장하는 저장소</li><li><strong>Projection (프로젝션)</strong>: Event에서 Read Model을 생성하는 과정</li><li><strong>Message Bus (메시지 버스)</strong>: Command와 Query를 적절한 Handler로 라우팅하는 컴포넌트</li><li><strong>Synchronization Mechanism (동기화 메커니즘)</strong>: Write Model과 Read Model 간의 데이터 동기화를 담당</li></ul><hr><h2 id=5-배경>5. 배경<a hidden class=anchor aria-hidden=true href=#5-배경>#</a></h2><p>CQRS는 2010년 Greg Young에 의해 처음 소개되었으며, Bertrand Meyer가 1988년 제안한 Command Query Separation (CQS) 원칙을 시스템 아키텍처 레벨로 확장한 것입니다. 전통적인 CRUD 아키텍처에서 단일 모델로 읽기와 쓰기를 모두 처리할 때 발생하는 성능 병목현상과 복잡성 문제를 해결하기 위해 개발되었습니다.</p><hr><h2 id=6-목적-및-필요성>6. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#6-목적-및-필요성>#</a></h2><h3 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h3><ul><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업을 각각에 최적화된 별도 모델로 처리</li><li><strong>확장성 향상</strong>: 읽기와 쓰기 부하를 독립적으로 확장 가능</li><li><strong>복잡성 관리</strong>: 복잡한 비즈니스 로직을 더 명확하게 분리하여 관리</li><li><strong>시스템 유연성</strong>: 다양한 읽기 요구사항에 맞는 여러 Read Model 제공</li></ul><h3 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h3><ul><li>높은 읽기/쓰기 부하 비율의 불균형</li><li>복잡한 도메인 로직과 다양한 조회 요구사항</li><li>실시간 분석과 리포팅 요구사항</li><li>마이크로서비스 아키텍처에서의 데이터 분산 관리</li></ul><hr><h2 id=7-주요-기능-및-역할>7. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#7-주요-기능-및-역할>#</a></h2><h3 id=command-side-명령-측>Command Side (명령 측)<a hidden class=anchor aria-hidden=true href=#command-side-명령-측>#</a></h3><ul><li>비즈니스 로직 실행 및 검증</li><li>도메인 모델 상태 변경</li><li>트랜잭션 무결성 보장</li><li>이벤트 발행 (Event Sourcing 사용 시)</li></ul><h3 id=query-side-조회-측>Query Side (조회 측)<a hidden class=anchor aria-hidden=true href=#query-side-조회-측>#</a></h3><ul><li>최적화된 데이터 조회</li><li>다양한 View Model 제공</li><li>읽기 성능 최적화</li><li>캐싱 및 비정규화된 데이터 활용</li></ul><hr><h2 id=8-특징>8. 특징<a hidden class=anchor aria-hidden=true href=#8-특징>#</a></h2><ul><li><strong>책임 분리</strong>: Command와 Query의 명확한 분리</li><li><strong>독립적 확장</strong>: 읽기와 쓰기 시스템의 독립적 확장 가능</li><li><strong>기술 다양성</strong>: 각 모델에 최적화된 서로 다른 기술 스택 사용 가능</li><li><strong>최종 일관성</strong>: Read Model과 Write Model 간의 비동기 동기화</li><li><strong>이벤트 기반</strong>: Event Sourcing과의 자연스러운 결합</li></ul><hr><h2 id=9-핵심-원칙>9. 핵심 원칙<a hidden class=anchor aria-hidden=true href=#9-핵심-원칙>#</a></h2><ol><li><strong>단일 책임 원칙</strong>: Command와 Query는 각각 하나의 책임만 가짐</li><li><strong>분리 원칙</strong>: 읽기와 쓰기 모델의 물리적/논리적 분리</li><li><strong>최적화 원칙</strong>: 각 모델을 해당 작업에 최적화</li><li><strong>일관성 원칙</strong>: 비즈니스 요구사항에 맞는 일관성 수준 제공</li></ol><hr><h2 id=10-주요-원리-및-작동-원리>10. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#10-주요-원리-및-작동-원리>#</a></h2><pre class=mermaid>graph TD
    A[Client] --&gt; B{Request Type}
    B --&gt;|Command| C[Command Handler]
    B --&gt;|Query| D[Query Handler]
    
    C --&gt; E[Write Model]
    E --&gt; F[Write Database]
    F --&gt; G[Event Publication]
    G --&gt; H[Event Handler]
    H --&gt; I[Read Model Update]
    
    D --&gt; J[Read Model]
    J --&gt; K[Read Database]
    
    subgraph &#34;Command Side&#34;
        C
        E
        F
    end
    
    subgraph &#34;Query Side&#34;
        D
        J
        K
    end
    
    subgraph &#34;Synchronization&#34;
        G
        H
        I
    end
</pre><h3 id=작동-과정>작동 과정<a hidden class=anchor aria-hidden=true href=#작동-과정>#</a></h3><ol><li><strong>Command 처리</strong>: Client에서 Command 전송 → Command Handler가 비즈니스 로직 실행 → Write Model 업데이트</li><li><strong>이벤트 발행</strong>: Write Model 변경 시 이벤트 발행</li><li><strong>Read Model 동기화</strong>: Event Handler가 이벤트를 받아 Read Model 업데이트</li><li><strong>Query 처리</strong>: Client에서 Query 전송 → Query Handler가 Read Model에서 데이터 조회</li></ol><hr><h2 id=11-구조-및-아키텍처>11. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처>#</a></h2><h3 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Command Handler</td><td>명령 처리</td><td>비즈니스 로직 실행 및 검증</td><td>상태 변경, 트랜잭션 관리</td></tr><tr><td>Query Handler</td><td>조회 처리</td><td>데이터 조회 및 반환</td><td>읽기 최적화, 캐싱 활용</td></tr><tr><td>Write Model</td><td>쓰기 모델</td><td>도메인 객체 및 비즈니스 로직</td><td>정규화된 구조, 일관성 보장</td></tr><tr><td>Read Model</td><td>읽기 모델</td><td>조회용 데이터 구조</td><td>비정규화된 구조, 성능 최적화</td></tr></tbody></table><h3 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Event Store</td><td>이벤트 저장</td><td>모든 도메인 이벤트 영구 저장</td><td>Event Sourcing 지원</td></tr><tr><td>Message Bus</td><td>메시지 라우팅</td><td>Command/Query를 적절한 Handler로 전달</td><td>확장성 및 유연성 제공</td></tr><tr><td>Projection Service</td><td>프로젝션 생성</td><td>Event에서 Read Model 생성</td><td>실시간 또는 배치 처리</td></tr><tr><td>Snapshot Store</td><td>스냅샷 저장</td><td>성능 최적화를 위한 상태 스냅샷</td><td>이벤트 재생 최적화</td></tr></tbody></table><h3 id=아키텍처-다이어그램>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        UI[User Interface]
        API[API Gateway]
    end
    
    subgraph &#34;Application Layer&#34;
        CB[Command Bus]
        QB[Query Bus]
        CH[Command Handlers]
        QH[Query Handlers]
    end
    
    subgraph &#34;Write Side&#34;
        WM[Write Model]
        WDB[(Write Database)]
        ES[(Event Store)]
    end
    
    subgraph &#34;Read Side&#34;
        RM1[Read Model 1]
        RM2[Read Model 2]
        RDB1[(Read Database 1)]
        RDB2[(Read Database 2)]
    end
    
    subgraph &#34;Infrastructure&#34;
        MB[Message Broker]
        EH[Event Handlers]
        PS[Projection Service]
    end
    
    UI --&gt; API
    API --&gt; CB
    API --&gt; QB
    
    CB --&gt; CH
    QB --&gt; QH
    
    CH --&gt; WM
    WM --&gt; WDB
    WM --&gt; ES
    
    ES --&gt; MB
    MB --&gt; EH
    EH --&gt; PS
    PS --&gt; RM1
    PS --&gt; RM2
    
    QH --&gt; RM1
    QH --&gt; RM2
    RM1 --&gt; RDB1
    RM2 --&gt; RDB2
</pre><hr><h2 id=12-구현-기법>12. 구현 기법<a hidden class=anchor aria-hidden=true href=#12-구현-기법>#</a></h2><h3 id=1-기본-cqrs-shared-database>1. 기본 CQRS (Shared Database)<a hidden class=anchor aria-hidden=true href=#1-기본-cqrs-shared-database>#</a></h3><p><strong>정의</strong>: 단일 데이터베이스를 사용하되 읽기와 쓰기 로직을 분리하는 방식</p><p><strong>구성</strong>:</p><ul><li>공통 데이터베이스</li><li>분리된 Command/Query Handler</li><li>서로 다른 도메인 모델과 DTO</li></ul><p><strong>목적</strong>: 복잡성 최소화하면서 읽기/쓰기 최적화</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Command Side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>CreateOrderCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>customerId</span> <span class=o>=</span> <span class=nx>customerId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Order</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>command</span><span class=p>.</span><span class=nx>items</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderRepository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=k>new</span> <span class=nx>OrderCreatedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query Side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrderSummary</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>database</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SELECT o.id, o.total, c.name FROM orders o JOIN customers c ON o.customer_id = c.id WHERE o.id = ?&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=nx>orderId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-분리된-데이터베이스-cqrs>2. 분리된 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#2-분리된-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 읽기와 쓰기에 별도의 데이터베이스를 사용하는 방식</p><p><strong>구성</strong>:</p><ul><li>Write Database (트랜잭션 최적화)</li><li>Read Database (쿼리 최적화)</li><li>데이터 동기화 메커니즘</li></ul><p><strong>목적</strong>: 각 데이터베이스를 해당 작업에 최적화</p><p><strong>실제 예시</strong>:</p><ul><li>Write: PostgreSQL (ACID 트랜잭션)</li><li>Read: MongoDB (문서 기반 빠른 조회)</li><li>동기화: Apache Kafka를 통한 이벤트 스트리밍</li></ul><h3 id=3-event-sourcing--cqrs>3. Event Sourcing + CQRS<a hidden class=anchor aria-hidden=true href=#3-event-sourcing--cqrs>#</a></h3><p><strong>정의</strong>: 이벤트 스토어를 Write Model로 사용하고 이벤트로부터 Read Model을 구성하는 방식</p><p><strong>구성</strong>:</p><ul><li>Event Store (Write Model)</li><li>Projection Engine</li><li>Materialized Views (Read Model)</li></ul><p><strong>목적</strong>: 완전한 감사 추적과 시간 여행 기능 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>,</span> <span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>store_event</span><span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>order_view</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_name&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>customer_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;Created&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=s1>&#39;order_views&#39;</span><span class=p>,</span> <span class=n>order_view</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=13-장점>13. 장점<a hidden class=anchor aria-hidden=true href=#13-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 최적화</td><td>읽기와 쓰기 모델을 각각에 특화되도록 설계하여 전체적인 시스템 성능 향상</td></tr><tr><td>장점</td><td>독립적 확장성</td><td>Command와 Query 처리를 독립적으로 확장 가능하여 비용 효율적인 리소스 관리</td></tr><tr><td>장점</td><td>기술 선택의 자유</td><td>읽기와 쓰기에 각각 최적화된 서로 다른 데이터베이스 및 기술 스택 사용 가능</td></tr><tr><td>장점</td><td>복잡성 분리</td><td>비즈니스 로직과 조회 로직을 분리하여 각각의 복잡성을 독립적으로 관리</td></tr><tr><td>장점</td><td>다양한 View 지원</td><td>동일한 데이터로부터 다양한 읽기 요구사항에 맞는 여러 Read Model 생성 가능</td></tr><tr><td>장점</td><td>보안 향상</td><td>읽기와 쓰기 권한을 별도로 관리하여 세밀한 접근 제어 가능</td></tr><tr><td>장점</td><td>유지보수성</td><td>명확한 책임 분리로 인한 코드의 가독성과 유지보수성 향상</td></tr></tbody></table><hr><h2 id=14-단점과-문제점-그리고-해결방안>14. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#14-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>별도의 읽기/쓰기 모델 관리로 인한 아키텍처 복잡성 증가</td><td>점진적 도입, 명확한 설계 가이드라인 수립</td></tr><tr><td>단점</td><td>데이터 일관성</td><td>Read Model과 Write Model 간의 최종 일관성으로 인한 데이터 불일치</td><td>비즈니스 요구사항에 맞는 일관성 수준 정의, 보상 트랜잭션 구현</td></tr><tr><td>단점</td><td>개발 오버헤드</td><td>중복된 코드와 모델로 인한 개발 시간 증가</td><td>코드 생성 도구 활용, 공통 라이브러리 구축</td></tr><tr><td>단점</td><td>운영 복잡성</td><td>여러 데이터베이스와 동기화 메커니즘 관리 필요</td><td>모니터링 도구 구축, 자동화된 배포 파이프라인</td></tr></tbody></table><h3 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>동기화 지연</td><td>네트워크 지연, 메시지 브로커 성능</td><td>사용자가 최신 데이터를 볼 수 없음</td><td>지연 시간 모니터링, 알림 설정</td><td>성능 테스트, 적절한 인프라 용량 계획</td><td>배치 처리 최적화, 캐싱 전략</td></tr><tr><td>문제점</td><td>메시지 손실</td><td>시스템 장애, 네트워크 오류</td><td>데이터 불일치, 비즈니스 로직 오류</td><td>메시지 추적, 상태 검증</td><td>메시지 지속성 보장, 중복 제거 메커니즘</td><td>재처리 로직, Dead Letter Queue</td></tr><tr><td>문제점</td><td>순환 의존성</td><td>잘못된 아키텍처 설계</td><td>시스템 데드락, 무한 루프</td><td>의존성 분석 도구</td><td>명확한 아키텍처 경계 정의</td><td>이벤트 체인 재설계, 의존성 역전</td></tr><tr><td>문제점</td><td>스키마 불일치</td><td>모델 진화 과정에서 발생</td><td>데이터 직렬화 오류</td><td>스키마 버전 관리</td><td>스키마 진화 전략 수립</td><td>백워드 호환성 유지, 마이그레이션 도구</td></tr></tbody></table><hr><h2 id=15-도전-과제>15. 도전 과제<a hidden class=anchor aria-hidden=true href=#15-도전-과제>#</a></h2><h3 id=기술적-도전-과제>기술적 도전 과제<a hidden class=anchor aria-hidden=true href=#기술적-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결 방법</th></tr></thead><tbody><tr><td>데이터 일관성</td><td>분산 트랜잭션 관리</td><td>여러 데이터베이스 간 ACID 보장 어려움</td><td>데이터 무결성 위험</td><td>Saga 패턴, 2PC 프로토콜</td></tr><tr><td>성능 최적화</td><td>이벤트 스트림 처리</td><td>대용량 이벤트 처리 성능</td><td>시스템 지연 및 병목</td><td>스트림 파티셔닝, 병렬 처리</td></tr><tr><td>모니터링</td><td>분산 시스템 추적</td><td>복잡한 데이터 플로우</td><td>장애 진단 어려움</td><td>분산 추적, 로깅 표준화</td></tr></tbody></table><h3 id=비즈니스-도전-과제>비즈니스 도전 과제<a hidden class=anchor aria-hidden=true href=#비즈니스-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결 방법</th></tr></thead><tbody><tr><td>조직 변화</td><td>팀 구조 재편</td><td>새로운 책임 분리 모델</td><td>개발 프로세스 변화</td><td>Conway&rsquo;s Law 적용, 팀 역할 재정의</td></tr><tr><td>기술 부채</td><td>레거시 시스템 통합</td><td>기존 CRUD 시스템과의 호환성</td><td>마이그레이션 복잡성</td><td>점진적 마이그레이션, Strangler Fig 패턴</td></tr><tr><td>비용 관리</td><td>인프라 비용 증가</td><td>여러 데이터베이스 및 서비스</td><td>운영 비용 상승</td><td>클라우드 네이티브 솔루션, 자동 확장</td></tr></tbody></table><hr><h2 id=16-분류-기준에-따른-종류-및-유형>16. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 사례</th></tr></thead><tbody><tr><td>데이터베이스 분리 수준</td><td>논리적 분리</td><td>동일 DB, 다른 스키마/테이블</td><td>단순한 읽기/쓰기 최적화</td></tr><tr><td>데이터베이스 분리 수준</td><td>물리적 분리</td><td>완전히 다른 데이터베이스</td><td>고성능, 고가용성 요구사항</td></tr><tr><td>이벤트 처리 방식</td><td>동기 CQRS</td><td>실시간 동기화</td><td>강한 일관성 요구 시스템</td></tr><tr><td>이벤트 처리 방식</td><td>비동기 CQRS</td><td>이벤트 기반 비동기 처리</td><td>높은 처리량 요구 시스템</td></tr><tr><td>복잡성 수준</td><td>단순 CQRS</td><td>기본적인 읽기/쓰기 분리</td><td>CRUD 개선이 목적인 시스템</td></tr><tr><td>복잡성 수준</td><td>완전 CQRS</td><td>Event Sourcing과 결합</td><td>복잡한 도메인, 감사 요구사항</td></tr><tr><td>기술 스택</td><td>동종 기술</td><td>같은 종류의 데이터베이스</td><td>기술 스택 단순화</td></tr><tr><td>기술 스택</td><td>이종 기술</td><td>서로 다른 데이터베이스</td><td>각 용도에 최적화</td></tr></tbody></table><hr><h2 id=17-실무-사용-예시>17. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시>#</a></h2><table><thead><tr><th>사용 목적</th><th>함께 사용되는 기술</th><th>효과</th><th>적용 분야</th></tr></thead><tbody><tr><td>고성능 읽기 처리</td><td>Redis Cache, Elasticsearch</td><td>조회 성능 100배 향상</td><td>전자상거래 상품 검색</td></tr><tr><td>실시간 분석</td><td>Apache Kafka, ClickHouse</td><td>실시간 대시보드 제공</td><td>금융 거래 모니터링</td></tr><tr><td>감사 추적</td><td>Event Store, PostgreSQL</td><td>완전한 감사 로그</td><td>의료 기록 관리</td></tr><tr><td>마이크로서비스 통합</td><td>API Gateway, Service Mesh</td><td>서비스 간 결합도 감소</td><td>대규모 분산 시스템</td></tr><tr><td>다중 채널 지원</td><td>GraphQL, REST API</td><td>채널별 최적화된 데이터 제공</td><td>옴니채널 플랫폼</td></tr><tr><td>성능 최적화</td><td>읽기 전용 복제본, CDN</td><td>글로벌 응답 시간 단축</td><td>소셜 미디어 플랫폼</td></tr></tbody></table><hr><h2 id=18-활용-사례>18. 활용 사례<a hidden class=anchor aria-hidden=true href=#18-활용-사례>#</a></h2><h3 id=netflix의-동영상-추천-시스템>Netflix의 동영상 추천 시스템<a hidden class=anchor aria-hidden=true href=#netflix의-동영상-추천-시스템>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>Command Side</strong>: 사용자 시청 기록, 평점 데이터 처리</li><li><strong>Query Side</strong>: 개인화된 추천 리스트 제공</li><li><strong>Event Store</strong>: 모든 사용자 상호작용 이벤트 저장</li><li><strong>Read Models</strong>: 장르별, 인기도별, 개인화 추천 모델</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Netflix CQRS Architecture&#34;
        U[User] --&gt; API[API Gateway]
        
        subgraph &#34;Command Side&#34;
            API --&gt; CH[Command Handler]
            CH --&gt; WM[Write Model]
            WM --&gt; ES[(Event Store)]
            WM --&gt; UDB[(User Database)]
        end
        
        subgraph &#34;Event Processing&#34;
            ES --&gt; KF[Kafka]
            KF --&gt; EP[Event Processors]
        end
        
        subgraph &#34;Query Side&#34;
            API --&gt; QH[Query Handler]
            QH --&gt; RM1[Recommendation Model]
            QH --&gt; RM2[User Profile Model]
            QH --&gt; RM3[Content Catalog Model]
            
            RM1 --&gt; RDB1[(Recommendation DB)]
            RM2 --&gt; RDB2[(Profile DB)]
            RM3 --&gt; RDB3[(Catalog DB)]
        end
        
        EP --&gt; RM1
        EP --&gt; RM2
        EP --&gt; RM3
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 시청 이벤트 발생 → Command Handler 처리</li><li>이벤트 저장 및 Kafka로 발행</li><li>추천 엔진이 이벤트 처리하여 Read Model 업데이트</li><li>사용자 요청 시 Query Handler가 개인화된 추천 리스트 반환</li></ol><p><strong>CQRS 역할</strong>:</p><ul><li><strong>쓰기 최적화</strong>: 대용량 사용자 이벤트 실시간 처리</li><li><strong>읽기 최적화</strong>: 밀리초 단위 추천 결과 제공</li><li><strong>확장성</strong>: 읽기와 쓰기 트래픽을 독립적으로 확장</li></ul><p><strong>기존 시스템과의 차이점</strong>:</p><ul><li><strong>전통적 방식</strong>: 실시간 계산으로 인한 지연 발생</li><li><strong>CQRS 방식</strong>: 미리 계산된 추천 결과로 즉시 응답</li><li><strong>데이터 일관성</strong>: 최종 일관성으로 실시간성 확보</li></ul><hr><h2 id=19-구현-예시>19. 구현 예시<a hidden class=anchor aria-hidden=true href=#19-구현-예시>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>  1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>  2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>  3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>  4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>  5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>  6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>  7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>  8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9>  9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10> 10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11> 11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12> 12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13> 13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14> 14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15> 15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16> 16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17> 17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18> 18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19> 19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20> 20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21> 21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22> 22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23> 23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24> 24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25> 25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26> 26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27> 27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28> 28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29> 29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30> 30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31> 31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32> 32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33> 33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34> 34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35> 35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36> 36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37> 37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38> 38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39> 39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40> 40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41> 41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42> 42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43> 43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44> 44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45> 45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46> 46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47> 47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48> 48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49> 49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50> 50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51> 51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52> 52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53> 53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54> 54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55> 55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56> 56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57> 57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58> 58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59> 59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60> 60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61> 61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62> 62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63> 63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64> 64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65> 65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66> 66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67> 67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68> 68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69> 69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70> 70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71> 71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72> 72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73> 73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74> 74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75> 75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76> 76</a>
</span><span class=lnt id=hl-11-77><a class=lnlinks href=#hl-11-77> 77</a>
</span><span class=lnt id=hl-11-78><a class=lnlinks href=#hl-11-78> 78</a>
</span><span class=lnt id=hl-11-79><a class=lnlinks href=#hl-11-79> 79</a>
</span><span class=lnt id=hl-11-80><a class=lnlinks href=#hl-11-80> 80</a>
</span><span class=lnt id=hl-11-81><a class=lnlinks href=#hl-11-81> 81</a>
</span><span class=lnt id=hl-11-82><a class=lnlinks href=#hl-11-82> 82</a>
</span><span class=lnt id=hl-11-83><a class=lnlinks href=#hl-11-83> 83</a>
</span><span class=lnt id=hl-11-84><a class=lnlinks href=#hl-11-84> 84</a>
</span><span class=lnt id=hl-11-85><a class=lnlinks href=#hl-11-85> 85</a>
</span><span class=lnt id=hl-11-86><a class=lnlinks href=#hl-11-86> 86</a>
</span><span class=lnt id=hl-11-87><a class=lnlinks href=#hl-11-87> 87</a>
</span><span class=lnt id=hl-11-88><a class=lnlinks href=#hl-11-88> 88</a>
</span><span class=lnt id=hl-11-89><a class=lnlinks href=#hl-11-89> 89</a>
</span><span class=lnt id=hl-11-90><a class=lnlinks href=#hl-11-90> 90</a>
</span><span class=lnt id=hl-11-91><a class=lnlinks href=#hl-11-91> 91</a>
</span><span class=lnt id=hl-11-92><a class=lnlinks href=#hl-11-92> 92</a>
</span><span class=lnt id=hl-11-93><a class=lnlinks href=#hl-11-93> 93</a>
</span><span class=lnt id=hl-11-94><a class=lnlinks href=#hl-11-94> 94</a>
</span><span class=lnt id=hl-11-95><a class=lnlinks href=#hl-11-95> 95</a>
</span><span class=lnt id=hl-11-96><a class=lnlinks href=#hl-11-96> 96</a>
</span><span class=lnt id=hl-11-97><a class=lnlinks href=#hl-11-97> 97</a>
</span><span class=lnt id=hl-11-98><a class=lnlinks href=#hl-11-98> 98</a>
</span><span class=lnt id=hl-11-99><a class=lnlinks href=#hl-11-99> 99</a>
</span><span class=lnt id=hl-11-100><a class=lnlinks href=#hl-11-100>100</a>
</span><span class=lnt id=hl-11-101><a class=lnlinks href=#hl-11-101>101</a>
</span><span class=lnt id=hl-11-102><a class=lnlinks href=#hl-11-102>102</a>
</span><span class=lnt id=hl-11-103><a class=lnlinks href=#hl-11-103>103</a>
</span><span class=lnt id=hl-11-104><a class=lnlinks href=#hl-11-104>104</a>
</span><span class=lnt id=hl-11-105><a class=lnlinks href=#hl-11-105>105</a>
</span><span class=lnt id=hl-11-106><a class=lnlinks href=#hl-11-106>106</a>
</span><span class=lnt id=hl-11-107><a class=lnlinks href=#hl-11-107>107</a>
</span><span class=lnt id=hl-11-108><a class=lnlinks href=#hl-11-108>108</a>
</span><span class=lnt id=hl-11-109><a class=lnlinks href=#hl-11-109>109</a>
</span><span class=lnt id=hl-11-110><a class=lnlinks href=#hl-11-110>110</a>
</span><span class=lnt id=hl-11-111><a class=lnlinks href=#hl-11-111>111</a>
</span><span class=lnt id=hl-11-112><a class=lnlinks href=#hl-11-112>112</a>
</span><span class=lnt id=hl-11-113><a class=lnlinks href=#hl-11-113>113</a>
</span><span class=lnt id=hl-11-114><a class=lnlinks href=#hl-11-114>114</a>
</span><span class=lnt id=hl-11-115><a class=lnlinks href=#hl-11-115>115</a>
</span><span class=lnt id=hl-11-116><a class=lnlinks href=#hl-11-116>116</a>
</span><span class=lnt id=hl-11-117><a class=lnlinks href=#hl-11-117>117</a>
</span><span class=lnt id=hl-11-118><a class=lnlinks href=#hl-11-118>118</a>
</span><span class=lnt id=hl-11-119><a class=lnlinks href=#hl-11-119>119</a>
</span><span class=lnt id=hl-11-120><a class=lnlinks href=#hl-11-120>120</a>
</span><span class=lnt id=hl-11-121><a class=lnlinks href=#hl-11-121>121</a>
</span><span class=lnt id=hl-11-122><a class=lnlinks href=#hl-11-122>122</a>
</span><span class=lnt id=hl-11-123><a class=lnlinks href=#hl-11-123>123</a>
</span><span class=lnt id=hl-11-124><a class=lnlinks href=#hl-11-124>124</a>
</span><span class=lnt id=hl-11-125><a class=lnlinks href=#hl-11-125>125</a>
</span><span class=lnt id=hl-11-126><a class=lnlinks href=#hl-11-126>126</a>
</span><span class=lnt id=hl-11-127><a class=lnlinks href=#hl-11-127>127</a>
</span><span class=lnt id=hl-11-128><a class=lnlinks href=#hl-11-128>128</a>
</span><span class=lnt id=hl-11-129><a class=lnlinks href=#hl-11-129>129</a>
</span><span class=lnt id=hl-11-130><a class=lnlinks href=#hl-11-130>130</a>
</span><span class=lnt id=hl-11-131><a class=lnlinks href=#hl-11-131>131</a>
</span><span class=lnt id=hl-11-132><a class=lnlinks href=#hl-11-132>132</a>
</span><span class=lnt id=hl-11-133><a class=lnlinks href=#hl-11-133>133</a>
</span><span class=lnt id=hl-11-134><a class=lnlinks href=#hl-11-134>134</a>
</span><span class=lnt id=hl-11-135><a class=lnlinks href=#hl-11-135>135</a>
</span><span class=lnt id=hl-11-136><a class=lnlinks href=#hl-11-136>136</a>
</span><span class=lnt id=hl-11-137><a class=lnlinks href=#hl-11-137>137</a>
</span><span class=lnt id=hl-11-138><a class=lnlinks href=#hl-11-138>138</a>
</span><span class=lnt id=hl-11-139><a class=lnlinks href=#hl-11-139>139</a>
</span><span class=lnt id=hl-11-140><a class=lnlinks href=#hl-11-140>140</a>
</span><span class=lnt id=hl-11-141><a class=lnlinks href=#hl-11-141>141</a>
</span><span class=lnt id=hl-11-142><a class=lnlinks href=#hl-11-142>142</a>
</span><span class=lnt id=hl-11-143><a class=lnlinks href=#hl-11-143>143</a>
</span><span class=lnt id=hl-11-144><a class=lnlinks href=#hl-11-144>144</a>
</span><span class=lnt id=hl-11-145><a class=lnlinks href=#hl-11-145>145</a>
</span><span class=lnt id=hl-11-146><a class=lnlinks href=#hl-11-146>146</a>
</span><span class=lnt id=hl-11-147><a class=lnlinks href=#hl-11-147>147</a>
</span><span class=lnt id=hl-11-148><a class=lnlinks href=#hl-11-148>148</a>
</span><span class=lnt id=hl-11-149><a class=lnlinks href=#hl-11-149>149</a>
</span><span class=lnt id=hl-11-150><a class=lnlinks href=#hl-11-150>150</a>
</span><span class=lnt id=hl-11-151><a class=lnlinks href=#hl-11-151>151</a>
</span><span class=lnt id=hl-11-152><a class=lnlinks href=#hl-11-152>152</a>
</span><span class=lnt id=hl-11-153><a class=lnlinks href=#hl-11-153>153</a>
</span><span class=lnt id=hl-11-154><a class=lnlinks href=#hl-11-154>154</a>
</span><span class=lnt id=hl-11-155><a class=lnlinks href=#hl-11-155>155</a>
</span><span class=lnt id=hl-11-156><a class=lnlinks href=#hl-11-156>156</a>
</span><span class=lnt id=hl-11-157><a class=lnlinks href=#hl-11-157>157</a>
</span><span class=lnt id=hl-11-158><a class=lnlinks href=#hl-11-158>158</a>
</span><span class=lnt id=hl-11-159><a class=lnlinks href=#hl-11-159>159</a>
</span><span class=lnt id=hl-11-160><a class=lnlinks href=#hl-11-160>160</a>
</span><span class=lnt id=hl-11-161><a class=lnlinks href=#hl-11-161>161</a>
</span><span class=lnt id=hl-11-162><a class=lnlinks href=#hl-11-162>162</a>
</span><span class=lnt id=hl-11-163><a class=lnlinks href=#hl-11-163>163</a>
</span><span class=lnt id=hl-11-164><a class=lnlinks href=#hl-11-164>164</a>
</span><span class=lnt id=hl-11-165><a class=lnlinks href=#hl-11-165>165</a>
</span><span class=lnt id=hl-11-166><a class=lnlinks href=#hl-11-166>166</a>
</span><span class=lnt id=hl-11-167><a class=lnlinks href=#hl-11-167>167</a>
</span><span class=lnt id=hl-11-168><a class=lnlinks href=#hl-11-168>168</a>
</span><span class=lnt id=hl-11-169><a class=lnlinks href=#hl-11-169>169</a>
</span><span class=lnt id=hl-11-170><a class=lnlinks href=#hl-11-170>170</a>
</span><span class=lnt id=hl-11-171><a class=lnlinks href=#hl-11-171>171</a>
</span><span class=lnt id=hl-11-172><a class=lnlinks href=#hl-11-172>172</a>
</span><span class=lnt id=hl-11-173><a class=lnlinks href=#hl-11-173>173</a>
</span><span class=lnt id=hl-11-174><a class=lnlinks href=#hl-11-174>174</a>
</span><span class=lnt id=hl-11-175><a class=lnlinks href=#hl-11-175>175</a>
</span><span class=lnt id=hl-11-176><a class=lnlinks href=#hl-11-176>176</a>
</span><span class=lnt id=hl-11-177><a class=lnlinks href=#hl-11-177>177</a>
</span><span class=lnt id=hl-11-178><a class=lnlinks href=#hl-11-178>178</a>
</span><span class=lnt id=hl-11-179><a class=lnlinks href=#hl-11-179>179</a>
</span><span class=lnt id=hl-11-180><a class=lnlinks href=#hl-11-180>180</a>
</span><span class=lnt id=hl-11-181><a class=lnlinks href=#hl-11-181>181</a>
</span><span class=lnt id=hl-11-182><a class=lnlinks href=#hl-11-182>182</a>
</span><span class=lnt id=hl-11-183><a class=lnlinks href=#hl-11-183>183</a>
</span><span class=lnt id=hl-11-184><a class=lnlinks href=#hl-11-184>184</a>
</span><span class=lnt id=hl-11-185><a class=lnlinks href=#hl-11-185>185</a>
</span><span class=lnt id=hl-11-186><a class=lnlinks href=#hl-11-186>186</a>
</span><span class=lnt id=hl-11-187><a class=lnlinks href=#hl-11-187>187</a>
</span><span class=lnt id=hl-11-188><a class=lnlinks href=#hl-11-188>188</a>
</span><span class=lnt id=hl-11-189><a class=lnlinks href=#hl-11-189>189</a>
</span><span class=lnt id=hl-11-190><a class=lnlinks href=#hl-11-190>190</a>
</span><span class=lnt id=hl-11-191><a class=lnlinks href=#hl-11-191>191</a>
</span><span class=lnt id=hl-11-192><a class=lnlinks href=#hl-11-192>192</a>
</span><span class=lnt id=hl-11-193><a class=lnlinks href=#hl-11-193>193</a>
</span><span class=lnt id=hl-11-194><a class=lnlinks href=#hl-11-194>194</a>
</span><span class=lnt id=hl-11-195><a class=lnlinks href=#hl-11-195>195</a>
</span><span class=lnt id=hl-11-196><a class=lnlinks href=#hl-11-196>196</a>
</span><span class=lnt id=hl-11-197><a class=lnlinks href=#hl-11-197>197</a>
</span><span class=lnt id=hl-11-198><a class=lnlinks href=#hl-11-198>198</a>
</span><span class=lnt id=hl-11-199><a class=lnlinks href=#hl-11-199>199</a>
</span><span class=lnt id=hl-11-200><a class=lnlinks href=#hl-11-200>200</a>
</span><span class=lnt id=hl-11-201><a class=lnlinks href=#hl-11-201>201</a>
</span><span class=lnt id=hl-11-202><a class=lnlinks href=#hl-11-202>202</a>
</span><span class=lnt id=hl-11-203><a class=lnlinks href=#hl-11-203>203</a>
</span><span class=lnt id=hl-11-204><a class=lnlinks href=#hl-11-204>204</a>
</span><span class=lnt id=hl-11-205><a class=lnlinks href=#hl-11-205>205</a>
</span><span class=lnt id=hl-11-206><a class=lnlinks href=#hl-11-206>206</a>
</span><span class=lnt id=hl-11-207><a class=lnlinks href=#hl-11-207>207</a>
</span><span class=lnt id=hl-11-208><a class=lnlinks href=#hl-11-208>208</a>
</span><span class=lnt id=hl-11-209><a class=lnlinks href=#hl-11-209>209</a>
</span><span class=lnt id=hl-11-210><a class=lnlinks href=#hl-11-210>210</a>
</span><span class=lnt id=hl-11-211><a class=lnlinks href=#hl-11-211>211</a>
</span><span class=lnt id=hl-11-212><a class=lnlinks href=#hl-11-212>212</a>
</span><span class=lnt id=hl-11-213><a class=lnlinks href=#hl-11-213>213</a>
</span><span class=lnt id=hl-11-214><a class=lnlinks href=#hl-11-214>214</a>
</span><span class=lnt id=hl-11-215><a class=lnlinks href=#hl-11-215>215</a>
</span><span class=lnt id=hl-11-216><a class=lnlinks href=#hl-11-216>216</a>
</span><span class=lnt id=hl-11-217><a class=lnlinks href=#hl-11-217>217</a>
</span><span class=lnt id=hl-11-218><a class=lnlinks href=#hl-11-218>218</a>
</span><span class=lnt id=hl-11-219><a class=lnlinks href=#hl-11-219>219</a>
</span><span class=lnt id=hl-11-220><a class=lnlinks href=#hl-11-220>220</a>
</span><span class=lnt id=hl-11-221><a class=lnlinks href=#hl-11-221>221</a>
</span><span class=lnt id=hl-11-222><a class=lnlinks href=#hl-11-222>222</a>
</span><span class=lnt id=hl-11-223><a class=lnlinks href=#hl-11-223>223</a>
</span><span class=lnt id=hl-11-224><a class=lnlinks href=#hl-11-224>224</a>
</span><span class=lnt id=hl-11-225><a class=lnlinks href=#hl-11-225>225</a>
</span><span class=lnt id=hl-11-226><a class=lnlinks href=#hl-11-226>226</a>
</span><span class=lnt id=hl-11-227><a class=lnlinks href=#hl-11-227>227</a>
</span><span class=lnt id=hl-11-228><a class=lnlinks href=#hl-11-228>228</a>
</span><span class=lnt id=hl-11-229><a class=lnlinks href=#hl-11-229>229</a>
</span><span class=lnt id=hl-11-230><a class=lnlinks href=#hl-11-230>230</a>
</span><span class=lnt id=hl-11-231><a class=lnlinks href=#hl-11-231>231</a>
</span><span class=lnt id=hl-11-232><a class=lnlinks href=#hl-11-232>232</a>
</span><span class=lnt id=hl-11-233><a class=lnlinks href=#hl-11-233>233</a>
</span><span class=lnt id=hl-11-234><a class=lnlinks href=#hl-11-234>234</a>
</span><span class=lnt id=hl-11-235><a class=lnlinks href=#hl-11-235>235</a>
</span><span class=lnt id=hl-11-236><a class=lnlinks href=#hl-11-236>236</a>
</span><span class=lnt id=hl-11-237><a class=lnlinks href=#hl-11-237>237</a>
</span><span class=lnt id=hl-11-238><a class=lnlinks href=#hl-11-238>238</a>
</span><span class=lnt id=hl-11-239><a class=lnlinks href=#hl-11-239>239</a>
</span><span class=lnt id=hl-11-240><a class=lnlinks href=#hl-11-240>240</a>
</span><span class=lnt id=hl-11-241><a class=lnlinks href=#hl-11-241>241</a>
</span><span class=lnt id=hl-11-242><a class=lnlinks href=#hl-11-242>242</a>
</span><span class=lnt id=hl-11-243><a class=lnlinks href=#hl-11-243>243</a>
</span><span class=lnt id=hl-11-244><a class=lnlinks href=#hl-11-244>244</a>
</span><span class=lnt id=hl-11-245><a class=lnlinks href=#hl-11-245>245</a>
</span><span class=lnt id=hl-11-246><a class=lnlinks href=#hl-11-246>246</a>
</span><span class=lnt id=hl-11-247><a class=lnlinks href=#hl-11-247>247</a>
</span><span class=lnt id=hl-11-248><a class=lnlinks href=#hl-11-248>248</a>
</span><span class=lnt id=hl-11-249><a class=lnlinks href=#hl-11-249>249</a>
</span><span class=lnt id=hl-11-250><a class=lnlinks href=#hl-11-250>250</a>
</span><span class=lnt id=hl-11-251><a class=lnlinks href=#hl-11-251>251</a>
</span><span class=lnt id=hl-11-252><a class=lnlinks href=#hl-11-252>252</a>
</span><span class=lnt id=hl-11-253><a class=lnlinks href=#hl-11-253>253</a>
</span><span class=lnt id=hl-11-254><a class=lnlinks href=#hl-11-254>254</a>
</span><span class=lnt id=hl-11-255><a class=lnlinks href=#hl-11-255>255</a>
</span><span class=lnt id=hl-11-256><a class=lnlinks href=#hl-11-256>256</a>
</span><span class=lnt id=hl-11-257><a class=lnlinks href=#hl-11-257>257</a>
</span><span class=lnt id=hl-11-258><a class=lnlinks href=#hl-11-258>258</a>
</span><span class=lnt id=hl-11-259><a class=lnlinks href=#hl-11-259>259</a>
</span><span class=lnt id=hl-11-260><a class=lnlinks href=#hl-11-260>260</a>
</span><span class=lnt id=hl-11-261><a class=lnlinks href=#hl-11-261>261</a>
</span><span class=lnt id=hl-11-262><a class=lnlinks href=#hl-11-262>262</a>
</span><span class=lnt id=hl-11-263><a class=lnlinks href=#hl-11-263>263</a>
</span><span class=lnt id=hl-11-264><a class=lnlinks href=#hl-11-264>264</a>
</span><span class=lnt id=hl-11-265><a class=lnlinks href=#hl-11-265>265</a>
</span><span class=lnt id=hl-11-266><a class=lnlinks href=#hl-11-266>266</a>
</span><span class=lnt id=hl-11-267><a class=lnlinks href=#hl-11-267>267</a>
</span><span class=lnt id=hl-11-268><a class=lnlinks href=#hl-11-268>268</a>
</span><span class=lnt id=hl-11-269><a class=lnlinks href=#hl-11-269>269</a>
</span><span class=lnt id=hl-11-270><a class=lnlinks href=#hl-11-270>270</a>
</span><span class=lnt id=hl-11-271><a class=lnlinks href=#hl-11-271>271</a>
</span><span class=lnt id=hl-11-272><a class=lnlinks href=#hl-11-272>272</a>
</span><span class=lnt id=hl-11-273><a class=lnlinks href=#hl-11-273>273</a>
</span><span class=lnt id=hl-11-274><a class=lnlinks href=#hl-11-274>274</a>
</span><span class=lnt id=hl-11-275><a class=lnlinks href=#hl-11-275>275</a>
</span><span class=lnt id=hl-11-276><a class=lnlinks href=#hl-11-276>276</a>
</span><span class=lnt id=hl-11-277><a class=lnlinks href=#hl-11-277>277</a>
</span><span class=lnt id=hl-11-278><a class=lnlinks href=#hl-11-278>278</a>
</span><span class=lnt id=hl-11-279><a class=lnlinks href=#hl-11-279>279</a>
</span><span class=lnt id=hl-11-280><a class=lnlinks href=#hl-11-280>280</a>
</span><span class=lnt id=hl-11-281><a class=lnlinks href=#hl-11-281>281</a>
</span><span class=lnt id=hl-11-282><a class=lnlinks href=#hl-11-282>282</a>
</span><span class=lnt id=hl-11-283><a class=lnlinks href=#hl-11-283>283</a>
</span><span class=lnt id=hl-11-284><a class=lnlinks href=#hl-11-284>284</a>
</span><span class=lnt id=hl-11-285><a class=lnlinks href=#hl-11-285>285</a>
</span><span class=lnt id=hl-11-286><a class=lnlinks href=#hl-11-286>286</a>
</span><span class=lnt id=hl-11-287><a class=lnlinks href=#hl-11-287>287</a>
</span><span class=lnt id=hl-11-288><a class=lnlinks href=#hl-11-288>288</a>
</span><span class=lnt id=hl-11-289><a class=lnlinks href=#hl-11-289>289</a>
</span><span class=lnt id=hl-11-290><a class=lnlinks href=#hl-11-290>290</a>
</span><span class=lnt id=hl-11-291><a class=lnlinks href=#hl-11-291>291</a>
</span><span class=lnt id=hl-11-292><a class=lnlinks href=#hl-11-292>292</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Netflix 동영상 추천 시스템 CQRS 구현 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Events</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserWatchedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserRatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Commands</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WatchContentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RateContentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command Handlers</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ContentCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_watch_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>WatchContentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>UserWatchedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>watch_duration</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>watch_duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Store에 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=s2>&#34;user_interactions&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Bus로 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_rate_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>RateContentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>UserRatedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>rating</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>rating</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=s2>&#34;user_ratings&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;rating_recorded&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>rating</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Models</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationModel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>recommended_contents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>last_updated</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserProfileModel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>preferences</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span>  <span class=c1># 장르별 선호도</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>average_rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Handlers</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendation_store</span><span class=p>,</span> <span class=n>profile_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>recommendation_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span> <span class=o>=</span> <span class=n>profile_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자별 개인화 추천 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>recommendations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 기본 추천 반환</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_recommendations</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>recommended_contents</span><span class=p>[:</span><span class=n>limit</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;last_updated&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>last_updated</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_user_profile</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 프로필 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Profile not found&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;preferences&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>preferences</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;watch_history_count&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>profile</span><span class=o>.</span><span class=n>watch_history</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;average_rating&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_get_default_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;기본 추천 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;popular_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;popular&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Handlers (Projections)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationProjectionHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendation_store</span><span class=p>,</span> <span class=n>ml_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>recommendation_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ml_service</span> <span class=o>=</span> <span class=n>ml_service</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_watched_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>UserWatchedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 이벤트 처리하여 추천 모델 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># ML 서비스를 통해 새로운 추천 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>new_recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>ml_service</span><span class=o>.</span><span class=n>calculate_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>watch_duration</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 모델 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendation_model</span> <span class=o>=</span> <span class=n>RecommendationModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>recommended_contents</span><span class=o>=</span><span class=n>new_recommendations</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>last_updated</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>recommendation_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_rated_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>UserRatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;평점 이벤트 처리하여 사용자 프로필 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 프로필 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>profile</span> <span class=o>=</span> <span class=n>UserProfileModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>user_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>preferences</span><span class=o>=</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>                <span class=n>watch_history</span><span class=o>=</span><span class=p>[],</span>
</span></span><span class=line><span class=cl>                <span class=n>average_rating</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>rating</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 평균 평점 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span> <span class=o>=</span> <span class=p>(</span><span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span> <span class=o>+</span> <span class=n>event</span><span class=o>.</span><span class=n>rating</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>profile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Bus 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>event</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span><span class=p>(</span><span class=n>event</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Store 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>append_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stream_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>])</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>stream_name</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 저장소 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>RecommendationModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_by_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProfileStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>UserProfileModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_by_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ML 서비스 모의 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationMLService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>calculate_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제로는 복잡한 ML 알고리즘 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;rec_</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.9</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 시스템 구성 및 실행 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 인프라 구성</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>RecommendationStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>profile_store</span> <span class=o>=</span> <span class=n>ProfileStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ml_service</span> <span class=o>=</span> <span class=n>RecommendationMLService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Handler 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>command_handler</span> <span class=o>=</span> <span class=n>ContentCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>query_handler</span> <span class=o>=</span> <span class=n>RecommendationQueryHandler</span><span class=p>(</span><span class=n>recommendation_store</span><span class=p>,</span> <span class=n>profile_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>projection_handler</span> <span class=o>=</span> <span class=n>RecommendationProjectionHandler</span><span class=p>(</span><span class=n>recommendation_store</span><span class=p>,</span> <span class=n>ml_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Event 구독 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;UserWatchedEvent&#34;</span><span class=p>,</span> <span class=n>projection_handler</span><span class=o>.</span><span class=n>handle_user_watched_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;UserRatedEvent&#34;</span><span class=p>,</span> <span class=n>projection_handler</span><span class=o>.</span><span class=n>handle_user_rated_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Command 실행 (쓰기 작업)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== Command 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_command</span> <span class=o>=</span> <span class=n>WatchContentCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s2>&#34;movie456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>watch_duration</span><span class=o>=</span><span class=mi>7200</span>  <span class=c1># 2시간</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_watch_content</span><span class=p>(</span><span class=n>watch_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;시청 기록 저장: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>rate_command</span> <span class=o>=</span> <span class=n>RateContentCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s2>&#34;movie456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>rating</span><span class=o>=</span><span class=mf>4.5</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_rate_content</span><span class=p>(</span><span class=n>rate_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;평점 저장: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 처리 대기 (실제로는 비동기로 처리됨)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Query 실행 (읽기 작업)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== Query 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_recommendations</span><span class=p>(</span><span class=s2>&#34;user123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;개인화 추천: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendations</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_user_profile</span><span class=p>(</span><span class=s2>&#34;user123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용자 프로필: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>profile</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>20. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>도메인 복잡성 평가</td><td>CQRS가 필요한 복잡성인지 판단</td><td>단순한 CRUD는 전통적 방식 유지</td></tr><tr><td>설계</td><td>경계 컨텍스트 정의</td><td>DDD의 Bounded Context 내에서만 적용</td><td>전체 시스템이 아닌 특정 영역에만 적용</td></tr><tr><td>구현</td><td>점진적 도입</td><td>한 번에 모든 것을 변경하지 않음</td><td>레거시 시스템과의 공존 전략 수립</td></tr><tr><td>구현</td><td>데이터 일관성 정책</td><td>비즈니스 요구사항에 맞는 일관성 수준</td><td>최종 일관성 허용 범위 명확히 정의</td></tr><tr><td>운영</td><td>모니터링 체계 구축</td><td>분산 시스템의 상태 추적</td><td>분산 추적, 메트릭 수집 도구 도입</td></tr><tr><td>운영</td><td>장애 복구 전략</td><td>이벤트 재처리 및 보상 트랜잭션</td><td>Dead Letter Queue, 재시도 로직 구현</td></tr><tr><td>팀</td><td>학습 곡선 관리</td><td>팀의 기술적 역량 고려</td><td>교육 프로그램, 파일럿 프로젝트 실행</td></tr><tr><td>팀</td><td>역할 분리</td><td>Command/Query 담당 팀 구분</td><td>Conway&rsquo;s Law에 따른 팀 구조 조정</td></tr></tbody></table><hr><h2 id=21-최적화하기-위한-고려사항-및-주의할-점>21. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#21-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>성능</td><td>이벤트 스트림 최적화</td><td>대용량 이벤트 처리 성능 향상</td><td>파티셔닝, 병렬 처리, 배치 처리</td></tr><tr><td>성능</td><td>캐싱 전략</td><td>Read Model의 응답 속도 향상</td><td>Redis, CDN 활용한 다계층 캐싱</td></tr><tr><td>성능</td><td>스냅샷 구현</td><td>이벤트 재생 성능 최적화</td><td>정기적 스냅샷 생성, 증분 업데이트</td></tr><tr><td>확장성</td><td>수평 확장 설계</td><td>트래픽 증가에 대비한 확장성</td><td>샤딩, 로드 밸런싱, 자동 확장</td></tr><tr><td>확장성</td><td>데이터 파티셔닝</td><td>대용량 데이터 효율적 처리</td><td>시간 기반, 해시 기반 파티셔닝</td></tr><tr><td>보안</td><td>접근 제어</td><td>읽기/쓰기 권한 분리 관리</td><td>RBAC, API 게이트웨이 활용</td></tr><tr><td>보안</td><td>데이터 암호화</td><td>민감한 데이터 보호</td><td>전송/저장 시 암호화, 키 관리</td></tr><tr><td>비용</td><td>리소스 최적화</td><td>불필요한 중복 제거</td><td>리소스 사용량 모니터링, 자동 스케일링</td></tr><tr><td>비용</td><td>저장소 비용 관리</td><td>이벤트 스토어 크기 관리</td><td>데이터 아카이빙, 압축 정책</td></tr></tbody></table><hr><h2 id=22-기타-사항>22. 기타 사항<a hidden class=anchor aria-hidden=true href=#22-기타-사항>#</a></h2><h3 id=cqrs와-관련된-현대적-트렌드>CQRS와 관련된 현대적 트렌드<a hidden class=anchor aria-hidden=true href=#cqrs와-관련된-현대적-트렌드>#</a></h3><ul><li><strong>서버리스 아키텍처</strong>: AWS Lambda, Azure Functions를 활용한 이벤트 기반 CQRS 구현</li><li><strong>컨테이너 오케스트레이션</strong>: Kubernetes를 이용한 CQRS 컴포넌트 배포 및 관리</li><li><strong>클라우드 네이티브</strong>: 완전 관리형 서비스를 활용한 CQRS 구현 (Amazon EventBridge, Azure Service Bus)</li></ul><h3 id=산업별-적용-사례>산업별 적용 사례<a hidden class=anchor aria-hidden=true href=#산업별-적용-사례>#</a></h3><ul><li><strong>금융</strong>: 거래 처리와 실시간 리스크 분석 분리</li><li><strong>전자상거래</strong>: 주문 처리와 상품 검색/추천 분리</li><li><strong>게임</strong>: 게임 상태 업데이트와 리더보드/통계 조회 분리</li><li><strong>IoT</strong>: 센서 데이터 수집과 분석/대시보드 분리</li></ul><h3 id=미래-발전-방향>미래 발전 방향<a hidden class=anchor aria-hidden=true href=#미래-발전-방향>#</a></h3><ul><li><strong>AI/ML 통합</strong>: 실시간 기계학습 모델 업데이트와 CQRS 결합</li><li><strong>엣지 컴퓨팅</strong>: 분산된 엣지 환경에서의 CQRS 패턴 적용</li><li><strong>블록체인</strong>: 불변 이벤트 스토어로서의 블록체인 활용</li></ul><hr><h2 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처 패턴</td><td>Event Sourcing</td><td>이벤트 기반 저장</td><td>모든 상태 변경을 이벤트로 저장하는 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Saga Pattern</td><td>분산 트랜잭션</td><td>분산 환경에서의 트랜잭션 관리 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Domain-Driven Design</td><td>도메인 중심 설계</td><td>복잡한 비즈니스 로직을 효과적으로 모델링</td></tr><tr><td>기술 스택</td><td>Apache Kafka</td><td>이벤트 스트리밍</td><td>대용량 실시간 이벤트 처리 플랫폼</td></tr><tr><td>기술 스택</td><td>Event Store DB</td><td>이벤트 저장소</td><td>Event Sourcing 전용 데이터베이스</td></tr><tr><td>기술 스택</td><td>Axon Framework</td><td>CQRS/ES 프레임워크</td><td>Java 기반 CQRS 및 Event Sourcing 구현</td></tr><tr><td>데이터베이스</td><td>Event Store</td><td>이벤트 저장</td><td>이벤트를 저장하는 전용 데이터베이스</td></tr><tr><td>데이터베이스</td><td>Read Replicas</td><td>읽기 전용 복제본</td><td>읽기 성능 향상을 위한 데이터 복제</td></tr><tr><td>데이터베이스</td><td>Materialized Views</td><td>구체화된 뷰</td><td>미리 계산된 조회 결과 저장</td></tr><tr><td>메시징</td><td>Command Bus</td><td>명령 라우팅</td><td>명령을 적절한 핸들러로 전달</td></tr><tr><td>메시징</td><td>Event Bus</td><td>이벤트 발행</td><td>이벤트를 구독자에게 전달</td></tr><tr><td>메시징</td><td>Message Broker</td><td>메시지 중개</td><td>시스템 간 비동기 통신 중개</td></tr></tbody></table><hr><h2 id=주제와-관련하여-반드시-학습해야-할-내용>주제와 관련하여 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>CQS 원칙</td><td>Command Query Separation</td><td>CQRS의 이론적 기반이 되는 원칙</td></tr><tr><td>기본 개념</td><td>최종 일관성</td><td>Eventual Consistency</td><td>분산 시스템에서의 일관성 모델</td></tr><tr><td>기본 개념</td><td>CAP 정리</td><td>CAP Theorem</td><td>분산 시스템의 한계와 트레이드오프</td></tr><tr><td>설계 패턴</td><td>Domain Events</td><td>도메인 이벤트</td><td>비즈니스 로직에서 발생하는 중요한 사건</td></tr><tr><td>설계 패턴</td><td>Aggregate Pattern</td><td>집합체 패턴</td><td>DDD의 핵심 빌딩 블록</td></tr><tr><td>설계 패턴</td><td>Repository Pattern</td><td>저장소 패턴</td><td>데이터 접근 로직 캡슐화</td></tr><tr><td>구현 기술</td><td>Event Streaming</td><td>이벤트 스트리밍</td><td>실시간 이벤트 처리 기술</td></tr><tr><td>구현 기술</td><td>Projection</td><td>프로젝션</td><td>이벤트에서 뷰 모델 생성</td></tr><tr><td>구현 기술</td><td>Snapshot</td><td>스냅샷</td><td>성능 최적화를 위한 상태 저장</td></tr><tr><td>운영 관리</td><td>Monitoring</td><td>모니터링</td><td>분산 시스템 상태 추적</td></tr><tr><td>운영 관리</td><td>Circuit Breaker</td><td>회로 차단기</td><td>장애 전파 방지 패턴</td></tr><tr><td>운영 관리</td><td>Dead Letter Queue</td><td>실패 메시지 처리</td><td>처리 실패한 메시지 관리</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>Bounded Context</td><td>DDD에서 모델의 경계를 정의하는 개념</td></tr><tr><td>아키텍처</td><td>Microservices</td><td>독립적으로 배포 가능한 작은 서비스들의 집합</td></tr><tr><td>아키텍처</td><td>Service Mesh</td><td>마이크로서비스 간 통신을 관리하는 인프라 계층</td></tr><tr><td>데이터</td><td>Polyglot Persistence</td><td>다양한 데이터베이스를 용도에 맞게 선택 사용</td></tr><tr><td>데이터</td><td>Denormalization</td><td>성능 향상을 위한 데이터 중복 허용</td></tr><tr><td>데이터</td><td>Sharding</td><td>대용량 데이터를 여러 DB에 분산 저장</td></tr><tr><td>메시징</td><td>At-least-once</td><td>메시지가 최소 한 번은 전달됨을 보장</td></tr><tr><td>메시징</td><td>Exactly-once</td><td>메시지가 정확히 한 번만 전달됨을 보장</td></tr><tr><td>메시징</td><td>Idempotent</td><td>동일한 연산을 여러 번 수행해도 결과가 같음</td></tr><tr><td>성능</td><td>Horizontal Scaling</td><td>서버 수를 늘려 성능을 향상시키는 방식</td></tr><tr><td>성능</td><td>Vertical Scaling</td><td>서버 사양을 높여 성능을 향상시키는 방식</td></tr><tr><td>성능</td><td>Load Balancing</td><td>여러 서버에 부하를 분산시키는 기술</td></tr><tr><td>보안</td><td>RBAC</td><td>Role-Based Access Control, 역할 기반 접근 제어</td></tr><tr><td>보안</td><td>OAuth 2.0</td><td>인증 및 권한 부여를 위한 개방형 표준</td></tr><tr><td>보안</td><td>JWT</td><td>JSON Web Token, 안전한 정보 전송을 위한 토큰</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center</a></li><li><a href=https://www.martinfowler.com/bliki/CQRS.html>Martin Fowler - CQRS</a></li><li><a href=https://www.geeksforgeeks.org/cqrs-command-query-responsibility-segregation/>Command Query Responsibility Segregation - GeeksforGeeks</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li><li><a href=https://microservices.io/patterns/data/cqrs.html>Microservices Pattern: CQRS</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>Event Sourcing and CQRS - Baeldung</a></li><li><a href=https://www.confluent.io/learn/cqrs/>Command Query Responsibility Segregation - Confluent</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>CQRS Design Pattern - TechTarget</a></li><li><a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>Understanding Event Sourcing and CQRS Pattern - Mia-Platform</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>A Beginner&rsquo;s Guide to CQRS - Kurrent</a></li></ul><hr><p>CQRS(Command Query Responsibility Segregation)는 마이크로서비스 아키텍처(MSA)에서 중요한 패턴 중 하나이다.<br>CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다.</p><p>CQRS는 다음과 같은 핵심 개념을 가지고 있다:</p><ol><li><strong>명령(Command)</strong>: 시스템의 상태를 변경하는 작업 (예: 주문하기, 회원가입)</li><li><strong>조회(Query)</strong>: 시스템의 상태를 조회하는 작업 (예: 주문 목록 조회, 회원 정보 조회)</li><li><strong>책임 분리(Responsibility Segregation)</strong>: 명령과 조회 작업을 별도의 모델로 분리</li></ol><p>CQRS 패턴은 시스템의 성능, 확장성, 유지보수성을 향상시킬 수 있는 강력한 도구이다. 하지만 모든 시스템에 적합한 것은 아니므로, 프로젝트의 요구사항과 특성을 고려하여 적용 여부를 신중히 결정해야 한다.<br>CQRS를 효과적으로 구현하기 위해서는 명령과 조회 모델의 분리, 데이터 동기화 전략, 그리고 전체 시스템 아키텍처에 대한 깊은 이해가 필요하다.</p><h3 id=cqrs의-구현-방식>CQRS의 구현 방식<a hidden class=anchor aria-hidden=true href=#cqrs의-구현-방식>#</a></h3><p>CQRS는 다양한 방식으로 구현될 수 있다:</p><ol><li><strong>같은 프로세스, 같은 DB</strong>: 가장 단순한 형태로, 코드 수준에서만 명령과 조회를 분리한다.</li><li><strong>같은 프로세스, 다른 DB</strong>: 명령용 DB와 조회용 DB를 분리하여 사용한다.</li><li><strong>다른 프로세스, 다른 DB</strong>: MSA와 유사한 구조로, 프로세스와 DB를 모두 분리한다.</li></ol><h3 id=cqrs의-장점>CQRS의 장점<a hidden class=anchor aria-hidden=true href=#cqrs의-장점>#</a></h3><ol><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업을 독립적으로 최적화할 수 있다.</li><li><strong>확장성 향상</strong>: 읽기와 쓰기 모델을 독립적으로 확장할 수 있다.</li><li><strong>복잡성 감소</strong>: 명령과 조회 모델을 분리함으로써 각 모델의 복잡성을 줄일 수 있다.</li><li><strong>보안 강화</strong>: 읽기와 쓰기 작업에 대한 접근 제어를 별도로 설정할 수 있다.</li></ol><h3 id=cqrs의-단점>CQRS의 단점<a hidden class=anchor aria-hidden=true href=#cqrs의-단점>#</a></h3><ol><li><strong>구현 복잡도 증가</strong>: 명령과 조회 모델을 분리하면 전체적인 시스템 구조가 복잡해질 수 있다.</li><li><strong>데이터 일관성 관리</strong>: 명령과 조회 모델 간의 데이터 동기화가 필요하다.</li><li><strong>추가 인프라 필요</strong>: 분리된 모델을 관리하기 위한 추가적인 인프라가 필요할 수 있다.</li></ol><h3 id=cqrs-적용-시-고려사항>CQRS 적용 시 고려사항<a hidden class=anchor aria-hidden=true href=#cqrs-적용-시-고려사항>#</a></h3><ol><li><strong>데이터 동기화</strong>: 명령 모델과 조회 모델 간의 데이터 동기화 방법을 신중히 선택해야 한다.</li><li><strong>일관성 지연</strong>: 데이터 동기화 과정에서 일시적인 불일치가 발생할 수 있음을 고려해야 한다.</li><li><strong>복잡성 관리</strong>: CQRS 패턴 도입으로 인한 시스템 복잡도 증가를 관리해야 한다.</li></ol><h3 id=cqrs-적용-사례>CQRS 적용 사례<a hidden class=anchor aria-hidden=true href=#cqrs-적용-사례>#</a></h3><ol><li><strong>이커머스 시스템</strong>: 상품 조회와 주문 처리를 분리하여 성능을 최적화할 수 있다.</li><li><strong>금융 거래 시스템</strong>: 거래 기록과 잔액 조회를 분리하여 데이터 정합성을 유지할 수 있다.</li><li><strong>소셜 네트워크 서비스</strong>: 사용자 활동 데이터의 실시간 조회와 분석을 효율적으로 처리할 수 있다.</li></ol><h3 id=cqrs와-이벤트-소싱>CQRS와 이벤트 소싱<a hidden class=anchor aria-hidden=true href=#cqrs와-이벤트-소싱>#</a></h3><p>CQRS는 <strong>이벤트 소싱</strong>과 함께 사용되는 경우가 많다.<br>이벤트 소싱은 시스템의 상태 변화를 이벤트로 저장하고, 이러한 이벤트의 흐름을 재생하여 현재 상태를 구성하는 방식이다. 이를 통해:</p><ul><li><strong>데이터의 변경 이력 추적</strong>: 모든 상태 변화를 이벤트로 저장하여 변경 이력을 추적할 수 있다.</li><li><strong>복잡한 비즈니스 로직 처리</strong>: 이벤트를 기반으로 비즈니스 로직을 처리하여 복잡성을 관리할 수 있다.<br>이벤트 소싱과 CQRS의 결합은 시스템의 유연성과 확장성을 높이지만, 구현의 복잡성을 증가시킬 수 있으므로 신중한 설계가 필요하다.</li></ul><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34>34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35>35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36>36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37>37</a>
</span><span class=lnt id=hl-12-38><a class=lnlinks href=#hl-12-38>38</a>
</span><span class=lnt id=hl-12-39><a class=lnlinks href=#hl-12-39>39</a>
</span><span class=lnt id=hl-12-40><a class=lnlinks href=#hl-12-40>40</a>
</span><span class=lnt id=hl-12-41><a class=lnlinks href=#hl-12-41>41</a>
</span><span class=lnt id=hl-12-42><a class=lnlinks href=#hl-12-42>42</a>
</span><span class=lnt id=hl-12-43><a class=lnlinks href=#hl-12-43>43</a>
</span><span class=lnt id=hl-12-44><a class=lnlinks href=#hl-12-44>44</a>
</span><span class=lnt id=hl-12-45><a class=lnlinks href=#hl-12-45>45</a>
</span><span class=lnt id=hl-12-46><a class=lnlinks href=#hl-12-46>46</a>
</span><span class=lnt id=hl-12-47><a class=lnlinks href=#hl-12-47>47</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Command 모델 (쓰기 작업을 위한 모델)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCommandModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>totalAmount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orderId</span> <span class=o>=</span> <span class=nx>orderId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>userId</span> <span class=o>=</span> <span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>totalAmount</span> <span class=o>=</span> <span class=nx>totalAmount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;PENDING&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 생성 명령
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderCommandModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>totalAmount</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>EventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 커맨드 데이터베이스에 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>CommandDatabase</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query 모델 (읽기 작업을 위한 모델)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orders</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 전용 데이터베이스에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>findOne</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>orderId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자의 모든 주문 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>getUserOrders</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 최적화된 읽기 전용 뷰에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cqrs-구현의-주요-구성요소-예시>CQRS 구현의 주요 구성요소 예시<a hidden class=anchor aria-hidden=true href=#cqrs-구현의-주요-구성요소-예시>#</a></h4><ol><li><p>Command 처리기</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;CREATE_ORDER&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;UPDATE_ORDER_STATUS&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleUpdateOrderStatus</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Unknown command type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 유효성 검증
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>validateCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 비즈니스 로직 수행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>OrderCommandModel</span><span class=p>.</span><span class=nx>createOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishOrderCreatedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Query 처리기</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>readModel</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderQueryModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;GET_ORDER&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleGetOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;GET_USER_ORDERS&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleGetUserOrders</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Unknown query type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleGetOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>cachedOrder</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`order:</span><span class=si>${</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>cachedOrder</span><span class=p>)</span> <span class=k>return</span> <span class=nx>cachedOrder</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 데이터베이스에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>readModel</span><span class=p>.</span><span class=nx>getOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=sb>`order:</span><span class=si>${</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>이벤트 동기화</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderCreated</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 모델 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>orderData</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 전용 데이터베이스에 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>userId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAmount</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>createdAt</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 무효화
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>invalidate</span><span class=p>(</span><span class=sb>`user:</span><span class=si>${</span><span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>:orders`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=주문-시스템-예제>주문 시스템 예제<a hidden class=anchor aria-hidden=true href=#주문-시스템-예제>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// API 엔드포인트 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>commandHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderCommandHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>queryHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderQueryHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;CREATE_ORDER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>payload</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>query</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;GET_ORDER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>orderId</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queryHandler</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><hr></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>