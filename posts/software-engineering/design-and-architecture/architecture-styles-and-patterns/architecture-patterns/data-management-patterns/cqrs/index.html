<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CQRS | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Patterns,Data-Management-Patterns,CQRS"><meta name=description content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/cqrs/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/cqrs/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/cqrs/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/cqrs/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="CQRS"><meta property="og:description" content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="CQRS"><meta name=twitter:description content="CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"CQRS","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/cqrs/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>CQRS</h1><div class=post-description>CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다.</div></header><div class=post-content><h2 id=cqrs>CQRS<a hidden class=anchor aria-hidden=true href=#cqrs>#</a></h2><p>아래는 “CQRS(Command Query Responsibility Segregation)” 주제에 대해 요청하신 모든 항목을 체계적으로 정리한 결과입니다.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li><strong>Architecture-Patterns</strong></li><li><strong>Data-Management-Patterns</strong></li><li><strong>Software-Engineering</strong></li><li><strong>Microservices</strong></li></ul><hr><h2 id=2-분류-구조-적합성-분석>2. 분류 구조 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적합성-분석>#</a></h2><p><strong>현재 분류 구조</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Computer Science and Engineering
</span></span><span class=line><span class=cl>└─ Software Engineering
</span></span><span class=line><span class=cl>   └─ Design and Architecture
</span></span><span class=line><span class=cl>      └─ Architecture Patterns
</span></span><span class=line><span class=cl>         └─ Data Management Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>분석 및 근거</strong><br>CQRS는 소프트웨어 엔지니어링 분야에서 디자인 및 아키텍처 패턴 중 하나로, 데이터 관리 패턴의 대표적인 예시입니다.<br>CQRS는 데이터의 읽기(Query)와 쓰기(Command)를 분리하여 시스템의 성능, 확장성, 유지보수성을 높이는 패턴이므로,<br>“Data Management Patterns” 하위에 배치하는 것이 적절합니다.<br>또한, 마이크로서비스 환경에서 많이 활용되므로 “Microservices” 태그도 함께 사용할 수 있습니다<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">1</a><a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">3</a>.</p><hr><h2 id=3-요약-문장-200자-내외>3. 요약 문장 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-문장-200자-내외>#</a></h2><p>CQRS는 데이터 읽기와 쓰기 모델을 분리해 각각을 최적화하고, 시스템의 성능, 확장성, 유지보수성을 높이는 소프트웨어 아키텍처 패턴이다<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">1</a><a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">5</a>.</p><hr><h2 id=4-전체-개요-250자-내외>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외>#</a></h2><p>CQRS는 데이터의 읽기(Query)와 쓰기(Command)를 분리하여 각각의 모델과 처리 로직을 독립적으로 설계·운영하는 패턴이다. 이를 통해 읽기와 쓰기 각각의 성능, 확장성, 보안을 최적화할 수 있으며, 복잡한 비즈니스 도메인에서 유연하게 시스템을 설계할 수 있다<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">1</a><a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">5</a>.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>CQRS(Command Query Responsibility Segregation)</strong><ul><li>데이터의 읽기(Query)와 쓰기(Command)를 분리하여 각각의 모델과 처리 로직을 독립적으로 설계·운영하는 아키텍처 패턴<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">1</a><a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">5</a>.</li><li><strong>Command(명령)</strong>: 시스템의 상태를 변경하는 작업(생성, 수정, 삭제 등).</li><li><strong>Query(조회)</strong>: 시스템의 상태를 변경하지 않고 데이터를 읽어오는 작업.</li><li><strong>Command Handler</strong>: 명령을 처리하여 시스템 상태를 변경하는 핸들러.</li><li><strong>Query Handler</strong>: 조회 요청을 처리하여 데이터를 반환하는 핸들러.</li><li><strong>Command Model</strong>: 쓰기(명령)에 최적화된 데이터 모델.</li><li><strong>Query Model</strong>: 읽기(조회)에 최적화된 데이터 모델(주로 비정규화, 캐시 등 활용).</li></ul></li><li><strong>실무 구현을 위한 연관성</strong><ul><li>읽기와 쓰기 트래픽이 불균형한 시스템(예: 이커머스, 실시간 분석, 대용량 데이터 처리)에서 효과적<a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">6</a>.</li><li>마이크로서비스, 이벤트 소싱과 함께 사용 시 시스템의 복잡성 관리와 확장성 향상에 도움<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">2</a><a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">6</a>.</li><li>각 모델을 독립적으로 확장 및 최적화할 수 있어, 성능과 유지보수성 향상<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">4</a><a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">7</a>.</li></ul></li></ul><hr><h2 id=6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>6. 조사 및 분석: “주제와 관련하여 조사할 내용” 중심 정리<a hidden class=anchor aria-hidden=true href=#6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>#</a></h2><h3 id=1-배경>(1) 배경<a hidden class=anchor aria-hidden=true href=#1-배경>#</a></h3><ul><li>전통적인 CRUD(생성, 읽기, 수정, 삭제) 방식은 단일 모델로 읽기와 쓰기를 모두 처리함.</li><li>시스템이 복잡해질수록 읽기와 쓰기의 요구사항이 달라지고, 단일 모델로는 최적화가 어려움<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">1</a><a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">7</a>.</li><li>읽기와 쓰기 트래픽의 비대칭성, 데이터 표현 차이, 잠금 경합 등 문제 발생<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">1</a>.</li></ul><h3 id=2-목적-및-필요성>(2) 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#2-목적-및-필요성>#</a></h3><ul><li>읽기와 쓰기 모델을 분리하여 각각을 독립적으로 최적화.</li><li>시스템의 성능, 확장성, 유지보수성, 보안성 향상<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">1</a><a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">5</a>.</li><li>복잡한 도메인에서 비즈니스 로직과 데이터 접근 방식을 명확히 분리<a href="https://dev.to/gabrielsadaka/vertical-slice-event-driven-architecture-with-net-core-and-kafka-2ad2?utm_source=chatgpt.com" title="A simpler approach to building event driven software using .NET ...">6</a>.</li></ul><h3 id=3-주요-기능-및-역할>(3) 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#3-주요-기능-및-역할>#</a></h3><ul><li><strong>Command</strong>: 시스템 상태 변경(생성, 수정, 삭제).</li><li><strong>Query</strong>: 데이터 조회(상태 변경 없음).</li><li><strong>Command Handler</strong>: 명령 처리 및 상태 변경.</li><li><strong>Query Handler</strong>: 데이터 조회 및 반환.</li><li><strong>Event Store(선택)</strong>: 명령 처리 결과를 이벤트로 저장하여, 읽기 모델과의 동기화에 활용<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul><h3 id=4-특징>(4) 특징<a hidden class=anchor aria-hidden=true href=#4-특징>#</a></h3><ul><li>읽기와 쓰기 모델의 분리.</li><li>각 모델의 독립적 확장 및 최적화.</li><li>이벤트 소싱과의 연동 가능성.</li><li>마이크로서비스 환경에서의 활용성<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">2</a><a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">6</a>.</li></ul><h3 id=5-핵심-원칙>(5) 핵심 원칙<a hidden class=anchor aria-hidden=true href=#5-핵심-원칙>#</a></h3><ul><li><strong>명령(Command)과 조회(Query)의 책임 분리</strong><ul><li>명령은 상태를 변경하지만 결과를 반환하지 않음.</li><li>조회는 상태를 변경하지 않고 결과를 반환함<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">13</a><a href="https://dev.to/gabrielsadaka/vertical-slice-event-driven-architecture-with-net-core-and-kafka-2ad2?utm_source=chatgpt.com" title="A simpler approach to building event driven software using .NET ...">10</a>.</li></ul></li><li><strong>명령과 조회 모델의 독립적 설계 및 운영</strong><ul><li>각 모델은 서로 다른 데이터 저장소, 처리 로직, 최적화 기법 사용 가능<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">1</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul></li><li><strong>이벤트 기반 동기화</strong><ul><li>명령 처리 결과를 이벤트로 저장하고, 읽기 모델에 전파하여 동기화(이벤트 소싱)<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul></li></ul><h3 id=6-주요-원리>(6) 주요 원리<a hidden class=anchor aria-hidden=true href=#6-주요-원리>#</a></h3><ul><li><strong>명령/조회 책임 분리</strong>: 명령과 조회의 처리 경로를 완전히 분리.</li><li><strong>이벤트 기반 동기화</strong>: 명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파.</li><li><strong>독립적 확장성</strong>: 읽기/쓰기 모델 각각의 확장성 보장.</li></ul><h3 id=7-작동-원리-및-다이어그램>(7) 작동 원리 및 다이어그램<a hidden class=anchor aria-hidden=true href=#7-작동-원리-및-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
    User --&gt;|Command| CommandHandler
    CommandHandler --&gt;|Update| WriteModel
    WriteModel --&gt;|Event| EventStore
    EventStore --&gt;|Event| EventBus
    EventBus --&gt;|Update| ReadModelUpdater
    ReadModelUpdater --&gt;|Update| ReadModel
    User --&gt;|Query| QueryHandler
    QueryHandler --&gt;|Retrieve| ReadModel
</pre><p><strong>설명</strong></p><ul><li><strong>User</strong>: 시스템을 사용하는 클라이언트.</li><li><strong>CommandHandler</strong>: 명령을 처리하여 쓰기 모델(Write Model)을 업데이트.</li><li><strong>WriteModel</strong>: 상태 변경(쓰기)에 최적화된 데이터 저장소.</li><li><strong>EventStore</strong>: 명령 처리 결과를 이벤트로 저장.</li><li><strong>EventBus</strong>: 이벤트를 읽기 측(Read Model)에 전파.</li><li><strong>ReadModelUpdater</strong>: 이벤트를 기반으로 읽기 모델을 갱신.</li><li><strong>ReadModel</strong>: 읽기에 최적화된 데이터 저장소(비정규화, 캐시 등 활용).</li><li><strong>QueryHandler</strong>: 조회 요청을 처리하여 읽기 모델에서 데이터 반환<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul><h3 id=8-구조-및-아키텍처>(8) 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#8-구조-및-아키텍처>#</a></h3><table><thead><tr><th>구성 요소</th><th>기능 및 역할</th><th>필수/선택</th></tr></thead><tbody><tr><td>Command</td><td>시스템 상태 변경(생성, 수정, 삭제) 요청</td><td>필수</td></tr><tr><td>Query</td><td>데이터 조회 요청</td><td>필수</td></tr><tr><td>Command Handler</td><td>명령을 처리하여 시스템 상태 변경</td><td>필수</td></tr><tr><td>Query Handler</td><td>조회 요청을 처리하여 데이터 반환</td><td>필수</td></tr><tr><td>Write Model</td><td>상태 변경(쓰기)에 최적화된 데이터 저장소</td><td>필수</td></tr><tr><td>Read Model</td><td>읽기에 최적화된 데이터 저장소(비정규화, 캐시 등 활용)</td><td>필수</td></tr><tr><td>Event Store</td><td>명령 처리 결과를 이벤트로 저장(이벤트 소싱 연동 시)</td><td>선택</td></tr><tr><td>Event Bus</td><td>이벤트를 읽기 측(Read Model)에 전파</td><td>선택</td></tr><tr><td>Read Model Updater</td><td>이벤트를 기반으로 읽기 모델 갱신</td><td>선택</td></tr></tbody></table><p><strong>설명</strong></p><ul><li><strong>필수 구성요소</strong>: Command, Query, Command Handler, Query Handler, Write Model, Read Model</li><li><strong>선택 구성요소</strong>: Event Store, Event Bus, Read Model Updater (이벤트 소싱 연동 시)<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a></li></ul><h3 id=9-구현-기법>(9) 구현 기법<a hidden class=anchor aria-hidden=true href=#9-구현-기법>#</a></h3><ul><li><strong>명령/조회 모델 분리</strong>: 읽기와 쓰기 모델을 별도로 설계 및 구현.</li><li><strong>이벤트 소싱</strong>: 명령 처리 결과를 이벤트로 저장, 읽기 모델과의 동기화에 활용.</li><li><strong>비정규화된 읽기 모델</strong>: 조회 성능을 위해 읽기 모델을 비정규화(Denormalized) 구조로 설계.</li><li><strong>독립적 데이터 저장소</strong>: 읽기/쓰기 모델에 각각 최적화된 데이터 저장소(예: RDBMS, NoSQL, 캐시) 사용<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul><h3 id=10-장점>(10) 장점<a hidden class=anchor aria-hidden=true href=#10-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 발생 원인</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 모델을 독립적으로 확장할 수 있음</td><td>명령/조회 책임 분리</td></tr><tr><td></td><td>성능</td><td>각 모델을 최적화하여 읽기/쓰기 성능 향상</td><td>독립적 최적화</td></tr><tr><td></td><td>유지보수성</td><td>명령과 조회 로직 분리로 코드 가독성 및 유지보수성 향상</td><td>책임 분리</td></tr><tr><td></td><td>보안</td><td>명령과 조회에 서로 다른 보안 정책 적용 가능</td><td>독립적 보안 적용</td></tr><tr><td></td><td>유연성</td><td>각 모델에 맞는 데이터 저장소 및 처리 로직 선택 가능</td><td>독립적 설계</td></tr></tbody></table><h3 id=11-단점과-문제점-그리고-해결방안>(11) 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#11-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>명령/조회 모델 분리로 시스템 복잡도 증가</td><td>명확한 설계, 문서화</td></tr><tr><td></td><td>데이터 일관성</td><td>읽기/쓰기 모델 간 데이터 일관성 문제 발생 가능</td><td>이벤트 기반 동기화, 최종 일관성</td></tr><tr><td></td><td>운영 비용</td><td>모델 분리로 인한 운영 및 관리 비용 증가</td><td>자동화, 모니터링 도구 활용</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 불일치</td><td>동기화 지연/실패</td><td>사용자 경험 저하</td><td>모니터링, 로그 분석</td><td>이벤트 핸들러 신뢰성</td><td>이벤트 핸들러 재처리, 최종 일관성</td></tr><tr><td></td><td>검증 중복</td><td>명령/조회 검증 중복</td><td>코드 복잡도 증가</td><td>코드 리뷰</td><td>공통 검증 모듈화</td><td>추상화, 공통 라이브러리 사용</td></tr></tbody></table><h3 id=12-도전-과제>(12) 도전 과제<a hidden class=anchor aria-hidden=true href=#12-도전-과제>#</a></h3><ul><li><p><strong>실시간 데이터 일관성 보장</strong>: 읽기 모델과 쓰기 모델 간 실시간 동기화가 어려울 수 있음.</p><ul><li><strong>원인</strong>: 이벤트 기반 비동기 처리, 네트워크 지연 등.</li><li><strong>영향</strong>: 사용자 경험 저하, 데이터 불일치.</li><li><strong>탐지 및 진단</strong>: 모니터링, 로그 분석.</li><li><strong>예방 방법</strong>: 이벤트 핸들러 신뢰성 확보, 네트워크 최적화.</li><li><strong>해결 방법</strong>: 최종 일관성(Eventual Consistency) 적용, 사용자 피드백 제공<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">14</a>.</li></ul></li><li><p><strong>복잡한 도메인에서의 적용</strong>: 복잡한 비즈니스 로직에서 명령/조회 분리 설계가 어려울 수 있음.</p><ul><li><strong>원인</strong>: 도메인 복잡성, 명령/조회 경계 모호함.</li><li><strong>영향</strong>: 설계 및 구현 난이도 증가.</li><li><strong>탐지 및 진단</strong>: 도메인 분석, 코드 리뷰.</li><li><strong>예방 방법</strong>: 명확한 도메인 경계 정의, 명령/조회 분리 기준 설정.</li><li><strong>해결 방법</strong>: 도메인 주도 설계(DDD) 적용, 명확한 문서화<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">14</a>.</li></ul></li></ul><h3 id=13-분류-기준에-따른-종류-및-유형>(13) 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#13-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>구분</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>유형</td><td>Type 0: No CQRS</td><td>전통적 CRUD 방식, 명령/조회 분리 없음</td></tr><tr><td></td><td>Type 1: 분리된 클래스 구조</td><td>명령/조회 로직을 별도 클래스로 분리, 동일 모델 사용</td></tr><tr><td></td><td>Type 2: 분리된 모델</td><td>명령/조회 모델을 별도로 설계, 동일 저장소 사용</td></tr><tr><td></td><td>Type 3: 분리된 저장소</td><td>명령/조회 모델 및 저장소 모두 분리</td></tr></tbody></table><h3 id=14-실무-사용-예시>(14) 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시>#</a></h3><table><thead><tr><th>예시</th><th>목적</th><th>함께 사용되는 기술/패턴</th><th>효과</th></tr></thead><tbody><tr><td>이커머스 주문 시스템</td><td>주문 생성/조회 분리</td><td>이벤트 소싱, 마이크로서비스</td><td>성능, 확장성, 유지보수성 향상</td></tr><tr><td>실시간 분석 시스템</td><td>대용량 데이터 처리</td><td>NoSQL, 캐시, 이벤트 기반 동기화</td><td>빠른 조회, 실시간 처리</td></tr></tbody></table><h3 id=15-활용-사례>(15) 활용 사례<a hidden class=anchor aria-hidden=true href=#15-활용-사례>#</a></h3><p><strong>이커머스 주문 시스템 예시</strong></p><ul><li><strong>시스템 구성</strong>: 주문 생성(Command), 주문 조회(Query) 모델 분리.</li><li><strong>시스템 구성 다이어그램</strong></li></ul><pre class=mermaid>flowchart LR
    User --&gt;|주문 생성| CommandHandler
    CommandHandler --&gt;|주문 저장| WriteModel
    WriteModel --&gt;|주문 이벤트| EventStore
    EventStore --&gt;|이벤트 전파| EventBus
    EventBus --&gt;|주문 정보 갱신| ReadModelUpdater
    ReadModelUpdater --&gt;|주문 정보 저장| ReadModel
    User --&gt;|주문 조회| QueryHandler
    QueryHandler --&gt;|주문 정보 조회| ReadModel
</pre><ul><li><strong>Workflow</strong>:<ol><li>사용자가 주문 생성(Command).</li><li>Command Handler가 주문을 저장(Write Model).</li><li>주문 이벤트가 Event Store에 저장.</li><li>Event Bus를 통해 이벤트가 Read Model Updater로 전달.</li><li>Read Model Updater가 주문 정보를 Read Model에 저장.</li><li>사용자가 주문 조회(Query) 시 Query Handler가 Read Model에서 정보 반환.</li></ol></li><li><strong>CQRS 역할</strong>:<ul><li>주문 생성과 조회 로직 분리로 각각의 성능, 확장성, 유지보수성 향상.</li><li>이벤트 기반 동기화로 데이터 일관성 보장<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul></li><li><strong>CQRS 유무에 따른 차이점</strong>:<ul><li><strong>CQRS 적용 시</strong>: 주문 생성과 조회가 독립적으로 확장 및 최적화 가능, 대용량 트래픽 처리 용이.</li><li><strong>CQRS 미적용 시</strong>: 단일 모델로 인한 성능 병목, 확장성 한계, 유지보수성 저하.</li></ul></li></ul><h3 id=16-구현-예시-python>(16) 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#16-구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Handler 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>write_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>write_model</span> <span class=o>=</span> <span class=n>write_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 생성 로직</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>write_model</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Handler 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>read_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=n>read_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 조회 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>write_model</span> <span class=o>=</span> <span class=n>WriteModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=n>write_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>order_id</span> <span class=o>=</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>create_order</span><span class=p>({</span><span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>read_model</span> <span class=o>=</span> <span class=n>ReadModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>(</span><span class=n>read_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>order</span> <span class=o>=</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=7-추가-조사-내용>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용>#</a></h2><ul><li><strong>CQRS와 이벤트 소싱의 연동</strong>:<ul><li>이벤트 소싱은 명령 처리 결과를 이벤트로 저장하고, 이를 기반으로 읽기 모델을 갱신하는 방식으로 CQRS와 매우 잘 어울림<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">13</a><a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">11</a>.</li></ul></li><li><strong>마이크로서비스와의 연동</strong>:<ul><li>마이크로서비스 환경에서 CQRS는 각 서비스의 명령/조회 책임을 명확히 분리하여 확장성과 유지보수성 향상에 기여<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">2</a><a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">6</a>.</li></ul></li><li><strong>최적화 기법</strong>:<ul><li>읽기 모델에 캐시, 비정규화, 인덱스 등 다양한 최적화 기법 적용 가능<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">2</a><a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul></li></ul><hr><h2 id=8-기타-사항>8. 기타 사항<a hidden class=anchor aria-hidden=true href=#8-기타-사항>#</a></h2><ul><li><strong>CQRS는 모든 시스템에 적합하지 않음</strong>:<ul><li>단순 CRUD 애플리케이션에는 오버엔지니어링이 될 수 있으므로, 복잡한 도메인이나 읽기/쓰기 트래픽이 비대칭인 시스템에 적합[7]<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">14</a>.</li></ul></li><li><strong>이벤트 기반 동기화의 한계</strong>:<ul><li>읽기 모델과 쓰기 모델 간 최종 일관성(Eventual Consistency)이 보장되므로, 실시간 일관성이 중요한 시스템에는 주의 필요<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">14</a>.</li></ul></li></ul><hr><h2 id=9-주제와-관련하여-주목할-내용>9. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#9-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>CQRS</td><td>명령/조회 분리</td><td>읽기와 쓰기 모델을 분리하여 각각 최적화</td></tr><tr><td>데이터 관리</td><td>이벤트 소싱</td><td>이벤트 기반 동기화</td><td>명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>독립적 확장</td><td>각 서비스의 명령/조회 책임 분리로 확장성 향상</td></tr><tr><td>최적화</td><td>비정규화</td><td>읽기 모델 최적화</td><td>읽기 모델에 비정규화, 캐시 등 적용</td></tr></tbody></table><hr><h2 id=10-반드시-학습해야할-내용>10. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#10-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>소프트웨어 아키텍처</td><td>CQRS</td><td>명령/조회 분리</td><td>읽기와 쓰기 모델을 분리하는 아키텍처 패턴</td></tr><tr><td>데이터 관리</td><td>이벤트 소싱</td><td>이벤트 기반 동기화</td><td>명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>독립적 확장</td><td>각 서비스의 명령/조회 책임 분리로 확장성 향상</td></tr><tr><td>최적화</td><td>비정규화</td><td>읽기 모델 최적화</td><td>읽기 모델에 비정규화, 캐시 등 적용</td></tr></tbody></table><hr><h2 id=11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>11. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에서 효과적</td><td>명확한 도메인 경계 정의, 명령/조회 분리 기준 설정</td></tr><tr><td>데이터 일관성</td><td>읽기/쓰기 모델 간 일관성 유지 필요</td><td>이벤트 기반 동기화, 최종 일관성 적용</td></tr><tr><td>운영 비용</td><td>모델 분리로 인한 운영 비용 증가</td><td>자동화, 모니터링 도구 활용</td></tr><tr><td>검증 중복</td><td>명령/조회 검증 중복 가능성</td><td>공통 검증 모듈화, 추상화</td></tr><tr><td>기술 선택</td><td>각 모델에 맞는 데이터 저장소 선택</td><td>읽기 모델에 캐시, 비정규화, 인덱스 등 적용</td></tr></tbody></table><hr><h2 id=12-최적화하기-위한-고려사항-및-주의할-점>12. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#12-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>읽기 모델 최적화</td><td>읽기 모델에 캐시, 비정규화, 인덱스 등 적용</td><td>조회 성능 향상을 위한 다양한 최적화 기법 적용</td></tr><tr><td>쓰기 모델 최적화</td><td>쓰기 모델에 트랜잭션, 락 등 적용</td><td>데이터 일관성 보장을 위한 트랜잭션 관리</td></tr><tr><td>이벤트 처리</td><td>이벤트 기반 동기화 최적화</td><td>이벤트 핸들러 신뢰성 확보, 네트워크 최적화</td></tr><tr><td>모니터링</td><td>모델 간 데이터 일관성 모니터링</td><td>모니터링, 로그 분석 도구 활용</td></tr></tbody></table><hr><h2 id=13-용어-정리>13. 용어 정리<a hidden class=anchor aria-hidden=true href=#13-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>CQRS</td><td>읽기와 쓰기 모델을 분리하는 아키텍처 패턴</td></tr><tr><td>데이터 관리</td><td>이벤트 소싱</td><td>명령 처리 결과를 이벤트로 저장, 읽기 모델에 전파</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>각 서비스의 명령/조회 책임 분리로 확장성 향상</td></tr><tr><td>최적화</td><td>비정규화</td><td>읽기 모델에 비정규화, 캐시 등 적용</td></tr></tbody></table><hr><h2 id=14-참고-및-출처>14. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#14-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center</a></li><li><a href=https://dev.to/jackynote/understanding-cqrs-pattern-pros-cons-and-a-spring-boot-example-3flb>Understanding CQRS Pattern: Pros, Cons, and a Spring Boot Example</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>What is CQRS (Command Query Responsibility Segregation)?</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>CQRS Pattern - System Design School</a></li><li><a href="https://blog.stackademic.com/understanding-the-command-query-responsibility-segregation-cqrs-architecture-pattern-5bdfb4ebd5a4?gi=dbdf2d726f29">Understanding the Command Query Responsibility Segregation (CQRS) Architecture Pattern</a></li><li><a href="https://blog.stackademic.com/cqrs-command-query-responsibility-segregation-pattern-with-an-example-c9fcd164928e?gi=4e76ece92720">CQRS (Command Query Responsibility Segregation) Pattern with an Example</a></li><li><a href=https://dev.to/mochafreddo/demystifying-cqrs-for-junior-developers-a-friendly-guide-10ki>Demystifying CQRS for Junior Developers: A Friendly Guide</a></li><li><a href=https://github.com/SardarMudassarAliKhan/MicroservicesWithCQRSDesignPattern>MicroservicesWithCQRSDesignPattern GitHub</a></li><li><a href=https://dev.to/vipulkumarsviit/understanding-the-cqrs-pattern-25je>Understanding the CQRS Pattern</a></li><li><a href=https://blog.risingstack.com/when-to-use-cqrs/>When should you use CQRS? - RisingStack Engineering</a></li><li><a href=https://reintech.io/blog/troubleshooting-cqrs-implementation-challenges>Troubleshooting CQRS Implementation Challenges</a></li><li><a href=https://configzen.com/blog/implementing-cqrs-architecture-challenges>Overcoming Challenges in Implementing CQRS Architecture</a></li><li><a href=https://enterprisecraftsmanship.com/posts/types-of-cqrs/>Types of CQRS - Enterprise Craftsmanship</a></li><li><a href=https://dev.to/moh_moh701/enhancing-net-applications-with-cqrs-and-solid-principles-30i8>Implementing the CQRS in a .NET</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>A Beginner&rsquo;s Guide to CQRS - Kurrent</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li></ul><p>아래는 <strong>CQRS (Command Query Responsibility Segregation)</strong> 주제에 대한 정리입니다.</p><hr><h2 id=태그-tags>태그 (Tags)<a hidden class=anchor aria-hidden=true href=#태그-tags>#</a></h2><ul><li>CQRS</li><li>Event-Sourcing</li><li>Architecture-Pattern</li><li>Distributed-Systems</li></ul><hr><h2 id=1-분류-구조-타당성-평가>1. 분류 구조 타당성 평가<a hidden class=anchor aria-hidden=true href=#1-분류-구조-타당성-평가>#</a></h2><p><strong>현재 위치</strong>:
<code>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns → CQRS</code></p><p><strong>분석</strong>:</p><ul><li>CQRS는 읽기(Query)와 쓰기(Command)를 분리하여 설계하는 <strong>데이터 관리 패턴</strong>입니다.</li><li>디자인 아키텍처 맥락에서 가장 적절하며, 특히 Event Sourcing 등과 결합되는 패턴이므로 <strong>Data Management Patterns</strong> 내 위치는 타당합니다.</li></ul><hr><h2 id=2-간략-요약-200자-이내>2. 간략 요약 (200자 이내)<a hidden class=anchor aria-hidden=true href=#2-간략-요약-200자-이내>#</a></h2><p>CQRS는 읽기와 쓰기 작업을 분리하여 서로 다른 모델로 처리하는 아키텍처 패턴입니다. 이를 통해 성능, 확장성, 보안, 복잡한 비즈니스 로직 처리 효율을 높이고, 이벤트 소싱(Event Sourcing)과 함께 사용하면 변경이력 관리와 시스템 유연성도 강화할 수 있습니다.</p><hr><h2 id=3-개요-250자-이내>3. 개요 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-개요-250자-이내>#</a></h2><p>CQRS는 Command(쓰기)와 Query(읽기)를 완전히 분리하여 각 역할에 최적화된 모델과 저장소를 제공하는 패턴입니다. 트랜잭션 성능, 확장성, 보안 및 데이터 이력 추적 기능 향상에 유리합니다. 이벤트 소싱과 함께 사용하면 도메인 이벤트 기반 구현이 가능하며, 복잡한 도메인 로직을 명확하게 처리할 수 있습니다. 다만 데이터 동기화, 복잡도 증가, 일관성 문제 등의 단점이 있으며, 이를 해결하려면 메시징, 이벤트 브로커, CQRS 프레임워크 도입이 필요합니다.</p><hr><h2 id=4-핵심-개념>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념>#</a></h2><h3 id=-cqrs란>• CQRS란?<a hidden class=anchor aria-hidden=true href=#-cqrs란>#</a></h3><p>읽기와 쓰기를 분리하여 서로 다른 모델/스토리지로 처리하는 아키텍처 패턴.</p><h3 id=-동기-vs-비동기-처리>• 동기 vs 비동기 처리<a hidden class=anchor aria-hidden=true href=#-동기-vs-비동기-처리>#</a></h3><p>쓰기 완료 후 읽기 모델은 배치나 이벤트 소비 방식으로 <strong>비동기 갱신</strong>.</p><h3 id=-일관성과-분리>• 일관성과 분리<a hidden class=anchor aria-hidden=true href=#-일관성과-분리>#</a></h3><p>개별 모델이므로 읽기 성능과 쓰기 복잡성을 독립적으로 최적화 가능.</p><h3 id=-event-sourcing-결합>• Event Sourcing 결합<a hidden class=anchor aria-hidden=true href=#-event-sourcing-결합>#</a></h3><p>도메인 이벤트 로깅 방식과 결합하여 <strong>변경 이력 추적</strong>이 가능.</p><h4 id=실무-연관성>실무 연관성<a hidden class=anchor aria-hidden=true href=#실무-연관성>#</a></h4><ul><li><strong>읽기 모델</strong>: 캐시, 인덱싱, NoSQL 등 사용해 읽기 최적화</li><li><strong>쓰기 모델</strong>: 복잡 비즈니스 로직 집중 및 도메인 트랜잭션 처리 집중</li></ul><hr><h2 id=5-주제별-분석-및-조사-항목-요약>5. 주제별 분석 및 조사 항목 요약<a hidden class=anchor aria-hidden=true href=#5-주제별-분석-및-조사-항목-요약>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>개념</td><td>CQRS</td><td>정의</td><td>읽기/쓰기를 분리하여 각각 담당</td></tr><tr><td>아키텍처</td><td>구조</td><td>CommandSide, QuerySide, EventBus 등 구성</td><td></td></tr><tr><td>구현</td><td>기술</td><td>Messaging, 이벤트 브로커, CDC(Change Data Capture)</td><td></td></tr><tr><td>장단점</td><td>장점</td><td>성능, 확장성, 모듈화, 보안 강화</td><td></td></tr><tr><td>단점/문제</td><td>단점</td><td>복잡도 증가, 동기화 지연, 유지보수 부담</td><td></td></tr><tr><td>사례</td><td>활용 사례</td><td>e‑commerce 주문 처리, 금융 결제 시스템 등</td><td></td></tr><tr><td>고려사항</td><td>적용 시점</td><td>도메인 복잡도, 팀 인프라 성숙도</td><td></td></tr><tr><td>최적화</td><td>성능 최적화</td><td>이벤트 파티셔닝, 모델 캐싱, 샤딩</td><td></td></tr></tbody></table><hr><h2 id=6-조사한-추가-필요사항>6. 조사한 추가 필요사항<a hidden class=anchor aria-hidden=true href=#6-조사한-추가-필요사항>#</a></h2><ul><li><strong>구조 및 아키텍처</strong>: 구성 요소(Command Handler, Query Handler, Event Store 등)별 역할 및 다이어그램</li><li><strong>주요 원리/작동 원리</strong>: Commander → Event → Projection 흐름</li><li><strong>구현 기법</strong>: 예시 코드, 이벤트 기반 메시징 처리</li><li><strong>장점/단점 분석</strong>: 표 포함 설명</li><li><strong>실무 사례</strong>: 다이어그램 및 워크플로우</li><li><strong>도전 과제</strong>: 동기화 지연, 일관성 모델 설계 복잡성, 데이터 중복 관리</li><li><strong>분류 기준에 따른 종류</strong>: Event Sourcing 포함 여부, 동기성 vs 비동기성</li><li><strong>실무 적용 고려사항</strong>: 팀 숙련도, 배포, 모니터링, 테스트 전략</li><li><strong>최적화 고려사항 및 권장사항</strong>: 이벤트 크기, 모델 최신화 전략, 이벤트 소비 방식</li></ul><hr><h2 id=7-용어-정리>7. 용어 정리<a hidden class=anchor aria-hidden=true href=#7-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>CQRS</td><td>Command–Query Responsibility Segregation</td></tr><tr><td>아키텍처</td><td>Event Sourcing</td><td>도메인 이벤트 저장 방식</td></tr><tr><td>구성요소</td><td>Command Handler</td><td>쓰기 요청 처리 로직</td></tr><tr><td>구성요소</td><td>Query Handler</td><td>읽기 요청 처리 로직</td></tr><tr><td>구성요소</td><td>Projection</td><td>이벤트 기반 읽기 모델 생성기</td></tr><tr><td>구성요소</td><td>Event Store</td><td>이벤트 저장용 저장소</td></tr><tr><td>방식</td><td>동기 처리</td><td>즉시 읽기 모델 업데이트</td></tr><tr><td>방식</td><td>비동기 처리</td><td>이벤트 큐 기반 느슨한 동기화</td></tr><tr><td>패턴</td><td>메시지 브로커</td><td>Kafka, RabbitMQ 등 이벤트 전달</td></tr><tr><td>최적화</td><td>샤딩</td><td>모델 분할 저장 방식</td></tr><tr><td>최적화</td><td>캐싱</td><td>빠른 읽기 응답 제공</td></tr></tbody></table><hr><h2 id=8-참고-및-출처>8. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#8-참고-및-출처>#</a></h2><ul><li>김형준, “마틴 파울러의 CQRS 패턴 분석” (링크 제공 예정)</li><li>Greg Young, “CQRS and Event Sourcing” (YouTube 및 블로그)</li><li>Martin Fowler 블로그 내 CQRS 관련 문서</li><li>EventStoreDB 공식 문서</li></ul><blockquote><p>추가 조사 진행 후 단계별로 도식, 다이어그램, 코드 구현 예시를 포함한 심화 분석 제공 예정입니다. 더 구체적으로 어떤 영역(예: 구현 코드, 성능 최적화 등)에 집중하시길 원하시면 알려주세요!</p></blockquote><p>아래는 CQRS에 대한 심화 분석입니다.</p><hr><h2 id=4-구조-및-아키텍처-구성-요소-포함->4. 구조 및 아키텍처 (구성 요소 포함) 🔧<a hidden class=anchor aria-hidden=true href=#4-구조-및-아키텍처-구성-요소-포함->#</a></h2><h3 id=-기본-구성-요소>📐 기본 구성 요소<a hidden class=anchor aria-hidden=true href=#-기본-구성-요소>#</a></h3><ul><li><p><strong>Command Side / Write Model</strong></p><ul><li>Command Bus: 명령 전달 채널</li><li>Command Handler: 비즈니스 로직 실행 후 이벤트 생성</li><li>Event Store: append-only 이벤트 저장소 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">linkedin.com</a>, <a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">nexocode.com</a>)</li></ul></li><li><p><strong>Query Side / Read Model</strong></p><ul><li>Event Handler 또는 Projection: 이벤트를 읽어읽기용 DB에 반영</li><li>Query Handler: 최적화된 View에서 데이터 조회</li></ul></li><li><p><strong>Event Bus / Broker</strong></p><ul><li>이벤트 전달 중개 역할, Kafka, RabbitMQ 등 사용 (<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">upsolver.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>, <a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">reddit.com</a>)</li></ul></li></ul><h3 id=-시스템-흐름-mermaid-다이어그램>🌐 시스템 흐름 mermaid 다이어그램<a hidden class=anchor aria-hidden=true href=#-시스템-흐름-mermaid-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
  U[User UI] --&gt; C[Command Bus]
  C --&gt; CH[Command Handler]
  CH --&gt; ES[Event Store]
  ES --&gt; EB[Event Bus]
  EB --&gt; EH[Event Handler / Projection]
  EH --&gt; RD[Read Database]
  U --&gt; Q[Query Handler]
  Q --&gt; RD
</pre><h3 id=-설명>📝 설명<a hidden class=anchor aria-hidden=true href=#-설명>#</a></h3><ul><li><strong>Command Bus</strong>가 사용자 요청을 받아 <strong>Command Handler</strong>로 전달</li><li>Handler는 비즈니스 로직 수행 후 <strong>Event Store</strong>에 이벤트 저장</li><li>저장된 이벤트는 <strong>Event Bus</strong> 통해 <strong>Query Side</strong>로 비동기 전달</li><li><strong>Projection</strong>이 이를 읽어 <strong>읽기 전용 DB</strong>에 반영</li><li>UI는 <strong>Query Handler</strong>를 통해 읽기 DB에서 응답 받음</li></ul><hr><h2 id=5-주요-원리-및-작동-원리-다이어그램-포함>5. 주요 원리 및 작동 원리 (다이어그램 포함)<a hidden class=anchor aria-hidden=true href=#5-주요-원리-및-작동-원리-다이어그램-포함>#</a></h2><ul><li><strong>단일 책임</strong>: 쓰기(Command)와 읽기(Query)를 명확히 분리 (<a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">dev.to</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">linkedin.com</a>, <a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">upsolver.com</a>)</li><li><strong>이벤트 기반 비동기 동기화</strong>: 이벤트 생성 후 Projection 비동기로 처리</li><li><strong>이벤트소싱 SEM</strong>: Event Store에서 상태 회전(재생)하고, 새로운 Projection 구성 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>)</li><li><strong>Eventual Consistency</strong>: 쓰기 완료 후 읽기 모델은 지연 반영 → 일관성 지연 발생 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>)</li></ul><hr><h2 id=6-특징-및-핵심-기능>6. 특징 및 핵심 기능<a hidden class=anchor aria-hidden=true href=#6-특징-및-핵심-기능>#</a></h2><ul><li><strong>성능 최적화</strong>: 읽기/쓰기 모델의 독립 스케일링 및 구조 최적화 (<a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">reddit.com</a>)</li><li><strong>감사 로그 및 이벤트 이력</strong>: 모든 변경 내역이 이벤트로 남아 감사, 재생, 재구축 가능</li><li><strong>모델 유연성</strong>: 필요에 따라 다양한 Projection 생성 가능 (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">medium.com</a>)</li><li><strong>도메인 중심 설계</strong>: 의미 있는 도메인 이벤트 중심 개발, 비즈니스 로직이 더 명확</li></ul><hr><h2 id=7-특징-요약>7. 특징 요약<a hidden class=anchor aria-hidden=true href=#7-특징-요약>#</a></h2><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td>분리된 모델</td><td>쓰기와 읽기 책임 분리</td></tr><tr><td>비동기 이벤트</td><td>Command → Event → Projection 흐름</td></tr><tr><td>Event Sourcing 결합</td><td>상태 변화는 모두 이벤트로 저장</td></tr><tr><td>확장성</td><td>읽기/쓰기 요구에 따른 개별 확장 가능</td></tr></tbody></table><hr><p>다음 단계에서는 <strong>구현 기법 (예: Kafka 기반 이벤트 전달 로직, .NET 코드)</strong>, <strong>장점/단점 표 분석</strong>, <strong>실무 활용 예시 + 워크플로우</strong>, <strong>도전 과제, 최적화 및 고려사항</strong>을 포함한 심층 파트로 진행하겠습니다. 어떤 부분에 더 집중하시길 원하시는지 말씀해 주세요!</p><p>다음은 CQRS의 <strong>구현 기법</strong>, <strong>장단점 분석</strong>, <strong>실무 활용 예시 및 워크플로우</strong>에 대한 심층 정리입니다.</p><hr><h2 id=1-구현-기법-implementation-techniques>1. 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#1-구현-기법-implementation-techniques>#</a></h2><h3 id=-messaging-브로커-기반>✅ Messaging 브로커 기반<a hidden class=anchor aria-hidden=true href=#-messaging-브로커-기반>#</a></h3><ul><li><p><strong>Kafka + CQRS</strong>: 쓰기 완료 시 이벤트를 Kafka 토픽에 발행 → 스트림 처리 또는 Consumer를 통해 Projection으로 동기화 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">medium.com</a>).</p><ul><li>장점: 분산 환경에서 확장성 우수, 이벤트 리플레이 가능.</li><li>단점: 동기화 지연, 클라이언트 동기 보장 어려움 .</li></ul></li><li><p><strong>RabbitMQ/NServiceBus</strong>: 고가용 큐 기반 메시징 처리. .NET 생태계에서 많이 사용 .</p></li></ul><h3 id=-framework-활용-net>✅ Framework 활용 (.NET)<a hidden class=anchor aria-hidden=true href=#-framework-활용-net>#</a></h3><ul><li><strong>MediatR</strong>: Command/Query 객체 분리, Handler 정의 → 간단한 CQRS 구조 지원 (<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">bizcoder.com</a>).</li><li><strong>EventStoreDB</strong>: 이벤트 소싱 및 CQRS를 위한 특화 DB.</li></ul><h3 id=-동기-vs-비동기-업데이트-기법>✅ 동기 vs 비동기 업데이트 기법<a hidden class=anchor aria-hidden=true href=#-동기-vs-비동기-업데이트-기법>#</a></h3><ul><li><strong>동기 방식</strong>: 쓰기 및 읽기 모델 모두 갱신 후 응답. ACID 유사하지만 응답 지연 발생 (<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">stackoverflow.com</a>, <a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">learn.microsoft.com</a>).</li><li><strong>비동기 방식</strong>: 쓰기만 빠르게 처리하고 이벤트 기반 비동기로 읽기 모델 갱신. 지연 허용이 가능한 도메인에 적합 .</li></ul><h3 id=-탄력적-설계>✅ 탄력적 설계<a hidden class=anchor aria-hidden=true href=#-탄력적-설계>#</a></h3><ul><li>CQRS는 반드시 물리적 DB 분리가 아니라, 동일 DB 내 logical 분리도 가능 (<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">medium.com</a>).</li></ul><hr><h2 id=2-장점--단점-분석>2. 장점 / 단점 분석<a hidden class=anchor aria-hidden=true href=#2-장점--단점-분석>#</a></h2><h3 id=-장점>▶ 장점<a hidden class=anchor aria-hidden=true href=#-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>성능 & 확장성</td><td>독립 스케일링</td><td>쓰기/읽기 각각의 요구사항에 맞춰 스케일링 가능</td></tr><tr><td>모델 최적화</td><td>다양한 최적화</td><td>읽기 모델은 denormalized, 쓰기 모델은 transaction-safe 구성</td></tr><tr><td>유지보수 & 보안</td><td>역할 분리</td><td>쓰기 / 읽기 코드와 저장소 분리로 보안 정책 적용 용이</td></tr><tr><td>감사 & 이력관리</td><td>이벤트 저장</td><td>변경 이력 기록과 재플레이 가능</td></tr></tbody></table><h3 id=-단점-및-문제점>▶ 단점 및 문제점<a hidden class=anchor aria-hidden=true href=#-단점-및-문제점>#</a></h3><h4 id=-단점>🛠 단점<a hidden class=anchor aria-hidden=true href=#-단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>복잡성</td><td>아키텍처 복잡</td><td>여러 구성 요소(버스, DB, 핸들러 등) 필수 (<a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">reddit.com</a>)</td><td>incremental 도입, 팀 교육</td></tr><tr><td>일관성 지연</td><td>Eventual Consistency</td><td>읽기 모델 반영 지연으로 stale 발생 가능</td><td>동기 옵션 제공, UI 측 해결</td></tr><tr><td>데이터 중복</td><td>여러 모델 유지</td><td>읽기 전용 모델 중복 데이터 발생</td><td>적절한 동기화 전략, 스냅샷</td></tr><tr><td>비용 증가</td><td>운영 오버헤드</td><td>추가 컴포넌트, 스토리지, 클라우드 인프라 요구</td><td>서비스 수준 조정 및 최적화</td></tr></tbody></table><h4 id=-문제점>🔍 문제점<a hidden class=anchor aria-hidden=true href=#-문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지</th><th>예방</th><th>해결</th></tr></thead><tbody><tr><td>동기화 지연</td><td>읽기 모델 갱신 누락</td><td>메시지 손실, 장애</td><td>stale 응답, 데이터 불일치</td><td>모니터링 래그/스루풋 지표</td><td>메시지 재시도, Dead-letter 큐</td><td>재처리, 수동 스냅샷</td></tr><tr><td>메시지 중복</td><td>중복 이벤트 전달</td><td>큐 재전송 정책</td><td>idempotency 불일치, 중복 반영</td><td>이벤트 로그 분석</td><td>idempotent 핸들러 설계</td><td>중복 감지 로직 적용</td></tr><tr><td>데이터 폭증</td><td>이벤트 과금/스토리지 비용</td><td>append-only 이벤트 누적</td><td>비용 증가, 복구 지연</td><td>스토리지 모니터링</td><td>주기 스냅샷, 로그 정리</td><td>스냅샷 및 압축</td></tr></tbody></table><hr><h2 id=3-실무-활용-예시--워크플로우>3. 실무 활용 예시 & 워크플로우<a hidden class=anchor aria-hidden=true href=#3-실무-활용-예시--워크플로우>#</a></h2><h3 id=-예시-전자상거래-주문-시스템>📌 예시: 전자상거래 주문 시스템<a hidden class=anchor aria-hidden=true href=#-예시-전자상거래-주문-시스템>#</a></h3><table><thead><tr><th>구성</th><th>역할</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Command Service</td><td>주문 생성, 검증 후 이벤트 발행</td><td>주문 도메인 처리</td><td>도메인 중심 처리 가능</td></tr><tr><td>Kafka Event Bus</td><td>이벤트 중계</td><td>비동기 동기화</td><td>확장성, 탄력성 확보</td></tr><tr><td>Projection Service</td><td>주문 이벤트 기반 읽기 모델 갱신</td><td>조회 최적화</td><td>빠른 주문 상태 조회</td></tr><tr><td>Read API</td><td>사용자 주문 내역 조회</td><td>읽기 요청 처리</td><td>빠른 응답, 낮은 레이턴시</td></tr></tbody></table><h4 id=-워크플로우>🧩 워크플로우:<a hidden class=anchor aria-hidden=true href=#-워크플로우>#</a></h4><pre class=mermaid>flowchart TD
  UI --&gt;|POST /order| CmdSVC[Command Service]
  CmdSVC --&gt;|validate &amp; save| EventStore
  EventStore --&gt;|publish| Kafka
  subgraph QuerySide
    Kafka --&gt; Projection
    Projection --&gt; ReadDB
  end
  UI &lt;--|GET /orders| QueryAPI
  QueryAPI --&gt; ReadDB
</pre><ul><li><strong>Command Service</strong>: 주문 로직 수행 후 이벤트 발행</li><li><strong>Kafka</strong>: 이벤트 전달</li><li><strong>Projection Service</strong>: Kafka 이벤트 소비 → ReadDB 갱신</li><li><strong>Read API</strong>: 주문 현황 조회 API 응답 처리</li></ul><hr><h2 id=4-구현-예시-코드-net--mediatr--kafka>4. 구현 예시 코드 (.NET + MediatR + Kafka)<a hidden class=anchor aria-hidden=true href=#4-구현-예시-코드-net--mediatr--kafka>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>record</span> <span class=nc>CreateOrderCommand</span><span class=p>(</span><span class=n>Guid</span> <span class=n>OrderId</span><span class=p>,</span> <span class=kt>string</span> <span class=n>Product</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CreateOrderHandler</span> <span class=p>:</span> <span class=n>IRequestHandler</span><span class=p>&lt;</span><span class=n>CreateOrderCommand</span><span class=p>,</span> <span class=n>Unit</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;</span> <span class=n>Handle</span><span class=p>(</span><span class=n>CreateOrderCommand</span> <span class=n>cmd</span><span class=p>,</span> <span class=n>CancellationToken</span> <span class=n>_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 도메인 로직 수행</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>evt</span> <span class=p>=</span> <span class=k>new</span> <span class=n>OrderCreated</span><span class=p>(</span><span class=n>cmd</span><span class=p>.</span><span class=n>OrderId</span><span class=p>,</span> <span class=n>cmd</span><span class=p>.</span><span class=n>Product</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>kafkaProducer</span><span class=p>.</span><span class=n>ProduceAsync</span><span class=p>(</span><span class=s>&#34;orders&#34;</span><span class=p>,</span> <span class=n>evt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Unit</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderCreatedHandler</span> <span class=p>:</span> <span class=n>IConsumer</span><span class=p>&lt;</span><span class=n>OrderCreated</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>Handle</span><span class=p>(</span><span class=n>OrderCreated</span> <span class=n>evt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>readDb</span><span class=p>.</span><span class=n>SaveAsync</span><span class=p>(</span><span class=k>new</span> <span class=n>OrderDto</span> <span class=p>{</span> <span class=n>Id</span> <span class=p>=</span> <span class=n>evt</span><span class=p>.</span><span class=n>OrderId</span><span class=p>,</span> <span class=n>Product</span> <span class=p>=</span> <span class=n>evt</span><span class=p>.</span><span class=n>Product</span><span class=p>,</span> <span class=n>Status</span> <span class=p>=</span> <span class=s>&#34;Pending&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>MediatR</code>로 Command/Handler 구조 구성 (<a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">medium.com</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">bizcoder.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">medium.com</a>, <a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">stackoverflow.com</a>, <a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">tinybird.co</a>, <a href="https://dev.to/gabrielsadaka/vertical-slice-event-driven-architecture-with-net-core-and-kafka-2ad2?utm_source=chatgpt.com" title="A simpler approach to building event driven software using .NET ...">dev.to</a>, <a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">linkedin.com</a>, <a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">vikasrohit.medium.com</a>, <a href="https://wiki.softheon.com/Wiki/softheon/article/8557?utm_source=chatgpt.com" title="Microservices Architecture with CQRS, Clean ... - Softheon Wiki">wiki.softheon.com</a>)</li><li>Kafka로 이벤트 발행 및 소비처 구성</li></ul><hr><p>👉 다음 단계에서는 <strong>도전 과제</strong>, <strong>최적화 및 고려사항</strong>(모니터링, 스냅샷 전략, 재처리 등)까지 포함해 이어서 작성할 수 있습니다. 어느 영역에 집중할지 말씀 주시면 맞춰서 진행하겠습니다!</p><p>다음은 <strong>CQRS</strong>의 <strong>도전 과제 (Challenges)</strong>, <strong>최적화 및 고려사항 (Optimizations & Considerations)</strong>, 그리고 <strong>모니터링 및 해결 전략</strong>에 대한 심화 정리입니다.</p><hr><h2 id=1-도전-과제-challenges>1. 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#1-도전-과제-challenges>#</a></h2><h3 id=-아키텍처-복잡성>📌 아키텍처 복잡성<a hidden class=anchor aria-hidden=true href=#-아키텍처-복잡성>#</a></h3><ul><li>읽기/쓰기 모델 분리로 코드베이스와 시스템 구성 요소가 증가하여 복잡성이 높아짐 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">itnext.io</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">solutionsarchitecture.medium.com</a>).</li><li>해결책: 점진적 도입(Incremental adoption), Bounded Context 기준 CQRS 적용 (<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">stackoverflow.com</a>).</li></ul><h3 id=-일관성-관리>📌 일관성 관리<a hidden class=anchor aria-hidden=true href=#-일관성-관리>#</a></h3><ul><li>비동기 이벤트 처리로 인한 읽기 모델 지연 또는 stale 응답 발생 (<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">reintech.io</a>).</li><li>해결책: 비동기 지연을 허용하거나, 필요 시 동기 업데이트 옵션 설계 및 UX에서 반영.</li></ul><h3 id=-데이터-중복-및-모델-유지비용>📌 데이터 중복 및 모델 유지비용<a hidden class=anchor aria-hidden=true href=#-데이터-중복-및-모델-유지비용>#</a></h3><ul><li>읽기/쓰기 모델에서 데이터 중복이 발생하여 동기화 관리 비용 증가 (<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">geeksforgeeks.org</a>).</li><li>해결책: 스냅샷, CDC 활용, 모델간 동기화 전략 수립.</li></ul><h3 id=-이벤트-버전-관리>📌 이벤트 버전 관리<a hidden class=anchor aria-hidden=true href=#-이벤트-버전-관리>#</a></h3><ul><li>시스템 변경시 이벤트 스키마 변경이 누적되고, 버전 관리 어려움 (<a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">hyscaler.com</a>).</li><li>해결책: 이벤트 버저닝 및 호환성 유지 전략 수립.</li></ul><h3 id=-운영-및-모니터링-부담>📌 운영 및 모니터링 부담<a hidden class=anchor aria-hidden=true href=#-운영-및-모니터링-부담>#</a></h3><ul><li>추가된 메시징 시스템, 이벤트 뒷단 흐름 등 운영 복잡도 증가 .</li><li>해결책: Kibana/Grafana 기반 모니터링 대시보드 구축, 이벤트 흐름/지연 추적.</li></ul><hr><h2 id=2-최적화-및-고려사항-optimizations--best-practices>2. 최적화 및 고려사항 (Optimizations & Best Practices)<a hidden class=anchor aria-hidden=true href=#2-최적화-및-고려사항-optimizations--best-practices>#</a></h2><table><thead><tr><th>영역</th><th>고려사항</th><th>권장 전략</th></tr></thead><tbody><tr><td><strong>모델 설계</strong></td><td>읽기 모델 필수 사항 기반 설계</td><td>Use-case 별 Query 설계, Over-fetch 방지 (<a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">softwareengineering.stackexchange.com</a>)</td></tr><tr><td><strong>동기/비동기 균형</strong></td><td>응답 시간 vs 일관성</td><td>경계 설정: 장기 트랜잭션 vs 단기 읽기 → 필요 시 hybrid 동기 도입</td></tr><tr><td><strong>이벤트 처리</strong></td><td>Idempotency 보장</td><td>Consumer에서 중복 허용 처리, Dead-letter 큐 설정</td></tr><tr><td><strong>스냅샷 및 압축</strong></td><td>이벤트 스토리지 급증</td><td>정기 스냅샷, 이벤트 압축, 장기 보존 전략 수립</td></tr><tr><td><strong>성능 튜닝</strong></td><td>이벤트 처리량 병목</td><td>배치 처리 또는 파티셔닝 활용</td></tr><tr><td><strong>색인·캐싱</strong></td><td>쿼리 성능 최적화</td><td>Read DB 인덱스 구성 및 캐시 계층 도입</td></tr><tr><td><strong>이벤트 버저닝</strong></td><td>변경 없는 구버전 호환</td><td>버전별 이벤트 핸들러 설계, 호환 로직 유지</td></tr><tr><td><strong>테스트 전략</strong></td><td>커맨드/쿼리 분리 테스트</td><td>단위 테스트 + 통합 테스트 + 이벤트 재처리 테스트</td></tr></tbody></table><hr><h2 id=3-모니터링-진단-및-해결-전략>3. 모니터링, 진단 및 해결 전략<a hidden class=anchor aria-hidden=true href=#3-모니터링-진단-및-해결-전략>#</a></h2><h3 id=-지연-모니터링>🔍 지연 모니터링<a hidden class=anchor aria-hidden=true href=#-지연-모니터링>#</a></h3><ul><li>이벤트 발행부터 Read DB 반영까지 지연시간 추적</li><li>메트릭 활용: 처리량(throughput), lags, 실패율</li></ul><h3 id=-장애-탐지>💥 장애 탐지<a hidden class=anchor aria-hidden=true href=#-장애-탐지>#</a></h3><ul><li>미처리 이벤트, Dead-letter 큐, Consumer 실패 탐지</li><li>Rollback 대비 재현(Replay) 기능 포함</li></ul><h3 id=-해결책>🔧 해결책<a hidden class=anchor aria-hidden=true href=#-해결책>#</a></h3><ol><li>Retry + Dead-letter 큐 + 관리자 알림 설계</li><li>수동 Replay/Drain 기능 제공</li><li>운영 시나리오 테스트 케이스 작성</li></ol><hr><h2 id=4-cqrs-적용이-적합한-시나리오>4. CQRS 적용이 적합한 시나리오<a hidden class=anchor aria-hidden=true href=#4-cqrs-적용이-적합한-시나리오>#</a></h2><ul><li><strong>읽기와 쓰기 요청 불균형</strong>: e‑commerce, SNS, 금융 서비스 등에서 높은 비대칭 존재 (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">sixt.tech</a>, <a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">learn.microsoft.com</a>, <a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">hyscaler.com</a>).</li><li><strong>복잡한 도메인 로직</strong>: 주문처리, 결제, 재고 시스템 내 복잡 규칙 처리에 유리</li><li><strong>Event Sourcing 활용 시</strong>: 감사, 재구성, 상태 재생 기능 필요</li><li><strong>팀 규모와 구조</strong>: 대규모/분산 팀이 명확한 경계(Bounded Context) 설정 가능</li></ul><hr><h2 id=5-정리-요약>5. 정리 요약<a hidden class=anchor aria-hidden=true href=#5-정리-요약>#</a></h2><p>CQRS는 읽기와 쓰기를 분리하여 성능, 확장성, 보안, 도메인 설계를 최적화할 수 있는 강력한 아키텍처 패턴입니다. 하지만 도입 전 반드시 도전 과제, 운영 복잡도, 일관성 모델, 이벤트 설계 전략 등을 고려해야 합니다. 적절한 모니터링, 테스트, 이벤트 버전 관리 전략을 병행할 때 효과적인 시스템 구축이 가능합니다.</p><hr><p>다음으로 필요하신 부분은 <strong>Event Sourcing 결합</strong>, <strong>실무 적용 단계별 가이드</strong>, 또는 <strong>코드 중심 스켈레톤 구현 예제 (Python/JS)</strong> 등입니다. 특정한 사례나 코드 구현에 집중하고 싶으시면 말씀해 주세요!</p><p>아래는 <strong>CQRS + Event Sourcing</strong> 결합에 대한 심화 내용입니다.</p><hr><h2 id=1-event-sourcing-결합-cqrs--event-sourcing>1. Event Sourcing 결합 (CQRS + Event Sourcing)<a hidden class=anchor aria-hidden=true href=#1-event-sourcing-결합-cqrs--event-sourcing>#</a></h2><h3 id=-주요-개념-및-패턴>🎯 주요 개념 및 패턴<a hidden class=anchor aria-hidden=true href=#-주요-개념-및-패턴>#</a></h3><ul><li><strong>이벤트 중심 저장</strong>: 상태 변화는 append-only 이벤트로 기록. 이벤트는 불변(immutable) (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">upsolver.com</a>).</li><li><strong>이력 기반 상태 재구축</strong>: 모든 이벤트를 순차 재생하여 현재 상태를 재생성 가능 .</li><li><strong>CQRS와의 결합</strong>: 쓰기 모델은 이벤트 저장소(Event Store), 읽기 모델은 Projection으로 분리하여 읽기 성능 최적화 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">upsolver.com</a>).</li></ul><hr><h2 id=2-작동-흐름-및-구조>2. 작동 흐름 및 구조<a hidden class=anchor aria-hidden=true href=#2-작동-흐름-및-구조>#</a></h2><pre class=mermaid>flowchart LR
  UI --&gt;|Command| CmdHandler
  CmdHandler --&gt;|Append| EventStore
  EventStore --&gt;|Publish| EventBus
  EventBus --&gt; Projection[Projection 서비스]
  Projection --&gt; ReadDB[읽기 DB]
  UI &lt;--|Query| QueryHandler
  QueryHandler --&gt; ReadDB
</pre><ol><li>커맨드 실행 시 <strong>Append-only 이벤트 저장</strong></li><li>이벤트 버스 통해 <strong>구독 및 Projection → 읽기 DB 갱신</strong></li><li>Query는 <strong>읽기 DB에서 값 조회</strong></li><li>현재 상태는 <strong>Projection된 상태</strong>, 필요 시 <strong>전체 이벤트 재생 가능</strong></li></ol><hr><h2 id=3-구현-예시-python-기반>3. 구현 예시 (Python 기반)<a hidden class=anchor aria-hidden=true href=#3-구현-예시-python-기반>#</a></h2><h3 id=-라이브러리-활용>✅ 라이브러리 활용<a hidden class=anchor aria-hidden=true href=#-라이브러리-활용>#</a></h3><ul><li><strong>eventsourcing</strong>: Python 이벤트소싱 라이브러리 (<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">medium.com</a>, <a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">stackoverflow.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">upsolver.com</a>, <a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">eventsourcing.readthedocs.io</a>).</li><li><strong>pyeventsourcing</strong>: Aggregate, event 데코레이터 기반 간편 구현 (<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">github.com</a>).</li></ul><h3 id=-샘플-코드-eventsourcing-라이브러리>🔧 샘플 코드 (eventsourcing 라이브러리)<a hidden class=anchor aria-hidden=true href=#-샘플-코드-eventsourcing-라이브러리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>eventsourcing.domain</span> <span class=kn>import</span> <span class=n>Aggregate</span><span class=p>,</span> <span class=n>event</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>eventsourcing.application</span> <span class=kn>import</span> <span class=n>Application</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Account</span><span class=p>(</span><span class=n>Aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=nd>@event</span><span class=p>(</span><span class=s1>&#39;Created&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>=</span> <span class=n>owner</span><span class=p>;</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nd>@event</span><span class=p>(</span><span class=s1>&#39;Deposited&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>  <span class=nd>@event</span><span class=p>(</span><span class=s1>&#39;Withdrawn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>withdraw</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AccountApp</span><span class=p>(</span><span class=n>Application</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>create_account</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acct</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=n>owner</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>acct</span><span class=p>);</span> <span class=k>return</span> <span class=n>acct</span><span class=o>.</span><span class=n>id</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>acct_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acct</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>acct_id</span><span class=p>);</span> <span class=n>acct</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span> <span class=bp>self</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>acct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>get_balance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>acct_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>acct</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>acct_id</span><span class=p>);</span> <span class=k>return</span> <span class=n>acct</span><span class=o>.</span><span class=n>balance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>AccountApp</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>id</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>create_account</span><span class=p>(</span><span class=s2>&#34;Alice&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>app</span><span class=o>.</span><span class=n>get_balance</span><span class=p>(</span><span class=nb>id</span><span class=p>))</span>  <span class=c1># 100</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>이벤트 저장 및 Aggregate 상태 재구축이 자동으로 처리됩니다. (<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">github.com</a>)</li></ul><hr><h2 id=4-장점--주의사항>4. 장점 & 주의사항<a hidden class=anchor aria-hidden=true href=#4-장점--주의사항>#</a></h2><h3 id=-장점-1>✅ 장점<a hidden class=anchor aria-hidden=true href=#-장점-1>#</a></h3><ul><li><strong>완전한 변경 이력</strong> 저장 → 디버깅, 감사, 재생 기능 ⏳</li><li><strong>읽기 모델 최적화</strong> → 쿼리 처리 성능 향상</li><li><strong>Fault tolerance</strong>: 이벤트 재실행으로 오류 회복 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">upsolver.com</a>)</li></ul><h3 id=-주의사항>⚠️ 주의사항<a hidden class=anchor aria-hidden=true href=#-주의사항>#</a></h3><ul><li><strong>이벤트 스토리지 급증</strong>: Snapshot 전략 필요</li><li><strong>이벤트 스키마 변화 관리 필요</strong>: 버저닝 로직 또는 호환 전략 수립</li><li><strong>일관성 지연</strong>: 비동기 Projection으로 인한 Eventual Consistency 주의 (<a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">learn.microsoft.com</a>)</li></ul><hr><h2 id=5-실무-적용-단계별-가이드>5. 실무 적용 단계별 가이드<a hidden class=anchor aria-hidden=true href=#5-실무-적용-단계별-가이드>#</a></h2><table><thead><tr><th>단계</th><th>내용</th><th>설명</th></tr></thead><tbody><tr><td></td><td>Aggregate 식별</td><td>이벤트 등록 및 혜택이 있는 도메인 결정</td></tr><tr><td></td><td>이벤트 정의</td><td>명확한 도메인 의미(event names), 페이로드 설계</td></tr><tr><td></td><td>Event Store</td><td>Kafka, EventStoreDB, DB 선택</td></tr><tr><td></td><td>Command Handler</td><td>이벤트 생성, append-only 저장</td></tr><tr><td></td><td>Projection</td><td>읽기 쿼리 패턴 반영하여 View 생성</td></tr><tr><td></td><td>브로커</td><td>메시지 전달용 Kafka/RabbitMQ 구성</td></tr><tr><td></td><td>Snapshot</td><td>성능 최적화 및 schema evolution 대응</td></tr><tr><td></td><td>지연, 예외 추적</td><td>적절한 alert + 재처리 로직 배치</td></tr></tbody></table><hr><h2 id=6-요약>6. 요약<a hidden class=anchor aria-hidden=true href=#6-요약>#</a></h2><p>Event Sourcing과 결합된 CQRS는 이벤트 이력을 기반으로 읽기/쓰기 책임을 분리해 성능, 확장성, 감사 기능을 강화합니다. 그러나 이벤트 버저닝, 스토리지 관리, 일관성 지연 같은 과제도 존재하며, 이를 해결하기 위해 스냅샷, 모니터링 전략이 필수적입니다. Python 기반 구현은 다양한 라이브러리를 활용해 비교적 쉽게 도입 가능합니다.</p><hr><h2 id=참고-자료>참고 자료<a hidden class=anchor aria-hidden=true href=#참고-자료>#</a></h2><ul><li>Upsolver, <em>CQRS + Event Sourcing 원리</em> (<a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">github.com</a>, <a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">learn.microsoft.com</a>, <a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">mia-platform.eu</a>, <a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">medium.com</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">upsolver.com</a>, <a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">stackoverflow.com</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">medium.com</a>, <a href="https://dev.to/gabrielsadaka/vertical-slice-event-driven-architecture-with-net-core-and-kafka-2ad2?utm_source=chatgpt.com" title="A simpler approach to building event driven software using .NET ...">developer.confluent.io</a>)</li><li>Microsoft Azure, <em>Event Sourcing 실행 흐름</em></li><li>Confluent Developer, <em>CQRS vs Event Sourcing 최적 결합 사례</em></li><li>Python 이벤트소싱 라이브러리 docs (<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">eventsourcing.readthedocs.io</a>)</li></ul><hr><p>다음으로는 <strong>Python 기반 전체 예제 프로젝트 구성</strong>, 또는 <strong>JavaScript 버전 구현</strong>을 원하시면 말씀해 주세요!</p><p>알겠습니다! 다음은 <strong>Python 기반 CQRS + Event Sourcing 예제 프로젝트 구성</strong>과 <strong>JavaScript 버전 구현</strong> 두 가지 방향으로 나눠 설명드리겠습니다. 요청하시는 방향을 알려주시면 해당 부분을 상세하게 작성해드릴게요.</p><hr><h2 id=-선택할-수-있는-두-가지-예시-유형>🧭 선택할 수 있는 두 가지 예시 유형<a hidden class=anchor aria-hidden=true href=#-선택할-수-있는-두-가지-예시-유형>#</a></h2><ol><li><p><strong>Python 기반 전체 예제 프로젝트 구성</strong></p><ul><li><p>디렉터리 구조</p></li><li><p>Command Side, Event Store, Projection, Query Side 구성</p></li><li><p>예제 코드 및 실행 플로우</p></li><li><p>테스트 및 실행 스크립트 포함</p></li></ul></li><li><p><strong>JavaScript (Node.js) 버전 구현</strong></p><ul><li><p>Event Sourcing을 위한 라이브러리 선택 (예: <code>node-eventstore</code>, <code>@nestjs/cqrs</code>)</p></li><li><p>Aggregates, Event Bus, Projection 구현</p></li><li><p>REST API 엔드포인트 예시</p></li><li><p>테스트 코드와 실행 방법 제시</p></li></ul></li></ol><hr><h2 id=-다음에-전달드릴-내용-예시-python-프로젝트>📌 다음에 전달드릴 내용 예시 (Python 프로젝트)<a hidden class=anchor aria-hidden=true href=#-다음에-전달드릴-내용-예시-python-프로젝트>#</a></h2><h3 id=프로젝트-구성-구조>프로젝트 구성 구조<a hidden class=anchor aria-hidden=true href=#프로젝트-구성-구조>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cqrs-es-example/
</span></span><span class=line><span class=cl>├── commands/
</span></span><span class=line><span class=cl>│   └── create_order.py
</span></span><span class=line><span class=cl>├── events/
</span></span><span class=line><span class=cl>│   └── order_created.py
</span></span><span class=line><span class=cl>├── projections/
</span></span><span class=line><span class=cl>│   └── order_projection.py
</span></span><span class=line><span class=cl>├── store/
</span></span><span class=line><span class=cl>│   └── event_store.py
</span></span><span class=line><span class=cl>├── api/
</span></span><span class=line><span class=cl>│   ├── cmd_api.py
</span></span><span class=line><span class=cl>│   └── query_api.py
</span></span><span class=line><span class=cl>├── requirements.txt
</span></span><span class=line><span class=cl>└── README.md
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>commands/</strong>: Command 객체와 Handler</p></li><li><p><strong>events/</strong>: 도메인 이벤트 정의</p></li><li><p><strong>projections/</strong>: Event → Read 모델 갱신 로직</p></li><li><p><strong>store/</strong>: 이벤트 스토어 구현 및 Repository</p></li><li><p><strong>api/</strong>: REST API (Flask/FastAPI)로 커맨드/쿼리 제공</p></li></ul><h3 id=핵심-코드-예시>핵심 코드 예시<a hidden class=anchor aria-hidden=true href=#핵심-코드-예시>#</a></h3><ul><li><p>CreateOrderCommand 생성 및 유효성 검사</p></li><li><p>Event Store append + publish</p></li><li><p>Projection 서비스: 이벤트 구독 및 Read DB (SQLite 등) 업데이트</p></li><li><p>REST를 통한 주문 생성/조회</p></li></ul><h3 id=실행-시나리오>실행 시나리오<a hidden class=anchor aria-hidden=true href=#실행-시나리오>#</a></h3><ol><li><p><code>POST /api/command/order</code>로 주문 생성</p></li><li><p>이벤트 저장 → 프로젝션 적용</p></li><li><p><code>GET /api/query/order/:id</code>로 주문 정보 조회</p></li></ol><h3 id=테스트-및-실행>테스트 및 실행<a hidden class=anchor aria-hidden=true href=#테스트-및-실행>#</a></h3><ul><li><p>Python 가상환경, <code>requirements.txt</code></p></li><li><p><code>pytest</code> 또는 unittest 기반 테스트</p></li><li><p>이벤트 재생, 스냅샷 테스트 포함</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>  1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>  2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>  3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>  4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>  5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>  6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>  7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8>  8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9>  9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10> 10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11> 11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12> 12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13> 13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14> 14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15> 15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16> 16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17> 17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18> 18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19> 19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20> 20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21> 21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22> 22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23> 23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24> 24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25> 25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26> 26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27> 27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28> 28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29> 29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30> 30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31> 31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32> 32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33> 33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34> 34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35> 35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36> 36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37> 37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38> 38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39> 39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40> 40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41> 41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42> 42</a>
</span><span class=lnt id=hl-10-43><a class=lnlinks href=#hl-10-43> 43</a>
</span><span class=lnt id=hl-10-44><a class=lnlinks href=#hl-10-44> 44</a>
</span><span class=lnt id=hl-10-45><a class=lnlinks href=#hl-10-45> 45</a>
</span><span class=lnt id=hl-10-46><a class=lnlinks href=#hl-10-46> 46</a>
</span><span class=lnt id=hl-10-47><a class=lnlinks href=#hl-10-47> 47</a>
</span><span class=lnt id=hl-10-48><a class=lnlinks href=#hl-10-48> 48</a>
</span><span class=lnt id=hl-10-49><a class=lnlinks href=#hl-10-49> 49</a>
</span><span class=lnt id=hl-10-50><a class=lnlinks href=#hl-10-50> 50</a>
</span><span class=lnt id=hl-10-51><a class=lnlinks href=#hl-10-51> 51</a>
</span><span class=lnt id=hl-10-52><a class=lnlinks href=#hl-10-52> 52</a>
</span><span class=lnt id=hl-10-53><a class=lnlinks href=#hl-10-53> 53</a>
</span><span class=lnt id=hl-10-54><a class=lnlinks href=#hl-10-54> 54</a>
</span><span class=lnt id=hl-10-55><a class=lnlinks href=#hl-10-55> 55</a>
</span><span class=lnt id=hl-10-56><a class=lnlinks href=#hl-10-56> 56</a>
</span><span class=lnt id=hl-10-57><a class=lnlinks href=#hl-10-57> 57</a>
</span><span class=lnt id=hl-10-58><a class=lnlinks href=#hl-10-58> 58</a>
</span><span class=lnt id=hl-10-59><a class=lnlinks href=#hl-10-59> 59</a>
</span><span class=lnt id=hl-10-60><a class=lnlinks href=#hl-10-60> 60</a>
</span><span class=lnt id=hl-10-61><a class=lnlinks href=#hl-10-61> 61</a>
</span><span class=lnt id=hl-10-62><a class=lnlinks href=#hl-10-62> 62</a>
</span><span class=lnt id=hl-10-63><a class=lnlinks href=#hl-10-63> 63</a>
</span><span class=lnt id=hl-10-64><a class=lnlinks href=#hl-10-64> 64</a>
</span><span class=lnt id=hl-10-65><a class=lnlinks href=#hl-10-65> 65</a>
</span><span class=lnt id=hl-10-66><a class=lnlinks href=#hl-10-66> 66</a>
</span><span class=lnt id=hl-10-67><a class=lnlinks href=#hl-10-67> 67</a>
</span><span class=lnt id=hl-10-68><a class=lnlinks href=#hl-10-68> 68</a>
</span><span class=lnt id=hl-10-69><a class=lnlinks href=#hl-10-69> 69</a>
</span><span class=lnt id=hl-10-70><a class=lnlinks href=#hl-10-70> 70</a>
</span><span class=lnt id=hl-10-71><a class=lnlinks href=#hl-10-71> 71</a>
</span><span class=lnt id=hl-10-72><a class=lnlinks href=#hl-10-72> 72</a>
</span><span class=lnt id=hl-10-73><a class=lnlinks href=#hl-10-73> 73</a>
</span><span class=lnt id=hl-10-74><a class=lnlinks href=#hl-10-74> 74</a>
</span><span class=lnt id=hl-10-75><a class=lnlinks href=#hl-10-75> 75</a>
</span><span class=lnt id=hl-10-76><a class=lnlinks href=#hl-10-76> 76</a>
</span><span class=lnt id=hl-10-77><a class=lnlinks href=#hl-10-77> 77</a>
</span><span class=lnt id=hl-10-78><a class=lnlinks href=#hl-10-78> 78</a>
</span><span class=lnt id=hl-10-79><a class=lnlinks href=#hl-10-79> 79</a>
</span><span class=lnt id=hl-10-80><a class=lnlinks href=#hl-10-80> 80</a>
</span><span class=lnt id=hl-10-81><a class=lnlinks href=#hl-10-81> 81</a>
</span><span class=lnt id=hl-10-82><a class=lnlinks href=#hl-10-82> 82</a>
</span><span class=lnt id=hl-10-83><a class=lnlinks href=#hl-10-83> 83</a>
</span><span class=lnt id=hl-10-84><a class=lnlinks href=#hl-10-84> 84</a>
</span><span class=lnt id=hl-10-85><a class=lnlinks href=#hl-10-85> 85</a>
</span><span class=lnt id=hl-10-86><a class=lnlinks href=#hl-10-86> 86</a>
</span><span class=lnt id=hl-10-87><a class=lnlinks href=#hl-10-87> 87</a>
</span><span class=lnt id=hl-10-88><a class=lnlinks href=#hl-10-88> 88</a>
</span><span class=lnt id=hl-10-89><a class=lnlinks href=#hl-10-89> 89</a>
</span><span class=lnt id=hl-10-90><a class=lnlinks href=#hl-10-90> 90</a>
</span><span class=lnt id=hl-10-91><a class=lnlinks href=#hl-10-91> 91</a>
</span><span class=lnt id=hl-10-92><a class=lnlinks href=#hl-10-92> 92</a>
</span><span class=lnt id=hl-10-93><a class=lnlinks href=#hl-10-93> 93</a>
</span><span class=lnt id=hl-10-94><a class=lnlinks href=#hl-10-94> 94</a>
</span><span class=lnt id=hl-10-95><a class=lnlinks href=#hl-10-95> 95</a>
</span><span class=lnt id=hl-10-96><a class=lnlinks href=#hl-10-96> 96</a>
</span><span class=lnt id=hl-10-97><a class=lnlinks href=#hl-10-97> 97</a>
</span><span class=lnt id=hl-10-98><a class=lnlinks href=#hl-10-98> 98</a>
</span><span class=lnt id=hl-10-99><a class=lnlinks href=#hl-10-99> 99</a>
</span><span class=lnt id=hl-10-100><a class=lnlinks href=#hl-10-100>100</a>
</span><span class=lnt id=hl-10-101><a class=lnlinks href=#hl-10-101>101</a>
</span><span class=lnt id=hl-10-102><a class=lnlinks href=#hl-10-102>102</a>
</span><span class=lnt id=hl-10-103><a class=lnlinks href=#hl-10-103>103</a>
</span><span class=lnt id=hl-10-104><a class=lnlinks href=#hl-10-104>104</a>
</span><span class=lnt id=hl-10-105><a class=lnlinks href=#hl-10-105>105</a>
</span><span class=lnt id=hl-10-106><a class=lnlinks href=#hl-10-106>106</a>
</span><span class=lnt id=hl-10-107><a class=lnlinks href=#hl-10-107>107</a>
</span><span class=lnt id=hl-10-108><a class=lnlinks href=#hl-10-108>108</a>
</span><span class=lnt id=hl-10-109><a class=lnlinks href=#hl-10-109>109</a>
</span><span class=lnt id=hl-10-110><a class=lnlinks href=#hl-10-110>110</a>
</span><span class=lnt id=hl-10-111><a class=lnlinks href=#hl-10-111>111</a>
</span><span class=lnt id=hl-10-112><a class=lnlinks href=#hl-10-112>112</a>
</span><span class=lnt id=hl-10-113><a class=lnlinks href=#hl-10-113>113</a>
</span><span class=lnt id=hl-10-114><a class=lnlinks href=#hl-10-114>114</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># CQRS + Event Sourcing Python 예제</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 디렉터리 구조</span>
</span></span><span class=line><span class=cl><span class=c1># cqrs_es_example/</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ commands/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ create_order.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ events/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ order_created.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ projections/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ order_projection.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ store/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ event_store.py</span>
</span></span><span class=line><span class=cl><span class=c1># ├─ api/</span>
</span></span><span class=line><span class=cl><span class=c1># │   ├─ cmd_api.py</span>
</span></span><span class=line><span class=cl><span class=c1># │   └─ query_api.py</span>
</span></span><span class=line><span class=cl><span class=c1># └─ main.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># commands/create_order.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreateOrderCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>product</span><span class=p>,</span> <span class=n>quantity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product</span> <span class=o>=</span> <span class=n>product</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>quantity</span> <span class=o>=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># events/order_created.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>product</span><span class=p>,</span> <span class=n>quantity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product</span> <span class=o>=</span> <span class=n>product</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>quantity</span> <span class=o>=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># store/event_store.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># projections/order_projection.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=s1>&#39;order_id&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;product&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>product</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>quantity</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># api/cmd_api.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>commands.create_order</span> <span class=kn>import</span> <span class=n>CreateOrderCommand</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>events.order_created</span> <span class=kn>import</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>store.event_store</span> <span class=kn>import</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>projections.order_projection</span> <span class=kn>import</span> <span class=n>projection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/command/order&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=n>CreateOrderCommand</span><span class=p>(</span><span class=o>**</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>product</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>quantity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>projection</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;created&#39;</span><span class=p>}),</span> <span class=mi>201</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># api/query_api.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>projections.order_projection</span> <span class=kn>import</span> <span class=n>projection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>query_app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@query_app.route</span><span class=p>(</span><span class=s1>&#39;/query/order/&lt;order_id&gt;&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>projection</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>order</span><span class=p>),</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;not found&#39;</span><span class=p>}),</span> <span class=mi>404</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># main.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>api.cmd_api</span> <span class=kn>import</span> <span class=n>app</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>api.query_api</span> <span class=kn>import</span> <span class=n>query_app</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>werkzeug.middleware.dispatcher</span> <span class=kn>import</span> <span class=n>DispatcherMiddleware</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>application</span> <span class=o>=</span> <span class=n>DispatcherMiddleware</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;/query&#39;</span><span class=p>:</span> <span class=n>query_app</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 공통 모듈 인스턴스 (store/event_store.py)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>events.order_created</span> <span class=kn>import</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>projections.order_projection</span> <span class=kn>import</span> <span class=n>OrderProjection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>projection</span> <span class=o>=</span> <span class=n>OrderProjection</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>원하시는 방향을 말씀해 주세요!</p><p>안녕하세요! CQRS에 대한 포괄적인 조사와 분석을 시작하겠습니다. 먼저 최신 정보를 수집하여 심도 있는 분석을 진행하겠습니다.</p><h1 id=cqrs-command-query-responsibility-segregation-포괄적-분석>CQRS (Command Query Responsibility Segregation) 포괄적 분석<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-포괄적-분석>#</a></h1><h2 id=1-태그-1>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-1>#</a></h2><ul><li><code>Command-Query-Responsibility-Segregation</code></li><li><code>Event-Sourcing-Pattern</code></li><li><code>Microservices-Architecture</code></li><li><code>Data-Management-Pattern</code></li></ul><h2 id=2-분류-구조-검토>2. 분류 구조 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-검토>#</a></h2><p>&ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns&rdquo;</p><p><strong>검토 결과</strong>: 적절한 분류입니다. CQRS는 본질적으로 데이터 관리 패턴이며, 명령과 조회의 책임을 분리하는 아키텍처 패턴으로서 소프트웨어 설계 및 아키텍처 영역에 속합니다. 더 구체적으로는 분산 시스템과 마이크로서비스 아키텍처에서 널리 사용되는 패턴이므로 해당 계층 구조가 적절합니다.</p><h2 id=3-요약-설명-200자-내외>3. 요약 설명 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-설명-200자-내외>#</a></h2><p>CQRS는 시스템에서 데이터를 변경하는 명령(Command)과 데이터를 조회하는 쿼리(Query)의 책임을 분리하는 아키텍처 패턴입니다. 이를 통해 읽기와 쓰기 작업을 독립적으로 최적화할 수 있어 성능, 확장성, 보안성을 향상시킬 수 있습니다.</p><h2 id=4-개요-250자-내외>4. 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요-250자-내외>#</a></h2><p>CQRS는 전통적인 CRUD 아키텍처의 한계를 극복하기 위해 개발된 패턴으로, 복잡한 도메인 로직과 높은 트래픽을 처리하는 시스템에서 특히 유용합니다. Event Sourcing과 함께 사용되어 이벤트 기반 아키텍처를 구성하며, 마이크로서비스 환경에서 각 서비스의 독립적인 확장과 최적화를 가능하게 합니다.</p><hr><h2 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h2><h3 id=51-기본-개념>5.1 기본 개념<a hidden class=anchor aria-hidden=true href=#51-기본-개념>#</a></h3><p>**CQRS (Command Query Responsibility Segregation)**는 Bertrand Meyer의 CQS (Command Query Separation) 원칙을 확장한 아키텍처 패턴입니다.</p><p><strong>핵심 원칙</strong>:</p><ul><li><strong>명령 (Command)</strong>: 시스템의 상태를 변경하는 작업 (Create, Update, Delete)</li><li><strong>조회 (Query)</strong>: 시스템의 상태를 읽는 작업 (Read), 상태 변경 없음</li><li><strong>책임 분리</strong>: 명령과 조회를 별도의 모델과 인터페이스로 처리</li></ul><h3 id=52-실무-구현-관련-핵심-개념>5.2 실무 구현 관련 핵심 개념<a hidden class=anchor aria-hidden=true href=#52-실무-구현-관련-핵심-개념>#</a></h3><p><strong>Write Model (명령 모델)</strong>:</p><ul><li>비즈니스 로직과 도메인 규칙 포함</li><li>트랜잭션 무결성과 일관성 보장</li><li>명령 검증 및 처리</li></ul><p><strong>Read Model (조회 모델)</strong>:</p><ul><li>조회에 최적화된 데이터 구조</li><li>DTO (Data Transfer Object) 또는 프로젝션 제공</li><li>캐싱 및 성능 최적화</li></ul><p><strong>Event Store</strong>:</p><ul><li>도메인 이벤트의 영구 저장소</li><li>Event Sourcing과 결합 시 활용</li><li>감사 추적 및 이력 관리</li></ul><h2 id=6-배경>6. 배경<a hidden class=anchor aria-hidden=true href=#6-배경>#</a></h2><p>CQRS는 2010년 Greg Young에 의해 정의되었으며, 다음과 같은 문제들을 해결하기 위해 등장했습니다:</p><ul><li><strong>성능 병목현상</strong>: 단일 모델에서 읽기/쓰기 작업의 경합</li><li><strong>복잡한 도메인 모델</strong>: 읽기와 쓰기 요구사항의 차이</li><li><strong>확장성 한계</strong>: 읽기와 쓰기 작업의 서로 다른 확장 요구사항</li><li><strong>데이터 불일치</strong>: 복잡한 조인과 집계 연산의 성능 문제</li></ul><h2 id=7-목적-및-필요성>7. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#7-목적-및-필요성>#</a></h2><h3 id=71-목적>7.1 목적<a hidden class=anchor aria-hidden=true href=#71-목적>#</a></h3><ul><li>읽기와 쓰기 작업의 독립적 최적화</li><li>복잡한 비즈니스 로직의 단순화</li><li>시스템 성능 및 확장성 개선</li><li>개발팀의 병렬 작업 가능</li></ul><h3 id=72-필요성>7.2 필요성<a hidden class=anchor aria-hidden=true href=#72-필요성>#</a></h3><ul><li>높은 트래픽과 복잡한 데이터 요구사항</li><li>읽기와 쓰기 패턴의 현저한 차이</li><li>마이크로서비스 환경에서의 데이터 분리</li><li>이벤트 기반 아키텍처 구현</li></ul><h2 id=8-주요-기능-및-역할>8. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#8-주요-기능-및-역할>#</a></h2><h3 id=81-명령-처리>8.1 명령 처리<a hidden class=anchor aria-hidden=true href=#81-명령-처리>#</a></h3><ul><li>비즈니스 규칙 검증</li><li>도메인 이벤트 생성</li><li>상태 변경 관리</li><li>트랜잭션 처리</li></ul><h3 id=82-조회-처리>8.2 조회 처리<a hidden class=anchor aria-hidden=true href=#82-조회-처리>#</a></h3><ul><li>최적화된 데이터 조회</li><li>프로젝션 생성 및 관리</li><li>캐싱 전략 구현</li><li>성능 최적화</li></ul><h3 id=83-이벤트-관리>8.3 이벤트 관리<a hidden class=anchor aria-hidden=true href=#83-이벤트-관리>#</a></h3><ul><li>도메인 이벤트 발행</li><li>이벤트 스트림 처리</li><li>최종 일관성 보장</li><li>감사 추적</li></ul><h2 id=9-주요-원리>9. 주요 원리<a hidden class=anchor aria-hidden=true href=#9-주요-원리>#</a></h2><h3 id=91-cqs-원칙-확장>9.1 CQS 원칙 확장<a hidden class=anchor aria-hidden=true href=#91-cqs-원칙-확장>#</a></h3><pre class=mermaid>graph TD
    A[CQS 원칙] --&gt; B[메서드 수준 분리]
    A --&gt; C[Command: 상태 변경]
    A --&gt; D[Query: 데이터 반환]
    
    E[CQRS 패턴] --&gt; F[객체/모델 수준 분리]
    E --&gt; G[Write Model]
    E --&gt; H[Read Model]
    
    B --&gt; E
</pre><h3 id=92-책임-분리-원칙>9.2 책임 분리 원칙<a hidden class=anchor aria-hidden=true href=#92-책임-분리-원칙>#</a></h3><ul><li><strong>단일 책임</strong>: 각 모델은 하나의 명확한 책임</li><li><strong>인터페이스 분리</strong>: 명령과 조회 인터페이스 분리</li><li><strong>의존성 역전</strong>: 추상화에 의존하는 구조</li></ul><h2 id=10-작동-원리>10. 작동 원리<a hidden class=anchor aria-hidden=true href=#10-작동-원리>#</a></h2><h3 id=101-기본-cqrs-흐름>10.1 기본 CQRS 흐름<a hidden class=anchor aria-hidden=true href=#101-기본-cqrs-흐름>#</a></h3><pre class=mermaid>sequenceDiagram
    participant Client
    participant CommandAPI
    participant WriteModel
    participant Database
    participant EventBus
    participant ReadModel
    participant QueryAPI

    Client-&gt;&gt;CommandAPI: Command 전송
    CommandAPI-&gt;&gt;WriteModel: 명령 처리
    WriteModel-&gt;&gt;Database: 데이터 저장
    WriteModel-&gt;&gt;EventBus: 이벤트 발행
    EventBus-&gt;&gt;ReadModel: 이벤트 처리
    ReadModel-&gt;&gt;Database: 조회 모델 업데이트
    
    Client-&gt;&gt;QueryAPI: Query 요청
    QueryAPI-&gt;&gt;ReadModel: 데이터 조회
    ReadModel-&gt;&gt;Client: 결과 반환
</pre><h3 id=102-event-sourcing과-결합된-cqrs>10.2 Event Sourcing과 결합된 CQRS<a hidden class=anchor aria-hidden=true href=#102-event-sourcing과-결합된-cqrs>#</a></h3><pre class=mermaid>graph LR
    A[Command] --&gt; B[Command Handler]
    B --&gt; C[Aggregate]
    C --&gt; D[Events]
    D --&gt; E[Event Store]
    E --&gt; F[Event Handler]
    F --&gt; G[Read Model]
    G --&gt; H[Query]
</pre><h2 id=11-구조-및-아키텍처>11. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처>#</a></h2><h3 id=111-전체-아키텍처>11.1 전체 아키텍처<a hidden class=anchor aria-hidden=true href=#111-전체-아키텍처>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;Command Side (Write)&#34;
        A[Command API]
        B[Command Handlers]
        C[Domain Model]
        D[Write Database]
    end
    
    subgraph &#34;Query Side (Read)&#34;
        E[Query API]
        F[Query Handlers]
        G[Read Model]
        H[Read Database]
    end
    
    subgraph &#34;Infrastructure&#34;
        I[Event Bus]
        J[Message Queue]
    end
    
    A --&gt; B
    B --&gt; C
    C --&gt; D
    C --&gt; I
    I --&gt; F
    F --&gt; G
    G --&gt; H
    E --&gt; F
</pre><h3 id=112-필수-구성요소>11.2 필수 구성요소<a hidden class=anchor aria-hidden=true href=#112-필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Command Handler</td><td>명령 처리</td><td>비즈니스 로직 실행</td><td>상태 변경, 검증</td></tr><tr><td>Query Handler</td><td>조회 처리</td><td>데이터 반환</td><td>상태 변경 없음</td></tr><tr><td>Write Model</td><td>쓰기 모델</td><td>도메인 로직 구현</td><td>정규화된 구조</td></tr><tr><td>Read Model</td><td>읽기 모델</td><td>조회 최적화</td><td>비정규화된 구조</td></tr><tr><td>Event Store</td><td>이벤트 저장</td><td>이벤트 영속화</td><td>순서 보장</td></tr></tbody></table><h3 id=113-선택-구성요소>11.3 선택 구성요소<a hidden class=anchor aria-hidden=true href=#113-선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Event Bus</td><td>이벤트 전달</td><td>비동기 통신</td><td>확장성 향상</td></tr><tr><td>Snapshot Store</td><td>스냅샷 저장</td><td>성능 최적화</td><td>빠른 상태 복원</td></tr><tr><td>Saga</td><td>장기 프로세스</td><td>트랜잭션 관리</td><td>보상 처리</td></tr><tr><td>Projector</td><td>프로젝션 생성</td><td>뷰 생성</td><td>데이터 변환</td></tr></tbody></table><h2 id=12-구현-기법>12. 구현 기법<a hidden class=anchor aria-hidden=true href=#12-구현-기법>#</a></h2><h3 id=121-단일-데이터베이스-cqrs>12.1 단일 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#121-단일-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 하나의 데이터베이스를 사용하되 읽기/쓰기 로직을 분리</p><p><strong>구성</strong>:</p><ul><li>공통 데이터베이스</li><li>별도의 명령/조회 핸들러</li><li>서로 다른 모델 인터페이스</li></ul><p><strong>목적</strong>: 복잡성 최소화하면서 CQRS 혜택 획득</p><p><strong>실제 예시</strong>:</p><pre class=mermaid>graph TD
    A[Client] --&gt; B[Command API]
    A --&gt; C[Query API]
    B --&gt; D[Command Handler]
    C --&gt; E[Query Handler]
    D --&gt; F[Shared Database]
    E --&gt; F
</pre><h3 id=122-분리된-데이터베이스-cqrs>12.2 분리된 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#122-분리된-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 읽기와 쓰기에 별도의 데이터베이스 사용</p><p><strong>구성</strong>:</p><ul><li>Write Database (정규화)</li><li>Read Database (비정규화)</li><li>동기화 메커니즘</li></ul><p><strong>목적</strong>: 각 작업에 최적화된 스토리지 활용</p><p><strong>실제 예시</strong>:</p><pre class=mermaid>graph TD
    A[Commands] --&gt; B[Write DB]
    B --&gt; C[Event Stream]
    C --&gt; D[Read DB]
    D --&gt; E[Queries]
</pre><h3 id=123-event-sourcing--cqrs>12.3 Event Sourcing + CQRS<a hidden class=anchor aria-hidden=true href=#123-event-sourcing--cqrs>#</a></h3><p><strong>정의</strong>: 모든 상태 변경을 이벤트로 저장하는 방식과 CQRS 결합</p><p><strong>구성</strong>:</p><ul><li>Event Store</li><li>Aggregate Root</li><li>Event Handlers</li><li>Projections</li></ul><p><strong>목적</strong>: 완전한 감사 추적과 상태 재구성 가능</p><p><strong>실제 예시</strong>:</p><pre class=mermaid>graph TB
    A[Command] --&gt; B[Aggregate]
    B --&gt; C[Events]
    C --&gt; D[Event Store]
    D --&gt; E[Projections]
    E --&gt; F[Read Models]
</pre><h2 id=13-장점>13. 장점<a hidden class=anchor aria-hidden=true href=#13-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 최적화</td><td>읽기와 쓰기 작업을 독립적으로 최적화하여 전체 시스템 성능 향상</td></tr><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 부하에 따라 각각 독립적으로 스케일링 가능</td></tr><tr><td>장점</td><td>개발 생산성</td><td>명령과 조회 로직 분리로 팀 간 병렬 개발 가능</td></tr><tr><td>장점</td><td>비즈니스 로직 명확성</td><td>도메인 중심의 명령 모델로 비즈니스 규칙이 명확해짐</td></tr><tr><td>장점</td><td>보안 강화</td><td>읽기와 쓰기 권한을 세밀하게 제어 가능</td></tr><tr><td>장점</td><td>기술 다양성</td><td>읽기와 쓰기에 서로 다른 기술 스택 사용 가능</td></tr></tbody></table><h2 id=14-단점과-문제점-그리고-해결방안>14. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#14-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=141-단점>14.1 단점<a hidden class=anchor aria-hidden=true href=#141-단점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>두 개의 분리된 모델 관리로 인한 시스템 복잡성</td><td>점진적 도입, 명확한 경계 설정</td></tr><tr><td>단점</td><td>최종 일관성</td><td>읽기와 쓰기 데이터 간 지연으로 인한 일관성 문제</td><td>사용자 기대치 관리, 보상 메커니즘</td></tr><tr><td>단점</td><td>인프라 비용</td><td>추가적인 데이터베이스와 메시징 인프라 필요</td><td>클라우드 서비스 활용, 비용 최적화</td></tr><tr><td>단점</td><td>학습 곡선</td><td>개발팀의 새로운 패러다임 학습 필요</td><td>교육 프로그램, 문서화</td></tr></tbody></table><h3 id=142-문제점>14.2 문제점<a hidden class=anchor aria-hidden=true href=#142-문제점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 동기화 지연</td><td>네트워크 지연, 처리 지연</td><td>사용자 혼란, 데이터 불일치</td><td>모니터링 대시보드</td><td>적절한 타임아웃 설정</td><td>재시도 메커니즘, 데드레터 큐</td></tr><tr><td>문제점</td><td>이벤트 순서 보장</td><td>분산 환경에서의 이벤트 처리</td><td>잘못된 상태 계산</td><td>이벤트 시퀀스 검증</td><td>파티셔닝 전략</td><td>이벤트 소싱, 버전 관리</td></tr><tr><td>문제점</td><td>메시지 중복 처리</td><td>네트워크 실패, 재시도</td><td>데이터 중복, 불일치</td><td>중복 감지 로직</td><td>멱등성 보장</td><td>멱등키, 중복 제거</td></tr></tbody></table><h2 id=15-도전-과제>15. 도전 과제<a hidden class=anchor aria-hidden=true href=#15-도전-과제>#</a></h2><h3 id=151-기술적-도전-과제>15.1 기술적 도전 과제<a hidden class=anchor aria-hidden=true href=#151-기술적-도전-과제>#</a></h3><p><strong>복잡성 관리</strong></p><ul><li>원인: 다중 모델과 비동기 처리</li><li>영향: 개발 및 운영 복잡성 증가</li><li>해결방안: 마이크로서비스 경계 명확화, 자동화된 테스트</li></ul><p><strong>최종 일관성 처리</strong></p><ul><li>원인: 분산 시스템의 본질적 특성</li><li>영향: 사용자 경험 저하 가능성</li><li>해결방안: 사용자 인터페이스 개선, 상태 표시</li></ul><h3 id=152-조직적-도전-과제>15.2 조직적 도전 과제<a hidden class=anchor aria-hidden=true href=#152-조직적-도전-과제>#</a></h3><p><strong>팀 협업</strong></p><ul><li>원인: 명령과 조회 팀 간 의존성</li><li>영향: 개발 속도 저하</li><li>해결방안: API 우선 설계, 계약 테스트</li></ul><p><strong>운영 모니터링</strong></p><ul><li>원인: 분산된 컴포넌트들</li><li>영향: 장애 진단 어려움</li><li>해결방안: 분산 추적, 통합 로깅</li></ul><h2 id=16-분류-기준에-따른-종류-및-유형>16. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td>데이터 저장소</td><td>단일 DB</td><td>하나의 데이터베이스 사용</td><td>단순한 도메인, 초기 구현</td></tr><tr><td>데이터 저장소</td><td>분리 DB</td><td>읽기/쓰기 별도 데이터베이스</td><td>높은 성능 요구사항</td></tr><tr><td>이벤트 처리</td><td>동기식</td><td>즉시 읽기 모델 업데이트</td><td>실시간 일관성 필요</td></tr><tr><td>이벤트 처리</td><td>비동기식</td><td>메시지 큐를 통한 처리</td><td>높은 처리량 필요</td></tr><tr><td>구현 방식</td><td>Event Sourcing</td><td>모든 변경을 이벤트로 저장</td><td>감사 추적, 이력 관리</td></tr><tr><td>구현 방식</td><td>State-based</td><td>현재 상태만 저장</td><td>일반적인 CRUD 개선</td></tr></tbody></table><h2 id=17-실무-사용-예시>17. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시>#</a></h2><table><thead><tr><th>도메인</th><th>목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td>E-commerce</td><td>주문 처리와 재고 조회 분리</td><td>Event Sourcing, Kafka</td><td>높은 처리량과 빠른 조회</td></tr><tr><td>금융 시스템</td><td>거래 처리와 잔액 조회 분리</td><td>RDBMS, Redis</td><td>정확성과 성능 모두 확보</td></tr><tr><td>소셜 미디어</td><td>포스팅과 피드 조회 분리</td><td>NoSQL, Elasticsearch</td><td>대용량 읽기 처리</td></tr><tr><td>IoT 플랫폼</td><td>센서 데이터 수집과 분석 분리</td><td>Time-series DB, Stream Processing</td><td>실시간 수집과 복잡한 분석</td></tr><tr><td>게임 플랫폼</td><td>게임 상태와 리더보드 분리</td><td>In-memory DB, Cache</td><td>빠른 응답 시간</td></tr></tbody></table><h2 id=18-활용-사례>18. 활용 사례<a hidden class=anchor aria-hidden=true href=#18-활용-사례>#</a></h2><h3 id=181-전자상거래-플랫폼-사례>18.1 전자상거래 플랫폼 사례<a hidden class=anchor aria-hidden=true href=#181-전자상거래-플랫폼-사례>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>명령 측</strong>: 주문 생성, 재고 업데이트, 결제 처리</li><li><strong>조회 측</strong>: 상품 검색, 주문 이력, 재고 현황</li></ul><p><strong>시스템 구성도</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;사용자 인터페이스&#34;
        A[웹 애플리케이션]
        B[모바일 앱]
    end
    
    subgraph &#34;명령 측 (Order Service)&#34;
        C[Order API]
        D[Order Handler]
        E[Order DB]
    end
    
    subgraph &#34;조회 측 (Catalog Service)&#34;
        F[Catalog API]
        G[Search Handler]
        H[Read DB]
    end
    
    subgraph &#34;인프라&#34;
        I[Event Bus]
        J[Cache Layer]
    end
    
    A --&gt; C
    B --&gt; C
    A --&gt; F
    B --&gt; F
    C --&gt; D
    D --&gt; E
    D --&gt; I
    I --&gt; G
    G --&gt; H
    G --&gt; J
    F --&gt; G
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 주문 생성 요청</li><li>Order Handler가 비즈니스 로직 검증</li><li>Order DB에 주문 정보 저장</li><li>OrderCreated 이벤트 발행</li><li>Catalog Service가 이벤트 수신</li><li>Read DB 업데이트 (재고 감소)</li><li>캐시 갱신</li></ol><p><strong>CQRS 역할</strong>:</p><ul><li><strong>명령 측</strong>: 복잡한 주문 로직과 재고 관리</li><li><strong>조회 측</strong>: 빠른 상품 검색과 추천</li></ul><p><strong>CQRS 유무에 따른 차이점</strong>:</p><p><strong>CQRS 적용 전</strong>:</p><ul><li>단일 데이터베이스에서 모든 작업 처리</li><li>복잡한 조인 쿼리로 성능 저하</li><li>읽기/쓰기 경합으로 인한 대기 시간 증가</li></ul><p><strong>CQRS 적용 후</strong>:</p><ul><li>읽기 최적화된 별도 데이터베이스</li><li>검색 성능 10배 향상</li><li>주문 처리와 독립적인 카탈로그 조회</li></ul><h2 id=19-구현-예시>19. 구현 예시<a hidden class=anchor aria-hidden=true href=#19-구현-예시>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>  1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>  2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>  3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>  4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>  5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>  6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>  7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>  8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>  9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10> 10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11> 11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12> 12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13> 13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14> 14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15> 15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16> 16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17> 17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18> 18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19> 19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20> 20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21> 21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22> 22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23> 23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24> 24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25> 25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26> 26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27> 27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28> 28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29> 29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30> 30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31> 31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32> 32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33> 33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34> 34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35> 35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36> 36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37> 37</a>
</span><span class=lnt id=hl-19-38><a class=lnlinks href=#hl-19-38> 38</a>
</span><span class=lnt id=hl-19-39><a class=lnlinks href=#hl-19-39> 39</a>
</span><span class=lnt id=hl-19-40><a class=lnlinks href=#hl-19-40> 40</a>
</span><span class=lnt id=hl-19-41><a class=lnlinks href=#hl-19-41> 41</a>
</span><span class=lnt id=hl-19-42><a class=lnlinks href=#hl-19-42> 42</a>
</span><span class=lnt id=hl-19-43><a class=lnlinks href=#hl-19-43> 43</a>
</span><span class=lnt id=hl-19-44><a class=lnlinks href=#hl-19-44> 44</a>
</span><span class=lnt id=hl-19-45><a class=lnlinks href=#hl-19-45> 45</a>
</span><span class=lnt id=hl-19-46><a class=lnlinks href=#hl-19-46> 46</a>
</span><span class=lnt id=hl-19-47><a class=lnlinks href=#hl-19-47> 47</a>
</span><span class=lnt id=hl-19-48><a class=lnlinks href=#hl-19-48> 48</a>
</span><span class=lnt id=hl-19-49><a class=lnlinks href=#hl-19-49> 49</a>
</span><span class=lnt id=hl-19-50><a class=lnlinks href=#hl-19-50> 50</a>
</span><span class=lnt id=hl-19-51><a class=lnlinks href=#hl-19-51> 51</a>
</span><span class=lnt id=hl-19-52><a class=lnlinks href=#hl-19-52> 52</a>
</span><span class=lnt id=hl-19-53><a class=lnlinks href=#hl-19-53> 53</a>
</span><span class=lnt id=hl-19-54><a class=lnlinks href=#hl-19-54> 54</a>
</span><span class=lnt id=hl-19-55><a class=lnlinks href=#hl-19-55> 55</a>
</span><span class=lnt id=hl-19-56><a class=lnlinks href=#hl-19-56> 56</a>
</span><span class=lnt id=hl-19-57><a class=lnlinks href=#hl-19-57> 57</a>
</span><span class=lnt id=hl-19-58><a class=lnlinks href=#hl-19-58> 58</a>
</span><span class=lnt id=hl-19-59><a class=lnlinks href=#hl-19-59> 59</a>
</span><span class=lnt id=hl-19-60><a class=lnlinks href=#hl-19-60> 60</a>
</span><span class=lnt id=hl-19-61><a class=lnlinks href=#hl-19-61> 61</a>
</span><span class=lnt id=hl-19-62><a class=lnlinks href=#hl-19-62> 62</a>
</span><span class=lnt id=hl-19-63><a class=lnlinks href=#hl-19-63> 63</a>
</span><span class=lnt id=hl-19-64><a class=lnlinks href=#hl-19-64> 64</a>
</span><span class=lnt id=hl-19-65><a class=lnlinks href=#hl-19-65> 65</a>
</span><span class=lnt id=hl-19-66><a class=lnlinks href=#hl-19-66> 66</a>
</span><span class=lnt id=hl-19-67><a class=lnlinks href=#hl-19-67> 67</a>
</span><span class=lnt id=hl-19-68><a class=lnlinks href=#hl-19-68> 68</a>
</span><span class=lnt id=hl-19-69><a class=lnlinks href=#hl-19-69> 69</a>
</span><span class=lnt id=hl-19-70><a class=lnlinks href=#hl-19-70> 70</a>
</span><span class=lnt id=hl-19-71><a class=lnlinks href=#hl-19-71> 71</a>
</span><span class=lnt id=hl-19-72><a class=lnlinks href=#hl-19-72> 72</a>
</span><span class=lnt id=hl-19-73><a class=lnlinks href=#hl-19-73> 73</a>
</span><span class=lnt id=hl-19-74><a class=lnlinks href=#hl-19-74> 74</a>
</span><span class=lnt id=hl-19-75><a class=lnlinks href=#hl-19-75> 75</a>
</span><span class=lnt id=hl-19-76><a class=lnlinks href=#hl-19-76> 76</a>
</span><span class=lnt id=hl-19-77><a class=lnlinks href=#hl-19-77> 77</a>
</span><span class=lnt id=hl-19-78><a class=lnlinks href=#hl-19-78> 78</a>
</span><span class=lnt id=hl-19-79><a class=lnlinks href=#hl-19-79> 79</a>
</span><span class=lnt id=hl-19-80><a class=lnlinks href=#hl-19-80> 80</a>
</span><span class=lnt id=hl-19-81><a class=lnlinks href=#hl-19-81> 81</a>
</span><span class=lnt id=hl-19-82><a class=lnlinks href=#hl-19-82> 82</a>
</span><span class=lnt id=hl-19-83><a class=lnlinks href=#hl-19-83> 83</a>
</span><span class=lnt id=hl-19-84><a class=lnlinks href=#hl-19-84> 84</a>
</span><span class=lnt id=hl-19-85><a class=lnlinks href=#hl-19-85> 85</a>
</span><span class=lnt id=hl-19-86><a class=lnlinks href=#hl-19-86> 86</a>
</span><span class=lnt id=hl-19-87><a class=lnlinks href=#hl-19-87> 87</a>
</span><span class=lnt id=hl-19-88><a class=lnlinks href=#hl-19-88> 88</a>
</span><span class=lnt id=hl-19-89><a class=lnlinks href=#hl-19-89> 89</a>
</span><span class=lnt id=hl-19-90><a class=lnlinks href=#hl-19-90> 90</a>
</span><span class=lnt id=hl-19-91><a class=lnlinks href=#hl-19-91> 91</a>
</span><span class=lnt id=hl-19-92><a class=lnlinks href=#hl-19-92> 92</a>
</span><span class=lnt id=hl-19-93><a class=lnlinks href=#hl-19-93> 93</a>
</span><span class=lnt id=hl-19-94><a class=lnlinks href=#hl-19-94> 94</a>
</span><span class=lnt id=hl-19-95><a class=lnlinks href=#hl-19-95> 95</a>
</span><span class=lnt id=hl-19-96><a class=lnlinks href=#hl-19-96> 96</a>
</span><span class=lnt id=hl-19-97><a class=lnlinks href=#hl-19-97> 97</a>
</span><span class=lnt id=hl-19-98><a class=lnlinks href=#hl-19-98> 98</a>
</span><span class=lnt id=hl-19-99><a class=lnlinks href=#hl-19-99> 99</a>
</span><span class=lnt id=hl-19-100><a class=lnlinks href=#hl-19-100>100</a>
</span><span class=lnt id=hl-19-101><a class=lnlinks href=#hl-19-101>101</a>
</span><span class=lnt id=hl-19-102><a class=lnlinks href=#hl-19-102>102</a>
</span><span class=lnt id=hl-19-103><a class=lnlinks href=#hl-19-103>103</a>
</span><span class=lnt id=hl-19-104><a class=lnlinks href=#hl-19-104>104</a>
</span><span class=lnt id=hl-19-105><a class=lnlinks href=#hl-19-105>105</a>
</span><span class=lnt id=hl-19-106><a class=lnlinks href=#hl-19-106>106</a>
</span><span class=lnt id=hl-19-107><a class=lnlinks href=#hl-19-107>107</a>
</span><span class=lnt id=hl-19-108><a class=lnlinks href=#hl-19-108>108</a>
</span><span class=lnt id=hl-19-109><a class=lnlinks href=#hl-19-109>109</a>
</span><span class=lnt id=hl-19-110><a class=lnlinks href=#hl-19-110>110</a>
</span><span class=lnt id=hl-19-111><a class=lnlinks href=#hl-19-111>111</a>
</span><span class=lnt id=hl-19-112><a class=lnlinks href=#hl-19-112>112</a>
</span><span class=lnt id=hl-19-113><a class=lnlinks href=#hl-19-113>113</a>
</span><span class=lnt id=hl-19-114><a class=lnlinks href=#hl-19-114>114</a>
</span><span class=lnt id=hl-19-115><a class=lnlinks href=#hl-19-115>115</a>
</span><span class=lnt id=hl-19-116><a class=lnlinks href=#hl-19-116>116</a>
</span><span class=lnt id=hl-19-117><a class=lnlinks href=#hl-19-117>117</a>
</span><span class=lnt id=hl-19-118><a class=lnlinks href=#hl-19-118>118</a>
</span><span class=lnt id=hl-19-119><a class=lnlinks href=#hl-19-119>119</a>
</span><span class=lnt id=hl-19-120><a class=lnlinks href=#hl-19-120>120</a>
</span><span class=lnt id=hl-19-121><a class=lnlinks href=#hl-19-121>121</a>
</span><span class=lnt id=hl-19-122><a class=lnlinks href=#hl-19-122>122</a>
</span><span class=lnt id=hl-19-123><a class=lnlinks href=#hl-19-123>123</a>
</span><span class=lnt id=hl-19-124><a class=lnlinks href=#hl-19-124>124</a>
</span><span class=lnt id=hl-19-125><a class=lnlinks href=#hl-19-125>125</a>
</span><span class=lnt id=hl-19-126><a class=lnlinks href=#hl-19-126>126</a>
</span><span class=lnt id=hl-19-127><a class=lnlinks href=#hl-19-127>127</a>
</span><span class=lnt id=hl-19-128><a class=lnlinks href=#hl-19-128>128</a>
</span><span class=lnt id=hl-19-129><a class=lnlinks href=#hl-19-129>129</a>
</span><span class=lnt id=hl-19-130><a class=lnlinks href=#hl-19-130>130</a>
</span><span class=lnt id=hl-19-131><a class=lnlinks href=#hl-19-131>131</a>
</span><span class=lnt id=hl-19-132><a class=lnlinks href=#hl-19-132>132</a>
</span><span class=lnt id=hl-19-133><a class=lnlinks href=#hl-19-133>133</a>
</span><span class=lnt id=hl-19-134><a class=lnlinks href=#hl-19-134>134</a>
</span><span class=lnt id=hl-19-135><a class=lnlinks href=#hl-19-135>135</a>
</span><span class=lnt id=hl-19-136><a class=lnlinks href=#hl-19-136>136</a>
</span><span class=lnt id=hl-19-137><a class=lnlinks href=#hl-19-137>137</a>
</span><span class=lnt id=hl-19-138><a class=lnlinks href=#hl-19-138>138</a>
</span><span class=lnt id=hl-19-139><a class=lnlinks href=#hl-19-139>139</a>
</span><span class=lnt id=hl-19-140><a class=lnlinks href=#hl-19-140>140</a>
</span><span class=lnt id=hl-19-141><a class=lnlinks href=#hl-19-141>141</a>
</span><span class=lnt id=hl-19-142><a class=lnlinks href=#hl-19-142>142</a>
</span><span class=lnt id=hl-19-143><a class=lnlinks href=#hl-19-143>143</a>
</span><span class=lnt id=hl-19-144><a class=lnlinks href=#hl-19-144>144</a>
</span><span class=lnt id=hl-19-145><a class=lnlinks href=#hl-19-145>145</a>
</span><span class=lnt id=hl-19-146><a class=lnlinks href=#hl-19-146>146</a>
</span><span class=lnt id=hl-19-147><a class=lnlinks href=#hl-19-147>147</a>
</span><span class=lnt id=hl-19-148><a class=lnlinks href=#hl-19-148>148</a>
</span><span class=lnt id=hl-19-149><a class=lnlinks href=#hl-19-149>149</a>
</span><span class=lnt id=hl-19-150><a class=lnlinks href=#hl-19-150>150</a>
</span><span class=lnt id=hl-19-151><a class=lnlinks href=#hl-19-151>151</a>
</span><span class=lnt id=hl-19-152><a class=lnlinks href=#hl-19-152>152</a>
</span><span class=lnt id=hl-19-153><a class=lnlinks href=#hl-19-153>153</a>
</span><span class=lnt id=hl-19-154><a class=lnlinks href=#hl-19-154>154</a>
</span><span class=lnt id=hl-19-155><a class=lnlinks href=#hl-19-155>155</a>
</span><span class=lnt id=hl-19-156><a class=lnlinks href=#hl-19-156>156</a>
</span><span class=lnt id=hl-19-157><a class=lnlinks href=#hl-19-157>157</a>
</span><span class=lnt id=hl-19-158><a class=lnlinks href=#hl-19-158>158</a>
</span><span class=lnt id=hl-19-159><a class=lnlinks href=#hl-19-159>159</a>
</span><span class=lnt id=hl-19-160><a class=lnlinks href=#hl-19-160>160</a>
</span><span class=lnt id=hl-19-161><a class=lnlinks href=#hl-19-161>161</a>
</span><span class=lnt id=hl-19-162><a class=lnlinks href=#hl-19-162>162</a>
</span><span class=lnt id=hl-19-163><a class=lnlinks href=#hl-19-163>163</a>
</span><span class=lnt id=hl-19-164><a class=lnlinks href=#hl-19-164>164</a>
</span><span class=lnt id=hl-19-165><a class=lnlinks href=#hl-19-165>165</a>
</span><span class=lnt id=hl-19-166><a class=lnlinks href=#hl-19-166>166</a>
</span><span class=lnt id=hl-19-167><a class=lnlinks href=#hl-19-167>167</a>
</span><span class=lnt id=hl-19-168><a class=lnlinks href=#hl-19-168>168</a>
</span><span class=lnt id=hl-19-169><a class=lnlinks href=#hl-19-169>169</a>
</span><span class=lnt id=hl-19-170><a class=lnlinks href=#hl-19-170>170</a>
</span><span class=lnt id=hl-19-171><a class=lnlinks href=#hl-19-171>171</a>
</span><span class=lnt id=hl-19-172><a class=lnlinks href=#hl-19-172>172</a>
</span><span class=lnt id=hl-19-173><a class=lnlinks href=#hl-19-173>173</a>
</span><span class=lnt id=hl-19-174><a class=lnlinks href=#hl-19-174>174</a>
</span><span class=lnt id=hl-19-175><a class=lnlinks href=#hl-19-175>175</a>
</span><span class=lnt id=hl-19-176><a class=lnlinks href=#hl-19-176>176</a>
</span><span class=lnt id=hl-19-177><a class=lnlinks href=#hl-19-177>177</a>
</span><span class=lnt id=hl-19-178><a class=lnlinks href=#hl-19-178>178</a>
</span><span class=lnt id=hl-19-179><a class=lnlinks href=#hl-19-179>179</a>
</span><span class=lnt id=hl-19-180><a class=lnlinks href=#hl-19-180>180</a>
</span><span class=lnt id=hl-19-181><a class=lnlinks href=#hl-19-181>181</a>
</span><span class=lnt id=hl-19-182><a class=lnlinks href=#hl-19-182>182</a>
</span><span class=lnt id=hl-19-183><a class=lnlinks href=#hl-19-183>183</a>
</span><span class=lnt id=hl-19-184><a class=lnlinks href=#hl-19-184>184</a>
</span><span class=lnt id=hl-19-185><a class=lnlinks href=#hl-19-185>185</a>
</span><span class=lnt id=hl-19-186><a class=lnlinks href=#hl-19-186>186</a>
</span><span class=lnt id=hl-19-187><a class=lnlinks href=#hl-19-187>187</a>
</span><span class=lnt id=hl-19-188><a class=lnlinks href=#hl-19-188>188</a>
</span><span class=lnt id=hl-19-189><a class=lnlinks href=#hl-19-189>189</a>
</span><span class=lnt id=hl-19-190><a class=lnlinks href=#hl-19-190>190</a>
</span><span class=lnt id=hl-19-191><a class=lnlinks href=#hl-19-191>191</a>
</span><span class=lnt id=hl-19-192><a class=lnlinks href=#hl-19-192>192</a>
</span><span class=lnt id=hl-19-193><a class=lnlinks href=#hl-19-193>193</a>
</span><span class=lnt id=hl-19-194><a class=lnlinks href=#hl-19-194>194</a>
</span><span class=lnt id=hl-19-195><a class=lnlinks href=#hl-19-195>195</a>
</span><span class=lnt id=hl-19-196><a class=lnlinks href=#hl-19-196>196</a>
</span><span class=lnt id=hl-19-197><a class=lnlinks href=#hl-19-197>197</a>
</span><span class=lnt id=hl-19-198><a class=lnlinks href=#hl-19-198>198</a>
</span><span class=lnt id=hl-19-199><a class=lnlinks href=#hl-19-199>199</a>
</span><span class=lnt id=hl-19-200><a class=lnlinks href=#hl-19-200>200</a>
</span><span class=lnt id=hl-19-201><a class=lnlinks href=#hl-19-201>201</a>
</span><span class=lnt id=hl-19-202><a class=lnlinks href=#hl-19-202>202</a>
</span><span class=lnt id=hl-19-203><a class=lnlinks href=#hl-19-203>203</a>
</span><span class=lnt id=hl-19-204><a class=lnlinks href=#hl-19-204>204</a>
</span><span class=lnt id=hl-19-205><a class=lnlinks href=#hl-19-205>205</a>
</span><span class=lnt id=hl-19-206><a class=lnlinks href=#hl-19-206>206</a>
</span><span class=lnt id=hl-19-207><a class=lnlinks href=#hl-19-207>207</a>
</span><span class=lnt id=hl-19-208><a class=lnlinks href=#hl-19-208>208</a>
</span><span class=lnt id=hl-19-209><a class=lnlinks href=#hl-19-209>209</a>
</span><span class=lnt id=hl-19-210><a class=lnlinks href=#hl-19-210>210</a>
</span><span class=lnt id=hl-19-211><a class=lnlinks href=#hl-19-211>211</a>
</span><span class=lnt id=hl-19-212><a class=lnlinks href=#hl-19-212>212</a>
</span><span class=lnt id=hl-19-213><a class=lnlinks href=#hl-19-213>213</a>
</span><span class=lnt id=hl-19-214><a class=lnlinks href=#hl-19-214>214</a>
</span><span class=lnt id=hl-19-215><a class=lnlinks href=#hl-19-215>215</a>
</span><span class=lnt id=hl-19-216><a class=lnlinks href=#hl-19-216>216</a>
</span><span class=lnt id=hl-19-217><a class=lnlinks href=#hl-19-217>217</a>
</span><span class=lnt id=hl-19-218><a class=lnlinks href=#hl-19-218>218</a>
</span><span class=lnt id=hl-19-219><a class=lnlinks href=#hl-19-219>219</a>
</span><span class=lnt id=hl-19-220><a class=lnlinks href=#hl-19-220>220</a>
</span><span class=lnt id=hl-19-221><a class=lnlinks href=#hl-19-221>221</a>
</span><span class=lnt id=hl-19-222><a class=lnlinks href=#hl-19-222>222</a>
</span><span class=lnt id=hl-19-223><a class=lnlinks href=#hl-19-223>223</a>
</span><span class=lnt id=hl-19-224><a class=lnlinks href=#hl-19-224>224</a>
</span><span class=lnt id=hl-19-225><a class=lnlinks href=#hl-19-225>225</a>
</span><span class=lnt id=hl-19-226><a class=lnlinks href=#hl-19-226>226</a>
</span><span class=lnt id=hl-19-227><a class=lnlinks href=#hl-19-227>227</a>
</span><span class=lnt id=hl-19-228><a class=lnlinks href=#hl-19-228>228</a>
</span><span class=lnt id=hl-19-229><a class=lnlinks href=#hl-19-229>229</a>
</span><span class=lnt id=hl-19-230><a class=lnlinks href=#hl-19-230>230</a>
</span><span class=lnt id=hl-19-231><a class=lnlinks href=#hl-19-231>231</a>
</span><span class=lnt id=hl-19-232><a class=lnlinks href=#hl-19-232>232</a>
</span><span class=lnt id=hl-19-233><a class=lnlinks href=#hl-19-233>233</a>
</span><span class=lnt id=hl-19-234><a class=lnlinks href=#hl-19-234>234</a>
</span><span class=lnt id=hl-19-235><a class=lnlinks href=#hl-19-235>235</a>
</span><span class=lnt id=hl-19-236><a class=lnlinks href=#hl-19-236>236</a>
</span><span class=lnt id=hl-19-237><a class=lnlinks href=#hl-19-237>237</a>
</span><span class=lnt id=hl-19-238><a class=lnlinks href=#hl-19-238>238</a>
</span><span class=lnt id=hl-19-239><a class=lnlinks href=#hl-19-239>239</a>
</span><span class=lnt id=hl-19-240><a class=lnlinks href=#hl-19-240>240</a>
</span><span class=lnt id=hl-19-241><a class=lnlinks href=#hl-19-241>241</a>
</span><span class=lnt id=hl-19-242><a class=lnlinks href=#hl-19-242>242</a>
</span><span class=lnt id=hl-19-243><a class=lnlinks href=#hl-19-243>243</a>
</span><span class=lnt id=hl-19-244><a class=lnlinks href=#hl-19-244>244</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># CQRS 패턴을 활용한 전자상거래 주문 시스템</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 도메인 이벤트</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DomainEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 명령 (Commands)</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CreateOrderCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UpdateInventoryCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 쿼리 (Queries)</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrderHistoryQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SearchProductsQuery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 스토어</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>callable</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>subscriber</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>subscriber</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>e</span> <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>==</span> <span class=n>aggregate_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>handler</span><span class=p>:</span> <span class=n>callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscribers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애그리게이트 루트</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;PENDING&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=s2>&#34;PENDING&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order already created&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>customer_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;CREATED&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>DomainEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event_id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;total_amount&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_amount</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>version</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_uncommitted_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mark_events_as_committed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 명령 핸들러</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Order</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>command</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>save_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>mark_events_as_committed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 읽기 모델</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderView</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProductView</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>category</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>inventory</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 조회 핸들러</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_views</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderView</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_get_order_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>GetOrderHistoryQuery</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderView</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>order</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_views</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>order</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>==</span> <span class=n>query</span><span class=o>.</span><span class=n>customer_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_order_view</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order_view</span> <span class=o>=</span> <span class=n>OrderView</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nb>id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>customer_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;customer_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>items</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>total_amount</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;total_amount&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span><span class=o>=</span><span class=s2>&#34;CREATED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>created_at</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>order_views</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>order_view</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProductQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ProductView</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=c1># 초기 상품 데이터</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>ProductView</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;노트북&#34;</span><span class=p>,</span> <span class=mi>1500000</span><span class=p>,</span> <span class=s2>&#34;전자제품&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=s2>&#34;고성능 노트북&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>ProductView</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=s2>&#34;마우스&#34;</span><span class=p>,</span> <span class=mi>50000</span><span class=p>,</span> <span class=s2>&#34;전자제품&#34;</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=s2>&#34;무선 마우스&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_search_products</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>SearchProductsQuery</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>ProductView</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>query</span><span class=o>.</span><span class=n>keyword</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>results</span> <span class=k>if</span> <span class=n>query</span><span class=o>.</span><span class=n>keyword</span> <span class=ow>in</span> <span class=n>p</span><span class=o>.</span><span class=n>name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>query</span><span class=o>.</span><span class=n>category</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>results</span> <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>category</span> <span class=o>==</span> <span class=n>query</span><span class=o>.</span><span class=n>category</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>product_id</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>quantity</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>product</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_views</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>product</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>product_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>product</span><span class=o>.</span><span class=n>inventory</span> <span class=o>-=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CQRS 시스템 조합</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CQRSSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>product_query_handler</span> <span class=o>=</span> <span class=n>ProductQueryHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 구독 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_query_handler</span><span class=o>.</span><span class=n>update_order_view</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>product_query_handler</span><span class=o>.</span><span class=n>update_inventory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>execute_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=n>CreateOrderCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_command_handler</span><span class=o>.</span><span class=n>handle_create_order</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>execute_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>GetOrderHistoryQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_query_handler</span><span class=o>.</span><span class=n>handle_get_order_history</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>SearchProductsQuery</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_query_handler</span><span class=o>.</span><span class=n>handle_search_products</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>cqrs_system</span> <span class=o>=</span> <span class=n>CQRSSystem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 명령 실행: 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>create_order_cmd</span> <span class=o>=</span> <span class=n>CreateOrderCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=s2>&#34;customer_123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;노트북&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>1500000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;마우스&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>50000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cqrs_system</span><span class=o>.</span><span class=n>execute_command</span><span class=p>(</span><span class=n>create_order_cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 생성됨: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 조회 실행: 주문 이력 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>order_history_query</span> <span class=o>=</span> <span class=n>GetOrderHistoryQuery</span><span class=p>(</span><span class=n>customer_id</span><span class=o>=</span><span class=s2>&#34;customer_123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_history</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cqrs_system</span><span class=o>.</span><span class=n>execute_query</span><span class=p>(</span><span class=n>order_history_query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 이력: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>order_history</span><span class=p>)</span><span class=si>}</span><span class=s2>건&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=n>order_history</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  - 주문 ID: </span><span class=si>{</span><span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>, 총액: </span><span class=si>{</span><span class=n>order</span><span class=o>.</span><span class=n>total_amount</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 조회 실행: 상품 검색</span>
</span></span><span class=line><span class=cl>    <span class=n>product_search_query</span> <span class=o>=</span> <span class=n>SearchProductsQuery</span><span class=p>(</span><span class=n>keyword</span><span class=o>=</span><span class=s2>&#34;노트북&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>products</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cqrs_system</span><span class=o>.</span><span class=n>execute_query</span><span class=p>(</span><span class=n>product_search_query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;상품 검색 결과: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>products</span><span class=p>)</span><span class=si>}</span><span class=s2>건&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>product</span> <span class=ow>in</span> <span class=n>products</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  - </span><span class=si>{</span><span class=n>product</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>product</span><span class=o>.</span><span class=n>inventory</span><span class=si>}</span><span class=s2>개 남음&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>20. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>영역</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>충분히 복잡한 도메인에서만 적용</td><td>단순한 CRUD에는 과도한 복잡성</td><td>도메인 복잡성 평가 후 결정</td></tr><tr><td>팀 역량</td><td>이벤트 기반 아키텍처 이해 필요</td><td>학습 곡선으로 인한 초기 생산성 저하</td><td>점진적 도입과 교육 병행</td></tr><tr><td>인프라 준비</td><td>메시징, 모니터링 인프라 필요</td><td>운영 복잡성 증가</td><td>클라우드 관리형 서비스 활용</td></tr><tr><td>경계 설정</td><td>명확한 바운디드 컨텍스트 정의</td><td>불명확한 경계로 인한 복잡성</td><td>DDD 원칙에 따른 설계</td></tr><tr><td>테스트 전략</td><td>비동기 처리에 대한 테스트</td><td>테스트 복잡성 증가</td><td>계약 테스트와 통합 테스트</td></tr></tbody></table><h2 id=21-최적화하기-위한-고려사항-및-주의할-점>21. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#21-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>영역</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td>성능 최적화</td><td>읽기 모델 캐싱 전략</td><td>캐시 무효화 복잡성</td><td>Redis, CDN 활용</td></tr><tr><td>동기화 최적화</td><td>이벤트 처리 배치화</td><td>메모리 사용량 증가</td><td>적절한 배치 크기 설정</td></tr><tr><td>저장소 최적화</td><td>읽기/쓰기에 적합한 DB 선택</td><td>다중 DB 관리 복잡성</td><td>폴리글랏 퍼시스턴스 적용</td></tr><tr><td>스케일링</td><td>독립적인 수평 확장</td><td>데이터 분산으로 인한 복잡성</td><td>파티셔닝 전략 수립</td></tr><tr><td>모니터링</td><td>분산 시스템 추적</td><td>장애 지점 파악 어려움</td><td>APM 도구 도입</td></tr></tbody></table><hr><h2 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>DDD</td><td>Aggregate Pattern</td><td>CQRS와 함께 사용되는 도메인 모델 패턴</td></tr><tr><td>설계 패턴</td><td>Event Sourcing</td><td>Event Store</td><td>모든 상태 변경을 이벤트로 저장하는 방식</td></tr><tr><td>아키텍처</td><td>Microservices</td><td>Service Mesh</td><td>CQRS 구현에 필요한 서비스 간 통신</td></tr><tr><td>기술 스택</td><td>Message Queue</td><td>Apache Kafka</td><td>이벤트 스트리밍 플랫폼</td></tr><tr><td>기술 스택</td><td>Database</td><td>Polyglot Persistence</td><td>읽기/쓰기에 다른 DB 사용</td></tr><tr><td>운영</td><td>Monitoring</td><td>Distributed Tracing</td><td>분산 시스템 추적 및 모니터링</td></tr></tbody></table><h2 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>이론 기초</td><td>CQS</td><td>Command Query Separation</td><td>CQRS의 기반이 되는 기본 원칙</td></tr><tr><td>설계 원칙</td><td>DDD</td><td>Domain Driven Design</td><td>복잡한 도메인 모델링 방법론</td></tr><tr><td>아키텍처 패턴</td><td>Event Sourcing</td><td>이벤트 기반 상태 관리</td><td>CQRS와 자주 결합되는 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Saga Pattern</td><td>분산 트랜잭션 관리</td><td>마이크로서비스에서의 일관성 보장</td></tr><tr><td>기술 구현</td><td>Event Bus</td><td>비동기 메시징</td><td>이벤트 기반 통신 메커니즘</td></tr><tr><td>운영 관리</td><td>Eventually Consistency</td><td>최종 일관성</td><td>분산 시스템의 일관성 모델</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>Command</td><td>시스템의 상태를 변경하는 요청이나 작업</td></tr><tr><td>기본 개념</td><td>Query</td><td>시스템의 상태를 조회하는 요청이나 작업</td></tr><tr><td>기본 개념</td><td>Aggregate</td><td>DDD에서 일관성 경계를 나타내는 도메인 객체 집합</td></tr><tr><td>기본 개념</td><td>Projection</td><td>이벤트 스트림에서 읽기 모델을 생성하는 과정</td></tr><tr><td>기본 개념</td><td>Event Store</td><td>도메인 이벤트를 시간순으로 저장하는 저장소</td></tr><tr><td>기본 개념</td><td>Saga</td><td>분산 시스템에서 장기 실행 비즈니스 프로세스</td></tr><tr><td>기술 구현</td><td>Event Bus</td><td>이벤트의 발행과 구독을 관리하는 메시징 시스템</td></tr><tr><td>기술 구현</td><td>Denormalizer</td><td>정규화된 데이터를 읽기에 최적화된 형태로 변환</td></tr><tr><td>기술 구현</td><td>Snapshot</td><td>특정 시점의 애그리게이트 상태를 저장한 것</td></tr><tr><td>기술 구현</td><td>Polyglot Persistence</td><td>서로 다른 종류의 데이터베이스를 적절히 조합하여 사용</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>Microsoft Azure - CQRS Pattern</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>AWS Prescriptive Guidance - CQRS Pattern</a></li><li><a href=https://www.martinfowler.com/bliki/CQRS.html>Martin Fowler - CQRS</a></li><li><a href=https://www.confluent.io/learn/cqrs/>Confluent - CQRS 학습 가이드</a></li><li><a href=https://www.geeksforgeeks.org/cqrs-command-query-responsibility-segregation/>GeeksforGeeks - CQRS 디자인 패턴</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>Kurrent - CQRS 패턴 가이드</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>TechTarget - CQRS 정의</a></li><li><a href=https://microservices.io/patterns/data/cqrs.html>Microservices.io - CQRS 패턴</a></li><li><a href=https://www.redhat.com/architect/pros-and-cons-cqrs>Red Hat - CQRS 장단점</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>Baeldung - Java에서 CQRS와 Event Sourcing</a></li><li><a href=https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture>Upsolver - CQRS와 Event Sourcing 패턴</a></li><li><a href=https://dzone.com/articles/microservices-with-cqrs-and-event-sourcing>DZone - 마이크로서비스에서 CQRS와 Event Sourcing</a></li><li><a href=https://blog.risingstack.com/cqrs-explained-node-js-at-scale/>RisingStack - CQRS 설명</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>System Design School - CQRS 패턴</a></li></ul><hr><h2 id=1-태그-2>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-2>#</a></h2><ul><li><strong>CQRS-Pattern</strong></li><li><strong>Command-Query-Separation</strong></li><li><strong>Event-Sourcing</strong></li><li><strong>Scalable-Architecture</strong></li></ul><hr><h2 id=2-분류-구조-분석>2. 분류 구조 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석>#</a></h2><p><strong>계층 구조:</strong><br>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Styles and Patterns > Architecture Patterns > Data Management</p><p><strong>분석 및 근거:</strong><br>CQRS는 소프트웨어 아키텍처 패턴으로, 데이터 읽기(Query)와 쓰기(Command) 작업을 분리하여 각각 최적화된 모델로 처리하는 설계 원칙입니다. 이는 “Architecture Styles and Patterns” 하위의 “Architecture Patterns”에 적합하게 분류되며, 데이터 관리(Data Management)와도 밀접하게 연관되어 있으므로 하위로 포함하는 것이 타당합니다. 실제로 CQRS는 도메인 주도 설계(DDD), 이벤트 소싱(Event Sourcing)과 함께 사용되어 데이터 처리와 확장성, 유지보수성을 높이는 데 활용됩니다<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">1</a><a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">3</a>.</p><hr><h2 id=3-요약200자-내외>3. 요약(200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약200자-내외>#</a></h2><p>CQRS는 데이터 읽기와 쓰기 작업을 분리해 각각의 모델과 저장소로 처리함으로써 성능, 확장성, 유지보수성을 높이는 소프트웨어 아키텍처 패턴이다<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">1</a><a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">2</a>.</p><hr><h2 id=4-개요250자-내외>4. 개요(250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요250자-내외>#</a></h2><p>CQRS는 애플리케이션의 데이터 읽기(Query)와 쓰기(Command) 작업을 별도의 모델과 저장소로 분리하여, 각 작업에 최적화된 처리와 독립적 확장이 가능하도록 설계하는 아키텍처 패턴이다. 이를 통해 복잡한 도메인에서 성능, 확장성, 유지보수성을 크게 향상시킬 수 있다<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">1</a><a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">2</a>.</p><hr><h2 id=5-핵심-개념-2>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-2>#</a></h2><ul><li><strong>명령(Command):</strong> 시스템의 상태를 변경하는 작업(예: 생성, 수정, 삭제).</li><li><strong>쿼리(Query):</strong> 시스템의 상태를 변경하지 않고 데이터를 조회하는 작업.</li><li><strong>책임 분리:</strong> 읽기와 쓰기 작업을 완전히 분리하여 각각의 모델과 저장소를 사용.</li><li><strong>독립적 최적화:</strong> 읽기와 쓰기 모델을 각각의 목적에 맞게 최적화.</li><li><strong>이벤트 소싱:</strong> 상태 변경 이벤트를 저장하여 복원 및 감사, 도메인 모델링에 활용 가능.</li></ul><p><strong>실무 구현 요소</strong></p><ul><li><strong>Command Handler:</strong> 명령을 처리하는 핸들러.</li><li><strong>Query Handler:</strong> 쿼리를 처리하는 핸들러.</li><li><strong>Command Model:</strong> 쓰기 작업에 최적화된 데이터 모델.</li><li><strong>Query Model:</strong> 읽기 작업에 최적화된 데이터 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트를 저장하는 저장소(선택).</li><li><strong>Synchronization Mechanism:</strong> Command와 Query 모델 간 데이터 동기화(필요 시).</li></ul><hr><h2 id=6-조사-내용주요-항목별-정리>6. 조사 내용(주요 항목별 정리)<a hidden class=anchor aria-hidden=true href=#6-조사-내용주요-항목별-정리>#</a></h2><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>CQRS는 기존 CRUD 기반 아키텍처에서 복잡성이 증가하고, 읽기와 쓰기 작업의 요구사항이 달라지면서 각각의 작업에 최적화된 처리가 필요해진 데서 등장했습니다. 이로 인해 유지보수성, 확장성, 성능 문제가 해결되고 있습니다<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">5</a><a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">6</a>.</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li><strong>성능 및 확장성:</strong> 읽기와 쓰기 작업을 독립적으로 확장 및 최적화.</li><li><strong>복잡성 관리:</strong> 도메인 복잡성 증가 시 유지보수성 향상.</li><li><strong>보안:</strong> 읽기와 쓰기 권한을 분리하여 보안 강화<a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">1</a><a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">4</a>.</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li><strong>Command Side:</strong> 데이터 생성, 수정, 삭제.</li><li><strong>Query Side:</strong> 데이터 조회.</li><li><strong>Event Sourcing:</strong> 상태 변경 이벤트 저장 및 재생(선택).</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>읽기/쓰기 분리:</strong> 각각의 모델과 저장소 사용.</li><li><strong>독립적 확장:</strong> 읽기와 쓰기 작업을 독립적으로 확장.</li><li><strong>이벤트 기반:</strong> 상태 변경 이벤트 저장 및 활용(선택).</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ul><li><strong>단일 책임:</strong> 명령(Command)과 쿼리(Query)는 각각 단일 책임.</li><li><strong>독립적 최적화:</strong> 읽기와 쓰기 모델을 각각 최적화.</li><li><strong>이벤트 기반:</strong> 상태 변경 이벤트 저장 및 활용(선택)<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">8</a><a href="https://dev.to/gabrielsadaka/vertical-slice-event-driven-architecture-with-net-core-and-kafka-2ad2?utm_source=chatgpt.com" title="A simpler approach to building event driven software using .NET ...">10</a>.</li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Diagram: CQRS Architecture]
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│  CLIENTS    │ → │ COMMAND API │ → │ WRITE MODEL │
</span></span><span class=line><span class=cl>│             │   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>│ APPLICATION │ ← │  QUERY API  │ ← │ READ MODEL  │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(Optional: Event Store for Command side)
</span></span></code></pre></td></tr></table></div></div><p>읽기와 쓰기 작업이 완전히 분리되어 있으며, 명령은 쓰기 모델에, 쿼리는 읽기 모델에 접근합니다. 필요 시 이벤트 소싱을 통해 상태 변경 이벤트를 저장하고 재생할 수 있습니다<a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">2</a><a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">11</a>.</p><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><ul><li><strong>Command Side:</strong> 명령 처리, 쓰기 모델, 이벤트 저장(선택).</li><li><strong>Query Side:</strong> 쿼리 처리, 읽기 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트 저장(선택).</li><li><strong>Synchronization Mechanism:</strong> Command와 Query 모델 간 데이터 동기화(필요 시).</li></ul><p><strong>각 구성요소의 기능과 역할</strong></p><ul><li><strong>Command Handler:</strong> 명령을 받아 처리하고, 쓰기 모델에 반영.</li><li><strong>Query Handler:</strong> 쿼리를 받아 읽기 모델에서 데이터 조회.</li><li><strong>Write Model:</strong> 데이터 생성, 수정, 삭제에 최적화된 모델.</li><li><strong>Read Model:</strong> 데이터 조회에 최적화된 모델.</li><li><strong>Event Store:</strong> 상태 변경 이벤트 저장(선택, 이벤트 소싱 사용 시).</li><li><strong>Synchronization Mechanism:</strong> 쓰기 모델의 변경을 읽기 모델에 반영(필요 시).</li></ul><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><ul><li><strong>분리된 모델:</strong> 읽기와 쓰기 모델을 완전히 분리.</li><li><strong>이벤트 소싱:</strong> 상태 변경 이벤트를 저장하여 재생 및 감사 가능.</li><li><strong>메시지 큐/브로커:</strong> 명령 처리 결과를 이벤트로 발행, 읽기 모델에 반영.</li><li><strong>독립적 저장소:</strong> 읽기와 쓰기 모델에 각각 최적화된 저장소 사용.</li><li><strong>동기화:</strong> 쓰기 모델의 변경을 읽기 모델에 반영하는 동기화 메커니즘 구현.</li></ul><p><strong>실제 예시(시나리오):</strong></p><ul><li><strong>쓰기:</strong> 주문 생성 명령 → Command Handler → Write Model(주문 저장) → Event Store(주문 생성 이벤트 저장) → Message Queue(이벤트 발행).</li><li><strong>읽기:</strong> 주문 조회 쿼리 → Query Handler → Read Model(주문 조회).</li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 원인</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>읽기와 쓰기 작업을 독립적으로 확장 가능</td><td>읽기/쓰기 분리</td></tr><tr><td>장점</td><td>성능</td><td>각 작업에 최적화된 모델과 저장소 사용</td><td>독립적 최적화</td></tr><tr><td>장점</td><td>유지보수성</td><td>코드가 분리되어 유지보수 용이</td><td>책임 분리</td></tr><tr><td>장점</td><td>보안</td><td>읽기와 쓰기 권한 분리로 보안 강화</td><td>책임 분리</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>시스템 구성이 복잡해짐</td><td>경험 축적, 문서화</td></tr><tr><td>단점</td><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 데이터 불일치 가능</td><td>동기화 메커니즘, 이벤트 기반 처리</td></tr></tbody></table><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데이터 불일치</td><td>동기화 지연, 이벤트 처리 실패</td><td>사용자 경험 저하</td><td>모니터링, 로그 분석</td><td>이벤트 처리 신뢰성 강화</td><td>이벤트 재처리, 동기화 메커니즘 강화</td></tr><tr><td>문제점</td><td>과도한 복잡성</td><td>불필요한 CQRS 적용</td><td>개발 및 유지보수 비용 증가</td><td>코드 리뷰, 아키텍처 리뷰</td><td>CQRS 필요성 평가</td><td>CRUD로 복귀, 도메인 단위로 CQRS 적용</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>도전 과제</td><td>대규모 시스템 적용</td><td>동기화 및 이벤트 처리 복잡성</td><td>시스템 안정성 저하</td><td>모니터링, 테스트</td><td>모듈화, 마이크로서비스 전환</td><td>이벤트 기반 아키텍처, 분산 트랜잭션 관리</td></tr><tr><td>도전 과제</td><td>팀 온보딩 및 코드 관리</td><td>아키텍처 복잡성, 팀원 이해 부족</td><td>개발 비용 증가, 일관성 저하</td><td>코드 리뷰, 문서화</td><td>교육, 예시 코드 제공</td><td>문서화, 코드 리뷰, 멘토링</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th></tr></thead><tbody><tr><td>분리 수준</td><td>클래스 분리</td><td>읽기와 쓰기 클래스만 분리</td></tr><tr><td>분리 수준</td><td>모델 분리</td><td>읽기와 쓰기 모델 분리</td></tr><tr><td>분리 수준</td><td>저장소 분리</td><td>읽기와 쓰기 저장소 분리(진정한 CQRS)</td></tr><tr><td>적용 범위</td><td>전체 시스템</td><td>시스템 전체에 CQRS 적용</td></tr><tr><td>적용 범위</td><td>도메인 단위</td><td>특정 도메인에만 CQRS 적용</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td>확장성</td><td>Spring, Node.js, Kafka</td><td>읽기와 쓰기 독립적 확장</td></tr><tr><td>성능</td><td>Redis, MongoDB, PostgreSQL</td><td>각 작업에 최적화된 저장소 사용</td></tr><tr><td>유지보수성</td><td>DDD, Event Sourcing</td><td>코드 분리로 유지보수성 향상</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><p><strong>RisingStack Node.js 모니터링 툴:</strong><br>CQRS를 적용해 데이터 수집(Command)과 데이터 시각화(Query)를 분리.</p><ul><li><strong>시스템 구성:</strong><ul><li>Command Side: 데이터 수집 API, 메시지 큐, 작업자(Worker), 쓰기 모델(데이터베이스)</li><li>Query Side: 읽기 모델(데이터베이스 복제본), 시각화 API</li></ul></li><li><strong>Workflow:</strong><ul><li>데이터 수집 → Command API → 메시지 큐 → 작업자 → 쓰기 모델</li><li>데이터 시각화 → Query API → 읽기 모델</li></ul></li><li><strong>역할:</strong><ul><li>Command Side: 데이터 수집 및 저장</li><li>Query Side: 데이터 조회 및 시각화</li></ul></li><li><strong>차이점:</strong><ul><li>기존 CRUD 방식은 읽기와 쓰기 작업이 동일 모델과 저장소에서 처리되어 성능 병목 및 복잡성 증가.</li><li>CQRS는 읽기와 쓰기를 분리해 각각 최적화되어 성능과 확장성 향상<a href="https://vikasrohit.medium.com/handling-eventual-consistency-in-cqrs-6481b2e9138c?utm_source=chatgpt.com" title="Handling Eventual Consistency in CQRS | by Vikas Agarwal - Medium">12</a>.</li></ul></li></ul><h3 id=구현-예시-python>구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Command Side</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Validate and process command</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=s2>&#34;order_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Side</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>read_model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span> <span class=o>=</span> <span class=n>read_model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_model</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Usage</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>read_model</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>OrderCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>query_handler</span> <span class=o>=</span> <span class=n>OrderQueryHandler</span><span class=p>(</span><span class=n>read_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>order_id</span> <span class=o>=</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>create_order</span><span class=p>({</span><span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;Laptop&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>  <span class=c1># None (initially, read model is not synced)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Simulate event processing to update read model</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;OrderCreated&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>read_model</span><span class=p>[</span><span class=n>event</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>query_handler</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>  <span class=c1># {&#39;product&#39;: &#39;Laptop&#39;, &#39;quantity&#39;: 1}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에만 적용</td><td>CRUD로 충분한 경우 CQRS 적용 지양</td></tr><tr><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 동기화 필수</td><td>이벤트 기반 동기화, 신뢰성 강화</td></tr><tr><td>이벤트 처리</td><td>이벤트 처리 실패 시 복구 필요</td><td>이벤트 재처리, 장애 복구 메커니즘</td></tr><tr><td>문서화</td><td>아키텍처 및 코드 문서화</td><td>문서화, 예시 코드 제공</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>저장소 선택</td><td>읽기와 쓰기 모델에 최적화된 저장소 사용</td><td>Redis, MongoDB, PostgreSQL 등 상황에 맞는 저장소 선택</td></tr><tr><td>캐싱</td><td>읽기 모델에 캐싱 적용</td><td>캐싱 전략 적용</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 시 성능 고려</td><td>이벤트 배치 처리, 스트리밍 처리</td></tr><tr><td>모니터링</td><td>데이터 동기화 및 이벤트 처리 모니터링</td><td>모니터링, 로그 분석</td></tr></tbody></table><h3 id=기타-사항>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항>#</a></h3><ul><li><strong>이벤트 소싱과의 연계:</strong> CQRS는 이벤트 소싱과 함께 사용될 때 가장 큰 효과를 발휘합니다. 상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용할 수 있습니다<a href="https://wiki.softheon.com/Wiki/softheon/article/8557?utm_source=chatgpt.com" title="Microservices Architecture with CQRS, Clean ... - Softheon Wiki">8</a><a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">11</a>.</li><li><strong>마이크로서비스와의 연계:</strong> CQRS는 마이크로서비스 환경에서 각 서비스의 독립적 확장과 유지보수성 향상에 유리합니다[8][14].</li><li><strong>적용 범위:</strong> 전체 시스템이 아닌, 복잡한 도메인이나 확장성이 중요한 부분에만 적용하는 것이 바람직합니다[15][16].</li></ul><hr><h2 id=7-추가-조사-내용-1>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용-1>#</a></h2><ul><li><strong>CQRS와 CRUD 비교:</strong><ul><li><strong>CRUD:</strong> 읽기와 쓰기 작업이 동일 모델과 저장소에서 처리. 단순하지만 복잡한 도메인에서는 성능 및 확장성 문제 발생.</li><li><strong>CQRS:</strong> 읽기와 쓰기 작업을 분리하여 각각 최적화. 복잡한 도메인, 대규모 시스템에 적합<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">1</a><a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">2</a>.</li></ul></li><li><strong>이벤트 소싱:</strong><ul><li>상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용.</li><li>CQRS와 함께 사용 시 시스템의 유연성과 확장성 극대화<a href="https://wiki.softheon.com/Wiki/softheon/article/8557?utm_source=chatgpt.com" title="Microservices Architecture with CQRS, Clean ... - Softheon Wiki">8</a><a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">11</a>.</li></ul></li><li><strong>적용 범위:</strong><ul><li>전체 시스템이 아닌, 복잡한 도메인이나 확장성이 중요한 부분에만 적용.</li><li>도메인 주도 설계(DDD)와 함께 사용 시 효과적[15][16][14].</li></ul></li></ul><hr><h2 id=8-주목할-내용>8. 주목할 내용<a hidden class=anchor aria-hidden=true href=#8-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>CQRS</td><td>읽기/쓰기 분리</td><td>데이터 읽기와 쓰기 작업을 분리하여 각각 최적화</td></tr><tr><td>설계 패턴</td><td>CQRS</td><td>이벤트 소싱</td><td>상태 변경 이벤트 저장 및 재생, 감사, 도메인 모델링</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>마이크로서비스</td><td>독립적 확장, 유지보수성 향상</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>도메인 주도 설계</td><td>복잡한 도메인에서 효과적</td></tr></tbody></table><hr><h2 id=9-반드시-학습해야-할-내용>9. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#9-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 원칙</td><td>CQRS</td><td>책임 분리</td><td>읽기와 쓰기 작업을 분리하여 각각 최적화</td></tr><tr><td>설계 원칙</td><td>CQRS</td><td>이벤트 소싱</td><td>상태 변경 이벤트 저장 및 재생</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>도메인 주도 설계</td><td>복잡한 도메인에서 효과적</td></tr><tr><td>실무 적용</td><td>CQRS</td><td>데이터 동기화</td><td>읽기와 쓰기 모델 간 데이터 동기화 메커니즘</td></tr></tbody></table><hr><h2 id=10-용어-정리>10. 용어 정리<a hidden class=anchor aria-hidden=true href=#10-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>CQRS</td><td>데이터 읽기와 쓰기 작업을 분리하여 각각 최적화된 모델과 저장소로 처리하는 아키텍처 패턴</td></tr><tr><td>설계 원칙</td><td>Command</td><td>시스템의 상태를 변경하는 작업(생성, 수정, 삭제)</td></tr><tr><td>설계 원칙</td><td>Query</td><td>시스템의 상태를 변경하지 않고 데이터를 조회하는 작업</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>상태 변경 이벤트를 저장하여 복원, 감사, 도메인 모델링에 활용</td></tr><tr><td>실무 적용</td><td>Read Model</td><td>데이터 조회에 최적화된 모델</td></tr><tr><td>실무 적용</td><td>Write Model</td><td>데이터 생성, 수정, 삭제에 최적화된 모델</td></tr></tbody></table><hr><h2 id=11-참고-및-출처>11. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#11-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center | Microsoft Learn</a></li><li><a href=https://dokhakbaksa.tistory.com/101>CQRS 패턴 - 짱구 - 티스토리</a></li><li><a href=https://www.linkedin.com/pulse/what-purpose-cqrs-pavan-kumar-devulapalli-v7crc>What is the purpose of CQRS? - LinkedIn</a></li><li><a href=https://www.advanceworks.ai/command-query-responsibility-segregation-cqrs/>Command Query Responsibility Segregation (CQRS) - AdvanceWorks</a></li><li><a href=https://www.redhat.com/ko/blog/illustrated-cqrs>An illustrated guide to CQRS data patterns - Red Hat</a></li><li><a href=https://blog.naver.com/seek316/223247564137>CQRS(Command Query Responsibility Segregation) 개념 - 네이버 블로그</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li><li><a href=https://www.graphapp.ai/blog/understanding-the-cqrs-pattern-benefits-and-implementation-strategies>Understanding the CQRS Pattern: Benefits and Implementation Strategies - GraphApp</a></li><li><a href=https://systemdesignschool.io/blog/cqrs-pattern>The CQRS Pattern - System Design School</a></li><li><a href=https://blog.devops.dev/understanding-cqrs-pattern-pros-cons-and-a-spring-boot-example-69138eef603f>Understanding CQRS Pattern: Pros, Cons, and a Spring Boot Example - DevOps.dev</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/tip/Common-CQRS-pattern-problems-and-how-teams-can-avoid-them>Common CQRS pattern problems, and how teams can avoid them - TechTarget</a></li><li><a href=https://martinfowler.com/bliki/CQRS.html>CQRS - Martin Fowler</a></li><li><a href=https://enterprisecraftsmanship.com/posts/types-of-cqrs/>Types of CQRS - Enterprise Craftsmanship</a></li><li><a href=https://www.rootstrap.com/blog/demystifying-cqrs-a-practical-approach---simple-cqrs-part-1>Demystifying CQRS: A Practical Approach – Simple CQRS [Part 1] - Rootstrap</a></li><li><a href=https://blog.risingstack.com/cqrs-explained-node-js-at-scale/>CQRS Explained - RisingStack Engineering</a></li><li><a href=https://blog.nashtechglobal.com/introduction-to-cqrs/>Introduction to CQRS(Working, Uses, Benefits) - NashTech Blog</a></li><li><a href=https://github.com/slashdotdash/cqrs-best-practices>CQRS/ES best practices - GitHub</a></li><li><a href=https://blog.bytedoodle.com/cqrs-schema-design-synchronization-and-consistency-considerations/>CQRS : Schema Design, Synchronization and Consistency Considerations - ByeDoodle</a>
아래는 <strong>CQRS(Command‑Query Responsibility Segregation)</strong> 아키텍처에 대한 1차 정리입니다. 이후 원하시면 단계별로 세부 내용을 더 깊이 다룰 수 있습니다!</li></ul><hr><h2 id=1-태그-3>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-3>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CQRS, Command‑Query‑Segregation, Event‑Sourcing‑Integration, Data‑Models‑Separation
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-분류-계층-적절성-분석>2. 분류 계층 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-계층-적절성-분석>#</a></h2><ul><li><p>현 분류:</p><blockquote><p>Computer Science and Engineering → Software Engineering → Design and Architecture → Architecture Styles and Patterns → Architecture Patterns → Data Management</p></blockquote></li><li><p><strong>분석</strong>: 적합합니다.
CQRS는 데이터 모델과 책임 분리 아키텍처로, 대규모 데이터 시스템 및 이벤트 기반 설계에 중요하며, ‘Data Management’ 하위에 위치하는 것이 타당합니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">en.wikipedia.org</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">learn.microsoft.com</a>)</p></li></ul><hr><h2 id=3-200자-요약>3. 200자 요약<a hidden class=anchor aria-hidden=true href=#3-200자-요약>#</a></h2><p>CQRS는 명령(Command, 쓰기)과 조회(Query, 읽기)를 분리해 각각의 흐름과 데이터 모델을 독립적으로 최적화하는 패턴입니다. 이를 통해 읽기 성능 향상, 스케일 독립성, 보안 강화, 그리고 복잡한 도메인 로직을 명확히 관리할 수 있습니다. Event Sourcing과 결합하면 이력감사, 비동기 업데이트, 강력한 트랜잭션 모델 제공도 가능합니다.</p><hr><h2 id=4-250자-개요>4. 250자 개요<a hidden class=anchor aria-hidden=true href=#4-250자-개요>#</a></h2><p>CQRS는 시스템의 쓰기(Command)와 읽기(Query) 요청을 논리적으로 분리하여 처리하는 아키텍처 패턴입니다. 쓰기 모델은 복잡한 도메인 로직과 비즈니스 규칙 처리를 담당하고, 읽기 모델은 데이터 조회에 최적화된 경량 모델로 설계됩니다. 두 모델은 동일하거나 분리된 데이터 저장소를 사용하며, Event Sourcing 이벤트를 통해 읽기 모델이 업데이트되고, 처리량, 보안, 유지보수성을 크게 개선할 수 있습니다. (<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">learn.microsoft.com</a>)</p><hr><h2 id=5-핵심-개념-및-실무-구현-요소>5. 핵심 개념 및 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-및-실무-구현-요소>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li><strong>Command vs Query</strong>: 상태 변경 <strong>Command</strong>는 결과 미반환, <strong>Query</strong>는 정보 반환만 수행 (<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">en.wikipedia.org</a>)</li><li><strong>쓰기 모델 (Write Model)</strong>: 비즈니스 로직 처리, 트랜잭션 관리</li><li><strong>읽기 모델 (Read Model)</strong>: 조회 최적화, DTO/Projections 생성</li><li><strong>데이터 저장소 분리</strong>: 동일 DB 또는 RDBMS와 NoSQL 등 별도 사용 가능 (<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">learn.microsoft.com</a>, <a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">docs.aws.amazon.com</a>)</li><li><strong>Event Sourcing 통합</strong>: 상태 변경을 이벤트 스트림으로 저장, 읽기 모델로 비동기 업데이트 (<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">linkedin.com</a>)</li></ul><h3 id=51-실무-구현-요소>5.1 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#51-실무-구현-요소>#</a></h3><ul><li><strong>Command Handler</strong> 구현 및 Command 객체정의</li><li><strong>Query Handler</strong> 구현 및 DTO 또는 projection 설계</li><li><strong>Event</strong> 발행 및 구독자(subscription) 구조 구축</li><li><strong>데이터베이스</strong> 설계: 복합/단독 DB 또는 복수 DB</li><li><strong>메시징</strong>: Kafka, RabbitMQ 등 이벤트 전달용 인프라</li><li><strong>동기화 메커니즘</strong>: 이벤트 소비자(consumers) 구성 및 eventual consistency 확보</li><li><strong>테스트 전략</strong>: Command/Query 유닛 테스트, 통합 테스트, 컨트랙트 테스트</li></ul><hr><p>다음 단계로 작성하기 좋은 항목을 골라주세요:</p><ul><li>A. “구조 및 아키텍처 + 구성 요소” + Mermaid 다이어그램</li><li>B. “주요 원리 & 작동 원리” 시각화</li><li>C. “장단점 분석” 및 “문제점 상세 분석”</li><li>D. “실무 사용 예시” 및 “활용 사례”</li><li>E. “구현 예시(Python/JS 코드)”</li></ul><p>원하시는 순서를 선택해 주세요!</p><p><a href=https://www.codeproject.com/articles/555855/introduction-to-cqrs><figure><img alt="Introduction to CQRS- CodeProject" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.5VvG29FDkUU3E8TaJqDVFwHaGr\\&r=0\\&pid=Api"></figure></a></p><hr><h2 id=-5-구조-및-아키텍처-structure--architecture>🚦 5. 구조 및 아키텍처 (Structure & Architecture)<a hidden class=anchor aria-hidden=true href=#-5-구조-및-아키텍처-structure--architecture>#</a></h2><p>CQRS는 <strong>Command(쓰기)</strong> 와 <strong>Query(읽기)</strong> 책임을 분리하며, 종종 <strong>Event Sourcing</strong>과 결합해 구현됩니다. 핵심 구성 요소는 아래와 같습니다:</p><pre class=mermaid>flowchart LR
  subgraph Write Side
    UI(UI/API) --&gt; CB[Command Bus/Facade]
    CB --&gt; CH[Command Handler]
    CH --&gt; DM[Domain Model / Aggregates]
    DM --&gt; ES[Event Store] --&gt; EB[Event Bus]
  end

  subgraph Read Side
    EB --&gt; EH[Event Handler / Projector]
    EH --&gt; RD[Read Database / Materialized View]
    UI --&gt; QF[Query Facade] --&gt; RD
  end
</pre><ul><li><strong>UI/API</strong>: 사용자의 명령(Command)과 조회(Query)를 입력받습니다. (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>)</li><li><strong>Command Bus / Facade & Handler</strong>: Command를 수신하고 도메인에 전달 (<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">rabbitstack.github.io</a>)</li><li><strong>Domain Model / Aggregates</strong>: 비즈니스 규칙을 처리하고 Event를 생성합니다 (<a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">ibm-cloud-architecture.github.io</a>)</li><li><strong>Event Store</strong>: 이벤트를 저장하는 append-only 저장소 (<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">red-gate.com</a>)</li><li><strong>Event Bus</strong>: 이벤트를 발행하고 구독하도록 브로드캐스트합니다 (<a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">codeproject.com</a>)</li><li><strong>Event Handler / Projector</strong>: 이벤트를 소비해 Read DB를 업데이트하며, Projection 역할 수행 (<a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">upsolver.com</a>)</li><li><strong>Read Database</strong>: 조회에 최적화된 뷰(view)를 제공하는 DB (<a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">microservices.io</a>)</li><li><strong>Query Facade/Service</strong>: 사용자 요청(Query)을 수신하고 Read DB에서 응답합니다 </li></ul><hr><h3 id=-필수-구성-요소-vs-선택-구성-요소>📘 필수 구성 요소 vs 선택 구성 요소<a hidden class=anchor aria-hidden=true href=#-필수-구성-요소-vs-선택-구성-요소>#</a></h3><table><thead><tr><th>구분</th><th>구성 요소</th><th>역할</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td>Command Handler, Query Handler, Read DB, Write DB or Event Store, Domain Model</td><td>읽기·쓰기 분리 구조 완성</td></tr><tr><td><strong>선택</strong></td><td>Event Store, Event Bus, Event Handlers, Message Broker</td><td>Event Sourcing, 비동기 복제, 마이크로서비스 확장성 확보</td></tr></tbody></table><hr><h2 id=-6-주요-원리--작동-원리>🔁 6. 주요 원리 & 작동 원리<a hidden class=anchor aria-hidden=true href=#-6-주요-원리--작동-원리>#</a></h2><ul><li><strong>Command-Query 분리 (CQS 준수)</strong>: 명령(Command)은 상태 변경만, 조회(Query)는 정보만 반환합니다 (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">kurrent.io</a>, <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">martinfowler.com</a>, <a href="https://www.tinybird.co/blog-posts/event-sourcing-with-kafka?utm_source=chatgpt.com" title="Event sourcing with Kafka: A practical example - Tinybird">confluent.io</a>, <a href="https://dev.to/gabrielsadaka/vertical-slice-event-driven-architecture-with-net-core-and-kafka-2ad2?utm_source=chatgpt.com" title="A simpler approach to building event driven software using .NET ...">en.wikipedia.org</a>)</li><li><strong>각 모델 독립 최적화</strong>: Write 모델은 도메인 로직 중심, Read 모델은 성능 중심 설계 </li><li><strong>Event 브로드캐스팅 & Projection</strong>: Write가 발생한 Event는 비동기적으로 Read 모델에 반영 </li><li><strong>Eventual Consistency (점진 일관성)</strong>: Command 완료 후 Read DB 반영까지 지연될 수 있습니다 (<a href="https://www.linkedin.com/pulse/cqrs-pattern-microservices-hamed-banaei-uu7bf?utm_source=chatgpt.com" title="CQRS Pattern in Microservices - LinkedIn">medium.com</a>)</li></ul><hr><h3 id=-실행-흐름>💡 실행 흐름<a hidden class=anchor aria-hidden=true href=#-실행-흐름>#</a></h3><ol><li><strong>쓰기 요청</strong>: 유저 UI/API → Command → Command Handler</li><li><strong>도메인 처리</strong>: Command Handler → Domain Model → Event 생성</li><li><strong>이벤트 저장 및 발행</strong>: Event Store에 쓰고 Event Bus 통해 전달</li><li><strong>Projection 처리</strong>: Event Handler가 Read DB 업데이트</li><li><strong>조회 요청</strong>: 유저 → Query Handler → Read DB → 결과 반환</li></ol><p>이 구조는 읽기·쓰기 책임을 분리하면서 성능과 확장성을 극대화하고, 복잡한 도메인 로직도 깔끔하게 관리할 수 있습니다.</p><hr><p>다음으로 어떤 부분을 상세하게 다뤄볼까요?</p><ul><li>A. <strong>장단점 분석 + 문제점 정리</strong></li><li>B. <strong>실무 사용 예시 + 활용 사례</strong></li><li>C. <strong>구현 예시 (Python / JS 코드)</strong></li></ul><p>선택하시면, 다음 단계로 진행하겠습니다!</p><p><a href=https://www.codeproject.com/articles/555855/introduction-to-cqrs><figure><img alt="Introduction to CQRS- CodeProject" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.5VvG29FDkUU3E8TaJqDVFwHaGr\\&r=0\\&pid=Api"></figure></a></p><p>아래는 <strong>CQRS의 실무 사용 예시</strong>와 <strong>활용 사례 분석</strong>, 그리고 **코드 구현 예시(Python)**입니다.</p><hr><h2 id=-11-실무-사용-예시>🧪 11. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#-11-실무-사용-예시>#</a></h2><table><thead><tr><th>기술 스택</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Java Spring + Axon Framework</td><td>이벤트 소싱 기반 주문/결제 시스템 구현</td><td>명령·조회 분리, 이벤트 기반 확장 및 감사 기능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">medium.com</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">github.com</a>, <a href="https://nexocode.com/blog/posts/cqrs-and-event-sourcing/?utm_source=chatgpt.com" title="CQRS and Event Sourcing as an antidote for problems ... - nexocode">reddit.com</a>)</td></tr><tr><td>.NET + Marten (PostgreSQL 기반 Event Sourcing)</td><td>의료 예약 시스템 등에서 상태 이력 관리</td><td>도메인 상태 재생, 일관성 보강</td></tr><tr><td>Go + RabbitMQ + Postgres + EventStoreDB</td><td>전자 상거래 마이크로서비스</td><td>Vertical Slice + CQRS + 이벤트 아키텍처 통합</td></tr><tr><td>Laravel + MySQL + MongoDB</td><td>PHP 기반 애플리케이션에서 읽기/쓰기 DB 분리</td><td>조회 성능 개선, 쓰기 로직 분리</td></tr><tr><td>FastAPI/Python + python-cqrs</td><td>CQRS 패턴 실험 및 PoC</td><td>Python 환경에서 CQRS 도입 가능성 확인</td></tr></tbody></table><hr><h2 id=-12-활용-사례-전자상거래-마이크로서비스>📦 12. 활용 사례: 전자상거래 마이크로서비스<a hidden class=anchor aria-hidden=true href=#-12-활용-사례-전자상거래-마이크로서비스>#</a></h2><h3 id=-시스템-구성도>🏗️ 시스템 구성도<a hidden class=anchor aria-hidden=true href=#-시스템-구성도>#</a></h3><pre class=mermaid>flowchart LR
  subgraph Write Side
    UI --&gt; CmdAPI[Command API]
    CmdAPI --&gt; CH[Command Handler]
    CH --&gt; DM[Order Aggregate]
    DM --&gt; ES[Event Store]
    ES --&gt; EB[Event Bus]
  end

  subgraph Read Side
    EB --&gt; PH[Projector/Event Handler]
    PH --&gt; RDB[(Read DB)]
    UI --&gt; QueryAPI[Query API] --&gt; RDB
  end
</pre><ul><li><strong>Write Side</strong>: 사용자가 주문 요청 → Command Handler 실행 → Order Aggregate 처리 → 이벤트 저장 → 이벤트 버스로 전파</li><li><strong>Event Store</strong>: 상태 변화 이력을 보관하며, 모든 Command가 이벤트 형태로 축적됨</li><li><strong>Event Bus</strong>: 이벤트를 읽기 측으로 전송</li><li><strong>Projector</strong>: 이벤트 소비 후 Read DB에 데이터 반영 (Materialized View)</li><li><strong>Read Side</strong>: UI/Query API가 연결되어 빠른 조회 제공</li></ul><p>이 구조는 조회와 쓰기가 분리돼 <strong>읽기 성능 최적화</strong>, <strong>이벤트 감사 기능 확보</strong>, <strong>도메인 복잡도 관리 용이</strong> 등의 장점을 제공합니다.</p><hr><h2 id=-13-구현-예시-python--fastapi--python-cqrs>💻 13. 구현 예시 (Python + FastAPI + python-cqrs)<a hidden class=anchor aria-hidden=true href=#-13-구현-예시-python--fastapi--python-cqrs>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># command.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cqrs</span> <span class=kn>import</span> <span class=n>Command</span><span class=p>,</span> <span class=n>CommandHandler</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaceOrder</span><span class=p>(</span><span class=n>Command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PlaceOrderHandler</span><span class=p>(</span><span class=n>CommandHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cmd</span><span class=p>:</span> <span class=n>PlaceOrder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 도메인 처리 예: 재고/결제 검증 후 OrderPlaced 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderPlaced&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=n>cmd</span><span class=o>.</span><span class=n>items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># query.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cqrs</span> <span class=kn>import</span> <span class=n>Query</span><span class=p>,</span> <span class=n>QueryHandler</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrder</span><span class=p>(</span><span class=n>Query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetOrderHandler</span><span class=p>(</span><span class=n>QueryHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>qry</span><span class=p>:</span> <span class=n>GetOrder</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 읽기 DB 호출</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>qry</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;PLACED&#34;</span><span class=p>,</span> <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># app.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>command</span> <span class=kn>import</span> <span class=n>PlaceOrder</span><span class=p>,</span> <span class=n>PlaceOrderHandler</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>query</span> <span class=kn>import</span> <span class=n>GetOrder</span><span class=p>,</span> <span class=n>GetOrderHandler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cmd_handler</span> <span class=o>=</span> <span class=n>PlaceOrderHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>qry_handler</span> <span class=o>=</span> <span class=n>GetOrderHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>place_order</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span> <span class=o>=</span> <span class=n>PlaceOrder</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>evt</span> <span class=o>=</span> <span class=n>cmd_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 시스템은 EventBus 전송 필요</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>evt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/orders/</span><span class=si>{order_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>qry</span> <span class=o>=</span> <span class=n>GetOrder</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>qry_handler</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>qry</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Command Handler</strong>: 쓰기 이벤트 처리 담당</li><li><strong>Query Handler</strong>: 읽기 요청 처리</li><li><strong>python‑cqrs</strong> 라이브러리를 통해 패턴 구현 기초 수월화 (<a href="https://www.upsolver.com/blog/cqrs-event-sourcing-build-database-architecture?utm_source=chatgpt.com" title="CQRS, Event Sourcing Patterns and Database Architecture - Upsolver">linkedin.com</a>, <a href="https://www.reddit.com/r/dotnet/comments/1bfwhk0/is_it_really_true_that_cqrs_is_very_helpful_and/?utm_source=chatgpt.com" title="Is it really true that CQRS is very helpful and effective when using ...">geeksforgeeks.org</a>, <a href="https://dev.to/yasmine_ddec94f4d4/event-driven-architecture-event-sourcing-and-cqrs-how-they-work-together-1bp1?utm_source=chatgpt.com" title="Event-Driven Architecture, Event Sourcing, and CQRS: How They ...">developer.confluent.io</a>, <a href="https://www.reddit.com/r/softwarearchitecture/comments/1im75z7/clarification_on_cqrs/?utm_source=chatgpt.com" title="Clarification on CQRS : r/softwarearchitecture - Reddit">pypi.org</a>, <a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">arxiv.org</a>)</li></ul><hr><h3 id=-요약>✅ 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h3><ul><li><strong>실무 예시</strong>: 마이크로서비스, 이벤트 소싱, 성능 및 감사 요구에 대응</li><li><strong>활용 사례</strong>: 전자상거래 마이크로서비스 아키텍처에서 CQRS + Event Sourcing 결합</li><li><strong>코드 예</strong>: FastAPI 기반 실험적인 CQRS 구조로 개념 실현 가능</li></ul><p>다음 단계로 <strong>실무에서의 적용 포인트 및 최적화 권장 사항</strong>, <strong>용어 정리/참고 출처</strong> 등 전달해드릴까요? 원하는 항목을 말씀해주세요!</p><p>아래는 <strong>CQRS</strong>의 마지막 정리 단계입니다.</p><hr><h2 id=-14-실무에서-적용-시-고려사항-및-주의할-점>📋 14. 실무에서 적용 시 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#-14-실무에서-적용-시-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 일관성</td><td>Eventually consistent 구조는 즉시 반영되지 않음</td><td>사용자에게 <em>일시적 지연</em> 안내, Polling/재시도 UX 제공</td></tr><tr><td>장애 복구</td><td>메시지 누락·중복 가능성 존재</td><td>Idempotent 처리, Outbox 패턴, Dead-letter 큐 도입</td></tr><tr><td>모니터링</td><td>메트릭 수집 없으면 지연 원인 파악 어려움</td><td>Lag, 이벤트 처리율, 오류율 모니터링 구성</td></tr><tr><td>보안</td><td>쓰기/읽기 API 분리로 권한 제어 추가 필요</td><td>권한 체크, 감사 로그, Command 추적 설계</td></tr><tr><td>스키마 변경</td><td>읽기/쓰기 모델 다른 스키마 버전 문제</td><td>Event 버전 관리, Projection 리컴패일 설계</td></tr><tr><td>테스트</td><td>Command/Query/Projection 모두 커버해야 함</td><td>Contract 테스트, E2E 시나리오 테스트 포함</td></tr></tbody></table><p><strong>권장 요약</strong>:
적용 전 반드시 스케일, 성능 요구, 팀 기술 역량, 도메인 복잡도를 고려하고, 초기에는 단순 CQRS 구조로 도입한 후 필요에 따라 Event Sourcing 또는 분산 트랜잭션 지원 구조로 확장하세요.</p><hr><h2 id=-15-최적화를-위한-고려사항-및-주의할-점>⚙️ 15. 최적화를 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#-15-최적화를-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>DB 최적화</td><td>Projection 대상 데이터는 큼직하게 될 수 있음</td><td>인덱싱, 파티셔닝, 정기 아카이빙 전략 적용</td></tr><tr><td>이벤트 관리</td><td>이벤트 수/크기 급증시 처리 지연 우려</td><td>Snapshot, 이벤트 압축, TTL 설정 적용</td></tr><tr><td>인프라 비용</td><td>브로커, 이벤트 저장소 등 비용 증가</td><td>필요 수준 평가 후 구성, 서버리스 등 고려</td></tr><tr><td>멀티 테넌시</td><td>테넌트별 데이터 격리 필요</td><td>스키마 격리, 네임스페이스 설계 유의</td></tr><tr><td>메시징 성능</td><td>동기 처리 시 지연 걱정</td><td>배치, 비동기 소비, Backpressure 대책 유효화</td></tr></tbody></table><hr><h2 id=-16-용어-정리>🧾 16. 용어 정리<a hidden class=anchor aria-hidden=true href=#-16-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>핵심 개념</td><td>Command</td><td>상태 변경 요청을 표현하는 객체 또는 메시지</td></tr><tr><td></td><td>Query</td><td>데이터를 조회하기 위한 요청</td></tr><tr><td></td><td>Command Handler</td><td>Command를 처리하는 비즈니스 로직 엔진</td></tr><tr><td></td><td>Query Handler</td><td>조회 요청을 처리하는 컴포넌트</td></tr><tr><td>아키텍처</td><td>Event Sourcing</td><td>상태 변경을 이벤트로 저장하고, 이를 통해 상태 재구성 방식 사용</td></tr><tr><td></td><td>Projection</td><td>이벤트를 기반으로 Read 모델을 구성하기 위한 View</td></tr><tr><td>패턴</td><td>Outbox Pattern</td><td>DB와 메시지 브로커 간의 트랜잭션 일관성 유지 전략</td></tr><tr><td>용어</td><td>Idempotence</td><td>중복 메시지(요청)에 대해 상태를 안전하게 처리하는 보장 방식</td></tr></tbody></table><hr><h2 id=-참고-및-출처>📚 참고 및 출처<a hidden class=anchor aria-hidden=true href=#-참고-및-출처>#</a></h2><ul><li>“CQRS pattern”, Microsoft docs</li><li>Greg Young, “Introduction to CQRS and Event Sourcing”</li><li>Udi Dahan, “CQRS and the Monolithic Mindset”</li><li>Microservices Patterns, Chris Richardson – CQRS 챕터</li><li>Axon Framework 문서 – Java/CQRS & Event Sourcing</li></ul><hr><p>🎯 <strong>정리 완료:</strong>
CQRS의 핵심 개념, 구조, 역할, 장단점부터 실무 고려사항, 최적화 지침, 용어 정의까지 정리했습니다.
추가로 프레임워크별 적용 가이드(.NET, Spring, Go 등)나 특정 사용 사례 코드가 필요하시면 언제든 요청하세요!</p><hr><h2 id=-장점-advantages>✅ 장점 (Advantages)<a hidden class=anchor aria-hidden=true href=#-장점-advantages>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>독립적 모델링</td><td>쓰기(도메인 로직)와 읽기(조회용 뷰) 모델을 분리하여 각각 최적화할 수 있습니다 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs?utm_source=chatgpt.com" title="CQRS Pattern - Azure Architecture Center | Microsoft Learn">redhat.com</a>, <a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">medium.com</a>)</td></tr><tr><td></td><td>성능 및 스케일</td><td>읽기/쓰기 작업을 독립적으로 확장 가능하며, 위치 기반 복제 통해 지연 감소</td></tr><tr><td></td><td>보안 강화</td><td>쓰기 모델 접근을 제한함으로써 보안 정책 적용이 용이해집니다</td></tr><tr><td></td><td>도메인 명확화</td><td>도메인 모델과 읽기 모델 분리를 통해 비즈니스 로직이 더욱 명료해집니다</td></tr><tr><td></td><td>유연성</td><td>데이터 저장소를 읽기/쓰기에 맞게 다르게 구성할 수 있으며, CQRS와 Event Sourcing 결합 시 강력한 로그·이력 관리 가능</td></tr></tbody></table><hr><h2 id=-단점-drawbacks>❌ 단점 (Drawbacks)<a hidden class=anchor aria-hidden=true href=#-단점-drawbacks>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡도 증가</td><td>구조가 복잡해지고, 개발·운영 비용이 상승합니다 (<a href="https://www.linkedin.com/pulse/understanding-cqrs-architecture-command-query-nasr-ullah?utm_source=chatgpt.com" title="Understanding the CQRS Architecture: Command and Query ...">medium.com</a>)</td><td>점진적 도입, 단순화 버전 사용, 내부 문서화</td></tr><tr><td></td><td>일관성 지연 (Eventual Consistency)</td><td>읽기 데이터가 즉시 반영되지 않아 사용자 경험에 지연 발생 가능</td><td>상태 표시 UI 제공, 보상 트랜잭션, 성숙한 이벤트 처리 설계</td></tr><tr><td></td><td>기술 중복</td><td>별도 저장소 및 이벤트 메시징 도입으로 기술 스택이 복잡해지고 장애 지점 증가</td><td>프레임워크 활용, 메시징 트랜잭션 안정성 고려, 모니터링 강화</td></tr><tr><td></td><td>추가 유지보수</td><td>읽기/쓰기와 이벤트 흐름 추가 구성 요소 관리 필요</td><td>자동화 테스트, Contract Testing, 로그 기반 추적</td></tr></tbody></table><hr><h2 id=-문제점-상세-분석-issue-breakdown>⚠️ 문제점 상세 분석 (Issue Breakdown)<a hidden class=anchor aria-hidden=true href=#-문제점-상세-분석-issue-breakdown>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제</td><td>지연 일관성</td><td>읽기 모델 비동기 업데이트</td><td>사용자 혼란, 데이터 불일치</td><td>지연 모니터링, UX 이슈</td><td>예측 가능한 UI, 보상 트랜잭션</td><td>예상 가능한 일관성 확보, 롤백/보상 로직</td></tr><tr><td>문제</td><td>메시지 실패/중복</td><td>네트워크 장애, 중복 수신</td><td>상태 불일치, 중복 작업</td><td>메시지 상태 추적</td><td>Exactly-once 처리 전략, 메시지 idempotence</td><td>중복 처리 로직, 2단계 커밋, Outbox 패턴</td></tr><tr><td>문제</td><td>물리적 인프라 증가</td><td>다중 DB, 브로커 도입</td><td>장애 지점 증가, 운영 비용 상승</td><td>장애 빈도 및 장애 시 영향 확인</td><td>간소화 아키텍처, 인프라 IaC 구축</td><td>지역 이중화, 자동 복구 환경 마련</td></tr><tr><td>문제</td><td>Event Store 과잉</td><td>이벤트 이력 지나치게 커짐</td><td>스토리지 과부하, 복구 지연</td><td>스토리지 용량 로그</td><td>Snapshot, 아카이빙 전략</td><td>정기 아카이빙, Snapshot 기반 리커버리</td></tr></tbody></table><hr><p>다음 단계는 무엇을 원하시나요?</p><ul><li><strong>A</strong>: 실무 사용 예시 + 활용 사례</li><li><strong>B</strong>: 구현 예시 (Python or JS 코드)</li><li><strong>C</strong>: 실무 적용 고려사항 및 최적화 권장 사항 정리</li></ul><p>원하시는 부분을 말씀해주시면 바로 이어서 작성해드리겠습니다!</p><p>안녕하세요! CQRS (Command Query Responsibility Segregation)에 대한 포괄적인 조사를 진행하겠습니다. 단계별로 체계적으로 분석해보겠습니다.이제 충분한 정보를 수집했으므로 CQRS에 대한 포괄적인 분석을 시작하겠습니다.</p><h1 id=cqrs-command-query-responsibility-segregation-조사-결과>CQRS (Command Query Responsibility Segregation) 조사 결과<a hidden class=anchor aria-hidden=true href=#cqrs-command-query-responsibility-segregation-조사-결과>#</a></h1><h2 id=1-태그-및-분류>1. 태그 및 분류<a hidden class=anchor aria-hidden=true href=#1-태그-및-분류>#</a></h2><p><strong>태그</strong>: Command-Query-Responsibility-Segregation, Software-Architecture-Pattern, Event-Driven-Architecture, Distributed-Systems</p><p><strong>주제의 분류 적절성 분석</strong>:
제시된 분류 &ldquo;Computer Science and Engineering&rdquo; > &ldquo;Software Engineering&rdquo; > &ldquo;Design and Architecture&rdquo; > &ldquo;Architecture Styles and Patterns&rdquo; > &ldquo;Architecture Patterns&rdquo; > &ldquo;Data Management"는 <strong>적절합니다</strong>.</p><p><strong>근거</strong>:</p><ul><li>CQRS는 소프트웨어 아키텍처 패턴으로, 데이터 관리와 관련된 설계 접근방식입니다</li><li>소프트웨어 엔지니어링의 설계 및 아키텍처 영역에서 활용되는 패턴입니다</li><li>시스템의 읽기와 쓰기 책임을 분리하는 아키텍처 패턴으로 분류됩니다</li></ul><h2 id=2-요약-설명>2. 요약 설명<a hidden class=anchor aria-hidden=true href=#2-요약-설명>#</a></h2><p>CQRS는 Command와 Query의 책임을 분리하여 읽기와 쓰기 작업을 별도의 모델로 처리하는 아키텍처 패턴으로, 복잡한 도메인과 고성능이 요구되는 시스템에서 확장성과 성능을 향상시키는 설계 접근방식입니다.</p><h2 id=3-전체-개요>3. 전체 개요<a hidden class=anchor aria-hidden=true href=#3-전체-개요>#</a></h2><p>CQRS는 전통적인 CRUD 아키텍처의 한계를 극복하기 위해 개발된 소프트웨어 아키텍처 패턴으로, 시스템의 Command(명령) 처리와 Query(조회) 처리를 분리하여 각각을 최적화할 수 있게 합니다. Event Sourcing과 함께 사용되어 복잡한 비즈니스 로직과 높은 확장성이 요구되는 시스템에서 효과적입니다.</p><hr><h2 id=4-핵심-개념-1>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념-1>#</a></h2><h3 id=기본-핵심-개념>기본 핵심 개념<a hidden class=anchor aria-hidden=true href=#기본-핵심-개념>#</a></h3><ul><li><strong>Command Query Separation (CQS)</strong>: CQRS의 기반이 되는 개념으로, 상태를 변경하는 명령과 데이터를 조회하는 쿼리를 분리하는 원칙</li><li><strong>Command (명령)</strong>: 시스템의 상태를 변경하는 작업을 나타내며, 결과값을 반환하지 않음</li><li><strong>Query (조회)</strong>: 시스템의 상태를 조회하는 작업으로, 시스템 상태를 변경하지 않음</li><li><strong>Write Model (쓰기 모델)</strong>: 명령을 처리하고 비즈니스 로직을 실행하는 모델</li><li><strong>Read Model (읽기 모델)</strong>: 조회 요청을 처리하고 최적화된 데이터를 제공하는 모델</li><li><strong>Eventual Consistency (최종 일관성)</strong>: 읽기와 쓰기 모델 간의 동기화가 즉시 이루어지지 않는 일관성 모델</li></ul><h3 id=실무-구현-요소>실무 구현 요소<a hidden class=anchor aria-hidden=true href=#실무-구현-요소>#</a></h3><ul><li><strong>Command Handler (명령 처리기)</strong>: Command를 받아 비즈니스 로직을 실행하고 상태를 변경하는 컴포넌트</li><li><strong>Query Handler (조회 처리기)</strong>: Query를 받아 Read Model에서 데이터를 조회하는 컴포넌트</li><li><strong>Event Store (이벤트 저장소)</strong>: Event Sourcing과 함께 사용될 때 모든 도메인 이벤트를 저장하는 저장소</li><li><strong>Projection (프로젝션)</strong>: Event에서 Read Model을 생성하는 과정</li><li><strong>Message Bus (메시지 버스)</strong>: Command와 Query를 적절한 Handler로 라우팅하는 컴포넌트</li><li><strong>Synchronization Mechanism (동기화 메커니즘)</strong>: Write Model과 Read Model 간의 데이터 동기화를 담당</li></ul><hr><h2 id=5-배경>5. 배경<a hidden class=anchor aria-hidden=true href=#5-배경>#</a></h2><p>CQRS는 2010년 Greg Young에 의해 처음 소개되었으며, Bertrand Meyer가 1988년 제안한 Command Query Separation (CQS) 원칙을 시스템 아키텍처 레벨로 확장한 것입니다. 전통적인 CRUD 아키텍처에서 단일 모델로 읽기와 쓰기를 모두 처리할 때 발생하는 성능 병목현상과 복잡성 문제를 해결하기 위해 개발되었습니다.</p><hr><h2 id=6-목적-및-필요성>6. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#6-목적-및-필요성>#</a></h2><h3 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h3><ul><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업을 각각에 최적화된 별도 모델로 처리</li><li><strong>확장성 향상</strong>: 읽기와 쓰기 부하를 독립적으로 확장 가능</li><li><strong>복잡성 관리</strong>: 복잡한 비즈니스 로직을 더 명확하게 분리하여 관리</li><li><strong>시스템 유연성</strong>: 다양한 읽기 요구사항에 맞는 여러 Read Model 제공</li></ul><h3 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h3><ul><li>높은 읽기/쓰기 부하 비율의 불균형</li><li>복잡한 도메인 로직과 다양한 조회 요구사항</li><li>실시간 분석과 리포팅 요구사항</li><li>마이크로서비스 아키텍처에서의 데이터 분산 관리</li></ul><hr><h2 id=7-주요-기능-및-역할>7. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#7-주요-기능-및-역할>#</a></h2><h3 id=command-side-명령-측>Command Side (명령 측)<a hidden class=anchor aria-hidden=true href=#command-side-명령-측>#</a></h3><ul><li>비즈니스 로직 실행 및 검증</li><li>도메인 모델 상태 변경</li><li>트랜잭션 무결성 보장</li><li>이벤트 발행 (Event Sourcing 사용 시)</li></ul><h3 id=query-side-조회-측>Query Side (조회 측)<a hidden class=anchor aria-hidden=true href=#query-side-조회-측>#</a></h3><ul><li>최적화된 데이터 조회</li><li>다양한 View Model 제공</li><li>읽기 성능 최적화</li><li>캐싱 및 비정규화된 데이터 활용</li></ul><hr><h2 id=8-특징>8. 특징<a hidden class=anchor aria-hidden=true href=#8-특징>#</a></h2><ul><li><strong>책임 분리</strong>: Command와 Query의 명확한 분리</li><li><strong>독립적 확장</strong>: 읽기와 쓰기 시스템의 독립적 확장 가능</li><li><strong>기술 다양성</strong>: 각 모델에 최적화된 서로 다른 기술 스택 사용 가능</li><li><strong>최종 일관성</strong>: Read Model과 Write Model 간의 비동기 동기화</li><li><strong>이벤트 기반</strong>: Event Sourcing과의 자연스러운 결합</li></ul><hr><h2 id=9-핵심-원칙>9. 핵심 원칙<a hidden class=anchor aria-hidden=true href=#9-핵심-원칙>#</a></h2><ol><li><strong>단일 책임 원칙</strong>: Command와 Query는 각각 하나의 책임만 가짐</li><li><strong>분리 원칙</strong>: 읽기와 쓰기 모델의 물리적/논리적 분리</li><li><strong>최적화 원칙</strong>: 각 모델을 해당 작업에 최적화</li><li><strong>일관성 원칙</strong>: 비즈니스 요구사항에 맞는 일관성 수준 제공</li></ol><hr><h2 id=10-주요-원리-및-작동-원리>10. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#10-주요-원리-및-작동-원리>#</a></h2><pre class=mermaid>graph TD
    A[Client] --&gt; B{Request Type}
    B --&gt;|Command| C[Command Handler]
    B --&gt;|Query| D[Query Handler]
    
    C --&gt; E[Write Model]
    E --&gt; F[Write Database]
    F --&gt; G[Event Publication]
    G --&gt; H[Event Handler]
    H --&gt; I[Read Model Update]
    
    D --&gt; J[Read Model]
    J --&gt; K[Read Database]
    
    subgraph &#34;Command Side&#34;
        C
        E
        F
    end
    
    subgraph &#34;Query Side&#34;
        D
        J
        K
    end
    
    subgraph &#34;Synchronization&#34;
        G
        H
        I
    end
</pre><h3 id=작동-과정>작동 과정<a hidden class=anchor aria-hidden=true href=#작동-과정>#</a></h3><ol><li><strong>Command 처리</strong>: Client에서 Command 전송 → Command Handler가 비즈니스 로직 실행 → Write Model 업데이트</li><li><strong>이벤트 발행</strong>: Write Model 변경 시 이벤트 발행</li><li><strong>Read Model 동기화</strong>: Event Handler가 이벤트를 받아 Read Model 업데이트</li><li><strong>Query 처리</strong>: Client에서 Query 전송 → Query Handler가 Read Model에서 데이터 조회</li></ol><hr><h2 id=11-구조-및-아키텍처-1>11. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처-1>#</a></h2><h3 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Command Handler</td><td>명령 처리</td><td>비즈니스 로직 실행 및 검증</td><td>상태 변경, 트랜잭션 관리</td></tr><tr><td>Query Handler</td><td>조회 처리</td><td>데이터 조회 및 반환</td><td>읽기 최적화, 캐싱 활용</td></tr><tr><td>Write Model</td><td>쓰기 모델</td><td>도메인 객체 및 비즈니스 로직</td><td>정규화된 구조, 일관성 보장</td></tr><tr><td>Read Model</td><td>읽기 모델</td><td>조회용 데이터 구조</td><td>비정규화된 구조, 성능 최적화</td></tr></tbody></table><h3 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td>Event Store</td><td>이벤트 저장</td><td>모든 도메인 이벤트 영구 저장</td><td>Event Sourcing 지원</td></tr><tr><td>Message Bus</td><td>메시지 라우팅</td><td>Command/Query를 적절한 Handler로 전달</td><td>확장성 및 유연성 제공</td></tr><tr><td>Projection Service</td><td>프로젝션 생성</td><td>Event에서 Read Model 생성</td><td>실시간 또는 배치 처리</td></tr><tr><td>Snapshot Store</td><td>스냅샷 저장</td><td>성능 최적화를 위한 상태 스냅샷</td><td>이벤트 재생 최적화</td></tr></tbody></table><h3 id=아키텍처-다이어그램>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        UI[User Interface]
        API[API Gateway]
    end
    
    subgraph &#34;Application Layer&#34;
        CB[Command Bus]
        QB[Query Bus]
        CH[Command Handlers]
        QH[Query Handlers]
    end
    
    subgraph &#34;Write Side&#34;
        WM[Write Model]
        WDB[(Write Database)]
        ES[(Event Store)]
    end
    
    subgraph &#34;Read Side&#34;
        RM1[Read Model 1]
        RM2[Read Model 2]
        RDB1[(Read Database 1)]
        RDB2[(Read Database 2)]
    end
    
    subgraph &#34;Infrastructure&#34;
        MB[Message Broker]
        EH[Event Handlers]
        PS[Projection Service]
    end
    
    UI --&gt; API
    API --&gt; CB
    API --&gt; QB
    
    CB --&gt; CH
    QB --&gt; QH
    
    CH --&gt; WM
    WM --&gt; WDB
    WM --&gt; ES
    
    ES --&gt; MB
    MB --&gt; EH
    EH --&gt; PS
    PS --&gt; RM1
    PS --&gt; RM2
    
    QH --&gt; RM1
    QH --&gt; RM2
    RM1 --&gt; RDB1
    RM2 --&gt; RDB2
</pre><hr><h2 id=12-구현-기법-1>12. 구현 기법<a hidden class=anchor aria-hidden=true href=#12-구현-기법-1>#</a></h2><h3 id=1-기본-cqrs-shared-database>1. 기본 CQRS (Shared Database)<a hidden class=anchor aria-hidden=true href=#1-기본-cqrs-shared-database>#</a></h3><p><strong>정의</strong>: 단일 데이터베이스를 사용하되 읽기와 쓰기 로직을 분리하는 방식</p><p><strong>구성</strong>:</p><ul><li>공통 데이터베이스</li><li>분리된 Command/Query Handler</li><li>서로 다른 도메인 모델과 DTO</li></ul><p><strong>목적</strong>: 복잡성 최소화하면서 읽기/쓰기 최적화</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Command Side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>CreateOrderCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>customerId</span> <span class=o>=</span> <span class=nx>customerId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Order</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>command</span><span class=p>.</span><span class=nx>items</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderRepository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=k>new</span> <span class=nx>OrderCreatedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query Side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrderSummary</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>database</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SELECT o.id, o.total, c.name FROM orders o JOIN customers c ON o.customer_id = c.id WHERE o.id = ?&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=nx>orderId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-분리된-데이터베이스-cqrs>2. 분리된 데이터베이스 CQRS<a hidden class=anchor aria-hidden=true href=#2-분리된-데이터베이스-cqrs>#</a></h3><p><strong>정의</strong>: 읽기와 쓰기에 별도의 데이터베이스를 사용하는 방식</p><p><strong>구성</strong>:</p><ul><li>Write Database (트랜잭션 최적화)</li><li>Read Database (쿼리 최적화)</li><li>데이터 동기화 메커니즘</li></ul><p><strong>목적</strong>: 각 데이터베이스를 해당 작업에 최적화</p><p><strong>실제 예시</strong>:</p><ul><li>Write: PostgreSQL (ACID 트랜잭션)</li><li>Read: MongoDB (문서 기반 빠른 조회)</li><li>동기화: Apache Kafka를 통한 이벤트 스트리밍</li></ul><h3 id=3-event-sourcing--cqrs>3. Event Sourcing + CQRS<a hidden class=anchor aria-hidden=true href=#3-event-sourcing--cqrs>#</a></h3><p><strong>정의</strong>: 이벤트 스토어를 Write Model로 사용하고 이벤트로부터 Read Model을 구성하는 방식</p><p><strong>구성</strong>:</p><ul><li>Event Store (Write Model)</li><li>Projection Engine</li><li>Materialized Views (Read Model)</li></ul><p><strong>목적</strong>: 완전한 감사 추적과 시간 여행 기능 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_id</span><span class=p>,</span> <span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>store_event</span><span class=p>(</span><span class=n>stream_id</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>order_view</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_name&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>customer_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;Created&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>read_db</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=s1>&#39;order_views&#39;</span><span class=p>,</span> <span class=n>order_view</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=13-장점-1>13. 장점<a hidden class=anchor aria-hidden=true href=#13-장점-1>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 최적화</td><td>읽기와 쓰기 모델을 각각에 특화되도록 설계하여 전체적인 시스템 성능 향상</td></tr><tr><td>장점</td><td>독립적 확장성</td><td>Command와 Query 처리를 독립적으로 확장 가능하여 비용 효율적인 리소스 관리</td></tr><tr><td>장점</td><td>기술 선택의 자유</td><td>읽기와 쓰기에 각각 최적화된 서로 다른 데이터베이스 및 기술 스택 사용 가능</td></tr><tr><td>장점</td><td>복잡성 분리</td><td>비즈니스 로직과 조회 로직을 분리하여 각각의 복잡성을 독립적으로 관리</td></tr><tr><td>장점</td><td>다양한 View 지원</td><td>동일한 데이터로부터 다양한 읽기 요구사항에 맞는 여러 Read Model 생성 가능</td></tr><tr><td>장점</td><td>보안 향상</td><td>읽기와 쓰기 권한을 별도로 관리하여 세밀한 접근 제어 가능</td></tr><tr><td>장점</td><td>유지보수성</td><td>명확한 책임 분리로 인한 코드의 가독성과 유지보수성 향상</td></tr></tbody></table><hr><h2 id=14-단점과-문제점-그리고-해결방안-1>14. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#14-단점과-문제점-그리고-해결방안-1>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>별도의 읽기/쓰기 모델 관리로 인한 아키텍처 복잡성 증가</td><td>점진적 도입, 명확한 설계 가이드라인 수립</td></tr><tr><td>단점</td><td>데이터 일관성</td><td>Read Model과 Write Model 간의 최종 일관성으로 인한 데이터 불일치</td><td>비즈니스 요구사항에 맞는 일관성 수준 정의, 보상 트랜잭션 구현</td></tr><tr><td>단점</td><td>개발 오버헤드</td><td>중복된 코드와 모델로 인한 개발 시간 증가</td><td>코드 생성 도구 활용, 공통 라이브러리 구축</td></tr><tr><td>단점</td><td>운영 복잡성</td><td>여러 데이터베이스와 동기화 메커니즘 관리 필요</td><td>모니터링 도구 구축, 자동화된 배포 파이프라인</td></tr></tbody></table><h3 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>동기화 지연</td><td>네트워크 지연, 메시지 브로커 성능</td><td>사용자가 최신 데이터를 볼 수 없음</td><td>지연 시간 모니터링, 알림 설정</td><td>성능 테스트, 적절한 인프라 용량 계획</td><td>배치 처리 최적화, 캐싱 전략</td></tr><tr><td>문제점</td><td>메시지 손실</td><td>시스템 장애, 네트워크 오류</td><td>데이터 불일치, 비즈니스 로직 오류</td><td>메시지 추적, 상태 검증</td><td>메시지 지속성 보장, 중복 제거 메커니즘</td><td>재처리 로직, Dead Letter Queue</td></tr><tr><td>문제점</td><td>순환 의존성</td><td>잘못된 아키텍처 설계</td><td>시스템 데드락, 무한 루프</td><td>의존성 분석 도구</td><td>명확한 아키텍처 경계 정의</td><td>이벤트 체인 재설계, 의존성 역전</td></tr><tr><td>문제점</td><td>스키마 불일치</td><td>모델 진화 과정에서 발생</td><td>데이터 직렬화 오류</td><td>스키마 버전 관리</td><td>스키마 진화 전략 수립</td><td>백워드 호환성 유지, 마이그레이션 도구</td></tr></tbody></table><hr><h2 id=15-도전-과제-1>15. 도전 과제<a hidden class=anchor aria-hidden=true href=#15-도전-과제-1>#</a></h2><h3 id=기술적-도전-과제>기술적 도전 과제<a hidden class=anchor aria-hidden=true href=#기술적-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결 방법</th></tr></thead><tbody><tr><td>데이터 일관성</td><td>분산 트랜잭션 관리</td><td>여러 데이터베이스 간 ACID 보장 어려움</td><td>데이터 무결성 위험</td><td>Saga 패턴, 2PC 프로토콜</td></tr><tr><td>성능 최적화</td><td>이벤트 스트림 처리</td><td>대용량 이벤트 처리 성능</td><td>시스템 지연 및 병목</td><td>스트림 파티셔닝, 병렬 처리</td></tr><tr><td>모니터링</td><td>분산 시스템 추적</td><td>복잡한 데이터 플로우</td><td>장애 진단 어려움</td><td>분산 추적, 로깅 표준화</td></tr></tbody></table><h3 id=비즈니스-도전-과제>비즈니스 도전 과제<a hidden class=anchor aria-hidden=true href=#비즈니스-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결 방법</th></tr></thead><tbody><tr><td>조직 변화</td><td>팀 구조 재편</td><td>새로운 책임 분리 모델</td><td>개발 프로세스 변화</td><td>Conway&rsquo;s Law 적용, 팀 역할 재정의</td></tr><tr><td>기술 부채</td><td>레거시 시스템 통합</td><td>기존 CRUD 시스템과의 호환성</td><td>마이그레이션 복잡성</td><td>점진적 마이그레이션, Strangler Fig 패턴</td></tr><tr><td>비용 관리</td><td>인프라 비용 증가</td><td>여러 데이터베이스 및 서비스</td><td>운영 비용 상승</td><td>클라우드 네이티브 솔루션, 자동 확장</td></tr></tbody></table><hr><h2 id=16-분류-기준에-따른-종류-및-유형-1>16. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-종류-및-유형-1>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 사례</th></tr></thead><tbody><tr><td>데이터베이스 분리 수준</td><td>논리적 분리</td><td>동일 DB, 다른 스키마/테이블</td><td>단순한 읽기/쓰기 최적화</td></tr><tr><td>데이터베이스 분리 수준</td><td>물리적 분리</td><td>완전히 다른 데이터베이스</td><td>고성능, 고가용성 요구사항</td></tr><tr><td>이벤트 처리 방식</td><td>동기 CQRS</td><td>실시간 동기화</td><td>강한 일관성 요구 시스템</td></tr><tr><td>이벤트 처리 방식</td><td>비동기 CQRS</td><td>이벤트 기반 비동기 처리</td><td>높은 처리량 요구 시스템</td></tr><tr><td>복잡성 수준</td><td>단순 CQRS</td><td>기본적인 읽기/쓰기 분리</td><td>CRUD 개선이 목적인 시스템</td></tr><tr><td>복잡성 수준</td><td>완전 CQRS</td><td>Event Sourcing과 결합</td><td>복잡한 도메인, 감사 요구사항</td></tr><tr><td>기술 스택</td><td>동종 기술</td><td>같은 종류의 데이터베이스</td><td>기술 스택 단순화</td></tr><tr><td>기술 스택</td><td>이종 기술</td><td>서로 다른 데이터베이스</td><td>각 용도에 최적화</td></tr></tbody></table><hr><h2 id=17-실무-사용-예시-1>17. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시-1>#</a></h2><table><thead><tr><th>사용 목적</th><th>함께 사용되는 기술</th><th>효과</th><th>적용 분야</th></tr></thead><tbody><tr><td>고성능 읽기 처리</td><td>Redis Cache, Elasticsearch</td><td>조회 성능 100배 향상</td><td>전자상거래 상품 검색</td></tr><tr><td>실시간 분석</td><td>Apache Kafka, ClickHouse</td><td>실시간 대시보드 제공</td><td>금융 거래 모니터링</td></tr><tr><td>감사 추적</td><td>Event Store, PostgreSQL</td><td>완전한 감사 로그</td><td>의료 기록 관리</td></tr><tr><td>마이크로서비스 통합</td><td>API Gateway, Service Mesh</td><td>서비스 간 결합도 감소</td><td>대규모 분산 시스템</td></tr><tr><td>다중 채널 지원</td><td>GraphQL, REST API</td><td>채널별 최적화된 데이터 제공</td><td>옴니채널 플랫폼</td></tr><tr><td>성능 최적화</td><td>읽기 전용 복제본, CDN</td><td>글로벌 응답 시간 단축</td><td>소셜 미디어 플랫폼</td></tr></tbody></table><hr><h2 id=18-활용-사례-1>18. 활용 사례<a hidden class=anchor aria-hidden=true href=#18-활용-사례-1>#</a></h2><h3 id=netflix의-동영상-추천-시스템>Netflix의 동영상 추천 시스템<a hidden class=anchor aria-hidden=true href=#netflix의-동영상-추천-시스템>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>Command Side</strong>: 사용자 시청 기록, 평점 데이터 처리</li><li><strong>Query Side</strong>: 개인화된 추천 리스트 제공</li><li><strong>Event Store</strong>: 모든 사용자 상호작용 이벤트 저장</li><li><strong>Read Models</strong>: 장르별, 인기도별, 개인화 추천 모델</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Netflix CQRS Architecture&#34;
        U[User] --&gt; API[API Gateway]
        
        subgraph &#34;Command Side&#34;
            API --&gt; CH[Command Handler]
            CH --&gt; WM[Write Model]
            WM --&gt; ES[(Event Store)]
            WM --&gt; UDB[(User Database)]
        end
        
        subgraph &#34;Event Processing&#34;
            ES --&gt; KF[Kafka]
            KF --&gt; EP[Event Processors]
        end
        
        subgraph &#34;Query Side&#34;
            API --&gt; QH[Query Handler]
            QH --&gt; RM1[Recommendation Model]
            QH --&gt; RM2[User Profile Model]
            QH --&gt; RM3[Content Catalog Model]
            
            RM1 --&gt; RDB1[(Recommendation DB)]
            RM2 --&gt; RDB2[(Profile DB)]
            RM3 --&gt; RDB3[(Catalog DB)]
        end
        
        EP --&gt; RM1
        EP --&gt; RM2
        EP --&gt; RM3
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 시청 이벤트 발생 → Command Handler 처리</li><li>이벤트 저장 및 Kafka로 발행</li><li>추천 엔진이 이벤트 처리하여 Read Model 업데이트</li><li>사용자 요청 시 Query Handler가 개인화된 추천 리스트 반환</li></ol><p><strong>CQRS 역할</strong>:</p><ul><li><strong>쓰기 최적화</strong>: 대용량 사용자 이벤트 실시간 처리</li><li><strong>읽기 최적화</strong>: 밀리초 단위 추천 결과 제공</li><li><strong>확장성</strong>: 읽기와 쓰기 트래픽을 독립적으로 확장</li></ul><p><strong>기존 시스템과의 차이점</strong>:</p><ul><li><strong>전통적 방식</strong>: 실시간 계산으로 인한 지연 발생</li><li><strong>CQRS 방식</strong>: 미리 계산된 추천 결과로 즉시 응답</li><li><strong>데이터 일관성</strong>: 최종 일관성으로 실시간성 확보</li></ul><hr><h2 id=19-구현-예시-1>19. 구현 예시<a hidden class=anchor aria-hidden=true href=#19-구현-예시-1>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>  1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>  2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>  3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>  4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>  5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6>  6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7>  7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8>  8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9>  9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10> 10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11> 11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12> 12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13> 13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14> 14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15> 15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16> 16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17> 17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18> 18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19> 19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20> 20</a>
</span><span class=lnt id=hl-31-21><a class=lnlinks href=#hl-31-21> 21</a>
</span><span class=lnt id=hl-31-22><a class=lnlinks href=#hl-31-22> 22</a>
</span><span class=lnt id=hl-31-23><a class=lnlinks href=#hl-31-23> 23</a>
</span><span class=lnt id=hl-31-24><a class=lnlinks href=#hl-31-24> 24</a>
</span><span class=lnt id=hl-31-25><a class=lnlinks href=#hl-31-25> 25</a>
</span><span class=lnt id=hl-31-26><a class=lnlinks href=#hl-31-26> 26</a>
</span><span class=lnt id=hl-31-27><a class=lnlinks href=#hl-31-27> 27</a>
</span><span class=lnt id=hl-31-28><a class=lnlinks href=#hl-31-28> 28</a>
</span><span class=lnt id=hl-31-29><a class=lnlinks href=#hl-31-29> 29</a>
</span><span class=lnt id=hl-31-30><a class=lnlinks href=#hl-31-30> 30</a>
</span><span class=lnt id=hl-31-31><a class=lnlinks href=#hl-31-31> 31</a>
</span><span class=lnt id=hl-31-32><a class=lnlinks href=#hl-31-32> 32</a>
</span><span class=lnt id=hl-31-33><a class=lnlinks href=#hl-31-33> 33</a>
</span><span class=lnt id=hl-31-34><a class=lnlinks href=#hl-31-34> 34</a>
</span><span class=lnt id=hl-31-35><a class=lnlinks href=#hl-31-35> 35</a>
</span><span class=lnt id=hl-31-36><a class=lnlinks href=#hl-31-36> 36</a>
</span><span class=lnt id=hl-31-37><a class=lnlinks href=#hl-31-37> 37</a>
</span><span class=lnt id=hl-31-38><a class=lnlinks href=#hl-31-38> 38</a>
</span><span class=lnt id=hl-31-39><a class=lnlinks href=#hl-31-39> 39</a>
</span><span class=lnt id=hl-31-40><a class=lnlinks href=#hl-31-40> 40</a>
</span><span class=lnt id=hl-31-41><a class=lnlinks href=#hl-31-41> 41</a>
</span><span class=lnt id=hl-31-42><a class=lnlinks href=#hl-31-42> 42</a>
</span><span class=lnt id=hl-31-43><a class=lnlinks href=#hl-31-43> 43</a>
</span><span class=lnt id=hl-31-44><a class=lnlinks href=#hl-31-44> 44</a>
</span><span class=lnt id=hl-31-45><a class=lnlinks href=#hl-31-45> 45</a>
</span><span class=lnt id=hl-31-46><a class=lnlinks href=#hl-31-46> 46</a>
</span><span class=lnt id=hl-31-47><a class=lnlinks href=#hl-31-47> 47</a>
</span><span class=lnt id=hl-31-48><a class=lnlinks href=#hl-31-48> 48</a>
</span><span class=lnt id=hl-31-49><a class=lnlinks href=#hl-31-49> 49</a>
</span><span class=lnt id=hl-31-50><a class=lnlinks href=#hl-31-50> 50</a>
</span><span class=lnt id=hl-31-51><a class=lnlinks href=#hl-31-51> 51</a>
</span><span class=lnt id=hl-31-52><a class=lnlinks href=#hl-31-52> 52</a>
</span><span class=lnt id=hl-31-53><a class=lnlinks href=#hl-31-53> 53</a>
</span><span class=lnt id=hl-31-54><a class=lnlinks href=#hl-31-54> 54</a>
</span><span class=lnt id=hl-31-55><a class=lnlinks href=#hl-31-55> 55</a>
</span><span class=lnt id=hl-31-56><a class=lnlinks href=#hl-31-56> 56</a>
</span><span class=lnt id=hl-31-57><a class=lnlinks href=#hl-31-57> 57</a>
</span><span class=lnt id=hl-31-58><a class=lnlinks href=#hl-31-58> 58</a>
</span><span class=lnt id=hl-31-59><a class=lnlinks href=#hl-31-59> 59</a>
</span><span class=lnt id=hl-31-60><a class=lnlinks href=#hl-31-60> 60</a>
</span><span class=lnt id=hl-31-61><a class=lnlinks href=#hl-31-61> 61</a>
</span><span class=lnt id=hl-31-62><a class=lnlinks href=#hl-31-62> 62</a>
</span><span class=lnt id=hl-31-63><a class=lnlinks href=#hl-31-63> 63</a>
</span><span class=lnt id=hl-31-64><a class=lnlinks href=#hl-31-64> 64</a>
</span><span class=lnt id=hl-31-65><a class=lnlinks href=#hl-31-65> 65</a>
</span><span class=lnt id=hl-31-66><a class=lnlinks href=#hl-31-66> 66</a>
</span><span class=lnt id=hl-31-67><a class=lnlinks href=#hl-31-67> 67</a>
</span><span class=lnt id=hl-31-68><a class=lnlinks href=#hl-31-68> 68</a>
</span><span class=lnt id=hl-31-69><a class=lnlinks href=#hl-31-69> 69</a>
</span><span class=lnt id=hl-31-70><a class=lnlinks href=#hl-31-70> 70</a>
</span><span class=lnt id=hl-31-71><a class=lnlinks href=#hl-31-71> 71</a>
</span><span class=lnt id=hl-31-72><a class=lnlinks href=#hl-31-72> 72</a>
</span><span class=lnt id=hl-31-73><a class=lnlinks href=#hl-31-73> 73</a>
</span><span class=lnt id=hl-31-74><a class=lnlinks href=#hl-31-74> 74</a>
</span><span class=lnt id=hl-31-75><a class=lnlinks href=#hl-31-75> 75</a>
</span><span class=lnt id=hl-31-76><a class=lnlinks href=#hl-31-76> 76</a>
</span><span class=lnt id=hl-31-77><a class=lnlinks href=#hl-31-77> 77</a>
</span><span class=lnt id=hl-31-78><a class=lnlinks href=#hl-31-78> 78</a>
</span><span class=lnt id=hl-31-79><a class=lnlinks href=#hl-31-79> 79</a>
</span><span class=lnt id=hl-31-80><a class=lnlinks href=#hl-31-80> 80</a>
</span><span class=lnt id=hl-31-81><a class=lnlinks href=#hl-31-81> 81</a>
</span><span class=lnt id=hl-31-82><a class=lnlinks href=#hl-31-82> 82</a>
</span><span class=lnt id=hl-31-83><a class=lnlinks href=#hl-31-83> 83</a>
</span><span class=lnt id=hl-31-84><a class=lnlinks href=#hl-31-84> 84</a>
</span><span class=lnt id=hl-31-85><a class=lnlinks href=#hl-31-85> 85</a>
</span><span class=lnt id=hl-31-86><a class=lnlinks href=#hl-31-86> 86</a>
</span><span class=lnt id=hl-31-87><a class=lnlinks href=#hl-31-87> 87</a>
</span><span class=lnt id=hl-31-88><a class=lnlinks href=#hl-31-88> 88</a>
</span><span class=lnt id=hl-31-89><a class=lnlinks href=#hl-31-89> 89</a>
</span><span class=lnt id=hl-31-90><a class=lnlinks href=#hl-31-90> 90</a>
</span><span class=lnt id=hl-31-91><a class=lnlinks href=#hl-31-91> 91</a>
</span><span class=lnt id=hl-31-92><a class=lnlinks href=#hl-31-92> 92</a>
</span><span class=lnt id=hl-31-93><a class=lnlinks href=#hl-31-93> 93</a>
</span><span class=lnt id=hl-31-94><a class=lnlinks href=#hl-31-94> 94</a>
</span><span class=lnt id=hl-31-95><a class=lnlinks href=#hl-31-95> 95</a>
</span><span class=lnt id=hl-31-96><a class=lnlinks href=#hl-31-96> 96</a>
</span><span class=lnt id=hl-31-97><a class=lnlinks href=#hl-31-97> 97</a>
</span><span class=lnt id=hl-31-98><a class=lnlinks href=#hl-31-98> 98</a>
</span><span class=lnt id=hl-31-99><a class=lnlinks href=#hl-31-99> 99</a>
</span><span class=lnt id=hl-31-100><a class=lnlinks href=#hl-31-100>100</a>
</span><span class=lnt id=hl-31-101><a class=lnlinks href=#hl-31-101>101</a>
</span><span class=lnt id=hl-31-102><a class=lnlinks href=#hl-31-102>102</a>
</span><span class=lnt id=hl-31-103><a class=lnlinks href=#hl-31-103>103</a>
</span><span class=lnt id=hl-31-104><a class=lnlinks href=#hl-31-104>104</a>
</span><span class=lnt id=hl-31-105><a class=lnlinks href=#hl-31-105>105</a>
</span><span class=lnt id=hl-31-106><a class=lnlinks href=#hl-31-106>106</a>
</span><span class=lnt id=hl-31-107><a class=lnlinks href=#hl-31-107>107</a>
</span><span class=lnt id=hl-31-108><a class=lnlinks href=#hl-31-108>108</a>
</span><span class=lnt id=hl-31-109><a class=lnlinks href=#hl-31-109>109</a>
</span><span class=lnt id=hl-31-110><a class=lnlinks href=#hl-31-110>110</a>
</span><span class=lnt id=hl-31-111><a class=lnlinks href=#hl-31-111>111</a>
</span><span class=lnt id=hl-31-112><a class=lnlinks href=#hl-31-112>112</a>
</span><span class=lnt id=hl-31-113><a class=lnlinks href=#hl-31-113>113</a>
</span><span class=lnt id=hl-31-114><a class=lnlinks href=#hl-31-114>114</a>
</span><span class=lnt id=hl-31-115><a class=lnlinks href=#hl-31-115>115</a>
</span><span class=lnt id=hl-31-116><a class=lnlinks href=#hl-31-116>116</a>
</span><span class=lnt id=hl-31-117><a class=lnlinks href=#hl-31-117>117</a>
</span><span class=lnt id=hl-31-118><a class=lnlinks href=#hl-31-118>118</a>
</span><span class=lnt id=hl-31-119><a class=lnlinks href=#hl-31-119>119</a>
</span><span class=lnt id=hl-31-120><a class=lnlinks href=#hl-31-120>120</a>
</span><span class=lnt id=hl-31-121><a class=lnlinks href=#hl-31-121>121</a>
</span><span class=lnt id=hl-31-122><a class=lnlinks href=#hl-31-122>122</a>
</span><span class=lnt id=hl-31-123><a class=lnlinks href=#hl-31-123>123</a>
</span><span class=lnt id=hl-31-124><a class=lnlinks href=#hl-31-124>124</a>
</span><span class=lnt id=hl-31-125><a class=lnlinks href=#hl-31-125>125</a>
</span><span class=lnt id=hl-31-126><a class=lnlinks href=#hl-31-126>126</a>
</span><span class=lnt id=hl-31-127><a class=lnlinks href=#hl-31-127>127</a>
</span><span class=lnt id=hl-31-128><a class=lnlinks href=#hl-31-128>128</a>
</span><span class=lnt id=hl-31-129><a class=lnlinks href=#hl-31-129>129</a>
</span><span class=lnt id=hl-31-130><a class=lnlinks href=#hl-31-130>130</a>
</span><span class=lnt id=hl-31-131><a class=lnlinks href=#hl-31-131>131</a>
</span><span class=lnt id=hl-31-132><a class=lnlinks href=#hl-31-132>132</a>
</span><span class=lnt id=hl-31-133><a class=lnlinks href=#hl-31-133>133</a>
</span><span class=lnt id=hl-31-134><a class=lnlinks href=#hl-31-134>134</a>
</span><span class=lnt id=hl-31-135><a class=lnlinks href=#hl-31-135>135</a>
</span><span class=lnt id=hl-31-136><a class=lnlinks href=#hl-31-136>136</a>
</span><span class=lnt id=hl-31-137><a class=lnlinks href=#hl-31-137>137</a>
</span><span class=lnt id=hl-31-138><a class=lnlinks href=#hl-31-138>138</a>
</span><span class=lnt id=hl-31-139><a class=lnlinks href=#hl-31-139>139</a>
</span><span class=lnt id=hl-31-140><a class=lnlinks href=#hl-31-140>140</a>
</span><span class=lnt id=hl-31-141><a class=lnlinks href=#hl-31-141>141</a>
</span><span class=lnt id=hl-31-142><a class=lnlinks href=#hl-31-142>142</a>
</span><span class=lnt id=hl-31-143><a class=lnlinks href=#hl-31-143>143</a>
</span><span class=lnt id=hl-31-144><a class=lnlinks href=#hl-31-144>144</a>
</span><span class=lnt id=hl-31-145><a class=lnlinks href=#hl-31-145>145</a>
</span><span class=lnt id=hl-31-146><a class=lnlinks href=#hl-31-146>146</a>
</span><span class=lnt id=hl-31-147><a class=lnlinks href=#hl-31-147>147</a>
</span><span class=lnt id=hl-31-148><a class=lnlinks href=#hl-31-148>148</a>
</span><span class=lnt id=hl-31-149><a class=lnlinks href=#hl-31-149>149</a>
</span><span class=lnt id=hl-31-150><a class=lnlinks href=#hl-31-150>150</a>
</span><span class=lnt id=hl-31-151><a class=lnlinks href=#hl-31-151>151</a>
</span><span class=lnt id=hl-31-152><a class=lnlinks href=#hl-31-152>152</a>
</span><span class=lnt id=hl-31-153><a class=lnlinks href=#hl-31-153>153</a>
</span><span class=lnt id=hl-31-154><a class=lnlinks href=#hl-31-154>154</a>
</span><span class=lnt id=hl-31-155><a class=lnlinks href=#hl-31-155>155</a>
</span><span class=lnt id=hl-31-156><a class=lnlinks href=#hl-31-156>156</a>
</span><span class=lnt id=hl-31-157><a class=lnlinks href=#hl-31-157>157</a>
</span><span class=lnt id=hl-31-158><a class=lnlinks href=#hl-31-158>158</a>
</span><span class=lnt id=hl-31-159><a class=lnlinks href=#hl-31-159>159</a>
</span><span class=lnt id=hl-31-160><a class=lnlinks href=#hl-31-160>160</a>
</span><span class=lnt id=hl-31-161><a class=lnlinks href=#hl-31-161>161</a>
</span><span class=lnt id=hl-31-162><a class=lnlinks href=#hl-31-162>162</a>
</span><span class=lnt id=hl-31-163><a class=lnlinks href=#hl-31-163>163</a>
</span><span class=lnt id=hl-31-164><a class=lnlinks href=#hl-31-164>164</a>
</span><span class=lnt id=hl-31-165><a class=lnlinks href=#hl-31-165>165</a>
</span><span class=lnt id=hl-31-166><a class=lnlinks href=#hl-31-166>166</a>
</span><span class=lnt id=hl-31-167><a class=lnlinks href=#hl-31-167>167</a>
</span><span class=lnt id=hl-31-168><a class=lnlinks href=#hl-31-168>168</a>
</span><span class=lnt id=hl-31-169><a class=lnlinks href=#hl-31-169>169</a>
</span><span class=lnt id=hl-31-170><a class=lnlinks href=#hl-31-170>170</a>
</span><span class=lnt id=hl-31-171><a class=lnlinks href=#hl-31-171>171</a>
</span><span class=lnt id=hl-31-172><a class=lnlinks href=#hl-31-172>172</a>
</span><span class=lnt id=hl-31-173><a class=lnlinks href=#hl-31-173>173</a>
</span><span class=lnt id=hl-31-174><a class=lnlinks href=#hl-31-174>174</a>
</span><span class=lnt id=hl-31-175><a class=lnlinks href=#hl-31-175>175</a>
</span><span class=lnt id=hl-31-176><a class=lnlinks href=#hl-31-176>176</a>
</span><span class=lnt id=hl-31-177><a class=lnlinks href=#hl-31-177>177</a>
</span><span class=lnt id=hl-31-178><a class=lnlinks href=#hl-31-178>178</a>
</span><span class=lnt id=hl-31-179><a class=lnlinks href=#hl-31-179>179</a>
</span><span class=lnt id=hl-31-180><a class=lnlinks href=#hl-31-180>180</a>
</span><span class=lnt id=hl-31-181><a class=lnlinks href=#hl-31-181>181</a>
</span><span class=lnt id=hl-31-182><a class=lnlinks href=#hl-31-182>182</a>
</span><span class=lnt id=hl-31-183><a class=lnlinks href=#hl-31-183>183</a>
</span><span class=lnt id=hl-31-184><a class=lnlinks href=#hl-31-184>184</a>
</span><span class=lnt id=hl-31-185><a class=lnlinks href=#hl-31-185>185</a>
</span><span class=lnt id=hl-31-186><a class=lnlinks href=#hl-31-186>186</a>
</span><span class=lnt id=hl-31-187><a class=lnlinks href=#hl-31-187>187</a>
</span><span class=lnt id=hl-31-188><a class=lnlinks href=#hl-31-188>188</a>
</span><span class=lnt id=hl-31-189><a class=lnlinks href=#hl-31-189>189</a>
</span><span class=lnt id=hl-31-190><a class=lnlinks href=#hl-31-190>190</a>
</span><span class=lnt id=hl-31-191><a class=lnlinks href=#hl-31-191>191</a>
</span><span class=lnt id=hl-31-192><a class=lnlinks href=#hl-31-192>192</a>
</span><span class=lnt id=hl-31-193><a class=lnlinks href=#hl-31-193>193</a>
</span><span class=lnt id=hl-31-194><a class=lnlinks href=#hl-31-194>194</a>
</span><span class=lnt id=hl-31-195><a class=lnlinks href=#hl-31-195>195</a>
</span><span class=lnt id=hl-31-196><a class=lnlinks href=#hl-31-196>196</a>
</span><span class=lnt id=hl-31-197><a class=lnlinks href=#hl-31-197>197</a>
</span><span class=lnt id=hl-31-198><a class=lnlinks href=#hl-31-198>198</a>
</span><span class=lnt id=hl-31-199><a class=lnlinks href=#hl-31-199>199</a>
</span><span class=lnt id=hl-31-200><a class=lnlinks href=#hl-31-200>200</a>
</span><span class=lnt id=hl-31-201><a class=lnlinks href=#hl-31-201>201</a>
</span><span class=lnt id=hl-31-202><a class=lnlinks href=#hl-31-202>202</a>
</span><span class=lnt id=hl-31-203><a class=lnlinks href=#hl-31-203>203</a>
</span><span class=lnt id=hl-31-204><a class=lnlinks href=#hl-31-204>204</a>
</span><span class=lnt id=hl-31-205><a class=lnlinks href=#hl-31-205>205</a>
</span><span class=lnt id=hl-31-206><a class=lnlinks href=#hl-31-206>206</a>
</span><span class=lnt id=hl-31-207><a class=lnlinks href=#hl-31-207>207</a>
</span><span class=lnt id=hl-31-208><a class=lnlinks href=#hl-31-208>208</a>
</span><span class=lnt id=hl-31-209><a class=lnlinks href=#hl-31-209>209</a>
</span><span class=lnt id=hl-31-210><a class=lnlinks href=#hl-31-210>210</a>
</span><span class=lnt id=hl-31-211><a class=lnlinks href=#hl-31-211>211</a>
</span><span class=lnt id=hl-31-212><a class=lnlinks href=#hl-31-212>212</a>
</span><span class=lnt id=hl-31-213><a class=lnlinks href=#hl-31-213>213</a>
</span><span class=lnt id=hl-31-214><a class=lnlinks href=#hl-31-214>214</a>
</span><span class=lnt id=hl-31-215><a class=lnlinks href=#hl-31-215>215</a>
</span><span class=lnt id=hl-31-216><a class=lnlinks href=#hl-31-216>216</a>
</span><span class=lnt id=hl-31-217><a class=lnlinks href=#hl-31-217>217</a>
</span><span class=lnt id=hl-31-218><a class=lnlinks href=#hl-31-218>218</a>
</span><span class=lnt id=hl-31-219><a class=lnlinks href=#hl-31-219>219</a>
</span><span class=lnt id=hl-31-220><a class=lnlinks href=#hl-31-220>220</a>
</span><span class=lnt id=hl-31-221><a class=lnlinks href=#hl-31-221>221</a>
</span><span class=lnt id=hl-31-222><a class=lnlinks href=#hl-31-222>222</a>
</span><span class=lnt id=hl-31-223><a class=lnlinks href=#hl-31-223>223</a>
</span><span class=lnt id=hl-31-224><a class=lnlinks href=#hl-31-224>224</a>
</span><span class=lnt id=hl-31-225><a class=lnlinks href=#hl-31-225>225</a>
</span><span class=lnt id=hl-31-226><a class=lnlinks href=#hl-31-226>226</a>
</span><span class=lnt id=hl-31-227><a class=lnlinks href=#hl-31-227>227</a>
</span><span class=lnt id=hl-31-228><a class=lnlinks href=#hl-31-228>228</a>
</span><span class=lnt id=hl-31-229><a class=lnlinks href=#hl-31-229>229</a>
</span><span class=lnt id=hl-31-230><a class=lnlinks href=#hl-31-230>230</a>
</span><span class=lnt id=hl-31-231><a class=lnlinks href=#hl-31-231>231</a>
</span><span class=lnt id=hl-31-232><a class=lnlinks href=#hl-31-232>232</a>
</span><span class=lnt id=hl-31-233><a class=lnlinks href=#hl-31-233>233</a>
</span><span class=lnt id=hl-31-234><a class=lnlinks href=#hl-31-234>234</a>
</span><span class=lnt id=hl-31-235><a class=lnlinks href=#hl-31-235>235</a>
</span><span class=lnt id=hl-31-236><a class=lnlinks href=#hl-31-236>236</a>
</span><span class=lnt id=hl-31-237><a class=lnlinks href=#hl-31-237>237</a>
</span><span class=lnt id=hl-31-238><a class=lnlinks href=#hl-31-238>238</a>
</span><span class=lnt id=hl-31-239><a class=lnlinks href=#hl-31-239>239</a>
</span><span class=lnt id=hl-31-240><a class=lnlinks href=#hl-31-240>240</a>
</span><span class=lnt id=hl-31-241><a class=lnlinks href=#hl-31-241>241</a>
</span><span class=lnt id=hl-31-242><a class=lnlinks href=#hl-31-242>242</a>
</span><span class=lnt id=hl-31-243><a class=lnlinks href=#hl-31-243>243</a>
</span><span class=lnt id=hl-31-244><a class=lnlinks href=#hl-31-244>244</a>
</span><span class=lnt id=hl-31-245><a class=lnlinks href=#hl-31-245>245</a>
</span><span class=lnt id=hl-31-246><a class=lnlinks href=#hl-31-246>246</a>
</span><span class=lnt id=hl-31-247><a class=lnlinks href=#hl-31-247>247</a>
</span><span class=lnt id=hl-31-248><a class=lnlinks href=#hl-31-248>248</a>
</span><span class=lnt id=hl-31-249><a class=lnlinks href=#hl-31-249>249</a>
</span><span class=lnt id=hl-31-250><a class=lnlinks href=#hl-31-250>250</a>
</span><span class=lnt id=hl-31-251><a class=lnlinks href=#hl-31-251>251</a>
</span><span class=lnt id=hl-31-252><a class=lnlinks href=#hl-31-252>252</a>
</span><span class=lnt id=hl-31-253><a class=lnlinks href=#hl-31-253>253</a>
</span><span class=lnt id=hl-31-254><a class=lnlinks href=#hl-31-254>254</a>
</span><span class=lnt id=hl-31-255><a class=lnlinks href=#hl-31-255>255</a>
</span><span class=lnt id=hl-31-256><a class=lnlinks href=#hl-31-256>256</a>
</span><span class=lnt id=hl-31-257><a class=lnlinks href=#hl-31-257>257</a>
</span><span class=lnt id=hl-31-258><a class=lnlinks href=#hl-31-258>258</a>
</span><span class=lnt id=hl-31-259><a class=lnlinks href=#hl-31-259>259</a>
</span><span class=lnt id=hl-31-260><a class=lnlinks href=#hl-31-260>260</a>
</span><span class=lnt id=hl-31-261><a class=lnlinks href=#hl-31-261>261</a>
</span><span class=lnt id=hl-31-262><a class=lnlinks href=#hl-31-262>262</a>
</span><span class=lnt id=hl-31-263><a class=lnlinks href=#hl-31-263>263</a>
</span><span class=lnt id=hl-31-264><a class=lnlinks href=#hl-31-264>264</a>
</span><span class=lnt id=hl-31-265><a class=lnlinks href=#hl-31-265>265</a>
</span><span class=lnt id=hl-31-266><a class=lnlinks href=#hl-31-266>266</a>
</span><span class=lnt id=hl-31-267><a class=lnlinks href=#hl-31-267>267</a>
</span><span class=lnt id=hl-31-268><a class=lnlinks href=#hl-31-268>268</a>
</span><span class=lnt id=hl-31-269><a class=lnlinks href=#hl-31-269>269</a>
</span><span class=lnt id=hl-31-270><a class=lnlinks href=#hl-31-270>270</a>
</span><span class=lnt id=hl-31-271><a class=lnlinks href=#hl-31-271>271</a>
</span><span class=lnt id=hl-31-272><a class=lnlinks href=#hl-31-272>272</a>
</span><span class=lnt id=hl-31-273><a class=lnlinks href=#hl-31-273>273</a>
</span><span class=lnt id=hl-31-274><a class=lnlinks href=#hl-31-274>274</a>
</span><span class=lnt id=hl-31-275><a class=lnlinks href=#hl-31-275>275</a>
</span><span class=lnt id=hl-31-276><a class=lnlinks href=#hl-31-276>276</a>
</span><span class=lnt id=hl-31-277><a class=lnlinks href=#hl-31-277>277</a>
</span><span class=lnt id=hl-31-278><a class=lnlinks href=#hl-31-278>278</a>
</span><span class=lnt id=hl-31-279><a class=lnlinks href=#hl-31-279>279</a>
</span><span class=lnt id=hl-31-280><a class=lnlinks href=#hl-31-280>280</a>
</span><span class=lnt id=hl-31-281><a class=lnlinks href=#hl-31-281>281</a>
</span><span class=lnt id=hl-31-282><a class=lnlinks href=#hl-31-282>282</a>
</span><span class=lnt id=hl-31-283><a class=lnlinks href=#hl-31-283>283</a>
</span><span class=lnt id=hl-31-284><a class=lnlinks href=#hl-31-284>284</a>
</span><span class=lnt id=hl-31-285><a class=lnlinks href=#hl-31-285>285</a>
</span><span class=lnt id=hl-31-286><a class=lnlinks href=#hl-31-286>286</a>
</span><span class=lnt id=hl-31-287><a class=lnlinks href=#hl-31-287>287</a>
</span><span class=lnt id=hl-31-288><a class=lnlinks href=#hl-31-288>288</a>
</span><span class=lnt id=hl-31-289><a class=lnlinks href=#hl-31-289>289</a>
</span><span class=lnt id=hl-31-290><a class=lnlinks href=#hl-31-290>290</a>
</span><span class=lnt id=hl-31-291><a class=lnlinks href=#hl-31-291>291</a>
</span><span class=lnt id=hl-31-292><a class=lnlinks href=#hl-31-292>292</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Netflix 동영상 추천 시스템 CQRS 구현 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Events</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserWatchedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserRatedEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Commands</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WatchContentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RateContentCommand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command Handlers</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ContentCommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_watch_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>WatchContentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>UserWatchedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>watch_duration</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>watch_duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Store에 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=s2>&#34;user_interactions&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Event Bus로 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_rate_content</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>RateContentCommand</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>UserRatedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>content_id</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>rating</span><span class=o>=</span><span class=n>command</span><span class=o>.</span><span class=n>rating</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_event</span><span class=p>(</span><span class=s2>&#34;user_ratings&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;rating_recorded&#34;</span><span class=p>:</span> <span class=n>command</span><span class=o>.</span><span class=n>rating</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Models</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationModel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>recommended_contents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>last_updated</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserProfileModel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>preferences</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span>  <span class=c1># 장르별 선호도</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>average_rating</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Query Handlers</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationQueryHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendation_store</span><span class=p>,</span> <span class=n>profile_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>recommendation_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span> <span class=o>=</span> <span class=n>profile_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자별 개인화 추천 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>recommendations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 기본 추천 반환</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_recommendations</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>recommended_contents</span><span class=p>[:</span><span class=n>limit</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;last_updated&#34;</span><span class=p>:</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>last_updated</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_user_profile</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사용자 프로필 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Profile not found&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;preferences&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>preferences</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;watch_history_count&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>profile</span><span class=o>.</span><span class=n>watch_history</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;average_rating&#34;</span><span class=p>:</span> <span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_get_default_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;기본 추천 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;popular_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;popular&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Handlers (Projections)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationProjectionHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>recommendation_store</span><span class=p>,</span> <span class=n>ml_service</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>recommendation_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ml_service</span> <span class=o>=</span> <span class=n>ml_service</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_watched_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>UserWatchedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시청 이벤트 처리하여 추천 모델 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># ML 서비스를 통해 새로운 추천 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>new_recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>ml_service</span><span class=o>.</span><span class=n>calculate_recommendations</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>content_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>watch_duration</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추천 모델 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendation_model</span> <span class=o>=</span> <span class=n>RecommendationModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>recommended_contents</span><span class=o>=</span><span class=n>new_recommendations</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>last_updated</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>recommendation_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>recommendation_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_user_rated_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>UserRatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;평점 이벤트 처리하여 사용자 프로필 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 프로필 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>get_by_user</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>profile</span> <span class=o>=</span> <span class=n>UserProfileModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>user_id</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>preferences</span><span class=o>=</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>                <span class=n>watch_history</span><span class=o>=</span><span class=p>[],</span>
</span></span><span class=line><span class=cl>                <span class=n>average_rating</span><span class=o>=</span><span class=n>event</span><span class=o>.</span><span class=n>rating</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 평균 평점 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span> <span class=o>=</span> <span class=p>(</span><span class=n>profile</span><span class=o>.</span><span class=n>average_rating</span> <span class=o>+</span> <span class=n>event</span><span class=o>.</span><span class=n>rating</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>profile_store</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>profile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Bus 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>event</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=n>handler</span><span class=p>(</span><span class=n>event</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handlers</span><span class=p>[</span><span class=n>event_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Store 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>append_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stream_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>stream_name</span><span class=p>])</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>stream_name</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 저장소 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>RecommendationModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_by_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProfileStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>UserProfileModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_by_user</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ML 서비스 모의 구현</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommendationMLService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>calculate_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>watch_duration</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제로는 복잡한 ML 알고리즘 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;content_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;rec_</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.9</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 시스템 구성 및 실행 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 인프라 구성</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendation_store</span> <span class=o>=</span> <span class=n>RecommendationStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>profile_store</span> <span class=o>=</span> <span class=n>ProfileStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ml_service</span> <span class=o>=</span> <span class=n>RecommendationMLService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Handler 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>command_handler</span> <span class=o>=</span> <span class=n>ContentCommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>query_handler</span> <span class=o>=</span> <span class=n>RecommendationQueryHandler</span><span class=p>(</span><span class=n>recommendation_store</span><span class=p>,</span> <span class=n>profile_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>projection_handler</span> <span class=o>=</span> <span class=n>RecommendationProjectionHandler</span><span class=p>(</span><span class=n>recommendation_store</span><span class=p>,</span> <span class=n>ml_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Event 구독 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;UserWatchedEvent&#34;</span><span class=p>,</span> <span class=n>projection_handler</span><span class=o>.</span><span class=n>handle_user_watched_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;UserRatedEvent&#34;</span><span class=p>,</span> <span class=n>projection_handler</span><span class=o>.</span><span class=n>handle_user_rated_event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Command 실행 (쓰기 작업)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== Command 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>watch_command</span> <span class=o>=</span> <span class=n>WatchContentCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s2>&#34;movie456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>watch_duration</span><span class=o>=</span><span class=mi>7200</span>  <span class=c1># 2시간</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_watch_content</span><span class=p>(</span><span class=n>watch_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;시청 기록 저장: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>rate_command</span> <span class=o>=</span> <span class=n>RateContentCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span><span class=o>=</span><span class=s2>&#34;user123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span><span class=o>=</span><span class=s2>&#34;movie456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>rating</span><span class=o>=</span><span class=mf>4.5</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>command_handler</span><span class=o>.</span><span class=n>handle_rate_content</span><span class=p>(</span><span class=n>rate_command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;평점 저장: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 처리 대기 (실제로는 비동기로 처리됨)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Query 실행 (읽기 작업)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== Query 실행 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendations</span> <span class=o>=</span> <span class=k>await</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_recommendations</span><span class=p>(</span><span class=s2>&#34;user123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;개인화 추천: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendations</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>profile</span> <span class=o>=</span> <span class=k>await</span> <span class=n>query_handler</span><span class=o>.</span><span class=n>get_user_profile</span><span class=p>(</span><span class=s2>&#34;user123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용자 프로필: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>profile</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>20. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>도메인 복잡성 평가</td><td>CQRS가 필요한 복잡성인지 판단</td><td>단순한 CRUD는 전통적 방식 유지</td></tr><tr><td>설계</td><td>경계 컨텍스트 정의</td><td>DDD의 Bounded Context 내에서만 적용</td><td>전체 시스템이 아닌 특정 영역에만 적용</td></tr><tr><td>구현</td><td>점진적 도입</td><td>한 번에 모든 것을 변경하지 않음</td><td>레거시 시스템과의 공존 전략 수립</td></tr><tr><td>구현</td><td>데이터 일관성 정책</td><td>비즈니스 요구사항에 맞는 일관성 수준</td><td>최종 일관성 허용 범위 명확히 정의</td></tr><tr><td>운영</td><td>모니터링 체계 구축</td><td>분산 시스템의 상태 추적</td><td>분산 추적, 메트릭 수집 도구 도입</td></tr><tr><td>운영</td><td>장애 복구 전략</td><td>이벤트 재처리 및 보상 트랜잭션</td><td>Dead Letter Queue, 재시도 로직 구현</td></tr><tr><td>팀</td><td>학습 곡선 관리</td><td>팀의 기술적 역량 고려</td><td>교육 프로그램, 파일럿 프로젝트 실행</td></tr><tr><td>팀</td><td>역할 분리</td><td>Command/Query 담당 팀 구분</td><td>Conway&rsquo;s Law에 따른 팀 구조 조정</td></tr></tbody></table><hr><h2 id=21-최적화하기-위한-고려사항-및-주의할-점-1>21. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#21-최적화하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>성능</td><td>이벤트 스트림 최적화</td><td>대용량 이벤트 처리 성능 향상</td><td>파티셔닝, 병렬 처리, 배치 처리</td></tr><tr><td>성능</td><td>캐싱 전략</td><td>Read Model의 응답 속도 향상</td><td>Redis, CDN 활용한 다계층 캐싱</td></tr><tr><td>성능</td><td>스냅샷 구현</td><td>이벤트 재생 성능 최적화</td><td>정기적 스냅샷 생성, 증분 업데이트</td></tr><tr><td>확장성</td><td>수평 확장 설계</td><td>트래픽 증가에 대비한 확장성</td><td>샤딩, 로드 밸런싱, 자동 확장</td></tr><tr><td>확장성</td><td>데이터 파티셔닝</td><td>대용량 데이터 효율적 처리</td><td>시간 기반, 해시 기반 파티셔닝</td></tr><tr><td>보안</td><td>접근 제어</td><td>읽기/쓰기 권한 분리 관리</td><td>RBAC, API 게이트웨이 활용</td></tr><tr><td>보안</td><td>데이터 암호화</td><td>민감한 데이터 보호</td><td>전송/저장 시 암호화, 키 관리</td></tr><tr><td>비용</td><td>리소스 최적화</td><td>불필요한 중복 제거</td><td>리소스 사용량 모니터링, 자동 스케일링</td></tr><tr><td>비용</td><td>저장소 비용 관리</td><td>이벤트 스토어 크기 관리</td><td>데이터 아카이빙, 압축 정책</td></tr></tbody></table><hr><h2 id=22-기타-사항>22. 기타 사항<a hidden class=anchor aria-hidden=true href=#22-기타-사항>#</a></h2><h3 id=cqrs와-관련된-현대적-트렌드>CQRS와 관련된 현대적 트렌드<a hidden class=anchor aria-hidden=true href=#cqrs와-관련된-현대적-트렌드>#</a></h3><ul><li><strong>서버리스 아키텍처</strong>: AWS Lambda, Azure Functions를 활용한 이벤트 기반 CQRS 구현</li><li><strong>컨테이너 오케스트레이션</strong>: Kubernetes를 이용한 CQRS 컴포넌트 배포 및 관리</li><li><strong>클라우드 네이티브</strong>: 완전 관리형 서비스를 활용한 CQRS 구현 (Amazon EventBridge, Azure Service Bus)</li></ul><h3 id=산업별-적용-사례>산업별 적용 사례<a hidden class=anchor aria-hidden=true href=#산업별-적용-사례>#</a></h3><ul><li><strong>금융</strong>: 거래 처리와 실시간 리스크 분석 분리</li><li><strong>전자상거래</strong>: 주문 처리와 상품 검색/추천 분리</li><li><strong>게임</strong>: 게임 상태 업데이트와 리더보드/통계 조회 분리</li><li><strong>IoT</strong>: 센서 데이터 수집과 분석/대시보드 분리</li></ul><h3 id=미래-발전-방향>미래 발전 방향<a hidden class=anchor aria-hidden=true href=#미래-발전-방향>#</a></h3><ul><li><strong>AI/ML 통합</strong>: 실시간 기계학습 모델 업데이트와 CQRS 결합</li><li><strong>엣지 컴퓨팅</strong>: 분산된 엣지 환경에서의 CQRS 패턴 적용</li><li><strong>블록체인</strong>: 불변 이벤트 스토어로서의 블록체인 활용</li></ul><hr><h2 id=주제와-관련하여-주목할-내용-1>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용-1>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처 패턴</td><td>Event Sourcing</td><td>이벤트 기반 저장</td><td>모든 상태 변경을 이벤트로 저장하는 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Saga Pattern</td><td>분산 트랜잭션</td><td>분산 환경에서의 트랜잭션 관리 패턴</td></tr><tr><td>아키텍처 패턴</td><td>Domain-Driven Design</td><td>도메인 중심 설계</td><td>복잡한 비즈니스 로직을 효과적으로 모델링</td></tr><tr><td>기술 스택</td><td>Apache Kafka</td><td>이벤트 스트리밍</td><td>대용량 실시간 이벤트 처리 플랫폼</td></tr><tr><td>기술 스택</td><td>Event Store DB</td><td>이벤트 저장소</td><td>Event Sourcing 전용 데이터베이스</td></tr><tr><td>기술 스택</td><td>Axon Framework</td><td>CQRS/ES 프레임워크</td><td>Java 기반 CQRS 및 Event Sourcing 구현</td></tr><tr><td>데이터베이스</td><td>Event Store</td><td>이벤트 저장</td><td>이벤트를 저장하는 전용 데이터베이스</td></tr><tr><td>데이터베이스</td><td>Read Replicas</td><td>읽기 전용 복제본</td><td>읽기 성능 향상을 위한 데이터 복제</td></tr><tr><td>데이터베이스</td><td>Materialized Views</td><td>구체화된 뷰</td><td>미리 계산된 조회 결과 저장</td></tr><tr><td>메시징</td><td>Command Bus</td><td>명령 라우팅</td><td>명령을 적절한 핸들러로 전달</td></tr><tr><td>메시징</td><td>Event Bus</td><td>이벤트 발행</td><td>이벤트를 구독자에게 전달</td></tr><tr><td>메시징</td><td>Message Broker</td><td>메시지 중개</td><td>시스템 간 비동기 통신 중개</td></tr></tbody></table><hr><h2 id=주제와-관련하여-반드시-학습해야-할-내용>주제와 관련하여 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>CQS 원칙</td><td>Command Query Separation</td><td>CQRS의 이론적 기반이 되는 원칙</td></tr><tr><td>기본 개념</td><td>최종 일관성</td><td>Eventual Consistency</td><td>분산 시스템에서의 일관성 모델</td></tr><tr><td>기본 개념</td><td>CAP 정리</td><td>CAP Theorem</td><td>분산 시스템의 한계와 트레이드오프</td></tr><tr><td>설계 패턴</td><td>Domain Events</td><td>도메인 이벤트</td><td>비즈니스 로직에서 발생하는 중요한 사건</td></tr><tr><td>설계 패턴</td><td>Aggregate Pattern</td><td>집합체 패턴</td><td>DDD의 핵심 빌딩 블록</td></tr><tr><td>설계 패턴</td><td>Repository Pattern</td><td>저장소 패턴</td><td>데이터 접근 로직 캡슐화</td></tr><tr><td>구현 기술</td><td>Event Streaming</td><td>이벤트 스트리밍</td><td>실시간 이벤트 처리 기술</td></tr><tr><td>구현 기술</td><td>Projection</td><td>프로젝션</td><td>이벤트에서 뷰 모델 생성</td></tr><tr><td>구현 기술</td><td>Snapshot</td><td>스냅샷</td><td>성능 최적화를 위한 상태 저장</td></tr><tr><td>운영 관리</td><td>Monitoring</td><td>모니터링</td><td>분산 시스템 상태 추적</td></tr><tr><td>운영 관리</td><td>Circuit Breaker</td><td>회로 차단기</td><td>장애 전파 방지 패턴</td></tr><tr><td>운영 관리</td><td>Dead Letter Queue</td><td>실패 메시지 처리</td><td>처리 실패한 메시지 관리</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>Bounded Context</td><td>DDD에서 모델의 경계를 정의하는 개념</td></tr><tr><td>아키텍처</td><td>Microservices</td><td>독립적으로 배포 가능한 작은 서비스들의 집합</td></tr><tr><td>아키텍처</td><td>Service Mesh</td><td>마이크로서비스 간 통신을 관리하는 인프라 계층</td></tr><tr><td>데이터</td><td>Polyglot Persistence</td><td>다양한 데이터베이스를 용도에 맞게 선택 사용</td></tr><tr><td>데이터</td><td>Denormalization</td><td>성능 향상을 위한 데이터 중복 허용</td></tr><tr><td>데이터</td><td>Sharding</td><td>대용량 데이터를 여러 DB에 분산 저장</td></tr><tr><td>메시징</td><td>At-least-once</td><td>메시지가 최소 한 번은 전달됨을 보장</td></tr><tr><td>메시징</td><td>Exactly-once</td><td>메시지가 정확히 한 번만 전달됨을 보장</td></tr><tr><td>메시징</td><td>Idempotent</td><td>동일한 연산을 여러 번 수행해도 결과가 같음</td></tr><tr><td>성능</td><td>Horizontal Scaling</td><td>서버 수를 늘려 성능을 향상시키는 방식</td></tr><tr><td>성능</td><td>Vertical Scaling</td><td>서버 사양을 높여 성능을 향상시키는 방식</td></tr><tr><td>성능</td><td>Load Balancing</td><td>여러 서버에 부하를 분산시키는 기술</td></tr><tr><td>보안</td><td>RBAC</td><td>Role-Based Access Control, 역할 기반 접근 제어</td></tr><tr><td>보안</td><td>OAuth 2.0</td><td>인증 및 권한 부여를 위한 개방형 표준</td></tr><tr><td>보안</td><td>JWT</td><td>JSON Web Token, 안전한 정보 전송을 위한 토큰</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS Pattern - Azure Architecture Center</a></li><li><a href=https://www.martinfowler.com/bliki/CQRS.html>Martin Fowler - CQRS</a></li><li><a href=https://www.geeksforgeeks.org/cqrs-command-query-responsibility-segregation/>Command Query Responsibility Segregation - GeeksforGeeks</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html>CQRS pattern - AWS Prescriptive Guidance</a></li><li><a href=https://microservices.io/patterns/data/cqrs.html>Microservices Pattern: CQRS</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>Event Sourcing and CQRS - Baeldung</a></li><li><a href=https://www.confluent.io/learn/cqrs/>Command Query Responsibility Segregation - Confluent</a></li><li><a href=https://www.techtarget.com/searchapparchitecture/definition/CQRS-command-query-responsibility-segregation>CQRS Design Pattern - TechTarget</a></li><li><a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>Understanding Event Sourcing and CQRS Pattern - Mia-Platform</a></li><li><a href=https://www.kurrent.io/cqrs-pattern>A Beginner&rsquo;s Guide to CQRS - Kurrent</a></li></ul><hr><p>CQRS(Command Query Responsibility Segregation)는 마이크로서비스 아키텍처(MSA)에서 중요한 패턴 중 하나이다.<br>CQRS는 시스템의 명령(Command)과 조회(Query) 작업을 분리하여 각각의 책임을 명확히 하는 패턴이다.</p><p>CQRS는 다음과 같은 핵심 개념을 가지고 있다:</p><ol><li><strong>명령(Command)</strong>: 시스템의 상태를 변경하는 작업 (예: 주문하기, 회원가입)</li><li><strong>조회(Query)</strong>: 시스템의 상태를 조회하는 작업 (예: 주문 목록 조회, 회원 정보 조회)</li><li><strong>책임 분리(Responsibility Segregation)</strong>: 명령과 조회 작업을 별도의 모델로 분리</li></ol><p>CQRS 패턴은 시스템의 성능, 확장성, 유지보수성을 향상시킬 수 있는 강력한 도구이다. 하지만 모든 시스템에 적합한 것은 아니므로, 프로젝트의 요구사항과 특성을 고려하여 적용 여부를 신중히 결정해야 한다.<br>CQRS를 효과적으로 구현하기 위해서는 명령과 조회 모델의 분리, 데이터 동기화 전략, 그리고 전체 시스템 아키텍처에 대한 깊은 이해가 필요하다.</p><h3 id=cqrs의-구현-방식>CQRS의 구현 방식<a hidden class=anchor aria-hidden=true href=#cqrs의-구현-방식>#</a></h3><p>CQRS는 다양한 방식으로 구현될 수 있다:</p><ol><li><strong>같은 프로세스, 같은 DB</strong>: 가장 단순한 형태로, 코드 수준에서만 명령과 조회를 분리한다.</li><li><strong>같은 프로세스, 다른 DB</strong>: 명령용 DB와 조회용 DB를 분리하여 사용한다.</li><li><strong>다른 프로세스, 다른 DB</strong>: MSA와 유사한 구조로, 프로세스와 DB를 모두 분리한다.</li></ol><h3 id=cqrs의-장점>CQRS의 장점<a hidden class=anchor aria-hidden=true href=#cqrs의-장점>#</a></h3><ol><li><strong>성능 최적화</strong>: 읽기와 쓰기 작업을 독립적으로 최적화할 수 있다.</li><li><strong>확장성 향상</strong>: 읽기와 쓰기 모델을 독립적으로 확장할 수 있다.</li><li><strong>복잡성 감소</strong>: 명령과 조회 모델을 분리함으로써 각 모델의 복잡성을 줄일 수 있다.</li><li><strong>보안 강화</strong>: 읽기와 쓰기 작업에 대한 접근 제어를 별도로 설정할 수 있다.</li></ol><h3 id=cqrs의-단점>CQRS의 단점<a hidden class=anchor aria-hidden=true href=#cqrs의-단점>#</a></h3><ol><li><strong>구현 복잡도 증가</strong>: 명령과 조회 모델을 분리하면 전체적인 시스템 구조가 복잡해질 수 있다.</li><li><strong>데이터 일관성 관리</strong>: 명령과 조회 모델 간의 데이터 동기화가 필요하다.</li><li><strong>추가 인프라 필요</strong>: 분리된 모델을 관리하기 위한 추가적인 인프라가 필요할 수 있다.</li></ol><h3 id=cqrs-적용-시-고려사항>CQRS 적용 시 고려사항<a hidden class=anchor aria-hidden=true href=#cqrs-적용-시-고려사항>#</a></h3><ol><li><strong>데이터 동기화</strong>: 명령 모델과 조회 모델 간의 데이터 동기화 방법을 신중히 선택해야 한다.</li><li><strong>일관성 지연</strong>: 데이터 동기화 과정에서 일시적인 불일치가 발생할 수 있음을 고려해야 한다.</li><li><strong>복잡성 관리</strong>: CQRS 패턴 도입으로 인한 시스템 복잡도 증가를 관리해야 한다.</li></ol><h3 id=cqrs-적용-사례>CQRS 적용 사례<a hidden class=anchor aria-hidden=true href=#cqrs-적용-사례>#</a></h3><ol><li><strong>이커머스 시스템</strong>: 상품 조회와 주문 처리를 분리하여 성능을 최적화할 수 있다.</li><li><strong>금융 거래 시스템</strong>: 거래 기록과 잔액 조회를 분리하여 데이터 정합성을 유지할 수 있다.</li><li><strong>소셜 네트워크 서비스</strong>: 사용자 활동 데이터의 실시간 조회와 분석을 효율적으로 처리할 수 있다.</li></ol><h3 id=cqrs와-이벤트-소싱>CQRS와 이벤트 소싱<a hidden class=anchor aria-hidden=true href=#cqrs와-이벤트-소싱>#</a></h3><p>CQRS는 <strong>이벤트 소싱</strong>과 함께 사용되는 경우가 많다.<br>이벤트 소싱은 시스템의 상태 변화를 이벤트로 저장하고, 이러한 이벤트의 흐름을 재생하여 현재 상태를 구성하는 방식이다. 이를 통해:</p><ul><li><strong>데이터의 변경 이력 추적</strong>: 모든 상태 변화를 이벤트로 저장하여 변경 이력을 추적할 수 있다.</li><li><strong>복잡한 비즈니스 로직 처리</strong>: 이벤트를 기반으로 비즈니스 로직을 처리하여 복잡성을 관리할 수 있다.<br>이벤트 소싱과 CQRS의 결합은 시스템의 유연성과 확장성을 높이지만, 구현의 복잡성을 증가시킬 수 있으므로 신중한 설계가 필요하다.</li></ul><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32>32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33>33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34>34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35>35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36>36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37>37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38>38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39>39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40>40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41>41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42>42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43>43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44>44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45>45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46>46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47>47</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Command 모델 (쓰기 작업을 위한 모델)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCommandModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>totalAmount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orderId</span> <span class=o>=</span> <span class=nx>orderId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>userId</span> <span class=o>=</span> <span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>totalAmount</span> <span class=o>=</span> <span class=nx>totalAmount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=s1>&#39;PENDING&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 생성 명령
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderCommandModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderData</span><span class=p>.</span><span class=nx>totalAmount</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>EventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 커맨드 데이터베이스에 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>CommandDatabase</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query 모델 (읽기 작업을 위한 모델)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderQueryModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>orders</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>orderId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 전용 데이터베이스에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>findOne</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>orderId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자의 모든 주문 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>getUserOrders</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 최적화된 읽기 전용 뷰에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cqrs-구현의-주요-구성요소-예시>CQRS 구현의 주요 구성요소 예시<a hidden class=anchor aria-hidden=true href=#cqrs-구현의-주요-구성요소-예시>#</a></h4><ol><li><p>Command 처리기</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;CREATE_ORDER&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;UPDATE_ORDER_STATUS&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleUpdateOrderStatus</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Unknown command type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 유효성 검증
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>validateCreateOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 비즈니스 로직 수행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>OrderCommandModel</span><span class=p>.</span><span class=nx>createOrder</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishOrderCreatedEvent</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Query 처리기</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22>22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23>23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24>24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25>25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26>26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27>27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28>28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29>29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderQueryHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>readModel</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderQueryModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;GET_ORDER&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleGetOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;GET_USER_ORDERS&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleGetUserOrders</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Unknown query type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleGetOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>cachedOrder</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`order:</span><span class=si>${</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>cachedOrder</span><span class=p>)</span> <span class=k>return</span> <span class=nx>cachedOrder</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 데이터베이스에서 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>readModel</span><span class=p>.</span><span class=nx>getOrder</span><span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=sb>`order:</span><span class=si>${</span><span class=nx>query</span><span class=p>.</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>이벤트 동기화</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OrderEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleOrderCreated</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 모델 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>orderData</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 읽기 전용 데이터베이스에 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>QueryDatabase</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>userId</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAmount</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=nx>orderData</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>createdAt</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 캐시 무효화
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>Cache</span><span class=p>.</span><span class=nx>invalidate</span><span class=p>(</span><span class=sb>`user:</span><span class=si>${</span><span class=nx>orderData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>:orders`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=주문-시스템-예제>주문 시스템 예제<a hidden class=anchor aria-hidden=true href=#주문-시스템-예제>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22>22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23>23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24>24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25>25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26>26</a>
</span><span class=lnt id=hl-36-27><a class=lnlinks href=#hl-36-27>27</a>
</span><span class=lnt id=hl-36-28><a class=lnlinks href=#hl-36-28>28</a>
</span><span class=lnt id=hl-36-29><a class=lnlinks href=#hl-36-29>29</a>
</span><span class=lnt id=hl-36-30><a class=lnlinks href=#hl-36-30>30</a>
</span><span class=lnt id=hl-36-31><a class=lnlinks href=#hl-36-31>31</a>
</span><span class=lnt id=hl-36-32><a class=lnlinks href=#hl-36-32>32</a>
</span><span class=lnt id=hl-36-33><a class=lnlinks href=#hl-36-33>33</a>
</span><span class=lnt id=hl-36-34><a class=lnlinks href=#hl-36-34>34</a>
</span><span class=lnt id=hl-36-35><a class=lnlinks href=#hl-36-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// API 엔드포인트 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>commandHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderCommandHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>queryHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OrderQueryHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;CREATE_ORDER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>payload</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>query</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;GET_ORDER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>orderId</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>queryHandler</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><hr></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>