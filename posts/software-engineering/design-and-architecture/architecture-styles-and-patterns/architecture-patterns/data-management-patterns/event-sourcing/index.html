<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Event Sourcing | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Patterns,Data-Management-Patterns,Event-Sourcing"><meta name=description content="이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/event-sourcing/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/event-sourcing/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/event-sourcing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/event-sourcing/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Event Sourcing"><meta property="og:description" content="이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Event Sourcing"><meta name=twitter:description content="이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Event Sourcing","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/data-management-patterns/event-sourcing/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Event Sourcing</h1><div class=post-description>이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다.</div></header><div class=post-content><h2 id=event-sourcing>Event Sourcing<a hidden class=anchor aria-hidden=true href=#event-sourcing>#</a></h2><p>아래는 “Event Sourcing(이벤트 소싱)” 주제에 대해 요청하신 모든 항목을 체계적으로 정리한 결과입니다.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li><strong>Event-Sourcing</strong></li><li><strong>Architecture-Patterns</strong></li><li><strong>Data-Management-Patterns</strong></li><li><strong>Software-Engineering</strong></li></ul><hr><h2 id=2-분류-구조-적합성-분석>2. 분류 구조 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적합성-분석>#</a></h2><p><strong>현재 분류 구조</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Computer Science and Engineering
</span></span><span class=line><span class=cl>└─ Software Engineering
</span></span><span class=line><span class=cl>   └─ Design and Architecture
</span></span><span class=line><span class=cl>      └─ Architecture Patterns
</span></span><span class=line><span class=cl>         └─ Data Management Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>분석 및 근거</strong><br>이벤트 소싱은 소프트웨어 엔지니어링의 디자인 및 아키텍처 패턴 중 하나로, 데이터 관리 패턴의 대표적 예시입니다.<br>이벤트 소싱은 시스템의 상태 변화를 이벤트로 기록하고, 이벤트 스트림을 통해 상태를 재구성하므로,<br>“Data Management Patterns” 하위에 배치하는 것이 적절합니다.<br>또한, 아키텍처 패턴과 소프트웨어 엔지니어링 분야에 속하므로 현재 분류 구조가 타당합니다.</p><hr><h2 id=3-요약-문장-200자-내외>3. 요약 문장 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-문장-200자-내외>#</a></h2><p>이벤트 소싱은 시스템의 모든 상태 변화를 이벤트로 기록하고, 필요 시 이벤트 스트림을 재생해 상태를 재구성하는 데이터 관리 아키텍처 패턴이다.</p><hr><h2 id=4-전체-개요-250자-내외>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외>#</a></h2><p>이벤트 소싱은 시스템의 상태 변화를 이벤트로 기록해 저장하며, 이벤트 스트림을 통해 시스템의 현재 상태를 재구성할 수 있는 아키텍처 패턴이다. 이를 통해 데이터 무결성, 감사, 복구, 분석 등 다양한 이점을 얻을 수 있다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>이벤트 소싱(Event Sourcing)</strong><ul><li>시스템의 모든 상태 변화를 이벤트(불변의 기록)로 저장.</li><li>현재 상태는 이벤트 스트림을 재생(재생산)하여 얻음.</li><li>이벤트는 원본 데이터로 간주, 시스템의 상태 변화 이력이 모두 보존됨.</li><li><strong>실무 구현 연관성</strong><ul><li>이벤트 스트림 저장 및 관리(이벤트 저장소, 스트림 처리)</li><li>이벤트 기반 시스템 설계(이벤트 발행, 구독, 처리)</li><li>상태 재구성(이벤트 재생산, 스냅샷 활용)</li><li>감사, 데이터 무결성, 트랜잭션 로그, 복구 등 다양한 실무 요구에 부합</li></ul></li></ul></li></ul><hr><h2 id=6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>6. 조사 및 분석: “주제와 관련하여 조사할 내용” 중심 정리<a hidden class=anchor aria-hidden=true href=#6-조사-및-분석-주제와-관련하여-조사할-내용-중심-정리>#</a></h2><h3 id=1-배경>(1) 배경<a hidden class=anchor aria-hidden=true href=#1-배경>#</a></h3><ul><li>기존 시스템은 현재 상태만 저장, 이력 추적 및 감사, 복구가 어려움.</li><li>복잡한 비즈니스 도메인에서 상태 변화 이력 관리 필요성 증대.</li></ul><h3 id=2-목적-및-필요성>(2) 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#2-목적-및-필요성>#</a></h3><ul><li>상태 변화의 완전한 이력 보존.</li><li>감사, 복구, 분석, 데이터 무결성 보장.</li><li>시스템의 현재 상태를 언제든지 재구성 가능.</li></ul><h3 id=3-주요-기능-및-역할>(3) 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#3-주요-기능-및-역할>#</a></h3><ul><li><strong>이벤트 저장</strong>: 상태 변화를 이벤트로 저장.</li><li><strong>이벤트 스트림</strong>: 이벤트의 연속된 흐름.</li><li><strong>상태 재구성</strong>: 이벤트 스트림을 재생하여 현재 상태 도출.</li><li><strong>감사 및 복구</strong>: 이벤트 이력 기반 감사, 복구, 분석.</li></ul><h3 id=4-특징>(4) 특징<a hidden class=anchor aria-hidden=true href=#4-특징>#</a></h3><ul><li>상태 변화 이력의 완전한 보존.</li><li>불변 데이터(이벤트) 기반.</li><li>이벤트 기반 아키텍처와 잘 어울림.</li><li>감사, 복구, 분석 등 다양한 활용 가능.</li></ul><h3 id=5-핵심-원칙>(5) 핵심 원칙<a hidden class=anchor aria-hidden=true href=#5-핵심-원칙>#</a></h3><ul><li><strong>상태 변화는 이벤트로 기록</strong><ul><li>모든 상태 변화는 불변의 이벤트로 저장.</li></ul></li><li><strong>상태는 이벤트 스트림에서 재구성</strong><ul><li>현재 상태는 이벤트 스트림을 재생하여 얻음.</li></ul></li><li><strong>이벤트는 원본 데이터</strong><ul><li>이벤트는 시스템의 진실의 원천(Source of Truth).</li></ul></li></ul><h3 id=6-주요-원리>(6) 주요 원리<a hidden class=anchor aria-hidden=true href=#6-주요-원리>#</a></h3><ul><li><strong>이벤트 저장 및 스트림 처리</strong><ul><li>상태 변화를 이벤트로 저장, 스트림으로 관리.</li></ul></li><li><strong>이벤트 기반 상태 재구성</strong><ul><li>이벤트 스트림을 재생하여 현재 상태 도출.</li></ul></li><li><strong>이벤트 발행 및 구독</strong><ul><li>이벤트를 발행하고, 필요한 곳에서 구독하여 처리.</li></ul></li></ul><h3 id=7-작동-원리-및-다이어그램>(7) 작동 원리 및 다이어그램<a hidden class=anchor aria-hidden=true href=#7-작동-원리-및-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
    User --&gt;|Command| CommandHandler
    CommandHandler --&gt;|Generate Event| EventStore
    EventStore --&gt;|Event Stream| EventProcessor
    EventProcessor --&gt;|Update| ReadModel
    User --&gt;|Query| QueryHandler
    QueryHandler --&gt;|Retrieve| ReadModel
</pre><p><strong>설명</strong></p><ul><li><strong>User</strong>: 시스템 사용자.</li><li><strong>CommandHandler</strong>: 명령을 처리하여 이벤트 생성.</li><li><strong>EventStore</strong>: 이벤트를 저장하는 저장소.</li><li><strong>EventProcessor</strong>: 이벤트 스트림을 처리하여 상태(Read Model) 갱신.</li><li><strong>ReadModel</strong>: 현재 상태(비정규화, 캐시 등 활용).</li><li><strong>QueryHandler</strong>: 조회 요청 처리.</li></ul><h3 id=8-구조-및-아키텍처>(8) 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#8-구조-및-아키텍처>#</a></h3><table><thead><tr><th>구성 요소</th><th>기능 및 역할</th><th>필수/선택</th></tr></thead><tbody><tr><td>Command</td><td>상태 변경 명령</td><td>필수</td></tr><tr><td>Command Handler</td><td>명령 처리 및 이벤트 생성</td><td>필수</td></tr><tr><td>Event</td><td>상태 변화를 나타내는 불변 데이터</td><td>필수</td></tr><tr><td>Event Store</td><td>이벤트 저장 및 관리</td><td>필수</td></tr><tr><td>Event Processor</td><td>이벤트 스트림 처리 및 상태 갱신</td><td>필수</td></tr><tr><td>Read Model</td><td>현재 상태(비정규화, 캐시 등 활용)</td><td>선택(일부 시스템)</td></tr><tr><td>Query Handler</td><td>조회 요청 처리</td><td>선택(일부 시스템)</td></tr></tbody></table><p><strong>설명</strong></p><ul><li><strong>필수 구성요소</strong>: Command, Command Handler, Event, Event Store, Event Processor</li><li><strong>선택 구성요소</strong>: Read Model, Query Handler (CQRS와 연동 시 필요)</li></ul><h3 id=9-구현-기법>(9) 구현 기법<a hidden class=anchor aria-hidden=true href=#9-구현-기법>#</a></h3><ul><li><strong>이벤트 저장소 설계</strong>: 이벤트를 효율적으로 저장 및 조회할 수 있는 저장소 구현.</li><li><strong>이벤트 발행/구독</strong>: 이벤트를 발행하고, 필요한 곳에서 구독하여 처리.</li><li><strong>상태 재구성</strong>: 이벤트 스트림을 재생하여 현재 상태 도출(스냅샷 활용 가능).</li><li><strong>이벤트 기반 시스템 연동</strong>: CQRS, 마이크로서비스 등과 연동.</li></ul><h3 id=10-장점>(10) 장점<a hidden class=anchor aria-hidden=true href=#10-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 발생 원인</th></tr></thead><tbody><tr><td>장점</td><td>데이터 무결성</td><td>상태 변화 이력 완전 보존, 감사 및 복구 가능</td><td>이벤트 기반 기록</td></tr><tr><td></td><td>감사 및 추적</td><td>모든 상태 변화 이력 추적 가능</td><td>이벤트 스트림 보존</td></tr><tr><td></td><td>복구 및 분석</td><td>이벤트 재생을 통한 과거 상태 복구, 분석 가능</td><td>이벤트 재생산</td></tr><tr><td></td><td>유연성</td><td>이벤트 기반 시스템 연동(CQRS, 마이크로서비스 등)에 적합</td><td>이벤트 발행/구독</td></tr></tbody></table><h3 id=11-단점과-문제점-그리고-해결방안>(11) 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#11-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>이벤트 저장, 처리, 재생 등 시스템 복잡도 증가</td><td>명확한 설계, 문서화</td></tr><tr><td></td><td>성능</td><td>대량 이벤트 처리 시 성능 저하 가능성</td><td>스냅샷, 최적화 기법 적용</td></tr><tr><td></td><td>저장소 용량</td><td>이벤트 누적로 저장소 용량 증가</td><td>이벤트 보관 정책, 아카이빙</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>이벤트 중복</td><td>이벤트 발행 중복</td><td>데이터 일관성 문제</td><td>모니터링, 로그 분석</td><td>이벤트 발행 제어</td><td>중복 제거, 멱등 처리</td></tr><tr><td></td><td>이벤트 손실</td><td>네트워크/장애 등</td><td>상태 재구성 불가</td><td>모니터링, 알림</td><td>신뢰성 확보</td><td>재시도, 복구 프로세스</td></tr></tbody></table><h3 id=12-도전-과제>(12) 도전 과제<a hidden class=anchor aria-hidden=true href=#12-도전-과제>#</a></h3><ul><li><p><strong>대용량 이벤트 처리</strong></p><ul><li><strong>원인</strong>: 이벤트 누적로 인한 저장소 및 처리 부하.</li><li><strong>영향</strong>: 성능 저하, 시스템 장애.</li><li><strong>탐지 및 진단</strong>: 모니터링, 로그 분석.</li><li><strong>예방 방법</strong>: 스냅샷, 이벤트 보관 정책.</li><li><strong>해결 방법</strong>: 아카이빙, 분산 처리.</li></ul></li><li><p><strong>이벤트 기반 시스템 연동</strong></p><ul><li><strong>원인</strong>: 다양한 시스템과의 연동 복잡성.</li><li><strong>영향</strong>: 데이터 일관성, 시스템 통합 난이도 증가.</li><li><strong>탐지 및 진단</strong>: 모니터링, 테스트.</li><li><strong>예방 방법</strong>: 명확한 인터페이스 정의.</li><li><strong>해결 방법</strong>: 이벤트 버스, 마이크로서비스 아키텍처.</li></ul></li></ul><h3 id=13-분류-기준에-따른-종류-및-유형>(13) 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#13-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>구분</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>유형</td><td>단일 이벤트 소싱</td><td>단일 시스템 내 이벤트 소싱 적용</td></tr><tr><td></td><td>분산 이벤트 소싱</td><td>분산 시스템(마이크로서비스 등)에서 이벤트 소싱 적용</td></tr><tr><td></td><td>이벤트 소싱 + CQRS</td><td>이벤트 소싱과 CQRS 패턴 연동</td></tr></tbody></table><h3 id=14-실무-사용-예시>(14) 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시>#</a></h3><table><thead><tr><th>예시</th><th>목적</th><th>함께 사용되는 기술/패턴</th><th>효과</th></tr></thead><tbody><tr><td>금융 거래 시스템</td><td>거래 이력 관리</td><td>CQRS, 마이크로서비스</td><td>감사, 복구, 분석</td></tr><tr><td>주문 관리 시스템</td><td>주문 상태 변화 추적</td><td>이벤트 버스, NoSQL</td><td>상태 이력 관리, 복구</td></tr></tbody></table><h3 id=15-활용-사례>(15) 활용 사례<a hidden class=anchor aria-hidden=true href=#15-활용-사례>#</a></h3><p><strong>금융 거래 시스템 예시</strong></p><ul><li><strong>시스템 구성</strong>: 거래 명령 → 이벤트 생성 → 이벤트 저장 → 이벤트 처리 → 상태 갱신</li><li><strong>시스템 구성 다이어그램</strong></li></ul><pre class=mermaid>flowchart LR
    User --&gt;|거래 명령| CommandHandler
    CommandHandler --&gt;|이벤트 생성| EventStore
    EventStore --&gt;|이벤트 스트림| EventProcessor
    EventProcessor --&gt;|상태 갱신| ReadModel
    User --&gt;|거래 조회| QueryHandler
    QueryHandler --&gt;|상태 조회| ReadModel
</pre><ul><li><strong>Workflow</strong>:<ol><li>사용자가 거래 명령(Command) 실행.</li><li>Command Handler가 이벤트 생성 및 Event Store에 저장.</li><li>Event Processor가 이벤트 스트림을 처리하여 상태(Read Model) 갱신.</li><li>사용자가 거래 조회(Query) 시 Query Handler가 Read Model에서 상태 반환.</li></ol></li><li><strong>이벤트 소싱 역할</strong>:<ul><li>거래 이력 완전 보존, 감사, 복구, 분석 가능.</li><li>상태 변화 이력 기반 시스템 운영.</li></ul></li><li><strong>이벤트 소싱 유무에 따른 차이점</strong>:<ul><li><strong>적용 시</strong>: 거래 이력 완전 보존, 감사/복구/분석 용이.</li><li><strong>미적용 시</strong>: 현재 상태만 저장, 이력 추적 및 복구 어려움.</li></ul></li></ul><h3 id=16-구현-예시-python>(16) 구현 예시 (Python)<a hidden class=anchor aria-hidden=true href=#16-구현-예시-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42>42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43>43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44>44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 이벤트 클래스 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 저장소 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command Handler 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CommandHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>Event</span><span class=p>(</span><span class=s2>&#34;Transaction&#34;</span><span class=p>,</span> <span class=n>command_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Event Processor 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s2>&#34;Transaction&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>command_handler</span> <span class=o>=</span> <span class=n>CommandHandler</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>command_handler</span><span class=o>.</span><span class=n>handle_command</span><span class=p>({</span><span class=s2>&#34;account&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>event_processor</span> <span class=o>=</span> <span class=n>Event2Processor</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>event_processor</span><span class=o>.</span><span class=n>process_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>event_processor</span><span class=o>.</span><span class=n>state</span><span class=p>)</span>  <span class=c1># {&#39;account&#39;: &#39;A&#39;, &#39;amount&#39;: 100}</span>
</span></span></code></pre></td></tr></table></div></div><p><em>EventProcessor 클래스명은 오타가 있을 수 있습니다. 실제로는 EventProcessor로 통일하는 것이 좋습니다.</em></p><hr><h2 id=7-추가-조사-내용>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용>#</a></h2><ul><li><strong>이벤트 소싱과 CQRS의 연동</strong>:<ul><li>이벤트 소싱은 명령 처리 결과를 이벤트로 저장하고, CQRS는 읽기/쓰기 모델을 분리하여 각각 최적화.</li><li>두 패턴을 함께 사용하면 시스템의 확장성, 유지보수성, 데이터 무결성, 감사, 복구 등 다양한 이점을 얻을 수 있음.</li></ul></li><li><strong>이벤트 기반 아키텍처의 확장</strong>:<ul><li>이벤트 소싱은 마이크로서비스, 분산 시스템 등에서 상태 변화 이력 관리와 시스템 연동에 매우 효과적.</li></ul></li></ul><hr><h2 id=8-기타-사항>8. 기타 사항<a hidden class=anchor aria-hidden=true href=#8-기타-사항>#</a></h2><ul><li><strong>이벤트 소싱은 모든 시스템에 적합하지 않음</strong>:<ul><li>단순 CRUD 애플리케이션에는 오버엔지니어링이 될 수 있으므로, 복잡한 도메인, 감사/복구/분석 요구가 있는 시스템에 적합.</li></ul></li><li><strong>이벤트 스트림의 장기 보관</strong>:<ul><li>이벤트가 누적되면 저장소 용량 및 처리 부하가 증가하므로, 스냅샷, 아카이빙 등 관리 전략 필요.</li></ul></li></ul><hr><h2 id=9-주제와-관련하여-주목할-내용>9. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#9-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>이벤트 소싱</td><td>이벤트 기반 기록</td><td>상태 변화를 이벤트로 기록, 이력 보존</td></tr><tr><td>데이터 관리</td><td>이벤트 스트림</td><td>상태 재구성</td><td>이벤트 스트림 재생으로 상태 도출</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>분산 시스템 연동</td><td>이벤트 기반 시스템 연동에 적합</td></tr><tr><td>최적화</td><td>스냅샷</td><td>성능 향상</td><td>대량 이벤트 처리 시 스냅샷 활용</td></tr></tbody></table><hr><h2 id=10-반드시-학습해야할-내용>10. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#10-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>이벤트 소싱</td><td>이벤트 기반 기록</td><td>상태 변화를 이벤트로 기록, 이력 보존</td></tr><tr><td>데이터 관리</td><td>이벤트 스트림</td><td>상태 재구성</td><td>이벤트 스트림 재생으로 상태 도출</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>분산 시스템 연동</td><td>이벤트 기반 시스템 연동에 적합</td></tr><tr><td>최적화</td><td>스냅샷</td><td>성능 향상</td><td>대량 이벤트 처리 시 스냅샷 활용</td></tr></tbody></table><hr><h2 id=11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>11. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#11-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 복잡성</td><td>복잡한 도메인에 적합</td><td>명확한 도메인 경계 정의</td></tr><tr><td>이벤트 저장소</td><td>이벤트 저장 및 관리 필요</td><td>효율적인 저장소 설계, 아카이빙</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 성능</td><td>스냅샷, 분산 처리</td></tr><tr><td>데이터 일관성</td><td>이벤트 기반 동기화 필요</td><td>이벤트 발행/구독 신뢰성 확보</td></tr></tbody></table><hr><h2 id=12-최적화하기-위한-고려사항-및-주의할-점>12. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#12-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 저장소</td><td>대량 이벤트 저장 효율성</td><td>아카이빙, 스냅샷</td></tr><tr><td>이벤트 처리</td><td>대량 이벤트 처리 성능</td><td>스냅샷, 분산 처리</td></tr><tr><td>상태 재구성</td><td>빠른 상태 재구성 필요</td><td>스냅샷, 캐시</td></tr><tr><td>시스템 연동</td><td>다양한 시스템과의 연동</td><td>명확한 인터페이스, 이벤트 버스</td></tr></tbody></table><hr><h2 id=13-용어-정리>13. 용어 정리<a hidden class=anchor aria-hidden=true href=#13-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>이벤트 소싱</td><td>상태 변화를 이벤트로 기록하는 아키텍처 패턴</td></tr><tr><td>데이터 관리</td><td>이벤트 스트림</td><td>상태 변화 이벤트의 연속된 흐름</td></tr><tr><td>확장성</td><td>마이크로서비스</td><td>각 서비스가 독립적으로 동작하는 아키텍처</td></tr><tr><td>최적화</td><td>스냅샷</td><td>특정 시점의 상태를 저장하여 빠른 재구성 지원</td></tr></tbody></table><hr><h2 id=14-참고-및-출처>14. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#14-참고-및-출처>#</a></h2><ul><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Event Sourcing - Martin Fowler</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Event Sourcing Pattern - Microsoft Azure Architecture Center</a></li><li><a href=https://www.eventstore.com/event-sourcing>Introducing Event Sourcing - Event Store</a></li><li><a href=https://www.dddcommunity.org/event-sourcing/>Event Sourcing Explained - DDD Community</a></li></ul><hr><h2 id=요약>요약<a hidden class=anchor aria-hidden=true href=#요약>#</a></h2><p>이벤트 소싱은 시스템의 상태 변화를 이벤트로 기록하고, 이벤트 스트림을 재생하여 상태를 재구성하는 아키텍처 패턴으로, 데이터 무결성, 감사, 복구, 분석 등 다양한 이점을 제공하며, 복잡한 도메인이나 분산 시스템에서 특히 효과적입니다.<br>분류 구조는 “Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns”로 적합하며, 이벤트 소싱은 CQRS, 마이크로서비스 등과 잘 연동됩니다.</p><hr><h2 id=-tags>📌 Tags<a hidden class=anchor aria-hidden=true href=#-tags>#</a></h2><ul><li>Event-Sourcing</li><li>Append-Only-Log</li><li>Temporal-Data</li><li>Audit-Trail</li></ul><hr><h2 id=1-분류-구조-타당성-평가>1. 분류 구조 타당성 평가<a hidden class=anchor aria-hidden=true href=#1-분류-구조-타당성-평가>#</a></h2><p><strong>현재 위치</strong>:
<code>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns</code></p><p>✅ <strong>적절</strong>: Event Sourcing은 변경 이력을 이벤트 로그로 보존하는 <strong>데이터 관리 패턴</strong>으로, CQRS와 자주 결합되어 설계상 읽기/쓰기 분리를 지원하기에 현 구조가 타당합니다. (<a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">kurrent.io</a>, <a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">microservices.io</a>)</p><hr><h2 id=2-200자-내외-요약>2. 200자 내외 요약<a hidden class=anchor aria-hidden=true href=#2-200자-내외-요약>#</a></h2><p>Event Sourcing은 모든 상태 변경을 불변 이벤트(event)로 기록하며, 이러한 이벤트 로그를 통해 현재 상태를 재구성하거나 과거 상태를 조회하는 패턴입니다. 이를 통해 완벽한 감사 로그, 시간 여행 쿼리, 복원 및 이벤트 기반 통합이 가능하며, CQRS와 결합 시 읽기/쓰기 분리를 통한 최적화도 수행할 수 있습니다.</p><hr><h2 id=3-250자-내외-개요>3. 250자 내외 개요<a hidden class=anchor aria-hidden=true href=#3-250자-내외-개요>#</a></h2><p>Event Sourcing은 시스템의 모든 상태 변화를 append-only 로그(Event Store)에 이벤트로 기록하는 아키텍처 패턴입니다. 이러한 이벤트 로그는 현재 상태 재생(replay)을 통해 시스템 상태를 복원하거나 과거 상태를 조회하는 용도로 사용됩니다. 주요 이점은 감사(Auditability), 시간여행(Temporal Queries), 복합 워크플로우 추적, 시스템 복원성 등이 있으며, 읽기 모델과 결합 시 CQRS 패턴의 최적화 효과도 얻을 수 있습니다. 단, 높은 복잡도, 이벤트 스냅샷 등 인프라 체계가 요구됩니다.</p><hr><h2 id=4-핵심-개념>4. 핵심 개념<a hidden class=anchor aria-hidden=true href=#4-핵심-개념>#</a></h2><h3 id=-event-이벤트>🔹 Event (이벤트)<a hidden class=anchor aria-hidden=true href=#-event-이벤트>#</a></h3><ul><li>시스템에서 발생한 불변(Immutable) 상태 변경 단위. (e.g., <code>OrderCreated</code>, <code>BalanceUpdated</code>) (<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">geeksforgeeks.org</a>)</li></ul><h3 id=-event-store-이벤트-저장소>🔹 Event Store (이벤트 저장소)<a hidden class=anchor aria-hidden=true href=#-event-store-이벤트-저장소>#</a></h3><ul><li>이벤트를 순차적으로 저장하는 append-only 로그.</li><li>상태 재구성, 이벤트 발행 기능 포함 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>)</li></ul><h3 id=-aggregate>🔹 Aggregate<a hidden class=anchor aria-hidden=true href=#-aggregate>#</a></h3><ul><li>도메인 단위의 변경 로직과 상태 응집체.</li><li>커맨드를 처리하고 이벤트를 생성하는 단일 단위 (<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">geeksforgeeks.org</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>)</li></ul><h3 id=-projection--materialized-view>🔹 Projection / Materialized View<a hidden class=anchor aria-hidden=true href=#-projection--materialized-view>#</a></h3><ul><li>이벤트를 읽기 전용 모델로 변환하여 조회 최적화. CQRS와 결합 시 필수 요소</li></ul><h3 id=-snapshot-스냅샷>🔹 Snapshot (스냅샷)<a hidden class=anchor aria-hidden=true href=#-snapshot-스냅샷>#</a></h3><ul><li>이벤트가 많아질 경우 재생 비용을 줄이기 위한 중간 상태 저장. 이후 이벤트는 이 후로만 재생</li></ul><h3 id=-replay-재생>🔹 Replay (재생)<a hidden class=anchor aria-hidden=true href=#-replay-재생>#</a></h3><ul><li>과거 시점이나 현재 상태를 이벤트 재생으로 복원하거나 분석</li></ul><hr><h3 id=-실무-구현-측면>🔹 실무 구현 측면<a hidden class=anchor aria-hidden=true href=#-실무-구현-측면>#</a></h3><ul><li><strong>감사(Audit)</strong> 요구사항이 있는 금융, 전자상거래, 보건 등에서 주로 도입됨 (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">medium.com</a>)</li><li><strong>분산 시스템 통합 및 Event-Driven 아키텍처</strong>에서 이벤트 발행 및 통합 소스로 사용됨 (<a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">arxiv.org</a>)</li></ul><hr><h2 id=5--6-주제와-관련하여-조사할-내용-정리>5. “## 6. 주제와 관련하여 조사할 내용” 정리<a hidden class=anchor aria-hidden=true href=#5--6-주제와-관련하여-조사할-내용-정리>#</a></h2><h3 id=-배경--배경-및-목적로-변경>• 배경 → ‘배경 및 목적’로 변경<a hidden class=anchor aria-hidden=true href=#-배경--배경-및-목적로-변경>#</a></h3><p>이벤트 기반 아키텍처 확산, 감사 기록 및 분산 시스템 요구사항 증가</p><h3 id=-목적-및-필요성>• 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#-목적-및-필요성>#</a></h3><p>감사-추적, 시스템 복원, 시간여행, 이벤트 기반 통합, CQRS 결합 읽기/쓰기 분리 최적화</p><h3 id=-주요-기능-및-역할>• 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#-주요-기능-및-역할>#</a></h3><p>이벤트 생성, 저장, 발행, 프로젝션, 재생, 스냅샷</p><h3 id=-특징>• 특징<a hidden class=anchor aria-hidden=true href=#-특징>#</a></h3><p>불변성, 시간여행, 감사성, 복원성, Eventual Consistency</p><h3 id=-구성-요소-및-구조구조-및-아키텍처-추가>• 구성 요소 및 구조 (“구조 및 아키텍처” 추가)<a hidden class=anchor aria-hidden=true href=#-구성-요소-및-구조구조-및-아키텍처-추가>#</a></h3><p>이벤트, 이벤트 저장소, 애그리거트, 프로젝션, 스냅샷</p><h3 id=-구현-기법>• 구현 기법<a hidden class=anchor aria-hidden=true href=#-구현-기법>#</a></h3><p>브로커(Kafka/RabbitMQ), EventStoreDB, 라이브러리(eventsourcing, Eventuate 등)</p><h3 id=-장점--단점-분석>• 장점 · 단점 분석<a hidden class=anchor aria-hidden=true href=#-장점--단점-분석>#</a></h3><p>장점: 감사, 시간여행, 복원, 분리 등 | 단점: 복잡성, 스토리지/메모리 증가, 이벤트 버전 관리, 일관성 지연 등</p><h3 id=-도전-과제>• 도전 과제<a hidden class=anchor aria-hidden=true href=#-도전-과제>#</a></h3><p>이벤트 진화, 스냅샷 정책, 테스트/모니터링, 분산 파티셔닝/ordering 문제</p><h3 id=-분류-기준>• 분류 기준<a hidden class=anchor aria-hidden=true href=#-분류-기준>#</a></h3><p>스냅샷 사용여부, 동기/비동기, CQRS 결합 여부, 단일/마이크로서비스 수준 등</p><h3 id=-실무-사용-예시>• 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#-실무-사용-예시>#</a></h3><p>금융․전자상거래 시스템, IoT, 협업툴</p><h3 id=-활용-사례>• 활용 사례<a hidden class=anchor aria-hidden=true href=#-활용-사례>#</a></h3><p>e‑commerce, Ride‑Sharing, 금융원장, Git 버전 관리</p><h3 id=-구현-예시>• 구현 예시<a hidden class=anchor aria-hidden=true href=#-구현-예시>#</a></h3><p>Python eventsourcing 샘플, Java Spring, Node.js등</p><h3 id=-고려-및-최적화-사항>• 고려 및 최적화 사항<a hidden class=anchor aria-hidden=true href=#-고려-및-최적화-사항>#</a></h3><p>모델 크기 관리, 이벤트 payload 설계, idempotency, 모니터링, 테스트 전략, 이벤트 버전 정책</p><h3 id=-기타-사항>• 기타 사항<a hidden class=anchor aria-hidden=true href=#-기타-사항>#</a></h3><p>기밀 데이터 삭제 처리, GDPR 대응, 쿼리 성능 보강</p><hr><h2 id=6-추가-조사-항목-및-요약>6. 추가 조사 항목 및 요약<a hidden class=anchor aria-hidden=true href=#6-추가-조사-항목-및-요약>#</a></h2><h3 id=-주목할-내용-표>📊 “주목할 내용” 표<a hidden class=anchor aria-hidden=true href=#-주목할-내용-표>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본</td><td>Immutable 이벤트</td><td>불변 이벤트 구조와 의미적 중요성</td><td></td></tr><tr><td>인프라</td><td>Event Ordering</td><td>이벤트 순서 보장 아키텍처 필요</td><td></td></tr><tr><td>관리</td><td>Event Versioning</td><td>버전 대응 전략 및 리팩토링 정책</td><td></td></tr><tr><td>성능</td><td>Snapshot 전략</td><td>주기적 상태 저장 및 재생 성능 향상</td><td></td></tr><tr><td>보안</td><td>GDPR·삭제</td><td>이벤트 로그에 개인정보 포함 시 삭제 문제</td><td></td></tr><tr><td>모니터링</td><td>Lag Metrics</td><td>이벤트 발행부터 Projection 동기화 시간 추적</td><td></td></tr><tr><td>테스트</td><td>Replay 테스트</td><td>재생 시나리오 기반 테스트 포함 필요</td><td></td></tr></tbody></table><h3 id=-반드시-학습해야할-내용-표>📘 “반드시 학습해야할 내용” 표<a hidden class=anchor aria-hidden=true href=#-반드시-학습해야할-내용-표>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>이벤트 모델링</td><td>Event Schema Design</td><td>이벤트 명명, payload 정의, 의미 일관성</td><td></td></tr><tr><td>데이터 관리</td><td>Snapshot & Retention</td><td>저장공간, 성능, GDPR 정책과 조율</td><td></td></tr><tr><td>도구</td><td>Event Store 시스템</td><td>Kafka, EventStoreDB, AWS Kinesis 등 비교</td><td></td></tr><tr><td>패턴</td><td>CQRS 결합</td><td>Projection 설계, 일관성 모델(강/약) 설계</td><td></td></tr><tr><td>버전 관리</td><td>Upcasting</td><td>이벤트 리팩토링, 호환성 유지 전략</td><td></td></tr><tr><td>통합</td><td>Temporal Queries</td><td>과거 시점 상태를 조회하는 쿼리 설계</td><td></td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본</td><td>Aggregate</td><td>도메인 상태 및 이벤트 생성 책임 단위</td></tr><tr><td>기본</td><td>Upcasting</td><td>이벤트 포맷 진화 시 변환 처리</td></tr><tr><td>기본</td><td>Temporal Query</td><td>과거 시점 상태 복원을 위한 재구성 쿼리</td></tr><tr><td>기본</td><td>Snapshot</td><td>이벤트 재생 성능 향상을 위한 중간 상태 저장</td></tr><tr><td>패턴</td><td>Eventual Consistency</td><td>비동기 Projection에 따른 읽기 일관성 지연</td></tr><tr><td>라이브러리</td><td>EventStoreDB</td><td>이벤트 저장 및 구독 기능 제공 DB 시스템</td></tr><tr><td>개발</td><td>Idempotency</td><td>중복 이벤트 처리 시 중복 영향 방지 처리</td></tr><tr><td>기능</td><td>Replay</td><td>이벤트를 순차적으로 다시 실행해 상태 복원</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li>Martin Fowler, <em>Event Sourcing</em> (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/service-per-team.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>, <a href="https://blog.bemi.io/rethinking-event-sourcing/?utm_source=chatgpt.com" title="It's Time to Rethink Event Sourcing - Bemi Blog">blog.bemi.io</a>, <a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">event-driven.io</a>, <a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">theserverside.com</a>, <a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">medium.com</a>, <a href="https://fr.wikipedia.org/wiki/Architecture_orient%C3%A9e_%C3%A9v%C3%A9nements?utm_source=chatgpt.com" title="Architecture orientée événements">fr.wikipedia.org</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing - Martin Fowler">martinfowler.com</a>)</li><li>Microservices.io, <em>Event Sourcing Pattern</em> (<a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">microservices.io</a>)</li><li>AWS Prescriptive Guidance, <em>Event Sourcing Pattern</em> (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>)</li><li>Medium, <em>Event Sourcing Explained</em> (<a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">event-driven.io</a>)</li><li>StackOverflow, <em>Disadvantages of Event Sourcing</em></li><li>Red Hat blog, <em>Pros & Cons of Event Sourcing</em></li><li>Kurrent.io, <em>10 problems ES helps solve</em> (<a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">kurrent.io</a>)</li><li>Innovecs blog, <em>Event Sourcing Best Practices</em> (<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">innovecs.com</a>)</li><li>Wikipedia, <em>Event-driven architecture</em> (<a href="https://en.wikipedia.org/wiki/Event-driven_architecture?utm_source=chatgpt.com" title="Event-driven architecture">en.wikipedia.org</a>)</li></ul><hr><p>원하시는 세부 항목(예: 구조 다이어그램, 실무 활용 사례, 구현 예시 코드 등)에 맞춰 추가로 작성 가능합니다. 요청 부탁드립니다!</p><p><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing><figure><img alt="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn" loading=lazy src="https://tse4.mm.bing.net/th?id=OIP.o6ZoY5sk83-tDISF-pVNtwHaEM\\&pid=Api"></figure></a></p><hr><h2 id=-구조-및-아키텍처-components--diagram>🔧 구조 및 아키텍처 (Components & Diagram)<a hidden class=anchor aria-hidden=true href=#-구조-및-아키텍처-components--diagram>#</a></h2><pre class=mermaid>flowchart LR
  UI[Presentation Layer] --&gt;|Command| CmdHandler[Command Handler]
  CmdHandler --&gt;|Rebuild from history| EventStore
  CmdHandler --&gt;|Append new event| EventStore
  EventStore --&gt;|Publish events| EventBus[Queue/Topic]
  subgraph Projections
    EventBus --&gt; ProjService[Projection/Event Handler]
    ProjService --&gt; ReadStore[Read-Only DB]
  end
  UI --&gt;|Query| QueryHandler
  QueryHandler --&gt; ReadStore
</pre><ul><li><strong>Command Handler</strong>: 도메인 변경을 이벤트로 생성</li><li><strong>Event Store</strong>: append-only 구조로 이벤트 저장 및 발행 (<a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">liurunner.blogspot.com</a>, <a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">learn.microsoft.com</a>)</li><li><strong>Event Bus</strong>: 이벤트를 비동기로 전달 (Kafka, RabbitMQ 등)</li><li><strong>Projections</strong>: 이벤트를 읽어 빠른 조회용 읽기 모델 구성</li><li><strong>Query Handler</strong>: 읽기 모델을 통한 쿼리 응답</li></ul><hr><h2 id=-배경-및-목적-background--purpose>⚙️ 배경 및 목적 (Background & Purpose)<a hidden class=anchor aria-hidden=true href=#-배경-및-목적-background--purpose>#</a></h2><ul><li><strong>감사 & 복원</strong>: 모든 변경을 이력으로 보존 → 추적성 확보 (<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">en.paradigmadigital.com</a>)</li><li><strong>시간여행 쿼리</strong>: 과거 상태 재구성 가능 (예: 장바구니 특정 시점) (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">microservices.io</a>)</li><li><strong>분산 시스템 통합</strong>: 이벤트 기반으로 서로 다른 서비스 간 상태 공유 (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">medium.com</a>)</li><li><strong>확장성 및 성능 향상</strong>: 쓰기, 읽기 분리로 리소스 최적화 가능</li></ul><hr><h2 id=-기능-및-역할-key-functions--responsibilities>✅ 기능 및 역할 (Key Functions & Responsibilities)<a hidden class=anchor aria-hidden=true href=#-기능-및-역할-key-functions--responsibilities>#</a></h2><ul><li><strong>이벤트 기록(Event Logging)</strong>: 모든 상태 변경을 이벤트로 저장</li><li><strong>상태 재생(State Reconstruction)</strong>: 이벤트를 순차적으로 재생해 Aggregate 상태 복구 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">microservices.io</a>, <a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">geeksforgeeks.org</a>)</li><li><strong>Projection 업데이트</strong>: 이벤트를 읽기 모델로 변환하여 효율적인 조회 제공</li><li><strong>이벤트 발행(Event Publishing)</strong>: 외부 시스템/서비스와 통합</li></ul><hr><h2 id=-특징-characteristics>🌟 특징 (Characteristics)<a hidden class=anchor aria-hidden=true href=#-특징-characteristics>#</a></h2><ul><li>Immutable event log (불변성)</li><li>Full audit trail (전체 이력 보존)</li><li>Eventual consistency (최종적 일관성)</li><li>Temporal queries support (시간여행 쿼리)</li><li>Replayability for recovery & testing</li></ul><hr><h2 id=-구현-기법-implementation-techniques>🧩 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#-구현-기법-implementation-techniques>#</a></h2><ul><li><strong>Event Store 플랫폼</strong>: EventStoreDB, Apache Kafka, AWS Kinesis 등</li><li><strong>라이브러리 활용</strong>: eventsourcing (Python), Eventuate, Eventuous (.NET), node-eventstore (Node.js) (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">microservices.io</a>, <a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">en.paradigmadigital.com</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/service-per-team.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">kurrent.io</a>, <a href="https://blog.bemi.io/rethinking-event-sourcing/?utm_source=chatgpt.com" title="It's Time to Rethink Event Sourcing - Bemi Blog">c-sharpcorner.com</a>)</li><li><strong>Snapshot 활용</strong>: 이벤트 재생 성능 향상 위해 주기적 상태 저장</li><li><strong>이벤트 버전 관리</strong>: Upcasting, 호환성 레이어 설계 필요</li></ul><hr><h2 id=-장점--단점--해결-방안>🧠 장점 / 단점 & 해결 방안<a hidden class=anchor aria-hidden=true href=#-장점--단점--해결-방안>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>장점</td><td>감사성 & 이력</td><td>모든 변경 이벤트 기록</td><td>이벤트 이벤트소싱 사용</td></tr><tr><td>장점</td><td>시간여행 쿼리</td><td>특정 시점 상태로 시스템 복원</td><td>Snapshot + 재생</td></tr><tr><td>장점</td><td>EDA 통합</td><td>마이크로·분산 시스템 연동 용이</td><td>Event Bus</td></tr><tr><td>단점</td><td>복잡한 이벤트 설계</td><td>Payload 설계, 버전 관리 필요</td><td>Event schema, Upcasting</td></tr><tr><td>단점</td><td>스토리지 증가</td><td>이벤트 저장소 커짐</td><td>스냅샷, Retention 정책</td></tr><tr><td>단점</td><td>성능 지연</td><td>Replay 비용 발생</td><td>Snapshot, 캐싱, 배치 처리</td></tr></tbody></table><hr><h2 id=-도전-과제-challenges>🚀 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#-도전-과제-challenges>#</a></h2><ul><li><strong>Event ordering & partitioning</strong>: 동일 Aggregate 내 순서 유지 필수 (<a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">upsolver.com</a>, <a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">stackoverflow.com</a>, <a href="https://fr.wikipedia.org/wiki/Architecture_orient%C3%A9e_%C3%A9v%C3%A9nements?utm_source=chatgpt.com" title="Architecture orientée événements">learn.microsoft.com</a>)</li><li><strong>GDPR / PII 삭제</strong>: 이벤트에서 개인정보 삭제 요구 복잡</li><li><strong>모니터링</strong>: 이벤트 지연, 누락, 소비 실패 등 상태 추적 필요</li><li><strong>테스트 / Debug</strong>: Replay, Snapshot, Projection 상태 검증용 테스트 전략 필요</li></ul><hr><h2 id=-분류-기준에-따른-유형-categorization-table>📘 분류 기준에 따른 유형 (Categorization Table)<a hidden class=anchor aria-hidden=true href=#-분류-기준에-따른-유형-categorization-table>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>Snapshot 사용</td><td>Snapshot + Replay</td><td>이벤트 로그 재생 최적화</td></tr><tr><td>CQRS 결합</td><td>Event Sourcing + CQRS</td><td>읽기/쓰기 분리 최적화</td></tr><tr><td>동기성</td><td>Synchronous ES</td><td>커맨드 즉시 프로젝션 처리</td></tr><tr><td>비동기</td><td>Asynchronous ES</td><td>배치 또는 이벤트 발행 방식</td></tr></tbody></table><hr><h2 id=-실무-사용-예시-use-case-table>📚 실무 사용 예시 (Use Case Table)<a hidden class=anchor aria-hidden=true href=#-실무-사용-예시-use-case-table>#</a></h2><table><thead><tr><th>시스템 유형</th><th>목적</th><th>Event Sourcing 역할</th></tr></thead><tbody><tr><td>금융 트랜잭션</td><td>감사·복원</td><td>모든 거래 이벤트 기록</td></tr><tr><td>전자상거래</td><td>상태 추적</td><td>장바구니, 주문 상태 재생</td></tr><tr><td>협업 도구</td><td>작업 히스토리</td><td>문서 편집 이력 추적</td></tr><tr><td>IoT</td><td>센서 데이터</td><td>이벤트 로그로 시계열 기록</td></tr></tbody></table><hr><h2 id=-활용-사례--전자상거래-사례>✅ 활용 사례 – 전자상거래 사례<a hidden class=anchor aria-hidden=true href=#-활용-사례--전자상거래-사례>#</a></h2><ul><li><p><strong>시스템 구성</strong>
UI → Command Handler → Event Store → Event Bus → OrderProjection → Read DB</p></li><li><p><strong>워크플로우</strong></p><ol><li><code>CreateOrder</code> 커맨드 발행</li><li>이벤트 저장 후 프로젝션 업데이트</li><li>이미지 UI <code>GET /orders/{id}</code></li></ol></li><li><p><strong>비교: Event Sourcing 없을 경우</strong>
|user orders의 현재 상태만 저장 → 이벤트 이력 없음, 재생 불가|
Event Sourcing 적용 시: 이력 완전 기록 가능, 문제 발생 시 rollback 및 진단 가능</p></li></ul><hr><h2 id=-구현-예시-python-코드-개요>🛠 구현 예시 (Python 코드 개요)<a hidden class=anchor aria-hidden=true href=#-구현-예시-python-코드-개요>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7>7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8>8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>(</span><span class=n>Aggregate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=o>...</span><span class=p>):</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_OrderCreated</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply_ItemAdded</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=c1># EventStore.save + snapshot + replay 기능 포함</span>
</span></span><span class=line><span class=cl><span class=n>eventlog</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=o>.</span><span class=n>replay</span><span class=p>(</span><span class=n>eventlog</span><span class=o>.</span><span class=n>load_stream</span><span class=p>(</span><span class=n>order_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>order</span><span class=o>.</span><span class=n>add_item</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>eventlog</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=-요약>📌 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h2><p>Event Sourcing은 변경 이력을 이벤트 로그로 저장하는 패턴으로, 감사, 시간 여행, 복원 가능 시스템을 구현합니다. CQRS와 결합 시 읽기/쓰기 최적화도 가능하지만, 개발/운영 복잡도 증가, 이벤트 설계·관리와 스토리지 고려가 필요합니다. 도메인 특성과 성숙된 인프라를 갖춘 환경에서 효과적입니다.</p><hr><h2 id=-다음-진도>🔧 다음 진도<a hidden class=anchor aria-hidden=true href=#-다음-진도>#</a></h2><ul><li><strong>Snapshot + Replay 구현 예시 (Python)</strong></li><li><strong>Event versioning (Upcasting) 샘플</strong></li><li><strong>실제 프로젝트 구조 + 테스트 코드 구성</strong> 원하시면 말씀 주세요!</li></ul><p>Event Sourcing에 대한 포괄적인 조사와 분석을 시작하겠습니다. 먼저 최신 정보를 수집하여 체계적으로 정리해드리겠습니다.</p><h1 id=event-sourcing-포괄적-분석-및-조사>Event Sourcing 포괄적 분석 및 조사<a hidden class=anchor aria-hidden=true href=#event-sourcing-포괄적-분석-및-조사>#</a></h1><h2 id=1-기본-정보>1. 기본 정보<a hidden class=anchor aria-hidden=true href=#1-기본-정보>#</a></h2><h3 id=태그>태그<a hidden class=anchor aria-hidden=true href=#태그>#</a></h3><ul><li>Event-Sourcing</li><li>Data-Management</li><li>CQRS-Pattern</li><li>Architecture-Pattern</li></ul><h3 id=카테고리-분류-분석>카테고리 분류 분석<a hidden class=anchor aria-hidden=true href=#카테고리-분류-분석>#</a></h3><p>&ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Data Management Patterns"의 계층 구조는 매우 적절합니다.</p><p><strong>근거:</strong></p><ul><li>Event Sourcing은 소프트웨어 설계 아키텍처 패턴의 한 종류임</li><li>데이터 관리와 직접적으로 연관된 패턴임</li><li>애플리케이션 상태를 이벤트 시퀀스로 관리하는 아키텍처 접근법임</li><li>DDD, CQRS와 함께 사용되는 고급 설계 패턴임</li></ul><h3 id=요약-설명-200자-내외>요약 설명 (200자 내외)<a hidden class=anchor aria-hidden=true href=#요약-설명-200자-내외>#</a></h3><p>Event Sourcing은 애플리케이션 상태 변화를 불변의 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 현재 상태만 저장하는 전통적 CRUD와 달리, 모든 변경사항을 이벤트로 기록하여 완전한 감사 추적과 시점별 상태 복원을 가능하게 합니다.</p><h3 id=개요-250자-내외>개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#개요-250자-내외>#</a></h3><p>Event Sourcing은 애플리케이션 상태를 이벤트 스트림으로 관리하는 데이터 아키텍처 패턴입니다. 각 상태 변화를 불변 이벤트로 append-only 저장소에 기록하며, 현재 상태는 이벤트를 순차적으로 재생하여 재구성합니다. CQRS와 함께 사용되어 읽기/쓰기 분리를 통한 성능 최적화와 복잡한 비즈니스 로직 처리에 적합합니다.</p><hr><h2 id=2-핵심-개념>2. 핵심 개념<a hidden class=anchor aria-hidden=true href=#2-핵심-개념>#</a></h2><h3 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h3><p>Event Sourcing은 애플리케이션의 상태 변화를 순차적인 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 전통적인 CRUD 방식이 현재 상태만 저장하는 것과 달리, 상태에 이르기까지의 모든 변화 과정을 불변의 이벤트로 기록합니다.</p><h3 id=핵심-구성-요소>핵심 구성 요소<a hidden class=anchor aria-hidden=true href=#핵심-구성-요소>#</a></h3><ul><li><strong>Event (이벤트)</strong>: 시스템에서 발생한 특정 변화를 나타내는 불변 객체</li><li><strong>Event Store (이벤트 저장소)</strong>: 이벤트를 시간순으로 저장하는 append-only 데이터베이스</li><li><strong>Event Stream (이벤트 스트림)</strong>: 특정 엔티티와 관련된 이벤트들의 순차적 시퀀스</li><li><strong>Aggregate (애그리거트)</strong>: 이벤트를 생성하고 상태를 관리하는 도메인 객체</li><li><strong>Projection (프로젝션)</strong>: 이벤트 스트림으로부터 파생된 읽기 전용 뷰</li></ul><h3 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h3><p>핵심 개념들은 다음과 같은 측면에서 실무 구현과 밀접하게 연관됩니다:</p><ul><li><strong>이벤트 설계</strong>: 비즈니스 도메인의 중요한 변화를 정확히 캡처하는 이벤트 모델링 필요</li><li><strong>저장소 선택</strong>: 높은 쓰기 처리량과 순차 읽기에 최적화된 데이터베이스 선택 (EventStoreDB, Apache Kafka 등)</li><li><strong>상태 복원</strong>: 이벤트 재생을 통한 효율적인 상태 재구성 메커니즘 구현</li><li><strong>스키마 진화</strong>: 시간이 지나면서 변화하는 이벤트 스키마의 버전 관리</li></ul><hr><h2 id=3-배경-및-목적>3. 배경 및 목적<a hidden class=anchor aria-hidden=true href=#3-배경-및-목적>#</a></h2><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Event Sourcing은 Domain-Driven Design (DDD) 커뮤니티에서 발전된 패턴으로, Greg Young에 의해 2010년경 체계화되었습니다. 전통적인 상태 기반 저장소의 한계점을 해결하기 위해 등장했습니다.</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li><strong>완전한 감사 추적</strong>: 모든 변경사항의 완전한 히스토리 보존</li><li><strong>시점별 상태 복원</strong>: 과거 특정 시점의 시스템 상태 정확한 재구성</li><li><strong>비즈니스 인사이트</strong>: 상태 변화 패턴 분석을 통한 비즈니스 통찰력 확보</li><li><strong>시스템 복구</strong>: 데이터 손상 시 이벤트 재생을 통한 복구 가능</li><li><strong>확장성</strong>: 읽기와 쓰기 워크로드의 독립적 확장</li></ul><hr><h2 id=4-주요-기능-및-역할>4. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#4-주요-기능-및-역할>#</a></h2><h3 id=주요-기능>주요 기능<a hidden class=anchor aria-hidden=true href=#주요-기능>#</a></h3><ol><li><strong>이벤트 기록</strong>: 모든 상태 변화를 불변 이벤트로 순차 저장</li><li><strong>상태 재구성</strong>: 이벤트 재생을 통한 현재 상태 복원</li><li><strong>시간 여행</strong>: 과거 특정 시점의 상태 조회</li><li><strong>이벤트 스트리밍</strong>: 실시간 이벤트 스트림을 통한 다른 시스템과의 통합</li><li><strong>프로젝션 생성</strong>: 다양한 읽기 모델을 위한 뷰 생성</li></ol><h3 id=역할>역할<a hidden class=anchor aria-hidden=true href=#역할>#</a></h3><ul><li><strong>데이터 지속성</strong>: 애플리케이션 상태의 영구 저장</li><li><strong>감사 로그</strong>: 모든 비즈니스 작업의 완전한 추적성 제공</li><li><strong>이벤트 소싱</strong>: 다른 시스템으로의 실시간 이벤트 전파</li><li><strong>분석 기반</strong>: 비즈니스 분석을 위한 풍부한 데이터 소스 제공</li></ul><hr><h2 id=5-특징-및-핵심-원칙>5. 특징 및 핵심 원칙<a hidden class=anchor aria-hidden=true href=#5-특징-및-핵심-원칙>#</a></h2><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>불변성</strong>: 저장된 이벤트는 변경되지 않음</li><li><strong>순차성</strong>: 이벤트는 발생 순서대로 저장됨</li><li><strong>완전성</strong>: 모든 상태 변화가 빠짐없이 기록됨</li><li><strong>결정론적</strong>: 동일한 이벤트 시퀀스는 항상 동일한 상태를 만듦</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ol><li><strong>Append-Only</strong>: 이벤트는 추가만 가능하고 수정/삭제 불가</li><li><strong>이벤트 우선</strong>: 이벤트가 시스템의 유일한 진실의 원천</li><li><strong>최종 일관성</strong>: 프로젝션과 뷰는 최종적으로 일관성을 가짐</li><li><strong>멱등성</strong>: 동일한 이벤트의 반복 처리가 안전함</li></ol><hr><h2 id=6-주요-원리-및-작동-원리>6. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#6-주요-원리-및-작동-원리>#</a></h2><h3 id=주요-원리-다이어그램>주요 원리 다이어그램<a hidden class=anchor aria-hidden=true href=#주요-원리-다이어그램>#</a></h3><pre class=mermaid>graph TB
    A[Command] --&gt; B[Aggregate]
    B --&gt; C[Event]
    C --&gt; D[Event Store]
    D --&gt; E[Event Stream]
    E --&gt; F[Projection Engine]
    F --&gt; G[Read Model]
    
    H[Query] --&gt; G
    
    I[Event Replay] --&gt; E
    E --&gt; J[State Reconstruction]
    
    classDef commandFlow fill:#e1f5fe
    classDef eventFlow fill:#f3e5f5
    classDef queryFlow fill:#e8f5e8
    
    class A,B commandFlow
    class C,D,E,F eventFlow
    class H,G,I,J queryFlow
</pre><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><ol><li><p><strong>명령 처리 단계</strong></p><ul><li>사용자 명령이 애그리거트로 전달</li><li>애그리거트가 비즈니스 로직 실행</li><li>상태 변화를 나타내는 이벤트 생성</li></ul></li><li><p><strong>이벤트 저장 단계</strong></p><ul><li>생성된 이벤트를 Event Store에 순차적으로 추가</li><li>이벤트는 타임스탬프와 시퀀스 번호를 포함</li></ul></li><li><p><strong>프로젝션 업데이트 단계</strong></p><ul><li>저장된 이벤트가 프로젝션 엔진으로 전파</li><li>다양한 읽기 모델과 뷰가 업데이트</li></ul></li><li><p><strong>상태 조회 단계</strong></p><ul><li>읽기 요청시 프로젝션에서 데이터 조회</li><li>또는 이벤트 재생을 통한 실시간 상태 구성</li></ul></li></ol><hr><h2 id=7-구조-및-아키텍처>7. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#7-구조-및-아키텍처>#</a></h2><h3 id=전체-아키텍처-다이어그램>전체 아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#전체-아키텍처-다이어그램>#</a></h3><pre class=mermaid>graph LR
    subgraph &#34;Command Side&#34;
        A[User Interface] --&gt; B[Command Handler]
        B --&gt; C[Aggregate]
        C --&gt; D[Domain Events]
    end
    
    subgraph &#34;Event Store&#34;
        D --&gt; E[Event Store Database]
        E --&gt; F[Event Streams]
    end
    
    subgraph &#34;Query Side&#34;
        F --&gt; G[Event Handlers]
        G --&gt; H[Projections]
        H --&gt; I[Read Database]
        I --&gt; J[Query Handlers]
        J --&gt; K[User Interface Views]
    end
    
    subgraph &#34;Infrastructure&#34;
        L[Message Bus]
        M[Event Publisher]
        N[Snapshots]
    end
    
    D --&gt; M
    M --&gt; L
    L --&gt; G
    E --&gt; N
    N --&gt; C
</pre><h3 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>Event Store</strong></td><td>이벤트 영구 저장</td><td>시스템의 진실의 원천</td><td>Append-only, 불변성</td></tr><tr><td><strong>Aggregate</strong></td><td>비즈니스 로직 실행</td><td>이벤트 생성 및 상태 관리</td><td>일관성 경계</td></tr><tr><td><strong>Event</strong></td><td>상태 변화 기록</td><td>도메인 변화 표현</td><td>불변, 직렬화 가능</td></tr><tr><td><strong>Event Handler</strong></td><td>이벤트 처리</td><td>프로젝션 업데이트</td><td>비동기 처리</td></tr></tbody></table><h3 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>Snapshot</strong></td><td>성능 최적화</td><td>상태 복원 가속화</td><td>선택적 최적화</td></tr><tr><td><strong>Message Bus</strong></td><td>이벤트 전파</td><td>시스템 간 통신</td><td>확장성 향상</td></tr><tr><td><strong>CQRS</strong></td><td>읽기/쓰기 분리</td><td>성능 최적화</td><td>Event Sourcing과 보완</td></tr><tr><td><strong>Saga</strong></td><td>분산 트랜잭션</td><td>마이크로서비스 조정</td><td>복잡한 워크플로우</td></tr></tbody></table><hr><h2 id=8-구현-기법>8. 구현 기법<a hidden class=anchor aria-hidden=true href=#8-구현-기법>#</a></h2><h3 id=1-기본-event-store-구현>1. 기본 Event Store 구현<a hidden class=anchor aria-hidden=true href=#1-기본-event-store-구현>#</a></h3><p><strong>정의</strong>: 이벤트를 순차적으로 저장하는 데이터베이스 구현
<strong>구성</strong>: 이벤트 테이블, 스트림 관리, 동시성 제어
<strong>목적</strong>: 모든 도메인 이벤트의 안전한 저장과 조회</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>events</span><span class=p>,</span> <span class=n>expected_version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_version</span> <span class=o>!=</span> <span class=n>expected_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>ConcurrencyException</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>current_version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>from_version</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>][</span><span class=n>from_version</span><span class=p>:]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-snapshot-구현>2. Snapshot 구현<a hidden class=anchor aria-hidden=true href=#2-snapshot-구현>#</a></h3><p><strong>정의</strong>: 특정 시점의 애그리거트 상태를 저장하는 최적화 기법
<strong>구성</strong>: 스냅샷 저장소, 스냅샷 생성 정책, 복원 로직
<strong>목적</strong>: 많은 이벤트 재생 없이 빠른 상태 복원</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33>33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34>34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35>35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Snapshot</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>version</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SnapshotStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>snapshot</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=p>[</span><span class=n>snapshot</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>snapshot</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshots</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AggregateRepository</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>,</span> <span class=n>snapshot_store</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span> <span class=o>=</span> <span class=n>snapshot_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_aggregate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>snapshot</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>snapshot_store</span><span class=o>.</span><span class=n>get_snapshot</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>snapshot</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>,</span> <span class=n>snapshot</span><span class=o>.</span><span class=n>version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>restore_from_snapshot</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>aggregate_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_new_aggregate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>aggregate</span><span class=o>.</span><span class=n>apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>aggregate</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-cqrs-프로젝션-구현>3. CQRS 프로젝션 구현<a hidden class=anchor aria-hidden=true href=#3-cqrs-프로젝션-구현>#</a></h3><p><strong>정의</strong>: 이벤트로부터 읽기 전용 뷰를 생성하는 메커니즘
<strong>구성</strong>: 이벤트 핸들러, 프로젝션 저장소, 업데이트 로직
<strong>목적</strong>: 쿼리에 최적화된 다양한 뷰 제공</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_confirmed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;confirmed&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;confirmed_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_orders_by_customer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>order</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>values</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>order</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>customer_id</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=9-장점>9. 장점<a hidden class=anchor aria-hidden=true href=#9-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>완전한 감사 추적</strong></td><td>모든 상태 변화가 불변 이벤트로 기록되어 완벽한 감사 로그 제공. 규정 준수와 보안 감사에 필수적</td></tr><tr><td></td><td><strong>시점별 상태 복원</strong></td><td>이벤트 재생을 통해 과거 임의 시점의 정확한 상태 재구성 가능. 디버깅과 분석에 강력한 도구 제공</td></tr><tr><td></td><td><strong>높은 쓰기 성능</strong></td><td>Append-only 구조로 락 경합 최소화하여 높은 쓰기 처리량 달성</td></tr><tr><td></td><td><strong>이벤트 기반 통합</strong></td><td>이벤트 스트림을 통한 자연스러운 시스템 간 통합과 마이크로서비스 아키텍처 지원</td></tr><tr><td></td><td><strong>비즈니스 인사이트</strong></td><td>이벤트 히스토리를 통한 풍부한 비즈니스 분석과 패턴 인식 가능</td></tr><tr><td></td><td><strong>확장성</strong></td><td>CQRS와 결합하여 읽기와 쓰기 워크로드의 독립적 확장 지원</td></tr></tbody></table><hr><h2 id=10-단점과-문제점-그리고-해결방안>10. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#10-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>복잡성 증가</strong></td><td>전통적 CRUD 대비 시스템 설계와 구현 복잡도 대폭 증가</td><td>단계별 도입, 팀 교육, 프레임워크 활용</td></tr><tr><td></td><td><strong>학습 곡선</strong></td><td>개발팀의 새로운 패러다임 학습 필요, 개발 생산성 초기 저하</td><td>충분한 교육 기간, 멘토링, 점진적 적용</td></tr><tr><td></td><td><strong>저장소 요구사항</strong></td><td>모든 이벤트 저장으로 인한 높은 스토리지 사용량</td><td>이벤트 압축, 아카이빙, 스냅샷 활용</td></tr><tr><td></td><td><strong>최종 일관성</strong></td><td>프로젝션 업데이트 지연으로 인한 읽기 데이터 불일치 가능성</td><td>적절한 캐싱, 사용자 경험 설계, 일관성 모니터링</td></tr></tbody></table><h3 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td><strong>이벤트 재생 성능 저하</strong></td><td>대량의 이벤트 누적으로 상태 복원 시간 증가</td><td>시스템 응답 시간 저하, 사용자 경험 악화</td><td>성능 모니터링, 재생 시간 측정</td><td>스냅샷 정책 수립, 이벤트 스트림 설계 최적화</td><td>스냅샷 구현, 이벤트 압축, 스트림 분할</td></tr><tr><td></td><td><strong>스키마 진화 문제</strong></td><td>시간이 지나면서 이벤트 구조 변경 필요성</td><td>기존 이벤트와 호환성 문제</td><td>스키마 버전 추적, 역직렬화 오류 모니터링</td><td>이벤트 버전 관리, 스키마 레지스트리 사용</td><td>이벤트 업캐스팅, 다중 버전 지원</td></tr><tr><td></td><td><strong>동시성 충돌</strong></td><td>동일 애그리거트에 대한 동시 업데이트</td><td>데이터 일관성 문제, 비즈니스 규칙 위반</td><td>버전 충돌 예외 모니터링</td><td>낙관적 동시성 제어, 적절한 애그리거트 경계 설정</td><td>재시도 메커니즘, 충돌 해결 정책 구현</td></tr><tr><td></td><td><strong>프로젝션 실패</strong></td><td>이벤트 처리 중 오류 발생</td><td>읽기 모델 불일치, 데이터 누락</td><td>프로젝션 상태 모니터링, 이벤트 처리 로그</td><td>멱등한 이벤트 핸들러 설계, 오류 처리 로직</td><td>Dead Letter Queue, 수동 복구 도구, 프로젝션 재구축</td></tr></tbody></table><hr><h2 id=11-도전-과제>11. 도전 과제<a hidden class=anchor aria-hidden=true href=#11-도전-과제>#</a></h2><h3 id=성능-및-확장성-과제>성능 및 확장성 과제<a hidden class=anchor aria-hidden=true href=#성능-및-확장성-과제>#</a></h3><p><strong>원인</strong>: 이벤트 볼륨 증가와 복잡한 프로젝션 처리
<strong>영향</strong>: 시스템 응답 시간 저하와 리소스 사용량 증가
<strong>해결 방법</strong>:</p><ul><li>이벤트 스트림 파티셔닝</li><li>병렬 프로젝션 처리</li><li>캐싱 전략 최적화</li><li>하드웨어 스케일 아웃</li></ul><h3 id=데이터-일관성-과제>데이터 일관성 과제<a hidden class=anchor aria-hidden=true href=#데이터-일관성-과제>#</a></h3><p><strong>원인</strong>: 분산 환경에서의 최종 일관성 모델
<strong>영향</strong>: 일시적 데이터 불일치와 사용자 혼란
<strong>해결 방법</strong>:</p><ul><li>적절한 일관성 경계 설정</li><li>사용자 인터페이스에서 일관성 상태 표시</li><li>보상 트랜잭션 구현</li></ul><h3 id=운영-및-모니터링-과제>운영 및 모니터링 과제<a hidden class=anchor aria-hidden=true href=#운영-및-모니터링-과제>#</a></h3><p><strong>원인</strong>: 복잡한 이벤트 기반 워크플로우
<strong>영향</strong>: 문제 진단 어려움과 운영 복잡성
<strong>해결 방법</strong>:</p><ul><li>포괄적인 이벤트 추적 시스템</li><li>실시간 대시보드와 알림</li><li>자동화된 복구 메커니즘</li></ul><hr><h2 id=12-분류-기준에-따른-종류-및-유형>12. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#12-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th><th>특징</th></tr></thead><tbody><tr><td><strong>저장소 타입</strong></td><td>In-Memory</td><td>메모리 내 이벤트 저장</td><td>빠른 성능, 휘발성</td></tr><tr><td></td><td>Relational DB</td><td>관계형 데이터베이스 사용</td><td>ACID 보장, 복잡한 쿼리</td></tr><tr><td></td><td>NoSQL</td><td>문서/키-값 데이터베이스</td><td>수평 확장, 스키마 유연성</td></tr><tr><td></td><td>Specialized</td><td>EventStoreDB 등 전용 저장소</td><td>이벤트 최적화, 고성능</td></tr><tr><td><strong>아키텍처 패턴</strong></td><td>Pure Event Sourcing</td><td>이벤트만으로 상태 관리</td><td>완전한 이벤트 기반</td></tr><tr><td></td><td>CQRS + Event Sourcing</td><td>읽기/쓰기 분리 결합</td><td>성능 최적화</td></tr><tr><td></td><td>Hybrid</td><td>일부 상태는 전통적 저장</td><td>점진적 도입 가능</td></tr><tr><td><strong>동시성 모델</strong></td><td>Single Writer</td><td>단일 작성자 모델</td><td>충돌 방지</td></tr><tr><td></td><td>Optimistic Concurrency</td><td>낙관적 동시성 제어</td><td>높은 처리량</td></tr><tr><td></td><td>Event Collapsing</td><td>이벤트 병합</td><td>중복 제거</td></tr></tbody></table><hr><h2 id=13-실무-사용-예시>13. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#13-실무-사용-예시>#</a></h2><table><thead><tr><th>활용 영역</th><th>목적</th><th>효과</th><th>동반 기술</th></tr></thead><tbody><tr><td><strong>금융 시스템</strong></td><td>거래 내역 완전 추적, 규정 준수</td><td>완벽한 감사 추적, 사기 탐지 향상</td><td>CQRS, 블록체인</td></tr><tr><td><strong>전자상거래</strong></td><td>주문 상태 관리, 재고 추적</td><td>정확한 재고 관리, 주문 히스토리 분석</td><td>마이크로서비스, API Gateway</td></tr><tr><td><strong>의료 정보 시스템</strong></td><td>환자 진료 기록 관리</td><td>의료 과실 방지, 치료 이력 추적</td><td>HL7 FHIR, 암호화</td></tr><tr><td><strong>게임 플랫폼</strong></td><td>플레이어 행동 분석, 게임 상태 관리</td><td>치트 방지, 게임 밸런싱 개선</td><td>실시간 분석, Machine Learning</td></tr><tr><td><strong>IoT 플랫폼</strong></td><td>센서 데이터 수집, 이벤트 처리</td><td>예측 유지보수, 이상 탐지</td><td>Stream Processing, Edge Computing</td></tr></tbody></table><hr><h2 id=14-활용-사례-전자상거래-주문-관리-시스템>14. 활용 사례: 전자상거래 주문 관리 시스템<a hidden class=anchor aria-hidden=true href=#14-활용-사례-전자상거래-주문-관리-시스템>#</a></h2><h3 id=시스템-구성>시스템 구성<a hidden class=anchor aria-hidden=true href=#시스템-구성>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;사용자 인터페이스&#34;
        A[Web Frontend]
        B[Mobile App]
    end
    
    subgraph &#34;API Gateway&#34;
        C[Order API]
        D[Inventory API]
        E[Payment API]
    end
    
    subgraph &#34;Command Side&#34;
        F[Order Service]
        G[Inventory Service]
        H[Payment Service]
    end
    
    subgraph &#34;Event Store&#34;
        I[(EventStoreDB)]
    end
    
    subgraph &#34;Query Side&#34;
        J[Order Projection]
        K[Inventory Projection]
        L[Analytics Projection]
        M[(Read Database)]
    end
    
    subgraph &#34;Message Bus&#34;
        N[Kafka]
    end
    
    A --&gt; C
    B --&gt; C
    C --&gt; F
    F --&gt; I
    I --&gt; N
    N --&gt; J
    J --&gt; M
    M --&gt; A
</pre><h3 id=workflow>Workflow<a hidden class=anchor aria-hidden=true href=#workflow>#</a></h3><ol><li><p><strong>주문 생성</strong></p><ul><li>고객이 상품을 장바구니에 추가하고 주문 생성</li><li>OrderCreatedEvent 생성 및 저장</li><li>재고 서비스로 이벤트 전파</li></ul></li><li><p><strong>재고 확인 및 예약</strong></p><ul><li>재고 서비스가 주문 이벤트 수신</li><li>재고 확인 후 ItemReservedEvent 생성</li><li>결제 서비스로 이벤트 전파</li></ul></li><li><p><strong>결제 처리</strong></p><ul><li>결제 서비스가 결제 진행</li><li>PaymentProcessedEvent 생성</li><li>주문 확정 처리</li></ul></li></ol><h3 id=event-sourcing의-역할>Event Sourcing의 역할<a hidden class=anchor aria-hidden=true href=#event-sourcing의-역할>#</a></h3><ul><li><strong>상태 추적</strong>: 주문의 모든 상태 변화를 이벤트로 기록</li><li><strong>일관성 보장</strong>: 서비스 간 이벤트 기반 통신으로 최종 일관성 확보</li><li><strong>감사 추적</strong>: 주문 처리 과정의 완전한 추적 가능</li><li><strong>복구 지원</strong>: 시스템 장애 시 이벤트 재생을 통한 상태 복구</li></ul><h3 id=event-sourcing-유무에-따른-차이점>Event Sourcing 유무에 따른 차이점<a hidden class=anchor aria-hidden=true href=#event-sourcing-유무에-따른-차이점>#</a></h3><p><strong>Event Sourcing 사용</strong>:</p><ul><li>주문 상태 변화의 완전한 히스토리 보존</li><li>서비스 간 느슨한 결합</li><li>높은 확장성과 가용성</li><li>복잡한 비즈니스 로직 처리 용이</li></ul><p><strong>전통적 CRUD 사용</strong>:</p><ul><li>현재 상태만 저장하여 히스토리 손실</li><li>서비스 간 강한 결합</li><li>확장성 제한</li><li>동시성 문제와 데이터 일관성 이슈</li></ul><hr><h2 id=15-구현-예시>15. 구현 예시<a hidden class=anchor aria-hidden=true href=#15-구현-예시>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>  1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>  2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>  3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>  4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>  5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>  6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>  7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8>  8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9>  9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10> 10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11> 11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12> 12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13> 13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14> 14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15> 15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16> 16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17> 17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18> 18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19> 19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20> 20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21> 21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22> 22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23> 23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24> 24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25> 25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26> 26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27> 27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28> 28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29> 29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30> 30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31> 31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32> 32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33> 33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34> 34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35> 35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36> 36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37> 37</a>
</span><span class=lnt id=hl-12-38><a class=lnlinks href=#hl-12-38> 38</a>
</span><span class=lnt id=hl-12-39><a class=lnlinks href=#hl-12-39> 39</a>
</span><span class=lnt id=hl-12-40><a class=lnlinks href=#hl-12-40> 40</a>
</span><span class=lnt id=hl-12-41><a class=lnlinks href=#hl-12-41> 41</a>
</span><span class=lnt id=hl-12-42><a class=lnlinks href=#hl-12-42> 42</a>
</span><span class=lnt id=hl-12-43><a class=lnlinks href=#hl-12-43> 43</a>
</span><span class=lnt id=hl-12-44><a class=lnlinks href=#hl-12-44> 44</a>
</span><span class=lnt id=hl-12-45><a class=lnlinks href=#hl-12-45> 45</a>
</span><span class=lnt id=hl-12-46><a class=lnlinks href=#hl-12-46> 46</a>
</span><span class=lnt id=hl-12-47><a class=lnlinks href=#hl-12-47> 47</a>
</span><span class=lnt id=hl-12-48><a class=lnlinks href=#hl-12-48> 48</a>
</span><span class=lnt id=hl-12-49><a class=lnlinks href=#hl-12-49> 49</a>
</span><span class=lnt id=hl-12-50><a class=lnlinks href=#hl-12-50> 50</a>
</span><span class=lnt id=hl-12-51><a class=lnlinks href=#hl-12-51> 51</a>
</span><span class=lnt id=hl-12-52><a class=lnlinks href=#hl-12-52> 52</a>
</span><span class=lnt id=hl-12-53><a class=lnlinks href=#hl-12-53> 53</a>
</span><span class=lnt id=hl-12-54><a class=lnlinks href=#hl-12-54> 54</a>
</span><span class=lnt id=hl-12-55><a class=lnlinks href=#hl-12-55> 55</a>
</span><span class=lnt id=hl-12-56><a class=lnlinks href=#hl-12-56> 56</a>
</span><span class=lnt id=hl-12-57><a class=lnlinks href=#hl-12-57> 57</a>
</span><span class=lnt id=hl-12-58><a class=lnlinks href=#hl-12-58> 58</a>
</span><span class=lnt id=hl-12-59><a class=lnlinks href=#hl-12-59> 59</a>
</span><span class=lnt id=hl-12-60><a class=lnlinks href=#hl-12-60> 60</a>
</span><span class=lnt id=hl-12-61><a class=lnlinks href=#hl-12-61> 61</a>
</span><span class=lnt id=hl-12-62><a class=lnlinks href=#hl-12-62> 62</a>
</span><span class=lnt id=hl-12-63><a class=lnlinks href=#hl-12-63> 63</a>
</span><span class=lnt id=hl-12-64><a class=lnlinks href=#hl-12-64> 64</a>
</span><span class=lnt id=hl-12-65><a class=lnlinks href=#hl-12-65> 65</a>
</span><span class=lnt id=hl-12-66><a class=lnlinks href=#hl-12-66> 66</a>
</span><span class=lnt id=hl-12-67><a class=lnlinks href=#hl-12-67> 67</a>
</span><span class=lnt id=hl-12-68><a class=lnlinks href=#hl-12-68> 68</a>
</span><span class=lnt id=hl-12-69><a class=lnlinks href=#hl-12-69> 69</a>
</span><span class=lnt id=hl-12-70><a class=lnlinks href=#hl-12-70> 70</a>
</span><span class=lnt id=hl-12-71><a class=lnlinks href=#hl-12-71> 71</a>
</span><span class=lnt id=hl-12-72><a class=lnlinks href=#hl-12-72> 72</a>
</span><span class=lnt id=hl-12-73><a class=lnlinks href=#hl-12-73> 73</a>
</span><span class=lnt id=hl-12-74><a class=lnlinks href=#hl-12-74> 74</a>
</span><span class=lnt id=hl-12-75><a class=lnlinks href=#hl-12-75> 75</a>
</span><span class=lnt id=hl-12-76><a class=lnlinks href=#hl-12-76> 76</a>
</span><span class=lnt id=hl-12-77><a class=lnlinks href=#hl-12-77> 77</a>
</span><span class=lnt id=hl-12-78><a class=lnlinks href=#hl-12-78> 78</a>
</span><span class=lnt id=hl-12-79><a class=lnlinks href=#hl-12-79> 79</a>
</span><span class=lnt id=hl-12-80><a class=lnlinks href=#hl-12-80> 80</a>
</span><span class=lnt id=hl-12-81><a class=lnlinks href=#hl-12-81> 81</a>
</span><span class=lnt id=hl-12-82><a class=lnlinks href=#hl-12-82> 82</a>
</span><span class=lnt id=hl-12-83><a class=lnlinks href=#hl-12-83> 83</a>
</span><span class=lnt id=hl-12-84><a class=lnlinks href=#hl-12-84> 84</a>
</span><span class=lnt id=hl-12-85><a class=lnlinks href=#hl-12-85> 85</a>
</span><span class=lnt id=hl-12-86><a class=lnlinks href=#hl-12-86> 86</a>
</span><span class=lnt id=hl-12-87><a class=lnlinks href=#hl-12-87> 87</a>
</span><span class=lnt id=hl-12-88><a class=lnlinks href=#hl-12-88> 88</a>
</span><span class=lnt id=hl-12-89><a class=lnlinks href=#hl-12-89> 89</a>
</span><span class=lnt id=hl-12-90><a class=lnlinks href=#hl-12-90> 90</a>
</span><span class=lnt id=hl-12-91><a class=lnlinks href=#hl-12-91> 91</a>
</span><span class=lnt id=hl-12-92><a class=lnlinks href=#hl-12-92> 92</a>
</span><span class=lnt id=hl-12-93><a class=lnlinks href=#hl-12-93> 93</a>
</span><span class=lnt id=hl-12-94><a class=lnlinks href=#hl-12-94> 94</a>
</span><span class=lnt id=hl-12-95><a class=lnlinks href=#hl-12-95> 95</a>
</span><span class=lnt id=hl-12-96><a class=lnlinks href=#hl-12-96> 96</a>
</span><span class=lnt id=hl-12-97><a class=lnlinks href=#hl-12-97> 97</a>
</span><span class=lnt id=hl-12-98><a class=lnlinks href=#hl-12-98> 98</a>
</span><span class=lnt id=hl-12-99><a class=lnlinks href=#hl-12-99> 99</a>
</span><span class=lnt id=hl-12-100><a class=lnlinks href=#hl-12-100>100</a>
</span><span class=lnt id=hl-12-101><a class=lnlinks href=#hl-12-101>101</a>
</span><span class=lnt id=hl-12-102><a class=lnlinks href=#hl-12-102>102</a>
</span><span class=lnt id=hl-12-103><a class=lnlinks href=#hl-12-103>103</a>
</span><span class=lnt id=hl-12-104><a class=lnlinks href=#hl-12-104>104</a>
</span><span class=lnt id=hl-12-105><a class=lnlinks href=#hl-12-105>105</a>
</span><span class=lnt id=hl-12-106><a class=lnlinks href=#hl-12-106>106</a>
</span><span class=lnt id=hl-12-107><a class=lnlinks href=#hl-12-107>107</a>
</span><span class=lnt id=hl-12-108><a class=lnlinks href=#hl-12-108>108</a>
</span><span class=lnt id=hl-12-109><a class=lnlinks href=#hl-12-109>109</a>
</span><span class=lnt id=hl-12-110><a class=lnlinks href=#hl-12-110>110</a>
</span><span class=lnt id=hl-12-111><a class=lnlinks href=#hl-12-111>111</a>
</span><span class=lnt id=hl-12-112><a class=lnlinks href=#hl-12-112>112</a>
</span><span class=lnt id=hl-12-113><a class=lnlinks href=#hl-12-113>113</a>
</span><span class=lnt id=hl-12-114><a class=lnlinks href=#hl-12-114>114</a>
</span><span class=lnt id=hl-12-115><a class=lnlinks href=#hl-12-115>115</a>
</span><span class=lnt id=hl-12-116><a class=lnlinks href=#hl-12-116>116</a>
</span><span class=lnt id=hl-12-117><a class=lnlinks href=#hl-12-117>117</a>
</span><span class=lnt id=hl-12-118><a class=lnlinks href=#hl-12-118>118</a>
</span><span class=lnt id=hl-12-119><a class=lnlinks href=#hl-12-119>119</a>
</span><span class=lnt id=hl-12-120><a class=lnlinks href=#hl-12-120>120</a>
</span><span class=lnt id=hl-12-121><a class=lnlinks href=#hl-12-121>121</a>
</span><span class=lnt id=hl-12-122><a class=lnlinks href=#hl-12-122>122</a>
</span><span class=lnt id=hl-12-123><a class=lnlinks href=#hl-12-123>123</a>
</span><span class=lnt id=hl-12-124><a class=lnlinks href=#hl-12-124>124</a>
</span><span class=lnt id=hl-12-125><a class=lnlinks href=#hl-12-125>125</a>
</span><span class=lnt id=hl-12-126><a class=lnlinks href=#hl-12-126>126</a>
</span><span class=lnt id=hl-12-127><a class=lnlinks href=#hl-12-127>127</a>
</span><span class=lnt id=hl-12-128><a class=lnlinks href=#hl-12-128>128</a>
</span><span class=lnt id=hl-12-129><a class=lnlinks href=#hl-12-129>129</a>
</span><span class=lnt id=hl-12-130><a class=lnlinks href=#hl-12-130>130</a>
</span><span class=lnt id=hl-12-131><a class=lnlinks href=#hl-12-131>131</a>
</span><span class=lnt id=hl-12-132><a class=lnlinks href=#hl-12-132>132</a>
</span><span class=lnt id=hl-12-133><a class=lnlinks href=#hl-12-133>133</a>
</span><span class=lnt id=hl-12-134><a class=lnlinks href=#hl-12-134>134</a>
</span><span class=lnt id=hl-12-135><a class=lnlinks href=#hl-12-135>135</a>
</span><span class=lnt id=hl-12-136><a class=lnlinks href=#hl-12-136>136</a>
</span><span class=lnt id=hl-12-137><a class=lnlinks href=#hl-12-137>137</a>
</span><span class=lnt id=hl-12-138><a class=lnlinks href=#hl-12-138>138</a>
</span><span class=lnt id=hl-12-139><a class=lnlinks href=#hl-12-139>139</a>
</span><span class=lnt id=hl-12-140><a class=lnlinks href=#hl-12-140>140</a>
</span><span class=lnt id=hl-12-141><a class=lnlinks href=#hl-12-141>141</a>
</span><span class=lnt id=hl-12-142><a class=lnlinks href=#hl-12-142>142</a>
</span><span class=lnt id=hl-12-143><a class=lnlinks href=#hl-12-143>143</a>
</span><span class=lnt id=hl-12-144><a class=lnlinks href=#hl-12-144>144</a>
</span><span class=lnt id=hl-12-145><a class=lnlinks href=#hl-12-145>145</a>
</span><span class=lnt id=hl-12-146><a class=lnlinks href=#hl-12-146>146</a>
</span><span class=lnt id=hl-12-147><a class=lnlinks href=#hl-12-147>147</a>
</span><span class=lnt id=hl-12-148><a class=lnlinks href=#hl-12-148>148</a>
</span><span class=lnt id=hl-12-149><a class=lnlinks href=#hl-12-149>149</a>
</span><span class=lnt id=hl-12-150><a class=lnlinks href=#hl-12-150>150</a>
</span><span class=lnt id=hl-12-151><a class=lnlinks href=#hl-12-151>151</a>
</span><span class=lnt id=hl-12-152><a class=lnlinks href=#hl-12-152>152</a>
</span><span class=lnt id=hl-12-153><a class=lnlinks href=#hl-12-153>153</a>
</span><span class=lnt id=hl-12-154><a class=lnlinks href=#hl-12-154>154</a>
</span><span class=lnt id=hl-12-155><a class=lnlinks href=#hl-12-155>155</a>
</span><span class=lnt id=hl-12-156><a class=lnlinks href=#hl-12-156>156</a>
</span><span class=lnt id=hl-12-157><a class=lnlinks href=#hl-12-157>157</a>
</span><span class=lnt id=hl-12-158><a class=lnlinks href=#hl-12-158>158</a>
</span><span class=lnt id=hl-12-159><a class=lnlinks href=#hl-12-159>159</a>
</span><span class=lnt id=hl-12-160><a class=lnlinks href=#hl-12-160>160</a>
</span><span class=lnt id=hl-12-161><a class=lnlinks href=#hl-12-161>161</a>
</span><span class=lnt id=hl-12-162><a class=lnlinks href=#hl-12-162>162</a>
</span><span class=lnt id=hl-12-163><a class=lnlinks href=#hl-12-163>163</a>
</span><span class=lnt id=hl-12-164><a class=lnlinks href=#hl-12-164>164</a>
</span><span class=lnt id=hl-12-165><a class=lnlinks href=#hl-12-165>165</a>
</span><span class=lnt id=hl-12-166><a class=lnlinks href=#hl-12-166>166</a>
</span><span class=lnt id=hl-12-167><a class=lnlinks href=#hl-12-167>167</a>
</span><span class=lnt id=hl-12-168><a class=lnlinks href=#hl-12-168>168</a>
</span><span class=lnt id=hl-12-169><a class=lnlinks href=#hl-12-169>169</a>
</span><span class=lnt id=hl-12-170><a class=lnlinks href=#hl-12-170>170</a>
</span><span class=lnt id=hl-12-171><a class=lnlinks href=#hl-12-171>171</a>
</span><span class=lnt id=hl-12-172><a class=lnlinks href=#hl-12-172>172</a>
</span><span class=lnt id=hl-12-173><a class=lnlinks href=#hl-12-173>173</a>
</span><span class=lnt id=hl-12-174><a class=lnlinks href=#hl-12-174>174</a>
</span><span class=lnt id=hl-12-175><a class=lnlinks href=#hl-12-175>175</a>
</span><span class=lnt id=hl-12-176><a class=lnlinks href=#hl-12-176>176</a>
</span><span class=lnt id=hl-12-177><a class=lnlinks href=#hl-12-177>177</a>
</span><span class=lnt id=hl-12-178><a class=lnlinks href=#hl-12-178>178</a>
</span><span class=lnt id=hl-12-179><a class=lnlinks href=#hl-12-179>179</a>
</span><span class=lnt id=hl-12-180><a class=lnlinks href=#hl-12-180>180</a>
</span><span class=lnt id=hl-12-181><a class=lnlinks href=#hl-12-181>181</a>
</span><span class=lnt id=hl-12-182><a class=lnlinks href=#hl-12-182>182</a>
</span><span class=lnt id=hl-12-183><a class=lnlinks href=#hl-12-183>183</a>
</span><span class=lnt id=hl-12-184><a class=lnlinks href=#hl-12-184>184</a>
</span><span class=lnt id=hl-12-185><a class=lnlinks href=#hl-12-185>185</a>
</span><span class=lnt id=hl-12-186><a class=lnlinks href=#hl-12-186>186</a>
</span><span class=lnt id=hl-12-187><a class=lnlinks href=#hl-12-187>187</a>
</span><span class=lnt id=hl-12-188><a class=lnlinks href=#hl-12-188>188</a>
</span><span class=lnt id=hl-12-189><a class=lnlinks href=#hl-12-189>189</a>
</span><span class=lnt id=hl-12-190><a class=lnlinks href=#hl-12-190>190</a>
</span><span class=lnt id=hl-12-191><a class=lnlinks href=#hl-12-191>191</a>
</span><span class=lnt id=hl-12-192><a class=lnlinks href=#hl-12-192>192</a>
</span><span class=lnt id=hl-12-193><a class=lnlinks href=#hl-12-193>193</a>
</span><span class=lnt id=hl-12-194><a class=lnlinks href=#hl-12-194>194</a>
</span><span class=lnt id=hl-12-195><a class=lnlinks href=#hl-12-195>195</a>
</span><span class=lnt id=hl-12-196><a class=lnlinks href=#hl-12-196>196</a>
</span><span class=lnt id=hl-12-197><a class=lnlinks href=#hl-12-197>197</a>
</span><span class=lnt id=hl-12-198><a class=lnlinks href=#hl-12-198>198</a>
</span><span class=lnt id=hl-12-199><a class=lnlinks href=#hl-12-199>199</a>
</span><span class=lnt id=hl-12-200><a class=lnlinks href=#hl-12-200>200</a>
</span><span class=lnt id=hl-12-201><a class=lnlinks href=#hl-12-201>201</a>
</span><span class=lnt id=hl-12-202><a class=lnlinks href=#hl-12-202>202</a>
</span><span class=lnt id=hl-12-203><a class=lnlinks href=#hl-12-203>203</a>
</span><span class=lnt id=hl-12-204><a class=lnlinks href=#hl-12-204>204</a>
</span><span class=lnt id=hl-12-205><a class=lnlinks href=#hl-12-205>205</a>
</span><span class=lnt id=hl-12-206><a class=lnlinks href=#hl-12-206>206</a>
</span><span class=lnt id=hl-12-207><a class=lnlinks href=#hl-12-207>207</a>
</span><span class=lnt id=hl-12-208><a class=lnlinks href=#hl-12-208>208</a>
</span><span class=lnt id=hl-12-209><a class=lnlinks href=#hl-12-209>209</a>
</span><span class=lnt id=hl-12-210><a class=lnlinks href=#hl-12-210>210</a>
</span><span class=lnt id=hl-12-211><a class=lnlinks href=#hl-12-211>211</a>
</span><span class=lnt id=hl-12-212><a class=lnlinks href=#hl-12-212>212</a>
</span><span class=lnt id=hl-12-213><a class=lnlinks href=#hl-12-213>213</a>
</span><span class=lnt id=hl-12-214><a class=lnlinks href=#hl-12-214>214</a>
</span><span class=lnt id=hl-12-215><a class=lnlinks href=#hl-12-215>215</a>
</span><span class=lnt id=hl-12-216><a class=lnlinks href=#hl-12-216>216</a>
</span><span class=lnt id=hl-12-217><a class=lnlinks href=#hl-12-217>217</a>
</span><span class=lnt id=hl-12-218><a class=lnlinks href=#hl-12-218>218</a>
</span><span class=lnt id=hl-12-219><a class=lnlinks href=#hl-12-219>219</a>
</span><span class=lnt id=hl-12-220><a class=lnlinks href=#hl-12-220>220</a>
</span><span class=lnt id=hl-12-221><a class=lnlinks href=#hl-12-221>221</a>
</span><span class=lnt id=hl-12-222><a class=lnlinks href=#hl-12-222>222</a>
</span><span class=lnt id=hl-12-223><a class=lnlinks href=#hl-12-223>223</a>
</span><span class=lnt id=hl-12-224><a class=lnlinks href=#hl-12-224>224</a>
</span><span class=lnt id=hl-12-225><a class=lnlinks href=#hl-12-225>225</a>
</span><span class=lnt id=hl-12-226><a class=lnlinks href=#hl-12-226>226</a>
</span><span class=lnt id=hl-12-227><a class=lnlinks href=#hl-12-227>227</a>
</span><span class=lnt id=hl-12-228><a class=lnlinks href=#hl-12-228>228</a>
</span><span class=lnt id=hl-12-229><a class=lnlinks href=#hl-12-229>229</a>
</span><span class=lnt id=hl-12-230><a class=lnlinks href=#hl-12-230>230</a>
</span><span class=lnt id=hl-12-231><a class=lnlinks href=#hl-12-231>231</a>
</span><span class=lnt id=hl-12-232><a class=lnlinks href=#hl-12-232>232</a>
</span><span class=lnt id=hl-12-233><a class=lnlinks href=#hl-12-233>233</a>
</span><span class=lnt id=hl-12-234><a class=lnlinks href=#hl-12-234>234</a>
</span><span class=lnt id=hl-12-235><a class=lnlinks href=#hl-12-235>235</a>
</span><span class=lnt id=hl-12-236><a class=lnlinks href=#hl-12-236>236</a>
</span><span class=lnt id=hl-12-237><a class=lnlinks href=#hl-12-237>237</a>
</span><span class=lnt id=hl-12-238><a class=lnlinks href=#hl-12-238>238</a>
</span><span class=lnt id=hl-12-239><a class=lnlinks href=#hl-12-239>239</a>
</span><span class=lnt id=hl-12-240><a class=lnlinks href=#hl-12-240>240</a>
</span><span class=lnt id=hl-12-241><a class=lnlinks href=#hl-12-241>241</a>
</span><span class=lnt id=hl-12-242><a class=lnlinks href=#hl-12-242>242</a>
</span><span class=lnt id=hl-12-243><a class=lnlinks href=#hl-12-243>243</a>
</span><span class=lnt id=hl-12-244><a class=lnlinks href=#hl-12-244>244</a>
</span><span class=lnt id=hl-12-245><a class=lnlinks href=#hl-12-245>245</a>
</span><span class=lnt id=hl-12-246><a class=lnlinks href=#hl-12-246>246</a>
</span><span class=lnt id=hl-12-247><a class=lnlinks href=#hl-12-247>247</a>
</span><span class=lnt id=hl-12-248><a class=lnlinks href=#hl-12-248>248</a>
</span><span class=lnt id=hl-12-249><a class=lnlinks href=#hl-12-249>249</a>
</span><span class=lnt id=hl-12-250><a class=lnlinks href=#hl-12-250>250</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 기본 클래스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DomainEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=o>=</span> <span class=n>aggregate_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span> <span class=o>=</span> <span class=n>event_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;aggregate_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 관련 이벤트들</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderCreatedEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;price&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderConfirmedEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;OrderConfirmed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=n>payment_id</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderShippedEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=s1>&#39;OrderShipped&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;tracking_number&#39;</span><span class=p>:</span> <span class=n>tracking_number</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 상태 열거형</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderStatus</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>CREATED</span> <span class=o>=</span> <span class=s2>&#34;created&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>CONFIRMED</span> <span class=o>=</span> <span class=s2>&#34;confirmed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SHIPPED</span> <span class=o>=</span> <span class=s2>&#34;shipped&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>DELIVERED</span> <span class=o>=</span> <span class=s2>&#34;delivered&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>CANCELLED</span> <span class=o>=</span> <span class=s2>&#34;cancelled&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 애그리거트</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>order_id</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>payment_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tracking_number</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;새 주문 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order already exists&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>,</span> <span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>confirm_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CREATED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order cannot be confirmed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderConfirmedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>ship_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>!=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Order cannot be shipped&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>OrderShippedEvent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>tracking_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_apply_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>DomainEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 애그리거트에 적용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>total</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CREATED</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderConfirmed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>payment_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>CONFIRMED</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;OrderShipped&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>tracking_number</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;tracking_number&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>OrderStatus</span><span class=o>.</span><span class=n>SHIPPED</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_from_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 히스토리로부터 상태 복원&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_apply_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_uncommitted_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;커밋되지 않은 이벤트 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mark_events_committed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 커밋된 것으로 표시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>uncommitted_events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 저장소</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>events</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>],</span> <span class=n>expected_version</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트를 스트림에 추가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_version</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_version</span> <span class=o>!=</span> <span class=n>expected_version</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Concurrency conflict. Expected version </span><span class=si>{</span><span class=n>expected_version</span><span class=si>}</span><span class=s2>, but was </span><span class=si>{</span><span class=n>current_version</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>current_version</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current_version</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregate_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>from_version</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>DomainEvent</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 스트림 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>aggregate_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=p>[</span><span class=n>aggregate_id</span><span class=p>][</span><span class=n>from_version</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 레포지토리</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderRepository</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_store</span><span class=p>:</span> <span class=n>EventStore</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span> <span class=o>=</span> <span class=n>event_store</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n>Order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 저장 (이벤트 저장)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>get_uncommitted_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>expected_version</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>version</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>append_events</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>events</span><span class=p>,</span> <span class=n>expected_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=o>.</span><span class=n>mark_events_committed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 로드 (이벤트 재생)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span><span class=o>.</span><span class=n>load_from_history</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 프로젝션 (CQRS 읽기 모델)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProjection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>OrderCreatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;tracking_number&#39;</span><span class=p>:</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_confirmed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>OrderConfirmedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 확정 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;confirmed&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;confirmed_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_shipped</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>OrderShippedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 배송 이벤트 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;shipped&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;tracking_number&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;tracking_number&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>aggregate_id</span><span class=p>][</span><span class=s1>&#39;shipped_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_orders_by_customer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;고객별 주문 목록 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>order</span> <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>values</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>order</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>customer_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 인프라 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>event_store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>order_repository</span> <span class=o>=</span> <span class=n>OrderRepository</span><span class=p>(</span><span class=n>event_store</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_projection</span> <span class=o>=</span> <span class=n>OrderProjection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 새 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span><span class=s2>&#34;customer-456&#34;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;p1&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;상품1&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>10000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;p2&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;상품2&#34;</span><span class=p>,</span> <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=mi>5000</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>order_repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프로젝션 업데이트 (실제로는 이벤트 버스를 통해 자동화)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderCreatedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>order_projection</span><span class=o>.</span><span class=n>handle_order_created</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 확정</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=o>.</span><span class=n>confirm_order</span><span class=p>(</span><span class=s2>&#34;payment-789&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프로젝션 업데이트</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>event_store</span><span class=o>.</span><span class=n>get_events</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>,</span> <span class=n>from_version</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderConfirmedEvent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>order_projection</span><span class=o>.</span><span class=n>handle_order_confirmed</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 읽기 모델에서 주문 조회</span>
</span></span><span class=line><span class=cl>    <span class=n>order_view</span> <span class=o>=</span> <span class=n>order_projection</span><span class=o>.</span><span class=n>get_order</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 상태: </span><span class=si>{</span><span class=n>order_view</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;총 금액: </span><span class=si>{</span><span class=n>order_view</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 히스토리로부터 주문 복원</span>
</span></span><span class=line><span class=cl>    <span class=n>restored_order</span> <span class=o>=</span> <span class=n>order_repository</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;order-123&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;복원된 주문 상태: </span><span class=si>{</span><span class=n>restored_order</span><span class=o>.</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=16-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>16. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#16-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>도메인 모델링</strong></td><td>비즈니스 이벤트 식별</td><td>기술적 이벤트와 비즈니스 이벤트 혼동</td><td>도메인 전문가와 협업하여 의미있는 이벤트 정의</td></tr><tr><td><strong>애그리거트 설계</strong></td><td>적절한 경계 설정</td><td>너무 큰 애그리거트로 인한 성능 저하</td><td>단일 트랜잭션 경계 내에서 일관성 보장 범위 설정</td></tr><tr><td><strong>이벤트 스키마</strong></td><td>진화 가능한 스키마 설계</td><td>하위 호환성 깨짐</td><td>스키마 버전 관리와 업캐스팅 전략 수립</td></tr><tr><td><strong>동시성 제어</strong></td><td>낙관적 동시성 선택</td><td>높은 충돌률 환경에서 성능 저하</td><td>비즈니스 특성에 맞는 동시성 전략 선택</td></tr><tr><td><strong>저장소 선택</strong></td><td>요구사항에 맞는 저장소</td><td>잘못된 저장소 선택으로 인한 성능 문제</td><td>이벤트 처리량, 쿼리 패턴 분석 후 선택</td></tr></tbody></table><hr><h2 id=17-최적화하기-위한-고려사항-및-주의할-점>17. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#17-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능 최적화</strong></td><td>스냅샷 전략 수립</td><td>너무 빈번한 스냅샷으로 인한 오버헤드</td><td>비즈니스 특성에 맞는 스냅샷 주기 결정</td></tr><tr><td><strong>캐싱 전략</strong></td><td>읽기 성능 향상</td><td>캐시 일관성 문제</td><td>Redis, 메모리 캐시를 활용한 계층화된 캐싱</td></tr><tr><td><strong>이벤트 압축</strong></td><td>저장소 용량 최적화</td><td>중요한 이벤트 손실 위험</td><td>비즈니스 규칙에 따른 압축 정책 수립</td></tr><tr><td><strong>파티셔닝</strong></td><td>수평 확장 지원</td><td>파티션 간 이벤트 순서 보장 문제</td><td>애그리거트 ID 기반 파티셔닝 전략</td></tr><tr><td><strong>배치 처리</strong></td><td>프로젝션 처리 최적화</td><td>실시간성 요구사항과 충돌</td><td>실시간과 배치 처리의 하이브리드 접근</td></tr></tbody></table><hr><h2 id=18-주제와-관련하여-주목할-내용>18. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#18-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>아키텍처 패턴</strong></td><td>CQRS</td><td>Command Query Responsibility Segregation</td><td>Event Sourcing과 함께 사용되는 읽기/쓰기 분리 패턴</td></tr><tr><td></td><td>Saga Pattern</td><td>분산 트랜잭션 관리</td><td>마이크로서비스 환경에서 장기 실행 프로세스 조정</td></tr><tr><td><strong>데이터 관리</strong></td><td>Event Store</td><td>전용 이벤트 데이터베이스</td><td>이벤트 저장에 특화된 데이터베이스 솔루션</td></tr><tr><td></td><td>Stream Processing</td><td>실시간 이벤트 처리</td><td>Apache Kafka, Pulsar 등을 활용한 스트리밍 처리</td></tr><tr><td><strong>구현 기술</strong></td><td>Event Versioning</td><td>이벤트 스키마 버전 관리</td><td>시간에 따른 이벤트 구조 변화 대응</td></tr><tr><td></td><td>Projection</td><td>읽기 모델 생성</td><td>이벤트로부터 다양한 뷰 생성 기법</td></tr><tr><td><strong>성능 최적화</strong></td><td>Snapshots</td><td>상태 복원 최적화</td><td>긴 이벤트 스트림의 성능 문제 해결</td></tr><tr><td></td><td>Caching</td><td>캐시 전략</td><td>Redis, 메모리 캐시를 활용한 성능 향상</td></tr></tbody></table><hr><h2 id=19-반드시-학습해야할-내용>19. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#19-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 개념</strong></td><td>Domain-Driven Design</td><td>도메인 주도 설계</td><td>Event Sourcing의 이론적 기반이 되는 설계 방법론</td></tr><tr><td></td><td>Aggregate Pattern</td><td>애그리거트 패턴</td><td>일관성 경계를 정의하는 DDD 핵심 패턴</td></tr><tr><td><strong>관련 패턴</strong></td><td>CQRS</td><td>명령 쿼리 책임 분리</td><td>Event Sourcing과 함께 사용되는 핵심 패턴</td></tr><tr><td></td><td>Materialized View</td><td>구체화된 뷰</td><td>이벤트로부터 읽기 최적화 뷰 생성</td></tr><tr><td><strong>기술 스택</strong></td><td>Message Broker</td><td>메시지 브로커</td><td>Apache Kafka, RabbitMQ 등 이벤트 전파 기술</td></tr><tr><td></td><td>Event Store Database</td><td>이벤트 저장소</td><td>EventStoreDB, Apache Kafka 등 전용 데이터베이스</td></tr><tr><td><strong>고급 주제</strong></td><td>Event Sourcing Patterns</td><td>이벤트 소싱 패턴들</td><td>Snapshot, Upcasting, Event Collapsing 등</td></tr><tr><td></td><td>Distributed Systems</td><td>분산 시스템</td><td>CAP 정리, 일관성 모델, 분산 트랜잭션</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>Event Store (이벤트 저장소)</td><td>이벤트를 시간순으로 저장하는 append-only 데이터베이스</td></tr><tr><td></td><td>Event Stream (이벤트 스트림)</td><td>특정 애그리거트와 관련된 이벤트들의 순차적 시퀀스</td></tr><tr><td></td><td>Aggregate (애그리거트)</td><td>일관성 경계를 형성하는 도메인 객체들의 집합</td></tr><tr><td></td><td>Projection (프로젝션)</td><td>이벤트 스트림으로부터 생성되는 읽기 전용 뷰</td></tr><tr><td><strong>기술 용어</strong></td><td>Snapshot (스냅샷)</td><td>특정 시점의 애그리거트 상태를 저장한 최적화 기법</td></tr><tr><td></td><td>Upcasting (업캐스팅)</td><td>구버전 이벤트를 신버전 형식으로 변환하는 과정</td></tr><tr><td></td><td>Idempotency (멱등성)</td><td>동일한 연산을 여러 번 수행해도 결과가 같은 성질</td></tr><tr><td></td><td>Optimistic Concurrency (낙관적 동시성)</td><td>충돌이 드물다고 가정하고 충돌 시 재시도하는 제어 방식</td></tr><tr><td><strong>아키텍처</strong></td><td>Command Handler (명령 핸들러)</td><td>사용자 명령을 받아 비즈니스 로직을 실행하는 컴포넌트</td></tr><tr><td></td><td>Event Handler (이벤트 핸들러)</td><td>이벤트를 받아 프로젝션을 업데이트하는 컴포넌트</td></tr><tr><td></td><td>Append-Only (추가 전용)</td><td>데이터 수정이나 삭제 없이 추가만 가능한 저장 방식</td></tr><tr><td></td><td>Eventually Consistent (최종 일관성)</td><td>즉시는 아니지만 결국에는 일관된 상태에 도달하는 일관성 모델</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Event Sourcing pattern - Azure Architecture Center</a></li><li><a href=https://microservices.io/patterns/data/event-sourcing.html>Microservices Pattern: Event sourcing</a></li><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Event Sourcing - Martin Fowler</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>CQRS and Event Sourcing in Java - Baeldung</a></li><li><a href=https://www.geeksforgeeks.org/dbms/event-sourcing-database-design-patterns/>Event Sourcing Database Design Patterns - GeeksforGeeks</a></li><li><a href=https://www.kurrent.io/event-sourcing>Beginner&rsquo;s Guide to Event Sourcing - Kurrent</a></li><li><a href=https://www.redpanda.com/guides/event-stream-processing-event-sourcing-database>Event sourcing database architecture - Redpanda</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html>Event Sourcing pattern - AWS Prescriptive Guidance</a></li></ul><hr><h2 id=1-태그-1>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-1>#</a></h2><ul><li><strong>Event-Sourcing</strong></li><li><strong>Event-Driven-Architecture</strong></li><li><strong>CQRS-Pattern</strong></li><li><strong>Data-Management</strong></li></ul><hr><h2 id=2-분류-구조-분석>2. 분류 구조 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석>#</a></h2><p><strong>계층 구조:</strong><br>Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Styles and Patterns > Architecture Patterns > Data Management</p><p><strong>분석 및 근거:</strong><br>이벤트 소싱은 시스템의 모든 상태 변경을 이벤트로 기록하고, 이를 통해 상태를 재구성하는 아키텍처 패턴입니다. 이는 “Architecture Styles and Patterns” 하위의 “Architecture Patterns”에 적합하며, 데이터 관리(Data Management)와도 밀접하게 연관되어 있으므로 하위로 포함하는 것이 타당합니다<a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">1</a><a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">3</a>.<br>이벤트 소싱은 이벤트 기반 아키텍처(Event-Driven Architecture), CQRS, 마이크로서비스 등과 함께 사용되어 확장성, 유지보수성, 감사 추적, 장애 복구 등 다양한 이점을 제공합니다.</p><hr><h2 id=3-요약200자-내외>3. 요약(200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약200자-내외>#</a></h2><p>이벤트 소싱은 시스템의 모든 상태 변화를 불변의 이벤트로 저장하고, 이를 재생하여 언제든지 상태를 재구성할 수 있는 데이터 관리 및 설계 패턴이다<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">5</a>.</p><hr><h2 id=4-개요250자-내외>4. 개요(250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요250자-내외>#</a></h2><p>이벤트 소싱은 기존 데이터베이스가 최종 상태만 저장하는 방식과 달리, 모든 상태 변화를 불변의 이벤트로 순차적으로 기록하여, 이벤트를 재생하면 시스템의 현재 상태와 과거 이력을 모두 추적할 수 있게 해주는 아키텍처 패턴이다. 감사, 장애 복구, 분석 등에 매우 효과적이다<a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">1</a><a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">3</a>.</p><hr><h2 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h2><ul><li><strong>이벤트(Event):</strong> 시스템에서 발생한 상태 변화(예: 계좌 개설, 입금, 출금 등)를 불변의 기록으로 저장<a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">4</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/service-per-team.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">7</a>.</li><li><strong>이벤트 저장소(Event Store):</strong> 모든 이벤트를 순차적으로 저장하는 저장소<a href="https://blog.bemi.io/rethinking-event-sourcing/?utm_source=chatgpt.com" title="It's Time to Rethink Event Sourcing - Bemi Blog">3</a><a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">9</a>.</li><li><strong>상태 재구성(Replay):</strong> 저장된 이벤트를 순차적으로 재생하여 현재 상태를 계산<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>불변성(Immutable):</strong> 이벤트는 한 번 기록되면 변경 또는 삭제되지 않음<a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">4</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>애그리게이트(Aggregate):</strong> 여러 이벤트를 묶어 하나의 도메인 객체로 관리하는 단위<a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing - Martin Fowler">11</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul><p><strong>실무 구현 요소</strong></p><ul><li><strong>이벤트(Event):</strong> 상태 변화 기록(필수)</li><li><strong>이벤트 저장소(Event Store):</strong> 이벤트 저장(필수)</li><li><strong>애그리게이트(Aggregate):</strong> 이벤트를 처리해 상태를 관리(필수)</li><li><strong>이벤트 핸들러(Event Handler):</strong> 이벤트 처리(필수)</li><li><strong>스냅샷(Snapshot):</strong> 주기적으로 상태를 저장해 재생 시간 단축(선택)</li><li><strong>커맨드(Command):</strong> 시스템에 수행 요청(필요 시)</li><li><strong>프로젝션(Projection):</strong> 이벤트를 기반으로 뷰(Read Model) 생성(필요 시, CQRS와 연계)</li></ul><hr><h2 id=6-조사-내용주요-항목별-정리>6. 조사 내용(주요 항목별 정리)<a hidden class=anchor aria-hidden=true href=#6-조사-내용주요-항목별-정리>#</a></h2><h3 id=배경-1>배경<a hidden class=anchor aria-hidden=true href=#배경-1>#</a></h3><p>기존 CRUD 방식은 최종 상태만 저장하므로, 과거 이력 추적이나 장애 복구, 감사, 분석이 어렵고, 동시성 문제 등 한계가 있었음. 이벤트 소싱은 이러한 문제를 해결하기 위해 등장한 패턴<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">14</a>.</p><h3 id=목적-및-필요성-1>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성-1>#</a></h3><ul><li><strong>감사 및 이력 추적:</strong> 모든 상태 변화를 이벤트로 기록해 추적 가능<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">2</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>장애 복구:</strong> 이벤트 재생을 통해 특정 시점으로 복구 가능<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">3</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>분석 및 디버깅:</strong> 이벤트 로그를 통해 시스템 동작 분석 및 디버깅 용이<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">2</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>확장성 및 유지보수성:</strong> 이벤트 기반 아키텍처와 결합해 확장성, 유지보수성 향상<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">2</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li><strong>이벤트 기록:</strong> 모든 상태 변화를 이벤트로 저장<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>상태 재구성:</strong> 이벤트를 재생해 현재 상태 계산<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>감사 및 분석:</strong> 이벤트 로그를 활용한 감사, 분석<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">2</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>장애 복구:</strong> 특정 시점으로 상태 복구<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">3</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li></ul><h3 id=특징-1>특징<a hidden class=anchor aria-hidden=true href=#특징-1>#</a></h3><ul><li><strong>불변성:</strong> 이벤트는 변경, 삭제 불가<a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">4</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>순차적 기록:</strong> 이벤트는 시간 순서대로 저장<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>재생 가능:</strong> 이벤트를 재생해 상태 복원<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>감사 및 추적:</strong> 모든 상태 변화 이력 보관<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">2</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li></ul><h3 id=핵심-원칙-1>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙-1>#</a></h3><ul><li><strong>불변성:</strong> 이벤트는 한 번 기록되면 변경 불가<a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">4</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>순차성:</strong> 이벤트는 시간 순서대로 저장<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>재생 가능성:</strong> 이벤트를 재생해 상태 복원<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li><li><strong>감사 가능성:</strong> 모든 상태 변화 이력 보관<a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">2</a><a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">10</a>.</li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Diagram: Event Sourcing Flow]
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│   Command   │ → │  Aggregate  │ → │   Event     │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span><span class=line><span class=cl>                                      ↓
</span></span><span class=line><span class=cl>┌─────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                Event Store                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>                                      ↓
</span></span><span class=line><span class=cl>┌─────────────┐   ┌─────────────┐   ┌─────────────┐
</span></span><span class=line><span class=cl>│   Replay    │ ← │  Projection │ ← │   Query     │
</span></span><span class=line><span class=cl>└─────────────┘   └─────────────┘   └─────────────┘
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Command:</strong> 시스템에 상태 변경 요청</li><li><strong>Aggregate:</strong> 이벤트를 생성해 상태 관리</li><li><strong>Event:</strong> 상태 변화 기록</li><li><strong>Event Store:</strong> 이벤트 저장</li><li><strong>Replay:</strong> 이벤트 재생으로 상태 복원</li><li><strong>Projection:</strong> 이벤트를 기반으로 뷰(Read Model) 생성</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><ul><li><strong>이벤트(Event):</strong> 상태 변화 기록(필수)</li><li><strong>이벤트 저장소(Event Store):</strong> 이벤트 저장(필수)</li><li><strong>애그리게이트(Aggregate):</strong> 이벤트를 처리해 상태 관리(필수)</li><li><strong>이벤트 핸들러(Event Handler):</strong> 이벤트 처리(필수)</li><li><strong>스냅샷(Snapshot):</strong> 주기적으로 상태 저장(선택)</li><li><strong>프로젝션(Projection):</strong> 이벤트를 기반으로 뷰 생성(선택, CQRS와 연계)</li></ul><p><strong>각 구성요소의 기능과 역할</strong></p><ul><li><strong>이벤트:</strong> 상태 변화 기록, 불변, 순차적 저장</li><li><strong>이벤트 저장소:</strong> 이벤트 저장, 재생 가능</li><li><strong>애그리게이트:</strong> 이벤트를 처리해 상태 관리</li><li><strong>이벤트 핸들러:</strong> 이벤트 처리(예: 이벤트 발행, 구독)</li><li><strong>스냅샷:</strong> 상태 저장, 재생 시간 단축</li><li><strong>프로젝션:</strong> 이벤트를 기반으로 뷰 생성</li></ul><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><ul><li><strong>이벤트 저장소:</strong> 이벤트를 순차적으로 저장(필수)</li><li><strong>애그리게이트:</strong> 이벤트를 처리해 상태 관리(필수)</li><li><strong>이벤트 핸들러:</strong> 이벤트 처리(필수)</li><li><strong>스냅샷:</strong> 주기적으로 상태 저장(선택)</li><li><strong>프로젝션:</strong> 이벤트를 기반으로 뷰 생성(선택, CQRS와 연계)</li><li><strong>이벤트 버스:</strong> 이벤트 발행/구독(선택, 분산 환경)</li></ul><p><strong>실제 예시(시나리오):</strong></p><ul><li><strong>은행 계좌 시스템:</strong> 계좌 개설, 입금, 출금 이벤트를 저장하고, 이벤트를 재생해 현재 잔액 계산<a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">4</a><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/service-per-team.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">7</a>.</li><li><strong>쇼핑몰 카트:</strong> 상품 추가, 제거 이벤트를 저장하고, 이벤트를 재생해 현재 카트 상태 계산<a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">9</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>특성 원인</th></tr></thead><tbody><tr><td>장점</td><td>감사 및 이력 추적</td><td>모든 상태 변화 이력 보관</td><td>이벤트 불변성, 순차적 기록</td></tr><tr><td>장점</td><td>장애 복구</td><td>특정 시점으로 상태 복구</td><td>이벤트 재생 가능성</td></tr><tr><td>장점</td><td>분석 및 디버깅</td><td>이벤트 로그로 동작 분석</td><td>이벤트 로그 보관</td></tr><tr><td>장점</td><td>확장성</td><td>이벤트 기반 아키텍처와 결합</td><td>이벤트 발행/구독 구조</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>기존 CRUD 방식보다 복잡</td><td>도메인 모델링 강화, 문서화</td></tr><tr><td>단점</td><td>성능 저하</td><td>이벤트가 많아질수록 재생 시간 증가</td><td>스냅샷, 프로젝션 활용</td></tr></tbody></table><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>이벤트 스키마 변경</td><td>비즈니스 요구사항 변화</td><td>기존 이벤트와 호환성 문제</td><td>코드 리뷰, 테스트</td><td>버전 관리, 이벤트 업캐스팅</td><td>이벤트 업캐스팅, 마이그레이션</td></tr><tr><td>문제점</td><td>데이터 불일치</td><td>프로젝션 지연, 이벤트 처리 실패</td><td>최신 상태 조회 지연</td><td>모니터링, 로그 분석</td><td>이벤트 처리 신뢰성 강화</td><td>이벤트 재처리, 프로젝션 최적화</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>도전 과제</td><td>대규모 시스템 적용</td><td>이벤트 수 증가, 프로젝션 복잡성</td><td>성능 저하, 유지보수 어려움</td><td>모니터링, 프로파일링</td><td>스냅샷, 프로젝션 분리</td><td>스냅샷, 프로젝션 최적화, 분산 처리</td></tr><tr><td>도전 과제</td><td>이벤트 순서 보장</td><td>분산 환경, 네트워크 지연</td><td>데이터 불일치</td><td>분산 추적, 로그 분석</td><td>이벤트 순서 보장 메커니즘</td><td>이벤트 버스, 분산 트랜잭션 관리</td></tr><tr><td>도전 과제</td><td>팀 온보딩 및 코드 관리</td><td>아키텍처 복잡성, 팀원 이해 부족</td><td>개발 비용 증가, 일관성 저하</td><td>코드 리뷰, 문서화</td><td>교육, 예시 코드 제공</td><td>문서화, 코드 리뷰, 멘토링</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>종류/유형</th><th>설명</th></tr></thead><tbody><tr><td>적용 범위</td><td>전체 시스템</td><td>시스템 전체에 이벤트 소싱 적용</td></tr><tr><td>적용 범위</td><td>도메인 단위</td><td>특정 도메인에만 이벤트 소싱 적용</td></tr><tr><td>저장 방식</td><td>이벤트 저장소</td><td>이벤트를 저장하는 전용 저장소 사용</td></tr><tr><td>저장 방식</td><td>일반 DB</td><td>일반 데이터베이스를 이벤트 저장소로 사용</td></tr><tr><td>연계 패턴</td><td>CQRS</td><td>이벤트 소싱과 CQRS 연계</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td>감사 및 이력 추적</td><td>EventStore, MongoDB, Kafka</td><td>모든 상태 변화 이력 보관</td></tr><tr><td>장애 복구</td><td>Spring Boot, PostgreSQL</td><td>특정 시점으로 상태 복구</td></tr><tr><td>분석 및 디버깅</td><td>Elasticsearch, Kibana</td><td>이벤트 로그 분석</td></tr><tr><td>확장성</td><td>RabbitMQ, Kafka</td><td>이벤트 기반 아키텍처와 결합</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><p><strong>은행 계좌 시스템:</strong><br>이벤트 소싱을 적용해 계좌 개설, 입금, 출금 이벤트를 저장하고, 이벤트를 재생해 현재 잔액 계산.</p><ul><li><strong>시스템 구성:</strong><ul><li>Command: 계좌 개설, 입금, 출금 요청</li><li>Aggregate: 계좌 상태 관리</li><li>Event: 계좌 개설됨, 입금 완료됨, 출금 처리됨</li><li>Event Store: 이벤트 저장소</li><li>Projection: 현재 잔액 뷰(Read Model)</li></ul></li><li><strong>Workflow:</strong><ul><li>사용자 → Command → Aggregate → Event → Event Store</li><li>Query → Projection(Read Model)</li></ul></li><li><strong>역할:</strong><ul><li>Command: 상태 변경 요청</li><li>Aggregate: 이벤트 생성 및 상태 관리</li><li>Event Store: 이벤트 저장</li><li>Projection: 뷰 생성</li></ul></li><li><strong>차이점:</strong><ul><li>기존 CRUD 방식은 최종 상태만 저장해 과거 이력 추적이 어렵고, 장애 복구, 감사, 분석이 제한적임.</li><li>이벤트 소싱은 모든 상태 변화를 이벤트로 저장해 과거 이력 추적, 장애 복구, 감사, 분석이 용이함.</li></ul></li></ul><h3 id=구현-예시-javascript>구현 예시 (JavaScript)<a hidden class=anchor aria-hidden=true href=#구현-예시-javascript>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30>30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31>31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32>32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33>33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34>34</a>
</span><span class=lnt id=hl-14-35><a class=lnlinks href=#hl-14-35>35</a>
</span><span class=lnt id=hl-14-36><a class=lnlinks href=#hl-14-36>36</a>
</span><span class=lnt id=hl-14-37><a class=lnlinks href=#hl-14-37>37</a>
</span><span class=lnt id=hl-14-38><a class=lnlinks href=#hl-14-38>38</a>
</span><span class=lnt id=hl-14-39><a class=lnlinks href=#hl-14-39>39</a>
</span><span class=lnt id=hl-14-40><a class=lnlinks href=#hl-14-40>40</a>
</span><span class=lnt id=hl-14-41><a class=lnlinks href=#hl-14-41>41</a>
</span><span class=lnt id=hl-14-42><a class=lnlinks href=#hl-14-42>42</a>
</span><span class=lnt id=hl-14-43><a class=lnlinks href=#hl-14-43>43</a>
</span><span class=lnt id=hl-14-44><a class=lnlinks href=#hl-14-44>44</a>
</span><span class=lnt id=hl-14-45><a class=lnlinks href=#hl-14-45>45</a>
</span><span class=lnt id=hl-14-46><a class=lnlinks href=#hl-14-46>46</a>
</span><span class=lnt id=hl-14-47><a class=lnlinks href=#hl-14-47>47</a>
</span><span class=lnt id=hl-14-48><a class=lnlinks href=#hl-14-48>48</a>
</span><span class=lnt id=hl-14-49><a class=lnlinks href=#hl-14-49>49</a>
</span><span class=lnt id=hl-14-50><a class=lnlinks href=#hl-14-50>50</a>
</span><span class=lnt id=hl-14-51><a class=lnlinks href=#hl-14-51>51</a>
</span><span class=lnt id=hl-14-52><a class=lnlinks href=#hl-14-52>52</a>
</span><span class=lnt id=hl-14-53><a class=lnlinks href=#hl-14-53>53</a>
</span><span class=lnt id=hl-14-54><a class=lnlinks href=#hl-14-54>54</a>
</span><span class=lnt id=hl-14-55><a class=lnlinks href=#hl-14-55>55</a>
</span><span class=lnt id=hl-14-56><a class=lnlinks href=#hl-14-56>56</a>
</span><span class=lnt id=hl-14-57><a class=lnlinks href=#hl-14-57>57</a>
</span><span class=lnt id=hl-14-58><a class=lnlinks href=#hl-14-58>58</a>
</span><span class=lnt id=hl-14-59><a class=lnlinks href=#hl-14-59>59</a>
</span><span class=lnt id=hl-14-60><a class=lnlinks href=#hl-14-60>60</a>
</span><span class=lnt id=hl-14-61><a class=lnlinks href=#hl-14-61>61</a>
</span><span class=lnt id=hl-14-62><a class=lnlinks href=#hl-14-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 이벤트 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>AccountCreatedEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>owner</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>owner</span> <span class=o>=</span> <span class=nx>owner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>initialBalance</span> <span class=o>=</span> <span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DepositMadeEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;DepositMade&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>WithdrawalProcessedEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;WithdrawalProcessed&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 애그리게이트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>AccountAggregate</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>events</span> <span class=o>=</span> <span class=nx>events</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>applyEvents</span><span class=p>(</span><span class=nx>events</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;DepositMade&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>+=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;WithdrawalProcessed&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>applyEvents</span><span class=p>(</span><span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>events</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=nx>e</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>deposit</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DepositMadeEvent</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WithdrawalProcessedEvent</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AccountAggregate</span><span class=p>([</span><span class=k>new</span> <span class=nx>AccountCreatedEvent</span><span class=p>(</span><span class=s1>&#39;acc1&#39;</span><span class=p>,</span> <span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)]);</span>
</span></span><span class=line><span class=cl><span class=nx>account</span><span class=p>.</span><span class=nx>deposit</span><span class=p>(</span><span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>account</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>account</span><span class=p>.</span><span class=nx>balance</span><span class=p>);</span> <span class=c1>// 1300
</span></span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>도메인 모델링</td><td>명확한 도메인 모델 설계</td><td>도메인 중심 설계 강화</td></tr><tr><td>이벤트 스키마</td><td>이벤트 스키마 변경 계획</td><td>버전 관리, 이벤트 업캐스팅</td></tr><tr><td>테스트</td><td>충분한 테스트</td><td>단위, 통합 테스트 강화</td></tr><tr><td>문서화</td><td>아키텍처 및 코드 문서화</td><td>문서화, 예시 코드 제공</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>스냅샷</td><td>이벤트가 많아질수록 재생 시간 증가</td><td>스냅샷 주기적 저장</td></tr><tr><td>프로젝션</td><td>뷰(Read Model) 생성 지연</td><td>프로젝션 최적화, 분산 처리</td></tr><tr><td>모니터링</td><td>분산 환경, 이벤트 처리 지연</td><td>모니터링, 로그 분석</td></tr></tbody></table><h3 id=기타-사항>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항>#</a></h3><ul><li><strong>CQRS와의 연계:</strong> 이벤트 소싱은 CQRS와 함께 사용 시 큰 시너지 효과(읽기/쓰기 분리, 뷰 최적화)<a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">15</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li><li><strong>마이크로서비스와의 연계:</strong> 이벤트 기반 아키텍처와 결합해 분산 시스템, 마이크로서비스에 적합<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">5</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li><li><strong>적용 범위:</strong> 모든 도메인에 적용할 필요 없음, 복잡한 도메인, 감사, 분석, 장애 복구가 필요한 곳에 적합<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">17</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul><hr><h2 id=7-추가-조사-내용-1>7. 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-추가-조사-내용-1>#</a></h2><ul><li><strong>이벤트 소싱과 CRUD 비교:</strong><ul><li><strong>CRUD:</strong> 최종 상태만 저장, 과거 이력 추적 어려움, 동시성 문제 발생 가능<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">4</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li><li><strong>이벤트 소싱:</strong> 모든 상태 변화를 이벤트로 저장, 과거 이력 추적, 장애 복구, 감사, 분석 용이<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">1</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul></li><li><strong>이벤트 소싱과 CQRS:</strong><ul><li>이벤트 소싱은 CQRS와 함께 사용 시 읽기/쓰기 분리, 뷰 최적화, 성능 향상<a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">15</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul></li><li><strong>적용 범위:</strong><ul><li>모든 도메인에 적용할 필요 없음, 복잡한 도메인, 감사, 분석, 장애 복구가 필요한 곳에 적합<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">17</a><a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">13</a>.</li></ul></li></ul><hr><h2 id=8-주목할-내용>8. 주목할 내용<a hidden class=anchor aria-hidden=true href=#8-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>Event Sourcing</td><td>불변성</td><td>이벤트는 한 번 기록되면 변경 불가</td></tr><tr><td>설계 패턴</td><td>Event Sourcing</td><td>순차성</td><td>이벤트는 시간 순서대로 저장</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>감사 및 이력 추적</td><td>모든 상태 변화 이력 보관</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>장애 복구</td><td>이벤트 재생으로 특정 시점 복구</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>분석 및 디버깅</td><td>이벤트 로그로 동작 분석</td></tr></tbody></table><hr><h2 id=9-반드시-학습해야-할-내용>9. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#9-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계 원칙</td><td>Event Sourcing</td><td>불변성</td><td>이벤트는 한 번 기록되면 변경 불가</td></tr><tr><td>설계 원칙</td><td>Event Sourcing</td><td>순차성</td><td>이벤트는 시간 순서대로 저장</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>감사 및 이력 추적</td><td>모든 상태 변화 이력 보관</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>장애 복구</td><td>이벤트 재생으로 특정 시점 복구</td></tr><tr><td>실무 적용</td><td>Event Sourcing</td><td>분석 및 디버깅</td><td>이벤트 로그로 동작 분석</td></tr></tbody></table><hr><h2 id=10-용어-정리>10. 용어 정리<a hidden class=anchor aria-hidden=true href=#10-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>설계 패턴</td><td>Event Sourcing</td><td>시스템의 모든 상태 변화를 불변의 이벤트로 저장하고, 이를 재생하여 상태를 재구성하는 패턴</td></tr><tr><td>설계 원칙</td><td>불변성</td><td>이벤트는 한 번 기록되면 변경 또는 삭제되지 않음</td></tr><tr><td>설계 원칙</td><td>순차성</td><td>이벤트는 시간 순서대로 저장됨</td></tr><tr><td>실무 적용</td><td>이벤트 저장소</td><td>이벤트를 저장하는 저장소</td></tr><tr><td>실무 적용</td><td>애그리게이트</td><td>여러 이벤트를 묶어 하나의 도메인 객체로 관리하는 단위</td></tr><tr><td>실무 적용</td><td>프로젝션</td><td>이벤트를 기반으로 뷰(Read Model) 생성</td></tr></tbody></table><hr><h2 id=11-참고-및-출처>11. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#11-참고-및-출처>#</a></h2><ul><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/event-sourcing>이벤트 소싱(Event Sourcing) 패턴 - Microsoft Learn</a></li><li><a href=https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html>이벤트 소싱 패턴 - AWS 권장 가이드</a></li><li><a href=https://sddev.tistory.com/111>이벤트 소싱(Event Sourcing) 개념 - devNote</a></li><li><a href=https://monday9pm.com/event-sourcing%EA%B3%BC-cqrs-1f6505035cbe>이벤트 소싱(Event Sourcing)과 CQRS 패턴 - monday9pm</a></li><li><a href=https://edykim.com/ko/post/event-sourcing-implementing-eventsourcing-patterns-with-javascript/>이벤트 소싱(Event Sourcing) JavaScript로 구현하기 - edykim</a></li><li><a href=https://sarc.io/index.php/cloud/2232-event-sourcing-pattern>이벤트 소싱(Event Sourcing) 패턴 - 삵(sarc.io)</a></li><li><a href=https://sabarada.tistory.com/231>이벤트 소싱(Event Sourcing) 맛보기 - 이론편 - saberada</a></li><li><a href=https://quddkflty.tistory.com/102>이벤트 소싱(Event Sourcing) 개념과 git 비교 - 병아리쇼</a></li><li><a href=https://velog.io/@bighaeil/Event-Sourcing-%EA%B5%AC%ED%98%84-with-Spring-Boot-MongoDB-Kafka>이벤트 소싱(Event Sourcing) 구현 with Spring Boot, MongoDB, Kafka - velog</a></li><li><a href=https://notavoid.tistory.com/218>이벤트 소싱(Event Sourcing)과 CQRS 패턴 심화 구현 - Spring Boot로 고급 이벤트 &mldr; - notavoid</a></li></ul><p><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing><figure><img alt="Event Sourcing pattern - Azure Architecture Center | Microsoft Learn" loading=lazy src="https://tse4.mm.bing.net/th/id/OIP.o6ZoY5sk83-tDISF-pVNtwHaEM?pid=Api"></figure></a></p><p>아래는 <strong>Event Sourcing</strong> 아키텍처에 대한 구조화된 분석입니다.</p><hr><h2 id=1-태그-2>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-2>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Event-Sourcing, Immutable-Events, Audit-Log, Replayable-State
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-분류-계층-적절성-분석>2. 분류 계층 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-계층-적절성-분석>#</a></h2><ul><li><p><strong>분류에 대한 평가</strong>:</p><blockquote><p>Computer Science and Engineering → Software Engineering → Design and Architecture → Architecture Styles and Patterns → Architecture Patterns → Data Management</p></blockquote></li><li><p><strong>분석 결과</strong>:</p><ul><li>적절한 계층 구조입니다. Event Sourcing은 변경 이벤트의 <strong>프로젝션</strong> 및 <strong>재생 가능 상태</strong>를 중앙에서 관리하는 데이터 중심 패턴으로, <strong>Data Management</strong> 하위 범주에 올바르게 위치합니다. (<a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">docs.aws.amazon.com</a>, <a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">stackoverflow.com</a>, <a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">learn.microsoft.com</a>)</li></ul></li></ul><hr><h2 id=3-200자-요약>3. 200자 요약<a hidden class=anchor aria-hidden=true href=#3-200자-요약>#</a></h2><p>Event Sourcing은 애플리케이션의 상태 변화를 <strong>이벤트</strong>로 불변하게 저장하는 패턴입니다. 현재 상태는 이벤트 스트림을 재생하여 구성되며, 모든 변경 기록이 남아 있어 <strong>감사</strong>, <strong>디버깅</strong>, <strong>시간 여행</strong>, <strong>이력 복원</strong> 등이 가능합니다. CQRS와 함께 쓰이면 읽기 모델 최적화와 확장성도 확보됩니다.</p><hr><h2 id=4-250자-개요>4. 250자 개요<a hidden class=anchor aria-hidden=true href=#4-250자-개요>#</a></h2><p>Event Sourcing은 도메인에서 발생하는 모든 상태 변경을 <strong>불변 이벤트</strong>로 저장하는 아키텍처 패턴입니다. 표준 CRUD 방식과 다르게 이벤트 로그가 **단일 출처(source of truth)**로 사용되며, **이벤트 저장소(Event Store)**에 append-only 방식으로 쌓입니다. 현재 상태는 이벤트 재생(replay)을 통해 계산되며, 이를 활용해 <strong>시점 조회</strong>, <strong>감사 로그</strong>, <strong>이력 복원</strong>, <strong>읽기 모델 프로젝션</strong>이 가능합니다. 특히 CQRS와 결합하면 이벤트는 Command Side에서 저장되고, Read Side에서 Projection을 통해 최적화된 조회용 뷰를 생성합니다. (<a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">docs.aws.amazon.com</a>)</p><hr><h2 id=5-핵심-개념-및-실무-구현-요소>5. 핵심 개념 및 실무 구현 요소<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-및-실무-구현-요소>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li><strong>Immutable Events</strong>: 모든 상태 변경은 변경 불가능한 이벤트로 기록됨</li><li><strong>Event Store</strong>: 이벤트를 순차적으로 저장하는 append-only 저장소 (<a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">docs.aws.amazon.com</a>)</li><li><strong>Event Replay</strong>: 저장된 이벤트를 순차 처리해 현재 상태를 재생산 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">learn.microsoft.com</a>)</li><li><strong>Projections / Read Models</strong>: 이벤트 소비 후 조회에 최적화된 구조로 가공된 뷰 생성 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">learn.microsoft.com</a>)</li><li><strong>Snapshot</strong>: 이벤트 재생 비용을 줄이기 위해 중간 상태를 저장하는 기법</li></ul><h3 id=구현-요소>구현 요소<a hidden class=anchor aria-hidden=true href=#구현-요소>#</a></h3><ul><li><code>Event</code> 클래스 정의 및 버전 관리</li><li><code>EventStore</code> 구성 (Kafka, EventStoreDB, RDBMS 로그 등)</li><li><code>Aggregate</code> 내 command 처리 로직과 이벤트 생성 함수</li><li><code>Projector</code> 구성하여 Read DB 업데이트</li><li><code>Snapshot</code> 저장 전략 및 소비자 구현</li><li>테스트 전략: 이벤트 replay 테스트, projection 검증, 동시성 처리</li></ul><hr><h2 id=6-구조-및-아키텍처--구성-요소>6. 구조 및 아키텍처 + 구성 요소<a hidden class=anchor aria-hidden=true href=#6-구조-및-아키텍처--구성-요소>#</a></h2><pre class=mermaid>flowchart LR
  UI/API --&gt; Cmd[Command Handler]
  Cmd --&gt; Agg[Aggregate] --&gt; EvtStore[Event Store (append-only)]
  EvtStore --&gt; EvtBus[Event Bus / Queue]
  EvtBus --&gt; Proj[Projector] --&gt; ReadDB[(Read Model DB)]
  EvtStore ==&gt; Replay[Snapshot mechanism]
</pre><ul><li><strong>Command Handler</strong>: command 입력 → Aggregate 실행 → 이벤트 생성</li><li><strong>Aggregate</strong>: 도메인 로직 수행 후 Event 반환</li><li><strong>Event Store</strong>: 이벤트 append 저장, 불변성 보장</li><li><strong>Event Bus / Queue</strong>: 이벤트를 비동기 배포</li><li><strong>Projector</strong>: 이벤트 소비 → Read DB 프로젝션 생성</li><li><strong>Read Model DB</strong>: 조회에 최적화된 Materialized View 제공</li><li><strong>Snapshot / Replay</strong>: 이벤트 재생 비용 절감을 위한 상태 저장 및 로딩</li></ul><p><strong>필수 구성요소</strong>: Event, Event Store, Aggregate, Projector, Read DB
<strong>선택 구성요소</strong>: Event Bus, Snapshot, Integration 이벤트 핸들러 등</p><hr><h2 id=7-주요-원리--작동-원리>7. 주요 원리 & 작동 원리<a hidden class=anchor aria-hidden=true href=#7-주요-원리--작동-원리>#</a></h2><ul><li><strong>불변성과 추적 가능성</strong>: 모든 변경을 이벤트로 캡처하여 완전한 이력 보장 (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">geeksforgeeks.org</a>, <a href="https://arxiv.org/abs/2407.11432?utm_source=chatgpt.com" title="Octopus: Experiences with a Hybrid Event-Driven Architecture for Distributed Scientific Computing">danielwhittaker.me</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/modernization-data-persistence/service-per-team.html?utm_source=chatgpt.com" title="Event sourcing pattern - AWS Prescriptive Guidance">en.wikipedia.org</a>, <a href="https://www.geeksforgeeks.org/system-design/event-sourcing-pattern/?utm_source=chatgpt.com" title="Event Sourcing Pattern - GeeksforGeeks">learn.microsoft.com</a>, <a href="https://blog.bemi.io/rethinking-event-sourcing/?utm_source=chatgpt.com" title="It's Time to Rethink Event Sourcing - Bemi Blog">upsolver.com</a>, <a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">docs.aws.amazon.com</a>)</li><li><strong>이벤트 재생을 통한 상태 복원</strong>: 이벤트 순서대로 처리하면 특정 시점 상태가 재현 가능</li><li><strong>CQRS 결합 구조</strong>: Write 모델은 이벤트 저장, Read 모델은 Projection을 통해 최적화 구조 구축 (<a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">docs.aws.amazon.com</a>)</li><li><strong>Snapshot 기반 최적화</strong>: 누적 이벤트 재생 비용 최소화 전략</li></ul><hr><h2 id=8-구현-기법-1>8. 구현 기법<a hidden class=anchor aria-hidden=true href=#8-구현-기법-1>#</a></h2><ul><li><strong>Event 정의 & 버전 관리</strong>: Event 타입과 Payload 정의 후 스키마 변경 대응(version field or upcasting) (<a href="https://www.theserverside.com/tip/How-the-event-sourcing-design-pattern-works-with-example?utm_source=chatgpt.com" title="How the event sourcing design pattern works, with example">en.wikipedia.org</a>)</li><li><strong>Event Store 구성</strong>: EventStoreDB, Kafka, RDBMS 이벤트 로그 활용</li><li><strong>Aggregate 클래스</strong>: <code>apply(event)</code> 방식으로 도메인 상태 변경, command 처리</li><li><strong>Projector</strong>: 이벤트 타입별 Subscription 설정 → Read DB 업데이트</li><li><strong>Snapshot 주기화</strong>: N번째 이벤트마다 Snapshot 생성 후 재생 시 Snapshot부터 시작</li><li><strong>백업/아카이빙</strong>: 장기 보존 이벤트 압축 또는 외부 저장소 전환</li></ul><hr><h2 id=9-장점-1>9. 장점<a hidden class=anchor aria-hidden=true href=#9-장점-1>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>감사 및 추적성</strong></td><td>이벤트 불변 저장으로 변경 내역 완전 기록</td></tr><tr><td></td><td><strong>이력 관리</strong></td><td>특정 시점 상태 재현 가능 (time travel)</td></tr><tr><td></td><td><strong>복원력</strong></td><td>롤백 없이 상태 재구성이 가능</td></tr><tr><td></td><td><strong>확장성</strong></td><td>다양한 프로젝션 생성, polyglot persistence 지원</td></tr><tr><td></td><td><strong>도메인 표현 적합성</strong></td><td>이벤트가 도메인 관점의 언어로 표현됨</td></tr></tbody></table><hr><h2 id=10-단점과-문제점--해결방안>10. 단점과 문제점 + 해결방안<a hidden class=anchor aria-hidden=true href=#10-단점과-문제점--해결방안>#</a></h2><h3 id=단점-2>단점<a hidden class=anchor aria-hidden=true href=#단점-2>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>복잡도 증가</strong></td><td>프로젝트 구조가 일반 CRUD보다 복잡 (<a href="https://microservices.io/patterns/data/event-sourcing.html?utm_source=chatgpt.com" title="Pattern: Event sourcing - Microservices.io">stackoverflow.com</a>)</td><td>단위 모듈 적용, 프레임워크 도입, 단계적 확장</td></tr><tr><td></td><td><strong>쿼리 어려움</strong></td><td>이벤트 로그 직접 쿼리 비효율</td><td>Read Model 구축 및 Projection 활용</td></tr><tr><td></td><td><strong>이벤트 버전 관리 부하</strong></td><td>이벤트 스키마 변경 시 어려움</td><td>upcasting, 버전 필드, backward-compatible 이벤트 설계</td></tr><tr><td></td><td><strong>스토리지 증가</strong></td><td>이벤트 저장 용량이 크게 증가</td><td>아카이빙, TTL, Snapshot 전략 사용</td></tr></tbody></table><h3 id=문제점-상세-분석>문제점 상세 분석<a hidden class=anchor aria-hidden=true href=#문제점-상세-분석>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지</th><th>예방</th><th>해결</th></tr></thead><tbody><tr><td>문제</td><td>Event replay 지연</td><td>누적 이벤트 재생 필요</td><td>시스템 부팅 느려짐, 상태 불확실</td><td>라그 시간 모니터링</td><td>Snapshot 전략, 주기적 미리 계산</td><td>자동 Snapshot, 이벤트 압축</td></tr><tr><td>문제</td><td>동시성 충돌</td><td>동일 도메인 동시 변경</td><td>상태 불일치 및 예외 발생</td><td>충돌 로그, 예외 모니터</td><td>optimistic concurrency, 버전 필드 사용</td><td>롤백/재시도 로직, 충돌 해결 UI</td></tr><tr><td>문제</td><td>과도한 이벤트</td><td>단순 상태 변경도 이벤트화</td><td>소비자 부담 증가, 이벤트 폭증</td><td>이벤트 수 증가 모니터링</td><td>비즈니스 이벤트만, 중요도 기반 선택</td><td>필터링, 청소, 미러링 전략</td></tr></tbody></table><hr><h2 id=11-도전-과제-1>11. 도전 과제<a hidden class=anchor aria-hidden=true href=#11-도전-과제-1>#</a></h2><ul><li><strong>이벤트 스키마 진화</strong>: 스키마 호환성·리팩토링 전략 필요</li><li><strong>모니터링 체계 구축</strong>: 이벤트 처리 지연 및 재시도 자동화</li><li><strong>관리 패턴 표준화</strong>: Event naming, 버전 관리, 필터 정책 가이드라인</li><li><strong>복잡한 도메인 적용</strong>: 미세 이벤트 vs. 복합 이벤트 수준 균형 잡기</li></ul><hr><h2 id=12-실무-사용-예시>12. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#12-실무-사용-예시>#</a></h2><table><thead><tr><th>스택</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Kafka + EventStoreDB + Spring Boot</td><td>금융 거래 이력 기록 및 감사</td><td>완전한 트랜잭션 추적, 재생 가능 상태 생성</td></tr><tr><td>.NET + Marten</td><td>주문시스템 상태 이력 관리</td><td>DB 롤백 없이 이력 복원, 이벤트 재가공</td></tr><tr><td>Node.js + AWS EventBridge</td><td>IoT 센서 데이터 수집</td><td>시간 기반 분석, 실패 메시지 재처리 지원</td></tr><tr><td>Laravel + spatie/laravel-event-sourcing</td><td>PHP 영역에서 PoC 구현</td><td>이벤트 구조 이해 및 조회 모델 분리</td></tr></tbody></table><hr><h2 id=13-활용-사례-금융-거래-시스템>13. 활용 사례: 금융 거래 시스템<a hidden class=anchor aria-hidden=true href=#13-활용-사례-금융-거래-시스템>#</a></h2><pre class=mermaid>flowchart LR
  subgraph Write
    API --&gt; Cmd
    Cmd --&gt; Agg[Account Aggregate]
    Agg --&gt; ES[Event Store]
    ES --&gt; Bus[Event Bus]
  end
  subgraph Read
    Bus --&gt; Proj[Transaction Projector]
    Proj --&gt; Read[(Read DB)]
      Read --&gt; UI
  end
</pre><ul><li><strong>Account Aggregate</strong>: 입출금 command 처리 후 <code>MoneyDeposited</code> 등 이벤트 생성</li><li><strong>Event Store</strong>: 거래 내역 이벤트만 기록</li><li><strong>Transaction Projector</strong>: 이벤트 소비 후 잔액, 거래 목록 프리젠테이션 뷰 생성</li><li><strong>장점 비교</strong>: CRUD 방식보다 정확한 이력 관리와 분리된 조회 모델로 성능 확보</li></ul><hr><h2 id=14-구현-예시-python--pseudocode>14. 구현 예시 (Python + Pseudocode)<a hidden class=anchor aria-hidden=true href=#14-구현-예시-python--pseudocode>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26>26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27>27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28>28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29>29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30>30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31>31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32>32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33>33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34>34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># events.py</span>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MoneyDeposited</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># aggregate.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AccountAggregate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>evt</span> <span class=o>=</span> <span class=n>MoneyDeposited</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>evt</span><span class=p>);</span> <span class=k>return</span> <span class=n>evt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># repository.py</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventStore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span> <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>):</span> <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># projector.py</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>project_transactions</span><span class=p>(</span><span class=n>events</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>balance</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>MoneyDeposited</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>balance</span> <span class=o>+=</span> <span class=n>e</span><span class=o>.</span><span class=n>amount</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>balance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># usage</span>
</span></span><span class=line><span class=cl><span class=n>agg</span> <span class=o>=</span> <span class=n>AccountAggregate</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>evt</span> <span class=o>=</span> <span class=n>agg</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>store</span> <span class=o>=</span> <span class=n>EventStore</span><span class=p>();</span> <span class=n>store</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;acct1&#34;</span><span class=p>,</span> <span class=n>evt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>events</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;acct1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>balance</span> <span class=o>=</span> <span class=n>project_transactions</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>balance</span><span class=p>)</span>  <span class=c1># 100</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=15-실무-적용-고려사항-및-최적화-권장-요약>15. 실무 적용 고려사항 및 최적화 권장 요약<a hidden class=anchor aria-hidden=true href=#15-실무-적용-고려사항-및-최적화-권장-요약>#</a></h2><ul><li><strong>적용 고려</strong>: 도메인 복잡도, 팀 역량, 감사지원 요구도 기반 적용 권장</li><li><strong>최적화 전략</strong>: Snapshot 도입, 이벤트(version) 전략, 도메인 이벤트 필터링</li><li><strong>운영 주의</strong>: 이벤트 모니터링, 재처리 환경, 이벤트 청소 정책 필수</li></ul><hr><h2 id=16-용어-정리>16. 용어 정리<a hidden class=anchor aria-hidden=true href=#16-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>개념</td><td>Event Store</td><td>불변한 이벤트 스트림을 순서대로 저장하는 저장소</td></tr><tr><td></td><td>Snapshot</td><td>이벤트 기반 상태 계산을 최적화하기 위한 중간 상태</td></tr><tr><td></td><td>Replay</td><td>저장된 이벤트들을 다시 실행하여 상태 재구성</td></tr><tr><td></td><td>Projection</td><td>이벤트 소비 후 읽기 모델로 변환하는 동작</td></tr><tr><td></td><td>Immutable Event</td><td>생성 후 변경되지 않는 상태 변경 이벤트</td></tr></tbody></table><hr><h2 id=17-참고-및-출처>17. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#17-참고-및-출처>#</a></h2><ul><li>Microservices.io, <em>Event Sourcing Pattern</em> (<a href="https://event-driven.io/en/when_not_to_use_event_sourcing/?utm_source=chatgpt.com" title="When not to use Event Sourcing? - Event-Driven.io">docs.aws.amazon.com</a>, <a href="https://fr.wikipedia.org/wiki/Architecture_orient%C3%A9e_%C3%A9v%C3%A9nements?utm_source=chatgpt.com" title="Architecture orientée événements">theserverside.com</a>, <a href="https://martinfowler.com/eaaDev/EventSourcing.html?utm_source=chatgpt.com" title="Event Sourcing - Martin Fowler">event-driven.io</a>, <a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">microservices.io</a>, <a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">geeksforgeeks.org</a>, <a href="https://blog.bemi.io/rethinking-event-sourcing/?utm_source=chatgpt.com" title="It's Time to Rethink Event Sourcing - Bemi Blog">upsolver.com</a>)</li><li>AWS Prescriptive Guidance, <em>Event Sourcing pattern</em> (<a href="https://www.kurrent.io/event-sourcing?utm_source=chatgpt.com" title="Beginner's Guide to Event Sourcing - Kurrent">docs.aws.amazon.com</a>)</li><li>Red Hat, <em>Pros and Cons of Event Sourcing</em> (<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">linkedin.com</a>)</li><li>StackOverflow, <em>Disadvantages of Event Sourcing</em></li><li>GeeksforGeeks, <em>Event Sourcing Pattern</em> (<a href="https://medium.com/%40alxkm/event-sourcing-explained-benefits-challenges-and-use-cases-d889dc96fc18?utm_source=chatgpt.com" title="Event Sourcing Explained: Benefits, Challenges, and Use Cases">geeksforgeeks.org</a>)</li><li>Martin Fowler, <em>Event Sourcing</em> (<a href="https://www.kurrent.io/blog/10-problems-that-event-sourcing-can-help-solve-for-you?utm_source=chatgpt.com" title="10 problems that Event Sourcing can help solve for you - Kurrent">microservices.io</a>)</li><li>Bemi Blog, <em>Event Sourcing is Hard</em> (<a href="https://en.wikipedia.org/wiki/Event-driven_architecture?utm_source=chatgpt.com" title="Event-driven architecture">chriskiehl.com</a>)</li><li>Innovecs Blog, <em>Event Sourcing 101</em> (<a href="https://innovecs.com/blog/event-sourcing-101-when-to-use-and-how-to-avoid-pitfalls/?utm_source=chatgpt.com" title="Event Sourcing 101: When to Use and How to Avoid Pitfalls - Innovecs">innovecs.com</a>)</li></ul><hr><p>🎯 <strong>정리 완료:</strong> Event Sourcing에 대한 핵심 개념부터 구조, 구현, 장단점, 실무 예시까지 포괄적으로 정리했습니다. 추가 프레임워크별 적용 가이드나 고급 최적화가 필요하면 언제든지 요청 주세요!</p><p>모든 주요 항목을 정리하셨습니다! 🎯
필요하시면 아래의 추가 지원도 제공 가능합니다:</p><ol><li><strong>프레임워크별 적용 가이드</strong> (.NET, Spring Boot, Node.js 등)</li><li><strong>고급 최적화 기법</strong> (e.g. Snapshot 전략, 이벤트 압축, 멀티 테넌시 지원 등)</li><li><strong>도전 과제 심화 분석</strong> (스키마 진화, 장애 대응, 모니터링/CI/CD 통합)</li><li><strong>분류 기준에 따른 종류 및 유형</strong> (예: CRUD vs Event-Sourced 시스템 비교)</li><li><strong>실무 적용 전 체크리스트</strong>, 적용 팁, 트레이드오프 분석 요약</li></ol><p>다음은 <strong>프레임워크별 적용 가이드</strong>입니다. .NET, Spring Boot, Node.js 중심으로 Event Sourcing + CQRS 구조를 실무에 적용하는 방법과 주요 체크포인트를 정리했습니다.</p><hr><h2 id=2-java--spring-boot--axon-framework>2. Java / Spring Boot + Axon Framework<a hidden class=anchor aria-hidden=true href=#2-java--spring-boot--axon-framework>#</a></h2><ul><li><p><strong>Axon 구성</strong>:</p><ul><li><code>@Aggregate</code>, <code>@CommandHandler</code>, <code>@EventSourcingHandler</code>, <code>@EventHandler</code> 등의 어노테이션 사용</li><li>EventStore는 JPA, MongoDB, Kafka 기반으로 설정 가능</li></ul></li><li><p><strong>도메인 모델</strong></p><ul><li><code>Aggregate</code> 클래스에서 <code>@CommandHandler</code> → do business logic → <code>apply()</code> event 호출</li></ul></li><li><p><strong>프로젝션(read model) 구성</strong>:</p><ul><li><code>@EventHandler</code> 클래스에서 <code>ReadRepository</code>에 쓰기</li><li><code>QueryGateway</code> 사용해 Query API 호출</li></ul></li><li><p><strong>Snapshot & 스케일링</strong></p><ul><li><code>@SnapshotTrigger</code> 사용 또는 Snapshot trigger policy 설정</li><li>Saga 패턴을 통한 비동기 장기 프로세스 관리</li></ul></li><li><p><strong>추가 기능</strong></p><ul><li>Event replay / reset via CLI</li><li>EventBus, Serializer, Metrics 자동 지원</li></ul></li></ul><hr><h2 id=3-nodejs--nestjs--typeorm--kafka>3. Node.js + NestJS + TypeORM + Kafka<a hidden class=anchor aria-hidden=true href=#3-nodejs--nestjs--typeorm--kafka>#</a></h2><ul><li><p><strong>Event Store 구현</strong></p><ul><li>Kafka 토픽 중심 저장: partition, offset 활용</li><li>관계형 DB 보조 store로 상태 저장 가능</li></ul></li><li><p><strong>도메인 / Command Handler</strong></p><ul><li>NestJS에서 <code>@CommandHandler()</code> 데코레이터 사용 + <code>CqrsModule</code></li><li><code>@EventPublisher()</code>로 publisher 주입</li></ul></li><li><p><strong>프로젝션</strong></p><ul><li><code>@EventsHandler()</code>에서 <code>ReadRepository.save()</code></li><li>TypeORM 리포지토리 기반 Read DB 테이블 업데이트</li></ul></li><li><p><strong>Snapshot</strong></p><ul><li>QoS 단위로 Kafka offset 관리 및 State 저장</li><li>Redis 등 외부 Key-Value store 활용</li></ul></li><li><p><strong>환경 설정</strong></p><ul><li>Nest Module 내 EventStore, CommandBus, EventBus 등록</li><li>ValidationPipe, Interceptor 통한 Idempotency/Retry 처리</li></ul></li></ul><hr><h2 id=-공통-적용-체크포인트>✅ 공통 적용 체크포인트<a hidden class=anchor aria-hidden=true href=#-공통-적용-체크포인트>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 불변성</td><td>스키마 변경 시 마이그레이션 필요</td><td>Version Field, Upcaster 적용</td></tr><tr><td>중복 처리</td><td>메시지 OO처리</td><td>Idempotent 핸들러 구현</td></tr><tr><td>일관성 보장</td><td>Write 모델/Read 모델 단일 원장 필요</td><td>Outbox 패턴 + 메시지 트랜잭션 구성</td></tr><tr><td>모니터링</td><td>이벤트 처리 흐름 추적 어려움</td><td>Lag, 처리율, 에러 메트릭 모니터링</td></tr><tr><td>장애 대응</td><td>메시지고립 및 장애 발생 가능</td><td>Dead-letter queue, 재시도 전략 구성</td></tr><tr><td>테스트 전략</td><td>CQRS 구조 분리로 테스트 케이스 증가</td><td>Core, Projection, Integration 테스트를 분리하여 구성</td></tr></tbody></table><hr><h3 id=-다음-단계-제안>🧭 다음 단계 제안<a hidden class=anchor aria-hidden=true href=#-다음-단계-제안>#</a></h3><ol><li><strong>고급 최적화 기법</strong> (snapshot 전략, 이벤트 압축, 멀티 테넌시 등)</li><li><strong>실무 도전 과제 심화</strong> (스키마 진화, 장애 대응, CI/CD 통합 전략)</li><li><strong>추가 코드 예시</strong>: Node.js 또는 Java 구현 샘플</li></ol><p>원하시는 항목을 지정해 주세요. 바로 이어서 정리해드리겠습니다!</p><p>다음은 <strong>고급 최적화 기법</strong> 및 <strong>실무에서 마주치는 도전 과제 심화 분석</strong>입니다.</p><hr><h2 id=1-고급-최적화-기법->1. 고급 최적화 기법 🌐<a hidden class=anchor aria-hidden=true href=#1-고급-최적화-기법->#</a></h2><h3 id=-snapshot-전략>• Snapshot 전략<a hidden class=anchor aria-hidden=true href=#-snapshot-전략>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 이벤트 재생 비용 절감 및 빠른 Aggregate 로딩</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>일정 이벤트 수(예: 500회)마다 <code>Snapshot</code> 저장</li><li>복구 시 마지막 Snapshot부터 이벤트 재생</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>비즈니스 중요한 시점 기준 스냅샷 생성</li><li>Snapshot 데이터 크기 최소화, 압축 저장</li></ul></li></ul><h3 id=-이벤트-압축-event-compression>• 이벤트 압축 (Event Compression)<a hidden class=anchor aria-hidden=true href=#-이벤트-압축-event-compression>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 유사 이벤트 병합으로 저장 공간 절감</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>중복/불필요 이벤트 탐지 및 주기적으로 축소</li><li>예: “Qty +5”, “Qty +3” → “Qty +8” 압축</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>도메인 의미 손상 안 되도록 이벤트 단위 유지</li><li>압축 주기 및 조건 조정 필요</li></ul></li></ul><h3 id=-이벤트-ttl--아카이빙>• 이벤트 TTL / 아카이빙<a hidden class=anchor aria-hidden=true href=#-이벤트-ttl--아카이빙>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 오래된 이벤트 관리 → 스토리지 비용 절감</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>TTL 설정 후 오래된 이벤트는 외부 저장소로 이동</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>아카이빙 정책 문서화, 복원 절차 포함</li><li>GDPR/법규 준수 여부 고려</li></ul></li></ul><h3 id=-멀티-테넌시-지원>• 멀티 테넌시 지원<a hidden class=anchor aria-hidden=true href=#-멀티-테넌시-지원>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: SaaS 환경에서 고객 격리 보장</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>네임스페이스별 이벤트 스트림 분리</li><li>테이블 파티셔닝 또는 토픽 분리 활용</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>추가 모니터링 처리량 분리</li><li>권한 경계(naming scope) 및 검증 로직 보강</li></ul></li></ul><h3 id=-백필링-backfilling>• 백필링 (Backfilling)<a hidden class=anchor aria-hidden=true href=#-백필링-backfilling>#</a></h3><ul><li><p><strong>목적 / 효과</strong>: 기존 이벤트로 오프라인 뷰 재생성, 코드 변경 영향 보강</p></li><li><p><strong>구현 방법</strong>:</p><ul><li>버전 이벤트 upcasting + 롤백부터 신규 코드 반영 재연산</li></ul></li><li><p><strong>주의 & 권장사항</strong>:</p><ul><li>고가용성 환경에서 배칭 처리, pause & resume 기능 필요</li><li>모니터링 및 실패 시 재시도 메커니즘 구축</li></ul></li></ul><hr><h2 id=2-도전-과제-심화-분석->2. 도전 과제 심화 분석 🔍<a hidden class=anchor aria-hidden=true href=#2-도전-과제-심화-분석->#</a></h2><h3 id=-이벤트-스키마-진화>• 이벤트 스키마 진화<a hidden class=anchor aria-hidden=true href=#-이벤트-스키마-진화>#</a></h3><ul><li><p><strong>원인</strong>: 도메인 로직 변화로 이벤트 구조가 변경됨</p></li><li><p><strong>영향</strong>: 오래된 이벤트 디코딩 실패, 재생 오류</p></li><li><p><strong>탐지/진단</strong>: 업스트림 로그 분석, 이벤트 리플레이 실패</p></li><li><p><strong>예방</strong>: 업캐스팅(upcasting) 전략, 버전 필드 포함 설계</p></li><li><p><strong>해결 기법</strong>:</p><ul><li>이벤트 리팩토링 시 새・구 버전 모두 파서 등록</li><li>데이터 마이그레이션 지원 또는 적응형 소비자</li></ul></li></ul><h3 id=-분산-장애-대응>• 분산 장애 대응<a hidden class=anchor aria-hidden=true href=#-분산-장애-대응>#</a></h3><ul><li><p><strong>원인</strong>: 이벤트 송수신 실패, 브로커 장애</p></li><li><p><strong>영향</strong>: Projection 지연/누락, 시스템 불안정</p></li><li><p><strong>탐지/진단</strong>: Dead Letter 큐 알림, 지연 메트릭</p></li><li><p><strong>예방</strong>: Exactly-once, idempotent 설계</p></li><li><p><strong>해결 기술</strong>:</p><ul><li>Dead-letter 큐, 재시도 전략</li><li>모니터링 기반 자동 복구</li><li>Outbox pattern + 브로커 트랜잭션</li></ul></li></ul><h3 id=-모니터링--추적>• 모니터링 & 추적<a hidden class=anchor aria-hidden=true href=#-모니터링--추적>#</a></h3><ul><li><p><strong>원인</strong>: 비동기 이벤트 흐름 복잡성</p></li><li><p><strong>영향</strong>: 장애 원인 분석 어려움</p></li><li><p><strong>탐지/진단</strong>: 분산 트레이싱 미비, 로그 단절</p></li><li><p><strong>예방</strong>: Correlation ID 및 Trace context 포함 설계</p></li><li><p><strong>해결 방법</strong>:</p><ul><li>Zipkin, OpenTelemetry 연동</li><li>Event dispatch / process 메트릭 수집</li></ul></li></ul><h3 id=-테스트--유지보수>• 테스트 & 유지보수<a hidden class=anchor aria-hidden=true href=#-테스트--유지보수>#</a></h3><ul><li><p><strong>원인</strong>: 이벤트 중심 결과 기반 테스트 복잡</p></li><li><p><strong>영향</strong>: 리그레션 위험 & 코드 가시성 감소</p></li><li><p><strong>탐지/진단</strong>: Projection 오류, 핸들러 실패</p></li><li><p><strong>예방</strong>: E2E/Contract 테스트 설계 철저</p></li><li><p><strong>해결 기술</strong>:</p><ul><li>Testcontainers 사용</li><li>모킹 가능한 EventBus, Projection 결과 검증 설정</li></ul></li></ul><hr><h2 id=3--요약-및-권장-가이드>3. ✅ 요약 및 권장 가이드<a hidden class=anchor aria-hidden=true href=#3--요약-및-권장-가이드>#</a></h2><ul><li><strong>최적화 전략</strong>: Snapshot + 이벤트 압축 + TTL 아카이빙 + 테넌시 분리 고려</li><li><strong>장애 대응</strong>: Dead-letter, Trace 모니터링, Outbox 트랜잭션 보강</li><li><strong>테스트 전략</strong>: 리그레션 방지 위한 E2E/Contract 테스트 구조화</li><li><strong>장기 운용 팁</strong>: 이벤트 스키마 진화 정책, 장애 자동 복구, 분산 tracing·metrics 구축</li></ul><hr><p>🎯 추가로 <strong>SAGA 패턴 통합</strong>, 특정 프레임워크 적용 코드 예시(.NET, NestJS), <strong>이벤트 기반 데이터 모델링 전략</strong>, 또는 <strong>보안/가버넌스 구축</strong>이 필요하시면 언제든지 요청해주세요!</p><p>이벤트 기반(Event-Driven) 아키텍처에서의 <strong>데이터 모델링 전략</strong>은 전통적인 CRUD 모델링과 달리 <strong>도메인 이벤트 중심</strong>으로 설계됩니다. 아래는 이벤트 기반 모델링 시 고려할 전략들을 실무 중심으로 정리한 내용입니다.</p><hr><h2 id=1-이벤트-기반-데이터-모델링의-핵심-원칙>1. 이벤트 기반 데이터 모델링의 핵심 원칙<a hidden class=anchor aria-hidden=true href=#1-이벤트-기반-데이터-모델링의-핵심-원칙>#</a></h2><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>도메인 중심</td><td>도메인 이벤트(Domain Events)를 기준으로 상태 전이 모델링</td></tr><tr><td>불변성</td><td>이벤트는 변경 불가(immutable) 데이터로 유지</td></tr><tr><td>비정규화</td><td>조회 성능 중심의 Projection 모델 설계 (Read Model)</td></tr><tr><td>일관성 지연</td><td>일관성(consistency)은 즉시가 아닌 이벤트에 의해 Eventually Consistent</td></tr><tr><td>책임 분리</td><td>Command 모델과 Query 모델을 명확히 분리 (CQRS)</td></tr></tbody></table><hr><h2 id=2-모델링-접근-방법>2. 모델링 접근 방법<a hidden class=anchor aria-hidden=true href=#2-모델링-접근-방법>#</a></h2><h3 id=--aggregate-중심-설계>🧩 ① Aggregate 중심 설계<a hidden class=anchor aria-hidden=true href=#--aggregate-중심-설계>#</a></h3><ul><li>한 트랜잭션 내 상태 변경의 단위를 Aggregate 단위로 정의</li><li>상태 변경은 Command → Event → Aggregate 상태 반영 흐름</li></ul><h3 id=--이벤트-유형-정의>🧾 ② 이벤트 유형 정의<a hidden class=anchor aria-hidden=true href=#--이벤트-유형-정의>#</a></h3><ul><li><code>OrderPlaced</code>, <code>PaymentCompleted</code>, <code>InventoryDecreased</code> 등 도메인 상태 전이에 기반한 이벤트 정의</li><li>Event는 과거형으로 명명</li></ul><h3 id=--event-sourcing-기반-상태-재생>🗃️ ③ Event Sourcing 기반 상태 재생<a hidden class=anchor aria-hidden=true href=#--event-sourcing-기반-상태-재생>#</a></h3><ul><li>Entity 상태를 DB에 저장하지 않고 이벤트 스트림 기반으로 복원</li><li>변경 상태 = 이전 상태 + 이벤트 집합</li></ul><h3 id=--projection-모델링-read-model>🗂️ ④ Projection 모델링 (Read Model)<a hidden class=anchor aria-hidden=true href=#--projection-모델링-read-model>#</a></h3><ul><li>각 View 목적에 맞게 다수의 Projection 테이블 설계</li><li>예: <code>CustomerView</code>, <code>OrderSummaryView</code>, <code>PaymentStatsView</code> 등</li></ul><h3 id=--이벤트-스키마-설계>🏷️ ⑤ 이벤트 스키마 설계<a hidden class=anchor aria-hidden=true href=#--이벤트-스키마-설계>#</a></h3><ul><li>이벤트 버전 관리 필수 (<code>event_type</code>, <code>version</code>, <code>timestamp</code>, <code>correlation_id</code> 등)</li><li>JSON 기반의 schema registry(예: Apache Avro, Protobuf) 활용 권장</li></ul><hr><h2 id=3-모델링-예시--쇼핑몰-주문>3. 모델링 예시 – 쇼핑몰 주문<a hidden class=anchor aria-hidden=true href=#3-모델링-예시--쇼핑몰-주문>#</a></h2><h3 id=-도메인-이벤트-예시>▶ 도메인 이벤트 예시<a hidden class=anchor aria-hidden=true href=#-도메인-이벤트-예시>#</a></h3><table><thead><tr><th>이벤트명</th><th>속성 예시</th></tr></thead><tbody><tr><td><code>OrderCreated</code></td><td>order_id, user_id, items, total_price, timestamp</td></tr><tr><td><code>OrderPaid</code></td><td>order_id, payment_id, method, amount, timestamp</td></tr><tr><td><code>OrderShipped</code></td><td>order_id, tracking_number, carrier, timestamp</td></tr></tbody></table><h3 id=-aggregate-상태-재생-event-sourcing-기반>▶ Aggregate 상태 재생 (Event Sourcing 기반)<a hidden class=anchor aria-hidden=true href=#-aggregate-상태-재생-event-sourcing-기반>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderAggregate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>apply</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderCreated</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;CREATED&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderPaid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;PAID&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>OrderShipped</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;SHIPPED&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-projection-설계>▶ Projection 설계<a hidden class=anchor aria-hidden=true href=#-projection-설계>#</a></h3><table><thead><tr><th>Projection Name</th><th>필드 구성</th><th>목적</th></tr></thead><tbody><tr><td><code>OrderSummaryView</code></td><td>order_id, user_id, status, total_price</td><td>사용자 주문 조회용</td></tr><tr><td><code>OrderStatusStats</code></td><td>status, count</td><td>관리자 대시보드 통계</td></tr></tbody></table><hr><h2 id=4-모델링-시-고려사항>4. 모델링 시 고려사항<a hidden class=anchor aria-hidden=true href=#4-모델링-시-고려사항>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>이벤트 정합성</td><td>이벤트 순서에 따라 상태 달라짐</td><td>Event ordering 보장 (Kafka partition key 기준)</td></tr><tr><td>이벤트 버전</td><td>구조 변경 시 호환성 유지</td><td>Event upcasting 전략, schema registry 도입</td></tr><tr><td>조회 최적화</td><td>Projection은 뷰 최적화 목적</td><td>Index, denormalization, TTL 고려</td></tr><tr><td>GDPR 대응</td><td>이벤트 로그에서 민감 정보 처리</td><td>암호화/익명화, soft delete 이벤트 발행</td></tr><tr><td>오류 복구</td><td>Projection 재생 지원</td><td>이벤트 replay 기능 및 checkpoint 저장</td></tr></tbody></table><hr><h2 id=5-추천-도구-및-기술>5. 추천 도구 및 기술<a hidden class=anchor aria-hidden=true href=#5-추천-도구-및-기술>#</a></h2><table><thead><tr><th>카테고리</th><th>도구 / 기술</th><th>설명</th></tr></thead><tbody><tr><td>Event Store</td><td>EventStoreDB, Kafka, Axon, Marten</td><td>도메인 이벤트 저장소</td></tr><tr><td>Query DB</td><td>Elasticsearch, Redis, PostgreSQL</td><td>Projection 용 Read DB</td></tr><tr><td>Schema 관리</td><td>Avro, Protobuf, AsyncAPI</td><td>이벤트 스키마 정의 및 버전 관리</td></tr><tr><td>프레임워크</td><td>Axon (Java), Eventuous (.NET), NestJS CQRS</td><td>이벤트 기반 설계 지원</td></tr></tbody></table><hr><h2 id=-요약-1>✅ 요약<a hidden class=anchor aria-hidden=true href=#-요약-1>#</a></h2><p>이벤트 기반 데이터 모델링은 이벤트가 곧 데이터의 원천(Log-as-source)이며, 모델은 불변성, 도메인 중심, 읽기/쓰기 책임 분리를 핵심 원칙으로 합니다. 이를 통해 확장성과 추적성을 확보할 수 있지만, 이벤트 순서, 스키마 관리, 비동기 처리 등의 복잡성이 증가하므로 구조적 설계가 필수입니다.</p><hr><h1 id=event-sourcing-분석-보고서>Event Sourcing 분석 보고서<a hidden class=anchor aria-hidden=true href=#event-sourcing-분석-보고서>#</a></h1><h2 id=1-태그-3>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그-3>#</a></h2><p><strong>Event-Sourcing</strong>, <strong>CQRS-Pattern</strong>, <strong>Data-Management</strong>, <strong>Architecture-Pattern</strong></p><h2 id=2-주제-분류-분석>2. 주제 분류 분석<a hidden class=anchor aria-hidden=true href=#2-주제-분류-분석>#</a></h2><p><strong>지정된 카테고리</strong>: &ldquo;Computer Science and Engineering&rdquo; > &ldquo;Software Engineering&rdquo; > &ldquo;Design and Architecture&rdquo; > &ldquo;Architecture Styles and Patterns&rdquo; > &ldquo;Architecture Patterns&rdquo; > &ldquo;Data Management&rdquo;</p><p><strong>분석 결과</strong>: Event Sourcing은 애플리케이션 상태를 처리하는 데이터 중심 아키텍처 패턴으로, CRUD 모델과는 다른 접근 방식을 취합니다. 제시된 카테고리 계층 구조는 적절하며, 특히 &ldquo;Data Management&rdquo; 하위에 위치하는 것이 타당합니다. Event Sourcing은 비즈니스 엔터티의 상태를 상태 변경 이벤트의 시퀀스로 지속화하는 데이터 관리 패턴이기 때문입니다.</p><h2 id=3-요약-문장-200자-내외-1>3. 요약 문장 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-문장-200자-내외-1>#</a></h2><p>Event Sourcing은 애플리케이션의 모든 상태 변경을 불변의 이벤트 시퀀스로 저장하는 아키텍처 패턴입니다. 현재 상태를 직접 저장하는 대신 이벤트를 재생하여 상태를 재구성하며, 완전한 감사 추적과 시간 기반 쿼리를 제공하여 복잡한 비즈니스 시스템과 분산 아키텍처에 적합합니다.</p><h2 id=4-전체-개요-250자-내외-1>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외-1>#</a></h2><p>Event Sourcing은 애플리케이션 상태의 모든 변경사항을 이벤트 시퀀스로 저장하는 패턴으로, 전통적인 CRUD 방식과 달리 상태 변경의 전체 이력을 보존합니다. CQRS와 함께 사용되어 읽기와 쓰기 모델을 분리하며, 마이크로서비스 아키텍처에서 데이터 일관성과 확장성을 제공합니다. 금융, 전자상거래, 물류 등 다양한 도메인에서 활용되어 감사 추적, 디버깅, 상태 복구 등의 강력한 기능을 제공합니다.</p><hr><h2 id=5-핵심-개념-2>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-2>#</a></h2><h3 id=기본-개념-1>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념-1>#</a></h3><ul><li><strong>이벤트 (Event)</strong>: 과거에 발생한 상태 변경을 나타내는 불변의 팩트</li><li><strong>이벤트 스토어 (Event Store)</strong>: 이벤트가 지속화되는 추가 전용 저장소로 시스템 기록의 권위 있는 데이터 소스 역할</li><li><strong>애그리게이트 (Aggregate)</strong>: 단일 세밀한 이벤트 스트림에서 재구성되는 도메인 주도 설계의 일관성 경계</li><li><strong>프로젝션 (Projection)</strong>: 이벤트 스트림에서 파생된 현재 상태에 대한 답변으로, 읽기 모델 구성에 사용</li></ul><h3 id=실무-구현-요소>실무 구현 요소<a hidden class=anchor aria-hidden=true href=#실무-구현-요소>#</a></h3><ul><li><strong>이벤트 스키마 설계</strong>: 이벤트 구조와 버전 관리</li><li><strong>스냅샷 (Snapshot)</strong>: 정기적인 간격으로 데이터의 스냅샷을 구현하여 성능 향상</li><li><strong>이벤트 핸들러</strong>: 이벤트를 처리하고 프로젝션을 업데이트하는 컴포넌트</li><li><strong>명령 처리</strong>: 도메인 로직을 통한 이벤트 생성</li><li><strong>동시성 제어</strong>: 이벤트 순서와 일관성 보장 메커니즘</li></ul><hr><h2 id=제1부-이론적-기초>제1부: 이론적 기초<a hidden class=anchor aria-hidden=true href=#제1부-이론적-기초>#</a></h2><h2 id=배경-2>배경<a hidden class=anchor aria-hidden=true href=#배경-2>#</a></h2><p>Event Sourcing은 1970년대와 80년대 데이터베이스 변경 로그와 메시지 기반 아키텍처에서 뿌리를 찾을 수 있지만, Eric Evans의 Domain-Driven Design(2003)과 Greg Young의 영향력 있는 강연을 통해 엔터프라이즈 소프트웨어 패턴으로 공식화되었습니다.</p><h2 id=목적-및-필요성-2>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성-2>#</a></h2><ol><li><strong>완전한 감사 추적</strong>: 시스템에서 발생한 모든 변경사항의 불변 기록 구축</li><li><strong>시간 기반 쿼리</strong>: 어떤 시점에서든 엔터티의 상태를 결정하는 시간적 쿼리 구현 가능</li><li><strong>복잡한 비즈니스 로직 지원</strong>: 변경 기록, 감사 가능성 또는 복잡한 비즈니스 로직이 요구사항을 주도하는 도메인에 적합</li><li><strong>분산 시스템 일관성</strong>: 느슨하게 결합된 비즈니스 엔터티 간 이벤트 교환을 통한 마이크로서비스 아키텍처 지원</li></ol><h2 id=주요-기능-및-역할-1>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할-1>#</a></h2><ul><li><strong>상태 재구성</strong>: 이벤트 재생을 통한 현재 상태 복원</li><li><strong>이벤트 발행</strong>: 다른 시스템에 상태 변경 알림</li><li><strong>시간 여행</strong>: 과거 특정 시점의 상태 조회</li><li><strong>디버깅 지원</strong>: 상태 변경 과정 추적 및 분석</li></ul><h2 id=특징-2>특징<a hidden class=anchor aria-hidden=true href=#특징-2>#</a></h2><ol><li><strong>불변성</strong>: 모든 이벤트는 불변이며 추가 전용 방식으로 저장</li><li><strong>순차성</strong>: 이벤트는 발생 순서대로 저장</li><li><strong>원자성</strong>: 이벤트 저장은 단일 연산으로 본질적으로 원자적</li><li><strong>재생 가능성</strong>: 언제든지 이벤트를 재생하여 상태 복원 가능</li></ol><h2 id=핵심-원칙-2>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙-2>#</a></h2><ol><li><strong>이벤트를 사실로 취급</strong>: 이벤트는 발생한 사실의 기록</li><li><strong>추가 전용 저장</strong>: 기존 데이터 수정이나 삭제 금지</li><li><strong>순서 보장</strong>: 이벤트 발생 순서 유지</li><li><strong>단일 소스 진실</strong>: 이벤트 스토어가 유일한 진실의 원천</li></ol><h2 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h2><pre class=mermaid>graph TD
    A[Command] --&gt; B[Aggregate]
    B --&gt; C[Event Generated]
    C --&gt; D[Event Store]
    D --&gt; E[Event Handler]
    E --&gt; F[Projection Update]
    D --&gt; G[Event Replay]
    G --&gt; H[State Reconstruction]
</pre><p><strong>작동 원리</strong>:</p><ol><li><strong>명령 처리</strong>: 애플리케이션 코드가 객체에 대해 수행된 작업을 명령적으로 설명하는 이벤트를 발생</li><li><strong>이벤트 저장</strong>: 생성된 이벤트를 추가 전용 이벤트 스토어에 저장</li><li><strong>이벤트 발행</strong>: 이벤트 핸들러가 관심 있는 이벤트를 수신하고 적절한 작업 수행</li><li><strong>상태 재구성</strong>: 필요 시 이벤트 재생을 통해 현재 상태 복원</li></ol><hr><h2 id=제2부-구조-및-구현>제2부: 구조 및 구현<a hidden class=anchor aria-hidden=true href=#제2부-구조-및-구현>#</a></h2><h2 id=구조-및-아키텍처-1>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처-1>#</a></h2><pre class=mermaid>graph TB
    subgraph &#34;Command Side (Write Model)&#34;
        A[Command Handler] --&gt; B[Aggregate]
        B --&gt; C[Domain Events]
        C --&gt; D[Event Store]
    end
    
    subgraph &#34;Query Side (Read Model)&#34;
        E[Event Handlers] --&gt; F[Projections]
        F --&gt; G[Read Database]
    end
    
    D --&gt; E
    D --&gt; H[Event Bus]
    H --&gt; I[External Systems]
    
    subgraph &#34;Supporting Components&#34;
        J[Snapshots]
        K[Event Schemas]
        L[Version Management]
    end
    
    D -.-&gt; J
    C -.-&gt; K
    K -.-&gt; L
</pre><h3 id=필수-구성요소-1>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소-1>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>이벤트 스토어</strong></td><td>이벤트 지속화</td><td>시스템 기록의 권위 있는 데이터 소스 역할</td><td>추가 전용, 순서 보장</td></tr><tr><td><strong>애그리게이트</strong></td><td>비즈니스 로직 처리</td><td>명령 검증 및 이벤트 생성</td><td>일관성 경계 제공</td></tr><tr><td><strong>이벤트</strong></td><td>상태 변경 기록</td><td>시스템의 각 변경 사항을 개별 이벤트로 문서화</td><td>불변, 순차 저장</td></tr><tr><td><strong>이벤트 핸들러</strong></td><td>이벤트 처리</td><td>프로젝션 업데이트 및 부가 작업</td><td>비동기 처리</td></tr></tbody></table><h3 id=선택-구성요소-1>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소-1>#</a></h3><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th><th>특징</th></tr></thead><tbody><tr><td><strong>스냅샷</strong></td><td>성능 최적화</td><td>정기적 간격으로 데이터 스냅샷 구현</td><td>재구성 성능 향상</td></tr><tr><td><strong>이벤트 버스</strong></td><td>이벤트 발행</td><td>외부 시스템 알림</td><td>느슨한 결합 제공</td></tr><tr><td><strong>CQRS 구현</strong></td><td>읽기/쓰기 분리</td><td>명령과 쿼리 책임 분리</td><td>성능 최적화</td></tr></tbody></table><h2 id=구현-기법-1>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법-1>#</a></h2><h3 id=1-기본-event-sourcing>1. 기본 Event Sourcing<a hidden class=anchor aria-hidden=true href=#1-기본-event-sourcing>#</a></h3><p><strong>정의</strong>: 이벤트만을 이용한 상태 관리
<strong>구성</strong>: 이벤트 스토어 + 이벤트 재생
<strong>목적</strong>: 완전한 감사 추적 제공
<strong>실제 예시</strong>: 은행 계좌 거래 내역을 모든 입출금 이벤트로 관리</p><h3 id=2-cqrs와-결합된-event-sourcing>2. CQRS와 결합된 Event Sourcing<a hidden class=anchor aria-hidden=true href=#2-cqrs와-결합된-event-sourcing>#</a></h3><p><strong>정의</strong>: 데이터 관리 작업을 이벤트에 대한 응답으로 수행하고 저장된 이벤트에서 뷰를 구체화
<strong>구성</strong>: 명령 모델 + 쿼리 모델 + 이벤트 스토어 + 프로젝션
<strong>목적</strong>: 읽기와 쓰기 성능 최적화
<strong>실제 예시</strong>: 전자상거래에서 주문 처리(쓰기)와 재고 조회(읽기) 분리</p><h3 id=3-snapshot을-활용한-event-sourcing>3. Snapshot을 활용한 Event Sourcing<a hidden class=anchor aria-hidden=true href=#3-snapshot을-활용한-event-sourcing>#</a></h3><p><strong>정의</strong>: 성능 최적화를 위한 상태 스냅샷 저장
<strong>구성</strong>: 이벤트 스토어 + 스냅샷 저장소 + 증분 이벤트 재생
<strong>목적</strong>: 대용량 이벤트에서 재구성 성능 향상
<strong>실제 예시</strong>: 수천 개의 트랜잭션이 있는 계좌에서 주기적 잔액 스냅샷 생성</p><h3 id=4-분산-event-sourcing>4. 분산 Event Sourcing<a hidden class=anchor aria-hidden=true href=#4-분산-event-sourcing>#</a></h3><p><strong>정의</strong>: 마이크로서비스 환경에서의 이벤트 소싱
<strong>구성</strong>: 서비스별 이벤트 스토어 + 이벤트 버스 + Saga 패턴
<strong>목적</strong>: 분산 시스템에서 데이터 일관성 보장
<strong>실제 예시</strong>: MSA에서 서비스별 분리된 DB 간 트랜잭션 관리</p><hr><h2 id=제3부-분석-및-평가>제3부: 분석 및 평가<a hidden class=anchor aria-hidden=true href=#제3부-분석-및-평가>#</a></h2><h2 id=장점-1>장점<a hidden class=anchor aria-hidden=true href=#장점-1>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>감사 및 추적성</strong></td><td>완전한 감사 로그</td><td>이벤트 소싱된 시스템은 가장 강력한 감사 로그 옵션 중 하나를 제공</td></tr><tr><td><strong>시간적 분석</strong></td><td>시간 기반 쿼리</td><td>시스템을 시간상 앞뒤로 이동시켜 디버깅과 &ldquo;만약에&rdquo; 분석에 매우 가치 있음</td></tr><tr><td><strong>확장성</strong></td><td>수평적 확장</td><td>이벤트 소싱은 분산 시스템과 수평적 확장에 적합</td></tr><tr><td><strong>복원력</strong></td><td>장애 복구</td><td>다운스트림 프로젝션을 재구축할 수 있는 핵심 &ldquo;기록 소스&rdquo; 데이터만 이벤트 스트림에 작성</td></tr><tr><td><strong>성능</strong></td><td>읽기/쓰기 최적화</td><td>이벤트 소싱된 시스템은 최소한의 동기적 상호작용을 추구하여 반응적, 고성능, 확장 가능한 시스템을 구현</td></tr></tbody></table><h2 id=단점과-문제점-그리고-해결방안-1>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안-1>#</a></h2><h3 id=단점-3>단점<a hidden class=anchor aria-hidden=true href=#단점-3>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td><strong>복잡성</strong></td><td>학습 곡선</td><td>다르고 익숙하지 않은 프로그래밍 스타일로 학습 곡선이 존재</td><td>단계적 도입, 교육 프로그램</td></tr><tr><td><strong>쿼리 어려움</strong></td><td>이벤트 스토어 쿼리</td><td>비즈니스 엔터티의 상태를 재구성하는 일반적인 쿼리가 복잡하고 비효율적</td><td>CQRS 패턴 적용</td></tr><tr><td><strong>일관성</strong></td><td>최종 일관성</td><td>구체화된 뷰나 데이터 프로젝션 생성 시 최종적으로만 일관성 유지</td><td>적절한 일관성 경계 설계</td></tr></tbody></table><h3 id=문제점-2>문제점<a hidden class=anchor aria-hidden=true href=#문제점-2>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td><strong>성능 저하</strong></td><td>프로젝션 재구축</td><td>대량 이벤트 누적</td><td>응답 시간 증가</td><td>성능 모니터링 도구</td><td>스냅샷 구현</td><td>정기적 간격으로 데이터 스냅샷 구현</td></tr><tr><td><strong>스키마 변경</strong></td><td>이벤트 구조 변화</td><td>비즈니스 요구사항 변경</td><td>시스템 호환성 문제</td><td>버전 호환성 테스트</td><td>이벤트 버전 관리</td><td>이벤트 업캐스팅/다운캐스팅</td></tr><tr><td><strong>동시성 충돌</strong></td><td>동일 애그리게이트 수정</td><td>동시 명령 처리</td><td>데이터 일관성 위반</td><td>버전 체크</td><td>낙관적 동시성 제어</td><td>충돌하는 업데이트에 대해 멱등성 보장</td></tr></tbody></table><h2 id=도전-과제-1>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제-1>#</a></h2><h3 id=기술적-도전>기술적 도전<a hidden class=anchor aria-hidden=true href=#기술적-도전>#</a></h3><ol><li><strong>이벤트 스키마 진화</strong>: 시간이 지남에 따른 이벤트 구조 변경 관리</li><li><strong>대용량 데이터 처리</strong>: 수백만 개의 이벤트를 효율적으로 처리</li><li><strong>분산 시스템 복잡성</strong>: 여러 서비스 간 이벤트 순서 및 일관성 보장</li></ol><h3 id=운영적-도전>운영적 도전<a hidden class=anchor aria-hidden=true href=#운영적-도전>#</a></h3><ol><li><strong>모니터링 및 관찰성</strong>: 이벤트 흐름과 프로젝션 상태 추적</li><li><strong>데이터 아카이빙</strong>: 오래된 이벤트의 효율적 관리</li><li><strong>재해 복구</strong>: 이벤트 스토어 백업 및 복구 전략</li></ol><hr><h2 id=제4부-실무-적용>제4부: 실무 적용<a hidden class=anchor aria-hidden=true href=#제4부-실무-적용>#</a></h2><h2 id=분류-기준에-따른-종류-및-유형-1>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형-1>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td><strong>저장 방식</strong></td><td>단일 스토어</td><td>모든 이벤트를 하나의 저장소에 보관</td><td>소규모 애플리케이션</td></tr><tr><td></td><td>분산 스토어</td><td>도메인별 또는 서비스별 분리 저장</td><td>마이크로서비스 아키텍처</td></tr><tr><td><strong>일관성 모델</strong></td><td>강한 일관성</td><td>즉시 일관성 보장</td><td>금융 시스템</td></tr><tr><td></td><td>최종 일관성</td><td>비동기적 일관성 달성</td><td>소셜 미디어, 전자상거래</td></tr><tr><td><strong>프로젝션 전략</strong></td><td>실시간 프로젝션</td><td>이벤트 발생 시 즉시 업데이트</td><td>실시간 대시보드</td></tr><tr><td></td><td>배치 프로젝션</td><td>주기적 일괄 업데이트</td><td>리포팅 시스템</td></tr></tbody></table><h2 id=실무-사용-예시-1>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시-1>#</a></h2><table><thead><tr><th>도메인</th><th>목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td><strong>금융 시스템</strong></td><td>거래 추적 및 감사</td><td>CQRS, 블록체인</td><td>규제 준수, 사기 탐지</td></tr><tr><td><strong>전자상거래</strong></td><td>주문 상태 관리</td><td>마이크로서비스, Kafka</td><td>확장성, 주문 추적</td></tr><tr><td><strong>IoT 플랫폼</strong></td><td>센서 데이터 수집</td><td>시계열 DB, 스트림 처리</td><td>실시간 분석, 예측</td></tr><tr><td><strong>게임 시스템</strong></td><td>플레이어 행동 분석</td><td>NoSQL, 분석 플랫폼</td><td>개인화, 치트 탐지</td></tr><tr><td><strong>의료 시스템</strong></td><td>환자 기록 관리</td><td>HL7 FHIR, 프라이버시 보호</td><td>추적성, 의료 감사</td></tr></tbody></table><h2 id=활용-사례-1>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례-1>#</a></h2><h3 id=netflix의-마이크로서비스-event-sourcing>Netflix의 마이크로서비스 Event Sourcing<a hidden class=anchor aria-hidden=true href=#netflix의-마이크로서비스-event-sourcing>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li><strong>이벤트 스토어</strong>: Apache Kafka를 중앙 이벤트 로그로 사용</li><li><strong>마이크로서비스</strong>: 각 서비스별 독립적인 이벤트 스트림</li><li><strong>프로젝션 서비스</strong>: 사용자 추천, 콘텐츠 메타데이터, 시청 이력 관리</li></ul><pre class=mermaid>graph TB
    subgraph &#34;Netflix Event Sourcing Architecture&#34;
        A[User Action] --&gt; B[Content Service]
        A --&gt; C[Recommendation Service]
        A --&gt; D[Billing Service]
        
        B --&gt; E[Kafka Event Stream]
        C --&gt; E
        D --&gt; E
        
        E --&gt; F[Content Projection]
        E --&gt; G[User Preference Projection]
        E --&gt; H[Analytics Projection]
        
        F --&gt; I[Content API]
        G --&gt; J[Recommendation API]
        H --&gt; K[Analytics Dashboard]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 행동(시청, 평가, 검색) 이벤트 발생</li><li>각 마이크로서비스가 관련 이벤트를 Kafka에 발행</li><li>이벤트 기반 프로젝션이 실시간으로 업데이트</li><li>추천 시스템과 분석 시스템이 이벤트 스트림 소비</li></ol><p><strong>Event Sourcing의 역할</strong>:</p><ul><li><strong>사용자 경험 개인화</strong>: 시청 이력 기반 추천</li><li><strong>A/B 테스트</strong>: 사용자 행동 패턴 분석</li><li><strong>시스템 확장성</strong>: 서비스별 독립적 확장</li><li><strong>장애 복구</strong>: 이벤트 재생을 통한 상태 복원</li></ul><p><strong>기존 방식과의 차이점</strong>:</p><ul><li><strong>전통적 방식</strong>: 현재 상태만 저장, 히스토리 정보 부족</li><li><strong>Event Sourcing</strong>: 모든 사용자 행동 보존, 시간별 패턴 분석 가능</li><li><strong>확장성</strong>: 개별 서비스 스케일링 vs 모놀리식 스케일링</li><li><strong>장애 복구</strong>: 부분적 복구 vs 전체 시스템 재시작</li></ul><h2 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h2><h3 id=javascript를-이용한-은행-계좌-event-sourcing>JavaScript를 이용한 은행 계좌 Event Sourcing<a hidden class=anchor aria-hidden=true href=#javascript를-이용한-은행-계좌-event-sourcing>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>  1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>  2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>  3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>  4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>  5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>  6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>  7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>  8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>  9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10> 10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11> 11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12> 12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13> 13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14> 14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15> 15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16> 16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17> 17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18> 18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19> 19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20> 20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21> 21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22> 22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23> 23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24> 24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25> 25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26> 26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27> 27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28> 28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29> 29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30> 30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31> 31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32> 32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33> 33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34> 34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35> 35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36> 36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37> 37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38> 38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39> 39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40> 40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41> 41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42> 42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43> 43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44> 44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45> 45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46> 46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47> 47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48> 48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49> 49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50> 50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51> 51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52> 52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53> 53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54> 54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55> 55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56> 56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57> 57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58> 58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59> 59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60> 60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61> 61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62> 62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63> 63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64> 64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65> 65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66> 66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67> 67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68> 68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69> 69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70> 70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71> 71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72> 72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73> 73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74> 74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75> 75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76> 76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77> 77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78> 78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79> 79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80> 80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81> 81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82> 82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83> 83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84> 84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85> 85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86> 86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87> 87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88> 88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89> 89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90> 90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91> 91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92> 92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93> 93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94> 94</a>
</span><span class=lnt id=hl-23-95><a class=lnlinks href=#hl-23-95> 95</a>
</span><span class=lnt id=hl-23-96><a class=lnlinks href=#hl-23-96> 96</a>
</span><span class=lnt id=hl-23-97><a class=lnlinks href=#hl-23-97> 97</a>
</span><span class=lnt id=hl-23-98><a class=lnlinks href=#hl-23-98> 98</a>
</span><span class=lnt id=hl-23-99><a class=lnlinks href=#hl-23-99> 99</a>
</span><span class=lnt id=hl-23-100><a class=lnlinks href=#hl-23-100>100</a>
</span><span class=lnt id=hl-23-101><a class=lnlinks href=#hl-23-101>101</a>
</span><span class=lnt id=hl-23-102><a class=lnlinks href=#hl-23-102>102</a>
</span><span class=lnt id=hl-23-103><a class=lnlinks href=#hl-23-103>103</a>
</span><span class=lnt id=hl-23-104><a class=lnlinks href=#hl-23-104>104</a>
</span><span class=lnt id=hl-23-105><a class=lnlinks href=#hl-23-105>105</a>
</span><span class=lnt id=hl-23-106><a class=lnlinks href=#hl-23-106>106</a>
</span><span class=lnt id=hl-23-107><a class=lnlinks href=#hl-23-107>107</a>
</span><span class=lnt id=hl-23-108><a class=lnlinks href=#hl-23-108>108</a>
</span><span class=lnt id=hl-23-109><a class=lnlinks href=#hl-23-109>109</a>
</span><span class=lnt id=hl-23-110><a class=lnlinks href=#hl-23-110>110</a>
</span><span class=lnt id=hl-23-111><a class=lnlinks href=#hl-23-111>111</a>
</span><span class=lnt id=hl-23-112><a class=lnlinks href=#hl-23-112>112</a>
</span><span class=lnt id=hl-23-113><a class=lnlinks href=#hl-23-113>113</a>
</span><span class=lnt id=hl-23-114><a class=lnlinks href=#hl-23-114>114</a>
</span><span class=lnt id=hl-23-115><a class=lnlinks href=#hl-23-115>115</a>
</span><span class=lnt id=hl-23-116><a class=lnlinks href=#hl-23-116>116</a>
</span><span class=lnt id=hl-23-117><a class=lnlinks href=#hl-23-117>117</a>
</span><span class=lnt id=hl-23-118><a class=lnlinks href=#hl-23-118>118</a>
</span><span class=lnt id=hl-23-119><a class=lnlinks href=#hl-23-119>119</a>
</span><span class=lnt id=hl-23-120><a class=lnlinks href=#hl-23-120>120</a>
</span><span class=lnt id=hl-23-121><a class=lnlinks href=#hl-23-121>121</a>
</span><span class=lnt id=hl-23-122><a class=lnlinks href=#hl-23-122>122</a>
</span><span class=lnt id=hl-23-123><a class=lnlinks href=#hl-23-123>123</a>
</span><span class=lnt id=hl-23-124><a class=lnlinks href=#hl-23-124>124</a>
</span><span class=lnt id=hl-23-125><a class=lnlinks href=#hl-23-125>125</a>
</span><span class=lnt id=hl-23-126><a class=lnlinks href=#hl-23-126>126</a>
</span><span class=lnt id=hl-23-127><a class=lnlinks href=#hl-23-127>127</a>
</span><span class=lnt id=hl-23-128><a class=lnlinks href=#hl-23-128>128</a>
</span><span class=lnt id=hl-23-129><a class=lnlinks href=#hl-23-129>129</a>
</span><span class=lnt id=hl-23-130><a class=lnlinks href=#hl-23-130>130</a>
</span><span class=lnt id=hl-23-131><a class=lnlinks href=#hl-23-131>131</a>
</span><span class=lnt id=hl-23-132><a class=lnlinks href=#hl-23-132>132</a>
</span><span class=lnt id=hl-23-133><a class=lnlinks href=#hl-23-133>133</a>
</span><span class=lnt id=hl-23-134><a class=lnlinks href=#hl-23-134>134</a>
</span><span class=lnt id=hl-23-135><a class=lnlinks href=#hl-23-135>135</a>
</span><span class=lnt id=hl-23-136><a class=lnlinks href=#hl-23-136>136</a>
</span><span class=lnt id=hl-23-137><a class=lnlinks href=#hl-23-137>137</a>
</span><span class=lnt id=hl-23-138><a class=lnlinks href=#hl-23-138>138</a>
</span><span class=lnt id=hl-23-139><a class=lnlinks href=#hl-23-139>139</a>
</span><span class=lnt id=hl-23-140><a class=lnlinks href=#hl-23-140>140</a>
</span><span class=lnt id=hl-23-141><a class=lnlinks href=#hl-23-141>141</a>
</span><span class=lnt id=hl-23-142><a class=lnlinks href=#hl-23-142>142</a>
</span><span class=lnt id=hl-23-143><a class=lnlinks href=#hl-23-143>143</a>
</span><span class=lnt id=hl-23-144><a class=lnlinks href=#hl-23-144>144</a>
</span><span class=lnt id=hl-23-145><a class=lnlinks href=#hl-23-145>145</a>
</span><span class=lnt id=hl-23-146><a class=lnlinks href=#hl-23-146>146</a>
</span><span class=lnt id=hl-23-147><a class=lnlinks href=#hl-23-147>147</a>
</span><span class=lnt id=hl-23-148><a class=lnlinks href=#hl-23-148>148</a>
</span><span class=lnt id=hl-23-149><a class=lnlinks href=#hl-23-149>149</a>
</span><span class=lnt id=hl-23-150><a class=lnlinks href=#hl-23-150>150</a>
</span><span class=lnt id=hl-23-151><a class=lnlinks href=#hl-23-151>151</a>
</span><span class=lnt id=hl-23-152><a class=lnlinks href=#hl-23-152>152</a>
</span><span class=lnt id=hl-23-153><a class=lnlinks href=#hl-23-153>153</a>
</span><span class=lnt id=hl-23-154><a class=lnlinks href=#hl-23-154>154</a>
</span><span class=lnt id=hl-23-155><a class=lnlinks href=#hl-23-155>155</a>
</span><span class=lnt id=hl-23-156><a class=lnlinks href=#hl-23-156>156</a>
</span><span class=lnt id=hl-23-157><a class=lnlinks href=#hl-23-157>157</a>
</span><span class=lnt id=hl-23-158><a class=lnlinks href=#hl-23-158>158</a>
</span><span class=lnt id=hl-23-159><a class=lnlinks href=#hl-23-159>159</a>
</span><span class=lnt id=hl-23-160><a class=lnlinks href=#hl-23-160>160</a>
</span><span class=lnt id=hl-23-161><a class=lnlinks href=#hl-23-161>161</a>
</span><span class=lnt id=hl-23-162><a class=lnlinks href=#hl-23-162>162</a>
</span><span class=lnt id=hl-23-163><a class=lnlinks href=#hl-23-163>163</a>
</span><span class=lnt id=hl-23-164><a class=lnlinks href=#hl-23-164>164</a>
</span><span class=lnt id=hl-23-165><a class=lnlinks href=#hl-23-165>165</a>
</span><span class=lnt id=hl-23-166><a class=lnlinks href=#hl-23-166>166</a>
</span><span class=lnt id=hl-23-167><a class=lnlinks href=#hl-23-167>167</a>
</span><span class=lnt id=hl-23-168><a class=lnlinks href=#hl-23-168>168</a>
</span><span class=lnt id=hl-23-169><a class=lnlinks href=#hl-23-169>169</a>
</span><span class=lnt id=hl-23-170><a class=lnlinks href=#hl-23-170>170</a>
</span><span class=lnt id=hl-23-171><a class=lnlinks href=#hl-23-171>171</a>
</span><span class=lnt id=hl-23-172><a class=lnlinks href=#hl-23-172>172</a>
</span><span class=lnt id=hl-23-173><a class=lnlinks href=#hl-23-173>173</a>
</span><span class=lnt id=hl-23-174><a class=lnlinks href=#hl-23-174>174</a>
</span><span class=lnt id=hl-23-175><a class=lnlinks href=#hl-23-175>175</a>
</span><span class=lnt id=hl-23-176><a class=lnlinks href=#hl-23-176>176</a>
</span><span class=lnt id=hl-23-177><a class=lnlinks href=#hl-23-177>177</a>
</span><span class=lnt id=hl-23-178><a class=lnlinks href=#hl-23-178>178</a>
</span><span class=lnt id=hl-23-179><a class=lnlinks href=#hl-23-179>179</a>
</span><span class=lnt id=hl-23-180><a class=lnlinks href=#hl-23-180>180</a>
</span><span class=lnt id=hl-23-181><a class=lnlinks href=#hl-23-181>181</a>
</span><span class=lnt id=hl-23-182><a class=lnlinks href=#hl-23-182>182</a>
</span><span class=lnt id=hl-23-183><a class=lnlinks href=#hl-23-183>183</a>
</span><span class=lnt id=hl-23-184><a class=lnlinks href=#hl-23-184>184</a>
</span><span class=lnt id=hl-23-185><a class=lnlinks href=#hl-23-185>185</a>
</span><span class=lnt id=hl-23-186><a class=lnlinks href=#hl-23-186>186</a>
</span><span class=lnt id=hl-23-187><a class=lnlinks href=#hl-23-187>187</a>
</span><span class=lnt id=hl-23-188><a class=lnlinks href=#hl-23-188>188</a>
</span><span class=lnt id=hl-23-189><a class=lnlinks href=#hl-23-189>189</a>
</span><span class=lnt id=hl-23-190><a class=lnlinks href=#hl-23-190>190</a>
</span><span class=lnt id=hl-23-191><a class=lnlinks href=#hl-23-191>191</a>
</span><span class=lnt id=hl-23-192><a class=lnlinks href=#hl-23-192>192</a>
</span><span class=lnt id=hl-23-193><a class=lnlinks href=#hl-23-193>193</a>
</span><span class=lnt id=hl-23-194><a class=lnlinks href=#hl-23-194>194</a>
</span><span class=lnt id=hl-23-195><a class=lnlinks href=#hl-23-195>195</a>
</span><span class=lnt id=hl-23-196><a class=lnlinks href=#hl-23-196>196</a>
</span><span class=lnt id=hl-23-197><a class=lnlinks href=#hl-23-197>197</a>
</span><span class=lnt id=hl-23-198><a class=lnlinks href=#hl-23-198>198</a>
</span><span class=lnt id=hl-23-199><a class=lnlinks href=#hl-23-199>199</a>
</span><span class=lnt id=hl-23-200><a class=lnlinks href=#hl-23-200>200</a>
</span><span class=lnt id=hl-23-201><a class=lnlinks href=#hl-23-201>201</a>
</span><span class=lnt id=hl-23-202><a class=lnlinks href=#hl-23-202>202</a>
</span><span class=lnt id=hl-23-203><a class=lnlinks href=#hl-23-203>203</a>
</span><span class=lnt id=hl-23-204><a class=lnlinks href=#hl-23-204>204</a>
</span><span class=lnt id=hl-23-205><a class=lnlinks href=#hl-23-205>205</a>
</span><span class=lnt id=hl-23-206><a class=lnlinks href=#hl-23-206>206</a>
</span><span class=lnt id=hl-23-207><a class=lnlinks href=#hl-23-207>207</a>
</span><span class=lnt id=hl-23-208><a class=lnlinks href=#hl-23-208>208</a>
</span><span class=lnt id=hl-23-209><a class=lnlinks href=#hl-23-209>209</a>
</span><span class=lnt id=hl-23-210><a class=lnlinks href=#hl-23-210>210</a>
</span><span class=lnt id=hl-23-211><a class=lnlinks href=#hl-23-211>211</a>
</span><span class=lnt id=hl-23-212><a class=lnlinks href=#hl-23-212>212</a>
</span><span class=lnt id=hl-23-213><a class=lnlinks href=#hl-23-213>213</a>
</span><span class=lnt id=hl-23-214><a class=lnlinks href=#hl-23-214>214</a>
</span><span class=lnt id=hl-23-215><a class=lnlinks href=#hl-23-215>215</a>
</span><span class=lnt id=hl-23-216><a class=lnlinks href=#hl-23-216>216</a>
</span><span class=lnt id=hl-23-217><a class=lnlinks href=#hl-23-217>217</a>
</span><span class=lnt id=hl-23-218><a class=lnlinks href=#hl-23-218>218</a>
</span><span class=lnt id=hl-23-219><a class=lnlinks href=#hl-23-219>219</a>
</span><span class=lnt id=hl-23-220><a class=lnlinks href=#hl-23-220>220</a>
</span><span class=lnt id=hl-23-221><a class=lnlinks href=#hl-23-221>221</a>
</span><span class=lnt id=hl-23-222><a class=lnlinks href=#hl-23-222>222</a>
</span><span class=lnt id=hl-23-223><a class=lnlinks href=#hl-23-223>223</a>
</span><span class=lnt id=hl-23-224><a class=lnlinks href=#hl-23-224>224</a>
</span><span class=lnt id=hl-23-225><a class=lnlinks href=#hl-23-225>225</a>
</span><span class=lnt id=hl-23-226><a class=lnlinks href=#hl-23-226>226</a>
</span><span class=lnt id=hl-23-227><a class=lnlinks href=#hl-23-227>227</a>
</span><span class=lnt id=hl-23-228><a class=lnlinks href=#hl-23-228>228</a>
</span><span class=lnt id=hl-23-229><a class=lnlinks href=#hl-23-229>229</a>
</span><span class=lnt id=hl-23-230><a class=lnlinks href=#hl-23-230>230</a>
</span><span class=lnt id=hl-23-231><a class=lnlinks href=#hl-23-231>231</a>
</span><span class=lnt id=hl-23-232><a class=lnlinks href=#hl-23-232>232</a>
</span><span class=lnt id=hl-23-233><a class=lnlinks href=#hl-23-233>233</a>
</span><span class=lnt id=hl-23-234><a class=lnlinks href=#hl-23-234>234</a>
</span><span class=lnt id=hl-23-235><a class=lnlinks href=#hl-23-235>235</a>
</span><span class=lnt id=hl-23-236><a class=lnlinks href=#hl-23-236>236</a>
</span><span class=lnt id=hl-23-237><a class=lnlinks href=#hl-23-237>237</a>
</span><span class=lnt id=hl-23-238><a class=lnlinks href=#hl-23-238>238</a>
</span><span class=lnt id=hl-23-239><a class=lnlinks href=#hl-23-239>239</a>
</span><span class=lnt id=hl-23-240><a class=lnlinks href=#hl-23-240>240</a>
</span><span class=lnt id=hl-23-241><a class=lnlinks href=#hl-23-241>241</a>
</span><span class=lnt id=hl-23-242><a class=lnlinks href=#hl-23-242>242</a>
</span><span class=lnt id=hl-23-243><a class=lnlinks href=#hl-23-243>243</a>
</span><span class=lnt id=hl-23-244><a class=lnlinks href=#hl-23-244>244</a>
</span><span class=lnt id=hl-23-245><a class=lnlinks href=#hl-23-245>245</a>
</span><span class=lnt id=hl-23-246><a class=lnlinks href=#hl-23-246>246</a>
</span><span class=lnt id=hl-23-247><a class=lnlinks href=#hl-23-247>247</a>
</span><span class=lnt id=hl-23-248><a class=lnlinks href=#hl-23-248>248</a>
</span><span class=lnt id=hl-23-249><a class=lnlinks href=#hl-23-249>249</a>
</span><span class=lnt id=hl-23-250><a class=lnlinks href=#hl-23-250>250</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 이벤트 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>AccountCreated</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>initialBalance</span> <span class=o>=</span> <span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MoneyDeposited</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;MoneyDeposited&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MoneyWithdrawn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;MoneyWithdrawn&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 애그리게이트 루트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BankAccount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 생성 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=nx>create</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>AccountCreated</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 입금 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>deposit</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;입금액은 0보다 커야 합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>MoneyDeposited</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 출금 명령 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;출금액은 0보다 커야 합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>&lt;</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;잔액이 부족합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>applyEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>MoneyWithdrawn</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 적용
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>applyEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyDeposited&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>+=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyWithdrawn&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 스트림에서 상태 재구성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>static</span> <span class=nx>fromHistory</span><span class=p>(</span><span class=nx>events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>events</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>account</span><span class=p>.</span><span class=nx>applyEventFromHistory</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>applyEventFromHistory</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;AccountCreated&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>accountId</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>accountId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>initialBalance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyDeposited&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>+=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s1>&#39;MoneyWithdrawn&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 저장되지 않은 이벤트 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getUncommittedEvents</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[...</span><span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 커밋 표시
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>markEventsAsCommitted</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>uncommittedEvents</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 스토어
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>EventStore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>events</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span> <span class=c1>// accountId -&gt; events[]
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>saveEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>events</span><span class=p>,</span> <span class=nx>expectedVersion</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>accountId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>existingEvents</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 동시성 제어 - 낙관적 잠금
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>existingEvents</span><span class=p>.</span><span class=nx>length</span> <span class=o>!==</span> <span class=nx>expectedVersion</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`동시성 충돌: 예상 버전 </span><span class=si>${</span><span class=nx>expectedVersion</span><span class=si>}</span><span class=sb>, 실제 버전 </span><span class=si>${</span><span class=nx>existingEvents</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>existingEvents</span><span class=p>.</span><span class=nx>push</span><span class=p>(...</span><span class=nx>events</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 로드
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>accountId</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 특정 버전까지의 이벤트 로드
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getEventsUpToVersion</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>version</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>events</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>version</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 리포지터리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BankAccountRepository</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>eventStore</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventStore</span> <span class=o>=</span> <span class=nx>eventStore</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 로드
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventStore</span><span class=p>.</span><span class=nx>getEvents</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>events</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>BankAccount</span><span class=p>.</span><span class=nx>fromHistory</span><span class=p>(</span><span class=nx>events</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>uncommittedEvents</span> <span class=o>=</span> <span class=nx>account</span><span class=p>.</span><span class=nx>getUncommittedEvents</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>uncommittedEvents</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>expectedVersion</span> <span class=o>=</span> <span class=nx>account</span><span class=p>.</span><span class=nx>version</span> <span class=o>-</span> <span class=nx>uncommittedEvents</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventStore</span><span class=p>.</span><span class=nx>saveEvents</span><span class=p>(</span><span class=nx>account</span><span class=p>.</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>uncommittedEvents</span><span class=p>,</span> <span class=nx>expectedVersion</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>markEventsAsCommitted</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 처리기
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>BankAccountCommandHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>repository</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span> <span class=o>=</span> <span class=nx>repository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 계좌 생성 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>createAccount</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>existingAccount</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>existingAccount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;계좌가 이미 존재합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=nx>BankAccount</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>initialBalance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 입금 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>deposit</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>account</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;계좌를 찾을 수 없습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>deposit</span><span class=p>(</span><span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 출금 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>withdraw</span><span class=p>(</span><span class=nx>accountId</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>account</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>accountId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>account</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;계좌를 찾을 수 없습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>account</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>account</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>eventStore</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventStore</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>repository</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccountRepository</span><span class=p>(</span><span class=nx>eventStore</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>commandHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccountCommandHandler</span><span class=p>(</span><span class=nx>repository</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 계좌 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>account1</span> <span class=o>=</span> <span class=nx>commandHandler</span><span class=p>.</span><span class=nx>createAccount</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`계좌 생성: </span><span class=si>${</span><span class=nx>account1</span><span class=p>.</span><span class=nx>accountId</span><span class=si>}</span><span class=sb>, 잔액: </span><span class=si>${</span><span class=nx>account1</span><span class=p>.</span><span class=nx>balance</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 입금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>deposit</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>,</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;500 입금 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 출금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>commandHandler</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>,</span> <span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;200 출금 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 현재 상태 조회
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>currentAccount</span> <span class=o>=</span> <span class=nx>repository</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`현재 잔액: </span><span class=si>${</span><span class=nx>currentAccount</span><span class=p>.</span><span class=nx>balance</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 히스토리 조회
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>events</span> <span class=o>=</span> <span class=nx>eventStore</span><span class=p>.</span><span class=nx>getEvents</span><span class=p>(</span><span class=s1>&#39;ACC-001&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;이벤트 히스토리:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>events</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>event</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=sb>. </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>고려사항</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>도메인 설계</strong></td><td>적절한 애그리게이트 경계 설정</td><td>비즈니스 일관성 경계에 따라 애그리게이트 크기 결정</td></tr><tr><td><strong>이벤트 설계</strong></td><td>이벤트 스키마의 미래 호환성</td><td>이벤트에 버전 정보 포함, 선택적 필드 사용</td></tr><tr><td><strong>성능 관리</strong></td><td>대용량 이벤트 스트림 처리</td><td>스냅샷 구현, 이벤트 아카이빙 전략 수립</td></tr><tr><td><strong>일관성 관리</strong></td><td>최종 일관성 수용</td><td>비즈니스 요구사항에 맞는 일관성 수준 정의</td></tr><tr><td><strong>모니터링</strong></td><td>이벤트 처리 상태 추적</td><td>프로젝션 지연 모니터링, 실패 이벤트 재처리</td></tr><tr><td><strong>보안</strong></td><td>민감한 데이터 처리</td><td>이벤트 암호화, 개인정보 익명화</td></tr><tr><td><strong>테스트</strong></td><td>시간 기반 테스트 복잡성</td><td>시간 추상화, 이벤트 시나리오 기반 테스트</td></tr></tbody></table><h2 id=최적화하기-위한-고려사항-및-주의할-점-1>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점-1>#</a></h2><table><thead><tr><th>구분</th><th>최적화 방법</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>저장소 최적화</strong></td><td>이벤트 스토어 파티셔닝</td><td>애그리게이트 ID 기반 샤딩</td></tr><tr><td><strong>읽기 성능</strong></td><td>프로젝션 캐싱</td><td>Redis 등을 활용한 자주 조회되는 프로젝션 캐싱</td></tr><tr><td><strong>쓰기 성능</strong></td><td>배치 이벤트 처리</td><td>여러 이벤트를 배치로 처리하여 I/O 최적화</td></tr><tr><td><strong>네트워크 최적화</strong></td><td>이벤트 압축</td><td>큰 이벤트 페이로드 압축 전송</td></tr><tr><td><strong>메모리 관리</strong></td><td>애그리게이트 캐싱</td><td>자주 접근되는 애그리게이트 메모리 캐싱</td></tr><tr><td><strong>동시성 최적화</strong></td><td>애그리게이트별 락</td><td>세밀한 단위의 동시성 제어</td></tr><tr><td><strong>이벤트 압축</strong></td><td>중복 이벤트 제거</td><td>의미없는 중간 상태 이벤트 압축</td></tr></tbody></table><h2 id=기타-사항-1>기타 사항<a hidden class=anchor aria-hidden=true href=#기타-사항-1>#</a></h2><h3 id=event-sourcing과-gdpr-준수>Event Sourcing과 GDPR 준수<a hidden class=anchor aria-hidden=true href=#event-sourcing과-gdpr-준수>#</a></h3><ul><li><strong>개인정보 삭제 요구</strong>: 이벤트의 불변성과 충돌하는 GDPR의 삭제권</li><li><strong>해결 방안</strong>:<ul><li>암호화된 이벤트 저장 후 키 삭제</li><li>개인정보 분리 저장</li><li>의사화(Pseudonymization) 적용</li></ul></li></ul><h3 id=이벤트-스키마-진화-전략>이벤트 스키마 진화 전략<a hidden class=anchor aria-hidden=true href=#이벤트-스키마-진화-전략>#</a></h3><ul><li><strong>전진 호환성</strong>: 새로운 필드 추가 시 기존 시스템 호환성 유지</li><li><strong>후진 호환성</strong>: 이전 버전 이벤트 처리 가능성</li><li><strong>업캐스팅</strong>: 오래된 이벤트를 새로운 스키마로 변환</li><li><strong>다운캐스팅</strong>: 새로운 이벤트를 이전 스키마로 변환</li></ul><h3 id=분산-환경에서의-고려사항>분산 환경에서의 고려사항<a hidden class=anchor aria-hidden=true href=#분산-환경에서의-고려사항>#</a></h3><ul><li><strong>이벤트 순서</strong>: 분산 환경에서 전역 순서 보장의 어려움</li><li><strong>시계 동기화</strong>: 타임스탬프 기반 순서 결정 시 시계 편차 문제</li><li><strong>네트워크 분할</strong>: CAP 정리에 따른 일관성과 가용성 트레이드오프</li></ul><hr><h2 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>패턴</strong></td><td>아키텍처 패턴</td><td>CQRS</td><td>Event Sourcing과 함께 사용되어 읽기/쓰기 분리</td></tr><tr><td></td><td></td><td>Saga 패턴</td><td>분산 트랜잭션에서 Event Sourcing 활용</td></tr><tr><td></td><td></td><td>Outbox 패턴</td><td>데이터베이스와 메시지 발행의 원자성 보장</td></tr><tr><td><strong>기술</strong></td><td>메시지 브로커</td><td>Apache Kafka</td><td>이벤트 스트리밍과 저장소 역할</td></tr><tr><td></td><td></td><td>RabbitMQ</td><td>이벤트 발행/구독 처리</td></tr><tr><td></td><td></td><td>EventStore DB</td><td>전용 이벤트 저장소</td></tr><tr><td><strong>개념</strong></td><td>도메인 설계</td><td>Aggregate</td><td>DDD의 일관성 경계와 Event Sourcing 통합</td></tr><tr><td></td><td></td><td>Domain Events</td><td>비즈니스 이벤트의 표현</td></tr><tr><td></td><td></td><td>Bounded Context</td><td>마이크로서비스와 이벤트 경계</td></tr><tr><td><strong>도구</strong></td><td>프레임워크</td><td>Axon Framework</td><td>Java 기반 CQRS/ES 프레임워크</td></tr><tr><td></td><td></td><td>EventStore</td><td>전용 이벤트 데이터베이스</td></tr><tr><td></td><td></td><td>Marten</td><td>.NET용 Event Sourcing 라이브러리</td></tr></tbody></table><h2 id=주제와-관련하여-반드시-학습해야할-내용>주제와 관련하여 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 개념</strong></td><td>Event Sourcing</td><td>기본 원리</td><td>이벤트 기반 상태 관리의 핵심 개념</td></tr><tr><td></td><td>CQRS</td><td>명령/쿼리 분리</td><td>읽기와 쓰기 모델의 분리</td></tr><tr><td></td><td>Domain Events</td><td>도메인 이벤트</td><td>비즈니스 의미가 있는 이벤트 설계</td></tr><tr><td><strong>구현 기술</strong></td><td>Event Store</td><td>이벤트 저장소</td><td>이벤트 지속화 메커니즘</td></tr><tr><td></td><td>Projections</td><td>프로젝션</td><td>이벤트에서 읽기 모델 생성</td></tr><tr><td></td><td>Snapshots</td><td>스냅샷</td><td>성능 최적화 기법</td></tr><tr><td><strong>설계 패턴</strong></td><td>Aggregate Design</td><td>애그리게이트 설계</td><td>적절한 경계 설정</td></tr><tr><td></td><td>Event Schema</td><td>이벤트 스키마</td><td>진화 가능한 이벤트 구조</td></tr><tr><td></td><td>Concurrency Control</td><td>동시성 제어</td><td>낙관적 잠금과 버전 관리</td></tr><tr><td><strong>운영 관리</strong></td><td>Monitoring</td><td>모니터링</td><td>이벤트 처리 상태 추적</td></tr><tr><td></td><td>Error Handling</td><td>오류 처리</td><td>실패한 이벤트 처리 전략</td></tr><tr><td></td><td>Data Migration</td><td>데이터 마이그레이션</td><td>이벤트 스키마 변경 관리</td></tr></tbody></table><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>Event Store</td><td>이벤트가 지속화되는 추가 전용 데이터베이스로 시스템 기록의 권위 있는 소스</td></tr><tr><td></td><td>Aggregate Root</td><td>도메인 주도 설계에서 애그리게이트의 진입점 역할을 하는 엔터티</td></tr><tr><td></td><td>Projection</td><td>이벤트 스트림에서 파생된 읽기 전용 뷰 또는 상태 표현</td></tr><tr><td></td><td>Command Handler</td><td>비즈니스 명령을 처리하고 이벤트를 생성하는 컴포넌트</td></tr><tr><td><strong>기술 용어</strong></td><td>Event Replay</td><td>저장된 이벤트를 순서대로 재생하여 상태를 재구성하는 과정</td></tr><tr><td></td><td>Snapshot</td><td>특정 시점의 애그리게이트 상태를 저장한 것으로 성능 최적화에 사용</td></tr><tr><td></td><td>Upcasting</td><td>이전 버전의 이벤트를 새로운 스키마 버전으로 변환하는 과정</td></tr><tr><td></td><td>Idempotency</td><td>동일한 연산을 여러 번 수행해도 결과가 같음을 보장하는 속성</td></tr><tr><td><strong>패턴 용어</strong></td><td>Outbox Pattern</td><td>데이터베이스 변경과 메시지 발행의 원자성을 보장하는 패턴</td></tr><tr><td></td><td>Saga Pattern</td><td>분산 트랜잭션을 일련의 로컬 트랜잭션으로 분해하는 패턴</td></tr><tr><td></td><td>Eventually Consistent</td><td>시스템이 시간이 지나면서 결국 일관된 상태에 도달하는 일관성 모델</td></tr><tr><td></td><td>Stream Aggregation</td><td>이벤트 스트림에서 쓰기 모델의 현재 상태를 구축하는 과정</td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing>Event Sourcing pattern - Microsoft Azure Architecture Center</a></li><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS pattern - Microsoft Azure Architecture Center</a></li><li><a href=https://microservices.io/patterns/data/event-sourcing.html>Microservices Pattern: Event sourcing</a></li><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Event Sourcing - Martin Fowler</a></li><li><a href=https://www.kurrent.io/event-sourcing>Beginner&rsquo;s Guide to Event Sourcing - Kurrent</a></li><li><a href=https://www.baeldung.com/cqrs-event-sourcing-java>CQRS and Event Sourcing in Java - Baeldung</a></li><li><a href=https://www.geeksforgeeks.org/event-sourcing-pattern/>Event Sourcing Pattern - GeeksforGeeks</a></li><li><a href=https://mia-platform.eu/blog/understanding-event-sourcing-and-cqrs-pattern/>Understanding Event Sourcing and CQRS Pattern - Mia-Platform</a></li><li><a href=https://blog.risingstack.com/event-sourcing-with-examples-node-js-at-scale/>Event Sourcing with Examples in Node.js - RisingStack</a></li><li><a href=https://edykim.com/ko/post/event-sourcing-implementing-eventsourcing-patterns-with-javascript/>이벤트 소싱 패턴 JavaScript로 구현하기 - edykim</a></li></ul><hr><p>Event Sourcing은 마이크로서비스 아키텍처(MSA)에서 데이터 일관성을 유지하는 중요한 패턴 중 하나이다.<br>이 패턴은 시스템의 상태 변화를 일련의 이벤트로 저장하고 관리하는 방식을 말한다.</p><p>Event Sourcing은 복잡한 도메인 모델을 가진 시스템이나 높은 감사 요구사항이 있는 금융, 의료 등의 분야에서 특히 유용하다. 하지만 구현의 복잡성과 초기 학습 곡선이 높다는 점을 고려해야 한다.</p><h3 id=event-sourcing의-핵심-개념>Event Sourcing의 핵심 개념<a hidden class=anchor aria-hidden=true href=#event-sourcing의-핵심-개념>#</a></h3><ol><li><strong>이벤트 중심 저장</strong>: 시스템의 모든 상태 변경을 이벤트로 저장한다.</li><li><strong>불변성</strong>: 저장된 이벤트는 수정되거나 삭제되지 않고 항상 추가만 된다.</li><li><strong>시간 순서</strong>: 이벤트는 발생한 순서대로 저장된다.</li><li><strong>상태 재구성</strong>: 현재 상태는 저장된 이벤트를 순차적으로 적용하여 재구성한다.</li></ol><h3 id=event-sourcing의-장점>Event Sourcing의 장점<a hidden class=anchor aria-hidden=true href=#event-sourcing의-장점>#</a></h3><ol><li><strong>완전한 감사 추적</strong>: 모든 변경 사항이 이벤트로 저장되어 시스템의 전체 히스토리를 추적할 수 있다.</li><li><strong>시간 여행 가능</strong>: 특정 시점의 상태를 재구성할 수 있어 디버깅과 분석에 유용하다.</li><li><strong>확장성</strong>: 이벤트 저장소는 추가만 하므로 확장이 용이합니다.</li><li><strong>유연성</strong>: 새로운 요구사항에 따라 이벤트를 재해석하여 새로운 뷰를 만들 수 있다.</li></ol><h3 id=event-sourcing의-구현-방법>Event Sourcing의 구현 방법<a hidden class=anchor aria-hidden=true href=#event-sourcing의-구현-방법>#</a></h3><ol><li><strong>이벤트 정의</strong>: 시스템에서 발생할 수 있는 모든 이벤트 유형을 정의한다.</li><li><strong>이벤트 저장소</strong>: 이벤트를 영구적으로 저장할 수 있는 저장소를 구현한다.</li><li><strong>이벤트 핸들러</strong>: 각 이벤트 유형에 대한 처리 로직을 구현한다.</li><li><strong>상태 재구성 로직</strong>: 저장된 이벤트를 기반으로 현재 상태를 재구성하는 로직을 구현한다.</li></ol><h3 id=event-sourcing의-주의사항>Event Sourcing의 주의사항<a hidden class=anchor aria-hidden=true href=#event-sourcing의-주의사항>#</a></h3><ol><li><strong>성능 고려</strong>: 이벤트가 많아질수록 상태 재구성에 시간이 걸릴 수 있다. 이를 위해 스냅샷을 주기적으로 저장하는 방법을 고려해야 한다.</li><li><strong>이벤트 버전 관리</strong>: 시스템이 발전함에 따라 이벤트 스키마가 변경될 수 있으므로, 버전 관리가 필요하다.</li><li><strong>최종 일관성</strong>: Event Sourcing은 일반적으로 최종 일관성 모델을 따르므로, 즉시 일관성이 필요한 경우 추가적인 메커니즘이 필요할 수 있다.</li></ol><h3 id=이벤트-소싱의-구현-시-고려사항>이벤트 소싱의 구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#이벤트-소싱의-구현-시-고려사항>#</a></h3><ol><li><p><strong>이벤트 저장소(Event Store)</strong>: 이벤트를 영구적으로 저장하고, 효율적으로 조회할 수 있는 저장소를 구축해야 한다. 이는 관계형 데이터베이스, NoSQL 데이터베이스, 또는 전문 이벤트 저장소를 사용할 수 있다.</p></li><li><p><strong>이벤트 발행 및 구독 메커니즘</strong>: 이벤트를 발행하고, 이를 구독하는 서비스 간의 통신 메커니즘을 설계해야 한다. 이는 메시지 브로커나 이벤트 스트리밍 플랫폼을 활용할 수 있다.</p></li><li><p><strong>트랜잭션 관리</strong>: 이벤트 저장과 관련된 트랜잭션을 원자적으로 처리하여, 데이터 일관성을 보장해야 한다.</p></li></ol><h3 id=event-sourcing과-cqrs>Event Sourcing과 CQRS<a hidden class=anchor aria-hidden=true href=#event-sourcing과-cqrs>#</a></h3><p>Event Sourcing은 종종 CQRS(Command Query Responsibility Segregation) 패턴과 함께 사용된다. CQRS는 데이터의 쓰기(Command)와 읽기(Query) 모델을 분리하는 패턴으로, Event Sourcing과 결합하면 더욱 강력한 아키텍처를 구성할 수 있다.</p><h3 id=구현-예시-1>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시-1>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 이벤트 기본 클래스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>Event</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventId</span> <span class=o>=</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>randomUUID</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>data</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>version</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 주문 관련 이벤트들
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCreatedEvent</span> <span class=kr>extends</span> <span class=nx>Event</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>super</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;CREATED&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;ORDER_CREATED&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 저장소
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>EventStore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>events</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>eventHandlers</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>snapshots</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>saveEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 유효성 검증
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>validateEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 스냅샷 필요 여부 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>checkForSnapshot</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getEvents</span><span class=p>(</span><span class=nx>aggregateId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>event</span> <span class=p>=&gt;</span> <span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>orderId</span> <span class=o>===</span> <span class=nx>aggregateId</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h2><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>