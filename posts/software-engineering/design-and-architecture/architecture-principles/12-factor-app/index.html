<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Twelve-Factor App methodology | hyunyoun's Blog</title><meta name=keywords content="System-and-Software-Architecture,Principles,Architecture-Principles,12-Factors,SaaS"><meta name=description content="Twelve-Factor App Methodology 는 클라우드 환경에서 확장 가능하고 유지보수하기 쉬운 애플리케이션을 개발하기 위한 12 가지 원칙을 제시한다. 이 원칙들은 코드베이스 관리, 구성 설정, 종속성 선언 등 다양한 측면을 포괄하며, 현대 소프트웨어 개발의 모범 사례로 널리 채택되고 있다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/12-factor-app/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/12-factor-app/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/12-factor-app/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/12-factor-app/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Twelve-Factor App methodology"><meta property="og:description" content="Twelve-Factor App Methodology 는 클라우드 환경에서 확장 가능하고 유지보수하기 쉬운 애플리케이션을 개발하기 위한 12 가지 원칙을 제시한다. 이 원칙들은 코드베이스 관리, 구성 설정, 종속성 선언 등 다양한 측면을 포괄하며, 현대 소프트웨어 개발의 모범 사례로 널리 채택되고 있다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Twelve-Factor App methodology"><meta name=twitter:description content="Twelve-Factor App Methodology 는 클라우드 환경에서 확장 가능하고 유지보수하기 쉬운 애플리케이션을 개발하기 위한 12 가지 원칙을 제시한다. 이 원칙들은 코드베이스 관리, 구성 설정, 종속성 선언 등 다양한 측면을 포괄하며, 현대 소프트웨어 개발의 모범 사례로 널리 채택되고 있다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":4,"name":"Architecture Principles","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/"},{"@type":"ListItem","position":5,"name":"Twelve-Factor App methodology","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/12-factor-app/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-principles/>Architecture Principles</a></div><h1>Twelve-Factor App methodology</h1><div class=post-description>Twelve-Factor App Methodology 는 클라우드 환경에서 확장 가능하고 유지보수하기 쉬운 애플리케이션을 개발하기 위한 12 가지 원칙을 제시한다. 이 원칙들은 코드베이스 관리, 구성 설정, 종속성 선언 등 다양한 측면을 포괄하며, 현대 소프트웨어 개발의 모범 사례로 널리 채택되고 있다.</div></header><div class=post-content><h2 id=twelve-factor-app-methodology>Twelve-Factor App Methodology<a hidden class=anchor aria-hidden=true href=#twelve-factor-app-methodology>#</a></h2><p>Twelve-Factor App Methodology 는 Heroku 의 개발자들이 2011 년에 제안한 클라우드 기반 애플리케이션 개발을 위한 12 가지 원칙이다.<br>이 방법론은 언어, 프레임워크, 플랫폼에 독립적으로 적용 가능하며, 코드베이스 관리, 종속성 선언, 구성 설정, 백엔드 서비스 처리, 빌드 및 릴리스 관리, 프로세스 실행, 포트 바인딩, 동시성 처리, 폐기성, 개발/운영 환경 일치, 로그 처리, 관리 프로세스 실행 등 다양한 측면을 다루며, 애플리케이션의 이식성, 확장성, 유지보수성을 향상시키는 데 중점을 둔다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p><strong>Twelve-Factor App</strong>은 SaaS(Software as a Service) 및 클라우드 네이티브 환경에 최적화된 애플리케이션 개발을 위한 12 가지 실천 원칙을 의미한다. 이 방법론은 언어, 프레임워크, 플랫폼에 독립적이며, 소프트웨어의 이식성, 확장성, 유지보수성, 자동화된 배포를 목표로 한다.<br>Twelve-Factor App Methodology 는 다음과 같은 12 가지 원칙으로 구성된다:</p><ol><li><strong>코드베이스 (Codebase)</strong>: 하나의 코드베이스를 유지하며, 여러 배포 환경에서 사용한다.</li><li><strong>종속성 (Dependencies)</strong>: 모든 종속성을 명시적으로 선언하고 격리한다.</li><li><strong>구성 (Config)</strong>: 구성은 환경 변수에 저장하여 코드와 분리한다.</li><li><strong>백엔드 서비스 (Backing Services)</strong>: 데이터베이스나 메시지 큐와 같은 백엔드 서비스를 연결된 리소스로 취급한다.</li><li><strong>빌드, 릴리스, 실행 (Build, Release, Run)</strong>: 빌드, 릴리스, 실행 단계를 명확히 분리한다.</li><li><strong>프로세스 (Processes)</strong>: 애플리케이션을 하나 이상의 무상태 프로세스로 실행한다.</li><li><strong>포트 바인딩 (Port Binding)</strong>: 서비스를 포트에 바인딩하여 외부에 노출한다.</li><li><strong>동시성 (Concurrency)</strong>: 프로세스를 복제하여 확장성을 확보한다.</li><li><strong>폐기성 (Disposability)</strong>: 빠른 시작과 종료를 통해 탄력성을 높인다.</li><li><strong>개발/운영 환경 일치 (Dev/Prod Parity)</strong>: 개발, 스테이징, 운영 환경의 차이를 최소화한다.</li><li><strong>로그 (Logs)</strong>: 애플리케이션은 로그를 이벤트 스트림으로 처리한다.</li><li><strong>관리 프로세스 (Admin Processes)</strong>: 관리 작업은 일회성 프로세스로 실행한다.</li></ol><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><p>이 방법론의 주요 목적은 다음과 같다:</p><ul><li><strong>자동화 설정</strong>: 선언적 형식 사용으로 새로운 개발자의 시간과 비용 최소화</li><li><strong>이식성</strong>: 실행 환경 간 최대 이식성 제공</li><li><strong>클라우드 배포</strong>: 현대적인 클라우드 플랫폼에 적합한 배포</li><li><strong>지속적 배포</strong>: 개발과 프로덕션 간의 차이 최소화로 최대 민첩성 확보</li><li><strong>확장성</strong>: 툴링, 아키텍처, 개발 관행의 중대한 변경 없이 확장 가능</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><p>12-Factor 방법론을 사용하는 개발자가 구축한 애플리케이션은 앱이 확장될 때 다양한 시나리오를 다루는 공통적인 특성을 갖게 된다.</p><p>주요 기능은 다음과 같다:</p><ul><li><strong>환경 독립성</strong>: 운영체제와의 깔끔한 계약으로 최대 이식성 제공</li><li><strong>자동화 지원</strong>: 설정 자동화를 위한 선언적 형식 사용</li><li><strong>수평적 확장</strong>: 중요한 재작업 없이 쉬운 확장</li><li><strong>언어 중립성</strong>: 모든 프로그래밍 언어와 백엔드 서비스 조합에 적용 가능</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><p>12-Factor App 의 주요 특징은 다음과 같다:</p><ul><li><strong>클라우드 네이티브 설계</strong>: 컨테이너화된 클라우드 환경에 최적화</li><li><strong>마이크로서비스 친화적</strong>: 개별 서비스의 독립적 개발과 배포 지원</li><li><strong>무상태 프로세스</strong>: 세션이나 워크플로우 상태를 프로세스에 저장하지 않음</li><li><strong>환경 분리</strong>: 코드와 설정의 명확한 분리</li><li><strong>백업 서비스 추상화</strong>: 로컬과 원격 서비스를 동일하게 취급</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><table><thead><tr><th>원칙 번호</th><th>항목</th><th>설명</th><th>특징</th></tr></thead><tbody><tr><td>1</td><td>코드베이스 (Codebase)</td><td>버전 관리되는 단일 코드베이스에서 여러 배포 환경 (환경별 인스턴스) 을 지원</td><td>코드베이스와 앱 배포의 1:1 관계</td></tr><tr><td>2</td><td>의존성 (Dependencies)</td><td>모든 의존성은 명시적으로 선언하고, 외부에서 관리되며, 격리된 환경에 설치</td><td>명시적 선언, 격리된 환경</td></tr><tr><td>3</td><td>설정 (Config)</td><td>구성 정보를 코드가 아닌 환경 변수로 관리하여, 환경에 따라 설정을 분리</td><td>민감정보 분리, 배포 유연성</td></tr><tr><td>4</td><td>지원 서비스 (Backing Services)</td><td>데이터베이스, 캐시, 메일 서비스 등 네트워크로 접근 가능한 외부 리소스를 독립 서비스로 취급</td><td>느슨한 결합, 교체 용이</td></tr><tr><td>5</td><td>빌드, 릴리즈, 실행 (Build, Release, Run)</td><td>애플리케이션은 빌드 (코드→실행파일), 릴리즈 (설정 포함), 실행 (실제 수행) 의 세 단계를 분리</td><td>일관성 유지, 자동화 용이</td></tr><tr><td>6</td><td>프로세스 (Processes)</td><td>애플리케이션은 무상태 (stateless) 프로세스로 실행되어야 하며, 상태는 외부 시스템에 저장</td><td>수평 확장성, 장애 복원력 향상</td></tr><tr><td>7</td><td>포트 바인딩 (Port Binding)</td><td>자체적으로 웹 서버를 실행하고 포트를 바인딩하여 서비스를 외부에 노출</td><td>독립 실행형 서비스, 직접 포트 사용</td></tr><tr><td>8</td><td>동시성 (Concurrency)</td><td>앱은 프로세스를 복제하거나 확장하여 작업을 분산 처리하며, 수평 확장이 용이해야 함</td><td>확장성, 프로세스 기반 스케일링</td></tr><tr><td>9</td><td>폐기성 (Disposability)</td><td>빠르게 시작하고, 정상적으로 종료 가능한 프로세스로 설계하여 시스템 유연성을 확보</td><td>빠른 배포, 탄력적 스케일링</td></tr><tr><td>10</td><td>환경 일치 (Dev/Prod Parity)</td><td>개발, 스테이징, 운영 환경 간의 차이를 최소화하여 배포 및 테스트 정확도를 향상</td><td>환경 간 불일치 최소화</td></tr><tr><td>11</td><td>로그 (Logs)</td><td>애플리케이션은 로그를 파일에 저장하지 않고, 이벤트 스트림으로 표준 출력에 기록함</td><td>실시간 로그 처리, 중앙 집중화</td></tr><tr><td>12</td><td>관리자 프로세스 (Admin Processes)</td><td>DB 마이그레이션, 배치 작업 등 일회성 관리 작업은 애플리케이션과 분리된 독립 프로세스로 실행</td><td>운영 안정성, 책임 분리</td></tr></tbody></table><p>각 항목은 Docker, Kubernetes, AWS 등의 운영 환경에 따라 구체적으로 달라질 수 있으며, 상황에 맞는 확장도 가능하다.</p><h4 id=codebase-코드베이스>Codebase (코드베이스)<a hidden class=anchor aria-hidden=true href=#codebase-코드베이스>#</a></h4><p><strong>원칙</strong>: 하나의 애플리케이션은 하나의 코드베이스를 갖는다.<br><strong>설명</strong>: 모든 배포 환경 (개발, 스테이징, 프로덕션 등) 에서 동일한 코드베이스를 사용하며, 버전 관리 시스템 (Git 등) 으로 관리된다. 단일 앱은 단일 코드베이스와 1:1 관계를 가져야 하며, 여러 앱이 하나의 코드베이스를 공유하거나, 하나의 앱이 여러 코드베이스를 사용하는 것은 지양한다. 마이크로서비스 아키텍처에서는 서비스별로 각각의 코드베이스를 둘 수 있다<br><strong>특징</strong>:</p><ul><li><p>단일 코드 저장소 (Repository) 사용</p></li><li><p>버전 관리 시스템 (Git, SVN 등) 활용</p></li><li><p>환경별 설정만 분리, 코드베이스는 동일</p></li><li><p>코드베이스와 앱의 1:1 관계 유지<br><strong>실전 예시</strong>:</p></li><li><p>단일 서비스 구조</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>my-web-app/
</span></span><span class=line><span class=cl>├── .git/
</span></span><span class=line><span class=cl>├── src/
</span></span><span class=line><span class=cl>│   ├── controllers/
</span></span><span class=line><span class=cl>│   ├── models/
</span></span><span class=line><span class=cl>│   └── views/
</span></span><span class=line><span class=cl>├── config/
</span></span><span class=line><span class=cl>│   ├── development.json
</span></span><span class=line><span class=cl>│   ├── staging.json
</span></span><span class=line><span class=cl>│   └── production.json
</span></span><span class=line><span class=cl>├── package.json
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>└── README.md
</span></span></code></pre></td></tr></table></div></div></li><li><p>마이크로서비스 구조 (Multi-repo 방식)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 각 서비스별 독립된 리포지토리</span>
</span></span><span class=line><span class=cl>user-service/
</span></span><span class=line><span class=cl>├── .git/
</span></span><span class=line><span class=cl>├── src/
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>└── package.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>order-service/
</span></span><span class=line><span class=cl>├── .git/
</span></span><span class=line><span class=cl>├── src/
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>└── package.json
</span></span></code></pre></td></tr></table></div></div></li><li><p>마이크로서비스 구조 (Mono-repo 방식)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>e-commerce-platform/
</span></span><span class=line><span class=cl>├── .git/
</span></span><span class=line><span class=cl>├── services/
</span></span><span class=line><span class=cl>│   ├── user-service/
</span></span><span class=line><span class=cl>│   │   ├── src/
</span></span><span class=line><span class=cl>│   │   └── Dockerfile
</span></span><span class=line><span class=cl>│   ├── order-service/
</span></span><span class=line><span class=cl>│   │   ├── src/
</span></span><span class=line><span class=cl>│   │   └── Dockerfile
</span></span><span class=line><span class=cl>│   └── payment-service/
</span></span><span class=line><span class=cl>├── shared/
</span></span><span class=line><span class=cl>│   └── libraries/
</span></span><span class=line><span class=cl>└── docker-compose.yml
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=dependencies-의존성>Dependencies (의존성)<a hidden class=anchor aria-hidden=true href=#dependencies-의존성>#</a></h4><p><strong>원칙</strong>: 모든 의존성을 명시적으로 선언하고 격리한다.<br><strong>설명</strong>: 애플리케이션이 필요로 하는 모든 라이브러리, 패키지, 모듈 등 의존성을 명확히 선언하고, 시스템에 암묵적으로 존재하는 패키지에 의존하지 않는다. 의존성 관리 도구와 격리 환경 (가상환경, 컨테이너 등) 을 활용해 환경 간 일관성을 보장한다<br><strong>특징</strong>:</p><ul><li><p>의존성 선언 (manifest) 파일 사용 (예: package.json, requirements.txt)</p></li><li><p>종속성 관리 도구 사용 (npm, pip, Maven, Gradle 등)</p></li><li><p>시스템 전역 패키지에 의존하지 않음</p></li><li><p>가상환경, Docker 등으로 환경 격리<br><strong>실전 예시</strong>:</p></li><li><p>Node.js 프로젝트</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my-app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;^4.18.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mongoose&#34;</span><span class=p>:</span> <span class=s2>&#34;^7.5.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;jsonwebtoken&#34;</span><span class=p>:</span> <span class=s2>&#34;^9.0.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;bcryptjs&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.4.3&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nodemon&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;jest&#34;</span><span class=p>:</span> <span class=s2>&#34;^29.6.4&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;engines&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;node&#34;</span><span class=p>:</span> <span class=s2>&#34;&gt;=18.0.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Python 프로젝트</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># requirements.txt</span>
</span></span><span class=line><span class=cl><span class=nv>Flask</span><span class=o>==</span>2.3.3
</span></span><span class=line><span class=cl><span class=nv>SQLAlchemy</span><span class=o>==</span>2.0.21
</span></span><span class=line><span class=cl><span class=nv>requests</span><span class=o>==</span>2.31.0
</span></span><span class=line><span class=cl><span class=nv>gunicorn</span><span class=o>==</span>21.2.0
</span></span><span class=line><span class=cl>python-dotenv<span class=o>==</span>1.0.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># requirements-dev.txt  </span>
</span></span><span class=line><span class=cl><span class=nv>pytest</span><span class=o>==</span>7.4.2
</span></span><span class=line><span class=cl><span class=nv>black</span><span class=o>==</span>23.9.1
</span></span><span class=line><span class=cl><span class=nv>flake8</span><span class=o>==</span>6.1.0
</span></span></code></pre></td></tr></table></div></div></li><li><p>Docker 를 통한 종속성 격리</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:18-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 종속성 파일만 먼저 복사 (캐시 효율성)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 종속성 설치 (정확한 버전으로)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci --only<span class=o>=</span>production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 애플리케이션 코드 복사</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 비root 사용자로 실행 (보안)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> node</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 3000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=config-설정>Config (설정)<a hidden class=anchor aria-hidden=true href=#config-설정>#</a></h4><p><strong>원칙</strong>: 환경설정을 코드와 분리하여 관리한다.<br><strong>설명</strong>: 환경별로 달라지는 설정 (데이터베이스 URL, API 키, 비밀 정보 등) 은 코드에 포함하지 않고 환경변수, 보안 저장소 (Kubernetes Secret, Vault 등) 로 관리한다. 이를 통해 코드 변경 없이 환경에 따라 설정만 바꿔 배포할 수 있다.<br><strong>특징</strong>:</p><ul><li><p>환경변수로 설정값 관리</p></li><li><p>민감 정보는 코드에 직접 노출하지 않음</p></li><li><p>운영환경에서는 Secret/Vault 등 보안 솔루션 활용 권장</p></li><li><p><code>.env</code> 파일은 개발 환경에서만 사용, 운영은 Secret/Vault 활용<br><strong>실전 예시</strong>:</p></li><li><p>환경 변수 설정 (개발 환경)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># .env.example (버전 관리에 포함)</span>
</span></span><span class=line><span class=cl><span class=nv>NODE_ENV</span><span class=o>=</span>development
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_URL</span><span class=o>=</span>mongodb://localhost:27017/myapp
</span></span><span class=line><span class=cl><span class=nv>JWT_SECRET</span><span class=o>=</span>your-jwt-secret-here
</span></span><span class=line><span class=cl><span class=nv>API_KEY</span><span class=o>=</span>your-api-key-here
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># .env (버전 관리에서 제외, .gitignore에 추가)</span>
</span></span><span class=line><span class=cl><span class=nv>NODE_ENV</span><span class=o>=</span>development
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_URL</span><span class=o>=</span>mongodb://localhost:27017/myapp_dev
</span></span><span class=line><span class=cl><span class=nv>JWT_SECRET</span><span class=o>=</span>super-secret-development-key
</span></span><span class=line><span class=cl><span class=nv>API_KEY</span><span class=o>=</span>dev-api-key-123
</span></span></code></pre></td></tr></table></div></div></li><li><p>애플리케이션에서 환경 변수 사용</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// config.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;dotenv&#39;</span><span class=p>).</span><span class=nx>config</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>port</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>nodeEnv</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>||</span> <span class=s1>&#39;development&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>databaseUrl</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_URL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>jwtSecret</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>apiKey</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>API_KEY</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 필수 환경 변수 검증
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>requiredEnvVars</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;DATABASE_URL&#39;</span><span class=p>,</span> <span class=s1>&#39;JWT_SECRET&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>requiredEnvVars</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>envVar</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>[</span><span class=nx>envVar</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`❌ Required environment variable </span><span class=si>${</span><span class=nx>envVar</span><span class=si>}</span><span class=sb> is missing`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>config</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서의 설정 관리 (프로덕션 권장)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ConfigMap for non-sensitive data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>NODE_ENV</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;production&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PORT</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Secret for sensitive data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class=l>cG9zdGdyZXNxbDovL3VzZXI6cGFzc0BkYjoxMjM0NS9teWRi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>JWT_SECRET</span><span class=p>:</span><span class=w> </span><span class=l>c3VwZXItc2VjcmV0LWp3dC1rZXk=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>cHJvZC1hcGkta2V5LTQ1Ng==</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Deployment using ConfigMap and Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>envFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>configMapRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Docker Compose 를 통한 환경별 설정</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NODE_ENV=${NODE_ENV:-development}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PORT=${PORT:-3000}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DATABASE_URL=${DATABASE_URL}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mongo:5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MONGO_INITDB_DATABASE</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=backing-services-지원-서비스>Backing Services (지원 서비스)<a hidden class=anchor aria-hidden=true href=#backing-services-지원-서비스>#</a></h4><p><strong>원칙</strong>: 지원 서비스를 연결된 리소스로 취급한다.<br><strong>설명</strong>: 데이터베이스, 캐시, 메시지 큐 등 네트워크로 접근하는 외부 리소스는 모두 &rsquo; 지원 서비스 (Backing Service)&rsquo; 로 간주하고, 코드와 느슨하게 결합한다. 서비스의 위치나 종류가 변경되어도 환경변수만 바꾸면 되도록 설계한다.<br><strong>특징</strong>:</p><ul><li><p>데이터베이스, 캐시, 메시지 큐 등 외부 리소스</p></li><li><p>환경변수로 서비스 주소 관리</p></li><li><p>서비스 교체 시 코드 수정 불필요<br><strong>실전 예시</strong>:</p></li><li><p>지원 서비스 연결 설정</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// services.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./config&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 데이터베이스 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>mongoose</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mongoose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>mongoose</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>databaseUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Redis 캐시 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;redis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>redisClient</span> <span class=o>=</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>createClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>redisUrl</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 메시지 큐 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>messageQueue</span> <span class=o>=</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>rabbitmqUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 외부 API 클라이언트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>axios</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>paymentAPI</span> <span class=o>=</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>baseURL</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>paymentServiceUrl</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>paymentApiKey</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>database</span><span class=o>:</span> <span class=nx>mongoose</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cache</span><span class=o>:</span> <span class=nx>redisClient</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>messageQueue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>paymentAPI</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>서비스 추상화를 통한 교체 가능성 확보</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// database.js - 데이터베이스 추상화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>DatabaseService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>connectionUrl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>connectionUrl</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;mongodb://&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>client</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./mongoAdapter&#39;</span><span class=p>)(</span><span class=nx>connectionUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>connectionUrl</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;postgresql://&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>client</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./postgresAdapter&#39;</span><span class=p>)(</span><span class=nx>connectionUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nx>findUser</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>saveUser</span><span class=p>(</span><span class=nx>userData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nx>saveUser</span><span class=p>(</span><span class=nx>userData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>db</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DatabaseService</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_URL</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Docker Compose 를 통한 로컬 지원 서비스 구성</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DATABASE_URL=postgresql://user:pass@db:5432/myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>REDIS_URL=redis://cache:6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RABBITMQ_URL=amqp://guest:guest@queue:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>pass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres_data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:7-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>queue</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq:3-management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_DEFAULT_USER</span><span class=p>:</span><span class=w> </span><span class=l>guest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_DEFAULT_PASS</span><span class=p>:</span><span class=w> </span><span class=l>guest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=build-release-run-빌드-배포-실행>Build, Release, Run (빌드, 배포, 실행)<a hidden class=anchor aria-hidden=true href=#build-release-run-빌드-배포-실행>#</a></h4><p><strong>원칙</strong>: 빌드, 릴리즈, 실행 단계를 엄격하게 분리한다.<br><strong>설명</strong>: 빌드 단계에서 코드를 컴파일하고, 릴리즈 단계에서 환경설정과 결합, 실행 단계에서 실제로 앱을 구동한다. 각 단계는 독립적으로 관리되어야 하며, CI/CD 파이프라인에서 자동화가 용이하다.<br><strong>특징</strong>:</p><ul><li><p>빌드/릴리즈/실행 단계 분리</p></li><li><p>각 단계별 자동화 및 버전 관리</p></li><li><p>롤백, 재배포 등 운영 편의성 향상</p></li><li><p>GitHub Actions, Jenkins, ArgoCD 등 CI/CD 도구로 단계별 자동화<br><strong>실전 예시</strong>:</p></li><li><p>GitHub Actions 를 통한 CI/CD 파이프라인</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38>38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39>39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40>40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41>41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42>42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43>43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44>44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45>45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .github/workflows/deploy.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build, Release, Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 1. Build Stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Docker image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        docker build -t myapp:${{ github.sha }} .
</span></span></span><span class=line><span class=cl><span class=sd>        docker tag myapp:${{ github.sha }} myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Push to registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
</span></span></span><span class=line><span class=cl><span class=sd>        docker push myapp:${{ github.sha }}
</span></span></span><span class=line><span class=cl><span class=sd>        docker push myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>release</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 2. Release Stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        # 빌드된 이미지와 환경 설정을 결합하여 릴리스 생성
</span></span></span><span class=line><span class=cl><span class=sd>        echo &#34;Release ID: ${{ github.sha }}&#34; &gt; release-info.txt
</span></span></span><span class=line><span class=cl><span class=sd>        echo &#34;Build: myapp:${{ github.sha }}&#34; &gt;&gt; release-info.txt
</span></span></span><span class=line><span class=cl><span class=sd>        echo &#34;Environment: production&#34; &gt;&gt; release-info.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 3. Run Stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to Kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl set image deployment/myapp myapp=myapp:${{ github.sha }}
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl rollout status deployment/myapp</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>로컬 개발을 위한 단순화된 파이프라인</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># deploy.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>APP_NAME</span><span class=o>=</span><span class=s2>&#34;myapp&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION</span><span class=o>=</span><span class=k>$(</span>git rev-parse --short HEAD<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>REGISTRY</span><span class=o>=</span><span class=s2>&#34;localhost:5000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;🔨 Build Stage&#34;</span>
</span></span><span class=line><span class=cl>docker build -t <span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span> .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;📦 Release Stage&#34;</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span> <span class=si>${</span><span class=nv>REGISTRY</span><span class=si>}</span>/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span> <span class=si>${</span><span class=nv>REGISTRY</span><span class=si>}</span>/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:latest
</span></span><span class=line><span class=cl>docker push <span class=si>${</span><span class=nv>REGISTRY</span><span class=si>}</span>/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span>
</span></span><span class=line><span class=cl>docker push <span class=si>${</span><span class=nv>REGISTRY</span><span class=si>}</span>/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;🚀 Run Stage&#34;</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>set</span> image deployment/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span> <span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span><span class=o>=</span><span class=si>${</span><span class=nv>REGISTRY</span><span class=si>}</span>/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span>
</span></span><span class=line><span class=cl>kubectl rollout status deployment/<span class=si>${</span><span class=nv>APP_NAME</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;✅ Deployment completed: </span><span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=processes-프로세스>Processes (프로세스)<a hidden class=anchor aria-hidden=true href=#processes-프로세스>#</a></h4><p><strong>원칙</strong>: 하나 이상의 상태 비저장 프로세스로 앱을 실행한다.<br><strong>설명</strong>: 앱은 상태를 내부에 저장하지 않고, 모든 상태는 외부 지원 서비스 (데이터베이스, 캐시 등) 에 저장한다. 프로세스 간 상태 공유를 하지 않으며, 무상태 (stateless) 로 설계한다.<br><strong>특징</strong>:</p><ul><li><p>무상태 (stateless) 프로세스</p></li><li><p>상태 공유 금지, 외부 저장소 활용</p></li><li><p>수평 확장에 용이<br><strong>실전 예시</strong>:</p></li><li><p>Express.js 에서 무상태 세션 관리</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36>36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37>37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38>38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39>39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40>40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41>41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42>42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43>43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44>44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45>45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46>46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47>47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48>48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49>49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50>50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51>51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express-session&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RedisStore</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;connect-redis&#39;</span><span class=p>)(</span><span class=nx>session</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;redis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>redisClient</span> <span class=o>=</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>createClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ❌ 잘못된 방식 - 메모리에 세션 저장
</span></span></span><span class=line><span class=cl><span class=c1>// app.use(session({
</span></span></span><span class=line><span class=cl><span class=c1>//   secret: &#39;secret-key&#39;,
</span></span></span><span class=line><span class=cl><span class=c1>//   resave: false,
</span></span></span><span class=line><span class=cl><span class=c1>//   saveUninitialized: false
</span></span></span><span class=line><span class=cl><span class=c1>// }));
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 올바른 방식 - Redis에 세션 저장
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>session</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>store</span><span class=o>:</span> <span class=k>new</span> <span class=nx>RedisStore</span><span class=p>({</span> <span class=nx>client</span><span class=o>:</span> <span class=nx>redisClient</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>secret</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SESSION_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>resave</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>saveUninitialized</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cookie</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>secure</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;production&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>maxAge</span><span class=o>:</span> <span class=mi>24</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span> <span class=c1>// 24 hours
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용자 인증 상태도 JWT로 무상태화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>username</span><span class=p>,</span> <span class=nx>password</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 사용자 인증 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>authenticateUser</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=nx>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Invalid credentials&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// JWT 토큰 생성 (무상태)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>userId</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>expiresIn</span><span class=o>:</span> <span class=s1>&#39;24h&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>token</span><span class=p>,</span> <span class=nx>user</span><span class=o>:</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span> <span class=p>}</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>파일 업로드 무상태 처리</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>multer</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;multer&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>AWS</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;aws-sdk&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ❌ 잘못된 방식 - 로컬 디스크에 저장
</span></span></span><span class=line><span class=cl><span class=c1>// const upload = multer({ dest: &#39;uploads/&#39; });
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 올바른 방식 - 외부 저장소(S3) 직접 업로드
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>s3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AWS</span><span class=p>.</span><span class=nx>S3</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>accessKeyId</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>AWS_ACCESS_KEY_ID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>secretAccessKey</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>AWS_SECRET_ACCESS_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>region</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>AWS_REGION</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>upload</span> <span class=o>=</span> <span class=nx>multer</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>storage</span><span class=o>:</span> <span class=nx>multer</span><span class=p>.</span><span class=nx>memoryStorage</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>  <span class=nx>limits</span><span class=o>:</span> <span class=p>{</span> <span class=nx>fileSize</span><span class=o>:</span> <span class=mi>10</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span> <span class=p>}</span> <span class=c1>// 10MB
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/upload&#39;</span><span class=p>,</span> <span class=nx>upload</span><span class=p>.</span><span class=nx>single</span><span class=p>(</span><span class=s1>&#39;file&#39;</span><span class=p>),</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>S3_BUCKET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Key</span><span class=o>:</span> <span class=sb>`uploads/</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>-</span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>originalname</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Body</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>buffer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>ContentType</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>mimetype</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>s3</span><span class=p>.</span><span class=nx>upload</span><span class=p>(</span><span class=nx>params</span><span class=p>).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>Location</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Upload failed&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서의 무상태 배포</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41>41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42>42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43>43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44>44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45>45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46>46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47>47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48>48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49>49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50>50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51>51</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>REDIS_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redis://redis-service:6379&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>JWT_SECRET</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>JWT_SECRET</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 무상태를 위한 프로브 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/ready</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>LoadBalancer</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=port-binding-포트-바인딩>Port Binding (포트 바인딩)<a hidden class=anchor aria-hidden=true href=#port-binding-포트-바인딩>#</a></h4><p><strong>원칙</strong>: 포트 바인딩을 통해 서비스를 외부에 공개한다.<br><strong>설명</strong>: 앱은 자체적으로 포트를 바인딩해 웹 서버를 실행하며, 별도의 웹 서버 (Apache, Nginx) 없이 독립적으로 서비스가 가능하다. Kubernetes 에서는 Service, Ingress 등으로 외부 노출이 가능하다.<br><strong>특징</strong>:</p><ul><li><p>자체 포트에서 웹 서버 실행</p></li><li><p>포트 번호를 환경변수로 관리</p></li><li><p>독립 실행 및 외부 서비스 연동 가능<br><strong>실전 예시</strong>:</p></li><li><p>Node.js Express 서버</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26>26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27>27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28>28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29>29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30>30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31>31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32>32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33>33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 환경 변수에서 포트 읽기, 기본값 3000
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> 
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Hello World!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=nx>PORT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pid</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>pid</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/health&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;healthy&#39;</span><span class=p>,</span> <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서버 시작 시 바인딩된 포트 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`🚀 Server is running on port </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📍 Health check available at http://localhost:</span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>/health`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Graceful shutdown 지원
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;SIGTERM received, shutting down gracefully&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>server</span><span class=p>.</span><span class=nx>close</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Process terminated&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>app</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Python Flask 서버</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27>27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28>28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29>29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30>30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31>31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32>32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33>33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>signal</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>PORT</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;PORT&#39;</span><span class=p>,</span> <span class=mi>5000</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Hello World!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=n>PORT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;pid&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getpid</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/health&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>health</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;healthy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>signal_handler</span><span class=p>(</span><span class=n>sig</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Received shutdown signal, exiting gracefully...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 신호 핸들러 등록</span>
</span></span><span class=line><span class=cl>    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>,</span> <span class=n>signal_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>signal_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;🚀 Server starting on port </span><span class=si>{</span><span class=n>PORT</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=n>PORT</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Docker 컨테이너에서의 포트 바인딩</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:18-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci --only<span class=o>=</span>production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 비root 사용자 생성 및 사용</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> addgroup -g <span class=m>1001</span> -S nodejs <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    adduser -S nextjs -u <span class=m>1001</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> nextjs</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 포트 환경 변수 설정</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 포트 노출</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> $PORT</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 헬스체크 추가</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>HEALTHCHECK --interval=30s --timeout=3s </span>--start-period<span class=o>=</span>5s --retries<span class=o>=</span><span class=m>3</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  CMD curl -f http://localhost:<span class=nv>$PORT</span>/health <span class=o>||</span> <span class=nb>exit</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서의 서비스 노출</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37>37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38>38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39>39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40>40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41>41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42>42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43>43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44>44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45>45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46>46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47>47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48>48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49>49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50>50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51>51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52>52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53>53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54>54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55>55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56>56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57>57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58>58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59>59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60>60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61>61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62>62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63>63</a>
</span><span class=lnt id=hl-21-64><a class=lnlinks href=#hl-21-64>64</a>
</span><span class=lnt id=hl-21-65><a class=lnlinks href=#hl-21-65>65</a>
</span><span class=lnt id=hl-21-66><a class=lnlinks href=#hl-21-66>66</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nginx.ingress.kubernetes.io/rewrite-target</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>myapp.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class=l>Prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=concurrency-동시성>Concurrency (동시성)<a hidden class=anchor aria-hidden=true href=#concurrency-동시성>#</a></h4><p><strong>원칙</strong>: 프로세스 모델을 통한 수평적 확장을 지원한다.<br><strong>설명</strong>: 애플리케이션을 여러 프로세스 (웹, 워커 등) 로 분할해 동시성을 확보하고, 프로세스 매니저나 오케스트레이터 (Kubernetes 등) 로 확장한다.<br><strong>특징</strong>:</p><ul><li><p>프로세스별 역할 분리 (web, worker 등)</p></li><li><p>수평 확장 (HPA 등) 용이</p></li><li><p>각 프로세스 독립 실행</p></li><li><p>Procfile 로 웹/워커 분리, Kubernetes Deployment 로 각각 확장<br><strong>실전 예시</strong>:</p></li><li><p>Procfile 을 통한 프로세스 유형 정의</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2>2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3>3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4>4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Procfile
</span></span><span class=line><span class=cl>web: node server.js
</span></span><span class=line><span class=cl>worker: node worker.js
</span></span><span class=line><span class=cl>scheduler: node scheduler.js
</span></span><span class=line><span class=cl>release: node scripts/migrate.js
</span></span></code></pre></td></tr></table></div></div></li><li><p>Node.js 웹 프로세스 구현</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22>22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23>23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24>24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25>25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26>26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27>27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28>28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29>29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30>30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31>31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32>32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33>33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34>34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35>35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36>36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37>37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38>38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39>39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40>40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41>41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42>42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43>43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44>44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45>45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46>46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47>47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48>48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49>49</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// server.js - 웹 프로세스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Queue</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bull&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 작업 큐 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>emailQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;email processing&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>imageQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;image processing&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// HTTP 요청 처리 (웹 프로세스의 역할)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/users&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>createUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이메일 발송을 워커 프로세스에 위임
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>emailQueue</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;welcome-email&#39;</span><span class=p>,</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nx>userId</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>email</span> 
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/upload&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>uploadResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>handleUpload</span><span class=p>(</span><span class=nx>req</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 이미지 처리를 워커 프로세스에 위임
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>imageQueue</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;resize-image&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>imageId</span><span class=o>:</span> <span class=nx>uploadResult</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>sizes</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;thumbnail&#39;</span><span class=p>,</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span> <span class=s1>&#39;large&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>uploadResult</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`🌐 Web process listening on port </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Node.js 워커 프로세스 구현</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53>53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54>54</a>
</span><span class=lnt id=hl-24-55><a class=lnlinks href=#hl-24-55>55</a>
</span><span class=lnt id=hl-24-56><a class=lnlinks href=#hl-24-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// worker.js - 워커 프로세스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>Queue</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bull&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>nodemailer</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;nodemailer&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sharp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;sharp&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 큐 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>emailQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;email processing&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>imageQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;image processing&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이메일 발송 워커
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>emailQueue</span><span class=p>.</span><span class=nx>process</span><span class=p>(</span><span class=s1>&#39;welcome-email&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>job</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>email</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📧 Processing welcome email for user </span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>transporter</span> <span class=o>=</span> <span class=nx>nodemailer</span><span class=p>.</span><span class=nx>createTransporter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SMTP_HOST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SMTP_PORT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>auth</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>user</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SMTP_USER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>pass</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SMTP_PASS</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>transporter</span><span class=p>.</span><span class=nx>sendMail</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>from</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>FROM_EMAIL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>to</span><span class=o>:</span> <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=o>:</span> <span class=s1>&#39;Welcome to our platform!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>html</span><span class=o>:</span> <span class=sb>`&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;p&gt;Thank you for joining us.&lt;/p&gt;`</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`✅ Welcome email sent to </span><span class=si>${</span><span class=nx>email</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이미지 처리 워커
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>imageQueue</span><span class=p>.</span><span class=nx>process</span><span class=p>(</span><span class=s1>&#39;resize-image&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>job</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>imageId</span><span class=p>,</span> <span class=nx>sizes</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`🖼️ Processing image </span><span class=si>${</span><span class=nx>imageId</span><span class=si>}</span><span class=sb> for sizes: </span><span class=si>${</span><span class=nx>sizes</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;, &#39;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>originalImage</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getImageById</span><span class=p>(</span><span class=nx>imageId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>size</span> <span class=k>of</span> <span class=nx>sizes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>dimensions</span> <span class=o>=</span> <span class=nx>getSizeDimensions</span><span class=p>(</span><span class=nx>size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>resizedBuffer</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>sharp</span><span class=p>(</span><span class=nx>originalImage</span><span class=p>.</span><span class=nx>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>resize</span><span class=p>(</span><span class=nx>dimensions</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>dimensions</span><span class=p>.</span><span class=nx>height</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>jpeg</span><span class=p>({</span> <span class=nx>quality</span><span class=o>:</span> <span class=mi>80</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>toBuffer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>saveResizedImage</span><span class=p>(</span><span class=nx>imageId</span><span class=p>,</span> <span class=nx>size</span><span class=p>,</span> <span class=nx>resizedBuffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`✅ Image </span><span class=si>${</span><span class=nx>imageId</span><span class=si>}</span><span class=sb> processed successfully`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;👷 Worker processes started&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>스케줄러 프로세스 구현</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// scheduler.js - 스케줄러 프로세스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>cron</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;node-cron&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Queue</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bull&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>emailQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;email processing&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cleanupQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;cleanup tasks&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 매일 오전 9시에 일일 리포트 이메일 발송
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>cron</span><span class=p>.</span><span class=nx>schedule</span><span class=p>(</span><span class=s1>&#39;0 9 * * *&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;📊 Scheduling daily report emails&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getActiveUsers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>user</span> <span class=k>of</span> <span class=nx>users</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>emailQueue</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;daily-report&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>userId</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>email</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>delay</span><span class=o>:</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>3600000</span><span class=p>)</span> <span class=c1>// 1시간 내 랜덤 지연
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 매주 일요일 자정에 데이터 정리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>cron</span><span class=p>.</span><span class=nx>schedule</span><span class=p>(</span><span class=s1>&#39;0 0 * * 0&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;🧹 Scheduling weekly cleanup&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>cleanupQueue</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;cleanup-old-logs&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>olderThan</span><span class=o>:</span> <span class=s1>&#39;30 days&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>cleanupQueue</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;cleanup-temp-files&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>olderThan</span><span class=o>:</span> <span class=s1>&#39;7 days&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;⏰ Scheduler process started&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서의 프로세스 유형별 배포</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>  1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>  2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>  3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>  4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5>  5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6>  6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7>  7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8>  8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9>  9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10> 10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11> 11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12> 12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13> 13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14> 14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15> 15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16> 16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17> 17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18> 18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19> 19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20> 20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21> 21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22> 22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23> 23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24> 24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25> 25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26> 26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27> 27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28> 28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29> 29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30> 30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31> 31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32> 32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33> 33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34> 34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35> 35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36> 36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37> 37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38> 38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39> 39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40> 40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41> 41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42> 42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43> 43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44> 44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45> 45</a>
</span><span class=lnt id=hl-26-46><a class=lnlinks href=#hl-26-46> 46</a>
</span><span class=lnt id=hl-26-47><a class=lnlinks href=#hl-26-47> 47</a>
</span><span class=lnt id=hl-26-48><a class=lnlinks href=#hl-26-48> 48</a>
</span><span class=lnt id=hl-26-49><a class=lnlinks href=#hl-26-49> 49</a>
</span><span class=lnt id=hl-26-50><a class=lnlinks href=#hl-26-50> 50</a>
</span><span class=lnt id=hl-26-51><a class=lnlinks href=#hl-26-51> 51</a>
</span><span class=lnt id=hl-26-52><a class=lnlinks href=#hl-26-52> 52</a>
</span><span class=lnt id=hl-26-53><a class=lnlinks href=#hl-26-53> 53</a>
</span><span class=lnt id=hl-26-54><a class=lnlinks href=#hl-26-54> 54</a>
</span><span class=lnt id=hl-26-55><a class=lnlinks href=#hl-26-55> 55</a>
</span><span class=lnt id=hl-26-56><a class=lnlinks href=#hl-26-56> 56</a>
</span><span class=lnt id=hl-26-57><a class=lnlinks href=#hl-26-57> 57</a>
</span><span class=lnt id=hl-26-58><a class=lnlinks href=#hl-26-58> 58</a>
</span><span class=lnt id=hl-26-59><a class=lnlinks href=#hl-26-59> 59</a>
</span><span class=lnt id=hl-26-60><a class=lnlinks href=#hl-26-60> 60</a>
</span><span class=lnt id=hl-26-61><a class=lnlinks href=#hl-26-61> 61</a>
</span><span class=lnt id=hl-26-62><a class=lnlinks href=#hl-26-62> 62</a>
</span><span class=lnt id=hl-26-63><a class=lnlinks href=#hl-26-63> 63</a>
</span><span class=lnt id=hl-26-64><a class=lnlinks href=#hl-26-64> 64</a>
</span><span class=lnt id=hl-26-65><a class=lnlinks href=#hl-26-65> 65</a>
</span><span class=lnt id=hl-26-66><a class=lnlinks href=#hl-26-66> 66</a>
</span><span class=lnt id=hl-26-67><a class=lnlinks href=#hl-26-67> 67</a>
</span><span class=lnt id=hl-26-68><a class=lnlinks href=#hl-26-68> 68</a>
</span><span class=lnt id=hl-26-69><a class=lnlinks href=#hl-26-69> 69</a>
</span><span class=lnt id=hl-26-70><a class=lnlinks href=#hl-26-70> 70</a>
</span><span class=lnt id=hl-26-71><a class=lnlinks href=#hl-26-71> 71</a>
</span><span class=lnt id=hl-26-72><a class=lnlinks href=#hl-26-72> 72</a>
</span><span class=lnt id=hl-26-73><a class=lnlinks href=#hl-26-73> 73</a>
</span><span class=lnt id=hl-26-74><a class=lnlinks href=#hl-26-74> 74</a>
</span><span class=lnt id=hl-26-75><a class=lnlinks href=#hl-26-75> 75</a>
</span><span class=lnt id=hl-26-76><a class=lnlinks href=#hl-26-76> 76</a>
</span><span class=lnt id=hl-26-77><a class=lnlinks href=#hl-26-77> 77</a>
</span><span class=lnt id=hl-26-78><a class=lnlinks href=#hl-26-78> 78</a>
</span><span class=lnt id=hl-26-79><a class=lnlinks href=#hl-26-79> 79</a>
</span><span class=lnt id=hl-26-80><a class=lnlinks href=#hl-26-80> 80</a>
</span><span class=lnt id=hl-26-81><a class=lnlinks href=#hl-26-81> 81</a>
</span><span class=lnt id=hl-26-82><a class=lnlinks href=#hl-26-82> 82</a>
</span><span class=lnt id=hl-26-83><a class=lnlinks href=#hl-26-83> 83</a>
</span><span class=lnt id=hl-26-84><a class=lnlinks href=#hl-26-84> 84</a>
</span><span class=lnt id=hl-26-85><a class=lnlinks href=#hl-26-85> 85</a>
</span><span class=lnt id=hl-26-86><a class=lnlinks href=#hl-26-86> 86</a>
</span><span class=lnt id=hl-26-87><a class=lnlinks href=#hl-26-87> 87</a>
</span><span class=lnt id=hl-26-88><a class=lnlinks href=#hl-26-88> 88</a>
</span><span class=lnt id=hl-26-89><a class=lnlinks href=#hl-26-89> 89</a>
</span><span class=lnt id=hl-26-90><a class=lnlinks href=#hl-26-90> 90</a>
</span><span class=lnt id=hl-26-91><a class=lnlinks href=#hl-26-91> 91</a>
</span><span class=lnt id=hl-26-92><a class=lnlinks href=#hl-26-92> 92</a>
</span><span class=lnt id=hl-26-93><a class=lnlinks href=#hl-26-93> 93</a>
</span><span class=lnt id=hl-26-94><a class=lnlinks href=#hl-26-94> 94</a>
</span><span class=lnt id=hl-26-95><a class=lnlinks href=#hl-26-95> 95</a>
</span><span class=lnt id=hl-26-96><a class=lnlinks href=#hl-26-96> 96</a>
</span><span class=lnt id=hl-26-97><a class=lnlinks href=#hl-26-97> 97</a>
</span><span class=lnt id=hl-26-98><a class=lnlinks href=#hl-26-98> 98</a>
</span><span class=lnt id=hl-26-99><a class=lnlinks href=#hl-26-99> 99</a>
</span><span class=lnt id=hl-26-100><a class=lnlinks href=#hl-26-100>100</a>
</span><span class=lnt id=hl-26-101><a class=lnlinks href=#hl-26-101>101</a>
</span><span class=lnt id=hl-26-102><a class=lnlinks href=#hl-26-102>102</a>
</span><span class=lnt id=hl-26-103><a class=lnlinks href=#hl-26-103>103</a>
</span><span class=lnt id=hl-26-104><a class=lnlinks href=#hl-26-104>104</a>
</span><span class=lnt id=hl-26-105><a class=lnlinks href=#hl-26-105>105</a>
</span><span class=lnt id=hl-26-106><a class=lnlinks href=#hl-26-106>106</a>
</span><span class=lnt id=hl-26-107><a class=lnlinks href=#hl-26-107>107</a>
</span><span class=lnt id=hl-26-108><a class=lnlinks href=#hl-26-108>108</a>
</span><span class=lnt id=hl-26-109><a class=lnlinks href=#hl-26-109>109</a>
</span><span class=lnt id=hl-26-110><a class=lnlinks href=#hl-26-110>110</a>
</span><span class=lnt id=hl-26-111><a class=lnlinks href=#hl-26-111>111</a>
</span><span class=lnt id=hl-26-112><a class=lnlinks href=#hl-26-112>112</a>
</span><span class=lnt id=hl-26-113><a class=lnlinks href=#hl-26-113>113</a>
</span><span class=lnt id=hl-26-114><a class=lnlinks href=#hl-26-114>114</a>
</span><span class=lnt id=hl-26-115><a class=lnlinks href=#hl-26-115>115</a>
</span><span class=lnt id=hl-26-116><a class=lnlinks href=#hl-26-116>116</a>
</span><span class=lnt id=hl-26-117><a class=lnlinks href=#hl-26-117>117</a>
</span><span class=lnt id=hl-26-118><a class=lnlinks href=#hl-26-118>118</a>
</span><span class=lnt id=hl-26-119><a class=lnlinks href=#hl-26-119>119</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Web 프로세스 배포</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;start:web&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PROCESS_TYPE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;web&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;128Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Worker 프로세스 배포</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;start:worker&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PROCESS_TYPE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;worker&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 스케줄러 프로세스 배포 (단일 인스턴스)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-scheduler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>scheduler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>scheduler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>scheduler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;start:scheduler&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PROCESS_TYPE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;scheduler&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># HPA (Horizontal Pod Autoscaler) 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-web-hpa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>70</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=disposability-폐기-가능성>Disposability (폐기 가능성)<a hidden class=anchor aria-hidden=true href=#disposability-폐기-가능성>#</a></h4><p><strong>원칙</strong>: 빠른 시작과 그레이스풀 셧다운으로 안정성을 극대화한다.<br><strong>설명</strong>: 프로세스는 빠르게 시작하고, 종료 시에도 안전하게 자원을 정리해야 한다. Kubernetes 에서는 preStop, terminationGracePeriodSeconds 등으로 graceful shutdown 을 지원한다.<br><strong>특징</strong>:</p><ul><li><p>빠른 부팅/종료</p></li><li><p>SIGTERM 등 신호에 안전하게 종료</p></li><li><p>장애 발생 시 빠른 복구 가능<br><strong>실전 예시</strong>:</p></li><li><p>Node.js 에서의 그레이스풀 셧다운 구현</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29>29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30>30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31>31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32>32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33>33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34>34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35>35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36>36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37>37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38>38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39>39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40>40</a>
</span><span class=lnt id=hl-27-41><a class=lnlinks href=#hl-27-41>41</a>
</span><span class=lnt id=hl-27-42><a class=lnlinks href=#hl-27-42>42</a>
</span><span class=lnt id=hl-27-43><a class=lnlinks href=#hl-27-43>43</a>
</span><span class=lnt id=hl-27-44><a class=lnlinks href=#hl-27-44>44</a>
</span><span class=lnt id=hl-27-45><a class=lnlinks href=#hl-27-45>45</a>
</span><span class=lnt id=hl-27-46><a class=lnlinks href=#hl-27-46>46</a>
</span><span class=lnt id=hl-27-47><a class=lnlinks href=#hl-27-47>47</a>
</span><span class=lnt id=hl-27-48><a class=lnlinks href=#hl-27-48>48</a>
</span><span class=lnt id=hl-27-49><a class=lnlinks href=#hl-27-49>49</a>
</span><span class=lnt id=hl-27-50><a class=lnlinks href=#hl-27-50>50</a>
</span><span class=lnt id=hl-27-51><a class=lnlinks href=#hl-27-51>51</a>
</span><span class=lnt id=hl-27-52><a class=lnlinks href=#hl-27-52>52</a>
</span><span class=lnt id=hl-27-53><a class=lnlinks href=#hl-27-53>53</a>
</span><span class=lnt id=hl-27-54><a class=lnlinks href=#hl-27-54>54</a>
</span><span class=lnt id=hl-27-55><a class=lnlinks href=#hl-27-55>55</a>
</span><span class=lnt id=hl-27-56><a class=lnlinks href=#hl-27-56>56</a>
</span><span class=lnt id=hl-27-57><a class=lnlinks href=#hl-27-57>57</a>
</span><span class=lnt id=hl-27-58><a class=lnlinks href=#hl-27-58>58</a>
</span><span class=lnt id=hl-27-59><a class=lnlinks href=#hl-27-59>59</a>
</span><span class=lnt id=hl-27-60><a class=lnlinks href=#hl-27-60>60</a>
</span><span class=lnt id=hl-27-61><a class=lnlinks href=#hl-27-61>61</a>
</span><span class=lnt id=hl-27-62><a class=lnlinks href=#hl-27-62>62</a>
</span><span class=lnt id=hl-27-63><a class=lnlinks href=#hl-27-63>63</a>
</span><span class=lnt id=hl-27-64><a class=lnlinks href=#hl-27-64>64</a>
</span><span class=lnt id=hl-27-65><a class=lnlinks href=#hl-27-65>65</a>
</span><span class=lnt id=hl-27-66><a class=lnlinks href=#hl-27-66>66</a>
</span><span class=lnt id=hl-27-67><a class=lnlinks href=#hl-27-67>67</a>
</span><span class=lnt id=hl-27-68><a class=lnlinks href=#hl-27-68>68</a>
</span><span class=lnt id=hl-27-69><a class=lnlinks href=#hl-27-69>69</a>
</span><span class=lnt id=hl-27-70><a class=lnlinks href=#hl-27-70>70</a>
</span><span class=lnt id=hl-27-71><a class=lnlinks href=#hl-27-71>71</a>
</span><span class=lnt id=hl-27-72><a class=lnlinks href=#hl-27-72>72</a>
</span><span class=lnt id=hl-27-73><a class=lnlinks href=#hl-27-73>73</a>
</span><span class=lnt id=hl-27-74><a class=lnlinks href=#hl-27-74>74</a>
</span><span class=lnt id=hl-27-75><a class=lnlinks href=#hl-27-75>75</a>
</span><span class=lnt id=hl-27-76><a class=lnlinks href=#hl-27-76>76</a>
</span><span class=lnt id=hl-27-77><a class=lnlinks href=#hl-27-77>77</a>
</span><span class=lnt id=hl-27-78><a class=lnlinks href=#hl-27-78>78</a>
</span><span class=lnt id=hl-27-79><a class=lnlinks href=#hl-27-79>79</a>
</span><span class=lnt id=hl-27-80><a class=lnlinks href=#hl-27-80>80</a>
</span><span class=lnt id=hl-27-81><a class=lnlinks href=#hl-27-81>81</a>
</span><span class=lnt id=hl-27-82><a class=lnlinks href=#hl-27-82>82</a>
</span><span class=lnt id=hl-27-83><a class=lnlinks href=#hl-27-83>83</a>
</span><span class=lnt id=hl-27-84><a class=lnlinks href=#hl-27-84>84</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// server.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 활성 연결 추적
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>connections</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>server</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>connection</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>connections</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>connection</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>connections</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Hello World!&#39;</span><span class=p>,</span> <span class=nx>pid</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>pid</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 헬스체크 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/health&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;healthy&#39;</span><span class=p>,</span> <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 빠른 시작을 위한 최소한의 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`🚀 Server started on port </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb> (PID: </span><span class=si>${</span><span class=nx>process</span><span class=p>.</span><span class=nx>pid</span><span class=si>}</span><span class=sb>)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 그레이스풀 셧다운 구현
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>isShuttingDown</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=nx>signal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isShuttingDown</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>isShuttingDown</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📨 Received </span><span class=si>${</span><span class=nx>signal</span><span class=si>}</span><span class=sb>. Starting graceful shutdown...`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 새로운 요청 거부
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>server</span><span class=p>.</span><span class=nx>close</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;🚪 HTTP server closed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 활성 연결 종료 (최대 30초 대기)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>timeout</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;⏰ Forcing close of remaining connections&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>connections</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>connection</span> <span class=p>=&gt;</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>destroy</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>30000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 모든 연결이 정상 종료되면 바로 종료
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>connections</span><span class=p>.</span><span class=nx>size</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;✅ Graceful shutdown completed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 연결 종료 대기
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>checkConnections</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>connections</span><span class=p>.</span><span class=nx>size</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>clearInterval</span><span class=p>(</span><span class=nx>checkConnections</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;✅ Graceful shutdown completed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 신호 핸들러 등록
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 처리되지 않은 예외 핸들링
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;uncaughtException&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;💥 Uncaught Exception:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=s1>&#39;uncaughtException&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;unhandledRejection&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>reason</span><span class=p>,</span> <span class=nx>promise</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;💥 Unhandled Rejection at:&#39;</span><span class=p>,</span> <span class=nx>promise</span><span class=p>,</span> <span class=s1>&#39;reason:&#39;</span><span class=p>,</span> <span class=nx>reason</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=s1>&#39;unhandledRejection&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>워커 프로세스의 그레이스풀 셧다운</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43>43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44>44</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// worker.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>Queue</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bull&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>emailQueue</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Queue</span><span class=p>(</span><span class=s1>&#39;email processing&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>isShuttingDown</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이메일 처리 작업
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>emailQueue</span><span class=p>.</span><span class=nx>process</span><span class=p>(</span><span class=s1>&#39;send-email&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>job</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 셧다운 중이면 새 작업 거부
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>isShuttingDown</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Worker is shutting down&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>to</span><span class=p>,</span> <span class=nx>subject</span><span class=p>,</span> <span class=nx>content</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📧 Processing email to </span><span class=si>${</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 발송 로직 (시간이 걸릴 수 있음)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>sendEmail</span><span class=p>(</span><span class=nx>to</span><span class=p>,</span> <span class=nx>subject</span><span class=p>,</span> <span class=nx>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`✅ Email sent to </span><span class=si>${</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=nx>signal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isShuttingDown</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>isShuttingDown</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📨 Received </span><span class=si>${</span><span class=nx>signal</span><span class=si>}</span><span class=sb>. Starting worker shutdown...`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 현재 처리 중인 작업 완료까지 대기 (최대 30초)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>emailQueue</span><span class=p>.</span><span class=nx>close</span><span class=p>(</span><span class=mi>30000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;✅ All jobs completed. Worker shutdown gracefully.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;⚠️ Error during shutdown:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>gracefulShutdown</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;👷 Worker started and ready to process jobs&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서의 그레이스풀 셧다운 설정</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18>18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19>19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20>20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21>21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22>22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23>23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24>24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25>25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26>26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27>27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28>28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29>29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30>30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31>31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32>32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33>33</a>
</span><span class=lnt id=hl-29-34><a class=lnlinks href=#hl-29-34>34</a>
</span><span class=lnt id=hl-29-35><a class=lnlinks href=#hl-29-35>35</a>
</span><span class=lnt id=hl-29-36><a class=lnlinks href=#hl-29-36>36</a>
</span><span class=lnt id=hl-29-37><a class=lnlinks href=#hl-29-37>37</a>
</span><span class=lnt id=hl-29-38><a class=lnlinks href=#hl-29-38>38</a>
</span><span class=lnt id=hl-29-39><a class=lnlinks href=#hl-29-39>39</a>
</span><span class=lnt id=hl-29-40><a class=lnlinks href=#hl-29-40>40</a>
</span><span class=lnt id=hl-29-41><a class=lnlinks href=#hl-29-41>41</a>
</span><span class=lnt id=hl-29-42><a class=lnlinks href=#hl-29-42>42</a>
</span><span class=lnt id=hl-29-43><a class=lnlinks href=#hl-29-43>43</a>
</span><span class=lnt id=hl-29-44><a class=lnlinks href=#hl-29-44>44</a>
</span><span class=lnt id=hl-29-45><a class=lnlinks href=#hl-29-45>45</a>
</span><span class=lnt id=hl-29-46><a class=lnlinks href=#hl-29-46>46</a>
</span><span class=lnt id=hl-29-47><a class=lnlinks href=#hl-29-47>47</a>
</span><span class=lnt id=hl-29-48><a class=lnlinks href=#hl-29-48>48</a>
</span><span class=lnt id=hl-29-49><a class=lnlinks href=#hl-29-49>49</a>
</span><span class=lnt id=hl-29-50><a class=lnlinks href=#hl-29-50>50</a>
</span><span class=lnt id=hl-29-51><a class=lnlinks href=#hl-29-51>51</a>
</span><span class=lnt id=hl-29-52><a class=lnlinks href=#hl-29-52>52</a>
</span><span class=lnt id=hl-29-53><a class=lnlinks href=#hl-29-53>53</a>
</span><span class=lnt id=hl-29-54><a class=lnlinks href=#hl-29-54>54</a>
</span><span class=lnt id=hl-29-55><a class=lnlinks href=#hl-29-55>55</a>
</span><span class=lnt id=hl-29-56><a class=lnlinks href=#hl-29-56>56</a>
</span><span class=lnt id=hl-29-57><a class=lnlinks href=#hl-29-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 빠른 시작을 위한 프로브 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 그레이스풀 셧다운을 위한 lifecycle 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>lifecycle</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>preStop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;sleep 5&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 리소스 제한으로 빠른 시작 보장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;128Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 그레이스풀 셧다운 대기 시간 (기본 30초)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>35</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 빠른 시작을 위한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Docker 컨테이너에서의 시그널 처리</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21>21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22>22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23>23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24>24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:18-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 빠른 빌드를 위한 레이어 분리</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci --only<span class=o>=</span>production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 비root 사용자로 실행 (보안)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> addgroup -g <span class=m>1001</span> -S nodejs <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    adduser -S nextjs -u <span class=m>1001</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> nextjs</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 시그널 전달을 위한 init 프로세스 사용</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;dumb-init&#34;</span><span class=p>,</span> <span class=s2>&#34;--&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 3000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 헬스체크로 빠른 시작 확인</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>HEALTHCHECK --interval=10s --timeout=3s </span>--start-period<span class=o>=</span>5s --retries<span class=o>=</span><span class=m>3</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  CMD curl -f http://localhost:3000/health <span class=o>||</span> <span class=nb>exit</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=devprod-parity-개발프로덕션-동일성>Dev/Prod Parity (개발/프로덕션 동일성)<a hidden class=anchor aria-hidden=true href=#devprod-parity-개발프로덕션-동일성>#</a></h4><p><strong>원칙</strong>: 개발, 스테이징, 프로덕션 환경을 최대한 비슷하게 유지한다.<br><strong>설명</strong>: 모든 환경에서 동일한 코드, 의존성, 지원 서비스를 사용해 환경 간 차이를 최소화한다. Docker, IaC, CI/CD 등으로 환경 일치를 보장한다.<br><strong>특징</strong>:</p><ul><li><p>동일 이미지/컨테이너로 환경 일치</p></li><li><p>환경별 설정만 분리</p></li><li><p>지속적 배포 (CI/CD) 용이</p></li><li><p>Docker Compose 로 개발/운영 환경 동일화, CI/CD 에서 동일 이미지 배포<br><strong>실전 예시</strong>:</p></li><li><p>Docker Compose 를 통한 환경 통일</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16>16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17>17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18>18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19>19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20>20</a>
</span><span class=lnt id=hl-31-21><a class=lnlinks href=#hl-31-21>21</a>
</span><span class=lnt id=hl-31-22><a class=lnlinks href=#hl-31-22>22</a>
</span><span class=lnt id=hl-31-23><a class=lnlinks href=#hl-31-23>23</a>
</span><span class=lnt id=hl-31-24><a class=lnlinks href=#hl-31-24>24</a>
</span><span class=lnt id=hl-31-25><a class=lnlinks href=#hl-31-25>25</a>
</span><span class=lnt id=hl-31-26><a class=lnlinks href=#hl-31-26>26</a>
</span><span class=lnt id=hl-31-27><a class=lnlinks href=#hl-31-27>27</a>
</span><span class=lnt id=hl-31-28><a class=lnlinks href=#hl-31-28>28</a>
</span><span class=lnt id=hl-31-29><a class=lnlinks href=#hl-31-29>29</a>
</span><span class=lnt id=hl-31-30><a class=lnlinks href=#hl-31-30>30</a>
</span><span class=lnt id=hl-31-31><a class=lnlinks href=#hl-31-31>31</a>
</span><span class=lnt id=hl-31-32><a class=lnlinks href=#hl-31-32>32</a>
</span><span class=lnt id=hl-31-33><a class=lnlinks href=#hl-31-33>33</a>
</span><span class=lnt id=hl-31-34><a class=lnlinks href=#hl-31-34>34</a>
</span><span class=lnt id=hl-31-35><a class=lnlinks href=#hl-31-35>35</a>
</span><span class=lnt id=hl-31-36><a class=lnlinks href=#hl-31-36>36</a>
</span><span class=lnt id=hl-31-37><a class=lnlinks href=#hl-31-37>37</a>
</span><span class=lnt id=hl-31-38><a class=lnlinks href=#hl-31-38>38</a>
</span><span class=lnt id=hl-31-39><a class=lnlinks href=#hl-31-39>39</a>
</span><span class=lnt id=hl-31-40><a class=lnlinks href=#hl-31-40>40</a>
</span><span class=lnt id=hl-31-41><a class=lnlinks href=#hl-31-41>41</a>
</span><span class=lnt id=hl-31-42><a class=lnlinks href=#hl-31-42>42</a>
</span><span class=lnt id=hl-31-43><a class=lnlinks href=#hl-31-43>43</a>
</span><span class=lnt id=hl-31-44><a class=lnlinks href=#hl-31-44>44</a>
</span><span class=lnt id=hl-31-45><a class=lnlinks href=#hl-31-45>45</a>
</span><span class=lnt id=hl-31-46><a class=lnlinks href=#hl-31-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yml (로컬 개발용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NODE_ENV=development</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DATABASE_URL=postgresql://user:pass@db:5432/myapp_dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>REDIS_URL=redis://redis:6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>JWT_SECRET=dev-secret-key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.:/app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/app/node_modules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>npm run dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>myapp_dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>pass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5432:5432&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres_data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:7-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;6379:6379&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 개발 중 이메일 테스트용 (프로덕션과 동일한 인터페이스)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mailhog</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mailhog/mailhog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;1025:1025&#34;</span><span class=w>  </span><span class=c># SMTP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8025:8025&#34;</span><span class=w>  </span><span class=c># Web UI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>프로덕션과 동일한 도커 이미지 사용</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Dockerfile (모든 환경에서 동일하게 사용)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:18-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 종속성 설치</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci --only<span class=o>=</span>production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 애플리케이션 코드 복사</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 비root 사용자</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> addgroup -g <span class=m>1001</span> -S nodejs <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    adduser -S nextjs -u <span class=m>1001</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> nextjs</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 3000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 프로덕션 빌드 (환경에 따라 다를 수 있음)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>환경별 설정 파일</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26>26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27>27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28>28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29>29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30>30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31>31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32>32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33>33</a>
</span><span class=lnt id=hl-33-34><a class=lnlinks href=#hl-33-34>34</a>
</span><span class=lnt id=hl-33-35><a class=lnlinks href=#hl-33-35>35</a>
</span><span class=lnt id=hl-33-36><a class=lnlinks href=#hl-33-36>36</a>
</span><span class=lnt id=hl-33-37><a class=lnlinks href=#hl-33-37>37</a>
</span><span class=lnt id=hl-33-38><a class=lnlinks href=#hl-33-38>38</a>
</span><span class=lnt id=hl-33-39><a class=lnlinks href=#hl-33-39>39</a>
</span><span class=lnt id=hl-33-40><a class=lnlinks href=#hl-33-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// config/database.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>development</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_HOST</span> <span class=o>||</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_PORT</span> <span class=o>||</span> <span class=mi>5432</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>database</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_NAME</span> <span class=o>||</span> <span class=s1>&#39;myapp_dev&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>username</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_USER</span> <span class=o>||</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_PASS</span> <span class=o>||</span> <span class=s1>&#39;pass&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>dialect</span><span class=o>:</span> <span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>logging</span><span class=o>:</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>staging</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_HOST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_PORT</span> <span class=o>||</span> <span class=mi>5432</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>database</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_NAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>username</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_USER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_PASS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>dialect</span><span class=o>:</span> <span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>logging</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>ssl</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>production</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_HOST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_PORT</span> <span class=o>||</span> <span class=mi>5432</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>database</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_NAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>username</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_USER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DB_PASS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>dialect</span><span class=o>:</span> <span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>logging</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>ssl</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>dialectOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ssl</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>require</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rejectUnauthorized</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>config</span><span class=p>[</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>||</span> <span class=s1>&#39;development&#39;</span><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>CI/CD 파이프라인에서 동일한 이미지 사용</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22>22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23>23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24>24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25>25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26>26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27>27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28>28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29>29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30>30</a>
</span><span class=lnt id=hl-34-31><a class=lnlinks href=#hl-34-31>31</a>
</span><span class=lnt id=hl-34-32><a class=lnlinks href=#hl-34-32>32</a>
</span><span class=lnt id=hl-34-33><a class=lnlinks href=#hl-34-33>33</a>
</span><span class=lnt id=hl-34-34><a class=lnlinks href=#hl-34-34>34</a>
</span><span class=lnt id=hl-34-35><a class=lnlinks href=#hl-34-35>35</a>
</span><span class=lnt id=hl-34-36><a class=lnlinks href=#hl-34-36>36</a>
</span><span class=lnt id=hl-34-37><a class=lnlinks href=#hl-34-37>37</a>
</span><span class=lnt id=hl-34-38><a class=lnlinks href=#hl-34-38>38</a>
</span><span class=lnt id=hl-34-39><a class=lnlinks href=#hl-34-39>39</a>
</span><span class=lnt id=hl-34-40><a class=lnlinks href=#hl-34-40>40</a>
</span><span class=lnt id=hl-34-41><a class=lnlinks href=#hl-34-41>41</a>
</span><span class=lnt id=hl-34-42><a class=lnlinks href=#hl-34-42>42</a>
</span><span class=lnt id=hl-34-43><a class=lnlinks href=#hl-34-43>43</a>
</span><span class=lnt id=hl-34-44><a class=lnlinks href=#hl-34-44>44</a>
</span><span class=lnt id=hl-34-45><a class=lnlinks href=#hl-34-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .github/workflows/deploy.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main, staging, develop]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 동일한 Dockerfile로 이미지 빌드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Docker image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        docker build -t myapp:${{ github.sha }} .
</span></span></span><span class=line><span class=cl><span class=sd>        docker tag myapp:${{ github.sha }} myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Push to registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
</span></span></span><span class=line><span class=cl><span class=sd>        docker push myapp:${{ github.sha }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy-staging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.ref == &#39;refs/heads/staging&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to staging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl config use-context staging-cluster
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl set image deployment/myapp myapp=myapp:${{ github.sha }}
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl set env deployment/myapp NODE_ENV=staging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy-production</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.ref == &#39;refs/heads/main&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl config use-context production-cluster
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl set image deployment/myapp myapp=myapp:${{ github.sha }}
</span></span></span><span class=line><span class=cl><span class=sd>        kubectl set env deployment/myapp NODE_ENV=production</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서 환경별 배포 설정</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span><span class=lnt id=hl-35-41><a class=lnlinks href=#hl-35-41>41</a>
</span><span class=lnt id=hl-35-42><a class=lnlinks href=#hl-35-42>42</a>
</span><span class=lnt id=hl-35-43><a class=lnlinks href=#hl-35-43>43</a>
</span><span class=lnt id=hl-35-44><a class=lnlinks href=#hl-35-44>44</a>
</span><span class=lnt id=hl-35-45><a class=lnlinks href=#hl-35-45>45</a>
</span><span class=lnt id=hl-35-46><a class=lnlinks href=#hl-35-46>46</a>
</span><span class=lnt id=hl-35-47><a class=lnlinks href=#hl-35-47>47</a>
</span><span class=lnt id=hl-35-48><a class=lnlinks href=#hl-35-48>48</a>
</span><span class=lnt id=hl-35-49><a class=lnlinks href=#hl-35-49>49</a>
</span><span class=lnt id=hl-35-50><a class=lnlinks href=#hl-35-50>50</a>
</span><span class=lnt id=hl-35-51><a class=lnlinks href=#hl-35-51>51</a>
</span><span class=lnt id=hl-35-52><a class=lnlinks href=#hl-35-52>52</a>
</span><span class=lnt id=hl-35-53><a class=lnlinks href=#hl-35-53>53</a>
</span><span class=lnt id=hl-35-54><a class=lnlinks href=#hl-35-54>54</a>
</span><span class=lnt id=hl-35-55><a class=lnlinks href=#hl-35-55>55</a>
</span><span class=lnt id=hl-35-56><a class=lnlinks href=#hl-35-56>56</a>
</span><span class=lnt id=hl-35-57><a class=lnlinks href=#hl-35-57>57</a>
</span><span class=lnt id=hl-35-58><a class=lnlinks href=#hl-35-58>58</a>
</span><span class=lnt id=hl-35-59><a class=lnlinks href=#hl-35-59>59</a>
</span><span class=lnt id=hl-35-60><a class=lnlinks href=#hl-35-60>60</a>
</span><span class=lnt id=hl-35-61><a class=lnlinks href=#hl-35-61>61</a>
</span><span class=lnt id=hl-35-62><a class=lnlinks href=#hl-35-62>62</a>
</span><span class=lnt id=hl-35-63><a class=lnlinks href=#hl-35-63>63</a>
</span><span class=lnt id=hl-35-64><a class=lnlinks href=#hl-35-64>64</a>
</span><span class=lnt id=hl-35-65><a class=lnlinks href=#hl-35-65>65</a>
</span><span class=lnt id=hl-35-66><a class=lnlinks href=#hl-35-66>66</a>
</span><span class=lnt id=hl-35-67><a class=lnlinks href=#hl-35-67>67</a>
</span><span class=lnt id=hl-35-68><a class=lnlinks href=#hl-35-68>68</a>
</span><span class=lnt id=hl-35-69><a class=lnlinks href=#hl-35-69>69</a>
</span><span class=lnt id=hl-35-70><a class=lnlinks href=#hl-35-70>70</a>
</span><span class=lnt id=hl-35-71><a class=lnlinks href=#hl-35-71>71</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># base/deployment.yaml (공통 설정)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>envFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>configMapRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># staging/kustomization.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kustomize.config.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Kustomization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>../base</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>patches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>patch</span><span class=p>:</span><span class=w> </span><span class=p>|-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    - op: replace
</span></span></span><span class=line><span class=cl><span class=sd>      path: /spec/replicas
</span></span></span><span class=line><span class=cl><span class=sd>      value: 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>configMapGenerator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>literals</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>NODE_ENV=staging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>LOG_LEVEL=debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># production/kustomization.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kustomize.config.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Kustomization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>../base</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>patches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>patch</span><span class=p>:</span><span class=w> </span><span class=p>|-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    - op: replace
</span></span></span><span class=line><span class=cl><span class=sd>      path: /spec/replicas
</span></span></span><span class=line><span class=cl><span class=sd>      value: 5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>configMapGenerator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>literals</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>NODE_ENV=production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>LOG_LEVEL=info</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=logs-로그>Logs (로그)<a hidden class=anchor aria-hidden=true href=#logs-로그>#</a></h4><p><strong>원칙</strong>: 로그를 이벤트 스트림으로 처리한다.<br><strong>설명</strong>: 애플리케이션 로그는 파일에 저장하지 않고, 표준 출력 (stdout) 으로 내보내 외부 로그 수집 시스템 (ELK, Loki, CloudWatch 등) 에서 집계 및 분석한다.<br><strong>특징</strong>:</p><ul><li><p>표준 출력 기반 로그 처리</p></li><li><p>중앙 로그 시스템 연동</p></li><li><p>로그 포맷 일관성 유지<br><strong>실전 예시</strong>:</p></li><li><p>구조화된 로깅 구현 (Node.js)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22>22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23>23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24>24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25>25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26>26</a>
</span><span class=lnt id=hl-36-27><a class=lnlinks href=#hl-36-27>27</a>
</span><span class=lnt id=hl-36-28><a class=lnlinks href=#hl-36-28>28</a>
</span><span class=lnt id=hl-36-29><a class=lnlinks href=#hl-36-29>29</a>
</span><span class=lnt id=hl-36-30><a class=lnlinks href=#hl-36-30>30</a>
</span><span class=lnt id=hl-36-31><a class=lnlinks href=#hl-36-31>31</a>
</span><span class=lnt id=hl-36-32><a class=lnlinks href=#hl-36-32>32</a>
</span><span class=lnt id=hl-36-33><a class=lnlinks href=#hl-36-33>33</a>
</span><span class=lnt id=hl-36-34><a class=lnlinks href=#hl-36-34>34</a>
</span><span class=lnt id=hl-36-35><a class=lnlinks href=#hl-36-35>35</a>
</span><span class=lnt id=hl-36-36><a class=lnlinks href=#hl-36-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// logger.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>winston</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;winston&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 구조화된 로그 포맷 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>logFormat</span> <span class=o>=</span> <span class=nx>winston</span><span class=p>.</span><span class=nx>format</span><span class=p>.</span><span class=nx>combine</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>winston</span><span class=p>.</span><span class=nx>format</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>  <span class=nx>winston</span><span class=p>.</span><span class=nx>format</span><span class=p>.</span><span class=nx>errors</span><span class=p>({</span> <span class=nx>stack</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>winston</span><span class=p>.</span><span class=nx>format</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 로거 설정 (stdout만 사용)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>winston</span><span class=p>.</span><span class=nx>createLogger</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>level</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>||</span> <span class=s1>&#39;info&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>format</span><span class=o>:</span> <span class=nx>logFormat</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>transports</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>winston</span><span class=p>.</span><span class=nx>transports</span><span class=p>.</span><span class=nx>Console</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 구조화된 로깅 헬퍼 함수
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>structuredLog</span><span class=p>(</span><span class=nx>level</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>metadata</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>logger</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>level</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>service</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SERVICE_NAME</span> <span class=o>||</span> <span class=s1>&#39;myapp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>version</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>APP_VERSION</span> <span class=o>||</span> <span class=s1>&#39;1.0.0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>environment</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>||</span> <span class=s1>&#39;development&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pid</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>pid</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=err>…</span><span class=nx>metadata</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>info</span><span class=o>:</span> <span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>structuredLog</span><span class=p>(</span><span class=s1>&#39;info&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>warn</span><span class=o>:</span> <span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>structuredLog</span><span class=p>(</span><span class=s1>&#39;warn&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span><span class=o>:</span> <span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>structuredLog</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>debug</span><span class=o>:</span> <span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>structuredLog</span><span class=p>(</span><span class=s1>&#39;debug&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>meta</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Express.js 미들웨어에서 요청 로깅</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26>26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27>27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28>28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29>29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30>30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31>31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32>32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33>33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34>34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35>35</a>
</span><span class=lnt id=hl-37-36><a class=lnlinks href=#hl-37-36>36</a>
</span><span class=lnt id=hl-37-37><a class=lnlinks href=#hl-37-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// middleware/logging.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../logger&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>v4</span><span class=o>:</span> <span class=nx>uuidv4</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;uuid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>requestLogging</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 요청별 고유 ID 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>req</span><span class=p>.</span><span class=nx>requestId</span> <span class=o>=</span> <span class=nx>uuidv4</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>startTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 요청 시작 로그
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Request started&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>requestId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>method</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>userAgent</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;User-Agent&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>ip</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>ip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=o>?</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 응답 완료 시 로그
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>res</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;finish&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>duration</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Request completed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>requestId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>userId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=o>?</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>requestLogging</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>비즈니스 로직에서의 로깅</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span><span class=lnt id=hl-38-27><a class=lnlinks href=#hl-38-27>27</a>
</span><span class=lnt id=hl-38-28><a class=lnlinks href=#hl-38-28>28</a>
</span><span class=lnt id=hl-38-29><a class=lnlinks href=#hl-38-29>29</a>
</span><span class=lnt id=hl-38-30><a class=lnlinks href=#hl-38-30>30</a>
</span><span class=lnt id=hl-38-31><a class=lnlinks href=#hl-38-31>31</a>
</span><span class=lnt id=hl-38-32><a class=lnlinks href=#hl-38-32>32</a>
</span><span class=lnt id=hl-38-33><a class=lnlinks href=#hl-38-33>33</a>
</span><span class=lnt id=hl-38-34><a class=lnlinks href=#hl-38-34>34</a>
</span><span class=lnt id=hl-38-35><a class=lnlinks href=#hl-38-35>35</a>
</span><span class=lnt id=hl-38-36><a class=lnlinks href=#hl-38-36>36</a>
</span><span class=lnt id=hl-38-37><a class=lnlinks href=#hl-38-37>37</a>
</span><span class=lnt id=hl-38-38><a class=lnlinks href=#hl-38-38>38</a>
</span><span class=lnt id=hl-38-39><a class=lnlinks href=#hl-38-39>39</a>
</span><span class=lnt id=hl-38-40><a class=lnlinks href=#hl-38-40>40</a>
</span><span class=lnt id=hl-38-41><a class=lnlinks href=#hl-38-41>41</a>
</span><span class=lnt id=hl-38-42><a class=lnlinks href=#hl-38-42>42</a>
</span><span class=lnt id=hl-38-43><a class=lnlinks href=#hl-38-43>43</a>
</span><span class=lnt id=hl-38-44><a class=lnlinks href=#hl-38-44>44</a>
</span><span class=lnt id=hl-38-45><a class=lnlinks href=#hl-38-45>45</a>
</span><span class=lnt id=hl-38-46><a class=lnlinks href=#hl-38-46>46</a>
</span><span class=lnt id=hl-38-47><a class=lnlinks href=#hl-38-47>47</a>
</span><span class=lnt id=hl-38-48><a class=lnlinks href=#hl-38-48>48</a>
</span><span class=lnt id=hl-38-49><a class=lnlinks href=#hl-38-49>49</a>
</span><span class=lnt id=hl-38-50><a class=lnlinks href=#hl-38-50>50</a>
</span><span class=lnt id=hl-38-51><a class=lnlinks href=#hl-38-51>51</a>
</span><span class=lnt id=hl-38-52><a class=lnlinks href=#hl-38-52>52</a>
</span><span class=lnt id=hl-38-53><a class=lnlinks href=#hl-38-53>53</a>
</span><span class=lnt id=hl-38-54><a class=lnlinks href=#hl-38-54>54</a>
</span><span class=lnt id=hl-38-55><a class=lnlinks href=#hl-38-55>55</a>
</span><span class=lnt id=hl-38-56><a class=lnlinks href=#hl-38-56>56</a>
</span><span class=lnt id=hl-38-57><a class=lnlinks href=#hl-38-57>57</a>
</span><span class=lnt id=hl-38-58><a class=lnlinks href=#hl-38-58>58</a>
</span><span class=lnt id=hl-38-59><a class=lnlinks href=#hl-38-59>59</a>
</span><span class=lnt id=hl-38-60><a class=lnlinks href=#hl-38-60>60</a>
</span><span class=lnt id=hl-38-61><a class=lnlinks href=#hl-38-61>61</a>
</span><span class=lnt id=hl-38-62><a class=lnlinks href=#hl-38-62>62</a>
</span><span class=lnt id=hl-38-63><a class=lnlinks href=#hl-38-63>63</a>
</span><span class=lnt id=hl-38-64><a class=lnlinks href=#hl-38-64>64</a>
</span><span class=lnt id=hl-38-65><a class=lnlinks href=#hl-38-65>65</a>
</span><span class=lnt id=hl-38-66><a class=lnlinks href=#hl-38-66>66</a>
</span><span class=lnt id=hl-38-67><a class=lnlinks href=#hl-38-67>67</a>
</span><span class=lnt id=hl-38-68><a class=lnlinks href=#hl-38-68>68</a>
</span><span class=lnt id=hl-38-69><a class=lnlinks href=#hl-38-69>69</a>
</span><span class=lnt id=hl-38-70><a class=lnlinks href=#hl-38-70>70</a>
</span><span class=lnt id=hl-38-71><a class=lnlinks href=#hl-38-71>71</a>
</span><span class=lnt id=hl-38-72><a class=lnlinks href=#hl-38-72>72</a>
</span><span class=lnt id=hl-38-73><a class=lnlinks href=#hl-38-73>73</a>
</span><span class=lnt id=hl-38-74><a class=lnlinks href=#hl-38-74>74</a>
</span><span class=lnt id=hl-38-75><a class=lnlinks href=#hl-38-75>75</a>
</span><span class=lnt id=hl-38-76><a class=lnlinks href=#hl-38-76>76</a>
</span><span class=lnt id=hl-38-77><a class=lnlinks href=#hl-38-77>77</a>
</span><span class=lnt id=hl-38-78><a class=lnlinks href=#hl-38-78>78</a>
</span><span class=lnt id=hl-38-79><a class=lnlinks href=#hl-38-79>79</a>
</span><span class=lnt id=hl-38-80><a class=lnlinks href=#hl-38-80>80</a>
</span><span class=lnt id=hl-38-81><a class=lnlinks href=#hl-38-81>81</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// services/userService.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../logger&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>createUser</span><span class=p>(</span><span class=nx>userData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>requestId</span> <span class=o>=</span> <span class=nx>userData</span><span class=p>.</span><span class=nx>requestId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Creating new user&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=o>:</span> <span class=nx>userData</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;user_creation_started&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 사용자 생성 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>userData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;User created successfully&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>userId</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;user_creation_completed&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Failed to create user&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=o>:</span> <span class=nx>userData</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>stack</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>stack</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;user_creation_failed&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>loginUser</span><span class=p>(</span><span class=nx>email</span><span class=p>,</span> <span class=nx>password</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>requestId</span> <span class=o>=</span> <span class=nx>uuidv4</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;User login attempt&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;login_attempt&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findByEmail</span><span class=p>(</span><span class=nx>email</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span> <span class=o>||</span> <span class=o>!</span><span class=kr>await</span> <span class=nx>user</span><span class=p>.</span><span class=nx>verifyPassword</span><span class=p>(</span><span class=nx>password</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=s1>&#39;Invalid login credentials&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;login_failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>reason</span><span class=o>:</span> <span class=s1>&#39;invalid_credentials&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Invalid credentials&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;User logged in successfully&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>userId</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;login_success&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Login error&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;login_error&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes 에서 로그 수집 설정</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15>15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16>16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17>17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18>18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19>19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20>20</a>
</span><span class=lnt id=hl-39-21><a class=lnlinks href=#hl-39-21>21</a>
</span><span class=lnt id=hl-39-22><a class=lnlinks href=#hl-39-22>22</a>
</span><span class=lnt id=hl-39-23><a class=lnlinks href=#hl-39-23>23</a>
</span><span class=lnt id=hl-39-24><a class=lnlinks href=#hl-39-24>24</a>
</span><span class=lnt id=hl-39-25><a class=lnlinks href=#hl-39-25>25</a>
</span><span class=lnt id=hl-39-26><a class=lnlinks href=#hl-39-26>26</a>
</span><span class=lnt id=hl-39-27><a class=lnlinks href=#hl-39-27>27</a>
</span><span class=lnt id=hl-39-28><a class=lnlinks href=#hl-39-28>28</a>
</span><span class=lnt id=hl-39-29><a class=lnlinks href=#hl-39-29>29</a>
</span><span class=lnt id=hl-39-30><a class=lnlinks href=#hl-39-30>30</a>
</span><span class=lnt id=hl-39-31><a class=lnlinks href=#hl-39-31>31</a>
</span><span class=lnt id=hl-39-32><a class=lnlinks href=#hl-39-32>32</a>
</span><span class=lnt id=hl-39-33><a class=lnlinks href=#hl-39-33>33</a>
</span><span class=lnt id=hl-39-34><a class=lnlinks href=#hl-39-34>34</a>
</span><span class=lnt id=hl-39-35><a class=lnlinks href=#hl-39-35>35</a>
</span><span class=lnt id=hl-39-36><a class=lnlinks href=#hl-39-36>36</a>
</span><span class=lnt id=hl-39-37><a class=lnlinks href=#hl-39-37>37</a>
</span><span class=lnt id=hl-39-38><a class=lnlinks href=#hl-39-38>38</a>
</span><span class=lnt id=hl-39-39><a class=lnlinks href=#hl-39-39>39</a>
</span><span class=lnt id=hl-39-40><a class=lnlinks href=#hl-39-40>40</a>
</span><span class=lnt id=hl-39-41><a class=lnlinks href=#hl-39-41>41</a>
</span><span class=lnt id=hl-39-42><a class=lnlinks href=#hl-39-42>42</a>
</span><span class=lnt id=hl-39-43><a class=lnlinks href=#hl-39-43>43</a>
</span><span class=lnt id=hl-39-44><a class=lnlinks href=#hl-39-44>44</a>
</span><span class=lnt id=hl-39-45><a class=lnlinks href=#hl-39-45>45</a>
</span><span class=lnt id=hl-39-46><a class=lnlinks href=#hl-39-46>46</a>
</span><span class=lnt id=hl-39-47><a class=lnlinks href=#hl-39-47>47</a>
</span><span class=lnt id=hl-39-48><a class=lnlinks href=#hl-39-48>48</a>
</span><span class=lnt id=hl-39-49><a class=lnlinks href=#hl-39-49>49</a>
</span><span class=lnt id=hl-39-50><a class=lnlinks href=#hl-39-50>50</a>
</span><span class=lnt id=hl-39-51><a class=lnlinks href=#hl-39-51>51</a>
</span><span class=lnt id=hl-39-52><a class=lnlinks href=#hl-39-52>52</a>
</span><span class=lnt id=hl-39-53><a class=lnlinks href=#hl-39-53>53</a>
</span><span class=lnt id=hl-39-54><a class=lnlinks href=#hl-39-54>54</a>
</span><span class=lnt id=hl-39-55><a class=lnlinks href=#hl-39-55>55</a>
</span><span class=lnt id=hl-39-56><a class=lnlinks href=#hl-39-56>56</a>
</span><span class=lnt id=hl-39-57><a class=lnlinks href=#hl-39-57>57</a>
</span><span class=lnt id=hl-39-58><a class=lnlinks href=#hl-39-58>58</a>
</span><span class=lnt id=hl-39-59><a class=lnlinks href=#hl-39-59>59</a>
</span><span class=lnt id=hl-39-60><a class=lnlinks href=#hl-39-60>60</a>
</span><span class=lnt id=hl-39-61><a class=lnlinks href=#hl-39-61>61</a>
</span><span class=lnt id=hl-39-62><a class=lnlinks href=#hl-39-62>62</a>
</span><span class=lnt id=hl-39-63><a class=lnlinks href=#hl-39-63>63</a>
</span><span class=lnt id=hl-39-64><a class=lnlinks href=#hl-39-64>64</a>
</span><span class=lnt id=hl-39-65><a class=lnlinks href=#hl-39-65>65</a>
</span><span class=lnt id=hl-39-66><a class=lnlinks href=#hl-39-66>66</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># fluentd-configmap.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fluentd-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fluent.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 컨테이너 로그 수집
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;source&gt;
</span></span></span><span class=line><span class=cl><span class=sd>      @type tail
</span></span></span><span class=line><span class=cl><span class=sd>      path /var/log/containers/myapp-*.log
</span></span></span><span class=line><span class=cl><span class=sd>      pos_file /var/log/fluentd-containers.log.pos
</span></span></span><span class=line><span class=cl><span class=sd>      tag kubernetes.*
</span></span></span><span class=line><span class=cl><span class=sd>      format json
</span></span></span><span class=line><span class=cl><span class=sd>      read_from_head true
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;/source&gt;
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 로그 파싱 및 enrichment
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;filter kubernetes.**&gt;
</span></span></span><span class=line><span class=cl><span class=sd>      @type kubernetes_metadata
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;/filter&gt;
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 구조화된 로그 파싱
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;filter kubernetes.**&gt;
</span></span></span><span class=line><span class=cl><span class=sd>      @type parser
</span></span></span><span class=line><span class=cl><span class=sd>      key_name log
</span></span></span><span class=line><span class=cl><span class=sd>      reserve_data true
</span></span></span><span class=line><span class=cl><span class=sd>      &lt;parse&gt;
</span></span></span><span class=line><span class=cl><span class=sd>        @type json
</span></span></span><span class=line><span class=cl><span class=sd>      &lt;/parse&gt;
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;/filter&gt;
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # Elasticsearch로 전송
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;match kubernetes.**&gt;
</span></span></span><span class=line><span class=cl><span class=sd>      @type elasticsearch
</span></span></span><span class=line><span class=cl><span class=sd>      host elasticsearch.logging.svc.cluster.local
</span></span></span><span class=line><span class=cl><span class=sd>      port 9200
</span></span></span><span class=line><span class=cl><span class=sd>      index_name myapp-logs
</span></span></span><span class=line><span class=cl><span class=sd>      type_name _doc
</span></span></span><span class=line><span class=cl><span class=sd>      include_tag_key true
</span></span></span><span class=line><span class=cl><span class=sd>      tag_key @log_name
</span></span></span><span class=line><span class=cl><span class=sd>      flush_interval 1s
</span></span></span><span class=line><span class=cl><span class=sd>    &lt;/match&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 애플리케이션 배포 (로그 설정 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>LOG_LEVEL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;info&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;myapp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>APP_VERSION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># stdout/stderr 로그가 자동으로 수집됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 별도 볼륨 마운트 불필요</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Python 에서의 구조화된 로깅</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1> 1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2> 2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3> 3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4> 4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5> 5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6> 6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7> 7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8> 8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9> 9</a>
</span><span class=lnt id=hl-40-10><a class=lnlinks href=#hl-40-10>10</a>
</span><span class=lnt id=hl-40-11><a class=lnlinks href=#hl-40-11>11</a>
</span><span class=lnt id=hl-40-12><a class=lnlinks href=#hl-40-12>12</a>
</span><span class=lnt id=hl-40-13><a class=lnlinks href=#hl-40-13>13</a>
</span><span class=lnt id=hl-40-14><a class=lnlinks href=#hl-40-14>14</a>
</span><span class=lnt id=hl-40-15><a class=lnlinks href=#hl-40-15>15</a>
</span><span class=lnt id=hl-40-16><a class=lnlinks href=#hl-40-16>16</a>
</span><span class=lnt id=hl-40-17><a class=lnlinks href=#hl-40-17>17</a>
</span><span class=lnt id=hl-40-18><a class=lnlinks href=#hl-40-18>18</a>
</span><span class=lnt id=hl-40-19><a class=lnlinks href=#hl-40-19>19</a>
</span><span class=lnt id=hl-40-20><a class=lnlinks href=#hl-40-20>20</a>
</span><span class=lnt id=hl-40-21><a class=lnlinks href=#hl-40-21>21</a>
</span><span class=lnt id=hl-40-22><a class=lnlinks href=#hl-40-22>22</a>
</span><span class=lnt id=hl-40-23><a class=lnlinks href=#hl-40-23>23</a>
</span><span class=lnt id=hl-40-24><a class=lnlinks href=#hl-40-24>24</a>
</span><span class=lnt id=hl-40-25><a class=lnlinks href=#hl-40-25>25</a>
</span><span class=lnt id=hl-40-26><a class=lnlinks href=#hl-40-26>26</a>
</span><span class=lnt id=hl-40-27><a class=lnlinks href=#hl-40-27>27</a>
</span><span class=lnt id=hl-40-28><a class=lnlinks href=#hl-40-28>28</a>
</span><span class=lnt id=hl-40-29><a class=lnlinks href=#hl-40-29>29</a>
</span><span class=lnt id=hl-40-30><a class=lnlinks href=#hl-40-30>30</a>
</span><span class=lnt id=hl-40-31><a class=lnlinks href=#hl-40-31>31</a>
</span><span class=lnt id=hl-40-32><a class=lnlinks href=#hl-40-32>32</a>
</span><span class=lnt id=hl-40-33><a class=lnlinks href=#hl-40-33>33</a>
</span><span class=lnt id=hl-40-34><a class=lnlinks href=#hl-40-34>34</a>
</span><span class=lnt id=hl-40-35><a class=lnlinks href=#hl-40-35>35</a>
</span><span class=lnt id=hl-40-36><a class=lnlinks href=#hl-40-36>36</a>
</span><span class=lnt id=hl-40-37><a class=lnlinks href=#hl-40-37>37</a>
</span><span class=lnt id=hl-40-38><a class=lnlinks href=#hl-40-38>38</a>
</span><span class=lnt id=hl-40-39><a class=lnlinks href=#hl-40-39>39</a>
</span><span class=lnt id=hl-40-40><a class=lnlinks href=#hl-40-40>40</a>
</span><span class=lnt id=hl-40-41><a class=lnlinks href=#hl-40-41>41</a>
</span><span class=lnt id=hl-40-42><a class=lnlinks href=#hl-40-42>42</a>
</span><span class=lnt id=hl-40-43><a class=lnlinks href=#hl-40-43>43</a>
</span><span class=lnt id=hl-40-44><a class=lnlinks href=#hl-40-44>44</a>
</span><span class=lnt id=hl-40-45><a class=lnlinks href=#hl-40-45>45</a>
</span><span class=lnt id=hl-40-46><a class=lnlinks href=#hl-40-46>46</a>
</span><span class=lnt id=hl-40-47><a class=lnlinks href=#hl-40-47>47</a>
</span><span class=lnt id=hl-40-48><a class=lnlinks href=#hl-40-48>48</a>
</span><span class=lnt id=hl-40-49><a class=lnlinks href=#hl-40-49>49</a>
</span><span class=lnt id=hl-40-50><a class=lnlinks href=#hl-40-50>50</a>
</span><span class=lnt id=hl-40-51><a class=lnlinks href=#hl-40-51>51</a>
</span><span class=lnt id=hl-40-52><a class=lnlinks href=#hl-40-52>52</a>
</span><span class=lnt id=hl-40-53><a class=lnlinks href=#hl-40-53>53</a>
</span><span class=lnt id=hl-40-54><a class=lnlinks href=#hl-40-54>54</a>
</span><span class=lnt id=hl-40-55><a class=lnlinks href=#hl-40-55>55</a>
</span><span class=lnt id=hl-40-56><a class=lnlinks href=#hl-40-56>56</a>
</span><span class=lnt id=hl-40-57><a class=lnlinks href=#hl-40-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># logger.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>StructuredFormatter</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>format</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>record</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>log_entry</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;level&#39;</span><span class=p>:</span> <span class=n>record</span><span class=o>.</span><span class=n>levelname</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=n>record</span><span class=o>.</span><span class=n>getMessage</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;service&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;SERVICE_NAME&#39;</span><span class=p>,</span> <span class=s1>&#39;myapp&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;APP_VERSION&#39;</span><span class=p>,</span> <span class=s1>&#39;1.0.0&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;environment&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;ENVIRONMENT&#39;</span><span class=p>,</span> <span class=s1>&#39;development&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;pid&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getpid</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 추가 메타데이터가 있으면 포함</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>record</span><span class=p>,</span> <span class=s1>&#39;metadata&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>log_entry</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>record</span><span class=o>.</span><span class=n>metadata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 예외 정보가 있으면 포함</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>record</span><span class=o>.</span><span class=n>exc_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>log_entry</span><span class=p>[</span><span class=s1>&#39;exception&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>formatException</span><span class=p>(</span><span class=n>record</span><span class=o>.</span><span class=n>exc_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>log_entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 로거 설정</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;myapp&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;LOG_LEVEL&#39;</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>StreamHandler</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>StructuredFormatter</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log_with_metadata</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메타데이터와 함께 로그 출력&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>record</span> <span class=o>=</span> <span class=n>logger</span><span class=o>.</span><span class=n>makeRecord</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>level</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=p>(),</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>record</span><span class=o>.</span><span class=n>metadata</span> <span class=o>=</span> <span class=n>metadata</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>record</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 편의 함수들</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>info</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log_with_metadata</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>error</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log_with_metadata</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>warning</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log_with_metadata</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>WARNING</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>debug</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log_with_metadata</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>metadata</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Docker Compose 를 통한 로그 스택 구성</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10>10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11>11</a>
</span><span class=lnt id=hl-41-12><a class=lnlinks href=#hl-41-12>12</a>
</span><span class=lnt id=hl-41-13><a class=lnlinks href=#hl-41-13>13</a>
</span><span class=lnt id=hl-41-14><a class=lnlinks href=#hl-41-14>14</a>
</span><span class=lnt id=hl-41-15><a class=lnlinks href=#hl-41-15>15</a>
</span><span class=lnt id=hl-41-16><a class=lnlinks href=#hl-41-16>16</a>
</span><span class=lnt id=hl-41-17><a class=lnlinks href=#hl-41-17>17</a>
</span><span class=lnt id=hl-41-18><a class=lnlinks href=#hl-41-18>18</a>
</span><span class=lnt id=hl-41-19><a class=lnlinks href=#hl-41-19>19</a>
</span><span class=lnt id=hl-41-20><a class=lnlinks href=#hl-41-20>20</a>
</span><span class=lnt id=hl-41-21><a class=lnlinks href=#hl-41-21>21</a>
</span><span class=lnt id=hl-41-22><a class=lnlinks href=#hl-41-22>22</a>
</span><span class=lnt id=hl-41-23><a class=lnlinks href=#hl-41-23>23</a>
</span><span class=lnt id=hl-41-24><a class=lnlinks href=#hl-41-24>24</a>
</span><span class=lnt id=hl-41-25><a class=lnlinks href=#hl-41-25>25</a>
</span><span class=lnt id=hl-41-26><a class=lnlinks href=#hl-41-26>26</a>
</span><span class=lnt id=hl-41-27><a class=lnlinks href=#hl-41-27>27</a>
</span><span class=lnt id=hl-41-28><a class=lnlinks href=#hl-41-28>28</a>
</span><span class=lnt id=hl-41-29><a class=lnlinks href=#hl-41-29>29</a>
</span><span class=lnt id=hl-41-30><a class=lnlinks href=#hl-41-30>30</a>
</span><span class=lnt id=hl-41-31><a class=lnlinks href=#hl-41-31>31</a>
</span><span class=lnt id=hl-41-32><a class=lnlinks href=#hl-41-32>32</a>
</span><span class=lnt id=hl-41-33><a class=lnlinks href=#hl-41-33>33</a>
</span><span class=lnt id=hl-41-34><a class=lnlinks href=#hl-41-34>34</a>
</span><span class=lnt id=hl-41-35><a class=lnlinks href=#hl-41-35>35</a>
</span><span class=lnt id=hl-41-36><a class=lnlinks href=#hl-41-36>36</a>
</span><span class=lnt id=hl-41-37><a class=lnlinks href=#hl-41-37>37</a>
</span><span class=lnt id=hl-41-38><a class=lnlinks href=#hl-41-38>38</a>
</span><span class=lnt id=hl-41-39><a class=lnlinks href=#hl-41-39>39</a>
</span><span class=lnt id=hl-41-40><a class=lnlinks href=#hl-41-40>40</a>
</span><span class=lnt id=hl-41-41><a class=lnlinks href=#hl-41-41>41</a>
</span><span class=lnt id=hl-41-42><a class=lnlinks href=#hl-41-42>42</a>
</span><span class=lnt id=hl-41-43><a class=lnlinks href=#hl-41-43>43</a>
</span><span class=lnt id=hl-41-44><a class=lnlinks href=#hl-41-44>44</a>
</span><span class=lnt id=hl-41-45><a class=lnlinks href=#hl-41-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.logging.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>fluentd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>fluentd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>options</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fluentd-address</span><span class=p>:</span><span class=w> </span><span class=l>localhost:24224</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class=l>myapp.{{.ID}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fluentd</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>fluent/fluentd:v1.14-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;24224:24224&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./fluentd.conf:/fluentd/etc/fluent.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>elasticsearch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch:7.17.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>discovery.type=single-node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;ES_JAVA_OPTS=-Xms512m -Xmx512m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9200:9200&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>es_data:/usr/share/elasticsearch/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kibana</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kibana:7.17.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5601:5601&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ELASTICSEARCH_HOSTS</span><span class=p>:</span><span class=w> </span><span class=l>http://elasticsearch:9200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>es_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=admin-processes-관리-프로세스>Admin Processes (관리 프로세스)<a hidden class=anchor aria-hidden=true href=#admin-processes-관리-프로세스>#</a></h4><p><strong>원칙</strong>: 관리/유지보수 작업을 일회성 프로세스로 실행한다.<br><strong>설명</strong>: DB 마이그레이션, 데이터 초기화 등 관리 작업은 애플리케이션 코드베이스 내에서, 동일한 환경과 설정으로 일회성 프로세스로 실행한다. Kubernetes 에서는 Job, CronJob 등으로 관리한다.<br><strong>특징</strong>:</p><ul><li><p>관리 작업도 동일 코드/환경에서 실행</p></li><li><p>일회성 실행, 버전 관리</p></li><li><p>운영 자동화와 연계 가능<br><strong>실전 예시</strong>:</p></li><li><p>Node.js CLI 명령어 구현</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1> 1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2> 2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3> 3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4> 4</a>
</span><span class=lnt id=hl-42-5><a class=lnlinks href=#hl-42-5> 5</a>
</span><span class=lnt id=hl-42-6><a class=lnlinks href=#hl-42-6> 6</a>
</span><span class=lnt id=hl-42-7><a class=lnlinks href=#hl-42-7> 7</a>
</span><span class=lnt id=hl-42-8><a class=lnlinks href=#hl-42-8> 8</a>
</span><span class=lnt id=hl-42-9><a class=lnlinks href=#hl-42-9> 9</a>
</span><span class=lnt id=hl-42-10><a class=lnlinks href=#hl-42-10>10</a>
</span><span class=lnt id=hl-42-11><a class=lnlinks href=#hl-42-11>11</a>
</span><span class=lnt id=hl-42-12><a class=lnlinks href=#hl-42-12>12</a>
</span><span class=lnt id=hl-42-13><a class=lnlinks href=#hl-42-13>13</a>
</span><span class=lnt id=hl-42-14><a class=lnlinks href=#hl-42-14>14</a>
</span><span class=lnt id=hl-42-15><a class=lnlinks href=#hl-42-15>15</a>
</span><span class=lnt id=hl-42-16><a class=lnlinks href=#hl-42-16>16</a>
</span><span class=lnt id=hl-42-17><a class=lnlinks href=#hl-42-17>17</a>
</span><span class=lnt id=hl-42-18><a class=lnlinks href=#hl-42-18>18</a>
</span><span class=lnt id=hl-42-19><a class=lnlinks href=#hl-42-19>19</a>
</span><span class=lnt id=hl-42-20><a class=lnlinks href=#hl-42-20>20</a>
</span><span class=lnt id=hl-42-21><a class=lnlinks href=#hl-42-21>21</a>
</span><span class=lnt id=hl-42-22><a class=lnlinks href=#hl-42-22>22</a>
</span><span class=lnt id=hl-42-23><a class=lnlinks href=#hl-42-23>23</a>
</span><span class=lnt id=hl-42-24><a class=lnlinks href=#hl-42-24>24</a>
</span><span class=lnt id=hl-42-25><a class=lnlinks href=#hl-42-25>25</a>
</span><span class=lnt id=hl-42-26><a class=lnlinks href=#hl-42-26>26</a>
</span><span class=lnt id=hl-42-27><a class=lnlinks href=#hl-42-27>27</a>
</span><span class=lnt id=hl-42-28><a class=lnlinks href=#hl-42-28>28</a>
</span><span class=lnt id=hl-42-29><a class=lnlinks href=#hl-42-29>29</a>
</span><span class=lnt id=hl-42-30><a class=lnlinks href=#hl-42-30>30</a>
</span><span class=lnt id=hl-42-31><a class=lnlinks href=#hl-42-31>31</a>
</span><span class=lnt id=hl-42-32><a class=lnlinks href=#hl-42-32>32</a>
</span><span class=lnt id=hl-42-33><a class=lnlinks href=#hl-42-33>33</a>
</span><span class=lnt id=hl-42-34><a class=lnlinks href=#hl-42-34>34</a>
</span><span class=lnt id=hl-42-35><a class=lnlinks href=#hl-42-35>35</a>
</span><span class=lnt id=hl-42-36><a class=lnlinks href=#hl-42-36>36</a>
</span><span class=lnt id=hl-42-37><a class=lnlinks href=#hl-42-37>37</a>
</span><span class=lnt id=hl-42-38><a class=lnlinks href=#hl-42-38>38</a>
</span><span class=lnt id=hl-42-39><a class=lnlinks href=#hl-42-39>39</a>
</span><span class=lnt id=hl-42-40><a class=lnlinks href=#hl-42-40>40</a>
</span><span class=lnt id=hl-42-41><a class=lnlinks href=#hl-42-41>41</a>
</span><span class=lnt id=hl-42-42><a class=lnlinks href=#hl-42-42>42</a>
</span><span class=lnt id=hl-42-43><a class=lnlinks href=#hl-42-43>43</a>
</span><span class=lnt id=hl-42-44><a class=lnlinks href=#hl-42-44>44</a>
</span><span class=lnt id=hl-42-45><a class=lnlinks href=#hl-42-45>45</a>
</span><span class=lnt id=hl-42-46><a class=lnlinks href=#hl-42-46>46</a>
</span><span class=lnt id=hl-42-47><a class=lnlinks href=#hl-42-47>47</a>
</span><span class=lnt id=hl-42-48><a class=lnlinks href=#hl-42-48>48</a>
</span><span class=lnt id=hl-42-49><a class=lnlinks href=#hl-42-49>49</a>
</span><span class=lnt id=hl-42-50><a class=lnlinks href=#hl-42-50>50</a>
</span><span class=lnt id=hl-42-51><a class=lnlinks href=#hl-42-51>51</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// scripts/migrate.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>sequelize</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../models&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../logger&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>runMigrations</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Starting database migrations&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;migration_started&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>environment</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Sequelize 마이그레이션 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>sequelize</span><span class=p>.</span><span class=nx>getQueryInterface</span><span class=p>().</span><span class=nx>showAllTables</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자 정의 마이그레이션 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>[</span><span class=nx>results</span><span class=p>,</span> <span class=nx>metadata</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>sequelize</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>      SELECT table_name 
</span></span></span><span class=line><span class=cl><span class=sb>      FROM information_schema.tables 
</span></span></span><span class=line><span class=cl><span class=sb>      WHERE table_schema = &#39;public&#39;
</span></span></span><span class=line><span class=cl><span class=sb>    `</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Current tables&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;migration_check&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>tables</span><span class=o>:</span> <span class=nx>results</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>r</span><span class=p>.</span><span class=nx>table_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 실제 마이그레이션 실행 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>sequelize</span><span class=p>.</span><span class=nx>sync</span><span class=p>({</span> <span class=nx>force</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Database migrations completed successfully&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;migration_completed&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Migration failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;migration_failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>stack</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>stack</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>sequelize</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// CLI에서 직접 실행 시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>require</span><span class=p>.</span><span class=nx>main</span> <span class=o>===</span> <span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>runMigrations</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>runMigrations</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>데이터 시딩 스크립트</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1> 1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2> 2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3> 3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4> 4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5> 5</a>
</span><span class=lnt id=hl-43-6><a class=lnlinks href=#hl-43-6> 6</a>
</span><span class=lnt id=hl-43-7><a class=lnlinks href=#hl-43-7> 7</a>
</span><span class=lnt id=hl-43-8><a class=lnlinks href=#hl-43-8> 8</a>
</span><span class=lnt id=hl-43-9><a class=lnlinks href=#hl-43-9> 9</a>
</span><span class=lnt id=hl-43-10><a class=lnlinks href=#hl-43-10>10</a>
</span><span class=lnt id=hl-43-11><a class=lnlinks href=#hl-43-11>11</a>
</span><span class=lnt id=hl-43-12><a class=lnlinks href=#hl-43-12>12</a>
</span><span class=lnt id=hl-43-13><a class=lnlinks href=#hl-43-13>13</a>
</span><span class=lnt id=hl-43-14><a class=lnlinks href=#hl-43-14>14</a>
</span><span class=lnt id=hl-43-15><a class=lnlinks href=#hl-43-15>15</a>
</span><span class=lnt id=hl-43-16><a class=lnlinks href=#hl-43-16>16</a>
</span><span class=lnt id=hl-43-17><a class=lnlinks href=#hl-43-17>17</a>
</span><span class=lnt id=hl-43-18><a class=lnlinks href=#hl-43-18>18</a>
</span><span class=lnt id=hl-43-19><a class=lnlinks href=#hl-43-19>19</a>
</span><span class=lnt id=hl-43-20><a class=lnlinks href=#hl-43-20>20</a>
</span><span class=lnt id=hl-43-21><a class=lnlinks href=#hl-43-21>21</a>
</span><span class=lnt id=hl-43-22><a class=lnlinks href=#hl-43-22>22</a>
</span><span class=lnt id=hl-43-23><a class=lnlinks href=#hl-43-23>23</a>
</span><span class=lnt id=hl-43-24><a class=lnlinks href=#hl-43-24>24</a>
</span><span class=lnt id=hl-43-25><a class=lnlinks href=#hl-43-25>25</a>
</span><span class=lnt id=hl-43-26><a class=lnlinks href=#hl-43-26>26</a>
</span><span class=lnt id=hl-43-27><a class=lnlinks href=#hl-43-27>27</a>
</span><span class=lnt id=hl-43-28><a class=lnlinks href=#hl-43-28>28</a>
</span><span class=lnt id=hl-43-29><a class=lnlinks href=#hl-43-29>29</a>
</span><span class=lnt id=hl-43-30><a class=lnlinks href=#hl-43-30>30</a>
</span><span class=lnt id=hl-43-31><a class=lnlinks href=#hl-43-31>31</a>
</span><span class=lnt id=hl-43-32><a class=lnlinks href=#hl-43-32>32</a>
</span><span class=lnt id=hl-43-33><a class=lnlinks href=#hl-43-33>33</a>
</span><span class=lnt id=hl-43-34><a class=lnlinks href=#hl-43-34>34</a>
</span><span class=lnt id=hl-43-35><a class=lnlinks href=#hl-43-35>35</a>
</span><span class=lnt id=hl-43-36><a class=lnlinks href=#hl-43-36>36</a>
</span><span class=lnt id=hl-43-37><a class=lnlinks href=#hl-43-37>37</a>
</span><span class=lnt id=hl-43-38><a class=lnlinks href=#hl-43-38>38</a>
</span><span class=lnt id=hl-43-39><a class=lnlinks href=#hl-43-39>39</a>
</span><span class=lnt id=hl-43-40><a class=lnlinks href=#hl-43-40>40</a>
</span><span class=lnt id=hl-43-41><a class=lnlinks href=#hl-43-41>41</a>
</span><span class=lnt id=hl-43-42><a class=lnlinks href=#hl-43-42>42</a>
</span><span class=lnt id=hl-43-43><a class=lnlinks href=#hl-43-43>43</a>
</span><span class=lnt id=hl-43-44><a class=lnlinks href=#hl-43-44>44</a>
</span><span class=lnt id=hl-43-45><a class=lnlinks href=#hl-43-45>45</a>
</span><span class=lnt id=hl-43-46><a class=lnlinks href=#hl-43-46>46</a>
</span><span class=lnt id=hl-43-47><a class=lnlinks href=#hl-43-47>47</a>
</span><span class=lnt id=hl-43-48><a class=lnlinks href=#hl-43-48>48</a>
</span><span class=lnt id=hl-43-49><a class=lnlinks href=#hl-43-49>49</a>
</span><span class=lnt id=hl-43-50><a class=lnlinks href=#hl-43-50>50</a>
</span><span class=lnt id=hl-43-51><a class=lnlinks href=#hl-43-51>51</a>
</span><span class=lnt id=hl-43-52><a class=lnlinks href=#hl-43-52>52</a>
</span><span class=lnt id=hl-43-53><a class=lnlinks href=#hl-43-53>53</a>
</span><span class=lnt id=hl-43-54><a class=lnlinks href=#hl-43-54>54</a>
</span><span class=lnt id=hl-43-55><a class=lnlinks href=#hl-43-55>55</a>
</span><span class=lnt id=hl-43-56><a class=lnlinks href=#hl-43-56>56</a>
</span><span class=lnt id=hl-43-57><a class=lnlinks href=#hl-43-57>57</a>
</span><span class=lnt id=hl-43-58><a class=lnlinks href=#hl-43-58>58</a>
</span><span class=lnt id=hl-43-59><a class=lnlinks href=#hl-43-59>59</a>
</span><span class=lnt id=hl-43-60><a class=lnlinks href=#hl-43-60>60</a>
</span><span class=lnt id=hl-43-61><a class=lnlinks href=#hl-43-61>61</a>
</span><span class=lnt id=hl-43-62><a class=lnlinks href=#hl-43-62>62</a>
</span><span class=lnt id=hl-43-63><a class=lnlinks href=#hl-43-63>63</a>
</span><span class=lnt id=hl-43-64><a class=lnlinks href=#hl-43-64>64</a>
</span><span class=lnt id=hl-43-65><a class=lnlinks href=#hl-43-65>65</a>
</span><span class=lnt id=hl-43-66><a class=lnlinks href=#hl-43-66>66</a>
</span><span class=lnt id=hl-43-67><a class=lnlinks href=#hl-43-67>67</a>
</span><span class=lnt id=hl-43-68><a class=lnlinks href=#hl-43-68>68</a>
</span><span class=lnt id=hl-43-69><a class=lnlinks href=#hl-43-69>69</a>
</span><span class=lnt id=hl-43-70><a class=lnlinks href=#hl-43-70>70</a>
</span><span class=lnt id=hl-43-71><a class=lnlinks href=#hl-43-71>71</a>
</span><span class=lnt id=hl-43-72><a class=lnlinks href=#hl-43-72>72</a>
</span><span class=lnt id=hl-43-73><a class=lnlinks href=#hl-43-73>73</a>
</span><span class=lnt id=hl-43-74><a class=lnlinks href=#hl-43-74>74</a>
</span><span class=lnt id=hl-43-75><a class=lnlinks href=#hl-43-75>75</a>
</span><span class=lnt id=hl-43-76><a class=lnlinks href=#hl-43-76>76</a>
</span><span class=lnt id=hl-43-77><a class=lnlinks href=#hl-43-77>77</a>
</span><span class=lnt id=hl-43-78><a class=lnlinks href=#hl-43-78>78</a>
</span><span class=lnt id=hl-43-79><a class=lnlinks href=#hl-43-79>79</a>
</span><span class=lnt id=hl-43-80><a class=lnlinks href=#hl-43-80>80</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// scripts/seed.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>User</span><span class=p>,</span> <span class=nx>Product</span><span class=p>,</span> <span class=nx>Category</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../models&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../logger&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>seedDatabase</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>seedId</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Starting database seeding&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;seed_started&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>seedId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>environment</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 카테고리 시드 데이터
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>categories</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>Category</span><span class=p>.</span><span class=nx>bulkCreate</span><span class=p>([</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Electronics&#39;</span><span class=p>,</span> <span class=nx>slug</span><span class=o>:</span> <span class=s1>&#39;electronics&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Books&#39;</span><span class=p>,</span> <span class=nx>slug</span><span class=o>:</span> <span class=s1>&#39;books&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Clothing&#39;</span><span class=p>,</span> <span class=nx>slug</span><span class=o>:</span> <span class=s1>&#39;clothing&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span> <span class=p>{</span> <span class=nx>ignoreDuplicates</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Categories seeded&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;categories_seeded&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>seedId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>:</span> <span class=nx>categories</span><span class=p>.</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 관리자 사용자 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>adminUser</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findOrCreate</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;admin@example.com&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>defaults</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>username</span><span class=o>:</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;admin@example.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>password</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>ADMIN_PASSWORD</span> <span class=o>||</span> <span class=s1>&#39;defaultpassword&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Admin user created/found&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;admin_user_seeded&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>seedId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>userId</span><span class=o>:</span> <span class=nx>adminUser</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>created</span><span class=o>:</span> <span class=nx>adminUser</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 환경별 다른 시드 데이터
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;development&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>testUsers</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>bulkCreate</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=s1>&#39;testuser1&#39;</span><span class=p>,</span> <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;test1@example.com&#39;</span><span class=p>,</span> <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;user&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=s1>&#39;testuser2&#39;</span><span class=p>,</span> <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;test2@example.com&#39;</span><span class=p>,</span> <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;user&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span> <span class=p>{</span> <span class=nx>ignoreDuplicates</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Test users created&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;test_users_seeded&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>seedId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>count</span><span class=o>:</span> <span class=nx>testUsers</span><span class=p>.</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Database seeding completed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;seed_completed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>seedId</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Seeding failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>action</span><span class=o>:</span> <span class=s1>&#39;seed_failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>seedId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>stack</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>stack</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>require</span><span class=p>.</span><span class=nx>main</span> <span class=o>===</span> <span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>seedDatabase</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>seedDatabase</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>package.json 에 스크립트 등록</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1> 1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2> 2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3> 3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4> 4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5> 5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6> 6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7> 7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8> 8</a>
</span><span class=lnt id=hl-44-9><a class=lnlinks href=#hl-44-9> 9</a>
</span><span class=lnt id=hl-44-10><a class=lnlinks href=#hl-44-10>10</a>
</span><span class=lnt id=hl-44-11><a class=lnlinks href=#hl-44-11>11</a>
</span><span class=lnt id=hl-44-12><a class=lnlinks href=#hl-44-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;myapp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node server.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;nodemon server.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;migrate&#34;</span><span class=p>:</span> <span class=s2>&#34;node scripts/migrate.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;seed&#34;</span><span class=p>:</span> <span class=s2>&#34;node scripts/seed.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;admin:create-user&#34;</span><span class=p>:</span> <span class=s2>&#34;node scripts/createAdminUser.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;admin:cleanup&#34;</span><span class=p>:</span> <span class=s2>&#34;node scripts/cleanup.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;admin:backup&#34;</span><span class=p>:</span> <span class=s2>&#34;node scripts/backup.js&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Kubernetes Job 을 통한 관리 프로세스 실행</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1> 1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2> 2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3> 3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4> 4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5> 5</a>
</span><span class=lnt id=hl-45-6><a class=lnlinks href=#hl-45-6> 6</a>
</span><span class=lnt id=hl-45-7><a class=lnlinks href=#hl-45-7> 7</a>
</span><span class=lnt id=hl-45-8><a class=lnlinks href=#hl-45-8> 8</a>
</span><span class=lnt id=hl-45-9><a class=lnlinks href=#hl-45-9> 9</a>
</span><span class=lnt id=hl-45-10><a class=lnlinks href=#hl-45-10>10</a>
</span><span class=lnt id=hl-45-11><a class=lnlinks href=#hl-45-11>11</a>
</span><span class=lnt id=hl-45-12><a class=lnlinks href=#hl-45-12>12</a>
</span><span class=lnt id=hl-45-13><a class=lnlinks href=#hl-45-13>13</a>
</span><span class=lnt id=hl-45-14><a class=lnlinks href=#hl-45-14>14</a>
</span><span class=lnt id=hl-45-15><a class=lnlinks href=#hl-45-15>15</a>
</span><span class=lnt id=hl-45-16><a class=lnlinks href=#hl-45-16>16</a>
</span><span class=lnt id=hl-45-17><a class=lnlinks href=#hl-45-17>17</a>
</span><span class=lnt id=hl-45-18><a class=lnlinks href=#hl-45-18>18</a>
</span><span class=lnt id=hl-45-19><a class=lnlinks href=#hl-45-19>19</a>
</span><span class=lnt id=hl-45-20><a class=lnlinks href=#hl-45-20>20</a>
</span><span class=lnt id=hl-45-21><a class=lnlinks href=#hl-45-21>21</a>
</span><span class=lnt id=hl-45-22><a class=lnlinks href=#hl-45-22>22</a>
</span><span class=lnt id=hl-45-23><a class=lnlinks href=#hl-45-23>23</a>
</span><span class=lnt id=hl-45-24><a class=lnlinks href=#hl-45-24>24</a>
</span><span class=lnt id=hl-45-25><a class=lnlinks href=#hl-45-25>25</a>
</span><span class=lnt id=hl-45-26><a class=lnlinks href=#hl-45-26>26</a>
</span><span class=lnt id=hl-45-27><a class=lnlinks href=#hl-45-27>27</a>
</span><span class=lnt id=hl-45-28><a class=lnlinks href=#hl-45-28>28</a>
</span><span class=lnt id=hl-45-29><a class=lnlinks href=#hl-45-29>29</a>
</span><span class=lnt id=hl-45-30><a class=lnlinks href=#hl-45-30>30</a>
</span><span class=lnt id=hl-45-31><a class=lnlinks href=#hl-45-31>31</a>
</span><span class=lnt id=hl-45-32><a class=lnlinks href=#hl-45-32>32</a>
</span><span class=lnt id=hl-45-33><a class=lnlinks href=#hl-45-33>33</a>
</span><span class=lnt id=hl-45-34><a class=lnlinks href=#hl-45-34>34</a>
</span><span class=lnt id=hl-45-35><a class=lnlinks href=#hl-45-35>35</a>
</span><span class=lnt id=hl-45-36><a class=lnlinks href=#hl-45-36>36</a>
</span><span class=lnt id=hl-45-37><a class=lnlinks href=#hl-45-37>37</a>
</span><span class=lnt id=hl-45-38><a class=lnlinks href=#hl-45-38>38</a>
</span><span class=lnt id=hl-45-39><a class=lnlinks href=#hl-45-39>39</a>
</span><span class=lnt id=hl-45-40><a class=lnlinks href=#hl-45-40>40</a>
</span><span class=lnt id=hl-45-41><a class=lnlinks href=#hl-45-41>41</a>
</span><span class=lnt id=hl-45-42><a class=lnlinks href=#hl-45-42>42</a>
</span><span class=lnt id=hl-45-43><a class=lnlinks href=#hl-45-43>43</a>
</span><span class=lnt id=hl-45-44><a class=lnlinks href=#hl-45-44>44</a>
</span><span class=lnt id=hl-45-45><a class=lnlinks href=#hl-45-45>45</a>
</span><span class=lnt id=hl-45-46><a class=lnlinks href=#hl-45-46>46</a>
</span><span class=lnt id=hl-45-47><a class=lnlinks href=#hl-45-47>47</a>
</span><span class=lnt id=hl-45-48><a class=lnlinks href=#hl-45-48>48</a>
</span><span class=lnt id=hl-45-49><a class=lnlinks href=#hl-45-49>49</a>
</span><span class=lnt id=hl-45-50><a class=lnlinks href=#hl-45-50>50</a>
</span><span class=lnt id=hl-45-51><a class=lnlinks href=#hl-45-51>51</a>
</span><span class=lnt id=hl-45-52><a class=lnlinks href=#hl-45-52>52</a>
</span><span class=lnt id=hl-45-53><a class=lnlinks href=#hl-45-53>53</a>
</span><span class=lnt id=hl-45-54><a class=lnlinks href=#hl-45-54>54</a>
</span><span class=lnt id=hl-45-55><a class=lnlinks href=#hl-45-55>55</a>
</span><span class=lnt id=hl-45-56><a class=lnlinks href=#hl-45-56>56</a>
</span><span class=lnt id=hl-45-57><a class=lnlinks href=#hl-45-57>57</a>
</span><span class=lnt id=hl-45-58><a class=lnlinks href=#hl-45-58>58</a>
</span><span class=lnt id=hl-45-59><a class=lnlinks href=#hl-45-59>59</a>
</span><span class=lnt id=hl-45-60><a class=lnlinks href=#hl-45-60>60</a>
</span><span class=lnt id=hl-45-61><a class=lnlinks href=#hl-45-61>61</a>
</span><span class=lnt id=hl-45-62><a class=lnlinks href=#hl-45-62>62</a>
</span><span class=lnt id=hl-45-63><a class=lnlinks href=#hl-45-63>63</a>
</span><span class=lnt id=hl-45-64><a class=lnlinks href=#hl-45-64>64</a>
</span><span class=lnt id=hl-45-65><a class=lnlinks href=#hl-45-65>65</a>
</span><span class=lnt id=hl-45-66><a class=lnlinks href=#hl-45-66>66</a>
</span><span class=lnt id=hl-45-67><a class=lnlinks href=#hl-45-67>67</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># jobs/migration-job.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>job-type</span><span class=p>:</span><span class=w> </span><span class=l>migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>job-type</span><span class=p>:</span><span class=w> </span><span class=l>migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;migrate&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_ENV</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;production&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;128Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backoffLimit</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># jobs/seed-job.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-seed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>job-type</span><span class=p>:</span><span class=w> </span><span class=l>seed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>seed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;seed&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_ENV</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;production&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>DATABASE_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ADMIN_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-secrets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>ADMIN_PASSWORD</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Helm Hook 을 통한 자동 관리 프로세스</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1> 1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2> 2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3> 3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4> 4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5> 5</a>
</span><span class=lnt id=hl-46-6><a class=lnlinks href=#hl-46-6> 6</a>
</span><span class=lnt id=hl-46-7><a class=lnlinks href=#hl-46-7> 7</a>
</span><span class=lnt id=hl-46-8><a class=lnlinks href=#hl-46-8> 8</a>
</span><span class=lnt id=hl-46-9><a class=lnlinks href=#hl-46-9> 9</a>
</span><span class=lnt id=hl-46-10><a class=lnlinks href=#hl-46-10>10</a>
</span><span class=lnt id=hl-46-11><a class=lnlinks href=#hl-46-11>11</a>
</span><span class=lnt id=hl-46-12><a class=lnlinks href=#hl-46-12>12</a>
</span><span class=lnt id=hl-46-13><a class=lnlinks href=#hl-46-13>13</a>
</span><span class=lnt id=hl-46-14><a class=lnlinks href=#hl-46-14>14</a>
</span><span class=lnt id=hl-46-15><a class=lnlinks href=#hl-46-15>15</a>
</span><span class=lnt id=hl-46-16><a class=lnlinks href=#hl-46-16>16</a>
</span><span class=lnt id=hl-46-17><a class=lnlinks href=#hl-46-17>17</a>
</span><span class=lnt id=hl-46-18><a class=lnlinks href=#hl-46-18>18</a>
</span><span class=lnt id=hl-46-19><a class=lnlinks href=#hl-46-19>19</a>
</span><span class=lnt id=hl-46-20><a class=lnlinks href=#hl-46-20>20</a>
</span><span class=lnt id=hl-46-21><a class=lnlinks href=#hl-46-21>21</a>
</span><span class=lnt id=hl-46-22><a class=lnlinks href=#hl-46-22>22</a>
</span><span class=lnt id=hl-46-23><a class=lnlinks href=#hl-46-23>23</a>
</span><span class=lnt id=hl-46-24><a class=lnlinks href=#hl-46-24>24</a>
</span><span class=lnt id=hl-46-25><a class=lnlinks href=#hl-46-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># templates/migration-hook.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>include &#34;myapp.fullname&#34; . }}-migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;helm.sh/hook&#34;: </span><span class=l>pre-install,pre-upgrade</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;helm.sh/hook-weight&#34;: </span><span class=s2>&#34;-5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;helm.sh/hook-delete-policy&#34;: </span><span class=l>before-hook-creation,hook-succeeded</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>migration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ .Values.image.repository }}:{{ .Values.image.tag }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;migrate&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>{{<span class=l>range $key, $value := .Values.env }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>$key }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>$value | quote }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>{{<span class=l>end }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>envFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>include &#34;myapp.fullname&#34; . }}-secrets</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=12-factor-app-원칙별-dockerkubernetes-적용-사례>12-Factor App 원칙별 Docker/Kubernetes 적용 사례<a hidden class=anchor aria-hidden=true href=#12-factor-app-원칙별-dockerkubernetes-적용-사례>#</a></h3><table><thead><tr><th>원칙 번호</th><th>항목</th><th>실전 예제</th><th>Docker/Kubernetes 적용 사례</th></tr></thead><tbody><tr><td>1</td><td>코드베이스 (Codebase)</td><td>Git 리포지토리 1 개로 운영/스테이징/개발 환경 각각 배포 예: <code>main</code>, <code>staging</code>, <code>dev</code> 브랜치 분리</td><td>GitOps 기반 ArgoCD 사용, <code>values-dev.yaml</code>, <code>values-prod.yaml</code> 등 Helm Chart 활용</td></tr><tr><td>2</td><td>의존성 (Dependencies)</td><td>Python <code>requirements.txt</code>, Node.js <code>package.json</code> 등 명시적 관리</td><td>Dockerfile 내에서 <code>pip install</code>, <code>npm install</code> 등 명확한 설치 명령 포함</td></tr><tr><td>3</td><td>설정 (Config)</td><td><code>.env</code> 파일로 환경 변수 설정, <code>DATABASE_URL</code>, <code>REDIS_URL</code> 등</td><td>Kubernetes <code>ConfigMap</code>, <code>Secret</code> 활용 후 <code>envFrom</code>, <code>valueFrom</code> 로 주입</td></tr><tr><td>4</td><td>지원 서비스 (Backing Services)</td><td>PostgreSQL, Redis, RabbitMQ 를 외부 서비스로 구성</td><td>PostgreSQL/Redis 를 외부 Helm chart 또는 RDS/ElastiCache 로 구성하고 <code>env</code> 로 주소 주입</td></tr><tr><td>5</td><td>빌드/릴리즈/실행</td><td>빌드: <code>docker build</code>, 릴리즈: <code>docker tag</code>, 실행: <code>docker run</code> 또는 <code>kubectl apply</code></td><td>CI 파이프라인에서 Build → Push → Deploy 분리, GitLab CI + Helm Release 분리 적용</td></tr><tr><td>6</td><td>프로세스 (Processes)</td><td>Flask 앱은 상태 없이 요청 처리, 상태 정보는 Redis 에 저장</td><td>앱 컨테이너는 무상태로 구성, 세션 및 상태 관리는 외부 Redis/Kafka 로 위임</td></tr><tr><td>7</td><td>포트 바인딩 (Port Binding)</td><td>Express 앱이 3000 포트를 리스닝하고, 외부에 해당 포트를 오픈</td><td>Dockerfile: <code>EXPOSE 3000</code> / K8s Deployment → Service → Ingress 구성</td></tr><tr><td>8</td><td>동시성 (Concurrency)</td><td>Gunicorn 의 <code>--workers</code> 옵션으로 다중 프로세스 실행</td><td>Kubernetes HorizontalPodAutoscaler(HPA) 로 Pod 수 자동 확장</td></tr><tr><td>9</td><td>폐기성 (Disposability)</td><td>앱이 SIGTERM 시 빠르게 shutdown 하며 커넥션 정리</td><td><code>preStop</code> hook 사용, <code>readinessProbe</code> 로 트래픽 차단 후 종료 처리</td></tr><tr><td>10</td><td>환경 일치 (Dev/Prod Parity)</td><td>Docker 로 dev/stage/prod 동일한 컨테이너 이미지 사용</td><td>CI 파이프라인에서 동일 이미지 사용, <code>values.yaml</code> 로 환경 차이만 관리</td></tr><tr><td>11</td><td>로그 (Logs)</td><td>애플리케이션 로그를 stdout 으로 출력 → <code>docker logs</code> or Fluent Bit 수집</td><td>Kubernetes Pod 로그 → Fluentd/Fluent Bit → Elasticsearch → Kibana 로 연계</td></tr><tr><td>12</td><td>관리자 프로세스 (Admin Processes)</td><td><code>python manage.py migrate</code> 또는 <code>node seed.js</code> 명령 수행</td><td>K8s Job 리소스 또는 CI Job 으로 <code>kubectl exec</code> 또는 Helm hook 사용</td></tr></tbody></table><h3 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><p>12-Factor App 의 작동 원리는 무상태 프로세스 컬렉션으로서 애플리케이션을 실행하는 것이다. 다음 다이어그램은 전체적인 작동 원리를 보여준다:</p><pre class=mermaid>graph TB
    subgraph &#34;Development Environment&#34;
        A[Source Code Repository]
        B[Dependency Manager]
        C[Local Config]
    end
    
    subgraph &#34;CI/CD Pipeline&#34;
        D[Build Stage]
        E[Test Stage]
        F[Release Stage]
    end
    
    subgraph &#34;Runtime Environment&#34;
        G[Load Balancer]
        H[App Process 1]
        I[App Process 2]
        J[App Process N]
    end
    
    subgraph &#34;Backing Services&#34;
        K[(Database)]
        L[Message Queue]
        M[Cache]
        N[External APIs]
    end
    
    subgraph &#34;Infrastructure Services&#34;
        O[Config Management]
        P[Log Aggregation]
        Q[Monitoring]
    end
    
    A --&gt; D
    B --&gt; D
    D --&gt; E
    E --&gt; F
    F --&gt; G
    G --&gt; H
    G --&gt; I
    G --&gt; J
    
    H --&gt; K
    H --&gt; L
    H --&gt; M
    H --&gt; N
    I --&gt; K
    I --&gt; L
    I --&gt; M
    I --&gt; N
    J --&gt; K
    J --&gt; L
    J --&gt; M
    J --&gt; N
    
    O --&gt; H
    O --&gt; I
    O --&gt; J
    
    H --&gt; P
    I --&gt; P
    J --&gt; P
    
    Q --&gt; H
    Q --&gt; I
    Q --&gt; J
</pre><h4 id=핵심-작동-원리>핵심 작동 원리<a hidden class=anchor aria-hidden=true href=#핵심-작동-원리>#</a></h4><ol><li><strong>빌드 - 릴리스 - 실행 분리</strong>: 빌드 단계에서는 소스 코드에서 실행 가능한 번들 생성, 릴리스 단계에서는 빌드와 구성 결합, 실행 단계에서는 선택된 릴리스를 런타임 환경에서 실행한다.</li><li><strong>무상태 프로세스</strong>: 각 프로세스는 독립적으로 작동하며, 다른 프로세스의 상태를 추적하지 않는다. 이를 통해 확장이 용이해진다.</li><li><strong>포트 바인딩</strong>: 애플리케이션은 포트 번호로 네트워크에서 식별되며, 도메인 이름이 아닌 포트를 통해 서비스를 내보낸다.</li></ol><h3 id=12-factor-app-구현을-위한-실전-설계-및-운영-기법>12-Factor App 구현을 위한 실전 설계 및 운영 기법<a hidden class=anchor aria-hidden=true href=#12-factor-app-구현을-위한-실전-설계-및-운영-기법>#</a></h3><table><thead><tr><th>구현 전략</th><th>정의</th><th>구성</th><th>목적</th><th>실제 예시</th></tr></thead><tbody><tr><td>코드베이스 통합</td><td>하나의 애플리케이션에 대해 하나의 코드베이스를 버전 관리</td><td>Git 저장소, 브랜칭 전략 (Git Flow), 태그 관리</td><td>코드 일관성과 협업 효율성 확보</td><td>GitLab 사용, feature 브랜치 작업 후 main 병합</td></tr><tr><td>컨테이너 기반 배포</td><td>Docker 컨테이너를 이용한 패키징 및 배포 방식</td><td>Dockerfile, 이미지 레지스트리 (Harbor), 컨테이너 런타임 (Kubernetes)</td><td>환경 간 일관성과 이식성 확보</td><td>Docker + Kubernetes, 테스트 후 프로덕션 배포</td></tr><tr><td>환경 변수 기반 구성 관리</td><td>코드와 별도로 환경별 설정을 환경 변수로 분리</td><td>환경 변수, ConfigMap, Secret, Vault 등 구성 관리 도구</td><td>보안성 강화 및 설정 유연화</td><td>Kubernetes ConfigMap + Vault 를 통한 DB 연결 정보 관리</td></tr><tr><td>무상태 프로세스 설계</td><td>상태를 외부화하여 프로세스 간 공유하지 않는 구조</td><td>Redis, Memcached, Load Balancer, 외부 세션 스토리지</td><td>수평 확장성 및 장애 복구력 향상</td><td>Redis 세션 저장소로 다중 웹 서버 간 무중단 세션 유지</td></tr><tr><td>마이크로서비스 분해</td><td>앱을 독립적인 서비스 집합으로 나누는 구조</td><td>API Gateway, 서비스 디스커버리 (Consul), Service Mesh(Istio)</td><td>서비스 독립성, 개별 확장/배포 가능성 확보</td><td>Kong Gateway + Consul + Istio 로 주문/결제 서비스 분리 운영</td></tr></tbody></table><h3 id=장점과-단점>장점과 단점<a hidden class=anchor aria-hidden=true href=#장점과-단점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>✅ 장점</td><td>수평적 확장성</td><td>무상태 프로세스로 인한 세션 고착성 문제 없이 쉬운 스케일 아웃</td></tr><tr><td></td><td>비용 효율성</td><td>트래픽이 낮은 시간대 스케일 인으로 인프라 비용 절감</td></tr><tr><td></td><td>이식성</td><td>운영체제와 분리되어 모든 클라우드 제공업체에 배포 가능</td></tr><tr><td></td><td>개발자 온보딩 간소화</td><td>명시적 종속성 선언으로 새로운 개발자 설정 시간 단축</td></tr><tr><td></td><td>지속적 배포 지원</td><td>개발과 프로덕션 환경 간 차이 최소화로 빠른 배포 가능</td></tr><tr><td></td><td>장애 복구 능력</td><td>빠른 시작과 정상 종료를 통한 견고성 향상</td></tr><tr><td></td><td>유지보수성</td><td>코드와 구성의 분리, 설정 자동화, 환경 일치로 유지보수 비용 절감</td></tr><tr><td>⚠ 단점</td><td>초기 복잡성</td><td>기존 모놀리식 애플리케이션 대비 초기 설계 및 구현 복잡성 증가</td></tr><tr><td></td><td>과도한 추상화</td><td>작은 프로젝트에는 과도할 수 있습니다.</td></tr><tr><td></td><td>환경 의존성</td><td>환경변수 관리 미숙 시 보안/운영상 문제 발생 가능</td></tr><tr><td></td><td>상태 관리 제약</td><td>무상태 설계로 인한 복잡한 상태 관리 시나리오에서의 제약</td></tr><tr><td></td><td>분산 시스템 복잡성</td><td>서비스 간 통신, 네트워크 지연, 부분 장애 등 분산 시스템 고유 문제</td></tr><tr><td></td><td>로깅 및 모니터링 복잡성</td><td>여러 프로세스와 서비스에 분산된 로그 관리 복잡성</td></tr></tbody></table><h3 id=도전-과제-및-해결책>도전 과제 및 해결책<a hidden class=anchor aria-hidden=true href=#도전-과제-및-해결책>#</a></h3><table><thead><tr><th>도전 과제</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>레거시 시스템 마이그레이션</td><td>모놀리식 구조에서 12-Factor 기반 구조로 전환 시의 복잡성</td><td>Strangler Fig Pattern, DDD 적용, API Gateway 로 레거시 - 신규 통합</td></tr><tr><td>상태 관리 복잡성</td><td>무상태 설계 원칙으로 인한 세션, 인증 등 상태 관리의 어려움</td><td>Redis/Memcached 외부 세션 저장소, JWT 기반 인증, 이벤트 소싱 적용</td></tr><tr><td>분산 시스템 디버깅</td><td>마이크로서비스 간 요청 추적 및 장애 원인 분석의 어려움</td><td>분산 추적 도구 (Jaeger/Zipkin), Correlation ID 적용, 중앙 집중식 로깅/모니터링 구축</td></tr><tr><td>네트워크 지연 및 장애</td><td>서비스 간 통신 시 지연 발생 및 장애 전파 가능성</td><td>서킷 브레이커 패턴, 재시도/백오프 전략, 서비스 메시 (Istio 등) 활용</td></tr><tr><td>환경 변수 보안</td><td>민감정보가 환경 변수에 노출될 가능성</td><td>HashiCorp Vault, AWS Secrets Manager, K8s Secret 등 비밀 관리 시스템 도입</td></tr><tr><td>운영 환경 일치</td><td>dev/stage/prod 간 환경 차이로 인해 오류 발생</td><td>IaC(Terraform 등) 적용, Docker/Kubernetes 기반 환경 구성으로 표준화</td></tr><tr><td>무상태 설계의 어려움</td><td>기존 구조와 비즈니스 로직에 상태 저장 방식이 깊이 연결되어 있는 경우</td><td>외부 세션 저장소, 이벤트 기반 상태 저장, 상태 캡슐화를 통한 리팩토링</td></tr><tr><td>환경 변수 관리의 복잡성</td><td>서비스 수 증가에 따라 환경 설정 유지 관리의 복잡도 상승</td><td>환경별 <code>.env</code> 분리 + CI/CD 통합 관리, Vault 기반 중앙 집중화</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-전자상거래-플랫폼-현대화>사례 1: 전자상거래 플랫폼 현대화<a hidden class=anchor aria-hidden=true href=#사례-1-전자상거래-플랫폼-현대화>#</a></h4><p><strong>시나리오</strong>: 기존 모놀리식 전자상거래 플랫폼을 클라우드 네이티브 아키텍처로 전환<br><strong>시스템 구성</strong>:</p><ul><li><strong>주문 서비스</strong>: 주문 처리 및 관리</li><li><strong>결제 서비스</strong>: 결제 처리 및 정산</li><li><strong>재고 서비스</strong>: 상품 재고 관리</li><li><strong>사용자 서비스</strong>: 사용자 인증 및 프로필 관리</li><li><strong>알림 서비스</strong>: 이메일/SMS 알림 발송</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        A[Web App]
        B[Mobile App]
        C[Partner API]
    end
    
    subgraph &#34;API Gateway&#34;
        D[Kong API Gateway]
    end
    
    subgraph &#34;Microservices&#34;
        E[User Service]
        F[Product Service]
        G[Order Service]
        H[Payment Service]
        I[Inventory Service]
        J[Notification Service]
    end
    
    subgraph &#34;Data Layer&#34;
        K[(User DB)]
        L[(Product DB)]
        M[(Order DB)]
        N[(Payment DB)]
        O[(Inventory DB)]
    end
    
    subgraph &#34;Infrastructure&#34;
        P[Redis Cache]
        Q[RabbitMQ]
        R[ELK Stack]
        S[Prometheus/Grafana]
    end
    
    A --&gt; D
    B --&gt; D
    C --&gt; D
    
    D --&gt; E
    D --&gt; F
    D --&gt; G
    D --&gt; H
    D --&gt; I
    D --&gt; J
    
    E --&gt; K
    F --&gt; L
    G --&gt; M
    H --&gt; N
    I --&gt; O
    
    E --&gt; P
    F --&gt; P
    G --&gt; Q
    H --&gt; Q
    I --&gt; Q
    J --&gt; Q
    
    E --&gt; R
    F --&gt; R
    G --&gt; R
    H --&gt; R
    I --&gt; R
    J --&gt; R
</pre><p><strong>활용 사례 Workflow</strong>:</p><ol><li><strong>코드베이스 분리</strong>: 각 서비스별 독립된 Git 저장소 구성</li><li><strong>종속성 관리</strong>: Docker 이미지 기반 종속성 패키징</li><li><strong>환경 설정</strong>: Kubernetes ConfigMap 과 Secret 으로 환경별 설정 관리</li><li><strong>백업 서비스</strong>: PostgreSQL, Redis, RabbitMQ 를 외부 서비스로 연결</li><li><strong>CI/CD 파이프라인</strong>: GitLab CI 를 통한 빌드 - 릴리스 - 실행 단계 분리</li><li><strong>무상태 설계</strong>: JWT 토큰 기반 인증, Redis 세션 저장소 활용</li><li><strong>포트 바인딩</strong>: 각 서비스는 고유 포트로 서비스 노출</li><li><strong>수평적 확장</strong>: Kubernetes HPA 를 통한 자동 확장</li><li><strong>빠른 시작/종료</strong>: 헬스체크와 그레이스풀 셧다운 구현</li><li><strong>환경 동등성</strong>: Docker 컨테이너로 개발/스테이징/프로덕션 환경 통일</li><li><strong>로그 스트리밍</strong>: ELK Stack 을 통한 중앙 집중식 로그 관리</li><li><strong>관리 프로세스</strong>: 데이터 마이그레이션을 별도 Job 으로 실행</li></ol><p><strong>12-Factor 원칙이 담당한 역할</strong>:</p><ul><li><strong>확장성</strong>: 트래픽 급증 시 개별 서비스별 자동 확장</li><li><strong>안정성</strong>: 서비스 장애 시 다른 서비스에 미치는 영향 최소화</li><li><strong>배포 효율성</strong>: 서비스별 독립적 배포로 출시 주기 단축</li><li><strong>운영 효율성</strong>: 표준화된 로깅과 모니터링으로 문제 진단 시간 단축</li><li><strong>비용 최적화</strong>: 사용량에 따른 탄력적 리소스 할당</li></ul><h4 id=사례-2-saas-기반-crm-시스템-구축>사례 2: SaaS 기반 CRM 시스템 구축<a hidden class=anchor aria-hidden=true href=#사례-2-saas-기반-crm-시스템-구축>#</a></h4><p><strong>시나리오</strong>: SaaS 기반 CRM 시스템을 구축하는데 있어 고객별 독립 배포가 필요하고, 빠른 기능 추가와 배포가 요구되는 환경<br><strong>사용 기술 스택</strong>:</p><ul><li>Backend: Python (FastAPI)</li><li>Frontend: React</li><li>Infra: AWS (ECS + S3 + RDS + CloudWatch), GitHub Actions</li></ul><p><strong>시스템 구성</strong></p><pre class=mermaid>graph LR
    subgraph User Interaction
        UI[React Frontend] --&gt; API[FastAPI Backend]
    end

    subgraph Backend Infra
        API --&gt; ECS[&#34;ECS (Dockerized App)&#34;]
        ECS --&gt; RDS[Amazon RDS]
        ECS --&gt; S3[Amazon S3]
        ECS --&gt; LOGS[CloudWatch Logs]
    end

    subgraph DevOps
        GitHub[GitHub Actions] --&gt; ECS
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>기능 개발 후 GitHub 에 push</li><li>GitHub Actions 를 통해 Build → Release → Run 분리 적용</li><li>환경 변수로 환경 구성 분리</li><li>각 프로세스는 컨테이너화되어 독립 실행 (무상태)</li><li>로그는 CloudWatch 로 집계</li><li>관리자 프로세스는 일회성 Job 으로 ECS Task 실행<br><strong>적용된 원칙</strong>: Codebase, Dependencies, Config, Backing Services, Build/Release/Run, Processes, Port Binding, Logs, Admin Processes 등</li></ol><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>환경 변수 관리</td><td>환경 변수에 민감정보가 포함되므로 관리 주의 필요</td><td>비밀 관리 도구 (Vault, AWS Secrets Manager 등) 사용</td></tr><tr><td>무상태 설계</td><td>세션 상태를 외부 저장소로 이전 필요</td><td>Redis, Memcached 등을 사용해 세션 분리</td></tr><tr><td>상태 외부화</td><td>세션, 캐시 등 외부 서비스로 관리</td><td>DB/Redis 등 활용</td></tr><tr><td>로깅 처리</td><td>로그를 단순 스트림으로 처리하므로 수집 시스템 필요</td><td>ELK, CloudWatch Logs 등의 수집 도구 사용</td></tr><tr><td>환경 일치</td><td>개발, 운영 환경 차이 발생 가능성</td><td>Docker 등으로 환경 동기화 권장</td></tr><tr><td>배포 파이프라인 구성</td><td>빌드 - 릴리스 - 실행 분리로 인해 자동화 필요</td><td>CI/CD 시스템 구축 권장</td></tr></tbody></table><h4 id=보안-고려사항>보안 고려사항<a hidden class=anchor aria-hidden=true href=#보안-고려사항>#</a></h4><p>12-Factor 방법론을 넘어 기업 생태계에서는 처음부터 모든 보안 차원을 다뤄야 한다.<br>주요 보안 모범 사례:</p><ul><li><strong>전송 중 데이터 보안</strong>: TLS(Transport Layer Security) 사용</li><li><strong>인증 및 권한 부여</strong>: API 키, OAuth 2.0, JWT 토큰 활용</li><li><strong>시크릿 관리</strong>: HashiCorp Vault, AWS Secrets Manager 등 활용</li><li><strong>네트워크 보안</strong>: 방화벽, VPC, 서비스 메시 정책 적용</li></ul><h4 id=관찰-가능성-observability>관찰 가능성 (Observability)<a hidden class=anchor aria-hidden=true href=#관찰-가능성-observability>#</a></h4><p>관찰 가능성이 새로운 요소로 부상하여 로그, 메트릭, 추적 데이터를 측정해 종단 간 가시성을 제공한다.</p><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>분류</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>자동 확장 정책</td><td>확장성</td><td>과도한 자동 확장은 리소스 낭비 및 비용 증가 가능</td><td>적절한 메트릭 기반 HPA 구성 (예: CPU 70% 이상일 때 확장)</td></tr><tr><td>수평 확장 지원</td><td>프로세스 확장성</td><td>무상태 프로세스로 수평 확장이 가능해야 함</td><td>Kubernetes 등 컨테이너 오케스트레이션 시스템 활용</td></tr><tr><td>캐싱 전략</td><td>성능</td><td>빈번한 데이터 조회 시 DB 부하 발생 가능</td><td>Redis, 분산 캐시, Cache Aside 패턴 활용</td></tr><tr><td>서비스 간 호출 최적화</td><td>지연 시간</td><td>REST 방식으로 서비스 호출이 누적되면 네트워크 지연 증가</td><td>API Aggregation 또는 GraphQL 로 호출 수 최소화</td></tr><tr><td>컨테이너 리소스 할당</td><td>리소스 관리</td><td>리소스 부족 시 컨테이너 성능 저하 및 장애 가능</td><td>적절한 CPU/Memory 요청 (request) 및 제한 (limit) 설정</td></tr><tr><td>읽기 복제본 활용</td><td>데이터베이스</td><td>복제본을 통한 분산 처리 시 읽기 지연이나 비일관성 발생 가능</td><td>읽기/쓰기 분리, CQRS(Command Query Responsibility Segregation) 적용</td></tr><tr><td>트래픽 분산 최적화</td><td>로드밸런싱</td><td>일부 서버에 트래픽 집중 시 핫스팟 발생</td><td>Consistent Hashing, Weighted Routing 적용</td></tr><tr><td>비동기 처리 최적화</td><td>메시징 처리</td><td>메시지 유실 또는 중복 처리 위험 존재</td><td>Dead Letter Queue(DLQ), 멱등성 처리 전략 적용</td></tr><tr><td>외부 서비스 성능</td><td>외부 리소스 성능</td><td>DB, MQ, 캐시 등의 리소스가 병목이 될 수 있음</td><td>Connection Pool, 모니터링, 자동 스케일링 적용</td></tr><tr><td>로그 스트림 처리</td><td>로깅 처리</td><td>동기식 로그 처리 시 성능 저하 및 I/O 병목 발생</td><td>비동기 로그 출력, Fluent Bit, ELK(Elastic Stack) 연계</td></tr><tr><td>빠른 시작/종료</td><td>실행 최적화</td><td>애플리케이션 시작/종료 속도에 따라 오토스케일링 반응 속도 저하</td><td>경량 런타임 채택, Lazy Init 으로 초기 지연 최소화</td></tr><tr><td>환경 변수 파싱 성능</td><td>구성 최적화</td><td>환경 변수가 많으면 파싱 시간 증가 및 런타임 초기화 지연</td><td><code>.env</code> 파일 캐싱 또는 초기화 시점 명확히 조정</td></tr><tr><td>배포 최적화</td><td>배포 성능</td><td>빌드 및 배포 속도가 느리면 기능 출시 지연</td><td>멀티 스테이지 Dockerfile, 이미지 경량화, Build Cache 활용</td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>컨테이너 기술</td><td>Docker</td><td>애플리케이션 컨테이너화를 통한 환경 일관성 보장</td></tr><tr><td>오케스트레이션</td><td>Kubernetes</td><td>컨테이너 기반 애플리케이션의 자동 배포, 확장, 관리</td></tr><tr><td>서비스 메시</td><td>Istio, Linkerd</td><td>서비스 간 통신 보안, 모니터링, 트래픽 관리</td></tr><tr><td>API 게이트웨이</td><td>Kong, Ambassador</td><td>마이크로서비스 진입점 통합 및 보안 정책 적용</td></tr><tr><td>모니터링</td><td>Prometheus, Grafana</td><td>메트릭 수집 및 시각화를 통한 시스템 상태 모니터링</td></tr><tr><td>로깅</td><td>ELK Stack, Fluentd</td><td>분산 시스템의 로그 수집, 저장, 분석</td></tr><tr><td>CI/CD</td><td>GitLab CI, Jenkins</td><td>지속적 통합 및 배포 파이프라인 자동화</td></tr><tr><td>서비스 디스커버리</td><td>Consul, Eureka</td><td>동적 서비스 검색 및 로드 밸런싱</td></tr></tbody></table><h3 id=하위-주제-분류>하위 주제 분류<a hidden class=anchor aria-hidden=true href=#하위-주제-분류>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>간략한 설명</th></tr></thead><tbody><tr><td>아키텍처 패턴</td><td>Microservices Architecture</td><td>12-Factor 와 밀접한 관련이 있는 마이크로서비스 설계 패턴</td></tr><tr><td>배포 전략</td><td>Blue-Green Deployment</td><td>무중단 배포를 위한 전략</td></tr><tr><td>배포 전략</td><td>Canary Deployment</td><td>점진적 배포를 통한 위험 최소화</td></tr><tr><td>데이터 관리</td><td>Database per Service</td><td>마이크로서비스별 독립적 데이터베이스 관리</td></tr><tr><td>통신 패턴</td><td>Event-Driven Architecture</td><td>비동기 메시징을 통한 서비스 간 통신</td></tr><tr><td>장애 관리</td><td>Circuit Breaker Pattern</td><td>연쇄 장애 방지를 위한 설계 패턴</td></tr><tr><td>보안</td><td>Zero Trust Security</td><td>12-Factor 환경에서의 보안 접근 방식</td></tr></tbody></table><h3 id=관련-분야-추가-학습-내용>관련 분야 추가 학습 내용<a hidden class=anchor aria-hidden=true href=#관련-분야-추가-학습-내용>#</a></h3><table><thead><tr><th>관련 분야</th><th>주제</th><th>간략한 설명</th></tr></thead><tbody><tr><td>DevOps</td><td>Infrastructure as Code</td><td>Terraform, Ansible 을 통한 인프라 자동화</td></tr><tr><td>Site Reliability Engineering</td><td>Error Budget, SLO/SLI</td><td>서비스 신뢰성 관리 방법론</td></tr><tr><td>Platform Engineering</td><td>Internal Developer Platform</td><td>개발자 생산성 향상을 위한 플랫폼 구축</td></tr><tr><td>Cloud Computing</td><td>Serverless Computing</td><td>FaaS 기반 애플리케이션 개발</td></tr><tr><td>Data Engineering</td><td>Stream Processing</td><td>실시간 데이터 처리 아키텍처</td></tr><tr><td>Security Engineering</td><td>Secure Software Development</td><td>보안이 내재된 소프트웨어 개발 생명주기</td></tr><tr><td>Quality Assurance</td><td>Chaos Engineering</td><td>시스템 복원력 테스트 방법론</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>환경 변수 (Environment Variable)</td><td>실행 환경에 따라 동적으로 설정되는 변수</td></tr><tr><td>IaC(Infrastructure as Code)</td><td>코드로 인프라를 관리하는 방식</td></tr><tr><td>오토스케일링 (Auto Scaling)</td><td>부하에 따라 자동으로 인스턴스 확장/축소</td></tr><tr><td>SaaS (Software-as-a-Service)</td><td>클라우드를 통해 제공되는 소프트웨어 서비스 모델</td></tr><tr><td>PaaS (Platform-as-a-Service)</td><td>애플리케이션 개발 및 배포를 위한 클라우드 플랫폼 서비스</td></tr><tr><td>CI/CD (Continuous Integration/Continuous Deployment)</td><td>지속적 통합 및 지속적 배포 파이프라인</td></tr><tr><td>무상태 프로세스 (Stateless Process)</td><td>이전 상호작용의 정보를 저장하지 않는 프로세스</td></tr><tr><td>백업 서비스 (Backing Services)</td><td>네트워크를 통해 애플리케이션이 사용하는 외부 서비스</td></tr><tr><td>포트 바인딩 (Port Binding)</td><td>애플리케이션이 특정 포트에 바인딩되어 네트워크 요청을 처리하는 방식</td></tr><tr><td>그레이스풀 셧다운 (Graceful Shutdown)</td><td>실행 중인 작업을 완료한 후 안전하게 프로세스를 종료하는 방식</td></tr><tr><td>서킷 브레이커 (Circuit Breaker)</td><td>연쇄 장애를 방지하기 위해 장애 발생 시 호출을 차단하는 패턴</td></tr><tr><td>서비스 메시 (Service Mesh)</td><td>마이크로서비스 간 통신을 관리하는 인프라 계층</td></tr><tr><td>컨테이너 오케스트레이션</td><td>컨테이너의 배포, 확장, 관리를 자동화하는 시스템</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://12factor.net/>The Twelve-Factor App 공식 웹사이트</a></li><li><a href=https://en.wikipedia.org/wiki/Twelve-Factor_App_methodology>Twelve-Factor App methodology - Wikipedia</a></li><li><a href=https://www.redhat.com/architect/12-factor-app>Red Hat - An illustrated guide to 12 Factor Apps</a></li><li><a href=https://www.geeksforgeeks.org/what-is-twelve-factor-app/>GeeksforGeeks - What is Twelve-Factor App</a></li><li><a href=https://www.netsolutions.com/insights/12-factor-app-methodology/>Net Solutions - The 12-Factor App Methodology Explained</a></li><li><a href=https://blog.scottlogic.com/2017/07/17/successful-microservices-with-12factor-app.html>Scott Logic - Successful microservices architecture with the Twelve-Factor App</a></li><li><a href=https://blog.clearscale.com/12-factor-approach-for-microservices/>ClearScale - Using the 12-Factor App Methodology for Microservices</a></li><li><a href=https://www.techtarget.com/searchsoftwarequality/definition/twelve-factor-app>TechTarget - What is 12-factor app? Definition</a></li><li><a href=https://www.bmc.com/blogs/twelve-factor-app/>BMC Software - The 12-Factor App Methodology Explained</a></li><li><a href=https://vedcraft.com/architecture/3-tricks-twelve-factor-app/>Vedcraft - 3 Simple Tricks Every Architect Should Know About Twelve-Factor App</a></li><li><a href=https://12factor.net/>12factor.net 공식 문서</a></li><li><a href=https://devcenter.heroku.com/articles/12-factor-app>Heroku Dev Center - The Twelve-Factor App</a></li><li><a href=https://www.bmc.com/blogs/twelve-factor-app/>BMC - Twelve-Factor App Overview</a></li><li><a href="https://cloud.ibm.com/docs/overview?topic=overview-12-factor-app">IBM Cloud Docs - The Twelve-Factor App Methodology</a></li><li><a href=https://12factor.net/ko/>Twelve-Factor App 공식 한국어 문서</a></li><li><a href=https://aws.amazon.com/ko/blogs/korea/twelve-factor-app-on-cloud-native/>AWS 클라우드 네이티브 기반 Twelve Factor 앱 개발 방법</a></li><li><a href=https://isaac-yoon.tistory.com/39>Isaac&rsquo;s Archive: Twelve-Factor</a></li><li><a href=https://minseok-study.tistory.com/entry/12-Factor-App>minseok_study: 12 Factor App</a></li><li><a href=https://cscscs.tistory.com/entry/The-Twelve-Factor-App-12>CS BLOG: The Twelve-Factor App</a></li></ul><hr></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>