<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Messaging Queues | hyunyoun's Blog</title><meta name=keywords content="Backend-Development,API-Design-and-Implementation,API-Integration-Patterns,Messaging-Queues"><meta name=description content="메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/implementations/message-queues/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/implementations/message-queues/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/implementations/message-queues/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/implementations/message-queues/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Messaging Queues"><meta property="og:description" content="메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Messaging Queues"><meta name=twitter:description content="메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Software Engineering","item":"https://buenhyden.github.io/posts/software-engineering/"},{"@type":"ListItem","position":3,"name":"Design and Architecture","item":""},{"@type":"ListItem","position":5,"name":"Messaging Systems","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/"},{"@type":"ListItem","position":6,"name":"Messaging Queues","item":"https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/implementations/message-queues/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/>Software Engineering</a>&nbsp;»&nbsp;<a href>Design and Architecture</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/>Messaging Systems</a></div><h1>Messaging Queues</h1><div class=post-description>메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다.</div></header><div class=post-content><h2 id=messaging-queues>Messaging Queues<a hidden class=anchor aria-hidden=true href=#messaging-queues>#</a></h2><p>메시징 큐는 현대 시스템 아키텍처에서 핵심적인 통합 패턴으로, 특히 분산 시스템과 마이크로서비스 환경에서 중요한 역할을 한다. 이는 시스템 간의 느슨한 결합, 확장성, 복원력, 비동기 통신 등 다양한 이점을 제공하기 때문이다.</p><p>특히 API 통합 측면에서 메시징 큐는 다음과 같은 중요한 역할을 한다:</p><ol><li><strong>트래픽 관리</strong>: API 게이트웨이와 메시징 큐를 결합하여 급증하는 트래픽을 효과적으로 관리할 수 있다.</li><li><strong>서비스 격리</strong>: 서비스 간 직접적인 의존성을 제거하여 한 서비스의 장애가 전체 시스템에 미치는 영향을 최소화한다.</li><li><strong>비동기 통신</strong>: 즉각적인 응답이 필요 없는 작업을 비동기적으로 처리하여 API 응답 시간을 개선한다.</li><li><strong>데이터 통합</strong>: 여러 시스템 간의 데이터 흐름을 조정하고 일관성을 유지한다.</li><li><strong>이벤트 기반 아키텍처</strong>: 이벤트 생성, 전파, 소비를 지원하여 이벤트 기반 시스템의 기반이 된다.</li></ol><p>메시징 큐를 효과적으로 활용하기 위해서는 메시지 설계, 큐 구조, 오류 처리, 확장성, 모니터링 등 다양한 측면에서 신중한 계획과 구현이 필요하다. 또한 비즈니스 요구사항과 기술적 제약을 고려하여 적절한 메시징 기술을 선택하는 것이 중요하다.</p><p>최신 클라우드 네이티브 환경에서는 Kafka, RabbitMQ, Amazon SQS/SNS, Google Pub/Sub 등 다양한 메시징 솔루션을 활용할 수 있으며, 각각의 솔루션은 특정 사용 사례와 요구사항에 더 적합하다. 각 조직의 상황에 맞는 메시징 큐 전략을 수립하고 구현하는 것이 성공적인 API 통합의 핵심 요소이다.</p><p>결론적으로, 메시징 큐는 단순한 통신 메커니즘 이상의 의미를 가진다. 이는 확장 가능하고, 유연하며, 복원력 있는 시스템 아키텍처를 구축하기 위한 전략적 도구이다. API 통합 패턴으로서 메시징 큐를 이해하고 활용함으로써, 조직은 더 강력하고 미래 지향적인 시스템을 구축할 수 있다.</p><h3 id=메시징-큐의-기본-개념>메시징 큐의 기본 개념<a hidden class=anchor aria-hidden=true href=#메시징-큐의-기본-개념>#</a></h3><p>메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다. 이는 마치 우체통과 같이 작동한다 - 발신자가 메시지를 보내면 우체통(큐)에 저장되고, 수신자는 자신의 속도와 능력에 맞춰 메시지를 가져가 처리한다.</p><p>메시징 큐의 핵심 기능은 다음과 같다:</p><ol><li><strong>비동기 통신</strong>: 생산자와 소비자가 동시에 활성화될 필요가 없음</li><li><strong>버퍼링</strong>: 일시적인 부하 증가나 소비자 장애 시 메시지 보존</li><li><strong>분리(Decoupling)</strong>: 시스템 구성 요소 간의 직접적인 의존성 제거</li><li><strong>부하 분산</strong>: 여러 소비자 간에 작업 분배 가능</li></ol><h3 id=메시징-큐의-주요-구성-요소>메시징 큐의 주요 구성 요소<a hidden class=anchor aria-hidden=true href=#메시징-큐의-주요-구성-요소>#</a></h3><h4 id=메시지message>메시지(Message)<a hidden class=anchor aria-hidden=true href=#메시지message>#</a></h4><p>메시징 시스템의 기본 단위로, 일반적으로 다음 요소로 구성된다:</p><ul><li><strong>헤더(Header)</strong>: 메타데이터(메시지 ID, 타임스탬프, 우선순위 등)</li><li><strong>본문(Body)</strong>: 실제 전송되는 데이터(JSON, XML, 바이너리 등)</li><li><strong>속성(Properties)</strong>: 라우팅 키, 만료 시간 등의 추가 정보</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=c1>// 메시지 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;header&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;messageId&#34;</span><span class=p>:</span> <span class=s2>&#34;msg-123456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-23T10:15:30Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;priority&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;orderId&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD-9876&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customerId&#34;</span><span class=p>:</span> <span class=s2>&#34;CUST-5432&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;productId&#34;</span><span class=p>:</span> <span class=s2>&#34;PROD-001&#34;</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;productId&#34;</span><span class=p>:</span> <span class=s2>&#34;PROD-015&#34;</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalAmount&#34;</span><span class=p>:</span> <span class=mf>79.98</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;routingKey&#34;</span><span class=p>:</span> <span class=s2>&#34;orders.new&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;contentType&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;expirationTime&#34;</span><span class=p>:</span> <span class=mi>86400</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=큐queue>큐(Queue)<a hidden class=anchor aria-hidden=true href=#큐queue>#</a></h4><p>메시지가 저장되는 데이터 구조로, 일반적으로 FIFO(First-In-First-Out) 방식을 따른다.</p><p>큐의 특성은 다음과 같다:</p><ul><li><strong>내구성(Durability)</strong>: 시스템 재시작 후에도 메시지 보존 여부</li><li><strong>배타성(Exclusivity)</strong>: 단일 소비자만 접근 가능 여부</li><li><strong>자동 삭제(Auto-delete)</strong>: 모든 소비자 연결 해제 시 자동 삭제 여부</li></ul><h4 id=익스체인지exchange>익스체인지(Exchange)<a hidden class=anchor aria-hidden=true href=#익스체인지exchange>#</a></h4><p>일부 메시징 시스템(RabbitMQ 등)에서 사용되는 개념으로, 생산자로부터 메시지를 받아 라우팅 규칙에 따라 적절한 큐로 전달한다.</p><p>주요 타입은 다음과 같다:</p><ul><li><strong>다이렉트(Direct)</strong>: 정확한 라우팅 키 매칭</li><li><strong>토픽(Topic)</strong>: 패턴 기반 라우팅</li><li><strong>팬아웃(Fanout)</strong>: 모든 바인딩된 큐에 브로드캐스트</li><li><strong>헤더(Headers)</strong>: 헤더 속성 기반 라우팅</li></ul><h4 id=생산자producer>생산자(Producer)<a hidden class=anchor aria-hidden=true href=#생산자producer>#</a></h4><p>메시지를 생성하고 메시징 시스템에 전송하는 애플리케이션이다.</p><p>생산자의 주요 책임은 다음과 같다:</p><ul><li>메시지 형식 정의 및 생성</li><li>적절한 라우팅 정보 제공</li><li>필요시 전송 확인 처리</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ를 사용한 메시지 생산자 예시 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐 선언</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 생성</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;orderId&#39;</span><span class=p>:</span> <span class=s1>&#39;ORD-9876&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;customerId&#39;</span><span class=p>:</span> <span class=s1>&#39;CUST-5432&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s1>&#39;productId&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD-001&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s1>&#39;productId&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD-015&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;totalAmount&#39;</span><span class=p>:</span> <span class=mf>79.98</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># 메시지 지속성 보장</span>
</span></span><span class=line><span class=cl>        <span class=n>content_type</span><span class=o>=</span><span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 메시지 발행: </span><span class=si>{</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;orderId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=소비자consumer>소비자(Consumer)<a hidden class=anchor aria-hidden=true href=#소비자consumer>#</a></h4><p>큐에서 메시지를 수신하고 처리하는 애플리케이션이다.</p><p>소비자의 주요 책임은 다음과 같다:</p><ul><li>메시지 수신 및 처리</li><li>처리 성공/실패 확인(Acknowledgment)</li><li>오류 처리 및 재시도 전략 구현</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ를 사용한 메시지 소비자 예시 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐 선언 (생산자와 동일한 큐)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 한 번에 하나의 메시지만 처리하도록 설정</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 중: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;orderId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 실제 비즈니스 로직 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>process_order</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 처리 완료 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 완료: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;orderId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=n>order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 주문 처리 로직 구현</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비 시작</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;주문 처리 서비스 실행 중... Ctrl+C로 종료&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api-통합을-위한-메시징-큐-패턴>API 통합을 위한 메시징 큐 패턴<a hidden class=anchor aria-hidden=true href=#api-통합을-위한-메시징-큐-패턴>#</a></h3><h4 id=작업-큐work-queue-패턴>작업 큐(Work Queue) 패턴<a hidden class=anchor aria-hidden=true href=#작업-큐work-queue-패턴>#</a></h4><p>시간이 많이 소요되거나 리소스 집약적인 작업을 비동기적으로 처리하기 위한 패턴이다. API 요청을 즉시 처리하는 대신 큐에 작업을 추가하고 응답을 빠르게 반환한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42>42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43>43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44>44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45>45</a>
</span><span class=lnt id=hl-3-46><a class=lnlinks href=#hl-3-46>46</a>
</span><span class=lnt id=hl-3-47><a class=lnlinks href=#hl-3-47>47</a>
</span><span class=lnt id=hl-3-48><a class=lnlinks href=#hl-3-48>48</a>
</span><span class=lnt id=hl-3-49><a class=lnlinks href=#hl-3-49>49</a>
</span><span class=lnt id=hl-3-50><a class=lnlinks href=#hl-3-50>50</a>
</span><span class=lnt id=hl-3-51><a class=lnlinks href=#hl-3-51>51</a>
</span><span class=lnt id=hl-3-52><a class=lnlinks href=#hl-3-52>52</a>
</span><span class=lnt id=hl-3-53><a class=lnlinks href=#hl-3-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js Express API 엔드포인트 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// RabbitMQ 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>connectQueue</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;image_processing&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>connectQueue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이미지 처리 API 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/images/process&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>imageUrl</span><span class=p>,</span> <span class=nx>filters</span><span class=p>,</span> <span class=nx>userId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 ID 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>jobId</span> <span class=o>=</span> <span class=nx>generateJobId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업을 큐에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span><span class=s1>&#39;image_processing&#39;</span><span class=p>,</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>imageUrl</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>filters</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})),</span> <span class=p>{</span> <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 ID와 상태 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>202</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>statusUrl</span><span class=o>:</span> <span class=sb>`/api/jobs/</span><span class=si>${</span><span class=nx>jobId</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 작업 상태 확인 API 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/jobs/:jobId&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>jobId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 상태 조회 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>jobStatus</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getJobStatus</span><span class=p>(</span><span class=nx>jobId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>jobStatus</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;API 서버가 포트 3000에서 실행 중입니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=게시-구독pub-sub-패턴>게시-구독(Pub-Sub) 패턴<a hidden class=anchor aria-hidden=true href=#게시-구독pub-sub-패턴>#</a></h4><p>하나의 메시지를 여러 소비자에게 전달하는 패턴으로, 이벤트 기반 아키텍처의 기반이 된다. 이벤트가 발생하면 관심 있는 모든 서비스가 알림을 받을 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C# 이벤트 발행 서비스 예시</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderService</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IMessageBroker</span> <span class=n>_messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IOrderRepository</span> <span class=n>_orderRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>OrderService</span><span class=p>(</span><span class=n>IMessageBroker</span> <span class=n>messageBroker</span><span class=p>,</span> <span class=n>IOrderRepository</span> <span class=n>orderRepository</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_messageBroker</span> <span class=p>=</span> <span class=n>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_orderRepository</span> <span class=p>=</span> <span class=n>orderRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>Order</span><span class=p>&gt;</span> <span class=n>CreateOrderAsync</span><span class=p>(</span><span class=n>OrderRequest</span> <span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 및 저장</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>order</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Order</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Id</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>CustomerId</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Items</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>Items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>TotalAmount</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>Items</span><span class=p>.</span><span class=n>Sum</span><span class=p>(</span><span class=n>i</span> <span class=p>=&gt;</span> <span class=n>i</span><span class=p>.</span><span class=n>Price</span> <span class=p>*</span> <span class=n>i</span><span class=p>.</span><span class=n>Quantity</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Status</span> <span class=p>=</span> <span class=n>OrderStatus</span><span class=p>.</span><span class=n>Created</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>CreatedAt</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>_orderRepository</span><span class=p>.</span><span class=n>SaveAsync</span><span class=p>(</span><span class=n>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>_messageBroker</span><span class=p>.</span><span class=n>PublishAsync</span><span class=p>(</span><span class=s>&#34;orders.created&#34;</span><span class=p>,</span> <span class=k>new</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderId</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>CustomerId</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>TotalAmount</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>TotalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Items</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>Items</span><span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>i</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>OrderItemEvent</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>ProductId</span> <span class=p>=</span> <span class=n>i</span><span class=p>.</span><span class=n>ProductId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>Quantity</span> <span class=p>=</span> <span class=n>i</span><span class=p>.</span><span class=n>Quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>Price</span> <span class=p>=</span> <span class=n>i</span><span class=p>.</span><span class=n>Price</span>
</span></span><span class=line><span class=cl>            <span class=p>}).</span><span class=n>ToList</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>CreatedAt</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>CreatedAt</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=요청-응답request-reply-패턴>요청-응답(Request-Reply) 패턴<a hidden class=anchor aria-hidden=true href=#요청-응답request-reply-패턴>#</a></h4><p>비동기적인 요청-응답 상호작용을 구현하는 패턴으로, 응답 큐와 상관관계 ID를 사용하여 응답을 추적한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java Spring Boot 요청-응답 패턴 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>requestQueue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;product.info.request&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>replyQueue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;product.info.reply&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ProductService</span><span class=p>(</span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>ProductInfo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getProductInfo</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>productId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>ProductInfo</span><span class=o>&gt;</span><span class=w> </span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>correlationId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 응답을 수신할 콜백 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>requestQueue</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ProductInfoRequest</span><span class=p>(</span><span class=n>productId</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setReplyTo</span><span class=p>(</span><span class=n>replyQueue</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setCorrelationId</span><span class=p>(</span><span class=n>correlationId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>receive</span><span class=p>(</span><span class=n>replyQueue</span><span class=p>,</span><span class=w> </span><span class=n>30000</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>correlationId</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>getCorrelationId</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ProductInfo</span><span class=w> </span><span class=n>productInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ProductInfo</span><span class=p>)</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>getMessageConverter</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>fromMessage</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>future</span><span class=p>.</span><span class=na>complete</span><span class=p>(</span><span class=n>productInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>future</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=경쟁-소비자competing-consumers-패턴>경쟁 소비자(Competing Consumers) 패턴<a hidden class=anchor aria-hidden=true href=#경쟁-소비자competing-consumers-패턴>#</a></h4><p>여러 소비자가 동일한 큐에서 메시지를 처리하여 부하를 분산하는 패턴이다. 메시지 처리량을 높이고 시스템의 확장성을 개선한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41>41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42>42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43>43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44>44</a>
</span><span class=lnt id=hl-6-45><a class=lnlinks href=#hl-6-45>45</a>
</span><span class=lnt id=hl-6-46><a class=lnlinks href=#hl-6-46>46</a>
</span><span class=lnt id=hl-6-47><a class=lnlinks href=#hl-6-47>47</a>
</span><span class=lnt id=hl-6-48><a class=lnlinks href=#hl-6-48>48</a>
</span><span class=lnt id=hl-6-49><a class=lnlinks href=#hl-6-49>49</a>
</span><span class=lnt id=hl-6-50><a class=lnlinks href=#hl-6-50>50</a>
</span><span class=lnt id=hl-6-51><a class=lnlinks href=#hl-6-51>51</a>
</span><span class=lnt id=hl-6-52><a class=lnlinks href=#hl-6-52>52</a>
</span><span class=lnt id=hl-6-53><a class=lnlinks href=#hl-6-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python FastAPI 경쟁 소비자 패턴 예시 (Celery 사용)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>BackgroundTasks</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>celery</span> <span class=kn>import</span> <span class=n>Celery</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Celery 설정</span>
</span></span><span class=line><span class=cl><span class=n>celery_app</span> <span class=o>=</span> <span class=n>Celery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tasks&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>broker</span><span class=o>=</span><span class=s1>&#39;redis://localhost:6379/0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>backend</span><span class=o>=</span><span class=s1>&#39;redis://localhost:6379/0&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 데이터 처리 작업 정의</span>
</span></span><span class=line><span class=cl><span class=nd>@celery_app.task</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_data_chunk</span><span class=p>(</span><span class=n>chunk_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Chunk </span><span class=si>{</span><span class=n>chunk_id</span><span class=si>}</span><span class=s2> 처리 시작: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2> 항목&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 데이터 처리 로직</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 데이터 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Chunk </span><span class=si>{</span><span class=n>chunk_id</span><span class=si>}</span><span class=s2> 처리 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/data/process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>process_large_dataset</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>],</span> <span class=n>background_tasks</span><span class=p>:</span> <span class=n>BackgroundTasks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 대용량 데이터를 청크로 분할</span>
</span></span><span class=line><span class=cl>    <span class=n>chunk_size</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=n>data_chunks</span> <span class=o>=</span> <span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>chunk_size</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>chunk_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 각 청크를 별도 작업으로 큐에 추가</span>
</span></span><span class=line><span class=cl>    <span class=n>task_ids</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data_chunks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>process_data_chunk</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>chunk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>task_ids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2> 항목이 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data_chunks</span><span class=p>)</span><span class=si>}</span><span class=s2> 청크로 처리 중입니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;task_ids&#34;</span><span class=p>:</span> <span class=n>task_ids</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/api/tasks/status&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/api/tasks/status&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_tasks_status</span><span class=p>(</span><span class=n>task_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>task_id</span> <span class=ow>in</span> <span class=n>task_ids</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>celery_app</span><span class=o>.</span><span class=n>AsyncResult</span><span class=p>(</span><span class=n>task_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>task_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=n>task</span><span class=o>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;result&#34;</span><span class=p>:</span> <span class=n>task</span><span class=o>.</span><span class=n>result</span> <span class=k>if</span> <span class=n>task</span><span class=o>.</span><span class=n>ready</span><span class=p>()</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐의-고급-기능과-패턴>메시징 큐의 고급 기능과 패턴<a hidden class=anchor aria-hidden=true href=#메시징-큐의-고급-기능과-패턴>#</a></h3><h4 id=메시지-우선순위priority>메시지 우선순위(Priority)<a hidden class=anchor aria-hidden=true href=#메시지-우선순위priority>#</a></h4><p>중요도에 따라 메시지 처리 순서를 조정하는 기능이다. 긴급한 메시지가 먼저 처리되도록 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java에서 우선순위 큐 사용 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>NotificationService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>NotificationService</span><span class=p>(</span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendNotification</span><span class=p>(</span><span class=n>Notification</span><span class=w> </span><span class=n>notification</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 알림 유형에 따라 우선순위 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>notification</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>ALERT</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w>  </span><span class=c1>// 가장 높은 우선순위</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>WARNING</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>INFO</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>    </span><span class=c1>// 가장 낮은 우선순위</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;notifications.exchange&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;notifications.queue&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>notification</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setPriority</span><span class=p>(</span><span class=n>priority</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=재시도-큐retry-queue와-데드-레터-큐dead-letter-queue>재시도 큐(Retry Queue)와 데드 레터 큐(Dead Letter Queue)<a hidden class=anchor aria-hidden=true href=#재시도-큐retry-queue와-데드-레터-큐dead-letter-queue>#</a></h4><p>처리 실패한 메시지를 재시도하거나 분석을 위해 별도의 큐로 이동시키는 패턴이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63>63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64>64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65>65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66>66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67>67</a>
</span><span class=lnt id=hl-8-68><a class=lnlinks href=#hl-8-68>68</a>
</span><span class=lnt id=hl-8-69><a class=lnlinks href=#hl-8-69>69</a>
</span><span class=lnt id=hl-8-70><a class=lnlinks href=#hl-8-70>70</a>
</span><span class=lnt id=hl-8-71><a class=lnlinks href=#hl-8-71>71</a>
</span><span class=lnt id=hl-8-72><a class=lnlinks href=#hl-8-72>72</a>
</span><span class=lnt id=hl-8-73><a class=lnlinks href=#hl-8-73>73</a>
</span><span class=lnt id=hl-8-74><a class=lnlinks href=#hl-8-74>74</a>
</span><span class=lnt id=hl-8-75><a class=lnlinks href=#hl-8-75>75</a>
</span><span class=lnt id=hl-8-76><a class=lnlinks href=#hl-8-76>76</a>
</span><span class=lnt id=hl-8-77><a class=lnlinks href=#hl-8-77>77</a>
</span><span class=lnt id=hl-8-78><a class=lnlinks href=#hl-8-78>78</a>
</span><span class=lnt id=hl-8-79><a class=lnlinks href=#hl-8-79>79</a>
</span><span class=lnt id=hl-8-80><a class=lnlinks href=#hl-8-80>80</a>
</span><span class=lnt id=hl-8-81><a class=lnlinks href=#hl-8-81>81</a>
</span><span class=lnt id=hl-8-82><a class=lnlinks href=#hl-8-82>82</a>
</span><span class=lnt id=hl-8-83><a class=lnlinks href=#hl-8-83>83</a>
</span><span class=lnt id=hl-8-84><a class=lnlinks href=#hl-8-84>84</a>
</span><span class=lnt id=hl-8-85><a class=lnlinks href=#hl-8-85>85</a>
</span><span class=lnt id=hl-8-86><a class=lnlinks href=#hl-8-86>86</a>
</span><span class=lnt id=hl-8-87><a class=lnlinks href=#hl-8-87>87</a>
</span><span class=lnt id=hl-8-88><a class=lnlinks href=#hl-8-88>88</a>
</span><span class=lnt id=hl-8-89><a class=lnlinks href=#hl-8-89>89</a>
</span><span class=lnt id=hl-8-90><a class=lnlinks href=#hl-8-90>90</a>
</span><span class=lnt id=hl-8-91><a class=lnlinks href=#hl-8-91>91</a>
</span><span class=lnt id=hl-8-92><a class=lnlinks href=#hl-8-92>92</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 재시도 큐와 데드 레터 큐 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>setupQueues</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 데드 레터 익스체인지 및 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertExchange</span><span class=p>(</span><span class=s1>&#39;dlx.payment&#39;</span><span class=p>,</span> <span class=s1>&#39;direct&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;payment.failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-message-ttl&#39;</span><span class=o>:</span> <span class=mi>86400000</span>  <span class=c1>// 24시간 보관
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>bindQueue</span><span class=p>(</span><span class=s1>&#39;payment.failed&#39;</span><span class=p>,</span> <span class=s1>&#39;dlx.payment&#39;</span><span class=p>,</span> <span class=s1>&#39;payment&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 재시도 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;payment.retry&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-routing-key&#39;</span><span class=o>:</span> <span class=s1>&#39;payment.process&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-message-ttl&#39;</span><span class=o>:</span> <span class=mi>60000</span>  <span class=c1>// 1분 후 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 메인 처리 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;payment.process&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=o>:</span> <span class=s1>&#39;dlx.payment&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-routing-key&#39;</span><span class=o>:</span> <span class=s1>&#39;payment&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>connection</span><span class=p>,</span> <span class=nx>channel</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>setupConsumer</span><span class=p>(</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>channel</span><span class=p>.</span><span class=nx>prefetch</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=s1>&#39;payment.process&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>payment</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 처리 중: </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 결제 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>processed</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>payment</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>processed</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 성공적으로 처리됨
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 성공: </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 일시적 오류, 재시도 필요
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>retryCount</span> <span class=o>=</span> <span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>properties</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;x-retry-count&#39;</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>retryCount</span> <span class=o>&lt;=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 재시도 큐로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>channel</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;payment.retry&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-retry-count&#39;</span><span class=o>:</span> <span class=nx>retryCount</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 재시도 예약 (</span><span class=si>${</span><span class=nx>retryCount</span><span class=si>}</span><span class=sb>/3): </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 최대 재시도 횟수 초과, 데드 레터 큐로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>channel</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 실패, 데드 레터로 이동: </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 처리 중 오류 발생
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`결제 처리 오류: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>channel</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>payment</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 실제 결제 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>;</span>  <span class=c1>// 70% 성공률 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>connection</span><span class=p>,</span> <span class=nx>channel</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>setupQueues</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>setupConsumer</span><span class=p>(</span><span class=nx>channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;결제 처리 서비스 실행 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-메시지-유효기간ttl-time-to-live>3. 메시지 유효기간(TTL, Time-To-Live)<a hidden class=anchor aria-hidden=true href=#3-메시지-유효기간ttl-time-to-live>#</a></h4><p>메시지가 큐에 머무를 수 있는 최대 시간을 설정하는 기능으로, 오래된 메시지가 시스템 리소스를 차지하지 않도록 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33>33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34>34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35>35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36>36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37>37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38>38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39>39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40>40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41>41</a>
</span><span class=lnt id=hl-9-42><a class=lnlinks href=#hl-9-42>42</a>
</span><span class=lnt id=hl-9-43><a class=lnlinks href=#hl-9-43>43</a>
</span><span class=lnt id=hl-9-44><a class=lnlinks href=#hl-9-44>44</a>
</span><span class=lnt id=hl-9-45><a class=lnlinks href=#hl-9-45>45</a>
</span><span class=lnt id=hl-9-46><a class=lnlinks href=#hl-9-46>46</a>
</span><span class=lnt id=hl-9-47><a class=lnlinks href=#hl-9-47>47</a>
</span><span class=lnt id=hl-9-48><a class=lnlinks href=#hl-9-48>48</a>
</span><span class=lnt id=hl-9-49><a class=lnlinks href=#hl-9-49>49</a>
</span><span class=lnt id=hl-9-50><a class=lnlinks href=#hl-9-50>50</a>
</span><span class=lnt id=hl-9-51><a class=lnlinks href=#hl-9-51>51</a>
</span><span class=lnt id=hl-9-52><a class=lnlinks href=#hl-9-52>52</a>
</span><span class=lnt id=hl-9-53><a class=lnlinks href=#hl-9-53>53</a>
</span><span class=lnt id=hl-9-54><a class=lnlinks href=#hl-9-54>54</a>
</span><span class=lnt id=hl-9-55><a class=lnlinks href=#hl-9-55>55</a>
</span><span class=lnt id=hl-9-56><a class=lnlinks href=#hl-9-56>56</a>
</span><span class=lnt id=hl-9-57><a class=lnlinks href=#hl-9-57>57</a>
</span><span class=lnt id=hl-9-58><a class=lnlinks href=#hl-9-58>58</a>
</span><span class=lnt id=hl-9-59><a class=lnlinks href=#hl-9-59>59</a>
</span><span class=lnt id=hl-9-60><a class=lnlinks href=#hl-9-60>60</a>
</span><span class=lnt id=hl-9-61><a class=lnlinks href=#hl-9-61>61</a>
</span><span class=lnt id=hl-9-62><a class=lnlinks href=#hl-9-62>62</a>
</span><span class=lnt id=hl-9-63><a class=lnlinks href=#hl-9-63>63</a>
</span><span class=lnt id=hl-9-64><a class=lnlinks href=#hl-9-64>64</a>
</span><span class=lnt id=hl-9-65><a class=lnlinks href=#hl-9-65>65</a>
</span><span class=lnt id=hl-9-66><a class=lnlinks href=#hl-9-66>66</a>
</span><span class=lnt id=hl-9-67><a class=lnlinks href=#hl-9-67>67</a>
</span><span class=lnt id=hl-9-68><a class=lnlinks href=#hl-9-68>68</a>
</span><span class=lnt id=hl-9-69><a class=lnlinks href=#hl-9-69>69</a>
</span><span class=lnt id=hl-9-70><a class=lnlinks href=#hl-9-70>70</a>
</span><span class=lnt id=hl-9-71><a class=lnlinks href=#hl-9-71>71</a>
</span><span class=lnt id=hl-9-72><a class=lnlinks href=#hl-9-72>72</a>
</span><span class=lnt id=hl-9-73><a class=lnlinks href=#hl-9-73>73</a>
</span><span class=lnt id=hl-9-74><a class=lnlinks href=#hl-9-74>74</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C#에서 메시지 TTL 설정 예시 (RabbitMQ.Client 사용)</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>NotificationSender</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>NotificationSender</span><span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// TTL이 적용된 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>queueArgs</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>object</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=s>&#34;x-message-ttl&#34;</span><span class=p>,</span> <span class=m>300000</span> <span class=p>}</span>  <span class=c1>// 5분 TTL</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=s>&#34;notifications.transient&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>arguments</span><span class=p>:</span> <span class=n>queueArgs</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SendTransientNotification</span><span class=p>(</span><span class=kt>string</span> <span class=n>userId</span><span class=p>,</span> <span class=kt>string</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>notification</span> <span class=p>=</span> <span class=k>new</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UserId</span> <span class=p>=</span> <span class=n>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Message</span> <span class=p>=</span> <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Timestamp</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=n>Text</span><span class=p>.</span><span class=n>Json</span><span class=p>.</span><span class=n>JsonSerializer</span><span class=p>.</span><span class=n>Serialize</span><span class=p>(</span><span class=n>notification</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=s>&#34;notifications.transient&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SendPriorityNotification</span><span class=p>(</span><span class=kt>string</span> <span class=n>userId</span><span class=p>,</span> <span class=kt>string</span> <span class=n>message</span><span class=p>,</span> <span class=kt>int</span> <span class=n>expirationSeconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>notification</span> <span class=p>=</span> <span class=k>new</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UserId</span> <span class=p>=</span> <span class=n>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Message</span> <span class=p>=</span> <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Timestamp</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=n>Text</span><span class=p>.</span><span class=n>Json</span><span class=p>.</span><span class=n>JsonSerializer</span><span class=p>.</span><span class=n>Serialize</span><span class=p>(</span><span class=n>notification</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Expiration</span> <span class=p>=</span> <span class=p>(</span><span class=n>expirationSeconds</span> <span class=p>*</span> <span class=m>1000</span><span class=p>).</span><span class=n>ToString</span><span class=p>();</span>  <span class=c1>// 개별 메시지 TTL 설정</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=s>&#34;notifications.priority&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=메시지-지연-전송delayed-delivery>메시지 지연 전송(Delayed Delivery)<a hidden class=anchor aria-hidden=true href=#메시지-지연-전송delayed-delivery>#</a></h4><p>메시지를 즉시 처리하지 않고 일정 시간 후에 처리하도록 예약하는 기능이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32>32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33>33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34>34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35>35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36>36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37>37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38>38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39>39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40>40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41>41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42>42</a>
</span><span class=lnt id=hl-10-43><a class=lnlinks href=#hl-10-43>43</a>
</span><span class=lnt id=hl-10-44><a class=lnlinks href=#hl-10-44>44</a>
</span><span class=lnt id=hl-10-45><a class=lnlinks href=#hl-10-45>45</a>
</span><span class=lnt id=hl-10-46><a class=lnlinks href=#hl-10-46>46</a>
</span><span class=lnt id=hl-10-47><a class=lnlinks href=#hl-10-47>47</a>
</span><span class=lnt id=hl-10-48><a class=lnlinks href=#hl-10-48>48</a>
</span><span class=lnt id=hl-10-49><a class=lnlinks href=#hl-10-49>49</a>
</span><span class=lnt id=hl-10-50><a class=lnlinks href=#hl-10-50>50</a>
</span><span class=lnt id=hl-10-51><a class=lnlinks href=#hl-10-51>51</a>
</span><span class=lnt id=hl-10-52><a class=lnlinks href=#hl-10-52>52</a>
</span><span class=lnt id=hl-10-53><a class=lnlinks href=#hl-10-53>53</a>
</span><span class=lnt id=hl-10-54><a class=lnlinks href=#hl-10-54>54</a>
</span><span class=lnt id=hl-10-55><a class=lnlinks href=#hl-10-55>55</a>
</span><span class=lnt id=hl-10-56><a class=lnlinks href=#hl-10-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java에서 지연 메시지 구현 예시 (Spring AMQP 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CustomExchange</span><span class=w> </span><span class=nf>delayExchange</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-delayed-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;direct&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomExchange</span><span class=p>(</span><span class=s>&#34;delay.exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;x-delayed-message&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Queue</span><span class=w> </span><span class=nf>reminderQueue</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Queue</span><span class=p>(</span><span class=s>&#34;reminders.queue&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Binding</span><span class=w> </span><span class=nf>reminderBinding</span><span class=p>(</span><span class=n>Queue</span><span class=w> </span><span class=n>reminderQueue</span><span class=p>,</span><span class=w> </span><span class=n>CustomExchange</span><span class=w> </span><span class=n>delayExchange</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>BindingBuilder</span><span class=p>.</span><span class=na>bind</span><span class=p>(</span><span class=n>reminderQueue</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>to</span><span class=p>(</span><span class=n>delayExchange</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=s>&#34;reminders.routing&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>noargs</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReminderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ReminderService</span><span class=p>(</span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>scheduleReminder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>delayInSeconds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Reminder</span><span class=w> </span><span class=n>reminder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Reminder</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>plusSeconds</span><span class=p>(</span><span class=n>delayInSeconds</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;delay.exchange&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;reminders.routing&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>reminder</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;x-delay&#34;</span><span class=p>,</span><span class=w> </span><span class=n>delayInSeconds</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;알림 예약됨: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delayInSeconds</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;초 후 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;님에게 전송&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-기술-비교>메시징 큐 기술 비교<a hidden class=anchor aria-hidden=true href=#메시징-큐-기술-비교>#</a></h3><h4 id=rabbitmq>RabbitMQ<a hidden class=anchor aria-hidden=true href=#rabbitmq>#</a></h4><ul><li><strong>특징</strong>: AMQP 프로토콜 지원, 다양한 메시징 패턴, 고급 라우팅</li><li><strong>장점</strong>: 유연한 라우팅, 플러그인 생태계, 관리 UI</li><li><strong>적합한 경우</strong>: 복잡한 라우팅 요구사항, 다양한 메시징 패턴 필요 시</li></ul><h4 id=apache-kafka>Apache Kafka<a hidden class=anchor aria-hidden=true href=#apache-kafka>#</a></h4><ul><li><strong>특징</strong>: 분산 스트리밍 플랫폼, 높은 처리량, 로그 보존</li><li><strong>장점</strong>: 확장성, 내구성, 실시간 스트림 처리</li><li><strong>적합한 경우</strong>: 대용량 이벤트 스트리밍, 실시간 분석, 이벤트 소싱</li></ul><h4 id=amazon-sqssns>Amazon SQS/SNS<a hidden class=anchor aria-hidden=true href=#amazon-sqssns>#</a></h4><ul><li><strong>특징</strong>: 관리형 메시징 서비스, 서버리스 운영</li><li><strong>장점</strong>: 운영 오버헤드 없음, 자동 확장</li><li><strong>적합한 경우</strong>: AWS 인프라 사용, 최소한의 운영 복잡성 추구</li></ul><h4 id=redis-pubsub>Redis Pub/Sub<a hidden class=anchor aria-hidden=true href=#redis-pubsub>#</a></h4><ul><li><strong>특징</strong>: 인메모리 데이터 스토어 기반 메시징</li><li><strong>장점</strong>: 빠른 처리 속도, 간단한 설정</li><li><strong>적합한 경우</strong>: 짧은 지연 시간 요구사항, 간단한 메시징 요구사항</li></ul><h3 id=api-시스템에서-메시징-큐-사용-사례>API 시스템에서 메시징 큐 사용 사례<a hidden class=anchor aria-hidden=true href=#api-시스템에서-메시징-큐-사용-사례>#</a></h3><h4 id=비동기-작업-처리>비동기 작업 처리<a hidden class=anchor aria-hidden=true href=#비동기-작업-처리>#</a></h4><p>오래 걸리는 작업을 비동기적으로 처리하여 API의 응답 시간을 개선할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Kotlin Spring Boot 비동기 작업 처리 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s2>&#34;/api/reports&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ReportController</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>reportPublisher</span><span class=p>:</span> <span class=n>ReportPublisher</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>reportRepository</span><span class=p>:</span> <span class=n>ReportRepository</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>generateReport</span><span class=p>(</span><span class=nd>@RequestBody</span> <span class=n>request</span><span class=p>:</span> <span class=n>ReportRequest</span><span class=p>):</span> <span class=n>ResponseEntity</span><span class=p>&lt;</span><span class=n>ReportResponse</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 보고서 작업 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>val</span> <span class=py>reportJob</span> <span class=p>=</span> <span class=n>ReportJob</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>id</span> <span class=p>=</span> <span class=nc>UUID</span><span class=p>.</span><span class=n>randomUUID</span><span class=p>().</span><span class=n>toString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>userId</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>parameters</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>parameters</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span> <span class=p>=</span> <span class=nc>ReportStatus</span><span class=p>.</span><span class=n>PENDING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>createdAt</span> <span class=p>=</span> <span class=nc>LocalDateTime</span><span class=p>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 작업 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>reportRepository</span><span class=p>.</span><span class=n>save</span><span class=p>(</span><span class=n>reportJob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 작업을 큐에 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>reportPublisher</span><span class=p>.</span><span class=n>publishReportJob</span><span class=p>(</span><span class=n>reportJob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 즉시 응답 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>ResponseEntity</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>accepted</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>body</span><span class=p>(</span><span class=n>ReportResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>jobId</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>statusUrl</span> <span class=p>=</span> <span class=s2>&#34;/api/reports/</span><span class=si>${reportJob.id}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@GetMapping</span><span class=p>(</span><span class=s2>&#34;/{jobId}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>getReportStatus</span><span class=p>(</span><span class=nd>@PathVariable</span> <span class=n>jobId</span><span class=p>:</span> <span class=n>String</span><span class=p>):</span> <span class=n>ResponseEntity</span><span class=p>&lt;</span><span class=n>ReportJobStatus</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>reportJob</span> <span class=p>=</span> <span class=n>reportRepository</span><span class=p>.</span><span class=n>findById</span><span class=p>(</span><span class=n>jobId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=o>?:</span> <span class=k>return</span> <span class=nc>ResponseEntity</span><span class=p>.</span><span class=n>notFound</span><span class=p>().</span><span class=n>build</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nc>ResponseEntity</span><span class=p>.</span><span class=n>ok</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>ReportJobStatus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>jobId</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>progress</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>progress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>createdAt</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>createdAt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>completedAt</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>completedAt</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=시스템-간-통합>시스템 간 통합<a hidden class=anchor aria-hidden=true href=#시스템-간-통합>#</a></h4><p>여러 시스템 간의 느슨한 결합을 통해 확장성과 유연성을 제공한다. 각 시스템은 독립적으로 진화하면서도 메시지를 통해 효과적으로 통신할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34>34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35>35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36>36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37>37</a>
</span><span class=lnt id=hl-12-38><a class=lnlinks href=#hl-12-38>38</a>
</span><span class=lnt id=hl-12-39><a class=lnlinks href=#hl-12-39>39</a>
</span><span class=lnt id=hl-12-40><a class=lnlinks href=#hl-12-40>40</a>
</span><span class=lnt id=hl-12-41><a class=lnlinks href=#hl-12-41>41</a>
</span><span class=lnt id=hl-12-42><a class=lnlinks href=#hl-12-42>42</a>
</span><span class=lnt id=hl-12-43><a class=lnlinks href=#hl-12-43>43</a>
</span><span class=lnt id=hl-12-44><a class=lnlinks href=#hl-12-44>44</a>
</span><span class=lnt id=hl-12-45><a class=lnlinks href=#hl-12-45>45</a>
</span><span class=lnt id=hl-12-46><a class=lnlinks href=#hl-12-46>46</a>
</span><span class=lnt id=hl-12-47><a class=lnlinks href=#hl-12-47>47</a>
</span><span class=lnt id=hl-12-48><a class=lnlinks href=#hl-12-48>48</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 주문 시스템에서 결제 시스템으로 메시지 전송 예시 (Java)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderCompletionService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JmsTemplate</span><span class=w> </span><span class=n>jmsTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OrderCompletionService</span><span class=p>(</span><span class=n>JmsTemplate</span><span class=w> </span><span class=n>jmsTemplate</span><span class=p>,</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jmsTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jmsTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>orderRepository</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>completeOrder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>PaymentDetails</span><span class=w> </span><span class=n>paymentDetails</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderNotFoundException</span><span class=p>(</span><span class=n>orderId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PAID</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setPaymentDetails</span><span class=p>(</span><span class=n>paymentDetails</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setUpdatedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 완료 메시지를 다른 시스템에 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderPaidEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderPaidEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getPaymentMethod</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getShippingAddress</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 배송 시스템에 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jmsTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;shipping.orders.paid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재고 시스템에 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jmsTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;inventory.orders.paid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 고객 알림 시스템에 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jmsTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;notifications.orders.paid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;주문 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>orderId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; 완료 메시지 전송됨&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=부하-분산-및-처리량-향상>부하 분산 및 처리량 향상<a hidden class=anchor aria-hidden=true href=#부하-분산-및-처리량-향상>#</a></h4><p>트래픽이 많은 작업을 여러 워커 인스턴스로 분산하여 시스템의 전체 처리량을 향상시킬 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38>38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39>39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40>40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41>41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42>42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43>43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44>44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45>45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46>46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47>47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48>48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49>49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50>50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51>51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52>52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53>53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54>54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55>55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56>56</a>
</span><span class=lnt id=hl-13-57><a class=lnlinks href=#hl-13-57>57</a>
</span><span class=lnt id=hl-13-58><a class=lnlinks href=#hl-13-58>58</a>
</span><span class=lnt id=hl-13-59><a class=lnlinks href=#hl-13-59>59</a>
</span><span class=lnt id=hl-13-60><a class=lnlinks href=#hl-13-60>60</a>
</span><span class=lnt id=hl-13-61><a class=lnlinks href=#hl-13-61>61</a>
</span><span class=lnt id=hl-13-62><a class=lnlinks href=#hl-13-62>62</a>
</span><span class=lnt id=hl-13-63><a class=lnlinks href=#hl-13-63>63</a>
</span><span class=lnt id=hl-13-64><a class=lnlinks href=#hl-13-64>64</a>
</span><span class=lnt id=hl-13-65><a class=lnlinks href=#hl-13-65>65</a>
</span><span class=lnt id=hl-13-66><a class=lnlinks href=#hl-13-66>66</a>
</span><span class=lnt id=hl-13-67><a class=lnlinks href=#hl-13-67>67</a>
</span><span class=lnt id=hl-13-68><a class=lnlinks href=#hl-13-68>68</a>
</span><span class=lnt id=hl-13-69><a class=lnlinks href=#hl-13-69>69</a>
</span><span class=lnt id=hl-13-70><a class=lnlinks href=#hl-13-70>70</a>
</span><span class=lnt id=hl-13-71><a class=lnlinks href=#hl-13-71>71</a>
</span><span class=lnt id=hl-13-72><a class=lnlinks href=#hl-13-72>72</a>
</span><span class=lnt id=hl-13-73><a class=lnlinks href=#hl-13-73>73</a>
</span><span class=lnt id=hl-13-74><a class=lnlinks href=#hl-13-74>74</a>
</span><span class=lnt id=hl-13-75><a class=lnlinks href=#hl-13-75>75</a>
</span><span class=lnt id=hl-13-76><a class=lnlinks href=#hl-13-76>76</a>
</span><span class=lnt id=hl-13-77><a class=lnlinks href=#hl-13-77>77</a>
</span><span class=lnt id=hl-13-78><a class=lnlinks href=#hl-13-78>78</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python FastAPI에서 이미지 처리 부하 분산 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>File</span><span class=p>,</span> <span class=n>UploadFile</span><span class=p>,</span> <span class=n>BackgroundTasks</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.responses</span> <span class=kn>import</span> <span class=n>JSONResponse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aio_pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_rabbitmq_connection</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=n>aio_pika</span><span class=o>.</span><span class=n>connect_robust</span><span class=p>(</span><span class=s2>&#34;amqp://guest:guest@localhost/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이미지 업로드 및 처리 요청 API</span>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/images/process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>process_image</span><span class=p>(</span><span class=n>file</span><span class=p>:</span> <span class=n>UploadFile</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>background_tasks</span><span class=p>:</span> <span class=n>BackgroundTasks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 파일 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>file_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;uploads/</span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s2>&#34;uploads&#34;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=k>await</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>buffer</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이미지 처리 작업 큐에 전송</span>
</span></span><span class=line><span class=cl>    <span class=n>background_tasks</span><span class=o>.</span><span class=n>add_task</span><span class=p>(</span><span class=n>send_to_processing_queue</span><span class=p>,</span> <span class=n>file_id</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>status_code</span><span class=o>=</span><span class=mi>202</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;이미지 처리가 시작되었습니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file_id&#34;</span><span class=p>:</span> <span class=n>file_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status_url&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;/api/images/status/</span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이미지 처리 작업을 큐에 전송</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>send_to_processing_queue</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_rabbitmq_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이미지 처리 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_queue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;image_processing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 생성 및 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>message_body</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file_id&#34;</span><span class=p>:</span> <span class=n>file_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file_path&#34;</span><span class=p>:</span> <span class=n>file_path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>default_exchange</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aio_pika</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>body</span><span class=o>=</span><span class=n>message_body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>delivery_mode</span><span class=o>=</span><span class=n>aio_pika</span><span class=o>.</span><span class=n>DeliveryMode</span><span class=o>.</span><span class=n>PERSISTENT</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s2>&#34;image_processing&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이미지 처리 요청이 큐에 전송됨: </span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이미지 처리 상태 확인 API</span>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/api/images/status/</span><span class=si>{file_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_image_status</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 구현에서는 DB에서 처리 상태 조회</span>
</span></span><span class=line><span class=cl>    <span class=c1># 여기서는 간단한 예시만 표시</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_id&#34;</span><span class=p>:</span> <span class=n>file_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;processing&#34;</span><span class=p>,</span>  <span class=c1># 실제로는 DB에서 현재 상태 조회</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;이미지가 처리 중입니다.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=장애-격리-및-복원력>장애 격리 및 복원력<a hidden class=anchor aria-hidden=true href=#장애-격리-및-복원력>#</a></h4><p>일시적인 장애나 부하 증가에도 시스템이 계속 작동할 수 있도록 메시지를 버퍼링하고 재시도 메커니즘을 구현한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>  1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>  2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>  3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>  4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>  5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>  6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>  7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>  8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>  9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10> 10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11> 11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12> 12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13> 13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14> 14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15> 15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16> 16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17> 17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18> 18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19> 19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20> 20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21> 21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22> 22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23> 23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24> 24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25> 25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26> 26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27> 27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28> 28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29> 29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30> 30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31> 31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32> 32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33> 33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34> 34</a>
</span><span class=lnt id=hl-14-35><a class=lnlinks href=#hl-14-35> 35</a>
</span><span class=lnt id=hl-14-36><a class=lnlinks href=#hl-14-36> 36</a>
</span><span class=lnt id=hl-14-37><a class=lnlinks href=#hl-14-37> 37</a>
</span><span class=lnt id=hl-14-38><a class=lnlinks href=#hl-14-38> 38</a>
</span><span class=lnt id=hl-14-39><a class=lnlinks href=#hl-14-39> 39</a>
</span><span class=lnt id=hl-14-40><a class=lnlinks href=#hl-14-40> 40</a>
</span><span class=lnt id=hl-14-41><a class=lnlinks href=#hl-14-41> 41</a>
</span><span class=lnt id=hl-14-42><a class=lnlinks href=#hl-14-42> 42</a>
</span><span class=lnt id=hl-14-43><a class=lnlinks href=#hl-14-43> 43</a>
</span><span class=lnt id=hl-14-44><a class=lnlinks href=#hl-14-44> 44</a>
</span><span class=lnt id=hl-14-45><a class=lnlinks href=#hl-14-45> 45</a>
</span><span class=lnt id=hl-14-46><a class=lnlinks href=#hl-14-46> 46</a>
</span><span class=lnt id=hl-14-47><a class=lnlinks href=#hl-14-47> 47</a>
</span><span class=lnt id=hl-14-48><a class=lnlinks href=#hl-14-48> 48</a>
</span><span class=lnt id=hl-14-49><a class=lnlinks href=#hl-14-49> 49</a>
</span><span class=lnt id=hl-14-50><a class=lnlinks href=#hl-14-50> 50</a>
</span><span class=lnt id=hl-14-51><a class=lnlinks href=#hl-14-51> 51</a>
</span><span class=lnt id=hl-14-52><a class=lnlinks href=#hl-14-52> 52</a>
</span><span class=lnt id=hl-14-53><a class=lnlinks href=#hl-14-53> 53</a>
</span><span class=lnt id=hl-14-54><a class=lnlinks href=#hl-14-54> 54</a>
</span><span class=lnt id=hl-14-55><a class=lnlinks href=#hl-14-55> 55</a>
</span><span class=lnt id=hl-14-56><a class=lnlinks href=#hl-14-56> 56</a>
</span><span class=lnt id=hl-14-57><a class=lnlinks href=#hl-14-57> 57</a>
</span><span class=lnt id=hl-14-58><a class=lnlinks href=#hl-14-58> 58</a>
</span><span class=lnt id=hl-14-59><a class=lnlinks href=#hl-14-59> 59</a>
</span><span class=lnt id=hl-14-60><a class=lnlinks href=#hl-14-60> 60</a>
</span><span class=lnt id=hl-14-61><a class=lnlinks href=#hl-14-61> 61</a>
</span><span class=lnt id=hl-14-62><a class=lnlinks href=#hl-14-62> 62</a>
</span><span class=lnt id=hl-14-63><a class=lnlinks href=#hl-14-63> 63</a>
</span><span class=lnt id=hl-14-64><a class=lnlinks href=#hl-14-64> 64</a>
</span><span class=lnt id=hl-14-65><a class=lnlinks href=#hl-14-65> 65</a>
</span><span class=lnt id=hl-14-66><a class=lnlinks href=#hl-14-66> 66</a>
</span><span class=lnt id=hl-14-67><a class=lnlinks href=#hl-14-67> 67</a>
</span><span class=lnt id=hl-14-68><a class=lnlinks href=#hl-14-68> 68</a>
</span><span class=lnt id=hl-14-69><a class=lnlinks href=#hl-14-69> 69</a>
</span><span class=lnt id=hl-14-70><a class=lnlinks href=#hl-14-70> 70</a>
</span><span class=lnt id=hl-14-71><a class=lnlinks href=#hl-14-71> 71</a>
</span><span class=lnt id=hl-14-72><a class=lnlinks href=#hl-14-72> 72</a>
</span><span class=lnt id=hl-14-73><a class=lnlinks href=#hl-14-73> 73</a>
</span><span class=lnt id=hl-14-74><a class=lnlinks href=#hl-14-74> 74</a>
</span><span class=lnt id=hl-14-75><a class=lnlinks href=#hl-14-75> 75</a>
</span><span class=lnt id=hl-14-76><a class=lnlinks href=#hl-14-76> 76</a>
</span><span class=lnt id=hl-14-77><a class=lnlinks href=#hl-14-77> 77</a>
</span><span class=lnt id=hl-14-78><a class=lnlinks href=#hl-14-78> 78</a>
</span><span class=lnt id=hl-14-79><a class=lnlinks href=#hl-14-79> 79</a>
</span><span class=lnt id=hl-14-80><a class=lnlinks href=#hl-14-80> 80</a>
</span><span class=lnt id=hl-14-81><a class=lnlinks href=#hl-14-81> 81</a>
</span><span class=lnt id=hl-14-82><a class=lnlinks href=#hl-14-82> 82</a>
</span><span class=lnt id=hl-14-83><a class=lnlinks href=#hl-14-83> 83</a>
</span><span class=lnt id=hl-14-84><a class=lnlinks href=#hl-14-84> 84</a>
</span><span class=lnt id=hl-14-85><a class=lnlinks href=#hl-14-85> 85</a>
</span><span class=lnt id=hl-14-86><a class=lnlinks href=#hl-14-86> 86</a>
</span><span class=lnt id=hl-14-87><a class=lnlinks href=#hl-14-87> 87</a>
</span><span class=lnt id=hl-14-88><a class=lnlinks href=#hl-14-88> 88</a>
</span><span class=lnt id=hl-14-89><a class=lnlinks href=#hl-14-89> 89</a>
</span><span class=lnt id=hl-14-90><a class=lnlinks href=#hl-14-90> 90</a>
</span><span class=lnt id=hl-14-91><a class=lnlinks href=#hl-14-91> 91</a>
</span><span class=lnt id=hl-14-92><a class=lnlinks href=#hl-14-92> 92</a>
</span><span class=lnt id=hl-14-93><a class=lnlinks href=#hl-14-93> 93</a>
</span><span class=lnt id=hl-14-94><a class=lnlinks href=#hl-14-94> 94</a>
</span><span class=lnt id=hl-14-95><a class=lnlinks href=#hl-14-95> 95</a>
</span><span class=lnt id=hl-14-96><a class=lnlinks href=#hl-14-96> 96</a>
</span><span class=lnt id=hl-14-97><a class=lnlinks href=#hl-14-97> 97</a>
</span><span class=lnt id=hl-14-98><a class=lnlinks href=#hl-14-98> 98</a>
</span><span class=lnt id=hl-14-99><a class=lnlinks href=#hl-14-99> 99</a>
</span><span class=lnt id=hl-14-100><a class=lnlinks href=#hl-14-100>100</a>
</span><span class=lnt id=hl-14-101><a class=lnlinks href=#hl-14-101>101</a>
</span><span class=lnt id=hl-14-102><a class=lnlinks href=#hl-14-102>102</a>
</span><span class=lnt id=hl-14-103><a class=lnlinks href=#hl-14-103>103</a>
</span><span class=lnt id=hl-14-104><a class=lnlinks href=#hl-14-104>104</a>
</span><span class=lnt id=hl-14-105><a class=lnlinks href=#hl-14-105>105</a>
</span><span class=lnt id=hl-14-106><a class=lnlinks href=#hl-14-106>106</a>
</span><span class=lnt id=hl-14-107><a class=lnlinks href=#hl-14-107>107</a>
</span><span class=lnt id=hl-14-108><a class=lnlinks href=#hl-14-108>108</a>
</span><span class=lnt id=hl-14-109><a class=lnlinks href=#hl-14-109>109</a>
</span><span class=lnt id=hl-14-110><a class=lnlinks href=#hl-14-110>110</a>
</span><span class=lnt id=hl-14-111><a class=lnlinks href=#hl-14-111>111</a>
</span><span class=lnt id=hl-14-112><a class=lnlinks href=#hl-14-112>112</a>
</span><span class=lnt id=hl-14-113><a class=lnlinks href=#hl-14-113>113</a>
</span><span class=lnt id=hl-14-114><a class=lnlinks href=#hl-14-114>114</a>
</span><span class=lnt id=hl-14-115><a class=lnlinks href=#hl-14-115>115</a>
</span><span class=lnt id=hl-14-116><a class=lnlinks href=#hl-14-116>116</a>
</span><span class=lnt id=hl-14-117><a class=lnlinks href=#hl-14-117>117</a>
</span><span class=lnt id=hl-14-118><a class=lnlinks href=#hl-14-118>118</a>
</span><span class=lnt id=hl-14-119><a class=lnlinks href=#hl-14-119>119</a>
</span><span class=lnt id=hl-14-120><a class=lnlinks href=#hl-14-120>120</a>
</span><span class=lnt id=hl-14-121><a class=lnlinks href=#hl-14-121>121</a>
</span><span class=lnt id=hl-14-122><a class=lnlinks href=#hl-14-122>122</a>
</span><span class=lnt id=hl-14-123><a class=lnlinks href=#hl-14-123>123</a>
</span><span class=lnt id=hl-14-124><a class=lnlinks href=#hl-14-124>124</a>
</span><span class=lnt id=hl-14-125><a class=lnlinks href=#hl-14-125>125</a>
</span><span class=lnt id=hl-14-126><a class=lnlinks href=#hl-14-126>126</a>
</span><span class=lnt id=hl-14-127><a class=lnlinks href=#hl-14-127>127</a>
</span><span class=lnt id=hl-14-128><a class=lnlinks href=#hl-14-128>128</a>
</span><span class=lnt id=hl-14-129><a class=lnlinks href=#hl-14-129>129</a>
</span><span class=lnt id=hl-14-130><a class=lnlinks href=#hl-14-130>130</a>
</span><span class=lnt id=hl-14-131><a class=lnlinks href=#hl-14-131>131</a>
</span><span class=lnt id=hl-14-132><a class=lnlinks href=#hl-14-132>132</a>
</span><span class=lnt id=hl-14-133><a class=lnlinks href=#hl-14-133>133</a>
</span><span class=lnt id=hl-14-134><a class=lnlinks href=#hl-14-134>134</a>
</span><span class=lnt id=hl-14-135><a class=lnlinks href=#hl-14-135>135</a>
</span><span class=lnt id=hl-14-136><a class=lnlinks href=#hl-14-136>136</a>
</span><span class=lnt id=hl-14-137><a class=lnlinks href=#hl-14-137>137</a>
</span><span class=lnt id=hl-14-138><a class=lnlinks href=#hl-14-138>138</a>
</span><span class=lnt id=hl-14-139><a class=lnlinks href=#hl-14-139>139</a>
</span><span class=lnt id=hl-14-140><a class=lnlinks href=#hl-14-140>140</a>
</span><span class=lnt id=hl-14-141><a class=lnlinks href=#hl-14-141>141</a>
</span><span class=lnt id=hl-14-142><a class=lnlinks href=#hl-14-142>142</a>
</span><span class=lnt id=hl-14-143><a class=lnlinks href=#hl-14-143>143</a>
</span><span class=lnt id=hl-14-144><a class=lnlinks href=#hl-14-144>144</a>
</span><span class=lnt id=hl-14-145><a class=lnlinks href=#hl-14-145>145</a>
</span><span class=lnt id=hl-14-146><a class=lnlinks href=#hl-14-146>146</a>
</span><span class=lnt id=hl-14-147><a class=lnlinks href=#hl-14-147>147</a>
</span><span class=lnt id=hl-14-148><a class=lnlinks href=#hl-14-148>148</a>
</span><span class=lnt id=hl-14-149><a class=lnlinks href=#hl-14-149>149</a>
</span><span class=lnt id=hl-14-150><a class=lnlinks href=#hl-14-150>150</a>
</span><span class=lnt id=hl-14-151><a class=lnlinks href=#hl-14-151>151</a>
</span><span class=lnt id=hl-14-152><a class=lnlinks href=#hl-14-152>152</a>
</span><span class=lnt id=hl-14-153><a class=lnlinks href=#hl-14-153>153</a>
</span><span class=lnt id=hl-14-154><a class=lnlinks href=#hl-14-154>154</a>
</span><span class=lnt id=hl-14-155><a class=lnlinks href=#hl-14-155>155</a>
</span><span class=lnt id=hl-14-156><a class=lnlinks href=#hl-14-156>156</a>
</span><span class=lnt id=hl-14-157><a class=lnlinks href=#hl-14-157>157</a>
</span><span class=lnt id=hl-14-158><a class=lnlinks href=#hl-14-158>158</a>
</span><span class=lnt id=hl-14-159><a class=lnlinks href=#hl-14-159>159</a>
</span><span class=lnt id=hl-14-160><a class=lnlinks href=#hl-14-160>160</a>
</span><span class=lnt id=hl-14-161><a class=lnlinks href=#hl-14-161>161</a>
</span><span class=lnt id=hl-14-162><a class=lnlinks href=#hl-14-162>162</a>
</span><span class=lnt id=hl-14-163><a class=lnlinks href=#hl-14-163>163</a>
</span><span class=lnt id=hl-14-164><a class=lnlinks href=#hl-14-164>164</a>
</span><span class=lnt id=hl-14-165><a class=lnlinks href=#hl-14-165>165</a>
</span><span class=lnt id=hl-14-166><a class=lnlinks href=#hl-14-166>166</a>
</span><span class=lnt id=hl-14-167><a class=lnlinks href=#hl-14-167>167</a>
</span><span class=lnt id=hl-14-168><a class=lnlinks href=#hl-14-168>168</a>
</span><span class=lnt id=hl-14-169><a class=lnlinks href=#hl-14-169>169</a>
</span><span class=lnt id=hl-14-170><a class=lnlinks href=#hl-14-170>170</a>
</span><span class=lnt id=hl-14-171><a class=lnlinks href=#hl-14-171>171</a>
</span><span class=lnt id=hl-14-172><a class=lnlinks href=#hl-14-172>172</a>
</span><span class=lnt id=hl-14-173><a class=lnlinks href=#hl-14-173>173</a>
</span><span class=lnt id=hl-14-174><a class=lnlinks href=#hl-14-174>174</a>
</span><span class=lnt id=hl-14-175><a class=lnlinks href=#hl-14-175>175</a>
</span><span class=lnt id=hl-14-176><a class=lnlinks href=#hl-14-176>176</a>
</span><span class=lnt id=hl-14-177><a class=lnlinks href=#hl-14-177>177</a>
</span><span class=lnt id=hl-14-178><a class=lnlinks href=#hl-14-178>178</a>
</span><span class=lnt id=hl-14-179><a class=lnlinks href=#hl-14-179>179</a>
</span><span class=lnt id=hl-14-180><a class=lnlinks href=#hl-14-180>180</a>
</span><span class=lnt id=hl-14-181><a class=lnlinks href=#hl-14-181>181</a>
</span><span class=lnt id=hl-14-182><a class=lnlinks href=#hl-14-182>182</a>
</span><span class=lnt id=hl-14-183><a class=lnlinks href=#hl-14-183>183</a>
</span><span class=lnt id=hl-14-184><a class=lnlinks href=#hl-14-184>184</a>
</span><span class=lnt id=hl-14-185><a class=lnlinks href=#hl-14-185>185</a>
</span><span class=lnt id=hl-14-186><a class=lnlinks href=#hl-14-186>186</a>
</span><span class=lnt id=hl-14-187><a class=lnlinks href=#hl-14-187>187</a>
</span><span class=lnt id=hl-14-188><a class=lnlinks href=#hl-14-188>188</a>
</span><span class=lnt id=hl-14-189><a class=lnlinks href=#hl-14-189>189</a>
</span><span class=lnt id=hl-14-190><a class=lnlinks href=#hl-14-190>190</a>
</span><span class=lnt id=hl-14-191><a class=lnlinks href=#hl-14-191>191</a>
</span><span class=lnt id=hl-14-192><a class=lnlinks href=#hl-14-192>192</a>
</span><span class=lnt id=hl-14-193><a class=lnlinks href=#hl-14-193>193</a>
</span><span class=lnt id=hl-14-194><a class=lnlinks href=#hl-14-194>194</a>
</span><span class=lnt id=hl-14-195><a class=lnlinks href=#hl-14-195>195</a>
</span><span class=lnt id=hl-14-196><a class=lnlinks href=#hl-14-196>196</a>
</span><span class=lnt id=hl-14-197><a class=lnlinks href=#hl-14-197>197</a>
</span><span class=lnt id=hl-14-198><a class=lnlinks href=#hl-14-198>198</a>
</span><span class=lnt id=hl-14-199><a class=lnlinks href=#hl-14-199>199</a>
</span><span class=lnt id=hl-14-200><a class=lnlinks href=#hl-14-200>200</a>
</span><span class=lnt id=hl-14-201><a class=lnlinks href=#hl-14-201>201</a>
</span><span class=lnt id=hl-14-202><a class=lnlinks href=#hl-14-202>202</a>
</span><span class=lnt id=hl-14-203><a class=lnlinks href=#hl-14-203>203</a>
</span><span class=lnt id=hl-14-204><a class=lnlinks href=#hl-14-204>204</a>
</span><span class=lnt id=hl-14-205><a class=lnlinks href=#hl-14-205>205</a>
</span><span class=lnt id=hl-14-206><a class=lnlinks href=#hl-14-206>206</a>
</span><span class=lnt id=hl-14-207><a class=lnlinks href=#hl-14-207>207</a>
</span><span class=lnt id=hl-14-208><a class=lnlinks href=#hl-14-208>208</a>
</span><span class=lnt id=hl-14-209><a class=lnlinks href=#hl-14-209>209</a>
</span><span class=lnt id=hl-14-210><a class=lnlinks href=#hl-14-210>210</a>
</span><span class=lnt id=hl-14-211><a class=lnlinks href=#hl-14-211>211</a>
</span><span class=lnt id=hl-14-212><a class=lnlinks href=#hl-14-212>212</a>
</span><span class=lnt id=hl-14-213><a class=lnlinks href=#hl-14-213>213</a>
</span><span class=lnt id=hl-14-214><a class=lnlinks href=#hl-14-214>214</a>
</span><span class=lnt id=hl-14-215><a class=lnlinks href=#hl-14-215>215</a>
</span><span class=lnt id=hl-14-216><a class=lnlinks href=#hl-14-216>216</a>
</span><span class=lnt id=hl-14-217><a class=lnlinks href=#hl-14-217>217</a>
</span><span class=lnt id=hl-14-218><a class=lnlinks href=#hl-14-218>218</a>
</span><span class=lnt id=hl-14-219><a class=lnlinks href=#hl-14-219>219</a>
</span><span class=lnt id=hl-14-220><a class=lnlinks href=#hl-14-220>220</a>
</span><span class=lnt id=hl-14-221><a class=lnlinks href=#hl-14-221>221</a>
</span><span class=lnt id=hl-14-222><a class=lnlinks href=#hl-14-222>222</a>
</span><span class=lnt id=hl-14-223><a class=lnlinks href=#hl-14-223>223</a>
</span><span class=lnt id=hl-14-224><a class=lnlinks href=#hl-14-224>224</a>
</span><span class=lnt id=hl-14-225><a class=lnlinks href=#hl-14-225>225</a>
</span><span class=lnt id=hl-14-226><a class=lnlinks href=#hl-14-226>226</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// TypeScript에서 장애 복원력 패턴 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>Channel</span><span class=p>,</span> <span class=nx>Connection</span><span class=p>,</span> <span class=nx>connect</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;amqplib&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ResilientEmailService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>connection</span>: <span class=kt>Connection</span> <span class=o>|</span> <span class=kc>null</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>channel</span>: <span class=kt>Channel</span> <span class=o>|</span> <span class=kc>null</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>maxRetries</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>isConnecting</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>pendingMessages</span>: <span class=kt>any</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 연결 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>setupConnection</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isConnecting</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>isConnecting</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// RabbitMQ 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 연결 오류 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 오류:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결이 닫혔습니다. 재연결 시도 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>(),</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 채널 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 이메일 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;emails&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 재시도 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;emails.retry&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>durable</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;x-dead-letter-routing-key&#39;</span><span class=o>:</span> <span class=s1>&#39;emails&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;x-message-ttl&#39;</span><span class=o>:</span> <span class=mi>60000</span>  <span class=c1>// 1분 후 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 데드 레터 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;emails.failed&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 및 채널 설정 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 대기 중인 메시지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>processPendingMessages</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 설정 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>(),</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>isConnecting</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 연결 리셋
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=nx>resetConnection</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 대기 중인 메시지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>processPendingMessages</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>||</span> <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>messages</span> <span class=o>=</span> <span class=p>[...</span><span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>msg</span> <span class=k>of</span> <span class=nx>messages</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendEmailToQueue</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>retryCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 메시지를 큐에 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>sendEmail</span><span class=p>(</span><span class=nx>to</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>subject</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>body</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>email</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>to</span><span class=p>,</span> <span class=nx>subject</span><span class=p>,</span> <span class=nx>body</span><span class=p>,</span> <span class=nx>timestamp</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 여전히 연결이 없는 경우 대기 중인 메시지에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>email</span><span class=p>,</span> <span class=nx>retryCount</span>: <span class=kt>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendEmailToQueue</span><span class=p>(</span><span class=nx>email</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이메일 전송 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 오류 발생 시 대기 중인 메시지에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>email</span><span class=p>,</span> <span class=nx>retryCount</span>: <span class=kt>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 연결 재설정 시도
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>(),</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일을 큐에 실제로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>sendEmailToQueue</span><span class=p>(</span><span class=nx>email</span>: <span class=kt>any</span><span class=p>,</span> <span class=nx>retryCount</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 채널이 설정되지 않았습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>retryCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>sentAt</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메시지를 이메일 큐에 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;emails&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>message</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>persistent</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-retry-count&#39;</span><span class=o>:</span> <span class=nx>retryCount</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일이 큐에 전송됨: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>, 재시도: </span><span class=si>${</span><span class=nx>retryCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 소비자 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>setupConsumer</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 채널이 설정되지 않았습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 이메일 처리를 위한 소비자 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>prefetch</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=s1>&#39;emails&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>msg</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>email</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 처리 중: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 이메일 전송 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>success</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>deliverEmail</span><span class=p>(</span><span class=nx>email</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 성공적으로 처리됨
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 성공: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 전송 실패, 재시도 필요
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>const</span> <span class=nx>retryCount</span> <span class=o>=</span> <span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>properties</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;x-retry-count&#39;</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>retryCount</span> <span class=o>&lt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>maxRetries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 재시도 큐로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;emails.retry&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>persistent</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-retry-count&#39;</span><span class=o>:</span> <span class=nx>retryCount</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 재시도 예약 (</span><span class=si>${</span><span class=nx>retryCount</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>maxRetries</span><span class=si>}</span><span class=sb>): </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 최대 재시도 횟수 초과, 실패 큐로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;emails.failed&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span> <span class=p>{</span> <span class=nx>persistent</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 실패, 데드 레터로 이동: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이메일 처리 중 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 처리 오류, 데드 레터 큐로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;이메일 소비자가 시작되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 실제 이메일 전송 로직 (외부 서비스 호출)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>deliverEmail</span><span class=p>(</span><span class=nx>email</span>: <span class=kt>any</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>boolean</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실제로는 SMTP 서비스 등을 호출
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 시도: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>, 제목: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>subject</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 성공/실패 시뮬레이션 (80% 성공률)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>isSuccessful</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>isSuccessful</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 일시적 실패: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`이메일 전송 중 오류: </span><span class=si>${</span><span class=nx>error</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>emailService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ResilientEmailService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>emailService</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>emailService</span><span class=p>.</span><span class=nx>setupConsumer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 전송 테스트
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>await</span> <span class=nx>emailService</span><span class=p>.</span><span class=nx>sendEmail</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;user@example.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;중요 알림&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;귀하의 계정에 중요한 변경사항이 있습니다.&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-구현-시-고려사항>메시징 큐 구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#메시징-큐-구현-시-고려사항>#</a></h3><h4 id=메시지-보장성delivery-guarantees>메시지 보장성(Delivery Guarantees)<a hidden class=anchor aria-hidden=true href=#메시지-보장성delivery-guarantees>#</a></h4><p>메시지 전송의 보장 수준에 따라 시스템 설계가 달라진다.</p><ul><li><strong>At-most-once 전달</strong>: 메시지가 최대 한 번 전달되거나 손실될 수 있음 (최소한의 오버헤드)</li><li><strong>At-least-once 전달</strong>: 메시지가 최소 한 번 전달되지만 중복 가능성 있음 (멱등성 필요)</li><li><strong>Exactly-once 전달</strong>: 메시지가 정확히 한 번 전달됨 (가장 높은 오버헤드)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36>36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37>37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38>38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39>39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40>40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41>41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42>42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43>43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44>44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45>45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46>46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47>47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48>48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49>49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50>50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51>51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52>52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53>53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54>54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55>55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56>56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57>57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58>58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59>59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60>60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61>61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// At-least-once 전송을 위한 Java Spring 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ConnectionFactory</span><span class=w> </span><span class=nf>connectionFactory</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CachingConnectionFactory</span><span class=w> </span><span class=n>connectionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CachingConnectionFactory</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;guest&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;guest&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 게시자 확인 활성화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setPublisherConfirmType</span><span class=p>(</span><span class=n>CachingConnectionFactory</span><span class=p>.</span><span class=na>ConfirmType</span><span class=p>.</span><span class=na>CORRELATED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setPublisherReturns</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>connectionFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=nf>rabbitTemplate</span><span class=p>(</span><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>connectionFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>template</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=p>(</span><span class=n>connectionFactory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>template</span><span class=p>.</span><span class=na>setMandatory</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 게시자 확인 콜백</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>template</span><span class=p>.</span><span class=na>setConfirmCallback</span><span class=p>((</span><span class=n>correlationData</span><span class=p>,</span><span class=w> </span><span class=n>ack</span><span class=p>,</span><span class=w> </span><span class=n>cause</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ack</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지가 브로커에 성공적으로 전달됨&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지 전달 실패: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>cause</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 여기서 메시지 재시도 로직 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 반환된 메시지 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>template</span><span class=p>.</span><span class=na>setReturnsCallback</span><span class=p>(</span><span class=n>returned</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지 반환됨: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, replyCode: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getReplyCode</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, replyText: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getReplyText</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, exchange: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getExchange</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, routingKey: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getRoutingKey</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 라우팅 실패 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>template</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SimpleRabbitListenerContainerFactory</span><span class=w> </span><span class=nf>rabbitListenerContainerFactory</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>connectionFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SimpleRabbitListenerContainerFactory</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SimpleRabbitListenerContainerFactory</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setConnectionFactory</span><span class=p>(</span><span class=n>connectionFactory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 자동 확인 비활성화 (수동 확인 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setAcknowledgeMode</span><span class=p>(</span><span class=n>AcknowledgeMode</span><span class=p>.</span><span class=na>MANUAL</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 동시성 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setConcurrentConsumers</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setMaxConcurrentConsumers</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 소비자 당 메시지 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setPrefetchCount</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>factory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=메시지-순서ordering>메시지 순서(Ordering)<a hidden class=anchor aria-hidden=true href=#메시지-순서ordering>#</a></h4><p>특정 시나리오에서는 메시지 처리 순서가 중요할 수 있다.</p><p>순서 보장을 위한 전략은 다음과 같다.</p><ul><li>동일한 파티션 키(Partition Key)를 사용하여 관련 메시지가 같은 소비자에게 전달</li><li>순차 번호(Sequence Number)를 메시지에 포함하여 소비자가 순서를 확인</li><li>단일 소비자 모델 사용 (확장성 제한)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46>46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47>47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48>48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49>49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50>50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51>51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52>52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53>53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54>54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55>55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56>56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57>57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58>58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59>59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60>60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61>61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62>62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63>63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64>64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65>65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66>66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67>67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68>68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69>69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70>70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71>71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72>72</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C#에서 메시지 순서 보장 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderedMessageProcessor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ConcurrentDictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>SemaphoreSlim</span><span class=p>&gt;</span> <span class=n>_entityLocks</span> <span class=p>=</span> <span class=k>new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ConcurrentDictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>long</span><span class=p>&gt;</span> <span class=n>_lastProcessedSequence</span> <span class=p>=</span> <span class=k>new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>ProcessMessageAsync</span><span class=p>(</span><span class=n>Message</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 파티션 키 추출 (예: 고객 ID)</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>partitionKey</span> <span class=p>=</span> <span class=n>message</span><span class=p>.</span><span class=n>Headers</span><span class=p>[</span><span class=s>&#34;partition-key&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>sequenceNumber</span> <span class=p>=</span> <span class=kt>long</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=n>Headers</span><span class=p>[</span><span class=s>&#34;sequence-number&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 엔티티별 잠금 획득</span>
</span></span><span class=line><span class=cl>        <span class=n>SemaphoreSlim</span> <span class=n>entityLock</span> <span class=p>=</span> <span class=n>_entityLocks</span><span class=p>.</span><span class=n>GetOrAdd</span><span class=p>(</span><span class=n>partitionKey</span><span class=p>,</span> <span class=n>_</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>SemaphoreSlim</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=m>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>entityLock</span><span class=p>.</span><span class=n>WaitAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 마지막으로 처리된 시퀀스 번호 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>_lastProcessedSequence</span><span class=p>.</span><span class=n>TryGetValue</span><span class=p>(</span><span class=n>partitionKey</span><span class=p>,</span> <span class=k>out</span> <span class=kt>long</span> <span class=n>lastSequence</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 순서가 맞지 않는 메시지는 지연 처리 또는 거부</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>sequenceNumber</span> <span class=p>&lt;</span> <span class=n>lastSequence</span> <span class=p>+</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 이미 처리된 메시지 - 무시</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;이미 처리된 메시지 무시: {partitionKey}, 시퀀스: {sequenceNumber}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>sequenceNumber</span> <span class=p>&gt;</span> <span class=n>lastSequence</span> <span class=p>+</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 순서가 맞지 않는 메시지 - 다시 큐에 넣거나 지연 처리</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;순서가 맞지 않는 메시지: {partitionKey}, 예상: {lastSequence + 1}, 실제: {sequenceNumber}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=n>OutOfOrderMessageException</span><span class=p>(</span><span class=n>partitionKey</span><span class=p>,</span> <span class=n>lastSequence</span> <span class=p>+</span> <span class=m>1</span><span class=p>,</span> <span class=n>sequenceNumber</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 정상적인 순서의 메시지 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>ProcessMessageInternalAsync</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 처리된 시퀀스 번호 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>_lastProcessedSequence</span><span class=p>[</span><span class=n>partitionKey</span><span class=p>]</span> <span class=p>=</span> <span class=n>sequenceNumber</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;메시지 처리 완료: {partitionKey}, 시퀀스: {sequenceNumber}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>entityLock</span><span class=p>.</span><span class=n>Release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>ProcessMessageInternalAsync</span><span class=p>(</span><span class=n>Message</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 메시지 처리 로직</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>messageBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;메시지 처리 중: {messageBody}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>100</span><span class=p>);</span>  <span class=c1>// 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 순서가 맞지 않는 메시지 예외</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OutOfOrderMessageException</span> <span class=p>:</span> <span class=n>Exception</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>PartitionKey</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>long</span> <span class=n>ExpectedSequence</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>long</span> <span class=n>ActualSequence</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>OutOfOrderMessageException</span><span class=p>(</span><span class=kt>string</span> <span class=n>partitionKey</span><span class=p>,</span> <span class=kt>long</span> <span class=n>expectedSequence</span><span class=p>,</span> <span class=kt>long</span> <span class=n>actualSequence</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;순서가 맞지 않는 메시지: {partitionKey}, 예상: {expectedSequence}, 실제: {actualSequence}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PartitionKey</span> <span class=p>=</span> <span class=n>partitionKey</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ExpectedSequence</span> <span class=p>=</span> <span class=n>expectedSequence</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ActualSequence</span> <span class=p>=</span> <span class=n>actualSequence</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=최적화>최적화<a hidden class=anchor aria-hidden=true href=#최적화>#</a></h4><p>메시징 시스템의 성능을 최적화하기 위한 주요 고려사항은 아래와 같다.</p><ul><li><strong>배치 처리(Batching)</strong>: 여러 메시지를 묶어서 전송하여 네트워크 오버헤드 감소</li><li><strong>미리 가져오기(Prefetching)</strong>: 소비자가 메시지를 미리 가져와 처리 지연 시간 감소</li><li><strong>압축(Compression)</strong>: 대용량 메시지 압축으로 네트워크 대역폭 절약</li><li><strong>동시성(Concurrency)</strong>: 적절한 수의 소비자 쓰레드로 처리량 최적화</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>  1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>  2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>  3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>  4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>  5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>  6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>  7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>  8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>  9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10> 10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11> 11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12> 12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13> 13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14> 14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15> 15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16> 16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17> 17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18> 18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19> 19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20> 20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21> 21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22> 22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23> 23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24> 24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25> 25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26> 26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27> 27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28> 28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29> 29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30> 30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31> 31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32> 32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33> 33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34> 34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35> 35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36> 36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37> 37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38> 38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39> 39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40> 40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41> 41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42> 42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43> 43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44> 44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45> 45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46> 46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47> 47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48> 48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49> 49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50> 50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51> 51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52> 52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53> 53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54> 54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55> 55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56> 56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57> 57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58> 58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59> 59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60> 60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61> 61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62> 62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63> 63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64> 64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65> 65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66> 66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67> 67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68> 68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69> 69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70> 70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71> 71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72> 72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73> 73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74> 74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75> 75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76> 76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77> 77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78> 78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79> 79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80> 80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81> 81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82> 82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83> 83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84> 84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85> 85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86> 86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87> 87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88> 88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89> 89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90> 90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91> 91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92> 92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93> 93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94> 94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95> 95</a>
</span><span class=lnt id=hl-17-96><a class=lnlinks href=#hl-17-96> 96</a>
</span><span class=lnt id=hl-17-97><a class=lnlinks href=#hl-17-97> 97</a>
</span><span class=lnt id=hl-17-98><a class=lnlinks href=#hl-17-98> 98</a>
</span><span class=lnt id=hl-17-99><a class=lnlinks href=#hl-17-99> 99</a>
</span><span class=lnt id=hl-17-100><a class=lnlinks href=#hl-17-100>100</a>
</span><span class=lnt id=hl-17-101><a class=lnlinks href=#hl-17-101>101</a>
</span><span class=lnt id=hl-17-102><a class=lnlinks href=#hl-17-102>102</a>
</span><span class=lnt id=hl-17-103><a class=lnlinks href=#hl-17-103>103</a>
</span><span class=lnt id=hl-17-104><a class=lnlinks href=#hl-17-104>104</a>
</span><span class=lnt id=hl-17-105><a class=lnlinks href=#hl-17-105>105</a>
</span><span class=lnt id=hl-17-106><a class=lnlinks href=#hl-17-106>106</a>
</span><span class=lnt id=hl-17-107><a class=lnlinks href=#hl-17-107>107</a>
</span><span class=lnt id=hl-17-108><a class=lnlinks href=#hl-17-108>108</a>
</span><span class=lnt id=hl-17-109><a class=lnlinks href=#hl-17-109>109</a>
</span><span class=lnt id=hl-17-110><a class=lnlinks href=#hl-17-110>110</a>
</span><span class=lnt id=hl-17-111><a class=lnlinks href=#hl-17-111>111</a>
</span><span class=lnt id=hl-17-112><a class=lnlinks href=#hl-17-112>112</a>
</span><span class=lnt id=hl-17-113><a class=lnlinks href=#hl-17-113>113</a>
</span><span class=lnt id=hl-17-114><a class=lnlinks href=#hl-17-114>114</a>
</span><span class=lnt id=hl-17-115><a class=lnlinks href=#hl-17-115>115</a>
</span><span class=lnt id=hl-17-116><a class=lnlinks href=#hl-17-116>116</a>
</span><span class=lnt id=hl-17-117><a class=lnlinks href=#hl-17-117>117</a>
</span><span class=lnt id=hl-17-118><a class=lnlinks href=#hl-17-118>118</a>
</span><span class=lnt id=hl-17-119><a class=lnlinks href=#hl-17-119>119</a>
</span><span class=lnt id=hl-17-120><a class=lnlinks href=#hl-17-120>120</a>
</span><span class=lnt id=hl-17-121><a class=lnlinks href=#hl-17-121>121</a>
</span><span class=lnt id=hl-17-122><a class=lnlinks href=#hl-17-122>122</a>
</span><span class=lnt id=hl-17-123><a class=lnlinks href=#hl-17-123>123</a>
</span><span class=lnt id=hl-17-124><a class=lnlinks href=#hl-17-124>124</a>
</span><span class=lnt id=hl-17-125><a class=lnlinks href=#hl-17-125>125</a>
</span><span class=lnt id=hl-17-126><a class=lnlinks href=#hl-17-126>126</a>
</span><span class=lnt id=hl-17-127><a class=lnlinks href=#hl-17-127>127</a>
</span><span class=lnt id=hl-17-128><a class=lnlinks href=#hl-17-128>128</a>
</span><span class=lnt id=hl-17-129><a class=lnlinks href=#hl-17-129>129</a>
</span><span class=lnt id=hl-17-130><a class=lnlinks href=#hl-17-130>130</a>
</span><span class=lnt id=hl-17-131><a class=lnlinks href=#hl-17-131>131</a>
</span><span class=lnt id=hl-17-132><a class=lnlinks href=#hl-17-132>132</a>
</span><span class=lnt id=hl-17-133><a class=lnlinks href=#hl-17-133>133</a>
</span><span class=lnt id=hl-17-134><a class=lnlinks href=#hl-17-134>134</a>
</span><span class=lnt id=hl-17-135><a class=lnlinks href=#hl-17-135>135</a>
</span><span class=lnt id=hl-17-136><a class=lnlinks href=#hl-17-136>136</a>
</span><span class=lnt id=hl-17-137><a class=lnlinks href=#hl-17-137>137</a>
</span><span class=lnt id=hl-17-138><a class=lnlinks href=#hl-17-138>138</a>
</span><span class=lnt id=hl-17-139><a class=lnlinks href=#hl-17-139>139</a>
</span><span class=lnt id=hl-17-140><a class=lnlinks href=#hl-17-140>140</a>
</span><span class=lnt id=hl-17-141><a class=lnlinks href=#hl-17-141>141</a>
</span><span class=lnt id=hl-17-142><a class=lnlinks href=#hl-17-142>142</a>
</span><span class=lnt id=hl-17-143><a class=lnlinks href=#hl-17-143>143</a>
</span><span class=lnt id=hl-17-144><a class=lnlinks href=#hl-17-144>144</a>
</span><span class=lnt id=hl-17-145><a class=lnlinks href=#hl-17-145>145</a>
</span><span class=lnt id=hl-17-146><a class=lnlinks href=#hl-17-146>146</a>
</span><span class=lnt id=hl-17-147><a class=lnlinks href=#hl-17-147>147</a>
</span><span class=lnt id=hl-17-148><a class=lnlinks href=#hl-17-148>148</a>
</span><span class=lnt id=hl-17-149><a class=lnlinks href=#hl-17-149>149</a>
</span><span class=lnt id=hl-17-150><a class=lnlinks href=#hl-17-150>150</a>
</span><span class=lnt id=hl-17-151><a class=lnlinks href=#hl-17-151>151</a>
</span><span class=lnt id=hl-17-152><a class=lnlinks href=#hl-17-152>152</a>
</span><span class=lnt id=hl-17-153><a class=lnlinks href=#hl-17-153>153</a>
</span><span class=lnt id=hl-17-154><a class=lnlinks href=#hl-17-154>154</a>
</span><span class=lnt id=hl-17-155><a class=lnlinks href=#hl-17-155>155</a>
</span><span class=lnt id=hl-17-156><a class=lnlinks href=#hl-17-156>156</a>
</span><span class=lnt id=hl-17-157><a class=lnlinks href=#hl-17-157>157</a>
</span><span class=lnt id=hl-17-158><a class=lnlinks href=#hl-17-158>158</a>
</span><span class=lnt id=hl-17-159><a class=lnlinks href=#hl-17-159>159</a>
</span><span class=lnt id=hl-17-160><a class=lnlinks href=#hl-17-160>160</a>
</span><span class=lnt id=hl-17-161><a class=lnlinks href=#hl-17-161>161</a>
</span><span class=lnt id=hl-17-162><a class=lnlinks href=#hl-17-162>162</a>
</span><span class=lnt id=hl-17-163><a class=lnlinks href=#hl-17-163>163</a>
</span><span class=lnt id=hl-17-164><a class=lnlinks href=#hl-17-164>164</a>
</span><span class=lnt id=hl-17-165><a class=lnlinks href=#hl-17-165>165</a>
</span><span class=lnt id=hl-17-166><a class=lnlinks href=#hl-17-166>166</a>
</span><span class=lnt id=hl-17-167><a class=lnlinks href=#hl-17-167>167</a>
</span><span class=lnt id=hl-17-168><a class=lnlinks href=#hl-17-168>168</a>
</span><span class=lnt id=hl-17-169><a class=lnlinks href=#hl-17-169>169</a>
</span><span class=lnt id=hl-17-170><a class=lnlinks href=#hl-17-170>170</a>
</span><span class=lnt id=hl-17-171><a class=lnlinks href=#hl-17-171>171</a>
</span><span class=lnt id=hl-17-172><a class=lnlinks href=#hl-17-172>172</a>
</span><span class=lnt id=hl-17-173><a class=lnlinks href=#hl-17-173>173</a>
</span><span class=lnt id=hl-17-174><a class=lnlinks href=#hl-17-174>174</a>
</span><span class=lnt id=hl-17-175><a class=lnlinks href=#hl-17-175>175</a>
</span><span class=lnt id=hl-17-176><a class=lnlinks href=#hl-17-176>176</a>
</span><span class=lnt id=hl-17-177><a class=lnlinks href=#hl-17-177>177</a>
</span><span class=lnt id=hl-17-178><a class=lnlinks href=#hl-17-178>178</a>
</span><span class=lnt id=hl-17-179><a class=lnlinks href=#hl-17-179>179</a>
</span><span class=lnt id=hl-17-180><a class=lnlinks href=#hl-17-180>180</a>
</span><span class=lnt id=hl-17-181><a class=lnlinks href=#hl-17-181>181</a>
</span><span class=lnt id=hl-17-182><a class=lnlinks href=#hl-17-182>182</a>
</span><span class=lnt id=hl-17-183><a class=lnlinks href=#hl-17-183>183</a>
</span><span class=lnt id=hl-17-184><a class=lnlinks href=#hl-17-184>184</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python에서 배치 처리 구현 예시 (Kafka 사용)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka</span> <span class=kn>import</span> <span class=n>Producer</span><span class=p>,</span> <span class=n>Consumer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka.admin</span> <span class=kn>import</span> <span class=n>AdminClient</span><span class=p>,</span> <span class=n>NewTopic</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BatchMessageProducer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span> <span class=n>flush_interval</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;batch.size&#39;</span><span class=p>:</span> <span class=mi>16384</span><span class=p>,</span>  <span class=c1># 배치 크기(바이트)</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;linger.ms&#39;</span><span class=p>:</span> <span class=mi>50</span><span class=p>,</span>      <span class=c1># 배치 지연 시간(밀리초)</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;compression.type&#39;</span><span class=p>:</span> <span class=s1>&#39;snappy&#39;</span>  <span class=c1># 메시지 압축</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=n>topic</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_size</span> <span class=o>=</span> <span class=n>batch_size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>flush_interval</span> <span class=o>=</span> <span class=n>flush_interval</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_flush_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 토픽 생성 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>admin_client</span> <span class=o>=</span> <span class=n>AdminClient</span><span class=p>({</span><span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=n>bootstrap_servers</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>topics</span> <span class=o>=</span> <span class=n>admin_client</span><span class=o>.</span><span class=n>list_topics</span><span class=p>()</span><span class=o>.</span><span class=n>topics</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>topics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>topic_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>NewTopic</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>num_partitions</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>replication_factor</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=p>)]</span>
</span></span><span class=line><span class=cl>            <span class=n>admin_client</span><span class=o>.</span><span class=n>create_topics</span><span class=p>(</span><span class=n>topic_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;토픽 생성됨: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>delivery_report</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>err</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>err</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 전송 실패: </span><span class=si>{</span><span class=n>err</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 전송 성공: </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>topic</span><span class=p>()</span><span class=si>}</span><span class=s2> [</span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>partition</span><span class=p>()</span><span class=si>}</span><span class=s2>] @ 오프셋 </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>offset</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 버퍼에 메시지 추가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배치 크기에 도달하거나 플러시 간격이 경과하면 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>current_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_size</span> <span class=ow>or</span> 
</span></span><span class=line><span class=cl>                <span class=n>current_time</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_flush_time</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>flush_interval</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>flush</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 버퍼의 모든 메시지 전송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;배치 플러시: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>)</span><span class=si>}</span><span class=s2> 메시지&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 직렬화</span>
</span></span><span class=line><span class=cl>            <span class=n>message_value</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 파티션 키 설정 (메시지 순서가 중요한 경우)</span>
</span></span><span class=line><span class=cl>            <span class=n>partition_key</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;entity_id&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 생산</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>produce</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>partition_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span><span class=o>=</span><span class=n>message_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>delivery_report</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 생산자 플러시</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 버퍼 비우기 및 타임스탬프 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_flush_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;남은 메시지 플러시 및 생산자 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ParallelMessageConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>group_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>num_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=n>topic</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>group_id</span> <span class=o>=</span> <span class=n>group_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>num_workers</span> <span class=o>=</span> <span class=n>num_workers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>workers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 소비자 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Consumer</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;group.id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;auto.offset.reset&#39;</span><span class=p>:</span> <span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;enable.auto.commit&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;max.poll.interval.ms&#39;</span><span class=p>:</span> <span class=mi>300000</span><span class=p>,</span>  <span class=c1># 5분</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;session.timeout.ms&#39;</span><span class=p>:</span> <span class=mi>30000</span><span class=p>,</span>     <span class=c1># 30초</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;fetch.min.bytes&#39;</span><span class=p>:</span> <span class=mi>1024</span><span class=p>,</span>         <span class=c1># 최소 가져오기 크기</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;fetch.max.wait.ms&#39;</span><span class=p>:</span> <span class=mi>500</span>         <span class=c1># 최대 대기 시간</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 처리 로직 (오버라이드 필요)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 역직렬화</span>
</span></span><span class=line><span class=cl>            <span class=n>message_value</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리: </span><span class=si>{</span><span class=n>message_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실제 처리 로직 구현</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>worker_loop</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>worker_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;작업자 스레드 메인 루프&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_consumer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=o>.</span><span class=n>subscribe</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;작업자 </span><span class=si>{</span><span class=n>worker_id</span><span class=si>}</span><span class=s2> 시작됨, 토픽: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 폴링</span>
</span></span><span class=line><span class=cl>                <span class=n>messages</span> <span class=o>=</span> <span class=n>consumer</span><span class=o>.</span><span class=n>consume</span><span class=p>(</span><span class=n>num_messages</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 배치 처리</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_offsets</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>error</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소비자 오류: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>error</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>continue</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>                    <span class=n>success</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 오프셋 추적</span>
</span></span><span class=line><span class=cl>                        <span class=n>partition</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>partition</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>partition</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>processed_offsets</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>processed_offsets</span><span class=p>[</span><span class=n>partition</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                        <span class=n>processed_offsets</span><span class=p>[</span><span class=n>partition</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>offset</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 성공한 오프셋 커밋</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>partition</span><span class=p>,</span> <span class=n>offsets</span> <span class=ow>in</span> <span class=n>processed_offsets</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>offsets</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>(</span><span class=n>offsets</span><span class=o>=</span><span class=p>[(</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span> <span class=n>partition</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=n>offsets</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;작업자 </span><span class=si>{</span><span class=n>worker_id</span><span class=si>}</span><span class=s2> 종료됨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;병렬 소비자 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 작업자 스레드 시작</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_workers</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>worker_loop</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>workers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>worker</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>num_workers</span><span class=si>}</span><span class=s2>개의 병렬 작업자가 시작되었습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;소비자 중지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 작업자 스레드가 종료될 때까지 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>worker</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>workers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>5.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;모든 소비자 작업자가 종료되었습니다.&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-모니터링-및-운영>메시징 큐 모니터링 및 운영<a hidden class=anchor aria-hidden=true href=#메시징-큐-모니터링-및-운영>#</a></h3><p>효과적인 메시징 시스템 운영을 위해서는 적절한 모니터링과 관리가 필수적이다.<br>다음은 주요 모니터링 포인트와 관리 전략이다.</p><h4 id=주요-모니터링-지표>주요 모니터링 지표<a hidden class=anchor aria-hidden=true href=#주요-모니터링-지표>#</a></h4><p>메시징 시스템의 건강 상태와 성능을 모니터링하기 위한 핵심 지표들이다.</p><ul><li><strong>큐 깊이(Queue Depth)</strong>: 큐에 적재된 메시지 수를 추적하여 처리 지연 감지</li><li><strong>메시지 처리율(Processing Rate)</strong>: 초당 처리되는 메시지 수를 측정하여 성능 평가</li><li><strong>메시지 지연 시간(Latency)</strong>: 메시지가 큐에 들어온 후 처리되기까지의 시간 측정</li><li><strong>오류율(Error Rate)</strong>: 처리 실패 및 재시도 횟수 모니터링</li><li><strong>소비자 상태(Consumer Health)</strong>: 활성 소비자 수와 소비자 지연 추적</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Prometheus와 Grafana를 사용한 RabbitMQ 모니터링 예시 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>prometheus_client</span> <span class=kn>import</span> <span class=n>start_http_server</span><span class=p>,</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Gauge</span><span class=p>,</span> <span class=n>Histogram</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Prometheus 메트릭 정의</span>
</span></span><span class=line><span class=cl><span class=n>MESSAGE_COUNT</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=s1>&#39;rabbitmq_messages_total&#39;</span><span class=p>,</span> <span class=s1>&#39;Total number of messages processed&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>QUEUE_DEPTH</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span><span class=s1>&#39;rabbitmq_queue_depth&#39;</span><span class=p>,</span> <span class=s1>&#39;Number of messages in queue&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>PROCESSING_TIME</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span><span class=s1>&#39;rabbitmq_processing_seconds&#39;</span><span class=p>,</span> <span class=s1>&#39;Time spent processing messages&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ACTIVE_CONSUMERS</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span><span class=s1>&#39;rabbitmq_active_consumers&#39;</span><span class=p>,</span> <span class=s1>&#39;Number of active consumers&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MonitoredConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_params</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span> <span class=o>=</span> <span class=n>connection_params</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span> <span class=o>=</span> <span class=n>queue_name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 소비자 활성화 상태 표시</span>
</span></span><span class=line><span class=cl>        <span class=n>ACTIVE_CONSUMERS</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>connect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;RabbitMQ에 연결&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;연결 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_consuming</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 소비 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>connect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;RabbitMQ 연결 실패. 30초 후 재시도합니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>ACTIVE_CONSUMERS</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=c1># 처리 시작 시간 기록</span>
</span></span><span class=line><span class=cl>            <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 처리 로직</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 수신: </span><span class=si>{</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 성공적으로 처리됨</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>MESSAGE_COUNT</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=s2>&#34;success&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 처리 시간 기록</span>
</span></span><span class=line><span class=cl>                <span class=n>PROCESSING_TIME</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 실패</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;처리 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>MESSAGE_COUNT</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=s2>&#34;error&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 큐 깊이 모니터링 스레드</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>monitor_queue_depth</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 큐 상태 확인</span>
</span></span><span class=line><span class=cl>                    <span class=n>queue</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>passive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>depth</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>message_count</span>
</span></span><span class=line><span class=cl>                    <span class=n>QUEUE_DEPTH</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>depth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐 모니터링 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>QUEUE_DEPTH</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>  <span class=c1># 5초마다 업데이트</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모니터링 스레드 시작</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>monitor_queue_depth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor_thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 소비자 시작</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐 </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>에서 메시지 소비 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소비자 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재연결 시도</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;별도 스레드에서 소비자 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;소비자 중지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>ACTIVE_CONSUMERS</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>stop_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>is_open</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐 </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>의 소비자가 중지되었습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메인 애플리케이션</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Prometheus 메트릭 서버 시작</span>
</span></span><span class=line><span class=cl>    <span class=n>start_http_server</span><span class=p>(</span><span class=mi>8000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Prometheus 메트릭 서버가 포트 8000에서 실행 중입니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># RabbitMQ 연결 파라미터</span>
</span></span><span class=line><span class=cl>    <span class=n>connection_params</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>heartbeat</span><span class=o>=</span><span class=mi>60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>blocked_connection_timeout</span><span class=o>=</span><span class=mi>300</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모니터링되는 소비자 시작</span>
</span></span><span class=line><span class=cl>    <span class=n>consumers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>queue_name</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=s1>&#39;emails&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>MonitoredConsumer</span><span class=p>(</span><span class=n>connection_params</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>consumers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>consumer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 애플리케이션 실행 유지</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;애플리케이션 종료 중...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>consumer</span> <span class=ow>in</span> <span class=n>consumers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=경보-및-자동화-대응>경보 및 자동화 대응<a hidden class=anchor aria-hidden=true href=#경보-및-자동화-대응>#</a></h4><p>메시징 시스템에서 발생할 수 있는 문제에 대한 경보와 자동화된 대응 전략은 아래와 같다.</p><ul><li><strong>큐 적체(Queue Buildup)</strong>: 큐 깊이가 임계값을 초과할 경우 경보 발생</li><li><strong>데드 레터 증가(Dead-Letter Growth)</strong>: 데드 레터 큐에 메시지가 축적될 경우 경보</li><li><strong>소비자 장애(Consumer Failure)</strong>: 활성 소비자 수가 감소할 경우 자동 복구</li><li><strong>처리 지연(Processing Delays)</strong>: 메시지 처리 지연이 임계값을 초과할 경우 경보</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>  1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>  2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>  3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>  4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>  5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>  6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>  7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>  8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>  9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10> 10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11> 11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12> 12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13> 13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14> 14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15> 15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16> 16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17> 17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18> 18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19> 19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20> 20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21> 21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22> 22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23> 23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24> 24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25> 25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26> 26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27> 27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28> 28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29> 29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30> 30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31> 31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32> 32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33> 33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34> 34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35> 35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36> 36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37> 37</a>
</span><span class=lnt id=hl-19-38><a class=lnlinks href=#hl-19-38> 38</a>
</span><span class=lnt id=hl-19-39><a class=lnlinks href=#hl-19-39> 39</a>
</span><span class=lnt id=hl-19-40><a class=lnlinks href=#hl-19-40> 40</a>
</span><span class=lnt id=hl-19-41><a class=lnlinks href=#hl-19-41> 41</a>
</span><span class=lnt id=hl-19-42><a class=lnlinks href=#hl-19-42> 42</a>
</span><span class=lnt id=hl-19-43><a class=lnlinks href=#hl-19-43> 43</a>
</span><span class=lnt id=hl-19-44><a class=lnlinks href=#hl-19-44> 44</a>
</span><span class=lnt id=hl-19-45><a class=lnlinks href=#hl-19-45> 45</a>
</span><span class=lnt id=hl-19-46><a class=lnlinks href=#hl-19-46> 46</a>
</span><span class=lnt id=hl-19-47><a class=lnlinks href=#hl-19-47> 47</a>
</span><span class=lnt id=hl-19-48><a class=lnlinks href=#hl-19-48> 48</a>
</span><span class=lnt id=hl-19-49><a class=lnlinks href=#hl-19-49> 49</a>
</span><span class=lnt id=hl-19-50><a class=lnlinks href=#hl-19-50> 50</a>
</span><span class=lnt id=hl-19-51><a class=lnlinks href=#hl-19-51> 51</a>
</span><span class=lnt id=hl-19-52><a class=lnlinks href=#hl-19-52> 52</a>
</span><span class=lnt id=hl-19-53><a class=lnlinks href=#hl-19-53> 53</a>
</span><span class=lnt id=hl-19-54><a class=lnlinks href=#hl-19-54> 54</a>
</span><span class=lnt id=hl-19-55><a class=lnlinks href=#hl-19-55> 55</a>
</span><span class=lnt id=hl-19-56><a class=lnlinks href=#hl-19-56> 56</a>
</span><span class=lnt id=hl-19-57><a class=lnlinks href=#hl-19-57> 57</a>
</span><span class=lnt id=hl-19-58><a class=lnlinks href=#hl-19-58> 58</a>
</span><span class=lnt id=hl-19-59><a class=lnlinks href=#hl-19-59> 59</a>
</span><span class=lnt id=hl-19-60><a class=lnlinks href=#hl-19-60> 60</a>
</span><span class=lnt id=hl-19-61><a class=lnlinks href=#hl-19-61> 61</a>
</span><span class=lnt id=hl-19-62><a class=lnlinks href=#hl-19-62> 62</a>
</span><span class=lnt id=hl-19-63><a class=lnlinks href=#hl-19-63> 63</a>
</span><span class=lnt id=hl-19-64><a class=lnlinks href=#hl-19-64> 64</a>
</span><span class=lnt id=hl-19-65><a class=lnlinks href=#hl-19-65> 65</a>
</span><span class=lnt id=hl-19-66><a class=lnlinks href=#hl-19-66> 66</a>
</span><span class=lnt id=hl-19-67><a class=lnlinks href=#hl-19-67> 67</a>
</span><span class=lnt id=hl-19-68><a class=lnlinks href=#hl-19-68> 68</a>
</span><span class=lnt id=hl-19-69><a class=lnlinks href=#hl-19-69> 69</a>
</span><span class=lnt id=hl-19-70><a class=lnlinks href=#hl-19-70> 70</a>
</span><span class=lnt id=hl-19-71><a class=lnlinks href=#hl-19-71> 71</a>
</span><span class=lnt id=hl-19-72><a class=lnlinks href=#hl-19-72> 72</a>
</span><span class=lnt id=hl-19-73><a class=lnlinks href=#hl-19-73> 73</a>
</span><span class=lnt id=hl-19-74><a class=lnlinks href=#hl-19-74> 74</a>
</span><span class=lnt id=hl-19-75><a class=lnlinks href=#hl-19-75> 75</a>
</span><span class=lnt id=hl-19-76><a class=lnlinks href=#hl-19-76> 76</a>
</span><span class=lnt id=hl-19-77><a class=lnlinks href=#hl-19-77> 77</a>
</span><span class=lnt id=hl-19-78><a class=lnlinks href=#hl-19-78> 78</a>
</span><span class=lnt id=hl-19-79><a class=lnlinks href=#hl-19-79> 79</a>
</span><span class=lnt id=hl-19-80><a class=lnlinks href=#hl-19-80> 80</a>
</span><span class=lnt id=hl-19-81><a class=lnlinks href=#hl-19-81> 81</a>
</span><span class=lnt id=hl-19-82><a class=lnlinks href=#hl-19-82> 82</a>
</span><span class=lnt id=hl-19-83><a class=lnlinks href=#hl-19-83> 83</a>
</span><span class=lnt id=hl-19-84><a class=lnlinks href=#hl-19-84> 84</a>
</span><span class=lnt id=hl-19-85><a class=lnlinks href=#hl-19-85> 85</a>
</span><span class=lnt id=hl-19-86><a class=lnlinks href=#hl-19-86> 86</a>
</span><span class=lnt id=hl-19-87><a class=lnlinks href=#hl-19-87> 87</a>
</span><span class=lnt id=hl-19-88><a class=lnlinks href=#hl-19-88> 88</a>
</span><span class=lnt id=hl-19-89><a class=lnlinks href=#hl-19-89> 89</a>
</span><span class=lnt id=hl-19-90><a class=lnlinks href=#hl-19-90> 90</a>
</span><span class=lnt id=hl-19-91><a class=lnlinks href=#hl-19-91> 91</a>
</span><span class=lnt id=hl-19-92><a class=lnlinks href=#hl-19-92> 92</a>
</span><span class=lnt id=hl-19-93><a class=lnlinks href=#hl-19-93> 93</a>
</span><span class=lnt id=hl-19-94><a class=lnlinks href=#hl-19-94> 94</a>
</span><span class=lnt id=hl-19-95><a class=lnlinks href=#hl-19-95> 95</a>
</span><span class=lnt id=hl-19-96><a class=lnlinks href=#hl-19-96> 96</a>
</span><span class=lnt id=hl-19-97><a class=lnlinks href=#hl-19-97> 97</a>
</span><span class=lnt id=hl-19-98><a class=lnlinks href=#hl-19-98> 98</a>
</span><span class=lnt id=hl-19-99><a class=lnlinks href=#hl-19-99> 99</a>
</span><span class=lnt id=hl-19-100><a class=lnlinks href=#hl-19-100>100</a>
</span><span class=lnt id=hl-19-101><a class=lnlinks href=#hl-19-101>101</a>
</span><span class=lnt id=hl-19-102><a class=lnlinks href=#hl-19-102>102</a>
</span><span class=lnt id=hl-19-103><a class=lnlinks href=#hl-19-103>103</a>
</span><span class=lnt id=hl-19-104><a class=lnlinks href=#hl-19-104>104</a>
</span><span class=lnt id=hl-19-105><a class=lnlinks href=#hl-19-105>105</a>
</span><span class=lnt id=hl-19-106><a class=lnlinks href=#hl-19-106>106</a>
</span><span class=lnt id=hl-19-107><a class=lnlinks href=#hl-19-107>107</a>
</span><span class=lnt id=hl-19-108><a class=lnlinks href=#hl-19-108>108</a>
</span><span class=lnt id=hl-19-109><a class=lnlinks href=#hl-19-109>109</a>
</span><span class=lnt id=hl-19-110><a class=lnlinks href=#hl-19-110>110</a>
</span><span class=lnt id=hl-19-111><a class=lnlinks href=#hl-19-111>111</a>
</span><span class=lnt id=hl-19-112><a class=lnlinks href=#hl-19-112>112</a>
</span><span class=lnt id=hl-19-113><a class=lnlinks href=#hl-19-113>113</a>
</span><span class=lnt id=hl-19-114><a class=lnlinks href=#hl-19-114>114</a>
</span><span class=lnt id=hl-19-115><a class=lnlinks href=#hl-19-115>115</a>
</span><span class=lnt id=hl-19-116><a class=lnlinks href=#hl-19-116>116</a>
</span><span class=lnt id=hl-19-117><a class=lnlinks href=#hl-19-117>117</a>
</span><span class=lnt id=hl-19-118><a class=lnlinks href=#hl-19-118>118</a>
</span><span class=lnt id=hl-19-119><a class=lnlinks href=#hl-19-119>119</a>
</span><span class=lnt id=hl-19-120><a class=lnlinks href=#hl-19-120>120</a>
</span><span class=lnt id=hl-19-121><a class=lnlinks href=#hl-19-121>121</a>
</span><span class=lnt id=hl-19-122><a class=lnlinks href=#hl-19-122>122</a>
</span><span class=lnt id=hl-19-123><a class=lnlinks href=#hl-19-123>123</a>
</span><span class=lnt id=hl-19-124><a class=lnlinks href=#hl-19-124>124</a>
</span><span class=lnt id=hl-19-125><a class=lnlinks href=#hl-19-125>125</a>
</span><span class=lnt id=hl-19-126><a class=lnlinks href=#hl-19-126>126</a>
</span><span class=lnt id=hl-19-127><a class=lnlinks href=#hl-19-127>127</a>
</span><span class=lnt id=hl-19-128><a class=lnlinks href=#hl-19-128>128</a>
</span><span class=lnt id=hl-19-129><a class=lnlinks href=#hl-19-129>129</a>
</span><span class=lnt id=hl-19-130><a class=lnlinks href=#hl-19-130>130</a>
</span><span class=lnt id=hl-19-131><a class=lnlinks href=#hl-19-131>131</a>
</span><span class=lnt id=hl-19-132><a class=lnlinks href=#hl-19-132>132</a>
</span><span class=lnt id=hl-19-133><a class=lnlinks href=#hl-19-133>133</a>
</span><span class=lnt id=hl-19-134><a class=lnlinks href=#hl-19-134>134</a>
</span><span class=lnt id=hl-19-135><a class=lnlinks href=#hl-19-135>135</a>
</span><span class=lnt id=hl-19-136><a class=lnlinks href=#hl-19-136>136</a>
</span><span class=lnt id=hl-19-137><a class=lnlinks href=#hl-19-137>137</a>
</span><span class=lnt id=hl-19-138><a class=lnlinks href=#hl-19-138>138</a>
</span><span class=lnt id=hl-19-139><a class=lnlinks href=#hl-19-139>139</a>
</span><span class=lnt id=hl-19-140><a class=lnlinks href=#hl-19-140>140</a>
</span><span class=lnt id=hl-19-141><a class=lnlinks href=#hl-19-141>141</a>
</span><span class=lnt id=hl-19-142><a class=lnlinks href=#hl-19-142>142</a>
</span><span class=lnt id=hl-19-143><a class=lnlinks href=#hl-19-143>143</a>
</span><span class=lnt id=hl-19-144><a class=lnlinks href=#hl-19-144>144</a>
</span><span class=lnt id=hl-19-145><a class=lnlinks href=#hl-19-145>145</a>
</span><span class=lnt id=hl-19-146><a class=lnlinks href=#hl-19-146>146</a>
</span><span class=lnt id=hl-19-147><a class=lnlinks href=#hl-19-147>147</a>
</span><span class=lnt id=hl-19-148><a class=lnlinks href=#hl-19-148>148</a>
</span><span class=lnt id=hl-19-149><a class=lnlinks href=#hl-19-149>149</a>
</span><span class=lnt id=hl-19-150><a class=lnlinks href=#hl-19-150>150</a>
</span><span class=lnt id=hl-19-151><a class=lnlinks href=#hl-19-151>151</a>
</span><span class=lnt id=hl-19-152><a class=lnlinks href=#hl-19-152>152</a>
</span><span class=lnt id=hl-19-153><a class=lnlinks href=#hl-19-153>153</a>
</span><span class=lnt id=hl-19-154><a class=lnlinks href=#hl-19-154>154</a>
</span><span class=lnt id=hl-19-155><a class=lnlinks href=#hl-19-155>155</a>
</span><span class=lnt id=hl-19-156><a class=lnlinks href=#hl-19-156>156</a>
</span><span class=lnt id=hl-19-157><a class=lnlinks href=#hl-19-157>157</a>
</span><span class=lnt id=hl-19-158><a class=lnlinks href=#hl-19-158>158</a>
</span><span class=lnt id=hl-19-159><a class=lnlinks href=#hl-19-159>159</a>
</span><span class=lnt id=hl-19-160><a class=lnlinks href=#hl-19-160>160</a>
</span><span class=lnt id=hl-19-161><a class=lnlinks href=#hl-19-161>161</a>
</span><span class=lnt id=hl-19-162><a class=lnlinks href=#hl-19-162>162</a>
</span><span class=lnt id=hl-19-163><a class=lnlinks href=#hl-19-163>163</a>
</span><span class=lnt id=hl-19-164><a class=lnlinks href=#hl-19-164>164</a>
</span><span class=lnt id=hl-19-165><a class=lnlinks href=#hl-19-165>165</a>
</span><span class=lnt id=hl-19-166><a class=lnlinks href=#hl-19-166>166</a>
</span><span class=lnt id=hl-19-167><a class=lnlinks href=#hl-19-167>167</a>
</span><span class=lnt id=hl-19-168><a class=lnlinks href=#hl-19-168>168</a>
</span><span class=lnt id=hl-19-169><a class=lnlinks href=#hl-19-169>169</a>
</span><span class=lnt id=hl-19-170><a class=lnlinks href=#hl-19-170>170</a>
</span><span class=lnt id=hl-19-171><a class=lnlinks href=#hl-19-171>171</a>
</span><span class=lnt id=hl-19-172><a class=lnlinks href=#hl-19-172>172</a>
</span><span class=lnt id=hl-19-173><a class=lnlinks href=#hl-19-173>173</a>
</span><span class=lnt id=hl-19-174><a class=lnlinks href=#hl-19-174>174</a>
</span><span class=lnt id=hl-19-175><a class=lnlinks href=#hl-19-175>175</a>
</span><span class=lnt id=hl-19-176><a class=lnlinks href=#hl-19-176>176</a>
</span><span class=lnt id=hl-19-177><a class=lnlinks href=#hl-19-177>177</a>
</span><span class=lnt id=hl-19-178><a class=lnlinks href=#hl-19-178>178</a>
</span><span class=lnt id=hl-19-179><a class=lnlinks href=#hl-19-179>179</a>
</span><span class=lnt id=hl-19-180><a class=lnlinks href=#hl-19-180>180</a>
</span><span class=lnt id=hl-19-181><a class=lnlinks href=#hl-19-181>181</a>
</span><span class=lnt id=hl-19-182><a class=lnlinks href=#hl-19-182>182</a>
</span><span class=lnt id=hl-19-183><a class=lnlinks href=#hl-19-183>183</a>
</span><span class=lnt id=hl-19-184><a class=lnlinks href=#hl-19-184>184</a>
</span><span class=lnt id=hl-19-185><a class=lnlinks href=#hl-19-185>185</a>
</span><span class=lnt id=hl-19-186><a class=lnlinks href=#hl-19-186>186</a>
</span><span class=lnt id=hl-19-187><a class=lnlinks href=#hl-19-187>187</a>
</span><span class=lnt id=hl-19-188><a class=lnlinks href=#hl-19-188>188</a>
</span><span class=lnt id=hl-19-189><a class=lnlinks href=#hl-19-189>189</a>
</span><span class=lnt id=hl-19-190><a class=lnlinks href=#hl-19-190>190</a>
</span><span class=lnt id=hl-19-191><a class=lnlinks href=#hl-19-191>191</a>
</span><span class=lnt id=hl-19-192><a class=lnlinks href=#hl-19-192>192</a>
</span><span class=lnt id=hl-19-193><a class=lnlinks href=#hl-19-193>193</a>
</span><span class=lnt id=hl-19-194><a class=lnlinks href=#hl-19-194>194</a>
</span><span class=lnt id=hl-19-195><a class=lnlinks href=#hl-19-195>195</a>
</span><span class=lnt id=hl-19-196><a class=lnlinks href=#hl-19-196>196</a>
</span><span class=lnt id=hl-19-197><a class=lnlinks href=#hl-19-197>197</a>
</span><span class=lnt id=hl-19-198><a class=lnlinks href=#hl-19-198>198</a>
</span><span class=lnt id=hl-19-199><a class=lnlinks href=#hl-19-199>199</a>
</span><span class=lnt id=hl-19-200><a class=lnlinks href=#hl-19-200>200</a>
</span><span class=lnt id=hl-19-201><a class=lnlinks href=#hl-19-201>201</a>
</span><span class=lnt id=hl-19-202><a class=lnlinks href=#hl-19-202>202</a>
</span><span class=lnt id=hl-19-203><a class=lnlinks href=#hl-19-203>203</a>
</span><span class=lnt id=hl-19-204><a class=lnlinks href=#hl-19-204>204</a>
</span><span class=lnt id=hl-19-205><a class=lnlinks href=#hl-19-205>205</a>
</span><span class=lnt id=hl-19-206><a class=lnlinks href=#hl-19-206>206</a>
</span><span class=lnt id=hl-19-207><a class=lnlinks href=#hl-19-207>207</a>
</span><span class=lnt id=hl-19-208><a class=lnlinks href=#hl-19-208>208</a>
</span><span class=lnt id=hl-19-209><a class=lnlinks href=#hl-19-209>209</a>
</span><span class=lnt id=hl-19-210><a class=lnlinks href=#hl-19-210>210</a>
</span><span class=lnt id=hl-19-211><a class=lnlinks href=#hl-19-211>211</a>
</span><span class=lnt id=hl-19-212><a class=lnlinks href=#hl-19-212>212</a>
</span><span class=lnt id=hl-19-213><a class=lnlinks href=#hl-19-213>213</a>
</span><span class=lnt id=hl-19-214><a class=lnlinks href=#hl-19-214>214</a>
</span><span class=lnt id=hl-19-215><a class=lnlinks href=#hl-19-215>215</a>
</span><span class=lnt id=hl-19-216><a class=lnlinks href=#hl-19-216>216</a>
</span><span class=lnt id=hl-19-217><a class=lnlinks href=#hl-19-217>217</a>
</span><span class=lnt id=hl-19-218><a class=lnlinks href=#hl-19-218>218</a>
</span><span class=lnt id=hl-19-219><a class=lnlinks href=#hl-19-219>219</a>
</span><span class=lnt id=hl-19-220><a class=lnlinks href=#hl-19-220>220</a>
</span><span class=lnt id=hl-19-221><a class=lnlinks href=#hl-19-221>221</a>
</span><span class=lnt id=hl-19-222><a class=lnlinks href=#hl-19-222>222</a>
</span><span class=lnt id=hl-19-223><a class=lnlinks href=#hl-19-223>223</a>
</span><span class=lnt id=hl-19-224><a class=lnlinks href=#hl-19-224>224</a>
</span><span class=lnt id=hl-19-225><a class=lnlinks href=#hl-19-225>225</a>
</span><span class=lnt id=hl-19-226><a class=lnlinks href=#hl-19-226>226</a>
</span><span class=lnt id=hl-19-227><a class=lnlinks href=#hl-19-227>227</a>
</span><span class=lnt id=hl-19-228><a class=lnlinks href=#hl-19-228>228</a>
</span><span class=lnt id=hl-19-229><a class=lnlinks href=#hl-19-229>229</a>
</span><span class=lnt id=hl-19-230><a class=lnlinks href=#hl-19-230>230</a>
</span><span class=lnt id=hl-19-231><a class=lnlinks href=#hl-19-231>231</a>
</span><span class=lnt id=hl-19-232><a class=lnlinks href=#hl-19-232>232</a>
</span><span class=lnt id=hl-19-233><a class=lnlinks href=#hl-19-233>233</a>
</span><span class=lnt id=hl-19-234><a class=lnlinks href=#hl-19-234>234</a>
</span><span class=lnt id=hl-19-235><a class=lnlinks href=#hl-19-235>235</a>
</span><span class=lnt id=hl-19-236><a class=lnlinks href=#hl-19-236>236</a>
</span><span class=lnt id=hl-19-237><a class=lnlinks href=#hl-19-237>237</a>
</span><span class=lnt id=hl-19-238><a class=lnlinks href=#hl-19-238>238</a>
</span><span class=lnt id=hl-19-239><a class=lnlinks href=#hl-19-239>239</a>
</span><span class=lnt id=hl-19-240><a class=lnlinks href=#hl-19-240>240</a>
</span><span class=lnt id=hl-19-241><a class=lnlinks href=#hl-19-241>241</a>
</span><span class=lnt id=hl-19-242><a class=lnlinks href=#hl-19-242>242</a>
</span><span class=lnt id=hl-19-243><a class=lnlinks href=#hl-19-243>243</a>
</span><span class=lnt id=hl-19-244><a class=lnlinks href=#hl-19-244>244</a>
</span><span class=lnt id=hl-19-245><a class=lnlinks href=#hl-19-245>245</a>
</span><span class=lnt id=hl-19-246><a class=lnlinks href=#hl-19-246>246</a>
</span><span class=lnt id=hl-19-247><a class=lnlinks href=#hl-19-247>247</a>
</span><span class=lnt id=hl-19-248><a class=lnlinks href=#hl-19-248>248</a>
</span><span class=lnt id=hl-19-249><a class=lnlinks href=#hl-19-249>249</a>
</span><span class=lnt id=hl-19-250><a class=lnlinks href=#hl-19-250>250</a>
</span><span class=lnt id=hl-19-251><a class=lnlinks href=#hl-19-251>251</a>
</span><span class=lnt id=hl-19-252><a class=lnlinks href=#hl-19-252>252</a>
</span><span class=lnt id=hl-19-253><a class=lnlinks href=#hl-19-253>253</a>
</span><span class=lnt id=hl-19-254><a class=lnlinks href=#hl-19-254>254</a>
</span><span class=lnt id=hl-19-255><a class=lnlinks href=#hl-19-255>255</a>
</span><span class=lnt id=hl-19-256><a class=lnlinks href=#hl-19-256>256</a>
</span><span class=lnt id=hl-19-257><a class=lnlinks href=#hl-19-257>257</a>
</span><span class=lnt id=hl-19-258><a class=lnlinks href=#hl-19-258>258</a>
</span><span class=lnt id=hl-19-259><a class=lnlinks href=#hl-19-259>259</a>
</span><span class=lnt id=hl-19-260><a class=lnlinks href=#hl-19-260>260</a>
</span><span class=lnt id=hl-19-261><a class=lnlinks href=#hl-19-261>261</a>
</span><span class=lnt id=hl-19-262><a class=lnlinks href=#hl-19-262>262</a>
</span><span class=lnt id=hl-19-263><a class=lnlinks href=#hl-19-263>263</a>
</span><span class=lnt id=hl-19-264><a class=lnlinks href=#hl-19-264>264</a>
</span><span class=lnt id=hl-19-265><a class=lnlinks href=#hl-19-265>265</a>
</span><span class=lnt id=hl-19-266><a class=lnlinks href=#hl-19-266>266</a>
</span><span class=lnt id=hl-19-267><a class=lnlinks href=#hl-19-267>267</a>
</span><span class=lnt id=hl-19-268><a class=lnlinks href=#hl-19-268>268</a>
</span><span class=lnt id=hl-19-269><a class=lnlinks href=#hl-19-269>269</a>
</span><span class=lnt id=hl-19-270><a class=lnlinks href=#hl-19-270>270</a>
</span><span class=lnt id=hl-19-271><a class=lnlinks href=#hl-19-271>271</a>
</span><span class=lnt id=hl-19-272><a class=lnlinks href=#hl-19-272>272</a>
</span><span class=lnt id=hl-19-273><a class=lnlinks href=#hl-19-273>273</a>
</span><span class=lnt id=hl-19-274><a class=lnlinks href=#hl-19-274>274</a>
</span><span class=lnt id=hl-19-275><a class=lnlinks href=#hl-19-275>275</a>
</span><span class=lnt id=hl-19-276><a class=lnlinks href=#hl-19-276>276</a>
</span><span class=lnt id=hl-19-277><a class=lnlinks href=#hl-19-277>277</a>
</span><span class=lnt id=hl-19-278><a class=lnlinks href=#hl-19-278>278</a>
</span><span class=lnt id=hl-19-279><a class=lnlinks href=#hl-19-279>279</a>
</span><span class=lnt id=hl-19-280><a class=lnlinks href=#hl-19-280>280</a>
</span><span class=lnt id=hl-19-281><a class=lnlinks href=#hl-19-281>281</a>
</span><span class=lnt id=hl-19-282><a class=lnlinks href=#hl-19-282>282</a>
</span><span class=lnt id=hl-19-283><a class=lnlinks href=#hl-19-283>283</a>
</span><span class=lnt id=hl-19-284><a class=lnlinks href=#hl-19-284>284</a>
</span><span class=lnt id=hl-19-285><a class=lnlinks href=#hl-19-285>285</a>
</span><span class=lnt id=hl-19-286><a class=lnlinks href=#hl-19-286>286</a>
</span><span class=lnt id=hl-19-287><a class=lnlinks href=#hl-19-287>287</a>
</span><span class=lnt id=hl-19-288><a class=lnlinks href=#hl-19-288>288</a>
</span><span class=lnt id=hl-19-289><a class=lnlinks href=#hl-19-289>289</a>
</span><span class=lnt id=hl-19-290><a class=lnlinks href=#hl-19-290>290</a>
</span><span class=lnt id=hl-19-291><a class=lnlinks href=#hl-19-291>291</a>
</span><span class=lnt id=hl-19-292><a class=lnlinks href=#hl-19-292>292</a>
</span><span class=lnt id=hl-19-293><a class=lnlinks href=#hl-19-293>293</a>
</span><span class=lnt id=hl-19-294><a class=lnlinks href=#hl-19-294>294</a>
</span><span class=lnt id=hl-19-295><a class=lnlinks href=#hl-19-295>295</a>
</span><span class=lnt id=hl-19-296><a class=lnlinks href=#hl-19-296>296</a>
</span><span class=lnt id=hl-19-297><a class=lnlinks href=#hl-19-297>297</a>
</span><span class=lnt id=hl-19-298><a class=lnlinks href=#hl-19-298>298</a>
</span><span class=lnt id=hl-19-299><a class=lnlinks href=#hl-19-299>299</a>
</span><span class=lnt id=hl-19-300><a class=lnlinks href=#hl-19-300>300</a>
</span><span class=lnt id=hl-19-301><a class=lnlinks href=#hl-19-301>301</a>
</span><span class=lnt id=hl-19-302><a class=lnlinks href=#hl-19-302>302</a>
</span><span class=lnt id=hl-19-303><a class=lnlinks href=#hl-19-303>303</a>
</span><span class=lnt id=hl-19-304><a class=lnlinks href=#hl-19-304>304</a>
</span><span class=lnt id=hl-19-305><a class=lnlinks href=#hl-19-305>305</a>
</span><span class=lnt id=hl-19-306><a class=lnlinks href=#hl-19-306>306</a>
</span><span class=lnt id=hl-19-307><a class=lnlinks href=#hl-19-307>307</a>
</span><span class=lnt id=hl-19-308><a class=lnlinks href=#hl-19-308>308</a>
</span><span class=lnt id=hl-19-309><a class=lnlinks href=#hl-19-309>309</a>
</span><span class=lnt id=hl-19-310><a class=lnlinks href=#hl-19-310>310</a>
</span><span class=lnt id=hl-19-311><a class=lnlinks href=#hl-19-311>311</a>
</span><span class=lnt id=hl-19-312><a class=lnlinks href=#hl-19-312>312</a>
</span><span class=lnt id=hl-19-313><a class=lnlinks href=#hl-19-313>313</a>
</span><span class=lnt id=hl-19-314><a class=lnlinks href=#hl-19-314>314</a>
</span><span class=lnt id=hl-19-315><a class=lnlinks href=#hl-19-315>315</a>
</span><span class=lnt id=hl-19-316><a class=lnlinks href=#hl-19-316>316</a>
</span><span class=lnt id=hl-19-317><a class=lnlinks href=#hl-19-317>317</a>
</span><span class=lnt id=hl-19-318><a class=lnlinks href=#hl-19-318>318</a>
</span><span class=lnt id=hl-19-319><a class=lnlinks href=#hl-19-319>319</a>
</span><span class=lnt id=hl-19-320><a class=lnlinks href=#hl-19-320>320</a>
</span><span class=lnt id=hl-19-321><a class=lnlinks href=#hl-19-321>321</a>
</span><span class=lnt id=hl-19-322><a class=lnlinks href=#hl-19-322>322</a>
</span><span class=lnt id=hl-19-323><a class=lnlinks href=#hl-19-323>323</a>
</span><span class=lnt id=hl-19-324><a class=lnlinks href=#hl-19-324>324</a>
</span><span class=lnt id=hl-19-325><a class=lnlinks href=#hl-19-325>325</a>
</span><span class=lnt id=hl-19-326><a class=lnlinks href=#hl-19-326>326</a>
</span><span class=lnt id=hl-19-327><a class=lnlinks href=#hl-19-327>327</a>
</span><span class=lnt id=hl-19-328><a class=lnlinks href=#hl-19-328>328</a>
</span><span class=lnt id=hl-19-329><a class=lnlinks href=#hl-19-329>329</a>
</span><span class=lnt id=hl-19-330><a class=lnlinks href=#hl-19-330>330</a>
</span><span class=lnt id=hl-19-331><a class=lnlinks href=#hl-19-331>331</a>
</span><span class=lnt id=hl-19-332><a class=lnlinks href=#hl-19-332>332</a>
</span><span class=lnt id=hl-19-333><a class=lnlinks href=#hl-19-333>333</a>
</span><span class=lnt id=hl-19-334><a class=lnlinks href=#hl-19-334>334</a>
</span><span class=lnt id=hl-19-335><a class=lnlinks href=#hl-19-335>335</a>
</span><span class=lnt id=hl-19-336><a class=lnlinks href=#hl-19-336>336</a>
</span><span class=lnt id=hl-19-337><a class=lnlinks href=#hl-19-337>337</a>
</span><span class=lnt id=hl-19-338><a class=lnlinks href=#hl-19-338>338</a>
</span><span class=lnt id=hl-19-339><a class=lnlinks href=#hl-19-339>339</a>
</span><span class=lnt id=hl-19-340><a class=lnlinks href=#hl-19-340>340</a>
</span><span class=lnt id=hl-19-341><a class=lnlinks href=#hl-19-341>341</a>
</span><span class=lnt id=hl-19-342><a class=lnlinks href=#hl-19-342>342</a>
</span><span class=lnt id=hl-19-343><a class=lnlinks href=#hl-19-343>343</a>
</span><span class=lnt id=hl-19-344><a class=lnlinks href=#hl-19-344>344</a>
</span><span class=lnt id=hl-19-345><a class=lnlinks href=#hl-19-345>345</a>
</span><span class=lnt id=hl-19-346><a class=lnlinks href=#hl-19-346>346</a>
</span><span class=lnt id=hl-19-347><a class=lnlinks href=#hl-19-347>347</a>
</span><span class=lnt id=hl-19-348><a class=lnlinks href=#hl-19-348>348</a>
</span><span class=lnt id=hl-19-349><a class=lnlinks href=#hl-19-349>349</a>
</span><span class=lnt id=hl-19-350><a class=lnlinks href=#hl-19-350>350</a>
</span><span class=lnt id=hl-19-351><a class=lnlinks href=#hl-19-351>351</a>
</span><span class=lnt id=hl-19-352><a class=lnlinks href=#hl-19-352>352</a>
</span><span class=lnt id=hl-19-353><a class=lnlinks href=#hl-19-353>353</a>
</span><span class=lnt id=hl-19-354><a class=lnlinks href=#hl-19-354>354</a>
</span><span class=lnt id=hl-19-355><a class=lnlinks href=#hl-19-355>355</a>
</span><span class=lnt id=hl-19-356><a class=lnlinks href=#hl-19-356>356</a>
</span><span class=lnt id=hl-19-357><a class=lnlinks href=#hl-19-357>357</a>
</span><span class=lnt id=hl-19-358><a class=lnlinks href=#hl-19-358>358</a>
</span><span class=lnt id=hl-19-359><a class=lnlinks href=#hl-19-359>359</a>
</span><span class=lnt id=hl-19-360><a class=lnlinks href=#hl-19-360>360</a>
</span><span class=lnt id=hl-19-361><a class=lnlinks href=#hl-19-361>361</a>
</span><span class=lnt id=hl-19-362><a class=lnlinks href=#hl-19-362>362</a>
</span><span class=lnt id=hl-19-363><a class=lnlinks href=#hl-19-363>363</a>
</span><span class=lnt id=hl-19-364><a class=lnlinks href=#hl-19-364>364</a>
</span><span class=lnt id=hl-19-365><a class=lnlinks href=#hl-19-365>365</a>
</span><span class=lnt id=hl-19-366><a class=lnlinks href=#hl-19-366>366</a>
</span><span class=lnt id=hl-19-367><a class=lnlinks href=#hl-19-367>367</a>
</span><span class=lnt id=hl-19-368><a class=lnlinks href=#hl-19-368>368</a>
</span><span class=lnt id=hl-19-369><a class=lnlinks href=#hl-19-369>369</a>
</span><span class=lnt id=hl-19-370><a class=lnlinks href=#hl-19-370>370</a>
</span><span class=lnt id=hl-19-371><a class=lnlinks href=#hl-19-371>371</a>
</span><span class=lnt id=hl-19-372><a class=lnlinks href=#hl-19-372>372</a>
</span><span class=lnt id=hl-19-373><a class=lnlinks href=#hl-19-373>373</a>
</span><span class=lnt id=hl-19-374><a class=lnlinks href=#hl-19-374>374</a>
</span><span class=lnt id=hl-19-375><a class=lnlinks href=#hl-19-375>375</a>
</span><span class=lnt id=hl-19-376><a class=lnlinks href=#hl-19-376>376</a>
</span><span class=lnt id=hl-19-377><a class=lnlinks href=#hl-19-377>377</a>
</span><span class=lnt id=hl-19-378><a class=lnlinks href=#hl-19-378>378</a>
</span><span class=lnt id=hl-19-379><a class=lnlinks href=#hl-19-379>379</a>
</span><span class=lnt id=hl-19-380><a class=lnlinks href=#hl-19-380>380</a>
</span><span class=lnt id=hl-19-381><a class=lnlinks href=#hl-19-381>381</a>
</span><span class=lnt id=hl-19-382><a class=lnlinks href=#hl-19-382>382</a>
</span><span class=lnt id=hl-19-383><a class=lnlinks href=#hl-19-383>383</a>
</span><span class=lnt id=hl-19-384><a class=lnlinks href=#hl-19-384>384</a>
</span><span class=lnt id=hl-19-385><a class=lnlinks href=#hl-19-385>385</a>
</span><span class=lnt id=hl-19-386><a class=lnlinks href=#hl-19-386>386</a>
</span><span class=lnt id=hl-19-387><a class=lnlinks href=#hl-19-387>387</a>
</span><span class=lnt id=hl-19-388><a class=lnlinks href=#hl-19-388>388</a>
</span><span class=lnt id=hl-19-389><a class=lnlinks href=#hl-19-389>389</a>
</span><span class=lnt id=hl-19-390><a class=lnlinks href=#hl-19-390>390</a>
</span><span class=lnt id=hl-19-391><a class=lnlinks href=#hl-19-391>391</a>
</span><span class=lnt id=hl-19-392><a class=lnlinks href=#hl-19-392>392</a>
</span><span class=lnt id=hl-19-393><a class=lnlinks href=#hl-19-393>393</a>
</span><span class=lnt id=hl-19-394><a class=lnlinks href=#hl-19-394>394</a>
</span><span class=lnt id=hl-19-395><a class=lnlinks href=#hl-19-395>395</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 RabbitMQ 모니터링 및 자동화된 대응 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>axios</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cron</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;node-cron&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MessageQueueMonitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>config</span> <span class=o>=</span> <span class=nx>config</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>alerts</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>connect</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>rabbitmq</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;RabbitMQ에 연결되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>monitorQueues</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>connected</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>connected</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;모니터링을 시작할 수 없습니다: RabbitMQ에 연결되지 않음&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 모든 큐 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>queueName</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>queues</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>queueInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 이전 상태 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>const</span> <span class=nx>prevStatus</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>queueName</span><span class=p>]</span> <span class=o>||</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 현재 상태 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>queueName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>queueInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>queueInfo</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>previousCount</span><span class=o>:</span> <span class=nx>prevStatus</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>||</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>growth</span><span class=o>:</span> <span class=nx>prevStatus</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>!==</span> <span class=kc>undefined</span> <span class=o>?</span> 
</span></span><span class=line><span class=cl>              <span class=nx>queueInfo</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>-</span> <span class=nx>prevStatus</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 경보 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>checkAlerts</span><span class=p>(</span><span class=nx>queueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>: 메시지=</span><span class=si>${</span><span class=nx>queueInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=si>}</span><span class=sb>, 소비자=</span><span class=si>${</span><span class=nx>queueInfo</span><span class=p>.</span><span class=nx>consumerCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb> 모니터링 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 데드 레터 큐 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>dlqName</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterQueues</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>dlqInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>dlqName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=nx>dlqName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>isDLQ</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 데드 레터 큐 경보 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>if</span> <span class=p>(</span><span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>deadLetterThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>              <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;dead_letter_buildup&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>queue</span><span class=o>:</span> <span class=nx>dlqName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>threshold</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>deadLetterThreshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb>: 메시지=</span><span class=si>${</span><span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb> 모니터링 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 메트릭 보고
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>reportMetrics</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;큐 모니터링 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 연결 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>checkAlerts</span><span class=p>(</span><span class=nx>queueName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>status</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>queueName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 큐 적체 경보
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>queueSizeThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;queue_buildup&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>queue</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>threshold</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>queueSizeThreshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 자동화된 대응 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>scaleUpConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메시지 증가율 경보
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>growth</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>growthRateThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;queue_growth_rate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>queue</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>growth</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>growth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>threshold</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>growthRateThreshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 소비자 부족 경보
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>consumerCount</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>minConsumers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;consumer_shortage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>queue</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>minRequired</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>minConsumers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 자동화된 대응 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>restartConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>triggerAlert</span><span class=p>(</span><span class=nx>alert</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`경보 발생: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>alert</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 경보 중복 방지 (같은 유형의 경보가 5분 내에 발생한 경우)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>recentSimilarAlert</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>alerts</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>a</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>type</span> <span class=o>&amp;&amp;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>queue</span> <span class=o>===</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>a</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span> <span class=o>-</span> <span class=nx>a</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>recentSimilarAlert</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 알림 전송 (Slack, 이메일 등)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>sendNotification</span><span class=p>(</span><span class=nx>alert</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>sendNotification</span><span class=p>(</span><span class=nx>alert</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Slack 웹훅 알림 전송 예시
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>notifications</span><span class=p>.</span><span class=nx>slack</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>severity</span> <span class=o>=</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;buildup&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;shortage&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>          <span class=o>?</span> <span class=s1>&#39;🔴 심각&#39;</span> <span class=o>:</span> <span class=s1>&#39;🟠 경고&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>notifications</span><span class=p>.</span><span class=nx>slack</span><span class=p>.</span><span class=nx>webhookUrl</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>severity</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>blocks</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;section&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>text</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>text</span><span class=o>:</span> <span class=sb>`*</span><span class=si>${</span><span class=nx>severity</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb>*`</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;section&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*큐:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*메시지 수:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>||</span> <span class=s1>&#39;N/A&#39;</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*임계값:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>threshold</span> <span class=o>||</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>minRequired</span> <span class=o>||</span> <span class=s1>&#39;N/A&#39;</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*시간:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>.</span><span class=nx>toISOString</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Slack 알림 전송됨: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;알림 전송 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>reportMetrics</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 보고 (Prometheus, CloudWatch 등)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>metrics</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>values</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>status</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>queueName</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>isDLQ</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>isDLQ</span> <span class=o>||</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>timestamp</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>.</span><span class=nx>getTime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 메트릭 API로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>,</span> <span class=p>{</span> <span class=nx>metrics</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;메트릭 보고 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;메트릭 보고 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>scaleUpConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>에 대한 소비자 확장 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Kubernetes API 호출 예시 (실제 환경에 맞게 조정 필요)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>k8sApi</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>deployment</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>deployments</span><span class=p>[</span><span class=nx>queueName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>deployment</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>patch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`</span><span class=si>${</span><span class=nx>k8sApi</span><span class=si>}</span><span class=sb>/namespaces/</span><span class=si>${</span><span class=nx>deployment</span><span class=p>.</span><span class=nx>namespace</span><span class=si>}</span><span class=sb>/deployments/</span><span class=si>${</span><span class=nx>deployment</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>/scale`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>spec</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>replicas</span><span class=o>:</span> <span class=nx>deployment</span><span class=p>.</span><span class=nx>maxReplicas</span> <span class=o>||</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>token</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/strategic-merge-patch+json&#39;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb> 소비자 수 확장 완료`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`소비자 확장 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>restartConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>에 대한 소비자 재시작 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 소비자 서비스 재시작 로직 구현
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// (실제 환경에 맞는 API 호출 또는 스크립트 실행)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`소비자 재시작 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>purgeDeadLetterQueue</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb> 비우기 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 각 메시지를 가져와서 로그로 기록 후 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kd>let</span> <span class=nx>emptyQueue</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>processedCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=nx>emptyQueue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>,</span> <span class=p>{</span> <span class=nx>noAck</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 메시지 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`DLQ 메시지: </span><span class=si>${</span><span class=nx>message</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 메시지 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>processedCount</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>emptyQueue</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb>에서 </span><span class=si>${</span><span class=nx>processedCount</span><span class=si>}</span><span class=sb>개 메시지 처리됨`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`데드 레터 큐 비우기 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>start</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 초기 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 정기적인 모니터링 스케줄링
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>cron</span><span class=p>.</span><span class=nx>schedule</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>monitoringInterval</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>monitorQueues</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 데드 레터 큐 정기 점검
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterCleanup</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>cron</span><span class=p>.</span><span class=nx>schedule</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterCleanup</span><span class=p>.</span><span class=nx>schedule</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>dlqName</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterQueues</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>purgeDeadLetterQueue</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;메시지 큐 모니터링 시작됨&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>stop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;메시지 큐 모니터링 중지됨&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 설정 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>rabbitmq</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;amqp://guest:guest@localhost&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>queues</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=s1>&#39;emails&#39;</span><span class=p>,</span> <span class=s1>&#39;payments&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>deadLetterQueues</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;orders.failed&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications.failed&#39;</span><span class=p>,</span> <span class=s1>&#39;emails.failed&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>monitoringInterval</span><span class=o>:</span> <span class=s1>&#39;*/1 * * * *&#39;</span><span class=p>,</span>  <span class=c1>// 매 분마다
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>alerts</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>queueSizeThreshold</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>growthRateThreshold</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>minConsumers</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>deadLetterThreshold</span><span class=o>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>autoRemediation</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>kubernetes</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>endpoint</span><span class=o>:</span> <span class=s1>&#39;https://kubernetes.default.svc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>token</span><span class=o>:</span> <span class=s1>&#39;k8s-token&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>deployments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>orders</span><span class=o>:</span> <span class=p>{</span> <span class=nx>namespace</span><span class=o>:</span> <span class=s1>&#39;default&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;order-consumer&#39;</span><span class=p>,</span> <span class=nx>maxReplicas</span><span class=o>:</span> <span class=mi>5</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>notifications</span><span class=o>:</span> <span class=p>{</span> <span class=nx>namespace</span><span class=o>:</span> <span class=s1>&#39;default&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;notification-consumer&#39;</span><span class=p>,</span> <span class=nx>maxReplicas</span><span class=o>:</span> <span class=mi>3</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>deadLetterCleanup</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>schedule</span><span class=o>:</span> <span class=s1>&#39;0 * * * *&#39;</span>  <span class=c1>// 매 시간마다
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>notifications</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slack</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>webhookUrl</span><span class=o>:</span> <span class=s1>&#39;https://hooks.slack.com/services/XXX/YYY/ZZZ&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>metrics</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpoint</span><span class=o>:</span> <span class=s1>&#39;http://metrics-collector:8080/api/metrics&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 모니터링 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>monitor</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MessageQueueMonitor</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>monitor</span><span class=p>.</span><span class=nx>start</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 정상 종료 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;프로그램 종료 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>monitor</span><span class=p>.</span><span class=nx>stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐의-고급-응용-패턴>메시징 큐의 고급 응용 패턴<a hidden class=anchor aria-hidden=true href=#메시징-큐의-고급-응용-패턴>#</a></h3><h4 id=명령-쿼리-책임-분리cqrs와-이벤트-소싱event-sourcing>명령 쿼리 책임 분리(CQRS)와 이벤트 소싱(Event Sourcing)<a hidden class=anchor aria-hidden=true href=#명령-쿼리-책임-분리cqrs와-이벤트-소싱event-sourcing>#</a></h4><p>메시징 큐는 CQRS와 이벤트 소싱 패턴을 구현하는 데 핵심적인 역할을 한다. 이벤트를 저장하고 전파하여 시스템의 상태 변화를 추적한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>  1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>  2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>  3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>  4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>  5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>  6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>  7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>  8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9>  9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10> 10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11> 11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12> 12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13> 13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14> 14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15> 15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16> 16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17> 17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18> 18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19> 19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20> 20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21> 21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22> 22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23> 23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24> 24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25> 25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26> 26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27> 27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28> 28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29> 29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30> 30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31> 31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32> 32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33> 33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34> 34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35> 35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36> 36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37> 37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38> 38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39> 39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40> 40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41> 41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42> 42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43> 43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44> 44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45> 45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46> 46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47> 47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48> 48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49> 49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50> 50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51> 51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52> 52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53> 53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54> 54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55> 55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56> 56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57> 57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58> 58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59> 59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60> 60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61> 61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62> 62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63> 63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64> 64</a>
</span><span class=lnt id=hl-20-65><a class=lnlinks href=#hl-20-65> 65</a>
</span><span class=lnt id=hl-20-66><a class=lnlinks href=#hl-20-66> 66</a>
</span><span class=lnt id=hl-20-67><a class=lnlinks href=#hl-20-67> 67</a>
</span><span class=lnt id=hl-20-68><a class=lnlinks href=#hl-20-68> 68</a>
</span><span class=lnt id=hl-20-69><a class=lnlinks href=#hl-20-69> 69</a>
</span><span class=lnt id=hl-20-70><a class=lnlinks href=#hl-20-70> 70</a>
</span><span class=lnt id=hl-20-71><a class=lnlinks href=#hl-20-71> 71</a>
</span><span class=lnt id=hl-20-72><a class=lnlinks href=#hl-20-72> 72</a>
</span><span class=lnt id=hl-20-73><a class=lnlinks href=#hl-20-73> 73</a>
</span><span class=lnt id=hl-20-74><a class=lnlinks href=#hl-20-74> 74</a>
</span><span class=lnt id=hl-20-75><a class=lnlinks href=#hl-20-75> 75</a>
</span><span class=lnt id=hl-20-76><a class=lnlinks href=#hl-20-76> 76</a>
</span><span class=lnt id=hl-20-77><a class=lnlinks href=#hl-20-77> 77</a>
</span><span class=lnt id=hl-20-78><a class=lnlinks href=#hl-20-78> 78</a>
</span><span class=lnt id=hl-20-79><a class=lnlinks href=#hl-20-79> 79</a>
</span><span class=lnt id=hl-20-80><a class=lnlinks href=#hl-20-80> 80</a>
</span><span class=lnt id=hl-20-81><a class=lnlinks href=#hl-20-81> 81</a>
</span><span class=lnt id=hl-20-82><a class=lnlinks href=#hl-20-82> 82</a>
</span><span class=lnt id=hl-20-83><a class=lnlinks href=#hl-20-83> 83</a>
</span><span class=lnt id=hl-20-84><a class=lnlinks href=#hl-20-84> 84</a>
</span><span class=lnt id=hl-20-85><a class=lnlinks href=#hl-20-85> 85</a>
</span><span class=lnt id=hl-20-86><a class=lnlinks href=#hl-20-86> 86</a>
</span><span class=lnt id=hl-20-87><a class=lnlinks href=#hl-20-87> 87</a>
</span><span class=lnt id=hl-20-88><a class=lnlinks href=#hl-20-88> 88</a>
</span><span class=lnt id=hl-20-89><a class=lnlinks href=#hl-20-89> 89</a>
</span><span class=lnt id=hl-20-90><a class=lnlinks href=#hl-20-90> 90</a>
</span><span class=lnt id=hl-20-91><a class=lnlinks href=#hl-20-91> 91</a>
</span><span class=lnt id=hl-20-92><a class=lnlinks href=#hl-20-92> 92</a>
</span><span class=lnt id=hl-20-93><a class=lnlinks href=#hl-20-93> 93</a>
</span><span class=lnt id=hl-20-94><a class=lnlinks href=#hl-20-94> 94</a>
</span><span class=lnt id=hl-20-95><a class=lnlinks href=#hl-20-95> 95</a>
</span><span class=lnt id=hl-20-96><a class=lnlinks href=#hl-20-96> 96</a>
</span><span class=lnt id=hl-20-97><a class=lnlinks href=#hl-20-97> 97</a>
</span><span class=lnt id=hl-20-98><a class=lnlinks href=#hl-20-98> 98</a>
</span><span class=lnt id=hl-20-99><a class=lnlinks href=#hl-20-99> 99</a>
</span><span class=lnt id=hl-20-100><a class=lnlinks href=#hl-20-100>100</a>
</span><span class=lnt id=hl-20-101><a class=lnlinks href=#hl-20-101>101</a>
</span><span class=lnt id=hl-20-102><a class=lnlinks href=#hl-20-102>102</a>
</span><span class=lnt id=hl-20-103><a class=lnlinks href=#hl-20-103>103</a>
</span><span class=lnt id=hl-20-104><a class=lnlinks href=#hl-20-104>104</a>
</span><span class=lnt id=hl-20-105><a class=lnlinks href=#hl-20-105>105</a>
</span><span class=lnt id=hl-20-106><a class=lnlinks href=#hl-20-106>106</a>
</span><span class=lnt id=hl-20-107><a class=lnlinks href=#hl-20-107>107</a>
</span><span class=lnt id=hl-20-108><a class=lnlinks href=#hl-20-108>108</a>
</span><span class=lnt id=hl-20-109><a class=lnlinks href=#hl-20-109>109</a>
</span><span class=lnt id=hl-20-110><a class=lnlinks href=#hl-20-110>110</a>
</span><span class=lnt id=hl-20-111><a class=lnlinks href=#hl-20-111>111</a>
</span><span class=lnt id=hl-20-112><a class=lnlinks href=#hl-20-112>112</a>
</span><span class=lnt id=hl-20-113><a class=lnlinks href=#hl-20-113>113</a>
</span><span class=lnt id=hl-20-114><a class=lnlinks href=#hl-20-114>114</a>
</span><span class=lnt id=hl-20-115><a class=lnlinks href=#hl-20-115>115</a>
</span><span class=lnt id=hl-20-116><a class=lnlinks href=#hl-20-116>116</a>
</span><span class=lnt id=hl-20-117><a class=lnlinks href=#hl-20-117>117</a>
</span><span class=lnt id=hl-20-118><a class=lnlinks href=#hl-20-118>118</a>
</span><span class=lnt id=hl-20-119><a class=lnlinks href=#hl-20-119>119</a>
</span><span class=lnt id=hl-20-120><a class=lnlinks href=#hl-20-120>120</a>
</span><span class=lnt id=hl-20-121><a class=lnlinks href=#hl-20-121>121</a>
</span><span class=lnt id=hl-20-122><a class=lnlinks href=#hl-20-122>122</a>
</span><span class=lnt id=hl-20-123><a class=lnlinks href=#hl-20-123>123</a>
</span><span class=lnt id=hl-20-124><a class=lnlinks href=#hl-20-124>124</a>
</span><span class=lnt id=hl-20-125><a class=lnlinks href=#hl-20-125>125</a>
</span><span class=lnt id=hl-20-126><a class=lnlinks href=#hl-20-126>126</a>
</span><span class=lnt id=hl-20-127><a class=lnlinks href=#hl-20-127>127</a>
</span><span class=lnt id=hl-20-128><a class=lnlinks href=#hl-20-128>128</a>
</span><span class=lnt id=hl-20-129><a class=lnlinks href=#hl-20-129>129</a>
</span><span class=lnt id=hl-20-130><a class=lnlinks href=#hl-20-130>130</a>
</span><span class=lnt id=hl-20-131><a class=lnlinks href=#hl-20-131>131</a>
</span><span class=lnt id=hl-20-132><a class=lnlinks href=#hl-20-132>132</a>
</span><span class=lnt id=hl-20-133><a class=lnlinks href=#hl-20-133>133</a>
</span><span class=lnt id=hl-20-134><a class=lnlinks href=#hl-20-134>134</a>
</span><span class=lnt id=hl-20-135><a class=lnlinks href=#hl-20-135>135</a>
</span><span class=lnt id=hl-20-136><a class=lnlinks href=#hl-20-136>136</a>
</span><span class=lnt id=hl-20-137><a class=lnlinks href=#hl-20-137>137</a>
</span><span class=lnt id=hl-20-138><a class=lnlinks href=#hl-20-138>138</a>
</span><span class=lnt id=hl-20-139><a class=lnlinks href=#hl-20-139>139</a>
</span><span class=lnt id=hl-20-140><a class=lnlinks href=#hl-20-140>140</a>
</span><span class=lnt id=hl-20-141><a class=lnlinks href=#hl-20-141>141</a>
</span><span class=lnt id=hl-20-142><a class=lnlinks href=#hl-20-142>142</a>
</span><span class=lnt id=hl-20-143><a class=lnlinks href=#hl-20-143>143</a>
</span><span class=lnt id=hl-20-144><a class=lnlinks href=#hl-20-144>144</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// TypeScript를 사용한 CQRS 및 이벤트 소싱 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>EventBus</span><span class=p>,</span> <span class=nx>CommandBus</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;some-event-library&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령(Command) 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>interface</span> <span class=nx>CreateOrderCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;CreateOrder&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>customerId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>items</span>: <span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>productId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>shippingAddress</span>: <span class=kt>Address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트(Event) 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>interface</span> <span class=nx>OrderCreatedEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>orderId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>customerId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>items</span>: <span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>productId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>totalAmount</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>shippingAddress</span>: <span class=kt>Address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>createdAt</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 핸들러
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>CreateOrderHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>orderRepository</span>: <span class=kt>OrderRepository</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>eventBus</span>: <span class=kt>EventBus</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span>: <span class=kt>CreateOrderCommand</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 비즈니스 로직 및 유효성 검사
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>shippingAddress</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>command</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 새 주문 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>generateId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>calculateTotalAmount</span><span class=p>(</span><span class=nx>items</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>shippingAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderRepository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>event</span>: <span class=kt>OrderCreatedEvent</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>orderId</span>: <span class=kt>order.id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>customerId</span>: <span class=kt>order.customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>items</span>: <span class=kt>order.items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>totalAmount</span>: <span class=kt>order.totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>shippingAddress</span>: <span class=kt>order.shippingAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span>: <span class=kt>order.createdAt</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>order</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 핸들러 (읽기 모델 업데이트)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCreatedEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>orderReadModel</span>: <span class=kt>OrderReadModel</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>event</span>: <span class=kt>OrderCreatedEvent</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>totalAmount</span><span class=p>,</span> <span class=nx>shippingAddress</span><span class=p>,</span> <span class=nx>createdAt</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 읽기 모델 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderReadModel</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>items</span>: <span class=kt>items.map</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>productId</span>: <span class=kt>item.productId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>quantity</span>: <span class=kt>item.quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>price</span>: <span class=kt>item.price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>subtotal</span>: <span class=kt>item.price</span> <span class=o>*</span> <span class=nx>item</span><span class=p>.</span><span class=nx>quantity</span>
</span></span><span class=line><span class=cl>      <span class=p>})),</span>
</span></span><span class=line><span class=cl>      <span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>shippingAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>createdAt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>updatedAt</span>: <span class=kt>createdAt</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 컨트롤러
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>commandBus</span>: <span class=kt>CommandBus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>orderReadModel</span>: <span class=kt>OrderReadModel</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 명령 처리 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>command</span>: <span class=kt>CreateOrderCommand</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;CreateOrder&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>payload</span>: <span class=kt>req.body</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>commandBus</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>orderId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span>: <span class=kt>error.message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 쿼리 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderReadModel</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>order</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Order not found&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span>: <span class=kt>error.message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=서킷-브레이커circuit-breaker-패턴>서킷 브레이커(Circuit Breaker) 패턴<a hidden class=anchor aria-hidden=true href=#서킷-브레이커circuit-breaker-패턴>#</a></h4><p>메시징 큐와 함께 서킷 브레이커 패턴을 사용하면 다운스트림 서비스의 장애로부터 시스템을 보호할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37>37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38>38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39>39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40>40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41>41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42>42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43>43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44>44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45>45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46>46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47>47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48>48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49>49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50>50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51>51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52>52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53>53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54>54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55>55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56>56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57>57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58>58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59>59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60>60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61>61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62>62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63>63</a>
</span><span class=lnt id=hl-21-64><a class=lnlinks href=#hl-21-64>64</a>
</span><span class=lnt id=hl-21-65><a class=lnlinks href=#hl-21-65>65</a>
</span><span class=lnt id=hl-21-66><a class=lnlinks href=#hl-21-66>66</a>
</span><span class=lnt id=hl-21-67><a class=lnlinks href=#hl-21-67>67</a>
</span><span class=lnt id=hl-21-68><a class=lnlinks href=#hl-21-68>68</a>
</span><span class=lnt id=hl-21-69><a class=lnlinks href=#hl-21-69>69</a>
</span><span class=lnt id=hl-21-70><a class=lnlinks href=#hl-21-70>70</a>
</span><span class=lnt id=hl-21-71><a class=lnlinks href=#hl-21-71>71</a>
</span><span class=lnt id=hl-21-72><a class=lnlinks href=#hl-21-72>72</a>
</span><span class=lnt id=hl-21-73><a class=lnlinks href=#hl-21-73>73</a>
</span><span class=lnt id=hl-21-74><a class=lnlinks href=#hl-21-74>74</a>
</span><span class=lnt id=hl-21-75><a class=lnlinks href=#hl-21-75>75</a>
</span><span class=lnt id=hl-21-76><a class=lnlinks href=#hl-21-76>76</a>
</span><span class=lnt id=hl-21-77><a class=lnlinks href=#hl-21-77>77</a>
</span><span class=lnt id=hl-21-78><a class=lnlinks href=#hl-21-78>78</a>
</span><span class=lnt id=hl-21-79><a class=lnlinks href=#hl-21-79>79</a>
</span><span class=lnt id=hl-21-80><a class=lnlinks href=#hl-21-80>80</a>
</span><span class=lnt id=hl-21-81><a class=lnlinks href=#hl-21-81>81</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java Spring Boot에서 서킷 브레이커와 메시징 큐 통합 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResilientMessageService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreakerFactory</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResilientMessageService</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CircuitBreakerFactory</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreakerFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendMessageWithCircuitBreaker</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;messagingCircuitBreaker&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>run</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 정상 경로: 메시지 전송 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 폴백 경로: 브로커 장애 시 대체 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>handleMessageSendFailure</span><span class=p>(</span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleMessageSendFailure</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=n>throwable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;메시지 전송 실패: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 로컬 저장소에 메시지 임시 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>saveMessageToLocalStorage</span><span class=p>(</span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 알림 발송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>notifyOperationsTeam</span><span class=p>(</span><span class=s>&#34;메시징 서비스 장애&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;메시지 전송 실패: 교환기=%s, 라우팅 키=%s, 오류=%s&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>60000</span><span class=p>)</span><span class=w> </span><span class=c1>// 1분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>retryFailedMessages</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>StoredMessage</span><span class=o>&gt;</span><span class=w> </span><span class=n>failedMessages</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getFailedMessagesFromLocalStorage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>failedMessages</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;실패한 메시지 {} 개 재시도 중&#34;</span><span class=p>,</span><span class=w> </span><span class=n>failedMessages</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>StoredMessage</span><span class=w> </span><span class=n>storedMessage</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>failedMessages</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 서킷 브레이커 상태 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;messagingCircuitBreaker&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>getState</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=p>.</span><span class=na>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 메시지 재전송 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getExchange</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getRoutingKey</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 성공적으로 전송된 메시지 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>removeMessageFromLocalStorage</span><span class=p>(</span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;메시지 ID {} 재전송 성공&#34;</span><span class=p>,</span><span class=w> </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;서킷 브레이커가 열려 있어 재시도 건너뜀 (상태: {})&#34;</span><span class=p>,</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>getState</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=p>;</span><span class=w>  </span><span class=c1>// 브레이커가 열려 있으면 더 이상 시도하지 않음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;메시지 ID {} 재전송 실패: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 재시도 횟수 및 마지막 시도 시간 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>updateRetryStatus</span><span class=p>(</span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=백-프레셔back-pressure-처리>백 프레셔(Back Pressure) 처리<a hidden class=anchor aria-hidden=true href=#백-프레셔back-pressure-처리>#</a></h4><p>시스템이 처리할 수 있는 것보다 더 많은 메시지가 유입될 때 백 프레셔 메커니즘을 통해 과부하를 방지한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26>26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27>27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28>28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29>29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30>30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31>31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32>32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33>33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34>34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35>35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36>36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37>37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38>38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39>39</a>
</span><span class=lnt id=hl-22-40><a class=lnlinks href=#hl-22-40>40</a>
</span><span class=lnt id=hl-22-41><a class=lnlinks href=#hl-22-41>41</a>
</span><span class=lnt id=hl-22-42><a class=lnlinks href=#hl-22-42>42</a>
</span><span class=lnt id=hl-22-43><a class=lnlinks href=#hl-22-43>43</a>
</span><span class=lnt id=hl-22-44><a class=lnlinks href=#hl-22-44>44</a>
</span><span class=lnt id=hl-22-45><a class=lnlinks href=#hl-22-45>45</a>
</span><span class=lnt id=hl-22-46><a class=lnlinks href=#hl-22-46>46</a>
</span><span class=lnt id=hl-22-47><a class=lnlinks href=#hl-22-47>47</a>
</span><span class=lnt id=hl-22-48><a class=lnlinks href=#hl-22-48>48</a>
</span><span class=lnt id=hl-22-49><a class=lnlinks href=#hl-22-49>49</a>
</span><span class=lnt id=hl-22-50><a class=lnlinks href=#hl-22-50>50</a>
</span><span class=lnt id=hl-22-51><a class=lnlinks href=#hl-22-51>51</a>
</span><span class=lnt id=hl-22-52><a class=lnlinks href=#hl-22-52>52</a>
</span><span class=lnt id=hl-22-53><a class=lnlinks href=#hl-22-53>53</a>
</span><span class=lnt id=hl-22-54><a class=lnlinks href=#hl-22-54>54</a>
</span><span class=lnt id=hl-22-55><a class=lnlinks href=#hl-22-55>55</a>
</span><span class=lnt id=hl-22-56><a class=lnlinks href=#hl-22-56>56</a>
</span><span class=lnt id=hl-22-57><a class=lnlinks href=#hl-22-57>57</a>
</span><span class=lnt id=hl-22-58><a class=lnlinks href=#hl-22-58>58</a>
</span><span class=lnt id=hl-22-59><a class=lnlinks href=#hl-22-59>59</a>
</span><span class=lnt id=hl-22-60><a class=lnlinks href=#hl-22-60>60</a>
</span><span class=lnt id=hl-22-61><a class=lnlinks href=#hl-22-61>61</a>
</span><span class=lnt id=hl-22-62><a class=lnlinks href=#hl-22-62>62</a>
</span><span class=lnt id=hl-22-63><a class=lnlinks href=#hl-22-63>63</a>
</span><span class=lnt id=hl-22-64><a class=lnlinks href=#hl-22-64>64</a>
</span><span class=lnt id=hl-22-65><a class=lnlinks href=#hl-22-65>65</a>
</span><span class=lnt id=hl-22-66><a class=lnlinks href=#hl-22-66>66</a>
</span><span class=lnt id=hl-22-67><a class=lnlinks href=#hl-22-67>67</a>
</span><span class=lnt id=hl-22-68><a class=lnlinks href=#hl-22-68>68</a>
</span><span class=lnt id=hl-22-69><a class=lnlinks href=#hl-22-69>69</a>
</span><span class=lnt id=hl-22-70><a class=lnlinks href=#hl-22-70>70</a>
</span><span class=lnt id=hl-22-71><a class=lnlinks href=#hl-22-71>71</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Kotlin과 Reactor를 사용한 백 프레셔 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>import</span> <span class=nn>org.springframework.stereotype.Service</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>org.springframework.amqp.rabbit.core.RabbitTemplate</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>org.springframework.amqp.rabbit.annotation.RabbitListener</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>reactor.core.publisher.Flux</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>reactor.core.publisher.Sinks</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>reactor.core.scheduler.Schedulers</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>java.time.Duration</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>java.util.concurrent.atomic.AtomicInteger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BackPressureMessageProcessor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>rabbitTemplate</span><span class=p>:</span> <span class=n>RabbitTemplate</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>messageCount</span> <span class=p>=</span> <span class=n>AtomicInteger</span><span class=p>(</span><span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>processingSink</span> <span class=p>=</span> <span class=nc>Sinks</span><span class=p>.</span><span class=n>many</span><span class=p>().</span><span class=n>multicast</span><span class=p>().</span><span class=n>onBackpressureBuffer</span><span class=p>&lt;</span><span class=n>Message</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>processingFlux</span> <span class=p>=</span> <span class=n>processingSink</span><span class=p>.</span><span class=n>asFlux</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>init</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 초당 최대 100개 메시지만 처리하도록 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>processingFlux</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>publishOn</span><span class=p>(</span><span class=nc>Schedulers</span><span class=p>.</span><span class=n>boundedElastic</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>window</span><span class=p>(</span><span class=nc>Duration</span><span class=p>.</span><span class=n>ofSeconds</span><span class=p>(</span><span class=m>1</span><span class=p>),</span> <span class=m>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>flatMap</span> <span class=p>{</span> <span class=n>window</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>window</span><span class=p>.</span><span class=n>doOnNext</span> <span class=p>{</span> <span class=n>msg</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>processMessage</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>subscribe</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 현재 처리 상태 모니터링 및 보고
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nc>Flux</span><span class=p>.</span><span class=n>interval</span><span class=p>(</span><span class=nc>Duration</span><span class=p>.</span><span class=n>ofSeconds</span><span class=p>(</span><span class=m>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>subscribe</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>messageCount</span><span class=p>.</span><span class=n>getAndSet</span><span class=p>(</span><span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;지난 10초 동안 처리된 메시지: </span><span class=si>$count</span><span class=s2> (초당 </span><span class=si>${count / 10.0}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;high-volume-queue&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>receiveMessage</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>emitResult</span> <span class=p>=</span> <span class=n>processingSink</span><span class=p>.</span><span class=n>tryEmitNext</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>emitResult</span><span class=p>.</span><span class=n>isFailure</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 백 프레셔 적용 - 큐로 다시 보내기
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>log</span><span class=p>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;처리 용량 초과, 메시지를 지연 큐로 리다이렉션&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>rabbitTemplate</span><span class=p>.</span><span class=n>convertAndSend</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;delayed.exchange&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;delayed.routing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>messagePostProcessor</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>messagePostProcessor</span><span class=p>.</span><span class=n>messageProperties</span><span class=p>.</span><span class=n>setHeader</span><span class=p>(</span><span class=s2>&#34;x-delay&#34;</span><span class=p>,</span> <span class=m>30000</span><span class=p>)</span> <span class=c1>// 30초 지연
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>messagePostProcessor</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>fun</span> <span class=nf>processMessage</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 실제 메시지 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>log</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;메시지 처리 중: </span><span class=si>${message.id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 처리 시간 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nc>Thread</span><span class=p>.</span><span class=n>sleep</span><span class=p>((</span><span class=m>10.</span><span class=p>).</span><span class=n>random</span><span class=p>().</span><span class=n>toLong</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>messageCount</span><span class=p>.</span><span class=n>incrementAndGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>Exception</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;메시지 처리 오류: </span><span class=si>${e.message}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분산-추적distributed-tracing>분산 추적(Distributed Tracing)<a hidden class=anchor aria-hidden=true href=#분산-추적distributed-tracing>#</a></h4><p>여러 서비스와 큐를 통과하는 메시지의 흐름을 추적하여 시스템 성능 및 오류를 모니터링한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>  1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>  2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>  3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>  4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>  5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>  6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>  7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>  8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>  9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10> 10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11> 11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12> 12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13> 13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14> 14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15> 15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16> 16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17> 17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18> 18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19> 19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20> 20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21> 21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22> 22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23> 23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24> 24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25> 25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26> 26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27> 27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28> 28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29> 29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30> 30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31> 31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32> 32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33> 33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34> 34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35> 35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36> 36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37> 37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38> 38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39> 39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40> 40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41> 41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42> 42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43> 43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44> 44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45> 45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46> 46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47> 47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48> 48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49> 49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50> 50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51> 51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52> 52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53> 53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54> 54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55> 55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56> 56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57> 57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58> 58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59> 59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60> 60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61> 61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62> 62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63> 63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64> 64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65> 65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66> 66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67> 67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68> 68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69> 69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70> 70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71> 71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72> 72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73> 73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74> 74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75> 75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76> 76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77> 77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78> 78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79> 79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80> 80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81> 81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82> 82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83> 83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84> 84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85> 85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86> 86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87> 87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88> 88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89> 89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90> 90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91> 91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92> 92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93> 93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94> 94</a>
</span><span class=lnt id=hl-23-95><a class=lnlinks href=#hl-23-95> 95</a>
</span><span class=lnt id=hl-23-96><a class=lnlinks href=#hl-23-96> 96</a>
</span><span class=lnt id=hl-23-97><a class=lnlinks href=#hl-23-97> 97</a>
</span><span class=lnt id=hl-23-98><a class=lnlinks href=#hl-23-98> 98</a>
</span><span class=lnt id=hl-23-99><a class=lnlinks href=#hl-23-99> 99</a>
</span><span class=lnt id=hl-23-100><a class=lnlinks href=#hl-23-100>100</a>
</span><span class=lnt id=hl-23-101><a class=lnlinks href=#hl-23-101>101</a>
</span><span class=lnt id=hl-23-102><a class=lnlinks href=#hl-23-102>102</a>
</span><span class=lnt id=hl-23-103><a class=lnlinks href=#hl-23-103>103</a>
</span><span class=lnt id=hl-23-104><a class=lnlinks href=#hl-23-104>104</a>
</span><span class=lnt id=hl-23-105><a class=lnlinks href=#hl-23-105>105</a>
</span><span class=lnt id=hl-23-106><a class=lnlinks href=#hl-23-106>106</a>
</span><span class=lnt id=hl-23-107><a class=lnlinks href=#hl-23-107>107</a>
</span><span class=lnt id=hl-23-108><a class=lnlinks href=#hl-23-108>108</a>
</span><span class=lnt id=hl-23-109><a class=lnlinks href=#hl-23-109>109</a>
</span><span class=lnt id=hl-23-110><a class=lnlinks href=#hl-23-110>110</a>
</span><span class=lnt id=hl-23-111><a class=lnlinks href=#hl-23-111>111</a>
</span><span class=lnt id=hl-23-112><a class=lnlinks href=#hl-23-112>112</a>
</span><span class=lnt id=hl-23-113><a class=lnlinks href=#hl-23-113>113</a>
</span><span class=lnt id=hl-23-114><a class=lnlinks href=#hl-23-114>114</a>
</span><span class=lnt id=hl-23-115><a class=lnlinks href=#hl-23-115>115</a>
</span><span class=lnt id=hl-23-116><a class=lnlinks href=#hl-23-116>116</a>
</span><span class=lnt id=hl-23-117><a class=lnlinks href=#hl-23-117>117</a>
</span><span class=lnt id=hl-23-118><a class=lnlinks href=#hl-23-118>118</a>
</span><span class=lnt id=hl-23-119><a class=lnlinks href=#hl-23-119>119</a>
</span><span class=lnt id=hl-23-120><a class=lnlinks href=#hl-23-120>120</a>
</span><span class=lnt id=hl-23-121><a class=lnlinks href=#hl-23-121>121</a>
</span><span class=lnt id=hl-23-122><a class=lnlinks href=#hl-23-122>122</a>
</span><span class=lnt id=hl-23-123><a class=lnlinks href=#hl-23-123>123</a>
</span><span class=lnt id=hl-23-124><a class=lnlinks href=#hl-23-124>124</a>
</span><span class=lnt id=hl-23-125><a class=lnlinks href=#hl-23-125>125</a>
</span><span class=lnt id=hl-23-126><a class=lnlinks href=#hl-23-126>126</a>
</span><span class=lnt id=hl-23-127><a class=lnlinks href=#hl-23-127>127</a>
</span><span class=lnt id=hl-23-128><a class=lnlinks href=#hl-23-128>128</a>
</span><span class=lnt id=hl-23-129><a class=lnlinks href=#hl-23-129>129</a>
</span><span class=lnt id=hl-23-130><a class=lnlinks href=#hl-23-130>130</a>
</span><span class=lnt id=hl-23-131><a class=lnlinks href=#hl-23-131>131</a>
</span><span class=lnt id=hl-23-132><a class=lnlinks href=#hl-23-132>132</a>
</span><span class=lnt id=hl-23-133><a class=lnlinks href=#hl-23-133>133</a>
</span><span class=lnt id=hl-23-134><a class=lnlinks href=#hl-23-134>134</a>
</span><span class=lnt id=hl-23-135><a class=lnlinks href=#hl-23-135>135</a>
</span><span class=lnt id=hl-23-136><a class=lnlinks href=#hl-23-136>136</a>
</span><span class=lnt id=hl-23-137><a class=lnlinks href=#hl-23-137>137</a>
</span><span class=lnt id=hl-23-138><a class=lnlinks href=#hl-23-138>138</a>
</span><span class=lnt id=hl-23-139><a class=lnlinks href=#hl-23-139>139</a>
</span><span class=lnt id=hl-23-140><a class=lnlinks href=#hl-23-140>140</a>
</span><span class=lnt id=hl-23-141><a class=lnlinks href=#hl-23-141>141</a>
</span><span class=lnt id=hl-23-142><a class=lnlinks href=#hl-23-142>142</a>
</span><span class=lnt id=hl-23-143><a class=lnlinks href=#hl-23-143>143</a>
</span><span class=lnt id=hl-23-144><a class=lnlinks href=#hl-23-144>144</a>
</span><span class=lnt id=hl-23-145><a class=lnlinks href=#hl-23-145>145</a>
</span><span class=lnt id=hl-23-146><a class=lnlinks href=#hl-23-146>146</a>
</span><span class=lnt id=hl-23-147><a class=lnlinks href=#hl-23-147>147</a>
</span><span class=lnt id=hl-23-148><a class=lnlinks href=#hl-23-148>148</a>
</span><span class=lnt id=hl-23-149><a class=lnlinks href=#hl-23-149>149</a>
</span><span class=lnt id=hl-23-150><a class=lnlinks href=#hl-23-150>150</a>
</span><span class=lnt id=hl-23-151><a class=lnlinks href=#hl-23-151>151</a>
</span><span class=lnt id=hl-23-152><a class=lnlinks href=#hl-23-152>152</a>
</span><span class=lnt id=hl-23-153><a class=lnlinks href=#hl-23-153>153</a>
</span><span class=lnt id=hl-23-154><a class=lnlinks href=#hl-23-154>154</a>
</span><span class=lnt id=hl-23-155><a class=lnlinks href=#hl-23-155>155</a>
</span><span class=lnt id=hl-23-156><a class=lnlinks href=#hl-23-156>156</a>
</span><span class=lnt id=hl-23-157><a class=lnlinks href=#hl-23-157>157</a>
</span><span class=lnt id=hl-23-158><a class=lnlinks href=#hl-23-158>158</a>
</span><span class=lnt id=hl-23-159><a class=lnlinks href=#hl-23-159>159</a>
</span><span class=lnt id=hl-23-160><a class=lnlinks href=#hl-23-160>160</a>
</span><span class=lnt id=hl-23-161><a class=lnlinks href=#hl-23-161>161</a>
</span><span class=lnt id=hl-23-162><a class=lnlinks href=#hl-23-162>162</a>
</span><span class=lnt id=hl-23-163><a class=lnlinks href=#hl-23-163>163</a>
</span><span class=lnt id=hl-23-164><a class=lnlinks href=#hl-23-164>164</a>
</span><span class=lnt id=hl-23-165><a class=lnlinks href=#hl-23-165>165</a>
</span><span class=lnt id=hl-23-166><a class=lnlinks href=#hl-23-166>166</a>
</span><span class=lnt id=hl-23-167><a class=lnlinks href=#hl-23-167>167</a>
</span><span class=lnt id=hl-23-168><a class=lnlinks href=#hl-23-168>168</a>
</span><span class=lnt id=hl-23-169><a class=lnlinks href=#hl-23-169>169</a>
</span><span class=lnt id=hl-23-170><a class=lnlinks href=#hl-23-170>170</a>
</span><span class=lnt id=hl-23-171><a class=lnlinks href=#hl-23-171>171</a>
</span><span class=lnt id=hl-23-172><a class=lnlinks href=#hl-23-172>172</a>
</span><span class=lnt id=hl-23-173><a class=lnlinks href=#hl-23-173>173</a>
</span><span class=lnt id=hl-23-174><a class=lnlinks href=#hl-23-174>174</a>
</span><span class=lnt id=hl-23-175><a class=lnlinks href=#hl-23-175>175</a>
</span><span class=lnt id=hl-23-176><a class=lnlinks href=#hl-23-176>176</a>
</span><span class=lnt id=hl-23-177><a class=lnlinks href=#hl-23-177>177</a>
</span><span class=lnt id=hl-23-178><a class=lnlinks href=#hl-23-178>178</a>
</span><span class=lnt id=hl-23-179><a class=lnlinks href=#hl-23-179>179</a>
</span><span class=lnt id=hl-23-180><a class=lnlinks href=#hl-23-180>180</a>
</span><span class=lnt id=hl-23-181><a class=lnlinks href=#hl-23-181>181</a>
</span><span class=lnt id=hl-23-182><a class=lnlinks href=#hl-23-182>182</a>
</span><span class=lnt id=hl-23-183><a class=lnlinks href=#hl-23-183>183</a>
</span><span class=lnt id=hl-23-184><a class=lnlinks href=#hl-23-184>184</a>
</span><span class=lnt id=hl-23-185><a class=lnlinks href=#hl-23-185>185</a>
</span><span class=lnt id=hl-23-186><a class=lnlinks href=#hl-23-186>186</a>
</span><span class=lnt id=hl-23-187><a class=lnlinks href=#hl-23-187>187</a>
</span><span class=lnt id=hl-23-188><a class=lnlinks href=#hl-23-188>188</a>
</span><span class=lnt id=hl-23-189><a class=lnlinks href=#hl-23-189>189</a>
</span><span class=lnt id=hl-23-190><a class=lnlinks href=#hl-23-190>190</a>
</span><span class=lnt id=hl-23-191><a class=lnlinks href=#hl-23-191>191</a>
</span><span class=lnt id=hl-23-192><a class=lnlinks href=#hl-23-192>192</a>
</span><span class=lnt id=hl-23-193><a class=lnlinks href=#hl-23-193>193</a>
</span><span class=lnt id=hl-23-194><a class=lnlinks href=#hl-23-194>194</a>
</span><span class=lnt id=hl-23-195><a class=lnlinks href=#hl-23-195>195</a>
</span><span class=lnt id=hl-23-196><a class=lnlinks href=#hl-23-196>196</a>
</span><span class=lnt id=hl-23-197><a class=lnlinks href=#hl-23-197>197</a>
</span><span class=lnt id=hl-23-198><a class=lnlinks href=#hl-23-198>198</a>
</span><span class=lnt id=hl-23-199><a class=lnlinks href=#hl-23-199>199</a>
</span><span class=lnt id=hl-23-200><a class=lnlinks href=#hl-23-200>200</a>
</span><span class=lnt id=hl-23-201><a class=lnlinks href=#hl-23-201>201</a>
</span><span class=lnt id=hl-23-202><a class=lnlinks href=#hl-23-202>202</a>
</span><span class=lnt id=hl-23-203><a class=lnlinks href=#hl-23-203>203</a>
</span><span class=lnt id=hl-23-204><a class=lnlinks href=#hl-23-204>204</a>
</span><span class=lnt id=hl-23-205><a class=lnlinks href=#hl-23-205>205</a>
</span><span class=lnt id=hl-23-206><a class=lnlinks href=#hl-23-206>206</a>
</span><span class=lnt id=hl-23-207><a class=lnlinks href=#hl-23-207>207</a>
</span><span class=lnt id=hl-23-208><a class=lnlinks href=#hl-23-208>208</a>
</span><span class=lnt id=hl-23-209><a class=lnlinks href=#hl-23-209>209</a>
</span><span class=lnt id=hl-23-210><a class=lnlinks href=#hl-23-210>210</a>
</span><span class=lnt id=hl-23-211><a class=lnlinks href=#hl-23-211>211</a>
</span><span class=lnt id=hl-23-212><a class=lnlinks href=#hl-23-212>212</a>
</span><span class=lnt id=hl-23-213><a class=lnlinks href=#hl-23-213>213</a>
</span><span class=lnt id=hl-23-214><a class=lnlinks href=#hl-23-214>214</a>
</span><span class=lnt id=hl-23-215><a class=lnlinks href=#hl-23-215>215</a>
</span><span class=lnt id=hl-23-216><a class=lnlinks href=#hl-23-216>216</a>
</span><span class=lnt id=hl-23-217><a class=lnlinks href=#hl-23-217>217</a>
</span><span class=lnt id=hl-23-218><a class=lnlinks href=#hl-23-218>218</a>
</span><span class=lnt id=hl-23-219><a class=lnlinks href=#hl-23-219>219</a>
</span><span class=lnt id=hl-23-220><a class=lnlinks href=#hl-23-220>220</a>
</span><span class=lnt id=hl-23-221><a class=lnlinks href=#hl-23-221>221</a>
</span><span class=lnt id=hl-23-222><a class=lnlinks href=#hl-23-222>222</a>
</span><span class=lnt id=hl-23-223><a class=lnlinks href=#hl-23-223>223</a>
</span><span class=lnt id=hl-23-224><a class=lnlinks href=#hl-23-224>224</a>
</span><span class=lnt id=hl-23-225><a class=lnlinks href=#hl-23-225>225</a>
</span><span class=lnt id=hl-23-226><a class=lnlinks href=#hl-23-226>226</a>
</span><span class=lnt id=hl-23-227><a class=lnlinks href=#hl-23-227>227</a>
</span><span class=lnt id=hl-23-228><a class=lnlinks href=#hl-23-228>228</a>
</span><span class=lnt id=hl-23-229><a class=lnlinks href=#hl-23-229>229</a>
</span><span class=lnt id=hl-23-230><a class=lnlinks href=#hl-23-230>230</a>
</span><span class=lnt id=hl-23-231><a class=lnlinks href=#hl-23-231>231</a>
</span><span class=lnt id=hl-23-232><a class=lnlinks href=#hl-23-232>232</a>
</span><span class=lnt id=hl-23-233><a class=lnlinks href=#hl-23-233>233</a>
</span><span class=lnt id=hl-23-234><a class=lnlinks href=#hl-23-234>234</a>
</span><span class=lnt id=hl-23-235><a class=lnlinks href=#hl-23-235>235</a>
</span><span class=lnt id=hl-23-236><a class=lnlinks href=#hl-23-236>236</a>
</span><span class=lnt id=hl-23-237><a class=lnlinks href=#hl-23-237>237</a>
</span><span class=lnt id=hl-23-238><a class=lnlinks href=#hl-23-238>238</a>
</span><span class=lnt id=hl-23-239><a class=lnlinks href=#hl-23-239>239</a>
</span><span class=lnt id=hl-23-240><a class=lnlinks href=#hl-23-240>240</a>
</span><span class=lnt id=hl-23-241><a class=lnlinks href=#hl-23-241>241</a>
</span><span class=lnt id=hl-23-242><a class=lnlinks href=#hl-23-242>242</a>
</span><span class=lnt id=hl-23-243><a class=lnlinks href=#hl-23-243>243</a>
</span><span class=lnt id=hl-23-244><a class=lnlinks href=#hl-23-244>244</a>
</span><span class=lnt id=hl-23-245><a class=lnlinks href=#hl-23-245>245</a>
</span><span class=lnt id=hl-23-246><a class=lnlinks href=#hl-23-246>246</a>
</span><span class=lnt id=hl-23-247><a class=lnlinks href=#hl-23-247>247</a>
</span><span class=lnt id=hl-23-248><a class=lnlinks href=#hl-23-248>248</a>
</span><span class=lnt id=hl-23-249><a class=lnlinks href=#hl-23-249>249</a>
</span><span class=lnt id=hl-23-250><a class=lnlinks href=#hl-23-250>250</a>
</span><span class=lnt id=hl-23-251><a class=lnlinks href=#hl-23-251>251</a>
</span><span class=lnt id=hl-23-252><a class=lnlinks href=#hl-23-252>252</a>
</span><span class=lnt id=hl-23-253><a class=lnlinks href=#hl-23-253>253</a>
</span><span class=lnt id=hl-23-254><a class=lnlinks href=#hl-23-254>254</a>
</span><span class=lnt id=hl-23-255><a class=lnlinks href=#hl-23-255>255</a>
</span><span class=lnt id=hl-23-256><a class=lnlinks href=#hl-23-256>256</a>
</span><span class=lnt id=hl-23-257><a class=lnlinks href=#hl-23-257>257</a>
</span><span class=lnt id=hl-23-258><a class=lnlinks href=#hl-23-258>258</a>
</span><span class=lnt id=hl-23-259><a class=lnlinks href=#hl-23-259>259</a>
</span><span class=lnt id=hl-23-260><a class=lnlinks href=#hl-23-260>260</a>
</span><span class=lnt id=hl-23-261><a class=lnlinks href=#hl-23-261>261</a>
</span><span class=lnt id=hl-23-262><a class=lnlinks href=#hl-23-262>262</a>
</span><span class=lnt id=hl-23-263><a class=lnlinks href=#hl-23-263>263</a>
</span><span class=lnt id=hl-23-264><a class=lnlinks href=#hl-23-264>264</a>
</span><span class=lnt id=hl-23-265><a class=lnlinks href=#hl-23-265>265</a>
</span><span class=lnt id=hl-23-266><a class=lnlinks href=#hl-23-266>266</a>
</span><span class=lnt id=hl-23-267><a class=lnlinks href=#hl-23-267>267</a>
</span><span class=lnt id=hl-23-268><a class=lnlinks href=#hl-23-268>268</a>
</span><span class=lnt id=hl-23-269><a class=lnlinks href=#hl-23-269>269</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python FastAPI와 OpenTelemetry를 사용한 분산 추적 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>Header</span><span class=p>,</span> <span class=n>Request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aio_pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.exporter.jaeger.thrift</span> <span class=kn>import</span> <span class=n>JaegerExporter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.resources</span> <span class=kn>import</span> <span class=n>SERVICE_NAME</span><span class=p>,</span> <span class=n>Resource</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace</span> <span class=kn>import</span> <span class=n>TracerProvider</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace.export</span> <span class=kn>import</span> <span class=n>BatchSpanProcessor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.instrumentation.fastapi</span> <span class=kn>import</span> <span class=n>FastAPIInstrumentor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.instrumentation.aio_pika</span> <span class=kn>import</span> <span class=n>AioPikaInstrumentor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.context</span> <span class=kn>import</span> <span class=n>Context</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.propagate</span> <span class=kn>import</span> <span class=n>extract</span><span class=p>,</span> <span class=n>inject</span><span class=p>,</span> <span class=n>get_global_TextMapPropagator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OpenTelemetry 설정</span>
</span></span><span class=line><span class=cl><span class=n>resource</span> <span class=o>=</span> <span class=n>Resource</span><span class=p>(</span><span class=n>attributes</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SERVICE_NAME</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>jaeger_exporter</span> <span class=o>=</span> <span class=n>JaegerExporter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>agent_host_name</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>agent_port</span><span class=o>=</span><span class=mi>6831</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>TracerProvider</span><span class=p>(</span><span class=n>resource</span><span class=o>=</span><span class=n>resource</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>trace</span><span class=o>.</span><span class=n>get_tracer_provider</span><span class=p>()</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>BatchSpanProcessor</span><span class=p>(</span><span class=n>jaeger_exporter</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tracer</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_tracer</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FastAPI 앱 생성</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s2>&#34;주문 서비스&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FastAPI 계측</span>
</span></span><span class=line><span class=cl><span class=n>FastAPIInstrumentor</span><span class=o>.</span><span class=n>instrument_app</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AioPika 계측</span>
</span></span><span class=line><span class=cl><span class=n>AioPikaInstrumentor</span><span class=p>()</span><span class=o>.</span><span class=n>instrument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_rabbitmq_connection</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=n>aio_pika</span><span class=o>.</span><span class=n>connect_robust</span><span class=p>(</span><span class=s2>&#34;amqp://guest:guest@localhost/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 추적 컨텍스트 추출 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_tracing_context</span><span class=p>(</span><span class=n>headers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Context</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>extract</span><span class=p>(</span><span class=n>get_global_TextMapPropagator</span><span class=p>(),</span> <span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 발행 함수</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>parent_span</span><span class=p>:</span> <span class=n>trace</span><span class=o>.</span><span class=n>Span</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_rabbitmq_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>exchange</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_exchange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange_name</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>aio_pika</span><span class=o>.</span><span class=n>ExchangeType</span><span class=o>.</span><span class=n>TOPIC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추적 컨텍스트를 메시지 헤더에 주입</span>
</span></span><span class=line><span class=cl>        <span class=n>message_headers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>inject</span><span class=p>(</span><span class=n>get_global_TextMapPropagator</span><span class=p>(),</span> <span class=n>message_headers</span><span class=p>,</span> <span class=n>parent_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추적 ID와 메시지 ID 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>message_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>message_with_context</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message_id&#34;</span><span class=p>:</span> <span class=n>message_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;trace_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>parent_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>trace_id</span><span class=p>,</span> <span class=s2>&#34;032x&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;span_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>parent_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>span_id</span><span class=p>,</span> <span class=s2>&#34;016x&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;publish-</span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>context</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>set_span_in_context</span><span class=p>(</span><span class=n>parent_span</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>kind</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>SpanKind</span><span class=o>.</span><span class=n>PRODUCER</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> <span class=k>as</span> <span class=n>publish_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.system&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.destination&#34;</span><span class=p>,</span> <span class=n>exchange_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.destination_kind&#34;</span><span class=p>,</span> <span class=s2>&#34;exchange&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.rabbitmq.routing_key&#34;</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.message_id&#34;</span><span class=p>,</span> <span class=n>message_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 발행</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>exchange</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>aio_pika</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message_with_context</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=n>content_type</span><span class=o>=</span><span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>headers</span><span class=o>=</span><span class=n>message_headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>message_id</span><span class=o>=</span><span class=n>message_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_mode</span><span class=o>=</span><span class=n>aio_pika</span><span class=o>.</span><span class=n>DeliveryMode</span><span class=o>.</span><span class=n>PERSISTENT</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>routing_key</span><span class=o>=</span><span class=n>routing_key</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 발행됨: </span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>, ID: </span><span class=si>{</span><span class=n>message_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>message_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 생성 API 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/orders&#34;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>202</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>trace_parent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Header</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 현재 트레이스 컨텍스트 가져오기</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 ID 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 생성 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;process-order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>set_span_in_context</span><span class=p>(</span><span class=n>current_span</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=k>as</span> <span class=n>process_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>process_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.id&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>process_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.customer_id&#34;</span><span class=p>,</span> <span class=n>order</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;customer_id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>process_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.item_count&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;items&#34;</span><span class=p>,</span> <span class=p>[])))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 상태 저장 로직 (실제로는 DB에 저장)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> 생성 중&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비동기 처리를 위한 메시지 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>message_id</span> <span class=o>=</span> <span class=k>await</span> <span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;orders.created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>process_span</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;processing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;주문이 처리 중입니다&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;trace_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>current_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>trace_id</span><span class=p>,</span> <span class=s2>&#34;032x&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비자 설정</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>setup_consumer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_rabbitmq_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 채널 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>set_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 교환기 및 큐 선언</span>
</span></span><span class=line><span class=cl>    <span class=n>orders_exchange</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_exchange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;orders&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>aio_pika</span><span class=o>.</span><span class=n>ExchangeType</span><span class=o>.</span><span class=n>TOPIC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>order_processing_queue</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_queue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order_processing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>order_processing_queue</span><span class=o>.</span><span class=n>bind</span><span class=p>(</span><span class=n>orders_exchange</span><span class=p>,</span> <span class=s2>&#34;orders.created&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 처리 콜백</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_order_message</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>aio_pika</span><span class=o>.</span><span class=n>IncomingMessage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>message</span><span class=o>.</span><span class=n>process</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=c1># 트레이싱 컨텍스트 추출</span>
</span></span><span class=line><span class=cl>            <span class=n>trace_context</span> <span class=o>=</span> <span class=n>extract_tracing_context</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>headers</span><span class=p>)</span> <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>headers</span> <span class=k>else</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 내용 파싱</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>order_data</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            <span class=n>message_id</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;message_id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>trace_id</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;trace_id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 메시지 수신: </span><span class=si>{</span><span class=n>message_id</span><span class=si>}</span><span class=s2>, 트레이스 ID: </span><span class=si>{</span><span class=n>trace_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 처리 스팬 생성</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;consume-order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>context</span><span class=o>=</span><span class=n>trace_context</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>kind</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>SpanKind</span><span class=o>.</span><span class=n>CONSUMER</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span> <span class=k>as</span> <span class=n>consume_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.system&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.operation&#34;</span><span class=p>,</span> <span class=s2>&#34;process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.message_id&#34;</span><span class=p>,</span> <span class=n>message_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.rabbitmq.routing_key&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.id&#34;</span><span class=p>,</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 처리 로직</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 처리 중&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 확인 스팬</span>
</span></span><span class=line><span class=cl>                    <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;check-inventory&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>inventory_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>inventory_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.item_count&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;items&#34;</span><span class=p>,</span> <span class=p>[])))</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span>  <span class=c1># 재고 확인 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 처리 스팬</span>
</span></span><span class=line><span class=cl>                    <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;process-payment&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>payment_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>payment_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.total&#34;</span><span class=p>,</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;total_amount&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.4</span><span class=p>)</span>  <span class=c1># 결제 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders.processed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;processed_at&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                        <span class=p>},</span>
</span></span><span class=line><span class=cl>                        <span class=n>consume_span</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 처리 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>error_msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;주문 처리 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>error_msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>consume_span</span><span class=o>.</span><span class=n>record_exception</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>consume_span</span><span class=o>.</span><span class=n>set_status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>ERROR</span><span class=p>,</span> <span class=n>error_msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 실패 이벤트 발행</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders.failed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;failed_at&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                        <span class=p>},</span>
</span></span><span class=line><span class=cl>                        <span class=n>consume_span</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 소비자 시작</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>order_processing_queue</span><span class=o>.</span><span class=n>consume</span><span class=p>(</span><span class=n>process_order_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;주문 처리 소비자가 시작되었습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애플리케이션 시작 이벤트에 소비자 설정 추가</span>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;startup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>startup_event</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 백그라운드 작업으로 소비자 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>setup_consumer</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;애플리케이션이 시작되었습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애플리케이션 종료 이벤트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;shutdown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>shutdown_event</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;애플리케이션이 종료됩니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>uvicorn</span>
</span></span><span class=line><span class=cl>    <span class=n>uvicorn</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8000</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-아키텍처-패턴>메시징 큐 아키텍처 패턴<a hidden class=anchor aria-hidden=true href=#메시징-큐-아키텍처-패턴>#</a></h3><h4 id=데이터-스트리밍-아키텍처>데이터 스트리밍 아키텍처<a hidden class=anchor aria-hidden=true href=#데이터-스트리밍-아키텍처>#</a></h4><p>메시징 큐를 사용하여 대량의 데이터를 연속적으로 처리하고 실시간 분석을 지원하는 아키텍처이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>  1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>  2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3>  3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4>  4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5>  5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6>  6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7>  7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8>  8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9>  9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10> 10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11> 11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12> 12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13> 13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14> 14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15> 15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16> 16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17> 17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18> 18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19> 19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20> 20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21> 21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22> 22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23> 23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24> 24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25> 25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26> 26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27> 27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28> 28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29> 29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30> 30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31> 31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32> 32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33> 33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34> 34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35> 35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36> 36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37> 37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38> 38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39> 39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40> 40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41> 41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42> 42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43> 43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44> 44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45> 45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46> 46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47> 47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48> 48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49> 49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50> 50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51> 51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52> 52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53> 53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54> 54</a>
</span><span class=lnt id=hl-24-55><a class=lnlinks href=#hl-24-55> 55</a>
</span><span class=lnt id=hl-24-56><a class=lnlinks href=#hl-24-56> 56</a>
</span><span class=lnt id=hl-24-57><a class=lnlinks href=#hl-24-57> 57</a>
</span><span class=lnt id=hl-24-58><a class=lnlinks href=#hl-24-58> 58</a>
</span><span class=lnt id=hl-24-59><a class=lnlinks href=#hl-24-59> 59</a>
</span><span class=lnt id=hl-24-60><a class=lnlinks href=#hl-24-60> 60</a>
</span><span class=lnt id=hl-24-61><a class=lnlinks href=#hl-24-61> 61</a>
</span><span class=lnt id=hl-24-62><a class=lnlinks href=#hl-24-62> 62</a>
</span><span class=lnt id=hl-24-63><a class=lnlinks href=#hl-24-63> 63</a>
</span><span class=lnt id=hl-24-64><a class=lnlinks href=#hl-24-64> 64</a>
</span><span class=lnt id=hl-24-65><a class=lnlinks href=#hl-24-65> 65</a>
</span><span class=lnt id=hl-24-66><a class=lnlinks href=#hl-24-66> 66</a>
</span><span class=lnt id=hl-24-67><a class=lnlinks href=#hl-24-67> 67</a>
</span><span class=lnt id=hl-24-68><a class=lnlinks href=#hl-24-68> 68</a>
</span><span class=lnt id=hl-24-69><a class=lnlinks href=#hl-24-69> 69</a>
</span><span class=lnt id=hl-24-70><a class=lnlinks href=#hl-24-70> 70</a>
</span><span class=lnt id=hl-24-71><a class=lnlinks href=#hl-24-71> 71</a>
</span><span class=lnt id=hl-24-72><a class=lnlinks href=#hl-24-72> 72</a>
</span><span class=lnt id=hl-24-73><a class=lnlinks href=#hl-24-73> 73</a>
</span><span class=lnt id=hl-24-74><a class=lnlinks href=#hl-24-74> 74</a>
</span><span class=lnt id=hl-24-75><a class=lnlinks href=#hl-24-75> 75</a>
</span><span class=lnt id=hl-24-76><a class=lnlinks href=#hl-24-76> 76</a>
</span><span class=lnt id=hl-24-77><a class=lnlinks href=#hl-24-77> 77</a>
</span><span class=lnt id=hl-24-78><a class=lnlinks href=#hl-24-78> 78</a>
</span><span class=lnt id=hl-24-79><a class=lnlinks href=#hl-24-79> 79</a>
</span><span class=lnt id=hl-24-80><a class=lnlinks href=#hl-24-80> 80</a>
</span><span class=lnt id=hl-24-81><a class=lnlinks href=#hl-24-81> 81</a>
</span><span class=lnt id=hl-24-82><a class=lnlinks href=#hl-24-82> 82</a>
</span><span class=lnt id=hl-24-83><a class=lnlinks href=#hl-24-83> 83</a>
</span><span class=lnt id=hl-24-84><a class=lnlinks href=#hl-24-84> 84</a>
</span><span class=lnt id=hl-24-85><a class=lnlinks href=#hl-24-85> 85</a>
</span><span class=lnt id=hl-24-86><a class=lnlinks href=#hl-24-86> 86</a>
</span><span class=lnt id=hl-24-87><a class=lnlinks href=#hl-24-87> 87</a>
</span><span class=lnt id=hl-24-88><a class=lnlinks href=#hl-24-88> 88</a>
</span><span class=lnt id=hl-24-89><a class=lnlinks href=#hl-24-89> 89</a>
</span><span class=lnt id=hl-24-90><a class=lnlinks href=#hl-24-90> 90</a>
</span><span class=lnt id=hl-24-91><a class=lnlinks href=#hl-24-91> 91</a>
</span><span class=lnt id=hl-24-92><a class=lnlinks href=#hl-24-92> 92</a>
</span><span class=lnt id=hl-24-93><a class=lnlinks href=#hl-24-93> 93</a>
</span><span class=lnt id=hl-24-94><a class=lnlinks href=#hl-24-94> 94</a>
</span><span class=lnt id=hl-24-95><a class=lnlinks href=#hl-24-95> 95</a>
</span><span class=lnt id=hl-24-96><a class=lnlinks href=#hl-24-96> 96</a>
</span><span class=lnt id=hl-24-97><a class=lnlinks href=#hl-24-97> 97</a>
</span><span class=lnt id=hl-24-98><a class=lnlinks href=#hl-24-98> 98</a>
</span><span class=lnt id=hl-24-99><a class=lnlinks href=#hl-24-99> 99</a>
</span><span class=lnt id=hl-24-100><a class=lnlinks href=#hl-24-100>100</a>
</span><span class=lnt id=hl-24-101><a class=lnlinks href=#hl-24-101>101</a>
</span><span class=lnt id=hl-24-102><a class=lnlinks href=#hl-24-102>102</a>
</span><span class=lnt id=hl-24-103><a class=lnlinks href=#hl-24-103>103</a>
</span><span class=lnt id=hl-24-104><a class=lnlinks href=#hl-24-104>104</a>
</span><span class=lnt id=hl-24-105><a class=lnlinks href=#hl-24-105>105</a>
</span><span class=lnt id=hl-24-106><a class=lnlinks href=#hl-24-106>106</a>
</span><span class=lnt id=hl-24-107><a class=lnlinks href=#hl-24-107>107</a>
</span><span class=lnt id=hl-24-108><a class=lnlinks href=#hl-24-108>108</a>
</span><span class=lnt id=hl-24-109><a class=lnlinks href=#hl-24-109>109</a>
</span><span class=lnt id=hl-24-110><a class=lnlinks href=#hl-24-110>110</a>
</span><span class=lnt id=hl-24-111><a class=lnlinks href=#hl-24-111>111</a>
</span><span class=lnt id=hl-24-112><a class=lnlinks href=#hl-24-112>112</a>
</span><span class=lnt id=hl-24-113><a class=lnlinks href=#hl-24-113>113</a>
</span><span class=lnt id=hl-24-114><a class=lnlinks href=#hl-24-114>114</a>
</span><span class=lnt id=hl-24-115><a class=lnlinks href=#hl-24-115>115</a>
</span><span class=lnt id=hl-24-116><a class=lnlinks href=#hl-24-116>116</a>
</span><span class=lnt id=hl-24-117><a class=lnlinks href=#hl-24-117>117</a>
</span><span class=lnt id=hl-24-118><a class=lnlinks href=#hl-24-118>118</a>
</span><span class=lnt id=hl-24-119><a class=lnlinks href=#hl-24-119>119</a>
</span><span class=lnt id=hl-24-120><a class=lnlinks href=#hl-24-120>120</a>
</span><span class=lnt id=hl-24-121><a class=lnlinks href=#hl-24-121>121</a>
</span><span class=lnt id=hl-24-122><a class=lnlinks href=#hl-24-122>122</a>
</span><span class=lnt id=hl-24-123><a class=lnlinks href=#hl-24-123>123</a>
</span><span class=lnt id=hl-24-124><a class=lnlinks href=#hl-24-124>124</a>
</span><span class=lnt id=hl-24-125><a class=lnlinks href=#hl-24-125>125</a>
</span><span class=lnt id=hl-24-126><a class=lnlinks href=#hl-24-126>126</a>
</span><span class=lnt id=hl-24-127><a class=lnlinks href=#hl-24-127>127</a>
</span><span class=lnt id=hl-24-128><a class=lnlinks href=#hl-24-128>128</a>
</span><span class=lnt id=hl-24-129><a class=lnlinks href=#hl-24-129>129</a>
</span><span class=lnt id=hl-24-130><a class=lnlinks href=#hl-24-130>130</a>
</span><span class=lnt id=hl-24-131><a class=lnlinks href=#hl-24-131>131</a>
</span><span class=lnt id=hl-24-132><a class=lnlinks href=#hl-24-132>132</a>
</span><span class=lnt id=hl-24-133><a class=lnlinks href=#hl-24-133>133</a>
</span><span class=lnt id=hl-24-134><a class=lnlinks href=#hl-24-134>134</a>
</span><span class=lnt id=hl-24-135><a class=lnlinks href=#hl-24-135>135</a>
</span><span class=lnt id=hl-24-136><a class=lnlinks href=#hl-24-136>136</a>
</span><span class=lnt id=hl-24-137><a class=lnlinks href=#hl-24-137>137</a>
</span><span class=lnt id=hl-24-138><a class=lnlinks href=#hl-24-138>138</a>
</span><span class=lnt id=hl-24-139><a class=lnlinks href=#hl-24-139>139</a>
</span><span class=lnt id=hl-24-140><a class=lnlinks href=#hl-24-140>140</a>
</span><span class=lnt id=hl-24-141><a class=lnlinks href=#hl-24-141>141</a>
</span><span class=lnt id=hl-24-142><a class=lnlinks href=#hl-24-142>142</a>
</span><span class=lnt id=hl-24-143><a class=lnlinks href=#hl-24-143>143</a>
</span><span class=lnt id=hl-24-144><a class=lnlinks href=#hl-24-144>144</a>
</span><span class=lnt id=hl-24-145><a class=lnlinks href=#hl-24-145>145</a>
</span><span class=lnt id=hl-24-146><a class=lnlinks href=#hl-24-146>146</a>
</span><span class=lnt id=hl-24-147><a class=lnlinks href=#hl-24-147>147</a>
</span><span class=lnt id=hl-24-148><a class=lnlinks href=#hl-24-148>148</a>
</span><span class=lnt id=hl-24-149><a class=lnlinks href=#hl-24-149>149</a>
</span><span class=lnt id=hl-24-150><a class=lnlinks href=#hl-24-150>150</a>
</span><span class=lnt id=hl-24-151><a class=lnlinks href=#hl-24-151>151</a>
</span><span class=lnt id=hl-24-152><a class=lnlinks href=#hl-24-152>152</a>
</span><span class=lnt id=hl-24-153><a class=lnlinks href=#hl-24-153>153</a>
</span><span class=lnt id=hl-24-154><a class=lnlinks href=#hl-24-154>154</a>
</span><span class=lnt id=hl-24-155><a class=lnlinks href=#hl-24-155>155</a>
</span><span class=lnt id=hl-24-156><a class=lnlinks href=#hl-24-156>156</a>
</span><span class=lnt id=hl-24-157><a class=lnlinks href=#hl-24-157>157</a>
</span><span class=lnt id=hl-24-158><a class=lnlinks href=#hl-24-158>158</a>
</span><span class=lnt id=hl-24-159><a class=lnlinks href=#hl-24-159>159</a>
</span><span class=lnt id=hl-24-160><a class=lnlinks href=#hl-24-160>160</a>
</span><span class=lnt id=hl-24-161><a class=lnlinks href=#hl-24-161>161</a>
</span><span class=lnt id=hl-24-162><a class=lnlinks href=#hl-24-162>162</a>
</span><span class=lnt id=hl-24-163><a class=lnlinks href=#hl-24-163>163</a>
</span><span class=lnt id=hl-24-164><a class=lnlinks href=#hl-24-164>164</a>
</span><span class=lnt id=hl-24-165><a class=lnlinks href=#hl-24-165>165</a>
</span><span class=lnt id=hl-24-166><a class=lnlinks href=#hl-24-166>166</a>
</span><span class=lnt id=hl-24-167><a class=lnlinks href=#hl-24-167>167</a>
</span><span class=lnt id=hl-24-168><a class=lnlinks href=#hl-24-168>168</a>
</span><span class=lnt id=hl-24-169><a class=lnlinks href=#hl-24-169>169</a>
</span><span class=lnt id=hl-24-170><a class=lnlinks href=#hl-24-170>170</a>
</span><span class=lnt id=hl-24-171><a class=lnlinks href=#hl-24-171>171</a>
</span><span class=lnt id=hl-24-172><a class=lnlinks href=#hl-24-172>172</a>
</span><span class=lnt id=hl-24-173><a class=lnlinks href=#hl-24-173>173</a>
</span><span class=lnt id=hl-24-174><a class=lnlinks href=#hl-24-174>174</a>
</span><span class=lnt id=hl-24-175><a class=lnlinks href=#hl-24-175>175</a>
</span><span class=lnt id=hl-24-176><a class=lnlinks href=#hl-24-176>176</a>
</span><span class=lnt id=hl-24-177><a class=lnlinks href=#hl-24-177>177</a>
</span><span class=lnt id=hl-24-178><a class=lnlinks href=#hl-24-178>178</a>
</span><span class=lnt id=hl-24-179><a class=lnlinks href=#hl-24-179>179</a>
</span><span class=lnt id=hl-24-180><a class=lnlinks href=#hl-24-180>180</a>
</span><span class=lnt id=hl-24-181><a class=lnlinks href=#hl-24-181>181</a>
</span><span class=lnt id=hl-24-182><a class=lnlinks href=#hl-24-182>182</a>
</span><span class=lnt id=hl-24-183><a class=lnlinks href=#hl-24-183>183</a>
</span><span class=lnt id=hl-24-184><a class=lnlinks href=#hl-24-184>184</a>
</span><span class=lnt id=hl-24-185><a class=lnlinks href=#hl-24-185>185</a>
</span><span class=lnt id=hl-24-186><a class=lnlinks href=#hl-24-186>186</a>
</span><span class=lnt id=hl-24-187><a class=lnlinks href=#hl-24-187>187</a>
</span><span class=lnt id=hl-24-188><a class=lnlinks href=#hl-24-188>188</a>
</span><span class=lnt id=hl-24-189><a class=lnlinks href=#hl-24-189>189</a>
</span><span class=lnt id=hl-24-190><a class=lnlinks href=#hl-24-190>190</a>
</span><span class=lnt id=hl-24-191><a class=lnlinks href=#hl-24-191>191</a>
</span><span class=lnt id=hl-24-192><a class=lnlinks href=#hl-24-192>192</a>
</span><span class=lnt id=hl-24-193><a class=lnlinks href=#hl-24-193>193</a>
</span><span class=lnt id=hl-24-194><a class=lnlinks href=#hl-24-194>194</a>
</span><span class=lnt id=hl-24-195><a class=lnlinks href=#hl-24-195>195</a>
</span><span class=lnt id=hl-24-196><a class=lnlinks href=#hl-24-196>196</a>
</span><span class=lnt id=hl-24-197><a class=lnlinks href=#hl-24-197>197</a>
</span><span class=lnt id=hl-24-198><a class=lnlinks href=#hl-24-198>198</a>
</span><span class=lnt id=hl-24-199><a class=lnlinks href=#hl-24-199>199</a>
</span><span class=lnt id=hl-24-200><a class=lnlinks href=#hl-24-200>200</a>
</span><span class=lnt id=hl-24-201><a class=lnlinks href=#hl-24-201>201</a>
</span><span class=lnt id=hl-24-202><a class=lnlinks href=#hl-24-202>202</a>
</span><span class=lnt id=hl-24-203><a class=lnlinks href=#hl-24-203>203</a>
</span><span class=lnt id=hl-24-204><a class=lnlinks href=#hl-24-204>204</a>
</span><span class=lnt id=hl-24-205><a class=lnlinks href=#hl-24-205>205</a>
</span><span class=lnt id=hl-24-206><a class=lnlinks href=#hl-24-206>206</a>
</span><span class=lnt id=hl-24-207><a class=lnlinks href=#hl-24-207>207</a>
</span><span class=lnt id=hl-24-208><a class=lnlinks href=#hl-24-208>208</a>
</span><span class=lnt id=hl-24-209><a class=lnlinks href=#hl-24-209>209</a>
</span><span class=lnt id=hl-24-210><a class=lnlinks href=#hl-24-210>210</a>
</span><span class=lnt id=hl-24-211><a class=lnlinks href=#hl-24-211>211</a>
</span><span class=lnt id=hl-24-212><a class=lnlinks href=#hl-24-212>212</a>
</span><span class=lnt id=hl-24-213><a class=lnlinks href=#hl-24-213>213</a>
</span><span class=lnt id=hl-24-214><a class=lnlinks href=#hl-24-214>214</a>
</span><span class=lnt id=hl-24-215><a class=lnlinks href=#hl-24-215>215</a>
</span><span class=lnt id=hl-24-216><a class=lnlinks href=#hl-24-216>216</a>
</span><span class=lnt id=hl-24-217><a class=lnlinks href=#hl-24-217>217</a>
</span><span class=lnt id=hl-24-218><a class=lnlinks href=#hl-24-218>218</a>
</span><span class=lnt id=hl-24-219><a class=lnlinks href=#hl-24-219>219</a>
</span><span class=lnt id=hl-24-220><a class=lnlinks href=#hl-24-220>220</a>
</span><span class=lnt id=hl-24-221><a class=lnlinks href=#hl-24-221>221</a>
</span><span class=lnt id=hl-24-222><a class=lnlinks href=#hl-24-222>222</a>
</span><span class=lnt id=hl-24-223><a class=lnlinks href=#hl-24-223>223</a>
</span><span class=lnt id=hl-24-224><a class=lnlinks href=#hl-24-224>224</a>
</span><span class=lnt id=hl-24-225><a class=lnlinks href=#hl-24-225>225</a>
</span><span class=lnt id=hl-24-226><a class=lnlinks href=#hl-24-226>226</a>
</span><span class=lnt id=hl-24-227><a class=lnlinks href=#hl-24-227>227</a>
</span><span class=lnt id=hl-24-228><a class=lnlinks href=#hl-24-228>228</a>
</span><span class=lnt id=hl-24-229><a class=lnlinks href=#hl-24-229>229</a>
</span><span class=lnt id=hl-24-230><a class=lnlinks href=#hl-24-230>230</a>
</span><span class=lnt id=hl-24-231><a class=lnlinks href=#hl-24-231>231</a>
</span><span class=lnt id=hl-24-232><a class=lnlinks href=#hl-24-232>232</a>
</span><span class=lnt id=hl-24-233><a class=lnlinks href=#hl-24-233>233</a>
</span><span class=lnt id=hl-24-234><a class=lnlinks href=#hl-24-234>234</a>
</span><span class=lnt id=hl-24-235><a class=lnlinks href=#hl-24-235>235</a>
</span><span class=lnt id=hl-24-236><a class=lnlinks href=#hl-24-236>236</a>
</span><span class=lnt id=hl-24-237><a class=lnlinks href=#hl-24-237>237</a>
</span><span class=lnt id=hl-24-238><a class=lnlinks href=#hl-24-238>238</a>
</span><span class=lnt id=hl-24-239><a class=lnlinks href=#hl-24-239>239</a>
</span><span class=lnt id=hl-24-240><a class=lnlinks href=#hl-24-240>240</a>
</span><span class=lnt id=hl-24-241><a class=lnlinks href=#hl-24-241>241</a>
</span><span class=lnt id=hl-24-242><a class=lnlinks href=#hl-24-242>242</a>
</span><span class=lnt id=hl-24-243><a class=lnlinks href=#hl-24-243>243</a>
</span><span class=lnt id=hl-24-244><a class=lnlinks href=#hl-24-244>244</a>
</span><span class=lnt id=hl-24-245><a class=lnlinks href=#hl-24-245>245</a>
</span><span class=lnt id=hl-24-246><a class=lnlinks href=#hl-24-246>246</a>
</span><span class=lnt id=hl-24-247><a class=lnlinks href=#hl-24-247>247</a>
</span><span class=lnt id=hl-24-248><a class=lnlinks href=#hl-24-248>248</a>
</span><span class=lnt id=hl-24-249><a class=lnlinks href=#hl-24-249>249</a>
</span><span class=lnt id=hl-24-250><a class=lnlinks href=#hl-24-250>250</a>
</span><span class=lnt id=hl-24-251><a class=lnlinks href=#hl-24-251>251</a>
</span><span class=lnt id=hl-24-252><a class=lnlinks href=#hl-24-252>252</a>
</span><span class=lnt id=hl-24-253><a class=lnlinks href=#hl-24-253>253</a>
</span><span class=lnt id=hl-24-254><a class=lnlinks href=#hl-24-254>254</a>
</span><span class=lnt id=hl-24-255><a class=lnlinks href=#hl-24-255>255</a>
</span><span class=lnt id=hl-24-256><a class=lnlinks href=#hl-24-256>256</a>
</span><span class=lnt id=hl-24-257><a class=lnlinks href=#hl-24-257>257</a>
</span><span class=lnt id=hl-24-258><a class=lnlinks href=#hl-24-258>258</a>
</span><span class=lnt id=hl-24-259><a class=lnlinks href=#hl-24-259>259</a>
</span><span class=lnt id=hl-24-260><a class=lnlinks href=#hl-24-260>260</a>
</span><span class=lnt id=hl-24-261><a class=lnlinks href=#hl-24-261>261</a>
</span><span class=lnt id=hl-24-262><a class=lnlinks href=#hl-24-262>262</a>
</span><span class=lnt id=hl-24-263><a class=lnlinks href=#hl-24-263>263</a>
</span><span class=lnt id=hl-24-264><a class=lnlinks href=#hl-24-264>264</a>
</span><span class=lnt id=hl-24-265><a class=lnlinks href=#hl-24-265>265</a>
</span><span class=lnt id=hl-24-266><a class=lnlinks href=#hl-24-266>266</a>
</span><span class=lnt id=hl-24-267><a class=lnlinks href=#hl-24-267>267</a>
</span><span class=lnt id=hl-24-268><a class=lnlinks href=#hl-24-268>268</a>
</span><span class=lnt id=hl-24-269><a class=lnlinks href=#hl-24-269>269</a>
</span><span class=lnt id=hl-24-270><a class=lnlinks href=#hl-24-270>270</a>
</span><span class=lnt id=hl-24-271><a class=lnlinks href=#hl-24-271>271</a>
</span><span class=lnt id=hl-24-272><a class=lnlinks href=#hl-24-272>272</a>
</span><span class=lnt id=hl-24-273><a class=lnlinks href=#hl-24-273>273</a>
</span><span class=lnt id=hl-24-274><a class=lnlinks href=#hl-24-274>274</a>
</span><span class=lnt id=hl-24-275><a class=lnlinks href=#hl-24-275>275</a>
</span><span class=lnt id=hl-24-276><a class=lnlinks href=#hl-24-276>276</a>
</span><span class=lnt id=hl-24-277><a class=lnlinks href=#hl-24-277>277</a>
</span><span class=lnt id=hl-24-278><a class=lnlinks href=#hl-24-278>278</a>
</span><span class=lnt id=hl-24-279><a class=lnlinks href=#hl-24-279>279</a>
</span><span class=lnt id=hl-24-280><a class=lnlinks href=#hl-24-280>280</a>
</span><span class=lnt id=hl-24-281><a class=lnlinks href=#hl-24-281>281</a>
</span><span class=lnt id=hl-24-282><a class=lnlinks href=#hl-24-282>282</a>
</span><span class=lnt id=hl-24-283><a class=lnlinks href=#hl-24-283>283</a>
</span><span class=lnt id=hl-24-284><a class=lnlinks href=#hl-24-284>284</a>
</span><span class=lnt id=hl-24-285><a class=lnlinks href=#hl-24-285>285</a>
</span><span class=lnt id=hl-24-286><a class=lnlinks href=#hl-24-286>286</a>
</span><span class=lnt id=hl-24-287><a class=lnlinks href=#hl-24-287>287</a>
</span><span class=lnt id=hl-24-288><a class=lnlinks href=#hl-24-288>288</a>
</span><span class=lnt id=hl-24-289><a class=lnlinks href=#hl-24-289>289</a>
</span><span class=lnt id=hl-24-290><a class=lnlinks href=#hl-24-290>290</a>
</span><span class=lnt id=hl-24-291><a class=lnlinks href=#hl-24-291>291</a>
</span><span class=lnt id=hl-24-292><a class=lnlinks href=#hl-24-292>292</a>
</span><span class=lnt id=hl-24-293><a class=lnlinks href=#hl-24-293>293</a>
</span><span class=lnt id=hl-24-294><a class=lnlinks href=#hl-24-294>294</a>
</span><span class=lnt id=hl-24-295><a class=lnlinks href=#hl-24-295>295</a>
</span><span class=lnt id=hl-24-296><a class=lnlinks href=#hl-24-296>296</a>
</span><span class=lnt id=hl-24-297><a class=lnlinks href=#hl-24-297>297</a>
</span><span class=lnt id=hl-24-298><a class=lnlinks href=#hl-24-298>298</a>
</span><span class=lnt id=hl-24-299><a class=lnlinks href=#hl-24-299>299</a>
</span><span class=lnt id=hl-24-300><a class=lnlinks href=#hl-24-300>300</a>
</span><span class=lnt id=hl-24-301><a class=lnlinks href=#hl-24-301>301</a>
</span><span class=lnt id=hl-24-302><a class=lnlinks href=#hl-24-302>302</a>
</span><span class=lnt id=hl-24-303><a class=lnlinks href=#hl-24-303>303</a>
</span><span class=lnt id=hl-24-304><a class=lnlinks href=#hl-24-304>304</a>
</span><span class=lnt id=hl-24-305><a class=lnlinks href=#hl-24-305>305</a>
</span><span class=lnt id=hl-24-306><a class=lnlinks href=#hl-24-306>306</a>
</span><span class=lnt id=hl-24-307><a class=lnlinks href=#hl-24-307>307</a>
</span><span class=lnt id=hl-24-308><a class=lnlinks href=#hl-24-308>308</a>
</span><span class=lnt id=hl-24-309><a class=lnlinks href=#hl-24-309>309</a>
</span><span class=lnt id=hl-24-310><a class=lnlinks href=#hl-24-310>310</a>
</span><span class=lnt id=hl-24-311><a class=lnlinks href=#hl-24-311>311</a>
</span><span class=lnt id=hl-24-312><a class=lnlinks href=#hl-24-312>312</a>
</span><span class=lnt id=hl-24-313><a class=lnlinks href=#hl-24-313>313</a>
</span><span class=lnt id=hl-24-314><a class=lnlinks href=#hl-24-314>314</a>
</span><span class=lnt id=hl-24-315><a class=lnlinks href=#hl-24-315>315</a>
</span><span class=lnt id=hl-24-316><a class=lnlinks href=#hl-24-316>316</a>
</span><span class=lnt id=hl-24-317><a class=lnlinks href=#hl-24-317>317</a>
</span><span class=lnt id=hl-24-318><a class=lnlinks href=#hl-24-318>318</a>
</span><span class=lnt id=hl-24-319><a class=lnlinks href=#hl-24-319>319</a>
</span><span class=lnt id=hl-24-320><a class=lnlinks href=#hl-24-320>320</a>
</span><span class=lnt id=hl-24-321><a class=lnlinks href=#hl-24-321>321</a>
</span><span class=lnt id=hl-24-322><a class=lnlinks href=#hl-24-322>322</a>
</span><span class=lnt id=hl-24-323><a class=lnlinks href=#hl-24-323>323</a>
</span><span class=lnt id=hl-24-324><a class=lnlinks href=#hl-24-324>324</a>
</span><span class=lnt id=hl-24-325><a class=lnlinks href=#hl-24-325>325</a>
</span><span class=lnt id=hl-24-326><a class=lnlinks href=#hl-24-326>326</a>
</span><span class=lnt id=hl-24-327><a class=lnlinks href=#hl-24-327>327</a>
</span><span class=lnt id=hl-24-328><a class=lnlinks href=#hl-24-328>328</a>
</span><span class=lnt id=hl-24-329><a class=lnlinks href=#hl-24-329>329</a>
</span><span class=lnt id=hl-24-330><a class=lnlinks href=#hl-24-330>330</a>
</span><span class=lnt id=hl-24-331><a class=lnlinks href=#hl-24-331>331</a>
</span><span class=lnt id=hl-24-332><a class=lnlinks href=#hl-24-332>332</a>
</span><span class=lnt id=hl-24-333><a class=lnlinks href=#hl-24-333>333</a>
</span><span class=lnt id=hl-24-334><a class=lnlinks href=#hl-24-334>334</a>
</span><span class=lnt id=hl-24-335><a class=lnlinks href=#hl-24-335>335</a>
</span><span class=lnt id=hl-24-336><a class=lnlinks href=#hl-24-336>336</a>
</span><span class=lnt id=hl-24-337><a class=lnlinks href=#hl-24-337>337</a>
</span><span class=lnt id=hl-24-338><a class=lnlinks href=#hl-24-338>338</a>
</span><span class=lnt id=hl-24-339><a class=lnlinks href=#hl-24-339>339</a>
</span><span class=lnt id=hl-24-340><a class=lnlinks href=#hl-24-340>340</a>
</span><span class=lnt id=hl-24-341><a class=lnlinks href=#hl-24-341>341</a>
</span><span class=lnt id=hl-24-342><a class=lnlinks href=#hl-24-342>342</a>
</span><span class=lnt id=hl-24-343><a class=lnlinks href=#hl-24-343>343</a>
</span><span class=lnt id=hl-24-344><a class=lnlinks href=#hl-24-344>344</a>
</span><span class=lnt id=hl-24-345><a class=lnlinks href=#hl-24-345>345</a>
</span><span class=lnt id=hl-24-346><a class=lnlinks href=#hl-24-346>346</a>
</span><span class=lnt id=hl-24-347><a class=lnlinks href=#hl-24-347>347</a>
</span><span class=lnt id=hl-24-348><a class=lnlinks href=#hl-24-348>348</a>
</span><span class=lnt id=hl-24-349><a class=lnlinks href=#hl-24-349>349</a>
</span><span class=lnt id=hl-24-350><a class=lnlinks href=#hl-24-350>350</a>
</span><span class=lnt id=hl-24-351><a class=lnlinks href=#hl-24-351>351</a>
</span><span class=lnt id=hl-24-352><a class=lnlinks href=#hl-24-352>352</a>
</span><span class=lnt id=hl-24-353><a class=lnlinks href=#hl-24-353>353</a>
</span><span class=lnt id=hl-24-354><a class=lnlinks href=#hl-24-354>354</a>
</span><span class=lnt id=hl-24-355><a class=lnlinks href=#hl-24-355>355</a>
</span><span class=lnt id=hl-24-356><a class=lnlinks href=#hl-24-356>356</a>
</span><span class=lnt id=hl-24-357><a class=lnlinks href=#hl-24-357>357</a>
</span><span class=lnt id=hl-24-358><a class=lnlinks href=#hl-24-358>358</a>
</span><span class=lnt id=hl-24-359><a class=lnlinks href=#hl-24-359>359</a>
</span><span class=lnt id=hl-24-360><a class=lnlinks href=#hl-24-360>360</a>
</span><span class=lnt id=hl-24-361><a class=lnlinks href=#hl-24-361>361</a>
</span><span class=lnt id=hl-24-362><a class=lnlinks href=#hl-24-362>362</a>
</span><span class=lnt id=hl-24-363><a class=lnlinks href=#hl-24-363>363</a>
</span><span class=lnt id=hl-24-364><a class=lnlinks href=#hl-24-364>364</a>
</span><span class=lnt id=hl-24-365><a class=lnlinks href=#hl-24-365>365</a>
</span><span class=lnt id=hl-24-366><a class=lnlinks href=#hl-24-366>366</a>
</span><span class=lnt id=hl-24-367><a class=lnlinks href=#hl-24-367>367</a>
</span><span class=lnt id=hl-24-368><a class=lnlinks href=#hl-24-368>368</a>
</span><span class=lnt id=hl-24-369><a class=lnlinks href=#hl-24-369>369</a>
</span><span class=lnt id=hl-24-370><a class=lnlinks href=#hl-24-370>370</a>
</span><span class=lnt id=hl-24-371><a class=lnlinks href=#hl-24-371>371</a>
</span><span class=lnt id=hl-24-372><a class=lnlinks href=#hl-24-372>372</a>
</span><span class=lnt id=hl-24-373><a class=lnlinks href=#hl-24-373>373</a>
</span><span class=lnt id=hl-24-374><a class=lnlinks href=#hl-24-374>374</a>
</span><span class=lnt id=hl-24-375><a class=lnlinks href=#hl-24-375>375</a>
</span><span class=lnt id=hl-24-376><a class=lnlinks href=#hl-24-376>376</a>
</span><span class=lnt id=hl-24-377><a class=lnlinks href=#hl-24-377>377</a>
</span><span class=lnt id=hl-24-378><a class=lnlinks href=#hl-24-378>378</a>
</span><span class=lnt id=hl-24-379><a class=lnlinks href=#hl-24-379>379</a>
</span><span class=lnt id=hl-24-380><a class=lnlinks href=#hl-24-380>380</a>
</span><span class=lnt id=hl-24-381><a class=lnlinks href=#hl-24-381>381</a>
</span><span class=lnt id=hl-24-382><a class=lnlinks href=#hl-24-382>382</a>
</span><span class=lnt id=hl-24-383><a class=lnlinks href=#hl-24-383>383</a>
</span><span class=lnt id=hl-24-384><a class=lnlinks href=#hl-24-384>384</a>
</span><span class=lnt id=hl-24-385><a class=lnlinks href=#hl-24-385>385</a>
</span><span class=lnt id=hl-24-386><a class=lnlinks href=#hl-24-386>386</a>
</span><span class=lnt id=hl-24-387><a class=lnlinks href=#hl-24-387>387</a>
</span><span class=lnt id=hl-24-388><a class=lnlinks href=#hl-24-388>388</a>
</span><span class=lnt id=hl-24-389><a class=lnlinks href=#hl-24-389>389</a>
</span><span class=lnt id=hl-24-390><a class=lnlinks href=#hl-24-390>390</a>
</span><span class=lnt id=hl-24-391><a class=lnlinks href=#hl-24-391>391</a>
</span><span class=lnt id=hl-24-392><a class=lnlinks href=#hl-24-392>392</a>
</span><span class=lnt id=hl-24-393><a class=lnlinks href=#hl-24-393>393</a>
</span><span class=lnt id=hl-24-394><a class=lnlinks href=#hl-24-394>394</a>
</span><span class=lnt id=hl-24-395><a class=lnlinks href=#hl-24-395>395</a>
</span><span class=lnt id=hl-24-396><a class=lnlinks href=#hl-24-396>396</a>
</span><span class=lnt id=hl-24-397><a class=lnlinks href=#hl-24-397>397</a>
</span><span class=lnt id=hl-24-398><a class=lnlinks href=#hl-24-398>398</a>
</span><span class=lnt id=hl-24-399><a class=lnlinks href=#hl-24-399>399</a>
</span><span class=lnt id=hl-24-400><a class=lnlinks href=#hl-24-400>400</a>
</span><span class=lnt id=hl-24-401><a class=lnlinks href=#hl-24-401>401</a>
</span><span class=lnt id=hl-24-402><a class=lnlinks href=#hl-24-402>402</a>
</span><span class=lnt id=hl-24-403><a class=lnlinks href=#hl-24-403>403</a>
</span><span class=lnt id=hl-24-404><a class=lnlinks href=#hl-24-404>404</a>
</span><span class=lnt id=hl-24-405><a class=lnlinks href=#hl-24-405>405</a>
</span><span class=lnt id=hl-24-406><a class=lnlinks href=#hl-24-406>406</a>
</span><span class=lnt id=hl-24-407><a class=lnlinks href=#hl-24-407>407</a>
</span><span class=lnt id=hl-24-408><a class=lnlinks href=#hl-24-408>408</a>
</span><span class=lnt id=hl-24-409><a class=lnlinks href=#hl-24-409>409</a>
</span><span class=lnt id=hl-24-410><a class=lnlinks href=#hl-24-410>410</a>
</span><span class=lnt id=hl-24-411><a class=lnlinks href=#hl-24-411>411</a>
</span><span class=lnt id=hl-24-412><a class=lnlinks href=#hl-24-412>412</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 Kafka를 사용한 데이터 스트리밍 아키텍처 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ioredis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cors</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cors&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Kafka 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;data-stream-processor&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Redis 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>redisClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Redis</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Express 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cors</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 스트림 처리 클래스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>StreamProcessor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>producer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;stream-processor-group&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;metrics-processor-group&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>start</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 생산자 및 소비자 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 토픽 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topics</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;data-events&#39;</span><span class=p>],</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topics</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;metrics&#39;</span><span class=p>],</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 데이터 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>heartbeat</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>eventData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>eventType</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데이터 이벤트 수신: </span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>, ID: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 이벤트 카운트 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span><span class=p>[</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span><span class=p>[</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 이벤트 타입에 따른 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processEvent</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 주기적 하트비트 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=nx>heartbeat</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이벤트 처리 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>metricData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 지표 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>updateMetrics</span><span class=p>(</span><span class=nx>metricData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// Redis에 실시간 지표 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>storeMetricsInRedis</span><span class=p>(</span><span class=nx>metricData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;메트릭 처리 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 주기적인 통계 보고
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>reportStats</span><span class=p>(),</span> <span class=mi>60000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;스트림 프로세서가 시작되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processEvent</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 타입에 따른 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>switch</span> <span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;user_action&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processUserAction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;system_metric&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processSystemMetric</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processTransaction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`알 수 없는 이벤트 타입: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 토픽으로 집계 데이터 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processUserAction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자 행동 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`사용자 행동 처리: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>, 액션: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>action</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자 행동 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=sb>`user:</span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>:actions`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>action</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=mi>86400</span><span class=p>);</span> <span class=c1>// 24시간 유지
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processSystemMetric</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 시스템 메트릭 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`시스템 메트릭 처리: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>system</span><span class=si>}</span><span class=sb>, 지표: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>metric</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 시스템 메트릭 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=sb>`system:</span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>system</span><span class=si>}</span><span class=sb>:metrics`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hset</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>metric</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processTransaction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 트랜잭션 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`트랜잭션 처리: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>transactionId</span><span class=si>}</span><span class=sb>, 금액: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>amount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 트랜잭션 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>dayKey</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`transactions:</span><span class=si>${</span><span class=nx>dayKey</span><span class=si>}</span><span class=sb>:count`</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`transactions:</span><span class=si>${</span><span class=nx>dayKey</span><span class=si>}</span><span class=sb>:amount`</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>sendMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 데이터 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>metricData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>source</span><span class=o>:</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>source</span> <span class=o>||</span> <span class=s1>&#39;unknown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>eventType</span><span class=o>:</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dimensions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 타입별 차원 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>extractDimensions</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>metrics</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 타입별 지표 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>extractMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 토픽으로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;metrics&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>messages</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>metricData</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>extractDimensions</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트에서 차원 정보 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>dimensions</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;user_action&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>userId</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>action</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>action</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>platform</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>platform</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;system_metric&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>system</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>system</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>metric</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>metric</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>instance</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>transactionType</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>transactionType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>paymentMethod</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>paymentMethod</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>country</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>country</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>dimensions</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>extractMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트에서 지표 정보 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>metrics</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;user_action&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>duration</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>duration</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;system_metric&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>metrics</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>updateMetrics</span><span class=p>(</span><span class=nx>metricData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>eventType</span><span class=p>,</span> <span class=nx>dimensions</span><span class=p>,</span> <span class=nx>metrics</span><span class=p>,</span> <span class=nx>timestamp</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>metricData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timeWindow</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>timestamp</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>)</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>;</span> <span class=c1>// 1분 윈도우
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 시간 윈도우별 지표 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>][</span><span class=nx>eventType</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>][</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>stats</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>][</span><span class=nx>eventType</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nx>stats</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 차원별 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>dimName</span><span class=p>,</span> <span class=nx>dimValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>dimensions</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>][</span><span class=nx>dimValue</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>][</span><span class=nx>dimValue</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>][</span><span class=nx>dimValue</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 지표 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>metrics</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>sum</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>min</span><span class=o>:</span> <span class=nb>Number</span><span class=p>.</span><span class=nx>MAX_VALUE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>max</span><span class=o>:</span> <span class=nb>Number</span><span class=p>.</span><span class=nx>MIN_VALUE</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>metricStats</span> <span class=o>=</span> <span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>sum</span> <span class=o>+=</span> <span class=nx>metricValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>min</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>min</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>max</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>max</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 오래된 윈도우 정리 (30분 이상 지난 데이터)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>cutoffTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=mi>30</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>windowTime</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>windowTime</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nx>cutoffTime</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>delete</span> <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>windowTime</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>storeMetricsInRedis</span><span class=p>(</span><span class=nx>metricData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>eventType</span><span class=p>,</span> <span class=nx>dimensions</span><span class=p>,</span> <span class=nx>metrics</span><span class=p>,</span> <span class=nx>timestamp</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>metricData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timeWindow</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>timestamp</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>);</span> <span class=c1>// 1분 윈도우
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// Redis에 지표 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>metricKey</span> <span class=o>=</span> <span class=sb>`metrics:</span><span class=si>${</span><span class=nx>timeWindow</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 지표 데이터 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>metrics</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:sum`</span><span class=p>,</span> <span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:count`</span><span class=p>,</span> <span class=nx>metricName</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 차원 데이터 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>dimName</span><span class=p>,</span> <span class=nx>dimValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>dimensions</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:dimension:</span><span class=si>${</span><span class=nx>dimName</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>dimValue</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 만료 시간 설정 (24시간)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>metricKey</span><span class=p>,</span> <span class=mi>86400</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>reportStats</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n--- 스트림 프로세서 통계 ---&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;이벤트 카운트:&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 최근 5분 통계 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>recentWindows</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>time</span> <span class=p>=&gt;</span> <span class=nx>now</span> <span class=o>-</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>time</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>sort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>recentWindows</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n최근 5분 통계:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nb>window</span> <span class=k>of</span> <span class=nx>recentWindows</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>windowTime</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nb>window</span><span class=p>)).</span><span class=nx>toISOString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\n시간 윈도우: </span><span class=si>${</span><span class=nx>windowTime</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>eventType</span><span class=p>,</span> <span class=nx>stats</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nb>window</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`  </span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>stats</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb>건`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 주요 지표 출력
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricStats</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>avg</span> <span class=o>=</span> <span class=nx>metricStats</span><span class=p>.</span><span class=nx>sum</span> <span class=o>/</span> <span class=nx>metricStats</span><span class=p>.</span><span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`    </span><span class=si>${</span><span class=nx>metricName</span><span class=si>}</span><span class=sb>: avg=</span><span class=si>${</span><span class=nx>avg</span><span class=p>.</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb>, min=</span><span class=si>${</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>min</span><span class=si>}</span><span class=sb>, max=</span><span class=si>${</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>max</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n------------------------\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>stop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;스트림 프로세서가 중지되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/stats/realtime&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 최근 5분 통계 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fiveMinutesAgo</span> <span class=o>=</span> <span class=nx>now</span> <span class=o>-</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Redis에서 최근 통계 데이터 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>timeWindows</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>t</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>fiveMinutesAgo</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>);</span> <span class=nx>t</span> <span class=o>&lt;=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>now</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>);</span> <span class=nx>t</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeWindows</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeWindows</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>      <span class=nx>eventTypes</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nb>window</span> <span class=k>of</span> <span class=nx>timeWindows</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>windowTime</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nb>window</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>).</span><span class=nx>toISOString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>result</span><span class=p>.</span><span class=nx>timeWindows</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>windowTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 각 이벤트 타입별 데이터 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>eventTypes</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;user_action&#39;</span><span class=p>,</span> <span class=s1>&#39;system_metric&#39;</span><span class=p>,</span> <span class=s1>&#39;transaction&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>eventType</span> <span class=k>of</span> <span class=nx>eventTypes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>counts</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=nx>metrics</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>metricKey</span> <span class=o>=</span> <span class=sb>`metrics:</span><span class=si>${</span><span class=nb>window</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 횟수 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>countData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hgetall</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:count`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>totalCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>count</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>values</span><span class=p>(</span><span class=nx>countData</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>totalCount</span> <span class=o>+=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>count</span> <span class=o>||</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>counts</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>totalCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주요 지표 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>sumData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hgetall</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:sum`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>sum</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>sumData</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>sums</span><span class=o>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>].</span><span class=nx>sums</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>sum</span> <span class=o>||</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;통계 조회 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서버 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`API 서버가 포트 </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>에서 실행 중입니다.`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 스트림 프로세서 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>processor</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>StreamProcessor</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>processor</span><span class=p>.</span><span class=nx>start</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 정상 종료 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;애플리케이션 종료 중…&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>processor</span><span class=p>.</span><span class=nx>stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>quit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=명령-및-이벤트-기반-아키텍처>명령 및 이벤트 기반 아키텍처<a hidden class=anchor aria-hidden=true href=#명령-및-이벤트-기반-아키텍처>#</a></h4><p>명령(Command)과 이벤트(Event)를 통해 시스템 컴포넌트 간의 통신을 조정하는 아키텍처 패턴이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>  1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>  2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>  3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>  4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>  5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>  6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>  7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>  8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>  9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10> 10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11> 11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12> 12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13> 13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14> 14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15> 15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16> 16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17> 17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18> 18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19> 19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20> 20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21> 21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22> 22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23> 23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24> 24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25> 25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26> 26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27> 27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28> 28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29> 29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30> 30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31> 31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32> 32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33> 33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34> 34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35> 35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36> 36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37> 37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38> 38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39> 39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40> 40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41> 41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42> 42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43> 43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44> 44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45> 45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46> 46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47> 47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48> 48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49> 49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50> 50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51> 51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52> 52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53> 53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54> 54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55> 55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56> 56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57> 57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58> 58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59> 59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60> 60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61> 61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62> 62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63> 63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64> 64</a>
</span><span class=lnt id=hl-25-65><a class=lnlinks href=#hl-25-65> 65</a>
</span><span class=lnt id=hl-25-66><a class=lnlinks href=#hl-25-66> 66</a>
</span><span class=lnt id=hl-25-67><a class=lnlinks href=#hl-25-67> 67</a>
</span><span class=lnt id=hl-25-68><a class=lnlinks href=#hl-25-68> 68</a>
</span><span class=lnt id=hl-25-69><a class=lnlinks href=#hl-25-69> 69</a>
</span><span class=lnt id=hl-25-70><a class=lnlinks href=#hl-25-70> 70</a>
</span><span class=lnt id=hl-25-71><a class=lnlinks href=#hl-25-71> 71</a>
</span><span class=lnt id=hl-25-72><a class=lnlinks href=#hl-25-72> 72</a>
</span><span class=lnt id=hl-25-73><a class=lnlinks href=#hl-25-73> 73</a>
</span><span class=lnt id=hl-25-74><a class=lnlinks href=#hl-25-74> 74</a>
</span><span class=lnt id=hl-25-75><a class=lnlinks href=#hl-25-75> 75</a>
</span><span class=lnt id=hl-25-76><a class=lnlinks href=#hl-25-76> 76</a>
</span><span class=lnt id=hl-25-77><a class=lnlinks href=#hl-25-77> 77</a>
</span><span class=lnt id=hl-25-78><a class=lnlinks href=#hl-25-78> 78</a>
</span><span class=lnt id=hl-25-79><a class=lnlinks href=#hl-25-79> 79</a>
</span><span class=lnt id=hl-25-80><a class=lnlinks href=#hl-25-80> 80</a>
</span><span class=lnt id=hl-25-81><a class=lnlinks href=#hl-25-81> 81</a>
</span><span class=lnt id=hl-25-82><a class=lnlinks href=#hl-25-82> 82</a>
</span><span class=lnt id=hl-25-83><a class=lnlinks href=#hl-25-83> 83</a>
</span><span class=lnt id=hl-25-84><a class=lnlinks href=#hl-25-84> 84</a>
</span><span class=lnt id=hl-25-85><a class=lnlinks href=#hl-25-85> 85</a>
</span><span class=lnt id=hl-25-86><a class=lnlinks href=#hl-25-86> 86</a>
</span><span class=lnt id=hl-25-87><a class=lnlinks href=#hl-25-87> 87</a>
</span><span class=lnt id=hl-25-88><a class=lnlinks href=#hl-25-88> 88</a>
</span><span class=lnt id=hl-25-89><a class=lnlinks href=#hl-25-89> 89</a>
</span><span class=lnt id=hl-25-90><a class=lnlinks href=#hl-25-90> 90</a>
</span><span class=lnt id=hl-25-91><a class=lnlinks href=#hl-25-91> 91</a>
</span><span class=lnt id=hl-25-92><a class=lnlinks href=#hl-25-92> 92</a>
</span><span class=lnt id=hl-25-93><a class=lnlinks href=#hl-25-93> 93</a>
</span><span class=lnt id=hl-25-94><a class=lnlinks href=#hl-25-94> 94</a>
</span><span class=lnt id=hl-25-95><a class=lnlinks href=#hl-25-95> 95</a>
</span><span class=lnt id=hl-25-96><a class=lnlinks href=#hl-25-96> 96</a>
</span><span class=lnt id=hl-25-97><a class=lnlinks href=#hl-25-97> 97</a>
</span><span class=lnt id=hl-25-98><a class=lnlinks href=#hl-25-98> 98</a>
</span><span class=lnt id=hl-25-99><a class=lnlinks href=#hl-25-99> 99</a>
</span><span class=lnt id=hl-25-100><a class=lnlinks href=#hl-25-100>100</a>
</span><span class=lnt id=hl-25-101><a class=lnlinks href=#hl-25-101>101</a>
</span><span class=lnt id=hl-25-102><a class=lnlinks href=#hl-25-102>102</a>
</span><span class=lnt id=hl-25-103><a class=lnlinks href=#hl-25-103>103</a>
</span><span class=lnt id=hl-25-104><a class=lnlinks href=#hl-25-104>104</a>
</span><span class=lnt id=hl-25-105><a class=lnlinks href=#hl-25-105>105</a>
</span><span class=lnt id=hl-25-106><a class=lnlinks href=#hl-25-106>106</a>
</span><span class=lnt id=hl-25-107><a class=lnlinks href=#hl-25-107>107</a>
</span><span class=lnt id=hl-25-108><a class=lnlinks href=#hl-25-108>108</a>
</span><span class=lnt id=hl-25-109><a class=lnlinks href=#hl-25-109>109</a>
</span><span class=lnt id=hl-25-110><a class=lnlinks href=#hl-25-110>110</a>
</span><span class=lnt id=hl-25-111><a class=lnlinks href=#hl-25-111>111</a>
</span><span class=lnt id=hl-25-112><a class=lnlinks href=#hl-25-112>112</a>
</span><span class=lnt id=hl-25-113><a class=lnlinks href=#hl-25-113>113</a>
</span><span class=lnt id=hl-25-114><a class=lnlinks href=#hl-25-114>114</a>
</span><span class=lnt id=hl-25-115><a class=lnlinks href=#hl-25-115>115</a>
</span><span class=lnt id=hl-25-116><a class=lnlinks href=#hl-25-116>116</a>
</span><span class=lnt id=hl-25-117><a class=lnlinks href=#hl-25-117>117</a>
</span><span class=lnt id=hl-25-118><a class=lnlinks href=#hl-25-118>118</a>
</span><span class=lnt id=hl-25-119><a class=lnlinks href=#hl-25-119>119</a>
</span><span class=lnt id=hl-25-120><a class=lnlinks href=#hl-25-120>120</a>
</span><span class=lnt id=hl-25-121><a class=lnlinks href=#hl-25-121>121</a>
</span><span class=lnt id=hl-25-122><a class=lnlinks href=#hl-25-122>122</a>
</span><span class=lnt id=hl-25-123><a class=lnlinks href=#hl-25-123>123</a>
</span><span class=lnt id=hl-25-124><a class=lnlinks href=#hl-25-124>124</a>
</span><span class=lnt id=hl-25-125><a class=lnlinks href=#hl-25-125>125</a>
</span><span class=lnt id=hl-25-126><a class=lnlinks href=#hl-25-126>126</a>
</span><span class=lnt id=hl-25-127><a class=lnlinks href=#hl-25-127>127</a>
</span><span class=lnt id=hl-25-128><a class=lnlinks href=#hl-25-128>128</a>
</span><span class=lnt id=hl-25-129><a class=lnlinks href=#hl-25-129>129</a>
</span><span class=lnt id=hl-25-130><a class=lnlinks href=#hl-25-130>130</a>
</span><span class=lnt id=hl-25-131><a class=lnlinks href=#hl-25-131>131</a>
</span><span class=lnt id=hl-25-132><a class=lnlinks href=#hl-25-132>132</a>
</span><span class=lnt id=hl-25-133><a class=lnlinks href=#hl-25-133>133</a>
</span><span class=lnt id=hl-25-134><a class=lnlinks href=#hl-25-134>134</a>
</span><span class=lnt id=hl-25-135><a class=lnlinks href=#hl-25-135>135</a>
</span><span class=lnt id=hl-25-136><a class=lnlinks href=#hl-25-136>136</a>
</span><span class=lnt id=hl-25-137><a class=lnlinks href=#hl-25-137>137</a>
</span><span class=lnt id=hl-25-138><a class=lnlinks href=#hl-25-138>138</a>
</span><span class=lnt id=hl-25-139><a class=lnlinks href=#hl-25-139>139</a>
</span><span class=lnt id=hl-25-140><a class=lnlinks href=#hl-25-140>140</a>
</span><span class=lnt id=hl-25-141><a class=lnlinks href=#hl-25-141>141</a>
</span><span class=lnt id=hl-25-142><a class=lnlinks href=#hl-25-142>142</a>
</span><span class=lnt id=hl-25-143><a class=lnlinks href=#hl-25-143>143</a>
</span><span class=lnt id=hl-25-144><a class=lnlinks href=#hl-25-144>144</a>
</span><span class=lnt id=hl-25-145><a class=lnlinks href=#hl-25-145>145</a>
</span><span class=lnt id=hl-25-146><a class=lnlinks href=#hl-25-146>146</a>
</span><span class=lnt id=hl-25-147><a class=lnlinks href=#hl-25-147>147</a>
</span><span class=lnt id=hl-25-148><a class=lnlinks href=#hl-25-148>148</a>
</span><span class=lnt id=hl-25-149><a class=lnlinks href=#hl-25-149>149</a>
</span><span class=lnt id=hl-25-150><a class=lnlinks href=#hl-25-150>150</a>
</span><span class=lnt id=hl-25-151><a class=lnlinks href=#hl-25-151>151</a>
</span><span class=lnt id=hl-25-152><a class=lnlinks href=#hl-25-152>152</a>
</span><span class=lnt id=hl-25-153><a class=lnlinks href=#hl-25-153>153</a>
</span><span class=lnt id=hl-25-154><a class=lnlinks href=#hl-25-154>154</a>
</span><span class=lnt id=hl-25-155><a class=lnlinks href=#hl-25-155>155</a>
</span><span class=lnt id=hl-25-156><a class=lnlinks href=#hl-25-156>156</a>
</span><span class=lnt id=hl-25-157><a class=lnlinks href=#hl-25-157>157</a>
</span><span class=lnt id=hl-25-158><a class=lnlinks href=#hl-25-158>158</a>
</span><span class=lnt id=hl-25-159><a class=lnlinks href=#hl-25-159>159</a>
</span><span class=lnt id=hl-25-160><a class=lnlinks href=#hl-25-160>160</a>
</span><span class=lnt id=hl-25-161><a class=lnlinks href=#hl-25-161>161</a>
</span><span class=lnt id=hl-25-162><a class=lnlinks href=#hl-25-162>162</a>
</span><span class=lnt id=hl-25-163><a class=lnlinks href=#hl-25-163>163</a>
</span><span class=lnt id=hl-25-164><a class=lnlinks href=#hl-25-164>164</a>
</span><span class=lnt id=hl-25-165><a class=lnlinks href=#hl-25-165>165</a>
</span><span class=lnt id=hl-25-166><a class=lnlinks href=#hl-25-166>166</a>
</span><span class=lnt id=hl-25-167><a class=lnlinks href=#hl-25-167>167</a>
</span><span class=lnt id=hl-25-168><a class=lnlinks href=#hl-25-168>168</a>
</span><span class=lnt id=hl-25-169><a class=lnlinks href=#hl-25-169>169</a>
</span><span class=lnt id=hl-25-170><a class=lnlinks href=#hl-25-170>170</a>
</span><span class=lnt id=hl-25-171><a class=lnlinks href=#hl-25-171>171</a>
</span><span class=lnt id=hl-25-172><a class=lnlinks href=#hl-25-172>172</a>
</span><span class=lnt id=hl-25-173><a class=lnlinks href=#hl-25-173>173</a>
</span><span class=lnt id=hl-25-174><a class=lnlinks href=#hl-25-174>174</a>
</span><span class=lnt id=hl-25-175><a class=lnlinks href=#hl-25-175>175</a>
</span><span class=lnt id=hl-25-176><a class=lnlinks href=#hl-25-176>176</a>
</span><span class=lnt id=hl-25-177><a class=lnlinks href=#hl-25-177>177</a>
</span><span class=lnt id=hl-25-178><a class=lnlinks href=#hl-25-178>178</a>
</span><span class=lnt id=hl-25-179><a class=lnlinks href=#hl-25-179>179</a>
</span><span class=lnt id=hl-25-180><a class=lnlinks href=#hl-25-180>180</a>
</span><span class=lnt id=hl-25-181><a class=lnlinks href=#hl-25-181>181</a>
</span><span class=lnt id=hl-25-182><a class=lnlinks href=#hl-25-182>182</a>
</span><span class=lnt id=hl-25-183><a class=lnlinks href=#hl-25-183>183</a>
</span><span class=lnt id=hl-25-184><a class=lnlinks href=#hl-25-184>184</a>
</span><span class=lnt id=hl-25-185><a class=lnlinks href=#hl-25-185>185</a>
</span><span class=lnt id=hl-25-186><a class=lnlinks href=#hl-25-186>186</a>
</span><span class=lnt id=hl-25-187><a class=lnlinks href=#hl-25-187>187</a>
</span><span class=lnt id=hl-25-188><a class=lnlinks href=#hl-25-188>188</a>
</span><span class=lnt id=hl-25-189><a class=lnlinks href=#hl-25-189>189</a>
</span><span class=lnt id=hl-25-190><a class=lnlinks href=#hl-25-190>190</a>
</span><span class=lnt id=hl-25-191><a class=lnlinks href=#hl-25-191>191</a>
</span><span class=lnt id=hl-25-192><a class=lnlinks href=#hl-25-192>192</a>
</span><span class=lnt id=hl-25-193><a class=lnlinks href=#hl-25-193>193</a>
</span><span class=lnt id=hl-25-194><a class=lnlinks href=#hl-25-194>194</a>
</span><span class=lnt id=hl-25-195><a class=lnlinks href=#hl-25-195>195</a>
</span><span class=lnt id=hl-25-196><a class=lnlinks href=#hl-25-196>196</a>
</span><span class=lnt id=hl-25-197><a class=lnlinks href=#hl-25-197>197</a>
</span><span class=lnt id=hl-25-198><a class=lnlinks href=#hl-25-198>198</a>
</span><span class=lnt id=hl-25-199><a class=lnlinks href=#hl-25-199>199</a>
</span><span class=lnt id=hl-25-200><a class=lnlinks href=#hl-25-200>200</a>
</span><span class=lnt id=hl-25-201><a class=lnlinks href=#hl-25-201>201</a>
</span><span class=lnt id=hl-25-202><a class=lnlinks href=#hl-25-202>202</a>
</span><span class=lnt id=hl-25-203><a class=lnlinks href=#hl-25-203>203</a>
</span><span class=lnt id=hl-25-204><a class=lnlinks href=#hl-25-204>204</a>
</span><span class=lnt id=hl-25-205><a class=lnlinks href=#hl-25-205>205</a>
</span><span class=lnt id=hl-25-206><a class=lnlinks href=#hl-25-206>206</a>
</span><span class=lnt id=hl-25-207><a class=lnlinks href=#hl-25-207>207</a>
</span><span class=lnt id=hl-25-208><a class=lnlinks href=#hl-25-208>208</a>
</span><span class=lnt id=hl-25-209><a class=lnlinks href=#hl-25-209>209</a>
</span><span class=lnt id=hl-25-210><a class=lnlinks href=#hl-25-210>210</a>
</span><span class=lnt id=hl-25-211><a class=lnlinks href=#hl-25-211>211</a>
</span><span class=lnt id=hl-25-212><a class=lnlinks href=#hl-25-212>212</a>
</span><span class=lnt id=hl-25-213><a class=lnlinks href=#hl-25-213>213</a>
</span><span class=lnt id=hl-25-214><a class=lnlinks href=#hl-25-214>214</a>
</span><span class=lnt id=hl-25-215><a class=lnlinks href=#hl-25-215>215</a>
</span><span class=lnt id=hl-25-216><a class=lnlinks href=#hl-25-216>216</a>
</span><span class=lnt id=hl-25-217><a class=lnlinks href=#hl-25-217>217</a>
</span><span class=lnt id=hl-25-218><a class=lnlinks href=#hl-25-218>218</a>
</span><span class=lnt id=hl-25-219><a class=lnlinks href=#hl-25-219>219</a>
</span><span class=lnt id=hl-25-220><a class=lnlinks href=#hl-25-220>220</a>
</span><span class=lnt id=hl-25-221><a class=lnlinks href=#hl-25-221>221</a>
</span><span class=lnt id=hl-25-222><a class=lnlinks href=#hl-25-222>222</a>
</span><span class=lnt id=hl-25-223><a class=lnlinks href=#hl-25-223>223</a>
</span><span class=lnt id=hl-25-224><a class=lnlinks href=#hl-25-224>224</a>
</span><span class=lnt id=hl-25-225><a class=lnlinks href=#hl-25-225>225</a>
</span><span class=lnt id=hl-25-226><a class=lnlinks href=#hl-25-226>226</a>
</span><span class=lnt id=hl-25-227><a class=lnlinks href=#hl-25-227>227</a>
</span><span class=lnt id=hl-25-228><a class=lnlinks href=#hl-25-228>228</a>
</span><span class=lnt id=hl-25-229><a class=lnlinks href=#hl-25-229>229</a>
</span><span class=lnt id=hl-25-230><a class=lnlinks href=#hl-25-230>230</a>
</span><span class=lnt id=hl-25-231><a class=lnlinks href=#hl-25-231>231</a>
</span><span class=lnt id=hl-25-232><a class=lnlinks href=#hl-25-232>232</a>
</span><span class=lnt id=hl-25-233><a class=lnlinks href=#hl-25-233>233</a>
</span><span class=lnt id=hl-25-234><a class=lnlinks href=#hl-25-234>234</a>
</span><span class=lnt id=hl-25-235><a class=lnlinks href=#hl-25-235>235</a>
</span><span class=lnt id=hl-25-236><a class=lnlinks href=#hl-25-236>236</a>
</span><span class=lnt id=hl-25-237><a class=lnlinks href=#hl-25-237>237</a>
</span><span class=lnt id=hl-25-238><a class=lnlinks href=#hl-25-238>238</a>
</span><span class=lnt id=hl-25-239><a class=lnlinks href=#hl-25-239>239</a>
</span><span class=lnt id=hl-25-240><a class=lnlinks href=#hl-25-240>240</a>
</span><span class=lnt id=hl-25-241><a class=lnlinks href=#hl-25-241>241</a>
</span><span class=lnt id=hl-25-242><a class=lnlinks href=#hl-25-242>242</a>
</span><span class=lnt id=hl-25-243><a class=lnlinks href=#hl-25-243>243</a>
</span><span class=lnt id=hl-25-244><a class=lnlinks href=#hl-25-244>244</a>
</span><span class=lnt id=hl-25-245><a class=lnlinks href=#hl-25-245>245</a>
</span><span class=lnt id=hl-25-246><a class=lnlinks href=#hl-25-246>246</a>
</span><span class=lnt id=hl-25-247><a class=lnlinks href=#hl-25-247>247</a>
</span><span class=lnt id=hl-25-248><a class=lnlinks href=#hl-25-248>248</a>
</span><span class=lnt id=hl-25-249><a class=lnlinks href=#hl-25-249>249</a>
</span><span class=lnt id=hl-25-250><a class=lnlinks href=#hl-25-250>250</a>
</span><span class=lnt id=hl-25-251><a class=lnlinks href=#hl-25-251>251</a>
</span><span class=lnt id=hl-25-252><a class=lnlinks href=#hl-25-252>252</a>
</span><span class=lnt id=hl-25-253><a class=lnlinks href=#hl-25-253>253</a>
</span><span class=lnt id=hl-25-254><a class=lnlinks href=#hl-25-254>254</a>
</span><span class=lnt id=hl-25-255><a class=lnlinks href=#hl-25-255>255</a>
</span><span class=lnt id=hl-25-256><a class=lnlinks href=#hl-25-256>256</a>
</span><span class=lnt id=hl-25-257><a class=lnlinks href=#hl-25-257>257</a>
</span><span class=lnt id=hl-25-258><a class=lnlinks href=#hl-25-258>258</a>
</span><span class=lnt id=hl-25-259><a class=lnlinks href=#hl-25-259>259</a>
</span><span class=lnt id=hl-25-260><a class=lnlinks href=#hl-25-260>260</a>
</span><span class=lnt id=hl-25-261><a class=lnlinks href=#hl-25-261>261</a>
</span><span class=lnt id=hl-25-262><a class=lnlinks href=#hl-25-262>262</a>
</span><span class=lnt id=hl-25-263><a class=lnlinks href=#hl-25-263>263</a>
</span><span class=lnt id=hl-25-264><a class=lnlinks href=#hl-25-264>264</a>
</span><span class=lnt id=hl-25-265><a class=lnlinks href=#hl-25-265>265</a>
</span><span class=lnt id=hl-25-266><a class=lnlinks href=#hl-25-266>266</a>
</span><span class=lnt id=hl-25-267><a class=lnlinks href=#hl-25-267>267</a>
</span><span class=lnt id=hl-25-268><a class=lnlinks href=#hl-25-268>268</a>
</span><span class=lnt id=hl-25-269><a class=lnlinks href=#hl-25-269>269</a>
</span><span class=lnt id=hl-25-270><a class=lnlinks href=#hl-25-270>270</a>
</span><span class=lnt id=hl-25-271><a class=lnlinks href=#hl-25-271>271</a>
</span><span class=lnt id=hl-25-272><a class=lnlinks href=#hl-25-272>272</a>
</span><span class=lnt id=hl-25-273><a class=lnlinks href=#hl-25-273>273</a>
</span><span class=lnt id=hl-25-274><a class=lnlinks href=#hl-25-274>274</a>
</span><span class=lnt id=hl-25-275><a class=lnlinks href=#hl-25-275>275</a>
</span><span class=lnt id=hl-25-276><a class=lnlinks href=#hl-25-276>276</a>
</span><span class=lnt id=hl-25-277><a class=lnlinks href=#hl-25-277>277</a>
</span><span class=lnt id=hl-25-278><a class=lnlinks href=#hl-25-278>278</a>
</span><span class=lnt id=hl-25-279><a class=lnlinks href=#hl-25-279>279</a>
</span><span class=lnt id=hl-25-280><a class=lnlinks href=#hl-25-280>280</a>
</span><span class=lnt id=hl-25-281><a class=lnlinks href=#hl-25-281>281</a>
</span><span class=lnt id=hl-25-282><a class=lnlinks href=#hl-25-282>282</a>
</span><span class=lnt id=hl-25-283><a class=lnlinks href=#hl-25-283>283</a>
</span><span class=lnt id=hl-25-284><a class=lnlinks href=#hl-25-284>284</a>
</span><span class=lnt id=hl-25-285><a class=lnlinks href=#hl-25-285>285</a>
</span><span class=lnt id=hl-25-286><a class=lnlinks href=#hl-25-286>286</a>
</span><span class=lnt id=hl-25-287><a class=lnlinks href=#hl-25-287>287</a>
</span><span class=lnt id=hl-25-288><a class=lnlinks href=#hl-25-288>288</a>
</span><span class=lnt id=hl-25-289><a class=lnlinks href=#hl-25-289>289</a>
</span><span class=lnt id=hl-25-290><a class=lnlinks href=#hl-25-290>290</a>
</span><span class=lnt id=hl-25-291><a class=lnlinks href=#hl-25-291>291</a>
</span><span class=lnt id=hl-25-292><a class=lnlinks href=#hl-25-292>292</a>
</span><span class=lnt id=hl-25-293><a class=lnlinks href=#hl-25-293>293</a>
</span><span class=lnt id=hl-25-294><a class=lnlinks href=#hl-25-294>294</a>
</span><span class=lnt id=hl-25-295><a class=lnlinks href=#hl-25-295>295</a>
</span><span class=lnt id=hl-25-296><a class=lnlinks href=#hl-25-296>296</a>
</span><span class=lnt id=hl-25-297><a class=lnlinks href=#hl-25-297>297</a>
</span><span class=lnt id=hl-25-298><a class=lnlinks href=#hl-25-298>298</a>
</span><span class=lnt id=hl-25-299><a class=lnlinks href=#hl-25-299>299</a>
</span><span class=lnt id=hl-25-300><a class=lnlinks href=#hl-25-300>300</a>
</span><span class=lnt id=hl-25-301><a class=lnlinks href=#hl-25-301>301</a>
</span><span class=lnt id=hl-25-302><a class=lnlinks href=#hl-25-302>302</a>
</span><span class=lnt id=hl-25-303><a class=lnlinks href=#hl-25-303>303</a>
</span><span class=lnt id=hl-25-304><a class=lnlinks href=#hl-25-304>304</a>
</span><span class=lnt id=hl-25-305><a class=lnlinks href=#hl-25-305>305</a>
</span><span class=lnt id=hl-25-306><a class=lnlinks href=#hl-25-306>306</a>
</span><span class=lnt id=hl-25-307><a class=lnlinks href=#hl-25-307>307</a>
</span><span class=lnt id=hl-25-308><a class=lnlinks href=#hl-25-308>308</a>
</span><span class=lnt id=hl-25-309><a class=lnlinks href=#hl-25-309>309</a>
</span><span class=lnt id=hl-25-310><a class=lnlinks href=#hl-25-310>310</a>
</span><span class=lnt id=hl-25-311><a class=lnlinks href=#hl-25-311>311</a>
</span><span class=lnt id=hl-25-312><a class=lnlinks href=#hl-25-312>312</a>
</span><span class=lnt id=hl-25-313><a class=lnlinks href=#hl-25-313>313</a>
</span><span class=lnt id=hl-25-314><a class=lnlinks href=#hl-25-314>314</a>
</span><span class=lnt id=hl-25-315><a class=lnlinks href=#hl-25-315>315</a>
</span><span class=lnt id=hl-25-316><a class=lnlinks href=#hl-25-316>316</a>
</span><span class=lnt id=hl-25-317><a class=lnlinks href=#hl-25-317>317</a>
</span><span class=lnt id=hl-25-318><a class=lnlinks href=#hl-25-318>318</a>
</span><span class=lnt id=hl-25-319><a class=lnlinks href=#hl-25-319>319</a>
</span><span class=lnt id=hl-25-320><a class=lnlinks href=#hl-25-320>320</a>
</span><span class=lnt id=hl-25-321><a class=lnlinks href=#hl-25-321>321</a>
</span><span class=lnt id=hl-25-322><a class=lnlinks href=#hl-25-322>322</a>
</span><span class=lnt id=hl-25-323><a class=lnlinks href=#hl-25-323>323</a>
</span><span class=lnt id=hl-25-324><a class=lnlinks href=#hl-25-324>324</a>
</span><span class=lnt id=hl-25-325><a class=lnlinks href=#hl-25-325>325</a>
</span><span class=lnt id=hl-25-326><a class=lnlinks href=#hl-25-326>326</a>
</span><span class=lnt id=hl-25-327><a class=lnlinks href=#hl-25-327>327</a>
</span><span class=lnt id=hl-25-328><a class=lnlinks href=#hl-25-328>328</a>
</span><span class=lnt id=hl-25-329><a class=lnlinks href=#hl-25-329>329</a>
</span><span class=lnt id=hl-25-330><a class=lnlinks href=#hl-25-330>330</a>
</span><span class=lnt id=hl-25-331><a class=lnlinks href=#hl-25-331>331</a>
</span><span class=lnt id=hl-25-332><a class=lnlinks href=#hl-25-332>332</a>
</span><span class=lnt id=hl-25-333><a class=lnlinks href=#hl-25-333>333</a>
</span><span class=lnt id=hl-25-334><a class=lnlinks href=#hl-25-334>334</a>
</span><span class=lnt id=hl-25-335><a class=lnlinks href=#hl-25-335>335</a>
</span><span class=lnt id=hl-25-336><a class=lnlinks href=#hl-25-336>336</a>
</span><span class=lnt id=hl-25-337><a class=lnlinks href=#hl-25-337>337</a>
</span><span class=lnt id=hl-25-338><a class=lnlinks href=#hl-25-338>338</a>
</span><span class=lnt id=hl-25-339><a class=lnlinks href=#hl-25-339>339</a>
</span><span class=lnt id=hl-25-340><a class=lnlinks href=#hl-25-340>340</a>
</span><span class=lnt id=hl-25-341><a class=lnlinks href=#hl-25-341>341</a>
</span><span class=lnt id=hl-25-342><a class=lnlinks href=#hl-25-342>342</a>
</span><span class=lnt id=hl-25-343><a class=lnlinks href=#hl-25-343>343</a>
</span><span class=lnt id=hl-25-344><a class=lnlinks href=#hl-25-344>344</a>
</span><span class=lnt id=hl-25-345><a class=lnlinks href=#hl-25-345>345</a>
</span><span class=lnt id=hl-25-346><a class=lnlinks href=#hl-25-346>346</a>
</span><span class=lnt id=hl-25-347><a class=lnlinks href=#hl-25-347>347</a>
</span><span class=lnt id=hl-25-348><a class=lnlinks href=#hl-25-348>348</a>
</span><span class=lnt id=hl-25-349><a class=lnlinks href=#hl-25-349>349</a>
</span><span class=lnt id=hl-25-350><a class=lnlinks href=#hl-25-350>350</a>
</span><span class=lnt id=hl-25-351><a class=lnlinks href=#hl-25-351>351</a>
</span><span class=lnt id=hl-25-352><a class=lnlinks href=#hl-25-352>352</a>
</span><span class=lnt id=hl-25-353><a class=lnlinks href=#hl-25-353>353</a>
</span><span class=lnt id=hl-25-354><a class=lnlinks href=#hl-25-354>354</a>
</span><span class=lnt id=hl-25-355><a class=lnlinks href=#hl-25-355>355</a>
</span><span class=lnt id=hl-25-356><a class=lnlinks href=#hl-25-356>356</a>
</span><span class=lnt id=hl-25-357><a class=lnlinks href=#hl-25-357>357</a>
</span><span class=lnt id=hl-25-358><a class=lnlinks href=#hl-25-358>358</a>
</span><span class=lnt id=hl-25-359><a class=lnlinks href=#hl-25-359>359</a>
</span><span class=lnt id=hl-25-360><a class=lnlinks href=#hl-25-360>360</a>
</span><span class=lnt id=hl-25-361><a class=lnlinks href=#hl-25-361>361</a>
</span><span class=lnt id=hl-25-362><a class=lnlinks href=#hl-25-362>362</a>
</span><span class=lnt id=hl-25-363><a class=lnlinks href=#hl-25-363>363</a>
</span><span class=lnt id=hl-25-364><a class=lnlinks href=#hl-25-364>364</a>
</span><span class=lnt id=hl-25-365><a class=lnlinks href=#hl-25-365>365</a>
</span><span class=lnt id=hl-25-366><a class=lnlinks href=#hl-25-366>366</a>
</span><span class=lnt id=hl-25-367><a class=lnlinks href=#hl-25-367>367</a>
</span><span class=lnt id=hl-25-368><a class=lnlinks href=#hl-25-368>368</a>
</span><span class=lnt id=hl-25-369><a class=lnlinks href=#hl-25-369>369</a>
</span><span class=lnt id=hl-25-370><a class=lnlinks href=#hl-25-370>370</a>
</span><span class=lnt id=hl-25-371><a class=lnlinks href=#hl-25-371>371</a>
</span><span class=lnt id=hl-25-372><a class=lnlinks href=#hl-25-372>372</a>
</span><span class=lnt id=hl-25-373><a class=lnlinks href=#hl-25-373>373</a>
</span><span class=lnt id=hl-25-374><a class=lnlinks href=#hl-25-374>374</a>
</span><span class=lnt id=hl-25-375><a class=lnlinks href=#hl-25-375>375</a>
</span><span class=lnt id=hl-25-376><a class=lnlinks href=#hl-25-376>376</a>
</span><span class=lnt id=hl-25-377><a class=lnlinks href=#hl-25-377>377</a>
</span><span class=lnt id=hl-25-378><a class=lnlinks href=#hl-25-378>378</a>
</span><span class=lnt id=hl-25-379><a class=lnlinks href=#hl-25-379>379</a>
</span><span class=lnt id=hl-25-380><a class=lnlinks href=#hl-25-380>380</a>
</span><span class=lnt id=hl-25-381><a class=lnlinks href=#hl-25-381>381</a>
</span><span class=lnt id=hl-25-382><a class=lnlinks href=#hl-25-382>382</a>
</span><span class=lnt id=hl-25-383><a class=lnlinks href=#hl-25-383>383</a>
</span><span class=lnt id=hl-25-384><a class=lnlinks href=#hl-25-384>384</a>
</span><span class=lnt id=hl-25-385><a class=lnlinks href=#hl-25-385>385</a>
</span><span class=lnt id=hl-25-386><a class=lnlinks href=#hl-25-386>386</a>
</span><span class=lnt id=hl-25-387><a class=lnlinks href=#hl-25-387>387</a>
</span><span class=lnt id=hl-25-388><a class=lnlinks href=#hl-25-388>388</a>
</span><span class=lnt id=hl-25-389><a class=lnlinks href=#hl-25-389>389</a>
</span><span class=lnt id=hl-25-390><a class=lnlinks href=#hl-25-390>390</a>
</span><span class=lnt id=hl-25-391><a class=lnlinks href=#hl-25-391>391</a>
</span><span class=lnt id=hl-25-392><a class=lnlinks href=#hl-25-392>392</a>
</span><span class=lnt id=hl-25-393><a class=lnlinks href=#hl-25-393>393</a>
</span><span class=lnt id=hl-25-394><a class=lnlinks href=#hl-25-394>394</a>
</span><span class=lnt id=hl-25-395><a class=lnlinks href=#hl-25-395>395</a>
</span><span class=lnt id=hl-25-396><a class=lnlinks href=#hl-25-396>396</a>
</span><span class=lnt id=hl-25-397><a class=lnlinks href=#hl-25-397>397</a>
</span><span class=lnt id=hl-25-398><a class=lnlinks href=#hl-25-398>398</a>
</span><span class=lnt id=hl-25-399><a class=lnlinks href=#hl-25-399>399</a>
</span><span class=lnt id=hl-25-400><a class=lnlinks href=#hl-25-400>400</a>
</span><span class=lnt id=hl-25-401><a class=lnlinks href=#hl-25-401>401</a>
</span><span class=lnt id=hl-25-402><a class=lnlinks href=#hl-25-402>402</a>
</span><span class=lnt id=hl-25-403><a class=lnlinks href=#hl-25-403>403</a>
</span><span class=lnt id=hl-25-404><a class=lnlinks href=#hl-25-404>404</a>
</span><span class=lnt id=hl-25-405><a class=lnlinks href=#hl-25-405>405</a>
</span><span class=lnt id=hl-25-406><a class=lnlinks href=#hl-25-406>406</a>
</span><span class=lnt id=hl-25-407><a class=lnlinks href=#hl-25-407>407</a>
</span><span class=lnt id=hl-25-408><a class=lnlinks href=#hl-25-408>408</a>
</span><span class=lnt id=hl-25-409><a class=lnlinks href=#hl-25-409>409</a>
</span><span class=lnt id=hl-25-410><a class=lnlinks href=#hl-25-410>410</a>
</span><span class=lnt id=hl-25-411><a class=lnlinks href=#hl-25-411>411</a>
</span><span class=lnt id=hl-25-412><a class=lnlinks href=#hl-25-412>412</a>
</span><span class=lnt id=hl-25-413><a class=lnlinks href=#hl-25-413>413</a>
</span><span class=lnt id=hl-25-414><a class=lnlinks href=#hl-25-414>414</a>
</span><span class=lnt id=hl-25-415><a class=lnlinks href=#hl-25-415>415</a>
</span><span class=lnt id=hl-25-416><a class=lnlinks href=#hl-25-416>416</a>
</span><span class=lnt id=hl-25-417><a class=lnlinks href=#hl-25-417>417</a>
</span><span class=lnt id=hl-25-418><a class=lnlinks href=#hl-25-418>418</a>
</span><span class=lnt id=hl-25-419><a class=lnlinks href=#hl-25-419>419</a>
</span><span class=lnt id=hl-25-420><a class=lnlinks href=#hl-25-420>420</a>
</span><span class=lnt id=hl-25-421><a class=lnlinks href=#hl-25-421>421</a>
</span><span class=lnt id=hl-25-422><a class=lnlinks href=#hl-25-422>422</a>
</span><span class=lnt id=hl-25-423><a class=lnlinks href=#hl-25-423>423</a>
</span><span class=lnt id=hl-25-424><a class=lnlinks href=#hl-25-424>424</a>
</span><span class=lnt id=hl-25-425><a class=lnlinks href=#hl-25-425>425</a>
</span><span class=lnt id=hl-25-426><a class=lnlinks href=#hl-25-426>426</a>
</span><span class=lnt id=hl-25-427><a class=lnlinks href=#hl-25-427>427</a>
</span><span class=lnt id=hl-25-428><a class=lnlinks href=#hl-25-428>428</a>
</span><span class=lnt id=hl-25-429><a class=lnlinks href=#hl-25-429>429</a>
</span><span class=lnt id=hl-25-430><a class=lnlinks href=#hl-25-430>430</a>
</span><span class=lnt id=hl-25-431><a class=lnlinks href=#hl-25-431>431</a>
</span><span class=lnt id=hl-25-432><a class=lnlinks href=#hl-25-432>432</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C#을 사용한 명령 및 이벤트 기반 아키텍처 예시</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Threading.Tasks</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.DependencyInjection</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.Hosting</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.Logging</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client.Events</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Newtonsoft.Json</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICommand</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>CommandType</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IEvent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>EventType</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>Guid</span><span class=p>?</span> <span class=n>CorrelationId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 핸들러 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICommandHandler</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>TCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Task</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>IEvent</span><span class=p>&gt;&gt;</span> <span class=n>HandleAsync</span><span class=p>(</span><span class=n>TCommand</span> <span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 핸들러 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IEventHandler</span><span class=p>&lt;</span><span class=n>TEvent</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>TEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Task</span> <span class=n>HandleAsync</span><span class=p>(</span><span class=n>TEvent</span> <span class=n>@event</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 버스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CommandBus</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IConnection</span> <span class=n>_connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandBus</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_exchangeName</span> <span class=p>=</span> <span class=s>&#34;commands&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CommandBus</span><span class=p>(</span><span class=n>IConnection</span> <span class=n>connection</span><span class=p>,</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandBus</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_connection</span> <span class=p>=</span> <span class=n>connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 교환기 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>_exchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Direct</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>SendAsync</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;(</span><span class=n>TCommand</span> <span class=n>command</span><span class=p>)</span> <span class=k>where</span> <span class=n>TCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>commandType</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>commandType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 직렬화</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>SerializeObject</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 속성 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>MessageId</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>Id</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Timestamp</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AmqpTimestamp</span><span class=p>(</span><span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>.</span><span class=n>ToUnixTimeSeconds</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Headers</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>object</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=s>&#34;command_type&#34;</span><span class=p>,</span> <span class=n>commandType</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;명령 전송됨: {commandType}, ID: {command.Id}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 버스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>EventBus</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IConnection</span> <span class=n>_connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>EventBus</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_exchangeName</span> <span class=p>=</span> <span class=s>&#34;events&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>EventBus</span><span class=p>(</span><span class=n>IConnection</span> <span class=n>connection</span><span class=p>,</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>EventBus</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_connection</span> <span class=p>=</span> <span class=n>connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 교환기 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>_exchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Topic</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>PublishAsync</span><span class=p>&lt;</span><span class=n>TEvent</span><span class=p>&gt;(</span><span class=n>TEvent</span> <span class=n>@event</span><span class=p>)</span> <span class=k>where</span> <span class=n>TEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>eventType</span> <span class=p>=</span> <span class=n>@event</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>eventType</span><span class=p>.</span><span class=n>Replace</span><span class=p>(</span><span class=s>&#34;Event&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>).</span><span class=n>ToLower</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;.happened&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 직렬화</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>SerializeObject</span><span class=p>(</span><span class=n>@event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 속성 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>MessageId</span> <span class=p>=</span> <span class=n>@event</span><span class=p>.</span><span class=n>Id</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>CorrelationId</span> <span class=p>=</span> <span class=n>@event</span><span class=p>.</span><span class=n>CorrelationId</span><span class=p>?.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Timestamp</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AmqpTimestamp</span><span class=p>(</span><span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>.</span><span class=n>ToUnixTimeSeconds</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Headers</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>object</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=s>&#34;event_type&#34;</span><span class=p>,</span> <span class=n>eventType</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;이벤트 발행됨: {eventType}, ID: {@event.Id}, 상관관계 ID: {@event.CorrelationId}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Subscribe</span><span class=p>&lt;</span><span class=n>TEvent</span><span class=p>&gt;(</span><span class=kt>string</span> <span class=n>queueName</span><span class=p>,</span> <span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>Task</span><span class=p>&gt;</span> <span class=n>callback</span><span class=p>)</span> <span class=k>where</span> <span class=n>TEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>eventType</span> <span class=p>=</span> <span class=k>typeof</span><span class=p>(</span><span class=n>TEvent</span><span class=p>).</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>eventType</span><span class=p>.</span><span class=n>Replace</span><span class=p>(</span><span class=s>&#34;Event&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>).</span><span class=n>ToLower</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;.happened&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐를 교환기에 바인딩</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 소비자 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AsyncEventingBasicConsumer</span><span class=p>(</span><span class=n>_channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=kd>async</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;이벤트 수신됨: {eventType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>callback</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicAck</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>_logger</span><span class=p>.</span><span class=n>LogError</span><span class=p>(</span><span class=n>ex</span><span class=p>,</span> <span class=s>$&#34;이벤트 처리 오류: {eventType}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicNack</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoAck</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;이벤트 구독 시작: {eventType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 프로세서</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CommandProcessor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IServiceProvider</span> <span class=n>_serviceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandProcessor</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>EventBus</span> <span class=n>_eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IConnection</span> <span class=n>_connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_exchangeName</span> <span class=p>=</span> <span class=s>&#34;commands&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CommandProcessor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>IServiceProvider</span> <span class=n>serviceProvider</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>IConnection</span> <span class=n>connection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>EventBus</span> <span class=n>eventBus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandProcessor</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_serviceProvider</span> <span class=p>=</span> <span class=n>serviceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_connection</span> <span class=p>=</span> <span class=n>connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_eventBus</span> <span class=p>=</span> <span class=n>eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 교환기 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>_exchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Direct</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RegisterHandler</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>,</span> <span class=n>THandler</span><span class=p>&gt;(</span><span class=kt>string</span> <span class=n>queueName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>TCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>THandler</span> <span class=p>:</span> <span class=n>ICommandHandler</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>commandType</span> <span class=p>=</span> <span class=k>typeof</span><span class=p>(</span><span class=n>TCommand</span><span class=p>).</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>commandType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐를 교환기에 바인딩</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 소비자 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AsyncEventingBasicConsumer</span><span class=p>(</span><span class=n>_channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=kd>async</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;명령 수신됨: {commandType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 명령 역직렬화</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>command</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>DeserializeObject</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 핸들러 인스턴스 생성</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=nn>var</span> <span class=n>scope</span> <span class=p>=</span> <span class=n>_serviceProvider</span><span class=p>.</span><span class=n>CreateScope</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>handler</span> <span class=p>=</span> <span class=n>scope</span><span class=p>.</span><span class=n>ServiceProvider</span><span class=p>.</span><span class=n>GetRequiredService</span><span class=p>&lt;</span><span class=n>THandler</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 명령 처리</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>events</span> <span class=p>=</span> <span class=k>await</span> <span class=n>handler</span><span class=p>.</span><span class=n>HandleAsync</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 발생한 이벤트 발행</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>events</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>@event</span> <span class=k>in</span> <span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>_eventBus</span><span class=p>.</span><span class=n>PublishAsync</span><span class=p>(</span><span class=n>@event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicAck</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>_logger</span><span class=p>.</span><span class=n>LogError</span><span class=p>(</span><span class=n>ex</span><span class=p>,</span> <span class=s>$&#34;명령 처리 오류: {commandType}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicNack</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoAck</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;명령 핸들러 등록됨: {commandType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 구체적인 명령 및 핸들러 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CreateOrderCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>CommandType</span> <span class=p>=&gt;</span> <span class=n>nameof</span><span class=p>(</span><span class=n>CreateOrderCommand</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>CustomerId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>OrderItem</span><span class=p>&gt;</span> <span class=n>Items</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>ShippingAddress</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderItem</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>ProductId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>Quantity</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>decimal</span> <span class=n>Price</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderCreatedEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>EventType</span> <span class=p>=&gt;</span> <span class=n>nameof</span><span class=p>(</span><span class=n>OrderCreatedEvent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span><span class=p>?</span> <span class=n>CorrelationId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>OrderId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>CustomerId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>decimal</span> <span class=n>TotalAmount</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>OrderStatus</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CreateOrderHandler</span> <span class=p>:</span> <span class=n>ICommandHandler</span><span class=p>&lt;</span><span class=n>CreateOrderCommand</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CreateOrderHandler</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 실제 구현에서는 DB 저장소 등 주입</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CreateOrderHandler</span><span class=p>(</span><span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CreateOrderHandler</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>IEvent</span><span class=p>&gt;&gt;</span> <span class=n>HandleAsync</span><span class=p>(</span><span class=n>CreateOrderCommand</span> <span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;주문 생성 처리 중: {command.Id}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 비즈니스 로직 수행</span>
</span></span><span class=line><span class=cl>        <span class=c1>// - 재고 확인</span>
</span></span><span class=line><span class=cl>        <span class=c1>// - 주문 유효성 검증</span>
</span></span><span class=line><span class=cl>        <span class=c1>// - DB에 주문 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>100</span><span class=p>);</span> <span class=c1>// DB 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 ID 생성</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>orderId</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 총액 계산</span>
</span></span><span class=line><span class=cl>        <span class=kt>decimal</span> <span class=n>totalAmount</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>item</span> <span class=k>in</span> <span class=n>command</span><span class=p>.</span><span class=n>Items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>totalAmount</span> <span class=p>+=</span> <span class=n>item</span><span class=p>.</span><span class=n>Price</span> <span class=p>*</span> <span class=n>item</span><span class=p>.</span><span class=n>Quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 이벤트 반환</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>orderCreatedEvent</span> <span class=p>=</span> <span class=k>new</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CorrelationId</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderId</span> <span class=p>=</span> <span class=n>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>CustomerId</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>TotalAmount</span> <span class=p>=</span> <span class=n>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span> <span class=p>=</span> <span class=s>&#34;Created&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>IEvent</span><span class=p>&gt;</span> <span class=p>{</span> <span class=n>orderCreatedEvent</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 애플리케이션 설정</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>host</span> <span class=p>=</span> <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>).</span><span class=n>Build</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 서비스 시작</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>host</span><span class=p>.</span><span class=n>RunAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IHostBuilder</span> <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>hostContext</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>factory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ConnectionFactory</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>HostName</span> <span class=p>=</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>UserName</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>Password</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>};</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>connection</span> <span class=p>=</span> <span class=n>factory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>(</span><span class=n>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>CommandBus</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>EventBus</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>CommandProcessor</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 명령 핸들러 등록</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>CreateOrderHandler</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 백그라운드 서비스 등록</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddHostedService</span><span class=p>&lt;</span><span class=n>OrderProcessingService</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 백그라운드 서비스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderProcessingService</span> <span class=p>:</span> <span class=n>BackgroundService</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>OrderProcessingService</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>CommandProcessor</span> <span class=n>_commandProcessor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>EventBus</span> <span class=n>_eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>OrderProcessingService</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>OrderProcessingService</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>CommandProcessor</span> <span class=n>commandProcessor</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>EventBus</span> <span class=n>eventBus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_commandProcessor</span> <span class=p>=</span> <span class=n>commandProcessor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_eventBus</span> <span class=p>=</span> <span class=n>eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kd>override</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>ExecuteAsync</span><span class=p>(</span><span class=n>CancellationToken</span> <span class=n>stoppingToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>&#34;주문 처리 서비스 시작&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 핸들러 등록</span>
</span></span><span class=line><span class=cl>        <span class=n>_commandProcessor</span><span class=p>.</span><span class=n>RegisterHandler</span><span class=p>&lt;</span><span class=n>CreateOrderCommand</span><span class=p>,</span> <span class=n>CreateOrderHandler</span><span class=p>&gt;(</span><span class=s>&#34;create-order-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=n>_eventBus</span><span class=p>.</span><span class=n>Subscribe</span><span class=p>&lt;</span><span class=n>OrderCreatedEvent</span><span class=p>&gt;(</span><span class=s>&#34;order-notification-queue&#34;</span><span class=p>,</span> <span class=kd>async</span> <span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>@event</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>DeserializeObject</span><span class=p>&lt;</span><span class=n>OrderCreatedEvent</span><span class=p>&gt;(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;주문 생성 이벤트 처리: {@event.OrderId}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 알림 발송 등의 로직 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;주문 알림 발송 완료: {@event.OrderId}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 서비스 종료까지 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=n>Timeout</span><span class=p>.</span><span class=n>Infinite</span><span class=p>,</span> <span class=n>stoppingToken</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-설계-및-구현-지침>메시징 큐 설계 및 구현 지침<a hidden class=anchor aria-hidden=true href=#메시징-큐-설계-및-구현-지침>#</a></h3><p>효율적이고 안정적인 메시징 시스템을 구축하기 위한 주요 설계 및 구현 지침</p><ol><li>메시지 설계 원칙<br>메시지는 시스템 간의 통신 단위이므로 명확하고 일관된 설계가 중요하다.<ol><li><strong>자기 완결성(Self-contained)</strong>: 메시지는 필요한 모든 정보를 포함해야 한다.</li><li><strong>스키마 버전 관리</strong>: 메시지 구조 변경에 대비한 버전 관리 전략이 필요하다.</li><li><strong>적절한 크기</strong>: 너무 크거나 작은 메시지는 성능에 영향을 미친다.</li><li><strong>표준화된 형식</strong>: JSON, Avro, Protocol Buffers 등 표준 형식을 사용한다.</li><li><strong>메타데이터 포함</strong>: 메시지 ID, 타임스탬프, 추적 정보 등을 포함한다.</li></ol></li><li>큐 구조 설계<br>큐의 구조와 관계는 메시징 시스템의 성능과 확장성에 직접적인 영향을 미친다.<ol><li><strong>목적별 큐 분리</strong>: 각 비즈니스 기능이나 처리 유형에 따라, 그리고 중요도나 우선순위에 따라 큐를 분리한다.</li><li><strong>큐 크기 제한</strong>: 무제한 큐는 메모리 문제를 일으킬 수 있으므로 적절한 제한이 필요하다.</li><li><strong>데드 레터 큐 구성</strong>: 처리 실패한 메시지를 저장하고 분석할 수 있는 별도의 큐를 마련한다.</li><li><strong>지연 큐 활용</strong>: 특정 시간 후에 처리해야 하는 메시지를 위한 지연 큐를 구성한다.</li><li><strong>우선순위 큐 고려</strong>: 중요도에 따라 메시지 처리 순서를 조정할 수 있는 우선순위 큐를 활용한다.</li></ol></li><li>오류 처리 및 복원력 전략<br>장애 상황에서도 데이터 손실 없이 안정적으로 작동하는 메시징 시스템을 구축하기 위한 전략이다.<ol><li><strong>자동 재시도</strong>: 일시적인 오류에 대응하기 위한 자동 재시도 메커니즘을 구현한다.</li><li><strong>지수 백오프(Exponential Backoff)</strong>: 반복적인 실패 시 재시도 간격을 점진적으로 늘린다.</li><li><strong>서킷 브레이커 패턴</strong>: 다운스트림 서비스 장애 시 요청을 차단하여 시스템을 보호한다.</li><li><strong>멱등성 보장</strong>: 중복 메시지 처리가 안전하도록 멱등성을 구현한다.</li><li><strong>부분 실패 처리</strong>: 배치 처리 시 일부 실패에 대한 대응 전략을 마련한다.</li></ol></li><li>확장성 고려사항<br>증가하는 부하에 대응할 수 있는 확장 가능한 메시징 시스템을 설계하기 위한 고려사항이다.<ol><li><strong>수평적 확장</strong>: 소비자 그룹을 통해 처리량을 향상시킨다.</li><li><strong>메시지 파티셔닝</strong>: 관련 메시지가 동일한 소비자에게 전달되도록 파티셔닝한다.</li><li><strong>비동기 처리</strong>: 소비자의 처리 시간이 생산자에게 영향을 미치지 않도록 한다.</li><li><strong>부하 분산</strong>: 여러 브로커와 큐에 부하를 분산시킨다.</li><li><strong>클러스터링</strong>: 고가용성을 위한 브로커 클러스터를 구성한다.</li></ol></li><li>모니터링 및 운영 최적화<br>효과적인 운영을 위한 모니터링 및 관리 전략이다.<ol><li><strong>주요 지표 추적</strong>: 큐 깊이, 처리율, 오류율 등의 핵심 지표를 모니터링한다.</li><li><strong>경보 설정</strong>: 문제 상황에 대한 조기 경보 시스템을 구축한다.</li><li><strong>로깅 전략</strong>: 디버깅과 분석을 위한 효과적인 로깅을 구현한다.</li><li><strong>성능 최적화</strong>: 배치 처리, 메시지 압축, 소비자 수 조정 등을 통해 성능을 최적화한다.</li><li><strong>자동화된 운영</strong>: 자동 확장, 자가 복구 등의 자동화 기능을 구현한다.</li></ol></li></ol><h3 id=메시징-큐-도입-시-고려사항>메시징 큐 도입 시 고려사항<a hidden class=anchor aria-hidden=true href=#메시징-큐-도입-시-고려사항>#</a></h3><p>메시징 큐 도입을 고려할 때 평가해야 할 주요 사항과 권장 사항이다.</p><ol><li>적합성 평가<br>모든 상황에 메시징 큐가 최적의 솔루션은 아니다. 다음 상황에서 메시징 큐 도입을 고려해야 한다.<ol><li><strong>비동기 처리가 필요한 경우</strong>: 즉각적인 응답이 불필요한 작업</li><li><strong>부하 분산이 필요한 경우</strong>: 트래픽 스파이크 처리</li><li><strong>시스템 간 느슨한 결합이 필요한 경우</strong>: 독립적인 서비스 운영</li><li><strong>내구성 있는 통신이 필요한 경우</strong>: 메시지 손실 방지</li><li><strong>처리 속도 차이가 있는 경우</strong>: 생산자와 소비자 간 속도 불일치</li></ol></li><li>기술 선택 기준<br>메시징 솔루션 선택 시 고려해야 할 주요 기준이다.<ol><li><strong>처리량 요구사항</strong>: 초당 처리해야 하는 메시지 수</li><li><strong>지연 시간 요구사항</strong>: 허용 가능한 메시지 전달 및 처리 지연</li><li><strong>내구성 요구사항</strong>: 메시지 손실 허용 정도</li><li><strong>전달 보장</strong>: At-most-once, At-least-once, Exactly-once 중 필요한 수준</li><li><strong>확장성 요구사항</strong>: 향후 예상되는 성장과 확장 니즈</li><li><strong>운영 복잡성</strong>: 관리 및 모니터링의 용이성</li><li><strong>비용 및 리소스</strong>: 라이선스, 인프라, 유지보수 비용</li></ol></li><li>구현 및 통합 권장사항<br>효과적인 메시징 큐 구현 및 통합을 위한 실용적인 권장사항이다.<ol><li><strong>점진적 도입</strong>: 모든 시스템을 한 번에 전환하기보다 중요도가 낮은 기능부터 점진적으로 메시징 큐를 적용한다.</li><li><strong>비동기 처리 패턴 채택</strong>: 동기식 요청-응답에서 비동기 이벤트 기반 패턴으로 전환한다.</li><li><strong>오류 처리 우선화</strong>: 구현 초기 단계부터 견고한 오류 처리를 설계한다.</li><li><strong>로컬 개발 환경 구성</strong>: 개발자가 로컬에서 메시징 시스템을 테스트할 수 있도록 환경을 구성한다.</li><li><strong>자동화된 테스트</strong>: 메시지 생산, 소비, 오류 처리를 포함한 자동화된 테스트를 구현한다.</li><li><strong>문서화 및 표준화</strong>: 메시지 형식, 큐 명명 규칙, 오류 처리 절차 등을 명확하게 문서화한다.</li><li><strong>모니터링 인프라 구축</strong>: 메시징 시스템 도입과 함께 모니터링 인프라를 구축한다.</li></ol></li></ol><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>RabbitMQ</h2></header><div class=entry-content><p>RabbitMQ RabbitMQ는 Erlang 언어로 작성된 오픈 소스 메시지 브로커 시스템으로, AMQP(Advanced Message Queuing Protocol)를 구현하고 있다. 2007년에 처음 출시되었으며, 현재는 VMware의 자회사인 Pivotal Software에서 관리하고 있다. RabbitMQ는 안정성, 확장성, 다양한 메시징 패턴 지원 등으로 인해 많은 기업들이 메시지 기반 아키텍처의 핵심 컴포넌트로 채택하고 있다.
주요 특징 표준 프로토콜 지원: AMQP 0-9-1을 기본으로 하며, STOMP, MQTT, HTTP 등 다양한 프로토콜을 플러그인을 통해 지원한다. 유연한 라우팅: Exchange와 바인딩을 통한 강력하고 유연한 메시지 라우팅 기능을 제공한다. 클러스터링: 높은 가용성과 처리량을 위한 내장 클러스터링 기능을 제공한다. 관리 인터페이스: 직관적인 웹 기반 관리 UI와 HTTP API를 제공한다. 플러그인 아키텍처: 기능을 확장할 수 있는 다양한 플러그인을 지원한다. 다양한 언어 지원: Java, Python, Ruby, PHP, C#, JavaScript 등 다양한 언어의 클라이언트 라이브러리를 제공한다. RabbitMQ의 주요 사용 사례 비동기 처리: 시간이 오래 걸리는 작업을 비동기적으로 처리할 수 있다. 서비스 간 통신: 마이크로서비스 아키텍처에서 서비스 간 통신 채널로 활용된다. 부하 분산: 작업을 여러 워커에게 분산시켜 시스템의 부하를 균등하게 분배한다. 이벤트 기반 아키텍처: 이벤트를 생성하고 소비하는 이벤트 기반 시스템의 기반이 된다. 데이터 스트리밍: 실시간 데이터 스트림을 처리하는 데 사용된다. RabbitMQ의 핵심 개념 AMQP 프로토콜
AMQP(Advanced Message Queuing Protocol)는 메시지 지향 미들웨어를 위한 개방형 표준 프로토콜이다. AMQP의 주요 개념을 이해하는 것은 RabbitMQ를 효과적으로 사용하기 위한 기본이다.
...</p></div><footer class=entry-footer><span title='2024-10-25 00:54:00 +0000 UTC'>October 25, 2024</span>&nbsp;·&nbsp;18 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to RabbitMQ" href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/integration/messaging-systems/implementations/message-queues/rabbitmq/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>