<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mutex | hyunyoun's Blog</title>
<meta name=keywords content="Computer-System,Operating-System,Synchronization-and-Concurrency-Control,Process-Synchronization,Mutex"><meta name=description content="Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/mutex/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/mutex/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/mutex/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Mutex"><meta property="og:description" content="Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-03T11:00:00+00:00"><meta property="article:modified_time" content="2024-10-03T11:00:00+00:00"><meta property="article:tag" content="Computer-System"><meta property="article:tag" content="Operating-System"><meta property="article:tag" content="Synchronization-and-Concurrency-Control"><meta property="article:tag" content="Process-Synchronization"><meta property="article:tag" content="Mutex"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Mutex"><meta name=twitter:description content="Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 블로그","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"컴퓨터 과학","item":"https://buenhyden.github.io/posts/computer-science/"},{"@type":"ListItem","position":3,"name":"Operating System","item":"https://buenhyden.github.io/posts/computer-science/operating-systems/"},{"@type":"ListItem","position":5,"name":"Concurrency and Parallelism","item":"https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/"},{"@type":"ListItem","position":6,"name":"임계 영역 (Critical Section)","item":"https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/"},{"@type":"ListItem","position":7,"name":"상호 배제 (Mutual Exclusion)","item":"https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/"},{"@type":"ListItem","position":8,"name":"Syncronization Algorithms","item":"https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/"},{"@type":"ListItem","position":9,"name":"Mutex","item":"https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/mutex/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Mutex","name":"Mutex","description":"Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체.","keywords":["Computer-System","Operating-System","Synchronization-and-Concurrency-Control","Process-Synchronization","Mutex"],"articleBody":"Mutex Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체.\n한 번에 하나의 스레드만이 Mutex를 소유할 수 있으며, 소유권 개념이 있어 Mutex를 획득한 스레드만이 이를 해제할 수 있다.\nSource: https://www.geeksforgeeks.org/std-mutex-in-cpp/\n주요 특징 두 가지 상태(잠김/열림)를 가집니다. 한 번에 하나의 스레드만 소유할 수 있습니다. 소유한 스레드만이 잠금을 해제할 수 있습니다. Mutex의 종류 일반 Mutex (Normal Mutex) 가장 기본적인 형태의 Mutex.\n단순한 상호 배제 기능을 제공하며, 재진입이 불가능하다.\n가장 빠른 성능을 제공하지만 우선순위 상속과 같은 고급 기능은 지원하지 않는다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import threading class BankAccount: def __init__(self): self.balance = 1000 self.mutex = threading.RLock() # Python에서는 RLock을 사용하여 Mutex 구현 def transfer(self, amount, target_account): # Mutex를 획득한 스레드만이 해제할 수 있음 self.mutex.acquire() try: if self.balance \u003e= amount: self.balance -= amount target_account.deposit(amount) print(f\"Transferred {amount}\") else: print(\"Insufficient funds\") finally: # 반드시 같은 스레드에서 해제해야 함 self.mutex.release() 재진입 가능한 Mutex (Recursive Mutex) 같은 스레드가 여러 번 획득할 수 있는 Mutex.\n내부적으로 잠금 횟수를 카운트하며, 모든 잠금이 해제되어야 완전히 해제된다.\n주로 재귀적 알고리즘이나 중첩된 함수 호출에서 사용된다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class RecursiveCounter: def __init__(self): self.count = 0 self.recursive_mutex = threading.RLock() def increment(self, level=0): # 같은 스레드가 여러 번 획득 가능 with self.recursive_mutex: self.count += 1 print(f\"Level {level}: {self.count}\") if level \u003c 3: # 재귀적 호출 self.increment(level + 1) # 사용 예시 counter = RecursiveCounter() counter.increment() # 한 스레드가 여러 번 Mutex 획득 오류 검사 Mutex (Error Checking Mutex) 추가적인 오류 검사 기능을 제공하는 Mutex.\n잠금 해제되지 않은 Mutex의 재잠금, 다른 스레드가 소유한 Mutex의 해제 시도 등을 감지하고 에러를 발생시킨다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class ErrorCheckingMutex: def __init__(self): self.mutex = threading.RLock() self.owner = None def acquire(self): if self.owner == threading.current_thread(): raise RuntimeError(\"Mutex already owned by current thread\") self.mutex.acquire() self.owner = threading.current_thread() def release(self): if self.owner != threading.current_thread(): raise RuntimeError(\"Mutex can only be released by owner thread\") self.owner = None self.mutex.release() 우선순위 상속 Mutex (Priority Inheritance Mutex) 우선순위 역전 문제를 해결하기 위한 Mutex.\n우선순위가 높은 태스크가 대기 중일 때 현재 Mutex를 소유한 태스크의 우선순위를 일시적으로 높인다.\n실시간 시스템에서 중요하다.\n구현이 복잡하고 오버헤드가 크다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 class PriorityTask: def __init__(self, priority): self.priority = priority self.mutex = threading.RLock() self.original_priority = priority def execute(self): with self.mutex: # 현재 스레드의 우선순위를 상속받음 current_priority = max(self.priority, threading.current_thread().priority) try: threading.current_thread().priority = current_priority # 작업 수행 print(f\"Executing with priority {current_priority}\") finally: # 원래 우선순위로 복구 threading.current_thread().priority = self.original_priority 시간 제한 Mutex (Timed Mutex) 지정된 시간 동안만 잠금을 시도하는 mutex.\n지정된 시간 내에 잠금을 획득하지 못하면 실패를 반환한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 import threading import time from datetime import datetime, timedelta from typing import Optional class TimedMutex: def __init__(self): # 기본적인 내부 잠금 메커니즘 self._lock = threading.Lock() # 현재 잠금을 소유한 스레드의 ID self._owner: Optional[int] = None # 잠금이 획득된 시간 self._acquire_time: Optional[datetime] = None # 잠금 상태를 추적하는 플래그 self._locked = False def acquire(self, timeout: float = None) -\u003e bool: \"\"\" 주어진 타임아웃 시간 내에 뮤텍스 잠금을 획득하려고 시도합니다. Args: timeout (float): 최대 대기 시간(초). None이면 무한정 대기 Returns: bool: 잠금 획득 성공 여부 \"\"\" start_time = datetime.now() while True: # 타임아웃 체크 if timeout is not None: if (datetime.now() - start_time).total_seconds() \u003e timeout: return False # 잠금 획득 시도 if self._try_acquire(): return True # 짧은 대기 후 재시도 time.sleep(0.001) def _try_acquire(self) -\u003e bool: \"\"\" 논블로킹 방식으로 잠금 획득을 시도합니다. \"\"\" if self._lock.acquire(False): # 비차단 모드로 시도 self._owner = threading.get_ident() self._acquire_time = datetime.now() self._locked = True return True return False def release(self): \"\"\" 뮤텍스 잠금을 해제합니다. 잘못된 스레드가 해제를 시도하면 예외가 발생합니다. \"\"\" if not self._locked: raise RuntimeError(\"잠금이 해제된 뮤텍스입니다\") if self._owner != threading.get_ident(): raise RuntimeError(\"다른 스레드가 소유한 뮤텍스입니다\") self._owner = None self._acquire_time = None self._locked = False self._lock.release() def locked(self) -\u003e bool: \"\"\"현재 잠금 상태를 반환합니다.\"\"\" return self._locked def hold_time(self) -\u003e Optional[float]: \"\"\" 현재 잠금이 유지된 시간(초)을 반환합니다. 잠금이 해제된 상태면 None을 반환합니다. \"\"\" if not self._locked or self._acquire_time is None: return None return (datetime.now() - self._acquire_time).total_seconds() # 사용 예시를 위한 공유 리소스 클래스 class SharedResource: def __init__(self): self.value = 0 self.mutex = TimedMutex() def update_value(self, new_value: int, timeout: float = 1.0) -\u003e bool: \"\"\" 타임아웃을 사용하여 값을 안전하게 업데이트합니다. Returns: bool: 업데이트 성공 여부 \"\"\" if not self.mutex.acquire(timeout): print(f\"스레드 {threading.get_ident()}: 타임아웃 발생\") return False try: print(f\"스레드 {threading.get_ident()}: 값 업데이트 중…\") time.sleep(0.5) # 작업 시뮬레이션 self.value = new_value return True finally: self.mutex.release() def worker(resource: SharedResource, sleep_time: float): \"\"\"작업자 스레드 함수\"\"\" thread_id = threading.get_ident() time.sleep(sleep_time) # 의도적인 지연 success = resource.update_value(thread_id, timeout=1.0) if success: print(f\"스레드 {thread_id}: 값 업데이트 성공 (새 값: {resource.value})\") else: print(f\"스레드 {thread_id}: 값 업데이트 실패\") def main(): # 공유 리소스 생성 resource = SharedResource() # 여러 스레드 생성 및 실행 threads = [] for i in range(3): # 각 스레드에 다른 시작 지연 시간을 줌 thread = threading.Thread( target=worker, args=(resource, i * 0.2) ) threads.append(thread) thread.start() # 모든 스레드 완료 대기 for thread in threads: thread.join() print(f\"최종 값: {resource.value}\") if __name__ == \"__main__\": main() 구현 내용 타임아웃 메커니즘: acquire 메서드는 지정된 시간 동안만 잠금 획득을 시도한다. 시간 초과 시 False를 반환하여 호출자가 적절히 대응할 수 있게 한다. 무한 대기를 방지하여 데드락 상황을 피할 수 있습니다. 안전성 기능: 소유자 스레드 추적으로 잘못된 해제를 방지한다. 잠금 시간 추적으로 디버깅과 모니터링이 가능하다. try-finally 구문으로 안전한 잠금 해제를 보장한다. 모니터링 기능: locked() 메서드로 현재 잠금 상태를 확인할 수 있다. hold_time() 메서드로 잠금 유지 시간을 확인할 수 있다. 상세한 로깅으로 문제 진단이 용이하다. 사용자 친화적 인터페이스: 간단하고 직관적인 API를 제공한다. 예외 처리를 통한 명확한 에러 메시지를 제공한다. 타입 힌팅으로 코드의 가독성을 높임. 적응형 Mutex (Adaptive Mutex) 시스템 부하에 따라 동작 방식을 자동으로 조절하는 Mutex.\n짧은 대기 시간에는 스핀락처럼 동작하고, 긴 대기 시간에는 일반 mutex처럼 동작한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 import threading import time from queue import Queue import random class AdaptiveMutex: def __init__(self, spin_count_threshold=1000): # 기본적인 잠금 메커니즘 self._lock = threading.Lock() # 스핀락 카운트를 위한 임계값 self.spin_count_threshold = spin_count_threshold # 대기 중인 스레드 수를 추적 self._waiting_threads = 0 # 경합 수준을 모니터링 self._contention_level = 0 # 대기 큐 self._wait_queue = Queue() # 현재 소유자 스레드 ID self._owner = None def acquire(self): thread_id = threading.get_ident() # 먼저 스핀락 시도 spin_count = 0 while spin_count \u003c self.spin_count_threshold: if self._try_acquire(thread_id): return True spin_count += 1 # 짧은 대기 시간 추가 time.sleep(0.000001) # 1 마이크로초 # 스핀락이 실패하면 일반 잠금으로 전환 self._waiting_threads += 1 try: # 일반 잠금 획득 시도 while True: if self._try_acquire(thread_id): return True # 경합 수준 증가 및 적응형 대기 self._contention_level += 1 self._adaptive_wait() finally: self._waiting_threads -= 1 def _try_acquire(self, thread_id): \"\"\"잠금 획득 시도\"\"\" if self._owner is None: if self._lock.acquire(False): # 비차단 시도 self._owner = thread_id return True return False def _adaptive_wait(self): \"\"\"경합 수준에 따른 적응형 대기\"\"\" if self._contention_level \u003c 5: # 낮은 경합: 짧은 대기 time.sleep(0.000001) # 1 마이크로초 elif self._contention_level \u003c 10: # 중간 경합: 중간 대기 time.sleep(0.0001) # 100 마이크로초 else: # 높은 경합: 긴 대기 time.sleep(0.001) # 1 밀리초 def release(self): \"\"\"잠금 해제\"\"\" if self._owner == threading.get_ident(): self._owner = None self._lock.release() self._contention_level = max(0, self._contention_level - 1) else: raise RuntimeError(\"잘못된 스레드가 잠금 해제를 시도했습니다\") # 사용 예시 def shared_resource_access(adaptive_mutex, thread_id, shared_data): \"\"\"공유 리소스에 접근하는 함수\"\"\" for _ in range(5): adaptive_mutex.acquire() try: # 임계 영역 시작 print(f\"스레드 {thread_id}가 공유 리소스에 접근 중…\") shared_data['value'] += 1 # 임의의 작업 시간 시뮬레이션 time.sleep(random.uniform(0.001, 0.005)) print(f\"스레드 {thread_id}가 공유 리소스 접근 완료. 현재 값: {shared_data['value']}\") # 임계 영역 종료 finally: adaptive_mutex.release() def main(): # 적응형 뮤텍스 인스턴스 생성 adaptive_mutex = AdaptiveMutex() # 공유 데이터 shared_data = {'value': 0} # 여러 스레드 생성 및 실행 threads = [] for i in range(5): thread = threading.Thread( target=shared_resource_access, args=(adaptive_mutex, i, shared_data) ) threads.append(thread) thread.start() # 모든 스레드가 완료될 때까지 대기 for thread in threads: thread.join() print(f\"최종 값: {shared_data['value']}\") if __name__ == \"__main__\": main() 구현 내용 적응형 메커니즘: 처음에는 스핀락 방식으로 시도하여 빠른 응답을 추구한다. 경합이 심해지면 일반 잠금 방식으로 전환하여 CPU 사용을 줄인다. 경합 수준에 따라 대기 시간을 동적으로 조절한다. 성능 최적화: 스핀락 임계값을 설정하여 초기 응답성을 조절할 수 있다. 경합 수준에 따라 세 가지 다른 대기 시간을 사용한다. 대기 중인 스레드 수를 추적하여 시스템 부하를 모니터링한다. 안전성 기능: 소유자 스레드 확인을 통한 잘못된 해제 방지 예외 발생 시에도 안전한 잠금 해제를 보장하는 try-finally 구조 스레드 ID 추적을 통한 소유권 관리 모니터링 및 디버깅: 대기 중인 스레드 수 추적 경합 수준 모니터링 상세한 로깅과 에러 메시지 Mutex 사용 시 주의사항 교착상태 방지 1 2 3 4 5 6 7 8 9 10 class DeadlockAvoidance: def __init__(self): self.mutex1 = threading.RLock() self.mutex2 = threading.RLock() def safe_operation(self): # Mutex 획득 순서를 항상 동일하게 유지 with self.mutex1: with self.mutex2: print(\"Safe operation\") RAII 패턴 사용 RAII(Resource Acuquisition Is Intialization) 는 C++에서 강조되는 디자인 테크닉 중 하나.\n“자원 획득(Resource Acquisition)은 초기화(Initialization)이다\n자원의 획득과 해제를 객체(객체의 포인터객체)의 수명과 연결 → 자동으로 효율적으로 자원(메모리, 파일 등)관리, 메모리 누수를 해결 1 2 3 4 5 6 7 8 9 10 class RAIIMutex: def __init__(self, mutex): self.mutex = mutex def __enter__(self): self.mutex.acquire() return self def __exit__(self, type, value, traceback): self.mutex.release() 최소한의 임계 영역 1 2 3 4 5 6 7 8 9 10 11 12 class OptimizedResource: def __init__(self): self.mutex = threading.RLock() self.data = [] def process_data(self, item): # Mutex가 필요없는 연산은 밖에서 수행 processed = self.heavy_computation(item) # 실제로 공유 자원에 접근할 때만 Mutex 사용 with self.mutex: self.data.append(processed) 참고 및 출처 ","wordCount":"1782","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-10-03T11:00:00Z","dateModified":"2024-10-03T11:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/mutex/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기술 블로그</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science/>컴퓨터 과학</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science/operating-systems/>Operating System</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/>Concurrency and Parallelism</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/>임계 영역 (Critical Section)</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/>상호 배제 (Mutual Exclusion)</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/>Syncronization Algorithms</a></div><h1 class="post-title entry-hint-parent">Mutex</h1><div class=post-description>Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체.</div><div class=post-meta><span title='2024-10-03 11:00:00 +0000 UTC'>October 3, 2024</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Computer%20Science/Operating%20systems/Process%20Management/Concurrency%20and%20Parallelism/Critical%20Section/Mutual%20Exclusion/Methods/Mutex.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#mutex>Mutex</a><ul><li><a href=#주요-특징>주요 특징</a></li><li><a href=#mutex의-종류>Mutex의 종류</a></li><li><a href=#mutex-사용-시-주의사항>Mutex 사용 시 주의사항</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=mutex>Mutex<a hidden class=anchor aria-hidden=true href=#mutex>#</a></h2><p>Mutex(Mutual Exclusion)는 공유 자원에 대한 접근을 동기화하는 객체.<br>한 번에 하나의 스레드만이 Mutex를 소유할 수 있으며, 소유권 개념이 있어 Mutex를 획득한 스레드만이 이를 해제할 수 있다.</p><p><figure><img alt=Mutex loading=lazy src=/img/mutex-locks.webp><figcaption>Source: https://www.geeksforgeeks.org/std-mutex-in-cpp/</figcaption></figure></p><h3 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h3><ol><li>두 가지 상태(잠김/열림)를 가집니다.</li><li>한 번에 하나의 스레드만 소유할 수 있습니다.</li><li>소유한 스레드만이 잠금을 해제할 수 있습니다.</li></ol><h3 id=mutex의-종류>Mutex의 종류<a hidden class=anchor aria-hidden=true href=#mutex의-종류>#</a></h3><h4 id=일반-mutex-normal-mutex>일반 Mutex (Normal Mutex)<a hidden class=anchor aria-hidden=true href=#일반-mutex-normal-mutex>#</a></h4><p>가장 기본적인 형태의 Mutex.<br>단순한 상호 배제 기능을 제공하며, 재진입이 불가능하다.<br>가장 빠른 성능을 제공하지만 우선순위 상속과 같은 고급 기능은 지원하지 않는다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankAccount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>  <span class=c1># Python에서는 RLock을 사용하여 Mutex 구현</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transfer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>target_account</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Mutex를 획득한 스레드만이 해제할 수 있음</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>&gt;=</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>                <span class=n>target_account</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Transferred </span><span class=si>{</span><span class=n>amount</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Insufficient funds&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 반드시 같은 스레드에서 해제해야 함</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=재진입-가능한-mutex-recursive-mutex>재진입 가능한 Mutex (Recursive Mutex)<a hidden class=anchor aria-hidden=true href=#재진입-가능한-mutex-recursive-mutex>#</a></h4><p>같은 스레드가 여러 번 획득할 수 있는 Mutex.<br>내부적으로 잠금 횟수를 카운트하며, 모든 잠금이 해제되어야 완전히 해제된다.<br>주로 재귀적 알고리즘이나 중첩된 함수 호출에서 사용된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecursiveCounter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recursive_mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>increment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 같은 스레드가 여러 번 획득 가능</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>recursive_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Level </span><span class=si>{</span><span class=n>level</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>count</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>level</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>:</span>  <span class=c1># 재귀적 호출</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>increment</span><span class=p>(</span><span class=n>level</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>counter</span> <span class=o>=</span> <span class=n>RecursiveCounter</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>counter</span><span class=o>.</span><span class=n>increment</span><span class=p>()</span>  <span class=c1># 한 스레드가 여러 번 Mutex 획득</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=오류-검사-mutex-error-checking-mutex>오류 검사 Mutex (Error Checking Mutex)<a hidden class=anchor aria-hidden=true href=#오류-검사-mutex-error-checking-mutex>#</a></h4><p>추가적인 오류 검사 기능을 제공하는 Mutex.<br>잠금 해제되지 않은 Mutex의 재잠금, 다른 스레드가 소유한 Mutex의 해제 시도 등을 감지하고 에러를 발생시킨다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>ErrorCheckingMutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>==</span> <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&#34;Mutex already owned by current thread&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>!=</span> <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&#34;Mutex can only be released by owner thread&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>owner</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=우선순위-상속-mutex-priority-inheritance-mutex>우선순위 상속 Mutex (Priority Inheritance Mutex)<a hidden class=anchor aria-hidden=true href=#우선순위-상속-mutex-priority-inheritance-mutex>#</a></h4><p>우선순위 역전 문제를 해결하기 위한 Mutex.<br>우선순위가 높은 태스크가 대기 중일 때 현재 Mutex를 소유한 태스크의 우선순위를 일시적으로 높인다.<br>실시간 시스템에서 중요하다.<br>구현이 복잡하고 오버헤드가 크다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>PriorityTask</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>priority</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>priority</span> <span class=o>=</span> <span class=n>priority</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>original_priority</span> <span class=o>=</span> <span class=n>priority</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 현재 스레드의 우선순위를 상속받음</span>
</span></span><span class=line><span class=cl>            <span class=n>current_priority</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>priority</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>priority</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>priority</span> <span class=o>=</span> <span class=n>current_priority</span>
</span></span><span class=line><span class=cl>                <span class=c1># 작업 수행</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Executing with priority </span><span class=si>{</span><span class=n>current_priority</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 원래 우선순위로 복구</span>
</span></span><span class=line><span class=cl>                <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>priority</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_priority</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=시간-제한-mutex-timed-mutex>시간 제한 Mutex (Timed Mutex)<a hidden class=anchor aria-hidden=true href=#시간-제한-mutex-timed-mutex>#</a></h4><p>지정된 시간 동안만 잠금을 시도하는 mutex.<br>지정된 시간 내에 잠금을 획득하지 못하면 실패를 반환한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>  1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>  2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>  3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>  4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>  5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>  6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>  7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>  8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9>  9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10> 10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11> 11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12> 12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13> 13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14> 14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15> 15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16> 16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17> 17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18> 18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19> 19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20> 20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21> 21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22> 22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23> 23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24> 24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25> 25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26> 26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27> 27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28> 28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29> 29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30> 30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31> 31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32> 32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33> 33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34> 34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35> 35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36> 36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37> 37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38> 38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39> 39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40> 40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41> 41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42> 42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43> 43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44> 44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45> 45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46> 46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47> 47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48> 48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49> 49</a>
</span><span class=lnt id=hl-4-50><a class=lnlinks href=#hl-4-50> 50</a>
</span><span class=lnt id=hl-4-51><a class=lnlinks href=#hl-4-51> 51</a>
</span><span class=lnt id=hl-4-52><a class=lnlinks href=#hl-4-52> 52</a>
</span><span class=lnt id=hl-4-53><a class=lnlinks href=#hl-4-53> 53</a>
</span><span class=lnt id=hl-4-54><a class=lnlinks href=#hl-4-54> 54</a>
</span><span class=lnt id=hl-4-55><a class=lnlinks href=#hl-4-55> 55</a>
</span><span class=lnt id=hl-4-56><a class=lnlinks href=#hl-4-56> 56</a>
</span><span class=lnt id=hl-4-57><a class=lnlinks href=#hl-4-57> 57</a>
</span><span class=lnt id=hl-4-58><a class=lnlinks href=#hl-4-58> 58</a>
</span><span class=lnt id=hl-4-59><a class=lnlinks href=#hl-4-59> 59</a>
</span><span class=lnt id=hl-4-60><a class=lnlinks href=#hl-4-60> 60</a>
</span><span class=lnt id=hl-4-61><a class=lnlinks href=#hl-4-61> 61</a>
</span><span class=lnt id=hl-4-62><a class=lnlinks href=#hl-4-62> 62</a>
</span><span class=lnt id=hl-4-63><a class=lnlinks href=#hl-4-63> 63</a>
</span><span class=lnt id=hl-4-64><a class=lnlinks href=#hl-4-64> 64</a>
</span><span class=lnt id=hl-4-65><a class=lnlinks href=#hl-4-65> 65</a>
</span><span class=lnt id=hl-4-66><a class=lnlinks href=#hl-4-66> 66</a>
</span><span class=lnt id=hl-4-67><a class=lnlinks href=#hl-4-67> 67</a>
</span><span class=lnt id=hl-4-68><a class=lnlinks href=#hl-4-68> 68</a>
</span><span class=lnt id=hl-4-69><a class=lnlinks href=#hl-4-69> 69</a>
</span><span class=lnt id=hl-4-70><a class=lnlinks href=#hl-4-70> 70</a>
</span><span class=lnt id=hl-4-71><a class=lnlinks href=#hl-4-71> 71</a>
</span><span class=lnt id=hl-4-72><a class=lnlinks href=#hl-4-72> 72</a>
</span><span class=lnt id=hl-4-73><a class=lnlinks href=#hl-4-73> 73</a>
</span><span class=lnt id=hl-4-74><a class=lnlinks href=#hl-4-74> 74</a>
</span><span class=lnt id=hl-4-75><a class=lnlinks href=#hl-4-75> 75</a>
</span><span class=lnt id=hl-4-76><a class=lnlinks href=#hl-4-76> 76</a>
</span><span class=lnt id=hl-4-77><a class=lnlinks href=#hl-4-77> 77</a>
</span><span class=lnt id=hl-4-78><a class=lnlinks href=#hl-4-78> 78</a>
</span><span class=lnt id=hl-4-79><a class=lnlinks href=#hl-4-79> 79</a>
</span><span class=lnt id=hl-4-80><a class=lnlinks href=#hl-4-80> 80</a>
</span><span class=lnt id=hl-4-81><a class=lnlinks href=#hl-4-81> 81</a>
</span><span class=lnt id=hl-4-82><a class=lnlinks href=#hl-4-82> 82</a>
</span><span class=lnt id=hl-4-83><a class=lnlinks href=#hl-4-83> 83</a>
</span><span class=lnt id=hl-4-84><a class=lnlinks href=#hl-4-84> 84</a>
</span><span class=lnt id=hl-4-85><a class=lnlinks href=#hl-4-85> 85</a>
</span><span class=lnt id=hl-4-86><a class=lnlinks href=#hl-4-86> 86</a>
</span><span class=lnt id=hl-4-87><a class=lnlinks href=#hl-4-87> 87</a>
</span><span class=lnt id=hl-4-88><a class=lnlinks href=#hl-4-88> 88</a>
</span><span class=lnt id=hl-4-89><a class=lnlinks href=#hl-4-89> 89</a>
</span><span class=lnt id=hl-4-90><a class=lnlinks href=#hl-4-90> 90</a>
</span><span class=lnt id=hl-4-91><a class=lnlinks href=#hl-4-91> 91</a>
</span><span class=lnt id=hl-4-92><a class=lnlinks href=#hl-4-92> 92</a>
</span><span class=lnt id=hl-4-93><a class=lnlinks href=#hl-4-93> 93</a>
</span><span class=lnt id=hl-4-94><a class=lnlinks href=#hl-4-94> 94</a>
</span><span class=lnt id=hl-4-95><a class=lnlinks href=#hl-4-95> 95</a>
</span><span class=lnt id=hl-4-96><a class=lnlinks href=#hl-4-96> 96</a>
</span><span class=lnt id=hl-4-97><a class=lnlinks href=#hl-4-97> 97</a>
</span><span class=lnt id=hl-4-98><a class=lnlinks href=#hl-4-98> 98</a>
</span><span class=lnt id=hl-4-99><a class=lnlinks href=#hl-4-99> 99</a>
</span><span class=lnt id=hl-4-100><a class=lnlinks href=#hl-4-100>100</a>
</span><span class=lnt id=hl-4-101><a class=lnlinks href=#hl-4-101>101</a>
</span><span class=lnt id=hl-4-102><a class=lnlinks href=#hl-4-102>102</a>
</span><span class=lnt id=hl-4-103><a class=lnlinks href=#hl-4-103>103</a>
</span><span class=lnt id=hl-4-104><a class=lnlinks href=#hl-4-104>104</a>
</span><span class=lnt id=hl-4-105><a class=lnlinks href=#hl-4-105>105</a>
</span><span class=lnt id=hl-4-106><a class=lnlinks href=#hl-4-106>106</a>
</span><span class=lnt id=hl-4-107><a class=lnlinks href=#hl-4-107>107</a>
</span><span class=lnt id=hl-4-108><a class=lnlinks href=#hl-4-108>108</a>
</span><span class=lnt id=hl-4-109><a class=lnlinks href=#hl-4-109>109</a>
</span><span class=lnt id=hl-4-110><a class=lnlinks href=#hl-4-110>110</a>
</span><span class=lnt id=hl-4-111><a class=lnlinks href=#hl-4-111>111</a>
</span><span class=lnt id=hl-4-112><a class=lnlinks href=#hl-4-112>112</a>
</span><span class=lnt id=hl-4-113><a class=lnlinks href=#hl-4-113>113</a>
</span><span class=lnt id=hl-4-114><a class=lnlinks href=#hl-4-114>114</a>
</span><span class=lnt id=hl-4-115><a class=lnlinks href=#hl-4-115>115</a>
</span><span class=lnt id=hl-4-116><a class=lnlinks href=#hl-4-116>116</a>
</span><span class=lnt id=hl-4-117><a class=lnlinks href=#hl-4-117>117</a>
</span><span class=lnt id=hl-4-118><a class=lnlinks href=#hl-4-118>118</a>
</span><span class=lnt id=hl-4-119><a class=lnlinks href=#hl-4-119>119</a>
</span><span class=lnt id=hl-4-120><a class=lnlinks href=#hl-4-120>120</a>
</span><span class=lnt id=hl-4-121><a class=lnlinks href=#hl-4-121>121</a>
</span><span class=lnt id=hl-4-122><a class=lnlinks href=#hl-4-122>122</a>
</span><span class=lnt id=hl-4-123><a class=lnlinks href=#hl-4-123>123</a>
</span><span class=lnt id=hl-4-124><a class=lnlinks href=#hl-4-124>124</a>
</span><span class=lnt id=hl-4-125><a class=lnlinks href=#hl-4-125>125</a>
</span><span class=lnt id=hl-4-126><a class=lnlinks href=#hl-4-126>126</a>
</span><span class=lnt id=hl-4-127><a class=lnlinks href=#hl-4-127>127</a>
</span><span class=lnt id=hl-4-128><a class=lnlinks href=#hl-4-128>128</a>
</span><span class=lnt id=hl-4-129><a class=lnlinks href=#hl-4-129>129</a>
</span><span class=lnt id=hl-4-130><a class=lnlinks href=#hl-4-130>130</a>
</span><span class=lnt id=hl-4-131><a class=lnlinks href=#hl-4-131>131</a>
</span><span class=lnt id=hl-4-132><a class=lnlinks href=#hl-4-132>132</a>
</span><span class=lnt id=hl-4-133><a class=lnlinks href=#hl-4-133>133</a>
</span><span class=lnt id=hl-4-134><a class=lnlinks href=#hl-4-134>134</a>
</span><span class=lnt id=hl-4-135><a class=lnlinks href=#hl-4-135>135</a>
</span><span class=lnt id=hl-4-136><a class=lnlinks href=#hl-4-136>136</a>
</span><span class=lnt id=hl-4-137><a class=lnlinks href=#hl-4-137>137</a>
</span><span class=lnt id=hl-4-138><a class=lnlinks href=#hl-4-138>138</a>
</span><span class=lnt id=hl-4-139><a class=lnlinks href=#hl-4-139>139</a>
</span><span class=lnt id=hl-4-140><a class=lnlinks href=#hl-4-140>140</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TimedMutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기본적인 내부 잠금 메커니즘</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 잠금을 소유한 스레드의 ID</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=c1># 잠금이 획득된 시간</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_acquire_time</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=c1># 잠금 상태를 추적하는 플래그</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주어진 타임아웃 시간 내에 뮤텍스 잠금을 획득하려고 시도합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            timeout (float): 최대 대기 시간(초). None이면 무한정 대기
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            bool: 잠금 획득 성공 여부
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 타임아웃 체크</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>timeout</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;</span> <span class=n>timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 잠금 획득 시도</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_acquire</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=c1># 짧은 대기 후 재시도</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_try_acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        논블로킹 방식으로 잠금 획득을 시도합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=kc>False</span><span class=p>):</span>  <span class=c1># 비차단 모드로 시도</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_acquire_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        뮤텍스 잠금을 해제합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        잘못된 스레드가 해제를 시도하면 예외가 발생합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&#34;잠금이 해제된 뮤텍스입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>!=</span> <span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&#34;다른 스레드가 소유한 뮤텍스입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_acquire_time</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>locked</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 잠금 상태를 반환합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>hold_time</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        현재 잠금이 유지된 시간(초)을 반환합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        잠금이 해제된 상태면 None을 반환합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_acquire_time</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>_acquire_time</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시를 위한 공유 리소스 클래스</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SharedResource</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>TimedMutex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>update_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_value</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        타임아웃을 사용하여 값을 안전하게 업데이트합니다.
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            bool: 업데이트 성공 여부
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스레드 </span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>()</span><span class=si>}</span><span class=s2>: 타임아웃 발생&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스레드 </span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>()</span><span class=si>}</span><span class=s2>: 값 업데이트 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>  <span class=c1># 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>new_value</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker</span><span class=p>(</span><span class=n>resource</span><span class=p>:</span> <span class=n>SharedResource</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;작업자 스레드 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>thread_id</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>sleep_time</span><span class=p>)</span>  <span class=c1># 의도적인 지연</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=o>=</span> <span class=n>resource</span><span class=o>.</span><span class=n>update_value</span><span class=p>(</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스레드 </span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>: 값 업데이트 성공 (새 값: </span><span class=si>{</span><span class=n>resource</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스레드 </span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>: 값 업데이트 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 공유 리소스 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>resource</span> <span class=o>=</span> <span class=n>SharedResource</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 여러 스레드 생성 및 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 각 스레드에 다른 시작 지연 시간을 줌</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>=</span><span class=n>worker</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>resource</span><span class=p>,</span> <span class=n>i</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 모든 스레드 완료 대기</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>thread</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;최종 값: </span><span class=si>{</span><span class=n>resource</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>구현 내용<ul><li><strong>타임아웃 메커니즘</strong>:<ul><li><code>acquire</code> 메서드는 지정된 시간 동안만 잠금 획득을 시도한다.</li><li>시간 초과 시 False를 반환하여 호출자가 적절히 대응할 수 있게 한다.</li><li>무한 대기를 방지하여 데드락 상황을 피할 수 있습니다.</li></ul></li><li><strong>안전성 기능</strong>:<ul><li>소유자 스레드 추적으로 잘못된 해제를 방지한다.</li><li>잠금 시간 추적으로 디버깅과 모니터링이 가능하다.</li><li>try-finally 구문으로 안전한 잠금 해제를 보장한다.</li></ul></li><li><strong>모니터링 기능</strong>:<ul><li><code>locked()</code> 메서드로 현재 잠금 상태를 확인할 수 있다.</li><li><code>hold_time()</code> 메서드로 잠금 유지 시간을 확인할 수 있다.</li><li>상세한 로깅으로 문제 진단이 용이하다.</li></ul></li><li><strong>사용자 친화적 인터페이스</strong>:<ul><li>간단하고 직관적인 API를 제공한다.</li><li>예외 처리를 통한 명확한 에러 메시지를 제공한다.</li><li>타입 힌팅으로 코드의 가독성을 높임.</li></ul></li></ul></li></ul><h4 id=적응형-mutex-adaptive-mutex>적응형 Mutex (Adaptive Mutex)<a hidden class=anchor aria-hidden=true href=#적응형-mutex-adaptive-mutex>#</a></h4><p>시스템 부하에 따라 동작 방식을 자동으로 조절하는 Mutex.<br>짧은 대기 시간에는 스핀락처럼 동작하고, 긴 대기 시간에는 일반 mutex처럼 동작한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>  1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>  2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>  3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>  4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>  5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>  6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7>  7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8>  8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9>  9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10> 10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11> 11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12> 12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13> 13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14> 14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15> 15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16> 16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17> 17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18> 18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19> 19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20> 20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21> 21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22> 22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23> 23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24> 24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25> 25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26> 26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27> 27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28> 28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29> 29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30> 30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31> 31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32> 32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33> 33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34> 34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35> 35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36> 36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37> 37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38> 38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39> 39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40> 40</a>
</span><span class=lnt id=hl-5-41><a class=lnlinks href=#hl-5-41> 41</a>
</span><span class=lnt id=hl-5-42><a class=lnlinks href=#hl-5-42> 42</a>
</span><span class=lnt id=hl-5-43><a class=lnlinks href=#hl-5-43> 43</a>
</span><span class=lnt id=hl-5-44><a class=lnlinks href=#hl-5-44> 44</a>
</span><span class=lnt id=hl-5-45><a class=lnlinks href=#hl-5-45> 45</a>
</span><span class=lnt id=hl-5-46><a class=lnlinks href=#hl-5-46> 46</a>
</span><span class=lnt id=hl-5-47><a class=lnlinks href=#hl-5-47> 47</a>
</span><span class=lnt id=hl-5-48><a class=lnlinks href=#hl-5-48> 48</a>
</span><span class=lnt id=hl-5-49><a class=lnlinks href=#hl-5-49> 49</a>
</span><span class=lnt id=hl-5-50><a class=lnlinks href=#hl-5-50> 50</a>
</span><span class=lnt id=hl-5-51><a class=lnlinks href=#hl-5-51> 51</a>
</span><span class=lnt id=hl-5-52><a class=lnlinks href=#hl-5-52> 52</a>
</span><span class=lnt id=hl-5-53><a class=lnlinks href=#hl-5-53> 53</a>
</span><span class=lnt id=hl-5-54><a class=lnlinks href=#hl-5-54> 54</a>
</span><span class=lnt id=hl-5-55><a class=lnlinks href=#hl-5-55> 55</a>
</span><span class=lnt id=hl-5-56><a class=lnlinks href=#hl-5-56> 56</a>
</span><span class=lnt id=hl-5-57><a class=lnlinks href=#hl-5-57> 57</a>
</span><span class=lnt id=hl-5-58><a class=lnlinks href=#hl-5-58> 58</a>
</span><span class=lnt id=hl-5-59><a class=lnlinks href=#hl-5-59> 59</a>
</span><span class=lnt id=hl-5-60><a class=lnlinks href=#hl-5-60> 60</a>
</span><span class=lnt id=hl-5-61><a class=lnlinks href=#hl-5-61> 61</a>
</span><span class=lnt id=hl-5-62><a class=lnlinks href=#hl-5-62> 62</a>
</span><span class=lnt id=hl-5-63><a class=lnlinks href=#hl-5-63> 63</a>
</span><span class=lnt id=hl-5-64><a class=lnlinks href=#hl-5-64> 64</a>
</span><span class=lnt id=hl-5-65><a class=lnlinks href=#hl-5-65> 65</a>
</span><span class=lnt id=hl-5-66><a class=lnlinks href=#hl-5-66> 66</a>
</span><span class=lnt id=hl-5-67><a class=lnlinks href=#hl-5-67> 67</a>
</span><span class=lnt id=hl-5-68><a class=lnlinks href=#hl-5-68> 68</a>
</span><span class=lnt id=hl-5-69><a class=lnlinks href=#hl-5-69> 69</a>
</span><span class=lnt id=hl-5-70><a class=lnlinks href=#hl-5-70> 70</a>
</span><span class=lnt id=hl-5-71><a class=lnlinks href=#hl-5-71> 71</a>
</span><span class=lnt id=hl-5-72><a class=lnlinks href=#hl-5-72> 72</a>
</span><span class=lnt id=hl-5-73><a class=lnlinks href=#hl-5-73> 73</a>
</span><span class=lnt id=hl-5-74><a class=lnlinks href=#hl-5-74> 74</a>
</span><span class=lnt id=hl-5-75><a class=lnlinks href=#hl-5-75> 75</a>
</span><span class=lnt id=hl-5-76><a class=lnlinks href=#hl-5-76> 76</a>
</span><span class=lnt id=hl-5-77><a class=lnlinks href=#hl-5-77> 77</a>
</span><span class=lnt id=hl-5-78><a class=lnlinks href=#hl-5-78> 78</a>
</span><span class=lnt id=hl-5-79><a class=lnlinks href=#hl-5-79> 79</a>
</span><span class=lnt id=hl-5-80><a class=lnlinks href=#hl-5-80> 80</a>
</span><span class=lnt id=hl-5-81><a class=lnlinks href=#hl-5-81> 81</a>
</span><span class=lnt id=hl-5-82><a class=lnlinks href=#hl-5-82> 82</a>
</span><span class=lnt id=hl-5-83><a class=lnlinks href=#hl-5-83> 83</a>
</span><span class=lnt id=hl-5-84><a class=lnlinks href=#hl-5-84> 84</a>
</span><span class=lnt id=hl-5-85><a class=lnlinks href=#hl-5-85> 85</a>
</span><span class=lnt id=hl-5-86><a class=lnlinks href=#hl-5-86> 86</a>
</span><span class=lnt id=hl-5-87><a class=lnlinks href=#hl-5-87> 87</a>
</span><span class=lnt id=hl-5-88><a class=lnlinks href=#hl-5-88> 88</a>
</span><span class=lnt id=hl-5-89><a class=lnlinks href=#hl-5-89> 89</a>
</span><span class=lnt id=hl-5-90><a class=lnlinks href=#hl-5-90> 90</a>
</span><span class=lnt id=hl-5-91><a class=lnlinks href=#hl-5-91> 91</a>
</span><span class=lnt id=hl-5-92><a class=lnlinks href=#hl-5-92> 92</a>
</span><span class=lnt id=hl-5-93><a class=lnlinks href=#hl-5-93> 93</a>
</span><span class=lnt id=hl-5-94><a class=lnlinks href=#hl-5-94> 94</a>
</span><span class=lnt id=hl-5-95><a class=lnlinks href=#hl-5-95> 95</a>
</span><span class=lnt id=hl-5-96><a class=lnlinks href=#hl-5-96> 96</a>
</span><span class=lnt id=hl-5-97><a class=lnlinks href=#hl-5-97> 97</a>
</span><span class=lnt id=hl-5-98><a class=lnlinks href=#hl-5-98> 98</a>
</span><span class=lnt id=hl-5-99><a class=lnlinks href=#hl-5-99> 99</a>
</span><span class=lnt id=hl-5-100><a class=lnlinks href=#hl-5-100>100</a>
</span><span class=lnt id=hl-5-101><a class=lnlinks href=#hl-5-101>101</a>
</span><span class=lnt id=hl-5-102><a class=lnlinks href=#hl-5-102>102</a>
</span><span class=lnt id=hl-5-103><a class=lnlinks href=#hl-5-103>103</a>
</span><span class=lnt id=hl-5-104><a class=lnlinks href=#hl-5-104>104</a>
</span><span class=lnt id=hl-5-105><a class=lnlinks href=#hl-5-105>105</a>
</span><span class=lnt id=hl-5-106><a class=lnlinks href=#hl-5-106>106</a>
</span><span class=lnt id=hl-5-107><a class=lnlinks href=#hl-5-107>107</a>
</span><span class=lnt id=hl-5-108><a class=lnlinks href=#hl-5-108>108</a>
</span><span class=lnt id=hl-5-109><a class=lnlinks href=#hl-5-109>109</a>
</span><span class=lnt id=hl-5-110><a class=lnlinks href=#hl-5-110>110</a>
</span><span class=lnt id=hl-5-111><a class=lnlinks href=#hl-5-111>111</a>
</span><span class=lnt id=hl-5-112><a class=lnlinks href=#hl-5-112>112</a>
</span><span class=lnt id=hl-5-113><a class=lnlinks href=#hl-5-113>113</a>
</span><span class=lnt id=hl-5-114><a class=lnlinks href=#hl-5-114>114</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AdaptiveMutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>spin_count_threshold</span><span class=o>=</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기본적인 잠금 메커니즘</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 스핀락 카운트를 위한 임계값</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>spin_count_threshold</span> <span class=o>=</span> <span class=n>spin_count_threshold</span>
</span></span><span class=line><span class=cl>        <span class=c1># 대기 중인 스레드 수를 추적</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_waiting_threads</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=c1># 경합 수준을 모니터링</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_contention_level</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=c1># 대기 큐</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_wait_queue</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 현재 소유자 스레드 ID</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>thread_id</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 먼저 스핀락 시도</span>
</span></span><span class=line><span class=cl>        <span class=n>spin_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>spin_count</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>spin_count_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_acquire</span><span class=p>(</span><span class=n>thread_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>spin_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=c1># 짧은 대기 시간 추가</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.000001</span><span class=p>)</span>  <span class=c1># 1 마이크로초</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=c1># 스핀락이 실패하면 일반 잠금으로 전환</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_waiting_threads</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 일반 잠금 획득 시도</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_acquire</span><span class=p>(</span><span class=n>thread_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=c1># 경합 수준 증가 및 적응형 대기</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_contention_level</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_adaptive_wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_waiting_threads</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_try_acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;잠금 획득 시도&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=kc>False</span><span class=p>):</span>  <span class=c1># 비차단 시도</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>=</span> <span class=n>thread_id</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_adaptive_wait</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;경합 수준에 따른 적응형 대기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_contention_level</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 낮은 경합: 짧은 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.000001</span><span class=p>)</span>  <span class=c1># 1 마이크로초</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_contention_level</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 중간 경합: 중간 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.0001</span><span class=p>)</span>    <span class=c1># 100 마이크로초</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 높은 경합: 긴 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>     <span class=c1># 1 밀리초</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;잠금 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>==</span> <span class=n>threading</span><span class=o>.</span><span class=n>get_ident</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_owner</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_contention_level</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_contention_level</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&#34;잘못된 스레드가 잠금 해제를 시도했습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shared_resource_access</span><span class=p>(</span><span class=n>adaptive_mutex</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>,</span> <span class=n>shared_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;공유 리소스에 접근하는 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>adaptive_mutex</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 임계 영역 시작</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스레드 </span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>가 공유 리소스에 접근 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>shared_data</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=c1># 임의의 작업 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=mf>0.005</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스레드 </span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>가 공유 리소스 접근 완료. 현재 값: </span><span class=si>{</span><span class=n>shared_data</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 임계 영역 종료</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>adaptive_mutex</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 적응형 뮤텍스 인스턴스 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>adaptive_mutex</span> <span class=o>=</span> <span class=n>AdaptiveMutex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 공유 데이터</span>
</span></span><span class=line><span class=cl>    <span class=n>shared_data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 여러 스레드 생성 및 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>=</span><span class=n>shared_resource_access</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>adaptive_mutex</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>shared_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 모든 스레드가 완료될 때까지 대기</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>thread</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;최종 값: </span><span class=si>{</span><span class=n>shared_data</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>구현 내용<ul><li><strong>적응형 메커니즘</strong>:<ul><li>처음에는 스핀락 방식으로 시도하여 빠른 응답을 추구한다.</li><li>경합이 심해지면 일반 잠금 방식으로 전환하여 CPU 사용을 줄인다.</li><li>경합 수준에 따라 대기 시간을 동적으로 조절한다.</li></ul></li><li><strong>성능 최적화</strong>:<ul><li>스핀락 임계값을 설정하여 초기 응답성을 조절할 수 있다.</li><li>경합 수준에 따라 세 가지 다른 대기 시간을 사용한다.</li><li>대기 중인 스레드 수를 추적하여 시스템 부하를 모니터링한다.</li></ul></li><li><strong>안전성 기능</strong>:<ul><li>소유자 스레드 확인을 통한 잘못된 해제 방지</li><li>예외 발생 시에도 안전한 잠금 해제를 보장하는 try-finally 구조</li><li>스레드 ID 추적을 통한 소유권 관리</li></ul></li><li><strong>모니터링 및 디버깅</strong>:<ul><li>대기 중인 스레드 수 추적</li><li>경합 수준 모니터링</li><li>상세한 로깅과 에러 메시지</li></ul></li></ul></li></ul><h3 id=mutex-사용-시-주의사항>Mutex 사용 시 주의사항<a hidden class=anchor aria-hidden=true href=#mutex-사용-시-주의사항>#</a></h3><h4 id=교착상태-방지>교착상태 방지<a hidden class=anchor aria-hidden=true href=#교착상태-방지>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>DeadlockAvoidance</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>safe_operation</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Mutex 획득 순서를 항상 동일하게 유지</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Safe operation&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=raii-패턴-사용>RAII 패턴 사용<a hidden class=anchor aria-hidden=true href=#raii-패턴-사용>#</a></h4><p>RAII(Resource Acuquisition Is Intialization) 는 C++에서 강조되는 디자인 테크닉 중 하나.<br>&ldquo;자원 획득(Resource Acquisition)은 초기화(Initialization)이다</p><ul><li>자원의 획득과 해제를 객체(객체의 포인터객체)의 수명과 연결 → 자동으로 효율적으로 자원(메모리, 파일 등)관리, 메모리 누수를 해결</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>RAIIMutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mutex</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>mutex</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__enter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__exit__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>type</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>traceback</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=최소한의-임계-영역>최소한의 임계 영역<a hidden class=anchor aria-hidden=true href=#최소한의-임계-영역>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OptimizedResource</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Mutex가 필요없는 연산은 밖에서 수행</span>
</span></span><span class=line><span class=cl>        <span class=n>processed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>heavy_computation</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 실제로 공유 자원에 접근할 때만 Mutex 사용</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>processed</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/computer-system/>Computer-System</a></li><li><a href=https://buenhyden.github.io/tags/operating-system/>Operating-System</a></li><li><a href=https://buenhyden.github.io/tags/synchronization-and-concurrency-control/>Synchronization-and-Concurrency-Control</a></li><li><a href=https://buenhyden.github.io/tags/process-synchronization/>Process-Synchronization</a></li><li><a href=https://buenhyden.github.io/tags/mutex/>Mutex</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/computer-science/operating-systems/thread-management/threads/><span class=title>« Prev</span><br><span>Thread</span>
</a><a class=next href=https://buenhyden.github.io/posts/computer-science/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/monitor/><span class=title>Next »</span><br><span>Monitor</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>