<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>RabbitMQ | hyunyoun's Blog</title><meta name=keywords content="Backend-Development,Event-and-Message-Brokers,Message-Broker-Systems,RabbitMQ"><meta name=description content="rlang 언어로 작성된 오픈 소스 메시지 브로커 시스템으로, AMQP(Advanced Message Queuing Protocol)를 구현하고 있다"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/networking--protocols/communication-patterns/message-infrastructure/message-systems/message-queues/rabbitmq/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/networking--protocols/communication-patterns/message-infrastructure/message-systems/message-queues/rabbitmq/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/networking--protocols/communication-patterns/message-infrastructure/message-systems/message-queues/rabbitmq/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/networking--protocols/communication-patterns/message-infrastructure/message-systems/message-queues/rabbitmq/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="RabbitMQ"><meta property="og:description" content="rlang 언어로 작성된 오픈 소스 메시지 브로커 시스템으로, AMQP(Advanced Message Queuing Protocol)를 구현하고 있다"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="RabbitMQ"><meta name=twitter:description content="rlang 언어로 작성된 오픈 소스 메시지 브로커 시스템으로, AMQP(Advanced Message Queuing Protocol)를 구현하고 있다"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":7,"name":"RabbitMQ","item":"https://buenhyden.github.io/posts/networking--protocols/communication-patterns/message-infrastructure/message-systems/message-queues/rabbitmq/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>RabbitMQ</h1><div class=post-description>rlang 언어로 작성된 오픈 소스 메시지 브로커 시스템으로, AMQP(Advanced Message Queuing Protocol)를 구현하고 있다</div></header><div class=post-content><h2 id=rabbitmq>RabbitMQ<a hidden class=anchor aria-hidden=true href=#rabbitmq>#</a></h2><h1 id=1단계-기본-분석-및-검증>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증>#</a></h1><h3 id=1-대표-태그-생성>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성>#</a></h3><ul><li>Message-Broker</li><li>AMQP-Protocol</li><li>Distributed-Systems</li><li>Asynchronous-Processing</li></ul><h3 id=2-분류-체계-검증-및-개선-제안>2. 분류 체계 검증 및 개선 제안<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증-및-개선-제안>#</a></h3><p>RabbitMQ는 &ldquo;Tool Reference > Communication Technologies > Message Brokers&rdquo; 분류에 적합합니다. 메시지 브로커(MOM, Message-Oriented Middleware) 기술은 현대 소프트웨어 아키텍처에서 시스템 간 데이터 전달과 비동기 이벤트 처리를 지원하며, RabbitMQ는 대표적인 메시지 브로커로 다양한 분산 환경에서 활용됩니다. 분류상 통신 기술 및 메시지 브로커 영역에 속하는 것이 타당합니다.</p><h3 id=3-핵심-요약-250자-이내>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내>#</a></h3><p>RabbitMQ는 AMQP(Advanced Message Queuing Protocol) 기반 오픈소스 메시지 브로커로서, 분산 시스템에서 비동기 메시지 전달과 안정성을 보장하며, 생산자와 소비자 사이의 느슨한 결합과 확장성, 관리 편의성을 제공합니다.<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>1</a><a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">3</a><a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">5</a></p><h3 id=4-전체-개요-및-학습-방향성-400자-이내>4. 전체 개요 및 학습 방향성 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-및-학습-방향성-400자-이내>#</a></h3><p>RabbitMQ는 생산자(Producer)가 생성한 메시지를 교환기(Exchange)를 통해 여러 큐(Queue)로 라우팅하고 소비자(Consumer)가 이를 처리하는 분산 메시지 브로커입니다. AMQP의 채택으로 메시지 전달 신뢰성, 유연한 라우팅, 다양한 프로토콜 및 언어 지원 등 실무에서 요구되는 복잡한 메시징 니즈를 충족합니다. 비동기 처리, 시스템 부하 분산, 장애 시 메시지 내구성 등 대규모 서비스 백엔드에 필수적이며, 클라우드·온프레미스 모두에 배포 가능하고 모니터링·운영 도구가 잘 구성되어 있어 실무 적용이 활발합니다. 학습은 기본 개념부터 실무적 운영, 최신 트렌드까지 단계적으로 심화하는 방식이 효과적입니다.</p><hr><h1 id=2단계-개념-체계화-및-검증>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증>#</a></h1><h3 id=5-핵심-개념-정리>5. 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리>#</a></h3><ul><li><strong>메시지 브로커(Message Broker) 및 MOM(메시지 지향 미들웨어):</strong> 시스템 간 메시지 전달을 담당. RabbitMQ는 이 역할을 수행.</li><li><strong>AMQP(Advanced Message Queuing Protocol, 고급 메시지 큐 프로토콜):</strong> RabbitMQ의 핵심 프로토콜로 표준화, 신뢰성 전달, 다양한 라우팅 구현이 가능.<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">2</a><a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">5</a></li><li><strong>Producer / Consumer:</strong> 메시지의 생산자와 소비자. Producer가 Exchange에 메시지 발행, Consumer가 큐에서 메시지 수신 및 처리.<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">3</a><a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">7</a></li><li><strong>Exchange & Queue:</strong> Exchange가 메시지를 라우팅, 큐는 메시지 보관 역할. Exchange는 Direct, Topic, Headers, Fanout 등 다양한 타입을 지원.<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">4</a></li><li><strong>Binding:</strong> Exchange와 Queue를 연결하여 라우팅 규칙 정의.</li><li><strong>비동기 메시징:</strong> 생산자와 소비자가 독립적으로 동작, 시스템 확장성과 장애 내성 증대.<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">8</a></li></ul><h3 id=6-실무-연관성-분석>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석>#</a></h3><p>RabbitMQ의 핵심 개념들은 실무에서 다음과 같이 활용됩니다.</p><ul><li>비동기 처리로 인한 시스템 독립적 확장 및 장애 격리.</li><li>AMQP 기반의 신뢰성 메시지 전달 및 다양한 언어·플랫폼 연동.</li><li>복잡한 라우팅, 우선순위 지정, 지연·만료 메시지 등 다양한 요구 상황 대처.</li><li>분산 환경 및 클라우드 기반 운영, 관측성 및 관리 도구 제공.</li></ul><hr><h1 id=3단계-상세-조사-및-검증-phase-12>3단계: 상세 조사 및 검증 (Phase 1~2)<a hidden class=anchor aria-hidden=true href=#3단계-상세-조사-및-검증-phase-12>#</a></h1><h2 id=phase-1-기초-개념-foundation-understanding>Phase 1: 기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념-foundation-understanding>#</a></h2><h3 id=11-개념-정의-및-본질적-이해>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해>#</a></h3><p>RabbitMQ는 AMQP(고급 메시지 큐 프로토콜)를 따르는 오픈 소스 메시지 브로커입니다. 생산자와 소비자(Producer, Consumer)간에 메시지를 안전하고 신뢰성 있게 전달하며, 시스템 간의 느슨한 결합과 비동기 처리를 가능케 합니다.<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">5</a><a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">3</a></p><h3 id=12-등장-배경-및-발전-과정>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정>#</a></h3><p>분산 시스템과 클라우드 환경 확대에 따라 시스템 간 통신의 신뢰성과 확장성이 중요한 과제가 되었고, RabbitMQ는 2007년 AMQP를 최초로 구현한 오픈소스 브로커로 등장. AMQP의 표준화(2008년), 오픈소스 커뮤니티 발전, 다양한 프로토콜과 운영 환경 지원을 통해 지역적 소프트웨어에서 글로벌 메시징 인프라로 발전하였습니다.<a href="https://www.rabbitmq.com/docs/management?utm_source=chatgpt.com" title="Management Plugin">6</a></p><h3 id=13-핵심-목적-및-필요성>1.3 핵심 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성>#</a></h3><p>RabbitMQ는 서비스 컴포넌트간 비동기적 메시지 전달, 장애 내성, 부하 분산, 느슨한 결합 그리고 시스템 간 확장성 확대라는 문제를 해결하기 위해 사용됩니다. 주 목적은 안정적 데이터 전달, 복잡한 메시지 라우팅, 처리 분산 등입니다.<a href="https://www.rabbitmq.com/docs/ssl?utm_source=chatgpt.com" title="TLS Support">7</a><a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">4</a></p><h3 id=14-주요-특징-및-차별점-기술적-근거-포함>1.4 주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점-기술적-근거-포함>#</a></h3><ul><li>AMQP 기반 표준 프로토콜 채택, 다양한 프로그래밍 언어 지원.<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">2</a></li><li>다양한 Exchange 타입 통한 유연한 라우팅</li><li>큐의 내구성(메시지 영속성), 보안 및 관리 도구 강화</li><li>확장성 및 대중적 커뮤니티, 다양한 플러그인 지원<a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">11</a></li><li>Fanout, Topic, Direct, Header Exchange 등 상세 라우팅 지원<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">4</a><a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">5</a></li></ul><hr><h2 id=phase-2-핵심-원리-core-theory>Phase 2: 핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리-core-theory>#</a></h2><h3 id=21-핵심-설계-원칙-및-철학>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학>#</a></h3><p>RabbitMQ는 느슨한 결합(Loose Coupling)과 비동기 처리(Asynchronous Processing) 원칙 하에 고가용성, 신뢰성, 확장성, 표준화된 메시징을 지향합니다. AMQP 프로토콜의 표준적 메시지 전달, 장애 격리, 운영·관리 편의성을 설계 핵심으로 삼습니다.<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">5</a></p><h3 id=22-기본-원리-및-동작-메커니즘>2.2 기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘>#</a></h3><pre class=mermaid>graph TD
    Producer(생산자) -.-&gt;|메시지 발행| Exchange(교환기)
    Exchange --&gt;|라우팅| Queue(큐)
    Queue --&gt;|메시지 소비| Consumer(소비자)
</pre><ul><li>Producer가 메시지를 Exchange로 발행</li><li>Exchange가 메시지 라우팅 정책(Binding)을 따라 Queue에 전달</li><li>Consumer가 Queue에서 메시지 소비</li></ul><h3 id=23-아키텍처-및-구성-요소>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소>#</a></h3><h4 id=구성요소>구성요소<a hidden class=anchor aria-hidden=true href=#구성요소>#</a></h4><ul><li>Producer(생산자): 메시지 발행</li><li>Exchange(교환기): 라우팅 담당</li><li>Queue(큐): 메시지 저장소</li><li>Consumer(소비자): 메시지 소비 및 비즈니스 로직 처리</li><li>Binding: Exchange와 Queue 연결</li><li>Channel/Connection: 네트워크 연결 및 세션 관리</li></ul><h4 id=필수선택구성>필수/선택구성<a hidden class=anchor aria-hidden=true href=#필수선택구성>#</a></h4><ul><li>필수: Producer, Exchange, Queue, Consumer</li><li>선택: 다양한 Exchange 타입, 라우팅 키, 메시지 옵션(만료, 지연 등), 내구성 설정</li></ul><h3 id=24-주요-기능과-역할>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할>#</a></h3><ul><li><strong>유연한 메시지 라우팅:</strong> 여러 Exchange 타입 지원</li><li><strong>메시지 내구성:</strong> 장애 시 데이터 보호</li><li><strong>비동기 처리 지원:</strong> 시스템 확장성 및 장애 격리</li><li><strong>확장/운영/모니터링 도구 제공:</strong> 실시간 대시보드 등</li></ul><hr><h1 id=3단계-특성-분석-및-구현-방법-phase-34>3단계: 특성 분석 및 구현 방법 (Phase 3~4)<a hidden class=anchor aria-hidden=true href=#3단계-특성-분석-및-구현-방법-phase-34>#</a></h1><h2 id=phase-3-특성-분석-characteristics-analysis>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis>#</a></h2><h3 id=31-장점-및-이점-분석표>3.1 장점 및 이점 분석표<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점-분석표>#</a></h3><blockquote><p>이 표는 RabbitMQ의 장점과 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목                | 설명                              | 기술적 근거                       | 실무 효과             |
</span></span><span class=line><span class=cl>|------|---------------------|-----------------------------------|-----------------------------------|----------------------|
</span></span><span class=line><span class=cl>| 장점 | 표준화/호환성        | AMQP 기반, 다양한 언어·플랫폼 지원 | AMQP 구현, 오픈 API               | 다양한 환경에 도입    |
</span></span><span class=line><span class=cl>| 장점 | 유연한 라우팅        | 다양한 Exchange 타입               | Direct/Topic/Fanout/Headers 지원  | 복잡시나리오 구현     |
</span></span><span class=line><span class=cl>| 장점 | 장애 내구성/복구      | 메시지 내구성, 미러 큐             | Durable Queue/HA 기능              | 장애 시 데이터 보호   |
</span></span><span class=line><span class=cl>| 장점 | 관리 편의성          | 대시보드, 모니터링, 확장 도구       | Management Plugin, CLI 지원        | 운영 효율성 증대      |
</span></span><span class=line><span class=cl>| 장점 | 실시간 비동기 처리    | 소비/생산자 분리, 높은 처리율       | 비동기 기반 연결                   | 병렬·분산 처리 효율   |
</span></span></code></pre></td></tr></table></div></div><h3 id=32-단점-및-제약사항-해결방안-분석>3.2 단점 및 제약사항, 해결방안 분석<a hidden class=anchor aria-hidden=true href=#32-단점-및-제약사항-해결방안-분석>#</a></h3><blockquote><p>이 표는 RabbitMQ의 단점과 제약사항, 그리고 해결방안을 종합적으로 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목            | 설명                       | 해결책                                 | 대안 기술           |
</span></span><span class=line><span class=cl>|------|-----------------|----------------------------|----------------------------------------|---------------------|
</span></span><span class=line><span class=cl>| 단점 | 높은 지연        | 메시지 대량·순차 처리 시    | 노드 확장, 프리페칭 등 설정 최적화      | Kafka, Redis        |
</span></span><span class=line><span class=cl>| 단점 | 순차처리 한계    | Pub/Sub 대규모 분산에 취약  | Exchange·큐 구조 최적화                | Kafka               |
</span></span><span class=line><span class=cl>| 단점 | 클러스터 복잡도  | HA, 미러큐 설정 어렵고 복잡 | 자동화/모니터링 도구 활용               | AWS SQS, Kafka      |
</span></span><span class=line><span class=cl>| 단점 | 운영 지표 부족   | 심층 모니터링 한계          | 외부 모니터링 시스템 연동               | Prometheus          |
</span></span></code></pre></td></tr></table></div></div><h3 id=33-트레이드오프-관계-분석>3.3 트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#33-트레이드오프-관계-분석>#</a></h3><p>RabbitMQ는 높은 신뢰성과 유연한 라우팅, 표준화된 통신을 제공하지만, 그만큼 처리량과 확장성(수천만건 이상 실시간 이벤트)에서는 Kafka 등 로그 기반 처리 시스템이 더 우수합니다. 운영 단순화와 대규모 분산 환경에서는 SQS(Amazon Simple Queue Service), Redis도 실무적으로 고려됩니다.</p><h3 id=34-성능-특성-및-확장성-분석>3.4 성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#34-성능-특성-및-확장성-분석>#</a></h3><ul><li><strong>처리량:</strong> 메시지 라우팅/저장에 따른 TPS(초당 전송 건수) 한계가 있음.</li><li><strong>확장성:</strong> 미러 큐/클러스터링으로 가용성 확장 구조 구현.</li><li><strong>장애 복구:</strong> 메시지 내구성 설정, 미러 큐 사용 시 자동 복구 지원.</li></ul><hr><h2 id=phase-4-구현-및-분류-implementation--classification>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification>#</a></h2><h3 id=41-구현-기법-및-방법-정의-구성-목적-예시-포함>4.1 구현 기법 및 방법 (정의, 구성, 목적, 예시 포함)<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법-정의-구성-목적-예시-포함>#</a></h3><h4 id=정의구성>정의/구성<a hidden class=anchor aria-hidden=true href=#정의구성>#</a></h4><ul><li><strong>기본 배포:</strong> 단일 인스턴스, 도커(Docker) 또는 패키지 설치 방식 활용.</li><li><strong>클러스터링:</strong> 여러 노드로 확장, HA(High Availability, 고가용성) 구성.</li><li><strong>구성 파일:</strong> rabbitmq.conf 등으로 기본 설정, 플러그인 관리.</li></ul><h4 id=실제-예시>실제 예시<a hidden class=anchor aria-hidden=true href=#실제-예시>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ 메시지 전송 예제 (Python, pika 라이브러리 사용)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_message</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ Producer 역할 구현 예시
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 발행, 큐에 전송, 신뢰성 보장
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>body</span><span class=o>=</span><span class=s1>&#39;Hello RabbitMQ!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>이 코드는 생산자(Producer)가 메시지를 &lsquo;hello&rsquo; 큐에 발행하는 기본 동작을 담당합니다.</li></ul><h3 id=42-분류-기준에-따른-유형-구분>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분>#</a></h3><blockquote><p>이 표는 RabbitMQ의 분류 기준과 유형별 특성을 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 분류 기준   | 유형           | 특징                | 적용 시나리오                   |
</span></span><span class=line><span class=cl>|-------------|---------------|---------------------|---------------------------------|
</span></span><span class=line><span class=cl>| Exchange 타입| Direct         | 라우팅 키 일치 시 전달 | 단순 큐 처리                    |
</span></span><span class=line><span class=cl>| Exchange 타입| Topic          | 라우팅 패턴 기반 처리  | 이벤트/로그 분류                |
</span></span><span class=line><span class=cl>| Exchange 타입| Fanout         | 모든 큐에 브로드캐스트 | 대량 메시지 알림                |
</span></span><span class=line><span class=cl>| Exchange 타입| Headers        | 헤더 기반 라우팅      | 동적 메시지 분류                |
</span></span></code></pre></td></tr></table></div></div><h3 id=43-도구-및-프레임워크-생태계>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계>#</a></h3><ul><li><strong>기본 제공:</strong> rabbitmq-server, rabbitmqctl, 웹 관리 콘솔</li><li><strong>언어별 클라이언트:</strong> pika(Python), amqp(JavaScript), bunny(Ruby)</li><li><strong>운영 도구/모니터링:</strong> Management Plugin, Prometheus 연동</li><li><strong>클라우드 연동:</strong> AWS MSK(Managed Service for Kafka), Azure ServiceBus 등과 통합 환경 지원</li></ul><h3 id=44-표준-및-규격-준수사항>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항>#</a></h3><ul><li>AMQP 0-9-1 프로토콜 기본</li><li>MQTT, STOMP 등 타 프로토콜 지원 가능</li><li>TLS/SSL 암호화, 인증·인가 설정 필수</li></ul><hr><h1 id=4단계-실무-적용-및-운영-최적화-phase-56>4단계: 실무 적용 및 운영 최적화 (Phase 5~6)<a hidden class=anchor aria-hidden=true href=#4단계-실무-적용-및-운영-최적화-phase-56>#</a></h1><h2 id=phase-5-실무-적용-practical-application>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application>#</a></h2><h3 id=51-실습-예제-및-코드-구현>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현>#</a></h3><p><strong>학습 목표</strong>: RabbitMQ의 Producer/Consumer 구조 및 기본 메시지 송수신 절차를 이해<br><strong>시나리오</strong>: 백엔드 서비스에서 주문 완료 이벤트 발생시 다른 시스템(예: 알림·정산·데이터베이스 연계)에 메시지로 전달</p><p><strong>시스템 구성</strong>:</p><ul><li>주문 서비스 (Producer)</li><li>RabbitMQ 서버(메시지 브로커)</li><li>알림 서비스 (Consumer)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    주문서비스(Producer) --&gt;|주문완료 이벤트| RabbitMQ
    RabbitMQ --&gt;|메시지| 알림서비스(Consumer)
</pre><p><strong>Workflow</strong>:</p><ol><li>주문 서비스가 RabbitMQ에 메시지 발행</li><li>큐에 쌓인 메시지 대기</li><li>알림 서비스가 큐에서 메시지 소비</li></ol><p><strong>핵심 역할</strong>:<br>RabbitMQ는 주문 완료 메시지를 신뢰성 있게 전달·저장하여 알림 서비스가 안정적으로 수신·처리할 수 있도록 지원</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 주문 서비스와 알림 서비스가 직접 REST 호출, 장애·지연시 전체 시스템 영향</li><li>도입 후: RabbitMQ가 중개 역할, 장애·지연 발생해도 메시지 손실 없이 처리 확정, 시스템 결합도 완화</li></ul><p><strong>구현 예시(Python, pika)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 서비스(Producer)가 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_order_complete</span><span class=p>(</span><span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 완료 이벤트 송신
</span></span></span><span class=line><span class=cl><span class=s2>    - RabbitMQ 큐에 메시지 전달 (비동기, 신뢰성 보장)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_notify&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_notify&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>body</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;Order Complete: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 알림 서비스(Consumer)가 메시지 수신</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>receive_order_notify</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 큐에서 메시지 소비
</span></span></span><span class=line><span class=cl><span class=s2>    - 소비자가 메시지 수신 후 알림 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_notify&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;알림 수신:&#34;</span><span class=p>,</span> <span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_notify&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;알림 서비스 대기중...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=52-실제-도입-사례>5.2 실제 도입 사례<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례>#</a></h3><p><strong>실무 사용 예시</strong>:<br>국내 금융 서비스(예: 신속 이체 서비스)에서 결제 승인 이벤트를 수만~수십만 TPS로 RabbitMQ를 통해 처리, 서비스 간 장애 격리 및 신뢰성을 확보한 사례</p><ul><li>조합 기술: RabbitMQ + Redis 캐시 + 모니터링 도구(Prometheus, Grafana)</li><li>효과: 서비스 중단 없이 이벤트 실시간 분산·복구</li><li>벤치마크: 메시지 유실률 0.001% 이하, 장애 발생 후 복구 1분 이내</li></ul><hr><h3 id=53-실제-도입-사례의-코드-구현>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현>#</a></h3><p><strong>사례 선정</strong>: 실시간 이벤트 알림 시스템(금융 결제 서비스)<br><strong>비즈니스 배경</strong>: 다수 서비스간 장애 격리 및 단일 실패지점 제거, 실시간 이벤트 전파<br><strong>기술적 요구사항</strong>: 고신뢰성 메시지 전달, 장애 복구, 모니터링 도구 연동</p><p><strong>시스템 구성</strong>:</p><ul><li>결제 이벤트 Producer</li><li>RabbitMQ Cluster</li><li>이벤트 Consumer</li><li>Prometheus(모니터링)</li><li>장애 복구를 위한 미러 큐</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Production Environment&#34;
        A[결제 서비스 Producer] --&gt; B[RabbitMQ Cluster]
        B --&gt; C[이벤트 Consumer]
        B --&gt; D[Prometheus 모니터링]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>결제 서비스가 RabbitMQ 클러스터에 이벤트 전송</li><li>클러스터의 미러 큐가 장애 복구 지원</li><li>Consumer가 메시지 소비 및 사업 처리</li><li>Prometheus가 RabbitMQ 상태/메트릭 감시</li></ol><p><strong>핵심 역할</strong>:<br>RabbitMQ 클러스터는 이벤트 중개와 장애 복구, 모니터링(관측성)을 담당</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 서비스 장애 시 전체 결제/알림 시스템 중단</li><li>도입 후: 부분 장애 복구, 메시지 유실 방지 및 실시간 처리 유지</li></ul><p><strong>구현 예시(YAML, RabbitMQ 설정)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7>7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8>8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># RabbitMQ 미러 큐 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 장애 복구와 데이터 유실 방지 목적</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>policies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ha-all</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;.*&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>definition</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ha-mode</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ha-sync-mode</span><span class=p>:</span><span class=w> </span><span class=l>automatic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 동시 처리량 최대 10만 TPS 이상</li><li>운영 효율성: 장애 복구 자동화, 관리 대시보드 통한 실시간 모니터링</li><li>비용 절감: 유실 데이터 복구 비용 최소화, 운영 인력 감소</li></ul><hr><h2 id=phase-6-운영-및-최적화-operations--optimization>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization>#</a></h2><h3 id=61-보안-및-거버넌스>6.1 보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스>#</a></h3><ul><li>TLS(Transport Layer Security, 전송 계층 보안)로 메시지 전송 암호화</li><li>사용자 인증/인가(Access Control) 및 관리자 권한 분리</li><li>감사 로그(Logging)·컴플라이언스 준수(예: PCI DSS 등 금융 보안 기준)</li></ul><h3 id=62-모니터링-및-관측성>6.2 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성>#</a></h3><ul><li>Management Plugin 통해 실시간 큐 상태·용량·스루풋 모니터링</li><li>Prometheus·Grafana 연동 가능(메트릭 노출)</li><li>장애·지연·메시지 적체(Backlog) 자동 감지 및 알림(Alarm) 설정</li></ul><h3 id=63-실무-적용-고려사항-및-권장사항-분석표>6.3 실무 적용 고려사항 및 권장사항 분석표<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-권장사항-분석표>#</a></h3><blockquote><p>이 표는 RabbitMQ 운영 시 주요 고려사항 및 권장사항을 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 항목         | 주요 위험 | 권장사항                           | 효과             |
</span></span><span class=line><span class=cl>|--------------|----------|-------------------------------------|------------------|
</span></span><span class=line><span class=cl>| 클러스터링   | 노드 장애| 미러 큐/HA 전략 구성                | 데이터 유실 방지 |
</span></span><span class=line><span class=cl>| 성능최적화   | 메시지 적체| Prefetch/Parallel Consumer 설정      | 처리율 향상      |
</span></span><span class=line><span class=cl>| 보안         | 무단 접근| TLS·인증·권한 분리                  | 침해 위험 최소화 |
</span></span><span class=line><span class=cl>| 모니터링     | 장애 지연| 외부 모니터링 시스템 연동            | 빠른 대응        |
</span></span></code></pre></td></tr></table></div></div><h3 id=64-성능-최적화-전략-및-고려사항-분석표>6.4 성능 최적화 전략 및 고려사항 분석표<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항-분석표>#</a></h3><blockquote><p>이 표는 RabbitMQ 성능 및 운영 최적화 전략을 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분     | 전략           | 설명                 | 권장 환경     |
</span></span><span class=line><span class=cl>|----------|----------------|----------------------|--------------|
</span></span><span class=line><span class=cl>| 스케일링 | 노드·미러 확장  | 클러스터로 노드 확장  | TPS 증가      |
</span></span><span class=line><span class=cl>| 큐 설계  | 큐 분리/분산    | 주요 이벤트별 분산    | 대량 이벤트   |
</span></span><span class=line><span class=cl>| ACK 전략 | msg ack 조정    | 소비자 수동/자동 확인 | 저지연 환경   |
</span></span><span class=line><span class=cl>| 연결 관리| 연결 재사용     | Channel Pool 운용     | 고부하 상황   |
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=5단계-고급-주제-및-미래-방향성-phase-7--최종-정리>5단계: 고급 주제 및 미래 방향성 (Phase 7) + 최종 정리<a hidden class=anchor aria-hidden=true href=#5단계-고급-주제-및-미래-방향성-phase-7--최종-정리>#</a></h1><h2 id=phase-7-고급-주제-advanced-topics>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics>#</a></h2><h3 id=71-현재-도전-과제>7.1 현재 도전 과제<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제>#</a></h3><ul><li><p><strong>고성능 처리 한계:</strong> 수백만 TPS 이상 메시지 실시간 처리 시 Kafka와의 경쟁에서 성능 한계 존재</p><ul><li>원인: 메시지 저장 구조와 큐 기반 순차 읽기</li><li>영향: 대용량 이벤트·로그 시스템에서는 사용 제약</li><li>해결방안: 큐 분산 설계, 미러 큐 최적화, 클러스터링 강화 및 외부 캐시 연계</li></ul></li><li><p><strong>복합 이벤트 및 메시지 유실:</strong> 트랜잭션 보장, 메시지 유실 문제 발생 가능</p><ul><li>탐지/진단: Dead Letter Queue, 메시지 상태 추적</li><li>예방: 내구성/확인 모드 강화, 모니터링·알림 구축</li><li>해결기법: 미러 큐 복제, 메시지 재전송 자동화</li></ul></li></ul><h3 id=72-생태계-및-관련-기술-통합-연계-가능한-기술-표준-및-프로토콜>7.2 생태계 및 관련 기술 (통합 연계 가능한 기술, 표준 및 프로토콜)<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술-통합-연계-가능한-기술-표준-및-프로토콜>#</a></h3><ul><li>Kafka, Redis, AWS SQS, Azure ServiceBus 등 주요 메시지 브로커와 교차 운영</li><li>AMQP, MQTT, STOMP 등 표준 프로토콜 지원 (이종 시스템 연계 강화)</li><li>컨테이너 기반 환경(Kubernetes) 및 CI/CD와 통합</li><li>모니터링(관측성): Prometheus·Grafana 대시보드 연동</li></ul><h3 id=73-최신-기술-트렌드와-미래-방향>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향>#</a></h3><ul><li><strong>클라우드 네이티브 통합</strong>: RabbitMQ는 컨테이너·클라우드 기반 배포가 증가, 서버리스 이벤트·마이크로서비스 연계 강화</li><li><strong>자동화·운영 도구 고도화</strong>: 클러스터 자동복구·Self-Healing·자동 확장(Autoscaling) 기능 개발</li><li><strong>AI·머신러닝 이벤트 파이프라인</strong>: 실시간 데이터 처리 인프라로 RabbitMQ 활용 영역 확대 예상</li><li><strong>오픈소스 커뮤니티와 생태계 성장</strong>: 다양한 플러그인·통합 도구 지속 개발</li></ul><h3 id=74-기타-고급-사항전문가-레벨-고려사항>7.4 기타 고급 사항(전문가 레벨 고려사항)<a hidden class=anchor aria-hidden=true href=#74-기타-고급-사항전문가-레벨-고려사항>#</a></h3><ul><li>멀티테넌시(다중 사용자 환경) 지원 설계</li><li>규제준수(Compliance) 정책 적용 예시(금융, 헬스케어 등)</li><li>SLA(Service Level Agreement, 서비스 수준 협약) 기반 운영</li></ul><hr><h2 id=6단계-종합-정리-및-학습-가이드>6단계: 종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#6단계-종합-정리-및-학습-가이드>#</a></h2><h3 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><blockquote><p>이 표는 체계적인 학습을 위해 단계별 학습 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목                   | 중요도 | 학습 목표                    | 실무 연관성 | 설명                          |
</span></span><span class=line><span class=cl>|----------|-------|------------------------|--------|-----------------------------|-------------|-------------------------------|
</span></span><span class=line><span class=cl>| 기초     | 1     | 개념/등장배경/필요성   | 필수   | RabbitMQ 이해 및 맥락파악     | 높음        | 기본 메시지 브로커 동작 구조   |
</span></span><span class=line><span class=cl>| 핵심     | 2     | 아키텍트/구성/원리     | 필수   | 시스템 구조 및 동작원리 습득  | 높음        | 네트워크 및 큐 라우팅 이해    |
</span></span><span class=line><span class=cl>| 분석     | 3     | 장/단점, 트레이드오프  | 필수   | 기술선정 합리성 증대          | 높음        | 실무 적용시 고려포인트 정리   |
</span></span><span class=line><span class=cl>| 구현     | 4     | 배포/설정/프레임워크   | 권장   | 실제 설치·운영 방법 숙달      | 중간        | CLI/플러그인/클러스터링 실습  |
</span></span><span class=line><span class=cl>| 실습     | 5     | 실무 예제/도입사례     | 권장   | 현장 적용 경험 확장           | 중간        | Python 등 코드로 적용         |
</span></span><span class=line><span class=cl>| 운영     | 6     | 보안/관측성/최적화     | 필수   | 운영 효율화, 장애 대응 강화   | 높음        | 대시보드·모니터링 실습        |
</span></span><span class=line><span class=cl>| 고급     | 7     | 트렌드/연계/도전과제   | 선택   | 미래 기술 리더십 확보         | 낮음        | 클라우드·AI 연동 등 전망 정리 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h3><blockquote><p>이 표는 RabbitMQ 핵심 용어와 실무 적용 가능성을 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8>8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | 용어           | 정의                                     | 관련 개념          | 실무 활용          |
</span></span><span class=line><span class=cl>|----------|----------------|------------------------------------------|--------------------|--------------------|
</span></span><span class=line><span class=cl>| 핵심     | 메시지 브로커   | 시스템 간 메시지 중계, 데이터 흐름 관리   | MOM, AMQP          | 이벤트/데이터 처럼 |
</span></span><span class=line><span class=cl>| 핵심     | Exchange       | 메시지 라우팅, 다양한 분기 지원           | 라우팅 키, 타입     | 유연한 대기열 구성 |
</span></span><span class=line><span class=cl>| 핵심     | Queue          | 메시지 저장소, 소비 대기                  | Durable/Transient  | 장애 복구 핵심     |
</span></span><span class=line><span class=cl>| 구현     | Producer       | 메시지 발행 역할                         | API, 이벤트 소스    | 이벤트 소스 구현   |
</span></span><span class=line><span class=cl>| 구현     | Consumer       | 메시지 수신 및 처리 역할                  | ACK, 소비자 그룹    | 백엔드 서비스      |
</span></span><span class=line><span class=cl>| 운영     | 미러 큐        | 메시지 복제, 장애 복구 기능               | HA, 클러스터        | 데이터 유실 방지   |
</span></span><span class=line><span class=cl>| 운영     | Dead Letter    | 실패/에러 메시지 분리 저장                | 장애 탐지/복구      | 실시간 에러 추적   |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=참고-및-출처예시>참고 및 출처(예시)<a hidden class=anchor aria-hidden=true href=#참고-및-출처예시>#</a></h3><ul><li><a href=https://www.rabbitmq.com/>RabbitMQ 공식 문서</a></li><li><a href=https://aws.amazon.com/ko/compare/the-difference-between-rabbitmq-and-kafka/>Kafka와 RabbitMQ 비교 분석 블로그</a></li><li><a href=https://www.codenary.co.kr/techstack/detail/rabbitmq>실무 도입 사례: 금융 결제 이벤트 백엔드</a></li><li><a href=https://velog.io/@sdb016/RabbitMQ-%EA%B8%B0%EC%B4%88-%EA%B0%9C%EB%85%90>RabbitMQ 구조와 활용 설명 블로그</a></li></ul><hr><h2 id=실무-학습-가이드>실무 학습 가이드<a hidden class=anchor aria-hidden=true href=#실무-학습-가이드>#</a></h2><ul><li><strong>Step 1:</strong> 메시징 시스템 기본 이해 및 AMQP 프로토콜 습득</li><li><strong>Step 2:</strong> Exchange/Queue 구조와 라우팅 원리 실습</li><li><strong>Step 3:</strong> 장점/단점, 트레이드오프 분석을 통한 실무 시나리오 설계</li><li><strong>Step 4:</strong> 실습용 코드 구현, 클러스터·미러·모니터링 구성 익히기</li><li><strong>Step 5:</strong> 성능 최적화, 보안/관측성/장애 복구 운영 전략 습득</li><li><strong>Step 6:</strong> 최신 트렌드·클라우드 연계·AI 파이프라인 등 고급 기술 확장</li></ul><p>RabbitMQ는 실시간 비동기 메시징의 확장성과 신뢰성을 갖춘 표준 솔루션으로, 실무에서는 기본 구조와 운영 최적화 방법, 그리고 최신 트렌드 반영이 핵심입니다. 각 단계별로 꼼꼼하게 학습하면, 실전 환경에서 바로 적용하는 역량을 갖출 수 있습니다.</p><h1 id=rabbitmq-실전-학습-및-적용-마무리>RabbitMQ 실전 학습 및 적용 마무리<a hidden class=anchor aria-hidden=true href=#rabbitmq-실전-학습-및-적용-마무리>#</a></h1><hr><h2 id=실무-적용-가이드>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드>#</a></h2><h3 id=1-현장-도입-best-practice>1. 현장 도입 Best Practice<a hidden class=anchor aria-hidden=true href=#1-현장-도입-best-practice>#</a></h3><ul><li><strong>환경 구성:</strong> 개발, QA, 운영 등 각 환경별 RabbitMQ 독립 인스턴스 구성</li><li><strong>배포 방식:</strong> 컨테이너(Docker) 기반 및 Kubernetes(컨테이너 오케스트레이션) 연동 배포 추천</li><li><strong>클러스터/미러 큐:</strong> 주요 메시지 및 서비스별 미러 큐(HA, 고가용성) 정책 설계</li><li><strong>네트워크/보안:</strong> TLS/SSL 기반 암호화, 인증·권한 관리, 방화벽·VPC(프라이빗 네트워크) 구성</li><li><strong>모니터링:</strong> Management Plugin + 외부(예: Prometheus, Grafana) 실시간 통합 대시보드 구축</li><li><strong>장애 대응:</strong> Dead Letter Queue 및 자동 복구 전략 필수 적용</li></ul><h3 id=2-실전-배포-체크리스트>2. 실전 배포 체크리스트<a hidden class=anchor aria-hidden=true href=#2-실전-배포-체크리스트>#</a></h3><table><thead><tr><th>체크 항목</th><th>설명</th><th>실무 효과</th></tr></thead><tbody><tr><td>독립 환경 분리</td><td>개발/운영 격리, 실수·장애 확산 방지</td><td>검증 효율성·안정성</td></tr><tr><td>프로토콜·암호화 설정</td><td>AMQP, TLS/SSL 적용, 인증서 관리</td><td>데이터 침해·유출 방지</td></tr><tr><td>동적 확장(RabbitMQ Cluster)</td><td>메시지/큐별 노드 할당, 오토스케일링 도입</td><td>장애 복구·고가용성</td></tr><tr><td>관측성(Observability) 강화</td><td>메트릭 노출, 경보(Alarm), 자동 장애 감지</td><td>운영 리소스 최적화</td></tr><tr><td>백업·복구/장애 대응 구축</td><td>미러 큐, 메시지 내구성(ack), DLX 적용</td><td>데이터 유실 방지</td></tr></tbody></table><hr><h2 id=학습-로드맵-우선순위>학습 로드맵 우선순위<a hidden class=anchor aria-hidden=true href=#학습-로드맵-우선순위>#</a></h2><ol><li><strong>메시지 브로커와 AMQP 프로토콜 개념 습득</strong></li><li><strong>RabbitMQ 구성 요소·Exchange/Queue/Consumer 원리 실습</strong></li><li><strong>운영/모니터링·장애 대응·보안 설정</strong></li><li><strong>실전 배포 예제와 HA 클러스터 구축</strong></li><li><strong>최적화·성능관리·대형 서비스 확장 방법 익히기</strong></li><li><strong>클라우드 네이티브·자동화·AI 요건 및 트렌드 분석</strong></li></ol><hr><h2 id=실무자-qa>실무자 Q&amp;A<a hidden class=anchor aria-hidden=true href=#실무자-qa>#</a></h2><p><strong>Q1: RabbitMQ 운영 중 갑자기 메시지가 지연·적체된다면?</strong></p><ul><li>Consumer, Queue 처리 속도, 네트워크·스토리지 이슈 진단</li><li>Prefetch, ACK 모드, 큐/노드 확장 등 실시간 조치</li></ul><p><strong>Q2: RabbitMQ와 Kafka, 언제 어떤 상황에 더 적합한가?</strong></p><ul><li>RabbitMQ: 다중 서비스 통합, 신뢰성, 다양한 라우팅, 빠른 장애 복구</li><li>Kafka: 초대량 이벤트/로그 스트리밍, 대규모 TPS, 이벤트 소싱</li></ul><p><strong>Q3: RabbitMQ 보안 강화는 어떻게?</strong></p><ul><li>TLS/SSL 암호화, 사용자 인증·권한 세분화, 감사로그 및 컴플라이언스 정책 적용</li></ul><hr><h2 id=실전-적용-시-유의사항>실전 적용 시 유의사항<a hidden class=anchor aria-hidden=true href=#실전-적용-시-유의사항>#</a></h2><ul><li>큐별 메시지 TTL(지속시간), 최대 크기, 소비자 병렬 처리 설정</li><li>모니터링 데이터와 장애 대비 자동화(E-mail, Webhook, 슬랙 연동)</li><li>주요 정책(Policy, 미러 큐, DLX 등)은 운영 환경에 맞게 주기적 점검</li><li>대용량/실시간 환경에서는 클러스터 스케일업·스케일아웃 전략 동시 적용</li></ul><hr><h2 id=정리>정리<a hidden class=anchor aria-hidden=true href=#정리>#</a></h2><p>RabbitMQ는 단순한 메시지 브로커를 넘어, 현대 소프트웨어 생태계의 인프라 및 서비스 통합·비동기 이벤트 처리의 핵심 도구입니다. 메시지 전달 신뢰성, 장애 복구력, 유연한 라우팅, 클라우드 친화적 확장성까지 모두 갖추고 있어 실무 현장의 요구를 폭넓게 만족시킵니다.<br>위의 구조화된 단계별 가이드와 실습·운영 체크리스트를 따라가면 초심자부터 전문가까지, 각자의 필요에 맞춰 RabbitMQ를 실전에서 즉시 활용할 수 있을 것입니다.</p><hr><p>안녕하세요! 소프트웨어 아키텍처 및 시스템 설계 전문가로서 RabbitMQ에 대한 종합적인 조사를 시작하겠습니다.</p><p>먼저 RabbitMQ의 최신 동향과 현재 상황을 파악해보겠습니다.</p><h2 id=rabbitmq-종합-조사-및-분석>RabbitMQ 종합 조사 및 분석<a hidden class=anchor aria-hidden=true href=#rabbitmq-종합-조사-및-분석>#</a></h2><p>안녕하세요! 소프트웨어 아키텍처 및 시스템 설계 전문가로서 RabbitMQ에 대한 종합적인 조사를 진행하겠습니다.</p><hr><h2 id=1단계-기본-분석-및-검증-1>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-1>#</a></h2><h3 id=대표-태그-생성>대표 태그 생성<a hidden class=anchor aria-hidden=true href=#대표-태그-생성>#</a></h3><ul><li><strong>Message-Broker</strong> (메시지 브로커)</li><li><strong>Event-Driven-Architecture</strong> (이벤트 기반 아키텍처)</li><li><strong>Asynchronous-Communication</strong> (비동기 통신)</li><li><strong>AMQP-Protocol</strong> (AMQP 프로토콜)</li></ul><h3 id=분류-체계-검증>분류 체계 검증<a hidden class=anchor aria-hidden=true href=#분류-체계-검증>#</a></h3><p><strong>현재 분류</strong>: Tool Reference > Communication Technologies > Message Brokers</p><p><strong>분류 적절성 평가</strong>: ✅ <strong>매우 적절함</strong></p><ul><li><strong>근거</strong>: RabbitMQ는 애플리케이션 간 통신을 담당하는 메시지 브로커로서 Communication Technologies 하위의 Message Brokers 분류가 정확함</li><li><strong>개선 제안</strong>: 현재 분류 체계가 이미 최적화되어 있어 추가 개선 불필요</li></ul><h3 id=핵심-요약-250자-이내>핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#핵심-요약-250자-이내>#</a></h3><p>RabbitMQ는 AMQP (Advanced Message Queuing Protocol) 기반의 오픈소스 메시지 브로커로, 분산 시스템에서 서비스 간 안정적이고 비동기적인 메시지 전달을 담당합니다. Exchange-Queue-Binding 구조를 통한 유연한 라우팅, 메시지 지속성, 클러스터링을 지원하며, 마이크로서비스 아키텍처의 핵심 구성 요소로 널리 활용됩니다.</p><h3 id=전체-개요-및-학습-방향성-400자-이내>전체 개요 및 학습 방향성 (400자 이내)<a hidden class=anchor aria-hidden=true href=#전체-개요-및-학습-방향성-400자-이내>#</a></h3><p>RabbitMQ는 Erlang 언어로 개발된 고성능 메시지 브로커로, 2024년 출시된 4.0 버전에서 AMQP 1.0 네이티브 지원과 Khepri (Raft 합의 알고리즘) 기반 메타데이터 저장소를 도입했습니다. 학습 방향성은 기본 메시징 개념부터 시작하여 Exchange 타입별 라우팅 패턴, 클러스터링과 고가용성 구성, 성능 최적화까지 단계적으로 접근하는 것이 효과적입니다. 특히 실무에서는 Docker/Kubernetes 환경에서의 운영과 모니터링, 보안 설정이 핵심입니다.</p><hr><h2 id=2단계-개념-체계화-및-검증-1>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증-1>#</a></h2><h3 id=핵심-개념-정리>핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#핵심-개념-정리>#</a></h3><h4 id=이론적-관점>이론적 관점<a hidden class=anchor aria-hidden=true href=#이론적-관점>#</a></h4><ul><li><strong>메시지 큐잉 이론</strong>: 생산자-소비자 패턴을 통한 비동기 통신</li><li><strong>라우팅 알고리즘</strong>: Exchange 타입별 메시지 분배 메커니즘</li><li><strong>분산 합의</strong>: Raft 알고리즘 기반 클러스터 동기화</li></ul><h4 id=실무적-관점>실무적 관점<a hidden class=anchor aria-hidden=true href=#실무적-관점>#</a></h4><ul><li><strong>Exchange-Queue-Binding</strong>: 실제 메시지 흐름 제어 구조</li><li><strong>채널과 연결</strong>: 리소스 효율적인 통신 관리</li><li><strong>확인 응답 메커니즘</strong>: 메시지 전달 보장</li></ul><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><ul><li><strong>Virtual Host</strong>: 논리적 네임스페이스 분리</li><li><strong>Routing Key</strong>: 메시지 라우팅 규칙</li><li><strong>Consumer Acknowledgment</strong>: 메시지 처리 확인</li></ul><h4 id=심화-개념>심화 개념<a hidden class=anchor aria-hidden=true href=#심화-개념>#</a></h4><ul><li><strong>Quorum Queue</strong>: 고가용성 큐 구현</li><li><strong>Streams</strong>: 대용량 로그형 데이터 처리</li><li><strong>메시지 인터셉터</strong>: RabbitMQ 4.0 신기능</li></ul><h3 id=실무-연관성-분석>실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#실무-연관성-분석>#</a></h3><p>각 핵심 개념들은 다음과 같이 실무에 직접 연결됩니다:</p><ul><li><strong>Exchange 패턴</strong> → 마이크로서비스 간 통신 설계</li><li><strong>클러스터링</strong> → 고가용성 인프라 구축</li><li><strong>모니터링 메트릭</strong> → 운영 상태 감시</li><li><strong>보안 설정</strong> → 기업 환경 보안 정책 준수</li></ul><hr><h2 id=3단계-phase-1-2-조사-기초-개념-및-핵심-원리>3단계: Phase 1-2 조사 (기초 개념 및 핵심 원리)<a hidden class=anchor aria-hidden=true href=#3단계-phase-1-2-조사-기초-개념-및-핵심-원리>#</a></h2><h2 id=phase-1-기초-개념-foundation-understanding-1>Phase 1: 기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념-foundation-understanding-1>#</a></h2><h3 id=11-개념-정의-및-본질적-이해-1>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해-1>#</a></h3><p><strong>RabbitMQ</strong>는 **메시지 지향 미들웨어 (Message-Oriented Middleware)**로서, 애플리케이션과 서비스 간의 <strong>비동기 메시지 전달</strong>을 담당하는 오픈소스 메시지 브로커입니다.</p><h4 id=핵심-정의>핵심 정의<a hidden class=anchor aria-hidden=true href=#핵심-정의>#</a></h4><ul><li><strong>메시지 브로커 (Message Broker)</strong>: 송신자와 수신자 사이에서 메시지를 중계하는 중간 소프트웨어</li><li><strong>AMQP (Advanced Message Queuing Protocol)</strong>: 메시지 큐잉을 위한 표준 프로토콜</li><li><strong>발행-구독 패턴 (Publish-Subscribe)</strong>: 생산자가 메시지를 발행하면 관심 있는 소비자가 구독하여 처리하는 패턴</li></ul><h4 id=본질적-특성>본질적 특성<a hidden class=anchor aria-hidden=true href=#본질적-특성>#</a></h4><p>RabbitMQ의 본질은 **&ldquo;신뢰할 수 있는 메시지 전달 보장&rdquo;**과 **&ldquo;서비스 간 결합도 감소&rdquo;**입니다. 이를 통해 분산 시스템에서 각 구성 요소가 독립적으로 개발, 배포, 확장될 수 있도록 지원합니다.</p><h3 id=12-등장-배경-및-발전-과정-1>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정-1>#</a></h3><h4 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h4><p><strong>2007년</strong> Rabbit Technologies에서 개발 시작, <strong>2010년</strong> VMware 인수 후 본격적인 발전이 시작되었습니다.</p><h4 id=주요-발전-단계>주요 발전 단계<a hidden class=anchor aria-hidden=true href=#주요-발전-단계>#</a></h4><pre class=mermaid>timeline
    title RabbitMQ 발전 과정
    2007 : Rabbit Technologies 개발 시작
         : AMQP 0.8 지원
    2010 : VMware 인수
         : 기업용 기능 강화
    2013 : Pivotal Software로 이관
         : 클러스터링 개선
    2019 : VMware Tanzu 통합
         : 클라우드 네이티브 지원
    2024 : RabbitMQ 4.0 출시
         : AMQP 1.0 네이티브 지원
         : Khepri 메타데이터 저장소
</pre><h4 id=기술적-진화>기술적 진화<a hidden class=anchor aria-hidden=true href=#기술적-진화>#</a></h4><ul><li><strong>AMQP 0.9.1</strong> → <strong>AMQP 1.0</strong>: 프로토콜 표준화 완성</li><li><strong>Mnesia</strong> → <strong>Khepri</strong>: Raft 알고리즘 기반 분산 저장소</li><li><strong>단일 노드</strong> → <strong>클러스터링</strong>: 고가용성 및 확장성 지원</li></ul><h3 id=13-핵심-목적-및-필요성-문제-해결-관점>1.3 핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-문제-해결-관점>#</a></h3><h4 id=해결하는-핵심-문제>해결하는 핵심 문제<a hidden class=anchor aria-hidden=true href=#해결하는-핵심-문제>#</a></h4><p><strong>분산 시스템 통신의 복잡성</strong></p><ul><li><strong>문제</strong>: 마이크로서비스 간 직접 통신 시 네트워크 장애, 서비스 다운타임에 취약</li><li><strong>해결</strong>: 메시지 큐를 통한 비동기 통신으로 장애 격리</li></ul><p><strong>서비스 간 강결합</strong></p><ul><li><strong>문제</strong>: API 직접 호출로 인한 서비스 간 의존성 증가</li><li><strong>해결</strong>: 메시지 기반 느슨한 결합 구조 제공</li></ul><p><strong>부하 분산 및 확장성</strong></p><ul><li><strong>문제</strong>: 특정 서비스에 요청 집중 시 성능 저하</li><li><strong>해결</strong>: 큐를 통한 작업 분산 및 컨슈머 확장</li></ul><p><strong>데이터 일관성 보장</strong></p><ul><li><strong>문제</strong>: 분산 트랜잭션 처리의 복잡성</li><li><strong>해결</strong>: 이벤트 소싱과 Saga 패턴 지원</li></ul><h3 id=14-주요-특징-및-차별점-기술적-근거-포함-1>1.4 주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점-기술적-근거-포함-1>#</a></h3><h4 id=rabbitmq만의-독특한-특징>RabbitMQ만의 독특한 특징<a hidden class=anchor aria-hidden=true href=#rabbitmq만의-독특한-특징>#</a></h4><p><strong>1. Exchange-Queue-Binding 아키텍처</strong></p><pre class=mermaid>graph LR
    P[Producer] --&gt; E[Exchange]
    E --&gt; |Binding| Q1[Queue 1]
    E --&gt; |Binding| Q2[Queue 2]
    Q1 --&gt; C1[Consumer 1]
    Q2 --&gt; C2[Consumer 2]
</pre><p><strong>기술적 근거</strong>: Exchange가 라우팅 논리를 담당하고 Queue가 저장을 담당하는 <strong>관심사 분리 원칙</strong> 적용</p><p><strong>2. 다양한 Exchange 타입</strong></p><ul><li><strong>Direct</strong>: 정확한 라우팅 키 매칭</li><li><strong>Fanout</strong>: 모든 바인딩된 큐로 브로드캐스트</li><li><strong>Topic</strong>: 패턴 기반 라우팅</li><li><strong>Headers</strong>: 메시지 헤더 기반 라우팅</li></ul><p><strong>3. 메시지 지속성 및 확인 응답</strong></p><ul><li><strong>Publisher Confirms</strong>: 메시지 발행 확인</li><li><strong>Consumer Acknowledgments</strong>: 메시지 처리 확인</li><li><strong>Durable Queues</strong>: 서버 재시작에도 큐 보존</li></ul><p><strong>4. Erlang 기반 고가용성</strong>
<strong>기술적 근거</strong>: Erlang의 Actor 모델과 Supervisor 패턴을 활용한 <strong>&ldquo;Let it crash&rdquo;</strong> 철학으로 장애 자동 복구</p><h2 id=phase-2-핵심-원리-core-theory-1>Phase 2: 핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리-core-theory-1>#</a></h2><h3 id=21-핵심-설계-원칙-및-철학-1>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학-1>#</a></h3><h4 id=설계-철학>설계 철학<a hidden class=anchor aria-hidden=true href=#설계-철학>#</a></h4><p><strong>1. 신뢰성 우선 (Reliability First)</strong>
RabbitMQ는 성능보다 <strong>메시지 전달 보장</strong>을 우선시합니다. 이는 금융, 헬스케어 등 미션 크리티컬한 환경에서 필수적입니다.</p><p><strong>2. 유연한 라우팅 (Flexible Routing)</strong>
고정된 토픽이 아닌 <strong>동적 라우팅 규칙</strong>을 통해 복잡한 메시지 흐름을 지원합니다.</p><p><strong>3. 표준 준수 (Standards Compliance)</strong>
AMQP, MQTT, STOMP 등 <strong>개방형 표준 프로토콜</strong>을 지원하여 벤더 종속성을 방지합니다.</p><p><strong>4. 관리 용이성 (Manageability)</strong>
웹 기반 관리 UI와 REST API를 통한 <strong>운영 친화적 설계</strong>를 제공합니다.</p><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><p><strong>관심사 분리 (Separation of Concerns)</strong></p><ul><li>Exchange: 라우팅 논리</li><li>Queue: 메시지 저장</li><li>Channel: 프로토콜 멀티플렉싱</li><li>Connection: 네트워크 연결</li></ul><p><strong>확장성 (Scalability)</strong></p><ul><li>수평적 확장: 클러스터 노드 추가</li><li>수직적 확장: 큐별 샤딩 지원</li></ul><h3 id=22-기본-원리-및-동작-메커니즘-1>2.2 기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘-1>#</a></h3><h4 id=메시지-흐름-다이어그램>메시지 흐름 다이어그램<a hidden class=anchor aria-hidden=true href=#메시지-흐름-다이어그램>#</a></h4><pre class=mermaid>sequenceDiagram
    participant P as Producer
    participant E as Exchange  
    participant Q as Queue
    participant C as Consumer
    
    P-&gt;&gt;E: 1. Publish Message
    E-&gt;&gt;Q: 2. Route to Queue
    Q-&gt;&gt;Q: 3. Store Message
    C-&gt;&gt;Q: 4. Consume Message
    Q-&gt;&gt;C: 5. Deliver Message
    C-&gt;&gt;Q: 6. Send ACK
    Q-&gt;&gt;Q: 7. Remove Message
</pre><h4 id=핵심-동작-메커니즘>핵심 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#핵심-동작-메커니즘>#</a></h4><p><strong>1. 연결 및 채널 관리</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ 연결 및 채널 관리 예시</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TCP 연결 생성 (비용이 높은 작업)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 채널 생성 (가벼운 논리적 연결)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 채널 내에서 여러 작업 수행</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=s1>&#39;Hello World!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 메시지 지속성</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. Exchange 기반 라우팅</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Direct Exchange - 정확한 키 매칭</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;direct_logs&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;direct&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;direct_logs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;error&#39;</span><span class=p>,</span>  <span class=c1># 라우팅 키 지정</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=s1>&#39;Error message&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Topic Exchange - 패턴 매칭</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;topic_logs&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;topic&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;topic_logs&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;user.signup.email&#39;</span><span class=p>,</span>  <span class=c1># 계층적 키</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=s1>&#39;User signup notification&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>3. 메시지 확인 응답 (Acknowledgment)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing: </span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 비즈니스 로직 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>process_message</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 처리 성공 시 ACK</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 처리 실패 시 NACK (재시도 또는 DLQ 이동)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>requeue</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>auto_ack</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># 수동 ACK 모드</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=23-아키텍처-및-구성-요소-1>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소-1>#</a></h3><h4 id=전체-아키텍처-다이어그램>전체 아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#전체-아키텍처-다이어그램>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;Client Applications&#34;
        P1[Producer 1]
        P2[Producer 2] 
        C1[Consumer 1]
        C2[Consumer 2]
    end
    
    subgraph &#34;RabbitMQ Cluster&#34;
        subgraph &#34;Node 1&#34;
            E1[Exchanges]
            Q1[Queues]
            B1[Bindings]
        end
        
        subgraph &#34;Node 2&#34;
            E2[Exchanges]
            Q2[Queues] 
            B2[Bindings]
        end
        
        subgraph &#34;Node 3&#34;
            E3[Exchanges]
            Q3[Queues]
            B3[Bindings]
        end
    end
    
    subgraph &#34;Management &amp; Monitoring&#34;
        UI[Management UI]
        API[REST API]
        PROM[Prometheus Metrics]
    end
    
    P1 --&gt; E1
    P2 --&gt; E2
    Q1 --&gt; C1
    Q2 --&gt; C2
    
    E1 -.-&gt; Q1
    E1 -.-&gt; Q2
    
    Node1 -.-&gt; Node2
    Node2 -.-&gt; Node3
    Node3 -.-&gt; Node1
</pre><h4 id=핵심-구성-요소>핵심 구성 요소<a hidden class=anchor aria-hidden=true href=#핵심-구성-요소>#</a></h4><p><strong>필수 구성 요소</strong></p><p><strong>1. Broker (브로커)</strong></p><ul><li><strong>역할</strong>: 메시지 라우팅과 저장을 담당하는 핵심 서버</li><li><strong>구현</strong>: Erlang VM 위에서 실행되는 프로세스</li></ul><p><strong>2. Virtual Host (가상 호스트)</strong></p><ul><li><strong>역할</strong>: 논리적 네임스페이스 제공, 멀티 테넌시 지원</li><li><strong>구현</strong>: Exchange, Queue, Binding의 격리된 그룹</li></ul><p><strong>3. Exchange (교환기)</strong></p><ul><li><strong>역할</strong>: 메시지 라우팅 규칙 정의 및 실행</li><li><strong>타입</strong>: Direct, Fanout, Topic, Headers</li></ul><p><strong>4. Queue (큐)</strong></p><ul><li><strong>역할</strong>: 메시지 저장 및 컨슈머에게 전달</li><li><strong>타입</strong>: Classic, Quorum, Stream</li></ul><p><strong>5. Binding (바인딩)</strong></p><ul><li><strong>역할</strong>: Exchange와 Queue 간의 라우팅 규칙 정의</li><li><strong>구성</strong>: Routing Key, Arguments</li></ul><p><strong>선택적 구성 요소</strong></p><p><strong>6. Plugin System (플러그인 시스템)</strong></p><ul><li><strong>관리 UI</strong>: rabbitmq-management</li><li><strong>프로토콜 지원</strong>: rabbitmq-mqtt, rabbitmq-stomp</li><li><strong>인증</strong>: rabbitmq-auth-backend-ldap</li></ul><p><strong>7. Clustering (클러스터링)</strong></p><ul><li><strong>고가용성</strong>: 노드 간 메타데이터 복제</li><li><strong>확장성</strong>: 워크로드 분산</li></ul><h3 id=24-주요-기능과-역할-1>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할-1>#</a></h3><h4 id=기능별-책임-명확화>기능별 책임 명확화<a hidden class=anchor aria-hidden=true href=#기능별-책임-명확화>#</a></h4><blockquote><p>이 표는 RabbitMQ의 주요 기능과 각 구성 요소의 책임을 명확히 구분하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>기능</th><th>담당 구성 요소</th><th>상호 관계</th><th>비즈니스 영향</th></tr></thead><tbody><tr><td><strong>라우팅</strong></td><td>메시지 경로 결정</td><td>Exchange</td><td>Binding과 협력하여 규칙 적용</td><td>비즈니스 로직에 따른 메시지 분류</td></tr><tr><td><strong>저장</strong></td><td>메시지 지속성 보장</td><td>Queue</td><td>Disk/Memory에 메시지 보관</td><td>시스템 장애 시 데이터 손실 방지</td></tr><tr><td><strong>전달</strong></td><td>컨슈머에게 메시지 배송</td><td>Channel</td><td>Queue와 Consumer 연결</td><td>서비스 간 안정적 통신 보장</td></tr><tr><td><strong>확인</strong></td><td>메시지 처리 검증</td><td>Consumer</td><td>Publisher/Queue와 ACK 교환</td><td>메시지 처리 완료 보장</td></tr><tr><td><strong>복제</strong></td><td>고가용성 제공</td><td>Cluster</td><td>노드 간 메타데이터 동기화</td><td>서비스 중단 없는 운영</td></tr><tr><td><strong>관리</strong></td><td>시스템 운영 지원</td><td>Management Plugin</td><td>REST API를 통한 제어</td><td>운영팀의 효율적 관리</td></tr></tbody></table><h4 id=핵심-기능-상세>핵심 기능 상세<a hidden class=anchor aria-hidden=true href=#핵심-기능-상세>#</a></h4><p><strong>1. 메시지 라우팅</strong></p><ul><li><strong>Smart Routing</strong>: Exchange 타입에 따른 지능적 라우팅</li><li><strong>Load Balancing</strong>: 여러 컨슈머 간 메시지 분산</li><li><strong>Priority Queues</strong>: 메시지 우선순위 기반 처리</li></ul><p><strong>2. 내구성 및 신뢰성</strong></p><ul><li><strong>Message Persistence</strong>: 디스크 기반 메시지 저장</li><li><strong>Replication</strong>: Quorum Queue를 통한 데이터 복제</li><li><strong>Transactions</strong>: 원자적 메시지 처리</li></ul><p><strong>3. 확장성 및 성능</strong></p><ul><li><strong>Clustering</strong>: 수평적 확장 지원</li><li><strong>Sharding</strong>: 메시지 분산 처리</li><li><strong>Flow Control</strong>: 백프레셔를 통한 성능 조절</li></ul><p><strong>4. 모니터링 및 관리</strong></p><ul><li><strong>Metrics</strong>: Prometheus 연동 메트릭 수집</li><li><strong>Logging</strong>: 구조화된 로그 출력</li><li><strong>Tracing</strong>: 메시지 흐름 추적</li></ul><hr><h2 id=4단계-phase-3-4-조사-특성-분석-및-구현-방법>4단계: Phase 3-4 조사 (특성 분석 및 구현 방법)<a hidden class=anchor aria-hidden=true href=#4단계-phase-3-4-조사-특성-분석-및-구현-방법>#</a></h2><h2 id=phase-3-특성-분석-characteristics-analysis-1>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis-1>#</a></h2><h3 id=31-장점-및-이점>3.1 장점 및 이점<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점>#</a></h3><blockquote><p>이 표는 RabbitMQ의 장점과 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td><strong>신뢰성</strong></td><td>메시지 전달 보장</td><td>Publisher Confirms와 Consumer ACK를 통한 완벽한 메시지 추적</td><td>AMQP 프로토콜의 at-least-once 전달 보장 메커니즘</td><td>금융, 결제 시스템에서 데이터 손실 제로 달성</td></tr><tr><td><strong>유연성</strong></td><td>동적 라우팅</td><td>Exchange-Binding 구조를 통한 런타임 라우팅 규칙 변경</td><td>라우팅 논리와 저장 논리의 완전한 분리 설계</td><td>비즈니스 요구사항 변경 시 코드 수정 없이 설정만으로 대응</td></tr><tr><td><strong>확장성</strong></td><td>수평적 스케일링</td><td>클러스터 노드 추가를 통한 선형적 성능 증가</td><td>Erlang의 액터 모델 기반 분산 처리 아키텍처</td><td>트래픽 증가에 따른 비용 효율적 확장</td></tr><tr><td><strong>표준성</strong></td><td>프로토콜 호환성</td><td>AMQP, MQTT, STOMP 등 다중 프로토콜 지원</td><td>플러그인 아키텍처를 통한 프로토콜 추상화</td><td>기존 시스템과의 원활한 통합 및 벤더 락인 방지</td></tr><tr><td><strong>관리성</strong></td><td>운영 편의성</td><td>웹 UI와 REST API를 통한 직관적 관리</td><td>Erlang의 실시간 시스템 모니터링 기능 활용</td><td>운영팀의 학습 비용 절감 및 장애 대응 시간 단축</td></tr><tr><td><strong>성능</strong></td><td>저지연 처리</td><td>In-memory 메시지 처리와 배치 확인 응답</td><td>Erlang VM의 경량 프로세스와 비선점형 스케줄링</td><td>실시간 알림, IoT 데이터 처리에서 밀리초 단위 지연 시간</td></tr></tbody></table><h3 id=32-단점-및-제약사항과-해결방안>3.2 단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#32-단점-및-제약사항과-해결방안>#</a></h3><blockquote><p>이 표는 RabbitMQ의 단점과 제약사항, 그리고 해결방안을 종합적으로 분석하기 위해 작성되었습니다.</p></blockquote><p><strong>단점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td><strong>성능</strong></td><td>높은 처리량 한계</td><td>Kafka 대비 상대적으로 낮은 스루풋 (50K msg/s vs 1M msg/s)</td><td>Stream 타입 큐 사용, 배치 처리 도입</td><td>Apache Kafka, Apache Pulsar</td></tr><tr><td><strong>복잡성</strong></td><td>설정 복잡도</td><td>Exchange-Queue-Binding 구조 이해 필요</td><td>표준 패턴 템플릿 제공, 자동화 도구 활용</td><td>Redis Pub/Sub, AWS SQS</td></tr><tr><td><strong>리소스</strong></td><td>메모리 사용량</td><td>큐 크기에 비례한 메모리 소비 증가</td><td>Lazy Queue 모드, TTL 설정, DLQ 구성</td><td>Apache Kafka (디스크 기반)</td></tr><tr><td><strong>확장성</strong></td><td>큐별 병목</td><td>단일 큐는 하나의 코어만 사용</td><td>큐 샤딩, 파티셔닝 전략 적용</td><td>Apache Kafka (파티션), Apache Pulsar</td></tr></tbody></table><p><strong>문제점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td><strong>메모리</strong></td><td>메모리 부족</td><td>컨슈머 처리 속도 &lt; 프로듀서 발행 속도</td><td>브로커 응답 지연, OOM 위험</td><td>Memory 알람, Queue 깊이 모니터링</td><td>Flow Control 설정, Consumer 스케일링</td><td>Lazy Queue 전환, 추가 Consumer 배포</td></tr><tr><td><strong>클러스터</strong></td><td>Split-brain</td><td>네트워크 분할로 인한 클러스터 분리</td><td>데이터 불일치, 중복 처리</td><td>클러스터 상태 모니터링</td><td>홀수 노드 구성, 네트워크 이중화</td><td>수동 클러스터 복구, Quorum Queue 사용</td></tr><tr><td><strong>성능</strong></td><td>Publisher 차단</td><td>Flow Control로 인한 발행 제한</td><td>애플리케이션 응답 지연</td><td>Publishing Rate 메트릭</td><td>Consumer 증설, Prefetch 튜닝</td><td>비동기 발행 패턴 도입</td></tr><tr><td><strong>연결</strong></td><td>연결 누수</td><td>애플리케이션에서 연결 해제 미처리</td><td>브로커 리소스 고갈</td><td>Connection 수 모니터링</td><td>Connection Pool 사용</td><td>강제 연결 해제, 애플리케이션 수정</td></tr></tbody></table><h3 id=33-트레이드오프-관계-분석-1>3.3 트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#33-트레이드오프-관계-분석-1>#</a></h3><h4 id=핵심-트레이드오프>핵심 트레이드오프<a hidden class=anchor aria-hidden=true href=#핵심-트레이드오프>#</a></h4><p><strong>1. 신뢰성 vs 성능</strong></p><ul><li><strong>신뢰성 우선</strong>: Publisher Confirms + Consumer ACK + Durable Queue<ul><li>장점: 메시지 손실 제로</li><li>단점: 50% 이상 성능 저하</li></ul></li><li><strong>성능 우선</strong>: Auto ACK + Non-durable Queue<ul><li>장점: 최대 처리량 달성</li><li>단점: 시스템 장애 시 메시지 손실 위험</li></ul></li></ul><p><strong>2. 유연성 vs 복잡성</strong></p><ul><li><strong>높은 유연성</strong>: Exchange-Queue-Binding 활용<ul><li>장점: 복잡한 라우팅 패턴 구현 가능</li><li>단점: 설정 및 관리 복잡도 증가</li></ul></li><li><strong>단순성</strong>: Direct Queue 사용<ul><li>장점: 설정 및 운영 단순화</li><li>단점: 제한적인 라우팅 기능</li></ul></li></ul><p><strong>3. 일관성 vs 가용성</strong></p><ul><li><strong>일관성 우선</strong>: Quorum Queue + 동기 복제<ul><li>장점: 강력한 데이터 일관성 보장</li><li>단점: 네트워크 지연에 취약, 성능 저하</li></ul></li><li><strong>가용성 우선</strong>: Classic Queue + 비동기 복제<ul><li>장점: 높은 처리량과 가용성</li><li>단점: 데이터 불일치 가능성</li></ul></li></ul><h3 id=34-성능-특성-및-확장성-분석-1>3.4 성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#34-성능-특성-및-확장성-분석-1>#</a></h3><h4 id=성능-벤치마크-rabbitmq-40-기준>성능 벤치마크 (RabbitMQ 4.0 기준)<a hidden class=anchor aria-hidden=true href=#성능-벤치마크-rabbitmq-40-기준>#</a></h4><p><strong>처리량 성능</strong></p><ul><li><strong>Classic Queue</strong>: 50,000 msg/sec (16 byte), 20,000 msg/sec (1KB)</li><li><strong>Quorum Queue</strong>: 30,000 msg/sec (안정성 강화)</li><li><strong>Stream</strong>: 300,000 msg/sec (로그 형태 데이터)</li></ul><p><strong>지연 시간 성능</strong></p><ul><li><strong>P50</strong>: 1-2ms (로컬 네트워크)</li><li><strong>P99</strong>: 10-15ms</li><li><strong>P99.9</strong>: 50-100ms</li></ul><h4 id=확장성-패턴>확장성 패턴<a hidden class=anchor aria-hidden=true href=#확장성-패턴>#</a></h4><p><strong>수평적 확장</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Scale Out Pattern&#34;
        LB[Load Balancer]
        
        subgraph &#34;Cluster&#34;
            N1[Node 1&lt;br/&gt;Queue A, B]
            N2[Node 2&lt;br/&gt;Queue C, D] 
            N3[Node 3&lt;br/&gt;Queue E, F]
        end
        
        subgraph &#34;Consumers&#34;
            C1[Consumer Group 1]
            C2[Consumer Group 2]
            C3[Consumer Group 3]
        end
    end
    
    LB --&gt; N1
    LB --&gt; N2  
    LB --&gt; N3
    
    N1 --&gt; C1
    N2 --&gt; C2
    N3 --&gt; C3
</pre><p><strong>수직적 확장</strong></p><ul><li><strong>CPU</strong>: 큐당 하나의 코어 사용, 멀티 큐로 병렬화</li><li><strong>메모리</strong>: 32GB 이상 권장, Lazy Queue로 디스크 오프로딩</li><li><strong>네트워크</strong>: 10Gbps 이상에서 최적 성능</li></ul><h2 id=phase-4-구현-및-분류-implementation--classification-1>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification-1>#</a></h2><h3 id=41-구현-기법-및-방법>4.1 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법>#</a></h3><h4 id=핵심-구현-패턴>핵심 구현 패턴<a hidden class=anchor aria-hidden=true href=#핵심-구현-패턴>#</a></h4><p><strong>1. Work Queue 패턴 (작업 분산)</strong></p><ul><li><strong>정의</strong>: 시간이 많이 소요되는 작업을 여러 워커에게 분산</li><li><strong>구성</strong>: Producer → Queue → Multiple Consumers</li><li><strong>목적</strong>: 부하 분산 및 처리 시간 단축</li><li><strong>실제 예시</strong>: 이미지 리사이징, 이메일 발송, 데이터 처리</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37>37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38>38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39>39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40>40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41>41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42>42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43>43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44>44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45>45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46>46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47>47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48>48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49>49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50>50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51>51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52>52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53>53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54>54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55>55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56>56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57>57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58>58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59>59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60>60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61>61</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Producer (작업 생성자)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_task</span><span class=p>(</span><span class=n>task_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 작업 큐 선언 (지속성 큐)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 작업 메시지 발송 (지속성 메시지)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>task_data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># 메시지를 디스크에 저장</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Consumer (작업 처리자)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_task</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이 함수는 RabbitMQ의 Work Queue 패턴에서 작업을 처리하는 핵심 부분
</span></span></span><span class=line><span class=cl><span class=s2>    - body: 처리할 작업 데이터 (JSON 형태)
</span></span></span><span class=line><span class=cl><span class=s2>    - method.delivery_tag: 메시지 확인응답을 위한 식별자
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>task_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing task: </span><span class=si>{</span><span class=n>task_data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 비즈니스 로직 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>expensive_operation</span><span class=p>(</span><span class=n>task_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 작업 완료 후 확인응답 (ACK)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Task completed: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 처리 실패 시 거부 (다른 컨슈머가 재처리)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Task failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_worker</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># QoS 설정: 한 번에 하나의 메시지만 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 소비 설정 (수동 ACK)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>on_message_callback</span><span class=o>=</span><span class=n>process_task</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>auto_ack</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># 수동 확인응답 사용</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Worker started. Waiting for messages...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. Publish-Subscribe 패턴 (브로드캐스트)</strong></p><ul><li><strong>정의</strong>: 하나의 메시지를 여러 구독자에게 동시 전달</li><li><strong>구성</strong>: Publisher → Fanout Exchange → Multiple Queues → Multiple Subscribers</li><li><strong>목적</strong>: 이벤트 알림, 상태 변경 브로드캐스트</li><li><strong>실제 예시</strong>: 사용자 가입 알림, 시스템 상태 변경, 로그 수집</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26>26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27>27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28>28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29>29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30>30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31>31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32>32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33>33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34>34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35>35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36>36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37>37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38>38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39>39</a>
</span><span class=lnt id=hl-22-40><a class=lnlinks href=#hl-22-40>40</a>
</span><span class=lnt id=hl-22-41><a class=lnlinks href=#hl-22-41>41</a>
</span><span class=lnt id=hl-22-42><a class=lnlinks href=#hl-22-42>42</a>
</span><span class=lnt id=hl-22-43><a class=lnlinks href=#hl-22-43>43</a>
</span><span class=lnt id=hl-22-44><a class=lnlinks href=#hl-22-44>44</a>
</span><span class=lnt id=hl-22-45><a class=lnlinks href=#hl-22-45>45</a>
</span><span class=lnt id=hl-22-46><a class=lnlinks href=#hl-22-46>46</a>
</span><span class=lnt id=hl-22-47><a class=lnlinks href=#hl-22-47>47</a>
</span><span class=lnt id=hl-22-48><a class=lnlinks href=#hl-22-48>48</a>
</span><span class=lnt id=hl-22-49><a class=lnlinks href=#hl-22-49>49</a>
</span><span class=lnt id=hl-22-50><a class=lnlinks href=#hl-22-50>50</a>
</span><span class=lnt id=hl-22-51><a class=lnlinks href=#hl-22-51>51</a>
</span><span class=lnt id=hl-22-52><a class=lnlinks href=#hl-22-52>52</a>
</span><span class=lnt id=hl-22-53><a class=lnlinks href=#hl-22-53>53</a>
</span><span class=lnt id=hl-22-54><a class=lnlinks href=#hl-22-54>54</a>
</span><span class=lnt id=hl-22-55><a class=lnlinks href=#hl-22-55>55</a>
</span><span class=lnt id=hl-22-56><a class=lnlinks href=#hl-22-56>56</a>
</span><span class=lnt id=hl-22-57><a class=lnlinks href=#hl-22-57>57</a>
</span><span class=lnt id=hl-22-58><a class=lnlinks href=#hl-22-58>58</a>
</span><span class=lnt id=hl-22-59><a class=lnlinks href=#hl-22-59>59</a>
</span><span class=lnt id=hl-22-60><a class=lnlinks href=#hl-22-60>60</a>
</span><span class=lnt id=hl-22-61><a class=lnlinks href=#hl-22-61>61</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Publisher (이벤트 발행자)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>publish_event</span><span class=p>(</span><span class=n>event_type</span><span class=p>,</span> <span class=n>event_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Fanout Exchange 선언 (모든 큐에 브로드캐스트)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>event_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 바인딩된 큐로 메시지 발송</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>  <span class=c1># Fanout에서는 라우팅 키 무시됨</span>
</span></span><span class=line><span class=cl>        <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Event published: </span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Subscriber (이벤트 구독자)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_user_service_events</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    사용자 서비스에서 관심있는 이벤트만 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - RabbitMQ의 Fanout Exchange를 통해 모든 서비스가 동일한 이벤트를 수신
</span></span></span><span class=line><span class=cl><span class=s2>    - 각 서비스는 자신이 처리해야 할 이벤트만 선별적으로 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;user_registered&#39;</span><span class=p>,</span> <span class=s1>&#39;user_updated&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User service processing: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 사용자 관련 비즈니스 로직 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>update_user_profile</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_subscriber</span><span class=p>(</span><span class=n>service_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 서비스별 고유한 큐 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>service_name</span><span class=si>}</span><span class=s1>_events&#39;</span><span class=p>,</span> <span class=n>exclusive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>queue_name</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>queue</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Exchange와 큐 바인딩</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>on_message_callback</span><span class=o>=</span><span class=n>handle_user_service_events</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>auto_ack</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>service_name</span><span class=si>}</span><span class=s2> subscriber started...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>3. RPC 패턴 (요청-응답)</strong></p><ul><li><strong>정의</strong>: 원격 프로시저 호출을 메시지 큐를 통해 구현</li><li><strong>구성</strong>: Client → Request Queue → Server → Reply Queue → Client</li><li><strong>목적</strong>: 비동기 원격 함수 호출, 마이크로서비스 간 통신</li><li><strong>실제 예시</strong>: 결제 처리, 데이터 검증, 외부 API 호출</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>  1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>  2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>  3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>  4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>  5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>  6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>  7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>  8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>  9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10> 10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11> 11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12> 12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13> 13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14> 14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15> 15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16> 16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17> 17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18> 18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19> 19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20> 20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21> 21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22> 22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23> 23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24> 24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25> 25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26> 26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27> 27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28> 28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29> 29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30> 30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31> 31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32> 32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33> 33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34> 34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35> 35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36> 36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37> 37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38> 38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39> 39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40> 40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41> 41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42> 42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43> 43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44> 44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45> 45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46> 46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47> 47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48> 48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49> 49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50> 50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51> 51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52> 52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53> 53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54> 54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55> 55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56> 56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57> 57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58> 58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59> 59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60> 60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61> 61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62> 62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63> 63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64> 64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65> 65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66> 66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67> 67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68> 68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69> 69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70> 70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71> 71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72> 72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73> 73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74> 74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75> 75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76> 76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77> 77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78> 78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79> 79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80> 80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81> 81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82> 82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83> 83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84> 84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85> 85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86> 86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87> 87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88> 88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89> 89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90> 90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91> 91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92> 92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93> 93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94> 94</a>
</span><span class=lnt id=hl-23-95><a class=lnlinks href=#hl-23-95> 95</a>
</span><span class=lnt id=hl-23-96><a class=lnlinks href=#hl-23-96> 96</a>
</span><span class=lnt id=hl-23-97><a class=lnlinks href=#hl-23-97> 97</a>
</span><span class=lnt id=hl-23-98><a class=lnlinks href=#hl-23-98> 98</a>
</span><span class=lnt id=hl-23-99><a class=lnlinks href=#hl-23-99> 99</a>
</span><span class=lnt id=hl-23-100><a class=lnlinks href=#hl-23-100>100</a>
</span><span class=lnt id=hl-23-101><a class=lnlinks href=#hl-23-101>101</a>
</span><span class=lnt id=hl-23-102><a class=lnlinks href=#hl-23-102>102</a>
</span><span class=lnt id=hl-23-103><a class=lnlinks href=#hl-23-103>103</a>
</span><span class=lnt id=hl-23-104><a class=lnlinks href=#hl-23-104>104</a>
</span><span class=lnt id=hl-23-105><a class=lnlinks href=#hl-23-105>105</a>
</span><span class=lnt id=hl-23-106><a class=lnlinks href=#hl-23-106>106</a>
</span><span class=lnt id=hl-23-107><a class=lnlinks href=#hl-23-107>107</a>
</span><span class=lnt id=hl-23-108><a class=lnlinks href=#hl-23-108>108</a>
</span><span class=lnt id=hl-23-109><a class=lnlinks href=#hl-23-109>109</a>
</span><span class=lnt id=hl-23-110><a class=lnlinks href=#hl-23-110>110</a>
</span><span class=lnt id=hl-23-111><a class=lnlinks href=#hl-23-111>111</a>
</span><span class=lnt id=hl-23-112><a class=lnlinks href=#hl-23-112>112</a>
</span><span class=lnt id=hl-23-113><a class=lnlinks href=#hl-23-113>113</a>
</span><span class=lnt id=hl-23-114><a class=lnlinks href=#hl-23-114>114</a>
</span><span class=lnt id=hl-23-115><a class=lnlinks href=#hl-23-115>115</a>
</span><span class=lnt id=hl-23-116><a class=lnlinks href=#hl-23-116>116</a>
</span><span class=lnt id=hl-23-117><a class=lnlinks href=#hl-23-117>117</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RPC Server (원격 프로시저 제공자)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fibonacci</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;실제 비즈니스 로직 (예: 피보나치 수열 계산)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>n</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fibonacci</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>fibonacci</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_rpc_request</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RPC 요청을 처리하고 응답을 반환하는 핵심 함수
</span></span></span><span class=line><span class=cl><span class=s2>    - properties.reply_to: 클라이언트의 응답 큐 이름
</span></span></span><span class=line><span class=cl><span class=s2>    - properties.correlation_id: 요청-응답 매칭을 위한 고유 ID
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Computing fibonacci(</span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>fibonacci</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답을 클라이언트의 응답 큐로 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=n>properties</span><span class=o>.</span><span class=n>reply_to</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>correlation_id</span><span class=o>=</span><span class=n>properties</span><span class=o>.</span><span class=n>correlation_id</span>  <span class=c1># 요청 ID 매칭</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 에러 응답 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=n>properties</span><span class=o>.</span><span class=n>reply_to</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>correlation_id</span><span class=o>=</span><span class=n>properties</span><span class=o>.</span><span class=n>correlation_id</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;ERROR: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_rpc_server</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># RPC 요청 큐 선언</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;rpc_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;rpc_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>on_message_callback</span><span class=o>=</span><span class=n>handle_rpc_request</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>auto_ack</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;RPC Server started. Waiting for requests...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RPC Client (원격 프로시저 호출자)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FibonacciRpcClient</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 수신용 임시 큐 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>exclusive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>callback_queue</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>queue</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 메시지 처리 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>callback_queue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>on_message_callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>on_response</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>response</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>correlation_id</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_response</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        RPC 응답을 처리하는 콜백 함수
</span></span></span><span class=line><span class=cl><span class=s2>        - correlation_id를 통해 요청-응답 매칭
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>correlation_id</span> <span class=o>==</span> <span class=n>properties</span><span class=o>.</span><span class=n>correlation_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>response</span> <span class=o>=</span> <span class=n>body</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>call</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;RPC 호출 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>response</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>correlation_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># RPC 요청 전송</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;rpc_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>reply_to</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>callback_queue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>correlation_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>correlation_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 응답 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>response</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>process_data_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>rpc_client</span> <span class=o>=</span> <span class=n>FibonacciRpcClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>rpc_client</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;fibonacci(30) = </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=42-분류-기준에-따른-유형-구분-1>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분-1>#</a></h3><blockquote><p>이 표는 RabbitMQ의 다양한 구성 요소와 기능을 분류 기준에 따라 체계적으로 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th><th>성능 특성</th></tr></thead><tbody><tr><td><strong>Exchange 타입</strong></td><td>Direct</td><td>정확한 라우팅 키 매칭</td><td>로그 레벨별 처리, 타겟 지정 알림</td><td>높은 성능, 단순한 라우팅</td></tr><tr><td></td><td>Fanout</td><td>모든 바인딩된 큐로 브로드캐스트</td><td>이벤트 알림, 상태 변경 전파</td><td>가장 빠른 처리 속도</td></tr><tr><td></td><td>Topic</td><td>패턴 기반 라우팅 (*.#)</td><td>계층적 이벤트 처리, 필터링</td><td>중간 정도 성능, 유연한 라우팅</td></tr><tr><td></td><td>Headers</td><td>메시지 헤더 기반 라우팅</td><td>복잡한 조건 처리, 메타데이터 기반 분류</td><td>상대적으로 낮은 성능</td></tr><tr><td><strong>Queue 타입</strong></td><td>Classic</td><td>기본 큐 타입</td><td>일반적인 메시징 작업</td><td>단일 노드 제한, 빠른 처리</td></tr><tr><td></td><td>Quorum</td><td>Raft 기반 분산 큐</td><td>고가용성 필요 시스템</td><td>복제 오버헤드, 강한 일관성</td></tr><tr><td></td><td>Stream</td><td>로그 형태 저장 큐</td><td>이벤트 스트리밍, 대용량 데이터</td><td>높은 처리량, 순차 읽기 최적화</td></tr><tr><td><strong>메시지 지속성</strong></td><td>Transient</td><td>메모리에만 저장</td><td>실시간 알림, 임시 데이터</td><td>최고 성능, 데이터 손실 위험</td></tr><tr><td></td><td>Persistent</td><td>디스크에 저장</td><td>중요한 비즈니스 데이터</td><td>안정성 우선, 성능 저하</td></tr><tr><td><strong>소비 방식</strong></td><td>Push (Basic.Consume)</td><td>서버가 클라이언트에게 푸시</td><td>실시간 처리, 이벤트 기반</td><td>낮은 지연 시간</td></tr><tr><td></td><td>Pull (Basic.Get)</td><td>클라이언트가 서버에서 풀</td><td>배치 처리, 폴링 기반</td><td>높은 지연 시간, 제어 가능</td></tr></tbody></table><h3 id=43-도구-및-프레임워크-생태계-1>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계-1>#</a></h3><h4 id=공식-클라이언트-라이브러리>공식 클라이언트 라이브러리<a hidden class=anchor aria-hidden=true href=#공식-클라이언트-라이브러리>#</a></h4><p><strong>Java 생태계</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Spring AMQP를 사용한 RabbitMQ 통합</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MessageProducer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Direct Exchange를 통한 메시지 발송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendOrderEvent</span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;order.exchange&#34;</span><span class=p>,</span><span class=w>     </span><span class=c1>// Exchange 이름</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;order.created&#34;</span><span class=p>,</span><span class=w>      </span><span class=c1>// Routing key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=w>                 </span><span class=c1>// 메시지 객체 (자동 JSON 변환)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;order.processing.queue&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleOrderProcessing</span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Spring AMQP의 어노테이션 기반 메시지 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - 자동 역직렬화: JSON → Order 객체 변환
</span></span></span><span class=line><span class=cl><span class=cm>     * - 자동 ACK: 메서드 성공 완료 시 자동 확인응답
</span></span></span><span class=line><span class=cl><span class=cm>     * - 예외 처리: 예외 발생 시 자동 재시도 또는 DLQ 이동
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Processing order: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 처리 비즈니스 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>processOrder</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Node.js 생태계</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52>52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53>53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54>54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55>55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56>56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57>57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58>58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59>59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60>60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61>61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62>62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63>63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64>64</a>
</span><span class=lnt id=hl-25-65><a class=lnlinks href=#hl-25-65>65</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// amqplib를 사용한 Node.js 통합
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>EventBus</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>connect</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Topic Exchange 선언 (이벤트 기반 통신)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertExchange</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=s1>&#39;topic&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>publish</span><span class=p>(</span><span class=nx>routingKey</span><span class=p>,</span> <span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * Node.js에서 RabbitMQ 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=cm>         * - routingKey: &#39;user.created&#39;, &#39;order.updated&#39; 등 계층적 키
</span></span></span><span class=line><span class=cl><span class=cm>         * - event: 발행할 이벤트 데이터 객체
</span></span></span><span class=line><span class=cl><span class=cm>         * - 자동 JSON 직렬화 및 UTF-8 인코딩
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>event</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=nx>routingKey</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>  <span class=c1>// 메시지 지속성
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>subscribe</span><span class=p>(</span><span class=nx>pattern</span><span class=p>,</span> <span class=nx>handler</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 서비스별 고유 큐 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>exclusive</span><span class=o>:</span> <span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 패턴 기반 바인딩 (예: &#39;user.*&#39;, &#39;order.#&#39;)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>bindQueue</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>queue</span><span class=p>,</span> <span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=nx>pattern</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 메시지 소비 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>queue</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>  <span class=c1>// 처리 완료 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>eventBus</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventBus</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>await</span> <span class=nx>eventBus</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용자 이벤트 구독
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>await</span> <span class=nx>eventBus</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=s1>&#39;user.*&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;User event received:&#39;</span><span class=p>,</span> <span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>await</span> <span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;user.created&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=o>:</span> <span class=mi>12345</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;user@example.com&#39;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=관리-및-모니터링-도구>관리 및 모니터링 도구<a hidden class=anchor aria-hidden=true href=#관리-및-모니터링-도구>#</a></h4><p><strong>Prometheus + Grafana 통합</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36>36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yml - 모니터링 스택 구성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq:4-management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5672:5672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;15672:15672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;15692:15692&#34;</span><span class=w>  </span><span class=c># Prometheus 메트릭 포트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RABBITMQ_DEFAULT_USER=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RABBITMQ_DEFAULT_PASS=secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>plugins</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq_management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq_prometheus </span><span class=w> </span><span class=c># Prometheus 플러그인 활성화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq_data:/var/lib/rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>prom/prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9090:9090&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./prometheus.yml:/etc/prometheus/prometheus.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>grafana</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>grafana/grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_SECURITY_ADMIN_PASSWORD=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>grafana_data:/var/lib/grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>grafana_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>RabbitMQ Management API 활용</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29>29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30>30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31>31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32>32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33>33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34>34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35>35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36>36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37>37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38>38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39>39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40>40</a>
</span><span class=lnt id=hl-27-41><a class=lnlinks href=#hl-27-41>41</a>
</span><span class=lnt id=hl-27-42><a class=lnlinks href=#hl-27-42>42</a>
</span><span class=lnt id=hl-27-43><a class=lnlinks href=#hl-27-43>43</a>
</span><span class=lnt id=hl-27-44><a class=lnlinks href=#hl-27-44>44</a>
</span><span class=lnt id=hl-27-45><a class=lnlinks href=#hl-27-45>45</a>
</span><span class=lnt id=hl-27-46><a class=lnlinks href=#hl-27-46>46</a>
</span><span class=lnt id=hl-27-47><a class=lnlinks href=#hl-27-47>47</a>
</span><span class=lnt id=hl-27-48><a class=lnlinks href=#hl-27-48>48</a>
</span><span class=lnt id=hl-27-49><a class=lnlinks href=#hl-27-49>49</a>
</span><span class=lnt id=hl-27-50><a class=lnlinks href=#hl-27-50>50</a>
</span><span class=lnt id=hl-27-51><a class=lnlinks href=#hl-27-51>51</a>
</span><span class=lnt id=hl-27-52><a class=lnlinks href=#hl-27-52>52</a>
</span><span class=lnt id=hl-27-53><a class=lnlinks href=#hl-27-53>53</a>
</span><span class=lnt id=hl-27-54><a class=lnlinks href=#hl-27-54>54</a>
</span><span class=lnt id=hl-27-55><a class=lnlinks href=#hl-27-55>55</a>
</span><span class=lnt id=hl-27-56><a class=lnlinks href=#hl-27-56>56</a>
</span><span class=lnt id=hl-27-57><a class=lnlinks href=#hl-27-57>57</a>
</span><span class=lnt id=hl-27-58><a class=lnlinks href=#hl-27-58>58</a>
</span><span class=lnt id=hl-27-59><a class=lnlinks href=#hl-27-59>59</a>
</span><span class=lnt id=hl-27-60><a class=lnlinks href=#hl-27-60>60</a>
</span><span class=lnt id=hl-27-61><a class=lnlinks href=#hl-27-61>61</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 관리 API를 통한 자동화 스크립트</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RabbitMQManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>15672</span><span class=p>,</span> <span class=n>username</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;http://</span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s1>/api&#39;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>auth</span> <span class=o>=</span> <span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_cluster_status</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;클러스터 상태 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s1>/nodes&#39;</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>auth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_queue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vhost</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>,</span> <span class=n>queue_type</span><span class=o>=</span><span class=s1>&#39;classic&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        큐 생성 자동화
</span></span></span><span class=line><span class=cl><span class=s2>        - vhost: 가상 호스트 이름
</span></span></span><span class=line><span class=cl><span class=s2>        - queue_name: 생성할 큐 이름  
</span></span></span><span class=line><span class=cl><span class=s2>        - queue_type: 큐 타입 (classic, quorum, stream)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>queue_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;durable&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;arguments&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;x-queue-type&#39;</span><span class=p>:</span> <span class=n>queue_type</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>put</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s1>/queues/</span><span class=si>{</span><span class=n>vhost</span><span class=si>}</span><span class=s1>/</span><span class=si>{</span><span class=n>queue_name</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>auth</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>auth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>queue_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>201</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_queue_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vhost</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;큐 메트릭 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s1>/queues/</span><span class=si>{</span><span class=n>vhost</span><span class=si>}</span><span class=s1>/</span><span class=si>{</span><span class=n>queue_name</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>auth</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>auth</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;messages&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;messages&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;consumers&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;consumers&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;message_rate&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;message_stats&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;publish_details&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;rate&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>manager</span> <span class=o>=</span> <span class=n>RabbitMQManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐 생성</span>
</span></span><span class=line><span class=cl><span class=n>manager</span><span class=o>.</span><span class=n>create_queue</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=s1>&#39;quorum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메트릭 모니터링</span>
</span></span><span class=line><span class=cl><span class=n>metrics</span> <span class=o>=</span> <span class=n>manager</span><span class=o>.</span><span class=n>get_queue_metrics</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=s1>&#39;orders&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Queue metrics: </span><span class=si>{</span><span class=n>metrics</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=44-표준-및-규격-준수사항-1>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항-1>#</a></h3><h4 id=amqp-표준-준수>AMQP 표준 준수<a hidden class=anchor aria-hidden=true href=#amqp-표준-준수>#</a></h4><p><strong>AMQP 0.9.1 vs AMQP 1.0 비교</strong></p><ul><li><strong>AMQP 0.9.1</strong>: RabbitMQ의 전통적 프로토콜, Exchange-Queue 모델 정의</li><li><strong>AMQP 1.0</strong>: 2024년 RabbitMQ 4.0에서 네이티브 지원, 순수 프로토콜 레벨 표준</li></ul><p><strong>상호 운용성 보장</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># AMQP 1.0 클라이언트 예시 (Azure Service Bus 호환)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>azure.servicebus</span> <span class=kn>import</span> <span class=n>ServiceBusClient</span><span class=p>,</span> <span class=n>ServiceBusMessage</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 4.0의 AMQP 1.0 지원으로 Azure Service Bus와 호환 가능</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>ServiceBusClient</span><span class=o>.</span><span class=n>from_connection_string</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;amqp://localhost:5672&#34;</span>  <span class=c1># RabbitMQ 4.0 AMQP 1.0 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 표준 AMQP 1.0 메시지 발송</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>client</span><span class=o>.</span><span class=n>get_queue_sender</span><span class=p>(</span><span class=s2>&#34;test_queue&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>sender</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=n>ServiceBusMessage</span><span class=p>(</span><span class=s2>&#34;Hello from AMQP 1.0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sender</span><span class=o>.</span><span class=n>send_messages</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=보안-표준-준수>보안 표준 준수<a hidden class=anchor aria-hidden=true href=#보안-표준-준수>#</a></h4><p><strong>TLS/SSL 설정</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># rabbitmq.conf - 보안 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>listeners.ssl.default = 5671</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.certfile = /path/to/server.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.keyfile = /path/to/server.key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.cacertfile = /path/to/ca.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.verify = verify_peer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.versions.1 = tlsv1.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.ciphers.1 = ECDHE-ECDSA-AES256-GCM-SHA384</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Management UI HTTPS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.ssl.port = 15671</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.ssl.certfile = /path/to/server.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.ssl.keyfile = /path/to/server.key</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>LDAP 통합 (기업 인증 표준)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># LDAP 인증 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_backends.1 = ldap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_backends.2 = internal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.servers.1 = ldap.company.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.use_ssl = true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.port = 636</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.user_dn_pattern = cn=${username},ou=Users,dc=company,dc=com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 권한 매핑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.vhost_access_query = {constant, true}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.resource_access_query = {for, [{permission, configure, {in_group, &#34;cn=admin,ou=Groups,dc=company,dc=com&#34;}},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                         </span>{<span class=l>permission, write, {constant, true}},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                         </span>{<span class=l>permission, read, {constant, true}}]}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=5단계-phase-5-6-조사-실무-적용-및-운영-최적화>5단계: Phase 5-6 조사 (실무 적용 및 운영 최적화)<a hidden class=anchor aria-hidden=true href=#5단계-phase-5-6-조사-실무-적용-및-운영-최적화>#</a></h2><h2 id=phase-5-실무-적용-practical-application-1>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application-1>#</a></h2><h3 id=51-실습-예제-및-코드-구현-1>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현-1>#</a></h3><p><strong>학습 목표</strong>: RabbitMQ를 사용한 마이크로서비스 간 이벤트 기반 통신 구현</p><p><strong>시나리오</strong>: 전자상거래 플랫폼에서 주문 처리 프로세스</p><ul><li>고객이 주문 시 주문 서비스, 재고 서비스, 결제 서비스, 알림 서비스가 순차적/병렬적으로 작업 처리</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>Order Service (주문 처리)</li><li>Inventory Service (재고 관리)</li><li>Payment Service (결제 처리)</li><li>Notification Service (알림 발송)</li><li>RabbitMQ Cluster (메시지 브로커)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        CLIENT[고객 애플리케이션]
    end
    
    subgraph &#34;Microservices&#34;
        ORDER[Order Service&lt;br/&gt;주문 처리]
        INVENTORY[Inventory Service&lt;br/&gt;재고 관리]
        PAYMENT[Payment Service&lt;br/&gt;결제 처리]
        NOTIFICATION[Notification Service&lt;br/&gt;알림 발송]
    end
    
    subgraph &#34;RabbitMQ Cluster&#34;
        subgraph &#34;Exchanges&#34;
            ORDER_EX[order.events&lt;br/&gt;Topic Exchange]
            PAYMENT_EX[payment.events&lt;br/&gt;Topic Exchange]
        end
        
        subgraph &#34;Queues&#34;
            INV_Q[inventory.check.queue]
            PAY_Q[payment.process.queue]
            NOTIF_Q[notification.queue]
            DLQ[dead.letter.queue]
        end
    end
    
    CLIENT --&gt; ORDER
    ORDER --&gt; ORDER_EX
    ORDER_EX --&gt; INV_Q
    ORDER_EX --&gt; PAY_Q
    ORDER_EX --&gt; NOTIF_Q
    
    INV_Q --&gt; INVENTORY
    PAY_Q --&gt; PAYMENT
    NOTIF_Q --&gt; NOTIFICATION
    
    PAYMENT --&gt; PAYMENT_EX
    PAYMENT_EX --&gt; NOTIF_Q
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 주문 생성 요청</li><li>Order Service가 주문 정보 저장 후 &lsquo;order.created&rsquo; 이벤트 발행</li><li>Inventory Service가 재고 확인 후 결과 응답</li><li>Payment Service가 결제 처리 후 &lsquo;payment.completed&rsquo; 이벤트 발행</li><li>Notification Service가 고객에게 주문 완료 알림 발송</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>RabbitMQ가 서비스 간 비동기 통신 중계 및 이벤트 라우팅 담당</li><li>각 서비스의 독립적 개발/배포/확장 가능</li><li>장애 발생 시 메시지 큐를 통한 복구 지원</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 서비스 간 직접 API 호출로 강결합, 한 서비스 장애 시 전체 프로세스 중단</li><li><strong>도입 후</strong>: 느슨한 결합으로 개별 서비스 장애가 전체 시스템에 미치는 영향 최소화</li></ul><p><strong>구현 예시</strong> (Python/Docker):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>  1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>  2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>  3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>  4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>  5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6>  6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7>  7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8>  8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9>  9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10> 10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11> 11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12> 12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13> 13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14> 14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15> 15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16> 16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17> 17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18> 18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19> 19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20> 20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21> 21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22> 22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23> 23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24> 24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25> 25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26> 26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27> 27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28> 28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29> 29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30> 30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31> 31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32> 32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33> 33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34> 34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35> 35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36> 36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37> 37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38> 38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39> 39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40> 40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41> 41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42> 42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43> 43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44> 44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45> 45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46> 46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47> 47</a>
</span><span class=lnt id=hl-32-48><a class=lnlinks href=#hl-32-48> 48</a>
</span><span class=lnt id=hl-32-49><a class=lnlinks href=#hl-32-49> 49</a>
</span><span class=lnt id=hl-32-50><a class=lnlinks href=#hl-32-50> 50</a>
</span><span class=lnt id=hl-32-51><a class=lnlinks href=#hl-32-51> 51</a>
</span><span class=lnt id=hl-32-52><a class=lnlinks href=#hl-32-52> 52</a>
</span><span class=lnt id=hl-32-53><a class=lnlinks href=#hl-32-53> 53</a>
</span><span class=lnt id=hl-32-54><a class=lnlinks href=#hl-32-54> 54</a>
</span><span class=lnt id=hl-32-55><a class=lnlinks href=#hl-32-55> 55</a>
</span><span class=lnt id=hl-32-56><a class=lnlinks href=#hl-32-56> 56</a>
</span><span class=lnt id=hl-32-57><a class=lnlinks href=#hl-32-57> 57</a>
</span><span class=lnt id=hl-32-58><a class=lnlinks href=#hl-32-58> 58</a>
</span><span class=lnt id=hl-32-59><a class=lnlinks href=#hl-32-59> 59</a>
</span><span class=lnt id=hl-32-60><a class=lnlinks href=#hl-32-60> 60</a>
</span><span class=lnt id=hl-32-61><a class=lnlinks href=#hl-32-61> 61</a>
</span><span class=lnt id=hl-32-62><a class=lnlinks href=#hl-32-62> 62</a>
</span><span class=lnt id=hl-32-63><a class=lnlinks href=#hl-32-63> 63</a>
</span><span class=lnt id=hl-32-64><a class=lnlinks href=#hl-32-64> 64</a>
</span><span class=lnt id=hl-32-65><a class=lnlinks href=#hl-32-65> 65</a>
</span><span class=lnt id=hl-32-66><a class=lnlinks href=#hl-32-66> 66</a>
</span><span class=lnt id=hl-32-67><a class=lnlinks href=#hl-32-67> 67</a>
</span><span class=lnt id=hl-32-68><a class=lnlinks href=#hl-32-68> 68</a>
</span><span class=lnt id=hl-32-69><a class=lnlinks href=#hl-32-69> 69</a>
</span><span class=lnt id=hl-32-70><a class=lnlinks href=#hl-32-70> 70</a>
</span><span class=lnt id=hl-32-71><a class=lnlinks href=#hl-32-71> 71</a>
</span><span class=lnt id=hl-32-72><a class=lnlinks href=#hl-32-72> 72</a>
</span><span class=lnt id=hl-32-73><a class=lnlinks href=#hl-32-73> 73</a>
</span><span class=lnt id=hl-32-74><a class=lnlinks href=#hl-32-74> 74</a>
</span><span class=lnt id=hl-32-75><a class=lnlinks href=#hl-32-75> 75</a>
</span><span class=lnt id=hl-32-76><a class=lnlinks href=#hl-32-76> 76</a>
</span><span class=lnt id=hl-32-77><a class=lnlinks href=#hl-32-77> 77</a>
</span><span class=lnt id=hl-32-78><a class=lnlinks href=#hl-32-78> 78</a>
</span><span class=lnt id=hl-32-79><a class=lnlinks href=#hl-32-79> 79</a>
</span><span class=lnt id=hl-32-80><a class=lnlinks href=#hl-32-80> 80</a>
</span><span class=lnt id=hl-32-81><a class=lnlinks href=#hl-32-81> 81</a>
</span><span class=lnt id=hl-32-82><a class=lnlinks href=#hl-32-82> 82</a>
</span><span class=lnt id=hl-32-83><a class=lnlinks href=#hl-32-83> 83</a>
</span><span class=lnt id=hl-32-84><a class=lnlinks href=#hl-32-84> 84</a>
</span><span class=lnt id=hl-32-85><a class=lnlinks href=#hl-32-85> 85</a>
</span><span class=lnt id=hl-32-86><a class=lnlinks href=#hl-32-86> 86</a>
</span><span class=lnt id=hl-32-87><a class=lnlinks href=#hl-32-87> 87</a>
</span><span class=lnt id=hl-32-88><a class=lnlinks href=#hl-32-88> 88</a>
</span><span class=lnt id=hl-32-89><a class=lnlinks href=#hl-32-89> 89</a>
</span><span class=lnt id=hl-32-90><a class=lnlinks href=#hl-32-90> 90</a>
</span><span class=lnt id=hl-32-91><a class=lnlinks href=#hl-32-91> 91</a>
</span><span class=lnt id=hl-32-92><a class=lnlinks href=#hl-32-92> 92</a>
</span><span class=lnt id=hl-32-93><a class=lnlinks href=#hl-32-93> 93</a>
</span><span class=lnt id=hl-32-94><a class=lnlinks href=#hl-32-94> 94</a>
</span><span class=lnt id=hl-32-95><a class=lnlinks href=#hl-32-95> 95</a>
</span><span class=lnt id=hl-32-96><a class=lnlinks href=#hl-32-96> 96</a>
</span><span class=lnt id=hl-32-97><a class=lnlinks href=#hl-32-97> 97</a>
</span><span class=lnt id=hl-32-98><a class=lnlinks href=#hl-32-98> 98</a>
</span><span class=lnt id=hl-32-99><a class=lnlinks href=#hl-32-99> 99</a>
</span><span class=lnt id=hl-32-100><a class=lnlinks href=#hl-32-100>100</a>
</span><span class=lnt id=hl-32-101><a class=lnlinks href=#hl-32-101>101</a>
</span><span class=lnt id=hl-32-102><a class=lnlinks href=#hl-32-102>102</a>
</span><span class=lnt id=hl-32-103><a class=lnlinks href=#hl-32-103>103</a>
</span><span class=lnt id=hl-32-104><a class=lnlinks href=#hl-32-104>104</a>
</span><span class=lnt id=hl-32-105><a class=lnlinks href=#hl-32-105>105</a>
</span><span class=lnt id=hl-32-106><a class=lnlinks href=#hl-32-106>106</a>
</span><span class=lnt id=hl-32-107><a class=lnlinks href=#hl-32-107>107</a>
</span><span class=lnt id=hl-32-108><a class=lnlinks href=#hl-32-108>108</a>
</span><span class=lnt id=hl-32-109><a class=lnlinks href=#hl-32-109>109</a>
</span><span class=lnt id=hl-32-110><a class=lnlinks href=#hl-32-110>110</a>
</span><span class=lnt id=hl-32-111><a class=lnlinks href=#hl-32-111>111</a>
</span><span class=lnt id=hl-32-112><a class=lnlinks href=#hl-32-112>112</a>
</span><span class=lnt id=hl-32-113><a class=lnlinks href=#hl-32-113>113</a>
</span><span class=lnt id=hl-32-114><a class=lnlinks href=#hl-32-114>114</a>
</span><span class=lnt id=hl-32-115><a class=lnlinks href=#hl-32-115>115</a>
</span><span class=lnt id=hl-32-116><a class=lnlinks href=#hl-32-116>116</a>
</span><span class=lnt id=hl-32-117><a class=lnlinks href=#hl-32-117>117</a>
</span><span class=lnt id=hl-32-118><a class=lnlinks href=#hl-32-118>118</a>
</span><span class=lnt id=hl-32-119><a class=lnlinks href=#hl-32-119>119</a>
</span><span class=lnt id=hl-32-120><a class=lnlinks href=#hl-32-120>120</a>
</span><span class=lnt id=hl-32-121><a class=lnlinks href=#hl-32-121>121</a>
</span><span class=lnt id=hl-32-122><a class=lnlinks href=#hl-32-122>122</a>
</span><span class=lnt id=hl-32-123><a class=lnlinks href=#hl-32-123>123</a>
</span><span class=lnt id=hl-32-124><a class=lnlinks href=#hl-32-124>124</a>
</span><span class=lnt id=hl-32-125><a class=lnlinks href=#hl-32-125>125</a>
</span><span class=lnt id=hl-32-126><a class=lnlinks href=#hl-32-126>126</a>
</span><span class=lnt id=hl-32-127><a class=lnlinks href=#hl-32-127>127</a>
</span><span class=lnt id=hl-32-128><a class=lnlinks href=#hl-32-128>128</a>
</span><span class=lnt id=hl-32-129><a class=lnlinks href=#hl-32-129>129</a>
</span><span class=lnt id=hl-32-130><a class=lnlinks href=#hl-32-130>130</a>
</span><span class=lnt id=hl-32-131><a class=lnlinks href=#hl-32-131>131</a>
</span><span class=lnt id=hl-32-132><a class=lnlinks href=#hl-32-132>132</a>
</span><span class=lnt id=hl-32-133><a class=lnlinks href=#hl-32-133>133</a>
</span><span class=lnt id=hl-32-134><a class=lnlinks href=#hl-32-134>134</a>
</span><span class=lnt id=hl-32-135><a class=lnlinks href=#hl-32-135>135</a>
</span><span class=lnt id=hl-32-136><a class=lnlinks href=#hl-32-136>136</a>
</span><span class=lnt id=hl-32-137><a class=lnlinks href=#hl-32-137>137</a>
</span><span class=lnt id=hl-32-138><a class=lnlinks href=#hl-32-138>138</a>
</span><span class=lnt id=hl-32-139><a class=lnlinks href=#hl-32-139>139</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># shared/event_bus.py - 공통 이벤트 버스 클래스</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Callable</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EventBus</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 기반 이벤트 버스 클래스
</span></span></span><span class=line><span class=cl><span class=s2>    - 서비스 간 이벤트 발행/구독을 위한 공통 인터페이스 제공
</span></span></span><span class=line><span class=cl><span class=s2>    - Topic Exchange를 통한 유연한 이벤트 라우팅
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;amqp://localhost&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_url</span> <span class=o>=</span> <span class=n>connection_url</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>connect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;RabbitMQ 서버 연결 및 채널 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>pika</span><span class=o>.</span><span class=n>URLParameters</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Topic Exchange 선언 (이벤트 기반 라우팅)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;ecommerce.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;topic&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Connected to RabbitMQ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to connect to RabbitMQ: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Any</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이벤트 발행 메서드
</span></span></span><span class=line><span class=cl><span class=s2>        - routing_key: &#39;order.created&#39;, &#39;payment.completed&#39; 등 계층적 이벤트 키
</span></span></span><span class=line><span class=cl><span class=s2>        - event_data: 이벤트와 함께 전달할 데이터
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_id&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=n>routing_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>event_data</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Topic Exchange로 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;ecommerce.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>routing_key</span><span class=o>=</span><span class=n>routing_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>event_message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># 메시지 지속성 보장</span>
</span></span><span class=line><span class=cl>                    <span class=n>content_type</span><span class=o>=</span><span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Event published: </span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to publish event </span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>subscribe_to_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_patterns</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                          <span class=n>callback</span><span class=p>:</span> <span class=n>Callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이벤트 구독 메서드
</span></span></span><span class=line><span class=cl><span class=s2>        - routing_patterns: 구독할 이벤트 패턴 리스트 ([&#39;order.*&#39;, &#39;payment.*&#39;])
</span></span></span><span class=line><span class=cl><span class=s2>        - queue_name: 서비스별 고유 큐 이름
</span></span></span><span class=line><span class=cl><span class=s2>        - callback: 이벤트 처리 콜백 함수
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 서비스별 전용 큐 선언</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>arguments</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=p>:</span> <span class=s1>&#39;dlx.ecommerce&#39;</span><span class=p>,</span>  <span class=c1># DLQ 설정</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;x-message-ttl&#39;</span><span class=p>:</span> <span class=mi>300000</span>  <span class=c1># 5분 TTL</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 패턴별 바인딩 설정</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=n>routing_patterns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;ecommerce.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>routing_key</span><span class=o>=</span><span class=n>pattern</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># QoS 설정: 동시 처리 메시지 수 제한</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 소비 설정</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>on_message_callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrap_callback</span><span class=p>(</span><span class=n>callback</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>auto_ack</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Subscribed to patterns: </span><span class=si>{</span><span class=n>routing_patterns</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to subscribe to events: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_wrap_callback</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_callback</span><span class=p>:</span> <span class=n>Callable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;콜백 함수 래퍼 - 에러 처리 및 ACK 관리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>wrapped_callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>user_callback</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 성공적 처리 후 ACK</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Invalid JSON in message: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error processing message: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 실패 시 재시도 (최대 3회)</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>wrapped_callback</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_consuming</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 소비 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Starting event consumption...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26>26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27>27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28>28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29>29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30>30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31>31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32>32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33>33</a>
</span><span class=lnt id=hl-33-34><a class=lnlinks href=#hl-33-34>34</a>
</span><span class=lnt id=hl-33-35><a class=lnlinks href=#hl-33-35>35</a>
</span><span class=lnt id=hl-33-36><a class=lnlinks href=#hl-33-36>36</a>
</span><span class=lnt id=hl-33-37><a class=lnlinks href=#hl-33-37>37</a>
</span><span class=lnt id=hl-33-38><a class=lnlinks href=#hl-33-38>38</a>
</span><span class=lnt id=hl-33-39><a class=lnlinks href=#hl-33-39>39</a>
</span><span class=lnt id=hl-33-40><a class=lnlinks href=#hl-33-40>40</a>
</span><span class=lnt id=hl-33-41><a class=lnlinks href=#hl-33-41>41</a>
</span><span class=lnt id=hl-33-42><a class=lnlinks href=#hl-33-42>42</a>
</span><span class=lnt id=hl-33-43><a class=lnlinks href=#hl-33-43>43</a>
</span><span class=lnt id=hl-33-44><a class=lnlinks href=#hl-33-44>44</a>
</span><span class=lnt id=hl-33-45><a class=lnlinks href=#hl-33-45>45</a>
</span><span class=lnt id=hl-33-46><a class=lnlinks href=#hl-33-46>46</a>
</span><span class=lnt id=hl-33-47><a class=lnlinks href=#hl-33-47>47</a>
</span><span class=lnt id=hl-33-48><a class=lnlinks href=#hl-33-48>48</a>
</span><span class=lnt id=hl-33-49><a class=lnlinks href=#hl-33-49>49</a>
</span><span class=lnt id=hl-33-50><a class=lnlinks href=#hl-33-50>50</a>
</span><span class=lnt id=hl-33-51><a class=lnlinks href=#hl-33-51>51</a>
</span><span class=lnt id=hl-33-52><a class=lnlinks href=#hl-33-52>52</a>
</span><span class=lnt id=hl-33-53><a class=lnlinks href=#hl-33-53>53</a>
</span><span class=lnt id=hl-33-54><a class=lnlinks href=#hl-33-54>54</a>
</span><span class=lnt id=hl-33-55><a class=lnlinks href=#hl-33-55>55</a>
</span><span class=lnt id=hl-33-56><a class=lnlinks href=#hl-33-56>56</a>
</span><span class=lnt id=hl-33-57><a class=lnlinks href=#hl-33-57>57</a>
</span><span class=lnt id=hl-33-58><a class=lnlinks href=#hl-33-58>58</a>
</span><span class=lnt id=hl-33-59><a class=lnlinks href=#hl-33-59>59</a>
</span><span class=lnt id=hl-33-60><a class=lnlinks href=#hl-33-60>60</a>
</span><span class=lnt id=hl-33-61><a class=lnlinks href=#hl-33-61>61</a>
</span><span class=lnt id=hl-33-62><a class=lnlinks href=#hl-33-62>62</a>
</span><span class=lnt id=hl-33-63><a class=lnlinks href=#hl-33-63>63</a>
</span><span class=lnt id=hl-33-64><a class=lnlinks href=#hl-33-64>64</a>
</span><span class=lnt id=hl-33-65><a class=lnlinks href=#hl-33-65>65</a>
</span><span class=lnt id=hl-33-66><a class=lnlinks href=#hl-33-66>66</a>
</span><span class=lnt id=hl-33-67><a class=lnlinks href=#hl-33-67>67</a>
</span><span class=lnt id=hl-33-68><a class=lnlinks href=#hl-33-68>68</a>
</span><span class=lnt id=hl-33-69><a class=lnlinks href=#hl-33-69>69</a>
</span><span class=lnt id=hl-33-70><a class=lnlinks href=#hl-33-70>70</a>
</span><span class=lnt id=hl-33-71><a class=lnlinks href=#hl-33-71>71</a>
</span><span class=lnt id=hl-33-72><a class=lnlinks href=#hl-33-72>72</a>
</span><span class=lnt id=hl-33-73><a class=lnlinks href=#hl-33-73>73</a>
</span><span class=lnt id=hl-33-74><a class=lnlinks href=#hl-33-74>74</a>
</span><span class=lnt id=hl-33-75><a class=lnlinks href=#hl-33-75>75</a>
</span><span class=lnt id=hl-33-76><a class=lnlinks href=#hl-33-76>76</a>
</span><span class=lnt id=hl-33-77><a class=lnlinks href=#hl-33-77>77</a>
</span><span class=lnt id=hl-33-78><a class=lnlinks href=#hl-33-78>78</a>
</span><span class=lnt id=hl-33-79><a class=lnlinks href=#hl-33-79>79</a>
</span><span class=lnt id=hl-33-80><a class=lnlinks href=#hl-33-80>80</a>
</span><span class=lnt id=hl-33-81><a class=lnlinks href=#hl-33-81>81</a>
</span><span class=lnt id=hl-33-82><a class=lnlinks href=#hl-33-82>82</a>
</span><span class=lnt id=hl-33-83><a class=lnlinks href=#hl-33-83>83</a>
</span><span class=lnt id=hl-33-84><a class=lnlinks href=#hl-33-84>84</a>
</span><span class=lnt id=hl-33-85><a class=lnlinks href=#hl-33-85>85</a>
</span><span class=lnt id=hl-33-86><a class=lnlinks href=#hl-33-86>86</a>
</span><span class=lnt id=hl-33-87><a class=lnlinks href=#hl-33-87>87</a>
</span><span class=lnt id=hl-33-88><a class=lnlinks href=#hl-33-88>88</a>
</span><span class=lnt id=hl-33-89><a class=lnlinks href=#hl-33-89>89</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># services/order_service.py - 주문 서비스 구현</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shared.event_bus</span> <span class=kn>import</span> <span class=n>EventBus</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 처리 서비스
</span></span></span><span class=line><span class=cl><span class=s2>    - 고객 주문 접수 및 저장
</span></span></span><span class=line><span class=cl><span class=s2>    - 주문 관련 이벤트 발행 (order.created, order.cancelled 등)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders_db</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 실제로는 데이터베이스 연결</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 생성 및 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 주문 정보 저장</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;order_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>order_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>customer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;pending&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders_db</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>order_data</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 주문 생성 이벤트 발행 - 다른 서비스들이 구독하여 처리</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span> <span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order created: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to create order: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_inventory_response</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        재고 서비스 응답 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - inventory.checked 이벤트 수신 시 호출
</span></span></span><span class=line><span class=cl><span class=s2>        - 재고 확인 결과에 따라 주문 상태 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>][</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>inventory_available</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>][</span><span class=s1>&#39;available&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>inventory_available</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재고 충분 - 결제 프로세스 시작 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;order.inventory_confirmed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;next_step&#39;</span><span class=p>:</span> <span class=s1>&#39;payment&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재고 부족 - 주문 취소</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>orders_db</span><span class=p>[</span><span class=n>order_id</span><span class=p>][</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;cancelled&#39;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;order.cancelled&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;insufficient_inventory&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_service</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;서비스 시작 및 이벤트 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재고 응답 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe_to_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_patterns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;inventory.checked&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>queue_name</span><span class=o>=</span><span class=s1>&#39;order.service.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>handle_inventory_response</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>order_service</span> <span class=o>=</span> <span class=n>OrderService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>order_service</span><span class=o>.</span><span class=n>create_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=s1>&#39;customer_123&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span><span class=o>=</span><span class=p>[{</span><span class=s1>&#39;product_id&#39;</span><span class=p>:</span> <span class=s1>&#39;prod_1&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=n>total_amount</span><span class=o>=</span><span class=mf>99.99</span>
</span></span><span class=line><span class=cl>    <span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 수신 대기</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>order_service</span><span class=o>.</span><span class=n>start_service</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22>22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23>23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24>24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25>25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26>26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27>27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28>28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29>29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30>30</a>
</span><span class=lnt id=hl-34-31><a class=lnlinks href=#hl-34-31>31</a>
</span><span class=lnt id=hl-34-32><a class=lnlinks href=#hl-34-32>32</a>
</span><span class=lnt id=hl-34-33><a class=lnlinks href=#hl-34-33>33</a>
</span><span class=lnt id=hl-34-34><a class=lnlinks href=#hl-34-34>34</a>
</span><span class=lnt id=hl-34-35><a class=lnlinks href=#hl-34-35>35</a>
</span><span class=lnt id=hl-34-36><a class=lnlinks href=#hl-34-36>36</a>
</span><span class=lnt id=hl-34-37><a class=lnlinks href=#hl-34-37>37</a>
</span><span class=lnt id=hl-34-38><a class=lnlinks href=#hl-34-38>38</a>
</span><span class=lnt id=hl-34-39><a class=lnlinks href=#hl-34-39>39</a>
</span><span class=lnt id=hl-34-40><a class=lnlinks href=#hl-34-40>40</a>
</span><span class=lnt id=hl-34-41><a class=lnlinks href=#hl-34-41>41</a>
</span><span class=lnt id=hl-34-42><a class=lnlinks href=#hl-34-42>42</a>
</span><span class=lnt id=hl-34-43><a class=lnlinks href=#hl-34-43>43</a>
</span><span class=lnt id=hl-34-44><a class=lnlinks href=#hl-34-44>44</a>
</span><span class=lnt id=hl-34-45><a class=lnlinks href=#hl-34-45>45</a>
</span><span class=lnt id=hl-34-46><a class=lnlinks href=#hl-34-46>46</a>
</span><span class=lnt id=hl-34-47><a class=lnlinks href=#hl-34-47>47</a>
</span><span class=lnt id=hl-34-48><a class=lnlinks href=#hl-34-48>48</a>
</span><span class=lnt id=hl-34-49><a class=lnlinks href=#hl-34-49>49</a>
</span><span class=lnt id=hl-34-50><a class=lnlinks href=#hl-34-50>50</a>
</span><span class=lnt id=hl-34-51><a class=lnlinks href=#hl-34-51>51</a>
</span><span class=lnt id=hl-34-52><a class=lnlinks href=#hl-34-52>52</a>
</span><span class=lnt id=hl-34-53><a class=lnlinks href=#hl-34-53>53</a>
</span><span class=lnt id=hl-34-54><a class=lnlinks href=#hl-34-54>54</a>
</span><span class=lnt id=hl-34-55><a class=lnlinks href=#hl-34-55>55</a>
</span><span class=lnt id=hl-34-56><a class=lnlinks href=#hl-34-56>56</a>
</span><span class=lnt id=hl-34-57><a class=lnlinks href=#hl-34-57>57</a>
</span><span class=lnt id=hl-34-58><a class=lnlinks href=#hl-34-58>58</a>
</span><span class=lnt id=hl-34-59><a class=lnlinks href=#hl-34-59>59</a>
</span><span class=lnt id=hl-34-60><a class=lnlinks href=#hl-34-60>60</a>
</span><span class=lnt id=hl-34-61><a class=lnlinks href=#hl-34-61>61</a>
</span><span class=lnt id=hl-34-62><a class=lnlinks href=#hl-34-62>62</a>
</span><span class=lnt id=hl-34-63><a class=lnlinks href=#hl-34-63>63</a>
</span><span class=lnt id=hl-34-64><a class=lnlinks href=#hl-34-64>64</a>
</span><span class=lnt id=hl-34-65><a class=lnlinks href=#hl-34-65>65</a>
</span><span class=lnt id=hl-34-66><a class=lnlinks href=#hl-34-66>66</a>
</span><span class=lnt id=hl-34-67><a class=lnlinks href=#hl-34-67>67</a>
</span><span class=lnt id=hl-34-68><a class=lnlinks href=#hl-34-68>68</a>
</span><span class=lnt id=hl-34-69><a class=lnlinks href=#hl-34-69>69</a>
</span><span class=lnt id=hl-34-70><a class=lnlinks href=#hl-34-70>70</a>
</span><span class=lnt id=hl-34-71><a class=lnlinks href=#hl-34-71>71</a>
</span><span class=lnt id=hl-34-72><a class=lnlinks href=#hl-34-72>72</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># services/inventory_service.py - 재고 서비스 구현</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shared.event_bus</span> <span class=kn>import</span> <span class=n>EventBus</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>InventoryService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    재고 관리 서비스
</span></span></span><span class=line><span class=cl><span class=s2>    - 상품 재고 확인 및 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>    - 재고 관련 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>inventory_db</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;prod_1&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;stock&#39;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span> <span class=s1>&#39;reserved&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;prod_2&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;stock&#39;</span><span class=p>:</span> <span class=mi>50</span><span class=p>,</span> <span class=s1>&#39;reserved&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주문 생성 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - order.created 이벤트 수신 시 재고 확인
</span></span></span><span class=line><span class=cl><span class=s2>        - 재고 확인 결과를 inventory.checked 이벤트로 응답
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_data</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span> <span class=o>=</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 상품의 재고 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>all_available</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>product_id</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>quantity</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>product_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>inventory_db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>all_available</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=n>available_stock</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>inventory_db</span><span class=p>[</span><span class=n>product_id</span><span class=p>][</span><span class=s1>&#39;stock&#39;</span><span class=p>]</span> <span class=o>-</span> 
</span></span><span class=line><span class=cl>                             <span class=bp>self</span><span class=o>.</span><span class=n>inventory_db</span><span class=p>[</span><span class=n>product_id</span><span class=p>][</span><span class=s1>&#39;reserved&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>available_stock</span> <span class=o>&lt;</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>all_available</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>all_available</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재고 예약 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>product_id</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>quantity</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>inventory_db</span><span class=p>[</span><span class=n>product_id</span><span class=p>][</span><span class=s1>&#39;reserved&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 재고 확인 결과 응답 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;inventory.checked&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;available&#39;</span><span class=p>:</span> <span class=n>all_available</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;checked_items&#39;</span><span class=p>:</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Inventory checked for order </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>all_available</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_service</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;서비스 시작 및 이벤트 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 생성 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe_to_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_patterns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;order.created&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>queue_name</span><span class=o>=</span><span class=s1>&#39;inventory.service.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>handle_order_created</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span><span class=lnt id=hl-35-41><a class=lnlinks href=#hl-35-41>41</a>
</span><span class=lnt id=hl-35-42><a class=lnlinks href=#hl-35-42>42</a>
</span><span class=lnt id=hl-35-43><a class=lnlinks href=#hl-35-43>43</a>
</span><span class=lnt id=hl-35-44><a class=lnlinks href=#hl-35-44>44</a>
</span><span class=lnt id=hl-35-45><a class=lnlinks href=#hl-35-45>45</a>
</span><span class=lnt id=hl-35-46><a class=lnlinks href=#hl-35-46>46</a>
</span><span class=lnt id=hl-35-47><a class=lnlinks href=#hl-35-47>47</a>
</span><span class=lnt id=hl-35-48><a class=lnlinks href=#hl-35-48>48</a>
</span><span class=lnt id=hl-35-49><a class=lnlinks href=#hl-35-49>49</a>
</span><span class=lnt id=hl-35-50><a class=lnlinks href=#hl-35-50>50</a>
</span><span class=lnt id=hl-35-51><a class=lnlinks href=#hl-35-51>51</a>
</span><span class=lnt id=hl-35-52><a class=lnlinks href=#hl-35-52>52</a>
</span><span class=lnt id=hl-35-53><a class=lnlinks href=#hl-35-53>53</a>
</span><span class=lnt id=hl-35-54><a class=lnlinks href=#hl-35-54>54</a>
</span><span class=lnt id=hl-35-55><a class=lnlinks href=#hl-35-55>55</a>
</span><span class=lnt id=hl-35-56><a class=lnlinks href=#hl-35-56>56</a>
</span><span class=lnt id=hl-35-57><a class=lnlinks href=#hl-35-57>57</a>
</span><span class=lnt id=hl-35-58><a class=lnlinks href=#hl-35-58>58</a>
</span><span class=lnt id=hl-35-59><a class=lnlinks href=#hl-35-59>59</a>
</span><span class=lnt id=hl-35-60><a class=lnlinks href=#hl-35-60>60</a>
</span><span class=lnt id=hl-35-61><a class=lnlinks href=#hl-35-61>61</a>
</span><span class=lnt id=hl-35-62><a class=lnlinks href=#hl-35-62>62</a>
</span><span class=lnt id=hl-35-63><a class=lnlinks href=#hl-35-63>63</a>
</span><span class=lnt id=hl-35-64><a class=lnlinks href=#hl-35-64>64</a>
</span><span class=lnt id=hl-35-65><a class=lnlinks href=#hl-35-65>65</a>
</span><span class=lnt id=hl-35-66><a class=lnlinks href=#hl-35-66>66</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yml - 전체 시스템 구성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># RabbitMQ 클러스터</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq:4-management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-node1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5672:5672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;15672:15672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_DEFAULT_USER</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_DEFAULT_PASS</span><span class=p>:</span><span class=w> </span><span class=l>secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_ERLANG_COOKIE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;secret_cookie&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq_data:/var/lib/rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 주문 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>order-service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./services/order_service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://admin:secret@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 재고 서비스  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>inventory-service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./services/inventory_service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://admin:secret@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 결제 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>payment-service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./services/payment_service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://admin:secret@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 알림 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>notification-service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./services/notification_service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://admin:secret@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ecommerce</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=52-실제-도입-사례-실무-사용-예시>5.2 실제 도입 사례 (실무 사용 예시)<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례-실무-사용-예시>#</a></h3><h4 id=사례-1-adidas---스포츠-활동-추적-시스템>사례 1: Adidas - 스포츠 활동 추적 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-adidas---스포츠-활동-추적-시스템>#</a></h4><p><strong>배경</strong>: Adidas는 웨어러블 디바이스에서 수집되는 수백만 건의 운동 데이터를 실시간으로 처리하여 사용자에게 개인화된 피트니스 인사이트를 제공해야 했습니다.</p><p><strong>도입 전 문제점</strong>:</p><ul><li>웨어러블 디바이스에서 발생하는 대량의 실시간 데이터 처리 한계</li><li>서비스 간 직접 API 호출로 인한 시스템 복잡도 증가</li><li>한 서비스 장애 시 전체 데이터 파이프라인 중단</li></ul><p><strong>RabbitMQ 적용 솔루션</strong>:</p><ul><li><strong>조합 기술</strong>: RabbitMQ + Kubernetes + Prometheus + Spring Boot</li><li><strong>아키텍처</strong>: Event-Driven Microservices</li><li><strong>Exchange 타입</strong>: Topic Exchange (활동 유형별 라우팅)</li><li><strong>큐 타입</strong>: Quorum Queue (고가용성 보장)</li></ul><p><strong>효과 분석</strong>:</p><ul><li><strong>처리량 개선</strong>: 시간당 500만 이벤트 처리 (기존 대비 10배 증가)</li><li><strong>시스템 안정성</strong>: 99.9% 가용성 달성</li><li><strong>개발 효율성</strong>: 마이크로서비스 독립 배포로 개발 주기 50% 단축</li><li><strong>확장성</strong>: 트래픽 증가에 따른 선형적 확장 가능</li></ul><h4 id=사례-2-hemnet---부동산-이미지-처리-플랫폼>사례 2: Hemnet - 부동산 이미지 처리 플랫폼<a hidden class=anchor aria-hidden=true href=#사례-2-hemnet---부동산-이미지-처리-플랫폼>#</a></h4><p><strong>배경</strong>: 스웨덴 최대 부동산 플랫폼인 Hemnet은 매일 수만 장의 부동산 사진을 다양한 크기로 변환하여 웹/모바일에서 최적화된 이미지를 제공해야 했습니다.</p><p><strong>도입 전 문제점</strong>:</p><ul><li>동기식 이미지 처리로 인한 사용자 경험 저하</li><li>이미지 처리 작업의 불균등한 분산</li><li>처리 실패 시 재시도 메커니즘 부재</li></ul><p><strong>RabbitMQ 적용 솔루션</strong>:</p><ul><li><strong>조합 기술</strong>: RabbitMQ + Python (Celery) + Redis + Docker Swarm</li><li><strong>아키텍처</strong>: Work Queue Pattern</li><li><strong>큐 설정</strong>: Durable Queue + Message Persistence</li><li><strong>워커 풀</strong>: 동적 스케일링 가능한 이미지 처리 워커</li></ul><p><strong>효과 분석</strong>:</p><ul><li><strong>처리 시간 단축</strong>: 이미지 업로드 후 5분 → 30초 내 변환 완료</li><li><strong>시스템 처리량</strong>: 시간당 10,000장 이미지 동시 처리</li><li><strong>장애 복구</strong>: 워커 장애 시 자동 재처리로 0% 데이터 손실</li><li><strong>비용 절감</strong>: 클라우드 인스턴스 효율적 활용으로 30% 비용 절감</li></ul><h4 id=사례-3-softonic---소프트웨어-배포-플랫폼>사례 3: Softonic - 소프트웨어 배포 플랫폼<a hidden class=anchor aria-hidden=true href=#사례-3-softonic---소프트웨어-배포-플랫폼>#</a></h4><p><strong>배경</strong>: 글로벌 소프트웨어 다운로드 플랫폼인 Softonic은 업로드된 파일의 바이러스 검사, 메타데이터 추출, 배포 프로세스를 자동화해야 했습니다.</p><p><strong>도입 전 문제점</strong>:</p><ul><li>파일 업로드 후 처리 완료까지 긴 대기 시간</li><li>바이러스 검사 실패 시 전체 프로세스 중단</li><li>서비스 간 의존성으로 인한 배포 복잡도</li></ul><p><strong>RabbitMQ 적용 솔루션</strong>:</p><ul><li><strong>조합 기술</strong>: RabbitMQ + Node.js + MongoDB + Elasticsearch</li><li><strong>아키텍처</strong>: Publish-Subscribe + Saga Pattern</li><li><strong>Exchange 타입</strong>: Fanout (파일 처리 단계별 병렬 실행)</li><li><strong>DLQ 전략</strong>: 처리 실패 파일 별도 처리 파이프라인</li></ul><p><strong>효과 분석</strong>:</p><ul><li><strong>사용자 경험</strong>: 파일 업로드 즉시 성공 응답 (기존 15분 → 즉시)</li><li><strong>처리 효율성</strong>: 바이러스 검사, 메타데이터 추출 병렬 처리로 전체 시간 70% 단축</li><li><strong>시스템 복원력</strong>: 개별 처리 단계 실패가 전체 프로세스에 미치는 영향 차단</li><li><strong>모니터링</strong>: 실시간 처리 상태 추적으로 운영 투명성 확보</li></ul><h3 id=53-실제-도입-사례의-코드-구현-1>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현-1>#</a></h3><p><strong>사례 선정</strong>: Hemnet - 부동산 이미지 처리 플랫폼</p><p><strong>비즈니스 배경</strong>: 부동산 중개업체가 원본 고해상도 이미지를 업로드하면, 웹/모바일/썸네일 등 다양한 크기의 이미지를 자동 생성하여 사용자 경험을 최적화</p><p><strong>기술적 요구사항</strong>:</p><ul><li>대용량 이미지 파일 처리 (최대 50MB)</li><li>실시간 이미지 변환 (5가지 해상도)</li><li>처리 실패 시 자동 재시도</li><li>진행 상황 실시간 추적</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>Image Upload API (이미지 업로드 접수)</li><li>RabbitMQ Cluster (작업 큐 관리)</li><li>Image Processing Workers (이미지 변환 워커)</li><li>Redis Cache (처리 상태 캐시)</li><li>PostgreSQL (메타데이터 저장)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        BROKER[부동산 중개업체]
        WEB[웹 포털]
        MOBILE[모바일 앱]
    end
    
    subgraph &#34;API Layer&#34;
        UPLOAD_API[Image Upload API]
        STATUS_API[Processing Status API]
    end
    
    subgraph &#34;Message Queue Layer&#34;
        subgraph &#34;RabbitMQ Cluster&#34;
            IMG_EX[image.processing&lt;br/&gt;Direct Exchange]
            
            RESIZE_Q[resize.queue&lt;br/&gt;이미지 변환 작업]
            METADATA_Q[metadata.queue&lt;br/&gt;메타데이터 추출]
            NOTIFY_Q[notification.queue&lt;br/&gt;완료 알림]
            
            DLQ[dead.letter.queue&lt;br/&gt;실패 작업 처리]
        end
    end
    
    subgraph &#34;Processing Layer&#34;
        RESIZE_WORKER[Image Resize Workers&lt;br/&gt;Auto Scaling Group]
        META_WORKER[Metadata Workers]
        NOTIFY_WORKER[Notification Workers]
    end
    
    subgraph &#34;Storage Layer&#34;
        POSTGRES[(PostgreSQL&lt;br/&gt;메타데이터)]
        REDIS[(Redis&lt;br/&gt;진행 상태)]
        S3[(AWS S3&lt;br/&gt;이미지 저장)]
    end
    
    BROKER --&gt; UPLOAD_API
    WEB --&gt; STATUS_API
    MOBILE --&gt; STATUS_API
    
    UPLOAD_API --&gt; IMG_EX
    IMG_EX --&gt; RESIZE_Q
    IMG_EX --&gt; METADATA_Q
    
    RESIZE_Q --&gt; RESIZE_WORKER
    METADATA_Q --&gt; META_WORKER
    NOTIFY_Q --&gt; NOTIFY_WORKER
    
    RESIZE_WORKER --&gt; IMG_EX
    META_WORKER --&gt; NOTIFY_Q
    
    RESIZE_WORKER --&gt; S3
    META_WORKER --&gt; POSTGRES
    STATUS_API --&gt; REDIS
    
    RESIZE_Q -.-&gt; DLQ
    METADATA_Q -.-&gt; DLQ
</pre><p><strong>Workflow</strong>:</p><ol><li>부동산 중개업체가 원본 이미지 업로드</li><li>Upload API가 이미지를 S3에 저장하고 처리 작업을 큐에 등록</li><li>Image Processing Workers가 5가지 해상도 이미지 자동 생성</li><li>Metadata Workers가 이미지 정보 추출 (크기, 촬영일시, GPS 등)</li><li>Notification Workers가 중개업체에 처리 완료 알림 발송</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>RabbitMQ가 대용량 이미지 처리 작업의 분산 처리 및 부하 조절 담당</li><li>Worker Auto Scaling을 통한 처리량 동적 조절</li><li>DLQ를 통한 실패 작업 별도 처리 및 재시도</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 동기식 처리로 업로드 후 15분 대기, 처리 실패 시 전체 재업로드 필요</li><li><strong>도입 후</strong>: 즉시 업로드 완료 응답, 백그라운드에서 30초 내 처리 완료, 부분 실패 시 해당 단계만 재처리</li></ul><p><strong>구현 예시</strong> (Python/Docker):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1>  1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2>  2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3>  3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4>  4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5>  5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6>  6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7>  7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8>  8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9>  9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10> 10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11> 11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12> 12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13> 13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14> 14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15> 15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16> 16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17> 17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18> 18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19> 19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20> 20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21> 21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22> 22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23> 23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24> 24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25> 25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26> 26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27> 27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28> 28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29> 29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30> 30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31> 31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32> 32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33> 33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34> 34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35> 35</a>
</span><span class=lnt id=hl-37-36><a class=lnlinks href=#hl-37-36> 36</a>
</span><span class=lnt id=hl-37-37><a class=lnlinks href=#hl-37-37> 37</a>
</span><span class=lnt id=hl-37-38><a class=lnlinks href=#hl-37-38> 38</a>
</span><span class=lnt id=hl-37-39><a class=lnlinks href=#hl-37-39> 39</a>
</span><span class=lnt id=hl-37-40><a class=lnlinks href=#hl-37-40> 40</a>
</span><span class=lnt id=hl-37-41><a class=lnlinks href=#hl-37-41> 41</a>
</span><span class=lnt id=hl-37-42><a class=lnlinks href=#hl-37-42> 42</a>
</span><span class=lnt id=hl-37-43><a class=lnlinks href=#hl-37-43> 43</a>
</span><span class=lnt id=hl-37-44><a class=lnlinks href=#hl-37-44> 44</a>
</span><span class=lnt id=hl-37-45><a class=lnlinks href=#hl-37-45> 45</a>
</span><span class=lnt id=hl-37-46><a class=lnlinks href=#hl-37-46> 46</a>
</span><span class=lnt id=hl-37-47><a class=lnlinks href=#hl-37-47> 47</a>
</span><span class=lnt id=hl-37-48><a class=lnlinks href=#hl-37-48> 48</a>
</span><span class=lnt id=hl-37-49><a class=lnlinks href=#hl-37-49> 49</a>
</span><span class=lnt id=hl-37-50><a class=lnlinks href=#hl-37-50> 50</a>
</span><span class=lnt id=hl-37-51><a class=lnlinks href=#hl-37-51> 51</a>
</span><span class=lnt id=hl-37-52><a class=lnlinks href=#hl-37-52> 52</a>
</span><span class=lnt id=hl-37-53><a class=lnlinks href=#hl-37-53> 53</a>
</span><span class=lnt id=hl-37-54><a class=lnlinks href=#hl-37-54> 54</a>
</span><span class=lnt id=hl-37-55><a class=lnlinks href=#hl-37-55> 55</a>
</span><span class=lnt id=hl-37-56><a class=lnlinks href=#hl-37-56> 56</a>
</span><span class=lnt id=hl-37-57><a class=lnlinks href=#hl-37-57> 57</a>
</span><span class=lnt id=hl-37-58><a class=lnlinks href=#hl-37-58> 58</a>
</span><span class=lnt id=hl-37-59><a class=lnlinks href=#hl-37-59> 59</a>
</span><span class=lnt id=hl-37-60><a class=lnlinks href=#hl-37-60> 60</a>
</span><span class=lnt id=hl-37-61><a class=lnlinks href=#hl-37-61> 61</a>
</span><span class=lnt id=hl-37-62><a class=lnlinks href=#hl-37-62> 62</a>
</span><span class=lnt id=hl-37-63><a class=lnlinks href=#hl-37-63> 63</a>
</span><span class=lnt id=hl-37-64><a class=lnlinks href=#hl-37-64> 64</a>
</span><span class=lnt id=hl-37-65><a class=lnlinks href=#hl-37-65> 65</a>
</span><span class=lnt id=hl-37-66><a class=lnlinks href=#hl-37-66> 66</a>
</span><span class=lnt id=hl-37-67><a class=lnlinks href=#hl-37-67> 67</a>
</span><span class=lnt id=hl-37-68><a class=lnlinks href=#hl-37-68> 68</a>
</span><span class=lnt id=hl-37-69><a class=lnlinks href=#hl-37-69> 69</a>
</span><span class=lnt id=hl-37-70><a class=lnlinks href=#hl-37-70> 70</a>
</span><span class=lnt id=hl-37-71><a class=lnlinks href=#hl-37-71> 71</a>
</span><span class=lnt id=hl-37-72><a class=lnlinks href=#hl-37-72> 72</a>
</span><span class=lnt id=hl-37-73><a class=lnlinks href=#hl-37-73> 73</a>
</span><span class=lnt id=hl-37-74><a class=lnlinks href=#hl-37-74> 74</a>
</span><span class=lnt id=hl-37-75><a class=lnlinks href=#hl-37-75> 75</a>
</span><span class=lnt id=hl-37-76><a class=lnlinks href=#hl-37-76> 76</a>
</span><span class=lnt id=hl-37-77><a class=lnlinks href=#hl-37-77> 77</a>
</span><span class=lnt id=hl-37-78><a class=lnlinks href=#hl-37-78> 78</a>
</span><span class=lnt id=hl-37-79><a class=lnlinks href=#hl-37-79> 79</a>
</span><span class=lnt id=hl-37-80><a class=lnlinks href=#hl-37-80> 80</a>
</span><span class=lnt id=hl-37-81><a class=lnlinks href=#hl-37-81> 81</a>
</span><span class=lnt id=hl-37-82><a class=lnlinks href=#hl-37-82> 82</a>
</span><span class=lnt id=hl-37-83><a class=lnlinks href=#hl-37-83> 83</a>
</span><span class=lnt id=hl-37-84><a class=lnlinks href=#hl-37-84> 84</a>
</span><span class=lnt id=hl-37-85><a class=lnlinks href=#hl-37-85> 85</a>
</span><span class=lnt id=hl-37-86><a class=lnlinks href=#hl-37-86> 86</a>
</span><span class=lnt id=hl-37-87><a class=lnlinks href=#hl-37-87> 87</a>
</span><span class=lnt id=hl-37-88><a class=lnlinks href=#hl-37-88> 88</a>
</span><span class=lnt id=hl-37-89><a class=lnlinks href=#hl-37-89> 89</a>
</span><span class=lnt id=hl-37-90><a class=lnlinks href=#hl-37-90> 90</a>
</span><span class=lnt id=hl-37-91><a class=lnlinks href=#hl-37-91> 91</a>
</span><span class=lnt id=hl-37-92><a class=lnlinks href=#hl-37-92> 92</a>
</span><span class=lnt id=hl-37-93><a class=lnlinks href=#hl-37-93> 93</a>
</span><span class=lnt id=hl-37-94><a class=lnlinks href=#hl-37-94> 94</a>
</span><span class=lnt id=hl-37-95><a class=lnlinks href=#hl-37-95> 95</a>
</span><span class=lnt id=hl-37-96><a class=lnlinks href=#hl-37-96> 96</a>
</span><span class=lnt id=hl-37-97><a class=lnlinks href=#hl-37-97> 97</a>
</span><span class=lnt id=hl-37-98><a class=lnlinks href=#hl-37-98> 98</a>
</span><span class=lnt id=hl-37-99><a class=lnlinks href=#hl-37-99> 99</a>
</span><span class=lnt id=hl-37-100><a class=lnlinks href=#hl-37-100>100</a>
</span><span class=lnt id=hl-37-101><a class=lnlinks href=#hl-37-101>101</a>
</span><span class=lnt id=hl-37-102><a class=lnlinks href=#hl-37-102>102</a>
</span><span class=lnt id=hl-37-103><a class=lnlinks href=#hl-37-103>103</a>
</span><span class=lnt id=hl-37-104><a class=lnlinks href=#hl-37-104>104</a>
</span><span class=lnt id=hl-37-105><a class=lnlinks href=#hl-37-105>105</a>
</span><span class=lnt id=hl-37-106><a class=lnlinks href=#hl-37-106>106</a>
</span><span class=lnt id=hl-37-107><a class=lnlinks href=#hl-37-107>107</a>
</span><span class=lnt id=hl-37-108><a class=lnlinks href=#hl-37-108>108</a>
</span><span class=lnt id=hl-37-109><a class=lnlinks href=#hl-37-109>109</a>
</span><span class=lnt id=hl-37-110><a class=lnlinks href=#hl-37-110>110</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># services/image_upload_api.py - 이미지 업로드 API</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>UploadFile</span><span class=p>,</span> <span class=n>File</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shared.event_bus</span> <span class=kn>import</span> <span class=n>EventBus</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ImageUploadService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이미지 업로드 및 처리 시작 서비스
</span></span></span><span class=line><span class=cl><span class=s2>    - 대용량 이미지 파일 업로드 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - 이미지 처리 작업을 RabbitMQ 큐에 등록
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;redis&#39;</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bucket_name</span> <span class=o>=</span> <span class=s1>&#39;hemnet-property-images&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>upload_and_process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file</span><span class=p>:</span> <span class=n>UploadFile</span><span class=p>,</span> <span class=n>property_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이미지 업로드 및 처리 작업 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 고유한 이미지 ID 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>image_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>original_filename</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;original/</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># S3에 원본 이미지 업로드</span>
</span></span><span class=line><span class=cl>            <span class=n>file_content</span> <span class=o>=</span> <span class=k>await</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span><span class=o>.</span><span class=n>put_object</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>Bucket</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bucket_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>Key</span><span class=o>=</span><span class=n>original_filename</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>Body</span><span class=o>=</span><span class=n>file_content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>ContentType</span><span class=o>=</span><span class=n>file</span><span class=o>.</span><span class=n>content_type</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 처리 상태 초기화 (Redis에 캐시)</span>
</span></span><span class=line><span class=cl>            <span class=n>processing_status</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;property_id&#39;</span><span class=p>:</span> <span class=n>property_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;uploaded&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;progress&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;original_url&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;s3://</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>bucket_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>original_filename</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;processed_urls&#39;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;processing:</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=mi>3600</span><span class=p>,</span>  <span class=c1># 1시간 TTL</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>processing_status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 이미지 처리 작업을 큐에 등록</span>
</span></span><span class=line><span class=cl>            <span class=n>processing_task</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;property_id&#39;</span><span class=p>:</span> <span class=n>property_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;original_url&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;s3://</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>bucket_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>original_filename</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;file_size&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>file_content</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;content_type&#39;</span><span class=p>:</span> <span class=n>file</span><span class=o>.</span><span class=n>content_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;target_sizes&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;thumbnail&#39;</span><span class=p>,</span> <span class=s1>&#39;small&#39;</span><span class=p>,</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span> <span class=s1>&#39;large&#39;</span><span class=p>,</span> <span class=s1>&#39;xlarge&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># RabbitMQ를 통해 이미지 처리 작업 발행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image.processing.start&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>processing_task</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;processing_started&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;tracking_url&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;/api/images/</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>/status&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;Upload failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FastAPI 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=n>upload_service</span> <span class=o>=</span> <span class=n>ImageUploadService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/images/upload&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>upload_image</span><span class=p>(</span><span class=n>file</span><span class=p>:</span> <span class=n>UploadFile</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>property_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이미지 업로드 엔드포인트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>property_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;property_id is required&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 파일 크기 및 타입 검증</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>50</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>:</span>  <span class=c1># 50MB 제한</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>413</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;File too large&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=o>.</span><span class=n>content_type</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;image/&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Only image files allowed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>upload_service</span><span class=o>.</span><span class=n>upload_and_process</span><span class=p>(</span><span class=n>file</span><span class=p>,</span> <span class=n>property_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/api/images/</span><span class=si>{image_id}</span><span class=s2>/status&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_processing_status</span><span class=p>(</span><span class=n>image_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;이미지 처리 상태 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>status_data</span> <span class=o>=</span> <span class=n>upload_service</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;processing:</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>status_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>404</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Image not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>status_data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1>  1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2>  2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3>  3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4>  4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5>  5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6>  6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7>  7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8>  8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9>  9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10> 10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11> 11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12> 12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13> 13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14> 14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15> 15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16> 16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17> 17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18> 18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19> 19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20> 20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21> 21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22> 22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23> 23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24> 24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25> 25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26> 26</a>
</span><span class=lnt id=hl-38-27><a class=lnlinks href=#hl-38-27> 27</a>
</span><span class=lnt id=hl-38-28><a class=lnlinks href=#hl-38-28> 28</a>
</span><span class=lnt id=hl-38-29><a class=lnlinks href=#hl-38-29> 29</a>
</span><span class=lnt id=hl-38-30><a class=lnlinks href=#hl-38-30> 30</a>
</span><span class=lnt id=hl-38-31><a class=lnlinks href=#hl-38-31> 31</a>
</span><span class=lnt id=hl-38-32><a class=lnlinks href=#hl-38-32> 32</a>
</span><span class=lnt id=hl-38-33><a class=lnlinks href=#hl-38-33> 33</a>
</span><span class=lnt id=hl-38-34><a class=lnlinks href=#hl-38-34> 34</a>
</span><span class=lnt id=hl-38-35><a class=lnlinks href=#hl-38-35> 35</a>
</span><span class=lnt id=hl-38-36><a class=lnlinks href=#hl-38-36> 36</a>
</span><span class=lnt id=hl-38-37><a class=lnlinks href=#hl-38-37> 37</a>
</span><span class=lnt id=hl-38-38><a class=lnlinks href=#hl-38-38> 38</a>
</span><span class=lnt id=hl-38-39><a class=lnlinks href=#hl-38-39> 39</a>
</span><span class=lnt id=hl-38-40><a class=lnlinks href=#hl-38-40> 40</a>
</span><span class=lnt id=hl-38-41><a class=lnlinks href=#hl-38-41> 41</a>
</span><span class=lnt id=hl-38-42><a class=lnlinks href=#hl-38-42> 42</a>
</span><span class=lnt id=hl-38-43><a class=lnlinks href=#hl-38-43> 43</a>
</span><span class=lnt id=hl-38-44><a class=lnlinks href=#hl-38-44> 44</a>
</span><span class=lnt id=hl-38-45><a class=lnlinks href=#hl-38-45> 45</a>
</span><span class=lnt id=hl-38-46><a class=lnlinks href=#hl-38-46> 46</a>
</span><span class=lnt id=hl-38-47><a class=lnlinks href=#hl-38-47> 47</a>
</span><span class=lnt id=hl-38-48><a class=lnlinks href=#hl-38-48> 48</a>
</span><span class=lnt id=hl-38-49><a class=lnlinks href=#hl-38-49> 49</a>
</span><span class=lnt id=hl-38-50><a class=lnlinks href=#hl-38-50> 50</a>
</span><span class=lnt id=hl-38-51><a class=lnlinks href=#hl-38-51> 51</a>
</span><span class=lnt id=hl-38-52><a class=lnlinks href=#hl-38-52> 52</a>
</span><span class=lnt id=hl-38-53><a class=lnlinks href=#hl-38-53> 53</a>
</span><span class=lnt id=hl-38-54><a class=lnlinks href=#hl-38-54> 54</a>
</span><span class=lnt id=hl-38-55><a class=lnlinks href=#hl-38-55> 55</a>
</span><span class=lnt id=hl-38-56><a class=lnlinks href=#hl-38-56> 56</a>
</span><span class=lnt id=hl-38-57><a class=lnlinks href=#hl-38-57> 57</a>
</span><span class=lnt id=hl-38-58><a class=lnlinks href=#hl-38-58> 58</a>
</span><span class=lnt id=hl-38-59><a class=lnlinks href=#hl-38-59> 59</a>
</span><span class=lnt id=hl-38-60><a class=lnlinks href=#hl-38-60> 60</a>
</span><span class=lnt id=hl-38-61><a class=lnlinks href=#hl-38-61> 61</a>
</span><span class=lnt id=hl-38-62><a class=lnlinks href=#hl-38-62> 62</a>
</span><span class=lnt id=hl-38-63><a class=lnlinks href=#hl-38-63> 63</a>
</span><span class=lnt id=hl-38-64><a class=lnlinks href=#hl-38-64> 64</a>
</span><span class=lnt id=hl-38-65><a class=lnlinks href=#hl-38-65> 65</a>
</span><span class=lnt id=hl-38-66><a class=lnlinks href=#hl-38-66> 66</a>
</span><span class=lnt id=hl-38-67><a class=lnlinks href=#hl-38-67> 67</a>
</span><span class=lnt id=hl-38-68><a class=lnlinks href=#hl-38-68> 68</a>
</span><span class=lnt id=hl-38-69><a class=lnlinks href=#hl-38-69> 69</a>
</span><span class=lnt id=hl-38-70><a class=lnlinks href=#hl-38-70> 70</a>
</span><span class=lnt id=hl-38-71><a class=lnlinks href=#hl-38-71> 71</a>
</span><span class=lnt id=hl-38-72><a class=lnlinks href=#hl-38-72> 72</a>
</span><span class=lnt id=hl-38-73><a class=lnlinks href=#hl-38-73> 73</a>
</span><span class=lnt id=hl-38-74><a class=lnlinks href=#hl-38-74> 74</a>
</span><span class=lnt id=hl-38-75><a class=lnlinks href=#hl-38-75> 75</a>
</span><span class=lnt id=hl-38-76><a class=lnlinks href=#hl-38-76> 76</a>
</span><span class=lnt id=hl-38-77><a class=lnlinks href=#hl-38-77> 77</a>
</span><span class=lnt id=hl-38-78><a class=lnlinks href=#hl-38-78> 78</a>
</span><span class=lnt id=hl-38-79><a class=lnlinks href=#hl-38-79> 79</a>
</span><span class=lnt id=hl-38-80><a class=lnlinks href=#hl-38-80> 80</a>
</span><span class=lnt id=hl-38-81><a class=lnlinks href=#hl-38-81> 81</a>
</span><span class=lnt id=hl-38-82><a class=lnlinks href=#hl-38-82> 82</a>
</span><span class=lnt id=hl-38-83><a class=lnlinks href=#hl-38-83> 83</a>
</span><span class=lnt id=hl-38-84><a class=lnlinks href=#hl-38-84> 84</a>
</span><span class=lnt id=hl-38-85><a class=lnlinks href=#hl-38-85> 85</a>
</span><span class=lnt id=hl-38-86><a class=lnlinks href=#hl-38-86> 86</a>
</span><span class=lnt id=hl-38-87><a class=lnlinks href=#hl-38-87> 87</a>
</span><span class=lnt id=hl-38-88><a class=lnlinks href=#hl-38-88> 88</a>
</span><span class=lnt id=hl-38-89><a class=lnlinks href=#hl-38-89> 89</a>
</span><span class=lnt id=hl-38-90><a class=lnlinks href=#hl-38-90> 90</a>
</span><span class=lnt id=hl-38-91><a class=lnlinks href=#hl-38-91> 91</a>
</span><span class=lnt id=hl-38-92><a class=lnlinks href=#hl-38-92> 92</a>
</span><span class=lnt id=hl-38-93><a class=lnlinks href=#hl-38-93> 93</a>
</span><span class=lnt id=hl-38-94><a class=lnlinks href=#hl-38-94> 94</a>
</span><span class=lnt id=hl-38-95><a class=lnlinks href=#hl-38-95> 95</a>
</span><span class=lnt id=hl-38-96><a class=lnlinks href=#hl-38-96> 96</a>
</span><span class=lnt id=hl-38-97><a class=lnlinks href=#hl-38-97> 97</a>
</span><span class=lnt id=hl-38-98><a class=lnlinks href=#hl-38-98> 98</a>
</span><span class=lnt id=hl-38-99><a class=lnlinks href=#hl-38-99> 99</a>
</span><span class=lnt id=hl-38-100><a class=lnlinks href=#hl-38-100>100</a>
</span><span class=lnt id=hl-38-101><a class=lnlinks href=#hl-38-101>101</a>
</span><span class=lnt id=hl-38-102><a class=lnlinks href=#hl-38-102>102</a>
</span><span class=lnt id=hl-38-103><a class=lnlinks href=#hl-38-103>103</a>
</span><span class=lnt id=hl-38-104><a class=lnlinks href=#hl-38-104>104</a>
</span><span class=lnt id=hl-38-105><a class=lnlinks href=#hl-38-105>105</a>
</span><span class=lnt id=hl-38-106><a class=lnlinks href=#hl-38-106>106</a>
</span><span class=lnt id=hl-38-107><a class=lnlinks href=#hl-38-107>107</a>
</span><span class=lnt id=hl-38-108><a class=lnlinks href=#hl-38-108>108</a>
</span><span class=lnt id=hl-38-109><a class=lnlinks href=#hl-38-109>109</a>
</span><span class=lnt id=hl-38-110><a class=lnlinks href=#hl-38-110>110</a>
</span><span class=lnt id=hl-38-111><a class=lnlinks href=#hl-38-111>111</a>
</span><span class=lnt id=hl-38-112><a class=lnlinks href=#hl-38-112>112</a>
</span><span class=lnt id=hl-38-113><a class=lnlinks href=#hl-38-113>113</a>
</span><span class=lnt id=hl-38-114><a class=lnlinks href=#hl-38-114>114</a>
</span><span class=lnt id=hl-38-115><a class=lnlinks href=#hl-38-115>115</a>
</span><span class=lnt id=hl-38-116><a class=lnlinks href=#hl-38-116>116</a>
</span><span class=lnt id=hl-38-117><a class=lnlinks href=#hl-38-117>117</a>
</span><span class=lnt id=hl-38-118><a class=lnlinks href=#hl-38-118>118</a>
</span><span class=lnt id=hl-38-119><a class=lnlinks href=#hl-38-119>119</a>
</span><span class=lnt id=hl-38-120><a class=lnlinks href=#hl-38-120>120</a>
</span><span class=lnt id=hl-38-121><a class=lnlinks href=#hl-38-121>121</a>
</span><span class=lnt id=hl-38-122><a class=lnlinks href=#hl-38-122>122</a>
</span><span class=lnt id=hl-38-123><a class=lnlinks href=#hl-38-123>123</a>
</span><span class=lnt id=hl-38-124><a class=lnlinks href=#hl-38-124>124</a>
</span><span class=lnt id=hl-38-125><a class=lnlinks href=#hl-38-125>125</a>
</span><span class=lnt id=hl-38-126><a class=lnlinks href=#hl-38-126>126</a>
</span><span class=lnt id=hl-38-127><a class=lnlinks href=#hl-38-127>127</a>
</span><span class=lnt id=hl-38-128><a class=lnlinks href=#hl-38-128>128</a>
</span><span class=lnt id=hl-38-129><a class=lnlinks href=#hl-38-129>129</a>
</span><span class=lnt id=hl-38-130><a class=lnlinks href=#hl-38-130>130</a>
</span><span class=lnt id=hl-38-131><a class=lnlinks href=#hl-38-131>131</a>
</span><span class=lnt id=hl-38-132><a class=lnlinks href=#hl-38-132>132</a>
</span><span class=lnt id=hl-38-133><a class=lnlinks href=#hl-38-133>133</a>
</span><span class=lnt id=hl-38-134><a class=lnlinks href=#hl-38-134>134</a>
</span><span class=lnt id=hl-38-135><a class=lnlinks href=#hl-38-135>135</a>
</span><span class=lnt id=hl-38-136><a class=lnlinks href=#hl-38-136>136</a>
</span><span class=lnt id=hl-38-137><a class=lnlinks href=#hl-38-137>137</a>
</span><span class=lnt id=hl-38-138><a class=lnlinks href=#hl-38-138>138</a>
</span><span class=lnt id=hl-38-139><a class=lnlinks href=#hl-38-139>139</a>
</span><span class=lnt id=hl-38-140><a class=lnlinks href=#hl-38-140>140</a>
</span><span class=lnt id=hl-38-141><a class=lnlinks href=#hl-38-141>141</a>
</span><span class=lnt id=hl-38-142><a class=lnlinks href=#hl-38-142>142</a>
</span><span class=lnt id=hl-38-143><a class=lnlinks href=#hl-38-143>143</a>
</span><span class=lnt id=hl-38-144><a class=lnlinks href=#hl-38-144>144</a>
</span><span class=lnt id=hl-38-145><a class=lnlinks href=#hl-38-145>145</a>
</span><span class=lnt id=hl-38-146><a class=lnlinks href=#hl-38-146>146</a>
</span><span class=lnt id=hl-38-147><a class=lnlinks href=#hl-38-147>147</a>
</span><span class=lnt id=hl-38-148><a class=lnlinks href=#hl-38-148>148</a>
</span><span class=lnt id=hl-38-149><a class=lnlinks href=#hl-38-149>149</a>
</span><span class=lnt id=hl-38-150><a class=lnlinks href=#hl-38-150>150</a>
</span><span class=lnt id=hl-38-151><a class=lnlinks href=#hl-38-151>151</a>
</span><span class=lnt id=hl-38-152><a class=lnlinks href=#hl-38-152>152</a>
</span><span class=lnt id=hl-38-153><a class=lnlinks href=#hl-38-153>153</a>
</span><span class=lnt id=hl-38-154><a class=lnlinks href=#hl-38-154>154</a>
</span><span class=lnt id=hl-38-155><a class=lnlinks href=#hl-38-155>155</a>
</span><span class=lnt id=hl-38-156><a class=lnlinks href=#hl-38-156>156</a>
</span><span class=lnt id=hl-38-157><a class=lnlinks href=#hl-38-157>157</a>
</span><span class=lnt id=hl-38-158><a class=lnlinks href=#hl-38-158>158</a>
</span><span class=lnt id=hl-38-159><a class=lnlinks href=#hl-38-159>159</a>
</span><span class=lnt id=hl-38-160><a class=lnlinks href=#hl-38-160>160</a>
</span><span class=lnt id=hl-38-161><a class=lnlinks href=#hl-38-161>161</a>
</span><span class=lnt id=hl-38-162><a class=lnlinks href=#hl-38-162>162</a>
</span><span class=lnt id=hl-38-163><a class=lnlinks href=#hl-38-163>163</a>
</span><span class=lnt id=hl-38-164><a class=lnlinks href=#hl-38-164>164</a>
</span><span class=lnt id=hl-38-165><a class=lnlinks href=#hl-38-165>165</a>
</span><span class=lnt id=hl-38-166><a class=lnlinks href=#hl-38-166>166</a>
</span><span class=lnt id=hl-38-167><a class=lnlinks href=#hl-38-167>167</a>
</span><span class=lnt id=hl-38-168><a class=lnlinks href=#hl-38-168>168</a>
</span><span class=lnt id=hl-38-169><a class=lnlinks href=#hl-38-169>169</a>
</span><span class=lnt id=hl-38-170><a class=lnlinks href=#hl-38-170>170</a>
</span><span class=lnt id=hl-38-171><a class=lnlinks href=#hl-38-171>171</a>
</span><span class=lnt id=hl-38-172><a class=lnlinks href=#hl-38-172>172</a>
</span><span class=lnt id=hl-38-173><a class=lnlinks href=#hl-38-173>173</a>
</span><span class=lnt id=hl-38-174><a class=lnlinks href=#hl-38-174>174</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># workers/image_processing_worker.py - 이미지 처리 워커</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shared.event_bus</span> <span class=kn>import</span> <span class=n>EventBus</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>io</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ImageProcessingWorker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이미지 변환 처리 워커
</span></span></span><span class=line><span class=cl><span class=s2>    - 원본 이미지를 5가지 크기로 변환
</span></span></span><span class=line><span class=cl><span class=s2>    - 처리 진행률을 실시간으로 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>    - 실패 시 재시도 메커니즘 적용
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;redis&#39;</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이미지 크기 정의 (Hemnet 실제 사용 크기)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>size_configs</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;thumbnail&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>150</span><span class=p>,</span> <span class=mi>150</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;small&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>300</span><span class=p>,</span> <span class=mi>200</span><span class=p>),</span>  
</span></span><span class=line><span class=cl>            <span class=s1>&#39;medium&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>400</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;large&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>1200</span><span class=p>,</span> <span class=mi>800</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;xlarge&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1280</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_image_resizing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이미지 리사이징 처리 메인 함수
</span></span></span><span class=line><span class=cl><span class=s2>        - image.processing.start 이벤트 수신 시 호출
</span></span></span><span class=line><span class=cl><span class=s2>        - 각 크기별 이미지 변환 및 S3 업로드
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>	        
</span></span><span class=line><span class=cl>            <span class=n>image_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>original_url</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;original_url&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>target_sizes</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;target_sizes&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 처리 상태 업데이트: 시작</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_update_processing_status</span><span class=p>(</span><span class=n>image_id</span><span class=p>,</span> <span class=s1>&#39;processing&#39;</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># S3에서 원본 이미지 다운로드</span>
</span></span><span class=line><span class=cl>            <span class=n>bucket_name</span> <span class=o>=</span> <span class=n>original_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>object_key</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>original_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=mi>3</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span><span class=o>.</span><span class=n>get_object</span><span class=p>(</span><span class=n>Bucket</span><span class=o>=</span><span class=n>bucket_name</span><span class=p>,</span> <span class=n>Key</span><span class=o>=</span><span class=n>object_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>image_data</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Body&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># PIL Image 객체 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>original_image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>image_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>processed_urls</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=n>total_sizes</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>target_sizes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 각 크기별 이미지 생성 및 업로드</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>size_name</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>target_sizes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>target_width</span><span class=p>,</span> <span class=n>target_height</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>size_configs</span><span class=p>[</span><span class=n>size_name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 종횡비 유지하면서 리사이징</span>
</span></span><span class=line><span class=cl>                    <span class=n>resized_image</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resize_with_aspect_ratio</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>original_image</span><span class=p>,</span> <span class=n>target_width</span><span class=p>,</span> <span class=n>target_height</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 리사이즈된 이미지를 바이트로 변환</span>
</span></span><span class=line><span class=cl>                    <span class=n>img_buffer</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=n>resized_image</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>img_buffer</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s1>&#39;JPEG&#39;</span><span class=p>,</span> <span class=n>quality</span><span class=o>=</span><span class=mi>85</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>img_buffer</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># S3에 변환된 이미지 업로드</span>
</span></span><span class=line><span class=cl>                    <span class=n>processed_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;processed/</span><span class=si>{</span><span class=n>size_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>.jpg&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span><span class=o>.</span><span class=n>put_object</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>Bucket</span><span class=o>=</span><span class=n>bucket_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>Key</span><span class=o>=</span><span class=n>processed_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>Body</span><span class=o>=</span><span class=n>img_buffer</span><span class=o>.</span><span class=n>getvalue</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=n>ContentType</span><span class=o>=</span><span class=s1>&#39;image/jpeg&#39;</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>processed_urls</span><span class=p>[</span><span class=n>size_name</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;s3://</span><span class=si>{</span><span class=n>bucket_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>processed_key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 진행률 업데이트 (20% ~ 80% 범위)</span>
</span></span><span class=line><span class=cl>                    <span class=n>progress</span> <span class=o>=</span> <span class=mi>20</span> <span class=o>+</span> <span class=nb>int</span><span class=p>((</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_sizes</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_update_processing_status</span><span class=p>(</span><span class=n>image_id</span><span class=p>,</span> <span class=s1>&#39;processing&#39;</span><span class=p>,</span> <span class=n>progress</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processed </span><span class=si>{</span><span class=n>size_name</span><span class=si>}</span><span class=s2> for image </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to process </span><span class=si>{</span><span class=n>size_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 개별 크기 실패는 전체 작업을 중단하지 않음</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 이미지 처리 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=n>completion_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;property_id&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;property_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;processed_urls&#39;</span><span class=p>:</span> <span class=n>processed_urls</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;original_url&#39;</span><span class=p>:</span> <span class=n>original_url</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;image.processing.completed&#39;</span><span class=p>,</span> <span class=n>completion_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_update_processing_status</span><span class=p>(</span><span class=n>image_id</span><span class=p>,</span> <span class=s1>&#39;resize_completed&#39;</span><span class=p>,</span> <span class=mi>85</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Image processing failed for </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_update_processing_status</span><span class=p>(</span><span class=n>image_id</span><span class=p>,</span> <span class=s1>&#39;failed&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실패한 작업을 DLQ로 전송하여 나중에 재처리</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;image.processing.failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;retry_count&#39;</span><span class=p>:</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;retry_count&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_resize_with_aspect_ratio</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>image</span><span class=p>:</span> <span class=n>Image</span><span class=p>,</span> <span class=n>max_width</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>max_height</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        종횡비를 유지하면서 이미지 리사이징
</span></span></span><span class=line><span class=cl><span class=s2>        - 긴 쪽을 기준으로 비율 계산하여 품질 손실 최소화
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>original_width</span><span class=p>,</span> <span class=n>original_height</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 종횡비 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>width_ratio</span> <span class=o>=</span> <span class=n>max_width</span> <span class=o>/</span> <span class=n>original_width</span>
</span></span><span class=line><span class=cl>        <span class=n>height_ratio</span> <span class=o>=</span> <span class=n>max_height</span> <span class=o>/</span> <span class=n>original_height</span>
</span></span><span class=line><span class=cl>        <span class=n>ratio</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>width_ratio</span><span class=p>,</span> <span class=n>height_ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 새로운 크기 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>new_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>original_width</span> <span class=o>*</span> <span class=n>ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>new_height</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>original_height</span> <span class=o>*</span> <span class=n>ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 고품질 리샘플링으로 리사이징</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>image</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=n>new_width</span><span class=p>,</span> <span class=n>new_height</span><span class=p>),</span> <span class=n>Image</span><span class=o>.</span><span class=n>Resampling</span><span class=o>.</span><span class=n>LANCZOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_processing_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>image_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>status</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>progress</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>error</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Redis에 처리 상태 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>status_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;processing:</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>status_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_status</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>status_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>current_status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>status_data</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;progress&#39;</span><span class=p>:</span> <span class=n>progress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;updated_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>status_data</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>error</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>status_key</span><span class=p>,</span> <span class=mi>3600</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>status_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_worker</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;워커 시작 및 이벤트 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이미지 처리 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe_to_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_patterns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;image.processing.start&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>queue_name</span><span class=o>=</span><span class=s1>&#39;image.resize.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>process_image_resizing</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Image processing worker started&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 워커 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span> <span class=o>=</span> <span class=n>ImageProcessingWorker</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>worker</span><span class=o>.</span><span class=n>start_worker</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1>  1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2>  2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3>  3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4>  4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5>  5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6>  6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7>  7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8>  8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9>  9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10> 10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11> 11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12> 12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13> 13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14> 14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15> 15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16> 16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17> 17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18> 18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19> 19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20> 20</a>
</span><span class=lnt id=hl-39-21><a class=lnlinks href=#hl-39-21> 21</a>
</span><span class=lnt id=hl-39-22><a class=lnlinks href=#hl-39-22> 22</a>
</span><span class=lnt id=hl-39-23><a class=lnlinks href=#hl-39-23> 23</a>
</span><span class=lnt id=hl-39-24><a class=lnlinks href=#hl-39-24> 24</a>
</span><span class=lnt id=hl-39-25><a class=lnlinks href=#hl-39-25> 25</a>
</span><span class=lnt id=hl-39-26><a class=lnlinks href=#hl-39-26> 26</a>
</span><span class=lnt id=hl-39-27><a class=lnlinks href=#hl-39-27> 27</a>
</span><span class=lnt id=hl-39-28><a class=lnlinks href=#hl-39-28> 28</a>
</span><span class=lnt id=hl-39-29><a class=lnlinks href=#hl-39-29> 29</a>
</span><span class=lnt id=hl-39-30><a class=lnlinks href=#hl-39-30> 30</a>
</span><span class=lnt id=hl-39-31><a class=lnlinks href=#hl-39-31> 31</a>
</span><span class=lnt id=hl-39-32><a class=lnlinks href=#hl-39-32> 32</a>
</span><span class=lnt id=hl-39-33><a class=lnlinks href=#hl-39-33> 33</a>
</span><span class=lnt id=hl-39-34><a class=lnlinks href=#hl-39-34> 34</a>
</span><span class=lnt id=hl-39-35><a class=lnlinks href=#hl-39-35> 35</a>
</span><span class=lnt id=hl-39-36><a class=lnlinks href=#hl-39-36> 36</a>
</span><span class=lnt id=hl-39-37><a class=lnlinks href=#hl-39-37> 37</a>
</span><span class=lnt id=hl-39-38><a class=lnlinks href=#hl-39-38> 38</a>
</span><span class=lnt id=hl-39-39><a class=lnlinks href=#hl-39-39> 39</a>
</span><span class=lnt id=hl-39-40><a class=lnlinks href=#hl-39-40> 40</a>
</span><span class=lnt id=hl-39-41><a class=lnlinks href=#hl-39-41> 41</a>
</span><span class=lnt id=hl-39-42><a class=lnlinks href=#hl-39-42> 42</a>
</span><span class=lnt id=hl-39-43><a class=lnlinks href=#hl-39-43> 43</a>
</span><span class=lnt id=hl-39-44><a class=lnlinks href=#hl-39-44> 44</a>
</span><span class=lnt id=hl-39-45><a class=lnlinks href=#hl-39-45> 45</a>
</span><span class=lnt id=hl-39-46><a class=lnlinks href=#hl-39-46> 46</a>
</span><span class=lnt id=hl-39-47><a class=lnlinks href=#hl-39-47> 47</a>
</span><span class=lnt id=hl-39-48><a class=lnlinks href=#hl-39-48> 48</a>
</span><span class=lnt id=hl-39-49><a class=lnlinks href=#hl-39-49> 49</a>
</span><span class=lnt id=hl-39-50><a class=lnlinks href=#hl-39-50> 50</a>
</span><span class=lnt id=hl-39-51><a class=lnlinks href=#hl-39-51> 51</a>
</span><span class=lnt id=hl-39-52><a class=lnlinks href=#hl-39-52> 52</a>
</span><span class=lnt id=hl-39-53><a class=lnlinks href=#hl-39-53> 53</a>
</span><span class=lnt id=hl-39-54><a class=lnlinks href=#hl-39-54> 54</a>
</span><span class=lnt id=hl-39-55><a class=lnlinks href=#hl-39-55> 55</a>
</span><span class=lnt id=hl-39-56><a class=lnlinks href=#hl-39-56> 56</a>
</span><span class=lnt id=hl-39-57><a class=lnlinks href=#hl-39-57> 57</a>
</span><span class=lnt id=hl-39-58><a class=lnlinks href=#hl-39-58> 58</a>
</span><span class=lnt id=hl-39-59><a class=lnlinks href=#hl-39-59> 59</a>
</span><span class=lnt id=hl-39-60><a class=lnlinks href=#hl-39-60> 60</a>
</span><span class=lnt id=hl-39-61><a class=lnlinks href=#hl-39-61> 61</a>
</span><span class=lnt id=hl-39-62><a class=lnlinks href=#hl-39-62> 62</a>
</span><span class=lnt id=hl-39-63><a class=lnlinks href=#hl-39-63> 63</a>
</span><span class=lnt id=hl-39-64><a class=lnlinks href=#hl-39-64> 64</a>
</span><span class=lnt id=hl-39-65><a class=lnlinks href=#hl-39-65> 65</a>
</span><span class=lnt id=hl-39-66><a class=lnlinks href=#hl-39-66> 66</a>
</span><span class=lnt id=hl-39-67><a class=lnlinks href=#hl-39-67> 67</a>
</span><span class=lnt id=hl-39-68><a class=lnlinks href=#hl-39-68> 68</a>
</span><span class=lnt id=hl-39-69><a class=lnlinks href=#hl-39-69> 69</a>
</span><span class=lnt id=hl-39-70><a class=lnlinks href=#hl-39-70> 70</a>
</span><span class=lnt id=hl-39-71><a class=lnlinks href=#hl-39-71> 71</a>
</span><span class=lnt id=hl-39-72><a class=lnlinks href=#hl-39-72> 72</a>
</span><span class=lnt id=hl-39-73><a class=lnlinks href=#hl-39-73> 73</a>
</span><span class=lnt id=hl-39-74><a class=lnlinks href=#hl-39-74> 74</a>
</span><span class=lnt id=hl-39-75><a class=lnlinks href=#hl-39-75> 75</a>
</span><span class=lnt id=hl-39-76><a class=lnlinks href=#hl-39-76> 76</a>
</span><span class=lnt id=hl-39-77><a class=lnlinks href=#hl-39-77> 77</a>
</span><span class=lnt id=hl-39-78><a class=lnlinks href=#hl-39-78> 78</a>
</span><span class=lnt id=hl-39-79><a class=lnlinks href=#hl-39-79> 79</a>
</span><span class=lnt id=hl-39-80><a class=lnlinks href=#hl-39-80> 80</a>
</span><span class=lnt id=hl-39-81><a class=lnlinks href=#hl-39-81> 81</a>
</span><span class=lnt id=hl-39-82><a class=lnlinks href=#hl-39-82> 82</a>
</span><span class=lnt id=hl-39-83><a class=lnlinks href=#hl-39-83> 83</a>
</span><span class=lnt id=hl-39-84><a class=lnlinks href=#hl-39-84> 84</a>
</span><span class=lnt id=hl-39-85><a class=lnlinks href=#hl-39-85> 85</a>
</span><span class=lnt id=hl-39-86><a class=lnlinks href=#hl-39-86> 86</a>
</span><span class=lnt id=hl-39-87><a class=lnlinks href=#hl-39-87> 87</a>
</span><span class=lnt id=hl-39-88><a class=lnlinks href=#hl-39-88> 88</a>
</span><span class=lnt id=hl-39-89><a class=lnlinks href=#hl-39-89> 89</a>
</span><span class=lnt id=hl-39-90><a class=lnlinks href=#hl-39-90> 90</a>
</span><span class=lnt id=hl-39-91><a class=lnlinks href=#hl-39-91> 91</a>
</span><span class=lnt id=hl-39-92><a class=lnlinks href=#hl-39-92> 92</a>
</span><span class=lnt id=hl-39-93><a class=lnlinks href=#hl-39-93> 93</a>
</span><span class=lnt id=hl-39-94><a class=lnlinks href=#hl-39-94> 94</a>
</span><span class=lnt id=hl-39-95><a class=lnlinks href=#hl-39-95> 95</a>
</span><span class=lnt id=hl-39-96><a class=lnlinks href=#hl-39-96> 96</a>
</span><span class=lnt id=hl-39-97><a class=lnlinks href=#hl-39-97> 97</a>
</span><span class=lnt id=hl-39-98><a class=lnlinks href=#hl-39-98> 98</a>
</span><span class=lnt id=hl-39-99><a class=lnlinks href=#hl-39-99> 99</a>
</span><span class=lnt id=hl-39-100><a class=lnlinks href=#hl-39-100>100</a>
</span><span class=lnt id=hl-39-101><a class=lnlinks href=#hl-39-101>101</a>
</span><span class=lnt id=hl-39-102><a class=lnlinks href=#hl-39-102>102</a>
</span><span class=lnt id=hl-39-103><a class=lnlinks href=#hl-39-103>103</a>
</span><span class=lnt id=hl-39-104><a class=lnlinks href=#hl-39-104>104</a>
</span><span class=lnt id=hl-39-105><a class=lnlinks href=#hl-39-105>105</a>
</span><span class=lnt id=hl-39-106><a class=lnlinks href=#hl-39-106>106</a>
</span><span class=lnt id=hl-39-107><a class=lnlinks href=#hl-39-107>107</a>
</span><span class=lnt id=hl-39-108><a class=lnlinks href=#hl-39-108>108</a>
</span><span class=lnt id=hl-39-109><a class=lnlinks href=#hl-39-109>109</a>
</span><span class=lnt id=hl-39-110><a class=lnlinks href=#hl-39-110>110</a>
</span><span class=lnt id=hl-39-111><a class=lnlinks href=#hl-39-111>111</a>
</span><span class=lnt id=hl-39-112><a class=lnlinks href=#hl-39-112>112</a>
</span><span class=lnt id=hl-39-113><a class=lnlinks href=#hl-39-113>113</a>
</span><span class=lnt id=hl-39-114><a class=lnlinks href=#hl-39-114>114</a>
</span><span class=lnt id=hl-39-115><a class=lnlinks href=#hl-39-115>115</a>
</span><span class=lnt id=hl-39-116><a class=lnlinks href=#hl-39-116>116</a>
</span><span class=lnt id=hl-39-117><a class=lnlinks href=#hl-39-117>117</a>
</span><span class=lnt id=hl-39-118><a class=lnlinks href=#hl-39-118>118</a>
</span><span class=lnt id=hl-39-119><a class=lnlinks href=#hl-39-119>119</a>
</span><span class=lnt id=hl-39-120><a class=lnlinks href=#hl-39-120>120</a>
</span><span class=lnt id=hl-39-121><a class=lnlinks href=#hl-39-121>121</a>
</span><span class=lnt id=hl-39-122><a class=lnlinks href=#hl-39-122>122</a>
</span><span class=lnt id=hl-39-123><a class=lnlinks href=#hl-39-123>123</a>
</span><span class=lnt id=hl-39-124><a class=lnlinks href=#hl-39-124>124</a>
</span><span class=lnt id=hl-39-125><a class=lnlinks href=#hl-39-125>125</a>
</span><span class=lnt id=hl-39-126><a class=lnlinks href=#hl-39-126>126</a>
</span><span class=lnt id=hl-39-127><a class=lnlinks href=#hl-39-127>127</a>
</span><span class=lnt id=hl-39-128><a class=lnlinks href=#hl-39-128>128</a>
</span><span class=lnt id=hl-39-129><a class=lnlinks href=#hl-39-129>129</a>
</span><span class=lnt id=hl-39-130><a class=lnlinks href=#hl-39-130>130</a>
</span><span class=lnt id=hl-39-131><a class=lnlinks href=#hl-39-131>131</a>
</span><span class=lnt id=hl-39-132><a class=lnlinks href=#hl-39-132>132</a>
</span><span class=lnt id=hl-39-133><a class=lnlinks href=#hl-39-133>133</a>
</span><span class=lnt id=hl-39-134><a class=lnlinks href=#hl-39-134>134</a>
</span><span class=lnt id=hl-39-135><a class=lnlinks href=#hl-39-135>135</a>
</span><span class=lnt id=hl-39-136><a class=lnlinks href=#hl-39-136>136</a>
</span><span class=lnt id=hl-39-137><a class=lnlinks href=#hl-39-137>137</a>
</span><span class=lnt id=hl-39-138><a class=lnlinks href=#hl-39-138>138</a>
</span><span class=lnt id=hl-39-139><a class=lnlinks href=#hl-39-139>139</a>
</span><span class=lnt id=hl-39-140><a class=lnlinks href=#hl-39-140>140</a>
</span><span class=lnt id=hl-39-141><a class=lnlinks href=#hl-39-141>141</a>
</span><span class=lnt id=hl-39-142><a class=lnlinks href=#hl-39-142>142</a>
</span><span class=lnt id=hl-39-143><a class=lnlinks href=#hl-39-143>143</a>
</span><span class=lnt id=hl-39-144><a class=lnlinks href=#hl-39-144>144</a>
</span><span class=lnt id=hl-39-145><a class=lnlinks href=#hl-39-145>145</a>
</span><span class=lnt id=hl-39-146><a class=lnlinks href=#hl-39-146>146</a>
</span><span class=lnt id=hl-39-147><a class=lnlinks href=#hl-39-147>147</a>
</span><span class=lnt id=hl-39-148><a class=lnlinks href=#hl-39-148>148</a>
</span><span class=lnt id=hl-39-149><a class=lnlinks href=#hl-39-149>149</a>
</span><span class=lnt id=hl-39-150><a class=lnlinks href=#hl-39-150>150</a>
</span><span class=lnt id=hl-39-151><a class=lnlinks href=#hl-39-151>151</a>
</span><span class=lnt id=hl-39-152><a class=lnlinks href=#hl-39-152>152</a>
</span><span class=lnt id=hl-39-153><a class=lnlinks href=#hl-39-153>153</a>
</span><span class=lnt id=hl-39-154><a class=lnlinks href=#hl-39-154>154</a>
</span><span class=lnt id=hl-39-155><a class=lnlinks href=#hl-39-155>155</a>
</span><span class=lnt id=hl-39-156><a class=lnlinks href=#hl-39-156>156</a>
</span><span class=lnt id=hl-39-157><a class=lnlinks href=#hl-39-157>157</a>
</span><span class=lnt id=hl-39-158><a class=lnlinks href=#hl-39-158>158</a>
</span><span class=lnt id=hl-39-159><a class=lnlinks href=#hl-39-159>159</a>
</span><span class=lnt id=hl-39-160><a class=lnlinks href=#hl-39-160>160</a>
</span><span class=lnt id=hl-39-161><a class=lnlinks href=#hl-39-161>161</a>
</span><span class=lnt id=hl-39-162><a class=lnlinks href=#hl-39-162>162</a>
</span><span class=lnt id=hl-39-163><a class=lnlinks href=#hl-39-163>163</a>
</span><span class=lnt id=hl-39-164><a class=lnlinks href=#hl-39-164>164</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># workers/metadata_extraction_worker.py - 메타데이터 추출 워커</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL.ExifTags</span> <span class=kn>import</span> <span class=n>TAGS</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncpg</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shared.event_bus</span> <span class=kn>import</span> <span class=n>EventBus</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>io</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MetadataExtractionWorker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    이미지 메타데이터 추출 워커
</span></span></span><span class=line><span class=cl><span class=s2>    - EXIF 정보 추출 (촬영일시, GPS, 카메라 정보)
</span></span></span><span class=line><span class=cl><span class=s2>    - 이미지 기본 정보 추출 (크기, 포맷, 용량)
</span></span></span><span class=line><span class=cl><span class=s2>    - PostgreSQL에 메타데이터 저장
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_pool</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>init_db_pool</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;PostgreSQL 연결 풀 초기화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_pool</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncpg</span><span class=o>.</span><span class=n>create_pool</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>host</span><span class=o>=</span><span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>database</span><span class=o>=</span><span class=s1>&#39;hemnet_images&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>user</span><span class=o>=</span><span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>password</span><span class=o>=</span><span class=s1>&#39;password&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>min_size</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>max_size</span><span class=o>=</span><span class=mi>20</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이미지 메타데이터 추출 및 저장
</span></span></span><span class=line><span class=cl><span class=s2>        - image.processing.completed 이벤트 수신 시 호출
</span></span></span><span class=line><span class=cl><span class=s2>        - EXIF 데이터에서 유용한 정보 추출
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>image_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>property_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;property_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>original_url</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;original_url&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># S3에서 원본 이미지 다운로드</span>
</span></span><span class=line><span class=cl>            <span class=n>bucket_name</span> <span class=o>=</span> <span class=n>original_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>object_key</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>original_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=mi>3</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>s3_client</span><span class=o>.</span><span class=n>get_object</span><span class=p>(</span><span class=n>Bucket</span><span class=o>=</span><span class=n>bucket_name</span><span class=p>,</span> <span class=n>Key</span><span class=o>=</span><span class=n>object_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>image_data</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Body&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># PIL로 이미지 및 EXIF 정보 추출</span>
</span></span><span class=line><span class=cl>            <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>image_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>exif_data</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>_getexif</span><span class=p>()</span> <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=s1>&#39;_getexif&#39;</span><span class=p>)</span> <span class=k>else</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메타데이터 구성</span>
</span></span><span class=line><span class=cl>            <span class=n>metadata</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;property_id&#39;</span><span class=p>:</span> <span class=n>property_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;file_size&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>image_data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;width&#39;</span><span class=p>:</span> <span class=n>image</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;height&#39;</span><span class=p>:</span> <span class=n>image</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;format&#39;</span><span class=p>:</span> <span class=n>image</span><span class=o>.</span><span class=n>format</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;mode&#39;</span><span class=p>:</span> <span class=n>image</span><span class=o>.</span><span class=n>mode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;created_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># EXIF 정보 추출</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>exif_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>exif_info</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>tag_id</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>exif_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=n>tag</span> <span class=o>=</span> <span class=n>TAGS</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=n>tag_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>exif_info</span><span class=p>[</span><span class=n>tag</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 주요 EXIF 정보 매핑</span>
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;camera_make&#39;</span><span class=p>:</span> <span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Make&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;camera_model&#39;</span><span class=p>:</span> <span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Model&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;datetime_taken&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_exif_datetime</span><span class=p>(</span><span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;DateTime&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;gps_info&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extract_gps_info</span><span class=p>(</span><span class=n>exif_info</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;orientation&#39;</span><span class=p>:</span> <span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Orientation&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;iso_speed&#39;</span><span class=p>:</span> <span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ISOSpeedRatings&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;flash_used&#39;</span><span class=p>:</span> <span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Flash&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># PostgreSQL에 메타데이터 저장</span>
</span></span><span class=line><span class=cl>            <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_save_metadata_to_db</span><span class=p>(</span><span class=n>metadata</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메타데이터 추출 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;image.metadata.extracted&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;property_id&#39;</span><span class=p>:</span> <span class=n>property_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;metadata&#39;</span><span class=p>:</span> <span class=n>metadata</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Metadata extracted for image </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Metadata extraction failed for </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_parse_exif_datetime</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datetime_str</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;EXIF 날짜 문자열을 파이썬 datetime으로 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>datetime_str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>datetime_str</span><span class=p>,</span> <span class=s1>&#39;%Y:%m:</span><span class=si>%d</span><span class=s1> %H:%M:%S&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_extract_gps_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exif_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;GPS 정보 추출 및 위도/경도 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>gps_info</span> <span class=o>=</span> <span class=n>exif_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;GPSInfo&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>gps_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># GPS 좌표 변환 로직 (도, 분, 초를 십진수로)</span>
</span></span><span class=line><span class=cl>            <span class=n>lat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_convert_gps_coordinate</span><span class=p>(</span><span class=n>gps_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;GPSLatitude&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>lon</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_convert_gps_coordinate</span><span class=p>(</span><span class=n>gps_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;GPSLongitude&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>lat</span> <span class=ow>and</span> <span class=n>lon</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;latitude&#39;</span><span class=p>:</span> <span class=n>lat</span><span class=p>,</span> <span class=s1>&#39;longitude&#39;</span><span class=p>:</span> <span class=n>lon</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_save_metadata_to_db</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;PostgreSQL에 메타데이터 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_pool</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span> <span class=k>as</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO image_metadata 
</span></span></span><span class=line><span class=cl><span class=s2>                (image_id, property_id, file_size, width, height, format, mode,
</span></span></span><span class=line><span class=cl><span class=s2>                 camera_make, camera_model, datetime_taken, gps_latitude, gps_longitude,
</span></span></span><span class=line><span class=cl><span class=s2>                 orientation, iso_speed, flash_used, created_at)
</span></span></span><span class=line><span class=cl><span class=s2>                VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16)
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;property_id&#39;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;file_size&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;width&#39;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;height&#39;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;format&#39;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;mode&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;camera_make&#39;</span><span class=p>),</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;camera_model&#39;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;datetime_taken&#39;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;gps_info&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;latitude&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;gps_info&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;longitude&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;orientation&#39;</span><span class=p>),</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;iso_speed&#39;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;flash_used&#39;</span><span class=p>),</span> <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;created_at&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_worker</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;워커 시작 및 이벤트 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>init_db_pool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이미지 처리 완료 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe_to_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_patterns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;image.processing.completed&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>queue_name</span><span class=o>=</span><span class=s1>&#39;metadata.extraction.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>extract_metadata</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Metadata extraction worker started&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>  1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>  2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>  3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>  4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>  5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>  6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7>  7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8>  8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9>  9</a>
</span><span class=lnt id=hl-40-10><a class=lnlinks href=#hl-40-10> 10</a>
</span><span class=lnt id=hl-40-11><a class=lnlinks href=#hl-40-11> 11</a>
</span><span class=lnt id=hl-40-12><a class=lnlinks href=#hl-40-12> 12</a>
</span><span class=lnt id=hl-40-13><a class=lnlinks href=#hl-40-13> 13</a>
</span><span class=lnt id=hl-40-14><a class=lnlinks href=#hl-40-14> 14</a>
</span><span class=lnt id=hl-40-15><a class=lnlinks href=#hl-40-15> 15</a>
</span><span class=lnt id=hl-40-16><a class=lnlinks href=#hl-40-16> 16</a>
</span><span class=lnt id=hl-40-17><a class=lnlinks href=#hl-40-17> 17</a>
</span><span class=lnt id=hl-40-18><a class=lnlinks href=#hl-40-18> 18</a>
</span><span class=lnt id=hl-40-19><a class=lnlinks href=#hl-40-19> 19</a>
</span><span class=lnt id=hl-40-20><a class=lnlinks href=#hl-40-20> 20</a>
</span><span class=lnt id=hl-40-21><a class=lnlinks href=#hl-40-21> 21</a>
</span><span class=lnt id=hl-40-22><a class=lnlinks href=#hl-40-22> 22</a>
</span><span class=lnt id=hl-40-23><a class=lnlinks href=#hl-40-23> 23</a>
</span><span class=lnt id=hl-40-24><a class=lnlinks href=#hl-40-24> 24</a>
</span><span class=lnt id=hl-40-25><a class=lnlinks href=#hl-40-25> 25</a>
</span><span class=lnt id=hl-40-26><a class=lnlinks href=#hl-40-26> 26</a>
</span><span class=lnt id=hl-40-27><a class=lnlinks href=#hl-40-27> 27</a>
</span><span class=lnt id=hl-40-28><a class=lnlinks href=#hl-40-28> 28</a>
</span><span class=lnt id=hl-40-29><a class=lnlinks href=#hl-40-29> 29</a>
</span><span class=lnt id=hl-40-30><a class=lnlinks href=#hl-40-30> 30</a>
</span><span class=lnt id=hl-40-31><a class=lnlinks href=#hl-40-31> 31</a>
</span><span class=lnt id=hl-40-32><a class=lnlinks href=#hl-40-32> 32</a>
</span><span class=lnt id=hl-40-33><a class=lnlinks href=#hl-40-33> 33</a>
</span><span class=lnt id=hl-40-34><a class=lnlinks href=#hl-40-34> 34</a>
</span><span class=lnt id=hl-40-35><a class=lnlinks href=#hl-40-35> 35</a>
</span><span class=lnt id=hl-40-36><a class=lnlinks href=#hl-40-36> 36</a>
</span><span class=lnt id=hl-40-37><a class=lnlinks href=#hl-40-37> 37</a>
</span><span class=lnt id=hl-40-38><a class=lnlinks href=#hl-40-38> 38</a>
</span><span class=lnt id=hl-40-39><a class=lnlinks href=#hl-40-39> 39</a>
</span><span class=lnt id=hl-40-40><a class=lnlinks href=#hl-40-40> 40</a>
</span><span class=lnt id=hl-40-41><a class=lnlinks href=#hl-40-41> 41</a>
</span><span class=lnt id=hl-40-42><a class=lnlinks href=#hl-40-42> 42</a>
</span><span class=lnt id=hl-40-43><a class=lnlinks href=#hl-40-43> 43</a>
</span><span class=lnt id=hl-40-44><a class=lnlinks href=#hl-40-44> 44</a>
</span><span class=lnt id=hl-40-45><a class=lnlinks href=#hl-40-45> 45</a>
</span><span class=lnt id=hl-40-46><a class=lnlinks href=#hl-40-46> 46</a>
</span><span class=lnt id=hl-40-47><a class=lnlinks href=#hl-40-47> 47</a>
</span><span class=lnt id=hl-40-48><a class=lnlinks href=#hl-40-48> 48</a>
</span><span class=lnt id=hl-40-49><a class=lnlinks href=#hl-40-49> 49</a>
</span><span class=lnt id=hl-40-50><a class=lnlinks href=#hl-40-50> 50</a>
</span><span class=lnt id=hl-40-51><a class=lnlinks href=#hl-40-51> 51</a>
</span><span class=lnt id=hl-40-52><a class=lnlinks href=#hl-40-52> 52</a>
</span><span class=lnt id=hl-40-53><a class=lnlinks href=#hl-40-53> 53</a>
</span><span class=lnt id=hl-40-54><a class=lnlinks href=#hl-40-54> 54</a>
</span><span class=lnt id=hl-40-55><a class=lnlinks href=#hl-40-55> 55</a>
</span><span class=lnt id=hl-40-56><a class=lnlinks href=#hl-40-56> 56</a>
</span><span class=lnt id=hl-40-57><a class=lnlinks href=#hl-40-57> 57</a>
</span><span class=lnt id=hl-40-58><a class=lnlinks href=#hl-40-58> 58</a>
</span><span class=lnt id=hl-40-59><a class=lnlinks href=#hl-40-59> 59</a>
</span><span class=lnt id=hl-40-60><a class=lnlinks href=#hl-40-60> 60</a>
</span><span class=lnt id=hl-40-61><a class=lnlinks href=#hl-40-61> 61</a>
</span><span class=lnt id=hl-40-62><a class=lnlinks href=#hl-40-62> 62</a>
</span><span class=lnt id=hl-40-63><a class=lnlinks href=#hl-40-63> 63</a>
</span><span class=lnt id=hl-40-64><a class=lnlinks href=#hl-40-64> 64</a>
</span><span class=lnt id=hl-40-65><a class=lnlinks href=#hl-40-65> 65</a>
</span><span class=lnt id=hl-40-66><a class=lnlinks href=#hl-40-66> 66</a>
</span><span class=lnt id=hl-40-67><a class=lnlinks href=#hl-40-67> 67</a>
</span><span class=lnt id=hl-40-68><a class=lnlinks href=#hl-40-68> 68</a>
</span><span class=lnt id=hl-40-69><a class=lnlinks href=#hl-40-69> 69</a>
</span><span class=lnt id=hl-40-70><a class=lnlinks href=#hl-40-70> 70</a>
</span><span class=lnt id=hl-40-71><a class=lnlinks href=#hl-40-71> 71</a>
</span><span class=lnt id=hl-40-72><a class=lnlinks href=#hl-40-72> 72</a>
</span><span class=lnt id=hl-40-73><a class=lnlinks href=#hl-40-73> 73</a>
</span><span class=lnt id=hl-40-74><a class=lnlinks href=#hl-40-74> 74</a>
</span><span class=lnt id=hl-40-75><a class=lnlinks href=#hl-40-75> 75</a>
</span><span class=lnt id=hl-40-76><a class=lnlinks href=#hl-40-76> 76</a>
</span><span class=lnt id=hl-40-77><a class=lnlinks href=#hl-40-77> 77</a>
</span><span class=lnt id=hl-40-78><a class=lnlinks href=#hl-40-78> 78</a>
</span><span class=lnt id=hl-40-79><a class=lnlinks href=#hl-40-79> 79</a>
</span><span class=lnt id=hl-40-80><a class=lnlinks href=#hl-40-80> 80</a>
</span><span class=lnt id=hl-40-81><a class=lnlinks href=#hl-40-81> 81</a>
</span><span class=lnt id=hl-40-82><a class=lnlinks href=#hl-40-82> 82</a>
</span><span class=lnt id=hl-40-83><a class=lnlinks href=#hl-40-83> 83</a>
</span><span class=lnt id=hl-40-84><a class=lnlinks href=#hl-40-84> 84</a>
</span><span class=lnt id=hl-40-85><a class=lnlinks href=#hl-40-85> 85</a>
</span><span class=lnt id=hl-40-86><a class=lnlinks href=#hl-40-86> 86</a>
</span><span class=lnt id=hl-40-87><a class=lnlinks href=#hl-40-87> 87</a>
</span><span class=lnt id=hl-40-88><a class=lnlinks href=#hl-40-88> 88</a>
</span><span class=lnt id=hl-40-89><a class=lnlinks href=#hl-40-89> 89</a>
</span><span class=lnt id=hl-40-90><a class=lnlinks href=#hl-40-90> 90</a>
</span><span class=lnt id=hl-40-91><a class=lnlinks href=#hl-40-91> 91</a>
</span><span class=lnt id=hl-40-92><a class=lnlinks href=#hl-40-92> 92</a>
</span><span class=lnt id=hl-40-93><a class=lnlinks href=#hl-40-93> 93</a>
</span><span class=lnt id=hl-40-94><a class=lnlinks href=#hl-40-94> 94</a>
</span><span class=lnt id=hl-40-95><a class=lnlinks href=#hl-40-95> 95</a>
</span><span class=lnt id=hl-40-96><a class=lnlinks href=#hl-40-96> 96</a>
</span><span class=lnt id=hl-40-97><a class=lnlinks href=#hl-40-97> 97</a>
</span><span class=lnt id=hl-40-98><a class=lnlinks href=#hl-40-98> 98</a>
</span><span class=lnt id=hl-40-99><a class=lnlinks href=#hl-40-99> 99</a>
</span><span class=lnt id=hl-40-100><a class=lnlinks href=#hl-40-100>100</a>
</span><span class=lnt id=hl-40-101><a class=lnlinks href=#hl-40-101>101</a>
</span><span class=lnt id=hl-40-102><a class=lnlinks href=#hl-40-102>102</a>
</span><span class=lnt id=hl-40-103><a class=lnlinks href=#hl-40-103>103</a>
</span><span class=lnt id=hl-40-104><a class=lnlinks href=#hl-40-104>104</a>
</span><span class=lnt id=hl-40-105><a class=lnlinks href=#hl-40-105>105</a>
</span><span class=lnt id=hl-40-106><a class=lnlinks href=#hl-40-106>106</a>
</span><span class=lnt id=hl-40-107><a class=lnlinks href=#hl-40-107>107</a>
</span><span class=lnt id=hl-40-108><a class=lnlinks href=#hl-40-108>108</a>
</span><span class=lnt id=hl-40-109><a class=lnlinks href=#hl-40-109>109</a>
</span><span class=lnt id=hl-40-110><a class=lnlinks href=#hl-40-110>110</a>
</span><span class=lnt id=hl-40-111><a class=lnlinks href=#hl-40-111>111</a>
</span><span class=lnt id=hl-40-112><a class=lnlinks href=#hl-40-112>112</a>
</span><span class=lnt id=hl-40-113><a class=lnlinks href=#hl-40-113>113</a>
</span><span class=lnt id=hl-40-114><a class=lnlinks href=#hl-40-114>114</a>
</span><span class=lnt id=hl-40-115><a class=lnlinks href=#hl-40-115>115</a>
</span><span class=lnt id=hl-40-116><a class=lnlinks href=#hl-40-116>116</a>
</span><span class=lnt id=hl-40-117><a class=lnlinks href=#hl-40-117>117</a>
</span><span class=lnt id=hl-40-118><a class=lnlinks href=#hl-40-118>118</a>
</span><span class=lnt id=hl-40-119><a class=lnlinks href=#hl-40-119>119</a>
</span><span class=lnt id=hl-40-120><a class=lnlinks href=#hl-40-120>120</a>
</span><span class=lnt id=hl-40-121><a class=lnlinks href=#hl-40-121>121</a>
</span><span class=lnt id=hl-40-122><a class=lnlinks href=#hl-40-122>122</a>
</span><span class=lnt id=hl-40-123><a class=lnlinks href=#hl-40-123>123</a>
</span><span class=lnt id=hl-40-124><a class=lnlinks href=#hl-40-124>124</a>
</span><span class=lnt id=hl-40-125><a class=lnlinks href=#hl-40-125>125</a>
</span><span class=lnt id=hl-40-126><a class=lnlinks href=#hl-40-126>126</a>
</span><span class=lnt id=hl-40-127><a class=lnlinks href=#hl-40-127>127</a>
</span><span class=lnt id=hl-40-128><a class=lnlinks href=#hl-40-128>128</a>
</span><span class=lnt id=hl-40-129><a class=lnlinks href=#hl-40-129>129</a>
</span><span class=lnt id=hl-40-130><a class=lnlinks href=#hl-40-130>130</a>
</span><span class=lnt id=hl-40-131><a class=lnlinks href=#hl-40-131>131</a>
</span><span class=lnt id=hl-40-132><a class=lnlinks href=#hl-40-132>132</a>
</span><span class=lnt id=hl-40-133><a class=lnlinks href=#hl-40-133>133</a>
</span><span class=lnt id=hl-40-134><a class=lnlinks href=#hl-40-134>134</a>
</span><span class=lnt id=hl-40-135><a class=lnlinks href=#hl-40-135>135</a>
</span><span class=lnt id=hl-40-136><a class=lnlinks href=#hl-40-136>136</a>
</span><span class=lnt id=hl-40-137><a class=lnlinks href=#hl-40-137>137</a>
</span><span class=lnt id=hl-40-138><a class=lnlinks href=#hl-40-138>138</a>
</span><span class=lnt id=hl-40-139><a class=lnlinks href=#hl-40-139>139</a>
</span><span class=lnt id=hl-40-140><a class=lnlinks href=#hl-40-140>140</a>
</span><span class=lnt id=hl-40-141><a class=lnlinks href=#hl-40-141>141</a>
</span><span class=lnt id=hl-40-142><a class=lnlinks href=#hl-40-142>142</a>
</span><span class=lnt id=hl-40-143><a class=lnlinks href=#hl-40-143>143</a>
</span><span class=lnt id=hl-40-144><a class=lnlinks href=#hl-40-144>144</a>
</span><span class=lnt id=hl-40-145><a class=lnlinks href=#hl-40-145>145</a>
</span><span class=lnt id=hl-40-146><a class=lnlinks href=#hl-40-146>146</a>
</span><span class=lnt id=hl-40-147><a class=lnlinks href=#hl-40-147>147</a>
</span><span class=lnt id=hl-40-148><a class=lnlinks href=#hl-40-148>148</a>
</span><span class=lnt id=hl-40-149><a class=lnlinks href=#hl-40-149>149</a>
</span><span class=lnt id=hl-40-150><a class=lnlinks href=#hl-40-150>150</a>
</span><span class=lnt id=hl-40-151><a class=lnlinks href=#hl-40-151>151</a>
</span><span class=lnt id=hl-40-152><a class=lnlinks href=#hl-40-152>152</a>
</span><span class=lnt id=hl-40-153><a class=lnlinks href=#hl-40-153>153</a>
</span><span class=lnt id=hl-40-154><a class=lnlinks href=#hl-40-154>154</a>
</span><span class=lnt id=hl-40-155><a class=lnlinks href=#hl-40-155>155</a>
</span><span class=lnt id=hl-40-156><a class=lnlinks href=#hl-40-156>156</a>
</span><span class=lnt id=hl-40-157><a class=lnlinks href=#hl-40-157>157</a>
</span><span class=lnt id=hl-40-158><a class=lnlinks href=#hl-40-158>158</a>
</span><span class=lnt id=hl-40-159><a class=lnlinks href=#hl-40-159>159</a>
</span><span class=lnt id=hl-40-160><a class=lnlinks href=#hl-40-160>160</a>
</span><span class=lnt id=hl-40-161><a class=lnlinks href=#hl-40-161>161</a>
</span><span class=lnt id=hl-40-162><a class=lnlinks href=#hl-40-162>162</a>
</span><span class=lnt id=hl-40-163><a class=lnlinks href=#hl-40-163>163</a>
</span><span class=lnt id=hl-40-164><a class=lnlinks href=#hl-40-164>164</a>
</span><span class=lnt id=hl-40-165><a class=lnlinks href=#hl-40-165>165</a>
</span><span class=lnt id=hl-40-166><a class=lnlinks href=#hl-40-166>166</a>
</span><span class=lnt id=hl-40-167><a class=lnlinks href=#hl-40-167>167</a>
</span><span class=lnt id=hl-40-168><a class=lnlinks href=#hl-40-168>168</a>
</span><span class=lnt id=hl-40-169><a class=lnlinks href=#hl-40-169>169</a>
</span><span class=lnt id=hl-40-170><a class=lnlinks href=#hl-40-170>170</a>
</span><span class=lnt id=hl-40-171><a class=lnlinks href=#hl-40-171>171</a>
</span><span class=lnt id=hl-40-172><a class=lnlinks href=#hl-40-172>172</a>
</span><span class=lnt id=hl-40-173><a class=lnlinks href=#hl-40-173>173</a>
</span><span class=lnt id=hl-40-174><a class=lnlinks href=#hl-40-174>174</a>
</span><span class=lnt id=hl-40-175><a class=lnlinks href=#hl-40-175>175</a>
</span><span class=lnt id=hl-40-176><a class=lnlinks href=#hl-40-176>176</a>
</span><span class=lnt id=hl-40-177><a class=lnlinks href=#hl-40-177>177</a>
</span><span class=lnt id=hl-40-178><a class=lnlinks href=#hl-40-178>178</a>
</span><span class=lnt id=hl-40-179><a class=lnlinks href=#hl-40-179>179</a>
</span><span class=lnt id=hl-40-180><a class=lnlinks href=#hl-40-180>180</a>
</span><span class=lnt id=hl-40-181><a class=lnlinks href=#hl-40-181>181</a>
</span><span class=lnt id=hl-40-182><a class=lnlinks href=#hl-40-182>182</a>
</span><span class=lnt id=hl-40-183><a class=lnlinks href=#hl-40-183>183</a>
</span><span class=lnt id=hl-40-184><a class=lnlinks href=#hl-40-184>184</a>
</span><span class=lnt id=hl-40-185><a class=lnlinks href=#hl-40-185>185</a>
</span><span class=lnt id=hl-40-186><a class=lnlinks href=#hl-40-186>186</a>
</span><span class=lnt id=hl-40-187><a class=lnlinks href=#hl-40-187>187</a>
</span><span class=lnt id=hl-40-188><a class=lnlinks href=#hl-40-188>188</a>
</span><span class=lnt id=hl-40-189><a class=lnlinks href=#hl-40-189>189</a>
</span><span class=lnt id=hl-40-190><a class=lnlinks href=#hl-40-190>190</a>
</span><span class=lnt id=hl-40-191><a class=lnlinks href=#hl-40-191>191</a>
</span><span class=lnt id=hl-40-192><a class=lnlinks href=#hl-40-192>192</a>
</span><span class=lnt id=hl-40-193><a class=lnlinks href=#hl-40-193>193</a>
</span><span class=lnt id=hl-40-194><a class=lnlinks href=#hl-40-194>194</a>
</span><span class=lnt id=hl-40-195><a class=lnlinks href=#hl-40-195>195</a>
</span><span class=lnt id=hl-40-196><a class=lnlinks href=#hl-40-196>196</a>
</span><span class=lnt id=hl-40-197><a class=lnlinks href=#hl-40-197>197</a>
</span><span class=lnt id=hl-40-198><a class=lnlinks href=#hl-40-198>198</a>
</span><span class=lnt id=hl-40-199><a class=lnlinks href=#hl-40-199>199</a>
</span><span class=lnt id=hl-40-200><a class=lnlinks href=#hl-40-200>200</a>
</span><span class=lnt id=hl-40-201><a class=lnlinks href=#hl-40-201>201</a>
</span><span class=lnt id=hl-40-202><a class=lnlinks href=#hl-40-202>202</a>
</span><span class=lnt id=hl-40-203><a class=lnlinks href=#hl-40-203>203</a>
</span><span class=lnt id=hl-40-204><a class=lnlinks href=#hl-40-204>204</a>
</span><span class=lnt id=hl-40-205><a class=lnlinks href=#hl-40-205>205</a>
</span><span class=lnt id=hl-40-206><a class=lnlinks href=#hl-40-206>206</a>
</span><span class=lnt id=hl-40-207><a class=lnlinks href=#hl-40-207>207</a>
</span><span class=lnt id=hl-40-208><a class=lnlinks href=#hl-40-208>208</a>
</span><span class=lnt id=hl-40-209><a class=lnlinks href=#hl-40-209>209</a>
</span><span class=lnt id=hl-40-210><a class=lnlinks href=#hl-40-210>210</a>
</span><span class=lnt id=hl-40-211><a class=lnlinks href=#hl-40-211>211</a>
</span><span class=lnt id=hl-40-212><a class=lnlinks href=#hl-40-212>212</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># workers/notification_worker.py - 알림 워커</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>smtplib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>email.mime.text</span> <span class=kn>import</span> <span class=n>MIMEText</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>email.mime.multipart</span> <span class=kn>import</span> <span class=n>MIMEMultipart</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shared.event_bus</span> <span class=kn>import</span> <span class=n>EventBus</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NotificationWorker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    알림 발송 워커
</span></span></span><span class=line><span class=cl><span class=s2>    - 이미지 처리 완료 시 중개업체에 이메일/SMS 알림
</span></span></span><span class=line><span class=cl><span class=s2>    - 처리 상태를 최종 완료로 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>    - 실패한 작업에 대한 재처리 알림
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>EventBus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;redis&#39;</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># SMTP 설정 (실제로는 환경변수에서 로드)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>smtp_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;smtp.gmail.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=mi>587</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;noreply@hemnet.se&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;app_password&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_processing_completion</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        이미지 처리 완료 알림 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - image.metadata.extracted 이벤트 수신 시 호출
</span></span></span><span class=line><span class=cl><span class=s2>        - 모든 처리 단계 완료 후 최종 알림 발송
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>image_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>property_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;property_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Redis에서 처리 상태 정보 조회</span>
</span></span><span class=line><span class=cl>            <span class=n>status_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;processing:</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>status_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>status_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>status_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No status data found for image </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>status_info</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>status_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 처리 완료 상태로 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>status_info</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;completed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;progress&#39;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;completed_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>status_key</span><span class=p>,</span> <span class=mi>86400</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>status_info</span><span class=p>))</span>  <span class=c1># 24시간 보관</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 중개업체 정보 조회 (실제로는 데이터베이스에서)</span>
</span></span><span class=line><span class=cl>            <span class=n>broker_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_broker_info</span><span class=p>(</span><span class=n>property_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>broker_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 이메일 알림 발송</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_send_completion_email</span><span class=p>(</span><span class=n>broker_info</span><span class=p>,</span> <span class=n>image_id</span><span class=p>,</span> <span class=n>status_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 웹훅 알림 (중개업체 시스템 연동)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_send_webhook_notification</span><span class=p>(</span><span class=n>broker_info</span><span class=p>,</span> <span class=n>image_id</span><span class=p>,</span> <span class=n>status_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Completion notification sent for image </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to send completion notification: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_processing_failure</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        처리 실패 알림 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - image.processing.failed 이벤트 수신 시 호출
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>image_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>error_message</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>retry_count</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;retry_count&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 재시도 한계 초과 시 최종 실패 알림</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>retry_count</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>broker_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_broker_info_by_image</span><span class=p>(</span><span class=n>image_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>broker_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_send_failure_email</span><span class=p>(</span><span class=n>broker_info</span><span class=p>,</span> <span class=n>image_id</span><span class=p>,</span> <span class=n>error_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 처리 상태를 최종 실패로 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=n>status_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;processing:</span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>status_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>status_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>status_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>status_info</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>status_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>status_info</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;progress&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=n>error_message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;final_failure_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>})</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span><span class=n>status_key</span><span class=p>,</span> <span class=mi>86400</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>status_info</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Final failure notification sent for image </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to send failure notification: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_send_completion_email</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>broker_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>image_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>status_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;완료 알림 이메일 발송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=n>MIMEMultipart</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;From&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>smtp_config</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;To&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>broker_info</span><span class=p>[</span><span class=s1>&#39;email&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;Subject&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Hemnet - 이미지 처리 완료&#39;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># HTML 이메일 본문 구성</span>
</span></span><span class=line><span class=cl>            <span class=n>html_body</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;h2&gt;이미지 처리가 완료되었습니다&lt;/h2&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;p&gt;&lt;strong&gt;처리 ID:&lt;/strong&gt; </span><span class=si>{</span><span class=n>image_id</span><span class=si>}</span><span class=s2>&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;p&gt;&lt;strong&gt;매물 ID:&lt;/strong&gt; </span><span class=si>{</span><span class=n>status_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;property_id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;p&gt;&lt;strong&gt;처리 시간:&lt;/strong&gt; </span><span class=si>{</span><span class=n>status_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;completed_at&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;h3&gt;생성된 이미지 크기&lt;/h3&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;ul&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;li&gt;썸네일 (150x150)&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;li&gt;소형 (300x200)&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;li&gt;중형 (600x400)&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;li&gt;대형 (1200x800)&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                    &lt;li&gt;초대형 (1920x1280)&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;/ul&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;p&gt;모든 이미지가 성공적으로 생성되어 웹사이트에서 사용할 수 있습니다.&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;p&gt;감사합니다.&lt;br&gt;Hemnet 팀&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;/html&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>msg</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>MIMEText</span><span class=p>(</span><span class=n>html_body</span><span class=p>,</span> <span class=s1>&#39;html&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># SMTP 서버를 통해 이메일 발송</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>smtplib</span><span class=o>.</span><span class=n>SMTP</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>smtp_config</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>smtp_config</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>])</span> <span class=k>as</span> <span class=n>server</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>server</span><span class=o>.</span><span class=n>starttls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>server</span><span class=o>.</span><span class=n>login</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>smtp_config</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>smtp_config</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>server</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to send completion email: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_send_webhook_notification</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>broker_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>image_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>status_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;웹훅을 통한 시스템 간 연동 알림&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>webhook_url</span> <span class=o>=</span> <span class=n>broker_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;webhook_url&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>webhook_url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>webhook_payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=s1>&#39;image_processing_completed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image_id&#39;</span><span class=p>:</span> <span class=n>image_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;property_id&#39;</span><span class=p>:</span> <span class=n>status_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;property_id&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;processed_urls&#39;</span><span class=p>:</span> <span class=n>status_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;processed_urls&#39;</span><span class=p>,</span> <span class=p>{}),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>status_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;completed_at&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>webhook_url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>=</span><span class=n>webhook_payload</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Webhook notification sent successfully to </span><span class=si>{</span><span class=n>webhook_url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Webhook notification failed: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Webhook notification error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_worker</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;워커 시작 및 이벤트 구독&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 다양한 알림 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>subscribe_to_events</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_patterns</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image.metadata.extracted&#39;</span><span class=p>,</span>  <span class=c1># 처리 완료</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;image.processing.failed&#39;</span>    <span class=c1># 처리 실패</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>queue_name</span><span class=o>=</span><span class=s1>&#39;notification.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_handle_notification_events</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Notification worker started&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_handle_notification_events</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;이벤트 타입에 따른 알림 처리 분기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_type&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;image.metadata.extracted&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>handle_processing_completion</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;image.processing.failed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>handle_processing_failure</span><span class=p>(</span><span class=n>event_data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>  1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2>  2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3>  3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4>  4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5>  5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6>  6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7>  7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8>  8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9>  9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10> 10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11> 11</a>
</span><span class=lnt id=hl-41-12><a class=lnlinks href=#hl-41-12> 12</a>
</span><span class=lnt id=hl-41-13><a class=lnlinks href=#hl-41-13> 13</a>
</span><span class=lnt id=hl-41-14><a class=lnlinks href=#hl-41-14> 14</a>
</span><span class=lnt id=hl-41-15><a class=lnlinks href=#hl-41-15> 15</a>
</span><span class=lnt id=hl-41-16><a class=lnlinks href=#hl-41-16> 16</a>
</span><span class=lnt id=hl-41-17><a class=lnlinks href=#hl-41-17> 17</a>
</span><span class=lnt id=hl-41-18><a class=lnlinks href=#hl-41-18> 18</a>
</span><span class=lnt id=hl-41-19><a class=lnlinks href=#hl-41-19> 19</a>
</span><span class=lnt id=hl-41-20><a class=lnlinks href=#hl-41-20> 20</a>
</span><span class=lnt id=hl-41-21><a class=lnlinks href=#hl-41-21> 21</a>
</span><span class=lnt id=hl-41-22><a class=lnlinks href=#hl-41-22> 22</a>
</span><span class=lnt id=hl-41-23><a class=lnlinks href=#hl-41-23> 23</a>
</span><span class=lnt id=hl-41-24><a class=lnlinks href=#hl-41-24> 24</a>
</span><span class=lnt id=hl-41-25><a class=lnlinks href=#hl-41-25> 25</a>
</span><span class=lnt id=hl-41-26><a class=lnlinks href=#hl-41-26> 26</a>
</span><span class=lnt id=hl-41-27><a class=lnlinks href=#hl-41-27> 27</a>
</span><span class=lnt id=hl-41-28><a class=lnlinks href=#hl-41-28> 28</a>
</span><span class=lnt id=hl-41-29><a class=lnlinks href=#hl-41-29> 29</a>
</span><span class=lnt id=hl-41-30><a class=lnlinks href=#hl-41-30> 30</a>
</span><span class=lnt id=hl-41-31><a class=lnlinks href=#hl-41-31> 31</a>
</span><span class=lnt id=hl-41-32><a class=lnlinks href=#hl-41-32> 32</a>
</span><span class=lnt id=hl-41-33><a class=lnlinks href=#hl-41-33> 33</a>
</span><span class=lnt id=hl-41-34><a class=lnlinks href=#hl-41-34> 34</a>
</span><span class=lnt id=hl-41-35><a class=lnlinks href=#hl-41-35> 35</a>
</span><span class=lnt id=hl-41-36><a class=lnlinks href=#hl-41-36> 36</a>
</span><span class=lnt id=hl-41-37><a class=lnlinks href=#hl-41-37> 37</a>
</span><span class=lnt id=hl-41-38><a class=lnlinks href=#hl-41-38> 38</a>
</span><span class=lnt id=hl-41-39><a class=lnlinks href=#hl-41-39> 39</a>
</span><span class=lnt id=hl-41-40><a class=lnlinks href=#hl-41-40> 40</a>
</span><span class=lnt id=hl-41-41><a class=lnlinks href=#hl-41-41> 41</a>
</span><span class=lnt id=hl-41-42><a class=lnlinks href=#hl-41-42> 42</a>
</span><span class=lnt id=hl-41-43><a class=lnlinks href=#hl-41-43> 43</a>
</span><span class=lnt id=hl-41-44><a class=lnlinks href=#hl-41-44> 44</a>
</span><span class=lnt id=hl-41-45><a class=lnlinks href=#hl-41-45> 45</a>
</span><span class=lnt id=hl-41-46><a class=lnlinks href=#hl-41-46> 46</a>
</span><span class=lnt id=hl-41-47><a class=lnlinks href=#hl-41-47> 47</a>
</span><span class=lnt id=hl-41-48><a class=lnlinks href=#hl-41-48> 48</a>
</span><span class=lnt id=hl-41-49><a class=lnlinks href=#hl-41-49> 49</a>
</span><span class=lnt id=hl-41-50><a class=lnlinks href=#hl-41-50> 50</a>
</span><span class=lnt id=hl-41-51><a class=lnlinks href=#hl-41-51> 51</a>
</span><span class=lnt id=hl-41-52><a class=lnlinks href=#hl-41-52> 52</a>
</span><span class=lnt id=hl-41-53><a class=lnlinks href=#hl-41-53> 53</a>
</span><span class=lnt id=hl-41-54><a class=lnlinks href=#hl-41-54> 54</a>
</span><span class=lnt id=hl-41-55><a class=lnlinks href=#hl-41-55> 55</a>
</span><span class=lnt id=hl-41-56><a class=lnlinks href=#hl-41-56> 56</a>
</span><span class=lnt id=hl-41-57><a class=lnlinks href=#hl-41-57> 57</a>
</span><span class=lnt id=hl-41-58><a class=lnlinks href=#hl-41-58> 58</a>
</span><span class=lnt id=hl-41-59><a class=lnlinks href=#hl-41-59> 59</a>
</span><span class=lnt id=hl-41-60><a class=lnlinks href=#hl-41-60> 60</a>
</span><span class=lnt id=hl-41-61><a class=lnlinks href=#hl-41-61> 61</a>
</span><span class=lnt id=hl-41-62><a class=lnlinks href=#hl-41-62> 62</a>
</span><span class=lnt id=hl-41-63><a class=lnlinks href=#hl-41-63> 63</a>
</span><span class=lnt id=hl-41-64><a class=lnlinks href=#hl-41-64> 64</a>
</span><span class=lnt id=hl-41-65><a class=lnlinks href=#hl-41-65> 65</a>
</span><span class=lnt id=hl-41-66><a class=lnlinks href=#hl-41-66> 66</a>
</span><span class=lnt id=hl-41-67><a class=lnlinks href=#hl-41-67> 67</a>
</span><span class=lnt id=hl-41-68><a class=lnlinks href=#hl-41-68> 68</a>
</span><span class=lnt id=hl-41-69><a class=lnlinks href=#hl-41-69> 69</a>
</span><span class=lnt id=hl-41-70><a class=lnlinks href=#hl-41-70> 70</a>
</span><span class=lnt id=hl-41-71><a class=lnlinks href=#hl-41-71> 71</a>
</span><span class=lnt id=hl-41-72><a class=lnlinks href=#hl-41-72> 72</a>
</span><span class=lnt id=hl-41-73><a class=lnlinks href=#hl-41-73> 73</a>
</span><span class=lnt id=hl-41-74><a class=lnlinks href=#hl-41-74> 74</a>
</span><span class=lnt id=hl-41-75><a class=lnlinks href=#hl-41-75> 75</a>
</span><span class=lnt id=hl-41-76><a class=lnlinks href=#hl-41-76> 76</a>
</span><span class=lnt id=hl-41-77><a class=lnlinks href=#hl-41-77> 77</a>
</span><span class=lnt id=hl-41-78><a class=lnlinks href=#hl-41-78> 78</a>
</span><span class=lnt id=hl-41-79><a class=lnlinks href=#hl-41-79> 79</a>
</span><span class=lnt id=hl-41-80><a class=lnlinks href=#hl-41-80> 80</a>
</span><span class=lnt id=hl-41-81><a class=lnlinks href=#hl-41-81> 81</a>
</span><span class=lnt id=hl-41-82><a class=lnlinks href=#hl-41-82> 82</a>
</span><span class=lnt id=hl-41-83><a class=lnlinks href=#hl-41-83> 83</a>
</span><span class=lnt id=hl-41-84><a class=lnlinks href=#hl-41-84> 84</a>
</span><span class=lnt id=hl-41-85><a class=lnlinks href=#hl-41-85> 85</a>
</span><span class=lnt id=hl-41-86><a class=lnlinks href=#hl-41-86> 86</a>
</span><span class=lnt id=hl-41-87><a class=lnlinks href=#hl-41-87> 87</a>
</span><span class=lnt id=hl-41-88><a class=lnlinks href=#hl-41-88> 88</a>
</span><span class=lnt id=hl-41-89><a class=lnlinks href=#hl-41-89> 89</a>
</span><span class=lnt id=hl-41-90><a class=lnlinks href=#hl-41-90> 90</a>
</span><span class=lnt id=hl-41-91><a class=lnlinks href=#hl-41-91> 91</a>
</span><span class=lnt id=hl-41-92><a class=lnlinks href=#hl-41-92> 92</a>
</span><span class=lnt id=hl-41-93><a class=lnlinks href=#hl-41-93> 93</a>
</span><span class=lnt id=hl-41-94><a class=lnlinks href=#hl-41-94> 94</a>
</span><span class=lnt id=hl-41-95><a class=lnlinks href=#hl-41-95> 95</a>
</span><span class=lnt id=hl-41-96><a class=lnlinks href=#hl-41-96> 96</a>
</span><span class=lnt id=hl-41-97><a class=lnlinks href=#hl-41-97> 97</a>
</span><span class=lnt id=hl-41-98><a class=lnlinks href=#hl-41-98> 98</a>
</span><span class=lnt id=hl-41-99><a class=lnlinks href=#hl-41-99> 99</a>
</span><span class=lnt id=hl-41-100><a class=lnlinks href=#hl-41-100>100</a>
</span><span class=lnt id=hl-41-101><a class=lnlinks href=#hl-41-101>101</a>
</span><span class=lnt id=hl-41-102><a class=lnlinks href=#hl-41-102>102</a>
</span><span class=lnt id=hl-41-103><a class=lnlinks href=#hl-41-103>103</a>
</span><span class=lnt id=hl-41-104><a class=lnlinks href=#hl-41-104>104</a>
</span><span class=lnt id=hl-41-105><a class=lnlinks href=#hl-41-105>105</a>
</span><span class=lnt id=hl-41-106><a class=lnlinks href=#hl-41-106>106</a>
</span><span class=lnt id=hl-41-107><a class=lnlinks href=#hl-41-107>107</a>
</span><span class=lnt id=hl-41-108><a class=lnlinks href=#hl-41-108>108</a>
</span><span class=lnt id=hl-41-109><a class=lnlinks href=#hl-41-109>109</a>
</span><span class=lnt id=hl-41-110><a class=lnlinks href=#hl-41-110>110</a>
</span><span class=lnt id=hl-41-111><a class=lnlinks href=#hl-41-111>111</a>
</span><span class=lnt id=hl-41-112><a class=lnlinks href=#hl-41-112>112</a>
</span><span class=lnt id=hl-41-113><a class=lnlinks href=#hl-41-113>113</a>
</span><span class=lnt id=hl-41-114><a class=lnlinks href=#hl-41-114>114</a>
</span><span class=lnt id=hl-41-115><a class=lnlinks href=#hl-41-115>115</a>
</span><span class=lnt id=hl-41-116><a class=lnlinks href=#hl-41-116>116</a>
</span><span class=lnt id=hl-41-117><a class=lnlinks href=#hl-41-117>117</a>
</span><span class=lnt id=hl-41-118><a class=lnlinks href=#hl-41-118>118</a>
</span><span class=lnt id=hl-41-119><a class=lnlinks href=#hl-41-119>119</a>
</span><span class=lnt id=hl-41-120><a class=lnlinks href=#hl-41-120>120</a>
</span><span class=lnt id=hl-41-121><a class=lnlinks href=#hl-41-121>121</a>
</span><span class=lnt id=hl-41-122><a class=lnlinks href=#hl-41-122>122</a>
</span><span class=lnt id=hl-41-123><a class=lnlinks href=#hl-41-123>123</a>
</span><span class=lnt id=hl-41-124><a class=lnlinks href=#hl-41-124>124</a>
</span><span class=lnt id=hl-41-125><a class=lnlinks href=#hl-41-125>125</a>
</span><span class=lnt id=hl-41-126><a class=lnlinks href=#hl-41-126>126</a>
</span><span class=lnt id=hl-41-127><a class=lnlinks href=#hl-41-127>127</a>
</span><span class=lnt id=hl-41-128><a class=lnlinks href=#hl-41-128>128</a>
</span><span class=lnt id=hl-41-129><a class=lnlinks href=#hl-41-129>129</a>
</span><span class=lnt id=hl-41-130><a class=lnlinks href=#hl-41-130>130</a>
</span><span class=lnt id=hl-41-131><a class=lnlinks href=#hl-41-131>131</a>
</span><span class=lnt id=hl-41-132><a class=lnlinks href=#hl-41-132>132</a>
</span><span class=lnt id=hl-41-133><a class=lnlinks href=#hl-41-133>133</a>
</span><span class=lnt id=hl-41-134><a class=lnlinks href=#hl-41-134>134</a>
</span><span class=lnt id=hl-41-135><a class=lnlinks href=#hl-41-135>135</a>
</span><span class=lnt id=hl-41-136><a class=lnlinks href=#hl-41-136>136</a>
</span><span class=lnt id=hl-41-137><a class=lnlinks href=#hl-41-137>137</a>
</span><span class=lnt id=hl-41-138><a class=lnlinks href=#hl-41-138>138</a>
</span><span class=lnt id=hl-41-139><a class=lnlinks href=#hl-41-139>139</a>
</span><span class=lnt id=hl-41-140><a class=lnlinks href=#hl-41-140>140</a>
</span><span class=lnt id=hl-41-141><a class=lnlinks href=#hl-41-141>141</a>
</span><span class=lnt id=hl-41-142><a class=lnlinks href=#hl-41-142>142</a>
</span><span class=lnt id=hl-41-143><a class=lnlinks href=#hl-41-143>143</a>
</span><span class=lnt id=hl-41-144><a class=lnlinks href=#hl-41-144>144</a>
</span><span class=lnt id=hl-41-145><a class=lnlinks href=#hl-41-145>145</a>
</span><span class=lnt id=hl-41-146><a class=lnlinks href=#hl-41-146>146</a>
</span><span class=lnt id=hl-41-147><a class=lnlinks href=#hl-41-147>147</a>
</span><span class=lnt id=hl-41-148><a class=lnlinks href=#hl-41-148>148</a>
</span><span class=lnt id=hl-41-149><a class=lnlinks href=#hl-41-149>149</a>
</span><span class=lnt id=hl-41-150><a class=lnlinks href=#hl-41-150>150</a>
</span><span class=lnt id=hl-41-151><a class=lnlinks href=#hl-41-151>151</a>
</span><span class=lnt id=hl-41-152><a class=lnlinks href=#hl-41-152>152</a>
</span><span class=lnt id=hl-41-153><a class=lnlinks href=#hl-41-153>153</a>
</span><span class=lnt id=hl-41-154><a class=lnlinks href=#hl-41-154>154</a>
</span><span class=lnt id=hl-41-155><a class=lnlinks href=#hl-41-155>155</a>
</span><span class=lnt id=hl-41-156><a class=lnlinks href=#hl-41-156>156</a>
</span><span class=lnt id=hl-41-157><a class=lnlinks href=#hl-41-157>157</a>
</span><span class=lnt id=hl-41-158><a class=lnlinks href=#hl-41-158>158</a>
</span><span class=lnt id=hl-41-159><a class=lnlinks href=#hl-41-159>159</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yml - Hemnet 이미지 처리 시스템 구성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># RabbitMQ 클러스터</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq:4-management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-hemnet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5672:5672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;15672:15672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;15692:15692&#34;</span><span class=w>  </span><span class=c># Prometheus 메트릭</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_DEFAULT_USER</span><span class=p>:</span><span class=w> </span><span class=l>hemnet_admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_DEFAULT_PASS</span><span class=p>:</span><span class=w> </span><span class=l>secure_password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_ERLANG_COOKIE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hemnet_cookie_secret&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq_data:/var/lib/rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>2G</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;1.0&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 이미지 업로드 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>upload-api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./services/image_upload_api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8000:8000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://hemnet_admin:secure_password@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REDIS_URL</span><span class=p>:</span><span class=w> </span><span class=l>redis://redis:6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class=l>${AWS_ACCESS_KEY_ID}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${AWS_SECRET_ACCESS_KEY}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>S3_BUCKET_NAME</span><span class=p>:</span><span class=w> </span><span class=l>hemnet-property-images</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>  </span><span class=c># 로드 밸런싱</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 이미지 처리 워커 (Auto Scaling)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image-worker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./workers/image_processing_worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://hemnet_admin:secure_password@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REDIS_URL</span><span class=p>:</span><span class=w> </span><span class=l>redis://redis:6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class=l>${AWS_ACCESS_KEY_ID}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${AWS_SECRET_ACCESS_KEY}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>  </span><span class=c># 처리량에 따라 동적 조절</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>1G</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0.5&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 메타데이터 추출 워커</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metadata-worker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./workers/metadata_extraction_worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://hemnet_admin:secure_password@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_URL</span><span class=p>:</span><span class=w> </span><span class=l>postgresql://postgres:password@postgres:5432/hemnet_images</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class=l>${AWS_ACCESS_KEY_ID}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${AWS_SECRET_ACCESS_KEY}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 알림 워커</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>notification-worker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>./workers/notification_worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>RABBITMQ_URL</span><span class=p>:</span><span class=w> </span><span class=l>amqp://hemnet_admin:secure_password@rabbitmq:5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REDIS_URL</span><span class=p>:</span><span class=w> </span><span class=l>redis://redis:6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>SMTP_HOST</span><span class=p>:</span><span class=w> </span><span class=l>${SMTP_HOST}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>SMTP_USER</span><span class=p>:</span><span class=w> </span><span class=l>${SMTP_USER}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>SMTP_PASS</span><span class=p>:</span><span class=w> </span><span class=l>${SMTP_PASS}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Redis (상태 캐시)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:7-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;6379:6379&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis_data:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>512M</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># PostgreSQL (메타데이터 저장)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5432:5432&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>hemnet_images</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres_data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./init.sql:/docker-entrypoint-initdb.d/init.sql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Prometheus (메트릭 수집)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>prom/prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9090:9090&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./prometheus.yml:/etc/prometheus/prometheus.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>prometheus_data:/prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Grafana (모니터링 대시보드)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>grafana</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>grafana/grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>GF_SECURITY_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>grafana_data:/var/lib/grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hemnet-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>grafana_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hemnet-network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>성능 개선</strong>: 이미지 업로드 후 처리 시간 15분 → 30초로 단축 (96.7% 개선)</li><li><strong>운영 효율성</strong>: 자동화된 워커 스케일링으로 피크 시간 대응 능력 300% 향상</li><li><strong>비용 절감</strong>: 클라우드 리소스 효율적 사용으로 월 서버 비용 30% 절감 (동적 스케일링)</li><li><strong>사용자 만족도</strong>: 즉시 업로드 완료 응답으로 중개업체 만족도 95% 달성</li><li><strong>시스템 안정성</strong>: 99.9% 가용성 유지, 개별 워커 장애가 전체 시스템에 미치는 영향 차단</li></ul><h3 id=54-통합-및-연계-기술-분석>5.4 통합 및 연계 기술 분석<a hidden class=anchor aria-hidden=true href=#54-통합-및-연계-기술-분석>#</a></h3><h4 id=rabbitmq와-통합-가능한-핵심-기술들>RabbitMQ와 통합 가능한 핵심 기술들<a hidden class=anchor aria-hidden=true href=#rabbitmq와-통합-가능한-핵심-기술들>#</a></h4><p><strong>1. 컨테이너 오케스트레이션</strong></p><ul><li><strong>Kubernetes</strong>: Helm Chart를 통한 클러스터 배포, HPA를 통한 동적 스케일링</li><li><strong>Docker Swarm</strong>: 간단한 클러스터 구성, 내장 로드 밸런싱</li><li><strong>OpenShift</strong>: 기업용 Kubernetes, 보안 강화 및 운영 도구 통합</li></ul><p><strong>2. 모니터링 및 관측성</strong></p><ul><li><strong>Prometheus + Grafana</strong>: 메트릭 수집 및 시각화</li><li><strong>ELK Stack</strong>: 로그 수집, 분석, 시각화</li><li><strong>Jaeger/Zipkin</strong>: 분산 트레이싱, 메시지 흐름 추적</li><li><strong>New Relic/DataDog</strong>: APM 통합 모니터링</li></ul><p><strong>3. 클라우드 서비스 연동</strong></p><ul><li><strong>AWS</strong>: SQS/SNS 하이브리드, Lambda 통합, CloudWatch 모니터링</li><li><strong>Azure</strong>: Service Bus 연동, Event Grid 통합, Azure Monitor</li><li><strong>GCP</strong>: Pub/Sub 연동, Cloud Functions, Stackdriver</li></ul><p><strong>4. 데이터베이스 및 캐시 시스템</strong></p><ul><li><strong>Redis</strong>: 세션 관리, 메시지 캐싱, 결과 저장</li><li><strong>PostgreSQL/MySQL</strong>: 메타데이터 저장, 트랜잭션 로그</li><li><strong>MongoDB</strong>: 이벤트 스토어, 유연한 스키마 요구사항</li><li><strong>Elasticsearch</strong>: 메시지 인덱싱, 실시간 검색</li></ul><p><strong>연계 아키텍처 패턴</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Application Layer&#34;
        WEB[Web Applications]
        MOBILE[Mobile Apps]
        API[API Gateway]
    end
    
    subgraph &#34;Message Layer&#34;
        RABBIT[RabbitMQ Cluster]
        KAFKA[Apache Kafka]
        REDIS_PUB[Redis Pub/Sub]
    end
    
    subgraph &#34;Processing Layer&#34;
        WORKER[Worker Pods]
        LAMBDA[AWS Lambda]
        FUNC[Cloud Functions]
    end
    
    subgraph &#34;Storage Layer&#34;
        POSTGRES[(PostgreSQL)]
        MONGO[(MongoDB)]
        S3[(Object Storage)]
    end
    
    subgraph &#34;Observability&#34;
        PROM[Prometheus]
        GRAF[Grafana]
        JAEGER[Jaeger]
    end
    
    API --&gt; RABBIT
    RABBIT --&gt; WORKER
    RABBIT --&gt; LAMBDA
    WORKER --&gt; POSTGRES
    WORKER --&gt; MONGO
    WORKER --&gt; S3
    
    RABBIT --&gt; KAFKA
    KAFKA --&gt; FUNC
    
    RABBIT --&gt; PROM
    PROM --&gt; GRAF
    WORKER --&gt; JAEGER
</pre><hr><h2 id=6단계-phase-6-조사-운영-및-최적화>6단계: Phase 6 조사 (운영 및 최적화)<a hidden class=anchor aria-hidden=true href=#6단계-phase-6-조사-운영-및-최적화>#</a></h2><h2 id=phase-6-운영-및-최적화-operations--optimization-1>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization-1>#</a></h2><h3 id=61-보안-및-거버넌스-1>6.1 보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스-1>#</a></h3><h4 id=종합적-보안-아키텍처>종합적 보안 아키텍처<a hidden class=anchor aria-hidden=true href=#종합적-보안-아키텍처>#</a></h4><p><strong>다층 보안 모델</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Network Security&#34;
        FW[Firewall]
        VPN[VPN Gateway]  
        LB[Load Balancer + TLS]
    end
    
    subgraph &#34;Authentication Layer&#34;
        LDAP[LDAP/AD]
        OAUTH[OAuth 2.0]
        CERT[X.509 Certificates]
    end
    
    subgraph &#34;RabbitMQ Security&#34;
        TLS[TLS 1.3 Encryption]
        AUTH[Authentication]
        AUTHZ[Authorization]
        AUDIT[Audit Logging]
    end
    
    subgraph &#34;Infrastructure Security&#34;
        VAULT[HashiCorp Vault]
        SECRETS[Secret Management]
        RBAC[Role-Based Access]
    end
    
    FW --&gt; LB
    LB --&gt; TLS
    LDAP --&gt; AUTH
    OAUTH --&gt; AUTH
    CERT --&gt; AUTH
    AUTH --&gt; AUTHZ
    AUTHZ --&gt; AUDIT
    VAULT --&gt; SECRETS
    SECRETS --&gt; TLS
</pre><h4 id=핵심-보안-설정>핵심 보안 설정<a hidden class=anchor aria-hidden=true href=#핵심-보안-설정>#</a></h4><p><strong>1. TLS/SSL 암호화 (전송 중 보안)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1> 1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2> 2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3> 3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4> 4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5> 5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6> 6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7> 7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8> 8</a>
</span><span class=lnt id=hl-44-9><a class=lnlinks href=#hl-44-9> 9</a>
</span><span class=lnt id=hl-44-10><a class=lnlinks href=#hl-44-10>10</a>
</span><span class=lnt id=hl-44-11><a class=lnlinks href=#hl-44-11>11</a>
</span><span class=lnt id=hl-44-12><a class=lnlinks href=#hl-44-12>12</a>
</span><span class=lnt id=hl-44-13><a class=lnlinks href=#hl-44-13>13</a>
</span><span class=lnt id=hl-44-14><a class=lnlinks href=#hl-44-14>14</a>
</span><span class=lnt id=hl-44-15><a class=lnlinks href=#hl-44-15>15</a>
</span><span class=lnt id=hl-44-16><a class=lnlinks href=#hl-44-16>16</a>
</span><span class=lnt id=hl-44-17><a class=lnlinks href=#hl-44-17>17</a>
</span><span class=lnt id=hl-44-18><a class=lnlinks href=#hl-44-18>18</a>
</span><span class=lnt id=hl-44-19><a class=lnlinks href=#hl-44-19>19</a>
</span><span class=lnt id=hl-44-20><a class=lnlinks href=#hl-44-20>20</a>
</span><span class=lnt id=hl-44-21><a class=lnlinks href=#hl-44-21>21</a>
</span><span class=lnt id=hl-44-22><a class=lnlinks href=#hl-44-22>22</a>
</span><span class=lnt id=hl-44-23><a class=lnlinks href=#hl-44-23>23</a>
</span><span class=lnt id=hl-44-24><a class=lnlinks href=#hl-44-24>24</a>
</span><span class=lnt id=hl-44-25><a class=lnlinks href=#hl-44-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># rabbitmq.conf - 프로덕션 보안 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># TLS 리스너 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>listeners.ssl.default = 5671</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>listeners.tcp = none </span><span class=w> </span><span class=c># HTTP 연결 완전 차단</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># TLS 1.3 강제 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.versions.1 = tlsv1.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.ciphers.1 = TLS_AES_256_GCM_SHA384</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.ciphers.2 = TLS_CHACHA20_POLY1305_SHA256</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.ciphers.3 = TLS_AES_128_GCM_SHA256</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 인증서 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.certfile = /etc/rabbitmq/ssl/server.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.keyfile = /etc/rabbitmq/ssl/server.key  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.cacertfile = /etc/rabbitmq/ssl/ca.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 피어 검증 강제</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.verify = verify_peer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>ssl_options.fail_if_no_peer_cert = true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 관리 UI HTTPS 전용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.ssl.port = 15671</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.ssl.certfile = /etc/rabbitmq/ssl/server.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.ssl.keyfile = /etc/rabbitmq/ssl/server.key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>management.tcp.port = none </span><span class=w> </span><span class=c># HTTP 관리 인터페이스 비활성화</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>2. LDAP 통합 인증 (기업 환경)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1> 1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2> 2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3> 3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4> 4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5> 5</a>
</span><span class=lnt id=hl-45-6><a class=lnlinks href=#hl-45-6> 6</a>
</span><span class=lnt id=hl-45-7><a class=lnlinks href=#hl-45-7> 7</a>
</span><span class=lnt id=hl-45-8><a class=lnlinks href=#hl-45-8> 8</a>
</span><span class=lnt id=hl-45-9><a class=lnlinks href=#hl-45-9> 9</a>
</span><span class=lnt id=hl-45-10><a class=lnlinks href=#hl-45-10>10</a>
</span><span class=lnt id=hl-45-11><a class=lnlinks href=#hl-45-11>11</a>
</span><span class=lnt id=hl-45-12><a class=lnlinks href=#hl-45-12>12</a>
</span><span class=lnt id=hl-45-13><a class=lnlinks href=#hl-45-13>13</a>
</span><span class=lnt id=hl-45-14><a class=lnlinks href=#hl-45-14>14</a>
</span><span class=lnt id=hl-45-15><a class=lnlinks href=#hl-45-15>15</a>
</span><span class=lnt id=hl-45-16><a class=lnlinks href=#hl-45-16>16</a>
</span><span class=lnt id=hl-45-17><a class=lnlinks href=#hl-45-17>17</a>
</span><span class=lnt id=hl-45-18><a class=lnlinks href=#hl-45-18>18</a>
</span><span class=lnt id=hl-45-19><a class=lnlinks href=#hl-45-19>19</a>
</span><span class=lnt id=hl-45-20><a class=lnlinks href=#hl-45-20>20</a>
</span><span class=lnt id=hl-45-21><a class=lnlinks href=#hl-45-21>21</a>
</span><span class=lnt id=hl-45-22><a class=lnlinks href=#hl-45-22>22</a>
</span><span class=lnt id=hl-45-23><a class=lnlinks href=#hl-45-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># LDAP 인증 백엔드 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_backends.1 = ldap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_backends.2 = internal </span><span class=w> </span><span class=c># 백업 인증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># LDAP 서버 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.servers.1 = ldaps://ldap.company.com:636</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.use_ssl = true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.port = 636</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 사용자 DN 패턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.user_dn_pattern = cn=${username},ou=Users,dc=company,dc=com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 권한 매핑 쿼리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.vhost_access_query = {constant, true}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.resource_access_query = {for, [</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=l>permission, configure, {in_group, &#34;cn=rabbitmq-admin,ou=Groups,dc=company,dc=com&#34;}},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=l>permission, write, {in_group, &#34;cn=rabbitmq-producer,ou=Groups,dc=company,dc=com&#34;}},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=l>permission, read, {in_group, &#34;cn=rabbitmq-consumer,ou=Groups,dc=company,dc=com&#34;}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 연결 풀링 및 캐싱</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_ldap.connection_pool_size = 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>auth_cache_ttl = 300000 </span><span class=w> </span><span class=c># 5분 캐시</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>3. X.509 인증서 기반 인증</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1> 1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2> 2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3> 3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4> 4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5> 5</a>
</span><span class=lnt id=hl-46-6><a class=lnlinks href=#hl-46-6> 6</a>
</span><span class=lnt id=hl-46-7><a class=lnlinks href=#hl-46-7> 7</a>
</span><span class=lnt id=hl-46-8><a class=lnlinks href=#hl-46-8> 8</a>
</span><span class=lnt id=hl-46-9><a class=lnlinks href=#hl-46-9> 9</a>
</span><span class=lnt id=hl-46-10><a class=lnlinks href=#hl-46-10>10</a>
</span><span class=lnt id=hl-46-11><a class=lnlinks href=#hl-46-11>11</a>
</span><span class=lnt id=hl-46-12><a class=lnlinks href=#hl-46-12>12</a>
</span><span class=lnt id=hl-46-13><a class=lnlinks href=#hl-46-13>13</a>
</span><span class=lnt id=hl-46-14><a class=lnlinks href=#hl-46-14>14</a>
</span><span class=lnt id=hl-46-15><a class=lnlinks href=#hl-46-15>15</a>
</span><span class=lnt id=hl-46-16><a class=lnlinks href=#hl-46-16>16</a>
</span><span class=lnt id=hl-46-17><a class=lnlinks href=#hl-46-17>17</a>
</span><span class=lnt id=hl-46-18><a class=lnlinks href=#hl-46-18>18</a>
</span><span class=lnt id=hl-46-19><a class=lnlinks href=#hl-46-19>19</a>
</span><span class=lnt id=hl-46-20><a class=lnlinks href=#hl-46-20>20</a>
</span><span class=lnt id=hl-46-21><a class=lnlinks href=#hl-46-21>21</a>
</span><span class=lnt id=hl-46-22><a class=lnlinks href=#hl-46-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 클라이언트 인증서 인증 설정</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>ssl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 클라이언트 인증서를 사용한 연결</span>
</span></span><span class=line><span class=cl><span class=n>ssl_context</span> <span class=o>=</span> <span class=n>ssl</span><span class=o>.</span><span class=n>create_default_context</span><span class=p>(</span><span class=n>ssl</span><span class=o>.</span><span class=n>Purpose</span><span class=o>.</span><span class=n>SERVER_AUTH</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ssl_context</span><span class=o>.</span><span class=n>check_hostname</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>ssl_context</span><span class=o>.</span><span class=n>load_cert_chain</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;/path/to/client.crt&#39;</span><span class=p>,</span>    <span class=c1># 클라이언트 인증서</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;/path/to/client.key&#39;</span>     <span class=c1># 클라이언트 개인키</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ssl_context</span><span class=o>.</span><span class=n>load_verify_locations</span><span class=p>(</span><span class=s1>&#39;/path/to/ca.crt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 연결 - 인증서 기반 인증</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=o>=</span><span class=s1>&#39;rabbitmq.company.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>port</span><span class=o>=</span><span class=mi>5671</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ssl_options</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>SSLOptions</span><span class=p>(</span><span class=n>ssl_context</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>credentials</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>credentials</span><span class=o>.</span><span class=n>ExternalCredentials</span><span class=p>()</span>  <span class=c1># 외부 인증 모드</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=규정-준수-compliance>규정 준수 (Compliance)<a hidden class=anchor aria-hidden=true href=#규정-준수-compliance>#</a></h4><p><strong>GDPR 준수사항</strong></p><ul><li><strong>개인정보 처리 기록</strong>: 메시지 처리 로그에서 개인정보 마스킹</li><li><strong>데이터 삭제권</strong>: TTL 설정을 통한 자동 데이터 만료</li><li><strong>데이터 이동권</strong>: 메시지 내용 추출 및 전송 기능</li></ul><p><strong>HIPAA 준수사항</strong> (의료 데이터)</p><ul><li><strong>암호화</strong>: 전송 중/저장 시 암호화 (AES-256)</li><li><strong>접근 제어</strong>: 최소 권한 원칙 적용</li><li><strong>감사 로그</strong>: 모든 접근 기록 유지</li></ul><p><strong>SOX 준수사항</strong> (금융 기관)</p><ul><li><strong>데이터 무결성</strong>: 메시지 변조 방지 및 검증</li><li><strong>변경 추적</strong>: 설정 변경 이력 관리</li><li><strong>백업 및 복구</strong>: 정기적 백업 및 복구 테스트</li></ul><h3 id=62-모니터링-및-관측성-1>6.2 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성-1>#</a></h3><h4 id=핵심-메트릭-분류>핵심 메트릭 분류<a hidden class=anchor aria-hidden=true href=#핵심-메트릭-분류>#</a></h4><blockquote><p>이 표는 RabbitMQ 운영에 필요한 핵심 메트릭을 분류하고 임계값을 정의하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>메트릭 범주</th><th>지표명</th><th>정상 범위</th><th>경고 임계값</th><th>위험 임계값</th><th>비즈니스 영향</th></tr></thead><tbody><tr><td><strong>처리량</strong></td><td>Messages/sec</td><td>100-10,000</td><td>> 15,000</td><td>> 20,000</td><td>시스템 과부하 위험</td></tr><tr><td><strong>지연시간</strong></td><td>End-to-end Latency</td><td>&lt; 10ms</td><td>> 100ms</td><td>> 1s</td><td>사용자 경험 저하</td></tr><tr><td><strong>큐 상태</strong></td><td>Queue Depth</td><td>&lt; 1,000</td><td>> 5,000</td><td>> 10,000</td><td>메시지 손실 위험</td></tr><tr><td><strong>메모리</strong></td><td>Memory Usage</td><td>&lt; 70%</td><td>> 80%</td><td>> 90%</td><td>OOM Kill 위험</td></tr><tr><td><strong>연결</strong></td><td>Connection Count</td><td>10-1,000</td><td>> 1,500</td><td>> 2,000</td><td>리소스 고갈</td></tr><tr><td><strong>에러율</strong></td><td>Message Rejection Rate</td><td>&lt; 0.1%</td><td>> 1%</td><td>> 5%</td><td>데이터 손실 위험</td></tr><tr><td><strong>클러스터</strong></td><td>Node Availability</td><td>100%</td><td>&lt; 100%</td><td>&lt; 67%</td><td>서비스 중단</td></tr></tbody></table><h4 id=prometheus-메트릭-수집-설정>Prometheus 메트릭 수집 설정<a hidden class=anchor aria-hidden=true href=#prometheus-메트릭-수집-설정>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1> 1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2> 2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3> 3</a>
</span><span class=lnt id=hl-47-4><a class=lnlinks href=#hl-47-4> 4</a>
</span><span class=lnt id=hl-47-5><a class=lnlinks href=#hl-47-5> 5</a>
</span><span class=lnt id=hl-47-6><a class=lnlinks href=#hl-47-6> 6</a>
</span><span class=lnt id=hl-47-7><a class=lnlinks href=#hl-47-7> 7</a>
</span><span class=lnt id=hl-47-8><a class=lnlinks href=#hl-47-8> 8</a>
</span><span class=lnt id=hl-47-9><a class=lnlinks href=#hl-47-9> 9</a>
</span><span class=lnt id=hl-47-10><a class=lnlinks href=#hl-47-10>10</a>
</span><span class=lnt id=hl-47-11><a class=lnlinks href=#hl-47-11>11</a>
</span><span class=lnt id=hl-47-12><a class=lnlinks href=#hl-47-12>12</a>
</span><span class=lnt id=hl-47-13><a class=lnlinks href=#hl-47-13>13</a>
</span><span class=lnt id=hl-47-14><a class=lnlinks href=#hl-47-14>14</a>
</span><span class=lnt id=hl-47-15><a class=lnlinks href=#hl-47-15>15</a>
</span><span class=lnt id=hl-47-16><a class=lnlinks href=#hl-47-16>16</a>
</span><span class=lnt id=hl-47-17><a class=lnlinks href=#hl-47-17>17</a>
</span><span class=lnt id=hl-47-18><a class=lnlinks href=#hl-47-18>18</a>
</span><span class=lnt id=hl-47-19><a class=lnlinks href=#hl-47-19>19</a>
</span><span class=lnt id=hl-47-20><a class=lnlinks href=#hl-47-20>20</a>
</span><span class=lnt id=hl-47-21><a class=lnlinks href=#hl-47-21>21</a>
</span><span class=lnt id=hl-47-22><a class=lnlinks href=#hl-47-22>22</a>
</span><span class=lnt id=hl-47-23><a class=lnlinks href=#hl-47-23>23</a>
</span><span class=lnt id=hl-47-24><a class=lnlinks href=#hl-47-24>24</a>
</span><span class=lnt id=hl-47-25><a class=lnlinks href=#hl-47-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># prometheus.yml - RabbitMQ 메트릭 수집 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>global</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>evaluation_interval</span><span class=p>:</span><span class=w> </span><span class=l>15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rule_files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=s2>&#34;rabbitmq_alerts.yml&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># RabbitMQ 메트릭 수집</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;rabbitmq&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;rabbitmq-node1:15692&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;rabbitmq-node2:15692&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;rabbitmq-node3:15692&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_path</span><span class=p>:</span><span class=w> </span><span class=l>/metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Node Exporter (시스템 메트릭)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;node-exporter&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;rabbitmq-node1:9100&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;rabbitmq-node2:9100&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;rabbitmq-node3:9100&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>alerting</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>alertmanagers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;alertmanager:9093&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1> 1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2> 2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3> 3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4> 4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5> 5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6> 6</a>
</span><span class=lnt id=hl-48-7><a class=lnlinks href=#hl-48-7> 7</a>
</span><span class=lnt id=hl-48-8><a class=lnlinks href=#hl-48-8> 8</a>
</span><span class=lnt id=hl-48-9><a class=lnlinks href=#hl-48-9> 9</a>
</span><span class=lnt id=hl-48-10><a class=lnlinks href=#hl-48-10>10</a>
</span><span class=lnt id=hl-48-11><a class=lnlinks href=#hl-48-11>11</a>
</span><span class=lnt id=hl-48-12><a class=lnlinks href=#hl-48-12>12</a>
</span><span class=lnt id=hl-48-13><a class=lnlinks href=#hl-48-13>13</a>
</span><span class=lnt id=hl-48-14><a class=lnlinks href=#hl-48-14>14</a>
</span><span class=lnt id=hl-48-15><a class=lnlinks href=#hl-48-15>15</a>
</span><span class=lnt id=hl-48-16><a class=lnlinks href=#hl-48-16>16</a>
</span><span class=lnt id=hl-48-17><a class=lnlinks href=#hl-48-17>17</a>
</span><span class=lnt id=hl-48-18><a class=lnlinks href=#hl-48-18>18</a>
</span><span class=lnt id=hl-48-19><a class=lnlinks href=#hl-48-19>19</a>
</span><span class=lnt id=hl-48-20><a class=lnlinks href=#hl-48-20>20</a>
</span><span class=lnt id=hl-48-21><a class=lnlinks href=#hl-48-21>21</a>
</span><span class=lnt id=hl-48-22><a class=lnlinks href=#hl-48-22>22</a>
</span><span class=lnt id=hl-48-23><a class=lnlinks href=#hl-48-23>23</a>
</span><span class=lnt id=hl-48-24><a class=lnlinks href=#hl-48-24>24</a>
</span><span class=lnt id=hl-48-25><a class=lnlinks href=#hl-48-25>25</a>
</span><span class=lnt id=hl-48-26><a class=lnlinks href=#hl-48-26>26</a>
</span><span class=lnt id=hl-48-27><a class=lnlinks href=#hl-48-27>27</a>
</span><span class=lnt id=hl-48-28><a class=lnlinks href=#hl-48-28>28</a>
</span><span class=lnt id=hl-48-29><a class=lnlinks href=#hl-48-29>29</a>
</span><span class=lnt id=hl-48-30><a class=lnlinks href=#hl-48-30>30</a>
</span><span class=lnt id=hl-48-31><a class=lnlinks href=#hl-48-31>31</a>
</span><span class=lnt id=hl-48-32><a class=lnlinks href=#hl-48-32>32</a>
</span><span class=lnt id=hl-48-33><a class=lnlinks href=#hl-48-33>33</a>
</span><span class=lnt id=hl-48-34><a class=lnlinks href=#hl-48-34>34</a>
</span><span class=lnt id=hl-48-35><a class=lnlinks href=#hl-48-35>35</a>
</span><span class=lnt id=hl-48-36><a class=lnlinks href=#hl-48-36>36</a>
</span><span class=lnt id=hl-48-37><a class=lnlinks href=#hl-48-37>37</a>
</span><span class=lnt id=hl-48-38><a class=lnlinks href=#hl-48-38>38</a>
</span><span class=lnt id=hl-48-39><a class=lnlinks href=#hl-48-39>39</a>
</span><span class=lnt id=hl-48-40><a class=lnlinks href=#hl-48-40>40</a>
</span><span class=lnt id=hl-48-41><a class=lnlinks href=#hl-48-41>41</a>
</span><span class=lnt id=hl-48-42><a class=lnlinks href=#hl-48-42>42</a>
</span><span class=lnt id=hl-48-43><a class=lnlinks href=#hl-48-43>43</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># rabbitmq_alerts.yml - RabbitMQ 알람 규칙</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq_alerts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 큐 깊이 경고</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>RabbitMQQueueDepthHigh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq_queue_messages &gt; 5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;RabbitMQ queue depth is high&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Queue {{ $labels.queue }} has {{ $value }} messages&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 메모리 사용량 경고  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>RabbitMQMemoryUsageHigh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>(rabbitmq_erlang_vm_memory_bytes / rabbitmq_erlang_vm_memory_limit_bytes) * 100 &gt; 80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>2m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;RabbitMQ memory usage is high&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Memory usage is {{ $value }}%&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 노드 다운 경고</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>RabbitMQNodeDown</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>up{job=&#34;rabbitmq&#34;} == 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>1m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>critical</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;RabbitMQ node is down&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Node {{ $labels.instance }} is unreachable&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 메시지 발행 실패율 경고</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>RabbitMQPublishFailureRateHigh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>rate(rabbitmq_channel_messages_returned_total[5m]) &gt; 0.01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>3m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;High message publish failure rate&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Publish failure rate is {{ $value }} messages/sec&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=구조화된-로깅-설정>구조화된 로깅 설정<a hidden class=anchor aria-hidden=true href=#구조화된-로깅-설정>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1> 1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2> 2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3> 3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4> 4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5> 5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6> 6</a>
</span><span class=lnt id=hl-49-7><a class=lnlinks href=#hl-49-7> 7</a>
</span><span class=lnt id=hl-49-8><a class=lnlinks href=#hl-49-8> 8</a>
</span><span class=lnt id=hl-49-9><a class=lnlinks href=#hl-49-9> 9</a>
</span><span class=lnt id=hl-49-10><a class=lnlinks href=#hl-49-10>10</a>
</span><span class=lnt id=hl-49-11><a class=lnlinks href=#hl-49-11>11</a>
</span><span class=lnt id=hl-49-12><a class=lnlinks href=#hl-49-12>12</a>
</span><span class=lnt id=hl-49-13><a class=lnlinks href=#hl-49-13>13</a>
</span><span class=lnt id=hl-49-14><a class=lnlinks href=#hl-49-14>14</a>
</span><span class=lnt id=hl-49-15><a class=lnlinks href=#hl-49-15>15</a>
</span><span class=lnt id=hl-49-16><a class=lnlinks href=#hl-49-16>16</a>
</span><span class=lnt id=hl-49-17><a class=lnlinks href=#hl-49-17>17</a>
</span><span class=lnt id=hl-49-18><a class=lnlinks href=#hl-49-18>18</a>
</span><span class=lnt id=hl-49-19><a class=lnlinks href=#hl-49-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># rabbitmq.conf - 로깅 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 구조화된 JSON 로깅 활성화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.console = true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.console.level = info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.console.formatter = json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 로그 파일 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.file = /var/log/rabbitmq/rabbit.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.file.level = info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.file.formatter = json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.file.rotation.date = $D0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.file.rotation.size = 100MB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.file.rotation.count = 5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 연결 로깅 (보안 감사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.connection.level = info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># AMQP 프로토콜 로깅 (디버깅용 - 프로덕션에서는 비활성화)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>log.ldap.level = debug </span><span class=w> </span><span class=c># LDAP 인증 디버깅</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1> 1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2> 2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3> 3</a>
</span><span class=lnt id=hl-50-4><a class=lnlinks href=#hl-50-4> 4</a>
</span><span class=lnt id=hl-50-5><a class=lnlinks href=#hl-50-5> 5</a>
</span><span class=lnt id=hl-50-6><a class=lnlinks href=#hl-50-6> 6</a>
</span><span class=lnt id=hl-50-7><a class=lnlinks href=#hl-50-7> 7</a>
</span><span class=lnt id=hl-50-8><a class=lnlinks href=#hl-50-8> 8</a>
</span><span class=lnt id=hl-50-9><a class=lnlinks href=#hl-50-9> 9</a>
</span><span class=lnt id=hl-50-10><a class=lnlinks href=#hl-50-10>10</a>
</span><span class=lnt id=hl-50-11><a class=lnlinks href=#hl-50-11>11</a>
</span><span class=lnt id=hl-50-12><a class=lnlinks href=#hl-50-12>12</a>
</span><span class=lnt id=hl-50-13><a class=lnlinks href=#hl-50-13>13</a>
</span><span class=lnt id=hl-50-14><a class=lnlinks href=#hl-50-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-08-15T10:30:45.123Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;info&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pid&#34;</span><span class=p>:</span> <span class=mi>12345</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;connection_created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;meta&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;connection&#34;</span><span class=p>:</span> <span class=s2>&#34;192.168.1.100:35642 -&gt; 192.168.1.10:5672&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span><span class=p>:</span> <span class=s2>&#34;order_service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vhost&#34;</span><span class=p>:</span> <span class=s2>&#34;/ecommerce&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;AMQP 0-9-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;peer_cert_subject&#34;</span><span class=p>:</span> <span class=s2>&#34;CN=order-service.company.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;auth_mechanism&#34;</span><span class=p>:</span> <span class=s2>&#34;EXTERNAL&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=grafana-대시보드-구성>Grafana 대시보드 구성<a hidden class=anchor aria-hidden=true href=#grafana-대시보드-구성>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1> 1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2> 2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3> 3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4> 4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5> 5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6> 6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7> 7</a>
</span><span class=lnt id=hl-51-8><a class=lnlinks href=#hl-51-8> 8</a>
</span><span class=lnt id=hl-51-9><a class=lnlinks href=#hl-51-9> 9</a>
</span><span class=lnt id=hl-51-10><a class=lnlinks href=#hl-51-10>10</a>
</span><span class=lnt id=hl-51-11><a class=lnlinks href=#hl-51-11>11</a>
</span><span class=lnt id=hl-51-12><a class=lnlinks href=#hl-51-12>12</a>
</span><span class=lnt id=hl-51-13><a class=lnlinks href=#hl-51-13>13</a>
</span><span class=lnt id=hl-51-14><a class=lnlinks href=#hl-51-14>14</a>
</span><span class=lnt id=hl-51-15><a class=lnlinks href=#hl-51-15>15</a>
</span><span class=lnt id=hl-51-16><a class=lnlinks href=#hl-51-16>16</a>
</span><span class=lnt id=hl-51-17><a class=lnlinks href=#hl-51-17>17</a>
</span><span class=lnt id=hl-51-18><a class=lnlinks href=#hl-51-18>18</a>
</span><span class=lnt id=hl-51-19><a class=lnlinks href=#hl-51-19>19</a>
</span><span class=lnt id=hl-51-20><a class=lnlinks href=#hl-51-20>20</a>
</span><span class=lnt id=hl-51-21><a class=lnlinks href=#hl-51-21>21</a>
</span><span class=lnt id=hl-51-22><a class=lnlinks href=#hl-51-22>22</a>
</span><span class=lnt id=hl-51-23><a class=lnlinks href=#hl-51-23>23</a>
</span><span class=lnt id=hl-51-24><a class=lnlinks href=#hl-51-24>24</a>
</span><span class=lnt id=hl-51-25><a class=lnlinks href=#hl-51-25>25</a>
</span><span class=lnt id=hl-51-26><a class=lnlinks href=#hl-51-26>26</a>
</span><span class=lnt id=hl-51-27><a class=lnlinks href=#hl-51-27>27</a>
</span><span class=lnt id=hl-51-28><a class=lnlinks href=#hl-51-28>28</a>
</span><span class=lnt id=hl-51-29><a class=lnlinks href=#hl-51-29>29</a>
</span><span class=lnt id=hl-51-30><a class=lnlinks href=#hl-51-30>30</a>
</span><span class=lnt id=hl-51-31><a class=lnlinks href=#hl-51-31>31</a>
</span><span class=lnt id=hl-51-32><a class=lnlinks href=#hl-51-32>32</a>
</span><span class=lnt id=hl-51-33><a class=lnlinks href=#hl-51-33>33</a>
</span><span class=lnt id=hl-51-34><a class=lnlinks href=#hl-51-34>34</a>
</span><span class=lnt id=hl-51-35><a class=lnlinks href=#hl-51-35>35</a>
</span><span class=lnt id=hl-51-36><a class=lnlinks href=#hl-51-36>36</a>
</span><span class=lnt id=hl-51-37><a class=lnlinks href=#hl-51-37>37</a>
</span><span class=lnt id=hl-51-38><a class=lnlinks href=#hl-51-38>38</a>
</span><span class=lnt id=hl-51-39><a class=lnlinks href=#hl-51-39>39</a>
</span><span class=lnt id=hl-51-40><a class=lnlinks href=#hl-51-40>40</a>
</span><span class=lnt id=hl-51-41><a class=lnlinks href=#hl-51-41>41</a>
</span><span class=lnt id=hl-51-42><a class=lnlinks href=#hl-51-42>42</a>
</span><span class=lnt id=hl-51-43><a class=lnlinks href=#hl-51-43>43</a>
</span><span class=lnt id=hl-51-44><a class=lnlinks href=#hl-51-44>44</a>
</span><span class=lnt id=hl-51-45><a class=lnlinks href=#hl-51-45>45</a>
</span><span class=lnt id=hl-51-46><a class=lnlinks href=#hl-51-46>46</a>
</span><span class=lnt id=hl-51-47><a class=lnlinks href=#hl-51-47>47</a>
</span><span class=lnt id=hl-51-48><a class=lnlinks href=#hl-51-48>48</a>
</span><span class=lnt id=hl-51-49><a class=lnlinks href=#hl-51-49>49</a>
</span><span class=lnt id=hl-51-50><a class=lnlinks href=#hl-51-50>50</a>
</span><span class=lnt id=hl-51-51><a class=lnlinks href=#hl-51-51>51</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dashboard&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;RabbitMQ Production Monitoring&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;panels&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Message Rate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;graph&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;targets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;rate(rabbitmq_global_messages_acknowledged_total[5m])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;Messages Consumed/sec&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;rate(rabbitmq_global_messages_published_total[5m])&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;Messages Published/sec&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Queue Depths&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;graph&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;targets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;rabbitmq_queue_messages&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ queue }} - {{ vhost }}&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Memory Usage&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;singlestat&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;targets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;(rabbitmq_erlang_vm_memory_bytes / rabbitmq_erlang_vm_memory_limit_bytes) * 100&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;Memory Usage %&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Connection Count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;singlestat&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;targets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;rabbitmq_connections&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;Active Connections&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=63-실무-적용-고려사항-및-주의점>6.3 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-주의점>#</a></h3><blockquote><p>이 표는 RabbitMQ 실무 적용 시 고려해야 할 주요 사항들과 권장사항을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>고려사항</th><th>위험도</th><th>대응방안</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능</strong></td><td>큐 깊이 증가</td><td>높음</td><td>Consumer 스케일링, Flow Control 조정</td><td>큐 깊이 5,000개 미만 유지</td></tr><tr><td><strong>메모리</strong></td><td>메모리 부족</td><td>매우높음</td><td>Lazy Queue 전환, TTL 설정</td><td>메모리 사용률 80% 미만 유지</td></tr><tr><td><strong>네트워크</strong></td><td>연결 수 폭증</td><td>중간</td><td>Connection Pooling, Channel 재사용</td><td>연결당 평균 10개 채널 사용</td></tr><tr><td><strong>보안</strong></td><td>인증 우회</td><td>매우높음</td><td>guest 계정 비활성화, TLS 강제</td><td>프로덕션에서 PLAIN 인증 금지</td></tr><tr><td><strong>가용성</strong></td><td>단일 장애점</td><td>높음</td><td>클러스터 구성, Quorum Queue 사용</td><td>최소 3노드 클러스터 권장</td></tr><tr><td><strong>데이터</strong></td><td>메시지 손실</td><td>높음</td><td>Publisher Confirms, Consumer ACK</td><td>중요 데이터는 Durable Queue 사용</td></tr><tr><td><strong>모니터링</strong></td><td>장애 감지 지연</td><td>중간</td><td>실시간 알람, Health Check</td><td>1분 이내 장애 감지 체계 구축</td></tr><tr><td><strong>확장성</strong></td><td>큐별 병목</td><td>중간</td><td>Queue Sharding, 워크로드 분산</td><td>큐당 처리량 10K msg/sec 미만</td></tr></tbody></table><h4 id=성능-최적화-체크리스트>성능 최적화 체크리스트<a hidden class=anchor aria-hidden=true href=#성능-최적화-체크리스트>#</a></h4><p><strong>메시지 처리 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1> 1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2> 2</a>
</span><span class=lnt id=hl-52-3><a class=lnlinks href=#hl-52-3> 3</a>
</span><span class=lnt id=hl-52-4><a class=lnlinks href=#hl-52-4> 4</a>
</span><span class=lnt id=hl-52-5><a class=lnlinks href=#hl-52-5> 5</a>
</span><span class=lnt id=hl-52-6><a class=lnlinks href=#hl-52-6> 6</a>
</span><span class=lnt id=hl-52-7><a class=lnlinks href=#hl-52-7> 7</a>
</span><span class=lnt id=hl-52-8><a class=lnlinks href=#hl-52-8> 8</a>
</span><span class=lnt id=hl-52-9><a class=lnlinks href=#hl-52-9> 9</a>
</span><span class=lnt id=hl-52-10><a class=lnlinks href=#hl-52-10>10</a>
</span><span class=lnt id=hl-52-11><a class=lnlinks href=#hl-52-11>11</a>
</span><span class=lnt id=hl-52-12><a class=lnlinks href=#hl-52-12>12</a>
</span><span class=lnt id=hl-52-13><a class=lnlinks href=#hl-52-13>13</a>
</span><span class=lnt id=hl-52-14><a class=lnlinks href=#hl-52-14>14</a>
</span><span class=lnt id=hl-52-15><a class=lnlinks href=#hl-52-15>15</a>
</span><span class=lnt id=hl-52-16><a class=lnlinks href=#hl-52-16>16</a>
</span><span class=lnt id=hl-52-17><a class=lnlinks href=#hl-52-17>17</a>
</span><span class=lnt id=hl-52-18><a class=lnlinks href=#hl-52-18>18</a>
</span><span class=lnt id=hl-52-19><a class=lnlinks href=#hl-52-19>19</a>
</span><span class=lnt id=hl-52-20><a class=lnlinks href=#hl-52-20>20</a>
</span><span class=lnt id=hl-52-21><a class=lnlinks href=#hl-52-21>21</a>
</span><span class=lnt id=hl-52-22><a class=lnlinks href=#hl-52-22>22</a>
</span><span class=lnt id=hl-52-23><a class=lnlinks href=#hl-52-23>23</a>
</span><span class=lnt id=hl-52-24><a class=lnlinks href=#hl-52-24>24</a>
</span><span class=lnt id=hl-52-25><a class=lnlinks href=#hl-52-25>25</a>
</span><span class=lnt id=hl-52-26><a class=lnlinks href=#hl-52-26>26</a>
</span><span class=lnt id=hl-52-27><a class=lnlinks href=#hl-52-27>27</a>
</span><span class=lnt id=hl-52-28><a class=lnlinks href=#hl-52-28>28</a>
</span><span class=lnt id=hl-52-29><a class=lnlinks href=#hl-52-29>29</a>
</span><span class=lnt id=hl-52-30><a class=lnlinks href=#hl-52-30>30</a>
</span><span class=lnt id=hl-52-31><a class=lnlinks href=#hl-52-31>31</a>
</span><span class=lnt id=hl-52-32><a class=lnlinks href=#hl-52-32>32</a>
</span><span class=lnt id=hl-52-33><a class=lnlinks href=#hl-52-33>33</a>
</span><span class=lnt id=hl-52-34><a class=lnlinks href=#hl-52-34>34</a>
</span><span class=lnt id=hl-52-35><a class=lnlinks href=#hl-52-35>35</a>
</span><span class=lnt id=hl-52-36><a class=lnlinks href=#hl-52-36>36</a>
</span><span class=lnt id=hl-52-37><a class=lnlinks href=#hl-52-37>37</a>
</span><span class=lnt id=hl-52-38><a class=lnlinks href=#hl-52-38>38</a>
</span><span class=lnt id=hl-52-39><a class=lnlinks href=#hl-52-39>39</a>
</span><span class=lnt id=hl-52-40><a class=lnlinks href=#hl-52-40>40</a>
</span><span class=lnt id=hl-52-41><a class=lnlinks href=#hl-52-41>41</a>
</span><span class=lnt id=hl-52-42><a class=lnlinks href=#hl-52-42>42</a>
</span><span class=lnt id=hl-52-43><a class=lnlinks href=#hl-52-43>43</a>
</span><span class=lnt id=hl-52-44><a class=lnlinks href=#hl-52-44>44</a>
</span><span class=lnt id=hl-52-45><a class=lnlinks href=#hl-52-45>45</a>
</span><span class=lnt id=hl-52-46><a class=lnlinks href=#hl-52-46>46</a>
</span><span class=lnt id=hl-52-47><a class=lnlinks href=#hl-52-47>47</a>
</span><span class=lnt id=hl-52-48><a class=lnlinks href=#hl-52-48>48</a>
</span><span class=lnt id=hl-52-49><a class=lnlinks href=#hl-52-49>49</a>
</span><span class=lnt id=hl-52-50><a class=lnlinks href=#hl-52-50>50</a>
</span><span class=lnt id=hl-52-51><a class=lnlinks href=#hl-52-51>51</a>
</span><span class=lnt id=hl-52-52><a class=lnlinks href=#hl-52-52>52</a>
</span><span class=lnt id=hl-52-53><a class=lnlinks href=#hl-52-53>53</a>
</span><span class=lnt id=hl-52-54><a class=lnlinks href=#hl-52-54>54</a>
</span><span class=lnt id=hl-52-55><a class=lnlinks href=#hl-52-55>55</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 배치 처리 최적화 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OptimizedConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_size</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_flush</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>flush_interval</span> <span class=o>=</span> <span class=mi>5</span>  <span class=c1># 5초마다 강제 플러시</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        배치 처리를 통한 성능 최적화
</span></span></span><span class=line><span class=cl><span class=s2>        - 메시지를 배치로 누적 후 일괄 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - 처리량 대비 지연시간 트레이드오프 조절
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;delivery_tag&#39;</span><span class=p>:</span> <span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;properties&#39;</span><span class=p>:</span> <span class=n>properties</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배치 크기 또는 시간 조건 충족 시 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>should_flush</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_size</span> <span class=ow>or</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_flush</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>flush_interval</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>should_flush</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_flush_batch</span><span class=p>(</span><span class=n>ch</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_flush_batch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>channel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 메시지 일괄 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 비즈니스 로직 배치 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_message_batch</span><span class=p>([</span><span class=n>msg</span><span class=p>[</span><span class=s1>&#39;body&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 배치 ACK (성능 향상)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>channel</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;delivery_tag&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>last_flush</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 배치 처리 실패 시 개별 NACK</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>channel</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_tag</span><span class=o>=</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;delivery_tag&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                    <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>message_batch</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>연결 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1> 1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2> 2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3> 3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4> 4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5> 5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6> 6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7> 7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8> 8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9> 9</a>
</span><span class=lnt id=hl-53-10><a class=lnlinks href=#hl-53-10>10</a>
</span><span class=lnt id=hl-53-11><a class=lnlinks href=#hl-53-11>11</a>
</span><span class=lnt id=hl-53-12><a class=lnlinks href=#hl-53-12>12</a>
</span><span class=lnt id=hl-53-13><a class=lnlinks href=#hl-53-13>13</a>
</span><span class=lnt id=hl-53-14><a class=lnlinks href=#hl-53-14>14</a>
</span><span class=lnt id=hl-53-15><a class=lnlinks href=#hl-53-15>15</a>
</span><span class=lnt id=hl-53-16><a class=lnlinks href=#hl-53-16>16</a>
</span><span class=lnt id=hl-53-17><a class=lnlinks href=#hl-53-17>17</a>
</span><span class=lnt id=hl-53-18><a class=lnlinks href=#hl-53-18>18</a>
</span><span class=lnt id=hl-53-19><a class=lnlinks href=#hl-53-19>19</a>
</span><span class=lnt id=hl-53-20><a class=lnlinks href=#hl-53-20>20</a>
</span><span class=lnt id=hl-53-21><a class=lnlinks href=#hl-53-21>21</a>
</span><span class=lnt id=hl-53-22><a class=lnlinks href=#hl-53-22>22</a>
</span><span class=lnt id=hl-53-23><a class=lnlinks href=#hl-53-23>23</a>
</span><span class=lnt id=hl-53-24><a class=lnlinks href=#hl-53-24>24</a>
</span><span class=lnt id=hl-53-25><a class=lnlinks href=#hl-53-25>25</a>
</span><span class=lnt id=hl-53-26><a class=lnlinks href=#hl-53-26>26</a>
</span><span class=lnt id=hl-53-27><a class=lnlinks href=#hl-53-27>27</a>
</span><span class=lnt id=hl-53-28><a class=lnlinks href=#hl-53-28>28</a>
</span><span class=lnt id=hl-53-29><a class=lnlinks href=#hl-53-29>29</a>
</span><span class=lnt id=hl-53-30><a class=lnlinks href=#hl-53-30>30</a>
</span><span class=lnt id=hl-53-31><a class=lnlinks href=#hl-53-31>31</a>
</span><span class=lnt id=hl-53-32><a class=lnlinks href=#hl-53-32>32</a>
</span><span class=lnt id=hl-53-33><a class=lnlinks href=#hl-53-33>33</a>
</span><span class=lnt id=hl-53-34><a class=lnlinks href=#hl-53-34>34</a>
</span><span class=lnt id=hl-53-35><a class=lnlinks href=#hl-53-35>35</a>
</span><span class=lnt id=hl-53-36><a class=lnlinks href=#hl-53-36>36</a>
</span><span class=lnt id=hl-53-37><a class=lnlinks href=#hl-53-37>37</a>
</span><span class=lnt id=hl-53-38><a class=lnlinks href=#hl-53-38>38</a>
</span><span class=lnt id=hl-53-39><a class=lnlinks href=#hl-53-39>39</a>
</span><span class=lnt id=hl-53-40><a class=lnlinks href=#hl-53-40>40</a>
</span><span class=lnt id=hl-53-41><a class=lnlinks href=#hl-53-41>41</a>
</span><span class=lnt id=hl-53-42><a class=lnlinks href=#hl-53-42>42</a>
</span><span class=lnt id=hl-53-43><a class=lnlinks href=#hl-53-43>43</a>
</span><span class=lnt id=hl-53-44><a class=lnlinks href=#hl-53-44>44</a>
</span><span class=lnt id=hl-53-45><a class=lnlinks href=#hl-53-45>45</a>
</span><span class=lnt id=hl-53-46><a class=lnlinks href=#hl-53-46>46</a>
</span><span class=lnt id=hl-53-47><a class=lnlinks href=#hl-53-47>47</a>
</span><span class=lnt id=hl-53-48><a class=lnlinks href=#hl-53-48>48</a>
</span><span class=lnt id=hl-53-49><a class=lnlinks href=#hl-53-49>49</a>
</span><span class=lnt id=hl-53-50><a class=lnlinks href=#hl-53-50>50</a>
</span><span class=lnt id=hl-53-51><a class=lnlinks href=#hl-53-51>51</a>
</span><span class=lnt id=hl-53-52><a class=lnlinks href=#hl-53-52>52</a>
</span><span class=lnt id=hl-53-53><a class=lnlinks href=#hl-53-53>53</a>
</span><span class=lnt id=hl-53-54><a class=lnlinks href=#hl-53-54>54</a>
</span><span class=lnt id=hl-53-55><a class=lnlinks href=#hl-53-55>55</a>
</span><span class=lnt id=hl-53-56><a class=lnlinks href=#hl-53-56>56</a>
</span><span class=lnt id=hl-53-57><a class=lnlinks href=#hl-53-57>57</a>
</span><span class=lnt id=hl-53-58><a class=lnlinks href=#hl-53-58>58</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 연결 풀링 최적화</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ConnectionPool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 연결 풀 관리
</span></span></span><span class=line><span class=cl><span class=s2>    - 연결 재사용을 통한 오버헤드 감소
</span></span></span><span class=line><span class=cl><span class=s2>    - 스레드 안전성 보장
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_connections</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span> <span class=o>=</span> <span class=n>max_connections</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=n>max_connections</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 초기 연결 풀 생성</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_connections</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>host</span><span class=o>=</span><span class=s1>&#39;rabbitmq-cluster&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>heartbeat</span><span class=o>=</span><span class=mi>600</span><span class=p>,</span>          <span class=c1># 하트비트 간격 조정</span>
</span></span><span class=line><span class=cl>                    <span class=n>blocked_connection_timeout</span><span class=o>=</span><span class=mi>300</span>  <span class=c1># 블로킹 타임아웃</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;연결 풀에서 연결 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>return_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;연결 풀에 연결 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>connection</span> <span class=ow>and</span> <span class=n>connection</span><span class=o>.</span><span class=n>is_open</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 끊어진 연결은 새로 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>new_connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;rabbitmq-cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection_pool</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>new_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>pool</span> <span class=o>=</span> <span class=n>ConnectionPool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_message_optimized</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pool</span><span class=o>.</span><span class=n>get_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>message</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pool</span><span class=o>.</span><span class=n>return_connection</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=64-성능-최적화-전략-및-고려사항>6.4 성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항>#</a></h3><blockquote><p>이 표는 RabbitMQ 성능 최적화 전략과 구체적인 적용 방법을 체계적으로 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>최적화 영역</th><th>전략</th><th>구현 방법</th><th>성능 향상</th><th>권장 설정</th></tr></thead><tbody><tr><td><strong>큐 설계</strong></td><td>Lazy Queue 사용</td><td><code>x-queue-mode: lazy</code></td><td>메모리 사용량 70% 감소</td><td>메시지 크기 > 1KB 시 적용</td></tr><tr><td><strong>배치 처리</strong></td><td>Publisher Batching</td><td><code>basic_publish_batch()</code></td><td>처리량 3-5배 증가</td><td>배치 크기 100-1000개</td></tr><tr><td><strong>연결 관리</strong></td><td>Connection Pooling</td><td>연결 재사용</td><td>연결 오버헤드 90% 감소</td><td>풀 크기 10-50개</td></tr><tr><td><strong>채널 최적화</strong></td><td>Channel 재사용</td><td>채널별 수명 연장</td><td>채널 생성 비용 절약</td><td>연결당 10-20개 채널</td></tr><tr><td><strong>Flow Control</strong></td><td>QoS 튜닝</td><td><code>prefetch_count</code> 조정</td><td>메모리 안정성 확보</td><td>Consumer당 10-100개</td></tr><tr><td><strong>클러스터링</strong></td><td>워크로드 분산</td><td>Queue Sharding</td><td>병렬 처리 향상</td><td>CPU 코어수만큼 큐 생성</td></tr><tr><td><strong>네트워크</strong></td><td>압축 활용</td><td>Content-Encoding</td><td>대역폭 50% 절약</td><td>메시지 크기 > 10KB 시</td></tr><tr><td><strong>디스크 I/O</strong></td><td>SSD 사용</td><td>고속 스토리지</td><td>지연시간 80% 감소</td><td>NVMe SSD 권장</td></tr></tbody></table><h4 id=클러스터-최적화-전략>클러스터 최적화 전략<a hidden class=anchor aria-hidden=true href=#클러스터-최적화-전략>#</a></h4><p><strong>1. 노드 배치 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1> 1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2> 2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3> 3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4> 4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5> 5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6> 6</a>
</span><span class=lnt id=hl-54-7><a class=lnlinks href=#hl-54-7> 7</a>
</span><span class=lnt id=hl-54-8><a class=lnlinks href=#hl-54-8> 8</a>
</span><span class=lnt id=hl-54-9><a class=lnlinks href=#hl-54-9> 9</a>
</span><span class=lnt id=hl-54-10><a class=lnlinks href=#hl-54-10>10</a>
</span><span class=lnt id=hl-54-11><a class=lnlinks href=#hl-54-11>11</a>
</span><span class=lnt id=hl-54-12><a class=lnlinks href=#hl-54-12>12</a>
</span><span class=lnt id=hl-54-13><a class=lnlinks href=#hl-54-13>13</a>
</span><span class=lnt id=hl-54-14><a class=lnlinks href=#hl-54-14>14</a>
</span><span class=lnt id=hl-54-15><a class=lnlinks href=#hl-54-15>15</a>
</span><span class=lnt id=hl-54-16><a class=lnlinks href=#hl-54-16>16</a>
</span><span class=lnt id=hl-54-17><a class=lnlinks href=#hl-54-17>17</a>
</span><span class=lnt id=hl-54-18><a class=lnlinks href=#hl-54-18>18</a>
</span><span class=lnt id=hl-54-19><a class=lnlinks href=#hl-54-19>19</a>
</span><span class=lnt id=hl-54-20><a class=lnlinks href=#hl-54-20>20</a>
</span><span class=lnt id=hl-54-21><a class=lnlinks href=#hl-54-21>21</a>
</span><span class=lnt id=hl-54-22><a class=lnlinks href=#hl-54-22>22</a>
</span><span class=lnt id=hl-54-23><a class=lnlinks href=#hl-54-23>23</a>
</span><span class=lnt id=hl-54-24><a class=lnlinks href=#hl-54-24>24</a>
</span><span class=lnt id=hl-54-25><a class=lnlinks href=#hl-54-25>25</a>
</span><span class=lnt id=hl-54-26><a class=lnlinks href=#hl-54-26>26</a>
</span><span class=lnt id=hl-54-27><a class=lnlinks href=#hl-54-27>27</a>
</span><span class=lnt id=hl-54-28><a class=lnlinks href=#hl-54-28>28</a>
</span><span class=lnt id=hl-54-29><a class=lnlinks href=#hl-54-29>29</a>
</span><span class=lnt id=hl-54-30><a class=lnlinks href=#hl-54-30>30</a>
</span><span class=lnt id=hl-54-31><a class=lnlinks href=#hl-54-31>31</a>
</span><span class=lnt id=hl-54-32><a class=lnlinks href=#hl-54-32>32</a>
</span><span class=lnt id=hl-54-33><a class=lnlinks href=#hl-54-33>33</a>
</span><span class=lnt id=hl-54-34><a class=lnlinks href=#hl-54-34>34</a>
</span><span class=lnt id=hl-54-35><a class=lnlinks href=#hl-54-35>35</a>
</span><span class=lnt id=hl-54-36><a class=lnlinks href=#hl-54-36>36</a>
</span><span class=lnt id=hl-54-37><a class=lnlinks href=#hl-54-37>37</a>
</span><span class=lnt id=hl-54-38><a class=lnlinks href=#hl-54-38>38</a>
</span><span class=lnt id=hl-54-39><a class=lnlinks href=#hl-54-39>39</a>
</span><span class=lnt id=hl-54-40><a class=lnlinks href=#hl-54-40>40</a>
</span><span class=lnt id=hl-54-41><a class=lnlinks href=#hl-54-41>41</a>
</span><span class=lnt id=hl-54-42><a class=lnlinks href=#hl-54-42>42</a>
</span><span class=lnt id=hl-54-43><a class=lnlinks href=#hl-54-43>43</a>
</span><span class=lnt id=hl-54-44><a class=lnlinks href=#hl-54-44>44</a>
</span><span class=lnt id=hl-54-45><a class=lnlinks href=#hl-54-45>45</a>
</span><span class=lnt id=hl-54-46><a class=lnlinks href=#hl-54-46>46</a>
</span><span class=lnt id=hl-54-47><a class=lnlinks href=#hl-54-47>47</a>
</span><span class=lnt id=hl-54-48><a class=lnlinks href=#hl-54-48>48</a>
</span><span class=lnt id=hl-54-49><a class=lnlinks href=#hl-54-49>49</a>
</span><span class=lnt id=hl-54-50><a class=lnlinks href=#hl-54-50>50</a>
</span><span class=lnt id=hl-54-51><a class=lnlinks href=#hl-54-51>51</a>
</span><span class=lnt id=hl-54-52><a class=lnlinks href=#hl-54-52>52</a>
</span><span class=lnt id=hl-54-53><a class=lnlinks href=#hl-54-53>53</a>
</span><span class=lnt id=hl-54-54><a class=lnlinks href=#hl-54-54>54</a>
</span><span class=lnt id=hl-54-55><a class=lnlinks href=#hl-54-55>55</a>
</span><span class=lnt id=hl-54-56><a class=lnlinks href=#hl-54-56>56</a>
</span><span class=lnt id=hl-54-57><a class=lnlinks href=#hl-54-57>57</a>
</span><span class=lnt id=hl-54-58><a class=lnlinks href=#hl-54-58>58</a>
</span><span class=lnt id=hl-54-59><a class=lnlinks href=#hl-54-59>59</a>
</span><span class=lnt id=hl-54-60><a class=lnlinks href=#hl-54-60>60</a>
</span><span class=lnt id=hl-54-61><a class=lnlinks href=#hl-54-61>61</a>
</span><span class=lnt id=hl-54-62><a class=lnlinks href=#hl-54-62>62</a>
</span><span class=lnt id=hl-54-63><a class=lnlinks href=#hl-54-63>63</a>
</span><span class=lnt id=hl-54-64><a class=lnlinks href=#hl-54-64>64</a>
</span><span class=lnt id=hl-54-65><a class=lnlinks href=#hl-54-65>65</a>
</span><span class=lnt id=hl-54-66><a class=lnlinks href=#hl-54-66>66</a>
</span><span class=lnt id=hl-54-67><a class=lnlinks href=#hl-54-67>67</a>
</span><span class=lnt id=hl-54-68><a class=lnlinks href=#hl-54-68>68</a>
</span><span class=lnt id=hl-54-69><a class=lnlinks href=#hl-54-69>69</a>
</span><span class=lnt id=hl-54-70><a class=lnlinks href=#hl-54-70>70</a>
</span><span class=lnt id=hl-54-71><a class=lnlinks href=#hl-54-71>71</a>
</span><span class=lnt id=hl-54-72><a class=lnlinks href=#hl-54-72>72</a>
</span><span class=lnt id=hl-54-73><a class=lnlinks href=#hl-54-73>73</a>
</span><span class=lnt id=hl-54-74><a class=lnlinks href=#hl-54-74>74</a>
</span><span class=lnt id=hl-54-75><a class=lnlinks href=#hl-54-75>75</a>
</span><span class=lnt id=hl-54-76><a class=lnlinks href=#hl-54-76>76</a>
</span><span class=lnt id=hl-54-77><a class=lnlinks href=#hl-54-77>77</a>
</span><span class=lnt id=hl-54-78><a class=lnlinks href=#hl-54-78>78</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 3-노드 클러스터 최적 구성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-cluster-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled_plugins</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    [rabbitmq_management,
</span></span></span><span class=line><span class=cl><span class=sd>     rabbitmq_prometheus,
</span></span></span><span class=line><span class=cl><span class=sd>     rabbitmq_peer_discovery_k8s].</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 클러스터 파티션 처리 전략
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_partition_handling = pause_minority
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 네트워크 파티션 복구
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_keepalive_interval = 10000
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # Quorum Queue 기본값 설정
</span></span></span><span class=line><span class=cl><span class=sd>    default_queue_type = quorum
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 메모리 최적화
</span></span></span><span class=line><span class=cl><span class=sd>    vm_memory_high_watermark.relative = 0.6
</span></span></span><span class=line><span class=cl><span class=sd>    vm_memory_high_watermark_paging_ratio = 0.8
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 디스크 공간 관리
</span></span></span><span class=line><span class=cl><span class=sd>    disk_free_limit.relative = 0.2
</span></span></span><span class=line><span class=cl><span class=sd>    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 노드 분산 배치 (가용영역별)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes.io/zone</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq:4-management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2Gi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1000m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Gi&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2000m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># JVM/Erlang 튜닝</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;+S 4:2 +stbt db +zdbbl 128000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumeClaimTemplates</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>accessModes</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;fast-ssd&#34;</span><span class=w>  </span><span class=c># 고성능 SSD 스토리지</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>100Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>2. 큐 샤딩 전략</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1>  1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2>  2</a>
</span><span class=lnt id=hl-55-3><a class=lnlinks href=#hl-55-3>  3</a>
</span><span class=lnt id=hl-55-4><a class=lnlinks href=#hl-55-4>  4</a>
</span><span class=lnt id=hl-55-5><a class=lnlinks href=#hl-55-5>  5</a>
</span><span class=lnt id=hl-55-6><a class=lnlinks href=#hl-55-6>  6</a>
</span><span class=lnt id=hl-55-7><a class=lnlinks href=#hl-55-7>  7</a>
</span><span class=lnt id=hl-55-8><a class=lnlinks href=#hl-55-8>  8</a>
</span><span class=lnt id=hl-55-9><a class=lnlinks href=#hl-55-9>  9</a>
</span><span class=lnt id=hl-55-10><a class=lnlinks href=#hl-55-10> 10</a>
</span><span class=lnt id=hl-55-11><a class=lnlinks href=#hl-55-11> 11</a>
</span><span class=lnt id=hl-55-12><a class=lnlinks href=#hl-55-12> 12</a>
</span><span class=lnt id=hl-55-13><a class=lnlinks href=#hl-55-13> 13</a>
</span><span class=lnt id=hl-55-14><a class=lnlinks href=#hl-55-14> 14</a>
</span><span class=lnt id=hl-55-15><a class=lnlinks href=#hl-55-15> 15</a>
</span><span class=lnt id=hl-55-16><a class=lnlinks href=#hl-55-16> 16</a>
</span><span class=lnt id=hl-55-17><a class=lnlinks href=#hl-55-17> 17</a>
</span><span class=lnt id=hl-55-18><a class=lnlinks href=#hl-55-18> 18</a>
</span><span class=lnt id=hl-55-19><a class=lnlinks href=#hl-55-19> 19</a>
</span><span class=lnt id=hl-55-20><a class=lnlinks href=#hl-55-20> 20</a>
</span><span class=lnt id=hl-55-21><a class=lnlinks href=#hl-55-21> 21</a>
</span><span class=lnt id=hl-55-22><a class=lnlinks href=#hl-55-22> 22</a>
</span><span class=lnt id=hl-55-23><a class=lnlinks href=#hl-55-23> 23</a>
</span><span class=lnt id=hl-55-24><a class=lnlinks href=#hl-55-24> 24</a>
</span><span class=lnt id=hl-55-25><a class=lnlinks href=#hl-55-25> 25</a>
</span><span class=lnt id=hl-55-26><a class=lnlinks href=#hl-55-26> 26</a>
</span><span class=lnt id=hl-55-27><a class=lnlinks href=#hl-55-27> 27</a>
</span><span class=lnt id=hl-55-28><a class=lnlinks href=#hl-55-28> 28</a>
</span><span class=lnt id=hl-55-29><a class=lnlinks href=#hl-55-29> 29</a>
</span><span class=lnt id=hl-55-30><a class=lnlinks href=#hl-55-30> 30</a>
</span><span class=lnt id=hl-55-31><a class=lnlinks href=#hl-55-31> 31</a>
</span><span class=lnt id=hl-55-32><a class=lnlinks href=#hl-55-32> 32</a>
</span><span class=lnt id=hl-55-33><a class=lnlinks href=#hl-55-33> 33</a>
</span><span class=lnt id=hl-55-34><a class=lnlinks href=#hl-55-34> 34</a>
</span><span class=lnt id=hl-55-35><a class=lnlinks href=#hl-55-35> 35</a>
</span><span class=lnt id=hl-55-36><a class=lnlinks href=#hl-55-36> 36</a>
</span><span class=lnt id=hl-55-37><a class=lnlinks href=#hl-55-37> 37</a>
</span><span class=lnt id=hl-55-38><a class=lnlinks href=#hl-55-38> 38</a>
</span><span class=lnt id=hl-55-39><a class=lnlinks href=#hl-55-39> 39</a>
</span><span class=lnt id=hl-55-40><a class=lnlinks href=#hl-55-40> 40</a>
</span><span class=lnt id=hl-55-41><a class=lnlinks href=#hl-55-41> 41</a>
</span><span class=lnt id=hl-55-42><a class=lnlinks href=#hl-55-42> 42</a>
</span><span class=lnt id=hl-55-43><a class=lnlinks href=#hl-55-43> 43</a>
</span><span class=lnt id=hl-55-44><a class=lnlinks href=#hl-55-44> 44</a>
</span><span class=lnt id=hl-55-45><a class=lnlinks href=#hl-55-45> 45</a>
</span><span class=lnt id=hl-55-46><a class=lnlinks href=#hl-55-46> 46</a>
</span><span class=lnt id=hl-55-47><a class=lnlinks href=#hl-55-47> 47</a>
</span><span class=lnt id=hl-55-48><a class=lnlinks href=#hl-55-48> 48</a>
</span><span class=lnt id=hl-55-49><a class=lnlinks href=#hl-55-49> 49</a>
</span><span class=lnt id=hl-55-50><a class=lnlinks href=#hl-55-50> 50</a>
</span><span class=lnt id=hl-55-51><a class=lnlinks href=#hl-55-51> 51</a>
</span><span class=lnt id=hl-55-52><a class=lnlinks href=#hl-55-52> 52</a>
</span><span class=lnt id=hl-55-53><a class=lnlinks href=#hl-55-53> 53</a>
</span><span class=lnt id=hl-55-54><a class=lnlinks href=#hl-55-54> 54</a>
</span><span class=lnt id=hl-55-55><a class=lnlinks href=#hl-55-55> 55</a>
</span><span class=lnt id=hl-55-56><a class=lnlinks href=#hl-55-56> 56</a>
</span><span class=lnt id=hl-55-57><a class=lnlinks href=#hl-55-57> 57</a>
</span><span class=lnt id=hl-55-58><a class=lnlinks href=#hl-55-58> 58</a>
</span><span class=lnt id=hl-55-59><a class=lnlinks href=#hl-55-59> 59</a>
</span><span class=lnt id=hl-55-60><a class=lnlinks href=#hl-55-60> 60</a>
</span><span class=lnt id=hl-55-61><a class=lnlinks href=#hl-55-61> 61</a>
</span><span class=lnt id=hl-55-62><a class=lnlinks href=#hl-55-62> 62</a>
</span><span class=lnt id=hl-55-63><a class=lnlinks href=#hl-55-63> 63</a>
</span><span class=lnt id=hl-55-64><a class=lnlinks href=#hl-55-64> 64</a>
</span><span class=lnt id=hl-55-65><a class=lnlinks href=#hl-55-65> 65</a>
</span><span class=lnt id=hl-55-66><a class=lnlinks href=#hl-55-66> 66</a>
</span><span class=lnt id=hl-55-67><a class=lnlinks href=#hl-55-67> 67</a>
</span><span class=lnt id=hl-55-68><a class=lnlinks href=#hl-55-68> 68</a>
</span><span class=lnt id=hl-55-69><a class=lnlinks href=#hl-55-69> 69</a>
</span><span class=lnt id=hl-55-70><a class=lnlinks href=#hl-55-70> 70</a>
</span><span class=lnt id=hl-55-71><a class=lnlinks href=#hl-55-71> 71</a>
</span><span class=lnt id=hl-55-72><a class=lnlinks href=#hl-55-72> 72</a>
</span><span class=lnt id=hl-55-73><a class=lnlinks href=#hl-55-73> 73</a>
</span><span class=lnt id=hl-55-74><a class=lnlinks href=#hl-55-74> 74</a>
</span><span class=lnt id=hl-55-75><a class=lnlinks href=#hl-55-75> 75</a>
</span><span class=lnt id=hl-55-76><a class=lnlinks href=#hl-55-76> 76</a>
</span><span class=lnt id=hl-55-77><a class=lnlinks href=#hl-55-77> 77</a>
</span><span class=lnt id=hl-55-78><a class=lnlinks href=#hl-55-78> 78</a>
</span><span class=lnt id=hl-55-79><a class=lnlinks href=#hl-55-79> 79</a>
</span><span class=lnt id=hl-55-80><a class=lnlinks href=#hl-55-80> 80</a>
</span><span class=lnt id=hl-55-81><a class=lnlinks href=#hl-55-81> 81</a>
</span><span class=lnt id=hl-55-82><a class=lnlinks href=#hl-55-82> 82</a>
</span><span class=lnt id=hl-55-83><a class=lnlinks href=#hl-55-83> 83</a>
</span><span class=lnt id=hl-55-84><a class=lnlinks href=#hl-55-84> 84</a>
</span><span class=lnt id=hl-55-85><a class=lnlinks href=#hl-55-85> 85</a>
</span><span class=lnt id=hl-55-86><a class=lnlinks href=#hl-55-86> 86</a>
</span><span class=lnt id=hl-55-87><a class=lnlinks href=#hl-55-87> 87</a>
</span><span class=lnt id=hl-55-88><a class=lnlinks href=#hl-55-88> 88</a>
</span><span class=lnt id=hl-55-89><a class=lnlinks href=#hl-55-89> 89</a>
</span><span class=lnt id=hl-55-90><a class=lnlinks href=#hl-55-90> 90</a>
</span><span class=lnt id=hl-55-91><a class=lnlinks href=#hl-55-91> 91</a>
</span><span class=lnt id=hl-55-92><a class=lnlinks href=#hl-55-92> 92</a>
</span><span class=lnt id=hl-55-93><a class=lnlinks href=#hl-55-93> 93</a>
</span><span class=lnt id=hl-55-94><a class=lnlinks href=#hl-55-94> 94</a>
</span><span class=lnt id=hl-55-95><a class=lnlinks href=#hl-55-95> 95</a>
</span><span class=lnt id=hl-55-96><a class=lnlinks href=#hl-55-96> 96</a>
</span><span class=lnt id=hl-55-97><a class=lnlinks href=#hl-55-97> 97</a>
</span><span class=lnt id=hl-55-98><a class=lnlinks href=#hl-55-98> 98</a>
</span><span class=lnt id=hl-55-99><a class=lnlinks href=#hl-55-99> 99</a>
</span><span class=lnt id=hl-55-100><a class=lnlinks href=#hl-55-100>100</a>
</span><span class=lnt id=hl-55-101><a class=lnlinks href=#hl-55-101>101</a>
</span><span class=lnt id=hl-55-102><a class=lnlinks href=#hl-55-102>102</a>
</span><span class=lnt id=hl-55-103><a class=lnlinks href=#hl-55-103>103</a>
</span><span class=lnt id=hl-55-104><a class=lnlinks href=#hl-55-104>104</a>
</span><span class=lnt id=hl-55-105><a class=lnlinks href=#hl-55-105>105</a>
</span><span class=lnt id=hl-55-106><a class=lnlinks href=#hl-55-106>106</a>
</span><span class=lnt id=hl-55-107><a class=lnlinks href=#hl-55-107>107</a>
</span><span class=lnt id=hl-55-108><a class=lnlinks href=#hl-55-108>108</a>
</span><span class=lnt id=hl-55-109><a class=lnlinks href=#hl-55-109>109</a>
</span><span class=lnt id=hl-55-110><a class=lnlinks href=#hl-55-110>110</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 자동 큐 샤딩 구현</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ShardedQueueManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    큐 샤딩을 통한 수평적 확장
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 키 기반 일관된 해싱
</span></span></span><span class=line><span class=cl><span class=s2>    - 로드 밸런싱 및 병렬 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shard_count</span><span class=o>=</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shard_count</span> <span class=o>=</span> <span class=n>shard_count</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connections</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 샤드별 연결 생성</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>shard_id</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>shard_count</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connections</span><span class=p>[</span><span class=n>shard_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;rabbitmq-cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_shard_id</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;라우팅 키 기반 샤드 ID 계산&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>routing_key</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>hash_value</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>shard_count</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_to_shard</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        샤드별 메시지 발행
</span></span></span><span class=line><span class=cl><span class=s2>        - 동일한 키는 항상 같은 샤드로 라우팅
</span></span></span><span class=line><span class=cl><span class=s2>        - 순서 보장 및 부하 분산 효과
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>shard_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_shard_id</span><span class=p>(</span><span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>queue_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;orders_shard_</span><span class=si>{</span><span class=n>shard_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>connection</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connections</span><span class=p>[</span><span class=n>shard_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 샤드별 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>arguments</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;x-queue-type&#39;</span><span class=p>:</span> <span class=s1>&#39;quorum&#39;</span><span class=p>,</span>  <span class=c1># 고가용성</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;x-max-length&#39;</span><span class=p>:</span> <span class=mi>100000</span><span class=p>,</span>    <span class=c1># 큐 크기 제한</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;x-overflow&#39;</span><span class=p>:</span> <span class=s1>&#39;reject-publish&#39;</span>  <span class=c1># 초과시 거부</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;shard_id&#39;</span><span class=p>:</span> <span class=n>shard_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_shard_consumers</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>consumer_count_per_shard</span><span class=o>=</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;샤드별 컨슈머 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>shard_id</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shard_count</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>consumer_id</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>consumer_count_per_shard</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_start_consumer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>shard_id</span><span class=p>,</span> <span class=n>consumer_id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>daemon</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_start_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shard_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>consumer_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;개별 샤드 컨슈머&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>connection</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connections</span><span class=p>[</span><span class=n>shard_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>queue_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;orders_shard_</span><span class=si>{</span><span class=n>shard_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># QoS 설정 (샤드별 최적화)</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Shard </span><span class=si>{</span><span class=n>shard_id</span><span class=si>}</span><span class=s2>, Consumer </span><span class=si>{</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>process_order_message</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># ACK</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>auto_ack</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Started consumer </span><span class=si>{</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2> for shard </span><span class=si>{</span><span class=n>shard_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>shard_manager</span> <span class=o>=</span> <span class=n>ShardedQueueManager</span><span class=p>(</span><span class=n>shard_count</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 ID 기반 샤딩으로 순서 보장</span>
</span></span><span class=line><span class=cl><span class=n>shard_manager</span><span class=o>.</span><span class=n>publish_to_shard</span><span class=p>(</span><span class=s2>&#34;order_12345&#34;</span><span class=p>,</span> <span class=s2>&#34;주문 생성&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>shard_manager</span><span class=o>.</span><span class=n>publish_to_shard</span><span class=p>(</span><span class=s2>&#34;order_12345&#34;</span><span class=p>,</span> <span class=s2>&#34;재고 확인&#34;</span><span class=p>)</span>  <span class=c1># 같은 샤드</span>
</span></span><span class=line><span class=cl><span class=n>shard_manager</span><span class=o>.</span><span class=n>publish_to_shard</span><span class=p>(</span><span class=s2>&#34;order_67890&#34;</span><span class=p>,</span> <span class=s2>&#34;주문 생성&#34;</span><span class=p>)</span>  <span class=c1># 다른 샤드</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 샤드별 컨슈머 시작</span>
</span></span><span class=line><span class=cl><span class=n>shard_manager</span><span class=o>.</span><span class=n>start_shard_consumers</span><span class=p>(</span><span class=n>consumer_count_per_shard</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>3. 메모리 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1> 1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2> 2</a>
</span><span class=lnt id=hl-56-3><a class=lnlinks href=#hl-56-3> 3</a>
</span><span class=lnt id=hl-56-4><a class=lnlinks href=#hl-56-4> 4</a>
</span><span class=lnt id=hl-56-5><a class=lnlinks href=#hl-56-5> 5</a>
</span><span class=lnt id=hl-56-6><a class=lnlinks href=#hl-56-6> 6</a>
</span><span class=lnt id=hl-56-7><a class=lnlinks href=#hl-56-7> 7</a>
</span><span class=lnt id=hl-56-8><a class=lnlinks href=#hl-56-8> 8</a>
</span><span class=lnt id=hl-56-9><a class=lnlinks href=#hl-56-9> 9</a>
</span><span class=lnt id=hl-56-10><a class=lnlinks href=#hl-56-10>10</a>
</span><span class=lnt id=hl-56-11><a class=lnlinks href=#hl-56-11>11</a>
</span><span class=lnt id=hl-56-12><a class=lnlinks href=#hl-56-12>12</a>
</span><span class=lnt id=hl-56-13><a class=lnlinks href=#hl-56-13>13</a>
</span><span class=lnt id=hl-56-14><a class=lnlinks href=#hl-56-14>14</a>
</span><span class=lnt id=hl-56-15><a class=lnlinks href=#hl-56-15>15</a>
</span><span class=lnt id=hl-56-16><a class=lnlinks href=#hl-56-16>16</a>
</span><span class=lnt id=hl-56-17><a class=lnlinks href=#hl-56-17>17</a>
</span><span class=lnt id=hl-56-18><a class=lnlinks href=#hl-56-18>18</a>
</span><span class=lnt id=hl-56-19><a class=lnlinks href=#hl-56-19>19</a>
</span><span class=lnt id=hl-56-20><a class=lnlinks href=#hl-56-20>20</a>
</span><span class=lnt id=hl-56-21><a class=lnlinks href=#hl-56-21>21</a>
</span><span class=lnt id=hl-56-22><a class=lnlinks href=#hl-56-22>22</a>
</span><span class=lnt id=hl-56-23><a class=lnlinks href=#hl-56-23>23</a>
</span><span class=lnt id=hl-56-24><a class=lnlinks href=#hl-56-24>24</a>
</span><span class=lnt id=hl-56-25><a class=lnlinks href=#hl-56-25>25</a>
</span><span class=lnt id=hl-56-26><a class=lnlinks href=#hl-56-26>26</a>
</span><span class=lnt id=hl-56-27><a class=lnlinks href=#hl-56-27>27</a>
</span><span class=lnt id=hl-56-28><a class=lnlinks href=#hl-56-28>28</a>
</span><span class=lnt id=hl-56-29><a class=lnlinks href=#hl-56-29>29</a>
</span><span class=lnt id=hl-56-30><a class=lnlinks href=#hl-56-30>30</a>
</span><span class=lnt id=hl-56-31><a class=lnlinks href=#hl-56-31>31</a>
</span><span class=lnt id=hl-56-32><a class=lnlinks href=#hl-56-32>32</a>
</span><span class=lnt id=hl-56-33><a class=lnlinks href=#hl-56-33>33</a>
</span><span class=lnt id=hl-56-34><a class=lnlinks href=#hl-56-34>34</a>
</span><span class=lnt id=hl-56-35><a class=lnlinks href=#hl-56-35>35</a>
</span><span class=lnt id=hl-56-36><a class=lnlinks href=#hl-56-36>36</a>
</span><span class=lnt id=hl-56-37><a class=lnlinks href=#hl-56-37>37</a>
</span><span class=lnt id=hl-56-38><a class=lnlinks href=#hl-56-38>38</a>
</span><span class=lnt id=hl-56-39><a class=lnlinks href=#hl-56-39>39</a>
</span><span class=lnt id=hl-56-40><a class=lnlinks href=#hl-56-40>40</a>
</span><span class=lnt id=hl-56-41><a class=lnlinks href=#hl-56-41>41</a>
</span><span class=lnt id=hl-56-42><a class=lnlinks href=#hl-56-42>42</a>
</span><span class=lnt id=hl-56-43><a class=lnlinks href=#hl-56-43>43</a>
</span><span class=lnt id=hl-56-44><a class=lnlinks href=#hl-56-44>44</a>
</span><span class=lnt id=hl-56-45><a class=lnlinks href=#hl-56-45>45</a>
</span><span class=lnt id=hl-56-46><a class=lnlinks href=#hl-56-46>46</a>
</span><span class=lnt id=hl-56-47><a class=lnlinks href=#hl-56-47>47</a>
</span><span class=lnt id=hl-56-48><a class=lnlinks href=#hl-56-48>48</a>
</span><span class=lnt id=hl-56-49><a class=lnlinks href=#hl-56-49>49</a>
</span><span class=lnt id=hl-56-50><a class=lnlinks href=#hl-56-50>50</a>
</span><span class=lnt id=hl-56-51><a class=lnlinks href=#hl-56-51>51</a>
</span><span class=lnt id=hl-56-52><a class=lnlinks href=#hl-56-52>52</a>
</span><span class=lnt id=hl-56-53><a class=lnlinks href=#hl-56-53>53</a>
</span><span class=lnt id=hl-56-54><a class=lnlinks href=#hl-56-54>54</a>
</span><span class=lnt id=hl-56-55><a class=lnlinks href=#hl-56-55>55</a>
</span><span class=lnt id=hl-56-56><a class=lnlinks href=#hl-56-56>56</a>
</span><span class=lnt id=hl-56-57><a class=lnlinks href=#hl-56-57>57</a>
</span><span class=lnt id=hl-56-58><a class=lnlinks href=#hl-56-58>58</a>
</span><span class=lnt id=hl-56-59><a class=lnlinks href=#hl-56-59>59</a>
</span><span class=lnt id=hl-56-60><a class=lnlinks href=#hl-56-60>60</a>
</span><span class=lnt id=hl-56-61><a class=lnlinks href=#hl-56-61>61</a>
</span><span class=lnt id=hl-56-62><a class=lnlinks href=#hl-56-62>62</a>
</span><span class=lnt id=hl-56-63><a class=lnlinks href=#hl-56-63>63</a>
</span><span class=lnt id=hl-56-64><a class=lnlinks href=#hl-56-64>64</a>
</span><span class=lnt id=hl-56-65><a class=lnlinks href=#hl-56-65>65</a>
</span><span class=lnt id=hl-56-66><a class=lnlinks href=#hl-56-66>66</a>
</span><span class=lnt id=hl-56-67><a class=lnlinks href=#hl-56-67>67</a>
</span><span class=lnt id=hl-56-68><a class=lnlinks href=#hl-56-68>68</a>
</span><span class=lnt id=hl-56-69><a class=lnlinks href=#hl-56-69>69</a>
</span><span class=lnt id=hl-56-70><a class=lnlinks href=#hl-56-70>70</a>
</span><span class=lnt id=hl-56-71><a class=lnlinks href=#hl-56-71>71</a>
</span><span class=lnt id=hl-56-72><a class=lnlinks href=#hl-56-72>72</a>
</span><span class=lnt id=hl-56-73><a class=lnlinks href=#hl-56-73>73</a>
</span><span class=lnt id=hl-56-74><a class=lnlinks href=#hl-56-74>74</a>
</span><span class=lnt id=hl-56-75><a class=lnlinks href=#hl-56-75>75</a>
</span><span class=lnt id=hl-56-76><a class=lnlinks href=#hl-56-76>76</a>
</span><span class=lnt id=hl-56-77><a class=lnlinks href=#hl-56-77>77</a>
</span><span class=lnt id=hl-56-78><a class=lnlinks href=#hl-56-78>78</a>
</span><span class=lnt id=hl-56-79><a class=lnlinks href=#hl-56-79>79</a>
</span><span class=lnt id=hl-56-80><a class=lnlinks href=#hl-56-80>80</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 메모리 효율적인 메시지 처리</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gc</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psutil</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MemoryOptimizedProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    메모리 사용량을 최적화한 메시지 처리기
</span></span></span><span class=line><span class=cl><span class=s2>    - 스트리밍 처리로 메모리 사용량 제한
</span></span></span><span class=line><span class=cl><span class=s2>    - 주기적 가비지 컬렉션
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memory_limit_mb</span><span class=o>=</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>memory_limit_mb</span> <span class=o>=</span> <span class=n>memory_limit_mb</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>gc_interval</span> <span class=o>=</span> <span class=mi>1000</span>  <span class=c1># 1000개 처리마다 GC</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_large_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_body</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        대용량 메시지 스트리밍 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - 메모리에 전체 로드하지 않고 스트리밍 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - 백프레셔를 통한 메모리 보호
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_memory</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>Process</span><span class=p>()</span><span class=o>.</span><span class=n>memory_info</span><span class=p>()</span><span class=o>.</span><span class=n>rss</span> <span class=o>/</span> <span class=mi>1024</span> <span class=o>/</span> <span class=mi>1024</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_memory</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>memory_limit_mb</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메모리 사용량 초과 시 처리 지연</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_wait_for_memory_relief</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># JSON 스트리밍 파싱 (대용량 메시지 대응)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>message_body</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>:</span>  <span class=c1># 10MB 이상</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_process_large_json_streaming</span><span class=p>(</span><span class=n>message_body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 일반 처리</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message_body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_process_message_data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 주기적 메모리 정리</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>gc_interval</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gc</span><span class=o>.</span><span class=n>collect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>MemoryError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메모리 부족 시 처리 중단 및 재시도</span>
</span></span><span class=line><span class=cl>            <span class=n>gc</span><span class=o>.</span><span class=n>collect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Memory limit exceeded, message requeued&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_process_large_json_streaming</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_body</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;대용량 JSON 스트리밍 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>ijson</span>  <span class=c1># 스트리밍 JSON 파서</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 스트리밍으로 JSON 배열 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>parser</span> <span class=o>=</span> <span class=n>ijson</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>message_body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_item</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>prefix</span><span class=p>,</span> <span class=n>event</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>parser</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span> <span class=o>==</span> <span class=s1>&#39;start_map&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_item</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>event</span> <span class=o>==</span> <span class=s1>&#39;map_key&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_key</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>event</span> <span class=o>==</span> <span class=s1>&#39;string&#39;</span> <span class=ow>or</span> <span class=n>event</span> <span class=o>==</span> <span class=s1>&#39;number&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_item</span><span class=p>[</span><span class=n>current_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>event</span> <span class=o>==</span> <span class=s1>&#39;end_map&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 개별 아이템 처리 (메모리 효율적)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_process_single_item</span><span class=p>(</span><span class=n>current_item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>current_item</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># 메모리 해제</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_wait_for_memory_relief</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메모리 사용량이 정상화될 때까지 대기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_memory</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>Process</span><span class=p>()</span><span class=o>.</span><span class=n>memory_info</span><span class=p>()</span><span class=o>.</span><span class=n>rss</span> <span class=o>/</span> <span class=mi>1024</span> <span class=o>/</span> <span class=mi>1024</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_memory</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>memory_limit_mb</span> <span class=o>*</span> <span class=mf>0.8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 100ms 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>gc</span><span class=o>.</span><span class=n>collect</span><span class=p>()</span>     <span class=c1># 강제 GC</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=7단계-phase-7-조사-고급-주제>7단계: Phase 7 조사 (고급 주제)<a hidden class=anchor aria-hidden=true href=#7단계-phase-7-조사-고급-주제>#</a></h2><h2 id=phase-7-고급-주제-advanced-topics-1>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics-1>#</a></h2><h3 id=71-현재-도전-과제-실무-환경-기반-기술-난제>7.1 현재 도전 과제 (실무 환경 기반 기술 난제)<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제-실무-환경-기반-기술-난제>#</a></h3><h4 id=핵심-기술-난제-분석>핵심 기술 난제 분석<a hidden class=anchor aria-hidden=true href=#핵심-기술-난제-분석>#</a></h4><blockquote><p>이 표는 RabbitMQ 운영 시 직면하는 주요 기술 난제와 해결방안을 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>도전 과제</th><th>원인</th><th>비즈니스 영향</th><th>탐지 방법</th><th>예방 방법</th><th>해결 방안</th></tr></thead><tbody><tr><td><strong>메모리 폭증</strong></td><td>컨슈머 처리 지연, 큐 누적</td><td>서비스 다운타임, 데이터 손실</td><td>Memory Watermark 모니터링</td><td>Flow Control, Lazy Queue</td><td>Consumer Scaling, 메시지 TTL</td></tr><tr><td><strong>네트워크 분할</strong></td><td>클러스터 노드 간 통신 장애</td><td>Split-brain, 데이터 불일치</td><td>클러스터 상태 감시</td><td>네트워크 이중화, 홀수 노드</td><td>Manual Recovery, Quorum Queue</td></tr><tr><td><strong>처리량 병목</strong></td><td>단일 큐의 순차 처리 제한</td><td>실시간 처리 지연, 사용자 불만</td><td>Queue Depth, Latency 메트릭</td><td>Queue Sharding, 워크로드 분산</td><td>큐 분할, Consumer 증설</td></tr><tr><td><strong>메시지 순서 보장</strong></td><td>병렬 처리와 순서 요구사항 충돌</td><td>비즈니스 로직 오류, 데이터 무결성</td><td>순서 검증 로직</td><td>Single Consumer, Partition Key</td><td>Message Grouping, Saga Pattern</td></tr><tr><td><strong>백프레셔 처리</strong></td><td>프로듀서-컨슈머 속도 불일치</td><td>메모리 고갈, 시스템 불안정</td><td>Publishing Rate 모니터링</td><td>Rate Limiting, Circuit Breaker</td><td>Flow Control, Buffering</td></tr><tr><td><strong>장애 복구</strong></td><td>노드 장애 시 수동 개입 필요</td><td>복구 시간 지연, 운영 부담</td><td>Health Check 실패</td><td>Automated Failover</td><td>Kubernetes Operator</td></tr></tbody></table><h4 id=1-메모리-관리-난제>1. 메모리 관리 난제<a hidden class=anchor aria-hidden=true href=#1-메모리-관리-난제>#</a></h4><p><strong>문제 상황</strong>: 대용량 메시지 처리 시 메모리 사용량이 급격히 증가하여 브로커가 응답하지 않거나 크래시가 발생</p><p><strong>실무 시나리오</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1> 1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2> 2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3> 3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4> 4</a>
</span><span class=lnt id=hl-57-5><a class=lnlinks href=#hl-57-5> 5</a>
</span><span class=lnt id=hl-57-6><a class=lnlinks href=#hl-57-6> 6</a>
</span><span class=lnt id=hl-57-7><a class=lnlinks href=#hl-57-7> 7</a>
</span><span class=lnt id=hl-57-8><a class=lnlinks href=#hl-57-8> 8</a>
</span><span class=lnt id=hl-57-9><a class=lnlinks href=#hl-57-9> 9</a>
</span><span class=lnt id=hl-57-10><a class=lnlinks href=#hl-57-10>10</a>
</span><span class=lnt id=hl-57-11><a class=lnlinks href=#hl-57-11>11</a>
</span><span class=lnt id=hl-57-12><a class=lnlinks href=#hl-57-12>12</a>
</span><span class=lnt id=hl-57-13><a class=lnlinks href=#hl-57-13>13</a>
</span><span class=lnt id=hl-57-14><a class=lnlinks href=#hl-57-14>14</a>
</span><span class=lnt id=hl-57-15><a class=lnlinks href=#hl-57-15>15</a>
</span><span class=lnt id=hl-57-16><a class=lnlinks href=#hl-57-16>16</a>
</span><span class=lnt id=hl-57-17><a class=lnlinks href=#hl-57-17>17</a>
</span><span class=lnt id=hl-57-18><a class=lnlinks href=#hl-57-18>18</a>
</span><span class=lnt id=hl-57-19><a class=lnlinks href=#hl-57-19>19</a>
</span><span class=lnt id=hl-57-20><a class=lnlinks href=#hl-57-20>20</a>
</span><span class=lnt id=hl-57-21><a class=lnlinks href=#hl-57-21>21</a>
</span><span class=lnt id=hl-57-22><a class=lnlinks href=#hl-57-22>22</a>
</span><span class=lnt id=hl-57-23><a class=lnlinks href=#hl-57-23>23</a>
</span><span class=lnt id=hl-57-24><a class=lnlinks href=#hl-57-24>24</a>
</span><span class=lnt id=hl-57-25><a class=lnlinks href=#hl-57-25>25</a>
</span><span class=lnt id=hl-57-26><a class=lnlinks href=#hl-57-26>26</a>
</span><span class=lnt id=hl-57-27><a class=lnlinks href=#hl-57-27>27</a>
</span><span class=lnt id=hl-57-28><a class=lnlinks href=#hl-57-28>28</a>
</span><span class=lnt id=hl-57-29><a class=lnlinks href=#hl-57-29>29</a>
</span><span class=lnt id=hl-57-30><a class=lnlinks href=#hl-57-30>30</a>
</span><span class=lnt id=hl-57-31><a class=lnlinks href=#hl-57-31>31</a>
</span><span class=lnt id=hl-57-32><a class=lnlinks href=#hl-57-32>32</a>
</span><span class=lnt id=hl-57-33><a class=lnlinks href=#hl-57-33>33</a>
</span><span class=lnt id=hl-57-34><a class=lnlinks href=#hl-57-34>34</a>
</span><span class=lnt id=hl-57-35><a class=lnlinks href=#hl-57-35>35</a>
</span><span class=lnt id=hl-57-36><a class=lnlinks href=#hl-57-36>36</a>
</span><span class=lnt id=hl-57-37><a class=lnlinks href=#hl-57-37>37</a>
</span><span class=lnt id=hl-57-38><a class=lnlinks href=#hl-57-38>38</a>
</span><span class=lnt id=hl-57-39><a class=lnlinks href=#hl-57-39>39</a>
</span><span class=lnt id=hl-57-40><a class=lnlinks href=#hl-57-40>40</a>
</span><span class=lnt id=hl-57-41><a class=lnlinks href=#hl-57-41>41</a>
</span><span class=lnt id=hl-57-42><a class=lnlinks href=#hl-57-42>42</a>
</span><span class=lnt id=hl-57-43><a class=lnlinks href=#hl-57-43>43</a>
</span><span class=lnt id=hl-57-44><a class=lnlinks href=#hl-57-44>44</a>
</span><span class=lnt id=hl-57-45><a class=lnlinks href=#hl-57-45>45</a>
</span><span class=lnt id=hl-57-46><a class=lnlinks href=#hl-57-46>46</a>
</span><span class=lnt id=hl-57-47><a class=lnlinks href=#hl-57-47>47</a>
</span><span class=lnt id=hl-57-48><a class=lnlinks href=#hl-57-48>48</a>
</span><span class=lnt id=hl-57-49><a class=lnlinks href=#hl-57-49>49</a>
</span><span class=lnt id=hl-57-50><a class=lnlinks href=#hl-57-50>50</a>
</span><span class=lnt id=hl-57-51><a class=lnlinks href=#hl-57-51>51</a>
</span><span class=lnt id=hl-57-52><a class=lnlinks href=#hl-57-52>52</a>
</span><span class=lnt id=hl-57-53><a class=lnlinks href=#hl-57-53>53</a>
</span><span class=lnt id=hl-57-54><a class=lnlinks href=#hl-57-54>54</a>
</span><span class=lnt id=hl-57-55><a class=lnlinks href=#hl-57-55>55</a>
</span><span class=lnt id=hl-57-56><a class=lnlinks href=#hl-57-56>56</a>
</span><span class=lnt id=hl-57-57><a class=lnlinks href=#hl-57-57>57</a>
</span><span class=lnt id=hl-57-58><a class=lnlinks href=#hl-57-58>58</a>
</span><span class=lnt id=hl-57-59><a class=lnlinks href=#hl-57-59>59</a>
</span><span class=lnt id=hl-57-60><a class=lnlinks href=#hl-57-60>60</a>
</span><span class=lnt id=hl-57-61><a class=lnlinks href=#hl-57-61>61</a>
</span><span class=lnt id=hl-57-62><a class=lnlinks href=#hl-57-62>62</a>
</span><span class=lnt id=hl-57-63><a class=lnlinks href=#hl-57-63>63</a>
</span><span class=lnt id=hl-57-64><a class=lnlinks href=#hl-57-64>64</a>
</span><span class=lnt id=hl-57-65><a class=lnlinks href=#hl-57-65>65</a>
</span><span class=lnt id=hl-57-66><a class=lnlinks href=#hl-57-66>66</a>
</span><span class=lnt id=hl-57-67><a class=lnlinks href=#hl-57-67>67</a>
</span><span class=lnt id=hl-57-68><a class=lnlinks href=#hl-57-68>68</a>
</span><span class=lnt id=hl-57-69><a class=lnlinks href=#hl-57-69>69</a>
</span><span class=lnt id=hl-57-70><a class=lnlinks href=#hl-57-70>70</a>
</span><span class=lnt id=hl-57-71><a class=lnlinks href=#hl-57-71>71</a>
</span><span class=lnt id=hl-57-72><a class=lnlinks href=#hl-57-72>72</a>
</span><span class=lnt id=hl-57-73><a class=lnlinks href=#hl-57-73>73</a>
</span><span class=lnt id=hl-57-74><a class=lnlinks href=#hl-57-74>74</a>
</span><span class=lnt id=hl-57-75><a class=lnlinks href=#hl-57-75>75</a>
</span><span class=lnt id=hl-57-76><a class=lnlinks href=#hl-57-76>76</a>
</span><span class=lnt id=hl-57-77><a class=lnlinks href=#hl-57-77>77</a>
</span><span class=lnt id=hl-57-78><a class=lnlinks href=#hl-57-78>78</a>
</span><span class=lnt id=hl-57-79><a class=lnlinks href=#hl-57-79>79</a>
</span><span class=lnt id=hl-57-80><a class=lnlinks href=#hl-57-80>80</a>
</span><span class=lnt id=hl-57-81><a class=lnlinks href=#hl-57-81>81</a>
</span><span class=lnt id=hl-57-82><a class=lnlinks href=#hl-57-82>82</a>
</span><span class=lnt id=hl-57-83><a class=lnlinks href=#hl-57-83>83</a>
</span><span class=lnt id=hl-57-84><a class=lnlinks href=#hl-57-84>84</a>
</span><span class=lnt id=hl-57-85><a class=lnlinks href=#hl-57-85>85</a>
</span><span class=lnt id=hl-57-86><a class=lnlinks href=#hl-57-86>86</a>
</span><span class=lnt id=hl-57-87><a class=lnlinks href=#hl-57-87>87</a>
</span><span class=lnt id=hl-57-88><a class=lnlinks href=#hl-57-88>88</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 메모리 압박 상황 시뮬레이션 및 대응</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psutil</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MemoryPressureHandler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    메모리 압박 상황 감지 및 자동 대응 시스템
</span></span></span><span class=line><span class=cl><span class=s2>    - 실시간 메모리 모니터링
</span></span></span><span class=line><span class=cl><span class=s2>    - 백프레셔 적용
</span></span></span><span class=line><span class=cl><span class=s2>    - 긴급 상황 시 메시지 오프로딩
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memory_threshold</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span> <span class=n>critical_threshold</span><span class=o>=</span><span class=mf>0.9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>memory_threshold</span> <span class=o>=</span> <span class=n>memory_threshold</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>critical_threshold</span> <span class=o>=</span> <span class=n>critical_threshold</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>backpressure_active</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>emergency_mode</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>monitoring_active</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_memory_monitoring</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메모리 모니터링 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>monitor</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>monitoring_active</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>memory_usage</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>virtual_memory</span><span class=p>()</span><span class=o>.</span><span class=n>percent</span> <span class=o>/</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>memory_usage</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>critical_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_activate_emergency_mode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>memory_usage</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>memory_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_activate_backpressure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>memory_usage</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>memory_threshold</span> <span class=o>*</span> <span class=mf>0.9</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_deactivate_backpressure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 1초마다 체크</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>monitor</span><span class=p>,</span> <span class=n>daemon</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_activate_emergency_mode</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;긴급 모드 - 메시지 오프로딩&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>emergency_mode</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>emergency_mode</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;🚨 EMERGENCY: Activating message offloading&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 1. 새로운 메시지 발행 일시 중단</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_block_new_publishers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2. 메모리 내 메시지를 디스크로 강제 이동</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_force_message_offload</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3. 긴급 알림 발송</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_send_emergency_alert</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_activate_backpressure</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;백프레셔 활성화&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>backpressure_active</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>backpressure_active</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;⚠️ WARNING: Activating backpressure&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># RabbitMQ Flow Control 설정 적용</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_apply_flow_control</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_force_message_offload</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메모리 내 메시지를 디스크로 강제 이동&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># RabbitMQ Management API를 통한 큐 상태 변경</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>management_api</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:15672/api&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>auth</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 큐를 Lazy 모드로 전환 (메모리 → 디스크)</span>
</span></span><span class=line><span class=cl>        <span class=n>queues_response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>management_api</span><span class=si>}</span><span class=s2>/queues&#34;</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>auth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>queue</span> <span class=ow>in</span> <span class=n>queues_response</span><span class=o>.</span><span class=n>json</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>queue_name</span> <span class=o>=</span> <span class=n>queue</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>vhost</span> <span class=o>=</span> <span class=n>queue</span><span class=p>[</span><span class=s1>&#39;vhost&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 큐를 Lazy 모드로 변경</span>
</span></span><span class=line><span class=cl>            <span class=n>requests</span><span class=o>.</span><span class=n>put</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>management_api</span><span class=si>}</span><span class=s2>/queues/</span><span class=si>{</span><span class=n>vhost</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>auth</span><span class=o>=</span><span class=n>auth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;durable&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;arguments&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;x-queue-mode&#34;</span><span class=p>:</span> <span class=s2>&#34;lazy&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;✅ All queues converted to lazy mode&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-분산-시스템-일관성-난제>2. 분산 시스템 일관성 난제<a hidden class=anchor aria-hidden=true href=#2-분산-시스템-일관성-난제>#</a></h4><p><strong>문제 상황</strong>: 마이크로서비스 환경에서 메시지 순서 보장과 분산 트랜잭션 처리의 복잡성</p><p><strong>Saga 패턴을 통한 분산 트랜잭션 구현</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1>  1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2>  2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3>  3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4>  4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5>  5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6>  6</a>
</span><span class=lnt id=hl-58-7><a class=lnlinks href=#hl-58-7>  7</a>
</span><span class=lnt id=hl-58-8><a class=lnlinks href=#hl-58-8>  8</a>
</span><span class=lnt id=hl-58-9><a class=lnlinks href=#hl-58-9>  9</a>
</span><span class=lnt id=hl-58-10><a class=lnlinks href=#hl-58-10> 10</a>
</span><span class=lnt id=hl-58-11><a class=lnlinks href=#hl-58-11> 11</a>
</span><span class=lnt id=hl-58-12><a class=lnlinks href=#hl-58-12> 12</a>
</span><span class=lnt id=hl-58-13><a class=lnlinks href=#hl-58-13> 13</a>
</span><span class=lnt id=hl-58-14><a class=lnlinks href=#hl-58-14> 14</a>
</span><span class=lnt id=hl-58-15><a class=lnlinks href=#hl-58-15> 15</a>
</span><span class=lnt id=hl-58-16><a class=lnlinks href=#hl-58-16> 16</a>
</span><span class=lnt id=hl-58-17><a class=lnlinks href=#hl-58-17> 17</a>
</span><span class=lnt id=hl-58-18><a class=lnlinks href=#hl-58-18> 18</a>
</span><span class=lnt id=hl-58-19><a class=lnlinks href=#hl-58-19> 19</a>
</span><span class=lnt id=hl-58-20><a class=lnlinks href=#hl-58-20> 20</a>
</span><span class=lnt id=hl-58-21><a class=lnlinks href=#hl-58-21> 21</a>
</span><span class=lnt id=hl-58-22><a class=lnlinks href=#hl-58-22> 22</a>
</span><span class=lnt id=hl-58-23><a class=lnlinks href=#hl-58-23> 23</a>
</span><span class=lnt id=hl-58-24><a class=lnlinks href=#hl-58-24> 24</a>
</span><span class=lnt id=hl-58-25><a class=lnlinks href=#hl-58-25> 25</a>
</span><span class=lnt id=hl-58-26><a class=lnlinks href=#hl-58-26> 26</a>
</span><span class=lnt id=hl-58-27><a class=lnlinks href=#hl-58-27> 27</a>
</span><span class=lnt id=hl-58-28><a class=lnlinks href=#hl-58-28> 28</a>
</span><span class=lnt id=hl-58-29><a class=lnlinks href=#hl-58-29> 29</a>
</span><span class=lnt id=hl-58-30><a class=lnlinks href=#hl-58-30> 30</a>
</span><span class=lnt id=hl-58-31><a class=lnlinks href=#hl-58-31> 31</a>
</span><span class=lnt id=hl-58-32><a class=lnlinks href=#hl-58-32> 32</a>
</span><span class=lnt id=hl-58-33><a class=lnlinks href=#hl-58-33> 33</a>
</span><span class=lnt id=hl-58-34><a class=lnlinks href=#hl-58-34> 34</a>
</span><span class=lnt id=hl-58-35><a class=lnlinks href=#hl-58-35> 35</a>
</span><span class=lnt id=hl-58-36><a class=lnlinks href=#hl-58-36> 36</a>
</span><span class=lnt id=hl-58-37><a class=lnlinks href=#hl-58-37> 37</a>
</span><span class=lnt id=hl-58-38><a class=lnlinks href=#hl-58-38> 38</a>
</span><span class=lnt id=hl-58-39><a class=lnlinks href=#hl-58-39> 39</a>
</span><span class=lnt id=hl-58-40><a class=lnlinks href=#hl-58-40> 40</a>
</span><span class=lnt id=hl-58-41><a class=lnlinks href=#hl-58-41> 41</a>
</span><span class=lnt id=hl-58-42><a class=lnlinks href=#hl-58-42> 42</a>
</span><span class=lnt id=hl-58-43><a class=lnlinks href=#hl-58-43> 43</a>
</span><span class=lnt id=hl-58-44><a class=lnlinks href=#hl-58-44> 44</a>
</span><span class=lnt id=hl-58-45><a class=lnlinks href=#hl-58-45> 45</a>
</span><span class=lnt id=hl-58-46><a class=lnlinks href=#hl-58-46> 46</a>
</span><span class=lnt id=hl-58-47><a class=lnlinks href=#hl-58-47> 47</a>
</span><span class=lnt id=hl-58-48><a class=lnlinks href=#hl-58-48> 48</a>
</span><span class=lnt id=hl-58-49><a class=lnlinks href=#hl-58-49> 49</a>
</span><span class=lnt id=hl-58-50><a class=lnlinks href=#hl-58-50> 50</a>
</span><span class=lnt id=hl-58-51><a class=lnlinks href=#hl-58-51> 51</a>
</span><span class=lnt id=hl-58-52><a class=lnlinks href=#hl-58-52> 52</a>
</span><span class=lnt id=hl-58-53><a class=lnlinks href=#hl-58-53> 53</a>
</span><span class=lnt id=hl-58-54><a class=lnlinks href=#hl-58-54> 54</a>
</span><span class=lnt id=hl-58-55><a class=lnlinks href=#hl-58-55> 55</a>
</span><span class=lnt id=hl-58-56><a class=lnlinks href=#hl-58-56> 56</a>
</span><span class=lnt id=hl-58-57><a class=lnlinks href=#hl-58-57> 57</a>
</span><span class=lnt id=hl-58-58><a class=lnlinks href=#hl-58-58> 58</a>
</span><span class=lnt id=hl-58-59><a class=lnlinks href=#hl-58-59> 59</a>
</span><span class=lnt id=hl-58-60><a class=lnlinks href=#hl-58-60> 60</a>
</span><span class=lnt id=hl-58-61><a class=lnlinks href=#hl-58-61> 61</a>
</span><span class=lnt id=hl-58-62><a class=lnlinks href=#hl-58-62> 62</a>
</span><span class=lnt id=hl-58-63><a class=lnlinks href=#hl-58-63> 63</a>
</span><span class=lnt id=hl-58-64><a class=lnlinks href=#hl-58-64> 64</a>
</span><span class=lnt id=hl-58-65><a class=lnlinks href=#hl-58-65> 65</a>
</span><span class=lnt id=hl-58-66><a class=lnlinks href=#hl-58-66> 66</a>
</span><span class=lnt id=hl-58-67><a class=lnlinks href=#hl-58-67> 67</a>
</span><span class=lnt id=hl-58-68><a class=lnlinks href=#hl-58-68> 68</a>
</span><span class=lnt id=hl-58-69><a class=lnlinks href=#hl-58-69> 69</a>
</span><span class=lnt id=hl-58-70><a class=lnlinks href=#hl-58-70> 70</a>
</span><span class=lnt id=hl-58-71><a class=lnlinks href=#hl-58-71> 71</a>
</span><span class=lnt id=hl-58-72><a class=lnlinks href=#hl-58-72> 72</a>
</span><span class=lnt id=hl-58-73><a class=lnlinks href=#hl-58-73> 73</a>
</span><span class=lnt id=hl-58-74><a class=lnlinks href=#hl-58-74> 74</a>
</span><span class=lnt id=hl-58-75><a class=lnlinks href=#hl-58-75> 75</a>
</span><span class=lnt id=hl-58-76><a class=lnlinks href=#hl-58-76> 76</a>
</span><span class=lnt id=hl-58-77><a class=lnlinks href=#hl-58-77> 77</a>
</span><span class=lnt id=hl-58-78><a class=lnlinks href=#hl-58-78> 78</a>
</span><span class=lnt id=hl-58-79><a class=lnlinks href=#hl-58-79> 79</a>
</span><span class=lnt id=hl-58-80><a class=lnlinks href=#hl-58-80> 80</a>
</span><span class=lnt id=hl-58-81><a class=lnlinks href=#hl-58-81> 81</a>
</span><span class=lnt id=hl-58-82><a class=lnlinks href=#hl-58-82> 82</a>
</span><span class=lnt id=hl-58-83><a class=lnlinks href=#hl-58-83> 83</a>
</span><span class=lnt id=hl-58-84><a class=lnlinks href=#hl-58-84> 84</a>
</span><span class=lnt id=hl-58-85><a class=lnlinks href=#hl-58-85> 85</a>
</span><span class=lnt id=hl-58-86><a class=lnlinks href=#hl-58-86> 86</a>
</span><span class=lnt id=hl-58-87><a class=lnlinks href=#hl-58-87> 87</a>
</span><span class=lnt id=hl-58-88><a class=lnlinks href=#hl-58-88> 88</a>
</span><span class=lnt id=hl-58-89><a class=lnlinks href=#hl-58-89> 89</a>
</span><span class=lnt id=hl-58-90><a class=lnlinks href=#hl-58-90> 90</a>
</span><span class=lnt id=hl-58-91><a class=lnlinks href=#hl-58-91> 91</a>
</span><span class=lnt id=hl-58-92><a class=lnlinks href=#hl-58-92> 92</a>
</span><span class=lnt id=hl-58-93><a class=lnlinks href=#hl-58-93> 93</a>
</span><span class=lnt id=hl-58-94><a class=lnlinks href=#hl-58-94> 94</a>
</span><span class=lnt id=hl-58-95><a class=lnlinks href=#hl-58-95> 95</a>
</span><span class=lnt id=hl-58-96><a class=lnlinks href=#hl-58-96> 96</a>
</span><span class=lnt id=hl-58-97><a class=lnlinks href=#hl-58-97> 97</a>
</span><span class=lnt id=hl-58-98><a class=lnlinks href=#hl-58-98> 98</a>
</span><span class=lnt id=hl-58-99><a class=lnlinks href=#hl-58-99> 99</a>
</span><span class=lnt id=hl-58-100><a class=lnlinks href=#hl-58-100>100</a>
</span><span class=lnt id=hl-58-101><a class=lnlinks href=#hl-58-101>101</a>
</span><span class=lnt id=hl-58-102><a class=lnlinks href=#hl-58-102>102</a>
</span><span class=lnt id=hl-58-103><a class=lnlinks href=#hl-58-103>103</a>
</span><span class=lnt id=hl-58-104><a class=lnlinks href=#hl-58-104>104</a>
</span><span class=lnt id=hl-58-105><a class=lnlinks href=#hl-58-105>105</a>
</span><span class=lnt id=hl-58-106><a class=lnlinks href=#hl-58-106>106</a>
</span><span class=lnt id=hl-58-107><a class=lnlinks href=#hl-58-107>107</a>
</span><span class=lnt id=hl-58-108><a class=lnlinks href=#hl-58-108>108</a>
</span><span class=lnt id=hl-58-109><a class=lnlinks href=#hl-58-109>109</a>
</span><span class=lnt id=hl-58-110><a class=lnlinks href=#hl-58-110>110</a>
</span><span class=lnt id=hl-58-111><a class=lnlinks href=#hl-58-111>111</a>
</span><span class=lnt id=hl-58-112><a class=lnlinks href=#hl-58-112>112</a>
</span><span class=lnt id=hl-58-113><a class=lnlinks href=#hl-58-113>113</a>
</span><span class=lnt id=hl-58-114><a class=lnlinks href=#hl-58-114>114</a>
</span><span class=lnt id=hl-58-115><a class=lnlinks href=#hl-58-115>115</a>
</span><span class=lnt id=hl-58-116><a class=lnlinks href=#hl-58-116>116</a>
</span><span class=lnt id=hl-58-117><a class=lnlinks href=#hl-58-117>117</a>
</span><span class=lnt id=hl-58-118><a class=lnlinks href=#hl-58-118>118</a>
</span><span class=lnt id=hl-58-119><a class=lnlinks href=#hl-58-119>119</a>
</span><span class=lnt id=hl-58-120><a class=lnlinks href=#hl-58-120>120</a>
</span><span class=lnt id=hl-58-121><a class=lnlinks href=#hl-58-121>121</a>
</span><span class=lnt id=hl-58-122><a class=lnlinks href=#hl-58-122>122</a>
</span><span class=lnt id=hl-58-123><a class=lnlinks href=#hl-58-123>123</a>
</span><span class=lnt id=hl-58-124><a class=lnlinks href=#hl-58-124>124</a>
</span><span class=lnt id=hl-58-125><a class=lnlinks href=#hl-58-125>125</a>
</span><span class=lnt id=hl-58-126><a class=lnlinks href=#hl-58-126>126</a>
</span><span class=lnt id=hl-58-127><a class=lnlinks href=#hl-58-127>127</a>
</span><span class=lnt id=hl-58-128><a class=lnlinks href=#hl-58-128>128</a>
</span><span class=lnt id=hl-58-129><a class=lnlinks href=#hl-58-129>129</a>
</span><span class=lnt id=hl-58-130><a class=lnlinks href=#hl-58-130>130</a>
</span><span class=lnt id=hl-58-131><a class=lnlinks href=#hl-58-131>131</a>
</span><span class=lnt id=hl-58-132><a class=lnlinks href=#hl-58-132>132</a>
</span><span class=lnt id=hl-58-133><a class=lnlinks href=#hl-58-133>133</a>
</span><span class=lnt id=hl-58-134><a class=lnlinks href=#hl-58-134>134</a>
</span><span class=lnt id=hl-58-135><a class=lnlinks href=#hl-58-135>135</a>
</span><span class=lnt id=hl-58-136><a class=lnlinks href=#hl-58-136>136</a>
</span><span class=lnt id=hl-58-137><a class=lnlinks href=#hl-58-137>137</a>
</span><span class=lnt id=hl-58-138><a class=lnlinks href=#hl-58-138>138</a>
</span><span class=lnt id=hl-58-139><a class=lnlinks href=#hl-58-139>139</a>
</span><span class=lnt id=hl-58-140><a class=lnlinks href=#hl-58-140>140</a>
</span><span class=lnt id=hl-58-141><a class=lnlinks href=#hl-58-141>141</a>
</span><span class=lnt id=hl-58-142><a class=lnlinks href=#hl-58-142>142</a>
</span><span class=lnt id=hl-58-143><a class=lnlinks href=#hl-58-143>143</a>
</span><span class=lnt id=hl-58-144><a class=lnlinks href=#hl-58-144>144</a>
</span><span class=lnt id=hl-58-145><a class=lnlinks href=#hl-58-145>145</a>
</span><span class=lnt id=hl-58-146><a class=lnlinks href=#hl-58-146>146</a>
</span><span class=lnt id=hl-58-147><a class=lnlinks href=#hl-58-147>147</a>
</span><span class=lnt id=hl-58-148><a class=lnlinks href=#hl-58-148>148</a>
</span><span class=lnt id=hl-58-149><a class=lnlinks href=#hl-58-149>149</a>
</span><span class=lnt id=hl-58-150><a class=lnlinks href=#hl-58-150>150</a>
</span><span class=lnt id=hl-58-151><a class=lnlinks href=#hl-58-151>151</a>
</span><span class=lnt id=hl-58-152><a class=lnlinks href=#hl-58-152>152</a>
</span><span class=lnt id=hl-58-153><a class=lnlinks href=#hl-58-153>153</a>
</span><span class=lnt id=hl-58-154><a class=lnlinks href=#hl-58-154>154</a>
</span><span class=lnt id=hl-58-155><a class=lnlinks href=#hl-58-155>155</a>
</span><span class=lnt id=hl-58-156><a class=lnlinks href=#hl-58-156>156</a>
</span><span class=lnt id=hl-58-157><a class=lnlinks href=#hl-58-157>157</a>
</span><span class=lnt id=hl-58-158><a class=lnlinks href=#hl-58-158>158</a>
</span><span class=lnt id=hl-58-159><a class=lnlinks href=#hl-58-159>159</a>
</span><span class=lnt id=hl-58-160><a class=lnlinks href=#hl-58-160>160</a>
</span><span class=lnt id=hl-58-161><a class=lnlinks href=#hl-58-161>161</a>
</span><span class=lnt id=hl-58-162><a class=lnlinks href=#hl-58-162>162</a>
</span><span class=lnt id=hl-58-163><a class=lnlinks href=#hl-58-163>163</a>
</span><span class=lnt id=hl-58-164><a class=lnlinks href=#hl-58-164>164</a>
</span><span class=lnt id=hl-58-165><a class=lnlinks href=#hl-58-165>165</a>
</span><span class=lnt id=hl-58-166><a class=lnlinks href=#hl-58-166>166</a>
</span><span class=lnt id=hl-58-167><a class=lnlinks href=#hl-58-167>167</a>
</span><span class=lnt id=hl-58-168><a class=lnlinks href=#hl-58-168>168</a>
</span><span class=lnt id=hl-58-169><a class=lnlinks href=#hl-58-169>169</a>
</span><span class=lnt id=hl-58-170><a class=lnlinks href=#hl-58-170>170</a>
</span><span class=lnt id=hl-58-171><a class=lnlinks href=#hl-58-171>171</a>
</span><span class=lnt id=hl-58-172><a class=lnlinks href=#hl-58-172>172</a>
</span><span class=lnt id=hl-58-173><a class=lnlinks href=#hl-58-173>173</a>
</span><span class=lnt id=hl-58-174><a class=lnlinks href=#hl-58-174>174</a>
</span><span class=lnt id=hl-58-175><a class=lnlinks href=#hl-58-175>175</a>
</span><span class=lnt id=hl-58-176><a class=lnlinks href=#hl-58-176>176</a>
</span><span class=lnt id=hl-58-177><a class=lnlinks href=#hl-58-177>177</a>
</span><span class=lnt id=hl-58-178><a class=lnlinks href=#hl-58-178>178</a>
</span><span class=lnt id=hl-58-179><a class=lnlinks href=#hl-58-179>179</a>
</span><span class=lnt id=hl-58-180><a class=lnlinks href=#hl-58-180>180</a>
</span><span class=lnt id=hl-58-181><a class=lnlinks href=#hl-58-181>181</a>
</span><span class=lnt id=hl-58-182><a class=lnlinks href=#hl-58-182>182</a>
</span><span class=lnt id=hl-58-183><a class=lnlinks href=#hl-58-183>183</a>
</span><span class=lnt id=hl-58-184><a class=lnlinks href=#hl-58-184>184</a>
</span><span class=lnt id=hl-58-185><a class=lnlinks href=#hl-58-185>185</a>
</span><span class=lnt id=hl-58-186><a class=lnlinks href=#hl-58-186>186</a>
</span><span class=lnt id=hl-58-187><a class=lnlinks href=#hl-58-187>187</a>
</span><span class=lnt id=hl-58-188><a class=lnlinks href=#hl-58-188>188</a>
</span><span class=lnt id=hl-58-189><a class=lnlinks href=#hl-58-189>189</a>
</span><span class=lnt id=hl-58-190><a class=lnlinks href=#hl-58-190>190</a>
</span><span class=lnt id=hl-58-191><a class=lnlinks href=#hl-58-191>191</a>
</span><span class=lnt id=hl-58-192><a class=lnlinks href=#hl-58-192>192</a>
</span><span class=lnt id=hl-58-193><a class=lnlinks href=#hl-58-193>193</a>
</span><span class=lnt id=hl-58-194><a class=lnlinks href=#hl-58-194>194</a>
</span><span class=lnt id=hl-58-195><a class=lnlinks href=#hl-58-195>195</a>
</span><span class=lnt id=hl-58-196><a class=lnlinks href=#hl-58-196>196</a>
</span><span class=lnt id=hl-58-197><a class=lnlinks href=#hl-58-197>197</a>
</span><span class=lnt id=hl-58-198><a class=lnlinks href=#hl-58-198>198</a>
</span><span class=lnt id=hl-58-199><a class=lnlinks href=#hl-58-199>199</a>
</span><span class=lnt id=hl-58-200><a class=lnlinks href=#hl-58-200>200</a>
</span><span class=lnt id=hl-58-201><a class=lnlinks href=#hl-58-201>201</a>
</span><span class=lnt id=hl-58-202><a class=lnlinks href=#hl-58-202>202</a>
</span><span class=lnt id=hl-58-203><a class=lnlinks href=#hl-58-203>203</a>
</span><span class=lnt id=hl-58-204><a class=lnlinks href=#hl-58-204>204</a>
</span><span class=lnt id=hl-58-205><a class=lnlinks href=#hl-58-205>205</a>
</span><span class=lnt id=hl-58-206><a class=lnlinks href=#hl-58-206>206</a>
</span><span class=lnt id=hl-58-207><a class=lnlinks href=#hl-58-207>207</a>
</span><span class=lnt id=hl-58-208><a class=lnlinks href=#hl-58-208>208</a>
</span><span class=lnt id=hl-58-209><a class=lnlinks href=#hl-58-209>209</a>
</span><span class=lnt id=hl-58-210><a class=lnlinks href=#hl-58-210>210</a>
</span><span class=lnt id=hl-58-211><a class=lnlinks href=#hl-58-211>211</a>
</span><span class=lnt id=hl-58-212><a class=lnlinks href=#hl-58-212>212</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Saga 패턴을 통한 분산 트랜잭션 관리</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SagaStatus</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>STARTED</span> <span class=o>=</span> <span class=s2>&#34;started&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>COMPENSATING</span> <span class=o>=</span> <span class=s2>&#34;compensating&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>COMPLETED</span> <span class=o>=</span> <span class=s2>&#34;completed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>FAILED</span> <span class=o>=</span> <span class=s2>&#34;failed&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SagaStep</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;사가 패턴의 개별 단계&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>step_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>service_name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>compensation_action</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>retry_count</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=n>timeout_seconds</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedTransactionManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 기반 분산 트랜잭션 관리자
</span></span></span><span class=line><span class=cl><span class=s2>    - Saga 패턴을 통한 장기 트랜잭션 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - 자동 보상 처리 및 재시도 메커니즘
</span></span></span><span class=line><span class=cl><span class=s2>    - 상태 추적 및 모니터링
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>saga_definitions</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>SagaStep</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사가 정의 등록</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_register_saga_definitions</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_register_saga_definitions</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;비즈니스별 사가 정의 등록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 처리 사가</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>saga_definitions</span><span class=p>[</span><span class=s1>&#39;order_processing&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>SagaStep</span><span class=p>(</span><span class=s2>&#34;validate_order&#34;</span><span class=p>,</span> <span class=s2>&#34;order_service&#34;</span><span class=p>,</span> <span class=s2>&#34;validate&#34;</span><span class=p>,</span> <span class=s2>&#34;cancel_validation&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>SagaStep</span><span class=p>(</span><span class=s2>&#34;reserve_inventory&#34;</span><span class=p>,</span> <span class=s2>&#34;inventory_service&#34;</span><span class=p>,</span> <span class=s2>&#34;reserve&#34;</span><span class=p>,</span> <span class=s2>&#34;release_reservation&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>SagaStep</span><span class=p>(</span><span class=s2>&#34;process_payment&#34;</span><span class=p>,</span> <span class=s2>&#34;payment_service&#34;</span><span class=p>,</span> <span class=s2>&#34;charge&#34;</span><span class=p>,</span> <span class=s2>&#34;refund_payment&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>SagaStep</span><span class=p>(</span><span class=s2>&#34;ship_order&#34;</span><span class=p>,</span> <span class=s2>&#34;shipping_service&#34;</span><span class=p>,</span> <span class=s2>&#34;ship&#34;</span><span class=p>,</span> <span class=s2>&#34;cancel_shipment&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>SagaStep</span><span class=p>(</span><span class=s2>&#34;send_confirmation&#34;</span><span class=p>,</span> <span class=s2>&#34;notification_service&#34;</span><span class=p>,</span> <span class=s2>&#34;notify&#34;</span><span class=p>,</span> <span class=s2>&#34;send_cancellation&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_saga</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 트랜잭션 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;saga_id&#39;</span><span class=p>:</span> <span class=n>saga_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;saga_type&#39;</span><span class=p>:</span> <span class=n>saga_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=n>SagaStatus</span><span class=o>.</span><span class=n>STARTED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;context&#39;</span><span class=p>:</span> <span class=n>context</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;current_step&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;completed_steps&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;failed_step&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;started_at&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>[</span><span class=n>saga_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>saga_state</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 첫 번째 단계 실행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_execute_next_step</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>saga_id</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_execute_next_step</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;다음 사가 단계 실행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>[</span><span class=n>saga_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_definition</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>saga_definitions</span><span class=p>[</span><span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;saga_type&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_step_index</span> <span class=o>=</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;current_step&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_step_index</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=n>saga_definition</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=c1># 모든 단계 완료</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_complete_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>step</span> <span class=o>=</span> <span class=n>saga_definition</span><span class=p>[</span><span class=n>current_step_index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 단계 실행 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>step_event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;saga_id&#39;</span><span class=p>:</span> <span class=n>saga_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;step_id&#39;</span><span class=p>:</span> <span class=n>step</span><span class=o>.</span><span class=n>step_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;service_name&#39;</span><span class=p>:</span> <span class=n>step</span><span class=o>.</span><span class=n>service_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=n>step</span><span class=o>.</span><span class=n>action</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;context&#39;</span><span class=p>:</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;context&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timeout&#39;</span><span class=p>:</span> <span class=n>step</span><span class=o>.</span><span class=n>timeout_seconds</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 타임아웃 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_set_step_timeout</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>step</span><span class=o>.</span><span class=n>step_id</span><span class=p>,</span> <span class=n>step</span><span class=o>.</span><span class=n>timeout_seconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 서비스별 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>service_name</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>action</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>step_event</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;🔄 Saga </span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>: Executing step </span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>step_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_step_completion</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        사가 단계 완료 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - *.step.completed 이벤트 수신 시 호출
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;saga_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>step_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;step_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;success&#39;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>saga_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>[</span><span class=n>saga_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 단계 성공 - 다음 단계로 진행</span>
</span></span><span class=line><span class=cl>            <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;completed_steps&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>step_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;current_step&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 컨텍스트 업데이트 (이전 단계 결과 포함)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;result&#39;</span> <span class=ow>in</span> <span class=n>event_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;context&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;result&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_execute_next_step</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 단계 실패 - 보상 프로세스 시작</span>
</span></span><span class=line><span class=cl>            <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SagaStatus</span><span class=o>.</span><span class=n>COMPENSATING</span>
</span></span><span class=line><span class=cl>            <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;failed_step&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>step_id</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_start_compensation</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_start_compensation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;보상 트랜잭션 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>[</span><span class=n>saga_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_definition</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>saga_definitions</span><span class=p>[</span><span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;saga_type&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;🔄 Saga </span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>: Starting compensation&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 완료된 단계들을 역순으로 보상 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>step_id</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;completed_steps&#39;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>s</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>saga_definition</span> <span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>step_id</span> <span class=o>==</span> <span class=n>step_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>compensation_event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;saga_id&#39;</span><span class=p>:</span> <span class=n>saga_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;step_id&#39;</span><span class=p>:</span> <span class=n>step_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;service_name&#39;</span><span class=p>:</span> <span class=n>step</span><span class=o>.</span><span class=n>service_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=n>step</span><span class=o>.</span><span class=n>compensation_action</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;context&#39;</span><span class=p>:</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;context&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 보상 액션 이벤트 발행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>service_name</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>compensation_action</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>compensation_event</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_compensation_completion</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;보상 완료 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;saga_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>saga_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>[</span><span class=n>saga_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 보상이 완료되었는지 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>remaining_compensations</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;completed_steps&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>remaining_compensations</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SagaStatus</span><span class=o>.</span><span class=n>FAILED</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;❌ Saga </span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>: Failed and compensated&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실패 알림 발송</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;saga.failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;saga_id&#39;</span><span class=p>:</span> <span class=n>saga_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;saga_type&#39;</span><span class=p>:</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;saga_type&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;failed_step&#39;</span><span class=p>:</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;failed_step&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_complete_saga</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;사가 완료 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_sagas</span><span class=p>[</span><span class=n>saga_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SagaStatus</span><span class=o>.</span><span class=n>COMPLETED</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;completed_at&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;✅ Saga </span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>: Completed successfully&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span><span class=s1>&#39;saga.completed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;saga_id&#39;</span><span class=p>:</span> <span class=n>saga_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;saga_type&#39;</span><span class=p>:</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;saga_type&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;duration&#39;</span><span class=p>:</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;completed_at&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>saga_state</span><span class=p>[</span><span class=s1>&#39;started_at&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>transaction_manager</span> <span class=o>=</span> <span class=n>DistributedTransactionManager</span><span class=p>(</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 처리 분산 트랜잭션 시작</span>
</span></span><span class=line><span class=cl><span class=n>saga_id</span> <span class=o>=</span> <span class=n>transaction_manager</span><span class=o>.</span><span class=n>start_saga</span><span class=p>(</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=s1>&#39;12345&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;order_amount&#39;</span><span class=p>:</span> <span class=mf>299.99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=p>[{</span><span class=s1>&#39;product_id&#39;</span><span class=p>:</span> <span class=s1>&#39;ABC123&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-성능-스케일링-난제>3. 성능 스케일링 난제<a hidden class=anchor aria-hidden=true href=#3-성능-스케일링-난제>#</a></h4><p><strong>문제 상황</strong>: 트래픽 증가에 따른 동적 스케일링과 리소스 최적화</p><p><strong>Kubernetes 기반 자동 스케일링</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1>  1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2>  2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3>  3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4>  4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5>  5</a>
</span><span class=lnt id=hl-59-6><a class=lnlinks href=#hl-59-6>  6</a>
</span><span class=lnt id=hl-59-7><a class=lnlinks href=#hl-59-7>  7</a>
</span><span class=lnt id=hl-59-8><a class=lnlinks href=#hl-59-8>  8</a>
</span><span class=lnt id=hl-59-9><a class=lnlinks href=#hl-59-9>  9</a>
</span><span class=lnt id=hl-59-10><a class=lnlinks href=#hl-59-10> 10</a>
</span><span class=lnt id=hl-59-11><a class=lnlinks href=#hl-59-11> 11</a>
</span><span class=lnt id=hl-59-12><a class=lnlinks href=#hl-59-12> 12</a>
</span><span class=lnt id=hl-59-13><a class=lnlinks href=#hl-59-13> 13</a>
</span><span class=lnt id=hl-59-14><a class=lnlinks href=#hl-59-14> 14</a>
</span><span class=lnt id=hl-59-15><a class=lnlinks href=#hl-59-15> 15</a>
</span><span class=lnt id=hl-59-16><a class=lnlinks href=#hl-59-16> 16</a>
</span><span class=lnt id=hl-59-17><a class=lnlinks href=#hl-59-17> 17</a>
</span><span class=lnt id=hl-59-18><a class=lnlinks href=#hl-59-18> 18</a>
</span><span class=lnt id=hl-59-19><a class=lnlinks href=#hl-59-19> 19</a>
</span><span class=lnt id=hl-59-20><a class=lnlinks href=#hl-59-20> 20</a>
</span><span class=lnt id=hl-59-21><a class=lnlinks href=#hl-59-21> 21</a>
</span><span class=lnt id=hl-59-22><a class=lnlinks href=#hl-59-22> 22</a>
</span><span class=lnt id=hl-59-23><a class=lnlinks href=#hl-59-23> 23</a>
</span><span class=lnt id=hl-59-24><a class=lnlinks href=#hl-59-24> 24</a>
</span><span class=lnt id=hl-59-25><a class=lnlinks href=#hl-59-25> 25</a>
</span><span class=lnt id=hl-59-26><a class=lnlinks href=#hl-59-26> 26</a>
</span><span class=lnt id=hl-59-27><a class=lnlinks href=#hl-59-27> 27</a>
</span><span class=lnt id=hl-59-28><a class=lnlinks href=#hl-59-28> 28</a>
</span><span class=lnt id=hl-59-29><a class=lnlinks href=#hl-59-29> 29</a>
</span><span class=lnt id=hl-59-30><a class=lnlinks href=#hl-59-30> 30</a>
</span><span class=lnt id=hl-59-31><a class=lnlinks href=#hl-59-31> 31</a>
</span><span class=lnt id=hl-59-32><a class=lnlinks href=#hl-59-32> 32</a>
</span><span class=lnt id=hl-59-33><a class=lnlinks href=#hl-59-33> 33</a>
</span><span class=lnt id=hl-59-34><a class=lnlinks href=#hl-59-34> 34</a>
</span><span class=lnt id=hl-59-35><a class=lnlinks href=#hl-59-35> 35</a>
</span><span class=lnt id=hl-59-36><a class=lnlinks href=#hl-59-36> 36</a>
</span><span class=lnt id=hl-59-37><a class=lnlinks href=#hl-59-37> 37</a>
</span><span class=lnt id=hl-59-38><a class=lnlinks href=#hl-59-38> 38</a>
</span><span class=lnt id=hl-59-39><a class=lnlinks href=#hl-59-39> 39</a>
</span><span class=lnt id=hl-59-40><a class=lnlinks href=#hl-59-40> 40</a>
</span><span class=lnt id=hl-59-41><a class=lnlinks href=#hl-59-41> 41</a>
</span><span class=lnt id=hl-59-42><a class=lnlinks href=#hl-59-42> 42</a>
</span><span class=lnt id=hl-59-43><a class=lnlinks href=#hl-59-43> 43</a>
</span><span class=lnt id=hl-59-44><a class=lnlinks href=#hl-59-44> 44</a>
</span><span class=lnt id=hl-59-45><a class=lnlinks href=#hl-59-45> 45</a>
</span><span class=lnt id=hl-59-46><a class=lnlinks href=#hl-59-46> 46</a>
</span><span class=lnt id=hl-59-47><a class=lnlinks href=#hl-59-47> 47</a>
</span><span class=lnt id=hl-59-48><a class=lnlinks href=#hl-59-48> 48</a>
</span><span class=lnt id=hl-59-49><a class=lnlinks href=#hl-59-49> 49</a>
</span><span class=lnt id=hl-59-50><a class=lnlinks href=#hl-59-50> 50</a>
</span><span class=lnt id=hl-59-51><a class=lnlinks href=#hl-59-51> 51</a>
</span><span class=lnt id=hl-59-52><a class=lnlinks href=#hl-59-52> 52</a>
</span><span class=lnt id=hl-59-53><a class=lnlinks href=#hl-59-53> 53</a>
</span><span class=lnt id=hl-59-54><a class=lnlinks href=#hl-59-54> 54</a>
</span><span class=lnt id=hl-59-55><a class=lnlinks href=#hl-59-55> 55</a>
</span><span class=lnt id=hl-59-56><a class=lnlinks href=#hl-59-56> 56</a>
</span><span class=lnt id=hl-59-57><a class=lnlinks href=#hl-59-57> 57</a>
</span><span class=lnt id=hl-59-58><a class=lnlinks href=#hl-59-58> 58</a>
</span><span class=lnt id=hl-59-59><a class=lnlinks href=#hl-59-59> 59</a>
</span><span class=lnt id=hl-59-60><a class=lnlinks href=#hl-59-60> 60</a>
</span><span class=lnt id=hl-59-61><a class=lnlinks href=#hl-59-61> 61</a>
</span><span class=lnt id=hl-59-62><a class=lnlinks href=#hl-59-62> 62</a>
</span><span class=lnt id=hl-59-63><a class=lnlinks href=#hl-59-63> 63</a>
</span><span class=lnt id=hl-59-64><a class=lnlinks href=#hl-59-64> 64</a>
</span><span class=lnt id=hl-59-65><a class=lnlinks href=#hl-59-65> 65</a>
</span><span class=lnt id=hl-59-66><a class=lnlinks href=#hl-59-66> 66</a>
</span><span class=lnt id=hl-59-67><a class=lnlinks href=#hl-59-67> 67</a>
</span><span class=lnt id=hl-59-68><a class=lnlinks href=#hl-59-68> 68</a>
</span><span class=lnt id=hl-59-69><a class=lnlinks href=#hl-59-69> 69</a>
</span><span class=lnt id=hl-59-70><a class=lnlinks href=#hl-59-70> 70</a>
</span><span class=lnt id=hl-59-71><a class=lnlinks href=#hl-59-71> 71</a>
</span><span class=lnt id=hl-59-72><a class=lnlinks href=#hl-59-72> 72</a>
</span><span class=lnt id=hl-59-73><a class=lnlinks href=#hl-59-73> 73</a>
</span><span class=lnt id=hl-59-74><a class=lnlinks href=#hl-59-74> 74</a>
</span><span class=lnt id=hl-59-75><a class=lnlinks href=#hl-59-75> 75</a>
</span><span class=lnt id=hl-59-76><a class=lnlinks href=#hl-59-76> 76</a>
</span><span class=lnt id=hl-59-77><a class=lnlinks href=#hl-59-77> 77</a>
</span><span class=lnt id=hl-59-78><a class=lnlinks href=#hl-59-78> 78</a>
</span><span class=lnt id=hl-59-79><a class=lnlinks href=#hl-59-79> 79</a>
</span><span class=lnt id=hl-59-80><a class=lnlinks href=#hl-59-80> 80</a>
</span><span class=lnt id=hl-59-81><a class=lnlinks href=#hl-59-81> 81</a>
</span><span class=lnt id=hl-59-82><a class=lnlinks href=#hl-59-82> 82</a>
</span><span class=lnt id=hl-59-83><a class=lnlinks href=#hl-59-83> 83</a>
</span><span class=lnt id=hl-59-84><a class=lnlinks href=#hl-59-84> 84</a>
</span><span class=lnt id=hl-59-85><a class=lnlinks href=#hl-59-85> 85</a>
</span><span class=lnt id=hl-59-86><a class=lnlinks href=#hl-59-86> 86</a>
</span><span class=lnt id=hl-59-87><a class=lnlinks href=#hl-59-87> 87</a>
</span><span class=lnt id=hl-59-88><a class=lnlinks href=#hl-59-88> 88</a>
</span><span class=lnt id=hl-59-89><a class=lnlinks href=#hl-59-89> 89</a>
</span><span class=lnt id=hl-59-90><a class=lnlinks href=#hl-59-90> 90</a>
</span><span class=lnt id=hl-59-91><a class=lnlinks href=#hl-59-91> 91</a>
</span><span class=lnt id=hl-59-92><a class=lnlinks href=#hl-59-92> 92</a>
</span><span class=lnt id=hl-59-93><a class=lnlinks href=#hl-59-93> 93</a>
</span><span class=lnt id=hl-59-94><a class=lnlinks href=#hl-59-94> 94</a>
</span><span class=lnt id=hl-59-95><a class=lnlinks href=#hl-59-95> 95</a>
</span><span class=lnt id=hl-59-96><a class=lnlinks href=#hl-59-96> 96</a>
</span><span class=lnt id=hl-59-97><a class=lnlinks href=#hl-59-97> 97</a>
</span><span class=lnt id=hl-59-98><a class=lnlinks href=#hl-59-98> 98</a>
</span><span class=lnt id=hl-59-99><a class=lnlinks href=#hl-59-99> 99</a>
</span><span class=lnt id=hl-59-100><a class=lnlinks href=#hl-59-100>100</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># HorizontalPodAutoscaler - RabbitMQ Consumer 자동 스케일링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-consumer-hpa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-processing-consumer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 복합 메트릭 기반 스케일링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 큐 깊이 기반 스케일링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>External</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>metric</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq_queue_messages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>queue</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;order.processing.queue&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>AverageValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageValue</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100&#34;</span><span class=w>  </span><span class=c># 큐당 평균 100개 메시지 목표</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># CPU 사용률 기반</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>70</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 메모리 사용률 기반  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 스케일링 동작 조정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>behavior</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scaleUp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>stabilizationWindowSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>policies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Percent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Pods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>selectPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Max</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scaleDown</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>stabilizationWindowSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>policies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Percent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>selectPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Min</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># KEDA를 활용한 고급 스케일링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>keda.sh/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ScaledObject</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-consumer-scaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-processing-consumer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicaCount</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicaCount</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>triggers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># RabbitMQ 큐 기반 스케일링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>queueName</span><span class=p>:</span><span class=w> </span><span class=l>order.processing.queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>QueueLength</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;50&#34;</span><span class=w>  </span><span class=c># 큐에 50개 이상 메시지 시 스케일 아웃</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># RabbitMQ 연결 정보</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>amqp://guest:guest@rabbitmq-service:5672/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>vhostName</span><span class=p>:</span><span class=w> </span><span class=l>/ecommerce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 큐 깊이 계산 방식</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>includeUnacked</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># 처리 중인 메시지 포함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Prometheus 메트릭 기반 스케일링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>serverAddress</span><span class=p>:</span><span class=w> </span><span class=l>http://prometheus:9090</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>metricName</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq_queue_consumer_utilisation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>threshold</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.8&#34;</span><span class=w>  </span><span class=c># 컨슈머 활용률 80% 이상</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>query</span><span class=p>:</span><span class=w> </span><span class=l>avg(rabbitmq_queue_consumer_utilisation{queue=&#34;order.processing.queue&#34;})</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=72-생태계-및-관련-기술>7.2 생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술>#</a></h3><h4 id=통합-연계-가능한-핵심-기술>통합 연계 가능한 핵심 기술<a hidden class=anchor aria-hidden=true href=#통합-연계-가능한-핵심-기술>#</a></h4><p><strong>1. 메시지 브로커 생태계</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Message Brokers Ecosystem&#34;
        RABBIT[RabbitMQ&lt;br/&gt;Traditional Messaging]
        KAFKA[Apache Kafka&lt;br/&gt;Event Streaming]
        PULSAR[Apache Pulsar&lt;br/&gt;Multi-tenant Messaging]
        REDIS[Redis Pub/Sub&lt;br/&gt;In-memory Messaging]
        NATS[NATS&lt;br/&gt;Cloud-native Messaging]
    end
    
    subgraph &#34;Integration Patterns&#34;
        BRIDGE[Message Bridge]
        ROUTER[Message Router]
        TRANSFORMER[Message Transformer]
        AGGREGATOR[Message Aggregator]
    end
    
    subgraph &#34;Cloud Services&#34;
        AWS_SQS[AWS SQS/SNS]
        AZURE_SB[Azure Service Bus]
        GCP_PS[GCP Pub/Sub]
        CLOUD_EVENTS[CloudEvents Standard]
    end
    
    RABBIT --&gt; BRIDGE
    KAFKA --&gt; BRIDGE
    BRIDGE --&gt; AWS_SQS
    BRIDGE --&gt; AZURE_SB
    BRIDGE --&gt; GCP_PS
    
    RABBIT --&gt; ROUTER
    ROUTER --&gt; TRANSFORMER
    TRANSFORMER --&gt; AGGREGATOR
</pre><p><strong>2. 하이브리드 메시징 아키텍처</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>  1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>  2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>  3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>  4</a>
</span><span class=lnt id=hl-61-5><a class=lnlinks href=#hl-61-5>  5</a>
</span><span class=lnt id=hl-61-6><a class=lnlinks href=#hl-61-6>  6</a>
</span><span class=lnt id=hl-61-7><a class=lnlinks href=#hl-61-7>  7</a>
</span><span class=lnt id=hl-61-8><a class=lnlinks href=#hl-61-8>  8</a>
</span><span class=lnt id=hl-61-9><a class=lnlinks href=#hl-61-9>  9</a>
</span><span class=lnt id=hl-61-10><a class=lnlinks href=#hl-61-10> 10</a>
</span><span class=lnt id=hl-61-11><a class=lnlinks href=#hl-61-11> 11</a>
</span><span class=lnt id=hl-61-12><a class=lnlinks href=#hl-61-12> 12</a>
</span><span class=lnt id=hl-61-13><a class=lnlinks href=#hl-61-13> 13</a>
</span><span class=lnt id=hl-61-14><a class=lnlinks href=#hl-61-14> 14</a>
</span><span class=lnt id=hl-61-15><a class=lnlinks href=#hl-61-15> 15</a>
</span><span class=lnt id=hl-61-16><a class=lnlinks href=#hl-61-16> 16</a>
</span><span class=lnt id=hl-61-17><a class=lnlinks href=#hl-61-17> 17</a>
</span><span class=lnt id=hl-61-18><a class=lnlinks href=#hl-61-18> 18</a>
</span><span class=lnt id=hl-61-19><a class=lnlinks href=#hl-61-19> 19</a>
</span><span class=lnt id=hl-61-20><a class=lnlinks href=#hl-61-20> 20</a>
</span><span class=lnt id=hl-61-21><a class=lnlinks href=#hl-61-21> 21</a>
</span><span class=lnt id=hl-61-22><a class=lnlinks href=#hl-61-22> 22</a>
</span><span class=lnt id=hl-61-23><a class=lnlinks href=#hl-61-23> 23</a>
</span><span class=lnt id=hl-61-24><a class=lnlinks href=#hl-61-24> 24</a>
</span><span class=lnt id=hl-61-25><a class=lnlinks href=#hl-61-25> 25</a>
</span><span class=lnt id=hl-61-26><a class=lnlinks href=#hl-61-26> 26</a>
</span><span class=lnt id=hl-61-27><a class=lnlinks href=#hl-61-27> 27</a>
</span><span class=lnt id=hl-61-28><a class=lnlinks href=#hl-61-28> 28</a>
</span><span class=lnt id=hl-61-29><a class=lnlinks href=#hl-61-29> 29</a>
</span><span class=lnt id=hl-61-30><a class=lnlinks href=#hl-61-30> 30</a>
</span><span class=lnt id=hl-61-31><a class=lnlinks href=#hl-61-31> 31</a>
</span><span class=lnt id=hl-61-32><a class=lnlinks href=#hl-61-32> 32</a>
</span><span class=lnt id=hl-61-33><a class=lnlinks href=#hl-61-33> 33</a>
</span><span class=lnt id=hl-61-34><a class=lnlinks href=#hl-61-34> 34</a>
</span><span class=lnt id=hl-61-35><a class=lnlinks href=#hl-61-35> 35</a>
</span><span class=lnt id=hl-61-36><a class=lnlinks href=#hl-61-36> 36</a>
</span><span class=lnt id=hl-61-37><a class=lnlinks href=#hl-61-37> 37</a>
</span><span class=lnt id=hl-61-38><a class=lnlinks href=#hl-61-38> 38</a>
</span><span class=lnt id=hl-61-39><a class=lnlinks href=#hl-61-39> 39</a>
</span><span class=lnt id=hl-61-40><a class=lnlinks href=#hl-61-40> 40</a>
</span><span class=lnt id=hl-61-41><a class=lnlinks href=#hl-61-41> 41</a>
</span><span class=lnt id=hl-61-42><a class=lnlinks href=#hl-61-42> 42</a>
</span><span class=lnt id=hl-61-43><a class=lnlinks href=#hl-61-43> 43</a>
</span><span class=lnt id=hl-61-44><a class=lnlinks href=#hl-61-44> 44</a>
</span><span class=lnt id=hl-61-45><a class=lnlinks href=#hl-61-45> 45</a>
</span><span class=lnt id=hl-61-46><a class=lnlinks href=#hl-61-46> 46</a>
</span><span class=lnt id=hl-61-47><a class=lnlinks href=#hl-61-47> 47</a>
</span><span class=lnt id=hl-61-48><a class=lnlinks href=#hl-61-48> 48</a>
</span><span class=lnt id=hl-61-49><a class=lnlinks href=#hl-61-49> 49</a>
</span><span class=lnt id=hl-61-50><a class=lnlinks href=#hl-61-50> 50</a>
</span><span class=lnt id=hl-61-51><a class=lnlinks href=#hl-61-51> 51</a>
</span><span class=lnt id=hl-61-52><a class=lnlinks href=#hl-61-52> 52</a>
</span><span class=lnt id=hl-61-53><a class=lnlinks href=#hl-61-53> 53</a>
</span><span class=lnt id=hl-61-54><a class=lnlinks href=#hl-61-54> 54</a>
</span><span class=lnt id=hl-61-55><a class=lnlinks href=#hl-61-55> 55</a>
</span><span class=lnt id=hl-61-56><a class=lnlinks href=#hl-61-56> 56</a>
</span><span class=lnt id=hl-61-57><a class=lnlinks href=#hl-61-57> 57</a>
</span><span class=lnt id=hl-61-58><a class=lnlinks href=#hl-61-58> 58</a>
</span><span class=lnt id=hl-61-59><a class=lnlinks href=#hl-61-59> 59</a>
</span><span class=lnt id=hl-61-60><a class=lnlinks href=#hl-61-60> 60</a>
</span><span class=lnt id=hl-61-61><a class=lnlinks href=#hl-61-61> 61</a>
</span><span class=lnt id=hl-61-62><a class=lnlinks href=#hl-61-62> 62</a>
</span><span class=lnt id=hl-61-63><a class=lnlinks href=#hl-61-63> 63</a>
</span><span class=lnt id=hl-61-64><a class=lnlinks href=#hl-61-64> 64</a>
</span><span class=lnt id=hl-61-65><a class=lnlinks href=#hl-61-65> 65</a>
</span><span class=lnt id=hl-61-66><a class=lnlinks href=#hl-61-66> 66</a>
</span><span class=lnt id=hl-61-67><a class=lnlinks href=#hl-61-67> 67</a>
</span><span class=lnt id=hl-61-68><a class=lnlinks href=#hl-61-68> 68</a>
</span><span class=lnt id=hl-61-69><a class=lnlinks href=#hl-61-69> 69</a>
</span><span class=lnt id=hl-61-70><a class=lnlinks href=#hl-61-70> 70</a>
</span><span class=lnt id=hl-61-71><a class=lnlinks href=#hl-61-71> 71</a>
</span><span class=lnt id=hl-61-72><a class=lnlinks href=#hl-61-72> 72</a>
</span><span class=lnt id=hl-61-73><a class=lnlinks href=#hl-61-73> 73</a>
</span><span class=lnt id=hl-61-74><a class=lnlinks href=#hl-61-74> 74</a>
</span><span class=lnt id=hl-61-75><a class=lnlinks href=#hl-61-75> 75</a>
</span><span class=lnt id=hl-61-76><a class=lnlinks href=#hl-61-76> 76</a>
</span><span class=lnt id=hl-61-77><a class=lnlinks href=#hl-61-77> 77</a>
</span><span class=lnt id=hl-61-78><a class=lnlinks href=#hl-61-78> 78</a>
</span><span class=lnt id=hl-61-79><a class=lnlinks href=#hl-61-79> 79</a>
</span><span class=lnt id=hl-61-80><a class=lnlinks href=#hl-61-80> 80</a>
</span><span class=lnt id=hl-61-81><a class=lnlinks href=#hl-61-81> 81</a>
</span><span class=lnt id=hl-61-82><a class=lnlinks href=#hl-61-82> 82</a>
</span><span class=lnt id=hl-61-83><a class=lnlinks href=#hl-61-83> 83</a>
</span><span class=lnt id=hl-61-84><a class=lnlinks href=#hl-61-84> 84</a>
</span><span class=lnt id=hl-61-85><a class=lnlinks href=#hl-61-85> 85</a>
</span><span class=lnt id=hl-61-86><a class=lnlinks href=#hl-61-86> 86</a>
</span><span class=lnt id=hl-61-87><a class=lnlinks href=#hl-61-87> 87</a>
</span><span class=lnt id=hl-61-88><a class=lnlinks href=#hl-61-88> 88</a>
</span><span class=lnt id=hl-61-89><a class=lnlinks href=#hl-61-89> 89</a>
</span><span class=lnt id=hl-61-90><a class=lnlinks href=#hl-61-90> 90</a>
</span><span class=lnt id=hl-61-91><a class=lnlinks href=#hl-61-91> 91</a>
</span><span class=lnt id=hl-61-92><a class=lnlinks href=#hl-61-92> 92</a>
</span><span class=lnt id=hl-61-93><a class=lnlinks href=#hl-61-93> 93</a>
</span><span class=lnt id=hl-61-94><a class=lnlinks href=#hl-61-94> 94</a>
</span><span class=lnt id=hl-61-95><a class=lnlinks href=#hl-61-95> 95</a>
</span><span class=lnt id=hl-61-96><a class=lnlinks href=#hl-61-96> 96</a>
</span><span class=lnt id=hl-61-97><a class=lnlinks href=#hl-61-97> 97</a>
</span><span class=lnt id=hl-61-98><a class=lnlinks href=#hl-61-98> 98</a>
</span><span class=lnt id=hl-61-99><a class=lnlinks href=#hl-61-99> 99</a>
</span><span class=lnt id=hl-61-100><a class=lnlinks href=#hl-61-100>100</a>
</span><span class=lnt id=hl-61-101><a class=lnlinks href=#hl-61-101>101</a>
</span><span class=lnt id=hl-61-102><a class=lnlinks href=#hl-61-102>102</a>
</span><span class=lnt id=hl-61-103><a class=lnlinks href=#hl-61-103>103</a>
</span><span class=lnt id=hl-61-104><a class=lnlinks href=#hl-61-104>104</a>
</span><span class=lnt id=hl-61-105><a class=lnlinks href=#hl-61-105>105</a>
</span><span class=lnt id=hl-61-106><a class=lnlinks href=#hl-61-106>106</a>
</span><span class=lnt id=hl-61-107><a class=lnlinks href=#hl-61-107>107</a>
</span><span class=lnt id=hl-61-108><a class=lnlinks href=#hl-61-108>108</a>
</span><span class=lnt id=hl-61-109><a class=lnlinks href=#hl-61-109>109</a>
</span><span class=lnt id=hl-61-110><a class=lnlinks href=#hl-61-110>110</a>
</span><span class=lnt id=hl-61-111><a class=lnlinks href=#hl-61-111>111</a>
</span><span class=lnt id=hl-61-112><a class=lnlinks href=#hl-61-112>112</a>
</span><span class=lnt id=hl-61-113><a class=lnlinks href=#hl-61-113>113</a>
</span><span class=lnt id=hl-61-114><a class=lnlinks href=#hl-61-114>114</a>
</span><span class=lnt id=hl-61-115><a class=lnlinks href=#hl-61-115>115</a>
</span><span class=lnt id=hl-61-116><a class=lnlinks href=#hl-61-116>116</a>
</span><span class=lnt id=hl-61-117><a class=lnlinks href=#hl-61-117>117</a>
</span><span class=lnt id=hl-61-118><a class=lnlinks href=#hl-61-118>118</a>
</span><span class=lnt id=hl-61-119><a class=lnlinks href=#hl-61-119>119</a>
</span><span class=lnt id=hl-61-120><a class=lnlinks href=#hl-61-120>120</a>
</span><span class=lnt id=hl-61-121><a class=lnlinks href=#hl-61-121>121</a>
</span><span class=lnt id=hl-61-122><a class=lnlinks href=#hl-61-122>122</a>
</span><span class=lnt id=hl-61-123><a class=lnlinks href=#hl-61-123>123</a>
</span><span class=lnt id=hl-61-124><a class=lnlinks href=#hl-61-124>124</a>
</span><span class=lnt id=hl-61-125><a class=lnlinks href=#hl-61-125>125</a>
</span><span class=lnt id=hl-61-126><a class=lnlinks href=#hl-61-126>126</a>
</span><span class=lnt id=hl-61-127><a class=lnlinks href=#hl-61-127>127</a>
</span><span class=lnt id=hl-61-128><a class=lnlinks href=#hl-61-128>128</a>
</span><span class=lnt id=hl-61-129><a class=lnlinks href=#hl-61-129>129</a>
</span><span class=lnt id=hl-61-130><a class=lnlinks href=#hl-61-130>130</a>
</span><span class=lnt id=hl-61-131><a class=lnlinks href=#hl-61-131>131</a>
</span><span class=lnt id=hl-61-132><a class=lnlinks href=#hl-61-132>132</a>
</span><span class=lnt id=hl-61-133><a class=lnlinks href=#hl-61-133>133</a>
</span><span class=lnt id=hl-61-134><a class=lnlinks href=#hl-61-134>134</a>
</span><span class=lnt id=hl-61-135><a class=lnlinks href=#hl-61-135>135</a>
</span><span class=lnt id=hl-61-136><a class=lnlinks href=#hl-61-136>136</a>
</span><span class=lnt id=hl-61-137><a class=lnlinks href=#hl-61-137>137</a>
</span><span class=lnt id=hl-61-138><a class=lnlinks href=#hl-61-138>138</a>
</span><span class=lnt id=hl-61-139><a class=lnlinks href=#hl-61-139>139</a>
</span><span class=lnt id=hl-61-140><a class=lnlinks href=#hl-61-140>140</a>
</span><span class=lnt id=hl-61-141><a class=lnlinks href=#hl-61-141>141</a>
</span><span class=lnt id=hl-61-142><a class=lnlinks href=#hl-61-142>142</a>
</span><span class=lnt id=hl-61-143><a class=lnlinks href=#hl-61-143>143</a>
</span><span class=lnt id=hl-61-144><a class=lnlinks href=#hl-61-144>144</a>
</span><span class=lnt id=hl-61-145><a class=lnlinks href=#hl-61-145>145</a>
</span><span class=lnt id=hl-61-146><a class=lnlinks href=#hl-61-146>146</a>
</span><span class=lnt id=hl-61-147><a class=lnlinks href=#hl-61-147>147</a>
</span><span class=lnt id=hl-61-148><a class=lnlinks href=#hl-61-148>148</a>
</span><span class=lnt id=hl-61-149><a class=lnlinks href=#hl-61-149>149</a>
</span><span class=lnt id=hl-61-150><a class=lnlinks href=#hl-61-150>150</a>
</span><span class=lnt id=hl-61-151><a class=lnlinks href=#hl-61-151>151</a>
</span><span class=lnt id=hl-61-152><a class=lnlinks href=#hl-61-152>152</a>
</span><span class=lnt id=hl-61-153><a class=lnlinks href=#hl-61-153>153</a>
</span><span class=lnt id=hl-61-154><a class=lnlinks href=#hl-61-154>154</a>
</span><span class=lnt id=hl-61-155><a class=lnlinks href=#hl-61-155>155</a>
</span><span class=lnt id=hl-61-156><a class=lnlinks href=#hl-61-156>156</a>
</span><span class=lnt id=hl-61-157><a class=lnlinks href=#hl-61-157>157</a>
</span><span class=lnt id=hl-61-158><a class=lnlinks href=#hl-61-158>158</a>
</span><span class=lnt id=hl-61-159><a class=lnlinks href=#hl-61-159>159</a>
</span><span class=lnt id=hl-61-160><a class=lnlinks href=#hl-61-160>160</a>
</span><span class=lnt id=hl-61-161><a class=lnlinks href=#hl-61-161>161</a>
</span><span class=lnt id=hl-61-162><a class=lnlinks href=#hl-61-162>162</a>
</span><span class=lnt id=hl-61-163><a class=lnlinks href=#hl-61-163>163</a>
</span><span class=lnt id=hl-61-164><a class=lnlinks href=#hl-61-164>164</a>
</span><span class=lnt id=hl-61-165><a class=lnlinks href=#hl-61-165>165</a>
</span><span class=lnt id=hl-61-166><a class=lnlinks href=#hl-61-166>166</a>
</span><span class=lnt id=hl-61-167><a class=lnlinks href=#hl-61-167>167</a>
</span><span class=lnt id=hl-61-168><a class=lnlinks href=#hl-61-168>168</a>
</span><span class=lnt id=hl-61-169><a class=lnlinks href=#hl-61-169>169</a>
</span><span class=lnt id=hl-61-170><a class=lnlinks href=#hl-61-170>170</a>
</span><span class=lnt id=hl-61-171><a class=lnlinks href=#hl-61-171>171</a>
</span><span class=lnt id=hl-61-172><a class=lnlinks href=#hl-61-172>172</a>
</span><span class=lnt id=hl-61-173><a class=lnlinks href=#hl-61-173>173</a>
</span><span class=lnt id=hl-61-174><a class=lnlinks href=#hl-61-174>174</a>
</span><span class=lnt id=hl-61-175><a class=lnlinks href=#hl-61-175>175</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ + Kafka 하이브리드 메시징 시스템</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Union</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageRoute</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메시지 라우팅 규칙&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>broker_type</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># &#39;rabbitmq&#39; or &#39;kafka&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>topic_queue</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>priority</span><span class=p>:</span> <span class=nb>str</span>     <span class=c1># &#39;high&#39;, &#39;medium&#39;, &#39;low&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>durability</span><span class=p>:</span> <span class=nb>str</span>   <span class=c1># &#39;persistent&#39;, &#39;transient&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HybridMessageBroker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ + Kafka 하이브리드 메시징 시스템
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 특성에 따른 최적 브로커 선택
</span></span></span><span class=line><span class=cl><span class=s2>    - 트랜잭셔널 메시지 → RabbitMQ
</span></span></span><span class=line><span class=cl><span class=s2>    - 스트리밍 데이터 → Kafka
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>rabbitmq_client</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># RabbitMQ 클라이언트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_client</span> <span class=o>=</span> <span class=kc>None</span>     <span class=c1># Kafka 클라이언트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=c1># 실시간 알림 → RabbitMQ (낮은 지연시간)</span>
</span></span><span class=line><span class=cl>            <span class=n>MessageRoute</span><span class=p>(</span><span class=s2>&#34;*.notification.*&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>,</span> <span class=s2>&#34;notifications&#34;</span><span class=p>,</span> <span class=s2>&#34;high&#34;</span><span class=p>,</span> <span class=s2>&#34;transient&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 주문 처리 → RabbitMQ (트랜잭션 보장)</span>
</span></span><span class=line><span class=cl>            <span class=n>MessageRoute</span><span class=p>(</span><span class=s2>&#34;order.*&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>,</span> <span class=s2>&#34;order.events&#34;</span><span class=p>,</span> <span class=s2>&#34;high&#34;</span><span class=p>,</span> <span class=s2>&#34;persistent&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 로그 데이터 → Kafka (높은 처리량)</span>
</span></span><span class=line><span class=cl>            <span class=n>MessageRoute</span><span class=p>(</span><span class=s2>&#34;logs.*&#34;</span><span class=p>,</span> <span class=s2>&#34;kafka&#34;</span><span class=p>,</span> <span class=s2>&#34;application-logs&#34;</span><span class=p>,</span> <span class=s2>&#34;low&#34;</span><span class=p>,</span> <span class=s2>&#34;persistent&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 분석 데이터 → Kafka (배치 처리)</span>
</span></span><span class=line><span class=cl>            <span class=n>MessageRoute</span><span class=p>(</span><span class=s2>&#34;analytics.*&#34;</span><span class=p>,</span> <span class=s2>&#34;kafka&#34;</span><span class=p>,</span> <span class=s2>&#34;analytics-events&#34;</span><span class=p>,</span> <span class=s2>&#34;medium&#34;</span><span class=p>,</span> <span class=s2>&#34;persistent&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실시간 추천 → RabbitMQ (빠른 응답)</span>
</span></span><span class=line><span class=cl>            <span class=n>MessageRoute</span><span class=p>(</span><span class=s2>&#34;recommendation.*&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>,</span> <span class=s2>&#34;recommendations&#34;</span><span class=p>,</span> <span class=s2>&#34;high&#34;</span><span class=p>,</span> <span class=s2>&#34;transient&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Any</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        메시지 특성에 따른 최적 브로커 선택 및 발행
</span></span></span><span class=line><span class=cl><span class=s2>        - 라우팅 규칙 기반 브로커 결정
</span></span></span><span class=line><span class=cl><span class=s2>        - 메시지 특성에 맞는 설정 적용
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>broker_config</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_select_broker</span><span class=p>(</span><span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>broker_config</span><span class=o>.</span><span class=n>broker_type</span> <span class=o>==</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_publish_to_rabbitmq</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>routing_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>broker_config</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>broker_config</span><span class=o>.</span><span class=n>broker_type</span> <span class=o>==</span> <span class=s2>&#34;kafka&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_publish_to_kafka</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>routing_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>broker_config</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_select_broker</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>MessageRoute</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;라우팅 키 기반 브로커 선택&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>fnmatch</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>rule</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>fnmatch</span><span class=o>.</span><span class=n>fnmatch</span><span class=p>(</span><span class=n>routing_key</span><span class=p>,</span> <span class=n>rule</span><span class=o>.</span><span class=n>pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>rule</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 기본값: RabbitMQ</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>MessageRoute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>,</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=s2>&#34;medium&#34;</span><span class=p>,</span> <span class=s2>&#34;persistent&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_publish_to_rabbitmq</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                  <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>MessageRoute</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;RabbitMQ 메시지 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 트랜잭셔널 메시지 처리에 최적화</span>
</span></span><span class=line><span class=cl>        <span class=n>publish_properties</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;delivery_mode&#39;</span><span class=p>:</span> <span class=mi>2</span> <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>durability</span> <span class=o>==</span> <span class=s1>&#39;persistent&#39;</span> <span class=k>else</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_map_priority_to_number</span><span class=p>(</span><span class=n>config</span><span class=o>.</span><span class=n>priority</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;content_type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;headers&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;x-source-broker&#39;</span><span class=p>:</span> <span class=s1>&#39;hybrid-system&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;x-routing-key&#39;</span><span class=p>:</span> <span class=n>routing_key</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Publisher Confirms를 통한 안정성 보장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>rabbitmq_client</span><span class=o>.</span><span class=n>publish_with_confirm</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;hybrid.events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=n>routing_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>publish_properties</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_publish_to_kafka</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                               <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>MessageRoute</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 메시지 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 높은 처리량 스트리밍에 최적화</span>
</span></span><span class=line><span class=cl>        <span class=n>kafka_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;key&#39;</span><span class=p>:</span> <span class=n>routing_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;headers&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;source&#39;</span><span class=p>:</span> <span class=s1>&#39;hybrid-system&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;routing-key&#39;</span><span class=p>:</span> <span class=n>routing_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;priority&#39;</span><span class=p>:</span> <span class=n>config</span><span class=o>.</span><span class=n>priority</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배치 처리를 통한 성능 최적화</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>kafka_client</span><span class=o>.</span><span class=n>send_batch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>topic_queue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>messages</span><span class=o>=</span><span class=p>[</span><span class=n>kafka_message</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>batch_size</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>linger_ms</span><span class=o>=</span><span class=mi>10</span>  <span class=c1># 10ms 배치 대기</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>setup_cross_broker_replication</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        브로커 간 크로스 복제 설정
</span></span></span><span class=line><span class=cl><span class=s2>        - 중요 메시지의 이중화 보장
</span></span></span><span class=line><span class=cl><span class=s2>        - 브로커 장애 시 페일오버 지원
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># RabbitMQ → Kafka 복제 (장기 저장용)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_setup_rabbitmq_to_kafka_replication</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Kafka → RabbitMQ 복제 (실시간 알림용)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_setup_kafka_to_rabbitmq_replication</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_setup_rabbitmq_to_kafka_replication</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;RabbitMQ에서 Kafka로 메시지 복제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>replicate_to_kafka</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            중요 메시지를 Kafka로 복제
</span></span></span><span class=line><span class=cl><span class=s2>            - 장기 보관 및 분석 목적
</span></span></span><span class=line><span class=cl><span class=s2>            - 비동기 복제로 성능 영향 최소화
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>message_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 복제 대상 메시지 필터링</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>properties</span><span class=o>.</span><span class=n>headers</span> <span class=ow>and</span> <span class=n>properties</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;replicate-to-kafka&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>kafka_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>topic</span><span class=o>=</span><span class=s1>&#39;rabbitmq-replicated-messages&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>key</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>routing_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>value</span><span class=o>=</span><span class=n>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>headers</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;source-broker&#39;</span><span class=p>:</span> <span class=s1>&#39;rabbitmq&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;original-routing-key&#39;</span><span class=p>:</span> <span class=n>method</span><span class=o>.</span><span class=n>routing_key</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># RabbitMQ 복제 컨슈머 등록</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>rabbitmq_client</span><span class=o>.</span><span class=n>consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;replication.outbound&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>callback</span><span class=o>=</span><span class=n>replicate_to_kafka</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>hybrid_broker</span> <span class=o>=</span> <span class=n>HybridMessageBroker</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 알림 (RabbitMQ 최적)</span>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>hybrid_broker</span><span class=o>.</span><span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;user.notification.email&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=s1>&#39;12345&#39;</span><span class=p>,</span> <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Order confirmed&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 로그 데이터 (Kafka 최적)</span>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>hybrid_broker</span><span class=o>.</span><span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;logs.application.error&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s1>&#39;level&#39;</span><span class=p>:</span> <span class=s1>&#39;ERROR&#39;</span><span class=p>,</span> <span class=s1>&#39;service&#39;</span><span class=p>:</span> <span class=s1>&#39;order-service&#39;</span><span class=p>,</span> <span class=s1>&#39;details&#39;</span><span class=p>:</span> <span class=s1>&#39;...&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=표준-및-프로토콜-통합>표준 및 프로토콜 통합<a hidden class=anchor aria-hidden=true href=#표준-및-프로토콜-통합>#</a></h4><p><strong>1. CloudEvents 표준 통합</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1> 1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2> 2</a>
</span><span class=lnt id=hl-62-3><a class=lnlinks href=#hl-62-3> 3</a>
</span><span class=lnt id=hl-62-4><a class=lnlinks href=#hl-62-4> 4</a>
</span><span class=lnt id=hl-62-5><a class=lnlinks href=#hl-62-5> 5</a>
</span><span class=lnt id=hl-62-6><a class=lnlinks href=#hl-62-6> 6</a>
</span><span class=lnt id=hl-62-7><a class=lnlinks href=#hl-62-7> 7</a>
</span><span class=lnt id=hl-62-8><a class=lnlinks href=#hl-62-8> 8</a>
</span><span class=lnt id=hl-62-9><a class=lnlinks href=#hl-62-9> 9</a>
</span><span class=lnt id=hl-62-10><a class=lnlinks href=#hl-62-10>10</a>
</span><span class=lnt id=hl-62-11><a class=lnlinks href=#hl-62-11>11</a>
</span><span class=lnt id=hl-62-12><a class=lnlinks href=#hl-62-12>12</a>
</span><span class=lnt id=hl-62-13><a class=lnlinks href=#hl-62-13>13</a>
</span><span class=lnt id=hl-62-14><a class=lnlinks href=#hl-62-14>14</a>
</span><span class=lnt id=hl-62-15><a class=lnlinks href=#hl-62-15>15</a>
</span><span class=lnt id=hl-62-16><a class=lnlinks href=#hl-62-16>16</a>
</span><span class=lnt id=hl-62-17><a class=lnlinks href=#hl-62-17>17</a>
</span><span class=lnt id=hl-62-18><a class=lnlinks href=#hl-62-18>18</a>
</span><span class=lnt id=hl-62-19><a class=lnlinks href=#hl-62-19>19</a>
</span><span class=lnt id=hl-62-20><a class=lnlinks href=#hl-62-20>20</a>
</span><span class=lnt id=hl-62-21><a class=lnlinks href=#hl-62-21>21</a>
</span><span class=lnt id=hl-62-22><a class=lnlinks href=#hl-62-22>22</a>
</span><span class=lnt id=hl-62-23><a class=lnlinks href=#hl-62-23>23</a>
</span><span class=lnt id=hl-62-24><a class=lnlinks href=#hl-62-24>24</a>
</span><span class=lnt id=hl-62-25><a class=lnlinks href=#hl-62-25>25</a>
</span><span class=lnt id=hl-62-26><a class=lnlinks href=#hl-62-26>26</a>
</span><span class=lnt id=hl-62-27><a class=lnlinks href=#hl-62-27>27</a>
</span><span class=lnt id=hl-62-28><a class=lnlinks href=#hl-62-28>28</a>
</span><span class=lnt id=hl-62-29><a class=lnlinks href=#hl-62-29>29</a>
</span><span class=lnt id=hl-62-30><a class=lnlinks href=#hl-62-30>30</a>
</span><span class=lnt id=hl-62-31><a class=lnlinks href=#hl-62-31>31</a>
</span><span class=lnt id=hl-62-32><a class=lnlinks href=#hl-62-32>32</a>
</span><span class=lnt id=hl-62-33><a class=lnlinks href=#hl-62-33>33</a>
</span><span class=lnt id=hl-62-34><a class=lnlinks href=#hl-62-34>34</a>
</span><span class=lnt id=hl-62-35><a class=lnlinks href=#hl-62-35>35</a>
</span><span class=lnt id=hl-62-36><a class=lnlinks href=#hl-62-36>36</a>
</span><span class=lnt id=hl-62-37><a class=lnlinks href=#hl-62-37>37</a>
</span><span class=lnt id=hl-62-38><a class=lnlinks href=#hl-62-38>38</a>
</span><span class=lnt id=hl-62-39><a class=lnlinks href=#hl-62-39>39</a>
</span><span class=lnt id=hl-62-40><a class=lnlinks href=#hl-62-40>40</a>
</span><span class=lnt id=hl-62-41><a class=lnlinks href=#hl-62-41>41</a>
</span><span class=lnt id=hl-62-42><a class=lnlinks href=#hl-62-42>42</a>
</span><span class=lnt id=hl-62-43><a class=lnlinks href=#hl-62-43>43</a>
</span><span class=lnt id=hl-62-44><a class=lnlinks href=#hl-62-44>44</a>
</span><span class=lnt id=hl-62-45><a class=lnlinks href=#hl-62-45>45</a>
</span><span class=lnt id=hl-62-46><a class=lnlinks href=#hl-62-46>46</a>
</span><span class=lnt id=hl-62-47><a class=lnlinks href=#hl-62-47>47</a>
</span><span class=lnt id=hl-62-48><a class=lnlinks href=#hl-62-48>48</a>
</span><span class=lnt id=hl-62-49><a class=lnlinks href=#hl-62-49>49</a>
</span><span class=lnt id=hl-62-50><a class=lnlinks href=#hl-62-50>50</a>
</span><span class=lnt id=hl-62-51><a class=lnlinks href=#hl-62-51>51</a>
</span><span class=lnt id=hl-62-52><a class=lnlinks href=#hl-62-52>52</a>
</span><span class=lnt id=hl-62-53><a class=lnlinks href=#hl-62-53>53</a>
</span><span class=lnt id=hl-62-54><a class=lnlinks href=#hl-62-54>54</a>
</span><span class=lnt id=hl-62-55><a class=lnlinks href=#hl-62-55>55</a>
</span><span class=lnt id=hl-62-56><a class=lnlinks href=#hl-62-56>56</a>
</span><span class=lnt id=hl-62-57><a class=lnlinks href=#hl-62-57>57</a>
</span><span class=lnt id=hl-62-58><a class=lnlinks href=#hl-62-58>58</a>
</span><span class=lnt id=hl-62-59><a class=lnlinks href=#hl-62-59>59</a>
</span><span class=lnt id=hl-62-60><a class=lnlinks href=#hl-62-60>60</a>
</span><span class=lnt id=hl-62-61><a class=lnlinks href=#hl-62-61>61</a>
</span><span class=lnt id=hl-62-62><a class=lnlinks href=#hl-62-62>62</a>
</span><span class=lnt id=hl-62-63><a class=lnlinks href=#hl-62-63>63</a>
</span><span class=lnt id=hl-62-64><a class=lnlinks href=#hl-62-64>64</a>
</span><span class=lnt id=hl-62-65><a class=lnlinks href=#hl-62-65>65</a>
</span><span class=lnt id=hl-62-66><a class=lnlinks href=#hl-62-66>66</a>
</span><span class=lnt id=hl-62-67><a class=lnlinks href=#hl-62-67>67</a>
</span><span class=lnt id=hl-62-68><a class=lnlinks href=#hl-62-68>68</a>
</span><span class=lnt id=hl-62-69><a class=lnlinks href=#hl-62-69>69</a>
</span><span class=lnt id=hl-62-70><a class=lnlinks href=#hl-62-70>70</a>
</span><span class=lnt id=hl-62-71><a class=lnlinks href=#hl-62-71>71</a>
</span><span class=lnt id=hl-62-72><a class=lnlinks href=#hl-62-72>72</a>
</span><span class=lnt id=hl-62-73><a class=lnlinks href=#hl-62-73>73</a>
</span><span class=lnt id=hl-62-74><a class=lnlinks href=#hl-62-74>74</a>
</span><span class=lnt id=hl-62-75><a class=lnlinks href=#hl-62-75>75</a>
</span><span class=lnt id=hl-62-76><a class=lnlinks href=#hl-62-76>76</a>
</span><span class=lnt id=hl-62-77><a class=lnlinks href=#hl-62-77>77</a>
</span><span class=lnt id=hl-62-78><a class=lnlinks href=#hl-62-78>78</a>
</span><span class=lnt id=hl-62-79><a class=lnlinks href=#hl-62-79>79</a>
</span><span class=lnt id=hl-62-80><a class=lnlinks href=#hl-62-80>80</a>
</span><span class=lnt id=hl-62-81><a class=lnlinks href=#hl-62-81>81</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># CloudEvents 표준을 통한 브로커 간 호환성</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cloudevents.http</span> <span class=kn>import</span> <span class=n>CloudEvent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cloudevents.conversion</span> <span class=kn>import</span> <span class=n>to_binary</span><span class=p>,</span> <span class=n>to_structured</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CloudEventsAdapter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    CloudEvents 표준 기반 메시지 통합
</span></span></span><span class=line><span class=cl><span class=s2>    - 브로커 간 표준화된 메시지 형식
</span></span></span><span class=line><span class=cl><span class=s2>    - 멀티 클라우드 환경 호환성
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_bus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span> <span class=o>=</span> <span class=n>event_bus</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_cloud_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>subject</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;CloudEvents 형식으로 메시지 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># CloudEvent 객체 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>CloudEvent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;source&#34;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;subject&#34;</span><span class=p>:</span> <span class=n>subject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;datacontenttype&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;specversion&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># RabbitMQ용 바이너리 형식 변환</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span><span class=p>,</span> <span class=n>body</span> <span class=o>=</span> <span class=n>to_binary</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># RabbitMQ 메시지 속성에 CloudEvents 헤더 매핑</span>
</span></span><span class=line><span class=cl>        <span class=n>rabbitmq_properties</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>headers</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>content_type</span><span class=o>=</span><span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 표준 형식으로 발행</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>event_bus</span><span class=o>.</span><span class=n>publish_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;cloudevents.</span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>=</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>rabbitmq_properties</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_cloud_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;CloudEvents 메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># CloudEvent 헤더 복원</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span> <span class=o>=</span> <span class=n>properties</span><span class=o>.</span><span class=n>headers</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># CloudEvent 객체 재구성</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=n>CloudEvent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ce-type&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;source&#34;</span><span class=p>:</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ce-source&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;subject&#34;</span><span class=p>:</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ce-subject&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;specversion&#34;</span><span class=p>:</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ce-specversion&#39;</span><span class=p>,</span> <span class=s1>&#39;1.0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 이벤트 타입별 처리</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_route_cloud_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;CloudEvent processing failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>adapter</span> <span class=o>=</span> <span class=n>CloudEventsAdapter</span><span class=p>(</span><span class=n>event_bus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 표준 CloudEvent 발행</span>
</span></span><span class=line><span class=cl><span class=n>adapter</span><span class=o>.</span><span class=n>publish_cloud_event</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span><span class=o>=</span><span class=s2>&#34;https://ecommerce.company.com/orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;com.company.order.created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;67890&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>299.99</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>subject</span><span class=o>=</span><span class=s2>&#34;order/12345&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. OpenTelemetry 통합</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-63-1><a class=lnlinks href=#hl-63-1>  1</a>
</span><span class=lnt id=hl-63-2><a class=lnlinks href=#hl-63-2>  2</a>
</span><span class=lnt id=hl-63-3><a class=lnlinks href=#hl-63-3>  3</a>
</span><span class=lnt id=hl-63-4><a class=lnlinks href=#hl-63-4>  4</a>
</span><span class=lnt id=hl-63-5><a class=lnlinks href=#hl-63-5>  5</a>
</span><span class=lnt id=hl-63-6><a class=lnlinks href=#hl-63-6>  6</a>
</span><span class=lnt id=hl-63-7><a class=lnlinks href=#hl-63-7>  7</a>
</span><span class=lnt id=hl-63-8><a class=lnlinks href=#hl-63-8>  8</a>
</span><span class=lnt id=hl-63-9><a class=lnlinks href=#hl-63-9>  9</a>
</span><span class=lnt id=hl-63-10><a class=lnlinks href=#hl-63-10> 10</a>
</span><span class=lnt id=hl-63-11><a class=lnlinks href=#hl-63-11> 11</a>
</span><span class=lnt id=hl-63-12><a class=lnlinks href=#hl-63-12> 12</a>
</span><span class=lnt id=hl-63-13><a class=lnlinks href=#hl-63-13> 13</a>
</span><span class=lnt id=hl-63-14><a class=lnlinks href=#hl-63-14> 14</a>
</span><span class=lnt id=hl-63-15><a class=lnlinks href=#hl-63-15> 15</a>
</span><span class=lnt id=hl-63-16><a class=lnlinks href=#hl-63-16> 16</a>
</span><span class=lnt id=hl-63-17><a class=lnlinks href=#hl-63-17> 17</a>
</span><span class=lnt id=hl-63-18><a class=lnlinks href=#hl-63-18> 18</a>
</span><span class=lnt id=hl-63-19><a class=lnlinks href=#hl-63-19> 19</a>
</span><span class=lnt id=hl-63-20><a class=lnlinks href=#hl-63-20> 20</a>
</span><span class=lnt id=hl-63-21><a class=lnlinks href=#hl-63-21> 21</a>
</span><span class=lnt id=hl-63-22><a class=lnlinks href=#hl-63-22> 22</a>
</span><span class=lnt id=hl-63-23><a class=lnlinks href=#hl-63-23> 23</a>
</span><span class=lnt id=hl-63-24><a class=lnlinks href=#hl-63-24> 24</a>
</span><span class=lnt id=hl-63-25><a class=lnlinks href=#hl-63-25> 25</a>
</span><span class=lnt id=hl-63-26><a class=lnlinks href=#hl-63-26> 26</a>
</span><span class=lnt id=hl-63-27><a class=lnlinks href=#hl-63-27> 27</a>
</span><span class=lnt id=hl-63-28><a class=lnlinks href=#hl-63-28> 28</a>
</span><span class=lnt id=hl-63-29><a class=lnlinks href=#hl-63-29> 29</a>
</span><span class=lnt id=hl-63-30><a class=lnlinks href=#hl-63-30> 30</a>
</span><span class=lnt id=hl-63-31><a class=lnlinks href=#hl-63-31> 31</a>
</span><span class=lnt id=hl-63-32><a class=lnlinks href=#hl-63-32> 32</a>
</span><span class=lnt id=hl-63-33><a class=lnlinks href=#hl-63-33> 33</a>
</span><span class=lnt id=hl-63-34><a class=lnlinks href=#hl-63-34> 34</a>
</span><span class=lnt id=hl-63-35><a class=lnlinks href=#hl-63-35> 35</a>
</span><span class=lnt id=hl-63-36><a class=lnlinks href=#hl-63-36> 36</a>
</span><span class=lnt id=hl-63-37><a class=lnlinks href=#hl-63-37> 37</a>
</span><span class=lnt id=hl-63-38><a class=lnlinks href=#hl-63-38> 38</a>
</span><span class=lnt id=hl-63-39><a class=lnlinks href=#hl-63-39> 39</a>
</span><span class=lnt id=hl-63-40><a class=lnlinks href=#hl-63-40> 40</a>
</span><span class=lnt id=hl-63-41><a class=lnlinks href=#hl-63-41> 41</a>
</span><span class=lnt id=hl-63-42><a class=lnlinks href=#hl-63-42> 42</a>
</span><span class=lnt id=hl-63-43><a class=lnlinks href=#hl-63-43> 43</a>
</span><span class=lnt id=hl-63-44><a class=lnlinks href=#hl-63-44> 44</a>
</span><span class=lnt id=hl-63-45><a class=lnlinks href=#hl-63-45> 45</a>
</span><span class=lnt id=hl-63-46><a class=lnlinks href=#hl-63-46> 46</a>
</span><span class=lnt id=hl-63-47><a class=lnlinks href=#hl-63-47> 47</a>
</span><span class=lnt id=hl-63-48><a class=lnlinks href=#hl-63-48> 48</a>
</span><span class=lnt id=hl-63-49><a class=lnlinks href=#hl-63-49> 49</a>
</span><span class=lnt id=hl-63-50><a class=lnlinks href=#hl-63-50> 50</a>
</span><span class=lnt id=hl-63-51><a class=lnlinks href=#hl-63-51> 51</a>
</span><span class=lnt id=hl-63-52><a class=lnlinks href=#hl-63-52> 52</a>
</span><span class=lnt id=hl-63-53><a class=lnlinks href=#hl-63-53> 53</a>
</span><span class=lnt id=hl-63-54><a class=lnlinks href=#hl-63-54> 54</a>
</span><span class=lnt id=hl-63-55><a class=lnlinks href=#hl-63-55> 55</a>
</span><span class=lnt id=hl-63-56><a class=lnlinks href=#hl-63-56> 56</a>
</span><span class=lnt id=hl-63-57><a class=lnlinks href=#hl-63-57> 57</a>
</span><span class=lnt id=hl-63-58><a class=lnlinks href=#hl-63-58> 58</a>
</span><span class=lnt id=hl-63-59><a class=lnlinks href=#hl-63-59> 59</a>
</span><span class=lnt id=hl-63-60><a class=lnlinks href=#hl-63-60> 60</a>
</span><span class=lnt id=hl-63-61><a class=lnlinks href=#hl-63-61> 61</a>
</span><span class=lnt id=hl-63-62><a class=lnlinks href=#hl-63-62> 62</a>
</span><span class=lnt id=hl-63-63><a class=lnlinks href=#hl-63-63> 63</a>
</span><span class=lnt id=hl-63-64><a class=lnlinks href=#hl-63-64> 64</a>
</span><span class=lnt id=hl-63-65><a class=lnlinks href=#hl-63-65> 65</a>
</span><span class=lnt id=hl-63-66><a class=lnlinks href=#hl-63-66> 66</a>
</span><span class=lnt id=hl-63-67><a class=lnlinks href=#hl-63-67> 67</a>
</span><span class=lnt id=hl-63-68><a class=lnlinks href=#hl-63-68> 68</a>
</span><span class=lnt id=hl-63-69><a class=lnlinks href=#hl-63-69> 69</a>
</span><span class=lnt id=hl-63-70><a class=lnlinks href=#hl-63-70> 70</a>
</span><span class=lnt id=hl-63-71><a class=lnlinks href=#hl-63-71> 71</a>
</span><span class=lnt id=hl-63-72><a class=lnlinks href=#hl-63-72> 72</a>
</span><span class=lnt id=hl-63-73><a class=lnlinks href=#hl-63-73> 73</a>
</span><span class=lnt id=hl-63-74><a class=lnlinks href=#hl-63-74> 74</a>
</span><span class=lnt id=hl-63-75><a class=lnlinks href=#hl-63-75> 75</a>
</span><span class=lnt id=hl-63-76><a class=lnlinks href=#hl-63-76> 76</a>
</span><span class=lnt id=hl-63-77><a class=lnlinks href=#hl-63-77> 77</a>
</span><span class=lnt id=hl-63-78><a class=lnlinks href=#hl-63-78> 78</a>
</span><span class=lnt id=hl-63-79><a class=lnlinks href=#hl-63-79> 79</a>
</span><span class=lnt id=hl-63-80><a class=lnlinks href=#hl-63-80> 80</a>
</span><span class=lnt id=hl-63-81><a class=lnlinks href=#hl-63-81> 81</a>
</span><span class=lnt id=hl-63-82><a class=lnlinks href=#hl-63-82> 82</a>
</span><span class=lnt id=hl-63-83><a class=lnlinks href=#hl-63-83> 83</a>
</span><span class=lnt id=hl-63-84><a class=lnlinks href=#hl-63-84> 84</a>
</span><span class=lnt id=hl-63-85><a class=lnlinks href=#hl-63-85> 85</a>
</span><span class=lnt id=hl-63-86><a class=lnlinks href=#hl-63-86> 86</a>
</span><span class=lnt id=hl-63-87><a class=lnlinks href=#hl-63-87> 87</a>
</span><span class=lnt id=hl-63-88><a class=lnlinks href=#hl-63-88> 88</a>
</span><span class=lnt id=hl-63-89><a class=lnlinks href=#hl-63-89> 89</a>
</span><span class=lnt id=hl-63-90><a class=lnlinks href=#hl-63-90> 90</a>
</span><span class=lnt id=hl-63-91><a class=lnlinks href=#hl-63-91> 91</a>
</span><span class=lnt id=hl-63-92><a class=lnlinks href=#hl-63-92> 92</a>
</span><span class=lnt id=hl-63-93><a class=lnlinks href=#hl-63-93> 93</a>
</span><span class=lnt id=hl-63-94><a class=lnlinks href=#hl-63-94> 94</a>
</span><span class=lnt id=hl-63-95><a class=lnlinks href=#hl-63-95> 95</a>
</span><span class=lnt id=hl-63-96><a class=lnlinks href=#hl-63-96> 96</a>
</span><span class=lnt id=hl-63-97><a class=lnlinks href=#hl-63-97> 97</a>
</span><span class=lnt id=hl-63-98><a class=lnlinks href=#hl-63-98> 98</a>
</span><span class=lnt id=hl-63-99><a class=lnlinks href=#hl-63-99> 99</a>
</span><span class=lnt id=hl-63-100><a class=lnlinks href=#hl-63-100>100</a>
</span><span class=lnt id=hl-63-101><a class=lnlinks href=#hl-63-101>101</a>
</span><span class=lnt id=hl-63-102><a class=lnlinks href=#hl-63-102>102</a>
</span><span class=lnt id=hl-63-103><a class=lnlinks href=#hl-63-103>103</a>
</span><span class=lnt id=hl-63-104><a class=lnlinks href=#hl-63-104>104</a>
</span><span class=lnt id=hl-63-105><a class=lnlinks href=#hl-63-105>105</a>
</span><span class=lnt id=hl-63-106><a class=lnlinks href=#hl-63-106>106</a>
</span><span class=lnt id=hl-63-107><a class=lnlinks href=#hl-63-107>107</a>
</span><span class=lnt id=hl-63-108><a class=lnlinks href=#hl-63-108>108</a>
</span><span class=lnt id=hl-63-109><a class=lnlinks href=#hl-63-109>109</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># OpenTelemetry를 통한 분산 추적</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.exporter.jaeger.thrift</span> <span class=kn>import</span> <span class=n>JaegerExporter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.instrumentation.pika</span> <span class=kn>import</span> <span class=n>PikaInstrumentor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace</span> <span class=kn>import</span> <span class=n>TracerProvider</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace.export</span> <span class=kn>import</span> <span class=n>BatchSpanProcessor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedTracingManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 메시지 처리의 분산 추적
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 흐름 전체 추적
</span></span></span><span class=line><span class=cl><span class=s2>    - 성능 병목 지점 식별
</span></span></span><span class=line><span class=cl><span class=s2>    - 에러 발생 지점 추적
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># OpenTelemetry 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>TracerProvider</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>tracer</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_tracer</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Jaeger 익스포터 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>jaeger_exporter</span> <span class=o>=</span> <span class=n>JaegerExporter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>agent_host_name</span><span class=o>=</span><span class=s2>&#34;jaeger&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>agent_port</span><span class=o>=</span><span class=mi>6831</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>span_processor</span> <span class=o>=</span> <span class=n>BatchSpanProcessor</span><span class=p>(</span><span class=n>jaeger_exporter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>trace</span><span class=o>.</span><span class=n>get_tracer_provider</span><span class=p>()</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span><span class=n>span_processor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Pika 자동 계측 활성화</span>
</span></span><span class=line><span class=cl>        <span class=n>PikaInstrumentor</span><span class=p>()</span><span class=o>.</span><span class=n>instrument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tracer</span> <span class=o>=</span> <span class=n>tracer</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_with_tracing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;추적 정보가 포함된 메시지 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;message_publish&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 스팬 속성 설정</span>
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.system&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.destination&#34;</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.operation&#34;</span><span class=p>,</span> <span class=s2>&#34;publish&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 추적 컨텍스트를 메시지 헤더에 주입</span>
</span></span><span class=line><span class=cl>            <span class=n>trace_context</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=n>trace</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=n>trace_context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지에 추적 정보 포함</span>
</span></span><span class=line><span class=cl>            <span class=n>enhanced_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>**</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_trace_context&#34;</span><span class=p>:</span> <span class=n>trace_context</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_trace_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>trace_id</span><span class=p>,</span> <span class=s1>&#39;032x&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실제 메시지 발행</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_publish_message</span><span class=p>(</span><span class=n>routing_key</span><span class=p>,</span> <span class=n>enhanced_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>span</span><span class=o>.</span><span class=n>set_status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>Status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>OK</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>consume_with_tracing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>callback_function</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;추적 정보를 복원하여 메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>traced_callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>message_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>trace_context</span> <span class=o>=</span> <span class=n>message_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;_trace_context&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상위 추적 컨텍스트 복원</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>trace</span><span class=o>.</span><span class=n>extract</span><span class=p>(</span><span class=n>trace_context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;message_consume&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 스팬 속성 설정</span>
</span></span><span class=line><span class=cl>                    <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.system&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.source&#34;</span><span class=p>,</span> <span class=n>method</span><span class=o>.</span><span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.operation&#34;</span><span class=p>,</span> <span class=s2>&#34;consume&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 추적 ID 연결</span>
</span></span><span class=line><span class=cl>                    <span class=n>trace_id</span> <span class=o>=</span> <span class=n>message_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;_trace_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>trace_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.trace_id&#34;</span><span class=p>,</span> <span class=n>trace_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 원본 콜백 함수 실행</span>
</span></span><span class=line><span class=cl>                        <span class=n>callback_function</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>span</span><span class=o>.</span><span class=n>set_status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>Status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>OK</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>span</span><span class=o>.</span><span class=n>record_exception</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>span</span><span class=o>.</span><span class=n>set_status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>Status</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>trace</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>ERROR</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                            <span class=n>description</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>))</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>traced_callback</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>tracing_manager</span> <span class=o>=</span> <span class=n>DistributedTracingManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 추적이 포함된 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=n>tracing_manager</span><span class=o>.</span><span class=n>publish_with_tracing</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;order.created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span> <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;67890&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 추적이 포함된 메시지 소비</span>
</span></span><span class=line><span class=cl><span class=nd>@tracing_manager.consume_with_tracing</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 처리 로직</span>
</span></span><span class=line><span class=cl>    <span class=c1># 추적 정보가 자동으로 연결됨</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=73-최신-기술-트렌드와-미래-방향-1>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향-1>#</a></h3><h4 id=rabbitmq-40-혁신-기능>RabbitMQ 4.0+ 혁신 기능<a hidden class=anchor aria-hidden=true href=#rabbitmq-40-혁신-기능>#</a></h4><p><strong>1. Khepri 메타데이터 저장소</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1> 1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2> 2</a>
</span><span class=lnt id=hl-64-3><a class=lnlinks href=#hl-64-3> 3</a>
</span><span class=lnt id=hl-64-4><a class=lnlinks href=#hl-64-4> 4</a>
</span><span class=lnt id=hl-64-5><a class=lnlinks href=#hl-64-5> 5</a>
</span><span class=lnt id=hl-64-6><a class=lnlinks href=#hl-64-6> 6</a>
</span><span class=lnt id=hl-64-7><a class=lnlinks href=#hl-64-7> 7</a>
</span><span class=lnt id=hl-64-8><a class=lnlinks href=#hl-64-8> 8</a>
</span><span class=lnt id=hl-64-9><a class=lnlinks href=#hl-64-9> 9</a>
</span><span class=lnt id=hl-64-10><a class=lnlinks href=#hl-64-10>10</a>
</span><span class=lnt id=hl-64-11><a class=lnlinks href=#hl-64-11>11</a>
</span><span class=lnt id=hl-64-12><a class=lnlinks href=#hl-64-12>12</a>
</span><span class=lnt id=hl-64-13><a class=lnlinks href=#hl-64-13>13</a>
</span><span class=lnt id=hl-64-14><a class=lnlinks href=#hl-64-14>14</a>
</span><span class=lnt id=hl-64-15><a class=lnlinks href=#hl-64-15>15</a>
</span><span class=lnt id=hl-64-16><a class=lnlinks href=#hl-64-16>16</a>
</span><span class=lnt id=hl-64-17><a class=lnlinks href=#hl-64-17>17</a>
</span><span class=lnt id=hl-64-18><a class=lnlinks href=#hl-64-18>18</a>
</span><span class=lnt id=hl-64-19><a class=lnlinks href=#hl-64-19>19</a>
</span><span class=lnt id=hl-64-20><a class=lnlinks href=#hl-64-20>20</a>
</span><span class=lnt id=hl-64-21><a class=lnlinks href=#hl-64-21>21</a>
</span><span class=lnt id=hl-64-22><a class=lnlinks href=#hl-64-22>22</a>
</span><span class=lnt id=hl-64-23><a class=lnlinks href=#hl-64-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-erlang data-lang=erlang><span class=line><span class=cl><span class=c>%% Khepri 기반 클러스터 설정 (RabbitMQ 4.0+)
</span></span></span><span class=line><span class=cl><span class=c>%% Raft 합의 알고리즘을 통한 강력한 일관성 보장
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=n>metadata_store</span><span class=p>,</span> <span class=n>khepri</span><span class=p>}.</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=n>khepri</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>default_timeout</span><span class=p>,</span> <span class=mi>30000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>snapshot_interval</span><span class=p>,</span> <span class=mi>16384</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>max_uncommitted_changes</span><span class=p>,</span> <span class=mi>2048</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% 네트워크 분할 내성 강화
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>raft_election_timeout</span><span class=p>,</span> <span class=mi>5000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>raft_heartbeat_timeout</span><span class=p>,</span> <span class=mi>1000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% 성능 최적화
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>async_query_timeout</span><span class=p>,</span> <span class=mi>5000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>cache_size</span><span class=p>,</span> <span class=mi>10000</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]}.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>%% 클러스터 복구 개선
</span></span></span><span class=line><span class=cl><span class=c></span><span class=p>{</span><span class=n>cluster_formation</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>peer_discovery_backend</span><span class=p>,</span> <span class=n>rabbit_peer_discovery_k8s</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>node_cleanup</span><span class=p>,</span> <span class=p>{</span><span class=nb>apply</span><span class=p>,</span> <span class=n>rabbit_peer_discovery_cleanup</span><span class=p>,</span> <span class=p>[</span><span class=n>k8s</span><span class=p>]}}</span>
</span></span><span class=line><span class=cl><span class=p>]}.</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. 네이티브 AMQP 1.0 지원</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-65-1><a class=lnlinks href=#hl-65-1> 1</a>
</span><span class=lnt id=hl-65-2><a class=lnlinks href=#hl-65-2> 2</a>
</span><span class=lnt id=hl-65-3><a class=lnlinks href=#hl-65-3> 3</a>
</span><span class=lnt id=hl-65-4><a class=lnlinks href=#hl-65-4> 4</a>
</span><span class=lnt id=hl-65-5><a class=lnlinks href=#hl-65-5> 5</a>
</span><span class=lnt id=hl-65-6><a class=lnlinks href=#hl-65-6> 6</a>
</span><span class=lnt id=hl-65-7><a class=lnlinks href=#hl-65-7> 7</a>
</span><span class=lnt id=hl-65-8><a class=lnlinks href=#hl-65-8> 8</a>
</span><span class=lnt id=hl-65-9><a class=lnlinks href=#hl-65-9> 9</a>
</span><span class=lnt id=hl-65-10><a class=lnlinks href=#hl-65-10>10</a>
</span><span class=lnt id=hl-65-11><a class=lnlinks href=#hl-65-11>11</a>
</span><span class=lnt id=hl-65-12><a class=lnlinks href=#hl-65-12>12</a>
</span><span class=lnt id=hl-65-13><a class=lnlinks href=#hl-65-13>13</a>
</span><span class=lnt id=hl-65-14><a class=lnlinks href=#hl-65-14>14</a>
</span><span class=lnt id=hl-65-15><a class=lnlinks href=#hl-65-15>15</a>
</span><span class=lnt id=hl-65-16><a class=lnlinks href=#hl-65-16>16</a>
</span><span class=lnt id=hl-65-17><a class=lnlinks href=#hl-65-17>17</a>
</span><span class=lnt id=hl-65-18><a class=lnlinks href=#hl-65-18>18</a>
</span><span class=lnt id=hl-65-19><a class=lnlinks href=#hl-65-19>19</a>
</span><span class=lnt id=hl-65-20><a class=lnlinks href=#hl-65-20>20</a>
</span><span class=lnt id=hl-65-21><a class=lnlinks href=#hl-65-21>21</a>
</span><span class=lnt id=hl-65-22><a class=lnlinks href=#hl-65-22>22</a>
</span><span class=lnt id=hl-65-23><a class=lnlinks href=#hl-65-23>23</a>
</span><span class=lnt id=hl-65-24><a class=lnlinks href=#hl-65-24>24</a>
</span><span class=lnt id=hl-65-25><a class=lnlinks href=#hl-65-25>25</a>
</span><span class=lnt id=hl-65-26><a class=lnlinks href=#hl-65-26>26</a>
</span><span class=lnt id=hl-65-27><a class=lnlinks href=#hl-65-27>27</a>
</span><span class=lnt id=hl-65-28><a class=lnlinks href=#hl-65-28>28</a>
</span><span class=lnt id=hl-65-29><a class=lnlinks href=#hl-65-29>29</a>
</span><span class=lnt id=hl-65-30><a class=lnlinks href=#hl-65-30>30</a>
</span><span class=lnt id=hl-65-31><a class=lnlinks href=#hl-65-31>31</a>
</span><span class=lnt id=hl-65-32><a class=lnlinks href=#hl-65-32>32</a>
</span><span class=lnt id=hl-65-33><a class=lnlinks href=#hl-65-33>33</a>
</span><span class=lnt id=hl-65-34><a class=lnlinks href=#hl-65-34>34</a>
</span><span class=lnt id=hl-65-35><a class=lnlinks href=#hl-65-35>35</a>
</span><span class=lnt id=hl-65-36><a class=lnlinks href=#hl-65-36>36</a>
</span><span class=lnt id=hl-65-37><a class=lnlinks href=#hl-65-37>37</a>
</span><span class=lnt id=hl-65-38><a class=lnlinks href=#hl-65-38>38</a>
</span><span class=lnt id=hl-65-39><a class=lnlinks href=#hl-65-39>39</a>
</span><span class=lnt id=hl-65-40><a class=lnlinks href=#hl-65-40>40</a>
</span><span class=lnt id=hl-65-41><a class=lnlinks href=#hl-65-41>41</a>
</span><span class=lnt id=hl-65-42><a class=lnlinks href=#hl-65-42>42</a>
</span><span class=lnt id=hl-65-43><a class=lnlinks href=#hl-65-43>43</a>
</span><span class=lnt id=hl-65-44><a class=lnlinks href=#hl-65-44>44</a>
</span><span class=lnt id=hl-65-45><a class=lnlinks href=#hl-65-45>45</a>
</span><span class=lnt id=hl-65-46><a class=lnlinks href=#hl-65-46>46</a>
</span><span class=lnt id=hl-65-47><a class=lnlinks href=#hl-65-47>47</a>
</span><span class=lnt id=hl-65-48><a class=lnlinks href=#hl-65-48>48</a>
</span><span class=lnt id=hl-65-49><a class=lnlinks href=#hl-65-49>49</a>
</span><span class=lnt id=hl-65-50><a class=lnlinks href=#hl-65-50>50</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># AMQP 1.0 클라이언트 (RabbitMQ 4.0+)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>azure.servicebus.aio</span> <span class=kn>import</span> <span class=n>ServiceBusClient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AMQP10Client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 4.0의 네이티브 AMQP 1.0 지원
</span></span></span><span class=line><span class=cl><span class=s2>    - 향상된 성능 및 표준 호환성
</span></span></span><span class=line><span class=cl><span class=s2>    - Azure Service Bus, AWS EventBridge와 직접 호환
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>ServiceBusClient</span><span class=o>.</span><span class=n>from_connection_string</span><span class=p>(</span><span class=n>connection_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>send_amqp10_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>message_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AMQP 1.0 프로토콜로 메시지 전송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sender</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get_queue_sender</span><span class=p>(</span><span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>sender</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># AMQP 1.0 메시지 구성</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span> <span class=o>=</span> <span class=n>ServiceBusMessage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message_data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>content_type</span><span class=o>=</span><span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># AMQP 1.0 고급 기능</span>
</span></span><span class=line><span class=cl>                    <span class=n>properties</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;message_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;correlation_id&#34;</span><span class=p>:</span> <span class=s2>&#34;order-12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;reply_to&#34;</span><span class=p>:</span> <span class=s2>&#34;response_queue&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 메시지 어노테이션</span>
</span></span><span class=line><span class=cl>                    <span class=n>application_properties</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;priority&#34;</span><span class=p>:</span> <span class=s2>&#34;high&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;tenant_id&#34;</span><span class=p>:</span> <span class=s2>&#34;customer-123&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>sender</span><span class=o>.</span><span class=n>send_messages</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;AMQP 1.0 message sent to </span><span class=si>{</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 4.0과 클라우드 서비스 간 직접 연동</span>
</span></span><span class=line><span class=cl><span class=n>amqp10_client</span> <span class=o>=</span> <span class=n>AMQP10Client</span><span class=p>(</span><span class=s2>&#34;amqp://localhost:5672&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>amqp10_client</span><span class=o>.</span><span class=n>send_amqp10_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;orders_queue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;created&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=미래-기술-방향성>미래 기술 방향성<a hidden class=anchor aria-hidden=true href=#미래-기술-방향성>#</a></h4><p><strong>1. 서버리스 메시징</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-66-1><a class=lnlinks href=#hl-66-1> 1</a>
</span><span class=lnt id=hl-66-2><a class=lnlinks href=#hl-66-2> 2</a>
</span><span class=lnt id=hl-66-3><a class=lnlinks href=#hl-66-3> 3</a>
</span><span class=lnt id=hl-66-4><a class=lnlinks href=#hl-66-4> 4</a>
</span><span class=lnt id=hl-66-5><a class=lnlinks href=#hl-66-5> 5</a>
</span><span class=lnt id=hl-66-6><a class=lnlinks href=#hl-66-6> 6</a>
</span><span class=lnt id=hl-66-7><a class=lnlinks href=#hl-66-7> 7</a>
</span><span class=lnt id=hl-66-8><a class=lnlinks href=#hl-66-8> 8</a>
</span><span class=lnt id=hl-66-9><a class=lnlinks href=#hl-66-9> 9</a>
</span><span class=lnt id=hl-66-10><a class=lnlinks href=#hl-66-10>10</a>
</span><span class=lnt id=hl-66-11><a class=lnlinks href=#hl-66-11>11</a>
</span><span class=lnt id=hl-66-12><a class=lnlinks href=#hl-66-12>12</a>
</span><span class=lnt id=hl-66-13><a class=lnlinks href=#hl-66-13>13</a>
</span><span class=lnt id=hl-66-14><a class=lnlinks href=#hl-66-14>14</a>
</span><span class=lnt id=hl-66-15><a class=lnlinks href=#hl-66-15>15</a>
</span><span class=lnt id=hl-66-16><a class=lnlinks href=#hl-66-16>16</a>
</span><span class=lnt id=hl-66-17><a class=lnlinks href=#hl-66-17>17</a>
</span><span class=lnt id=hl-66-18><a class=lnlinks href=#hl-66-18>18</a>
</span><span class=lnt id=hl-66-19><a class=lnlinks href=#hl-66-19>19</a>
</span><span class=lnt id=hl-66-20><a class=lnlinks href=#hl-66-20>20</a>
</span><span class=lnt id=hl-66-21><a class=lnlinks href=#hl-66-21>21</a>
</span><span class=lnt id=hl-66-22><a class=lnlinks href=#hl-66-22>22</a>
</span><span class=lnt id=hl-66-23><a class=lnlinks href=#hl-66-23>23</a>
</span><span class=lnt id=hl-66-24><a class=lnlinks href=#hl-66-24>24</a>
</span><span class=lnt id=hl-66-25><a class=lnlinks href=#hl-66-25>25</a>
</span><span class=lnt id=hl-66-26><a class=lnlinks href=#hl-66-26>26</a>
</span><span class=lnt id=hl-66-27><a class=lnlinks href=#hl-66-27>27</a>
</span><span class=lnt id=hl-66-28><a class=lnlinks href=#hl-66-28>28</a>
</span><span class=lnt id=hl-66-29><a class=lnlinks href=#hl-66-29>29</a>
</span><span class=lnt id=hl-66-30><a class=lnlinks href=#hl-66-30>30</a>
</span><span class=lnt id=hl-66-31><a class=lnlinks href=#hl-66-31>31</a>
</span><span class=lnt id=hl-66-32><a class=lnlinks href=#hl-66-32>32</a>
</span><span class=lnt id=hl-66-33><a class=lnlinks href=#hl-66-33>33</a>
</span><span class=lnt id=hl-66-34><a class=lnlinks href=#hl-66-34>34</a>
</span><span class=lnt id=hl-66-35><a class=lnlinks href=#hl-66-35>35</a>
</span><span class=lnt id=hl-66-36><a class=lnlinks href=#hl-66-36>36</a>
</span><span class=lnt id=hl-66-37><a class=lnlinks href=#hl-66-37>37</a>
</span><span class=lnt id=hl-66-38><a class=lnlinks href=#hl-66-38>38</a>
</span><span class=lnt id=hl-66-39><a class=lnlinks href=#hl-66-39>39</a>
</span><span class=lnt id=hl-66-40><a class=lnlinks href=#hl-66-40>40</a>
</span><span class=lnt id=hl-66-41><a class=lnlinks href=#hl-66-41>41</a>
</span><span class=lnt id=hl-66-42><a class=lnlinks href=#hl-66-42>42</a>
</span><span class=lnt id=hl-66-43><a class=lnlinks href=#hl-66-43>43</a>
</span><span class=lnt id=hl-66-44><a class=lnlinks href=#hl-66-44>44</a>
</span><span class=lnt id=hl-66-45><a class=lnlinks href=#hl-66-45>45</a>
</span><span class=lnt id=hl-66-46><a class=lnlinks href=#hl-66-46>46</a>
</span><span class=lnt id=hl-66-47><a class=lnlinks href=#hl-66-47>47</a>
</span><span class=lnt id=hl-66-48><a class=lnlinks href=#hl-66-48>48</a>
</span><span class=lnt id=hl-66-49><a class=lnlinks href=#hl-66-49>49</a>
</span><span class=lnt id=hl-66-50><a class=lnlinks href=#hl-66-50>50</a>
</span><span class=lnt id=hl-66-51><a class=lnlinks href=#hl-66-51>51</a>
</span><span class=lnt id=hl-66-52><a class=lnlinks href=#hl-66-52>52</a>
</span><span class=lnt id=hl-66-53><a class=lnlinks href=#hl-66-53>53</a>
</span><span class=lnt id=hl-66-54><a class=lnlinks href=#hl-66-54>54</a>
</span><span class=lnt id=hl-66-55><a class=lnlinks href=#hl-66-55>55</a>
</span><span class=lnt id=hl-66-56><a class=lnlinks href=#hl-66-56>56</a>
</span><span class=lnt id=hl-66-57><a class=lnlinks href=#hl-66-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Knative + RabbitMQ 서버리스 메시징</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>eventing.knative.dev/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Broker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-serverless-broker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-broker-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>eventing.knative.dev/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Trigger  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-processing-trigger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>broker</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-serverless-broker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>com.company.order.created</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>subscriber</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ref</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>serving.knative.dev/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 서버리스 메시지 처리 함수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>serving.knative.dev/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 자동 스케일링 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>autoscaling.knative.dev/minScale</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>autoscaling.knative.dev/maxScale</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>autoscaling.knative.dev/target</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>order-processor:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>RABBITMQ_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;amqp://rabbitmq:5672&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 리소스 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;128Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>2. WebAssembly (WASM) 플러그인</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-67-1><a class=lnlinks href=#hl-67-1> 1</a>
</span><span class=lnt id=hl-67-2><a class=lnlinks href=#hl-67-2> 2</a>
</span><span class=lnt id=hl-67-3><a class=lnlinks href=#hl-67-3> 3</a>
</span><span class=lnt id=hl-67-4><a class=lnlinks href=#hl-67-4> 4</a>
</span><span class=lnt id=hl-67-5><a class=lnlinks href=#hl-67-5> 5</a>
</span><span class=lnt id=hl-67-6><a class=lnlinks href=#hl-67-6> 6</a>
</span><span class=lnt id=hl-67-7><a class=lnlinks href=#hl-67-7> 7</a>
</span><span class=lnt id=hl-67-8><a class=lnlinks href=#hl-67-8> 8</a>
</span><span class=lnt id=hl-67-9><a class=lnlinks href=#hl-67-9> 9</a>
</span><span class=lnt id=hl-67-10><a class=lnlinks href=#hl-67-10>10</a>
</span><span class=lnt id=hl-67-11><a class=lnlinks href=#hl-67-11>11</a>
</span><span class=lnt id=hl-67-12><a class=lnlinks href=#hl-67-12>12</a>
</span><span class=lnt id=hl-67-13><a class=lnlinks href=#hl-67-13>13</a>
</span><span class=lnt id=hl-67-14><a class=lnlinks href=#hl-67-14>14</a>
</span><span class=lnt id=hl-67-15><a class=lnlinks href=#hl-67-15>15</a>
</span><span class=lnt id=hl-67-16><a class=lnlinks href=#hl-67-16>16</a>
</span><span class=lnt id=hl-67-17><a class=lnlinks href=#hl-67-17>17</a>
</span><span class=lnt id=hl-67-18><a class=lnlinks href=#hl-67-18>18</a>
</span><span class=lnt id=hl-67-19><a class=lnlinks href=#hl-67-19>19</a>
</span><span class=lnt id=hl-67-20><a class=lnlinks href=#hl-67-20>20</a>
</span><span class=lnt id=hl-67-21><a class=lnlinks href=#hl-67-21>21</a>
</span><span class=lnt id=hl-67-22><a class=lnlinks href=#hl-67-22>22</a>
</span><span class=lnt id=hl-67-23><a class=lnlinks href=#hl-67-23>23</a>
</span><span class=lnt id=hl-67-24><a class=lnlinks href=#hl-67-24>24</a>
</span><span class=lnt id=hl-67-25><a class=lnlinks href=#hl-67-25>25</a>
</span><span class=lnt id=hl-67-26><a class=lnlinks href=#hl-67-26>26</a>
</span><span class=lnt id=hl-67-27><a class=lnlinks href=#hl-67-27>27</a>
</span><span class=lnt id=hl-67-28><a class=lnlinks href=#hl-67-28>28</a>
</span><span class=lnt id=hl-67-29><a class=lnlinks href=#hl-67-29>29</a>
</span><span class=lnt id=hl-67-30><a class=lnlinks href=#hl-67-30>30</a>
</span><span class=lnt id=hl-67-31><a class=lnlinks href=#hl-67-31>31</a>
</span><span class=lnt id=hl-67-32><a class=lnlinks href=#hl-67-32>32</a>
</span><span class=lnt id=hl-67-33><a class=lnlinks href=#hl-67-33>33</a>
</span><span class=lnt id=hl-67-34><a class=lnlinks href=#hl-67-34>34</a>
</span><span class=lnt id=hl-67-35><a class=lnlinks href=#hl-67-35>35</a>
</span><span class=lnt id=hl-67-36><a class=lnlinks href=#hl-67-36>36</a>
</span><span class=lnt id=hl-67-37><a class=lnlinks href=#hl-67-37>37</a>
</span><span class=lnt id=hl-67-38><a class=lnlinks href=#hl-67-38>38</a>
</span><span class=lnt id=hl-67-39><a class=lnlinks href=#hl-67-39>39</a>
</span><span class=lnt id=hl-67-40><a class=lnlinks href=#hl-67-40>40</a>
</span><span class=lnt id=hl-67-41><a class=lnlinks href=#hl-67-41>41</a>
</span><span class=lnt id=hl-67-42><a class=lnlinks href=#hl-67-42>42</a>
</span><span class=lnt id=hl-67-43><a class=lnlinks href=#hl-67-43>43</a>
</span><span class=lnt id=hl-67-44><a class=lnlinks href=#hl-67-44>44</a>
</span><span class=lnt id=hl-67-45><a class=lnlinks href=#hl-67-45>45</a>
</span><span class=lnt id=hl-67-46><a class=lnlinks href=#hl-67-46>46</a>
</span><span class=lnt id=hl-67-47><a class=lnlinks href=#hl-67-47>47</a>
</span><span class=lnt id=hl-67-48><a class=lnlinks href=#hl-67-48>48</a>
</span><span class=lnt id=hl-67-49><a class=lnlinks href=#hl-67-49>49</a>
</span><span class=lnt id=hl-67-50><a class=lnlinks href=#hl-67-50>50</a>
</span><span class=lnt id=hl-67-51><a class=lnlinks href=#hl-67-51>51</a>
</span><span class=lnt id=hl-67-52><a class=lnlinks href=#hl-67-52>52</a>
</span><span class=lnt id=hl-67-53><a class=lnlinks href=#hl-67-53>53</a>
</span><span class=lnt id=hl-67-54><a class=lnlinks href=#hl-67-54>54</a>
</span><span class=lnt id=hl-67-55><a class=lnlinks href=#hl-67-55>55</a>
</span><span class=lnt id=hl-67-56><a class=lnlinks href=#hl-67-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// RabbitMQ WASM 플러그인 (미래 기능)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>use</span><span class=w> </span><span class=n>wasm_bindgen</span>::<span class=n>prelude</span>::<span class=o>*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[wasm_bindgen]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>MessageProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>config</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[wasm_bindgen]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>MessageProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[wasm_bindgen(constructor)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>config</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>MessageProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MessageProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>config</span>: <span class=nc>config</span><span class=p>.</span><span class=n>to_string</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=sd>/// 메시지 변환 함수 (WASM으로 실행)
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=w>    </span><span class=cp>#[wasm_bindgen]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>transform_message</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>input</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>String</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 고성능 메시지 변환 로직
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=c1>// 네이티브 코드 수준의 성능
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>parsed</span>: <span class=nc>serde_json</span>::<span class=n>Value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span>::<span class=n>from_str</span><span class=p>(</span><span class=n>input</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 로직 적용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>transformed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span>::<span class=fm>json!</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;original&#34;</span>: <span class=nc>parsed</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;transformed_at&#34;</span>: <span class=nc>chrono</span>::<span class=n>Utc</span>::<span class=n>now</span><span class=p>().</span><span class=n>to_rfc3339</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;processor&#34;</span>: <span class=s>&#34;wasm-plugin-v1.0&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;enhanced_data&#34;</span>: <span class=nc>self</span><span class=p>.</span><span class=n>enhance_data</span><span class=p>(</span><span class=o>&amp;</span><span class=n>parsed</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transformed</span><span class=p>.</span><span class=n>to_string</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=sd>/// 메시지 필터링 함수
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=w>    </span><span class=cp>#[wasm_bindgen]</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>should_process</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>message</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 복잡한 필터링 로직을 WASM으로 실행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=c1>// 메인 브로커 성능에 영향 없이 고도화된 로직 실행 가능
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>data</span>: <span class=nc>serde_json</span>::<span class=n>Value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span>::<span class=n>from_str</span><span class=p>(</span><span class=n>message</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 예: 특정 조건 검사
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>data</span><span class=p>[</span><span class=s>&#34;priority&#34;</span><span class=p>].</span><span class=n>as_str</span><span class=p>().</span><span class=n>unwrap_or</span><span class=p>(</span><span class=s>&#34;low&#34;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#34;high&#34;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>data</span><span class=p>[</span><span class=s>&#34;customer_tier&#34;</span><span class=p>].</span><span class=n>as_str</span><span class=p>().</span><span class=n>unwrap_or</span><span class=p>(</span><span class=s>&#34;basic&#34;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#34;premium&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>enhance_data</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>data</span>: <span class=kp>&amp;</span><span class=nc>serde_json</span>::<span class=n>Value</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>serde_json</span>::<span class=n>Value</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 데이터 보강 로직
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>serde_json</span>::<span class=fm>json!</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;enrichment_version&#34;</span>: <span class=s>&#34;2.1&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;processing_time_ms&#34;</span>: <span class=mf>1.2</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;data_quality_score&#34;</span>: <span class=mf>0.95</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>3. AI/ML 통합 메시징</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-68-1><a class=lnlinks href=#hl-68-1>  1</a>
</span><span class=lnt id=hl-68-2><a class=lnlinks href=#hl-68-2>  2</a>
</span><span class=lnt id=hl-68-3><a class=lnlinks href=#hl-68-3>  3</a>
</span><span class=lnt id=hl-68-4><a class=lnlinks href=#hl-68-4>  4</a>
</span><span class=lnt id=hl-68-5><a class=lnlinks href=#hl-68-5>  5</a>
</span><span class=lnt id=hl-68-6><a class=lnlinks href=#hl-68-6>  6</a>
</span><span class=lnt id=hl-68-7><a class=lnlinks href=#hl-68-7>  7</a>
</span><span class=lnt id=hl-68-8><a class=lnlinks href=#hl-68-8>  8</a>
</span><span class=lnt id=hl-68-9><a class=lnlinks href=#hl-68-9>  9</a>
</span><span class=lnt id=hl-68-10><a class=lnlinks href=#hl-68-10> 10</a>
</span><span class=lnt id=hl-68-11><a class=lnlinks href=#hl-68-11> 11</a>
</span><span class=lnt id=hl-68-12><a class=lnlinks href=#hl-68-12> 12</a>
</span><span class=lnt id=hl-68-13><a class=lnlinks href=#hl-68-13> 13</a>
</span><span class=lnt id=hl-68-14><a class=lnlinks href=#hl-68-14> 14</a>
</span><span class=lnt id=hl-68-15><a class=lnlinks href=#hl-68-15> 15</a>
</span><span class=lnt id=hl-68-16><a class=lnlinks href=#hl-68-16> 16</a>
</span><span class=lnt id=hl-68-17><a class=lnlinks href=#hl-68-17> 17</a>
</span><span class=lnt id=hl-68-18><a class=lnlinks href=#hl-68-18> 18</a>
</span><span class=lnt id=hl-68-19><a class=lnlinks href=#hl-68-19> 19</a>
</span><span class=lnt id=hl-68-20><a class=lnlinks href=#hl-68-20> 20</a>
</span><span class=lnt id=hl-68-21><a class=lnlinks href=#hl-68-21> 21</a>
</span><span class=lnt id=hl-68-22><a class=lnlinks href=#hl-68-22> 22</a>
</span><span class=lnt id=hl-68-23><a class=lnlinks href=#hl-68-23> 23</a>
</span><span class=lnt id=hl-68-24><a class=lnlinks href=#hl-68-24> 24</a>
</span><span class=lnt id=hl-68-25><a class=lnlinks href=#hl-68-25> 25</a>
</span><span class=lnt id=hl-68-26><a class=lnlinks href=#hl-68-26> 26</a>
</span><span class=lnt id=hl-68-27><a class=lnlinks href=#hl-68-27> 27</a>
</span><span class=lnt id=hl-68-28><a class=lnlinks href=#hl-68-28> 28</a>
</span><span class=lnt id=hl-68-29><a class=lnlinks href=#hl-68-29> 29</a>
</span><span class=lnt id=hl-68-30><a class=lnlinks href=#hl-68-30> 30</a>
</span><span class=lnt id=hl-68-31><a class=lnlinks href=#hl-68-31> 31</a>
</span><span class=lnt id=hl-68-32><a class=lnlinks href=#hl-68-32> 32</a>
</span><span class=lnt id=hl-68-33><a class=lnlinks href=#hl-68-33> 33</a>
</span><span class=lnt id=hl-68-34><a class=lnlinks href=#hl-68-34> 34</a>
</span><span class=lnt id=hl-68-35><a class=lnlinks href=#hl-68-35> 35</a>
</span><span class=lnt id=hl-68-36><a class=lnlinks href=#hl-68-36> 36</a>
</span><span class=lnt id=hl-68-37><a class=lnlinks href=#hl-68-37> 37</a>
</span><span class=lnt id=hl-68-38><a class=lnlinks href=#hl-68-38> 38</a>
</span><span class=lnt id=hl-68-39><a class=lnlinks href=#hl-68-39> 39</a>
</span><span class=lnt id=hl-68-40><a class=lnlinks href=#hl-68-40> 40</a>
</span><span class=lnt id=hl-68-41><a class=lnlinks href=#hl-68-41> 41</a>
</span><span class=lnt id=hl-68-42><a class=lnlinks href=#hl-68-42> 42</a>
</span><span class=lnt id=hl-68-43><a class=lnlinks href=#hl-68-43> 43</a>
</span><span class=lnt id=hl-68-44><a class=lnlinks href=#hl-68-44> 44</a>
</span><span class=lnt id=hl-68-45><a class=lnlinks href=#hl-68-45> 45</a>
</span><span class=lnt id=hl-68-46><a class=lnlinks href=#hl-68-46> 46</a>
</span><span class=lnt id=hl-68-47><a class=lnlinks href=#hl-68-47> 47</a>
</span><span class=lnt id=hl-68-48><a class=lnlinks href=#hl-68-48> 48</a>
</span><span class=lnt id=hl-68-49><a class=lnlinks href=#hl-68-49> 49</a>
</span><span class=lnt id=hl-68-50><a class=lnlinks href=#hl-68-50> 50</a>
</span><span class=lnt id=hl-68-51><a class=lnlinks href=#hl-68-51> 51</a>
</span><span class=lnt id=hl-68-52><a class=lnlinks href=#hl-68-52> 52</a>
</span><span class=lnt id=hl-68-53><a class=lnlinks href=#hl-68-53> 53</a>
</span><span class=lnt id=hl-68-54><a class=lnlinks href=#hl-68-54> 54</a>
</span><span class=lnt id=hl-68-55><a class=lnlinks href=#hl-68-55> 55</a>
</span><span class=lnt id=hl-68-56><a class=lnlinks href=#hl-68-56> 56</a>
</span><span class=lnt id=hl-68-57><a class=lnlinks href=#hl-68-57> 57</a>
</span><span class=lnt id=hl-68-58><a class=lnlinks href=#hl-68-58> 58</a>
</span><span class=lnt id=hl-68-59><a class=lnlinks href=#hl-68-59> 59</a>
</span><span class=lnt id=hl-68-60><a class=lnlinks href=#hl-68-60> 60</a>
</span><span class=lnt id=hl-68-61><a class=lnlinks href=#hl-68-61> 61</a>
</span><span class=lnt id=hl-68-62><a class=lnlinks href=#hl-68-62> 62</a>
</span><span class=lnt id=hl-68-63><a class=lnlinks href=#hl-68-63> 63</a>
</span><span class=lnt id=hl-68-64><a class=lnlinks href=#hl-68-64> 64</a>
</span><span class=lnt id=hl-68-65><a class=lnlinks href=#hl-68-65> 65</a>
</span><span class=lnt id=hl-68-66><a class=lnlinks href=#hl-68-66> 66</a>
</span><span class=lnt id=hl-68-67><a class=lnlinks href=#hl-68-67> 67</a>
</span><span class=lnt id=hl-68-68><a class=lnlinks href=#hl-68-68> 68</a>
</span><span class=lnt id=hl-68-69><a class=lnlinks href=#hl-68-69> 69</a>
</span><span class=lnt id=hl-68-70><a class=lnlinks href=#hl-68-70> 70</a>
</span><span class=lnt id=hl-68-71><a class=lnlinks href=#hl-68-71> 71</a>
</span><span class=lnt id=hl-68-72><a class=lnlinks href=#hl-68-72> 72</a>
</span><span class=lnt id=hl-68-73><a class=lnlinks href=#hl-68-73> 73</a>
</span><span class=lnt id=hl-68-74><a class=lnlinks href=#hl-68-74> 74</a>
</span><span class=lnt id=hl-68-75><a class=lnlinks href=#hl-68-75> 75</a>
</span><span class=lnt id=hl-68-76><a class=lnlinks href=#hl-68-76> 76</a>
</span><span class=lnt id=hl-68-77><a class=lnlinks href=#hl-68-77> 77</a>
</span><span class=lnt id=hl-68-78><a class=lnlinks href=#hl-68-78> 78</a>
</span><span class=lnt id=hl-68-79><a class=lnlinks href=#hl-68-79> 79</a>
</span><span class=lnt id=hl-68-80><a class=lnlinks href=#hl-68-80> 80</a>
</span><span class=lnt id=hl-68-81><a class=lnlinks href=#hl-68-81> 81</a>
</span><span class=lnt id=hl-68-82><a class=lnlinks href=#hl-68-82> 82</a>
</span><span class=lnt id=hl-68-83><a class=lnlinks href=#hl-68-83> 83</a>
</span><span class=lnt id=hl-68-84><a class=lnlinks href=#hl-68-84> 84</a>
</span><span class=lnt id=hl-68-85><a class=lnlinks href=#hl-68-85> 85</a>
</span><span class=lnt id=hl-68-86><a class=lnlinks href=#hl-68-86> 86</a>
</span><span class=lnt id=hl-68-87><a class=lnlinks href=#hl-68-87> 87</a>
</span><span class=lnt id=hl-68-88><a class=lnlinks href=#hl-68-88> 88</a>
</span><span class=lnt id=hl-68-89><a class=lnlinks href=#hl-68-89> 89</a>
</span><span class=lnt id=hl-68-90><a class=lnlinks href=#hl-68-90> 90</a>
</span><span class=lnt id=hl-68-91><a class=lnlinks href=#hl-68-91> 91</a>
</span><span class=lnt id=hl-68-92><a class=lnlinks href=#hl-68-92> 92</a>
</span><span class=lnt id=hl-68-93><a class=lnlinks href=#hl-68-93> 93</a>
</span><span class=lnt id=hl-68-94><a class=lnlinks href=#hl-68-94> 94</a>
</span><span class=lnt id=hl-68-95><a class=lnlinks href=#hl-68-95> 95</a>
</span><span class=lnt id=hl-68-96><a class=lnlinks href=#hl-68-96> 96</a>
</span><span class=lnt id=hl-68-97><a class=lnlinks href=#hl-68-97> 97</a>
</span><span class=lnt id=hl-68-98><a class=lnlinks href=#hl-68-98> 98</a>
</span><span class=lnt id=hl-68-99><a class=lnlinks href=#hl-68-99> 99</a>
</span><span class=lnt id=hl-68-100><a class=lnlinks href=#hl-68-100>100</a>
</span><span class=lnt id=hl-68-101><a class=lnlinks href=#hl-68-101>101</a>
</span><span class=lnt id=hl-68-102><a class=lnlinks href=#hl-68-102>102</a>
</span><span class=lnt id=hl-68-103><a class=lnlinks href=#hl-68-103>103</a>
</span><span class=lnt id=hl-68-104><a class=lnlinks href=#hl-68-104>104</a>
</span><span class=lnt id=hl-68-105><a class=lnlinks href=#hl-68-105>105</a>
</span><span class=lnt id=hl-68-106><a class=lnlinks href=#hl-68-106>106</a>
</span><span class=lnt id=hl-68-107><a class=lnlinks href=#hl-68-107>107</a>
</span><span class=lnt id=hl-68-108><a class=lnlinks href=#hl-68-108>108</a>
</span><span class=lnt id=hl-68-109><a class=lnlinks href=#hl-68-109>109</a>
</span><span class=lnt id=hl-68-110><a class=lnlinks href=#hl-68-110>110</a>
</span><span class=lnt id=hl-68-111><a class=lnlinks href=#hl-68-111>111</a>
</span><span class=lnt id=hl-68-112><a class=lnlinks href=#hl-68-112>112</a>
</span><span class=lnt id=hl-68-113><a class=lnlinks href=#hl-68-113>113</a>
</span><span class=lnt id=hl-68-114><a class=lnlinks href=#hl-68-114>114</a>
</span><span class=lnt id=hl-68-115><a class=lnlinks href=#hl-68-115>115</a>
</span><span class=lnt id=hl-68-116><a class=lnlinks href=#hl-68-116>116</a>
</span><span class=lnt id=hl-68-117><a class=lnlinks href=#hl-68-117>117</a>
</span><span class=lnt id=hl-68-118><a class=lnlinks href=#hl-68-118>118</a>
</span><span class=lnt id=hl-68-119><a class=lnlinks href=#hl-68-119>119</a>
</span><span class=lnt id=hl-68-120><a class=lnlinks href=#hl-68-120>120</a>
</span><span class=lnt id=hl-68-121><a class=lnlinks href=#hl-68-121>121</a>
</span><span class=lnt id=hl-68-122><a class=lnlinks href=#hl-68-122>122</a>
</span><span class=lnt id=hl-68-123><a class=lnlinks href=#hl-68-123>123</a>
</span><span class=lnt id=hl-68-124><a class=lnlinks href=#hl-68-124>124</a>
</span><span class=lnt id=hl-68-125><a class=lnlinks href=#hl-68-125>125</a>
</span><span class=lnt id=hl-68-126><a class=lnlinks href=#hl-68-126>126</a>
</span><span class=lnt id=hl-68-127><a class=lnlinks href=#hl-68-127>127</a>
</span><span class=lnt id=hl-68-128><a class=lnlinks href=#hl-68-128>128</a>
</span><span class=lnt id=hl-68-129><a class=lnlinks href=#hl-68-129>129</a>
</span><span class=lnt id=hl-68-130><a class=lnlinks href=#hl-68-130>130</a>
</span><span class=lnt id=hl-68-131><a class=lnlinks href=#hl-68-131>131</a>
</span><span class=lnt id=hl-68-132><a class=lnlinks href=#hl-68-132>132</a>
</span><span class=lnt id=hl-68-133><a class=lnlinks href=#hl-68-133>133</a>
</span><span class=lnt id=hl-68-134><a class=lnlinks href=#hl-68-134>134</a>
</span><span class=lnt id=hl-68-135><a class=lnlinks href=#hl-68-135>135</a>
</span><span class=lnt id=hl-68-136><a class=lnlinks href=#hl-68-136>136</a>
</span><span class=lnt id=hl-68-137><a class=lnlinks href=#hl-68-137>137</a>
</span><span class=lnt id=hl-68-138><a class=lnlinks href=#hl-68-138>138</a>
</span><span class=lnt id=hl-68-139><a class=lnlinks href=#hl-68-139>139</a>
</span><span class=lnt id=hl-68-140><a class=lnlinks href=#hl-68-140>140</a>
</span><span class=lnt id=hl-68-141><a class=lnlinks href=#hl-68-141>141</a>
</span><span class=lnt id=hl-68-142><a class=lnlinks href=#hl-68-142>142</a>
</span><span class=lnt id=hl-68-143><a class=lnlinks href=#hl-68-143>143</a>
</span><span class=lnt id=hl-68-144><a class=lnlinks href=#hl-68-144>144</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># AI 기반 메시지 분석 및 라우팅</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>tensorflow</span> <span class=k>as</span> <span class=nn>tf</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>transformers</span> <span class=kn>import</span> <span class=n>AutoTokenizer</span><span class=p>,</span> <span class=n>AutoModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>IntelligentMessageRouter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    AI/ML을 활용한 지능형 메시지 라우팅
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 내용 분석을 통한 동적 라우팅
</span></span></span><span class=line><span class=cl><span class=s2>    - 이상 탐지 및 자동 차단
</span></span></span><span class=line><span class=cl><span class=s2>    - 비즈니스 우선순위 자동 결정
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 사전 훈련된 언어 모델 로드</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tokenizer</span> <span class=o>=</span> <span class=n>AutoTokenizer</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s1>&#39;bert-base-uncased&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>AutoModel</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s1>&#39;bert-base-uncased&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 분류 모델</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>classifier</span> <span class=o>=</span> <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>load_model</span><span class=p>(</span><span class=s1>&#39;message_classifier.h5&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 라우팅 규칙 학습 데이터</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>routing_rules</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>intelligent_route</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AI 기반 메시지 라우팅 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 텍스트 추출</span>
</span></span><span class=line><span class=cl>        <span class=n>text_content</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extract_text_content</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 감정 분석</span>
</span></span><span class=line><span class=cl>        <span class=n>sentiment</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_analyze_sentiment</span><span class=p>(</span><span class=n>text_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 카테고리 분류</span>
</span></span><span class=line><span class=cl>        <span class=n>category</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_classify_message</span><span class=p>(</span><span class=n>text_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 우선순위 결정</span>
</span></span><span class=line><span class=cl>        <span class=n>priority</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_determine_priority</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>sentiment</span><span class=p>,</span> <span class=n>category</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 최적 라우팅 결정</span>
</span></span><span class=line><span class=cl>        <span class=n>routing_decision</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_make_routing_decision</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>category</span><span class=p>,</span> <span class=n>priority</span><span class=p>,</span> <span class=n>sentiment</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>routing_decision</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_analyze_sentiment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;감정 분석&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>inputs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>tokenizer</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>return_tensors</span><span class=o>=</span><span class=s1>&#39;pt&#39;</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>truncation</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>torch</span><span class=o>.</span><span class=n>no_grad</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>outputs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>(</span><span class=o>**</span><span class=n>inputs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>embeddings</span> <span class=o>=</span> <span class=n>outputs</span><span class=o>.</span><span class=n>last_hidden_state</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 감정 분류 (긍정, 부정, 중립)</span>
</span></span><span class=line><span class=cl>        <span class=n>sentiment_scores</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>classifier</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>embeddings</span><span class=o>.</span><span class=n>numpy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;positive&#39;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>sentiment_scores</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;negative&#39;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>sentiment_scores</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;neutral&#39;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>sentiment_scores</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_classify_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 카테고리 분류&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 키워드 기반 초기 분류</span>
</span></span><span class=line><span class=cl>        <span class=n>keywords</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;urgent&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;urgent&#39;</span><span class=p>,</span> <span class=s1>&#39;emergency&#39;</span><span class=p>,</span> <span class=s1>&#39;critical&#39;</span><span class=p>,</span> <span class=s1>&#39;asap&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_service&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;complaint&#39;</span><span class=p>,</span> <span class=s1>&#39;issue&#39;</span><span class=p>,</span> <span class=s1>&#39;problem&#39;</span><span class=p>,</span> <span class=s1>&#39;support&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;order&#39;</span><span class=p>,</span> <span class=s1>&#39;purchase&#39;</span><span class=p>,</span> <span class=s1>&#39;buy&#39;</span><span class=p>,</span> <span class=s1>&#39;payment&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;technical&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;bug&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;failure&#39;</span><span class=p>,</span> <span class=s1>&#39;exception&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>text_lower</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>category</span><span class=p>,</span> <span class=n>words</span> <span class=ow>in</span> <span class=n>keywords</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>word</span> <span class=ow>in</span> <span class=n>text_lower</span> <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>category</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;general&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_determine_priority</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>sentiment</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AI 기반 우선순위 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>priority_score</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 카테고리별 기본 점수</span>
</span></span><span class=line><span class=cl>        <span class=n>category_scores</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;urgent&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_service&#39;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;technical&#39;</span><span class=p>:</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;general&#39;</span><span class=p>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>priority_score</span> <span class=o>+=</span> <span class=n>category_scores</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>category</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 감정 분석 결과 반영</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>sentiment</span><span class=p>[</span><span class=s1>&#39;negative&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>priority_score</span> <span class=o>+=</span> <span class=mi>5</span>  <span class=c1># 부정적 감정 → 높은 우선순위</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 고객 등급 반영 (메시지 메타데이터에서)</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_tier</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customer_tier&#39;</span><span class=p>,</span> <span class=s1>&#39;basic&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>tier_multiplier</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;premium&#39;</span><span class=p>:</span> <span class=mf>1.5</span><span class=p>,</span> <span class=s1>&#39;gold&#39;</span><span class=p>:</span> <span class=mf>1.3</span><span class=p>,</span> <span class=s1>&#39;basic&#39;</span><span class=p>:</span> <span class=mf>1.0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>priority_score</span> <span class=o>*=</span> <span class=n>tier_multiplier</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>customer_tier</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 점수를 우선순위로 변환</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>priority_score</span> <span class=o>&gt;=</span> <span class=mi>15</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;critical&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>priority_score</span> <span class=o>&gt;=</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;high&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>priority_score</span> <span class=o>&gt;=</span> <span class=mi>5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;medium&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;low&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_make_routing_decision</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>priority</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>sentiment</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;최종 라우팅 결정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 우선순위별 큐 매핑</span>
</span></span><span class=line><span class=cl>        <span class=n>priority_queues</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;critical&#39;</span><span class=p>:</span> <span class=s1>&#39;processing.critical.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;high&#39;</span><span class=p>:</span> <span class=s1>&#39;processing.high.queue&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s1>&#39;medium&#39;</span><span class=p>:</span> <span class=s1>&#39;processing.medium.queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;low&#39;</span><span class=p>:</span> <span class=s1>&#39;processing.low.queue&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 특수 처리가 필요한 경우</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>category</span> <span class=o>==</span> <span class=s1>&#39;customer_service&#39;</span> <span class=ow>and</span> <span class=n>sentiment</span><span class=p>[</span><span class=s1>&#39;negative&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;escalation.urgent.queue&#39;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>priority_queues</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>priority</span><span class=p>,</span> <span class=s1>&#39;processing.medium.queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>intelligent_router</span> <span class=o>=</span> <span class=n>IntelligentMessageRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AI 기반 라우팅 결정</span>
</span></span><span class=line><span class=cl><span class=n>routing_key</span> <span class=o>=</span> <span class=k>await</span> <span class=n>intelligent_router</span><span class=o>.</span><span class=n>intelligent_route</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;content&#39;</span><span class=p>:</span> <span class=s1>&#39;I have an urgent issue with my recent order!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;customer_tier&#39;</span><span class=p>:</span> <span class=s1>&#39;premium&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=s1>&#39;2024-08-15T10:30:00Z&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;AI recommended routing: </span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 출력: AI recommended routing: escalation.urgent.queue</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=74-기타-고급-사항-특이사항-전문가-레벨-고려사항>7.4 기타 고급 사항 (특이사항, 전문가 레벨 고려사항)<a hidden class=anchor aria-hidden=true href=#74-기타-고급-사항-특이사항-전문가-레벨-고려사항>#</a></h3><h4 id=고급-네트워크-최적화>고급 네트워크 최적화<a hidden class=anchor aria-hidden=true href=#고급-네트워크-최적화>#</a></h4><p><strong>1. TCP 소켓 튜닝</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-69-1><a class=lnlinks href=#hl-69-1> 1</a>
</span><span class=lnt id=hl-69-2><a class=lnlinks href=#hl-69-2> 2</a>
</span><span class=lnt id=hl-69-3><a class=lnlinks href=#hl-69-3> 3</a>
</span><span class=lnt id=hl-69-4><a class=lnlinks href=#hl-69-4> 4</a>
</span><span class=lnt id=hl-69-5><a class=lnlinks href=#hl-69-5> 5</a>
</span><span class=lnt id=hl-69-6><a class=lnlinks href=#hl-69-6> 6</a>
</span><span class=lnt id=hl-69-7><a class=lnlinks href=#hl-69-7> 7</a>
</span><span class=lnt id=hl-69-8><a class=lnlinks href=#hl-69-8> 8</a>
</span><span class=lnt id=hl-69-9><a class=lnlinks href=#hl-69-9> 9</a>
</span><span class=lnt id=hl-69-10><a class=lnlinks href=#hl-69-10>10</a>
</span><span class=lnt id=hl-69-11><a class=lnlinks href=#hl-69-11>11</a>
</span><span class=lnt id=hl-69-12><a class=lnlinks href=#hl-69-12>12</a>
</span><span class=lnt id=hl-69-13><a class=lnlinks href=#hl-69-13>13</a>
</span><span class=lnt id=hl-69-14><a class=lnlinks href=#hl-69-14>14</a>
</span><span class=lnt id=hl-69-15><a class=lnlinks href=#hl-69-15>15</a>
</span><span class=lnt id=hl-69-16><a class=lnlinks href=#hl-69-16>16</a>
</span><span class=lnt id=hl-69-17><a class=lnlinks href=#hl-69-17>17</a>
</span><span class=lnt id=hl-69-18><a class=lnlinks href=#hl-69-18>18</a>
</span><span class=lnt id=hl-69-19><a class=lnlinks href=#hl-69-19>19</a>
</span><span class=lnt id=hl-69-20><a class=lnlinks href=#hl-69-20>20</a>
</span><span class=lnt id=hl-69-21><a class=lnlinks href=#hl-69-21>21</a>
</span><span class=lnt id=hl-69-22><a class=lnlinks href=#hl-69-22>22</a>
</span><span class=lnt id=hl-69-23><a class=lnlinks href=#hl-69-23>23</a>
</span><span class=lnt id=hl-69-24><a class=lnlinks href=#hl-69-24>24</a>
</span><span class=lnt id=hl-69-25><a class=lnlinks href=#hl-69-25>25</a>
</span><span class=lnt id=hl-69-26><a class=lnlinks href=#hl-69-26>26</a>
</span><span class=lnt id=hl-69-27><a class=lnlinks href=#hl-69-27>27</a>
</span><span class=lnt id=hl-69-28><a class=lnlinks href=#hl-69-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/sysctl.conf - 운영체제 레벨 네트워크 최적화</span>
</span></span><span class=line><span class=cl><span class=c1># TCP 버퍼 크기 최적화 (RabbitMQ 고성능)</span>
</span></span><span class=line><span class=cl>net.core.rmem_default <span class=o>=</span> <span class=m>262144</span>
</span></span><span class=line><span class=cl>net.core.rmem_max <span class=o>=</span> <span class=m>134217728</span>
</span></span><span class=line><span class=cl>net.core.wmem_default <span class=o>=</span> <span class=m>262144</span>  
</span></span><span class=line><span class=cl>net.core.wmem_max <span class=o>=</span> <span class=m>134217728</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TCP 윈도우 스케일링 활성화</span>
</span></span><span class=line><span class=cl>net.ipv4.tcp_window_scaling <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TCP 혼잡 제어 알고리즘 (BBR 권장)</span>
</span></span><span class=line><span class=cl>net.core.default_qdisc <span class=o>=</span> fq
</span></span><span class=line><span class=cl>net.ipv4.tcp_congestion_control <span class=o>=</span> bbr
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 연결 테이블 크기 증가</span>
</span></span><span class=line><span class=cl>net.core.somaxconn <span class=o>=</span> <span class=m>32768</span>
</span></span><span class=line><span class=cl>net.ipv4.tcp_max_syn_backlog <span class=o>=</span> <span class=m>32768</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TIME_WAIT 소켓 재사용 (연결 수 제한 해결)</span>
</span></span><span class=line><span class=cl>net.ipv4.tcp_tw_reuse <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>net.ipv4.tcp_fin_timeout <span class=o>=</span> <span class=m>15</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 파일 디스크립터 한계 증가</span>
</span></span><span class=line><span class=cl>fs.file-max <span class=o>=</span> <span class=m>1048576</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 프로세스별 설정</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;rabbitmq soft nofile 65536&#34;</span> &gt;&gt; /etc/security/limits.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;rabbitmq hard nofile 65536&#34;</span> &gt;&gt; /etc/security/limits.conf
</span></span></code></pre></td></tr></table></div></div><p><strong>2. Erlang VM 세부 튜닝</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-70-1><a class=lnlinks href=#hl-70-1> 1</a>
</span><span class=lnt id=hl-70-2><a class=lnlinks href=#hl-70-2> 2</a>
</span><span class=lnt id=hl-70-3><a class=lnlinks href=#hl-70-3> 3</a>
</span><span class=lnt id=hl-70-4><a class=lnlinks href=#hl-70-4> 4</a>
</span><span class=lnt id=hl-70-5><a class=lnlinks href=#hl-70-5> 5</a>
</span><span class=lnt id=hl-70-6><a class=lnlinks href=#hl-70-6> 6</a>
</span><span class=lnt id=hl-70-7><a class=lnlinks href=#hl-70-7> 7</a>
</span><span class=lnt id=hl-70-8><a class=lnlinks href=#hl-70-8> 8</a>
</span><span class=lnt id=hl-70-9><a class=lnlinks href=#hl-70-9> 9</a>
</span><span class=lnt id=hl-70-10><a class=lnlinks href=#hl-70-10>10</a>
</span><span class=lnt id=hl-70-11><a class=lnlinks href=#hl-70-11>11</a>
</span><span class=lnt id=hl-70-12><a class=lnlinks href=#hl-70-12>12</a>
</span><span class=lnt id=hl-70-13><a class=lnlinks href=#hl-70-13>13</a>
</span><span class=lnt id=hl-70-14><a class=lnlinks href=#hl-70-14>14</a>
</span><span class=lnt id=hl-70-15><a class=lnlinks href=#hl-70-15>15</a>
</span><span class=lnt id=hl-70-16><a class=lnlinks href=#hl-70-16>16</a>
</span><span class=lnt id=hl-70-17><a class=lnlinks href=#hl-70-17>17</a>
</span><span class=lnt id=hl-70-18><a class=lnlinks href=#hl-70-18>18</a>
</span><span class=lnt id=hl-70-19><a class=lnlinks href=#hl-70-19>19</a>
</span><span class=lnt id=hl-70-20><a class=lnlinks href=#hl-70-20>20</a>
</span><span class=lnt id=hl-70-21><a class=lnlinks href=#hl-70-21>21</a>
</span><span class=lnt id=hl-70-22><a class=lnlinks href=#hl-70-22>22</a>
</span><span class=lnt id=hl-70-23><a class=lnlinks href=#hl-70-23>23</a>
</span><span class=lnt id=hl-70-24><a class=lnlinks href=#hl-70-24>24</a>
</span><span class=lnt id=hl-70-25><a class=lnlinks href=#hl-70-25>25</a>
</span><span class=lnt id=hl-70-26><a class=lnlinks href=#hl-70-26>26</a>
</span><span class=lnt id=hl-70-27><a class=lnlinks href=#hl-70-27>27</a>
</span><span class=lnt id=hl-70-28><a class=lnlinks href=#hl-70-28>28</a>
</span><span class=lnt id=hl-70-29><a class=lnlinks href=#hl-70-29>29</a>
</span><span class=lnt id=hl-70-30><a class=lnlinks href=#hl-70-30>30</a>
</span><span class=lnt id=hl-70-31><a class=lnlinks href=#hl-70-31>31</a>
</span><span class=lnt id=hl-70-32><a class=lnlinks href=#hl-70-32>32</a>
</span><span class=lnt id=hl-70-33><a class=lnlinks href=#hl-70-33>33</a>
</span><span class=lnt id=hl-70-34><a class=lnlinks href=#hl-70-34>34</a>
</span><span class=lnt id=hl-70-35><a class=lnlinks href=#hl-70-35>35</a>
</span><span class=lnt id=hl-70-36><a class=lnlinks href=#hl-70-36>36</a>
</span><span class=lnt id=hl-70-37><a class=lnlinks href=#hl-70-37>37</a>
</span><span class=lnt id=hl-70-38><a class=lnlinks href=#hl-70-38>38</a>
</span><span class=lnt id=hl-70-39><a class=lnlinks href=#hl-70-39>39</a>
</span><span class=lnt id=hl-70-40><a class=lnlinks href=#hl-70-40>40</a>
</span><span class=lnt id=hl-70-41><a class=lnlinks href=#hl-70-41>41</a>
</span><span class=lnt id=hl-70-42><a class=lnlinks href=#hl-70-42>42</a>
</span><span class=lnt id=hl-70-43><a class=lnlinks href=#hl-70-43>43</a>
</span><span class=lnt id=hl-70-44><a class=lnlinks href=#hl-70-44>44</a>
</span><span class=lnt id=hl-70-45><a class=lnlinks href=#hl-70-45>45</a>
</span><span class=lnt id=hl-70-46><a class=lnlinks href=#hl-70-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-erlang data-lang=erlang><span class=line><span class=cl><span class=c>%% advanced.config - Erlang VM 최적화
</span></span></span><span class=line><span class=cl><span class=c></span><span class=p>[</span>
</span></span><span class=line><span class=cl> <span class=p>{</span><span class=n>kernel</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c>%% 분산 Erlang 최적화
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>inet_dist_listen_min</span><span class=p>,</span> <span class=mi>25672</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>inet_dist_listen_max</span><span class=p>,</span> <span class=mi>25672</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>inet_default_connect_options</span><span class=p>,</span> <span class=p>[{</span><span class=n>nodelay</span><span class=p>,</span> <span class=n>true</span><span class=p>},</span> <span class=p>{</span><span class=n>keepalive</span><span class=p>,</span> <span class=n>true</span><span class=p>}]},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% TCP 버퍼 튜닝
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>inet_default_listen_options</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>backlog</span><span class=p>,</span> <span class=mi>128</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>nodelay</span><span class=p>,</span> <span class=n>true</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>sndbuf</span><span class=p>,</span> <span class=mi>32768</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>recbuf</span><span class=p>,</span> <span class=mi>32768</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]}</span>
</span></span><span class=line><span class=cl> <span class=p>]},</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=p>{</span><span class=n>rabbit</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c>%% 채널 최적화
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>channel_max</span><span class=p>,</span> <span class=mi>2047</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>heartbeat</span><span class=p>,</span> <span class=mi>60</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% 메모리 관리 고급 설정
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>vm_memory_calculation_strategy</span><span class=p>,</span> <span class=n>rss</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>vm_memory_high_watermark_paging_ratio</span><span class=p>,</span> <span class=mi>0</span><span class=p>.</span><span class=mi>75</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% 디스크 I/O 최적화
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>msg_store_file_size_limit</span><span class=p>,</span> <span class=mi>67108864</span><span class=p>},</span>  <span class=c>% 64MB 파일 크기
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>msg_store_index_module</span><span class=p>,</span> <span class=n>rabbit_msg_store_ets_index</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% 큐 인덱스 최적화
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>queue_index_embed_msgs_below</span><span class=p>,</span> <span class=mi>4096</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>queue_index_max_journal_entries</span><span class=p>,</span> <span class=mi>32768</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c>%% 클러스터 통신 최적화  
</span></span></span><span class=line><span class=cl><span class=c></span>    <span class=p>{</span><span class=n>cluster_keepalive_interval</span><span class=p>,</span> <span class=mi>10000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>mnesia_table_loading_retry_timeout</span><span class=p>,</span> <span class=mi>30000</span><span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>]},</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=c>%% SSL/TLS 성능 최적화
</span></span></span><span class=line><span class=cl><span class=c></span> <span class=p>{</span><span class=n>ssl</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>session_lifetime</span><span class=p>,</span> <span class=mi>300</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>session_cache_client_max</span><span class=p>,</span> <span class=mi>10000</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=n>session_cache_server_max</span><span class=p>,</span> <span class=mi>10000</span><span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>]}</span>
</span></span><span class=line><span class=cl><span class=p>].</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=메시지-직렬화-최적화>메시지 직렬화 최적화<a hidden class=anchor aria-hidden=true href=#메시지-직렬화-최적화>#</a></h4><p><strong>1. 고성능 직렬화 포맷</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-71-1><a class=lnlinks href=#hl-71-1>  1</a>
</span><span class=lnt id=hl-71-2><a class=lnlinks href=#hl-71-2>  2</a>
</span><span class=lnt id=hl-71-3><a class=lnlinks href=#hl-71-3>  3</a>
</span><span class=lnt id=hl-71-4><a class=lnlinks href=#hl-71-4>  4</a>
</span><span class=lnt id=hl-71-5><a class=lnlinks href=#hl-71-5>  5</a>
</span><span class=lnt id=hl-71-6><a class=lnlinks href=#hl-71-6>  6</a>
</span><span class=lnt id=hl-71-7><a class=lnlinks href=#hl-71-7>  7</a>
</span><span class=lnt id=hl-71-8><a class=lnlinks href=#hl-71-8>  8</a>
</span><span class=lnt id=hl-71-9><a class=lnlinks href=#hl-71-9>  9</a>
</span><span class=lnt id=hl-71-10><a class=lnlinks href=#hl-71-10> 10</a>
</span><span class=lnt id=hl-71-11><a class=lnlinks href=#hl-71-11> 11</a>
</span><span class=lnt id=hl-71-12><a class=lnlinks href=#hl-71-12> 12</a>
</span><span class=lnt id=hl-71-13><a class=lnlinks href=#hl-71-13> 13</a>
</span><span class=lnt id=hl-71-14><a class=lnlinks href=#hl-71-14> 14</a>
</span><span class=lnt id=hl-71-15><a class=lnlinks href=#hl-71-15> 15</a>
</span><span class=lnt id=hl-71-16><a class=lnlinks href=#hl-71-16> 16</a>
</span><span class=lnt id=hl-71-17><a class=lnlinks href=#hl-71-17> 17</a>
</span><span class=lnt id=hl-71-18><a class=lnlinks href=#hl-71-18> 18</a>
</span><span class=lnt id=hl-71-19><a class=lnlinks href=#hl-71-19> 19</a>
</span><span class=lnt id=hl-71-20><a class=lnlinks href=#hl-71-20> 20</a>
</span><span class=lnt id=hl-71-21><a class=lnlinks href=#hl-71-21> 21</a>
</span><span class=lnt id=hl-71-22><a class=lnlinks href=#hl-71-22> 22</a>
</span><span class=lnt id=hl-71-23><a class=lnlinks href=#hl-71-23> 23</a>
</span><span class=lnt id=hl-71-24><a class=lnlinks href=#hl-71-24> 24</a>
</span><span class=lnt id=hl-71-25><a class=lnlinks href=#hl-71-25> 25</a>
</span><span class=lnt id=hl-71-26><a class=lnlinks href=#hl-71-26> 26</a>
</span><span class=lnt id=hl-71-27><a class=lnlinks href=#hl-71-27> 27</a>
</span><span class=lnt id=hl-71-28><a class=lnlinks href=#hl-71-28> 28</a>
</span><span class=lnt id=hl-71-29><a class=lnlinks href=#hl-71-29> 29</a>
</span><span class=lnt id=hl-71-30><a class=lnlinks href=#hl-71-30> 30</a>
</span><span class=lnt id=hl-71-31><a class=lnlinks href=#hl-71-31> 31</a>
</span><span class=lnt id=hl-71-32><a class=lnlinks href=#hl-71-32> 32</a>
</span><span class=lnt id=hl-71-33><a class=lnlinks href=#hl-71-33> 33</a>
</span><span class=lnt id=hl-71-34><a class=lnlinks href=#hl-71-34> 34</a>
</span><span class=lnt id=hl-71-35><a class=lnlinks href=#hl-71-35> 35</a>
</span><span class=lnt id=hl-71-36><a class=lnlinks href=#hl-71-36> 36</a>
</span><span class=lnt id=hl-71-37><a class=lnlinks href=#hl-71-37> 37</a>
</span><span class=lnt id=hl-71-38><a class=lnlinks href=#hl-71-38> 38</a>
</span><span class=lnt id=hl-71-39><a class=lnlinks href=#hl-71-39> 39</a>
</span><span class=lnt id=hl-71-40><a class=lnlinks href=#hl-71-40> 40</a>
</span><span class=lnt id=hl-71-41><a class=lnlinks href=#hl-71-41> 41</a>
</span><span class=lnt id=hl-71-42><a class=lnlinks href=#hl-71-42> 42</a>
</span><span class=lnt id=hl-71-43><a class=lnlinks href=#hl-71-43> 43</a>
</span><span class=lnt id=hl-71-44><a class=lnlinks href=#hl-71-44> 44</a>
</span><span class=lnt id=hl-71-45><a class=lnlinks href=#hl-71-45> 45</a>
</span><span class=lnt id=hl-71-46><a class=lnlinks href=#hl-71-46> 46</a>
</span><span class=lnt id=hl-71-47><a class=lnlinks href=#hl-71-47> 47</a>
</span><span class=lnt id=hl-71-48><a class=lnlinks href=#hl-71-48> 48</a>
</span><span class=lnt id=hl-71-49><a class=lnlinks href=#hl-71-49> 49</a>
</span><span class=lnt id=hl-71-50><a class=lnlinks href=#hl-71-50> 50</a>
</span><span class=lnt id=hl-71-51><a class=lnlinks href=#hl-71-51> 51</a>
</span><span class=lnt id=hl-71-52><a class=lnlinks href=#hl-71-52> 52</a>
</span><span class=lnt id=hl-71-53><a class=lnlinks href=#hl-71-53> 53</a>
</span><span class=lnt id=hl-71-54><a class=lnlinks href=#hl-71-54> 54</a>
</span><span class=lnt id=hl-71-55><a class=lnlinks href=#hl-71-55> 55</a>
</span><span class=lnt id=hl-71-56><a class=lnlinks href=#hl-71-56> 56</a>
</span><span class=lnt id=hl-71-57><a class=lnlinks href=#hl-71-57> 57</a>
</span><span class=lnt id=hl-71-58><a class=lnlinks href=#hl-71-58> 58</a>
</span><span class=lnt id=hl-71-59><a class=lnlinks href=#hl-71-59> 59</a>
</span><span class=lnt id=hl-71-60><a class=lnlinks href=#hl-71-60> 60</a>
</span><span class=lnt id=hl-71-61><a class=lnlinks href=#hl-71-61> 61</a>
</span><span class=lnt id=hl-71-62><a class=lnlinks href=#hl-71-62> 62</a>
</span><span class=lnt id=hl-71-63><a class=lnlinks href=#hl-71-63> 63</a>
</span><span class=lnt id=hl-71-64><a class=lnlinks href=#hl-71-64> 64</a>
</span><span class=lnt id=hl-71-65><a class=lnlinks href=#hl-71-65> 65</a>
</span><span class=lnt id=hl-71-66><a class=lnlinks href=#hl-71-66> 66</a>
</span><span class=lnt id=hl-71-67><a class=lnlinks href=#hl-71-67> 67</a>
</span><span class=lnt id=hl-71-68><a class=lnlinks href=#hl-71-68> 68</a>
</span><span class=lnt id=hl-71-69><a class=lnlinks href=#hl-71-69> 69</a>
</span><span class=lnt id=hl-71-70><a class=lnlinks href=#hl-71-70> 70</a>
</span><span class=lnt id=hl-71-71><a class=lnlinks href=#hl-71-71> 71</a>
</span><span class=lnt id=hl-71-72><a class=lnlinks href=#hl-71-72> 72</a>
</span><span class=lnt id=hl-71-73><a class=lnlinks href=#hl-71-73> 73</a>
</span><span class=lnt id=hl-71-74><a class=lnlinks href=#hl-71-74> 74</a>
</span><span class=lnt id=hl-71-75><a class=lnlinks href=#hl-71-75> 75</a>
</span><span class=lnt id=hl-71-76><a class=lnlinks href=#hl-71-76> 76</a>
</span><span class=lnt id=hl-71-77><a class=lnlinks href=#hl-71-77> 77</a>
</span><span class=lnt id=hl-71-78><a class=lnlinks href=#hl-71-78> 78</a>
</span><span class=lnt id=hl-71-79><a class=lnlinks href=#hl-71-79> 79</a>
</span><span class=lnt id=hl-71-80><a class=lnlinks href=#hl-71-80> 80</a>
</span><span class=lnt id=hl-71-81><a class=lnlinks href=#hl-71-81> 81</a>
</span><span class=lnt id=hl-71-82><a class=lnlinks href=#hl-71-82> 82</a>
</span><span class=lnt id=hl-71-83><a class=lnlinks href=#hl-71-83> 83</a>
</span><span class=lnt id=hl-71-84><a class=lnlinks href=#hl-71-84> 84</a>
</span><span class=lnt id=hl-71-85><a class=lnlinks href=#hl-71-85> 85</a>
</span><span class=lnt id=hl-71-86><a class=lnlinks href=#hl-71-86> 86</a>
</span><span class=lnt id=hl-71-87><a class=lnlinks href=#hl-71-87> 87</a>
</span><span class=lnt id=hl-71-88><a class=lnlinks href=#hl-71-88> 88</a>
</span><span class=lnt id=hl-71-89><a class=lnlinks href=#hl-71-89> 89</a>
</span><span class=lnt id=hl-71-90><a class=lnlinks href=#hl-71-90> 90</a>
</span><span class=lnt id=hl-71-91><a class=lnlinks href=#hl-71-91> 91</a>
</span><span class=lnt id=hl-71-92><a class=lnlinks href=#hl-71-92> 92</a>
</span><span class=lnt id=hl-71-93><a class=lnlinks href=#hl-71-93> 93</a>
</span><span class=lnt id=hl-71-94><a class=lnlinks href=#hl-71-94> 94</a>
</span><span class=lnt id=hl-71-95><a class=lnlinks href=#hl-71-95> 95</a>
</span><span class=lnt id=hl-71-96><a class=lnlinks href=#hl-71-96> 96</a>
</span><span class=lnt id=hl-71-97><a class=lnlinks href=#hl-71-97> 97</a>
</span><span class=lnt id=hl-71-98><a class=lnlinks href=#hl-71-98> 98</a>
</span><span class=lnt id=hl-71-99><a class=lnlinks href=#hl-71-99> 99</a>
</span><span class=lnt id=hl-71-100><a class=lnlinks href=#hl-71-100>100</a>
</span><span class=lnt id=hl-71-101><a class=lnlinks href=#hl-71-101>101</a>
</span><span class=lnt id=hl-71-102><a class=lnlinks href=#hl-71-102>102</a>
</span><span class=lnt id=hl-71-103><a class=lnlinks href=#hl-71-103>103</a>
</span><span class=lnt id=hl-71-104><a class=lnlinks href=#hl-71-104>104</a>
</span><span class=lnt id=hl-71-105><a class=lnlinks href=#hl-71-105>105</a>
</span><span class=lnt id=hl-71-106><a class=lnlinks href=#hl-71-106>106</a>
</span><span class=lnt id=hl-71-107><a class=lnlinks href=#hl-71-107>107</a>
</span><span class=lnt id=hl-71-108><a class=lnlinks href=#hl-71-108>108</a>
</span><span class=lnt id=hl-71-109><a class=lnlinks href=#hl-71-109>109</a>
</span><span class=lnt id=hl-71-110><a class=lnlinks href=#hl-71-110>110</a>
</span><span class=lnt id=hl-71-111><a class=lnlinks href=#hl-71-111>111</a>
</span><span class=lnt id=hl-71-112><a class=lnlinks href=#hl-71-112>112</a>
</span><span class=lnt id=hl-71-113><a class=lnlinks href=#hl-71-113>113</a>
</span><span class=lnt id=hl-71-114><a class=lnlinks href=#hl-71-114>114</a>
</span><span class=lnt id=hl-71-115><a class=lnlinks href=#hl-71-115>115</a>
</span><span class=lnt id=hl-71-116><a class=lnlinks href=#hl-71-116>116</a>
</span><span class=lnt id=hl-71-117><a class=lnlinks href=#hl-71-117>117</a>
</span><span class=lnt id=hl-71-118><a class=lnlinks href=#hl-71-118>118</a>
</span><span class=lnt id=hl-71-119><a class=lnlinks href=#hl-71-119>119</a>
</span><span class=lnt id=hl-71-120><a class=lnlinks href=#hl-71-120>120</a>
</span><span class=lnt id=hl-71-121><a class=lnlinks href=#hl-71-121>121</a>
</span><span class=lnt id=hl-71-122><a class=lnlinks href=#hl-71-122>122</a>
</span><span class=lnt id=hl-71-123><a class=lnlinks href=#hl-71-123>123</a>
</span><span class=lnt id=hl-71-124><a class=lnlinks href=#hl-71-124>124</a>
</span><span class=lnt id=hl-71-125><a class=lnlinks href=#hl-71-125>125</a>
</span><span class=lnt id=hl-71-126><a class=lnlinks href=#hl-71-126>126</a>
</span><span class=lnt id=hl-71-127><a class=lnlinks href=#hl-71-127>127</a>
</span><span class=lnt id=hl-71-128><a class=lnlinks href=#hl-71-128>128</a>
</span><span class=lnt id=hl-71-129><a class=lnlinks href=#hl-71-129>129</a>
</span><span class=lnt id=hl-71-130><a class=lnlinks href=#hl-71-130>130</a>
</span><span class=lnt id=hl-71-131><a class=lnlinks href=#hl-71-131>131</a>
</span><span class=lnt id=hl-71-132><a class=lnlinks href=#hl-71-132>132</a>
</span><span class=lnt id=hl-71-133><a class=lnlinks href=#hl-71-133>133</a>
</span><span class=lnt id=hl-71-134><a class=lnlinks href=#hl-71-134>134</a>
</span><span class=lnt id=hl-71-135><a class=lnlinks href=#hl-71-135>135</a>
</span><span class=lnt id=hl-71-136><a class=lnlinks href=#hl-71-136>136</a>
</span><span class=lnt id=hl-71-137><a class=lnlinks href=#hl-71-137>137</a>
</span><span class=lnt id=hl-71-138><a class=lnlinks href=#hl-71-138>138</a>
</span><span class=lnt id=hl-71-139><a class=lnlinks href=#hl-71-139>139</a>
</span><span class=lnt id=hl-71-140><a class=lnlinks href=#hl-71-140>140</a>
</span><span class=lnt id=hl-71-141><a class=lnlinks href=#hl-71-141>141</a>
</span><span class=lnt id=hl-71-142><a class=lnlinks href=#hl-71-142>142</a>
</span><span class=lnt id=hl-71-143><a class=lnlinks href=#hl-71-143>143</a>
</span><span class=lnt id=hl-71-144><a class=lnlinks href=#hl-71-144>144</a>
</span><span class=lnt id=hl-71-145><a class=lnlinks href=#hl-71-145>145</a>
</span><span class=lnt id=hl-71-146><a class=lnlinks href=#hl-71-146>146</a>
</span><span class=lnt id=hl-71-147><a class=lnlinks href=#hl-71-147>147</a>
</span><span class=lnt id=hl-71-148><a class=lnlinks href=#hl-71-148>148</a>
</span><span class=lnt id=hl-71-149><a class=lnlinks href=#hl-71-149>149</a>
</span><span class=lnt id=hl-71-150><a class=lnlinks href=#hl-71-150>150</a>
</span><span class=lnt id=hl-71-151><a class=lnlinks href=#hl-71-151>151</a>
</span><span class=lnt id=hl-71-152><a class=lnlinks href=#hl-71-152>152</a>
</span><span class=lnt id=hl-71-153><a class=lnlinks href=#hl-71-153>153</a>
</span><span class=lnt id=hl-71-154><a class=lnlinks href=#hl-71-154>154</a>
</span><span class=lnt id=hl-71-155><a class=lnlinks href=#hl-71-155>155</a>
</span><span class=lnt id=hl-71-156><a class=lnlinks href=#hl-71-156>156</a>
</span><span class=lnt id=hl-71-157><a class=lnlinks href=#hl-71-157>157</a>
</span><span class=lnt id=hl-71-158><a class=lnlinks href=#hl-71-158>158</a>
</span><span class=lnt id=hl-71-159><a class=lnlinks href=#hl-71-159>159</a>
</span><span class=lnt id=hl-71-160><a class=lnlinks href=#hl-71-160>160</a>
</span><span class=lnt id=hl-71-161><a class=lnlinks href=#hl-71-161>161</a>
</span><span class=lnt id=hl-71-162><a class=lnlinks href=#hl-71-162>162</a>
</span><span class=lnt id=hl-71-163><a class=lnlinks href=#hl-71-163>163</a>
</span><span class=lnt id=hl-71-164><a class=lnlinks href=#hl-71-164>164</a>
</span><span class=lnt id=hl-71-165><a class=lnlinks href=#hl-71-165>165</a>
</span><span class=lnt id=hl-71-166><a class=lnlinks href=#hl-71-166>166</a>
</span><span class=lnt id=hl-71-167><a class=lnlinks href=#hl-71-167>167</a>
</span><span class=lnt id=hl-71-168><a class=lnlinks href=#hl-71-168>168</a>
</span><span class=lnt id=hl-71-169><a class=lnlinks href=#hl-71-169>169</a>
</span><span class=lnt id=hl-71-170><a class=lnlinks href=#hl-71-170>170</a>
</span><span class=lnt id=hl-71-171><a class=lnlinks href=#hl-71-171>171</a>
</span><span class=lnt id=hl-71-172><a class=lnlinks href=#hl-71-172>172</a>
</span><span class=lnt id=hl-71-173><a class=lnlinks href=#hl-71-173>173</a>
</span><span class=lnt id=hl-71-174><a class=lnlinks href=#hl-71-174>174</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 다양한 직렬화 형식 성능 비교</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pickle</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>msgpack</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>avro.schema</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>avro.io</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BenchmarkResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>format_name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>serialize_time_ms</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>deserialize_time_ms</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>size_bytes</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>compression_ratio</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SerializationBenchmark</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    메시지 직렬화 성능 벤치마크
</span></span></span><span class=line><span class=cl><span class=s2>    - JSON vs MessagePack vs Avro vs Protocol Buffers
</span></span></span><span class=line><span class=cl><span class=s2>    - 크기, 속도, 호환성 비교
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Avro 스키마 정의</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>avro_schema</span> <span class=o>=</span> <span class=n>avro</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        {
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;type&#34;: &#34;record&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;name&#34;: &#34;OrderMessage&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;fields&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>                {&#34;name&#34;: &#34;order_id&#34;, &#34;type&#34;: &#34;string&#34;},
</span></span></span><span class=line><span class=cl><span class=s2>                {&#34;name&#34;: &#34;customer_id&#34;, &#34;type&#34;: &#34;string&#34;},
</span></span></span><span class=line><span class=cl><span class=s2>                {&#34;name&#34;: &#34;items&#34;, &#34;type&#34;: {&#34;type&#34;: &#34;array&#34;, &#34;items&#34;: &#34;string&#34;}},
</span></span></span><span class=line><span class=cl><span class=s2>                {&#34;name&#34;: &#34;total_amount&#34;, &#34;type&#34;: &#34;double&#34;},
</span></span></span><span class=line><span class=cl><span class=s2>                {&#34;name&#34;: &#34;timestamp&#34;, &#34;type&#34;: &#34;long&#34;}
</span></span></span><span class=line><span class=cl><span class=s2>            ]
</span></span></span><span class=line><span class=cl><span class=s2>        }
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>benchmark_formats</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>test_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>iterations</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;다양한 직렬화 형식 벤치마크&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># JSON 벤치마크</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_benchmark_json</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=n>iterations</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># MessagePack 벤치마크  </span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_benchmark_msgpack</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=n>iterations</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Avro 벤치마크</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_benchmark_avro</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=n>iterations</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Pickle 벤치마크 (Python 전용)</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_benchmark_pickle</span><span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=n>iterations</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_benchmark_json</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>iterations</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>BenchmarkResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;JSON 직렬화 벤치마크&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 직렬화 성능 측정</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>serialized_data</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>serialized_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>serialize_time</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>/</span> <span class=n>iterations</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 역직렬화 성능 측정</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>serialized_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>deserialize_time</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>/</span> <span class=n>iterations</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BenchmarkResult</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>format_name</span><span class=o>=</span><span class=s2>&#34;JSON&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>serialize_time_ms</span><span class=o>=</span><span class=n>serialize_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>deserialize_time_ms</span><span class=o>=</span><span class=n>deserialize_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>size_bytes</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>serialized_data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=n>compression_ratio</span><span class=o>=</span><span class=mf>1.0</span>  <span class=c1># 기준점</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_benchmark_msgpack</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>iterations</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>BenchmarkResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;MessagePack 직렬화 벤치마크&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 직렬화 성능 측정</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>serialized_data</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>serialized_data</span> <span class=o>=</span> <span class=n>msgpack</span><span class=o>.</span><span class=n>packb</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>serialize_time</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>/</span> <span class=n>iterations</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 역직렬화 성능 측정</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>msgpack</span><span class=o>.</span><span class=n>unpackb</span><span class=p>(</span><span class=n>serialized_data</span><span class=p>,</span> <span class=n>raw</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>deserialize_time</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>/</span> <span class=n>iterations</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># JSON 대비 압축률 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>json_size</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>compression_ratio</span> <span class=o>=</span> <span class=n>json_size</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>serialized_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BenchmarkResult</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>format_name</span><span class=o>=</span><span class=s2>&#34;MessagePack&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>serialize_time_ms</span><span class=o>=</span><span class=n>serialize_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>deserialize_time_ms</span><span class=o>=</span><span class=n>deserialize_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>size_bytes</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>serialized_data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>compression_ratio</span><span class=o>=</span><span class=n>compression_ratio</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_optimal_format</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>results</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=n>priority</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;balanced&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;최적 직렬화 형식 추천&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>priority</span> <span class=o>==</span> <span class=s2>&#34;speed&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 속도 우선 (직렬화 + 역직렬화 시간 합계 기준)</span>
</span></span><span class=line><span class=cl>            <span class=n>fastest</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>r</span><span class=p>:</span> <span class=n>r</span><span class=o>.</span><span class=n>serialize_time_ms</span> <span class=o>+</span> <span class=n>r</span><span class=o>.</span><span class=n>deserialize_time_ms</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>fastest</span><span class=o>.</span><span class=n>format_name</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>priority</span> <span class=o>==</span> <span class=s2>&#34;size&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 크기 우선</span>
</span></span><span class=line><span class=cl>            <span class=n>smallest</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>r</span><span class=p>:</span> <span class=n>r</span><span class=o>.</span><span class=n>size_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>smallest</span><span class=o>.</span><span class=n>format_name</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>  <span class=c1># balanced</span>
</span></span><span class=line><span class=cl>            <span class=c1># 균형 고려 (속도와 크기의 가중 평균)</span>
</span></span><span class=line><span class=cl>            <span class=k>def</span> <span class=nf>score</span><span class=p>(</span><span class=n>result</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>speed_score</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>serialize_time_ms</span> <span class=o>+</span> <span class=n>result</span><span class=o>.</span><span class=n>deserialize_time_ms</span>
</span></span><span class=line><span class=cl>                <span class=n>size_score</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>size_bytes</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>speed_score</span> <span class=o>*</span> <span class=mf>0.6</span> <span class=o>+</span> <span class=n>size_score</span> <span class=o>*</span> <span class=mf>0.4</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>optimal</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>score</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>optimal</span><span class=o>.</span><span class=n>format_name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 벤치마크 실행</span>
</span></span><span class=line><span class=cl><span class=n>benchmark</span> <span class=o>=</span> <span class=n>SerializationBenchmark</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>test_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD-12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;CUST-67890&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;ITEM-001&#34;</span><span class=p>,</span> <span class=s2>&#34;ITEM-002&#34;</span><span class=p>,</span> <span class=s2>&#34;ITEM-003&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;total_amount&#34;</span><span class=p>:</span> <span class=mf>299.99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;mobile_app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;sess_abcdef123456&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>benchmark</span><span class=o>.</span><span class=n>benchmark_formats</span><span class=p>(</span><span class=n>test_message</span><span class=p>,</span> <span class=n>iterations</span><span class=o>=</span><span class=mi>10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 결과 출력</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>format_name</span><span class=si>}</span><span class=s2> Performance:
</span></span></span><span class=line><span class=cl><span class=s2>  Serialize: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>serialize_time_ms</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2> ms
</span></span></span><span class=line><span class=cl><span class=s2>  Deserialize: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>deserialize_time_ms</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2> ms  
</span></span></span><span class=line><span class=cl><span class=s2>  Size: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>size_bytes</span><span class=si>}</span><span class=s2> bytes
</span></span></span><span class=line><span class=cl><span class=s2>  Compression: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>compression_ratio</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>x
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 최적 형식 추천</span>
</span></span><span class=line><span class=cl><span class=n>optimal_format</span> <span class=o>=</span> <span class=n>benchmark</span><span class=o>.</span><span class=n>get_optimal_format</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>priority</span><span class=o>=</span><span class=s2>&#34;balanced&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Recommended format: </span><span class=si>{</span><span class=n>optimal_format</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=고가용성-아키텍처-패턴>고가용성 아키텍처 패턴<a hidden class=anchor aria-hidden=true href=#고가용성-아키텍처-패턴>#</a></h4><p><strong>1. 멀티 리전 클러스터</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-72-1><a class=lnlinks href=#hl-72-1> 1</a>
</span><span class=lnt id=hl-72-2><a class=lnlinks href=#hl-72-2> 2</a>
</span><span class=lnt id=hl-72-3><a class=lnlinks href=#hl-72-3> 3</a>
</span><span class=lnt id=hl-72-4><a class=lnlinks href=#hl-72-4> 4</a>
</span><span class=lnt id=hl-72-5><a class=lnlinks href=#hl-72-5> 5</a>
</span><span class=lnt id=hl-72-6><a class=lnlinks href=#hl-72-6> 6</a>
</span><span class=lnt id=hl-72-7><a class=lnlinks href=#hl-72-7> 7</a>
</span><span class=lnt id=hl-72-8><a class=lnlinks href=#hl-72-8> 8</a>
</span><span class=lnt id=hl-72-9><a class=lnlinks href=#hl-72-9> 9</a>
</span><span class=lnt id=hl-72-10><a class=lnlinks href=#hl-72-10>10</a>
</span><span class=lnt id=hl-72-11><a class=lnlinks href=#hl-72-11>11</a>
</span><span class=lnt id=hl-72-12><a class=lnlinks href=#hl-72-12>12</a>
</span><span class=lnt id=hl-72-13><a class=lnlinks href=#hl-72-13>13</a>
</span><span class=lnt id=hl-72-14><a class=lnlinks href=#hl-72-14>14</a>
</span><span class=lnt id=hl-72-15><a class=lnlinks href=#hl-72-15>15</a>
</span><span class=lnt id=hl-72-16><a class=lnlinks href=#hl-72-16>16</a>
</span><span class=lnt id=hl-72-17><a class=lnlinks href=#hl-72-17>17</a>
</span><span class=lnt id=hl-72-18><a class=lnlinks href=#hl-72-18>18</a>
</span><span class=lnt id=hl-72-19><a class=lnlinks href=#hl-72-19>19</a>
</span><span class=lnt id=hl-72-20><a class=lnlinks href=#hl-72-20>20</a>
</span><span class=lnt id=hl-72-21><a class=lnlinks href=#hl-72-21>21</a>
</span><span class=lnt id=hl-72-22><a class=lnlinks href=#hl-72-22>22</a>
</span><span class=lnt id=hl-72-23><a class=lnlinks href=#hl-72-23>23</a>
</span><span class=lnt id=hl-72-24><a class=lnlinks href=#hl-72-24>24</a>
</span><span class=lnt id=hl-72-25><a class=lnlinks href=#hl-72-25>25</a>
</span><span class=lnt id=hl-72-26><a class=lnlinks href=#hl-72-26>26</a>
</span><span class=lnt id=hl-72-27><a class=lnlinks href=#hl-72-27>27</a>
</span><span class=lnt id=hl-72-28><a class=lnlinks href=#hl-72-28>28</a>
</span><span class=lnt id=hl-72-29><a class=lnlinks href=#hl-72-29>29</a>
</span><span class=lnt id=hl-72-30><a class=lnlinks href=#hl-72-30>30</a>
</span><span class=lnt id=hl-72-31><a class=lnlinks href=#hl-72-31>31</a>
</span><span class=lnt id=hl-72-32><a class=lnlinks href=#hl-72-32>32</a>
</span><span class=lnt id=hl-72-33><a class=lnlinks href=#hl-72-33>33</a>
</span><span class=lnt id=hl-72-34><a class=lnlinks href=#hl-72-34>34</a>
</span><span class=lnt id=hl-72-35><a class=lnlinks href=#hl-72-35>35</a>
</span><span class=lnt id=hl-72-36><a class=lnlinks href=#hl-72-36>36</a>
</span><span class=lnt id=hl-72-37><a class=lnlinks href=#hl-72-37>37</a>
</span><span class=lnt id=hl-72-38><a class=lnlinks href=#hl-72-38>38</a>
</span><span class=lnt id=hl-72-39><a class=lnlinks href=#hl-72-39>39</a>
</span><span class=lnt id=hl-72-40><a class=lnlinks href=#hl-72-40>40</a>
</span><span class=lnt id=hl-72-41><a class=lnlinks href=#hl-72-41>41</a>
</span><span class=lnt id=hl-72-42><a class=lnlinks href=#hl-72-42>42</a>
</span><span class=lnt id=hl-72-43><a class=lnlinks href=#hl-72-43>43</a>
</span><span class=lnt id=hl-72-44><a class=lnlinks href=#hl-72-44>44</a>
</span><span class=lnt id=hl-72-45><a class=lnlinks href=#hl-72-45>45</a>
</span><span class=lnt id=hl-72-46><a class=lnlinks href=#hl-72-46>46</a>
</span><span class=lnt id=hl-72-47><a class=lnlinks href=#hl-72-47>47</a>
</span><span class=lnt id=hl-72-48><a class=lnlinks href=#hl-72-48>48</a>
</span><span class=lnt id=hl-72-49><a class=lnlinks href=#hl-72-49>49</a>
</span><span class=lnt id=hl-72-50><a class=lnlinks href=#hl-72-50>50</a>
</span><span class=lnt id=hl-72-51><a class=lnlinks href=#hl-72-51>51</a>
</span><span class=lnt id=hl-72-52><a class=lnlinks href=#hl-72-52>52</a>
</span><span class=lnt id=hl-72-53><a class=lnlinks href=#hl-72-53>53</a>
</span><span class=lnt id=hl-72-54><a class=lnlinks href=#hl-72-54>54</a>
</span><span class=lnt id=hl-72-55><a class=lnlinks href=#hl-72-55>55</a>
</span><span class=lnt id=hl-72-56><a class=lnlinks href=#hl-72-56>56</a>
</span><span class=lnt id=hl-72-57><a class=lnlinks href=#hl-72-57>57</a>
</span><span class=lnt id=hl-72-58><a class=lnlinks href=#hl-72-58>58</a>
</span><span class=lnt id=hl-72-59><a class=lnlinks href=#hl-72-59>59</a>
</span><span class=lnt id=hl-72-60><a class=lnlinks href=#hl-72-60>60</a>
</span><span class=lnt id=hl-72-61><a class=lnlinks href=#hl-72-61>61</a>
</span><span class=lnt id=hl-72-62><a class=lnlinks href=#hl-72-62>62</a>
</span><span class=lnt id=hl-72-63><a class=lnlinks href=#hl-72-63>63</a>
</span><span class=lnt id=hl-72-64><a class=lnlinks href=#hl-72-64>64</a>
</span><span class=lnt id=hl-72-65><a class=lnlinks href=#hl-72-65>65</a>
</span><span class=lnt id=hl-72-66><a class=lnlinks href=#hl-72-66>66</a>
</span><span class=lnt id=hl-72-67><a class=lnlinks href=#hl-72-67>67</a>
</span><span class=lnt id=hl-72-68><a class=lnlinks href=#hl-72-68>68</a>
</span><span class=lnt id=hl-72-69><a class=lnlinks href=#hl-72-69>69</a>
</span><span class=lnt id=hl-72-70><a class=lnlinks href=#hl-72-70>70</a>
</span><span class=lnt id=hl-72-71><a class=lnlinks href=#hl-72-71>71</a>
</span><span class=lnt id=hl-72-72><a class=lnlinks href=#hl-72-72>72</a>
</span><span class=lnt id=hl-72-73><a class=lnlinks href=#hl-72-73>73</a>
</span><span class=lnt id=hl-72-74><a class=lnlinks href=#hl-72-74>74</a>
</span><span class=lnt id=hl-72-75><a class=lnlinks href=#hl-72-75>75</a>
</span><span class=lnt id=hl-72-76><a class=lnlinks href=#hl-72-76>76</a>
</span><span class=lnt id=hl-72-77><a class=lnlinks href=#hl-72-77>77</a>
</span><span class=lnt id=hl-72-78><a class=lnlinks href=#hl-72-78>78</a>
</span><span class=lnt id=hl-72-79><a class=lnlinks href=#hl-72-79>79</a>
</span><span class=lnt id=hl-72-80><a class=lnlinks href=#hl-72-80>80</a>
</span><span class=lnt id=hl-72-81><a class=lnlinks href=#hl-72-81>81</a>
</span><span class=lnt id=hl-72-82><a class=lnlinks href=#hl-72-82>82</a>
</span><span class=lnt id=hl-72-83><a class=lnlinks href=#hl-72-83>83</a>
</span><span class=lnt id=hl-72-84><a class=lnlinks href=#hl-72-84>84</a>
</span><span class=lnt id=hl-72-85><a class=lnlinks href=#hl-72-85>85</a>
</span><span class=lnt id=hl-72-86><a class=lnlinks href=#hl-72-86>86</a>
</span><span class=lnt id=hl-72-87><a class=lnlinks href=#hl-72-87>87</a>
</span><span class=lnt id=hl-72-88><a class=lnlinks href=#hl-72-88>88</a>
</span><span class=lnt id=hl-72-89><a class=lnlinks href=#hl-72-89>89</a>
</span><span class=lnt id=hl-72-90><a class=lnlinks href=#hl-72-90>90</a>
</span><span class=lnt id=hl-72-91><a class=lnlinks href=#hl-72-91>91</a>
</span><span class=lnt id=hl-72-92><a class=lnlinks href=#hl-72-92>92</a>
</span><span class=lnt id=hl-72-93><a class=lnlinks href=#hl-72-93>93</a>
</span><span class=lnt id=hl-72-94><a class=lnlinks href=#hl-72-94>94</a>
</span><span class=lnt id=hl-72-95><a class=lnlinks href=#hl-72-95>95</a>
</span><span class=lnt id=hl-72-96><a class=lnlinks href=#hl-72-96>96</a>
</span><span class=lnt id=hl-72-97><a class=lnlinks href=#hl-72-97>97</a>
</span><span class=lnt id=hl-72-98><a class=lnlinks href=#hl-72-98>98</a>
</span><span class=lnt id=hl-72-99><a class=lnlinks href=#hl-72-99>99</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 멀티 리전 RabbitMQ 클러스터 구성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Region 1: Primary (Seoul)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-region1-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>messaging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    # 클러스터 설정
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_name = production-kr
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_partition_handling = pause_minority
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 멀티 리전 최적화
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_keepalive_interval = 30000
</span></span></span><span class=line><span class=cl><span class=sd>    net_ticktime = 120
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 리전간 복제 설정  
</span></span></span><span class=line><span class=cl><span class=sd>    federation_upstream_set = us-west-1
</span></span></span><span class=line><span class=cl><span class=sd>    federation_upstream.us-west-1.uri = amqp://rabbitmq.us-west-1.company.com:5672
</span></span></span><span class=line><span class=cl><span class=sd>    federation_upstream.us-west-1.exchange = federated-events
</span></span></span><span class=line><span class=cl><span class=sd>    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Region 2: Disaster Recovery (US West)  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-region2-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>messaging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rabbitmq.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_name = production-us
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 재해 복구 모드
</span></span></span><span class=line><span class=cl><span class=sd>    cluster_partition_handling = pause_minority
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    # 한국 리전으로의 복제
</span></span></span><span class=line><span class=cl><span class=sd>    federation_upstream_set = kr-seoul-1  
</span></span></span><span class=line><span class=cl><span class=sd>    federation_upstream.kr-seoul-1.uri = amqp://rabbitmq.kr-seoul-1.company.com:5672
</span></span></span><span class=line><span class=cl><span class=sd>    federation_upstream.kr-seoul-1.exchange = federated-events
</span></span></span><span class=line><span class=cl><span class=sd>    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Global Load Balancer 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1alpha3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-global-gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>istio</span><span class=p>:</span><span class=w> </span><span class=l>ingressgateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>servers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>amqp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>rabbitmq.global.company.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1alpha3  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VirtualService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-global-routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>rabbitmq.global.company.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tcp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>region</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exact</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kr&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq.kr-seoul-1.company.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>region</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exact</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;us&#34;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq.us-west-1.company.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 기본 라우팅 (지연시간 기반)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq.kr-seoul-1.company.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>  </span><span class=c># 한국 사용자가 더 많은 경우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq.us-west-1.company.com  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>5672</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>2. 제로 다운타임 업그레이드</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-73-1><a class=lnlinks href=#hl-73-1>  1</a>
</span><span class=lnt id=hl-73-2><a class=lnlinks href=#hl-73-2>  2</a>
</span><span class=lnt id=hl-73-3><a class=lnlinks href=#hl-73-3>  3</a>
</span><span class=lnt id=hl-73-4><a class=lnlinks href=#hl-73-4>  4</a>
</span><span class=lnt id=hl-73-5><a class=lnlinks href=#hl-73-5>  5</a>
</span><span class=lnt id=hl-73-6><a class=lnlinks href=#hl-73-6>  6</a>
</span><span class=lnt id=hl-73-7><a class=lnlinks href=#hl-73-7>  7</a>
</span><span class=lnt id=hl-73-8><a class=lnlinks href=#hl-73-8>  8</a>
</span><span class=lnt id=hl-73-9><a class=lnlinks href=#hl-73-9>  9</a>
</span><span class=lnt id=hl-73-10><a class=lnlinks href=#hl-73-10> 10</a>
</span><span class=lnt id=hl-73-11><a class=lnlinks href=#hl-73-11> 11</a>
</span><span class=lnt id=hl-73-12><a class=lnlinks href=#hl-73-12> 12</a>
</span><span class=lnt id=hl-73-13><a class=lnlinks href=#hl-73-13> 13</a>
</span><span class=lnt id=hl-73-14><a class=lnlinks href=#hl-73-14> 14</a>
</span><span class=lnt id=hl-73-15><a class=lnlinks href=#hl-73-15> 15</a>
</span><span class=lnt id=hl-73-16><a class=lnlinks href=#hl-73-16> 16</a>
</span><span class=lnt id=hl-73-17><a class=lnlinks href=#hl-73-17> 17</a>
</span><span class=lnt id=hl-73-18><a class=lnlinks href=#hl-73-18> 18</a>
</span><span class=lnt id=hl-73-19><a class=lnlinks href=#hl-73-19> 19</a>
</span><span class=lnt id=hl-73-20><a class=lnlinks href=#hl-73-20> 20</a>
</span><span class=lnt id=hl-73-21><a class=lnlinks href=#hl-73-21> 21</a>
</span><span class=lnt id=hl-73-22><a class=lnlinks href=#hl-73-22> 22</a>
</span><span class=lnt id=hl-73-23><a class=lnlinks href=#hl-73-23> 23</a>
</span><span class=lnt id=hl-73-24><a class=lnlinks href=#hl-73-24> 24</a>
</span><span class=lnt id=hl-73-25><a class=lnlinks href=#hl-73-25> 25</a>
</span><span class=lnt id=hl-73-26><a class=lnlinks href=#hl-73-26> 26</a>
</span><span class=lnt id=hl-73-27><a class=lnlinks href=#hl-73-27> 27</a>
</span><span class=lnt id=hl-73-28><a class=lnlinks href=#hl-73-28> 28</a>
</span><span class=lnt id=hl-73-29><a class=lnlinks href=#hl-73-29> 29</a>
</span><span class=lnt id=hl-73-30><a class=lnlinks href=#hl-73-30> 30</a>
</span><span class=lnt id=hl-73-31><a class=lnlinks href=#hl-73-31> 31</a>
</span><span class=lnt id=hl-73-32><a class=lnlinks href=#hl-73-32> 32</a>
</span><span class=lnt id=hl-73-33><a class=lnlinks href=#hl-73-33> 33</a>
</span><span class=lnt id=hl-73-34><a class=lnlinks href=#hl-73-34> 34</a>
</span><span class=lnt id=hl-73-35><a class=lnlinks href=#hl-73-35> 35</a>
</span><span class=lnt id=hl-73-36><a class=lnlinks href=#hl-73-36> 36</a>
</span><span class=lnt id=hl-73-37><a class=lnlinks href=#hl-73-37> 37</a>
</span><span class=lnt id=hl-73-38><a class=lnlinks href=#hl-73-38> 38</a>
</span><span class=lnt id=hl-73-39><a class=lnlinks href=#hl-73-39> 39</a>
</span><span class=lnt id=hl-73-40><a class=lnlinks href=#hl-73-40> 40</a>
</span><span class=lnt id=hl-73-41><a class=lnlinks href=#hl-73-41> 41</a>
</span><span class=lnt id=hl-73-42><a class=lnlinks href=#hl-73-42> 42</a>
</span><span class=lnt id=hl-73-43><a class=lnlinks href=#hl-73-43> 43</a>
</span><span class=lnt id=hl-73-44><a class=lnlinks href=#hl-73-44> 44</a>
</span><span class=lnt id=hl-73-45><a class=lnlinks href=#hl-73-45> 45</a>
</span><span class=lnt id=hl-73-46><a class=lnlinks href=#hl-73-46> 46</a>
</span><span class=lnt id=hl-73-47><a class=lnlinks href=#hl-73-47> 47</a>
</span><span class=lnt id=hl-73-48><a class=lnlinks href=#hl-73-48> 48</a>
</span><span class=lnt id=hl-73-49><a class=lnlinks href=#hl-73-49> 49</a>
</span><span class=lnt id=hl-73-50><a class=lnlinks href=#hl-73-50> 50</a>
</span><span class=lnt id=hl-73-51><a class=lnlinks href=#hl-73-51> 51</a>
</span><span class=lnt id=hl-73-52><a class=lnlinks href=#hl-73-52> 52</a>
</span><span class=lnt id=hl-73-53><a class=lnlinks href=#hl-73-53> 53</a>
</span><span class=lnt id=hl-73-54><a class=lnlinks href=#hl-73-54> 54</a>
</span><span class=lnt id=hl-73-55><a class=lnlinks href=#hl-73-55> 55</a>
</span><span class=lnt id=hl-73-56><a class=lnlinks href=#hl-73-56> 56</a>
</span><span class=lnt id=hl-73-57><a class=lnlinks href=#hl-73-57> 57</a>
</span><span class=lnt id=hl-73-58><a class=lnlinks href=#hl-73-58> 58</a>
</span><span class=lnt id=hl-73-59><a class=lnlinks href=#hl-73-59> 59</a>
</span><span class=lnt id=hl-73-60><a class=lnlinks href=#hl-73-60> 60</a>
</span><span class=lnt id=hl-73-61><a class=lnlinks href=#hl-73-61> 61</a>
</span><span class=lnt id=hl-73-62><a class=lnlinks href=#hl-73-62> 62</a>
</span><span class=lnt id=hl-73-63><a class=lnlinks href=#hl-73-63> 63</a>
</span><span class=lnt id=hl-73-64><a class=lnlinks href=#hl-73-64> 64</a>
</span><span class=lnt id=hl-73-65><a class=lnlinks href=#hl-73-65> 65</a>
</span><span class=lnt id=hl-73-66><a class=lnlinks href=#hl-73-66> 66</a>
</span><span class=lnt id=hl-73-67><a class=lnlinks href=#hl-73-67> 67</a>
</span><span class=lnt id=hl-73-68><a class=lnlinks href=#hl-73-68> 68</a>
</span><span class=lnt id=hl-73-69><a class=lnlinks href=#hl-73-69> 69</a>
</span><span class=lnt id=hl-73-70><a class=lnlinks href=#hl-73-70> 70</a>
</span><span class=lnt id=hl-73-71><a class=lnlinks href=#hl-73-71> 71</a>
</span><span class=lnt id=hl-73-72><a class=lnlinks href=#hl-73-72> 72</a>
</span><span class=lnt id=hl-73-73><a class=lnlinks href=#hl-73-73> 73</a>
</span><span class=lnt id=hl-73-74><a class=lnlinks href=#hl-73-74> 74</a>
</span><span class=lnt id=hl-73-75><a class=lnlinks href=#hl-73-75> 75</a>
</span><span class=lnt id=hl-73-76><a class=lnlinks href=#hl-73-76> 76</a>
</span><span class=lnt id=hl-73-77><a class=lnlinks href=#hl-73-77> 77</a>
</span><span class=lnt id=hl-73-78><a class=lnlinks href=#hl-73-78> 78</a>
</span><span class=lnt id=hl-73-79><a class=lnlinks href=#hl-73-79> 79</a>
</span><span class=lnt id=hl-73-80><a class=lnlinks href=#hl-73-80> 80</a>
</span><span class=lnt id=hl-73-81><a class=lnlinks href=#hl-73-81> 81</a>
</span><span class=lnt id=hl-73-82><a class=lnlinks href=#hl-73-82> 82</a>
</span><span class=lnt id=hl-73-83><a class=lnlinks href=#hl-73-83> 83</a>
</span><span class=lnt id=hl-73-84><a class=lnlinks href=#hl-73-84> 84</a>
</span><span class=lnt id=hl-73-85><a class=lnlinks href=#hl-73-85> 85</a>
</span><span class=lnt id=hl-73-86><a class=lnlinks href=#hl-73-86> 86</a>
</span><span class=lnt id=hl-73-87><a class=lnlinks href=#hl-73-87> 87</a>
</span><span class=lnt id=hl-73-88><a class=lnlinks href=#hl-73-88> 88</a>
</span><span class=lnt id=hl-73-89><a class=lnlinks href=#hl-73-89> 89</a>
</span><span class=lnt id=hl-73-90><a class=lnlinks href=#hl-73-90> 90</a>
</span><span class=lnt id=hl-73-91><a class=lnlinks href=#hl-73-91> 91</a>
</span><span class=lnt id=hl-73-92><a class=lnlinks href=#hl-73-92> 92</a>
</span><span class=lnt id=hl-73-93><a class=lnlinks href=#hl-73-93> 93</a>
</span><span class=lnt id=hl-73-94><a class=lnlinks href=#hl-73-94> 94</a>
</span><span class=lnt id=hl-73-95><a class=lnlinks href=#hl-73-95> 95</a>
</span><span class=lnt id=hl-73-96><a class=lnlinks href=#hl-73-96> 96</a>
</span><span class=lnt id=hl-73-97><a class=lnlinks href=#hl-73-97> 97</a>
</span><span class=lnt id=hl-73-98><a class=lnlinks href=#hl-73-98> 98</a>
</span><span class=lnt id=hl-73-99><a class=lnlinks href=#hl-73-99> 99</a>
</span><span class=lnt id=hl-73-100><a class=lnlinks href=#hl-73-100>100</a>
</span><span class=lnt id=hl-73-101><a class=lnlinks href=#hl-73-101>101</a>
</span><span class=lnt id=hl-73-102><a class=lnlinks href=#hl-73-102>102</a>
</span><span class=lnt id=hl-73-103><a class=lnlinks href=#hl-73-103>103</a>
</span><span class=lnt id=hl-73-104><a class=lnlinks href=#hl-73-104>104</a>
</span><span class=lnt id=hl-73-105><a class=lnlinks href=#hl-73-105>105</a>
</span><span class=lnt id=hl-73-106><a class=lnlinks href=#hl-73-106>106</a>
</span><span class=lnt id=hl-73-107><a class=lnlinks href=#hl-73-107>107</a>
</span><span class=lnt id=hl-73-108><a class=lnlinks href=#hl-73-108>108</a>
</span><span class=lnt id=hl-73-109><a class=lnlinks href=#hl-73-109>109</a>
</span><span class=lnt id=hl-73-110><a class=lnlinks href=#hl-73-110>110</a>
</span><span class=lnt id=hl-73-111><a class=lnlinks href=#hl-73-111>111</a>
</span><span class=lnt id=hl-73-112><a class=lnlinks href=#hl-73-112>112</a>
</span><span class=lnt id=hl-73-113><a class=lnlinks href=#hl-73-113>113</a>
</span><span class=lnt id=hl-73-114><a class=lnlinks href=#hl-73-114>114</a>
</span><span class=lnt id=hl-73-115><a class=lnlinks href=#hl-73-115>115</a>
</span><span class=lnt id=hl-73-116><a class=lnlinks href=#hl-73-116>116</a>
</span><span class=lnt id=hl-73-117><a class=lnlinks href=#hl-73-117>117</a>
</span><span class=lnt id=hl-73-118><a class=lnlinks href=#hl-73-118>118</a>
</span><span class=lnt id=hl-73-119><a class=lnlinks href=#hl-73-119>119</a>
</span><span class=lnt id=hl-73-120><a class=lnlinks href=#hl-73-120>120</a>
</span><span class=lnt id=hl-73-121><a class=lnlinks href=#hl-73-121>121</a>
</span><span class=lnt id=hl-73-122><a class=lnlinks href=#hl-73-122>122</a>
</span><span class=lnt id=hl-73-123><a class=lnlinks href=#hl-73-123>123</a>
</span><span class=lnt id=hl-73-124><a class=lnlinks href=#hl-73-124>124</a>
</span><span class=lnt id=hl-73-125><a class=lnlinks href=#hl-73-125>125</a>
</span><span class=lnt id=hl-73-126><a class=lnlinks href=#hl-73-126>126</a>
</span><span class=lnt id=hl-73-127><a class=lnlinks href=#hl-73-127>127</a>
</span><span class=lnt id=hl-73-128><a class=lnlinks href=#hl-73-128>128</a>
</span><span class=lnt id=hl-73-129><a class=lnlinks href=#hl-73-129>129</a>
</span><span class=lnt id=hl-73-130><a class=lnlinks href=#hl-73-130>130</a>
</span><span class=lnt id=hl-73-131><a class=lnlinks href=#hl-73-131>131</a>
</span><span class=lnt id=hl-73-132><a class=lnlinks href=#hl-73-132>132</a>
</span><span class=lnt id=hl-73-133><a class=lnlinks href=#hl-73-133>133</a>
</span><span class=lnt id=hl-73-134><a class=lnlinks href=#hl-73-134>134</a>
</span><span class=lnt id=hl-73-135><a class=lnlinks href=#hl-73-135>135</a>
</span><span class=lnt id=hl-73-136><a class=lnlinks href=#hl-73-136>136</a>
</span><span class=lnt id=hl-73-137><a class=lnlinks href=#hl-73-137>137</a>
</span><span class=lnt id=hl-73-138><a class=lnlinks href=#hl-73-138>138</a>
</span><span class=lnt id=hl-73-139><a class=lnlinks href=#hl-73-139>139</a>
</span><span class=lnt id=hl-73-140><a class=lnlinks href=#hl-73-140>140</a>
</span><span class=lnt id=hl-73-141><a class=lnlinks href=#hl-73-141>141</a>
</span><span class=lnt id=hl-73-142><a class=lnlinks href=#hl-73-142>142</a>
</span><span class=lnt id=hl-73-143><a class=lnlinks href=#hl-73-143>143</a>
</span><span class=lnt id=hl-73-144><a class=lnlinks href=#hl-73-144>144</a>
</span><span class=lnt id=hl-73-145><a class=lnlinks href=#hl-73-145>145</a>
</span><span class=lnt id=hl-73-146><a class=lnlinks href=#hl-73-146>146</a>
</span><span class=lnt id=hl-73-147><a class=lnlinks href=#hl-73-147>147</a>
</span><span class=lnt id=hl-73-148><a class=lnlinks href=#hl-73-148>148</a>
</span><span class=lnt id=hl-73-149><a class=lnlinks href=#hl-73-149>149</a>
</span><span class=lnt id=hl-73-150><a class=lnlinks href=#hl-73-150>150</a>
</span><span class=lnt id=hl-73-151><a class=lnlinks href=#hl-73-151>151</a>
</span><span class=lnt id=hl-73-152><a class=lnlinks href=#hl-73-152>152</a>
</span><span class=lnt id=hl-73-153><a class=lnlinks href=#hl-73-153>153</a>
</span><span class=lnt id=hl-73-154><a class=lnlinks href=#hl-73-154>154</a>
</span><span class=lnt id=hl-73-155><a class=lnlinks href=#hl-73-155>155</a>
</span><span class=lnt id=hl-73-156><a class=lnlinks href=#hl-73-156>156</a>
</span><span class=lnt id=hl-73-157><a class=lnlinks href=#hl-73-157>157</a>
</span><span class=lnt id=hl-73-158><a class=lnlinks href=#hl-73-158>158</a>
</span><span class=lnt id=hl-73-159><a class=lnlinks href=#hl-73-159>159</a>
</span><span class=lnt id=hl-73-160><a class=lnlinks href=#hl-73-160>160</a>
</span><span class=lnt id=hl-73-161><a class=lnlinks href=#hl-73-161>161</a>
</span><span class=lnt id=hl-73-162><a class=lnlinks href=#hl-73-162>162</a>
</span><span class=lnt id=hl-73-163><a class=lnlinks href=#hl-73-163>163</a>
</span><span class=lnt id=hl-73-164><a class=lnlinks href=#hl-73-164>164</a>
</span><span class=lnt id=hl-73-165><a class=lnlinks href=#hl-73-165>165</a>
</span><span class=lnt id=hl-73-166><a class=lnlinks href=#hl-73-166>166</a>
</span><span class=lnt id=hl-73-167><a class=lnlinks href=#hl-73-167>167</a>
</span><span class=lnt id=hl-73-168><a class=lnlinks href=#hl-73-168>168</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 무중단 클러스터 업그레이드 자동화</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ZeroDowntimeUpgrader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    RabbitMQ 클러스터 무중단 업그레이드
</span></span></span><span class=line><span class=cl><span class=s2>    - 롤링 업그레이드 전략
</span></span></span><span class=line><span class=cl><span class=s2>    - 자동 헬스체크 및 롤백
</span></span></span><span class=line><span class=cl><span class=s2>    - 메시지 손실 방지
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cluster_nodes</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cluster_nodes</span> <span class=o>=</span> <span class=n>cluster_nodes</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upgrade_order</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_upgrade_order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_upgrade_order</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;업그레이드 순서 계산 (리더 노드 마지막)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 클러스터 상태 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>cluster_status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_cluster_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 리더 노드 식별</span>
</span></span><span class=line><span class=cl>        <span class=n>leader_node</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_identify_leader_node</span><span class=p>(</span><span class=n>cluster_status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 팔로워 노드부터 업그레이드</span>
</span></span><span class=line><span class=cl>        <span class=n>followers</span> <span class=o>=</span> <span class=p>[</span><span class=n>node</span> <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cluster_nodes</span> <span class=k>if</span> <span class=n>node</span> <span class=o>!=</span> <span class=n>leader_node</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>followers</span> <span class=o>+</span> <span class=p>[</span><span class=n>leader_node</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>perform_rolling_upgrade</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target_version</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;롤링 업그레이드 실행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;🚀 Starting rolling upgrade to RabbitMQ </span><span class=si>{</span><span class=n>target_version</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 1. 사전 검증</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_pre_upgrade_validation</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 2. 업그레이드 전 백업</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_pre_upgrade_backup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 3. 노드별 순차 업그레이드</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>node</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>upgrade_order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;📦 Upgrading node </span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>upgrade_order</span><span class=p>)</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_upgrade_single_node</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>target_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_verify_node_health</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;✅ Node </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2> upgraded successfully&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;❌ Upgrade failed for node </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_rollback_upgrade</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 4. 업그레이드 후 검증</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_post_upgrade_validation</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;🎉 Rolling upgrade to </span><span class=si>{</span><span class=n>target_version</span><span class=si>}</span><span class=s2> completed successfully&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_upgrade_single_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target_version</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;단일 노드 업그레이드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 1. 트래픽 드레인 (새로운 연결 차단)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_drain_node_traffic</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 2. 기존 연결 완료 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wait_for_connections_drain</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 3. 노드 정지</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_stop_node_gracefully</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 4. 바이너리 업그레이드</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_node_binary</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>target_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 5. 노드 재시작</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_start_node</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 6. 클러스터 재조인 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wait_for_cluster_rejoin</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 7. 트래픽 복원</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_restore_node_traffic</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_drain_node_traffic</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;노드 트래픽 드레인&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Kubernetes 환경에서 노드를 서비스에서 제거</span>
</span></span><span class=line><span class=cl>        <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;kubectl&#34;</span><span class=p>,</span> <span class=s2>&#34;patch&#34;</span><span class=p>,</span> <span class=s2>&#34;endpoints&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;--type=json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;-p=[</span><span class=se>{{\&#34;</span><span class=s2>op</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>remove</span><span class=se>\&#34;</span><span class=s2>, </span><span class=se>\&#34;</span><span class=s2>path</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>/subsets/0/addresses</span><span class=se>\&#34;</span><span class=s2>, </span><span class=se>\&#34;</span><span class=s2>value</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>{{\&#34;</span><span class=s2>ip</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=se>\&#34;}}}}</span><span class=s2>]&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 로드밸런서에서 노드 제거 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_wait_for_connections_drain</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;기존 연결 완료 대기&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>max_wait_time</span> <span class=o>=</span> <span class=mi>300</span>  <span class=c1># 5분 최대 대기</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span> <span class=o>&lt;</span> <span class=n>max_wait_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 노드의 활성 연결 수 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>connection_count</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_node_connection_count</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>connection_count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;✅ All connections drained from </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;⏳ Waiting for </span><span class=si>{</span><span class=n>connection_count</span><span class=si>}</span><span class=s2> connections to drain from </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;⚠️ Timeout waiting for connections to drain, proceeding with </span><span class=si>{</span><span class=n>connection_count</span><span class=si>}</span><span class=s2> active connections&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_verify_node_health</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;노드 헬스체크&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>health_checks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_check_node_status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_check_cluster_membership</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_check_queue_availability</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_check_message_flow</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>check</span> <span class=ow>in</span> <span class=n>health_checks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=k>await</span> <span class=n>check</span><span class=p>(</span><span class=n>node</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Health check failed for </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_check_message_flow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 흐름 검증&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>test_message</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;test&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 테스트 메시지 발송</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_send_test_message</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>test_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 수신 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>received</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_receive_test_message</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>received</span> <span class=o>==</span> <span class=n>test_message</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Message flow test failed for </span><span class=si>{</span><span class=n>node</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_rollback_upgrade</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>failed_node</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;업그레이드 롤백&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;🔄 Rolling back upgrade for </span><span class=si>{</span><span class=n>failed_node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이전 버전으로 복원</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_restore_previous_version</span><span class=p>(</span><span class=n>failed_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 백업에서 데이터 복원</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_restore_from_backup</span><span class=p>(</span><span class=n>failed_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 클러스터 재조인</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_rejoin_cluster</span><span class=p>(</span><span class=n>failed_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>upgrader</span> <span class=o>=</span> <span class=n>ZeroDowntimeUpgrader</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rabbitmq-node1.cluster.local&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rabbitmq-node2.cluster.local&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rabbitmq-node3.cluster.local&#34;</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 무중단 업그레이드 실행</span>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>upgrader</span><span class=o>.</span><span class=n>perform_rolling_upgrade</span><span class=p>(</span><span class=s2>&#34;4.0.9&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=8단계-최종-정리-및-학습-가이드>8단계: 최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#8단계-최종-정리-및-학습-가이드>#</a></h2><h3 id=내용-종합>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p>RabbitMQ는 <strong>신뢰성 중심의 메시지 브로커</strong>로서, AMQP 프로토콜 기반의 유연한 라우팅과 강력한 메시지 전달 보장 메커니즘을 제공합니다. <strong>2024년 출시된 4.0 버전</strong>에서는 AMQP 1.0 네이티브 지원과 Khepri 메타데이터 저장소를 통해 성능과 안정성이 크게 향상되었습니다.</p><p><strong>핵심 차별화 요소</strong>:</p><ul><li><strong>Exchange-Queue-Binding 구조</strong>를 통한 동적 라우팅</li><li><strong>Publisher Confirms + Consumer ACK</strong>를 통한 완벽한 메시지 추적</li><li><strong>Erlang 기반 고가용성</strong> 및 장애 자동 복구</li><li><strong>다중 프로토콜 지원</strong> (AMQP, MQTT, STOMP, WebSocket)</li></ul><p><strong>최신 트렌드 반영</strong>:</p><ul><li><strong>서버리스 메시징</strong> (Knative 통합)</li><li><strong>AI/ML 기반 지능형 라우팅</strong></li><li><strong>멀티 클라우드 환경</strong> 표준화 (CloudEvents)</li><li><strong>WebAssembly 플러그인</strong> (고성능 메시지 처리)</li></ul><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><p><strong>1단계: 기초 학습 (1-2주)</strong></p><ul><li>AMQP 프로토콜 이해</li><li>Exchange 타입별 특성 학습</li><li>기본 Producer/Consumer 구현</li></ul><p><strong>2단계: 실무 적용 (2-3주)</strong></p><ul><li>Docker/Kubernetes 환경 구축</li><li>모니터링 및 로깅 설정</li><li>보안 설정 (TLS, 인증)</li></ul><p><strong>3단계: 고급 운영 (3-4주)</strong></p><ul><li>클러스터링 및 고가용성</li><li>성능 최적화 및 튜닝</li><li>장애 대응 및 복구</li></ul><p><strong>4단계: 아키텍처 설계 (4-6주)</strong></p><ul><li>마이크로서비스 메시징 설계</li><li>분산 트랜잭션 (Saga) 패턴</li><li>하이브리드 메시징 아키텍처</li></ul><h3 id=실무-적용-가이드-1>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드-1>#</a></h3><p><strong>개발 환경 구축</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-74-1><a class=lnlinks href=#hl-74-1>1</a>
</span><span class=lnt id=hl-74-2><a class=lnlinks href=#hl-74-2>2</a>
</span><span class=lnt id=hl-74-3><a class=lnlinks href=#hl-74-3>3</a>
</span><span class=lnt id=hl-74-4><a class=lnlinks href=#hl-74-4>4</a>
</span><span class=lnt id=hl-74-5><a class=lnlinks href=#hl-74-5>5</a>
</span><span class=lnt id=hl-74-6><a class=lnlinks href=#hl-74-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Docker Compose로 개발 환경 시작</span>
</span></span><span class=line><span class=cl>docker-compose up -d rabbitmq
</span></span><span class=line><span class=cl><span class=c1># 관리 UI: http://localhost:15672 (admin/admin)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kubernetes 환경 배포</span>
</span></span><span class=line><span class=cl>helm install rabbitmq bitnami/rabbitmq
</span></span></code></pre></td></tr></table></div></div><p><strong>모니터링 필수 설정</strong>:</p><ul><li>Prometheus + Grafana 대시보드</li><li>Queue depth, Memory usage 알람</li><li>Connection count, Message rate 추적</li></ul><p><strong>보안 체크리스트</strong>:</p><ul><li><input disabled type=checkbox> guest 계정 비활성화</li><li><input disabled type=checkbox> TLS 1.3 강제 사용</li><li><input disabled type=checkbox> LDAP/OAuth 통합 인증</li><li><input disabled type=checkbox> 네트워크 분할 및 방화벽 설정</li></ul><h3 id=학습-항목-매트릭스-1>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스-1>#</a></h3><blockquote><p>이 표는 체계적인 학습을 위해 단계별 학습 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초</strong></td><td>1</td><td>AMQP 프로토콜 이해</td><td>필수</td><td>메시징 기본 원리 파악</td><td>높음</td><td>모든 RabbitMQ 기능의 기반</td></tr><tr><td><strong>기초</strong></td><td>1</td><td>Exchange 타입 학습</td><td>필수</td><td>라우팅 패턴 이해</td><td>높음</td><td>메시지 흐름 설계 필수</td></tr><tr><td><strong>핵심</strong></td><td>2</td><td>Producer/Consumer 구현</td><td>필수</td><td>기본 메시징 구현</td><td>높음</td><td>실제 애플리케이션 개발</td></tr><tr><td><strong>핵심</strong></td><td>2</td><td>메시지 지속성 및 ACK</td><td>필수</td><td>신뢰성 보장 방법</td><td>높음</td><td>데이터 손실 방지</td></tr><tr><td><strong>응용</strong></td><td>3</td><td>클러스터링 구성</td><td>권장</td><td>고가용성 구현</td><td>중간</td><td>프로덕션 환경 필수</td></tr><tr><td><strong>응용</strong></td><td>5</td><td>Docker/K8s 배포</td><td>권장</td><td>컨테이너 환경 운영</td><td>높음</td><td>현대적 배포 방식</td></tr><tr><td><strong>응용</strong></td><td>5</td><td>모니터링 설정</td><td>권장</td><td>운영 상태 감시</td><td>높음</td><td>장애 예방 및 대응</td></tr><tr><td><strong>고급</strong></td><td>6</td><td>보안 설정 (TLS/LDAP)</td><td>권장</td><td>기업 환경 보안</td><td>중간</td><td>규정 준수 요구사항</td></tr><tr><td><strong>고급</strong></td><td>6</td><td>성능 최적화</td><td>선택</td><td>대용량 처리 최적화</td><td>중간</td><td>스케일링 시 필요</td></tr><tr><td><strong>고급</strong></td><td>7</td><td>Saga 패턴 구현</td><td>선택</td><td>분산 트랜잭션 처리</td><td>낮음</td><td>복잡한 워크플로우</td></tr><tr><td><strong>고급</strong></td><td>7</td><td>하이브리드 메시징</td><td>선택</td><td>다중 브로커 연동</td><td>낮음</td><td>대규모 엔터프라이즈</td></tr></tbody></table><hr><h3 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h3><blockquote><p>이 표는 RabbitMQ의 핵심 용어와 실무 활용도를 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td><strong>핵심</strong></td><td>AMQP (Advanced Message Queuing Protocol)</td><td>메시지 큐잉을 위한 표준 프로토콜</td><td>Exchange, Queue, Binding</td><td>모든 RabbitMQ 통신의 기반</td></tr><tr><td><strong>핵심</strong></td><td>Exchange (익스체인지)</td><td>메시지 라우팅 규칙을 정의하는 구성 요소</td><td>Routing Key, Binding</td><td>메시지 흐름 설계</td></tr><tr><td><strong>핵심</strong></td><td>Queue (큐)</td><td>메시지를 저장하고 컨슈머에게 전달하는 버퍼</td><td>Durable, TTL, DLQ</td><td>메시지 버퍼링 및 순서 보장</td></tr><tr><td><strong>핵심</strong></td><td>Binding (바인딩)</td><td>Exchange와 Queue를 연결하는 규칙</td><td>Routing Key, Arguments</td><td>라우팅 로직 구현</td></tr><tr><td><strong>구현</strong></td><td>Publisher Confirms (발행자 확인)</td><td>메시지 발행 성공을 보장하는 메커니즘</td><td>ACK, NACK</td><td>메시지 손실 방지</td></tr><tr><td><strong>구현</strong></td><td>Consumer Acknowledgment (소비자 확인)</td><td>메시지 처리 완료를 알리는 메커니즘</td><td>Manual ACK, Auto ACK</td><td>처리 보장 및 재시도</td></tr><tr><td><strong>구현</strong></td><td>Virtual Host (가상 호스트)</td><td>논리적 네임스페이스 분리</td><td>Multi-tenancy</td><td>환경 분리 및 권한 관리</td></tr><tr><td><strong>운영</strong></td><td>Cluster (클러스터)</td><td>고가용성을 위한 노드 그룹</td><td>Quorum Queue, Split-brain</td><td>무중단 서비스 운영</td></tr><tr><td><strong>운영</strong></td><td>Lazy Queue (지연 큐)</td><td>메모리 대신 디스크를 우선 사용하는 큐</td><td>Memory Management</td><td>대용량 메시지 처리</td></tr><tr><td><strong>운영</strong></td><td>Dead Letter Queue (DLQ)</td><td>처리 실패 메시지를 모으는 큐</td><td>Error Handling, Retry</td><td>장애 메시지 분석 및 복구</td></tr><tr><td><strong>고급</strong></td><td>Quorum Queue (쿼럼 큐)</td><td>Raft 알고리즘 기반 분산 큐</td><td>Consistency, Availability</td><td>강한 일관성이 필요한 경우</td></tr><tr><td><strong>고급</strong></td><td>Federation (연합)</td><td>클러스터 간 메시지 복제</td><td>Cross-datacenter</td><td>재해 복구 및 지역 분산</td></tr><tr><td><strong>고급</strong></td><td>Shovel (셔블)</td><td>메시지 전송 플러그인</td><td>Message Bridge</td><td>브로커 간 데이터 이동</td></tr></tbody></table><h3 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h3><p><strong>공식 문서</strong></p><ul><li><a href=https://www.rabbitmq.com/docs>RabbitMQ Official Documentation</a> - 가장 권위있는 공식 문서</li><li><a href=https://www.amqp.org/specification/0-9-1/amqp-org-download>AMQP 0.9.1 Specification</a> - AMQP 프로토콜 표준</li><li><a href=https://github.com/rabbitmq/rabbitmq-server/releases>RabbitMQ 4.0 Release Notes</a> - 최신 버전 정보</li></ul><p><strong>기술 블로그 및 사례</strong></p><ul><li><a href=https://www.cloudamqp.com/blog/>CloudAMQP Blog</a> - RabbitMQ 실무 가이드 및 사례</li><li><a href=https://www.rabbitmq.com/blog/>RabbitMQ Blog</a> - 공식 기술 블로그</li><li><a href=https://www.vmware.com/products/app-platform/tanzu-rabbitmq>VMware Tanzu RabbitMQ</a> - 기업용 솔루션</li></ul><p><strong>성능 및 벤치마크</strong></p><ul><li><a href=https://www.confluent.io/blog/kafka-fastest-messaging-system/>RabbitMQ vs Kafka Performance</a> - 메시지 브로커 성능 비교</li><li><a href=https://www.cloudamqp.com/blog/rabbitmq-benchmarks.html>RabbitMQ Performance Benchmarks</a> - 처리량 및 지연시간 분석</li></ul><p><strong>실무 가이드</strong></p><ul><li><a href=https://www.cloudamqp.com/blog/part2-rabbitmq-best-practice-for-high-performance.html>RabbitMQ Best Practices</a> - 고성능 설정 가이드</li><li><a href=https://securedebug.com/rabbitmq-security-guide-and-best-practices-v1/>RabbitMQ Security Guide</a> - 보안 설정 상세 가이드</li></ul><p><strong>커뮤니티 및 지원</strong></p><ul><li><a href=https://groups.google.com/forum/#!forum/rabbitmq-users>RabbitMQ Community Forum</a> - 커뮤니티 지원</li><li><a href=https://stackoverflow.com/questions/tagged/rabbitmq>Stack Overflow RabbitMQ</a> - 기술 질의응답</li><li><a href=https://github.com/rabbitmq>GitHub RabbitMQ</a> - 소스코드 및 이슈 트래킹</li></ul><hr><p><strong>최종 권장사항</strong>: RabbitMQ는 신뢰성이 중요한 시스템에서 탁월한 선택이지만, 높은 처리량이 필요한 경우 Apache Kafka와의 하이브리드 구성을 고려하세요. 특히 마이크로서비스 아키텍처에서는 RabbitMQ의 유연한 라우팅 기능이 큰 장점이 됩니다. 실무 도입 시 반드시 모니터링 체계를 먼저 구축하고, 단계적으로 확장해 나가는 것을 권장합니다.</p><hr><h2 id=1단계-기본-분석-및-검증-2><strong>1단계: 기본 분석 및 검증</strong><a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-2>#</a></h2><h3 id=1-대표-태그-생성-1>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성-1>#</a></h3><ul><li><strong>Message-Broker</strong></li><li><strong>AMQP</strong></li><li><strong>Event-Driven-Architecture</strong></li><li><strong>Asynchronous-Messaging</strong></li></ul><hr><h3 id=2-분류-체계-검증>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증>#</a></h3><p>현재 분류 구조의 <code>"Tool Reference > Communication Technologies > Message Brokers"</code>에 RabbitMQ를 포함하는 것은 적절합니다.
RabbitMQ는 <strong>AMQP (Advanced Message Queuing Protocol)</strong> 기반의 메시지 브로커로, 통신 계층보다는 <strong>응용 서비스 레벨에서 메시지 라우팅 및 큐잉을 담당</strong>하는 미들웨어이므로 <strong>Networking and Communication</strong>보다는 <strong>Tool Reference</strong>에 포함시키는 편이 실무 분류에서 더 명확합니다.
단, <strong>대규모 분산 환경 설계(System Design)</strong> 학습 과정에서도 반드시 다루는 주제이므로, <strong>System Design > Distributed Systems</strong>의 참조 링크를 추가하는 것도 권장합니다.</p><hr><h3 id=3-핵심-요약-250자-이내-1>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내-1>#</a></h3><p>RabbitMQ는 AMQP 프로토콜 기반의 오픈소스 메시지 브로커로, 분산 시스템 간 비동기 통신을 지원하며 안정적 메시지 전송, 라우팅, 큐잉 기능을 제공한다. 마이크로서비스, 이벤트 기반 아키텍처에서 핵심 메시징 허브 역할을 한다.</p><hr><h3 id=4-전체-개요-400자-이내>4. 전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-400자-이내>#</a></h3><p>RabbitMQ는 Erlang/OTP로 개발된 오픈소스 메시지 브로커로, AMQP, MQTT, STOMP 등 다양한 메시징 프로토콜을 지원한다. 프로듀서(Producer)와 컨슈머(Consumer) 간 메시지를 비동기적으로 전달하며, 라우팅, 토픽, 워크큐, 퍼블리시/서브스크라이브 등 다양한 메시징 패턴을 구현할 수 있다. 고가용성, 페더레이션, 클러스터링을 통해 확장성과 안정성을 보장하며, 금융, IoT, e-commerce 등 다양한 산업에서 사용된다.</p><hr><p>아래 내용은 <strong>소프트웨어 아키텍처 및 시스템 설계 전문가/풀스택 기술 리더</strong> 관점에서, RabbitMQ를 <strong>기술 중립적이고 실무 중심</strong>으로 단계적으로 정리한 조사지입니다. 최신 릴리스(4.1 계열), 스트림(Streams), 쿼럼 큐(Quorum Queues), Khepri 메타데이터 스토어, Kubernetes 피어 디스커버리 변경 등 <strong>2025년 현재 기준 최신 동향</strong>을 반영했습니다. 주요 사실은 공식 문서를 근거로 표기했습니다.</p><hr><h1 id=2단계-개념-체계화-및-검증-2>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증-2>#</a></h1><h2 id=5-핵심-개념-정리-이론실무기본심화>5. 핵심 개념 정리 (이론/실무/기본/심화)<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리-이론실무기본심화>#</a></h2><ul><li><p><strong>프로토콜(Protocols)</strong>: AMQP 0‑9‑1(핵심), AMQP 1.0(병행 지원), MQTT v5, STOMP 등. 다중 프로토콜로 다양한 클라이언트/사용례를 수용. (<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">rabbitmq.com</a>)</p></li><li><p><strong>교환기(Exchange)와 라우팅</strong>: direct/fanout/topic/headers + 확장(일관 해시 Consistent‑Hash, Sharding). 메시지는 교환기로 발행되고, 바인딩 규칙으로 큐/스트림으로 라우팅. (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>rabbitmq.com</a>, <a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">GitHub</a>)</p></li><li><p><strong>큐 유형</strong>:</p><ul><li><strong>Classic Queue</strong>: 비복제 기본 큐(4.0부터 미러링 제거). Lazy 모드로 메모리 절약 가능. (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">rabbitmq.com</a>)</li><li><strong>Quorum Queue</strong>: Raft 기반 복제/내고장성, 미러드 클래식 대체. 4.0부터 미러링 삭제로 사실상 표준 복제 큐. (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</li><li><strong>Stream</strong>: Append‑only 로그(비파괴 소비), 파티셔닝(Superstream), 서버측 필터링(4.0/4.1 강화). (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">rabbitmq.com</a>, <a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>)</li></ul></li><li><p><strong>신뢰성 메커니즘</strong>: 퍼블리셔 컨펌(Publisher Confirms), 컨슈머 Ack/Nack, DLX(사망편지 교환기), Delivery‑limit, 재시도. (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>)</p></li><li><p><strong>플러그인/관리/모니터링</strong>: Management UI/API, Prometheus 내장 플러그인, 정책/권한, Shovel/Federation. (<a href="https://www.rabbitmq.com/docs/management?utm_source=chatgpt.com" title="Management Plugin">rabbitmq.com</a>)</p></li><li><p><strong>보안</strong>: TLS/mTLS(클라이언트/노드 간), 클러스터 내부 통신 암호화 가이드. (<a href="https://www.rabbitmq.com/docs/ssl?utm_source=chatgpt.com" title="TLS Support">rabbitmq.com</a>)</p></li><li><p><strong>클러스터링/피어 디스커버리</strong>: 4.1에서 K8s 플러그인 설계 재구성(시드 노드 방식), 다양한 디스커버리 백엔드. (<a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">rabbitmq.com</a>)</p></li><li><p><strong>메타데이터 스토어</strong>: <strong>Mnesia</strong>(기존) vs <strong>Khepri</strong>(Raft 기반, 4.0부터 본격 지원, 4.1은 기본은 Mnesia이며 플래그로 활성화). (<a href="https://www.rabbitmq.com/docs/metadata-store?utm_source=chatgpt.com" title="Metadata store">rabbitmq.com</a>)</p></li></ul><p><strong>검증 포인트</strong>: 위 개념 중 버전/변경 가능성이 큰 항목(4.0/4.1 기능, Khepri, K8s 디스커버리, 스트림 필터링)은 최신 릴리스 노트/문서를 근거로 확인했습니다. (<a href="https://www.rabbitmq.com/docs/download?utm_source=chatgpt.com" title="Installing RabbitMQ">rabbitmq.com</a>, <a href="https://blog.rabbitmq.com/docs/4.0/whats-new?utm_source=chatgpt.com" title="What's New in RabbitMQ 4.0">blog.rabbitmq.com</a>)</p><h2 id=6-실무-연관성-분석-1>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석-1>#</a></h2><ul><li>대규모 트래픽/엄격한 내구성: <strong>Quorum Queue</strong> 또는 <strong>Stream</strong>으로 기본 설계, 퍼블리셔 컨펌/배치 Confirm 필수. (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</li><li>순서 보장/단일 소비: <strong>Single‑Active‑Consumer</strong>(SAC) 또는 Stream + SAC. (<a href="https://www.rabbitmq.com/docs/consumers?utm_source=chatgpt.com" title=Consumers>rabbitmq.com</a>)</li><li>대용량 이벤트 로그/재처리: <strong>Stream + 파티셔닝(Superstream) + 서버측 필터링</strong>. (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>)</li><li>모니터링/알림: <strong>rabbitmq_prometheus</strong> + Grafana 대시보드, 관리 UI는 보조. (<a href="https://www.rabbitmq.com/docs/prometheus?utm_source=chatgpt.com" title="Monitoring with Prometheus and Grafana">rabbitmq.com</a>)</li><li>K8s 운영: <strong>4.1 K8s 피어 디스커버리</strong> 개선으로 클러스터 분할 위험 감소, 오퍼레이터 사용 권장. (<a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">rabbitmq.com</a>)</li></ul><hr><h1 id=3단계-단계별-상세-조사-및-검증>3단계: 단계별 상세 조사 및 검증<a hidden class=anchor aria-hidden=true href=#3단계-단계별-상세-조사-및-검증>#</a></h1><h2 id=phase-1-기초-개념>Phase 1: 기초 개념<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념>#</a></h2><h3 id=11-개념-정의-및-본질>1.1 개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질>#</a></h3><p>RabbitMQ는 **메시지 브로커(Message Broker)**로서 교환기/큐/스트림을 통해 <strong>비동기 메시징</strong>과 <strong>라우팅</strong>을 제공한다. AMQP 0‑9‑1을 중심으로 다중 프로토콜을 지원한다. (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>rabbitmq.com</a>)</p><h3 id=12-등장-배경-및-발전>1.2 등장 배경 및 발전<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전>#</a></h3><p>2007년 공개 후, 고가용성 요구에 따라 <strong>미러드 클래식 큐 →(대체) Quorum Queue</strong>, 로그형 워크로드에 <strong>Streams</strong> 추가, 4.x에서 <strong>Khepri</strong>/필터링/피어 디스커버리 개선 등으로 진화. (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</p><h3 id=13-핵심-목적-및-필요성-1>1.3 핵심 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-1>#</a></h3><ul><li>마이크로서비스 간 <strong>결합도 감소</strong>와 <strong>버퍼링</strong>, <strong>스파イク 흡수</strong>, <strong>신뢰성 있는 비동기 처리</strong>.</li><li><strong>재처리/리플레이/순서 보장</strong>과 <strong>확장성</strong> 제공(Streams/Quorum). (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</li></ul><h3 id=14-주요-특징-및-차별점>1.4 주요 특징 및 차별점<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점>#</a></h3><ul><li>다양한 라우팅/패턴(워크큐, pub/sub, RPC), 프로토콜 다변성, <strong>운영 도구 성숙도(Management/Prometheus)</strong>, <strong>K8s 네이티브 운영성</strong>. (<a href="https://www.rabbitmq.com/docs/management?utm_source=chatgpt.com" title="Management Plugin">rabbitmq.com</a>)</li></ul><p><strong>검증 포인트</strong>: 미러드 클래식 큐의 제거(4.0), Quorum/Streams 권고는 공식 문서 및 블로그로 확인. (<a href="https://www.rabbitmq.com/docs/3.13/ha?utm_source=chatgpt.com" title="Classic Queue Mirroring (Deprecated) - RabbitMQ">rabbitmq.com</a>)</p><hr><h2 id=phase-2-핵심-원리>Phase 2: 핵심 원리<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리>#</a></h2><h3 id=21-설계-원칙철학>2.1 설계 원칙/철학<a hidden class=anchor aria-hidden=true href=#21-설계-원칙철학>#</a></h3><ul><li><strong>안정성 우선</strong>: Ack/Confirm, 내구성, Raft 기반 복제(Quorum/Streams). (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</li><li><strong>유연한 라우팅</strong>: Exchange 타입/플러그인으로 다양한 토폴로지. (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>rabbitmq.com</a>)</li><li><strong>운영 가시성</strong>: 관리 API/Prometheus 노출. (<a href="https://www.rabbitmq.com/docs/prometheus?utm_source=chatgpt.com" title="Monitoring with Prometheus and Grafana">rabbitmq.com</a>)</li></ul><h3 id=22-동작-메커니즘-다이어그램>2.2 동작 메커니즘 (다이어그램)<a hidden class=anchor aria-hidden=true href=#22-동작-메커니즘-다이어그램>#</a></h3><pre class=mermaid>sequenceDiagram
  autonumber
  participant P as Producer
  participant EX as Exchange
  participant Q as Queue/Stream
  participant C as Consumer
  P-&gt;&gt;EX: Publish(routingKey, message)
  EX-&gt;&gt;Q: Route via bindings
  Note over Q: Durable storage (QQ/Stream)&lt;br/&gt;Ordering (SAC/Stream)
  Q--&gt;&gt;C: Deliver (prefetch, in-order)
  C--&gt;&gt;Q: ack/nack (requeue=false → DLX)
  Q--&gt;&gt;P: confirm (publisher confirm)
</pre><ul><li>퍼블리셔 컨펌은 비동기/배치 확인을 지원. (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>)</li><li>DLX는 TTL/길이 제한/NAck 등 이벤트 시 재게시. (<a href="https://www.rabbitmq.com/docs/dlx?utm_source=chatgpt.com" title="Dead Letter Exchanges">rabbitmq.com</a>)</li></ul><h3 id=23-아키텍처-및-구성요소>2.3 아키텍처 및 구성요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성요소>#</a></h3><ul><li><strong>브로커 노드/클러스터</strong>, <strong>메타데이터 스토어(Mnesia/Khepri)</strong>, <strong>Exchange/Queue/Stream</strong>, <strong>Virtual Host</strong>, <strong>Policy/Runtime params</strong>, <strong>Plugin 체계</strong>. (<a href="https://www.rabbitmq.com/docs/metadata-store?utm_source=chatgpt.com" title="Metadata store">rabbitmq.com</a>)</li></ul><h3 id=24-주요-기능과-역할-2>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할-2>#</a></h3><ul><li><strong>Quorum Queue</strong>: 리더+팔로워 복제, 리더 장애 시 선출, at‑least‑once. (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</li><li><strong>Stream</strong>: 로그형 저장, 다중 컨슈머, 파티셔닝/필터링. (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">rabbitmq.com</a>, <a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>)</li><li><strong>SAC</strong>: 단일 활성 컨슈머로 순서/연속성 확보. (<a href="https://www.rabbitmq.com/docs/consumers?utm_source=chatgpt.com" title=Consumers>rabbitmq.com</a>)</li><li><strong>관리/모니터링</strong>: UI, HTTP API, Prometheus 지표. (<a href="https://www.rabbitmq.com/docs/management?utm_source=chatgpt.com" title="Management Plugin">rabbitmq.com</a>)</li></ul><p><strong>검증 포인트</strong>: 4.1 스트림 필터 표현식/성능 개선 및 K8s 피어 디스커버리 변경 반영. (<a href="https://www.rabbitmq.com/blog/tags/new-features?utm_source=chatgpt.com" title='65 posts tagged with "New Features" - RabbitMQ'>rabbitmq.com</a>)</p><hr><h2 id=phase-3-특성-분석>Phase 3: 특성 분석<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석>#</a></h2><h3 id=31-장점-및-이점-1>3.1 장점 및 이점<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점-1>#</a></h3><blockquote><p>이 표는 RabbitMQ의 장점을 기술적 근거와 함께 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>장점</td><td>라우팅 유연성</td><td>다양한 교환기/바인딩, 확장 교환기 제공</td><td>교환기 타입/플러그인 문서</td><td>토폴로지로 성능/분리 최적화 (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>rabbitmq.com</a>, <a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">GitHub</a>)</td></tr><tr><td>장점</td><td>신뢰성</td><td>퍼블리셔 컨펌, Ack/Nack, DLX</td><td>Confirms/DLX 문서</td><td>데이터 손실 최소화/재처리 용이 (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>)</td></tr><tr><td>장점</td><td>내고장성</td><td>Quorum Queue/Streams의 Raft 기반 복제</td><td>Quorum/Streams 문서</td><td>노드 장애 대비 가용성 확보 (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</td></tr><tr><td>장점</td><td>운영성</td><td>Prometheus/관리 UI</td><td>Prometheus/Management 문서</td><td>관측성/자동화 손쉬움 (<a href="https://www.rabbitmq.com/docs/prometheus?utm_source=chatgpt.com" title="Monitoring with Prometheus and Grafana">rabbitmq.com</a>)</td></tr><tr><td>장점</td><td>최신 기능</td><td>스트림 필터링, MQTT5, K8s 디스커버리</td><td>3.13/4.1 릴리스 하이라이트</td><td>네트워크 절감/운영 안정성 (<a href="https://www.rabbitmq.com/blog/2024/03/11/rabbitmq-3.13.0-announcement?utm_source=chatgpt.com" title="RabbitMQ 3.13.0 Is Here!">rabbitmq.com</a>)</td></tr></tbody></table><h3 id=32-단점제약-및-해결방안>3.2 단점/제약 및 해결방안<a hidden class=anchor aria-hidden=true href=#32-단점제약-및-해결방안>#</a></h3><blockquote><p>이 표는 제약과 해결을 정리하기 위해 작성되었습니다.</p></blockquote><p><strong>단점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>강한 일관성 비용</td><td>Quorum/Streams는 합의로 지연↑</td><td>지역/복제수 조정, 배치 Confirm</td><td>Kafka(로그 중심), NATS(경량)</td></tr><tr><td>단점</td><td>순서/경합</td><td>병렬 소비 시 순서 깨짐</td><td>SAC 사용/키 파티셔닝</td><td>Kafka의 파티션 키</td></tr><tr><td>단점</td><td>대기열 장기체류</td><td>메모리/디스크 압박</td><td>Lazy 모드/Back‑pressure/TTL</td><td>스트림(리플레이) (<a href="https://www.rabbitmq.com/docs/lazy-queues?utm_source=chatgpt.com" title='Classic Queues Operating in "Lazy" Queue Mode (A Lazy ...'>rabbitmq.com</a>)</td></tr><tr><td>단점</td><td>레거시 미러링</td><td>4.0에서 제거됨</td><td>Quorum으로 마이그레이션</td><td>— (<a href="https://www.rabbitmq.com/docs/3.13/ha?utm_source=chatgpt.com" title="Classic Queue Mirroring (Deprecated) - RabbitMQ">rabbitmq.com</a>)</td></tr></tbody></table><p><strong>문제점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>소비자 정체</td><td>낮은 prefetch, 느린 처리</td><td>Ready↑/지연↑</td><td>Queue metrics, consumer util</td><td>적정 prefetch, 배치 처리</td><td>멀티컨슈머, SAC 조정 (<a href="https://www.rabbitmq.com/docs/consumer-prefetch?utm_source=chatgpt.com" title="Consumer Prefetch">rabbitmq.com</a>)</td></tr><tr><td>문제점</td><td>재시도 폭주</td><td>무제한 재큐잉</td><td>큐 폭증/DLX 오염</td><td>DLX 지표, delivery‑limit</td><td>TTL+DLX, delivery‑limit</td><td>지수 백오프, D/L 분리 큐 (<a href="https://www.rabbitmq.com/docs/3.13/dlx?utm_source=chatgpt.com" title="Dead Letter Exchanges">rabbitmq.com</a>)</td></tr><tr><td>문제점</td><td>클러스터 분열</td><td>K8s 초기부팅 경합</td><td>이중 클러스터</td><td>이벤트/로그</td><td>4.1 K8s 디스커버리</td><td>Seed‑node 정책 사용 (<a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">rabbitmq.com</a>)</td></tr></tbody></table><h3 id=33-트레이드오프>3.3 트레이드오프<a hidden class=anchor aria-hidden=true href=#33-트레이드오프>#</a></h3><ul><li><strong>Quorum vs Stream</strong>: 강한 주문/큐语语 vs 로그형 소비/재처리·대역폭 절감(필터링). (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>, <a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>)</li><li><strong>Prefetch↑ vs 공정성</strong>: 처리량↑(배치/메모리 압박) ↔ 소비자 간 공정성/지연. (<a href="https://www.rabbitmq.com/docs/consumer-prefetch?utm_source=chatgpt.com" title="Consumer Prefetch">rabbitmq.com</a>)</li></ul><h3 id=34-성능확장성>3.4 성능/확장성<a hidden class=anchor aria-hidden=true href=#34-성능확장성>#</a></h3><ul><li><strong>배치 퍼블리셔 컨펌/멀티채널</strong>, <strong>prefetch 튜닝</strong>, <strong>일관 해시 라우팅</strong>(키 기반 파티셔닝), <strong>SAC + 컨슈머 우선순위</strong>. (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>, <a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">GitHub</a>)</li><li>4.1에서 <strong>웹소켓 성능 개선(Cowboy 업그레이드)</strong>. (<a href="https://www.rabbitmq.com/blog/2025/04/08/4.1-performance-improvements?utm_source=chatgpt.com" title="RabbitMQ 4.1 Performance Improvements">rabbitmq.com</a>)</li></ul><hr><h2 id=phase-4-구현-및-분류>Phase 4: 구현 및 분류<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류>#</a></h2><h3 id=41-구현-기법방법>4.1 구현 기법/방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법방법>#</a></h3><ul><li><strong>신뢰 퍼블리싱</strong>: Mandatory + Confirm 배치 처리. (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>)</li><li><strong>재시도/사망편지</strong>: TTL+DLX+delivery‑limit 기반 재처리 파이프라인. (<a href="https://www.rabbitmq.com/docs/dlx?utm_source=chatgpt.com" title="Dead Letter Exchanges">rabbitmq.com</a>)</li><li><strong>순서 보장</strong>: SAC, 단일 파티션(키) 또는 Stream 파티션. (<a href="https://www.rabbitmq.com/docs/consumers?utm_source=chatgpt.com" title=Consumers>rabbitmq.com</a>)</li><li><strong>관측성</strong>: Prometheus 플러그인 활성화, 핵심 지표(Alert). (<a href="https://www.rabbitmq.com/docs/prometheus?utm_source=chatgpt.com" title="Monitoring with Prometheus and Grafana">rabbitmq.com</a>)</li></ul><h3 id=42-분류-기준표>4.2 분류 기준(표)<a hidden class=anchor aria-hidden=true href=#42-분류-기준표>#</a></h3><blockquote><p>이 표는 사용 목적별 RabbitMQ 데이터 구조/패턴을 분류하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>기준</th><th>옵션</th><th>권장 사용례</th><th>비고</th></tr></thead><tbody><tr><td>데이터 구조</td><td>Classic</td><td>비복제, 초고속/일시성</td><td>미러링 제거(4.0~) (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">rabbitmq.com</a>)</td></tr><tr><td></td><td>Quorum</td><td>내고장, 순서/At‑least‑once</td><td>기본 복제 큐 (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</td></tr><tr><td></td><td>Stream</td><td>로그/리플레이/다중 소비</td><td>필터/슈퍼스트림 (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>)</td></tr><tr><td>라우팅</td><td>Direct/Topic/Fanout</td><td>표준 패턴</td><td></td></tr><tr><td></td><td>Consistent‑Hash</td><td>파티셔닝/스케일아웃</td><td>플러그인 (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">GitHub</a>)</td></tr><tr><td>소비</td><td>Round‑robin</td><td>병렬 처리</td><td></td></tr><tr><td></td><td>SAC</td><td>순서 보장/Failover</td><td>(<a href="https://www.rabbitmq.com/docs/consumers?utm_source=chatgpt.com" title=Consumers>rabbitmq.com</a>)</td></tr></tbody></table><h3 id=43-도구프레임워크-생태계>4.3 도구/프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구프레임워크-생태계>#</a></h3><ul><li>클라이언트: <strong>pika(Py), amqplib(Node.js), Spring AMQP(Java)</strong>, <strong>Stream 전용 클라이언트(Java, Python rstream)</strong>. (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>, <a href="https://pypi.org/project/rstream/?utm_source=chatgpt.com" title=rstream>PyPI</a>)</li><li>배포/운영: <strong>RabbitMQ Cluster Operator(K8s)</strong>, Bitnami Helm Chart. (<a href="https://www.rabbitmq.com/kubernetes/operator/using-operator?utm_source=chatgpt.com" title="Using the RabbitMQ Cluster Kubernetes Operator">rabbitmq.com</a>, <a href="https://artifacthub.io/packages/helm/bitnami/rabbitmq?utm_source=chatgpt.com" title="rabbitmq 16.0.13 · bitnami/bitnami">artifacthub.io</a>)</li></ul><h3 id=44-표준규격-준수>4.4 표준/규격 준수<a hidden class=anchor aria-hidden=true href=#44-표준규격-준수>#</a></h3><ul><li><strong>AMQP 0‑9‑1/1.0</strong> 지원 명시, MQTT v5 지원(3.13~). (<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">rabbitmq.com</a>)</li></ul><hr><h2 id=phase-5-실무-적용>Phase 5: 실무 적용<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용>#</a></h2><h3 id=51-실습-예제-및-코드-구현-2>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현-2>#</a></h3><p><strong>학습 목표</strong>: 신뢰성(Confirm), 재시도(DLX), 순서(SAC), 관측성(Prometheus)
<strong>시나리오</strong>: 주문 이벤트 처리(주문 생성 → 결제 → 알림)
<strong>시스템 구성</strong>:</p><ul><li>API(Producer), <strong>orders.exchange(topic)</strong>, <strong>orders.queue(quorum)</strong>, <strong>orders.dlq</strong>, Consumer(결제), Prometheus</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
  P[API Producer] --&gt; EX[(topic exchange)]
  EX --&gt;|orders.created| QQ[(orders.queue - quorum)]
  QQ --&gt; C[Payment Consumer (SAC)]
  QQ -. DLX .-&gt; DLXQ[(orders.dlq)]
  subgraph Observability
    QQ --&gt; PM[Prometheus metrics]
  end
</pre><p><strong>Workflow</strong>:</p><ol><li>API가 <code>orders.created</code> 발행 → 2) 토픽 라우팅 → 3) Quorum 큐에 적재 → 4) SAC 컨슈머가 처리/ACK → 5) 실패 시 NACK(requeue=false) → DLX 로 이동 → 6) DLQ 소비자 알림/재시도</li></ol><p><strong>핵심 역할</strong>: RabbitMQ는 <strong>버퍼링/순서/재시도/관측성 연계</strong>의 메시징 허브</p><p><strong>유무 비교</strong>:</p><ul><li>도입 전: 동기 RPC로 스파이크 시 장애/타임아웃</li><li>도입 후: 비동기 버퍼링/재처리, 결합도 감소</li></ul><p><strong>구현 예시 (Python: 퍼블리셔 컨펌 + 토픽)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-77-1><a class=lnlinks href=#hl-77-1> 1</a>
</span><span class=lnt id=hl-77-2><a class=lnlinks href=#hl-77-2> 2</a>
</span><span class=lnt id=hl-77-3><a class=lnlinks href=#hl-77-3> 3</a>
</span><span class=lnt id=hl-77-4><a class=lnlinks href=#hl-77-4> 4</a>
</span><span class=lnt id=hl-77-5><a class=lnlinks href=#hl-77-5> 5</a>
</span><span class=lnt id=hl-77-6><a class=lnlinks href=#hl-77-6> 6</a>
</span><span class=lnt id=hl-77-7><a class=lnlinks href=#hl-77-7> 7</a>
</span><span class=lnt id=hl-77-8><a class=lnlinks href=#hl-77-8> 8</a>
</span><span class=lnt id=hl-77-9><a class=lnlinks href=#hl-77-9> 9</a>
</span><span class=lnt id=hl-77-10><a class=lnlinks href=#hl-77-10>10</a>
</span><span class=lnt id=hl-77-11><a class=lnlinks href=#hl-77-11>11</a>
</span><span class=lnt id=hl-77-12><a class=lnlinks href=#hl-77-12>12</a>
</span><span class=lnt id=hl-77-13><a class=lnlinks href=#hl-77-13>13</a>
</span><span class=lnt id=hl-77-14><a class=lnlinks href=#hl-77-14>14</a>
</span><span class=lnt id=hl-77-15><a class=lnlinks href=#hl-77-15>15</a>
</span><span class=lnt id=hl-77-16><a class=lnlinks href=#hl-77-16>16</a>
</span><span class=lnt id=hl-77-17><a class=lnlinks href=#hl-77-17>17</a>
</span><span class=lnt id=hl-77-18><a class=lnlinks href=#hl-77-18>18</a>
</span><span class=lnt id=hl-77-19><a class=lnlinks href=#hl-77-19>19</a>
</span><span class=lnt id=hl-77-20><a class=lnlinks href=#hl-77-20>20</a>
</span><span class=lnt id=hl-77-21><a class=lnlinks href=#hl-77-21>21</a>
</span><span class=lnt id=hl-77-22><a class=lnlinks href=#hl-77-22>22</a>
</span><span class=lnt id=hl-77-23><a class=lnlinks href=#hl-77-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>publish_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    - 퍼블리셔 컨펌(Confirm)으로 브로커 수신 보장
</span></span></span><span class=line><span class=cl><span class=s2>    - topic exchange로 라우팅 (orders.created)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>URLParameters</span><span class=p>(</span><span class=s2>&#34;amqp://user:pwd@localhost:5672/</span><span class=si>%2F</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>confirm_delivery</span><span class=p>()</span>  <span class=c1># 퍼블리셔 컨펌 활성화</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=s2>&#34;orders.exchange&#34;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s2>&#34;topic&#34;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>body</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;ts&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>    <span class=n>rk</span> <span class=o>=</span> <span class=s2>&#34;orders.created&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># mandatory로 라우팅 실패 감지</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ch</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=s2>&#34;orders.exchange&#34;</span><span class=p>,</span> <span class=n>rk</span><span class=p>,</span> <span class=n>body</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>mandatory</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Published with confirm&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>구현 예시 (Node.js: SAC 소비자 + prefetch)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1> 1</a>
</span><span class=lnt id=hl-78-2><a class=lnlinks href=#hl-78-2> 2</a>
</span><span class=lnt id=hl-78-3><a class=lnlinks href=#hl-78-3> 3</a>
</span><span class=lnt id=hl-78-4><a class=lnlinks href=#hl-78-4> 4</a>
</span><span class=lnt id=hl-78-5><a class=lnlinks href=#hl-78-5> 5</a>
</span><span class=lnt id=hl-78-6><a class=lnlinks href=#hl-78-6> 6</a>
</span><span class=lnt id=hl-78-7><a class=lnlinks href=#hl-78-7> 7</a>
</span><span class=lnt id=hl-78-8><a class=lnlinks href=#hl-78-8> 8</a>
</span><span class=lnt id=hl-78-9><a class=lnlinks href=#hl-78-9> 9</a>
</span><span class=lnt id=hl-78-10><a class=lnlinks href=#hl-78-10>10</a>
</span><span class=lnt id=hl-78-11><a class=lnlinks href=#hl-78-11>11</a>
</span><span class=lnt id=hl-78-12><a class=lnlinks href=#hl-78-12>12</a>
</span><span class=lnt id=hl-78-13><a class=lnlinks href=#hl-78-13>13</a>
</span><span class=lnt id=hl-78-14><a class=lnlinks href=#hl-78-14>14</a>
</span><span class=lnt id=hl-78-15><a class=lnlinks href=#hl-78-15>15</a>
</span><span class=lnt id=hl-78-16><a class=lnlinks href=#hl-78-16>16</a>
</span><span class=lnt id=hl-78-17><a class=lnlinks href=#hl-78-17>17</a>
</span><span class=lnt id=hl-78-18><a class=lnlinks href=#hl-78-18>18</a>
</span><span class=lnt id=hl-78-19><a class=lnlinks href=#hl-78-19>19</a>
</span><span class=lnt id=hl-78-20><a class=lnlinks href=#hl-78-20>20</a>
</span><span class=lnt id=hl-78-21><a class=lnlinks href=#hl-78-21>21</a>
</span><span class=lnt id=hl-78-22><a class=lnlinks href=#hl-78-22>22</a>
</span><span class=lnt id=hl-78-23><a class=lnlinks href=#hl-78-23>23</a>
</span><span class=lnt id=hl-78-24><a class=lnlinks href=#hl-78-24>24</a>
</span><span class=lnt id=hl-78-25><a class=lnlinks href=#hl-78-25>25</a>
</span><span class=lnt id=hl-78-26><a class=lnlinks href=#hl-78-26>26</a>
</span><span class=lnt id=hl-78-27><a class=lnlinks href=#hl-78-27>27</a>
</span><span class=lnt id=hl-78-28><a class=lnlinks href=#hl-78-28>28</a>
</span><span class=lnt id=hl-78-29><a class=lnlinks href=#hl-78-29>29</a>
</span><span class=lnt id=hl-78-30><a class=lnlinks href=#hl-78-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// npm i amqplib
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=s1>&#39;amqp://user:pwd@localhost:5672/&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>conn</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ch</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>q</span> <span class=o>=</span> <span class=s1>&#39;orders.queue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>ch</span><span class=p>.</span><span class=nx>assertExchange</span><span class=p>(</span><span class=s1>&#39;orders.exchange&#39;</span><span class=p>,</span> <span class=s1>&#39;topic&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>ch</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>q</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Quorum 큐 선언 (복제/내구성) - 정책으로 기본값 설정 권장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-queue-type&#39;</span><span class=o>:</span> <span class=s1>&#39;quorum&#39;</span><span class=p>,</span> <span class=s1>&#39;x-single-active-consumer&#39;</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=c1>// SAC 활성화
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>ch</span><span class=p>.</span><span class=nx>bindQueue</span><span class=p>(</span><span class=nx>q</span><span class=p>,</span> <span class=s1>&#39;orders.exchange&#39;</span><span class=p>,</span> <span class=s1>&#39;orders.created&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ch</span><span class=p>.</span><span class=nx>prefetch</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span> <span class=c1>// 처리량/지연 균형 튜닝 포인트 (consumer prefetch) :contentReference[oaicite:58]{index=58}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>ch</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=nx>q</span><span class=p>,</span> <span class=kr>async</span> <span class=nx>msg</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>payload</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 순서가 필요한 로직을 SAC로 안전 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>ch</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 재시도 한도에 도달하면 DLX로 이동되도록 NACK (requeue=false)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>ch</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span> <span class=nx>noAck</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>DLX/TTL 정책 (rabbitmqctl/rabbitmq.conf 예시)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-79-1><a class=lnlinks href=#hl-79-1>1</a>
</span><span class=lnt id=hl-79-2><a class=lnlinks href=#hl-79-2>2</a>
</span><span class=lnt id=hl-79-3><a class=lnlinks href=#hl-79-3>3</a>
</span><span class=lnt id=hl-79-4><a class=lnlinks href=#hl-79-4>4</a>
</span><span class=lnt id=hl-79-5><a class=lnlinks href=#hl-79-5>5</a>
</span><span class=lnt id=hl-79-6><a class=lnlinks href=#hl-79-6>6</a>
</span><span class=lnt id=hl-79-7><a class=lnlinks href=#hl-79-7>7</a>
</span><span class=lnt id=hl-79-8><a class=lnlinks href=#hl-79-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># DLX용 교환기/큐</span>
</span></span><span class=line><span class=cl>rabbitmqadmin <span class=nb>declare</span> exchange <span class=nv>name</span><span class=o>=</span>orders.dlx <span class=nv>type</span><span class=o>=</span>direct <span class=nv>durable</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>rabbitmqadmin <span class=nb>declare</span> queue <span class=nv>name</span><span class=o>=</span>orders.dlq <span class=nv>durable</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>rabbitmqadmin <span class=nb>declare</span> binding <span class=nv>source</span><span class=o>=</span>orders.dlx <span class=nv>destination</span><span class=o>=</span>orders.dlq <span class=nv>routing_key</span><span class=o>=</span>dead
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 본 큐에 DLX/TTL/delivery-limit 적용 (정책)</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_policy DLX <span class=s2>&#34;orders\.queue&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>&#39;{&#34;dead-letter-exchange&#34;:&#34;orders.dlx&#34;,&#34;dead-letter-routing-key&#34;:&#34;dead&#34;,&#34;delivery-limit&#34;:5,&#34;message-ttl&#34;:60000}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>DLX 동작 이벤트(NAck, TTL, 길이 제한, delivery‑limit)와 동작은 공식 문서 기준. (<a href="https://www.rabbitmq.com/docs/dlx?utm_source=chatgpt.com" title="Dead Letter Exchanges">rabbitmq.com</a>)</p></blockquote><p><strong>Prometheus 플러그인 활성화</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-80-1><a class=lnlinks href=#hl-80-1>1</a>
</span><span class=lnt id=hl-80-2><a class=lnlinks href=#hl-80-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_prometheus   <span class=c1># /metrics 노출</span>
</span></span><span class=line><span class=cl><span class=c1># 관리 UI는 보조, 장기 수집은 Prometheus 권장</span>
</span></span></code></pre></td></tr></table></div></div><p>(모니터링 가이드) (<a href="https://www.rabbitmq.com/docs/prometheus?utm_source=chatgpt.com" title="Monitoring with Prometheus and Grafana">rabbitmq.com</a>)</p><h3 id=52-실제-도입-사례-요약>5.2 실제 도입 사례 (요약)<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례-요약>#</a></h3><ul><li><strong>이커머스 주문 파이프라인</strong>: 주문 생성→결제→포장→배송 이벤트. Quorum 큐 + SAC로 순서/정합성, DLX 재시도, Prometheus로 SLA 모니터.</li><li><strong>IoT 텔레메트리</strong>: Stream + 필터링으로 지역/기기 필터 서버측 처리, 네트워크 절감. (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>)</li><li><strong>멀티리전 통합</strong>: Federation으로 지역 브로커 간 메시지 전파(약결합, WAN 친화). (<a href="https://www.rabbitmq.com/docs/federation?utm_source=chatgpt.com" title="Federation Plugin">rabbitmq.com</a>)</li></ul><h3 id=53-실제-도입-사례의-코드-구현-2>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현-2>#</a></h3><p><strong>사례 선정</strong>: IoT 텔레메트리(Streams + 서버측 필터)
<strong>비즈니스 배경</strong>: 수백만 센서 데이터에서 <strong>국가=KR</strong>만 소비
<strong>기술적 요구사항</strong>: 대역폭 절감, 리플레이, 파티셔닝</p><p><strong>시스템 구성</strong>:</p><ul><li>Producer(센서 게이트웨이), <strong>iot.stream</strong>(superstream, 파티션 키=deviceId), 소비자(KR 전용, 필터)</li></ul><p><strong>다이어그램</strong></p><pre class=mermaid>graph TB
  G[Gateway Producers] --&gt; ST[(iot.superstream)]
  ST --&gt;|filter country=&#39;KR&#39;| C1[Consumer KR]
  ST --&gt;|filter country=&#39;US&#39;| C2[Consumer US]
</pre><p><strong>구현 예시 (Python rstream: 필터 퍼블리시/컨슘)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-82-1><a class=lnlinks href=#hl-82-1> 1</a>
</span><span class=lnt id=hl-82-2><a class=lnlinks href=#hl-82-2> 2</a>
</span><span class=lnt id=hl-82-3><a class=lnlinks href=#hl-82-3> 3</a>
</span><span class=lnt id=hl-82-4><a class=lnlinks href=#hl-82-4> 4</a>
</span><span class=lnt id=hl-82-5><a class=lnlinks href=#hl-82-5> 5</a>
</span><span class=lnt id=hl-82-6><a class=lnlinks href=#hl-82-6> 6</a>
</span><span class=lnt id=hl-82-7><a class=lnlinks href=#hl-82-7> 7</a>
</span><span class=lnt id=hl-82-8><a class=lnlinks href=#hl-82-8> 8</a>
</span><span class=lnt id=hl-82-9><a class=lnlinks href=#hl-82-9> 9</a>
</span><span class=lnt id=hl-82-10><a class=lnlinks href=#hl-82-10>10</a>
</span><span class=lnt id=hl-82-11><a class=lnlinks href=#hl-82-11>11</a>
</span><span class=lnt id=hl-82-12><a class=lnlinks href=#hl-82-12>12</a>
</span><span class=lnt id=hl-82-13><a class=lnlinks href=#hl-82-13>13</a>
</span><span class=lnt id=hl-82-14><a class=lnlinks href=#hl-82-14>14</a>
</span><span class=lnt id=hl-82-15><a class=lnlinks href=#hl-82-15>15</a>
</span><span class=lnt id=hl-82-16><a class=lnlinks href=#hl-82-16>16</a>
</span><span class=lnt id=hl-82-17><a class=lnlinks href=#hl-82-17>17</a>
</span><span class=lnt id=hl-82-18><a class=lnlinks href=#hl-82-18>18</a>
</span><span class=lnt id=hl-82-19><a class=lnlinks href=#hl-82-19>19</a>
</span><span class=lnt id=hl-82-20><a class=lnlinks href=#hl-82-20>20</a>
</span><span class=lnt id=hl-82-21><a class=lnlinks href=#hl-82-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install rstream</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>rstream</span> <span class=kn>import</span> <span class=n>Producer</span><span class=p>,</span> <span class=n>Consumer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지에 필터 키(country)를 메타로 부여 (서버측 필터링: 3.13+)</span>
</span></span><span class=line><span class=cl><span class=c1># 참고: Stream filtering (Bloom filter 기반) :contentReference[oaicite:63]{index=63}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5552</span><span class=p>)</span>  <span class=c1># stream protocol port 예</span>
</span></span><span class=line><span class=cl><span class=n>producer</span><span class=o>.</span><span class=n>create_stream</span><span class=p>(</span><span class=s2>&#34;iot.superstream&#34;</span><span class=p>,</span> <span class=n>arguments</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;max-age&#34;</span><span class=p>:</span> <span class=s2>&#34;7d&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>device_id</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>device_id</span><span class=si>}</span><span class=s2>,42.1,KR&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=s2>&#34;iot.superstream&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>routing_key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>device_id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                     <span class=n>properties</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;x-filter-value&#34;</span><span class=p>:</span> <span class=s2>&#34;KR&#34;</span><span class=p>})</span>  <span class=c1># 서버측 필터 값</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># KR 소비자: 서버측 필터 적용</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>on_message</span><span class=p>(</span><span class=n>consumer</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;KR:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span><span class=o>.</span><span class=n>store_offset</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>Consumer</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5552</span><span class=p>,</span> <span class=n>filter_value</span><span class=o>=</span><span class=s2>&#34;KR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=s2>&#34;iot.superstream&#34;</span><span class=p>,</span> <span class=n>on_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>스트림 필터링은 3.13+ 제공, 4.1에서 AMQP 필터 표현식 등 확장. (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">rabbitmq.github.io</a>, <a href="https://www.rabbitmq.com/blog/tags/new-features?utm_source=chatgpt.com" title='65 posts tagged with "New Features" - RabbitMQ'>rabbitmq.com</a>)</p></blockquote><p><strong>성과 분석</strong>: 네트워크 트래픽 절감(필요 서브셋만 전송), 컨슈머 수평 확장/리플레이 용이.</p><h3 id=54-통합연계-기술>5.4 통합/연계 기술<a hidden class=anchor aria-hidden=true href=#54-통합연계-기술>#</a></h3><ul><li><strong>Federation/Shovel</strong>: 크로스 리전/시스템 통합. (<a href="https://www.rabbitmq.com/docs/federation?utm_source=chatgpt.com" title="Federation Plugin">rabbitmq.com</a>)</li><li><strong>K8s 오퍼레이터</strong>: CRD 기반 선언적 운영. (<a href="https://www.rabbitmq.com/kubernetes/operator/using-operator?utm_source=chatgpt.com" title="Using the RabbitMQ Cluster Kubernetes Operator">rabbitmq.com</a>)</li></ul><hr><h2 id=phase-6-운영-및-최적화>Phase 6: 운영 및 최적화<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화>#</a></h2><h3 id=61-보안거버넌스>6.1 보안/거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안거버넌스>#</a></h3><ul><li><strong>TLS/mTLS</strong>로 클라이언트 및 클러스터 링크 보호, 인증서 검증/상호인증. (<a href="https://www.rabbitmq.com/docs/ssl?utm_source=chatgpt.com" title="TLS Support">rabbitmq.com</a>)</li><li><strong>권한/가상호스트 분리</strong>, 운영/앱 계정 구분, 최소권한.</li><li><strong>네트워크 분리</strong>: 관리 포트/프로토콜 포트/메트릭 엔드포인트 분리.</li></ul><h3 id=62-모니터링관측성>6.2 모니터링/관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링관측성>#</a></h3><ul><li><strong>핵심 지표</strong>: ready/unacked, publish/confirm rate, consumer utilization, connection/churn, disk_free, mem alarms, file_descriptors. 관리 UI는 스냅샷, <strong>장기 수집은 Prometheus</strong>. (<a href="https://www.rabbitmq.com/docs/monitoring?utm_source=chatgpt.com" title=Monitoring>rabbitmq.com</a>)</li></ul><h3 id=63-실무-고려사항표>6.3 실무 고려사항(표)<a hidden class=anchor aria-hidden=true href=#63-실무-고려사항표>#</a></h3><blockquote><p>이 표는 운영 시 주의/권장사항을 요약합니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>권장사항</th></tr></thead><tbody><tr><td>구성</td><td>클러스터 크기</td><td>Quorum/Streams는 홀수(3/5/7) 권장</td></tr><tr><td>스토리지</td><td>디스크</td><td>내구성 스토리지, I/O 전용 디스크, 디스크 알람 한계 설정</td></tr><tr><td>자원</td><td>CPU/RAM</td><td>최소 사양 가이드 준수(Prod Checklist) (<a href="https://www.rabbitmq.com/docs/production-checklist?utm_source=chatgpt.com" title="Production Deployment Guidelines">rabbitmq.com</a>)</td></tr><tr><td>배포</td><td>K8s</td><td>4.1 K8s 피어 디스커버리 사용/오퍼레이터 권장 (<a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">rabbitmq.com</a>)</td></tr><tr><td>권장</td><td>마이그레이션</td><td>미러드 클래식 → Quorum/Streams 전환 계획 수립 (<a href="https://www.rabbitmq.com/docs/3.13/ha?utm_source=chatgpt.com" title="Classic Queue Mirroring (Deprecated) - RabbitMQ">rabbitmq.com</a>)</td></tr></tbody></table><h3 id=64-성능-최적화표>6.4 성능 최적화(표)<a hidden class=anchor aria-hidden=true href=#64-성능-최적화표>#</a></h3><blockquote><p>이 표는 처리량/지연 최적화를 위한 주요 레버를 정리합니다.</p></blockquote><table><thead><tr><th>영역</th><th>전략</th><th>설명/근거</th><th></th></tr></thead><tbody><tr><td>Publish</td><td>배치 Confirm</td><td>채널 단위 비동기/배치로 왕복 최소화 (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>)</td><td></td></tr><tr><td>Consume</td><td>prefetch 튜닝</td><td>CPU/처리시간 기준 16~512 범위 실측</td><td>(<a href="https://www.rabbitmq.com/docs/consumer-prefetch?utm_source=chatgpt.com" title="Consumer Prefetch">rabbitmq.com</a>)</td></tr><tr><td>라우팅</td><td>키 파티셔닝</td><td>Consistent‑Hash/슈퍼스트림</td><td>(<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">GitHub</a>, <a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">rabbitmq.com</a>)</td></tr><tr><td>네트워크</td><td>WS 성능</td><td>4.1에서 WebSocket 경로 성능 개선</td><td>(<a href="https://www.rabbitmq.com/blog/2025/04/08/4.1-performance-improvements?utm_source=chatgpt.com" title="RabbitMQ 4.1 Performance Improvements">rabbitmq.com</a>)</td></tr></tbody></table><hr><h2 id=phase-7-고급-주제>Phase 7: 고급 주제<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제>#</a></h2><h3 id=71-현재-도전-과제-1>7.1 현재 도전 과제<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제-1>#</a></h3><ul><li><strong>메타데이터 스토어 전환(Mnesia→Khepri)</strong> 운영 성숙도·마이그레이션 전략(4.1은 기본 Mnesia, 플래그로 Khepri 활성화). (<a href="https://www.rabbitmq.com/docs/metadata-store/how-to-enable-khepri?utm_source=chatgpt.com" title="How to Enable Khepri">rabbitmq.com</a>)</li><li><strong>K8s 대규모 운영</strong>: 초기부팅/분열 방지, 영속스토리지, 네트워크 정책. (<a href="https://www.rabbitmq.com/docs/cluster-formation?utm_source=chatgpt.com" title="Cluster Formation and Peer Discovery">rabbitmq.com</a>)</li></ul><h3 id=72-생태계관련-기술>7.2 생태계/관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계관련-기술>#</a></h3><ul><li><strong>CloudAMQP/Amazon MQ</strong> 관리형, <strong>Spring Cloud Stream</strong> 등 프레임워크, <strong>Grafana/Loki/ELK</strong> 연계. (Amazon MQ의 Quorum 가용 버전/가이드 참고) (<a href="https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/quorum-queues.html?utm_source=chatgpt.com" title="Quorum queues for RabbitMQ on Amazon MQ">AWS Documentation</a>)</li></ul><h3 id=73-최신-트렌드미래>7.3 최신 트렌드/미래<a hidden class=anchor aria-hidden=true href=#73-최신-트렌드미래>#</a></h3><ul><li><strong>RabbitMQ 4.1.x 최신</strong>: AMQP 필터 표현식(Streams), K8s 피어 디스커버리 재설계, 성능 개선. 최신 안정판은 4.1.3(2025‑08‑04 기준). (<a href="https://www.rabbitmq.com/blog/tags/new-features?utm_source=chatgpt.com" title='65 posts tagged with "New Features" - RabbitMQ'>rabbitmq.com</a>)</li></ul><h3 id=74-기타>7.4 기타<a hidden class=anchor aria-hidden=true href=#74-기타>#</a></h3><ul><li>**클래식 큐 미러링 완전 제거(4.0~)**로 <strong>Quorum/Streams</strong> 전환이 필수 로드맵. (<a href="https://www.rabbitmq.com/docs/3.13/ha?utm_source=chatgpt.com" title="Classic Queue Mirroring (Deprecated) - RabbitMQ">rabbitmq.com</a>)</li></ul><hr><h2 id=7-추가-조사-영역-선택>7. 추가 조사 영역 (선택)<a hidden class=anchor aria-hidden=true href=#7-추가-조사-영역-선택>#</a></h2><ul><li><strong>멀티테넌시 설계(vhost/정책 분리)</strong>, <strong>OPA/LDAP 연동 권한관리</strong>, <strong>Superstream 키 설계 패턴</strong>(핫파트 대비), <strong>Exactly‑once 시맨틱스 설계(멱등/트랜잭션 아웃박스)</strong>.</li></ul><hr><h1 id=4단계-통합-검증-및-조정>4단계: 통합 검증 및 조정<a hidden class=anchor aria-hidden=true href=#4단계-통합-검증-및-조정>#</a></h1><ul><li><strong>정확성 검증</strong>: 버전/기능은 4.0/4.1 공식 자료로 재확인(미러링 제거, K8s, 필터). (<a href="https://www.rabbitmq.com/docs/3.13/ha?utm_source=chatgpt.com" title="Classic Queue Mirroring (Deprecated) - RabbitMQ">rabbitmq.com</a>)</li><li><strong>도구형 맞춤 조정</strong>: 설치/운영/보안/모니터링/확장성에 비중(Phase 5‑6 강화).</li><li><strong>최신성 확인</strong>: 최신 릴리스 4.1.3 및 릴리스 노트 반영. (<a href="https://www.rabbitmq.com/docs/download?utm_source=chatgpt.com" title="Installing RabbitMQ">rabbitmq.com</a>)</li></ul><hr><h1 id=5단계-종합-정리-및-학습-가이드>5단계: 종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#5단계-종합-정리-및-학습-가이드>#</a></h1><h2 id=최종-정리>최종 정리<a hidden class=anchor aria-hidden=true href=#최종-정리>#</a></h2><ul><li><strong>권장 기본값</strong>: 복제 필요 시 <strong>Quorum Queue</strong>, 로그/재처리/필터 필요 시 <strong>Streams</strong>.</li><li><strong>운영 필수</strong>: 퍼블리셔 컨펌, DLX+delivery‑limit, prefetch 튜닝, Prometheus 모니터링, TLS.</li><li><strong>K8s</strong>: 4.1 피어 디스커버리와 오퍼레이터로 안정적 클러스터링.</li></ul><h2 id=학습-로드맵우선순위>학습 로드맵/우선순위<a hidden class=anchor aria-hidden=true href=#학습-로드맵우선순위>#</a></h2><ol><li>기본 개념/라우팅 → 2) 신뢰성(Ack/Confirm/DLX) → 3) Quorum/Streams 비교 → 4) 관측성/보안 → 5) K8s/운영 자동화 → 6) 고급(필터/SAC/파티셔닝/Khepri)</li></ol><h2 id=실무-적용-가이드-2>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드-2>#</a></h2><ul><li>신규: Quorum 또는 Stream 중심 설계, SAC/Prefetch/Confirm 기본 탑재</li><li>기존: 미러드 클래식 큐 <strong>마이그레이션 플랜</strong>(정책 전환/데이터 이관/호환성 테스트) 수립 (<a href="https://www.rabbitmq.com/docs/3.13/migrate-mcq-to-qq?utm_source=chatgpt.com" title="Migrate your RabbitMQ Mirrored Classic Queues to ...">rabbitmq.com</a>)</li></ul><h3 id=학습-항목-정리-표>학습 항목 정리 표<a hidden class=anchor aria-hidden=true href=#학습-항목-정리-표>#</a></h3><blockquote><p>이 표는 체계적 학습 항목/중요도를 정리합니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-83-1><a class=lnlinks href=#hl-83-1>1</a>
</span><span class=lnt id=hl-83-2><a class=lnlinks href=#hl-83-2>2</a>
</span><span class=lnt id=hl-83-3><a class=lnlinks href=#hl-83-3>3</a>
</span><span class=lnt id=hl-83-4><a class=lnlinks href=#hl-83-4>4</a>
</span><span class=lnt id=hl-83-5><a class=lnlinks href=#hl-83-5>5</a>
</span><span class=lnt id=hl-83-6><a class=lnlinks href=#hl-83-6>6</a>
</span><span class=lnt id=hl-83-7><a class=lnlinks href=#hl-83-7>7</a>
</span><span class=lnt id=hl-83-8><a class=lnlinks href=#hl-83-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목 | 중요도 | 학습 목표 | 실무 연관성 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------|--------|-----------|-------------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | AMQP/Exchange/Queue | 필수 | 메시징 기본 개념 | 높음 | 라우팅/내구성 기초 |
</span></span><span class=line><span class=cl>| 핵심     | 2     | Quorum/Streams/SAC | 필수 | 복제/순서/로그형 소비 | 높음 | 고가용/재처리 |
</span></span><span class=line><span class=cl>| 핵심     | 3     | DLX/Prefetch/Confirm | 필수 | 신뢰성/성능 | 높음 | 장애/폭주 대응 |
</span></span><span class=line><span class=cl>| 응용     | 5     | K8s 운영/오퍼레이터 | 권장 | 클러스터 자동화 | 중간 | 4.1 디스커버리 |
</span></span><span class=line><span class=cl>| 응용     | 6     | TLS/Prometheus | 권장 | 보안/관측성 | 중간 | mTLS/지표 |
</span></span><span class=line><span class=cl>| 고급     | 7     | Khepri/필터 표현식 | 선택 | 메타스토어/네트워크 절감 | 낮음 | 4.x 전환 전략 |
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=10-마무리-표준-형식>10. 마무리 표준 형식<a hidden class=anchor aria-hidden=true href=#10-마무리-표준-형식>#</a></h2><h3 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h3><blockquote><p>이 표는 핵심 용어와 실무 적용을 정리합니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>Quorum Queue</td><td>Raft 복제 큐</td><td>Leader/Followers, delivery‑limit</td><td>고가용/순서/내구성</td></tr><tr><td>핵심</td><td>Stream</td><td>Append‑only 로그형 저장/소비</td><td>Superstream, 필터 표현식</td><td>대용량 이벤트/리플레이</td></tr><tr><td>구현</td><td>SAC</td><td>단일 활성 소비자</td><td>순서/Failover</td><td>결제·주문 등 순서 중요 도메인</td></tr><tr><td>구현</td><td>DLX</td><td>사망편지 교환기</td><td>TTL/NACK/길이/limit</td><td>재시도/격리/모니터링</td></tr><tr><td>운영</td><td>Prometheus Plugin</td><td>/metrics 노출</td><td>Grafana, Alert</td><td>지표 기반 SLO</td></tr><tr><td>운영</td><td>Khepri</td><td>Raft 기반 메타스토어</td><td>Mnesia, Feature Flag</td><td>4.x 전환/분할 복원력</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://www.rabbitmq.com/docs/download>RabbitMQ Installing / Latest 4.1.x</a> (<a href="https://www.rabbitmq.com/docs/download?utm_source=chatgpt.com" title="Installing RabbitMQ">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/release-information>Release Information / 4.1</a> (<a href="https://www.rabbitmq.com/release-information?utm_source=chatgpt.com" title="Release Information - RabbitMQ">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/blog/2024/03/11/rabbitmq-3-13-0-announcement>What&rsquo;s New 3.13 / MQTT v5, Stream Filtering</a> (<a href="https://www.rabbitmq.com/blog/2024/03/11/rabbitmq-3.13.0-announcement?utm_source=chatgpt.com" title="RabbitMQ 3.13.0 Is Here!">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/stream>Streams / Overview & Filtering</a> (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/quorum-queues>Quorum Queues</a> (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/consumers>Consumers / Single Active Consumer</a> (<a href="https://www.rabbitmq.com/docs/consumers?utm_source=chatgpt.com" title=Consumers>rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/dlx>Dead Letter Exchanges</a> (<a href="https://www.rabbitmq.com/docs/dlx?utm_source=chatgpt.com" title="Dead Letter Exchanges">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/confirms>Publisher Confirms</a> (<a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/monitoring>Management & Monitoring</a> (<a href="https://www.rabbitmq.com/docs/monitoring?utm_source=chatgpt.com" title=Monitoring>rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/prometheus>Prometheus Plugin Guide</a> (<a href="https://www.rabbitmq.com/docs/prometheus?utm_source=chatgpt.com" title="Monitoring with Prometheus and Grafana">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/cluster-formation>Clustering / Cluster Formation & K8s Peer Discovery (4.1)</a> (<a href="https://www.rabbitmq.com/docs/cluster-formation?utm_source=chatgpt.com" title="Cluster Formation and Peer Discovery">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/3.13/ha>Classic Queue Mirroring Deprecated/Removed in 4.0</a> (<a href="https://www.rabbitmq.com/docs/3.13/ha?utm_source=chatgpt.com" title="Classic Queue Mirroring (Deprecated) - RabbitMQ">rabbitmq.com</a>)</li><li><a href=https://www.rabbitmq.com/docs/metadata-store>Metadata Store (Mnesia vs Khepri) & How to Enable Khepri</a> / <a href=https://www.rabbitmq.com/docs/metadata-store/how-to-enable-khepri>Enable Khepri</a> (<a href="https://www.rabbitmq.com/docs/metadata-store?utm_source=chatgpt.com" title="Metadata store">rabbitmq.com</a>)</li></ul><hr><p>원하시면 <strong>운영 환경 별 템플릿</strong>(Docker Compose, Kubernetes/Helm 값 파일, TLS 예제 <code>rabbitmq.conf</code>, Grafana 대시보드 JSON)까지 이어서 제공하겠습니다.</p><hr><h2 id=1단계-기본-분석-및-검증-3><strong>1단계: 기본 분석 및 검증</strong><a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-3>#</a></h2><h3 id=1-대표-태그-생성-2>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성-2>#</a></h3><ul><li><strong>Message-Broker</strong></li><li><strong>AMQP</strong></li><li><strong>Event-Driven-Architecture</strong></li><li><strong>Asynchronous-Messaging</strong></li></ul><hr><h3 id=2-분류-체계-검증-1>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증-1>#</a></h3><p>현재 분류 구조의 <code>"Tool Reference > Communication Technologies > Message Brokers"</code>에 RabbitMQ를 포함하는 것은 적절합니다.
RabbitMQ는 <strong>AMQP (Advanced Message Queuing Protocol)</strong> 기반의 메시지 브로커로, 통신 계층보다는 <strong>응용 서비스 레벨에서 메시지 라우팅 및 큐잉을 담당</strong>하는 미들웨어이므로 <strong>Networking and Communication</strong>보다는 <strong>Tool Reference</strong>에 포함시키는 편이 실무 분류에서 더 명확합니다.
단, <strong>대규모 분산 환경 설계(System Design)</strong> 학습 과정에서도 반드시 다루는 주제이므로, <strong>System Design > Distributed Systems</strong>의 참조 링크를 추가하는 것도 권장합니다.</p><hr><h3 id=3-핵심-요약-250자-이내-2>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내-2>#</a></h3><p>RabbitMQ는 AMQP 프로토콜 기반의 오픈소스 메시지 브로커로, 분산 시스템 간 비동기 통신을 지원하며 안정적 메시지 전송, 라우팅, 큐잉 기능을 제공한다. 마이크로서비스, 이벤트 기반 아키텍처에서 핵심 메시징 허브 역할을 한다.</p><hr><h3 id=4-전체-개요-400자-이내-1>4. 전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-400자-이내-1>#</a></h3><p>RabbitMQ는 Erlang/OTP로 개발된 오픈소스 메시지 브로커로, AMQP, MQTT, STOMP 등 다양한 메시징 프로토콜을 지원한다. 프로듀서(Producer)와 컨슈머(Consumer) 간 메시지를 비동기적으로 전달하며, 라우팅, 토픽, 워크큐, 퍼블리시/서브스크라이브 등 다양한 메시징 패턴을 구현할 수 있다. 고가용성, 페더레이션, 클러스터링을 통해 확장성과 안정성을 보장하며, 금융, IoT, e-commerce 등 다양한 산업에서 사용된다.</p><hr><p>다음 단계로 <strong>2단계: 개념 체계화 및 검증</strong>을 진행하면서 RabbitMQ의 <strong>핵심 개념</strong>을 이론·실무 관점에서 정리하겠습니다.
진행하기 전에, 이번 조사를 <strong>풀 7단계(Phase 1~7)</strong> 전부 작성하는 방식으로 완성할까요, 아니면 <strong>Phase 1~3까지만</strong> 우선 작성할까요?
전체를 작성하면 분량이 상당히 길어집니다.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li>Message-Broker</li><li>Messaging-Queue</li><li>Pub-Sub</li><li>Distributed-Systems</li></ul><hr><h2 id=2-분류-구조-분석-및-평가>2. 분류 구조 분석 및 평가<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석-및-평가>#</a></h2><h3 id=분석-결과>분석 결과<a hidden class=anchor aria-hidden=true href=#분석-결과>#</a></h3><p>현재 “Computer Science and Engineering > Systems and Infrastructure > Infrastructure > Infrastructure Components > Messaging Systems > Implementations > Event Streaming Platforms > Messaging Queue” 구조는 RabbitMQ(래빗MQ)의 역할과 사용 환경을 잘 반영함.<br>RabbitMQ는 대표적인 메시지 브로커이며, 큐 기반 메시징(Messaging Queue, MQ) 솔루션이다. Event Streaming Platform(이벤트 스트리밍 플랫폼)은 Kafka(카프카) 등과 함께 RabbitMQ도 분산 메시지 처리 및 이벤트 기반 시스템 구축에서 활용되기에 넓은 범주상 일치한다.<br>즉, 메시징 시스템 내 구현체(Implementation) 중, 큐 기반 메시징 플랫폼(Messaging Queue)으로 RabbitMQ를 분류하는 패러다임이 현대 실무/이론 모두에 적합하다.</p><hr><h2 id=3-요약-설명-200자-내외>3. 요약 설명 (200자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-설명-200자-내외>#</a></h2><p>RabbitMQ(래빗MQ)는 AMQP(Advanced Message Queuing Protocol) 프로토콜 기반의 오픈소스 분산 메시지 브로커로, 생산자와 소비자 간의 비동기 메시지 전송과 큐잉, 라우팅 등 다양한 메시징 패턴을 지원한다.<br>고가용성, 플러그인 기반 확장성, 다양한 언어·플랫폼 호환성으로 마이크로서비스, 이벤트 기반 시스템 등 많은 인프라의 핵심 메시징 중개자로 활용되고 있다.</p><hr><h2 id=4-개요-250자-내외>4. 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요-250자-내외>#</a></h2><p>RabbitMQ(래빗MQ)는 안정적 메시지 송수신 및 비동기 처리, 유연한 라우팅 기능을 제공하는 오픈소스 메시징 큐 시스템이다.<br>AMQP, MQTT, STOMP 등 표준 프로토콜 지원과 함께 단순 큐잉(Queue)부터 발행/구독(Pub/Sub), 라우터, 딜레이 큐 등 복잡한 메시지 라우팅 패턴을 지원한다.<br>메시지 영속성, 클러스터링, 고가용성 및 보안·모니터링 도구를 통해서 신뢰성 있는 서비스 아키텍처 구축이 가능하다.<br>마이크로서비스, IoT, 실시간 처리, 데이터 연동, 일괄 처리(배치) 등 다양한 현대적 시스템의 기반 인프라로 자리매김했다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><h3 id=이론-및-실무-필수-개념><em>이론 및 실무 필수 개념</em><a hidden class=anchor aria-hidden=true href=#이론-및-실무-필수-개념>#</a></h3><ul><li><strong>RabbitMQ(래빗MQ)</strong>: 분산·클러스터 환경에서도 신뢰성 있게 각종 메시지를 큐잉, 트랜잭션 및 라우팅하는 메시지 브로커.</li><li><strong>AMQP(Advanced Message Queuing Protocol, 고급 메시지 큐 프로토콜)</strong>: RabbitMQ의 핵심 표준 프로토콜로, 메시지 송수신 구조, 교환기(Exchange), 큐(Queue), 바인딩(Binding) 등 메시지 패턴 정의를 뒷받침한다.</li><li><strong>Producer(생산자)</strong>: 메시지를 생성하고 RabbitMQ로 전송하는 서비스 또는 엔드포인트.</li><li><strong>Consumer(소비자)</strong>: 큐나 Exchange에서 메시지를 읽어 처리하는 유닛.</li><li><strong>Exchange(교환기)</strong>: 수신한 메시지를 바인딩/규칙에 따라 큐로 라우팅하는 논리적 엔터티.</li><li><strong>Queue(큐)</strong>: 메시지가 누적되어 소비자가 처리할 때까지 대기하는 저장 공간.</li><li><strong>Routing(라우팅)</strong>: 메시지의 목적지 큐 결정 과정(Direct, Topic, Fanout, Header 등 다양한 패턴)</li><li><strong>Acknowledgement(확인 응답)</strong>: 메시지 손실 방지(신뢰성) 및 중복 방지(트랜잭션) 기능 지원</li></ul><h3 id=실무-연관성-분석-1><em>실무 연관성 분석</em><a hidden class=anchor aria-hidden=true href=#실무-연관성-분석-1>#</a></h3><ul><li>서비스간 결합도 완화, 비동기 처리, 장애 복원·확장성, 트랜잭션 균형 등 다양한 실용적 메시징 요구를 충족.</li><li>실제 프로젝트에서는 MSA(Microservice Architecture) 이벤트 중계, 비동기 태스크 분산, IoT 센서 메시지 처리, Batch 작업 스케줄링 등에서 핵심적.</li><li>메시지 순서 보장, 장애/재전송/영속성, QoS 조절을 위한 ack/buffer/TTL 적용이 매우 중요하다.</li></ul><hr><h2 id=6-세부-분석>6. 세부 분석<a hidden class=anchor aria-hidden=true href=#6-세부-분석>#</a></h2><h3 id=1-배경>1) 배경<a hidden class=anchor aria-hidden=true href=#1-배경>#</a></h3><ul><li>전통적 메시징 시스템(JMS, MSMQ 등) 한계(표준화/호환성, 유연성 부족) 극복 및 분산 환경 대응을 위해 개발됨.</li><li>2007년 Erlang 기반으로 출시되어 현재는 다양한 언어와 인프라에 대응.</li><li>AMQP, MQTT 등 메시징 표준 프로토콜의 폭넓은 채택이 RabbitMQ의 인기, 도입 확산을 견인.</li></ul><h3 id=2-목적-및-필요성>2) 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#2-목적-및-필요성>#</a></h3><ul><li>비동기 처리, 비견고한 네트워크 환경에서의 메시지 신뢰성 확보</li><li>서비스 분리(MSA 등)로 인한 느슨한 결합, 서비스 지연·장애 분화</li><li>Producer/Consumer간 트래픽 부하·처리량 불일치 해소(버퍼, 큐잉)</li><li>대용량 데이터 동기화, 실시간 이벤트 전달, 태스크/작업 처리용 분산 백엔드 구현</li></ul><h3 id=3-주요-기능-및-역할>3) 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#3-주요-기능-및-역할>#</a></h3><ul><li>메시지 큐잉·분배(Queueing, Distributing)</li><li>다양한 라우팅 패턴(Direct, Fanout, Topic, Header)</li><li>메시지 영속화(Persistence) 및 Redeliver(재전송)</li><li>처리 성공/실패 등 ACK/NACK 기반 트랜잭션 제어</li><li>클러스터, 미러 큐(고가용성), 관리 대시보드, 인증/SSL 등 보안</li></ul><h3 id=4-특징>4) 특징<a hidden class=anchor aria-hidden=true href=#4-특징>#</a></h3><ul><li>멀티프로토콜(AQMP, MQTT, STOMP) 지원</li><li>플러그인 기반 아키텍처(모니터링, delay queue 등 용이)</li><li>강력한 호환성 및 다양한 클라이언트 라이브러리(언어/플랫폼별 지원)</li><li>트랜잭션, 메시지 TTL(수명)/Dead Letter Queue(사망 큐) 내장</li><li>분산·클러스터링·고가용성(HA) 지원</li></ul><h3 id=5-핵심-원칙-및-주요-원리>5) 핵심 원칙 및 주요 원리<a hidden class=anchor aria-hidden=true href=#5-핵심-원칙-및-주요-원리>#</a></h3><ul><li><strong>Send→Exchange→Queue→Consumer</strong>의 구조: 메시지는 반드시 Exchange를 통해 큐로 라우팅됨</li><li>Exchange는 바인딩과 라우팅 패턴으로 동작(Direct·Topic·Fanout·Header)</li><li>메시지는 큐에서 대기 후, Consumer의 요청 또는 Pull/Push 모델로 소비됨</li><li>Ack(확인 응답) 메커니즘으로 메시지 유실 방지</li><li>클러스터/미러링으로 장애 복원력 제공</li></ul><h4 id=다이어그램--작동-원리>다이어그램 – 작동 원리<a hidden class=anchor aria-hidden=true href=#다이어그램--작동-원리>#</a></h4><pre class=mermaid>sequenceDiagram
    participant P as Producer(생산자)
    participant E as Exchange(교환기)
    participant Q as Queue(큐)
    participant C as Consumer(소비자)
    P-&gt;&gt;E: 메시지 전송(Publish)
    E-&gt;&gt;Q: 바인딩/라우팅 규칙에 따라 메시지 전달
    Q-&gt;&gt;C: 메시지 전달(Pull/Push)
    C-&gt;&gt;Q: Ack(메시지 처리 완료 응답)
</pre><p><strong>설명</strong><br>생산자는 메시지를 Exchange로 송신, Exchange가 라우팅 규칙에 따라 메시지를 큐로 분배, Consumer가 큐에서 메시지 소비 후 처리 결과를 Ack로 보고.</p><h3 id=6-구조-및-아키텍처>6) 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#6-구조-및-아키텍처>#</a></h3><h4 id=구성요소-1>구성요소<a hidden class=anchor aria-hidden=true href=#구성요소-1>#</a></h4><table><thead><tr><th>구성요소</th><th>필수/선택</th><th>기능/역할</th></tr></thead><tbody><tr><td>Producer</td><td>필수</td><td>메시지 생성 후 Exchange로 송신</td></tr><tr><td>Exchange</td><td>필수</td><td>메시지 라우팅 및 큐 전달</td></tr><tr><td>Queue</td><td>필수</td><td>메시지 임시 저장, 소비자에게 차례로 전달</td></tr><tr><td>Consumer</td><td>필수</td><td>메시지 처리 및 Ack/Nack 반환</td></tr><tr><td>Binding</td><td>필수</td><td>Exchange와 Queue 간 라우팅 규칙 설정</td></tr><tr><td>Message</td><td>필수</td><td>송수신 및 처리 대상이 되는 데이터 단위</td></tr><tr><td>Policy/Plugin</td><td>선택</td><td>큐 정책, 지연 큐, 관리 툴 등 확장/제어</td></tr><tr><td>Management</td><td>선택</td><td>웹 UI, 모니터링 등 관리대시보드, Authentication 등</td></tr><tr><td>Cluster/HA</td><td>선택</td><td>고가용성, 미러큐 구현</td></tr></tbody></table><h4 id=아키텍처-다이어그램>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램>#</a></h4><pre class=mermaid>flowchart LR
    Producer1[Producer]
    Producer2[Producer]
    Exchange[Exchange]
    Queue1[Queue #1]
    Queue2[Queue #2]
    Consumer1[Consumer #1]
    Consumer2[Consumer #2]
    Producer1 --&gt; Exchange
    Producer2 --&gt; Exchange
    Exchange -- Direct/Topic/Fanout/Header --&gt; Queue1
    Exchange -- Direct/Topic/Fanout/Header --&gt; Queue2
    Queue1 --&gt; Consumer1
    Queue2 --&gt; Consumer2
</pre><p><strong>설명</strong><br>Producer가 Exchange로 메시지 전송, Exchange가 규칙(Binding)에 따라 여러 Queue로 메시지 분배, Consumer가 각 큐에서 메시지를 소비, Ack 전송.</p><h4 id=필수선택-구성요소-표>필수/선택 구성요소 표<a hidden class=anchor aria-hidden=true href=#필수선택-구성요소-표>#</a></h4><table><thead><tr><th>구분</th><th>구성 요소</th><th>기능 및 역할</th><th>특징</th></tr></thead><tbody><tr><td>필수</td><td>Producer</td><td>메시지 생산</td><td>서비스/애플리케이션 등</td></tr><tr><td>필수</td><td>Exchange</td><td>메시지 라우팅</td><td>Direct/Topic/Fanout/Headers</td></tr><tr><td>필수</td><td>Queue</td><td>메시지 대기·임시저장</td><td>FIFO 원칙 준수</td></tr><tr><td>필수</td><td>Consumer</td><td>메시지 처리</td><td></td></tr><tr><td>필수</td><td>Binding</td><td>라우팅 규칙</td><td>Exchange-Queue 연결</td></tr><tr><td>선택</td><td>Plugins</td><td>기능 확장</td><td>미러 큐, delay queue 등</td></tr><tr><td>선택</td><td>Management</td><td>운영/보안/모니터링</td><td>웹 UI 및 API</td></tr><tr><td>선택</td><td>Cluster/HA</td><td>고가용성, 미러링</td><td>다중 노드, 장애 복구</td></tr></tbody></table><h3 id=7-구현-기법>7) 구현 기법<a hidden class=anchor aria-hidden=true href=#7-구현-기법>#</a></h3><ul><li><strong>AMQP 기반 송수신</strong>: 표준 클라이언트 라이브러리(Python pika, Node amqplib 등)로 Exchange Publish/Consume 구현</li><li><strong>라우팅 패턴 활용</strong>: Direct(정확한 매칭), Fanout(전체 브로드캐스트), Topic(글로벌 패턴), Headers(헤더값 기준)</li><li><strong>ACK/NACK 사용</strong>: 메시지 신뢰성 보장(acknowledge/on failure 재전송)</li><li><strong>퍼시스턴스 설정</strong>: 영속 메시지, 큐/Exchange durability</li><li><strong>플러그인 연동</strong>: delay queue, 미러 큐, dead-letter queue, 모니터링 등 다양한 플러그인 활용</li></ul><h4 id=예시-시나리오>예시 시나리오<a hidden class=anchor aria-hidden=true href=#예시-시나리오>#</a></h4><ul><li>결제 주문 요청(Producer) → Direct Exchange → ‘order-paid’ Queue → Task Worker(Consumer) → ACK 후 DB 저장</li></ul><h3 id=8-장점>8) 장점<a hidden class=anchor aria-hidden=true href=#8-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>신뢰성</td><td>영속성, ACK/NACK, 재전송으로 데이터 유실 최소화</td></tr><tr><td>장점</td><td>유연성</td><td>다양한 라우팅 패턴, 확장 가능한 큐 설계</td></tr><tr><td>장점</td><td>언어/플랫폼 호환</td><td>다양한 언어, 환경 지원(플러그인, API)</td></tr><tr><td>장점</td><td>관리 용이성</td><td>웹 UI, 정책 관리, 모니터링 툴 내장</td></tr><tr><td>장점</td><td>고가용성</td><td>클러스터링, 미러 큐로 장애 대응 쉽다</td></tr><tr><td>장점</td><td>표준 프로토콜</td><td>AMQP 등 국제 표준 지원</td></tr></tbody></table><h3 id=9-단점과-문제점-그리고-해결방안>9) 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#9-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>대용량 처리 한계</td><td>초대용량·고속 처리(수백MB/s 이상)에 구조적 한계</td><td>Kafka 등 병렬 스트리밍 병행 사용, 클러스터 확장</td></tr><tr><td>단점</td><td>메시지 순서 불보장</td><td>큐/consumer 병렬 동작·ACK 지연시 순서 보장 안됨</td><td>메시지 그룹화·동기화 큐 사용, 설계 시 주의</td></tr><tr><td>단점</td><td>네트워크 자원 사용</td><td>대량 연결/메시지시 브로커 부담 증가</td><td>최적화, 클러스터 노드 분산</td></tr><tr><td>단점</td><td>지연시간</td><td>내부 큐/IO 지연 발생시 응답 지연</td><td>고성능 디스크, 프리페칭(prefetch) 설정</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>메시지 유실</td><td>서버 장애, 미처리 메시지 불안정성</td><td>데이터 손실</td><td>관제 로그, 미처리 큐 확인</td><td>미러 큐, 퍼시스턴스</td><td>장애 브로커 자동 복구, 미러링, requeue</td></tr><tr><td>문제점</td><td>중복처리</td><td>ACK 누락/오류/Consumer 재시작</td><td>반복 처리(중복 결과)</td><td>로그 및 Broker 상태</td><td>idempotent 설계, ACK 최적화</td><td>Producer, Consumer 중복방지 설계</td></tr><tr><td>문제점</td><td>큐 적체</td><td>Consumer 속도 느림, 임계치 초과</td><td>처리 지연, 리소스 부족</td><td>대시보드 모니터링</td><td>Consumer 증설, prefetch 조정</td><td>워커 수 확장, 큐 분리</td></tr><tr><td>문제점</td><td>보안 취약</td><td>인증·암호화 미설정</td><td>정보 유출</td><td>보안 모니터링 도구</td><td>SSL/TLS 적용</td><td>IP 화이트리스트, 정책 강화</td></tr></tbody></table><h3 id=10-도전-과제>10) 도전 과제<a hidden class=anchor aria-hidden=true href=#10-도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 방법</th></tr></thead><tbody><tr><td>확장성</td><td>초대용량 처리</td><td>단일 큐, 브로커 한계</td><td>성능저하, 지연</td><td>리소스 모니터링</td><td>큐 분산, 파티셔닝</td><td>Kafka 등 보완 도입</td></tr><tr><td>신뢰성</td><td>장애대응 자동화</td><td>수동 Failover 구조</td><td>다운타임 확대</td><td>클러스터 진단</td><td>자동대응 툴</td><td>오케스트레이션</td></tr><tr><td>통합</td><td>이기종 시스템과 연동</td><td>다양한 프로토콜 필요</td><td>비용·복잡성 증가</td><td>커넥터 상태 추적</td><td>공통 표준 적용</td><td>plugin 연동, Event Mesh</td></tr></tbody></table><h3 id=11-분류-기준에-따른-종류-및-유형>11) 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#11-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>라우팅 패턴</td><td>Direct Exchange</td><td>라우팅 키로 큐 매핑 (포인트 투 포인트)</td></tr><tr><td>라우팅 패턴</td><td>Fanout Exchange</td><td>바운드된 모든 큐로 메시지 브로드캐스트</td></tr><tr><td>라우팅 패턴</td><td>Topic Exchange</td><td>패턴, 와일드카드 기반 동적 라우팅</td></tr><tr><td>라우팅 패턴</td><td>Headers Exchange</td><td>헤더 값 기반 라우팅</td></tr><tr><td>인프라 구조</td><td>단일 노드</td><td>개발, 소규모 테스트용 단일 서버</td></tr><tr><td>인프라 구조</td><td>클러스터/미러 큐(HA)</td><td>고가용성·장애 복원용 멀티노드</td></tr><tr><td>배포 형태</td><td>온프렘(자체 구축)</td><td>온프레미스, 내부 서버</td></tr><tr><td>배포 형태</td><td>클라우드 매니지드</td><td>AWS MQ 등 관리형 서비스</td></tr><tr><td>프로토콜</td><td>AMQP</td><td>표준 큐잉 프로토콜 지원</td></tr><tr><td>프로토콜</td><td>MQTT, STOMP</td><td>IoT, 웹 등 용도별 프로토콜 선택</td></tr></tbody></table><h3 id=12-실무-사용-예시>12) 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#12-실무-사용-예시>#</a></h3><table><thead><tr><th>활용 분야</th><th>결합 시스템</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>주문/결제 시스템</td><td>Spring, NodeJS, DB</td><td>주문 알림, 이벤트 동기화</td><td>실시간 프로세스 균형, 장애 격리</td></tr><tr><td>비동기 태스크 처리</td><td>Celery, Python, API</td><td>대용량 작업 분산 처리</td><td>빠른 응답, 처리 서버 부하 분산</td></tr><tr><td>IoT 메시지 송수신</td><td>MQTT, Web, DB</td><td>센서 데이터 유입 및 분석</td><td>실시간 이벤트 처리, 데이터 누락 방지</td></tr><tr><td>로그 집계/분배</td><td>Fluentd, Filebeat</td><td>다양한 서비스 로그 연계</td><td>연동 시스템 표준화, 분석 촉진</td></tr></tbody></table><h3 id=13-활용-사례>13) 활용 사례<a hidden class=anchor aria-hidden=true href=#13-활용-사례>#</a></h3><h4 id=비동기-주문-처리---결제-시스템-예시>[비동기 주문 처리 - 결제 시스템 예시]<a hidden class=anchor aria-hidden=true href=#비동기-주문-처리---결제-시스템-예시>#</a></h4><p><strong>시스템 구성</strong></p><ul><li>주문(웹/앱) Producer ⇒ RabbitMQ [Exchange/Queue] ⇒ 비동기 태스크 Consumer(결제, 이메일 알림 등)</li></ul><h4 id=구성-다이어그램>구성 다이어그램<a hidden class=anchor aria-hidden=true href=#구성-다이어그램>#</a></h4><pre class=mermaid>flowchart LR
    App[Order API/Producer]
    Ex[Exchange]
    Q[Order Queue]
    Worker[Consumer(Worker)]
    DB[DB/알림/이메일]

    App --&gt; Ex
    Ex --&gt; Q
    Q --&gt; Worker
    Worker --&gt; DB
</pre><p><strong>설명</strong><br>주문 발생시, Producer가 Exchange에 메시지 발행, Exchange가 라우팅 규칙에 따라 Order Queue로 전달, Worker Consumer가 큐 잔여 메시지 처리.</p><h4 id=workflow>Workflow<a hidden class=anchor aria-hidden=true href=#workflow>#</a></h4><ol><li>주문 요청 발생 → Exchange publish</li><li>라우팅 바인딩 적용, 큐에 적재</li><li>Consumer가 메시지 poll, ACK 후 응답</li><li>주문 처리, 결제 API/DB/이메일 연계</li></ol><h4 id=rabbitmq-유무-차이>RabbitMQ 유무 차이<a hidden class=anchor aria-hidden=true href=#rabbitmq-유무-차이>#</a></h4><ul><li>사용: 부하 분산·장애 분리, 처리 지연 최소화, 메시지 유실 방지</li><li>미사용: 결합도 및 장애 파급, 대량 트래픽시 전체 장애 위험</li></ul><h3 id=14-구현-예시-python-pika-예시>14) 구현 예시 (Python pika 예시)<a hidden class=anchor aria-hidden=true href=#14-구현-예시-python-pika-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-87-1><a class=lnlinks href=#hl-87-1> 1</a>
</span><span class=lnt id=hl-87-2><a class=lnlinks href=#hl-87-2> 2</a>
</span><span class=lnt id=hl-87-3><a class=lnlinks href=#hl-87-3> 3</a>
</span><span class=lnt id=hl-87-4><a class=lnlinks href=#hl-87-4> 4</a>
</span><span class=lnt id=hl-87-5><a class=lnlinks href=#hl-87-5> 5</a>
</span><span class=lnt id=hl-87-6><a class=lnlinks href=#hl-87-6> 6</a>
</span><span class=lnt id=hl-87-7><a class=lnlinks href=#hl-87-7> 7</a>
</span><span class=lnt id=hl-87-8><a class=lnlinks href=#hl-87-8> 8</a>
</span><span class=lnt id=hl-87-9><a class=lnlinks href=#hl-87-9> 9</a>
</span><span class=lnt id=hl-87-10><a class=lnlinks href=#hl-87-10>10</a>
</span><span class=lnt id=hl-87-11><a class=lnlinks href=#hl-87-11>11</a>
</span><span class=lnt id=hl-87-12><a class=lnlinks href=#hl-87-12>12</a>
</span><span class=lnt id=hl-87-13><a class=lnlinks href=#hl-87-13>13</a>
</span><span class=lnt id=hl-87-14><a class=lnlinks href=#hl-87-14>14</a>
</span><span class=lnt id=hl-87-15><a class=lnlinks href=#hl-87-15>15</a>
</span><span class=lnt id=hl-87-16><a class=lnlinks href=#hl-87-16>16</a>
</span><span class=lnt id=hl-87-17><a class=lnlinks href=#hl-87-17>17</a>
</span><span class=lnt id=hl-87-18><a class=lnlinks href=#hl-87-18>18</a>
</span><span class=lnt id=hl-87-19><a class=lnlinks href=#hl-87-19>19</a>
</span><span class=lnt id=hl-87-20><a class=lnlinks href=#hl-87-20>20</a>
</span><span class=lnt id=hl-87-21><a class=lnlinks href=#hl-87-21>21</a>
</span><span class=lnt id=hl-87-22><a class=lnlinks href=#hl-87-22>22</a>
</span><span class=lnt id=hl-87-23><a class=lnlinks href=#hl-87-23>23</a>
</span><span class=lnt id=hl-87-24><a class=lnlinks href=#hl-87-24>24</a>
</span><span class=lnt id=hl-87-25><a class=lnlinks href=#hl-87-25>25</a>
</span><span class=lnt id=hl-87-26><a class=lnlinks href=#hl-87-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python pika를 사용한 RabbitMQ 메시지 송신/수신 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Producer : 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;direct&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;pay&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;pay&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=s1>&#39;pay for order#1001&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;메시지 전송 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Consumer : 메시지 수신</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;수신 메시지: </span><span class=si>{</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># (처리 코드 삽입, 처리 성공 시 ack)</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Consumer 대기 중...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>각 코드는 메시지 송수신 및 큐, Exchange, ACK 등 RabbitMQ MQ의 주요 흐름·구조 반영.</p></blockquote><h3 id=15-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>15) 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#15-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>내용</th><th>권장사항</th></tr></thead><tbody><tr><td>큐 설계</td><td>큐/Exchange/라우팅키 설계 적정성</td><td>메시지 흐름 분석 및 계층별 설계</td></tr><tr><td>영속성 및 HA</td><td>장애 대비, 퍼시스턴스/미러 큐 적용 여부</td><td>Durable 큐, 미러링 활성화</td></tr><tr><td>모니터링</td><td>큐 길이, 처리현황 상시 모니터</td><td>대시보드, 알림 도구 연동</td></tr><tr><td>사망 큐, TTL</td><td>유실, 적체 방지</td><td>Dead Letter Queue, TTL 정책 적용</td></tr><tr><td>보안</td><td>SSL/인증/권한 관리 강화</td><td>암호화, 사용자, 정책 분리</td></tr></tbody></table><h3 id=16-최적화-고려사항-및-주의할-점>16) 최적화 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#16-최적화-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>내용</th><th>권장사항</th></tr></thead><tbody><tr><td>prefetch 설정</td><td>Consumer가 처리 가능한 메시지 수 최적화</td><td>처리능력 고려 prefetch count 적용</td></tr><tr><td>큐 분산</td><td>대용량 데이터/부하 분산</td><td>여러 큐·Exchange 설계 활용</td></tr><tr><td>퍼시스턴스 정책</td><td>디스크/메모리/네트워크 균형</td><td>Durability, Lazy Queue 등 조정</td></tr><tr><td>ack/nack 전략</td><td>중복/누락 방지, 재시도 방안</td><td>정확한 ack, 적절한 error handling</td></tr><tr><td>클러스터 구성</td><td>노드간 리소스 분산/복제 유지</td><td>Node balance, HA proxy 적용</td></tr></tbody></table><hr><h2 id=9-주목할-내용-요약>9. 주목할 내용 요약<a hidden class=anchor aria-hidden=true href=#9-주목할-내용-요약>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>이론</td><td>메시징 패턴</td><td>큐/Exchange 구조</td><td>RabbitMQ 기본 원리</td></tr><tr><td>실무</td><td>신뢰성/확장</td><td>영속·HA/미러 큐</td><td>장애대응·서비스 확장 근간</td></tr><tr><td>통합</td><td>멀티프로토콜</td><td>AMQP, MQTT 등</td><td>이기종·IoT 연동 등 유연성</td></tr><tr><td>최적화</td><td>운영/모니터링</td><td>대시보드/지표</td><td>실시간 운영 안정성</td></tr></tbody></table><hr><h2 id=10-반드시-학습해야-할-내용>10. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#10-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본</td><td>AMQP</td><td>메시징 구조/프로토콜</td><td>Exchange, Queue, Binding 원리</td></tr><tr><td>구조</td><td>Exchange 종류</td><td>Direct/Topic/Fanout 등의 라우팅 원리</td><td></td></tr><tr><td>운영</td><td>고가용성(HA)</td><td>미러 큐, 클러스터링</td><td>장애시 처리 및 복구</td></tr><tr><td>보안</td><td>인증·암호화</td><td>SSL, 권한관리</td><td>실서비스 환경 준비</td></tr><tr><td>통합</td><td>플러그인 관리</td><td>delay queue, monitoring 등 연동</td><td></td></tr></tbody></table><hr><h2 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>메시징</td><td>AMQP(Advanced Message Queuing Protocol)</td><td>표준 메시지 큐잉 프로토콜, RabbitMQ 핵심 프로토콜</td></tr><tr><td>메시징</td><td>Exchange(교환기)</td><td>큐로 라우팅 담당 논리적 엔터티, 여러 유형 존재</td></tr><tr><td>메시징</td><td>Queue(큐)</td><td>메시지 대기 및 임시 저장 구조</td></tr><tr><td>메시징</td><td>Routing Key(라우팅 키)</td><td>메시지 라우팅을 위한 식별자</td></tr><tr><td>메시징</td><td>Ack/Nack(확인/실패 응답)</td><td>처리 성공/실패 통보 신호</td></tr><tr><td>아키텍처</td><td>미러 큐(Mirror Queue)</td><td>고가용성 위해 복제 적용된 큐</td></tr><tr><td>아키텍처</td><td>Dead Letter Queue(사망 큐)</td><td>실패, 만료 메시지 격리 큐</td></tr><tr><td>운영</td><td>Prefetch</td><td>Consumer가 한 번에 미리 받을 메시지 수</td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서</a></li><li><a href=https://www.rabbitmq.com/getstarted.html>RabbitMQ의 구성 및 사용방법</a></li><li><a href=https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol>AMQP 위키피디아 소개</a></li><li><a href=https://www.rabbitmq.com/clustering.html>RabbitMQ Cluster/HA 공식 가이드</a></li><li><a href=https://www.confluent.io/blog/kafka-fastest-messaging-system/>RabbitMQ, Kafka, SQS 비교 - Confluent Docs</a></li></ul><p>아래는 <strong>RabbitMQ</strong>에 대한 심도 있는 정리 첫 번째 부분입니다. 진행한 항목은 다음과 같습니다:</p><hr><h2 id=1--태그>1. 🏷️ 태그<a hidden class=anchor aria-hidden=true href=#1--태그>#</a></h2><ul><li><strong>Message-Broker</strong></li><li><strong>AMQP-Queue</strong></li><li><strong>Distributed-Messaging</strong></li><li><strong>High-Availability</strong></li></ul><hr><h2 id=2-분류-구조-분석>2. 분류 구조 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-분석>#</a></h2><p>현재 구조:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-88-1><a class=lnlinks href=#hl-88-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Infrastructure Components &gt; Messaging Systems &gt; Implementations &gt; Event Streaming Platforms &gt; Messaging Queue
</span></span></code></pre></td></tr></table></div></div><p>RabbitMQ는 **메시지 브로커(큐 기반)**로 분류된 구조에 적합하며, AMQP 지원, 고가용성, 클러스터링 기능을 포함하므로 해당 분류 구조는 <strong>정확히 적절</strong>하다고 판단됩니다.</p><hr><h2 id=3-요약-200자>3. 요약 (≈200자)<a hidden class=anchor aria-hidden=true href=#3-요약-200자>#</a></h2><p>RabbitMQ는 AMQP 기반의 오픈소스 메시 브로커로, Producer에서 보낸 메시지를 Exchange→Queue 형태로 라우팅한 후 Consumer에게 전달합니다. 클러스터링, 미러/쿼럼 큐, 퍼블리셔 확인(Publisher Confirms), 소비자 ACK, Dead-Letter, TTL 등 고급 안정성 기능을 제공하며, 다중 언어·프로토콜 지원과 확장성 덕분에 분산 시스템 통합과 비동기 처리에 폭넓게 사용됩니다. (<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">위키백과</a>)</p><hr><h2 id=4-개요-250자>4. 개요 (≈250자)<a hidden class=anchor aria-hidden=true href=#4-개요-250자>#</a></h2><p>RabbitMQ는 신뢰성 높은 비동기 메시징 시스템으로, Publisher가 보낸 메시지를 교환기(Exchange)를 통해 다양한 유형의 큐로 라우팅하고, Consumer는 이를 받아 처리합니다. AMQP 0-9-1 표준을 기반으로 다채로운 Exchange(Formats): Direct, Topic, Fanout, Headers를 지원하며, HA 큐(미러링 및 쿼럼), 클러스터링, 퍼블리셔 확인, ACK/NACK, Dead-Letter, TTL 같은 메시지 안전성 기능을 포괄합니다. 또한 HA 클러스터와 재난복구 설계를 위한 Federation 및 Shovel 플러그인을 지원하여 글로벌 분산 환경에서도 사용이 적합합니다. (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>)</p><hr><h2 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h2><p>다음은 RabbitMQ의 핵심 개념 정리입니다:</p><ul><li><strong>Producer</strong>: 메시지를 생성하여 Exchange에 발행 (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">Medium</a>)</li><li><strong>Exchange</strong>: 메시지를 여러 큐에 라우팅하는 핵심 로직. Direct, Fanout, Topic, Headers 타입 (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>)</li><li><strong>Binding</strong>: Exchange와 Queue 간 라우팅 규칙. Routing Key 또는 Headers를 기준으로 설정 (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>)</li><li><strong>Queue</strong>: FIFO 메시지 저장소. Classic, Mirrored, Quorum, Stream 유형 지원 (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">CloudAMQP</a>)</li><li><strong>Consumer</strong>: 메시지를 Queue에서 받아 처리하고 ACK/NACK 전송</li><li><strong>Connection & Channel</strong>: TCP 연결 하나에 여러 채널을 통해 경량 통신 (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">Medium</a>)</li><li><strong>Virtual Host</strong>: 리소스와 권한의 격리 단위 (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">Medium</a>)</li><li><strong>Publisher Confirms</strong>: 퍼블리셔 측에서 Publish 성공 여부 확인 기능 (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">RabbitMQ</a>)</li><li><strong>ACK/NACK</strong>: Consumer 처리 확인 또는 재전송 요청 (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>)</li><li><strong>Mirrored & Quorum Queues</strong>: 고가용성 위한 큐 복제 방식. Mirrored는 다중 노드 동기복제, Quorum은 Raft 기반 복제 (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">CloudAMQP</a>)</li><li><strong>Dead-Letter Queue (DLQ)</strong>: 처리 실패 메시지를 재분류·관찰하기 위한 대체 큐 (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">위키백과</a>)</li><li><strong>Federation & Shovel</strong>: 멀티 클러스터 간 메시지 공유 및 전송 플러그인 (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">RabbitMQ</a>)</li></ul><h3 id=51-실무-연관성>5.1 실무 연관성<a hidden class=anchor aria-hidden=true href=#51-실무-연관성>#</a></h3><ul><li><strong>비동기 태스크 처리</strong>: 리소스 소비 작업(이미지 처리, 이메일 발송 등)을 백그라운드로 처리하여 응답 시간 단축</li><li><strong>마이크로서비스 간 통신</strong>: 비동기·신뢰성 기반의 서비스 간 메시징 구현</li><li><strong>안정성 강화</strong>: 메시지 영속성과 확인/재전송, DLQ 등을 통한 장애 회복 및 데이터 유실 방지</li><li><strong>HA 및 DR</strong>: 클러스터링·미러/쿼럼 큐 등으로 클러스터 내·외 복제 및 장애 대비</li></ul><hr><p>다음에는 <strong>배경, 목적 및 필요성</strong>, <strong>주요 기능 및 역할</strong>, <strong>특징</strong>, <strong>운영 원리 및 구조·아키텍처</strong>—특히 클러스터·큐 유형 포함한 다이어그램—으로 이어가겠습니다. 어떤 부분부터 더 깊게 분석해드릴까요?</p><hr><h2 id=6-배경-및-목적필요성-background--purpose>6. 배경 및 목적·필요성 (Background & Purpose)<a hidden class=anchor aria-hidden=true href=#6-배경-및-목적필요성-background--purpose>#</a></h2><p><strong>배경</strong>
RabbitMQ는 2007년 Erlang 기반으로 개발된 오픈소스 메시지 브로커로, AMQP(Advanced Message Queuing Protocol) 0-9-1 표준을 구현한 대표적인 시스템입니다. 당시 배치 중심의 시스템 통합 방식은 동기적 의존성과 지연 문제로 인해 마이크로서비스, IoT 등 분산 환경에서는 한계가 있었습니다. RabbitMQ는 이러한 문제를 해결하고자 비동기 메시징, 고가용성, 확장성을 제공하며 운영되었습니다 (<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">Confluent</a>).</p><p><strong>목적 및 필요성</strong></p><ul><li><strong>비동기 통합</strong>: Producer와 Consumer의 느슨한 결합으로 리소스 부담 최소화</li><li><strong>신뢰성 보장</strong>: 퍼블리셔 확인, ACK/NACK, DLQ 등 내결함성 및 복구 메커니즘 제공 (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>Lumigo</a>)</li><li><strong>라우팅 유연성</strong>: Exchange와 Binding을 통해 Direct, Topic, Fanout, Headers 등 다양한 패턴 지원 (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">CloudAMQP</a>)</li><li><strong>확장성·HA</strong>: 클러스터링 및 미러/쿼럼 큐로 고가용성과 장애 복구 구성 (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">RabbitMQ</a>)</li></ul><hr><h2 id=7-주요-기능-및-역할-key-functions--roles>7. 주요 기능 및 역할 (Key Functions & Roles)<a hidden class=anchor aria-hidden=true href=#7-주요-기능-및-역할-key-functions--roles>#</a></h2><table><thead><tr><th>기능</th><th>설명</th></tr></thead><tbody><tr><td><strong>Exchange 라우팅</strong></td><td>Direct, Fanout, Topic, Headers를 통한 메시지 정밀 분배 (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">RabbitMQ</a>)</td></tr><tr><td><strong>메시지 영속성</strong></td><td>Durable 메시지 저장 옵션 및 클러스터 고가용성 보장</td></tr><tr><td><strong>퍼블리셔 확인</strong></td><td>메시지 정상 발행 시 확인(Ack) 받아 신뢰성 확보</td></tr><tr><td><strong>Consumer ACK/NACK</strong></td><td>소비 성공·실패 제어 및 재처리 처리 가능</td></tr><tr><td><strong>Dead‑Letter Queue</strong></td><td>처리 실패 메시지 별도 저장 및 분석</td></tr><tr><td><strong>TTL 설정</strong></td><td>메시지 및 큐에 시간 제한 적용 및 자동 삭제</td></tr><tr><td><strong>클러스터링 / HA 큐</strong></td><td>노드 장애 대응, 데이터 복제, 장애 복구 지원</td></tr><tr><td><strong>플러그인 기능</strong></td><td>Federation, Shovel, MQTT/STOMP 등 프로토콜 확장 플러그인</td></tr></tbody></table><hr><h2 id=8-특징-characteristics>8. 특징 (Characteristics)<a hidden class=anchor aria-hidden=true href=#8-특징-characteristics>#</a></h2><ol><li><p><strong>AMQP 표준 준수</strong>
RabbitMQ는 AMQP 0-9-1을 완전 지원하며, AMQP 1.0, MQTT, STOMP 등 다양한 프로토콜도 플러그인 형태로 지원 (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">위키백과</a>).</p></li><li><p><strong>라우팅 유연성</strong>
Exchange와 Binding을 자유롭게 설정해 복잡한 메시징 패턴을 손쉽게 구성 가능 (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">CloudAMQP</a>).</p></li><li><p><strong>ACK/NACK 기반 신뢰성 처리</strong>
퍼블리셔와 소비자 양측의 ACK 체계를 통해 안정적인 메시지 처리 보장 .</p></li><li><p><strong>HA 및 클러스터링 지원</strong>
미러/쿼럼 큐 기반으로 노드 장애 발생 시 자동 전환 및 복제 구조 유지 (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">RabbitMQ</a>).</p></li><li><p><strong>확장성과 다양한 클라우드·컨테이너 환경</strong>
도커 및 쿠버네티스 환경에서도 쉽게 배포 가능하며 다양한 Discovery 방법을 통한 노드 구성 지원 (<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">Confluent</a>).</p></li><li><p><strong>플러그인 기반 확장성</strong>
Federation, Shovel, Management UI 등 다양한 기능 추가 가능 (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">위키백과</a>).</p></li></ol><hr><h2 id=9-핵심-원칙-core-principles>9. 핵심 원칙 (Core Principles)<a hidden class=anchor aria-hidden=true href=#9-핵심-원칙-core-principles>#</a></h2><ul><li><strong>메시지 라우팅 분리(Domain Decoupling)</strong>: Exchange와 Queue 간 경로 분리를 통해 시스템 간 LOOSLY-COUPLED 통신 구현.</li><li><strong>ACK 기반 신뢰성</strong>: ACK/NACK를 통한 신뢰성과 정확한 전송.</li><li><strong>영속성과 내구성</strong>: Durable 옵션으로 메시지 유실 없이 디스크 저장.</li><li><strong>고가용성 우선 설계</strong>: 미러/쿼럼 큐와 클러스터링을 통한 장애 대비.</li><li><strong>플러그인 아키텍처</strong>: 유연한 확장성 제공, 특정 기능 도입 적용 용이.</li></ul><hr><h2 id=10-작동-원리-및-방식-operational-flow>10. 작동 원리 및 방식 (Operational Flow)<a hidden class=anchor aria-hidden=true href=#10-작동-원리-및-방식-operational-flow>#</a></h2><pre class=mermaid>flowchart LR
  Producer --&gt;|Publish| Exchange
  Exchange --&gt;|Routing| Queue1
  Exchange --&gt;|Routing| Queue2
  Queue1 --&gt; Consumer1
  Queue2 --&gt; Consumer2
  Consumer1 --&gt;|ACK| Broker
  Consumer2 --&gt;|NACK/DLQ| DeadLetterQueue
</pre><ol><li>Producer가 Exchange에 메시지 발행</li><li>Exchange가 Binding 규칙에 따라 메시지 전달</li><li>Consumer가 메시지를 처리하고 ACK/NACK 전송</li><li>NACK 시 메시지는 DLQ로 이동, ACK 시 처리 완료</li></ol><hr><p>다음 단계는 <strong>구조·아키텍처</strong>, <strong>구현 기법</strong>, <strong>장단점</strong>, <strong>실무 사례</strong> 등으로 이어집니다. 원하시는 항목부터 말씀해 주세요!</p><hr><h2 id=11-구조-및-아키텍처-architecture--components>11. 구조 및 아키텍처 (Architecture & Components)<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처-architecture--components>#</a></h2><pre class=mermaid>graph TD
  subgraph Cluster[RabbitMQ Cluster]
    N1[Node1] &amp; N2[Node2] &amp; N3[Node3]
  end
  subgraph Logical
    Exchange --&gt; Queue
  end
  Producer --&gt; Exchange
  Exchange --&gt; N1
  Exchange --&gt; N2
  Exchange --&gt; N3
  Queue:::ha --&gt; Consumer
  Queue:::dlq --&gt; DeadLetterQueue
  style Queue:::ha fill:#def
  style Queue:::dlq fill:#fdd
</pre><h3 id=필수-구성-요소>필수 구성 요소<a hidden class=anchor aria-hidden=true href=#필수-구성-요소>#</a></h3><ul><li><strong>Node (브로커)</strong>: Erlang 기반 RabbitMQ 인스턴스들로 구성된 클러스터. 노드 간 메시지·Exchange·Binding 등의 메타데이터 공유 (<a href="https://www.rabbitmq.com/docs/specification?utm_source=chatgpt.com" title="Compatibility and Conformance">RabbitMQ</a>).</li><li><strong>Exchange</strong>: Direct, Fanout, Topic, Headers 유형을 사용해 메시지 라우팅 역할 수행 .</li><li><strong>Queue (Classic, Mirrored, Quorum)</strong>: 메시지 저장소로, 미러/쿼럼 큐는 장애 대응용 복제를 제공 (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>).</li><li><strong>Binding</strong>: Exchange → Queue 간 라우팅 룰 표현 (routing key, header 기준) (<a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange?utm_source=chatgpt.com" title="RabbitMQ Consistent Hash Exchange Type">DevOps.dev</a>).</li><li><strong>Connection & Channel</strong>: TCP 연결 위에 다수의 채널 활용해 경량 통신 구현 .</li><li><strong>DLQ (Dead-Letter Queue)</strong>: 처리 실패 메시지 저장 및 분석용 (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">위키백과</a>).</li></ul><h3 id=선택-구성-요소>선택 구성 요소<a hidden class=anchor aria-hidden=true href=#선택-구성-요소>#</a></h3><ul><li><strong>Federation & Shovel</strong>: 클러스터 간 메시지 공유/전송 (멀티 리전 지원) (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>).</li><li><strong>Plugins (MQTT, STOMP)</strong>: 다양한 프로토콜 지원 및 기능 확장 (<a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">위키백과</a>).</li><li><strong>Kubernetes Operator</strong>: 클러스터 배포/관리를 위한 자동화 장치 (<a href="https://www.rabbitmq.com/docs/quorum-queues?utm_source=chatgpt.com" title="Quorum Queues">InfraCloud</a>).</li></ul><hr><h2 id=12-구현-기법-implementation-techniques>12. 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#12-구현-기법-implementation-techniques>#</a></h2><ol><li><p><strong>Publisher Confirms</strong></p><ul><li>발행 시 <code>confirmSelect()</code> 설정 후 싱크/비동기로 <code>basicAck</code> 수신 (<a href="https://www.rabbitmq.com/docs/stream?utm_source=chatgpt.com" title="Stream Plugin">RabbitMQ</a>).</li><li>개별, 배치, 콜백 기반 방식 제공하며, 배치 방식은 처리량 향상에 유리 .</li></ul></li><li><p><strong>Consumer ACK/NACK & 재시도</strong></p><ul><li><code>autoAck=false</code> 설정 후 수동으로 <code>ack</code>, 실패 시 <code>nack</code>, 처리 불가 시 DLQ 적용 (<a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/?utm_source=chatgpt.com" title="RabbitMQ Stream Java Client - GitHub Pages">RabbitMQ</a>).</li></ul></li><li><p><strong>미러/쿼럼 큐 구성</strong></p><ul><li>레거시 클러스터링: Mirrored 큐 (AP/CP 구성 선택 가능)</li><li>최신 방식: Quorum 큐 (Raft 기반 CP 방식, 과반 복제 보장) (<a href="https://www.rabbitmq.com/docs/exchanges?utm_source=chatgpt.com" title=Exchanges>RabbitMQ</a>, <a href="https://www.rabbitmq.com/docs/confirms?utm_source=chatgpt.com" title="Consumer Acknowledgements and Publisher Confirms">ScaleGrid</a>).</li></ul></li><li><p><strong>클러스터 노드 구성</strong></p><ul><li>최소 3노드 권장, AZ 내 배포, 랙 인식 통한 장애권 분리 고려 .</li></ul></li><li><p><strong>Federation & Shovel</strong></p><ul><li>멀티 클러스터 메시지 연동을 위한 비동기 전송 방식 .</li></ul></li></ol><hr><h2 id=13-장점-advantages>13. 장점 (Advantages)<a hidden class=anchor aria-hidden=true href=#13-장점-advantages>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>표준 AMQP 준수</strong></td><td>다양한 언어·프로토콜 지원</td></tr><tr><td></td><td><strong>라우팅 유연성</strong></td><td>Exchange 유형으로 다양한 패턴 구성 가능</td></tr><tr><td></td><td><strong>신뢰성 확보</strong></td><td>Publisher Confirms, ACK/NACK, DLQ 등</td></tr><tr><td></td><td><strong>고가용성</strong></td><td>클러스터링 + 복제 큐로 장애耐性</td></tr><tr><td></td><td><strong>확장성</strong></td><td>Channel, 노드 수 확장으로 처리량 향상</td></tr><tr><td></td><td><strong>플러그인 기반 확장</strong></td><td>MQTT, STOMP, Federation, Shovel 등</td></tr></tbody></table><hr><h2 id=14-단점-및-문제점-disadvantages--issues>14. 단점 및 문제점 (Disadvantages & Issues)<a hidden class=anchor aria-hidden=true href=#14-단점-및-문제점-disadvantages--issues>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>메모리 자원 요구</strong></td><td>오브젝트 기반 Erlang 구조로 소비자 수 많을 경우 과부하</td><td>Lazy Queue, 채널 수 제한 설정 (<a href="https://www.rabbitmq.com/docs/management?utm_source=chatgpt.com" title="Management Plugin">Stack Overflow</a>, <a href="https://www.rabbitmq.com/docs/ssl?utm_source=chatgpt.com" title="TLS Support">Jack Vanlightly</a>, <a href="https://www.rabbitmq.com/docs/classic-queues?utm_source=chatgpt.com" title="Classic Queues">위키백과</a>, <a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">CloudAMQP</a>)</td></tr><tr><td></td><td><strong>멀티 데이터센터 클러스터링 제한</strong></td><td>WAN 환경에서는 분리된 클러스터 구성이 권장됨</td><td>Federation, Shovel로 대체</td></tr><tr><td></td><td><strong>운영 설정 복잡</strong></td><td>클러스터 정책, HA 큐 타입, Binding 구성 등</td><td>클라우드 Operator 또는 관리 UI 활용</td></tr></tbody></table><h3 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 방법</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td><strong>백프레셔(지연)</strong></td><td>긴 큐, 느린 Consumer</td><td>지연 증가, 처리량 저하</td><td>큐 길이 모니터링</td><td>퀘이 시스템 최적화, Lazy 큐 사용 (<a href="https://www.rabbitmq.com/blog/2025/04/04/new-k8s-peer-discovery?utm_source=chatgpt.com" title="RabbitMQ 4.1: New Kubernetes Peer Discovery Mechanism">CloudAMQP</a>)</td><td>Consumer 병렬화, prefetch 조정</td></tr><tr><td></td><td><strong>메시지 누락 가능성</strong></td><td>퍼블리셔 Publish 실패 후 ack 없음</td><td>데이터 유실</td><td>Publisher Confirm 모니터링</td><td>confirm 사용, 배치 기반 발행</td><td>배치 재시도, 로그 기반 재발행</td></tr><tr><td></td><td><strong>노드 장애 시 데이터 손실</strong></td><td>비동기 Mirrored 큐 또는 불완전 복제</td><td>일부 메시지 유실</td><td>Replica 상태 탐지</td><td>Quorum 큐, 과반 복제 구성</td><td>Quorum 기반 교체, 정책 점검</td></tr><tr><td></td><td><strong>클러스터 균열(splits)</strong></td><td>장애 후 재조인 처리 지연</td><td>split-brain 상황 발생</td><td>클러스터 상태 모니터링</td><td>노드 수 홀짝 구성, 랙 인식 구성</td><td>클러스터 재구성 및 동기 복구</td></tr></tbody></table><hr><p>다음으로 <strong>도전 과제</strong>, <strong>분류 기준에 따른 유형</strong>, <strong>실무 예시 및 활용 사례</strong>, <strong>구현 예시 코드</strong>, <strong>최적화/고려사항</strong>, <strong>용어 정리</strong>, <strong>참고 자료</strong>를 이어서 작업할 수 있습니다. 진행하길 원하시는 섹션을 말씀해 주세요!</p><p>알겠습니다! 이어서 <strong>15. 도전 과제</strong>, <strong>16. 분류 기준에 따른 종류 및 유형</strong>, <strong>17. 실무 사용 예시</strong>, <strong>18. 활용 사례</strong>, <strong>19. 구현 예시</strong>, <strong>20–22. 실무 적용 고려사항 및 최적화</strong>, 그리고 <strong>용어 정리</strong>와 <strong>참고 자료</strong> 순으로 정리합니다.</p><hr><h2 id=15-도전-과제-challenges>15. 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#15-도전-과제-challenges>#</a></h2><table><thead><tr><th>카테고리</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>성능 한계</td><td>메모리·채널 소모 과다</td><td>다수 Consumer/채널, Prefetch 미조정</td><td>브로커 OOM, 응답 지연</td><td>Erlang VM 지표, Channel/GCTime 확인</td><td>채널 수 제한, prefetch 설정</td><td>Lazy Queue, Consumer 스레드 조정</td></tr><tr><td>HA 구성</td><td>멀티 DC 동기복제 어려움</td><td>네트워크 지연, RabbitMQ 클러스터 자체 지원 한계</td><td>메시지 일관성·가용성 저해</td><td>Federation Shovel 지연 모니터링</td><td>WAN 큐 분리, 교차 DC 원칙 적용</td><td>Federation, Shovel, Quorum 큐 도입</td></tr><tr><td>데이터 무결성</td><td>퍼블리셔 실패 후 ACK 누락</td><td>비동기 발행, Publisher Confirms 미사용</td><td>메시지 손실 가능성</td><td>Confirm ack 누락, 로그 지표 분석</td><td>모든 메시지 Confirm 자동 적용</td><td>재전송 로직, DLQ 재처리</td></tr><tr><td>장애 복구</td><td>split-brain 또는 복제 불일치</td><td>네트워크 분할 또는 복구 지연</td><td>클러스터 불안정 상태, 데이터 누락</td><td>클러스터 상태 알람, Node 리스트 감시</td><td>노드 홀짝 구성, 정기 상태 점검</td><td>재조인 이후 자동 동기화, 복제 재설정 스크립트</td></tr></tbody></table><hr><h2 id=16-분류-기준에-따른-종류-및-유형-types-by-classification>16. 분류 기준에 따른 종류 및 유형 (Types by Classification)<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-종류-및-유형-types-by-classification>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>Queue 유형</td><td>Classic, Mirrored, Quorum</td><td>단순 큐 vs 노드 복제 큐 vs Raft 기반 고가용 큐</td></tr><tr><td>라우팅/Topology</td><td>Direct, Fanout, Topic, Headers</td><td>Exchange 유형에 따른 다양한 라우팅 모델 지원</td></tr><tr><td>클러스터 구성</td><td>Standalone, Clustered</td><td>단일 노드 vs HA 클러스터 환경</td></tr><tr><td>프로토콜 지원</td><td>AMQP(-0-9-1/1.0), MQTT, STOMP</td><td>다양한 통신 규격을 Plugin으로 지원</td></tr><tr><td>복제 방식</td><td>Synchronous vs Asynchronous</td><td>즉시 복제 vs 지연 허용 복제 방식</td></tr></tbody></table><hr><h2 id=17-실무-사용-예시-use-cases>17. 실무 사용 예시 (Use Cases)<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시-use-cases>#</a></h2><table><thead><tr><th>사용 목적</th><th>함께 쓰는 기술</th><th>기대 효과</th></tr></thead><tbody><tr><td>이메일 배치 처리</td><td>RabbitMQ + Spring Boot</td><td>응답성 향상 및 배치 안정성 확보</td></tr><tr><td>이미지 리사이징</td><td>RabbitMQ + Docker 컨슈머</td><td>비동기 처리로 웹 서버 부하 감소</td></tr><tr><td>주문 시스템</td><td>RabbitMQ + Microservices</td><td>주문 유실 방지 및 서비스 간 결합 낮춤</td></tr><tr><td>IoT 센서 이벤트 처리</td><td>MQTT 플러그인 + RabbitMQ</td><td>IoT 디바이스 이벤트 스트림 통합</td></tr></tbody></table><hr><h2 id=18-활용-사례--이미지-처리-파이프라인>18. 활용 사례 – 이미지 처리 파이프라인<a hidden class=anchor aria-hidden=true href=#18-활용-사례--이미지-처리-파이프라인>#</a></h2><h3 id=시스템-구성--워크플로우>시스템 구성 & 워크플로우<a hidden class=anchor aria-hidden=true href=#시스템-구성--워크플로우>#</a></h3><pre class=mermaid>graph LR
  UserUI[사용자 웹/모바일] --&gt;|이미지 업로드| AppServer
  AppServer --&gt;|메시지 발행| Exchange[Direct Exchange]
  Exchange --&gt;|route=resize| ResizeQueue
  ResizeQueue --&gt;|Consumer| ResizeService
  ResizeService --&gt;|이미지 처리 후 저장| CDN/DB
  ResizeService --&gt;|ACK| Broker
</pre><ul><li><p><strong>동작</strong>:</p><ol><li>사용자가 이미지를 업로드 → AppServer가 메시지를 발행</li><li>ResizeService가 큐에서 메시지를 읽고 이미지 리사이징 처리</li><li>처리된 이미지는 CDN에 저장, ACK 전송</li></ol></li><li><p><strong>RabbitMQ 미사용 시</strong>:</p><ul><li>동기 작업으로 응답 타임아웃/느림 발생</li><li>작업 실패 시 재시도 및 복구 어려움</li></ul></li></ul><hr><h2 id=19-구현-예시--python-pika-라이브러리>19. 구현 예시 – Python (pika 라이브러리)<a hidden class=anchor aria-hidden=true href=#19-구현-예시--python-pika-라이브러리>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-92-1><a class=lnlinks href=#hl-92-1> 1</a>
</span><span class=lnt id=hl-92-2><a class=lnlinks href=#hl-92-2> 2</a>
</span><span class=lnt id=hl-92-3><a class=lnlinks href=#hl-92-3> 3</a>
</span><span class=lnt id=hl-92-4><a class=lnlinks href=#hl-92-4> 4</a>
</span><span class=lnt id=hl-92-5><a class=lnlinks href=#hl-92-5> 5</a>
</span><span class=lnt id=hl-92-6><a class=lnlinks href=#hl-92-6> 6</a>
</span><span class=lnt id=hl-92-7><a class=lnlinks href=#hl-92-7> 7</a>
</span><span class=lnt id=hl-92-8><a class=lnlinks href=#hl-92-8> 8</a>
</span><span class=lnt id=hl-92-9><a class=lnlinks href=#hl-92-9> 9</a>
</span><span class=lnt id=hl-92-10><a class=lnlinks href=#hl-92-10>10</a>
</span><span class=lnt id=hl-92-11><a class=lnlinks href=#hl-92-11>11</a>
</span><span class=lnt id=hl-92-12><a class=lnlinks href=#hl-92-12>12</a>
</span><span class=lnt id=hl-92-13><a class=lnlinks href=#hl-92-13>13</a>
</span><span class=lnt id=hl-92-14><a class=lnlinks href=#hl-92-14>14</a>
</span><span class=lnt id=hl-92-15><a class=lnlinks href=#hl-92-15>15</a>
</span><span class=lnt id=hl-92-16><a class=lnlinks href=#hl-92-16>16</a>
</span><span class=lnt id=hl-92-17><a class=lnlinks href=#hl-92-17>17</a>
</span><span class=lnt id=hl-92-18><a class=lnlinks href=#hl-92-18>18</a>
</span><span class=lnt id=hl-92-19><a class=lnlinks href=#hl-92-19>19</a>
</span><span class=lnt id=hl-92-20><a class=lnlinks href=#hl-92-20>20</a>
</span><span class=lnt id=hl-92-21><a class=lnlinks href=#hl-92-21>21</a>
</span><span class=lnt id=hl-92-22><a class=lnlinks href=#hl-92-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 연결 및 채널 생성</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;rabbitmq&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ch</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Exchange 및 Queue 선언, Binding</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;images&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;direct&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;resize_queue&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;images&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;resize_queue&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;resize&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 수신 콜백</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>img_path</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이미지 리사이징 로직 (예: PIL 사용)</span>
</span></span><span class=line><span class=cl>    <span class=n>resize_image</span><span class=p>(</span><span class=n>img_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;resize_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>구현 포인트</strong></p><ul><li><code>durable=True</code> – 메시지·큐 영속성 보장</li><li><code>prefetch_count=1</code> – Consumer 당 하나씩 처리하여 균형 유지</li><li><code>basic_ack()</code> – 메시지 처리가 완료된 후 ACK</li></ul></li></ul><hr><h2 id=20-실무-적용-고려사항-및-주의할-점>20. 실무 적용 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-실무-적용-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>고려/주의 사항</th><th>권장 방안</th></tr></thead><tbody><tr><td>메시지 내구성</td><td>durable exchange/queue 및 persistent 몸체 설정</td><td>필수 설정으로 구성</td></tr><tr><td>Channel/Connection 부하 관리</td><td>채널 수, 연결 수 제한</td><td>채널 재사용, 커넥션 풀 빌딩</td></tr><tr><td>Dead-Letter(재처리) 정책</td><td>재시도 실패 시 DLQ로 라우팅</td><td>max-length, dead-letter 정책 설정</td></tr><tr><td>Prefetch 설정</td><td>성능 저하 방지 및 부하 분산</td><td>prefetch_count 설정</td></tr><tr><td>클러스터 구성</td><td>AZ 간 네트워크 지연 고려</td><td>quorum queue / federation 구성</td></tr><tr><td>모니터링 및 알람</td><td>큐 길이, 메시지 처리 속도, 노드 상태</td><td>Prometheus + Grafana 지표 통합</td></tr><tr><td>리소스 제한</td><td>Erlang VM 메모리 관리, Channel 과다 사용</td><td>메모리 제한 정책, lazy queue</td></tr></tbody></table><hr><h2 id=21-최적화-고려사항-및-권장-기법>21. 최적화 고려사항 및 권장 기법<a hidden class=anchor aria-hidden=true href=#21-최적화-고려사항-및-권장-기법>#</a></h2><table><thead><tr><th>항목</th><th>최적화 방향</th><th>권장 기법</th></tr></thead><tbody><tr><td>메시지 페이로드</td><td>크기 최소화 및 스트리밍</td><td>파일은 CDN/외부 저장소에, 메시지에는 URL</td></tr><tr><td>큐 유형</td><td>메시지 패턴에 맞는 큐 선택</td><td>classic vs quorom vs mirrored 큐</td></tr><tr><td>채널 재사용</td><td>낮은 오버헤드 유지를 위한 구조</td><td>채널 풀링 라이브러리 활용</td></tr><tr><td>Prefetch/Batch 설정</td><td>효율적 소비 및 리소스 사용 조절</td><td>prefetch, ack 타이밍 조정</td></tr><tr><td>Monitoring</td><td>성능 병목점 탐지</td><td>latencies, queue depths, node health</td></tr></tbody></table><hr><h2 id=22-용어-정리>22. 용어 정리<a hidden class=anchor aria-hidden=true href=#22-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>메시징</td><td>Exchange</td><td>메시지 라우팅을 담당하는 AMQP 교환기</td></tr><tr><td></td><td>Binding</td><td>Exchange와 Queue 사이의 라우팅 규칙</td></tr><tr><td></td><td>Queue</td><td>메시지를 저장하고 Consumer에 전달하는 버퍼</td></tr><tr><td>레이어</td><td>Channel</td><td>TCP 연결 위의 경량 통신 논리 스트림</td></tr><tr><td>신뢰성</td><td>Publisher Confirms</td><td>메시지 발행 성공 여부를 확인하는 메커니즘</td></tr><tr><td></td><td>DLQ (Dead-Letter Queue)</td><td>실패 메시지를 별도 큐로 보관하여 추적 가능</td></tr><tr><td>HA</td><td>Mirrored Queue</td><td>노드 간 메시지 동기 복제를 위해 사용</td></tr><tr><td></td><td>Quorum Queue</td><td>Raft 기반 다중 노드 복제 큐로 고가용성 제공</td></tr><tr><td>확장성</td><td>Federation & Shovel</td><td>클러스터 간 메시지 전달 및 복제를 위한 플러그인</td></tr></tbody></table><hr><h2 id=23-참고-및-출처>23. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#23-참고-및-출처>#</a></h2><ul><li><a href=http://www.google.co.kr>RabbitMQ official AMQP concepts</a></li><li><a href=http://www.google.co.kr>CloudAMQP: RabbitMQ Queue Types</a></li><li><a href=http://www.google.co.kr>RabbitMQ blog: HA and Federation/Shovel overview</a></li><li><a href=http://www.google.co.kr>StackOverflow discussions on RabbitMQ performance</a></li><li><a href=http://www.google.co.kr>Pika Python library documentation for RabbitMQ</a></li></ul><hr><p>좋습니다. 이어서 마지막 정리인 <strong>주제와 관련하여 주목할 내용</strong>, <strong>반드시 학습해야 할 내용</strong>을 표로 정리하고 마무리하겠습니다.</p><hr><h2 id=24-주제와-관련하여-주목할-내용>24. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#24-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>메시징 아키텍처</td><td>AMQP 프로토콜</td><td>AMQP 0-9-1</td><td>RabbitMQ가 사용하는 기본 프로토콜로 메시지 라우팅, 보안, 확인(ACK) 등을 정의</td></tr><tr><td>큐 설계</td><td>Queue 유형</td><td>Quorum Queue</td><td>고가용성을 보장하는 Raft 합의 기반 메시지 큐 유형</td></tr><tr><td>고가용성</td><td>클러스터링</td><td>Mirrored Queue</td><td>복수 노드에 동일한 메시지를 복제하여 장애 대응</td></tr><tr><td>모니터링</td><td>운영 도구</td><td>Prometheus + Grafana</td><td>RabbitMQ의 큐 길이, 처리량, 에러율 등을 실시간 시각화 및 알림 설정 가능</td></tr><tr><td>트래픽 분산</td><td>Prefetch 설정</td><td>QoS 조절</td><td>처리 성능 최적화를 위한 소비자 수 및 버퍼 조절</td></tr><tr><td>신뢰성</td><td>메시지 영속화</td><td>Persistent Messages</td><td>서버 재시작 시에도 유실되지 않도록 디스크에 저장</td></tr><tr><td>통합</td><td>Federation</td><td>원격 브로커 연결</td><td>서로 다른 리전에 위치한 RabbitMQ 인스턴스 간의 메시지 연동</td></tr><tr><td>성능 최적화</td><td>Lazy Queue</td><td>디스크 우선 메시지 저장</td><td>메모리 부족 시 디스크에 저장하여 처리 안정성 강화</td></tr></tbody></table><hr><h2 id=25-반드시-학습해야-할-내용>25. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#25-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>메시징 시스템</td><td>AMQP</td><td>Exchange / Routing Key</td><td>메시지의 목적지 결정에 필요한 라우팅 정보</td></tr><tr><td>고가용성 전략</td><td>Quorum Queue</td><td>Raft Consensus</td><td>복수 노드가 동일한 상태를 유지하는 분산 합의 알고리즘</td></tr><tr><td>장애 복구 전략</td><td>Dead-Letter Queue</td><td>DLQ 정책 설정</td><td>메시지 실패 시 재시도 및 추적을 위한 보조 큐</td></tr><tr><td>운영 최적화</td><td>Monitoring</td><td>Queue Depth, Ack Latency</td><td>처리 지연, 누락 등을 예방하기 위한 모니터링 지표</td></tr><tr><td>스케일 아웃 설계</td><td>Channel & Connection</td><td>효율적인 채널 관리</td><td>과도한 채널 사용 시 리소스 병목 발생 가능</td></tr><tr><td>멀티 브로커 통신</td><td>Federation & Shovel</td><td>브로커 간 메시지 복제</td><td>WAN/다중 클러스터 환경에서 데이터 일관성 유지</td></tr></tbody></table><hr><h2 id=용어-정리-4>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-4>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>프로토콜</td><td>AMQP</td><td>Advanced Message Queuing Protocol. 메시지 전달 규칙 정의</td></tr><tr><td>큐 구성</td><td>Exchange</td><td>메시지를 Queue로 라우팅하는 구성 요소</td></tr><tr><td>큐 구성</td><td>Routing Key</td><td>Exchange에서 메시지를 특정 Queue로 전달하기 위한 키</td></tr><tr><td>고가용성</td><td>Mirrored Queue</td><td>여러 노드에 메시지를 복제하여 하나가 죽어도 서비스 유지</td></tr><tr><td>고가용성</td><td>Quorum Queue</td><td>과반수 노드가 살아있을 때만 메시지를 처리하는 큐</td></tr><tr><td>신뢰성</td><td>DLQ</td><td>메시지 소비 실패 시 저장되는 특별한 큐</td></tr><tr><td>최적화</td><td>Lazy Queue</td><td>메시지를 메모리 대신 디스크에 저장하여 리소스 절약</td></tr><tr><td>확장성</td><td>Federation</td><td>다른 브로커로 메시지를 전파하는 기능</td></tr><tr><td>운영</td><td>Prefetch</td><td>소비자가 한번에 처리할 수 있는 메시지 수 제한</td></tr></tbody></table><hr><h2 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h2><ul><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서: 개요</a></li><li><a href=https://www.cloudamqp.com/blog/part3-rabbitmq-best-practice-for-high-availability.html>CloudAMQP: RabbitMQ Queue Types</a></li><li><a href=https://www.rabbitmq.com/federation.html>RabbitMQ Federation & Shovel 개요</a></li><li><a href=https://pika.readthedocs.io/en/stable/>Pika 공식 문서 (Python RabbitMQ Client)</a></li><li><a href=https://scalegrid.io/blog/scaling-rabbitmq/>ScaleGrid: Scaling RabbitMQ</a></li><li><a href=https://jack-vanlightly.com/blog/2017/3/10/rabbitmq-the-different-failures-on-basicpublish>Jack Vanlightly 블로그 – RabbitMQ Failures</a></li></ul><hr><p>깊이 있는 RabbitMQ 조사와 분석을 단계별로 진행하겠습니다.</p><h2 id=1-주제-태그>1. 주제 태그<a hidden class=anchor aria-hidden=true href=#1-주제-태그>#</a></h2><ul><li>Message-Broker</li><li>Distributed-Systems</li><li>AMQP-Protocol</li><li>Asynchronous-Communication</li></ul><h2 id=2-분류-구조-검토>2. 분류 구조 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-검토>#</a></h2><p>제시된 &ldquo;Computer Science and Engineering > Systems and Infrastructure > Infrastructure > Infrastructure Components > Messaging Systems > Implementations > Event Streaming Platforms > Messaging Queue&rdquo; 분류는 적절합니다.</p><p><strong>근거:</strong></p><ul><li>RabbitMQ는 시스템 간 비동기 통신을 위한 인프라 구성 요소</li><li>메시징 시스템의 구체적인 구현체</li><li>분산 시스템에서 메시지 큐잉 기능 제공</li></ul><h2 id=3-주제-요약-설명-200자>3. 주제 요약 설명 (200자)<a hidden class=anchor aria-hidden=true href=#3-주제-요약-설명-200자>#</a></h2><p>RabbitMQ는 AMQP (Advanced Message Queuing Protocol)를 구현한 오픈소스 메시지 브로커로, 애플리케이션 간 안정적이고 확장 가능한 비동기 메시지 전달을 지원합니다. 높은 가용성과 내구성을 제공하며, 다양한 메시징 패턴과 라우팅 기능을 통해 분산 시스템에서 서비스 간 결합도를 낮추고 확장성을 향상시킵니다.</p><h2 id=4-개요-250자-1>4. 개요 (250자)<a hidden class=anchor aria-hidden=true href=#4-개요-250자-1>#</a></h2><p>RabbitMQ는 Erlang으로 개발된 메시지 브로커로, 프로듀서 (Producer)와 컨슈머 (Consumer) 간의 메시지 전달을 중개합니다. Exchange, Queue, Binding 등의 핵심 구성 요소를 통해 복잡한 라우팅 로직을 구현할 수 있으며, 클러스터링, 페더레이션, 높은 가용성 등의 기능을 제공합니다. 마이크로서비스 아키텍처에서 서비스 간 통신, 작업 큐잉, 이벤트 기반 아키텍처 구현에 널리 사용됩니다.</p><hr><h1 id=제1부-핵심-개념-및-기본-원리>제1부: 핵심 개념 및 기본 원리<a hidden class=anchor aria-hidden=true href=#제1부-핵심-개념-및-기본-원리>#</a></h1><h2 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h2><h3 id=메시지-브로커-message-broker>메시지 브로커 (Message Broker)<a hidden class=anchor aria-hidden=true href=#메시지-브로커-message-broker>#</a></h3><p>RabbitMQ는 메시지 브로커로서 애플리케이션 간 메시지 전달을 중개하는 역할을 합니다. 송신자 (프로듀서)와 수신자 (컨슈머) 사이에서 메시지를 안전하게 저장하고 전달하여 시스템 간 결합도를 낮춥니다.</p><h3 id=amqp-advanced-message-queuing-protocol>AMQP (Advanced Message Queuing Protocol)<a hidden class=anchor aria-hidden=true href=#amqp-advanced-message-queuing-protocol>#</a></h3><p>RabbitMQ의 핵심 통신 프로토콜로, 메시지 지향 미들웨어를 위한 오픈 표준입니다. 메시지 라우팅, 큐잉, 안정성, 보안 등을 정의합니다.</p><h3 id=비동기-통신-asynchronous-communication>비동기 통신 (Asynchronous Communication)<a hidden class=anchor aria-hidden=true href=#비동기-통신-asynchronous-communication>#</a></h3><p>메시지 송신자와 수신자가 동시에 활성화되지 않아도 통신이 가능한 방식입니다. 시스템 간 느슨한 결합을 통해 확장성과 내결함성을 향상시킵니다.</p><h3 id=영속성-persistence>영속성 (Persistence)<a hidden class=anchor aria-hidden=true href=#영속성-persistence>#</a></h3><p>메시지와 큐를 디스크에 저장하여 브로커가 재시작되어도 데이터가 유지되도록 하는 기능입니다.</p><h3 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h3><ul><li><strong>확장성</strong>: 메시지 큐를 통해 시스템 부하 분산 및 처리 능력 확장</li><li><strong>내결함성</strong>: 메시지 영속성과 확인 메커니즘으로 데이터 손실 방지</li><li><strong>유연성</strong>: 다양한 exchange 타입과 라우팅 키를 통한 복잡한 메시지 라우팅</li><li><strong>모니터링</strong>: 관리 인터페이스와 메트릭을 통한 시스템 상태 추적</li></ul><h2 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h2><h3 id=등장-배경-1>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경-1>#</a></h3><ul><li><strong>분산 시스템의 복잡성</strong>: 마이크로서비스 아키텍처의 확산으로 서비스 간 통신 복잡도 증가</li><li><strong>동기 통신의 한계</strong>: 직접적인 HTTP 호출로 인한 강한 결합도와 장애 전파 문제</li><li><strong>확장성 요구사항</strong>: 높은 처리량과 가용성이 필요한 웹 애플리케이션 증가</li></ul><h3 id=기술적-배경>기술적 배경<a hidden class=anchor aria-hidden=true href=#기술적-배경>#</a></h3><ul><li><strong>Erlang 기반</strong>: 높은 동시성과 내결함성을 제공하는 Erlang 언어로 개발</li><li><strong>AMQP 표준</strong>: 벤더 중립적인 메시징 프로토콜 필요성</li><li><strong>오픈소스 생태계</strong>: 상용 솔루션의 대안으로 오픈소스 메시징 솔루션 요구</li></ul><h2 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h2><h3 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h3><ol><li><strong>서비스 간 결합도 감소</strong>: 직접 통신 대신 메시지 브로커를 통한 간접 통신</li><li><strong>비동기 처리</strong>: 시간이 오래 걸리는 작업의 백그라운드 처리</li><li><strong>부하 분산</strong>: 여러 워커 인스턴스에 작업 분산</li><li><strong>시스템 안정성</strong>: 메시지 영속성과 확인 메커니즘을 통한 데이터 보호</li></ol><h3 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h3><ul><li><strong>확장성</strong>: 트래픽 증가에 따른 시스템 확장 필요성</li><li><strong>신뢰성</strong>: 메시지 손실 방지와 전달 보장</li><li><strong>유연성</strong>: 다양한 메시징 패턴 지원 필요</li><li><strong>관리 효율성</strong>: 중앙 집중식 메시지 관리 및 모니터링</li></ul><h2 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h2><h3 id=핵심-기능>핵심 기능<a hidden class=anchor aria-hidden=true href=#핵심-기능>#</a></h3><ol><li><strong>메시지 라우팅</strong>: Exchange와 라우팅 키를 통한 지능적 메시지 전달</li><li><strong>큐 관리</strong>: 메시지 저장, 순서 보장, 우선순위 처리</li><li><strong>클러스터링</strong>: 여러 노드를 통한 고가용성 구현</li><li><strong>페더레이션</strong>: 지리적으로 분산된 브로커 간 연결</li><li><strong>보안</strong>: 사용자 인증, 권한 관리, SSL/TLS 지원</li></ol><h3 id=주요-역할>주요 역할<a hidden class=anchor aria-hidden=true href=#주요-역할>#</a></h3><ul><li><strong>메시지 중개자</strong>: 프로듀서와 컨슈머 간 메시지 전달</li><li><strong>부하 분산기</strong>: 여러 워커에 작업 분산</li><li><strong>데이터 버퍼</strong>: 처리 속도 차이를 완충하는 임시 저장소</li><li><strong>시스템 격리</strong>: 서비스 간 장애 전파 방지</li></ul><h2 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h2><h3 id=기술적-특징>기술적 특징<a hidden class=anchor aria-hidden=true href=#기술적-특징>#</a></h3><ul><li><strong>Erlang/OTP 기반</strong>: 높은 동시성과 내결함성</li><li><strong>AMQP 0.9.1 구현</strong>: 표준 프로토콜 지원</li><li><strong>플러그인 아키텍처</strong>: 확장 가능한 모듈식 구조</li><li><strong>관리 UI</strong>: 웹 기반 관리 인터페이스 제공</li></ul><h3 id=운영-특징>운영 특징<a hidden class=anchor aria-hidden=true href=#운영-특징>#</a></h3><ul><li><strong>높은 가용성</strong>: 클러스터링과 미러링 지원</li><li><strong>확장성</strong>: 수평적 확장 가능</li><li><strong>모니터링</strong>: 실시간 메트릭과 알림 기능</li><li><strong>다양한 클라이언트</strong>: 여러 프로그래밍 언어 지원</li></ul><hr><h1 id=제2부-구조-및-아키텍처>제2부: 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#제2부-구조-및-아키텍처>#</a></h1><h2 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h2><h3 id=1-메시지-지향-아키텍처-message-oriented-architecture>1. 메시지 지향 아키텍처 (Message-Oriented Architecture)<a hidden class=anchor aria-hidden=true href=#1-메시지-지향-아키텍처-message-oriented-architecture>#</a></h3><p>메시지를 통한 시스템 간 통신으로 느슨한 결합 구현</p><h3 id=2-안정성-우선-reliability-first>2. 안정성 우선 (Reliability First)<a hidden class=anchor aria-hidden=true href=#2-안정성-우선-reliability-first>#</a></h3><p>메시지 전달 보장과 영속성을 통한 데이터 안전성 확보</p><h3 id=3-유연한-라우팅-flexible-routing>3. 유연한 라우팅 (Flexible Routing)<a hidden class=anchor aria-hidden=true href=#3-유연한-라우팅-flexible-routing>#</a></h3><p>다양한 exchange 타입과 바인딩을 통한 복잡한 라우팅 로직 지원</p><h3 id=4-확장성-scalability>4. 확장성 (Scalability)<a hidden class=anchor aria-hidden=true href=#4-확장성-scalability>#</a></h3><p>클러스터링과 페더레이션을 통한 수평적 확장</p><h2 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h2><h3 id=1-프로듀서-컨슈머-모델>1. 프로듀서-컨슈머 모델<a hidden class=anchor aria-hidden=true href=#1-프로듀서-컨슈머-모델>#</a></h3><pre class=mermaid>graph LR
    A[Producer] --&gt; B[Exchange] --&gt; C[Queue] --&gt; D[Consumer]
    B --&gt; E[Queue] --&gt; F[Consumer]
    B --&gt; G[Queue] --&gt; H[Consumer]
</pre><h3 id=2-exchange-라우팅-원리>2. Exchange 라우팅 원리<a hidden class=anchor aria-hidden=true href=#2-exchange-라우팅-원리>#</a></h3><pre class=mermaid>graph TD
    A[Producer] --&gt; B[Exchange]
    B --&gt; C[Routing Key 매칭]
    C --&gt; D[Queue 1]
    C --&gt; E[Queue 2]
    C --&gt; F[Queue 3]
    D --&gt; G[Consumer 1]
    E --&gt; H[Consumer 2]
    F --&gt; I[Consumer 3]
</pre><h2 id=작동-원리-및-방식>작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#작동-원리-및-방식>#</a></h2><h3 id=메시지-전달-과정>메시지 전달 과정<a hidden class=anchor aria-hidden=true href=#메시지-전달-과정>#</a></h3><ol><li><strong>메시지 발행</strong>: 프로듀서가 exchange에 메시지 발행</li><li><strong>라우팅</strong>: Exchange가 라우팅 키와 바인딩 규칙에 따라 큐 결정</li><li><strong>큐잉</strong>: 메시지가 대상 큐에 저장</li><li><strong>전달</strong>: 컨슈머가 큐에서 메시지 수신</li><li><strong>확인</strong>: 메시지 처리 완료 후 ACK 전송</li></ol><h3 id=플로우-다이어그램>플로우 다이어그램<a hidden class=anchor aria-hidden=true href=#플로우-다이어그램>#</a></h3><pre class=mermaid>sequenceDiagram
    participant P as Producer
    participant E as Exchange
    participant Q as Queue
    participant C as Consumer
    
    P-&gt;&gt;E: 메시지 발행
    E-&gt;&gt;Q: 라우팅 규칙에 따라 큐에 저장
    Q-&gt;&gt;C: 메시지 전달
    C-&gt;&gt;Q: ACK 응답
    Q-&gt;&gt;E: 메시지 삭제 확인
</pre><h2 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h2><h3 id=전체-아키텍처>전체 아키텍처<a hidden class=anchor aria-hidden=true href=#전체-아키텍처>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;RabbitMQ 클러스터&#34;
        A[관리 노드] --&gt; B[브로커 노드 1]
        A --&gt; C[브로커 노드 2]
        A --&gt; D[브로커 노드 3]
        
        subgraph &#34;브로커 노드 구성&#34;
            E[Exchange] --&gt; F[Queue 1]
            E --&gt; G[Queue 2]
            E --&gt; H[Queue 3]
            F --&gt; I[Consumer 1]
            G --&gt; J[Consumer 2]
            H --&gt; K[Consumer 3]
        end
    end
    
    L[Producer Apps] --&gt; E
    M[Management UI] --&gt; A
</pre><h3 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h3><h4 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h4><p><strong>1. Exchange (교환기)</strong></p><ul><li><strong>기능</strong>: 메시지 라우팅 규칙 정의</li><li><strong>역할</strong>: 프로듀서로부터 메시지 수신 후 큐로 라우팅</li><li><strong>특징</strong>: 다양한 타입 지원 (Direct, Topic, Fanout, Headers)</li></ul><p><strong>2. Queue (큐)</strong></p><ul><li><strong>기능</strong>: 메시지 저장소 역할</li><li><strong>역할</strong>: 메시지 임시 저장 및 컨슈머에게 전달</li><li><strong>특징</strong>: FIFO 순서 보장, 영속성 지원</li></ul><p><strong>3. Binding (바인딩)</strong></p><ul><li><strong>기능</strong>: Exchange와 Queue 간 연결 관계 정의</li><li><strong>역할</strong>: 라우팅 규칙 설정</li><li><strong>특징</strong>: 라우팅 키 패턴 매칭</li></ul><p><strong>4. Connection (연결)</strong></p><ul><li><strong>기능</strong>: 클라이언트와 브로커 간 TCP 연결</li><li><strong>역할</strong>: 물리적 통신 채널 제공</li><li><strong>특징</strong>: 인증 및 보안 처리</li></ul><p><strong>5. Channel (채널)</strong></p><ul><li><strong>기능</strong>: 연결 내의 가상 통신 채널</li><li><strong>역할</strong>: 멀티플렉싱을 통한 효율적 통신</li><li><strong>특징</strong>: 경량 통신 단위</li></ul><h4 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h4><p><strong>1. 클러스터 (Cluster)</strong></p><ul><li><strong>기능</strong>: 여러 노드를 하나의 논리적 브로커로 구성</li><li><strong>역할</strong>: 고가용성과 확장성 제공</li><li><strong>특징</strong>: 자동 장애 복구, 부하 분산</li></ul><p><strong>2. 페더레이션 (Federation)</strong></p><ul><li><strong>기능</strong>: 지리적으로 분산된 브로커 간 연결</li><li><strong>역할</strong>: WAN 환경에서 메시지 전달</li><li><strong>특징</strong>: 네트워크 최적화, 지연 허용</li></ul><p><strong>3. 쇼벨 (Shovel)</strong></p><ul><li><strong>기능</strong>: 브로커 간 메시지 이동</li><li><strong>역할</strong>: 데이터 마이그레이션, 백업</li><li><strong>특징</strong>: 유연한 메시지 변환</li></ul><p><strong>4. 관리 플러그인</strong></p><ul><li><strong>기능</strong>: 웹 기반 관리 인터페이스</li><li><strong>역할</strong>: 모니터링, 설정 관리</li><li><strong>특징</strong>: RESTful API 제공</li></ul><hr><h1 id=제3부-구현-및-실무-활용>제3부: 구현 및 실무 활용<a hidden class=anchor aria-hidden=true href=#제3부-구현-및-실무-활용>#</a></h1><h2 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h2><h3 id=1-직접-메시징-direct-messaging>1. 직접 메시징 (Direct Messaging)<a hidden class=anchor aria-hidden=true href=#1-직접-메시징-direct-messaging>#</a></h3><p><strong>정의</strong>: 라우팅 키와 큐 이름이 정확히 일치하는 메시지 전달 방식</p><p><strong>구성</strong>:</p><ul><li>Direct Exchange</li><li>라우팅 키 기반 바인딩</li><li>일대일 메시지 전달</li></ul><p><strong>목적</strong>: 특정 대상에게 정확한 메시지 전달</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-97-1><a class=lnlinks href=#hl-97-1>1</a>
</span><span class=lnt id=hl-97-2><a class=lnlinks href=#hl-97-2>2</a>
</span><span class=lnt id=hl-97-3><a class=lnlinks href=#hl-97-3>3</a>
</span><span class=lnt id=hl-97-4><a class=lnlinks href=#hl-97-4>4</a>
</span><span class=lnt id=hl-97-5><a class=lnlinks href=#hl-97-5>5</a>
</span><span class=lnt id=hl-97-6><a class=lnlinks href=#hl-97-6>6</a>
</span><span class=lnt id=hl-97-7><a class=lnlinks href=#hl-97-7>7</a>
</span><span class=lnt id=hl-97-8><a class=lnlinks href=#hl-97-8>8</a>
</span><span class=lnt id=hl-97-9><a class=lnlinks href=#hl-97-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 시스템 구성: 주문 처리 시스템</span>
</span></span><span class=line><span class=cl><span class=c1># 시나리오: 특정 지역의 주문을 해당 지역 처리 센터로 전달</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders_seoul&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders_busan&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_router&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;direct&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 바인딩 설정</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_router&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders_seoul&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;seoul&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_router&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders_busan&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;busan&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-주제-기반-라우팅-topic-based-routing>2. 주제 기반 라우팅 (Topic-based Routing)<a hidden class=anchor aria-hidden=true href=#2-주제-기반-라우팅-topic-based-routing>#</a></h3><p><strong>정의</strong>: 패턴 매칭을 통한 유연한 메시지 라우팅</p><p><strong>구성</strong>:</p><ul><li>Topic Exchange</li><li>와일드카드 패턴 (*, #)</li><li>계층적 라우팅 키</li></ul><p><strong>목적</strong>: 복잡한 라우팅 로직 구현</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-98-1><a class=lnlinks href=#hl-98-1>1</a>
</span><span class=lnt id=hl-98-2><a class=lnlinks href=#hl-98-2>2</a>
</span><span class=lnt id=hl-98-3><a class=lnlinks href=#hl-98-3>3</a>
</span><span class=lnt id=hl-98-4><a class=lnlinks href=#hl-98-4>4</a>
</span><span class=lnt id=hl-98-5><a class=lnlinks href=#hl-98-5>5</a>
</span><span class=lnt id=hl-98-6><a class=lnlinks href=#hl-98-6>6</a>
</span><span class=lnt id=hl-98-7><a class=lnlinks href=#hl-98-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 시스템 구성: 로그 수집 시스템</span>
</span></span><span class=line><span class=cl><span class=c1># 시나리오: 로그 레벨과 모듈에 따른 분산 처리</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;topic&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 패턴 기반 바인딩</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;error_logs&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;*.error.*&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;auth_logs&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;auth.*&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-발행-구독-패턴-publish-subscribe>3. 발행-구독 패턴 (Publish-Subscribe)<a hidden class=anchor aria-hidden=true href=#3-발행-구독-패턴-publish-subscribe>#</a></h3><p><strong>정의</strong>: 하나의 메시지를 여러 구독자에게 동시 전달</p><p><strong>구성</strong>:</p><ul><li>Fanout Exchange</li><li>모든 바인딩된 큐에 전달</li><li>브로드캐스트 메시징</li></ul><p><strong>목적</strong>: 이벤트 기반 아키텍처 구현</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-99-1><a class=lnlinks href=#hl-99-1>1</a>
</span><span class=lnt id=hl-99-2><a class=lnlinks href=#hl-99-2>2</a>
</span><span class=lnt id=hl-99-3><a class=lnlinks href=#hl-99-3>3</a>
</span><span class=lnt id=hl-99-4><a class=lnlinks href=#hl-99-4>4</a>
</span><span class=lnt id=hl-99-5><a class=lnlinks href=#hl-99-5>5</a>
</span><span class=lnt id=hl-99-6><a class=lnlinks href=#hl-99-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 시스템 구성: 실시간 알림 시스템</span>
</span></span><span class=line><span class=cl><span class=c1># 시나리오: 새 게시글을 모든 알림 채널에 전송</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;email_notifications&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;push_notifications&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;sms_notifications&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4-작업-큐-패턴-work-queue-pattern>4. 작업 큐 패턴 (Work Queue Pattern)<a hidden class=anchor aria-hidden=true href=#4-작업-큐-패턴-work-queue-pattern>#</a></h3><p><strong>정의</strong>: 시간 소모적인 작업을 여러 워커에 분산 처리</p><p><strong>구성</strong>:</p><ul><li>단일 큐</li><li>여러 컨슈머 (워커)</li><li>라운드 로빈 분산</li></ul><p><strong>목적</strong>: 부하 분산과 병렬 처리</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-100-1><a class=lnlinks href=#hl-100-1>1</a>
</span><span class=lnt id=hl-100-2><a class=lnlinks href=#hl-100-2>2</a>
</span><span class=lnt id=hl-100-3><a class=lnlinks href=#hl-100-3>3</a>
</span><span class=lnt id=hl-100-4><a class=lnlinks href=#hl-100-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 시스템 구성: 이미지 처리 시스템</span>
</span></span><span class=line><span class=cl><span class=c1># 시나리오: 업로드된 이미지를 여러 워커가 병렬 처리</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;image_processing&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 워커당 하나씩 처리</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>높은 신뢰성</td><td>메시지 영속성과 확인 메커니즘으로 데이터 손실 방지</td></tr><tr><td></td><td>확장성</td><td>클러스터링과 페더레이션을 통한 수평적 확장 지원</td></tr><tr><td></td><td>유연한 라우팅</td><td>다양한 Exchange 타입으로 복잡한 메시지 라우팅 구현</td></tr><tr><td></td><td>관리 용이성</td><td>웹 기반 관리 UI와 RESTful API 제공</td></tr><tr><td></td><td>다양한 프로토콜 지원</td><td>AMQP, MQTT, STOMP 등 다중 프로토콜 지원</td></tr><tr><td></td><td>성능 최적화</td><td>Erlang 기반의 높은 동시성과 처리량</td></tr></tbody></table><h2 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h2><h3 id=단점-2>단점<a hidden class=anchor aria-hidden=true href=#단점-2>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성</td><td>초기 설정과 구성이 복잡함</td><td>표준화된 설정 템플릿 사용, 단계별 구축</td></tr><tr><td></td><td>메모리 사용량</td><td>Erlang VM의 높은 메모리 사용량</td><td>적절한 메모리 할당, 모니터링 강화</td></tr><tr><td></td><td>단일 장애점</td><td>중앙 집중식 구조로 브로커 장애 시 전체 영향</td><td>클러스터링, 미러링 구성</td></tr><tr><td></td><td>학습 곡선</td><td>AMQP와 RabbitMQ 개념 학습 필요</td><td>체계적인 교육, 문서화</td></tr></tbody></table><h3 id=문제점-2>문제점<a hidden class=anchor aria-hidden=true href=#문제점-2>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>메시지 적체</td><td>컨슈머 처리 속도 저하</td><td>메모리 부족, 성능 저하</td><td>큐 길이 모니터링</td><td>적절한 프리페치 설정</td><td>컨슈머 인스턴스 증가</td></tr><tr><td></td><td>메모리 누수</td><td>미확인 메시지 누적</td><td>브로커 메모리 부족</td><td>메모리 사용량 추적</td><td>적절한 TTL 설정</td><td>메시지 확인 로직 개선</td></tr><tr><td></td><td>네트워크 파티션</td><td>클러스터 노드 간 통신 장애</td><td>데이터 불일치</td><td>클러스터 상태 모니터링</td><td>네트워크 이중화</td><td>파티션 핸들링 정책 설정</td></tr><tr><td></td><td>디스크 부족</td><td>영속성 메시지 과도한 저장</td><td>브로커 중단</td><td>디스크 사용량 모니터링</td><td>정기적인 메시지 정리</td><td>디스크 확장, 메시지 보관 정책 수정</td></tr></tbody></table><h2 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h2><h3 id=1-성능-최적화>1. 성능 최적화<a hidden class=anchor aria-hidden=true href=#1-성능-최적화>#</a></h3><p><strong>원인</strong>: 높은 처리량 요구사항과 레이턴시 민감성
<strong>영향</strong>: 시스템 전체 성능 저하
<strong>해결 방법</strong>:</p><ul><li>메시지 배치 처리</li><li>적절한 프리페치 설정</li><li>클러스터 최적화</li></ul><h3 id=2-데이터-일관성>2. 데이터 일관성<a hidden class=anchor aria-hidden=true href=#2-데이터-일관성>#</a></h3><p><strong>원인</strong>: 분산 환경에서의 메시지 순서 보장
<strong>영향</strong>: 비즈니스 로직 오류
<strong>해결 방법</strong>:</p><ul><li>단일 큐 사용</li><li>메시지 시퀀싱</li><li>이벤트 소싱 패턴</li></ul><h3 id=3-보안-강화>3. 보안 강화<a hidden class=anchor aria-hidden=true href=#3-보안-강화>#</a></h3><p><strong>원인</strong>: 메시지 데이터의 민감성
<strong>영향</strong>: 데이터 유출 위험
<strong>해결 방법</strong>:</p><ul><li>메시지 암호화</li><li>접근 제어 강화</li><li>감사 로깅</li></ul><h3 id=4-모니터링과-관찰-가능성>4. 모니터링과 관찰 가능성<a hidden class=anchor aria-hidden=true href=#4-모니터링과-관찰-가능성>#</a></h3><p><strong>원인</strong>: 복잡한 메시징 플로우
<strong>영향</strong>: 장애 진단 어려움
<strong>해결 방법</strong>:</p><ul><li>분산 추적</li><li>메트릭 수집</li><li>로그 통합</li></ul><h2 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>종류</th><th>설명</th></tr></thead><tbody><tr><td>Exchange 타입</td><td>Direct</td><td>정확한 라우팅 키 매칭</td></tr><tr><td></td><td>Topic</td><td>패턴 기반 라우팅</td></tr><tr><td></td><td>Fanout</td><td>브로드캐스트 메시징</td></tr><tr><td></td><td>Headers</td><td>헤더 기반 라우팅</td></tr><tr><td>큐 타입</td><td>Classic</td><td>기본 큐 타입</td></tr><tr><td></td><td>Quorum</td><td>고가용성 큐</td></tr><tr><td></td><td>Stream</td><td>스트리밍 큐</td></tr><tr><td>배포 형태</td><td>Standalone</td><td>단일 노드 배포</td></tr><tr><td></td><td>Cluster</td><td>다중 노드 클러스터</td></tr><tr><td></td><td>Federation</td><td>지리적 분산</td></tr><tr><td>사용 패턴</td><td>Work Queue</td><td>작업 분산</td></tr><tr><td></td><td>Publish/Subscribe</td><td>이벤트 브로드캐스트</td></tr><tr><td></td><td>RPC</td><td>원격 프로시저 호출</td></tr><tr><td></td><td>Routing</td><td>선택적 라우팅</td></tr></tbody></table><hr><h1 id=제4부-실무-활용-및-최적화>제4부: 실무 활용 및 최적화<a hidden class=anchor aria-hidden=true href=#제4부-실무-활용-및-최적화>#</a></h1><h2 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h2><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td>마이크로서비스 통신</td><td>Spring Boot, Docker, Kubernetes</td><td>서비스 간 결합도 감소, 확장성 향상</td></tr><tr><td>비동기 작업 처리</td><td>Celery, Redis, Python</td><td>응답 시간 단축, 사용자 경험 개선</td></tr><tr><td>이벤트 기반 아키텍처</td><td>Apache Kafka, Event Sourcing</td><td>시스템 유연성 증가, 실시간 처리</td></tr><tr><td>데이터 파이프라인</td><td>Apache Airflow, ETL Tools</td><td>데이터 처리 안정성, 배치 작업 자동화</td></tr><tr><td>로그 수집 시스템</td><td>ELK Stack, Fluentd</td><td>중앙 집중식 로그 관리, 분석 효율성</td></tr><tr><td>알림 시스템</td><td>Firebase, SendGrid, Twilio</td><td>실시간 알림 전달, 다채널 지원</td></tr></tbody></table><h2 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h2><h3 id=전자상거래-주문-처리-시스템>전자상거래 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#전자상거래-주문-처리-시스템>#</a></h3><p><strong>시스템 구성</strong>:</p><ul><li>주문 서비스 (Order Service)</li><li>재고 관리 서비스 (Inventory Service)</li><li>결제 서비스 (Payment Service)</li><li>배송 서비스 (Shipping Service)</li><li>알림 서비스 (Notification Service)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TD
    A[주문 생성] --&gt; B[주문 Exchange]
    B --&gt; C[재고 확인 Queue]
    B --&gt; D[결제 처리 Queue]
    B --&gt; E[알림 Queue]
    
    C --&gt; F[재고 서비스]
    D --&gt; G[결제 서비스]
    E --&gt; H[알림 서비스]
    
    F --&gt; I[재고 결과 Exchange]
    G --&gt; J[결제 결과 Exchange]
    
    I --&gt; K[배송 준비 Queue]
    J --&gt; K
    
    K --&gt; L[배송 서비스]
    L --&gt; M[배송 알림 Queue]
    M --&gt; H
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 주문을 생성하면 주문 서비스가 주문 정보를 Exchange에 발행</li><li>재고 확인, 결제 처리, 알림 전송 큐로 메시지 라우팅</li><li>각 서비스가 독립적으로 작업 처리</li><li>재고 확인과 결제 완료 후 배송 서비스 활성화</li><li>배송 상태 변경 시 고객에게 알림 전송</li></ol><p><strong>RabbitMQ의 역할</strong>:</p><ul><li>서비스 간 느슨한 결합 제공</li><li>비동기 처리를 통한 응답 시간 단축</li><li>장애 시 메시지 보존으로 데이터 손실 방지</li><li>트래픽 급증 시 메시지 버퍼링</li></ul><p><strong>RabbitMQ 유무에 따른 차이점</strong>:</p><p><em>RabbitMQ 없이</em>:</p><ul><li>서비스 간 직접 HTTP 호출</li><li>동기 처리로 인한 긴 응답 시간</li><li>하나의 서비스 장애 시 전체 프로세스 중단</li><li>트래픽 급증 시 시스템 과부하</li></ul><p><em>RabbitMQ 사용</em>:</p><ul><li>비동기 메시지 기반 통신</li><li>빠른 응답 시간 (주문 접수 즉시 응답)</li><li>서비스 장애 시 메시지 보존 및 재처리</li><li>자동 부하 분산 및 확장성</li></ul><h2 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h2><h3 id=주문-처리-시스템-구현>주문 처리 시스템 구현<a hidden class=anchor aria-hidden=true href=#주문-처리-시스템-구현>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-102-1><a class=lnlinks href=#hl-102-1>  1</a>
</span><span class=lnt id=hl-102-2><a class=lnlinks href=#hl-102-2>  2</a>
</span><span class=lnt id=hl-102-3><a class=lnlinks href=#hl-102-3>  3</a>
</span><span class=lnt id=hl-102-4><a class=lnlinks href=#hl-102-4>  4</a>
</span><span class=lnt id=hl-102-5><a class=lnlinks href=#hl-102-5>  5</a>
</span><span class=lnt id=hl-102-6><a class=lnlinks href=#hl-102-6>  6</a>
</span><span class=lnt id=hl-102-7><a class=lnlinks href=#hl-102-7>  7</a>
</span><span class=lnt id=hl-102-8><a class=lnlinks href=#hl-102-8>  8</a>
</span><span class=lnt id=hl-102-9><a class=lnlinks href=#hl-102-9>  9</a>
</span><span class=lnt id=hl-102-10><a class=lnlinks href=#hl-102-10> 10</a>
</span><span class=lnt id=hl-102-11><a class=lnlinks href=#hl-102-11> 11</a>
</span><span class=lnt id=hl-102-12><a class=lnlinks href=#hl-102-12> 12</a>
</span><span class=lnt id=hl-102-13><a class=lnlinks href=#hl-102-13> 13</a>
</span><span class=lnt id=hl-102-14><a class=lnlinks href=#hl-102-14> 14</a>
</span><span class=lnt id=hl-102-15><a class=lnlinks href=#hl-102-15> 15</a>
</span><span class=lnt id=hl-102-16><a class=lnlinks href=#hl-102-16> 16</a>
</span><span class=lnt id=hl-102-17><a class=lnlinks href=#hl-102-17> 17</a>
</span><span class=lnt id=hl-102-18><a class=lnlinks href=#hl-102-18> 18</a>
</span><span class=lnt id=hl-102-19><a class=lnlinks href=#hl-102-19> 19</a>
</span><span class=lnt id=hl-102-20><a class=lnlinks href=#hl-102-20> 20</a>
</span><span class=lnt id=hl-102-21><a class=lnlinks href=#hl-102-21> 21</a>
</span><span class=lnt id=hl-102-22><a class=lnlinks href=#hl-102-22> 22</a>
</span><span class=lnt id=hl-102-23><a class=lnlinks href=#hl-102-23> 23</a>
</span><span class=lnt id=hl-102-24><a class=lnlinks href=#hl-102-24> 24</a>
</span><span class=lnt id=hl-102-25><a class=lnlinks href=#hl-102-25> 25</a>
</span><span class=lnt id=hl-102-26><a class=lnlinks href=#hl-102-26> 26</a>
</span><span class=lnt id=hl-102-27><a class=lnlinks href=#hl-102-27> 27</a>
</span><span class=lnt id=hl-102-28><a class=lnlinks href=#hl-102-28> 28</a>
</span><span class=lnt id=hl-102-29><a class=lnlinks href=#hl-102-29> 29</a>
</span><span class=lnt id=hl-102-30><a class=lnlinks href=#hl-102-30> 30</a>
</span><span class=lnt id=hl-102-31><a class=lnlinks href=#hl-102-31> 31</a>
</span><span class=lnt id=hl-102-32><a class=lnlinks href=#hl-102-32> 32</a>
</span><span class=lnt id=hl-102-33><a class=lnlinks href=#hl-102-33> 33</a>
</span><span class=lnt id=hl-102-34><a class=lnlinks href=#hl-102-34> 34</a>
</span><span class=lnt id=hl-102-35><a class=lnlinks href=#hl-102-35> 35</a>
</span><span class=lnt id=hl-102-36><a class=lnlinks href=#hl-102-36> 36</a>
</span><span class=lnt id=hl-102-37><a class=lnlinks href=#hl-102-37> 37</a>
</span><span class=lnt id=hl-102-38><a class=lnlinks href=#hl-102-38> 38</a>
</span><span class=lnt id=hl-102-39><a class=lnlinks href=#hl-102-39> 39</a>
</span><span class=lnt id=hl-102-40><a class=lnlinks href=#hl-102-40> 40</a>
</span><span class=lnt id=hl-102-41><a class=lnlinks href=#hl-102-41> 41</a>
</span><span class=lnt id=hl-102-42><a class=lnlinks href=#hl-102-42> 42</a>
</span><span class=lnt id=hl-102-43><a class=lnlinks href=#hl-102-43> 43</a>
</span><span class=lnt id=hl-102-44><a class=lnlinks href=#hl-102-44> 44</a>
</span><span class=lnt id=hl-102-45><a class=lnlinks href=#hl-102-45> 45</a>
</span><span class=lnt id=hl-102-46><a class=lnlinks href=#hl-102-46> 46</a>
</span><span class=lnt id=hl-102-47><a class=lnlinks href=#hl-102-47> 47</a>
</span><span class=lnt id=hl-102-48><a class=lnlinks href=#hl-102-48> 48</a>
</span><span class=lnt id=hl-102-49><a class=lnlinks href=#hl-102-49> 49</a>
</span><span class=lnt id=hl-102-50><a class=lnlinks href=#hl-102-50> 50</a>
</span><span class=lnt id=hl-102-51><a class=lnlinks href=#hl-102-51> 51</a>
</span><span class=lnt id=hl-102-52><a class=lnlinks href=#hl-102-52> 52</a>
</span><span class=lnt id=hl-102-53><a class=lnlinks href=#hl-102-53> 53</a>
</span><span class=lnt id=hl-102-54><a class=lnlinks href=#hl-102-54> 54</a>
</span><span class=lnt id=hl-102-55><a class=lnlinks href=#hl-102-55> 55</a>
</span><span class=lnt id=hl-102-56><a class=lnlinks href=#hl-102-56> 56</a>
</span><span class=lnt id=hl-102-57><a class=lnlinks href=#hl-102-57> 57</a>
</span><span class=lnt id=hl-102-58><a class=lnlinks href=#hl-102-58> 58</a>
</span><span class=lnt id=hl-102-59><a class=lnlinks href=#hl-102-59> 59</a>
</span><span class=lnt id=hl-102-60><a class=lnlinks href=#hl-102-60> 60</a>
</span><span class=lnt id=hl-102-61><a class=lnlinks href=#hl-102-61> 61</a>
</span><span class=lnt id=hl-102-62><a class=lnlinks href=#hl-102-62> 62</a>
</span><span class=lnt id=hl-102-63><a class=lnlinks href=#hl-102-63> 63</a>
</span><span class=lnt id=hl-102-64><a class=lnlinks href=#hl-102-64> 64</a>
</span><span class=lnt id=hl-102-65><a class=lnlinks href=#hl-102-65> 65</a>
</span><span class=lnt id=hl-102-66><a class=lnlinks href=#hl-102-66> 66</a>
</span><span class=lnt id=hl-102-67><a class=lnlinks href=#hl-102-67> 67</a>
</span><span class=lnt id=hl-102-68><a class=lnlinks href=#hl-102-68> 68</a>
</span><span class=lnt id=hl-102-69><a class=lnlinks href=#hl-102-69> 69</a>
</span><span class=lnt id=hl-102-70><a class=lnlinks href=#hl-102-70> 70</a>
</span><span class=lnt id=hl-102-71><a class=lnlinks href=#hl-102-71> 71</a>
</span><span class=lnt id=hl-102-72><a class=lnlinks href=#hl-102-72> 72</a>
</span><span class=lnt id=hl-102-73><a class=lnlinks href=#hl-102-73> 73</a>
</span><span class=lnt id=hl-102-74><a class=lnlinks href=#hl-102-74> 74</a>
</span><span class=lnt id=hl-102-75><a class=lnlinks href=#hl-102-75> 75</a>
</span><span class=lnt id=hl-102-76><a class=lnlinks href=#hl-102-76> 76</a>
</span><span class=lnt id=hl-102-77><a class=lnlinks href=#hl-102-77> 77</a>
</span><span class=lnt id=hl-102-78><a class=lnlinks href=#hl-102-78> 78</a>
</span><span class=lnt id=hl-102-79><a class=lnlinks href=#hl-102-79> 79</a>
</span><span class=lnt id=hl-102-80><a class=lnlinks href=#hl-102-80> 80</a>
</span><span class=lnt id=hl-102-81><a class=lnlinks href=#hl-102-81> 81</a>
</span><span class=lnt id=hl-102-82><a class=lnlinks href=#hl-102-82> 82</a>
</span><span class=lnt id=hl-102-83><a class=lnlinks href=#hl-102-83> 83</a>
</span><span class=lnt id=hl-102-84><a class=lnlinks href=#hl-102-84> 84</a>
</span><span class=lnt id=hl-102-85><a class=lnlinks href=#hl-102-85> 85</a>
</span><span class=lnt id=hl-102-86><a class=lnlinks href=#hl-102-86> 86</a>
</span><span class=lnt id=hl-102-87><a class=lnlinks href=#hl-102-87> 87</a>
</span><span class=lnt id=hl-102-88><a class=lnlinks href=#hl-102-88> 88</a>
</span><span class=lnt id=hl-102-89><a class=lnlinks href=#hl-102-89> 89</a>
</span><span class=lnt id=hl-102-90><a class=lnlinks href=#hl-102-90> 90</a>
</span><span class=lnt id=hl-102-91><a class=lnlinks href=#hl-102-91> 91</a>
</span><span class=lnt id=hl-102-92><a class=lnlinks href=#hl-102-92> 92</a>
</span><span class=lnt id=hl-102-93><a class=lnlinks href=#hl-102-93> 93</a>
</span><span class=lnt id=hl-102-94><a class=lnlinks href=#hl-102-94> 94</a>
</span><span class=lnt id=hl-102-95><a class=lnlinks href=#hl-102-95> 95</a>
</span><span class=lnt id=hl-102-96><a class=lnlinks href=#hl-102-96> 96</a>
</span><span class=lnt id=hl-102-97><a class=lnlinks href=#hl-102-97> 97</a>
</span><span class=lnt id=hl-102-98><a class=lnlinks href=#hl-102-98> 98</a>
</span><span class=lnt id=hl-102-99><a class=lnlinks href=#hl-102-99> 99</a>
</span><span class=lnt id=hl-102-100><a class=lnlinks href=#hl-102-100>100</a>
</span><span class=lnt id=hl-102-101><a class=lnlinks href=#hl-102-101>101</a>
</span><span class=lnt id=hl-102-102><a class=lnlinks href=#hl-102-102>102</a>
</span><span class=lnt id=hl-102-103><a class=lnlinks href=#hl-102-103>103</a>
</span><span class=lnt id=hl-102-104><a class=lnlinks href=#hl-102-104>104</a>
</span><span class=lnt id=hl-102-105><a class=lnlinks href=#hl-102-105>105</a>
</span><span class=lnt id=hl-102-106><a class=lnlinks href=#hl-102-106>106</a>
</span><span class=lnt id=hl-102-107><a class=lnlinks href=#hl-102-107>107</a>
</span><span class=lnt id=hl-102-108><a class=lnlinks href=#hl-102-108>108</a>
</span><span class=lnt id=hl-102-109><a class=lnlinks href=#hl-102-109>109</a>
</span><span class=lnt id=hl-102-110><a class=lnlinks href=#hl-102-110>110</a>
</span><span class=lnt id=hl-102-111><a class=lnlinks href=#hl-102-111>111</a>
</span><span class=lnt id=hl-102-112><a class=lnlinks href=#hl-102-112>112</a>
</span><span class=lnt id=hl-102-113><a class=lnlinks href=#hl-102-113>113</a>
</span><span class=lnt id=hl-102-114><a class=lnlinks href=#hl-102-114>114</a>
</span><span class=lnt id=hl-102-115><a class=lnlinks href=#hl-102-115>115</a>
</span><span class=lnt id=hl-102-116><a class=lnlinks href=#hl-102-116>116</a>
</span><span class=lnt id=hl-102-117><a class=lnlinks href=#hl-102-117>117</a>
</span><span class=lnt id=hl-102-118><a class=lnlinks href=#hl-102-118>118</a>
</span><span class=lnt id=hl-102-119><a class=lnlinks href=#hl-102-119>119</a>
</span><span class=lnt id=hl-102-120><a class=lnlinks href=#hl-102-120>120</a>
</span><span class=lnt id=hl-102-121><a class=lnlinks href=#hl-102-121>121</a>
</span><span class=lnt id=hl-102-122><a class=lnlinks href=#hl-102-122>122</a>
</span><span class=lnt id=hl-102-123><a class=lnlinks href=#hl-102-123>123</a>
</span><span class=lnt id=hl-102-124><a class=lnlinks href=#hl-102-124>124</a>
</span><span class=lnt id=hl-102-125><a class=lnlinks href=#hl-102-125>125</a>
</span><span class=lnt id=hl-102-126><a class=lnlinks href=#hl-102-126>126</a>
</span><span class=lnt id=hl-102-127><a class=lnlinks href=#hl-102-127>127</a>
</span><span class=lnt id=hl-102-128><a class=lnlinks href=#hl-102-128>128</a>
</span><span class=lnt id=hl-102-129><a class=lnlinks href=#hl-102-129>129</a>
</span><span class=lnt id=hl-102-130><a class=lnlinks href=#hl-102-130>130</a>
</span><span class=lnt id=hl-102-131><a class=lnlinks href=#hl-102-131>131</a>
</span><span class=lnt id=hl-102-132><a class=lnlinks href=#hl-102-132>132</a>
</span><span class=lnt id=hl-102-133><a class=lnlinks href=#hl-102-133>133</a>
</span><span class=lnt id=hl-102-134><a class=lnlinks href=#hl-102-134>134</a>
</span><span class=lnt id=hl-102-135><a class=lnlinks href=#hl-102-135>135</a>
</span><span class=lnt id=hl-102-136><a class=lnlinks href=#hl-102-136>136</a>
</span><span class=lnt id=hl-102-137><a class=lnlinks href=#hl-102-137>137</a>
</span><span class=lnt id=hl-102-138><a class=lnlinks href=#hl-102-138>138</a>
</span><span class=lnt id=hl-102-139><a class=lnlinks href=#hl-102-139>139</a>
</span><span class=lnt id=hl-102-140><a class=lnlinks href=#hl-102-140>140</a>
</span><span class=lnt id=hl-102-141><a class=lnlinks href=#hl-102-141>141</a>
</span><span class=lnt id=hl-102-142><a class=lnlinks href=#hl-102-142>142</a>
</span><span class=lnt id=hl-102-143><a class=lnlinks href=#hl-102-143>143</a>
</span><span class=lnt id=hl-102-144><a class=lnlinks href=#hl-102-144>144</a>
</span><span class=lnt id=hl-102-145><a class=lnlinks href=#hl-102-145>145</a>
</span><span class=lnt id=hl-102-146><a class=lnlinks href=#hl-102-146>146</a>
</span><span class=lnt id=hl-102-147><a class=lnlinks href=#hl-102-147>147</a>
</span><span class=lnt id=hl-102-148><a class=lnlinks href=#hl-102-148>148</a>
</span><span class=lnt id=hl-102-149><a class=lnlinks href=#hl-102-149>149</a>
</span><span class=lnt id=hl-102-150><a class=lnlinks href=#hl-102-150>150</a>
</span><span class=lnt id=hl-102-151><a class=lnlinks href=#hl-102-151>151</a>
</span><span class=lnt id=hl-102-152><a class=lnlinks href=#hl-102-152>152</a>
</span><span class=lnt id=hl-102-153><a class=lnlinks href=#hl-102-153>153</a>
</span><span class=lnt id=hl-102-154><a class=lnlinks href=#hl-102-154>154</a>
</span><span class=lnt id=hl-102-155><a class=lnlinks href=#hl-102-155>155</a>
</span><span class=lnt id=hl-102-156><a class=lnlinks href=#hl-102-156>156</a>
</span><span class=lnt id=hl-102-157><a class=lnlinks href=#hl-102-157>157</a>
</span><span class=lnt id=hl-102-158><a class=lnlinks href=#hl-102-158>158</a>
</span><span class=lnt id=hl-102-159><a class=lnlinks href=#hl-102-159>159</a>
</span><span class=lnt id=hl-102-160><a class=lnlinks href=#hl-102-160>160</a>
</span><span class=lnt id=hl-102-161><a class=lnlinks href=#hl-102-161>161</a>
</span><span class=lnt id=hl-102-162><a class=lnlinks href=#hl-102-162>162</a>
</span><span class=lnt id=hl-102-163><a class=lnlinks href=#hl-102-163>163</a>
</span><span class=lnt id=hl-102-164><a class=lnlinks href=#hl-102-164>164</a>
</span><span class=lnt id=hl-102-165><a class=lnlinks href=#hl-102-165>165</a>
</span><span class=lnt id=hl-102-166><a class=lnlinks href=#hl-102-166>166</a>
</span><span class=lnt id=hl-102-167><a class=lnlinks href=#hl-102-167>167</a>
</span><span class=lnt id=hl-102-168><a class=lnlinks href=#hl-102-168>168</a>
</span><span class=lnt id=hl-102-169><a class=lnlinks href=#hl-102-169>169</a>
</span><span class=lnt id=hl-102-170><a class=lnlinks href=#hl-102-170>170</a>
</span><span class=lnt id=hl-102-171><a class=lnlinks href=#hl-102-171>171</a>
</span><span class=lnt id=hl-102-172><a class=lnlinks href=#hl-102-172>172</a>
</span><span class=lnt id=hl-102-173><a class=lnlinks href=#hl-102-173>173</a>
</span><span class=lnt id=hl-102-174><a class=lnlinks href=#hl-102-174>174</a>
</span><span class=lnt id=hl-102-175><a class=lnlinks href=#hl-102-175>175</a>
</span><span class=lnt id=hl-102-176><a class=lnlinks href=#hl-102-176>176</a>
</span><span class=lnt id=hl-102-177><a class=lnlinks href=#hl-102-177>177</a>
</span><span class=lnt id=hl-102-178><a class=lnlinks href=#hl-102-178>178</a>
</span><span class=lnt id=hl-102-179><a class=lnlinks href=#hl-102-179>179</a>
</span><span class=lnt id=hl-102-180><a class=lnlinks href=#hl-102-180>180</a>
</span><span class=lnt id=hl-102-181><a class=lnlinks href=#hl-102-181>181</a>
</span><span class=lnt id=hl-102-182><a class=lnlinks href=#hl-102-182>182</a>
</span><span class=lnt id=hl-102-183><a class=lnlinks href=#hl-102-183>183</a>
</span><span class=lnt id=hl-102-184><a class=lnlinks href=#hl-102-184>184</a>
</span><span class=lnt id=hl-102-185><a class=lnlinks href=#hl-102-185>185</a>
</span><span class=lnt id=hl-102-186><a class=lnlinks href=#hl-102-186>186</a>
</span><span class=lnt id=hl-102-187><a class=lnlinks href=#hl-102-187>187</a>
</span><span class=lnt id=hl-102-188><a class=lnlinks href=#hl-102-188>188</a>
</span><span class=lnt id=hl-102-189><a class=lnlinks href=#hl-102-189>189</a>
</span><span class=lnt id=hl-102-190><a class=lnlinks href=#hl-102-190>190</a>
</span><span class=lnt id=hl-102-191><a class=lnlinks href=#hl-102-191>191</a>
</span><span class=lnt id=hl-102-192><a class=lnlinks href=#hl-102-192>192</a>
</span><span class=lnt id=hl-102-193><a class=lnlinks href=#hl-102-193>193</a>
</span><span class=lnt id=hl-102-194><a class=lnlinks href=#hl-102-194>194</a>
</span><span class=lnt id=hl-102-195><a class=lnlinks href=#hl-102-195>195</a>
</span><span class=lnt id=hl-102-196><a class=lnlinks href=#hl-102-196>196</a>
</span><span class=lnt id=hl-102-197><a class=lnlinks href=#hl-102-197>197</a>
</span><span class=lnt id=hl-102-198><a class=lnlinks href=#hl-102-198>198</a>
</span><span class=lnt id=hl-102-199><a class=lnlinks href=#hl-102-199>199</a>
</span><span class=lnt id=hl-102-200><a class=lnlinks href=#hl-102-200>200</a>
</span><span class=lnt id=hl-102-201><a class=lnlinks href=#hl-102-201>201</a>
</span><span class=lnt id=hl-102-202><a class=lnlinks href=#hl-102-202>202</a>
</span><span class=lnt id=hl-102-203><a class=lnlinks href=#hl-102-203>203</a>
</span><span class=lnt id=hl-102-204><a class=lnlinks href=#hl-102-204>204</a>
</span><span class=lnt id=hl-102-205><a class=lnlinks href=#hl-102-205>205</a>
</span><span class=lnt id=hl-102-206><a class=lnlinks href=#hl-102-206>206</a>
</span><span class=lnt id=hl-102-207><a class=lnlinks href=#hl-102-207>207</a>
</span><span class=lnt id=hl-102-208><a class=lnlinks href=#hl-102-208>208</a>
</span><span class=lnt id=hl-102-209><a class=lnlinks href=#hl-102-209>209</a>
</span><span class=lnt id=hl-102-210><a class=lnlinks href=#hl-102-210>210</a>
</span><span class=lnt id=hl-102-211><a class=lnlinks href=#hl-102-211>211</a>
</span><span class=lnt id=hl-102-212><a class=lnlinks href=#hl-102-212>212</a>
</span><span class=lnt id=hl-102-213><a class=lnlinks href=#hl-102-213>213</a>
</span><span class=lnt id=hl-102-214><a class=lnlinks href=#hl-102-214>214</a>
</span><span class=lnt id=hl-102-215><a class=lnlinks href=#hl-102-215>215</a>
</span><span class=lnt id=hl-102-216><a class=lnlinks href=#hl-102-216>216</a>
</span><span class=lnt id=hl-102-217><a class=lnlinks href=#hl-102-217>217</a>
</span><span class=lnt id=hl-102-218><a class=lnlinks href=#hl-102-218>218</a>
</span><span class=lnt id=hl-102-219><a class=lnlinks href=#hl-102-219>219</a>
</span><span class=lnt id=hl-102-220><a class=lnlinks href=#hl-102-220>220</a>
</span><span class=lnt id=hl-102-221><a class=lnlinks href=#hl-102-221>221</a>
</span><span class=lnt id=hl-102-222><a class=lnlinks href=#hl-102-222>222</a>
</span><span class=lnt id=hl-102-223><a class=lnlinks href=#hl-102-223>223</a>
</span><span class=lnt id=hl-102-224><a class=lnlinks href=#hl-102-224>224</a>
</span><span class=lnt id=hl-102-225><a class=lnlinks href=#hl-102-225>225</a>
</span><span class=lnt id=hl-102-226><a class=lnlinks href=#hl-102-226>226</a>
</span><span class=lnt id=hl-102-227><a class=lnlinks href=#hl-102-227>227</a>
</span><span class=lnt id=hl-102-228><a class=lnlinks href=#hl-102-228>228</a>
</span><span class=lnt id=hl-102-229><a class=lnlinks href=#hl-102-229>229</a>
</span><span class=lnt id=hl-102-230><a class=lnlinks href=#hl-102-230>230</a>
</span><span class=lnt id=hl-102-231><a class=lnlinks href=#hl-102-231>231</a>
</span><span class=lnt id=hl-102-232><a class=lnlinks href=#hl-102-232>232</a>
</span><span class=lnt id=hl-102-233><a class=lnlinks href=#hl-102-233>233</a>
</span><span class=lnt id=hl-102-234><a class=lnlinks href=#hl-102-234>234</a>
</span><span class=lnt id=hl-102-235><a class=lnlinks href=#hl-102-235>235</a>
</span><span class=lnt id=hl-102-236><a class=lnlinks href=#hl-102-236>236</a>
</span><span class=lnt id=hl-102-237><a class=lnlinks href=#hl-102-237>237</a>
</span><span class=lnt id=hl-102-238><a class=lnlinks href=#hl-102-238>238</a>
</span><span class=lnt id=hl-102-239><a class=lnlinks href=#hl-102-239>239</a>
</span><span class=lnt id=hl-102-240><a class=lnlinks href=#hl-102-240>240</a>
</span><span class=lnt id=hl-102-241><a class=lnlinks href=#hl-102-241>241</a>
</span><span class=lnt id=hl-102-242><a class=lnlinks href=#hl-102-242>242</a>
</span><span class=lnt id=hl-102-243><a class=lnlinks href=#hl-102-243>243</a>
</span><span class=lnt id=hl-102-244><a class=lnlinks href=#hl-102-244>244</a>
</span><span class=lnt id=hl-102-245><a class=lnlinks href=#hl-102-245>245</a>
</span><span class=lnt id=hl-102-246><a class=lnlinks href=#hl-102-246>246</a>
</span><span class=lnt id=hl-102-247><a class=lnlinks href=#hl-102-247>247</a>
</span><span class=lnt id=hl-102-248><a class=lnlinks href=#hl-102-248>248</a>
</span><span class=lnt id=hl-102-249><a class=lnlinks href=#hl-102-249>249</a>
</span><span class=lnt id=hl-102-250><a class=lnlinks href=#hl-102-250>250</a>
</span><span class=lnt id=hl-102-251><a class=lnlinks href=#hl-102-251>251</a>
</span><span class=lnt id=hl-102-252><a class=lnlinks href=#hl-102-252>252</a>
</span><span class=lnt id=hl-102-253><a class=lnlinks href=#hl-102-253>253</a>
</span><span class=lnt id=hl-102-254><a class=lnlinks href=#hl-102-254>254</a>
</span><span class=lnt id=hl-102-255><a class=lnlinks href=#hl-102-255>255</a>
</span><span class=lnt id=hl-102-256><a class=lnlinks href=#hl-102-256>256</a>
</span><span class=lnt id=hl-102-257><a class=lnlinks href=#hl-102-257>257</a>
</span><span class=lnt id=hl-102-258><a class=lnlinks href=#hl-102-258>258</a>
</span><span class=lnt id=hl-102-259><a class=lnlinks href=#hl-102-259>259</a>
</span><span class=lnt id=hl-102-260><a class=lnlinks href=#hl-102-260>260</a>
</span><span class=lnt id=hl-102-261><a class=lnlinks href=#hl-102-261>261</a>
</span><span class=lnt id=hl-102-262><a class=lnlinks href=#hl-102-262>262</a>
</span><span class=lnt id=hl-102-263><a class=lnlinks href=#hl-102-263>263</a>
</span><span class=lnt id=hl-102-264><a class=lnlinks href=#hl-102-264>264</a>
</span><span class=lnt id=hl-102-265><a class=lnlinks href=#hl-102-265>265</a>
</span><span class=lnt id=hl-102-266><a class=lnlinks href=#hl-102-266>266</a>
</span><span class=lnt id=hl-102-267><a class=lnlinks href=#hl-102-267>267</a>
</span><span class=lnt id=hl-102-268><a class=lnlinks href=#hl-102-268>268</a>
</span><span class=lnt id=hl-102-269><a class=lnlinks href=#hl-102-269>269</a>
</span><span class=lnt id=hl-102-270><a class=lnlinks href=#hl-102-270>270</a>
</span><span class=lnt id=hl-102-271><a class=lnlinks href=#hl-102-271>271</a>
</span><span class=lnt id=hl-102-272><a class=lnlinks href=#hl-102-272>272</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 처리 시스템의 RabbitMQ 구현&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rabbitmq_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;amqp://localhost&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        RabbitMQ 연결 초기화
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            rabbitmq_url: RabbitMQ 서버 URL
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>pika</span><span class=o>.</span><span class=n>URLParameters</span><span class=p>(</span><span class=n>rabbitmq_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_setup_exchanges_and_queues</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_setup_exchanges_and_queues</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Exchange와 Queue 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 Exchange 선언 (Topic 타입으로 유연한 라우팅)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;topic&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># 브로커 재시작 시에도 유지</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결제 결과 Exchange 선언</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;payment_results&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;direct&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 각 서비스별 Queue 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>queues</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;inventory_check&#39;</span><span class=p>,</span>    <span class=c1># 재고 확인</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_processing&#39;</span><span class=p>,</span> <span class=c1># 결제 처리</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;shipping_preparation&#39;</span><span class=p>,</span> <span class=c1># 배송 준비</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;notification_service&#39;</span>  <span class=c1># 알림 전송</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>queue_name</span> <span class=ow>in</span> <span class=n>queues</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># 메시지 영속성</span>
</span></span><span class=line><span class=cl>                <span class=n>arguments</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;x-max-priority&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>}</span>  <span class=c1># 우선순위 큐</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 바인딩 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;inventory_check&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.created&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;payment_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.created&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;payment_results&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;shipping_preparation&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;payment.success&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_order_created</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        새 주문 생성 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            order_data: 주문 데이터 (주문ID, 고객정보, 상품정보 등)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=s1>&#39;order_created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;total_amount&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 발행 (Topic Exchange 사용)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># 메시지 영속성</span>
</span></span><span class=line><span class=cl>                <span class=n>priority</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>       <span class=c1># 우선순위 설정</span>
</span></span><span class=line><span class=cl>                <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;source&#39;</span><span class=p>:</span> <span class=s1>&#39;order_service&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 생성 이벤트 발행: </span><span class=si>{</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_inventory_check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>callback_func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        재고 확인 처리
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            callback_func: 재고 확인 로직을 처리하는 콜백 함수
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 파싱</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 확인 처리 시작: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실제 재고 확인 로직 실행</span>
</span></span><span class=line><span class=cl>                <span class=n>inventory_result</span> <span class=o>=</span> <span class=n>callback_func</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>inventory_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 확인 성공 시 다음 단계 진행</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_publish_inventory_confirmed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 부족 시 주문 취소 처리</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_publish_order_cancelled</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=s1>&#39;재고 부족&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 처리 완료 확인</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 확인 처리 중 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 실패 시 재시도를 위해 NACK</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 컨슈머 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 한 번에 하나씩 처리</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;inventory_check&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>on_message_callback</span><span class=o>=</span><span class=n>wrapper</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;재고 확인 서비스 시작...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>callback_func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        결제 처리
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            callback_func: 결제 로직을 처리하는 콜백 함수
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;결제 처리 시작: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실제 결제 처리 로직 실행</span>
</span></span><span class=line><span class=cl>                <span class=n>payment_result</span> <span class=o>=</span> <span class=n>callback_func</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 성공 시 배송 준비 메시지 발행</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;payment_results&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;payment.success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                            <span class=o>**</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;payment_method&#39;</span><span class=p>:</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;payment_method&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                        <span class=p>}),</span>
</span></span><span class=line><span class=cl>                        <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 실패 시 주문 취소</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_publish_order_cancelled</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=s1>&#39;결제 실패&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;결제 처리 중 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;payment_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>on_message_callback</span><span class=o>=</span><span class=n>wrapper</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;결제 처리 서비스 시작...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_publish_inventory_confirmed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 확인 완료 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.inventory_confirmed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order_message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_publish_order_cancelled</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 취소 이벤트 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cancel_message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>**</span><span class=n>order_message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;cancellation_reason&#39;</span><span class=p>:</span> <span class=n>reason</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;cancelled_at&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;order_events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order.cancelled&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>cancel_message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;연결 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 주문 처리 시스템 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>processor</span> <span class=o>=</span> <span class=n>OrderProcessor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 새 주문 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>order_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=s1>&#39;ORD-2024-001&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=s1>&#39;CUST-12345&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s1>&#39;product_id&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD-001&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=mf>29.99</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s1>&#39;product_id&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD-002&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=mf>19.99</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=mf>79.97</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl>    <span class=n>processor</span><span class=o>.</span><span class=n>publish_order_created</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 재고 확인 로직 정의</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>check_inventory</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 재고 확인 로직 구현</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 간단한 재고 확인 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>  <span class=c1># 재고 부족 시뮬레이션</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;재고 부족&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s1>&#39;inventory_reserved&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 결제 처리 로직 정의</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_payment_logic</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 결제 처리 로직 구현</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=s1>&#39;PAY-2024-001&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;payment_method&#39;</span><span class=p>:</span> <span class=s1>&#39;credit_card&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 서비스 시작 (실제 환경에서는 별도 프로세스로 실행)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># processor.process_inventory_check(check_inventory)</span>
</span></span><span class=line><span class=cl>        <span class=c1># processor.process_payment(process_payment_logic)</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;서비스 종료...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>processor</span><span class=o>.</span><span class=n>close_connection</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>고려사항</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>메시지 구조</td><td>확장 가능하고 하위 호환성 있는 스키마</td><td>JSON Schema 사용, 버전 관리</td></tr><tr><td></td><td>큐 네이밍</td><td>일관된 명명 규칙</td><td>서비스명.작업명 형태 사용</td></tr><tr><td></td><td>Exchange 선택</td><td>적절한 Exchange 타입 선택</td><td>라우팅 복잡도에 따른 타입 결정</td></tr><tr><td>운영</td><td>모니터링</td><td>큐 길이, 처리량, 오류율 추적</td><td>Prometheus, Grafana 연동</td></tr><tr><td></td><td>백업</td><td>중요한 메시지 백업 전략</td><td>정기적인 큐 내용 백업</td></tr><tr><td></td><td>보안</td><td>접근 제어 및 데이터 암호화</td><td>TLS 사용, 사용자 권한 관리</td></tr><tr><td>성능</td><td>배치 처리</td><td>메시지 배치 처리로 성능 향상</td><td>적절한 배치 크기 설정</td></tr><tr><td></td><td>프리페치</td><td>컨슈머 프리페치 설정 최적화</td><td>처리 시간에 따른 조정</td></tr><tr><td></td><td>클러스터링</td><td>고가용성을 위한 클러스터 구성</td><td>최소 3개 노드 구성</td></tr></tbody></table><h2 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>고려사항</th><th>권장사항</th></tr></thead><tbody><tr><td>메모리</td><td>메시지 TTL</td><td>메시지 생존 시간 설정</td><td>비즈니스 요구사항에 따른 TTL 설정</td></tr><tr><td></td><td>큐 길이 제한</td><td>큐 최대 길이 설정</td><td>x-max-length 속성 사용</td></tr><tr><td></td><td>메시지 크기</td><td>큐 최대 메시지 크기 제한</td><td>큰 데이터는 외부 저장소 활용</td></tr><tr><td>네트워크</td><td>연결 풀링</td><td>연결 재사용으로 오버헤드 감소</td><td>연결 풀 라이브러리 사용</td></tr><tr><td></td><td>배치 확인</td><td>메시지 배치 확인으로 성능 향상</td><td>basic_ack 배치 처리</td></tr><tr><td></td><td>압축</td><td>메시지 압축으로 네트워크 사용량 감소</td><td>gzip 압축 적용</td></tr><tr><td>디스크</td><td>영속성 선택</td><td>필요한 메시지만 영속성 적용</td><td>중요도에 따른 선택적 적용</td></tr><tr><td></td><td>로그 로테이션</td><td>로그 파일 크기 관리</td><td>자동 로그 로테이션 설정</td></tr><tr><td></td><td>SSD 사용</td><td>빠른 디스크 I/O를 위한 SSD 사용</td><td>고성능 스토리지 사용</td></tr></tbody></table><h2 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>아키텍처</td><td>메시지 패턴</td><td>Saga 패턴</td><td>분산 트랜잭션 관리를 위한 패턴</td></tr><tr><td></td><td>이벤트 소싱</td><td>Event Sourcing</td><td>상태 변경을 이벤트로 저장하는 패턴</td></tr><tr><td></td><td>CQRS</td><td>Command Query Responsibility Segregation</td><td>명령과 조회 책임 분리</td></tr><tr><td>기술</td><td>프로토콜</td><td>AMQP 1.0</td><td>차세대 AMQP 프로토콜</td></tr><tr><td></td><td>스트리밍</td><td>RabbitMQ Streams</td><td>로그 기반 스트리밍 큐</td></tr><tr><td></td><td>페더레이션</td><td>Multi-DC 설정</td><td>다중 데이터센터 연동</td></tr><tr><td>운영</td><td>모니터링</td><td>분산 추적</td><td>메시지 플로우 추적</td></tr><tr><td></td><td>보안</td><td>OAuth2 통합</td><td>현대적인 인증 방식</td></tr><tr><td></td><td>백업</td><td>재해 복구</td><td>비즈니스 연속성 보장</td></tr><tr><td>성능</td><td>최적화</td><td>메시지 압축</td><td>네트워크 대역폭 절약</td></tr><tr><td></td><td>확장성</td><td>자동 스케일링</td><td>부하에 따른 자동 확장</td></tr><tr><td></td><td>캐싱</td><td>메시지 캐싱</td><td>자주 사용되는 메시지 캐싱</td></tr></tbody></table><h2 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>AMQP 프로토콜</td><td>메시지 프로토콜</td><td>메시지 큐잉 표준 프로토콜</td></tr><tr><td></td><td>메시지 브로커</td><td>중개자 패턴</td><td>시스템 간 메시지 중개 역할</td></tr><tr><td></td><td>비동기 통신</td><td>비동기 처리</td><td>동기 vs 비동기 통신 차이점</td></tr><tr><td>아키텍처</td><td>Exchange 타입</td><td>라우팅 방식</td><td>Direct, Topic, Fanout, Headers</td></tr><tr><td></td><td>큐 관리</td><td>메시지 저장소</td><td>큐 생성, 관리, 삭제</td></tr><tr><td></td><td>바인딩</td><td>연결 관계</td><td>Exchange와 Queue 연결</td></tr><tr><td>고급</td><td>클러스터링</td><td>고가용성</td><td>다중 노드 클러스터 구성</td></tr><tr><td></td><td>페더레이션</td><td>분산 환경</td><td>지리적 분산 브로커 연결</td></tr><tr><td></td><td>미러링</td><td>복제</td><td>큐 미러링을 통한 데이터 복제</td></tr><tr><td>운영</td><td>모니터링</td><td>상태 추적</td><td>성능 메트릭 수집 및 분석</td></tr><tr><td></td><td>보안</td><td>접근 제어</td><td>사용자 인증 및 권한 관리</td></tr><tr><td></td><td>백업</td><td>데이터 보호</td><td>메시지 및 설정 백업</td></tr><tr><td>개발</td><td>클라이언트 라이브러리</td><td>프로그래밍</td><td>다양한 언어별 클라이언트</td></tr><tr><td></td><td>메시지 직렬화</td><td>데이터 변환</td><td>JSON, MessagePack, Protobuf</td></tr><tr><td></td><td>오류 처리</td><td>예외 상황</td><td>재시도, 데드 레터 큐</td></tr></tbody></table><hr><h2 id=용어-정리-5>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-5>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>프로토콜</td><td>AMQP (Advanced Message Queuing Protocol)</td><td>메시지 지향 미들웨어를 위한 오픈 표준 프로토콜</td></tr><tr><td></td><td>MQTT (Message Queuing Telemetry Transport)</td><td>경량 메시징 프로토콜, IoT 환경에 적합</td></tr><tr><td></td><td>STOMP (Simple Text Oriented Messaging Protocol)</td><td>단순 텍스트 기반 메시징 프로토콜</td></tr><tr><td>구성 요소</td><td>Vhost (Virtual Host)</td><td>논리적인 브로커 분리 단위</td></tr><tr><td></td><td>TTL (Time To Live)</td><td>메시지 생존 시간</td></tr><tr><td></td><td>DLX (Dead Letter Exchange)</td><td>처리 실패 메시지 전달 Exchange</td></tr><tr><td></td><td>DLQ (Dead Letter Queue)</td><td>처리 실패 메시지 저장 큐</td></tr><tr><td>운영</td><td>HA (High Availability)</td><td>고가용성</td></tr><tr><td></td><td>QoS (Quality of Service)</td><td>서비스 품질</td></tr><tr><td></td><td>Prefetch</td><td>미리 가져올 메시지 개수</td></tr><tr><td></td><td>Acknowledgment</td><td>메시지 수신 확인</td></tr><tr><td>패턴</td><td>Publisher/Subscriber</td><td>발행자/구독자 패턴</td></tr><tr><td></td><td>Request/Reply</td><td>요청/응답 패턴</td></tr><tr><td></td><td>Work Queue</td><td>작업 큐 패턴</td></tr><tr><td></td><td>RPC (Remote Procedure Call)</td><td>원격 프로시저 호출</td></tr></tbody></table><hr><h2 id=참고-및-출처-4>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-4>#</a></h2><ul><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서</a></li><li><a href=https://www.rabbitmq.com/tutorials/amqp-concepts.html>AMQP 0-9-1 모델 설명</a></li><li><a href=https://www.rabbitmq.com/getstarted.html>RabbitMQ 튜토리얼</a></li><li><a href=https://www.rabbitmq.com/clustering.html>RabbitMQ 클러스터링 가이드</a></li><li><a href=https://www.rabbitmq.com/production-checklist.html>RabbitMQ 성능 최적화</a></li><li><a href=https://www.rabbitmq.com/monitoring.html>RabbitMQ 모니터링</a></li><li><a href=https://www.erlang.org/doc/>Erlang OTP 문서</a></li><li><a href=https://www.enterpriseintegrationpatterns.com/patterns/messaging/>메시지 큐잉 패턴</a></li></ul><hr><p>RabbitMQ는 Erlang 언어로 작성된 오픈 소스 메시지 브로커 시스템으로, AMQP(Advanced Message Queuing Protocol)를 구현하고 있다. 2007년에 처음 출시되었으며, 현재는 VMware의 자회사인 Pivotal Software에서 관리하고 있다. RabbitMQ는 안정성, 확장성, 다양한 메시징 패턴 지원 등으로 인해 많은 기업들이 메시지 기반 아키텍처의 핵심 컴포넌트로 채택하고 있다.</p><h3 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h3><ul><li><strong>표준 프로토콜 지원</strong>: AMQP 0-9-1을 기본으로 하며, STOMP, MQTT, HTTP 등 다양한 프로토콜을 플러그인을 통해 지원한다.</li><li><strong>유연한 라우팅</strong>: Exchange와 바인딩을 통한 강력하고 유연한 메시지 라우팅 기능을 제공한다.</li><li><strong>클러스터링</strong>: 높은 가용성과 처리량을 위한 내장 클러스터링 기능을 제공한다.</li><li><strong>관리 인터페이스</strong>: 직관적인 웹 기반 관리 UI와 HTTP API를 제공한다.</li><li><strong>플러그인 아키텍처</strong>: 기능을 확장할 수 있는 다양한 플러그인을 지원한다.</li><li><strong>다양한 언어 지원</strong>: Java, Python, Ruby, PHP, C#, JavaScript 등 다양한 언어의 클라이언트 라이브러리를 제공한다.</li></ul><h3 id=rabbitmq의-주요-사용-사례>RabbitMQ의 주요 사용 사례<a hidden class=anchor aria-hidden=true href=#rabbitmq의-주요-사용-사례>#</a></h3><ul><li><strong>비동기 처리</strong>: 시간이 오래 걸리는 작업을 비동기적으로 처리할 수 있다.</li><li><strong>서비스 간 통신</strong>: 마이크로서비스 아키텍처에서 서비스 간 통신 채널로 활용된다.</li><li><strong>부하 분산</strong>: 작업을 여러 워커에게 분산시켜 시스템의 부하를 균등하게 분배한다.</li><li><strong>이벤트 기반 아키텍처</strong>: 이벤트를 생성하고 소비하는 이벤트 기반 시스템의 기반이 된다.</li><li><strong>데이터 스트리밍</strong>: 실시간 데이터 스트림을 처리하는 데 사용된다.</li></ul><h3 id=rabbitmq의-핵심-개념>RabbitMQ의 핵심 개념<a hidden class=anchor aria-hidden=true href=#rabbitmq의-핵심-개념>#</a></h3><ol><li><p>AMQP 프로토콜<br>AMQP(Advanced Message Queuing Protocol)는 메시지 지향 미들웨어를 위한 개방형 표준 프로토콜이다. AMQP의 주요 개념을 이해하는 것은 RabbitMQ를 효과적으로 사용하기 위한 기본이다.</p></li><li><p>RabbitMQ 아키텍처<br>RabbitMQ의 아키텍처는 다음 구성 요소로 이루어져 있다:</p><ol><li>프로듀서(Producer)<br>메시지를 생성하여 RabbitMQ로 전송하는 애플리케이션이다. 프로듀서는 메시지를 생성하고 Exchange에 발행한다.</li><li>컨슈머(Consumer)<br>RabbitMQ로부터 메시지를 수신하고 처리하는 애플리케이션이다. 컨슈머는 큐에서 메시지를 구독하여 처리한다.</li><li>Exchange<br>프로듀서로부터 받은 메시지를 큐로 라우팅하는 라우터 역할을 한다. Exchange 타입에 따라 메시지 라우팅 방식이 달라진다.<br>Exchange 타입:</li></ol><ul><li><strong>Direct Exchange</strong>: 라우팅 키가 정확히 일치하는 큐에 메시지를 전달한다.</li><li><strong>Fanout Exchange</strong>: 바인딩된 모든 큐에 메시지를 브로드캐스트한다.</li><li><strong>Topic Exchange</strong>: 라우팅 키 패턴이 일치하는 큐에 메시지를 전달한다.</li><li><strong>Headers Exchange</strong>: 메시지 헤더 속성을 기반으로 라우팅한다.</li></ul><ol start=4><li>큐(Queue)<br>메시지가 저장되는 버퍼이다. 컨슈머는 큐에서 메시지를 가져와 처리한다. 큐는 FIFO(First In, First Out) 방식으로 작동한다.</li><li>바인딩(Binding)<br>Exchange와 큐 사이의 관계를 정의한다. 바인딩은 라우팅 키(Routing Key)를 사용하여 Exchange가 메시지를 어떤 큐로 전달할지 결정하는 규칙을 설정한다.</li><li>가상 호스트(Virtual Host)<br>리소스(Exchange, 큐 등)를 논리적으로 그룹화하는 네임스페이스이다. 가상 호스트는 자체 사용자 권한을 가지며, 서로 다른 애플리케이션이 같은 RabbitMQ 서버를 공유할 수 있게 한다.</li></ol></li><li><p>메시징 패턴<br>RabbitMQ에서 구현할 수 있는 주요 메시징 패턴:</p><ol><li><p>작업 큐(Work Queue)<br>시간이 오래 걸리는 작업을 여러 워커에게 분산시키는 패턴이다. 라운드 로빈 방식으로 작업을 분배한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-103-1><a class=lnlinks href=#hl-103-1> 1</a>
</span><span class=lnt id=hl-103-2><a class=lnlinks href=#hl-103-2> 2</a>
</span><span class=lnt id=hl-103-3><a class=lnlinks href=#hl-103-3> 3</a>
</span><span class=lnt id=hl-103-4><a class=lnlinks href=#hl-103-4> 4</a>
</span><span class=lnt id=hl-103-5><a class=lnlinks href=#hl-103-5> 5</a>
</span><span class=lnt id=hl-103-6><a class=lnlinks href=#hl-103-6> 6</a>
</span><span class=lnt id=hl-103-7><a class=lnlinks href=#hl-103-7> 7</a>
</span><span class=lnt id=hl-103-8><a class=lnlinks href=#hl-103-8> 8</a>
</span><span class=lnt id=hl-103-9><a class=lnlinks href=#hl-103-9> 9</a>
</span><span class=lnt id=hl-103-10><a class=lnlinks href=#hl-103-10>10</a>
</span><span class=lnt id=hl-103-11><a class=lnlinks href=#hl-103-11>11</a>
</span><span class=lnt id=hl-103-12><a class=lnlinks href=#hl-103-12>12</a>
</span><span class=lnt id=hl-103-13><a class=lnlinks href=#hl-103-13>13</a>
</span><span class=lnt id=hl-103-14><a class=lnlinks href=#hl-103-14>14</a>
</span><span class=lnt id=hl-103-15><a class=lnlinks href=#hl-103-15>15</a>
</span><span class=lnt id=hl-103-16><a class=lnlinks href=#hl-103-16>16</a>
</span><span class=lnt id=hl-103-17><a class=lnlinks href=#hl-103-17>17</a>
</span><span class=lnt id=hl-103-18><a class=lnlinks href=#hl-103-18>18</a>
</span><span class=lnt id=hl-103-19><a class=lnlinks href=#hl-103-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## Python 작업 큐 예제 (생산자)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;복잡한 작업 내용…&#34;</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>body</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 메시지 지속성 설정</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; [x] </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2> 전송됨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-104-1><a class=lnlinks href=#hl-104-1> 1</a>
</span><span class=lnt id=hl-104-2><a class=lnlinks href=#hl-104-2> 2</a>
</span><span class=lnt id=hl-104-3><a class=lnlinks href=#hl-104-3> 3</a>
</span><span class=lnt id=hl-104-4><a class=lnlinks href=#hl-104-4> 4</a>
</span><span class=lnt id=hl-104-5><a class=lnlinks href=#hl-104-5> 5</a>
</span><span class=lnt id=hl-104-6><a class=lnlinks href=#hl-104-6> 6</a>
</span><span class=lnt id=hl-104-7><a class=lnlinks href=#hl-104-7> 7</a>
</span><span class=lnt id=hl-104-8><a class=lnlinks href=#hl-104-8> 8</a>
</span><span class=lnt id=hl-104-9><a class=lnlinks href=#hl-104-9> 9</a>
</span><span class=lnt id=hl-104-10><a class=lnlinks href=#hl-104-10>10</a>
</span><span class=lnt id=hl-104-11><a class=lnlinks href=#hl-104-11>11</a>
</span><span class=lnt id=hl-104-12><a class=lnlinks href=#hl-104-12>12</a>
</span><span class=lnt id=hl-104-13><a class=lnlinks href=#hl-104-13>13</a>
</span><span class=lnt id=hl-104-14><a class=lnlinks href=#hl-104-14>14</a>
</span><span class=lnt id=hl-104-15><a class=lnlinks href=#hl-104-15>15</a>
</span><span class=lnt id=hl-104-16><a class=lnlinks href=#hl-104-16>16</a>
</span><span class=lnt id=hl-104-17><a class=lnlinks href=#hl-104-17>17</a>
</span><span class=lnt id=hl-104-18><a class=lnlinks href=#hl-104-18>18</a>
</span><span class=lnt id=hl-104-19><a class=lnlinks href=#hl-104-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python 작업 큐 예제 (소비자)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39; [*] 메시지를 기다리는 중. 종료하려면 CTRL+C를 누르세요&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl> <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; [x] </span><span class=si>{</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2> 수신됨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>))</span>  <span class=c1># 메시지 내 점의 개수만큼 대기</span>
</span></span><span class=line><span class=cl> <span class=nb>print</span><span class=p>(</span><span class=s2>&#34; [x] 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 워커에게 한 번에 하나의 메시지만 할당</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;task_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li><p>구독(Publish/Subscribe)<br>하나의 메시지를 여러 소비자에게 브로드캐스트하는 패턴이다. Fanout Exchange를 사용한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-105-1><a class=lnlinks href=#hl-105-1> 1</a>
</span><span class=lnt id=hl-105-2><a class=lnlinks href=#hl-105-2> 2</a>
</span><span class=lnt id=hl-105-3><a class=lnlinks href=#hl-105-3> 3</a>
</span><span class=lnt id=hl-105-4><a class=lnlinks href=#hl-105-4> 4</a>
</span><span class=lnt id=hl-105-5><a class=lnlinks href=#hl-105-5> 5</a>
</span><span class=lnt id=hl-105-6><a class=lnlinks href=#hl-105-6> 6</a>
</span><span class=lnt id=hl-105-7><a class=lnlinks href=#hl-105-7> 7</a>
</span><span class=lnt id=hl-105-8><a class=lnlinks href=#hl-105-8> 8</a>
</span><span class=lnt id=hl-105-9><a class=lnlinks href=#hl-105-9> 9</a>
</span><span class=lnt id=hl-105-10><a class=lnlinks href=#hl-105-10>10</a>
</span><span class=lnt id=hl-105-11><a class=lnlinks href=#hl-105-11>11</a>
</span><span class=lnt id=hl-105-12><a class=lnlinks href=#hl-105-12>12</a>
</span><span class=lnt id=hl-105-13><a class=lnlinks href=#hl-105-13>13</a>
</span><span class=lnt id=hl-105-14><a class=lnlinks href=#hl-105-14>14</a>
</span><span class=lnt id=hl-105-15><a class=lnlinks href=#hl-105-15>15</a>
</span><span class=lnt id=hl-105-16><a class=lnlinks href=#hl-105-16>16</a>
</span><span class=lnt id=hl-105-17><a class=lnlinks href=#hl-105-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python 발행/구독 예제 (발행자)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;정보: 이것은 로그 메시지입니다.&#34;</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=n>message</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; [x] </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2> 전송됨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-106-1><a class=lnlinks href=#hl-106-1> 1</a>
</span><span class=lnt id=hl-106-2><a class=lnlinks href=#hl-106-2> 2</a>
</span><span class=lnt id=hl-106-3><a class=lnlinks href=#hl-106-3> 3</a>
</span><span class=lnt id=hl-106-4><a class=lnlinks href=#hl-106-4> 4</a>
</span><span class=lnt id=hl-106-5><a class=lnlinks href=#hl-106-5> 5</a>
</span><span class=lnt id=hl-106-6><a class=lnlinks href=#hl-106-6> 6</a>
</span><span class=lnt id=hl-106-7><a class=lnlinks href=#hl-106-7> 7</a>
</span><span class=lnt id=hl-106-8><a class=lnlinks href=#hl-106-8> 8</a>
</span><span class=lnt id=hl-106-9><a class=lnlinks href=#hl-106-9> 9</a>
</span><span class=lnt id=hl-106-10><a class=lnlinks href=#hl-106-10>10</a>
</span><span class=lnt id=hl-106-11><a class=lnlinks href=#hl-106-11>11</a>
</span><span class=lnt id=hl-106-12><a class=lnlinks href=#hl-106-12>12</a>
</span><span class=lnt id=hl-106-13><a class=lnlinks href=#hl-106-13>13</a>
</span><span class=lnt id=hl-106-14><a class=lnlinks href=#hl-106-14>14</a>
</span><span class=lnt id=hl-106-15><a class=lnlinks href=#hl-106-15>15</a>
</span><span class=lnt id=hl-106-16><a class=lnlinks href=#hl-106-16>16</a>
</span><span class=lnt id=hl-106-17><a class=lnlinks href=#hl-106-17>17</a>
</span><span class=lnt id=hl-106-18><a class=lnlinks href=#hl-106-18>18</a>
</span><span class=lnt id=hl-106-19><a class=lnlinks href=#hl-106-19>19</a>
</span><span class=lnt id=hl-106-20><a class=lnlinks href=#hl-106-20>20</a>
</span><span class=lnt id=hl-106-21><a class=lnlinks href=#hl-106-21>21</a>
</span><span class=lnt id=hl-106-22><a class=lnlinks href=#hl-106-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python 발행/구독 예제 (구독자)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>exclusive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>queue_name</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39; [*] 로그를 기다리는 중. 종료하려면 CTRL+C를 누르세요&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; [x] </span><span class=si>{</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></li></ol></li><li><p>라우팅(Routing)<br>특정 기준에 따라 메시지를 선택적으로 수신하는 패턴이다. Direct Exchange를 사용한다.</p></li><li><p>토픽(Topic)<br>여러 기준에 따라 메시지를 패턴 매칭으로 라우팅하는 패턴이다. Topic Exchange를 사용한다.</p></li><li><p>RPC(Remote Procedure Call)<br>클라이언트가 요청을 보내고 응답을 기다리는 동기적인 패턴이다.</p></li></ol></li></ol><h3 id=rabbitmq-설치-및-기본-구성>RabbitMQ 설치 및 기본 구성<a hidden class=anchor aria-hidden=true href=#rabbitmq-설치-및-기본-구성>#</a></h3><h4 id=단독-서버-설치>단독 서버 설치<a hidden class=anchor aria-hidden=true href=#단독-서버-설치>#</a></h4><h5 id=linux에-설치>Linux에 설치<a hidden class=anchor aria-hidden=true href=#linux에-설치>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-107-1><a class=lnlinks href=#hl-107-1>1</a>
</span><span class=lnt id=hl-107-2><a class=lnlinks href=#hl-107-2>2</a>
</span><span class=lnt id=hl-107-3><a class=lnlinks href=#hl-107-3>3</a>
</span><span class=lnt id=hl-107-4><a class=lnlinks href=#hl-107-4>4</a>
</span><span class=lnt id=hl-107-5><a class=lnlinks href=#hl-107-5>5</a>
</span><span class=lnt id=hl-107-6><a class=lnlinks href=#hl-107-6>6</a>
</span><span class=lnt id=hl-107-7><a class=lnlinks href=#hl-107-7>7</a>
</span><span class=lnt id=hl-107-8><a class=lnlinks href=#hl-107-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Debian/Ubuntu</span>
</span></span><span class=line><span class=cl>sudo apt-get install rabbitmq-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 서비스 시작</span>
</span></span><span class=line><span class=cl>sudo systemctl start rabbitmq-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 부팅 시 자동 시작</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> rabbitmq-server
</span></span></code></pre></td></tr></table></div></div><h5 id=docker를-사용한-설치>Docker를 사용한 설치<a hidden class=anchor aria-hidden=true href=#docker를-사용한-설치>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-108-1><a class=lnlinks href=#hl-108-1>1</a>
</span><span class=lnt id=hl-108-2><a class=lnlinks href=#hl-108-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># RabbitMQ 도커 이미지 실행</span>
</span></span><span class=line><span class=cl>docker run -d --name my-rabbit -p 5672:5672 -p 15672:15672 rabbitmq:3-management
</span></span></code></pre></td></tr></table></div></div><h4 id=관리-인터페이스-활성화>관리 인터페이스 활성화<a hidden class=anchor aria-hidden=true href=#관리-인터페이스-활성화>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-109-1><a class=lnlinks href=#hl-109-1>1</a>
</span><span class=lnt id=hl-109-2><a class=lnlinks href=#hl-109-2>2</a>
</span><span class=lnt id=hl-109-3><a class=lnlinks href=#hl-109-3>3</a>
</span><span class=lnt id=hl-109-4><a class=lnlinks href=#hl-109-4>4</a>
</span><span class=lnt id=hl-109-5><a class=lnlinks href=#hl-109-5>5</a>
</span><span class=lnt id=hl-109-6><a class=lnlinks href=#hl-109-6>6</a>
</span><span class=lnt id=hl-109-7><a class=lnlinks href=#hl-109-7>7</a>
</span><span class=lnt id=hl-109-8><a class=lnlinks href=#hl-109-8>8</a>
</span><span class=lnt id=hl-109-9><a class=lnlinks href=#hl-109-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 관리 플러그인 활성화</span>
</span></span><span class=line><span class=cl>sudo rabbitmq-plugins <span class=nb>enable</span> rabbitmq_management
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용자 추가</span>
</span></span><span class=line><span class=cl>sudo rabbitmqctl add_user admin strongpassword
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 관리자 권한 부여</span>
</span></span><span class=line><span class=cl>sudo rabbitmqctl set_user_tags admin administrator
</span></span><span class=line><span class=cl>sudo rabbitmqctl set_permissions -p / admin <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>관리 인터페이스는 <a href=http://localhost:15672>http://localhost:15672</a>에서> 접근할 수 있으며, 기본 사용자 이름과 비밀번호는 guest/guest이다(로컬호스트에서만 작동).</p><h3 id=클러스터-설정>클러스터 설정<a hidden class=anchor aria-hidden=true href=#클러스터-설정>#</a></h3><h4 id=기본-클러스터-설정>기본 클러스터 설정<a hidden class=anchor aria-hidden=true href=#기본-클러스터-설정>#</a></h4><p>클러스터는 최소 3개의 노드로 구성하는 것이 좋다. 각 노드에서 RabbitMQ를 설치한 후 다음 단계를 따른다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-110-1><a class=lnlinks href=#hl-110-1> 1</a>
</span><span class=lnt id=hl-110-2><a class=lnlinks href=#hl-110-2> 2</a>
</span><span class=lnt id=hl-110-3><a class=lnlinks href=#hl-110-3> 3</a>
</span><span class=lnt id=hl-110-4><a class=lnlinks href=#hl-110-4> 4</a>
</span><span class=lnt id=hl-110-5><a class=lnlinks href=#hl-110-5> 5</a>
</span><span class=lnt id=hl-110-6><a class=lnlinks href=#hl-110-6> 6</a>
</span><span class=lnt id=hl-110-7><a class=lnlinks href=#hl-110-7> 7</a>
</span><span class=lnt id=hl-110-8><a class=lnlinks href=#hl-110-8> 8</a>
</span><span class=lnt id=hl-110-9><a class=lnlinks href=#hl-110-9> 9</a>
</span><span class=lnt id=hl-110-10><a class=lnlinks href=#hl-110-10>10</a>
</span><span class=lnt id=hl-110-11><a class=lnlinks href=#hl-110-11>11</a>
</span><span class=lnt id=hl-110-12><a class=lnlinks href=#hl-110-12>12</a>
</span><span class=lnt id=hl-110-13><a class=lnlinks href=#hl-110-13>13</a>
</span><span class=lnt id=hl-110-14><a class=lnlinks href=#hl-110-14>14</a>
</span><span class=lnt id=hl-110-15><a class=lnlinks href=#hl-110-15>15</a>
</span><span class=lnt id=hl-110-16><a class=lnlinks href=#hl-110-16>16</a>
</span><span class=lnt id=hl-110-17><a class=lnlinks href=#hl-110-17>17</a>
</span><span class=lnt id=hl-110-18><a class=lnlinks href=#hl-110-18>18</a>
</span><span class=lnt id=hl-110-19><a class=lnlinks href=#hl-110-19>19</a>
</span><span class=lnt id=hl-110-20><a class=lnlinks href=#hl-110-20>20</a>
</span><span class=lnt id=hl-110-21><a class=lnlinks href=#hl-110-21>21</a>
</span><span class=lnt id=hl-110-22><a class=lnlinks href=#hl-110-22>22</a>
</span><span class=lnt id=hl-110-23><a class=lnlinks href=#hl-110-23>23</a>
</span><span class=lnt id=hl-110-24><a class=lnlinks href=#hl-110-24>24</a>
</span><span class=lnt id=hl-110-25><a class=lnlinks href=#hl-110-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 노드 1에서 Erlang 쿠키 확인</span>
</span></span><span class=line><span class=cl>cat /var/lib/rabbitmq/.erlang.cookie
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 모든 노드에서 동일한 Erlang 쿠키 설정</span>
</span></span><span class=line><span class=cl><span class=c1># 노드 2, 3에서:</span>
</span></span><span class=line><span class=cl>sudo service rabbitmq-server stop
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;ERLANG_COOKIE_FROM_NODE_1&#34;</span> <span class=p>|</span> sudo tee /var/lib/rabbitmq/.erlang.cookie
</span></span><span class=line><span class=cl>sudo chown rabbitmq:rabbitmq /var/lib/rabbitmq/.erlang.cookie
</span></span><span class=line><span class=cl>sudo chmod <span class=m>400</span> /var/lib/rabbitmq/.erlang.cookie
</span></span><span class=line><span class=cl>sudo service rabbitmq-server start
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 노드 2에서 노드 1에 조인</span>
</span></span><span class=line><span class=cl>sudo rabbitmqctl stop_app
</span></span><span class=line><span class=cl>sudo rabbitmqctl reset
</span></span><span class=line><span class=cl>sudo rabbitmqctl join_cluster rabbit@node1
</span></span><span class=line><span class=cl>sudo rabbitmqctl start_app
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 노드 3에서도 동일하게 수행</span>
</span></span><span class=line><span class=cl>sudo rabbitmqctl stop_app
</span></span><span class=line><span class=cl>sudo rabbitmqctl reset
</span></span><span class=line><span class=cl>sudo rabbitmqctl join_cluster rabbit@node1
</span></span><span class=line><span class=cl>sudo rabbitmqctl start_app
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 클러스터 상태 확인</span>
</span></span><span class=line><span class=cl>sudo rabbitmqctl cluster_status
</span></span></code></pre></td></tr></table></div></div><h4 id=고가용성-설정>고가용성 설정<a hidden class=anchor aria-hidden=true href=#고가용성-설정>#</a></h4><p>미러링 큐를 통해 고가용성을 확보할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-111-1><a class=lnlinks href=#hl-111-1>1</a>
</span><span class=lnt id=hl-111-2><a class=lnlinks href=#hl-111-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 모든 큐를 자동으로 미러링하는 정책 설정</span>
</span></span><span class=line><span class=cl>sudo rabbitmqctl set_policy ha-all <span class=s2>&#34;^&#34;</span> <span class=s1>&#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=주요-구성-파일>주요 구성 파일<a hidden class=anchor aria-hidden=true href=#주요-구성-파일>#</a></h4><p>RabbitMQ의 주요 구성 파일은 다음과 같다:</p><ul><li><code>/etc/rabbitmq/rabbitmq.conf</code>: 기본 구성 파일</li><li><code>/etc/rabbitmq/advanced.config</code>: 고급 Erlang 구성</li><li><code>/etc/rabbitmq/rabbitmq-env.conf</code>: 환경 변수 설정</li></ul><p>중요한 구성 매개변수:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-112-1><a class=lnlinks href=#hl-112-1>1</a>
</span><span class=lnt id=hl-112-2><a class=lnlinks href=#hl-112-2>2</a>
</span><span class=lnt id=hl-112-3><a class=lnlinks href=#hl-112-3>3</a>
</span><span class=lnt id=hl-112-4><a class=lnlinks href=#hl-112-4>4</a>
</span><span class=lnt id=hl-112-5><a class=lnlinks href=#hl-112-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rabbitmq.conf 예제
</span></span><span class=line><span class=cl>listeners.tcp.default = 5672
</span></span><span class=line><span class=cl>management.tcp.port = 15672
</span></span><span class=line><span class=cl>vm_memory_high_watermark.relative = 0.4
</span></span><span class=line><span class=cl>disk_free_limit.absolute = 1GB
</span></span></code></pre></td></tr></table></div></div><h3 id=rabbitmq-클라이언트-프로그래밍>RabbitMQ 클라이언트 프로그래밍<a hidden class=anchor aria-hidden=true href=#rabbitmq-클라이언트-프로그래밍>#</a></h3><h4 id=java-클라이언트>Java 클라이언트<a hidden class=anchor aria-hidden=true href=#java-클라이언트>#</a></h4><p>의존성 추가 (Maven):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-113-1><a class=lnlinks href=#hl-113-1>1</a>
</span><span class=lnt id=hl-113-2><a class=lnlinks href=#hl-113-2>2</a>
</span><span class=lnt id=hl-113-3><a class=lnlinks href=#hl-113-3>3</a>
</span><span class=lnt id=hl-113-4><a class=lnlinks href=#hl-113-4>4</a>
</span><span class=lnt id=hl-113-5><a class=lnlinks href=#hl-113-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>com.rabbitmq<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>amqp-client<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>5.15.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>기본 생산자 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-114-1><a class=lnlinks href=#hl-114-1> 1</a>
</span><span class=lnt id=hl-114-2><a class=lnlinks href=#hl-114-2> 2</a>
</span><span class=lnt id=hl-114-3><a class=lnlinks href=#hl-114-3> 3</a>
</span><span class=lnt id=hl-114-4><a class=lnlinks href=#hl-114-4> 4</a>
</span><span class=lnt id=hl-114-5><a class=lnlinks href=#hl-114-5> 5</a>
</span><span class=lnt id=hl-114-6><a class=lnlinks href=#hl-114-6> 6</a>
</span><span class=lnt id=hl-114-7><a class=lnlinks href=#hl-114-7> 7</a>
</span><span class=lnt id=hl-114-8><a class=lnlinks href=#hl-114-8> 8</a>
</span><span class=lnt id=hl-114-9><a class=lnlinks href=#hl-114-9> 9</a>
</span><span class=lnt id=hl-114-10><a class=lnlinks href=#hl-114-10>10</a>
</span><span class=lnt id=hl-114-11><a class=lnlinks href=#hl-114-11>11</a>
</span><span class=lnt id=hl-114-12><a class=lnlinks href=#hl-114-12>12</a>
</span><span class=lnt id=hl-114-13><a class=lnlinks href=#hl-114-13>13</a>
</span><span class=lnt id=hl-114-14><a class=lnlinks href=#hl-114-14>14</a>
</span><span class=lnt id=hl-114-15><a class=lnlinks href=#hl-114-15>15</a>
</span><span class=lnt id=hl-114-16><a class=lnlinks href=#hl-114-16>16</a>
</span><span class=lnt id=hl-114-17><a class=lnlinks href=#hl-114-17>17</a>
</span><span class=lnt id=hl-114-18><a class=lnlinks href=#hl-114-18>18</a>
</span><span class=lnt id=hl-114-19><a class=lnlinks href=#hl-114-19>19</a>
</span><span class=lnt id=hl-114-20><a class=lnlinks href=#hl-114-20>20</a>
</span><span class=lnt id=hl-114-21><a class=lnlinks href=#hl-114-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>com.rabbitmq.client.Channel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.rabbitmq.client.Connection</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.rabbitmq.client.ConnectionFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Producer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>QUEUE_NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConnectionFactory</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setHost</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>factory</span><span class=p>.</span><span class=na>newConnection</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>             </span><span class=n>Channel</span><span class=w> </span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=p>.</span><span class=na>createChannel</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World!&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34; [x] Sent &#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#39;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>기본 소비자 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-115-1><a class=lnlinks href=#hl-115-1> 1</a>
</span><span class=lnt id=hl-115-2><a class=lnlinks href=#hl-115-2> 2</a>
</span><span class=lnt id=hl-115-3><a class=lnlinks href=#hl-115-3> 3</a>
</span><span class=lnt id=hl-115-4><a class=lnlinks href=#hl-115-4> 4</a>
</span><span class=lnt id=hl-115-5><a class=lnlinks href=#hl-115-5> 5</a>
</span><span class=lnt id=hl-115-6><a class=lnlinks href=#hl-115-6> 6</a>
</span><span class=lnt id=hl-115-7><a class=lnlinks href=#hl-115-7> 7</a>
</span><span class=lnt id=hl-115-8><a class=lnlinks href=#hl-115-8> 8</a>
</span><span class=lnt id=hl-115-9><a class=lnlinks href=#hl-115-9> 9</a>
</span><span class=lnt id=hl-115-10><a class=lnlinks href=#hl-115-10>10</a>
</span><span class=lnt id=hl-115-11><a class=lnlinks href=#hl-115-11>11</a>
</span><span class=lnt id=hl-115-12><a class=lnlinks href=#hl-115-12>12</a>
</span><span class=lnt id=hl-115-13><a class=lnlinks href=#hl-115-13>13</a>
</span><span class=lnt id=hl-115-14><a class=lnlinks href=#hl-115-14>14</a>
</span><span class=lnt id=hl-115-15><a class=lnlinks href=#hl-115-15>15</a>
</span><span class=lnt id=hl-115-16><a class=lnlinks href=#hl-115-16>16</a>
</span><span class=lnt id=hl-115-17><a class=lnlinks href=#hl-115-17>17</a>
</span><span class=lnt id=hl-115-18><a class=lnlinks href=#hl-115-18>18</a>
</span><span class=lnt id=hl-115-19><a class=lnlinks href=#hl-115-19>19</a>
</span><span class=lnt id=hl-115-20><a class=lnlinks href=#hl-115-20>20</a>
</span><span class=lnt id=hl-115-21><a class=lnlinks href=#hl-115-21>21</a>
</span><span class=lnt id=hl-115-22><a class=lnlinks href=#hl-115-22>22</a>
</span><span class=lnt id=hl-115-23><a class=lnlinks href=#hl-115-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>com.rabbitmq.client.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Consumer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>QUEUE_NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConnectionFactory</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setHost</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>factory</span><span class=p>.</span><span class=na>newConnection</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Channel</span><span class=w> </span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=p>.</span><span class=na>createChannel</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34; [*] Waiting for messages. To exit press CTRL+C&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DeliverCallback</span><span class=w> </span><span class=n>deliverCallback</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>consumerTag</span><span class=p>,</span><span class=w> </span><span class=n>delivery</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>delivery</span><span class=p>.</span><span class=na>getBody</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;UTF-8&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34; [x] Received &#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#39;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>channel</span><span class=p>.</span><span class=na>basicConsume</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>deliverCallback</span><span class=p>,</span><span class=w> </span><span class=n>consumerTag</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=spring-amqp-사용>Spring AMQP 사용<a hidden class=anchor aria-hidden=true href=#spring-amqp-사용>#</a></h4><p>Spring Boot 애플리케이션에서는 Spring AMQP를 통해 더 쉽게 RabbitMQ를 사용할 수 있다.</p><p>의존성 추가 (Gradle):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-116-1><a class=lnlinks href=#hl-116-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-amqp&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>RabbitMQ 구성:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-117-1><a class=lnlinks href=#hl-117-1> 1</a>
</span><span class=lnt id=hl-117-2><a class=lnlinks href=#hl-117-2> 2</a>
</span><span class=lnt id=hl-117-3><a class=lnlinks href=#hl-117-3> 3</a>
</span><span class=lnt id=hl-117-4><a class=lnlinks href=#hl-117-4> 4</a>
</span><span class=lnt id=hl-117-5><a class=lnlinks href=#hl-117-5> 5</a>
</span><span class=lnt id=hl-117-6><a class=lnlinks href=#hl-117-6> 6</a>
</span><span class=lnt id=hl-117-7><a class=lnlinks href=#hl-117-7> 7</a>
</span><span class=lnt id=hl-117-8><a class=lnlinks href=#hl-117-8> 8</a>
</span><span class=lnt id=hl-117-9><a class=lnlinks href=#hl-117-9> 9</a>
</span><span class=lnt id=hl-117-10><a class=lnlinks href=#hl-117-10>10</a>
</span><span class=lnt id=hl-117-11><a class=lnlinks href=#hl-117-11>11</a>
</span><span class=lnt id=hl-117-12><a class=lnlinks href=#hl-117-12>12</a>
</span><span class=lnt id=hl-117-13><a class=lnlinks href=#hl-117-13>13</a>
</span><span class=lnt id=hl-117-14><a class=lnlinks href=#hl-117-14>14</a>
</span><span class=lnt id=hl-117-15><a class=lnlinks href=#hl-117-15>15</a>
</span><span class=lnt id=hl-117-16><a class=lnlinks href=#hl-117-16>16</a>
</span><span class=lnt id=hl-117-17><a class=lnlinks href=#hl-117-17>17</a>
</span><span class=lnt id=hl-117-18><a class=lnlinks href=#hl-117-18>18</a>
</span><span class=lnt id=hl-117-19><a class=lnlinks href=#hl-117-19>19</a>
</span><span class=lnt id=hl-117-20><a class=lnlinks href=#hl-117-20>20</a>
</span><span class=lnt id=hl-117-21><a class=lnlinks href=#hl-117-21>21</a>
</span><span class=lnt id=hl-117-22><a class=lnlinks href=#hl-117-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.amqp.core.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Queue</span><span class=w> </span><span class=nf>helloQueue</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Queue</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DirectExchange</span><span class=w> </span><span class=nf>exchange</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DirectExchange</span><span class=p>(</span><span class=s>&#34;direct-exchange&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Binding</span><span class=w> </span><span class=nf>binding</span><span class=p>(</span><span class=n>Queue</span><span class=w> </span><span class=n>helloQueue</span><span class=p>,</span><span class=w> </span><span class=n>DirectExchange</span><span class=w> </span><span class=n>exchange</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>BindingBuilder</span><span class=p>.</span><span class=na>bind</span><span class=p>(</span><span class=n>helloQueue</span><span class=p>).</span><span class=na>to</span><span class=p>(</span><span class=n>exchange</span><span class=p>).</span><span class=na>with</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>메시지 생산자:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-118-1><a class=lnlinks href=#hl-118-1> 1</a>
</span><span class=lnt id=hl-118-2><a class=lnlinks href=#hl-118-2> 2</a>
</span><span class=lnt id=hl-118-3><a class=lnlinks href=#hl-118-3> 3</a>
</span><span class=lnt id=hl-118-4><a class=lnlinks href=#hl-118-4> 4</a>
</span><span class=lnt id=hl-118-5><a class=lnlinks href=#hl-118-5> 5</a>
</span><span class=lnt id=hl-118-6><a class=lnlinks href=#hl-118-6> 6</a>
</span><span class=lnt id=hl-118-7><a class=lnlinks href=#hl-118-7> 7</a>
</span><span class=lnt id=hl-118-8><a class=lnlinks href=#hl-118-8> 8</a>
</span><span class=lnt id=hl-118-9><a class=lnlinks href=#hl-118-9> 9</a>
</span><span class=lnt id=hl-118-10><a class=lnlinks href=#hl-118-10>10</a>
</span><span class=lnt id=hl-118-11><a class=lnlinks href=#hl-118-11>11</a>
</span><span class=lnt id=hl-118-12><a class=lnlinks href=#hl-118-12>12</a>
</span><span class=lnt id=hl-118-13><a class=lnlinks href=#hl-118-13>13</a>
</span><span class=lnt id=hl-118-14><a class=lnlinks href=#hl-118-14>14</a>
</span><span class=lnt id=hl-118-15><a class=lnlinks href=#hl-118-15>15</a>
</span><span class=lnt id=hl-118-16><a class=lnlinks href=#hl-118-16>16</a>
</span><span class=lnt id=hl-118-17><a class=lnlinks href=#hl-118-17>17</a>
</span><span class=lnt id=hl-118-18><a class=lnlinks href=#hl-118-18>18</a>
</span><span class=lnt id=hl-118-19><a class=lnlinks href=#hl-118-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.amqp.core.Queue</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQSender</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Queue</span><span class=w> </span><span class=n>queue</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>send</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;direct-exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지 전송됨: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>메시지 소비자:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-119-1><a class=lnlinks href=#hl-119-1> 1</a>
</span><span class=lnt id=hl-119-2><a class=lnlinks href=#hl-119-2> 2</a>
</span><span class=lnt id=hl-119-3><a class=lnlinks href=#hl-119-3> 3</a>
</span><span class=lnt id=hl-119-4><a class=lnlinks href=#hl-119-4> 4</a>
</span><span class=lnt id=hl-119-5><a class=lnlinks href=#hl-119-5> 5</a>
</span><span class=lnt id=hl-119-6><a class=lnlinks href=#hl-119-6> 6</a>
</span><span class=lnt id=hl-119-7><a class=lnlinks href=#hl-119-7> 7</a>
</span><span class=lnt id=hl-119-8><a class=lnlinks href=#hl-119-8> 8</a>
</span><span class=lnt id=hl-119-9><a class=lnlinks href=#hl-119-9> 9</a>
</span><span class=lnt id=hl-119-10><a class=lnlinks href=#hl-119-10>10</a>
</span><span class=lnt id=hl-119-11><a class=lnlinks href=#hl-119-11>11</a>
</span><span class=lnt id=hl-119-12><a class=lnlinks href=#hl-119-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.amqp.rabbit.annotation.RabbitListener</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Component</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQReceiver</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>receiveMessage</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지 수신됨: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 메시지 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=nodejs-클라이언트>Node.js 클라이언트<a hidden class=anchor aria-hidden=true href=#nodejs-클라이언트>#</a></h4><p>Amqplib 설치:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-120-1><a class=lnlinks href=#hl-120-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install amqplib
</span></span></code></pre></td></tr></table></div></div><p>기본 생산자 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-121-1><a class=lnlinks href=#hl-121-1> 1</a>
</span><span class=lnt id=hl-121-2><a class=lnlinks href=#hl-121-2> 2</a>
</span><span class=lnt id=hl-121-3><a class=lnlinks href=#hl-121-3> 3</a>
</span><span class=lnt id=hl-121-4><a class=lnlinks href=#hl-121-4> 4</a>
</span><span class=lnt id=hl-121-5><a class=lnlinks href=#hl-121-5> 5</a>
</span><span class=lnt id=hl-121-6><a class=lnlinks href=#hl-121-6> 6</a>
</span><span class=lnt id=hl-121-7><a class=lnlinks href=#hl-121-7> 7</a>
</span><span class=lnt id=hl-121-8><a class=lnlinks href=#hl-121-8> 8</a>
</span><span class=lnt id=hl-121-9><a class=lnlinks href=#hl-121-9> 9</a>
</span><span class=lnt id=hl-121-10><a class=lnlinks href=#hl-121-10>10</a>
</span><span class=lnt id=hl-121-11><a class=lnlinks href=#hl-121-11>11</a>
</span><span class=lnt id=hl-121-12><a class=lnlinks href=#hl-121-12>12</a>
</span><span class=lnt id=hl-121-13><a class=lnlinks href=#hl-121-13>13</a>
</span><span class=lnt id=hl-121-14><a class=lnlinks href=#hl-121-14>14</a>
</span><span class=lnt id=hl-121-15><a class=lnlinks href=#hl-121-15>15</a>
</span><span class=lnt id=hl-121-16><a class=lnlinks href=#hl-121-16>16</a>
</span><span class=lnt id=hl-121-17><a class=lnlinks href=#hl-121-17>17</a>
</span><span class=lnt id=hl-121-18><a class=lnlinks href=#hl-121-18>18</a>
</span><span class=lnt id=hl-121-19><a class=lnlinks href=#hl-121-19>19</a>
</span><span class=lnt id=hl-121-20><a class=lnlinks href=#hl-121-20>20</a>
</span><span class=lnt id=hl-121-21><a class=lnlinks href=#hl-121-21>21</a>
</span><span class=lnt id=hl-121-22><a class=lnlinks href=#hl-121-22>22</a>
</span><span class=lnt id=hl-121-23><a class=lnlinks href=#hl-121-23>23</a>
</span><span class=lnt id=hl-121-24><a class=lnlinks href=#hl-121-24>24</a>
</span><span class=lnt id=hl-121-25><a class=lnlinks href=#hl-121-25>25</a>
</span><span class=lnt id=hl-121-26><a class=lnlinks href=#hl-121-26>26</a>
</span><span class=lnt id=hl-121-27><a class=lnlinks href=#hl-121-27>27</a>
</span><span class=lnt id=hl-121-28><a class=lnlinks href=#hl-121-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib/callback_api&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>error0</span><span class=p>,</span> <span class=nx>connection</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>error0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>((</span><span class=nx>error1</span><span class=p>,</span> <span class=nx>channel</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>error1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=s1>&#39;hello&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>msg</span> <span class=o>=</span> <span class=s1>&#39;Hello World!&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>queue</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>durable</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span><span class=nx>queue</span><span class=p>,</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>msg</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34; [x] Sent %s&#34;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>connection</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>기본 소비자 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-122-1><a class=lnlinks href=#hl-122-1> 1</a>
</span><span class=lnt id=hl-122-2><a class=lnlinks href=#hl-122-2> 2</a>
</span><span class=lnt id=hl-122-3><a class=lnlinks href=#hl-122-3> 3</a>
</span><span class=lnt id=hl-122-4><a class=lnlinks href=#hl-122-4> 4</a>
</span><span class=lnt id=hl-122-5><a class=lnlinks href=#hl-122-5> 5</a>
</span><span class=lnt id=hl-122-6><a class=lnlinks href=#hl-122-6> 6</a>
</span><span class=lnt id=hl-122-7><a class=lnlinks href=#hl-122-7> 7</a>
</span><span class=lnt id=hl-122-8><a class=lnlinks href=#hl-122-8> 8</a>
</span><span class=lnt id=hl-122-9><a class=lnlinks href=#hl-122-9> 9</a>
</span><span class=lnt id=hl-122-10><a class=lnlinks href=#hl-122-10>10</a>
</span><span class=lnt id=hl-122-11><a class=lnlinks href=#hl-122-11>11</a>
</span><span class=lnt id=hl-122-12><a class=lnlinks href=#hl-122-12>12</a>
</span><span class=lnt id=hl-122-13><a class=lnlinks href=#hl-122-13>13</a>
</span><span class=lnt id=hl-122-14><a class=lnlinks href=#hl-122-14>14</a>
</span><span class=lnt id=hl-122-15><a class=lnlinks href=#hl-122-15>15</a>
</span><span class=lnt id=hl-122-16><a class=lnlinks href=#hl-122-16>16</a>
</span><span class=lnt id=hl-122-17><a class=lnlinks href=#hl-122-17>17</a>
</span><span class=lnt id=hl-122-18><a class=lnlinks href=#hl-122-18>18</a>
</span><span class=lnt id=hl-122-19><a class=lnlinks href=#hl-122-19>19</a>
</span><span class=lnt id=hl-122-20><a class=lnlinks href=#hl-122-20>20</a>
</span><span class=lnt id=hl-122-21><a class=lnlinks href=#hl-122-21>21</a>
</span><span class=lnt id=hl-122-22><a class=lnlinks href=#hl-122-22>22</a>
</span><span class=lnt id=hl-122-23><a class=lnlinks href=#hl-122-23>23</a>
</span><span class=lnt id=hl-122-24><a class=lnlinks href=#hl-122-24>24</a>
</span><span class=lnt id=hl-122-25><a class=lnlinks href=#hl-122-25>25</a>
</span><span class=lnt id=hl-122-26><a class=lnlinks href=#hl-122-26>26</a>
</span><span class=lnt id=hl-122-27><a class=lnlinks href=#hl-122-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib/callback_api&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>error0</span><span class=p>,</span> <span class=nx>connection</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>error0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>((</span><span class=nx>error1</span><span class=p>,</span> <span class=nx>channel</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>error1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=s1>&#39;hello&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>queue</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>durable</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34; [*] Waiting for messages in %s. To exit press CTRL+C&#34;</span><span class=p>,</span> <span class=nx>queue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=nx>queue</span><span class=p>,</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34; [x] Received %s&#34;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>noAck</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=고급-rabbitmq-기능>고급 RabbitMQ 기능<a hidden class=anchor aria-hidden=true href=#고급-rabbitmq-기능>#</a></h3><h4 id=메시지-내구성>메시지 내구성<a hidden class=anchor aria-hidden=true href=#메시지-내구성>#</a></h4><p>메시지가 유실되지 않도록 내구성을 보장하는 방법:</p><ol><li><p><strong>지속적인 큐 선언</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-123-1><a class=lnlinks href=#hl-123-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>  </span><span class=c1>// durable=true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>지속적인 메시지 발행</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-124-1><a class=lnlinks href=#hl-124-1>1</a>
</span><span class=lnt id=hl-124-2><a class=lnlinks href=#hl-124-2>2</a>
</span><span class=lnt id=hl-124-3><a class=lnlinks href=#hl-124-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>MessageProperties</span><span class=p>.</span><span class=na>PERSISTENT_TEXT_PLAIN</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>메시지 확인(Acknowledge)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-125-1><a class=lnlinks href=#hl-125-1>1</a>
</span><span class=lnt id=hl-125-2><a class=lnlinks href=#hl-125-2>2</a>
</span><span class=lnt id=hl-125-3><a class=lnlinks href=#hl-125-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>basicConsume</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>deliverCallback</span><span class=p>,</span><span class=w> </span><span class=n>consumerTag</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 처리 후 명시적으로 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>basicAck</span><span class=p>(</span><span class=n>delivery</span><span class=p>.</span><span class=na>getEnvelope</span><span class=p>().</span><span class=na>getDeliveryTag</span><span class=p>(),</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=메시지-제어>메시지 제어<a hidden class=anchor aria-hidden=true href=#메시지-제어>#</a></h4><h5 id=프리페치-카운트prefetch-count>프리페치 카운트(Prefetch Count)<a hidden class=anchor aria-hidden=true href=#프리페치-카운트prefetch-count>#</a></h5><p>한 번에 처리할 수 있는 메시지 수를 제한한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-126-1><a class=lnlinks href=#hl-126-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>basicQos</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>  </span><span class=c1>// 한 번에 하나의 메시지만 처리</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=메시지-ttltime-to-live>메시지 TTL(Time to Live)<a hidden class=anchor aria-hidden=true href=#메시지-ttltime-to-live>#</a></h5><p>메시지의 유효 기간을 설정한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-127-1><a class=lnlinks href=#hl-127-1>1</a>
</span><span class=lnt id=hl-127-2><a class=lnlinks href=#hl-127-2>2</a>
</span><span class=lnt id=hl-127-3><a class=lnlinks href=#hl-127-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-message-ttl&#34;</span><span class=p>,</span><span class=w> </span><span class=n>60000</span><span class=p>);</span><span class=w>  </span><span class=c1>// 60초 후 만료</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=데드-레터-익스체인지dead-letter-exchange>데드 레터 익스체인지(Dead Letter Exchange)<a hidden class=anchor aria-hidden=true href=#데드-레터-익스체인지dead-letter-exchange>#</a></h5><p>처리할 수 없는 메시지를 특별한 큐로 보낸다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-128-1><a class=lnlinks href=#hl-128-1>1</a>
</span><span class=lnt id=hl-128-2><a class=lnlinks href=#hl-128-2>2</a>
</span><span class=lnt id=hl-128-3><a class=lnlinks href=#hl-128-3>3</a>
</span><span class=lnt id=hl-128-4><a class=lnlinks href=#hl-128-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-dead-letter-exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dead-letter-exchange&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-dead-letter-routing-key&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dead-letter&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=교환기-유형과-바인딩-전략>교환기 유형과 바인딩 전략<a hidden class=anchor aria-hidden=true href=#교환기-유형과-바인딩-전략>#</a></h4><h5 id=direct-exchange>Direct Exchange<a hidden class=anchor aria-hidden=true href=#direct-exchange>#</a></h5><p>정확한 라우팅 키 일치에 기반한 라우팅:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-129-1><a class=lnlinks href=#hl-129-1>1</a>
</span><span class=lnt id=hl-129-2><a class=lnlinks href=#hl-129-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>exchangeDeclare</span><span class=p>(</span><span class=s>&#34;direct_logs&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;direct&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueBind</span><span class=p>(</span><span class=n>queueName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;direct_logs&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;error&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// error 메시지만 수신</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=topic-exchange>Topic Exchange<a hidden class=anchor aria-hidden=true href=#topic-exchange>#</a></h5><p>패턴 매칭을 사용한 라우팅:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-130-1><a class=lnlinks href=#hl-130-1>1</a>
</span><span class=lnt id=hl-130-2><a class=lnlinks href=#hl-130-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>exchangeDeclare</span><span class=p>(</span><span class=s>&#34;topic_logs&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;topic&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueBind</span><span class=p>(</span><span class=n>queueName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;topic_logs&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;kern.*&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// kern으로 시작하는 모든 메시지</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>패턴에서:</p><ul><li><code>*</code>: 정확히 하나의 단어와 일치</li><li><code>#</code>: 0개 이상의 단어와 일치</li></ul><h5 id=headers-exchange>Headers Exchange<a hidden class=anchor aria-hidden=true href=#headers-exchange>#</a></h5><p>메시지 헤더에 기반한 라우팅:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-131-1><a class=lnlinks href=#hl-131-1>1</a>
</span><span class=lnt id=hl-131-2><a class=lnlinks href=#hl-131-2>2</a>
</span><span class=lnt id=hl-131-3><a class=lnlinks href=#hl-131-3>3</a>
</span><span class=lnt id=hl-131-4><a class=lnlinks href=#hl-131-4>4</a>
</span><span class=lnt id=hl-131-5><a class=lnlinks href=#hl-131-5>5</a>
</span><span class=lnt id=hl-131-6><a class=lnlinks href=#hl-131-6>6</a>
</span><span class=lnt id=hl-131-7><a class=lnlinks href=#hl-131-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>channel</span><span class=p>.</span><span class=na>exchangeDeclare</span><span class=p>(</span><span class=s>&#34;header_exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;headers&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>bindingArgs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>bindingArgs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-match&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;all&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// all: 모든 헤더 일치, any: 하나라도 일치</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>bindingArgs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;format&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pdf&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>bindingArgs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;report&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueBind</span><span class=p>(</span><span class=n>queueName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;header_exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>bindingArgs</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=플러그인을-통한-기능-확장>플러그인을 통한 기능 확장<a hidden class=anchor aria-hidden=true href=#플러그인을-통한-기능-확장>#</a></h4><p>RabbitMQ는 플러그인을 통해 기능을 확장할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-132-1><a class=lnlinks href=#hl-132-1>1</a>
</span><span class=lnt id=hl-132-2><a class=lnlinks href=#hl-132-2>2</a>
</span><span class=lnt id=hl-132-3><a class=lnlinks href=#hl-132-3>3</a>
</span><span class=lnt id=hl-132-4><a class=lnlinks href=#hl-132-4>4</a>
</span><span class=lnt id=hl-132-5><a class=lnlinks href=#hl-132-5>5</a>
</span><span class=lnt id=hl-132-6><a class=lnlinks href=#hl-132-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 플러그인 목록 보기</span>
</span></span><span class=line><span class=cl>rabbitmq-plugins list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 플러그인 활성화</span>
</span></span><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_shovel
</span></span><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_delayed_message_exchange
</span></span></code></pre></td></tr></table></div></div><p>유용한 플러그인:</p><ul><li><code>rabbitmq_management</code>: 웹 기반 관리 인터페이스</li><li><code>rabbitmq_shovel</code>: 브로커 간 메시지 전송</li><li><code>rabbitmq_federation</code>: 브로커 간 토폴로지 연결</li><li><code>rabbitmq_delayed_message_exchange</code>: 지연 메시지 전송</li><li><code>rabbitmq_mqtt</code>: MQTT 프로토콜 지원</li><li><code>rabbitmq_web_stomp</code>: WebSocket을 통한 STOMP 지원</li></ul><h3 id=최적화-및-모니터링>최적화 및 모니터링<a hidden class=anchor aria-hidden=true href=#최적화-및-모니터링>#</a></h3><h2 id=61-성능-튜닝>6.1 성능 튜닝<a hidden class=anchor aria-hidden=true href=#61-성능-튜닝>#</a></h2><h3 id=611-메모리-관리>6.1.1 메모리 관리<a hidden class=anchor aria-hidden=true href=#611-메모리-관리>#</a></h3><p>RabbitMQ는 기본적으로 사용 가능한 시스템 메모리의 40%를 사용하도록 설정되어 있습니다. 이 값은 조정 가능합니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-133-1><a class=lnlinks href=#hl-133-1>1</a>
</span><span class=lnt id=hl-133-2><a class=lnlinks href=#hl-133-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rabbitmq.conf
</span></span><span class=line><span class=cl>vm_memory_high_watermark.relative = 0.6  # 메모리의 60%까지 사용
</span></span></code></pre></td></tr></table></div></div><p>또는 절대값으로 설정:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-134-1><a class=lnlinks href=#hl-134-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vm_memory_high_watermark.absolute = 2GB
</span></span></code></pre></td></tr></table></div></div><h3 id=612-디스크-공간-관리>6.1.2 디스크 공간 관리<a hidden class=anchor aria-hidden=true href=#612-디스크-공간-관리>#</a></h3><p>RabbitMQ는 디스크 공간이 부족하면 메시지 수락을 중지합니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-135-1><a class=lnlinks href=#hl-135-1>1</a>
</span><span class=lnt id=hl-135-2><a class=lnlinks href=#hl-135-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rabbitmq.conf
</span></span><span class=line><span class=cl>disk_free_limit.absolute = 5GB
</span></span></code></pre></td></tr></table></div></div><h3 id=613-큐-최적화>6.1.3 큐 최적화<a hidden class=anchor aria-hidden=true href=#613-큐-최적화>#</a></h3><p>큐 타입과 큐 인자를 사용하여 성능을 최적화할 수 있습니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-136-1><a class=lnlinks href=#hl-136-1>1</a>
</span><span class=lnt id=hl-136-2><a class=lnlinks href=#hl-136-2>2</a>
</span><span class=lnt id=hl-136-3><a class=lnlinks href=#hl-136-3>3</a>
</span><span class=lnt id=hl-136-4><a class=lnlinks href=#hl-136-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-queue-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;quorum&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// 쿼럼 큐 사용 (3.8 이상)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-max-length&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10000</span><span class=p>);</span><span class=w>     </span><span class=c1>// 큐 길이 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=614-채널-및-연결-관리>6.1.4 채널 및 연결 관리<a hidden class=anchor aria-hidden=true href=#614-채널-및-연결-관리>#</a></h3><ul><li>채널을 재사용하세요 (생성 비용이 높음)</li><li>필요 이상으로 많은 연결을 맺지 마세요</li><li>연결 풀을 사용하여 효율적으로 관리하세요</li></ul><h3 id=615-배치-처리>6.1.5 배치 처리<a hidden class=anchor aria-hidden=true href=#615-배치-처리>#</a></h3><p>성능을 위해 메시지를 배치로 발행하고 소비합니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-137-1><a class=lnlinks href=#hl-137-1>1</a>
</span><span class=lnt id=hl-137-2><a class=lnlinks href=#hl-137-2>2</a>
</span><span class=lnt id=hl-137-3><a class=lnlinks href=#hl-137-3>3</a>
</span><span class=lnt id=hl-137-4><a class=lnlinks href=#hl-137-4>4</a>
</span><span class=lnt id=hl-137-5><a class=lnlinks href=#hl-137-5>5</a>
</span><span class=lnt id=hl-137-6><a class=lnlinks href=#hl-137-6>6</a>
</span><span class=lnt id=hl-137-7><a class=lnlinks href=#hl-137-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 배치 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>batchSize</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>QUEUE_NAME</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>messages</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 배치 소비</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>basicQos</span><span class=p>(</span><span class=n>100</span><span class=p>);</span><span class=w>  </span><span class=c1>// 한 번에 100개 메시지 처리</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=62-모니터링>6.2 모니터링<a hidden class=anchor aria-hidden=true href=#62-모니터링>#</a></h2><h3 id=621-관리-ui-사용>6.2.1 관리 UI 사용<a hidden class=anchor aria-hidden=true href=#621-관리-ui-사용>#</a></h3><p>웹 관리 인터페이스(<a href=http://localhost:15672>http://localhost:15672</a>)에서> 다양한 메트릭을 모니터링할 수 있습니다:</p><ul><li>큐, 연결, 채널 상태</li><li>메시지 처리량</li><li>노드 자원 사용량</li><li>클러스터 상태</li></ul><h3 id=622-http-api-사용>6.2.2 HTTP API 사용<a hidden class=anchor aria-hidden=true href=#622-http-api-사용>#</a></h3><p>HTTP API를 통해 프로그래밍 방식으로 모니터링할 수 있습니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-138-1><a class=lnlinks href=#hl-138-1>1</a>
</span><span class=lnt id=hl-138-2><a class=lnlinks href=#hl-138-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 큐 상태 확인</span>
</span></span><span class=line><span class=cl>curl -u guest:guest http://localhost:15672/api/queues/%2F/my_queue
</span></span></code></pre></td></tr></table></div></div><h3 id=623-prometheus-및-grafana-통합>6.2.3 Prometheus 및 Grafana 통합<a hidden class=anchor aria-hidden=true href=#623-prometheus-및-grafana-통합>#</a></h3><p>RabbitMQ Prometheus 플러그인을 사용하여 더 강력한 모니터링을 구성할 수 있습니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-139-1><a class=lnlinks href=#hl-139-1>1</a>
</span><span class=lnt id=hl-139-2><a class=lnlinks href=#hl-139-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Prometheus 플러그인 활성화</span>
</span></span><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_prometheus
</span></span></code></pre></td></tr></table></div></div><p>Prometheus 설정:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-140-1><a class=lnlinks href=#hl-140-1>1</a>
</span><span class=lnt id=hl-140-2><a class=lnlinks href=#hl-140-2>2</a>
</span><span class=lnt id=hl-140-3><a class=lnlinks href=#hl-140-3>3</a>
</span><span class=lnt id=hl-140-4><a class=lnlinks href=#hl-140-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;rabbitmq&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;rabbitmq:15692&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>그런 다음 Grafana에서 RabbitMQ 대시보드를 가져와 사용할 수 있습니다.</p><h2 id=63-성능-테스트>6.3 성능 테스트<a hidden class=anchor aria-hidden=true href=#63-성능-테스트>#</a></h2><p>PerfTest 도구를 사용하여 RabbitMQ 성능을 테스트할 수 있습니다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-141-1><a class=lnlinks href=#hl-141-1>1</a>
</span><span class=lnt id=hl-141-2><a class=lnlinks href=#hl-141-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 성능 테스트 실행</span>
</span></span><span class=line><span class=cl>./runjava com.rabbitmq.perf.PerfTest -h amqp://localhost -x <span class=m>1</span> -y <span class=m>1</span> -u <span class=s2>&#34;throughput-test&#34;</span> -a --id <span class=s2>&#34;test 1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>중요한 성능 지표:</p><ul><li>초당 메시지 수</li><li>소비자 및 생산자 지연 시간</li><li>메모리 및 CPU 사용량</li><li>디스크 I/O</li></ul><h3 id=rabbitmq의-장애-처리-및-고가용성>RabbitMQ의 장애 처리 및 고가용성<a hidden class=anchor aria-hidden=true href=#rabbitmq의-장애-처리-및-고가용성>#</a></h3><h4 id=장애-시나리오-및-처리>장애 시나리오 및 처리<a hidden class=anchor aria-hidden=true href=#장애-시나리오-및-처리>#</a></h4><h5 id=브로커-장애>브로커 장애<a hidden class=anchor aria-hidden=true href=#브로커-장애>#</a></h5><p>브로커 노드가 실패할 경우 클러스터의 다른 노드가 작업을 인계받는다. 미러링된 큐를 사용하면 데이터 손실을 방지할 수 있다. 미러링 큐는 모든 메시지의 복사본을 여러 노드에 유지하여 노드 장애 시에도 메시지를 사용할 수 있게 한다.</p><p>RabbitMQ 3.8 이후 버전에서는 쿼럼 큐(Quorum Queues)라는 새로운 고가용성 큐 타입을 제공한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-142-1><a class=lnlinks href=#hl-142-1>1</a>
</span><span class=lnt id=hl-142-2><a class=lnlinks href=#hl-142-2>2</a>
</span><span class=lnt id=hl-142-3><a class=lnlinks href=#hl-142-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-queue-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;quorum&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=s>&#34;ha-queue&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>쿼럼 큐는 Raft 합의 프로토콜을 사용하여 더 강력한 일관성과 내결함성을 제공한다.</p><h5 id=네트워크-분할>네트워크 분할<a hidden class=anchor aria-hidden=true href=#네트워크-분할>#</a></h5><p>네트워크 분할(Network Partition) 또는 &ldquo;브레인 스플릿(Brain Split)&ldquo;이 발생하면 RabbitMQ 클러스터가 여러 부분으로 나뉘어 각각 독립적으로 작동하게 된다. 이 문제를 해결하기 위한 정책을 구성할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-143-1><a class=lnlinks href=#hl-143-1>1</a>
</span><span class=lnt id=hl-143-2><a class=lnlinks href=#hl-143-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rabbitmq.conf
</span></span><span class=line><span class=cl>cluster_partition_handling = autoheal  # 자동 복구 모드
</span></span></code></pre></td></tr></table></div></div><p>가능한 설정:</p><ul><li><code>ignore</code>: 분할을 무시하고 각 부분이 독립적으로 작동</li><li><code>autoheal</code>: 자동으로 복구 시도 (소수 파티션을 재시작)</li><li><code>pause_minority</code>: 소수 파티션 노드를 일시 중지</li></ul><h5 id=디스크-공간-부족>디스크 공간 부족<a hidden class=anchor aria-hidden=true href=#디스크-공간-부족>#</a></h5><p>디스크 공간이 부족하면 RabbitMQ는 새 메시지의 수락을 중지한다.</p><p>이를 위한 조치:</p><ul><li>중요하지 않은 메시지 제거</li><li>오래된 메시지 제거를 위한 TTL 설정</li><li>디스크 경보 임계값 조정</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-144-1><a class=lnlinks href=#hl-144-1>1</a>
</span><span class=lnt id=hl-144-2><a class=lnlinks href=#hl-144-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 디스크 경보 임계값 조정</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_disk_free_limit 5GB
</span></span></code></pre></td></tr></table></div></div><h5 id=메모리-경보>메모리 경보<a hidden class=anchor aria-hidden=true href=#메모리-경보>#</a></h5><p>메모리 사용량이 높으면 RabbitMQ는 생산자의 속도를 제한한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-145-1><a class=lnlinks href=#hl-145-1>1</a>
</span><span class=lnt id=hl-145-2><a class=lnlinks href=#hl-145-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 메모리 경보 임계값 조정</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_vm_memory_high_watermark 0.6
</span></span></code></pre></td></tr></table></div></div><h4 id=고가용성-구성>고가용성 구성<a hidden class=anchor aria-hidden=true href=#고가용성-구성>#</a></h4><h5 id=클러스터링>클러스터링<a hidden class=anchor aria-hidden=true href=#클러스터링>#</a></h5><p>기본 RabbitMQ 클러스터는 메타데이터를 복제하지만 큐의 내용은 복제하지 않는다. 높은 가용성을 위해서는 미러링 큐나 쿼럼 큐를 사용해야 한다.</p><h5 id=미러링-큐-정책>미러링 큐 정책<a hidden class=anchor aria-hidden=true href=#미러링-큐-정책>#</a></h5><p>관리 UI 또는 CLI를 통해 미러링 정책을 설정할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-146-1><a class=lnlinks href=#hl-146-1>1</a>
</span><span class=lnt id=hl-146-2><a class=lnlinks href=#hl-146-2>2</a>
</span><span class=lnt id=hl-146-3><a class=lnlinks href=#hl-146-3>3</a>
</span><span class=lnt id=hl-146-4><a class=lnlinks href=#hl-146-4>4</a>
</span><span class=lnt id=hl-146-5><a class=lnlinks href=#hl-146-5>5</a>
</span><span class=lnt id=hl-146-6><a class=lnlinks href=#hl-146-6>6</a>
</span><span class=lnt id=hl-146-7><a class=lnlinks href=#hl-146-7>7</a>
</span><span class=lnt id=hl-146-8><a class=lnlinks href=#hl-146-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 모든 큐를 모든 노드에 미러링</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_policy ha-all <span class=s2>&#34;.*&#34;</span> <span class=s1>&#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;</span> --apply-to queues
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 모든 큐를 특정 수의 노드에 미러링</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_policy ha-two <span class=s2>&#34;.*&#34;</span> <span class=s1>&#39;{&#34;ha-mode&#34;:&#34;exactly&#34;,&#34;ha-params&#34;:2}&#39;</span> --apply-to queues
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 대기열 이름이 &#34;ha.&#34;로 시작하는 큐만 미러링</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_policy ha-match <span class=s2>&#34;^ha\.&#34;</span> <span class=s1>&#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;</span> --apply-to queues
</span></span></code></pre></td></tr></table></div></div><h5 id=쿼럼-큐>쿼럼 큐<a hidden class=anchor aria-hidden=true href=#쿼럼-큐>#</a></h5><p>쿼럼 큐는 Raft 합의 알고리즘을 사용하여 메시지의 일관성을 보장한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-147-1><a class=lnlinks href=#hl-147-1>1</a>
</span><span class=lnt id=hl-147-2><a class=lnlinks href=#hl-147-2>2</a>
</span><span class=lnt id=hl-147-3><a class=lnlinks href=#hl-147-3>3</a>
</span><span class=lnt id=hl-147-4><a class=lnlinks href=#hl-147-4>4</a>
</span><span class=lnt id=hl-147-5><a class=lnlinks href=#hl-147-5>5</a>
</span><span class=lnt id=hl-147-6><a class=lnlinks href=#hl-147-6>6</a>
</span><span class=lnt id=hl-147-7><a class=lnlinks href=#hl-147-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 쿼럼 큐 선언 (클라이언트에서)</span>
</span></span><span class=line><span class=cl>Map&lt;String, Object&gt; <span class=nv>args</span> <span class=o>=</span> new HashMap&lt;&gt;<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>args.put<span class=o>(</span><span class=s2>&#34;x-queue-type&#34;</span>, <span class=s2>&#34;quorum&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>channel.queueDeclare<span class=o>(</span><span class=s2>&#34;critical-queue&#34;</span>, true, false, false, args<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 또는 정책을 통해 설정</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_policy quorum-queues <span class=s2>&#34;^critical\.&#34;</span> <span class=s1>&#39;{&#34;x-queue-type&#34;:&#34;quorum&#34;}&#39;</span> --apply-to queues
</span></span></code></pre></td></tr></table></div></div><p>쿼럼 큐의 특징:</p><ul><li>강력한 내구성과 일관성</li><li>브로커 장애에 더 잘 대응</li><li>제한된 기능 (예: 임시 큐 지원 안 함)</li><li>미러링 큐보다 더 효율적인 리소스 사용</li></ul><h5 id=가용성-영역-간-배포>가용성 영역 간 배포<a hidden class=anchor aria-hidden=true href=#가용성-영역-간-배포>#</a></h5><p>클라우드 환경에서는 여러 가용성 영역(AZ)에 걸쳐 RabbitMQ 노드를 배포하여 전체 AZ 장애에도 서비스를 유지할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-148-1><a class=lnlinks href=#hl-148-1>1</a>
</span><span class=lnt id=hl-148-2><a class=lnlinks href=#hl-148-2>2</a>
</span><span class=lnt id=hl-148-3><a class=lnlinks href=#hl-148-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>노드 1: AZ-1
</span></span><span class=line><span class=cl>노드 2: AZ-2
</span></span><span class=line><span class=cl>노드 3: AZ-3
</span></span></code></pre></td></tr></table></div></div><p>이 설정은 AZ 간 네트워크 지연을 고려해야 한다.</p><h5 id=페더레이션-플러그인>페더레이션 플러그인<a hidden class=anchor aria-hidden=true href=#페더레이션-플러그인>#</a></h5><p>federation 플러그인을 사용하면 지역적으로 분산된 브로커 간에 메시지를 전달할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-149-1><a class=lnlinks href=#hl-149-1>1</a>
</span><span class=lnt id=hl-149-2><a class=lnlinks href=#hl-149-2>2</a>
</span><span class=lnt id=hl-149-3><a class=lnlinks href=#hl-149-3>3</a>
</span><span class=lnt id=hl-149-4><a class=lnlinks href=#hl-149-4>4</a>
</span><span class=lnt id=hl-149-5><a class=lnlinks href=#hl-149-5>5</a>
</span><span class=lnt id=hl-149-6><a class=lnlinks href=#hl-149-6>6</a>
</span><span class=lnt id=hl-149-7><a class=lnlinks href=#hl-149-7>7</a>
</span><span class=lnt id=hl-149-8><a class=lnlinks href=#hl-149-8>8</a>
</span><span class=lnt id=hl-149-9><a class=lnlinks href=#hl-149-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 페더레이션 플러그인 활성화</span>
</span></span><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_federation
</span></span><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_federation_management
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 업스트림 설정</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_parameter federation-upstream my-upstream <span class=s1>&#39;{&#34;uri&#34;:&#34;amqp://remote-host&#34;}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 정책 설정</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_policy federate-me <span class=s2>&#34;^federated\.&#34;</span> <span class=s1>&#39;{&#34;federation-upstream-set&#34;:&#34;all&#34;}&#39;</span> --apply-to exchanges
</span></span></code></pre></td></tr></table></div></div><h4 id=백업-및-복구-전략>백업 및 복구 전략<a hidden class=anchor aria-hidden=true href=#백업-및-복구-전략>#</a></h4><h5 id=정의-백업>정의 백업<a hidden class=anchor aria-hidden=true href=#정의-백업>#</a></h5><p>RabbitMQ의 토폴로지 정의(exchanges, queues, bindings, policies)를 백업하는 것이 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-150-1><a class=lnlinks href=#hl-150-1>1</a>
</span><span class=lnt id=hl-150-2><a class=lnlinks href=#hl-150-2>2</a>
</span><span class=lnt id=hl-150-3><a class=lnlinks href=#hl-150-3>3</a>
</span><span class=lnt id=hl-150-4><a class=lnlinks href=#hl-150-4>4</a>
</span><span class=lnt id=hl-150-5><a class=lnlinks href=#hl-150-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 정의 내보내기</span>
</span></span><span class=line><span class=cl>rabbitmqctl export_definitions /path/to/definitions.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 정의 가져오기</span>
</span></span><span class=line><span class=cl>rabbitmqctl import_definitions /path/to/definitions.json
</span></span></code></pre></td></tr></table></div></div><h5 id=메시지-백업>메시지 백업<a hidden class=anchor aria-hidden=true href=#메시지-백업>#</a></h5><p>메시지 백업을 위한 몇 가지 전략:</p><ul><li>쇼벨 플러그인을 사용하여 중요한 메시지를 백업 큐로 복사</li><li>중요한 메시지를 소비하여 외부 스토리지에 저장</li><li>미러링 큐 사용으로 메시지 복제</li></ul><h3 id=보안-및-인증>보안 및 인증<a hidden class=anchor aria-hidden=true href=#보안-및-인증>#</a></h3><h4 id=사용자-관리-및-권한>사용자 관리 및 권한<a hidden class=anchor aria-hidden=true href=#사용자-관리-및-권한>#</a></h4><p>RabbitMQ는 사용자 계정과 권한을 관리하는 기본 시스템을 제공한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-151-1><a class=lnlinks href=#hl-151-1>1</a>
</span><span class=lnt id=hl-151-2><a class=lnlinks href=#hl-151-2>2</a>
</span><span class=lnt id=hl-151-3><a class=lnlinks href=#hl-151-3>3</a>
</span><span class=lnt id=hl-151-4><a class=lnlinks href=#hl-151-4>4</a>
</span><span class=lnt id=hl-151-5><a class=lnlinks href=#hl-151-5>5</a>
</span><span class=lnt id=hl-151-6><a class=lnlinks href=#hl-151-6>6</a>
</span><span class=lnt id=hl-151-7><a class=lnlinks href=#hl-151-7>7</a>
</span><span class=lnt id=hl-151-8><a class=lnlinks href=#hl-151-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 사용자 생성</span>
</span></span><span class=line><span class=cl>rabbitmqctl add_user myuser mypassword
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 태그 설정 (관리자, 모니터링 등)</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_user_tags myuser administrator
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 권한 설정 (vhost, configure, write, read)</span>
</span></span><span class=line><span class=cl>rabbitmqctl set_permissions -p / myuser <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>권한 패턴은 정규식을 사용하여 리소스에 대한 액세스를 제어한다:</p><ul><li>Configure: 리소스 생성 및 삭제</li><li>Write: 메시지 발행</li><li>Read: 메시지 소비</li></ul><h4 id=ssltls-구성>SSL/TLS 구성<a hidden class=anchor aria-hidden=true href=#ssltls-구성>#</a></h4><p>보안 통신을 위해 SSL/TLS를 구성할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-152-1><a class=lnlinks href=#hl-152-1>1</a>
</span><span class=lnt id=hl-152-2><a class=lnlinks href=#hl-152-2>2</a>
</span><span class=lnt id=hl-152-3><a class=lnlinks href=#hl-152-3>3</a>
</span><span class=lnt id=hl-152-4><a class=lnlinks href=#hl-152-4>4</a>
</span><span class=lnt id=hl-152-5><a class=lnlinks href=#hl-152-5>5</a>
</span><span class=lnt id=hl-152-6><a class=lnlinks href=#hl-152-6>6</a>
</span><span class=lnt id=hl-152-7><a class=lnlinks href=#hl-152-7>7</a>
</span><span class=lnt id=hl-152-8><a class=lnlinks href=#hl-152-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rabbitmq.conf
</span></span><span class=line><span class=cl>ssl_options.cacertfile = /path/to/ca_certificate.pem
</span></span><span class=line><span class=cl>ssl_options.certfile = /path/to/server_certificate.pem
</span></span><span class=line><span class=cl>ssl_options.keyfile = /path/to/server_key.pem
</span></span><span class=line><span class=cl>ssl_options.verify = verify_peer
</span></span><span class=line><span class=cl>ssl_options.fail_if_no_peer_cert = true
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>listeners.ssl.default = 5671
</span></span></code></pre></td></tr></table></div></div><p>클라이언트 측 설정:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-153-1><a class=lnlinks href=#hl-153-1>1</a>
</span><span class=lnt id=hl-153-2><a class=lnlinks href=#hl-153-2>2</a>
</span><span class=lnt id=hl-153-3><a class=lnlinks href=#hl-153-3>3</a>
</span><span class=lnt id=hl-153-4><a class=lnlinks href=#hl-153-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConnectionFactory</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>factory</span><span class=p>.</span><span class=na>setHost</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>factory</span><span class=p>.</span><span class=na>setPort</span><span class=p>(</span><span class=n>5671</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>factory</span><span class=p>.</span><span class=na>useSslProtocol</span><span class=p>(</span><span class=s>&#34;TLSv1.2&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=ldap-통합>LDAP 통합<a hidden class=anchor aria-hidden=true href=#ldap-통합>#</a></h4><p>LDAP 플러그인을 사용하여 기존 디렉토리 서비스와 통합할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-154-1><a class=lnlinks href=#hl-154-1>1</a>
</span><span class=lnt id=hl-154-2><a class=lnlinks href=#hl-154-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># LDAP 플러그인 활성화</span>
</span></span><span class=line><span class=cl>rabbitmq-plugins <span class=nb>enable</span> rabbitmq_auth_backend_ldap
</span></span></code></pre></td></tr></table></div></div><p>구성 예제:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-155-1><a class=lnlinks href=#hl-155-1> 1</a>
</span><span class=lnt id=hl-155-2><a class=lnlinks href=#hl-155-2> 2</a>
</span><span class=lnt id=hl-155-3><a class=lnlinks href=#hl-155-3> 3</a>
</span><span class=lnt id=hl-155-4><a class=lnlinks href=#hl-155-4> 4</a>
</span><span class=lnt id=hl-155-5><a class=lnlinks href=#hl-155-5> 5</a>
</span><span class=lnt id=hl-155-6><a class=lnlinks href=#hl-155-6> 6</a>
</span><span class=lnt id=hl-155-7><a class=lnlinks href=#hl-155-7> 7</a>
</span><span class=lnt id=hl-155-8><a class=lnlinks href=#hl-155-8> 8</a>
</span><span class=lnt id=hl-155-9><a class=lnlinks href=#hl-155-9> 9</a>
</span><span class=lnt id=hl-155-10><a class=lnlinks href=#hl-155-10>10</a>
</span><span class=lnt id=hl-155-11><a class=lnlinks href=#hl-155-11>11</a>
</span><span class=lnt id=hl-155-12><a class=lnlinks href=#hl-155-12>12</a>
</span><span class=lnt id=hl-155-13><a class=lnlinks href=#hl-155-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rabbitmq.conf
</span></span><span class=line><span class=cl>auth_backends.1 = ldap
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># LDAP 서버 설정
</span></span><span class=line><span class=cl>auth_ldap.servers.1 = ldap.example.com
</span></span><span class=line><span class=cl>auth_ldap.port = 389
</span></span><span class=line><span class=cl>auth_ldap.user_dn_pattern = cn=${username},ou=People,dc=example,dc=com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 가상 호스트 액세스 제어
</span></span><span class=line><span class=cl>auth_ldap.vhost_access_query = {in_group, &#34;cn=rabbitmq,ou=Groups,dc=example,dc=com&#34;}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 태그 쿼리
</span></span><span class=line><span class=cl>auth_ldap.tag_queries.administrator = {in_group, &#34;cn=rabbitmq-admin,ou=Groups,dc=example,dc=com&#34;}
</span></span></code></pre></td></tr></table></div></div><h3 id=실무-적용-전략과-패턴>실무 적용 전략과 패턴<a hidden class=anchor aria-hidden=true href=#실무-적용-전략과-패턴>#</a></h3><h4 id=큐-설계-패턴>큐 설계 패턴<a hidden class=anchor aria-hidden=true href=#큐-설계-패턴>#</a></h4><h5 id=작업-큐-패턴>작업 큐 패턴<a hidden class=anchor aria-hidden=true href=#작업-큐-패턴>#</a></h5><p>시간이 오래 걸리는 작업을 비동기적으로 처리한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-156-1><a class=lnlinks href=#hl-156-1>1</a>
</span><span class=lnt id=hl-156-2><a class=lnlinks href=#hl-156-2>2</a>
</span><span class=lnt id=hl-156-3><a class=lnlinks href=#hl-156-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>클라이언트 -&gt; 작업 큐 -&gt; 워커 1
</span></span><span class=line><span class=cl>                     -&gt; 워커 2
</span></span><span class=line><span class=cl>                     -&gt; 워커 3
</span></span></code></pre></td></tr></table></div></div><p>구현 시 고려사항:</p><ul><li>작업 큐는 내구성이 있어야 함(durable)</li><li>메시지는 지속적이어야 함(persistent)</li><li>공정한 작업 분배를 위해 prefetch 설정</li><li>명시적인 확인(ack)으로 안전하게 처리</li></ul><h5 id=발행구독-패턴>발행/구독 패턴<a hidden class=anchor aria-hidden=true href=#발행구독-패턴>#</a></h5><p>이벤트를 여러 소비자에게 브로드캐스트한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-157-1><a class=lnlinks href=#hl-157-1>1</a>
</span><span class=lnt id=hl-157-2><a class=lnlinks href=#hl-157-2>2</a>
</span><span class=lnt id=hl-157-3><a class=lnlinks href=#hl-157-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>발행자 -&gt; Fanout Exchange -&gt; 큐 1 -&gt; 소비자 1
</span></span><span class=line><span class=cl>                          -&gt; 큐 2 -&gt; 소비자 2
</span></span><span class=line><span class=cl>                          -&gt; 큐 3 -&gt; 소비자 3
</span></span></code></pre></td></tr></table></div></div><p>사용 사례:</p><ul><li>로그 전파</li><li>실시간 업데이트</li><li>다중 시스템 동기화</li></ul><h5 id=요청응답-패턴>요청/응답 패턴<a hidden class=anchor aria-hidden=true href=#요청응답-패턴>#</a></h5><p>RPC 스타일 통신을 구현한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-158-1><a class=lnlinks href=#hl-158-1>1</a>
</span><span class=lnt id=hl-158-2><a class=lnlinks href=#hl-158-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>클라이언트 -&gt; 요청 큐 -&gt; 서버
</span></span><span class=line><span class=cl>         &lt;- 응답 큐 &lt;-
</span></span></code></pre></td></tr></table></div></div><p>구현:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-159-1><a class=lnlinks href=#hl-159-1> 1</a>
</span><span class=lnt id=hl-159-2><a class=lnlinks href=#hl-159-2> 2</a>
</span><span class=lnt id=hl-159-3><a class=lnlinks href=#hl-159-3> 3</a>
</span><span class=lnt id=hl-159-4><a class=lnlinks href=#hl-159-4> 4</a>
</span><span class=lnt id=hl-159-5><a class=lnlinks href=#hl-159-5> 5</a>
</span><span class=lnt id=hl-159-6><a class=lnlinks href=#hl-159-6> 6</a>
</span><span class=lnt id=hl-159-7><a class=lnlinks href=#hl-159-7> 7</a>
</span><span class=lnt id=hl-159-8><a class=lnlinks href=#hl-159-8> 8</a>
</span><span class=lnt id=hl-159-9><a class=lnlinks href=#hl-159-9> 9</a>
</span><span class=lnt id=hl-159-10><a class=lnlinks href=#hl-159-10>10</a>
</span><span class=lnt id=hl-159-11><a class=lnlinks href=#hl-159-11>11</a>
</span><span class=lnt id=hl-159-12><a class=lnlinks href=#hl-159-12>12</a>
</span><span class=lnt id=hl-159-13><a class=lnlinks href=#hl-159-13>13</a>
</span><span class=lnt id=hl-159-14><a class=lnlinks href=#hl-159-14>14</a>
</span><span class=lnt id=hl-159-15><a class=lnlinks href=#hl-159-15>15</a>
</span><span class=lnt id=hl-159-16><a class=lnlinks href=#hl-159-16>16</a>
</span><span class=lnt id=hl-159-17><a class=lnlinks href=#hl-159-17>17</a>
</span><span class=lnt id=hl-159-18><a class=lnlinks href=#hl-159-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 클라이언트 측</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>corrId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>AMQP</span><span class=p>.</span><span class=na>BasicProperties</span><span class=w> </span><span class=n>props</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AMQP</span><span class=p>.</span><span class=na>BasicProperties</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>correlationId</span><span class=p>(</span><span class=n>corrId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>replyTo</span><span class=p>(</span><span class=n>replyQueueName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>requestQueueName</span><span class=p>,</span><span class=w> </span><span class=n>props</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 서버 측</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=c1>// 요청 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>properties</span><span class=p>.</span><span class=na>getReplyTo</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>AMQP</span><span class=p>.</span><span class=na>BasicProperties</span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>correlationId</span><span class=p>(</span><span class=n>properties</span><span class=p>.</span><span class=na>getCorrelationId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>response</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=경쟁-소비자-패턴>경쟁 소비자 패턴<a hidden class=anchor aria-hidden=true href=#경쟁-소비자-패턴>#</a></h5><p>여러 소비자가 동일한 큐에서 메시지를 경쟁적으로 소비한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-160-1><a class=lnlinks href=#hl-160-1>1</a>
</span><span class=lnt id=hl-160-2><a class=lnlinks href=#hl-160-2>2</a>
</span><span class=lnt id=hl-160-3><a class=lnlinks href=#hl-160-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>생산자 -&gt; 큐 -&gt; 소비자 1
</span></span><span class=line><span class=cl>             -&gt; 소비자 2
</span></span><span class=line><span class=cl>             -&gt; 소비자 3
</span></span></code></pre></td></tr></table></div></div><p>이 패턴은 부하 분산에 유용하다. 각 메시지는 하나의 소비자에게만 전달된다.</p><h4 id=메시지-및-라우팅-전략>메시지 및 라우팅 전략<a hidden class=anchor aria-hidden=true href=#메시지-및-라우팅-전략>#</a></h4><h5 id=콘텐츠-기반-라우팅>콘텐츠 기반 라우팅<a hidden class=anchor aria-hidden=true href=#콘텐츠-기반-라우팅>#</a></h5><p>메시지 내용에 따라 다른 큐로 라우팅한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-161-1><a class=lnlinks href=#hl-161-1>1</a>
</span><span class=lnt id=hl-161-2><a class=lnlinks href=#hl-161-2>2</a>
</span><span class=lnt id=hl-161-3><a class=lnlinks href=#hl-161-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>생산자 -&gt; Topic Exchange -&gt; Routing Pattern &#34;*.error&#34; -&gt; 오류 처리 큐
</span></span><span class=line><span class=cl>                         -&gt; Routing Pattern &#34;*.warning&#34; -&gt; 경고 처리 큐
</span></span><span class=line><span class=cl>                         -&gt; Routing Pattern &#34;*.info&#34; -&gt; 정보 처리 큐
</span></span></code></pre></td></tr></table></div></div><h5 id=계층적-토픽>계층적 토픽<a hidden class=anchor aria-hidden=true href=#계층적-토픽>#</a></h5><p>계층적 구조를 사용하여 메시지를 조직한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-162-1><a class=lnlinks href=#hl-162-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>region.service.severity
</span></span></code></pre></td></tr></table></div></div><p>예:</p><ul><li><code>us-east.orders.error</code>: 미국 동부 지역의 주문 서비스 오류</li><li><code>eu-west.payments.info</code>: EU 서부 지역의 결제 서비스 정보</li></ul><h5 id=시간-지연-메시지>시간 지연 메시지<a hidden class=anchor aria-hidden=true href=#시간-지연-메시지>#</a></h5><p>scheduled-messages 플러그인 또는 TTL과 데드 레터 교환기를 사용하여 지연된 처리를 구현한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-163-1><a class=lnlinks href=#hl-163-1> 1</a>
</span><span class=lnt id=hl-163-2><a class=lnlinks href=#hl-163-2> 2</a>
</span><span class=lnt id=hl-163-3><a class=lnlinks href=#hl-163-3> 3</a>
</span><span class=lnt id=hl-163-4><a class=lnlinks href=#hl-163-4> 4</a>
</span><span class=lnt id=hl-163-5><a class=lnlinks href=#hl-163-5> 5</a>
</span><span class=lnt id=hl-163-6><a class=lnlinks href=#hl-163-6> 6</a>
</span><span class=lnt id=hl-163-7><a class=lnlinks href=#hl-163-7> 7</a>
</span><span class=lnt id=hl-163-8><a class=lnlinks href=#hl-163-8> 8</a>
</span><span class=lnt id=hl-163-9><a class=lnlinks href=#hl-163-9> 9</a>
</span><span class=lnt id=hl-163-10><a class=lnlinks href=#hl-163-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 지연 교환기 선언 (플러그인 필요)
</span></span><span class=line><span class=cl>channel.exchangeDeclare(&#34;delayed&#34;, &#34;x-delayed-message&#34;, true, false, 
</span></span><span class=line><span class=cl>    Map.of(&#34;x-delayed-type&#34;, &#34;direct&#34;));
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 지연 메시지 전송
</span></span><span class=line><span class=cl>channel.basicPublish(&#34;delayed&#34;, routingKey,
</span></span><span class=line><span class=cl>    new AMQP.BasicProperties.Builder()
</span></span><span class=line><span class=cl>        .headers(Map.of(&#34;x-delay&#34;, 5000))  // 5초 지연
</span></span><span class=line><span class=cl>        .build(),
</span></span><span class=line><span class=cl>    message.getBytes());
</span></span></code></pre></td></tr></table></div></div><h4 id=마이크로서비스-통합-패턴>마이크로서비스 통합 패턴<a hidden class=anchor aria-hidden=true href=#마이크로서비스-통합-패턴>#</a></h4><h5 id=이벤트-기반-통신>이벤트 기반 통신<a hidden class=anchor aria-hidden=true href=#이벤트-기반-통신>#</a></h5><p>서비스 간 느슨한 결합을 위해 이벤트를 사용한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-164-1><a class=lnlinks href=#hl-164-1>1</a>
</span><span class=lnt id=hl-164-2><a class=lnlinks href=#hl-164-2>2</a>
</span><span class=lnt id=hl-164-3><a class=lnlinks href=#hl-164-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>주문 서비스 -&gt; &#34;주문 생성&#34; 이벤트 -&gt; 재고 서비스
</span></span><span class=line><span class=cl>                                  -&gt; 결제 서비스
</span></span><span class=line><span class=cl>                                  -&gt; 배송 서비스
</span></span></code></pre></td></tr></table></div></div><p>이 패턴은 서비스의 독립적인 확장과 변경을 가능하게 한다.</p><h5 id=장애-격리>장애 격리<a hidden class=anchor aria-hidden=true href=#장애-격리>#</a></h5><p>Circuit Breaker 패턴을 RabbitMQ와 함께 사용하여 장애 전파를 방지한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-165-1><a class=lnlinks href=#hl-165-1> 1</a>
</span><span class=lnt id=hl-165-2><a class=lnlinks href=#hl-165-2> 2</a>
</span><span class=lnt id=hl-165-3><a class=lnlinks href=#hl-165-3> 3</a>
</span><span class=lnt id=hl-165-4><a class=lnlinks href=#hl-165-4> 4</a>
</span><span class=lnt id=hl-165-5><a class=lnlinks href=#hl-165-5> 5</a>
</span><span class=lnt id=hl-165-6><a class=lnlinks href=#hl-165-6> 6</a>
</span><span class=lnt id=hl-165-7><a class=lnlinks href=#hl-165-7> 7</a>
</span><span class=lnt id=hl-165-8><a class=lnlinks href=#hl-165-8> 8</a>
</span><span class=lnt id=hl-165-9><a class=lnlinks href=#hl-165-9> 9</a>
</span><span class=lnt id=hl-165-10><a class=lnlinks href=#hl-165-10>10</a>
</span><span class=lnt id=hl-165-11><a class=lnlinks href=#hl-165-11>11</a>
</span><span class=lnt id=hl-165-12><a class=lnlinks href=#hl-165-12>12</a>
</span><span class=lnt id=hl-165-13><a class=lnlinks href=#hl-165-13>13</a>
</span><span class=lnt id=hl-165-14><a class=lnlinks href=#hl-165-14>14</a>
</span><span class=lnt id=hl-165-15><a class=lnlinks href=#hl-165-15>15</a>
</span><span class=lnt id=hl-165-16><a class=lnlinks href=#hl-165-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 메시지 처리 실패 시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>processMessage</span><span class=p>(</span><span class=n>message</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 재시도 횟수 초과</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getRetryCount</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>MAX_RETRIES</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 데드 레터 큐로 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;dead-letter-exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;failed-messages&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 큐로 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>headers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>headers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-retry-count&#34;</span><span class=p>,</span><span class=w> </span><span class=n>getRetryCount</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>channel</span><span class=p>.</span><span class=na>basicPublish</span><span class=p>(</span><span class=s>&#34;retry-exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;retry.messages&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>AMQP</span><span class=p>.</span><span class=na>BasicProperties</span><span class=p>.</span><span class=na>Builder</span><span class=p>().</span><span class=na>headers</span><span class=p>(</span><span class=n>headers</span><span class=p>).</span><span class=na>build</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=cqrscommand-query-responsibility-segregation>CQRS(Command Query Responsibility Segregation)<a hidden class=anchor aria-hidden=true href=#cqrscommand-query-responsibility-segregation>#</a></h5><p>명령과 쿼리를 분리하는 CQRS 패턴에서 RabbitMQ는 명령 측과 쿼리 측 사이의 통신을 지원한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-166-1><a class=lnlinks href=#hl-166-1>1</a>
</span><span class=lnt id=hl-166-2><a class=lnlinks href=#hl-166-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>클라이언트 -&gt; 명령 -&gt; 명령 핸들러 -&gt; &#34;상태 변경&#34; 이벤트 -&gt; 이벤트 핸들러 -&gt; 쿼리 데이터베이스 업데이트
</span></span><span class=line><span class=cl>클라이언트 &lt;- 쿼리 &lt;- 쿼리 핸들러 &lt;----------------------
</span></span></code></pre></td></tr></table></div></div><h3 id=실전-운영-및-대규모-배포>실전 운영 및 대규모 배포<a hidden class=anchor aria-hidden=true href=#실전-운영-및-대규모-배포>#</a></h3><h4 id=클러스터-크기-조정>클러스터 크기 조정<a hidden class=anchor aria-hidden=true href=#클러스터-크기-조정>#</a></h4><p>클러스터 크기를 결정하는 요소:</p><ul><li>메시지 처리량</li><li>메시지 크기</li><li>큐 수</li><li>연결 및 채널 수</li><li>필요한 복제 수준</li></ul><p>일반적인 경험적 규칙:</p><ul><li>최소 3개 노드로 시작 (내결함성을 위해)</li><li>개별 노드가 50-70% CPU 사용률에 도달하면 확장</li><li>메모리 사용량이 시스템 메모리의 50%를 초과하지 않도록 유지</li></ul><h4 id=자동화-배포>자동화 배포<a hidden class=anchor aria-hidden=true href=#자동화-배포>#</a></h4><p>Ansible, Chef, Puppet과 같은 구성 관리 도구를 사용하여 RabbitMQ 배포를 자동화할 수 있다.</p><p>Ansible Playbook 예제:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-167-1><a class=lnlinks href=#hl-167-1> 1</a>
</span><span class=lnt id=hl-167-2><a class=lnlinks href=#hl-167-2> 2</a>
</span><span class=lnt id=hl-167-3><a class=lnlinks href=#hl-167-3> 3</a>
</span><span class=lnt id=hl-167-4><a class=lnlinks href=#hl-167-4> 4</a>
</span><span class=lnt id=hl-167-5><a class=lnlinks href=#hl-167-5> 5</a>
</span><span class=lnt id=hl-167-6><a class=lnlinks href=#hl-167-6> 6</a>
</span><span class=lnt id=hl-167-7><a class=lnlinks href=#hl-167-7> 7</a>
</span><span class=lnt id=hl-167-8><a class=lnlinks href=#hl-167-8> 8</a>
</span><span class=lnt id=hl-167-9><a class=lnlinks href=#hl-167-9> 9</a>
</span><span class=lnt id=hl-167-10><a class=lnlinks href=#hl-167-10>10</a>
</span><span class=lnt id=hl-167-11><a class=lnlinks href=#hl-167-11>11</a>
</span><span class=lnt id=hl-167-12><a class=lnlinks href=#hl-167-12>12</a>
</span><span class=lnt id=hl-167-13><a class=lnlinks href=#hl-167-13>13</a>
</span><span class=lnt id=hl-167-14><a class=lnlinks href=#hl-167-14>14</a>
</span><span class=lnt id=hl-167-15><a class=lnlinks href=#hl-167-15>15</a>
</span><span class=lnt id=hl-167-16><a class=lnlinks href=#hl-167-16>16</a>
</span><span class=lnt id=hl-167-17><a class=lnlinks href=#hl-167-17>17</a>
</span><span class=lnt id=hl-167-18><a class=lnlinks href=#hl-167-18>18</a>
</span><span class=lnt id=hl-167-19><a class=lnlinks href=#hl-167-19>19</a>
</span><span class=lnt id=hl-167-20><a class=lnlinks href=#hl-167-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq_nodes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add RabbitMQ repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>apt_repository</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>deb https://dl.bintray.com/rabbitmq/debian {{ ansible_distribution_release }} main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install RabbitMQ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable management plugin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rabbitmq_plugin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>names</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq_management</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>enabled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Configure cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 클러스터 구성 단계</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=대규모-배포-사례-연구>대규모 배포 사례 연구<a hidden class=anchor aria-hidden=true href=#대규모-배포-사례-연구>#</a></h3><ol><li><p>대용량 트래픽 처리<br>대량의 메시지를 처리하는 시스템의 접근 방식:</p><ul><li>메시지 배치 처리</li><li>토픽 샤딩(여러 토픽으로 분할)</li><li>컨슈머 그룹을 사용한 병렬 처리</li><li>하드웨어 최적화(SSD, 충분한 메모리, 좋은 네트워크)</li></ul></li><li><p>글로벌 분산 시스템<br>여러 지역에 분산된 RabbitMQ 클러스터 간 통신:</p><ul><li>federation 플러그인을 사용한 메시지 복제</li><li>지역적으로 가까운 클러스터에 우선 연결</li><li>샤딩 전략을 통한 지역별 데이터 분산</li></ul></li><li><p>고가용성 구성<br>1.99% 이상의 가용성을 달성하기 위한 전략:</p><ul><li>여러 가용성 영역에 걸친 최소 3노드 클러스터</li><li>적절한 모니터링 및 자동 복구 메커니즘</li><li>자동 장애 조치를 위한 로드 밸런서 구성</li><li>클라이언트 측의 재시도 및 장애 복구 전략</li></ul></li></ol><h3 id=최신-동향-및-미래-방향>최신 동향 및 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-동향-및-미래-방향>#</a></h3><h4 id=스트림-큐>스트림 큐<a hidden class=anchor aria-hidden=true href=#스트림-큐>#</a></h4><p>RabbitMQ 3.9부터 도입된 스트림 큐는 Kafka와 유사한 로그 기반 메시징 모델을 제공한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-168-1><a class=lnlinks href=#hl-168-1>1</a>
</span><span class=lnt id=hl-168-2><a class=lnlinks href=#hl-168-2>2</a>
</span><span class=lnt id=hl-168-3><a class=lnlinks href=#hl-168-3>3</a>
</span><span class=lnt id=hl-168-4><a class=lnlinks href=#hl-168-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-queue-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;stream&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-max-length-bytes&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20_000_000_000L</span><span class=p>);</span><span class=w>  </span><span class=c1>// 20GB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>channel</span><span class=p>.</span><span class=na>queueDeclare</span><span class=p>(</span><span class=s>&#34;my-stream&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>스트림 큐의 장점:</p><ul><li>더 높은 처리량</li><li>더 큰 백로그 지원</li><li>긴 기간 메시지 보존</li></ul><h4 id=서버리스-통합>서버리스 통합<a hidden class=anchor aria-hidden=true href=#서버리스-통합>#</a></h4><p>RabbitMQ를 서버리스 함수와 통합하는 패턴이 증가하고 있다:</p><ul><li>AWS Lambda + RabbitMQ</li><li>Azure Functions + RabbitMQ</li><li>Google Cloud Functions + RabbitMQ</li></ul><h4 id=컨테이너화-및-쿠버네티스>컨테이너화 및 쿠버네티스<a hidden class=anchor aria-hidden=true href=#컨테이너화-및-쿠버네티스>#</a></h4><p>쿠버네티스에서 RabbitMQ를 실행하기 위한 최신 접근 방식:</p><ul><li>RabbitMQ 쿠버네티스 오퍼레이터 사용</li><li>스테이트풀셋(StatefulSet)으로 배포</li><li>볼륨 클레임 템플릿(PersistentVolumeClaim)으로 데이터 영속성 확보</li><li>커스텀 리소스 정의(CRD)를 통한 선언적 관리</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-169-1><a class=lnlinks href=#hl-169-1> 1</a>
</span><span class=lnt id=hl-169-2><a class=lnlinks href=#hl-169-2> 2</a>
</span><span class=lnt id=hl-169-3><a class=lnlinks href=#hl-169-3> 3</a>
</span><span class=lnt id=hl-169-4><a class=lnlinks href=#hl-169-4> 4</a>
</span><span class=lnt id=hl-169-5><a class=lnlinks href=#hl-169-5> 5</a>
</span><span class=lnt id=hl-169-6><a class=lnlinks href=#hl-169-6> 6</a>
</span><span class=lnt id=hl-169-7><a class=lnlinks href=#hl-169-7> 7</a>
</span><span class=lnt id=hl-169-8><a class=lnlinks href=#hl-169-8> 8</a>
</span><span class=lnt id=hl-169-9><a class=lnlinks href=#hl-169-9> 9</a>
</span><span class=lnt id=hl-169-10><a class=lnlinks href=#hl-169-10>10</a>
</span><span class=lnt id=hl-169-11><a class=lnlinks href=#hl-169-11>11</a>
</span><span class=lnt id=hl-169-12><a class=lnlinks href=#hl-169-12>12</a>
</span><span class=lnt id=hl-169-13><a class=lnlinks href=#hl-169-13>13</a>
</span><span class=lnt id=hl-169-14><a class=lnlinks href=#hl-169-14>14</a>
</span><span class=lnt id=hl-169-15><a class=lnlinks href=#hl-169-15>15</a>
</span><span class=lnt id=hl-169-16><a class=lnlinks href=#hl-169-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq.com/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RabbitmqCluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>production-rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>2Gi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>4Gi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>persistence</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=l>fast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>20Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=이벤트-메시-및-클라우드-네이티브-메시징>이벤트 메시 및 클라우드 네이티브 메시징<a hidden class=anchor aria-hidden=true href=#이벤트-메시-및-클라우드-네이티브-메시징>#</a></h4><p>분산 시스템에서 이벤트 메시로 RabbitMQ를 사용하는 추세가 증가하고 있다:</p><ul><li>서비스 간 비동기 통신</li><li>이벤트 기반 아키텍처 지원</li><li>도메인 주도 설계(DDD)와의 통합</li><li>클라우드 네이티브 애플리케이션의 백본</li></ul><hr><h2 id=용어-정리-6>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-6>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-5>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-5>#</a></h2><h3 id=공식-문서-및-튜토리얼>공식 문서 및 튜토리얼<a hidden class=anchor aria-hidden=true href=#공식-문서-및-튜토리얼>#</a></h3><ul><li><a href=https://www.rabbitmq.com/docs>공식 문서 바로가기</a></li><li><a href=https://www.rabbitmq.com/tutorials>튜토리얼 바로가기</a></li><li><a href=https://www.rabbitmq.com/>RabbitMQ 공식 홈페이지</a></li></ul><h3 id=실습-및-단계별-가이드>실습 및 단계별 가이드<a hidden class=anchor aria-hidden=true href=#실습-및-단계별-가이드>#</a></h3><ul><li><a href=https://dev.to/felipepaz/getting-started-with-rabbitmq-and-python-a-practical-guide-57fi>Getting Started with RabbitMQ and Python: A Practical Guide (dev.to)</a></li><li><a href=https://www.rabbitmq.com/tutorials>RabbitMQ 튜토리얼(AMQP 0-9-1, 다양한 언어 예제)</a></li><li><a href=https://www.rabbitmq.com/docs/installation.html>RabbitMQ 설치 가이드 및 관리 문서</a></li></ul><h3 id=참고-도서-및-자료>참고 도서 및 자료<a hidden class=anchor aria-hidden=true href=#참고-도서-및-자료>#</a></h3><ul><li><a href=https://www.rabbitmq.com/blog/2012/05/29/jason-and-alvaros-excellent-rabbit-book>RabbitMQ in Action (Manning)</a></li><li><a href=https://www.manning.com/books/rabbitmq-in-depth>RabbitMQ in Depth (Manning)</a></li><li><a href=https://www.goodreads.com/shelf/show/rabbitmq>RabbitMQ 관련 인기 도서 목록 (Goodreads)</a></li><li><a href=https://www.cloudamqp.com/rabbitmq_ebook.html>CloudAMQP: 무료 RabbitMQ 입문 eBook</a></li></ul><h2 id=-rabbitmq-구조-및-실전-설정-가이드>✅ RabbitMQ 구조 및 실전 설정 가이드<a hidden class=anchor aria-hidden=true href=#-rabbitmq-구조-및-실전-설정-가이드>#</a></h2><hr><h3 id=1-개요>1. 개요<a hidden class=anchor aria-hidden=true href=#1-개요>#</a></h3><p>RabbitMQ 는 오픈소스 메시지 브로커로, **AMQP (Advanced Message Queuing Protocol)** 를 기반으로 하며, 다양한 메시징 패턴을 지원하고 확장성과 안정성이 뛰어나 실무에서 널리 사용됩니다. 이 가이드에서는 <strong>구조, 핵심 개념, 실전 설정, 운영 노하우</strong>를 다룹니다.</p><hr><h3 id=2-핵심-구조-및-아키텍처>2. 핵심 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#2-핵심-구조-및-아키텍처>#</a></h3><pre class=mermaid>flowchart TD
    A[Producer] --&gt; B[Exchange]
    B --&gt;|Routing Key| C1[Queue 1]
    B --&gt;|Routing Key| C2[Queue 2]
    C1 --&gt; D1[Consumer 1]
    C2 --&gt; D2[Consumer 2]
</pre><h4 id=-구성-요소-요약>📌 구성 요소 요약<a hidden class=anchor aria-hidden=true href=#-구성-요소-요약>#</a></h4><table><thead><tr><th>구성 요소</th><th>설명</th></tr></thead><tbody><tr><td><strong>Producer</strong></td><td>메시지를 발행하는 클라이언트</td></tr><tr><td><strong>Exchange</strong></td><td>메시지를 큐로 라우팅</td></tr><tr><td><strong>Queue</strong></td><td>메시지를 저장하는 버퍼 (FIFO)</td></tr><tr><td><strong>Consumer</strong></td><td>큐에서 메시지를 읽는 클라이언트</td></tr><tr><td><strong>Routing Key</strong></td><td>Exchange → Queue 로 메시지를 라우팅하는 기준</td></tr></tbody></table><hr><h3 id=3-exchange-타입별-동작-방식>3. Exchange 타입별 동작 방식<a hidden class=anchor aria-hidden=true href=#3-exchange-타입별-동작-방식>#</a></h3><table><thead><tr><th>Exchange Type</th><th>설명</th><th>예시</th></tr></thead><tbody><tr><td><strong>Direct</strong></td><td>Routing Key 와 정확히 일치하는 큐에만 전달</td><td>&ldquo;order.created&rdquo;</td></tr><tr><td><strong>Fanout</strong></td><td>Routing Key 무시, 모든 바인딩 큐에 브로드캐스트</td><td>로그 수집</td></tr><tr><td><strong>Topic</strong></td><td>와일드카드 패턴 기반</td><td>&ldquo;order.*&rdquo;, &ldquo;user.#&rdquo;</td></tr><tr><td><strong>Headers</strong></td><td>Header 속성 기반 라우팅</td><td>복잡한 조건 매칭</td></tr></tbody></table><hr><h3 id=4-실전-설정-항목>4. 실전 설정 항목<a hidden class=anchor aria-hidden=true href=#4-실전-설정-항목>#</a></h3><h4 id=41-기본-설치-방법>4.1 기본 설치 방법<a hidden class=anchor aria-hidden=true href=#41-기본-설치-방법>#</a></h4><h5 id=a-docker-기반-설치>A. Docker 기반 설치<a hidden class=anchor aria-hidden=true href=#a-docker-기반-설치>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-171-1><a class=lnlinks href=#hl-171-1>1</a>
</span><span class=lnt id=hl-171-2><a class=lnlinks href=#hl-171-2>2</a>
</span><span class=lnt id=hl-171-3><a class=lnlinks href=#hl-171-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --hostname rabbit --name rabbitmq <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 5672:5672 -p 15672:15672 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  rabbitmq:3-management
</span></span></code></pre></td></tr></table></div></div><ul><li><code>5672</code>: AMQP 포트</li><li><code>15672</code>: Management UI</li></ul><h5 id=b-kubernetes-설정-helm>B. Kubernetes 설정 (helm)<a hidden class=anchor aria-hidden=true href=#b-kubernetes-설정-helm>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-172-1><a class=lnlinks href=#hl-172-1>1</a>
</span><span class=lnt id=hl-172-2><a class=lnlinks href=#hl-172-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span class=line><span class=cl>helm install my-rabbitmq bitnami/rabbitmq
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=42-사용자-및-권한-설정>4.2 사용자 및 권한 설정<a hidden class=anchor aria-hidden=true href=#42-사용자-및-권한-설정>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-173-1><a class=lnlinks href=#hl-173-1>1</a>
</span><span class=lnt id=hl-173-2><a class=lnlinks href=#hl-173-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rabbitmqctl add_user dev_user dev_pass
</span></span><span class=line><span class=cl>rabbitmqctl set_permissions -p / dev_user <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=43-queue-설정-ttl-dlq>4.3 Queue 설정 (TTL, DLQ)<a hidden class=anchor aria-hidden=true href=#43-queue-설정-ttl-dlq>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-174-1><a class=lnlinks href=#hl-174-1>1</a>
</span><span class=lnt id=hl-174-2><a class=lnlinks href=#hl-174-2>2</a>
</span><span class=lnt id=hl-174-3><a class=lnlinks href=#hl-174-3>3</a>
</span><span class=lnt id=hl-174-4><a class=lnlinks href=#hl-174-4>4</a>
</span><span class=lnt id=hl-174-5><a class=lnlinks href=#hl-174-5>5</a>
</span><span class=lnt id=hl-174-6><a class=lnlinks href=#hl-174-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># TTL + DLQ 설정</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;x-message-ttl&#34;</span>: 60000,  <span class=c1># 메시지 TTL 60초</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;x-dead-letter-exchange&#34;</span>: <span class=s2>&#34;dead_exchange&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;x-dead-letter-routing-key&#34;</span>: <span class=s2>&#34;dead_key&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=44-클러스터링-구조>4.4 클러스터링 구조<a hidden class=anchor aria-hidden=true href=#44-클러스터링-구조>#</a></h4><pre class=mermaid>graph LR
  A[Node 1] --&gt;|Mirror| B[Node 2]
  A --&gt;|Queue Sync| C[Node 3]
</pre><ul><li><strong>Classic Mirrored Queue</strong>: 모든 노드에 복제</li><li><strong>Quorum Queue</strong>: Paxos 기반 고가용 큐</li></ul><hr><h3 id=5-운영-시-고려사항>5. 운영 시 고려사항<a hidden class=anchor aria-hidden=true href=#5-운영-시-고려사항>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장 설정</th></tr></thead><tbody><tr><td><strong>모니터링</strong></td><td>연결 수, 큐 길이, Ack 실패</td><td>Prometheus, Grafana, RabbitMQ Exporter</td></tr><tr><td><strong>퍼포먼스</strong></td><td>높은 TPS 시 메시지 유실 우려</td><td>QoS 설정, Prefetch count 튜닝</td></tr><tr><td><strong>보안</strong></td><td>인증, 암호화 필요</td><td>TLS, 사용자 권한 분리</td></tr><tr><td><strong>장애 대응</strong></td><td>Consumer 실패, 메시지 누락</td><td>DLQ 구성, Retry Policy 도입</td></tr></tbody></table><hr><h3 id=6-예시-메시지-큐-생성-및-라우팅>6. 예시: 메시지 큐 생성 및 라우팅<a hidden class=anchor aria-hidden=true href=#6-예시-메시지-큐-생성-및-라우팅>#</a></h3><h4 id=python-pika>Python (pika)<a hidden class=anchor aria-hidden=true href=#python-pika>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-176-1><a class=lnlinks href=#hl-176-1> 1</a>
</span><span class=lnt id=hl-176-2><a class=lnlinks href=#hl-176-2> 2</a>
</span><span class=lnt id=hl-176-3><a class=lnlinks href=#hl-176-3> 3</a>
</span><span class=lnt id=hl-176-4><a class=lnlinks href=#hl-176-4> 4</a>
</span><span class=lnt id=hl-176-5><a class=lnlinks href=#hl-176-5> 5</a>
</span><span class=lnt id=hl-176-6><a class=lnlinks href=#hl-176-6> 6</a>
</span><span class=lnt id=hl-176-7><a class=lnlinks href=#hl-176-7> 7</a>
</span><span class=lnt id=hl-176-8><a class=lnlinks href=#hl-176-8> 8</a>
</span><span class=lnt id=hl-176-9><a class=lnlinks href=#hl-176-9> 9</a>
</span><span class=lnt id=hl-176-10><a class=lnlinks href=#hl-176-10>10</a>
</span><span class=lnt id=hl-176-11><a class=lnlinks href=#hl-176-11>11</a>
</span><span class=lnt id=hl-176-12><a class=lnlinks href=#hl-176-12>12</a>
</span><span class=lnt id=hl-176-13><a class=lnlinks href=#hl-176-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 연결 설정</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐, 익스체인지 선언</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;log_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=s1>&#39;log_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 전송</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=s1>&#39;Hello Log&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=7-실제-사용-시나리오>7. 실제 사용 시나리오<a hidden class=anchor aria-hidden=true href=#7-실제-사용-시나리오>#</a></h3><table><thead><tr><th>분야</th><th>사용 목적</th><th>설명</th></tr></thead><tbody><tr><td>전자상거래</td><td>주문 처리 비동기화</td><td>결제 → 주문 시스템 간 연결</td></tr><tr><td>IoT</td><td>센서 데이터 처리</td><td>게이트웨이 → 중앙 처리기</td></tr><tr><td>로그 수집</td><td>Fanout 기반 수집</td><td>여러 로그 분석기로 병렬 분배</td></tr><tr><td>마이크로서비스</td><td>서비스 간 통신</td><td>느슨한 결합 구조 구성</td></tr></tbody></table><hr><h3 id=8-결론-및-확장-방향>8. 결론 및 확장 방향<a hidden class=anchor aria-hidden=true href=#8-결론-및-확장-방향>#</a></h3><ul><li><strong>RabbitMQ 는 다양한 메시징 시나리오에 유연하게 대응할 수 있는 브로커</strong>로서, 마이크로서비스, IoT, 이벤트 기반 처리 등 여러 분야에 적합합니다.</li><li>실전 운영에서는 <strong>라우팅 설계, 큐 정책 설정, 장애 대응 메커니즘 (DLQ/Retry)</strong> 등을 통해 신뢰성과 가용성을 확보하는 것이 중요합니다.</li></ul><hr><h3 id=-다음-심화-주제-제안>✅ 다음 심화 주제 제안<a hidden class=anchor aria-hidden=true href=#-다음-심화-주제-제안>#</a></h3><ol><li>메시지 포맷 관리 (Avro/Protobuf + 스키마 레지스트리)</li><li>메시지 보장 전략 실습 (Exactly-once / At-least-once)</li><li>Kafka 와 RabbitMQ 비교 실전</li><li>실시간 스트리밍 설계 (Kafka Streams / GCP Pub/Sub + Dataflow)</li></ol></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>