<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>트랜잭션 (Transactions) | hyunyoun's Blog</title><meta name=keywords content="Databases,More-about-Databases,Transactions"><meta name=description content="데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-design/distributed-systems/transactions/transactions/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-design/distributed-systems/transactions/transactions/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-design/distributed-systems/transactions/transactions/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="트랜잭션 (Transactions)"><meta property="og:description" content="데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-24T13:19:00+00:00"><meta property="article:modified_time" content="2024-10-24T13:19:00+00:00"><meta property="article:tag" content="Databases"><meta property="article:tag" content="More-About-Databases"><meta property="article:tag" content="Transactions"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="트랜잭션 (Transactions)"><meta name=twitter:description content="데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"트랜잭션 (Transactions)","item":"https://buenhyden.github.io/posts/system-design/distributed-systems/transactions/transactions/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"트랜잭션 (Transactions)","name":"트랜잭션 (Transactions)","description":"데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위","keywords":["Databases","More-about-Databases","Transactions"],"articleBody":"트랜잭션 (Transactions) 1 부. 태그, 분류 구조, 요약 및 개요 1. 태그 (Tag) Transaction, Database-Systems, Data-Integrity, Concurrency-Control\n2. 분류 구조의 적합성 분석 “Systems and Infrastructure \u003e Database Systems” 분류는 트랜잭션 (Transactions) 의 본질을 잘 반영합니다. 트랜잭션은 데이터베이스 시스템의 핵심 기능이자, 데이터 무결성과 동시성 제어, 장애 복구 등 모든 데이터베이스 운영의 중심이 되는 개념이므로 이 분류 체계가 적합합니다.\n3. 200 자 내외 요약 트랜잭션 (Transaction) 은 데이터베이스에서 하나의 논리적 작업 단위로, 원자성, 일관성, 고립성, 지속성 (ACID) 을 보장하여 데이터의 무결성과 신뢰성을 확보합니다. 트랜잭션은 동시성 제어, 장애 복구 등 복잡한 환경에서도 안정적인 데이터 처리를 가능하게 합니다.\n4. 250 자 내외 개요 트랜잭션 (Transaction) 은 데이터베이스에서 여러 작업을 하나의 논리적 단위로 묶어 처리하는 개념입니다. 트랜잭션은 반드시 원자성 (Atomicity), 일관성 (Consistency), 고립성 (Isolation), 지속성 (Durability) 이라는 ACID 특성을 지켜야 하며, 이를 통해 데이터의 신뢰성과 무결성을 보장합니다. 실무에서는 금융, 예약, 전자상거래 등 데이터 정합성이 중요한 시스템에서 필수적으로 사용되며, 동시성 제어와 장애 복구 등 다양한 기술과 연계되어 운영됩니다.\n2 부. 트랜잭션 심층 분석 1. 핵심 개념 트랜잭션 (Transaction): 데이터베이스에서 하나의 논리적 작업 단위로, 여러 작업을 묶어서 원자적으로 처리 ACID 특성: 원자성, 일관성, 고립성, 지속성 보장 커밋 (Commit)/롤백 (Rollback): 트랜잭션의 성공/실패 처리 방식 2. 실무 연관성 분석 데이터 무결성 보장, 동시성 제어, 장애 복구에 필수 금융, 주문, 예약 등 데이터 정합성이 중요한 시스템에서 핵심 역할 3. 배경 여러 사용자가 동시에 데이터베이스에 접근할 때 데이터 손실, 불일치, 장애 발생 방지 필요성에서 등장 4. 목적 및 필요성 데이터 손상 및 불일치 방지 장애 발생 시 데이터 복구 신뢰성 있는 데이터베이스 운영 5. 주요 기능 및 역할 논리적 작업 단위로 묶어 처리 부분 실패 시 전체 작업 취소 (원자성) 트랜잭션 간 간섭 방지 (고립성) 장애 발생 시 데이터 복구 (지속성) 6. 특징 명확한 성공/실패 처리 동시성 및 장애 복원력 강화 트랜잭션 단위의 일관성 보장 7. 핵심 원칙 ACID 특성 준수 (원자성, 일관성, 고립성, 지속성) 8. 주요 원리 및 작동 원리 flowchart TD A[트랜잭션 시작] --\u003e B[작업 수행] B --\u003e C{모든 작업 성공?} C -- 예 --\u003e D[커밋(Commit)] C -- 아니오 --\u003e E[롤백(Rollback)] D --\u003e F[트랜잭션 종료] E --\u003e F 설명: 트랜잭션 내 모든 작업이 성공하면 커밋, 하나라도 실패하면 롤백되어 데이터의 무결성이 보장됩니다. 9. 구조 및 아키텍처 구성 요소 기능 역할 트랜잭션 관리자 트랜잭션 상태 관리 ACID 특성 보장 로그 관리자 변경 이력 기록 복구 및 지속성 지원 동시성 제어기 동시 트랜잭션 조정 고립성, 일관성 유지 복구 관리자 장애 시 데이터 복구 지속성, 일관성 보장 선택 구성요소 구성 요소 기능 역할 락 관리자 자원 잠금 관리 고립성 강화 체크포인트 관리자 상태 저장 복구 최적화 구조 다이어그램 flowchart LR User(사용자) --\u003e TxManager(트랜잭션 관리자) TxManager --\u003e LogManager(로그 관리자) TxManager --\u003e Concurrency(동시성 제어기) TxManager --\u003e Recovery(복구 관리자) Concurrency --\u003e DB(데이터베이스) Recovery --\u003e DB LogManager --\u003e DB 설명: 트랜잭션 관리자는 로그, 동시성, 복구 관리자를 통해 데이터베이스의 ACID 특성을 보장합니다. 3 부. 구현 기법, 장단점, 실무 활용 1. 구현 기법 Write-Ahead Logging (WAL, 선기록 로그): 변경 전 로그 기록 후 실제 데이터 변경 Locking(락킹): 자원 잠금으로 동시성 제어 MVCC(다중 버전 동시성 제어): 버전별 데이터 관리로 고립성 보장 2-Phase Commit(2PC, 2 단계 커밋): 분산 트랜잭션에서 원자성 보장 2. 장점 구분 항목 설명 장점 데이터 무결성 트랜잭션 단위로 일관성 보장 장점 신뢰성 오류·장애 발생 시 데이터 손실 방지 장점 동시성 여러 트랜잭션의 안정적 병행 처리 장점 복구 용이성 장애 발생 시 신속한 복구 가능 3. 단점과 문제점 그리고 해결방안 단점 구분 항목 설명 해결책 단점 성능 저하 동시성 제어로 인한 지연 MVCC, 최적화된 락 전략 단점 복잡성 증가 트랜잭션 관리 로직 복잡 자동화 도구 활용 단점 확장성 한계 분산 환경에서 관리 어려움 분산 트랜잭션 프로토콜 문제점 구분 항목 원인 영향 탐지 및 진단 예방 방법 해결 방법 및 기법 문제점 데드락 상호 잠금 트랜잭션 정지 모니터링, 타임아웃 락 순서 지정 데드락 회피 알고리즘 문제점 성능 저하 락 경합 응답 지연 성능 모니터링 락 범위 최소화 MVCC 적용 문제점 일관성 오류 트랜잭션 실패 데이터 불일치 정합성 검사 트랜잭션 재시도 자동 롤백 4. 도전 과제 분산 환경에서의 트랜잭션 일관성 보장 글로벌 트랜잭션의 성능·확장성 최적화 장애 복구 자동화 및 신뢰성 강화 5. 분류 기준에 따른 종류 및 유형 분류 기준 유형 설명 트랜잭션 범위 단일 데이터베이스 하나의 DB 내 트랜잭션 트랜잭션 범위 분산 트랜잭션 여러 DB, 시스템 간 트랜잭션 동시성 제어 Locking 기반 자원 잠금 방식 동시성 제어 MVCC 기반 다중 버전 관리 방식 6. 실무 사용 예시 사용 분야 함께 사용하는 시스템 목적 효과 금융 거래 Oracle, PostgreSQL 정확한 잔액 처리 데이터 손실 및 오류 방지 전자상거래 주문 MySQL, MongoDB 주문/재고 동시 처리 정확한 재고 관리 예약 시스템 SQL Server 동시 예약 방지 이중 예약 방지 7. 활용 사례 전자상거래 주문 처리 시스템 주문 요청 → 트랜잭션 시작 → 재고 차감 및 결제 → 성공 시 커밋, 실패 시 롤백 트랜잭션 미적용 시: 장애 발생 시 재고 불일치, 결제 오류 발생 가능 트랜잭션 적용 시: 장애 발생 시 모든 작업 롤백, 데이터 일관성 유지 flowchart TD A[주문 요청] --\u003e B[트랜잭션 시작] B --\u003e C[재고 차감] C --\u003e D[결제 처리] D --\u003e E{모두 성공?} E -- 예 --\u003e F[커밋] E -- 아니오 --\u003e G[롤백] 8. 구현 예시 (Python, SQLAlchemy) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # SQLAlchemy를 활용한 트랜잭션 처리 예시 from sqlalchemy import create_engine from sqlalchemy.orm import sessionmaker engine = create_engine('postgresql://user:pw@localhost/db') Session = sessionmaker(bind=engine) session = Session() try: # 트랜잭션 시작 # 주문 정보 저장 # 재고 차감 # 결제 처리 session.commit() # 모든 작업 성공 시 커밋 except Exception as e: session.rollback() # 하나라도 실패 시 롤백 finally: session.close() 설명: 모든 작업이 성공하면 커밋, 실패 시 롤백하여 원자성과 일관성을 보장합니다. 9. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점 구분 항목 설명 설계 트랜잭션 경계 명확화 작업 단위 명확히 구분 운영 동시성 제어 락 경합 최소화 복구 로그 관리 WAL 등 로그 기록 필수 확장성 분산 트랜잭션 관리 XA 등 프로토콜 적용 권장사항: 트랜잭션 범위 최소화, 자동화 도구 활용, 실시간 모니터링 도입 10. 최적화하기 위한 고려사항 및 주의할 점 구분 항목 설명 성능 락 범위 최소화 필요한 자원만 잠금 동시성 MVCC 활용 충돌 최소화 복구 체크포인트 관리 복구 시간 단축 운영 모니터링 데드락·성능 이슈 실시간 감지 권장사항: MVCC 및 WAL 적극 활용, 자동화된 복구 및 모니터링 시스템 구축 4 부. 주제별 주목할 내용 및 학습 필수 항목 1. 주제별 주목할 내용 카테고리 주제 항목 설명 트랜잭션 ACID 4 대 원칙 데이터베이스 신뢰성의 핵심 동시성 Locking 자원 잠금 고립성, 일관성 보장 복구 WAL 로그 기반 복구 지속성, 장애 복구 확장성 2PC 분산 트랜잭션 원자성 보장 2. 반드시 학습해야할 내용 카테고리 주제 항목 설명 트랜잭션 ACID 원자성, 일관성, 고립성, 지속성 트랜잭션의 기본 원칙 동시성 제어 Locking, MVCC 동시성 관리 여러 트랜잭션의 안정적 실행 복구 WAL, Shadow Paging 장애 복구 데이터 손실 방지 분산 시스템 분산 트랜잭션 확장성 여러 시스템 간 일관성 유지 용어 정리 카테고리 용어 설명 트랜잭션 트랜잭션 (Transaction) 데이터베이스에서 하나의 논리적 작업 단위 트랜잭션 커밋 (Commit) 트랜잭션의 모든 작업을 영구 반영하는 명령 트랜잭션 롤백 (Rollback) 트랜잭션 내 모든 작업을 취소하는 명령 동시성 락 (Lock) 동시 접근 제어를 위한 자원 잠금 기법 복구 로그 (Log) 변경 이력을 기록한 파일 복구 체크포인트 (Checkpoint) 복구 시점 저장을 위한 데이터베이스 상태 분산 2PC(2-Phase Commit) 분산 트랜잭션의 원자성 보장 프로토콜 최적화 MVCC(Multi-Version Concurrency Control) 다중 버전 동시성 제어 기법 참고 및 출처 트랜잭션 개념 및 ACID 특성 트랜잭션과 동시성 제어 Write-Ahead Logging 개념 분산 트랜잭션과 2PC MVCC와 동시성 제어 다음은 Transactions 주제에 대한 심화 정리입니다.\n1. 태그 Database-Transactions ACID-Properties Concurrency-Control Distributed-Transactions 2. 분류 구조 적절성 분석 현재 “Systems and Infrastructure \u003e Database Systems” 안에 “Transactions” 가 위치하고 있으며, 이는 데이터베이스 동작의 핵심 개념으로 적절합니다.\n근거:\n트랜잭션은 DB 의 일관성, 동시성, 복구의 핵심 메커니즘이므로, 해당 분류 구조가 매우 적합합니다. 3. 요약 (200 자 내외) 트랜잭션은 여러 데이터베이스 작업을 하나의 논리적 단위로 묶어 ACID(Atomicity, Consistency, Isolation, Durability) 를 보장합니다. 이를 통해 동시성 문제 및 시스템 장애에도 데이터 정확성과 일관성을 유지합니다. Isolation 수준 (Serializable, Repeatable Read 등) 을 설정하여 동시성 - 성능 균형을 조절하며, 분산 환경에서는 2 상 커밋 같은 프로토콜이 활용됩니다.\n4. 개요 (250 자 내외) 데이터베이스 트랜잭션은 여러 연산을 하나의 원자적 (atomic) 유닛으로 처리하여, 실패 시 롤백, 성공 시 커밋 처리하는 일련의 흐름입니다. 이는 ACID 속성을 기반으로 하며, 동시성 제어를 통해 여러 트랜잭션이 충돌 없이 실행되도록 합니다. Isolation 수준 (Serializable 등) 을 조정해 일관성과 성능을 조율하고, 시스템 장애 시 WAL(write-ahead logging) 이나 쉐도 페이지 (shadow paging) 로 복구됩니다. 분산 환경에서는 2PC(two-phase commit) 로 전역 원자성을 보장합니다.\n5. 핵심 개념 Transaction: 일련의 DB 작업 (read/write) 의 의미있는 묶음, BEGIN…COMMIT/ROLLBACK 통해 경계 정의 (위키백과) ACID 특성: Atomicity: 전부 실행되거나 전혀 실행되지 않음 Consistency: 트랜잭션 전후에 DB 무결성 보장 (위키백과) Isolation: 동시 트랜잭션 간 간섭 없음, 격리 수준에 따라 동시성 조절 Durability: 커밋 후 영구 저장, 시스템 장애에도 손실 없음 (위키백과) Isolation Levels: ANSI 수준 (READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE), 동시성 현상 관리 (위키백과) 5.1. 실무 연관성 금융/재무 시스템: 정확한 금액 이체와 무결성 보장 동시 사용: 쇼핑카트, 예약 시스템에서 경쟁 조건 방지 분산 트랜잭션: 데이터 샤딩 환경에서 일관성 유지 6. 주요 원리 \u0026 작동 방식 원리: WAL \u0026 MVCC Write-Ahead Logging: 로그에 먼저 기록 후 반영 → 복구 지원 (tru-dasc.github.io, 위키백과) Concurrency Control: Lock 기반 (2PL): 잠금을 통해 동시성 조절 MVCC(snapshot): 버전 기반 읽기, Dirty/Non-repeatable/Phantom 방지 (위키백과) 작동 다이어그램 (MVCC + 2PL) sequenceDiagram participant T1 participant T2 T1-\u003e\u003eDB: BEGIN DB-\u003e\u003eT1: Snapshot at S1 T1-\u003e\u003eDB: UPDATE A T2-\u003e\u003eDB: BEGIN DB-\u003e\u003eT2: Snapshot at S1 T2-\u003e\u003eDB: READ A (old version) T1-\u003e\u003eDB: COMMIT → write-ahead log, version++ T2-\u003e\u003eDB: UPDATE A? → check version conflict 7. 구조 및 아키텍처 구성 요소 구성 요소 필수/선택 역할 Transaction Manager 필수 트랜잭션 시작/커밋/롤백, 상태 관리 Concurrency Control 필수 Lock/MVCC / 격리 수준 관리 Recovery Manager 필수 WAL 기반 장애 복구 구현 Log Manager 필수 WAL 기록 및 체크포인트 관리 Scheduler 선택 작업 스케줄링 및 동시성 조정 2PC Coordinator 선택 분산 트랜잭션 커밋 협의 Timeout Manager 선택 롱 트랜잭션 탐지/타임아웃 아키텍처 도식 flowchart LR App --\u003e TM[Transaction Manager] TM --\u003e CControl[Concurrency Control] TM --\u003e LogM[Log Manager] TM --\u003e RM[Recovery Manager] CControl --\u003e Storage LogM --\u003e WAL RM --\u003e Storage 8. 구현 기법 단일 인스턴스 DB: WAL + 2PL 또는 MVCC 분산 트랜잭션: 2PC (코디네이터 + 참가자, voting) NoSQL/Bulk 데이터베이스: Multi-document 트랜잭션 (MongoDB), 제한된 ACID 적용 (GeeksforGeeks, hevodata.com, 위키백과, MongoDB) 9. 장점 구분 항목 설명 장점 데이터 무결성 보장 ACID 로 정확한 처리 흐름 유지 동시성 관리 Isolation 수준으로 교착 없이 처리 장애 복구 능력 WAL+Recovery 로 데이터 손실 방지 일관된 분산 처리 2PC 로 전역 동기화된 커밋 보장 10. 단점·문제점·해결방안 단점 구분 항목 설명 해결책 단점 성능 오버헤드 Lock/MVCC 관리로 처리 지연 최적 isolation 설정, 인덱스 활용 확장성 한계 2PC 로 인한 블로킹 및 복잡도 증가 Saga 패턴으로 대체 자원 사용 증가 로그/버전 관리 비용 발생 로그 압축, 버전 GC 설정 문제점 구분 항목 원인 영향 탐지 예방 해결 문제점 Deadlock 순환 Lock 대기 시스템 hang Deadlock detector 올바른 잠금 순서 타임아웃, rollback Phantom read 낮은 isolation 불일치 조회 비정상 query 결과 SERIALIZABLE 수준 Upgrade isolation Coordinator crash 2PC 중단 분산 블로킹 Unresolved participants Retry, Timeout Recovery 절차 완비 11. 분류 기준별 유형 비교 기준 유형 설명 Isolation 기준 Read Uncommitted, Read Committed, Repeatable Read, Serializable ANSI 표준 Concurrency 방식 Lock-based, MVCC 동시성 제어 방식 환경 기준 Local, Distributed 분산 여부 기준 12. 실무 사용 예시 시스템 사용 목적 효과 금융 앱 이체 작업 개발 금액 정확성, 롤백 보장 전자상거래 주문/재고 동시 처리 재고 오버셀 방지 분산 서비스 샤 arded DB 간 트랜잭션 Saga vs 2PC 전략 선택 13. 활용 사례–은행 계좌 이체 시스템 구성도 graph LR A[App API] --\u003e TM[Transaction Manager] TM --\u003e DB1 TM --\u003e DB2 Workflow 계좌 A 에서 금액 차감 계좌 B 에 금액 입금 두 DB 에 대해 2PC 수행 모두 성공 시 Commit, 아니면 Rollback With 트랜잭션: 원자성 확보, 불일치 없음\nWithout 트랜잭션: 반만 실행될 경우 데이터 불일치 및 오류 발생\n14. 구현 예시 (Node.js) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 async function transfer(client1, client2, amount) { const conn1 = await client1.connect(); const conn2 = await client2.connect(); try { await conn1.query('BEGIN'); await conn2.query('BEGIN'); await conn1.query('UPDATE accounts SET bal=bal-$1 WHERE id=$2', [amount, 'A']); await conn2.query('UPDATE accounts SET bal=bal+$1 WHERE id=$2', [amount, 'B']); await Promise.all([conn1.query('COMMIT'), conn2.query('COMMIT')]); } catch(e) { await conn1.query('ROLLBACK'); await conn2.query('ROLLBACK'); throw e; } finally { conn1.release(); conn2.release(); } } 15. 실무 적용 고려사항 고려 항목 설명 권장 사항 Isolation 선택 데이터 정합성 vs 성능 대부분 R/C, 필요 시 R/R Timeout 설정 롱 트랜잭션 방지 타임아웃 + 모니터링 로그 및 GC MVCC log 누적 방지 VACUUM/Cleanup 주기 설정 장애 대응 중단된 트랜잭션 탐지 Deadlock 감지, coordinator 복구 16. 최적화 고려사항 항목 설명 권장 사항 인덱스 활용 Lock 범위 최소화 WHERE↑JOIN 컬럼 인덱스 배치 처리 트랜잭션 오버헤드 감소 100~1000 건당 묶기 Isolation 혼합 사용 경우에 따라 차등 적용 읽기: R/C, 쓰기: R/R Connection Pool 조정 트랜잭션 수에 연동 max connections \u003c DB limit 용어 정리 카테고리 용어 설명 기본 개념 Transaction 작업의 논리적 단위, ACID 보장 ACID 속성 Atomicity 원자성, 전부 또는 전무 ACID 속성 Consistency 일관성, 무결성 규칙 유지 ACID 속성 Isolation 격리성, 동시성 간섭 방지 ACID 속성 Durability 영구성, 커밋 보장 동시성 MVCC 멀티 버전 동시성 제어 동시성 2PL 2 단계 잠금 프로토콜 분산 트랜잭션 2PC 2 상 커밋 프로토콜 참고 및 출처 [Databricks: ACID 트랜잭션 정의](위키백과, dev.mysql.com, databricks.com) [Wikipedia: ACID 속성 유래] [CockroachLabs: Isolation Level 설명](cockroachlabs.com) [PostgreSQL 문서: Isolation 레벨](PostgreSQL) [Wikipedia: MVCC (Snapshot Isolation)](위키백과) 필요하신 추가 항목 (분산 트랜잭션 상세, 트랜잭션 모니터링 등) 도 언제든 요청하세요!\n이어서 Transactions 주제의 나머지 항목을 상세하게 정리합니다.\n17. 도전 과제 (Challenges in Practice) 트랜잭션은 실무에서 확장성, 성능, 복구 전략, 분산 처리 등 다양한 과제를 안고 있습니다.\n카테고리 항목 원인 영향 탐지 및 진단 예방 방법 해결 방법 및 기법 동시성 제어 Lock Contention 다중 쓰기 충돌 성능 저하, Deadlock 대기 시간, Lock Queue 모니터링 분리된 범위로 쓰기 분산 MVCC 기반 버전 격리 분산 환경 2PC 지연 참가자 간 메시지 지연 블로킹, 불완전 트랜잭션 Coordinator 로그 분석 Saga 기반 롤백 설계 Compensation 트랜잭션 도입 복구 전략 WAL 손상 디스크 오류 로그 기반 복구 실패 CRC 검사, 로그 비교 WAL 이중화 RAID 구성, 이중 로그 채널 시스템 확장 글로벌 트랜잭션 증가 마이크로서비스 간 분산 처리 트랜잭션 관리 복잡도 상승 트랜잭션 추적 로그 서비스 단위 최소화 분산 트랜잭션 추상화 도입 (Atomikos, Debezium) 데이터 지연 트랜잭션 큐 증가 높은 TPS → 처리 병목 대기 시간 증가 대기열 모니터링 처리량 기반 Auto-scaling 비동기 트랜잭션 처리 18. 분류 기준에 따른 종류 및 유형 분류 기준 유형 설명 트랜잭션 환경 Local Transaction 단일 DB 내 트랜잭션 Distributed Transaction 여러 DB 노드에 걸친 트랜잭션 (2PC 사용) 처리 단위 기준 Flat Transaction 단일 수준의 begin/commit 구조 Nested Transaction 하위 트랜잭션 포함 구조 동시성 제어 방식 Lock-based Concurrency 잠금 기반 격리 제어 (2PL) MVCC (Multi-Version Concurrency) 버전 기반 비차단 읽기 실패 복구 방식 Undo Logging 이전 상태 저장 → 롤백 Redo Logging 변경사항 저장 → 복구 API 스타일 기준 Declarative Transaction 설정 기반 관리 (@Transactional) Programmatic Transaction 명시적 API 호출 관리 19. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점 고려 항목 설명 권장 사항 Isolation Level 낮을수록 성능 향상, 높을수록 정합성 보장 기본은 Read Committed, 중요 데이터는 Serializable 커넥션 수 제한 동시 트랜잭션 수는 DB 의 커넥션 수 제약에 영향 커넥션 풀을 적절히 설정하고 트랜잭션 범위를 짧게 유지 트랜잭션 범위 정의 긴 트랜잭션은 교착 상태 유발 가능성 ↑ 트랜잭션 범위를 최소화하고 명확히 경계 설정 장애 복구 전략 수립 WAL, replication 등을 활용한 복구 메커니즘 필수 DB 장애 시 빠른 복구를 위한 백업 및 장애대응 자동화 분산 환경 고려 마이크로서비스 간 트랜잭션은 복잡도 높음 분산 트랜잭션 프레임워크 (Saga, Atomikos 등) 활용 20. 최적화하기 위한 고려사항 및 주의할 점 최적화 항목 설명 권장 사항 Read-Only 트랜잭션 구분 읽기 전용 트랜잭션은 격리 수준 낮게 설정 성능 개선 위해 READ COMMITTED 활용 Index 최적화 트랜잭션 내 검색 성능 향상 WHERE 절과 JOIN 키에 적절한 인덱스 구성 Bulk 처리 최적화 다건 처리 시 트랜잭션 하나로 묶어 오버헤드 감소 500~1000 건 단위로 batching 트랜잭션 프로파일링 병목 파악 및 로그 분석 pg_stat_activity, SHOW ENGINE INNODB STATUS 등 활용 쓰기 분산 전략 특정 테이블 집중 쓰기 → 경합 발생 샤딩 (sharding), 파티셔닝 (partitioning) 도입 21. 기타 사항 트랜잭션 Vs 비동기 메시지 기반 처리 비교 (표) 기준 트랜잭션 기반 처리 비동기 메시지 처리 일관성 강한 정합성 보장 (ACID) Eventually Consistent 성능 TPS 제한 가능성 있음 고성능 처리 가능 장애 복구 로그 기반 재처리 지원 메시지 재시도 가능 구현 복잡도 상대적으로 단순 메시지 큐, 보상 로직 필요 사용 사례 금융, 재고, 주문 처리 등 이벤트 전파, 분산 처리 등 22. 주제와 관련하여 주목할 내용 카테고리 주제 항목 설명 트랜잭션 모델 ACID Durability 장애 후에도 데이터 일관성 유지 동시성 격리 수준 Serializable 가장 강력한 데이터 정합성 보장 장애 복구 WAL Write-Ahead Logging 장애 복구 시점 제어의 핵심 메커니즘 분산 처리 2PC Two-Phase Commit 분산 트랜잭션의 표준 처리 방식 대체 전략 Saga 보상 트랜잭션 기반 분산처리 롱 트랜잭션 없이 확장성 확보 가능 23. 반드시 학습해야 할 내용 카테고리 주제 항목 설명 기본 이론 트랜잭션 모델 ACID 트랜잭션의 4 대 핵심 속성 동시성 제어 MVCC / 2PL 격리 수준 설정 동시성 문제를 방지하는 제어 기술 분산 환경 2PC, 3PC, Saga 커밋/보상 전략 글로벌 트랜잭션 구현을 위한 기술 복구 전략 로그 기반 복구 Undo/Redo Logging 장애 대응 및 무결성 확보 프레임워크 JTA, Atomikos 트랜잭션 API 분산 트랜잭션 관리용 표준 프레임워크 용어 정리 카테고리 용어 설명 트랜잭션 이론 Atomicity 트랜잭션의 원자성: 모두 또는 전무 수행 원칙 트랜잭션 이론 Isolation 서로 다른 트랜잭션 간 간섭 차단 트랜잭션 이론 Durability 커밋된 변경은 장애에도 유지 동시성 제어 MVCC 버전 기반 동시성 처리 기법 동시성 제어 2PL 잠금 기반 격리 전략 (2 단계 잠금 프로토콜) 장애 복구 WAL 로그 우선 기록, 장애 시 롤백/재실행 가능 분산 처리 2PC 전역 커밋 여부 협의 프로토콜 대체 전략 Saga 각 작업의 보상 트랜잭션을 통한 분산 제어 참고 및 출처 ACID Transactions - Wikipedia Isolation Levels - PostgreSQL Docs Concurrency Control in DBMS - GeeksforGeeks Write-Ahead Logging - PostgreSQL Wiki MongoDB ACID Transactions Saga Pattern - microservices.io 2PC and Distributed Transactions - Oracle Docs 이어서 Transactions 주제의 마무리 정리 및 보완 내용을 중심으로 작성합니다.\n24. 기타 사항 (추가로 알아야 할 필수 개념 및 기술) 1) 트랜잭션과 트랜잭션 로그의 차이 트랜잭션: DB 의 상태를 바꾸는 작업 집합 트랜잭션 로그 (WAL): DB 에 실제 반영 전에 수행 작업을 기록하여 복구 시 활용 ⇒ 트랜잭션이 실행한 작업을 영속화하고, 복구 및 재처리의 기준점이 되는 핵심 기술 2) 트랜잭션 관점에서의 Query Best Practices 분류 Best Practice 설명 SELECT FOR UPDATE 최소화 불필요한 잠금 방지, 교착 상태 위험 감소 INSERT/UPDATE WHERE 정확성 확보 인덱스를 활용한 타겟 최소화 DELETE LIMIT 및 배치 대량 삭제 시 소규모로 나눠 처리, 롤백 부담 경감 전체 트랜잭션 내 로직 최소화 외부 호출 (HTTP 등) 을 트랜잭션 외부로 분리 3) 트랜잭션과 인프라스트럭처 연계 고려사항 영역 연계 고려 요소 설명 컨테이너 환경 트랜잭션 유지 Kubernetes 에서 롤백 고려, Init container 실패 시 유의 CI/CD 트랜잭션 보존 여부 배포 중단 시 미완료 트랜잭션 롤백 상태 확인 필요 클라우드 환경 Managed DB 와 WAL GCP Cloud SQL, AWS RDS 에서 WAL 접근 제한에 따른 제약 존재 4) 트랜잭션과 보안 트랜잭션 자체는 보안 기능을 제공하지 않지만, 접근 제어 및 무결성 보장과 직접 연관됨 보안 로그와 트랜잭션 로그는 병행 저장되어야 감사를 위한 추적 가능성 확보 TAM (Transaction Access Monitor) 구축 시 내부자 위변조 감지 가능 5) 트랜잭션 테스트 기법 기법 설명 Rollback Test 실패 상황 가정 후 트랜잭션이 정확히 원복되는지 검증 Concurrency Test 여러 트랜잭션 간 동시 실행 시 정합성 유지 여부 확인 Commit Consistency 커밋된 데이터만 조회되는지, 읽기 일관성 보장 확인 Fault Injection 장애 발생 시 트랜잭션 로그 복구 및 commit/rollback 확인 25. 연계 기술 정리 연계 기술 역할 트랜잭션과의 관계 Kafka (with Idempotency) 메시지 기반 처리 Exactly-once 보장을 위한 트랜잭션 API Redis (with Lua Script) 트랜잭션 유사 실행 MULTI/EXEC 블록, atomic 블록 실행 gRPC / REST API 호출 경계 트랜잭션 범위 내 외부 호출 시 장애 발생 가능성 있음 Saga Pattern 분산 트랜잭션 대체 트랜잭션을 보상 트랜잭션으로 쪼개 비동기 처리 Debezium / CDC 변경 감지 커밋된 데이터의 변경 이력을 외부로 실시간 추출 26. 마무리 요약 트랜잭션은 단일 또는 복수의 데이터 조작 연산을 하나의 원자적 실행 단위로 묶어, 장애와 동시성 문제에서도 데이터의 일관성을 유지하기 위한 핵심 기술입니다.\nACID 원칙을 기반으로 하며, 각 RDBMS 와 NoSQL 환경에서도 다양한 방식으로 구현됩니다.\n실무에서는 격리 수준 조절, WAL 활용, 분산 트랜잭션 관리, 그리고 보상 트랜잭션 등의 전략을 복합적으로 활용해야 하며, 단일 노드 트랜잭션에서 분산 환경까지 확장된 전반적인 이해가 필요합니다.\n다음으로 추천되는 학습 주제 카테고리 주제 항목 설명 Concurrency MVCC 상세 Snapshot 기반 버전 읽기 PostgreSQL, MySQL InnoDB, Oracle 등에서 차이 존재 Distributed Systems 2PC vs Saga 분산 커밋 대안 비교 전역 원자성 vs 보상 트랜잭션 모델 DB Internals WAL 구조 Write-ahead logging 내부 기록 순서, checkpoint, redo log 동작 방식 Monitoring 트랜잭션 추적 APM 연계 및 성능 추적 트랜잭션 슬로우 로그, deadlock 감지 등 API Design 트랜잭션 범위 제한 외부 API 호출 시 경계 설정 DB 연결/처리 사이클 분리 설계 필요 이제 요청하신 MVCC 기반 상세 트랜잭션 흐름, 2PC vs 3PC vs Saga 동작 시나리오, 분산 트랜잭션에 대한 심화 내용을 정리해드립니다.\n📌 1. MVCC 기반 상세 트랜잭션 흐름 핵심 흐름 트랜잭션 시작 → 고유 XID 할당 → 스냅샷 (snapshot) 캡처 (Medium)\n읽기 (Read) → 스냅샷 타임스탬프 ≤ 레코드 xmin/xmax 조건에 맞는 버전 조회 쓰기 (Update/Delete/Insert)\nUpdate/Delete: 새로운 버전 생성, 이전 버전 유지 (xmax 설정) Insert: 새 튜플 xmin = XID, xmax = ∞ (Vlad Mihalcea, devcenter.heroku.com) 커밋 시점\nXID 는 고정, 새로운 버전이 활성화됨 다른 트랜잭션도 이후 커밋된 버전부터 읽기 시작 빈 버전 정리\nVACUUM 또는 GC 가 불필요 버전 제거 스토리지 누수 방지 (위키백과) 다이어그램 흐름 sequenceDiagram participant T1 as 트랜잭션 T1 participant T2 as 트랜잭션 T2 participant DB as Database T1-\u003e\u003eDB: BEGIN (XID=100) T2-\u003e\u003eDB: BEGIN (XID=101) T1-\u003e\u003eDB: UPDATE A -\u003e new version xmin=100 T2-\u003e\u003eDB: SELECT A -\u003e snapshot sees old version (xmin \u003c 101 \u003c xmax) T1-\u003e\u003eDB: COMMIT T2-\u003e\u003eDB: UPDATE A -\u003e new version xmin=101 이 흐름은 독립적인 스냅샷으로 인해 읽기와 쓰기 간 비차단을 보장하며, 정상적으로 스냅샷 격리 정보를 유지합니다.\n🔗 2. 분산 트랜잭션 프로토콜 비교 및 동작 시나리오 2.1 Two-Phase Commit (2PC) **1 단계: Prepare (투표 요청)**\n코디네이터 → 모든 참가자에게 “Prepare?”\n참가자: 로컬 트랜잭션 준비 후 Yes/No 응답 (위키백과, 위키백과) 2 단계: Commit/Abort All Yes → Commit 명령, 각 참가자 커밋 후 ACK Any No → Abort 명령, 각 참가자 롤백 특징: 원자성 보장, 단일 코디네이터 기반, 장애 시 블로킹 가능 (위키백과, 위키백과)\n2.2 Three-Phase Commit (3PC) 준비 단계: Prepare 사전 커밋 단계: Pre-Commit—참가자가 준비 완료 확인 최종 커밋 단계: Commit 개선점: 코디네이터 장애 시에도 참가자가 사전 커밋 상태를 인식하여 시스템 블로킹 완화 (위키백과)\n단점: 추가 메시지 및 타임아웃 복잡도 증가, 가정 한정적\n2.3 Saga 패턴 Orchestration (중앙 조정)\n각 마이크로서비스 별 로컬 트랜잭션 수행 → 실패 시 보상 트랜잭션 실행 (LinkedIn) Choreography (이벤트 방식)\n서비스 간 이벤트 연쇄 방식, 보상 및 흐름 분산 처리 장점: 속도, 확장성, 장애 내성 좋음\n단점: 보상 로직 복잡, 일관성 보장 어려움 (LinkedIn)\n비교 표 특성 2PC 3PC Saga 일관성 강한 (원자성) 강함, 블로킹 완화 Eventually Consistent (사후 보상) 블로킹 가능성 높음 중간 (타임아웃 처리 가능) 낮음 (비동기 처리) 장애 시 완화 manual intervention 필요 타임아웃 기반 복구 가능 보상 트랜잭션으로 자동 회복 구현 복잡도 중간 높음 매우 높음 (각 단계별 보상 설계 필요) 메시지 오버헤드 2 라운드 3 라운드 이벤트/명시적 호출 필요 🌐 3. 분산 트랜잭션 개요 (Distributed Transactions) 목적: 여러 독립 시스템 간 원자적 데이터 변경 보장 핵심 구성 요소: 코디네이터 (Transaction Manager) 참가자 (Participants) Committed / Rolled-back 상태 기록 (로그 기반) 타임아웃/복구/보상 메커니즘 프로토콜 선택 기준: 원자성 필요 시 → 2PC/3PC, 확장성 초점 시 → Saga, 메시징 시스템 통합 시 → Kafka 트랜잭션 등 ✅ 요약 MVCC는 읽기와 쓰기 충돌을 최소화하여 고성능 동시성을 제공하며, PostgreSQL, MySQL 등에서 널리 채택됨 (GeeksforGeeks, Vlad Mihalcea, Medium, betterengineers.substack.com, LinkedIn) 2PC는 분산 원자성을 보장하지만, 블로킹과 장애 복잡성이 존재 3PC는 2PC 단점을 일부 보완하나, 구현 부담이 커 현실에서는 잘 사용되지 않음 Saga는 확장성과 내성 면에서 우수하지만, 보상 트랜잭션 설계의 복잡도 존재 더 구체적인 코드 시나리오, 아키텍처 설계, 도구 연동 (Apache Kafka, Debezium 등) 관련 설명도 필요하시면 알려주세요!\n트랜잭션 (Transactions) 심화 분석 1. 태그 및 분류 검증 주제 태그: Database-Transactions, ACID-Properties, Concurrency-Control, Data-Consistency\n분류 구조 검증: “Systems and Infrastructure \u003e Database Systems”\n현재 분류가 적절합니다. 트랜잭션은 데이터베이스 시스템의 핵심 구성 요소로서 데이터 무결성과 일관성을 보장하는 시스템 레벨의 메커니즘이므로 해당 분류에 정확히 위치합니다.\n2. 주제 요약 및 개요 주제 요약 (200 자):\n트랜잭션은 데이터베이스 시스템에서 논리적 작업 단위로, ACID 속성을 통해 데이터 무결성과 일관성을 보장하는 핵심 메커니즘입니다. 동시성 제어, 장애 복구, 격리 수준 관리를 통해 안정적인 데이터 처리를 가능하게 합니다.\n전체 개요 (250 자):\n데이터베이스 트랜잭션은 하나 이상의 연산들을 논리적으로 묶어 원자성 (Atomicity), 일관성 (Consistency), 격리성 (Isolation), 지속성 (Durability) 을 보장하는 시스템입니다. 락 기반 제어, 타임스탬프 기반 제어 등 다양한 동시성 제어 기법을 통해 멀티유저 환경에서 안전한 데이터 접근을 제공합니다.\n3. 핵심 개념 3.1 기본 개념 트랜잭션 (Transaction): 데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 논리적 단위로, 분할할 수 없는 최소 작업 단위입니다.\nACID 속성:\n원자성 (Atomicity): 트랜잭션 내 모든 연산이 성공하거나 모두 실패해야 함 일관성 (Consistency): 트랜잭션 실행 전후 데이터베이스가 일관된 상태를 유지 격리성 (Isolation): 동시 실행되는 트랜잭션들이 서로 영향을 주지 않음 지속성 (Durability): 성공적으로 완료된 트랜잭션의 결과가 영구적으로 저장됨 3.2 실무 구현 관련 핵심 개념 동시성 제어 (Concurrency Control): 여러 트랜잭션이 동시에 실행될 때 데이터 일관성을 유지하는 메커니즘\n격리 수준 (Isolation Levels):\nREAD UNCOMMITTED: 커밋되지 않은 데이터 읽기 가능 READ COMMITTED: 커밋된 데이터만 읽기 가능 REPEATABLE READ: 동일 트랜잭션 내 반복 읽기 결과 동일 SERIALIZABLE: 가장 높은 격리 수준, 직렬 실행과 동일 로킹 (Locking): 데이터 접근을 제어하여 동시성 문제를 해결하는 기법\n데드락 (Deadlock): 두 개 이상의 트랜잭션이 서로 점유한 자원을 기다리며 무한 대기하는 상황\n4. 배경 및 목적 4.1 배경 데이터베이스 시스템이 다중 사용자 환경에서 운영되면서 데이터 무결성과 일관성 보장의 필요성이 대두되었습니다. 특히 은행 시스템과 같은 중요한 애플리케이션에서 데이터 신뢰성이 핵심 요구사항이 되었습니다.\n4.2 목적 및 필요성 데이터 무결성 보장: 잘못된 데이터 입력이나 시스템 오류로부터 데이터 보호 동시성 제어: 여러 사용자가 동시에 데이터에 접근할 때 충돌 방지 장애 복구: 시스템 장애 발생 시 데이터 일관성 유지 격리성 보장: 트랜잭션 간 간섭 없는 독립적 실행 5. 주요 기능 및 역할 5.1 주요 기능 데이터 변경 관리: INSERT, UPDATE, DELETE 연산의 논리적 그룹화 롤백 (Rollback): 오류 발생 시 이전 상태로 복원 커밋 (Commit): 변경사항을 영구적으로 데이터베이스에 반영 체크포인트 (Checkpoint): 복구를 위한 일관된 상태 저장점 생성 5.2 역할 데이터베이스 상태의 일관성 유지 동시 접근 환경에서의 충돌 해결 시스템 장애 시 데이터 복구 지원 비즈니스 로직의 논리적 단위 구현 6. 특징 및 핵심 원칙 6.1 특징 원자성: 전부 성공 또는 전부 실패 독립성: 다른 트랜잭션과 독립적 실행 영속성: 성공한 변경사항의 영구 보존 일관성: 무결성 제약조건 준수 6.2 핵심 원칙 All or Nothing: 부분적 실행 불허 Isolation: 트랜잭션 간 격리 Consistency: 데이터베이스 제약조건 유지 Durability: 영구적 저장 7. 작동 원리 및 방식 7.1 트랜잭션 생명주기 stateDiagram-v2 [*] --\u003e Active: BEGIN Active --\u003e PartiallyCommitted: COMMIT 요청 Active --\u003e Failed: 오류 발생 PartiallyCommitted --\u003e Committed: 커밋 완료 PartiallyCommitted --\u003e Failed: 커밋 실패 Failed --\u003e Aborted: ROLLBACK Committed --\u003e [*] Aborted --\u003e [*] 7.2 ACID 보장 메커니즘 graph TD A[트랜잭션 시작] --\u003e B[원자성 보장] B --\u003e C[일관성 검증] C --\u003e D[격리성 적용] D --\u003e E[지속성 확보] E --\u003e F[트랜잭션 완료] B --\u003e G[로그 기록] C --\u003e H[제약조건 검사] D --\u003e I[락 메커니즘] E --\u003e J[디스크 저장] 트랜잭션은 시작부터 완료까지 엄격한 상태 관리를 통해 ACID 속성을 보장합니다. 각 단계에서 로그 기록, 제약조건 검사, 락 적용, 영구 저장 등의 메커니즘이 동작합니다.\n8. 구조 및 아키텍처 8.1 트랜잭션 관리 아키텍처 graph TB subgraph \"애플리케이션 계층\" App[애플리케이션] end subgraph \"트랜잭션 관리 계층\" TM[트랜잭션 매니저] CC[동시성 제어자] LM[락 매니저] RM[복구 매니저] end subgraph \"저장소 계층\" BM[버퍼 매니저] SM[저장소 매니저] LB[로그 버퍼] DB[데이터베이스] end App --\u003e TM TM --\u003e CC TM --\u003e LM TM --\u003e RM CC --\u003e BM LM --\u003e BM RM --\u003e LB BM --\u003e SM SM --\u003e DB LB --\u003e DB 8.2 필수 구성요소 구성요소 기능 역할 트랜잭션 매니저 트랜잭션 생명주기 관리 BEGIN, COMMIT, ROLLBACK 처리 동시성 제어자 동시 실행 제어 격리성 보장, 스케줄링 락 매니저 자원 접근 제어 락 획득/해제, 데드락 탐지 복구 매니저 장애 복구 로그 관리, 롤백/복구 수행 버퍼 매니저 메모리 관리 페이지 캐싱, 더티 페이지 관리 8.3 선택 구성요소 구성요소 기능 특징 체크포인트 매니저 복구 지점 관리 성능 최적화, 복구 시간 단축 분산 트랜잭션 코디네이터 분산 환경 지원 2PC, 3PC 프로토콜 구현 성능 모니터 성능 감시 트랜잭션 통계, 병목점 분석 9. 구현 기법 9.1 락 기반 동시성 제어 정의: 데이터 항목에 락을 설정하여 동시 접근을 제어하는 기법\n구성:\n공유 락 (Shared Lock): 읽기 전용 접근 배타 락 (Exclusive Lock): 읽기/쓰기 독점 접근 의도 락 (Intent Lock): 하위 레벨 락 설정 의도 표시 목적: 데이터 일관성 보장, 동시성 제어\n실제 예시:\n1 2 3 4 5 6 7 8 9 10 11 # 은행 계좌 이체 시나리오 def transfer_money(from_account, to_account, amount): # 계좌 순서대로 락 획득 (데드락 방지) accounts = sorted([from_account, to_account], key=lambda x: x.id) with lock_manager.acquire_locks(accounts, EXCLUSIVE): if from_account.balance \u003e= amount: from_account.balance -= amount to_account.balance += amount return True return False 9.2 타임스탬프 기반 제어 정의: 각 트랜잭션에 고유한 타임스탬프를 부여하여 실행 순서 결정\n구성:\n읽기 타임스탬프 (Read Timestamp) 쓰기 타임스탬프 (Write Timestamp) 트랜잭션 타임스탬프 (Transaction Timestamp) 목적: 데드락 없는 동시성 제어\n9.3 다버전 동시성 제어 (MVCC) 정의: 데이터의 여러 버전을 유지하여 읽기 - 쓰기 충돌 최소화\n구성:\n버전 체인 스냅샷 격리 가비지 컬렉션 목적: 읽기 성능 향상, 락 경합 감소\n10. 장점 구분 항목 설명 장점 데이터 무결성 ACID 속성을 통한 데이터 일관성과 신뢰성 보장 장점 장애 복구 로그 기반 복구 메커니즘으로 시스템 장애 시 데이터 복원 장점 동시성 지원 여러 사용자의 동시 접근을 안전하게 처리 장점 비즈니스 로직 지원 복잡한 비즈니스 규칙을 논리적 단위로 구현 장점 표준화 SQL 표준을 통한 일관된 인터페이스 제공 11. 단점과 문제점 그리고 해결방안 11.1 단점 구분 항목 설명 해결책 단점 성능 오버헤드 락 관리와 로그 기록으로 인한 처리 지연 적절한 격리 수준 선택, 락 최소화 단점 데드락 위험 상호 대기로 인한 시스템 정지 데드락 탐지/해결 알고리즘 구현 단점 확장성 제한 중앙집중식 락 관리로 인한 병목 분산 락, 파티셔닝 적용 11.2 문제점 구분 항목 원인 영향 탐지 및 진단 예방 방법 해결 방법 및 기법 문제점 데드락 순환 대기 조건 시스템 정지 대기 그래프 분석 락 순서 정렬 희생자 선택, 롤백 문제점 라이브락 지속적 충돌 무한 재시도 재시도 패턴 모니터링 백오프 전략 우선순위 부여 문제점 팬텀 리드 범위 락 부재 데이터 불일치 쿼리 결과 비교 범위 락 사용 직렬화 가능 격리 12. 도전 과제 12.1 성능 최적화 과제 원인: 동시성 제어와 일관성 보장 간의 트레이드오프\n영향: 시스템 처리량 감소\n해결 방법: 적응적 격리 수준, 비관적/낙관적 락 혼합 사용\n12.2 분산 환경 과제 원인: 네트워크 지연과 부분 실패\n영향: 2PC 프로토콜의 블로킹 문제\n해결 방법: 3PC, Saga 패턴, 최종 일관성 모델 적용\n12.3 클라우드 네이티브 과제 원인: 마이크로서비스 아키텍처의 데이터 분산\n영향: 전역 트랜잭션 관리 복잡성\n해결 방법: 이벤트 소싱, CQRS 패턴 적용\n13. 분류 기준에 따른 종류 및 유형 분류 기준 유형 특징 사용 사례 범위 로컬 트랜잭션 단일 데이터베이스 내 실행 일반적인 CRUD 연산 범위 분산 트랜잭션 다중 데이터베이스 간 실행 마이크로서비스 간 데이터 동기화 처리 방식 온라인 트랜잭션 (OLTP) 실시간 처리, 짧은 실행 시간 웹 애플리케이션, ERP 시스템 처리 방식 배치 트랜잭션 대량 데이터 처리, 긴 실행 시간 데이터 마이그레이션, 리포팅 제어 방식 명시적 트랜잭션 개발자가 직접 제어 복잡한 비즈니스 로직 제어 방식 암시적 트랜잭션 시스템이 자동 관리 단순한 단일 연산 14. 실무 사용 예시 사용 영역 목적 함께 사용되는 기술 효과 전자상거래 주문 처리 결제 게이트웨이, 재고 관리 주문 - 결제 - 재고 일관성 보장 금융 시스템 계좌 이체 보안 모듈, 감사 로그 자금 무결성 보장 예약 시스템 좌석 예약 캐싱 시스템, 큐잉 동시 예약 충돌 방지 게임 서비스 아이템 거래 메시징 시스템, NoSQL 게임 경제 균형 유지 의료 시스템 환자 기록 암호화, 백업 시스템 의료 데이터 신뢰성 확보 15. 활용 사례: 전자상거래 주문 처리 시스템 15.1 시스템 구성 graph TB subgraph \"클라이언트\" User[사용자] Web[웹 인터페이스] end subgraph \"애플리케이션 서버\" OrderService[주문 서비스] PaymentService[결제 서비스] InventoryService[재고 서비스] end subgraph \"데이터베이스\" OrderDB[(주문 DB)] PaymentDB[(결제 DB)] InventoryDB[(재고 DB)] end subgraph \"외부 시스템\" PaymentGateway[결제 게이트웨이] ShippingAPI[배송 API] end User --\u003e Web Web --\u003e OrderService OrderService --\u003e PaymentService OrderService --\u003e InventoryService OrderService --\u003e OrderDB PaymentService --\u003e PaymentDB InventoryService --\u003e InventoryDB PaymentService --\u003e PaymentGateway OrderService --\u003e ShippingAPI 15.2 주문 처리 워크플로우 sequenceDiagram participant C as 고객 participant O as 주문서비스 participant P as 결제서비스 participant I as 재고서비스 participant DB as 데이터베이스 C-\u003e\u003eO: 주문 요청 O-\u003e\u003eDB: BEGIN TRANSACTION O-\u003e\u003eI: 재고 확인 I-\u003e\u003eDB: SELECT FOR UPDATE (재고) DB--\u003e\u003eI: 재고 정보 I--\u003e\u003eO: 재고 충분 O-\u003e\u003eI: 재고 차감 I-\u003e\u003eDB: UPDATE 재고 O-\u003e\u003eP: 결제 요청 P-\u003e\u003eDB: INSERT 결제 기록 O-\u003e\u003eDB: INSERT 주문 기록 O-\u003e\u003eDB: COMMIT DB--\u003e\u003eO: 커밋 완료 O--\u003e\u003eC: 주문 완료 15.3 트랜잭션의 역할 원자성 보장: 재고 차감, 결제 처리, 주문 생성이 모두 성공하거나 모두 실패 일관성 유지: 재고량과 주문량의 정확한 매칭 격리성 적용: 동시 주문 요청 간 재고 충돌 방지 지속성 확보: 성공한 주문의 영구적 보존 15.4 트랜잭션 적용 전후 차이점 적용 전:\n재고는 차감되었으나 결제 실패 시 재고 복구 누락 동시 주문으로 인한 초과 판매 발생 시스템 장애 시 데이터 불일치 적용 후:\n결제 실패 시 자동 롤백으로 재고 복구 락을 통한 동시 접근 제어로 정확한 재고 관리 장애 복구 시 일관된 상태 보장 16. 구현 예시 16.1 Python 구현 (SQLAlchemy 사용) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 from sqlalchemy import create_engine, Column, Integer, String, Numeric from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker from contextlib import contextmanager import logging # 데이터베이스 모델 정의 Base = declarative_base() class Account(Base): \"\"\"은행 계좌 모델\"\"\" __tablename__ = 'accounts' id = Column(Integer, primary_key=True) account_number = Column(String(20), unique=True, nullable=False) balance = Column(Numeric(10, 2), nullable=False, default=0) owner_name = Column(String(100), nullable=False) class Transaction(Base): \"\"\"거래 기록 모델\"\"\" __tablename__ = 'transactions' id = Column(Integer, primary_key=True) from_account = Column(String(20), nullable=False) to_account = Column(String(20), nullable=False) amount = Column(Numeric(10, 2), nullable=False) status = Column(String(10), nullable=False) # SUCCESS, FAILED # 데이터베이스 연결 설정 engine = create_engine('postgresql://user:password@localhost/bank_db') SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine) class BankingService: \"\"\"은행 서비스 클래스 - 트랜잭션 관리\"\"\" @contextmanager def get_db_session(self): \"\"\"데이터베이스 세션 관리 컨텍스트\"\"\" session = SessionLocal() try: yield session session.commit() # 트랜잭션 커밋 except Exception as e: session.rollback() # 오류 시 롤백 logging.error(f\"트랜잭션 실패: {e}\") raise finally: session.close() def transfer_money(self, from_account_number, to_account_number, amount): \"\"\" 계좌 이체 처리 - ACID 속성 보장 Args: from_account_number: 출금 계좌번호 to_account_number: 입금 계좌번호 amount: 이체 금액 Returns: bool: 이체 성공 여부 \"\"\" with self.get_db_session() as session: try: # 1. 원자성(Atomicity): 모든 연산이 하나의 트랜잭션으로 처리 # 2. 일관성(Consistency): 데이터베이스 제약조건 확인 if amount \u003c= 0: raise ValueError(\"이체 금액은 0보다 커야 합니다\") # 3. 격리성(Isolation): SELECT FOR UPDATE로 배타적 락 적용 from_account = session.query(Account)\\ .filter(Account.account_number == from_account_number)\\ .with_for_update().first() to_account = session.query(Account)\\ .filter(Account.account_number == to_account_number)\\ .with_for_update().first() # 계좌 존재 여부 확인 if not from_account or not to_account: raise ValueError(\"존재하지 않는 계좌입니다\") # 잔액 확인 if from_account.balance \u003c amount: raise ValueError(\"잔액이 부족합니다\") # 잔액 업데이트 from_account.balance -= amount to_account.balance += amount # 거래 기록 생성 transaction_record = Transaction( from_account=from_account_number, to_account=to_account_number, amount=amount, status=\"SUCCESS\" ) session.add(transaction_record) # 4. 지속성(Durability): 커밋으로 영구 저장 보장 # (컨텍스트 매니저에서 자동 커밋) logging.info(f\"이체 성공: {from_account_number} -\u003e {to_account_number}, {amount}원\") return True except Exception as e: # 오류 발생 시 거래 실패 기록 failed_transaction = Transaction( from_account=from_account_number, to_account=to_account_number, amount=amount, status=\"FAILED\" ) session.add(failed_transaction) logging.error(f\"이체 실패: {e}\") return False # 사용 예시 banking_service = BankingService() # 정상적인 이체 success = banking_service.transfer_money(\"123-456-789\", \"987-654-321\", 100000) # 잔액 부족으로 실패하는 이체 failed = banking_service.transfer_money(\"123-456-789\", \"987-654-321\", 999999999) 16.2 JavaScript 구현 (Node.js + PostgreSQL) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 const { Pool } = require('pg'); class TransactionManager { constructor(dbConfig) { this.pool = new Pool(dbConfig); } /** * 트랜잭션 실행 래퍼 * @param {Function} operation - 실행할 데이터베이스 연산 * @returns {Promise} 연산 결과 */ async executeTransaction(operation) { const client = await this.pool.connect(); try { // 트랜잭션 시작 await client.query('BEGIN'); // 격리 수준 설정 (REPEATABLE READ) await client.query('SET TRANSACTION ISOLATION LEVEL REPEATABLE READ'); // 연산 수행 const result = await operation(client); // 트랜잭션 커밋 await client.query('COMMIT'); return result; } catch (error) { // 오류 발생 시 롤백 await client.query('ROLLBACK'); throw error; } finally { // 연결 해제 client.release(); } } /** * 온라인 쇼핑몰 주문 처리 * @param {Object} orderData - 주문 데이터 * @returns {Promise} 주문 결과 */ async processOrder(orderData) { return await this.executeTransaction(async (client) =\u003e { const { userId, productId, quantity, price } = orderData; // 1. 상품 재고 확인 및 차감 (배타적 락 적용) const stockResult = await client.query( 'SELECT stock FROM products WHERE id = $1 FOR UPDATE', [productId] ); if (stockResult.rows.length === 0) { throw new Error('상품이 존재하지 않습니다'); } const currentStock = stockResult.rows[0].stock; if (currentStock \u003c quantity) { throw new Error('재고가 부족합니다'); } // 재고 차감 await client.query( 'UPDATE products SET stock = stock - $1 WHERE id = $2', [quantity, productId] ); // 2. 사용자 포인트 확인 및 차감 const userResult = await client.query( 'SELECT points FROM users WHERE id = $1 FOR UPDATE', [userId] ); if (userResult.rows.length === 0) { throw new Error('사용자가 존재하지 않습니다'); } const currentPoints = userResult.rows[0].points; const totalPrice = price * quantity; if (currentPoints \u003c totalPrice) { throw new Error('포인트가 부족합니다'); } // 포인트 차감 await client.query( 'UPDATE users SET points = points - $1 WHERE id = $2', [totalPrice, userId] ); // 3. 주문 생성 const orderResult = await client.query( `INSERT INTO orders (user_id, product_id, quantity, price, status, created_at) VALUES ($1, $2, $3, $4, 'COMPLETED', NOW()) RETURNING id`, [userId, productId, quantity, price] ); const orderId = orderResult.rows[0].id; // 4. 주문 상세 로그 기록 await client.query( `INSERT INTO order_logs (order_id, action, description, created_at) VALUES ($1, 'ORDER_CREATED', $2, NOW())`, [orderId, `주문 생성: 상품 ${productId}, 수량 ${quantity}, 금액 ${totalPrice}`] ); return { orderId, message: '주문이 성공적으로 처리되었습니다', totalPrice, remainingStock: currentStock - quantity, remainingPoints: currentPoints - totalPrice }; }); } } // 사용 예시 const dbConfig = { user: 'your_username', host: 'localhost', database: 'ecommerce_db', password: 'your_password', port: 5432, }; const transactionManager = new TransactionManager(dbConfig); // 주문 처리 실행 async function main() { try { const orderData = { userId: 1, productId: 101, quantity: 2, price: 25000 }; const result = await transactionManager.processOrder(orderData); console.log('주문 성공:', result); } catch (error) { console.error('주문 실패:', error.message); } } main(); 17. 실무에서 효과적으로 적용하기 위한 고려사항 분류 고려사항 설명 권장사항 성능 트랜잭션 범위 최소화 긴 트랜잭션은 락 경합 증가 필요한 연산만 트랜잭션에 포함 성능 적절한 격리 수준 선택 과도한 격리는 성능 저하 비즈니스 요구사항에 맞는 최소 격리 수준 적용 안정성 데드락 방지 전략 순환 대기 방지 일관된 락 순서 정의, 타임아웃 설정 안정성 예외 처리 체계 부분 실패 상황 대응 명확한 롤백 정책과 에러 핸들링 모니터링 트랜잭션 로깅 문제 상황 추적 시작/종료 시점, 실행 시간, 결과 기록 모니터링 성능 메트릭 수집 병목점 식별 락 대기 시간, 커밋 비율, 처리량 측정 18. 최적화하기 위한 고려사항 분류 고려사항 설명 권장사항 동시성 락 최적화 락 경합 최소화 행 레벨 락, 락 분할, 비관적/낙관적 락 적절한 선택 동시성 배치 처리 대량 데이터 처리 최적화 청크 단위 처리, 부분 커밋 활용 저장소 인덱스 최적화 빠른 데이터 접근 트랜잭션에서 자주 사용되는 컬럼에 인덱스 생성 저장소 로그 관리 I/O 부하 최소화 로그 버퍼링, 비동기 로그 쓰기 아키텍처 읽기 전용 복제본 읽기 부하 분산 읽기 전용 쿼리를 복제본으로 라우팅 아키텍처 분산 처리 수평 확장 샤딩, 파티셔닝으로 트랜잭션 분산 19. 주제와 관련하여 주목할 내용 카테고리 주제 항목 설명 성능 최적화 락 메커니즘 적응적 락 관리 실행 패턴에 따라 락 전략을 동적으로 조정 성능 최적화 캐싱 전략 트랜잭션 캐시 읽기 전용 데이터의 캐싱으로 성능 향상 분산 시스템 마이크로서비스 Saga 패턴 분산 환경에서 장기 실행 트랜잭션 관리 분산 시스템 이벤트 소싱 이벤트 기반 아키텍처 상태 변화를 이벤트로 기록하여 복구 및 감사 지원 클라우드 네이티브 서버리스 함수형 트랜잭션 서버리스 환경에서의 상태 관리 및 트랜잭션 처리 신기술 블록체인 분산 원장 기술 탈중앙화된 트랜잭션 처리 및 스마트 컨트랙트 20. 반드시 학습해야할 내용 카테고리 주제 항목 설명 기초 이론 동시성 제어 2PL, MVCC, 타임스탬프 순서 다양한 동시성 제어 알고리즘의 이해와 적용 기초 이론 복구 기법 ARIES, WAL, 체크포인트 장애 복구를 위한 로그 기반 알고리즘 실무 기술 SQL 트랜잭션 BEGIN, COMMIT, ROLLBACK 표준 SQL 트랜잭션 명령어와 격리 수준 실무 기술 ORM 활용 JPA, Hibernate, SQLAlchemy 객체 관계 매핑에서의 트랜잭션 관리 고급 주제 분산 트랜잭션 2PC, 3PC, XA 분산 환경에서의 원자성 보장 프로토콜 고급 주제 NoSQL 트랜잭션 MongoDB, Cassandra NoSQL 데이터베이스의 트랜잭션 특성과 제약사항 용어 정리 카테고리 용어 설명 기본 개념 2PC (Two-Phase Commit) 분산 트랜잭션에서 모든 참여자의 합의를 통한 커밋 프로토콜 기본 개념 WAL (Write-Ahead Logging) 데이터 변경 전에 로그를 먼저 기록하는 복구 기법 기본 개념 MVCC (Multi-Version Concurrency Control) 데이터의 여러 버전을 유지하여 동시성을 제어하는 기법 락 관리 2PL (Two-Phase Locking) 성장 단계와 축소 단계로 나누어 락을 관리하는 프로토콜 락 관리 의도 락 (Intent Lock) 하위 레벨에서 락을 설정할 의도를 상위 레벨에 표시하는 락 문제 상황 더티 리드 (Dirty Read) 커밋되지 않은 데이터를 읽는 현상 문제 상황 팬텀 리드 (Phantom Read) 동일 쿼리의 반복 실행에서 새로운 행이 나타나는 현상 문제 상황 논리피터블 리드 (Non-Repeatable Read) 동일 데이터의 반복 읽기에서 다른 값이 나타나는 현상 참고 및 출처 Database System Concepts (Abraham Silberschatz, Henry F. Korth, S. Sudarshan) Transaction Processing: Concepts and Techniques (Jim Gray, Andreas Reuter) PostgreSQL Documentation - Transaction Isolation MySQL Documentation - InnoDB Locking and Transaction Model Oracle Database Concepts - Data Concurrency and Consistency Microsoft SQL Server Documentation - Transaction Locking and Row Versioning Guide MongoDB Documentation - Transactions Apache Cassandra Documentation - Lightweight Transactions 데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위\n트랜잭션은 데이터베이스의 무결성을 보장하고 일관성 있는 상태를 유지하는 데 중요한 역할을 한다.\n데이터베이스의 상태를 변화시키는 하나의 논리적 작업 단위를 구성하는 연산들의 집합.\n이는 한 번에 모두 수행되어야 할 일련의 데이터베이스 연산들을 의미한다.\n트랜잭션의 역할:\n데이터 무결성 보장: 여러 작업이 하나의 단위로 처리되어 부분적인 데이터 변경을 방지합니다. 동시성 제어: 여러 사용자가 동시에 데이터에 접근할 때 데이터의 일관성을 유지합니다. 오류 복구: 트랜잭션 실행 중 오류가 발생하면 이전 상태로 롤백하여 데이터의 안정성을 보장합니다. 복잡한 비즈니스 로직 처리: 여러 단계의 작업을 하나의 논리적 단위로 처리할 수 있게 합니다. 트랜잭션의 특성 (ACID):\n원자성 (Atomicity)\n트랜잭션의 모든 연산이 완전히 수행되거나 전혀 수행되지 않아야 합니다 중간 단계까지 실행되다가 실패하면 처음부터 다시 시작해야 합니다 예: 계좌이체 시 출금과 입금이 모두 성공하거나, 둘 다 실패해야 합니다 일관성 (Consistency)\n트랜잭션 실행 전과 후의 데이터베이스는 일관된 상태를 유지해야 합니다 데이터베이스의 제약조건을 위반하지 않아야 합니다 예: 계좌 잔고는 항상 0 원 이상이어야 한다는 규칙이 있다면, 이를 위반할 수 없습니다 독립성 (Isolation)\n동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야 합니다 한 트랜잭션의 중간 결과가 다른 트랜잭션에게 보이지 않아야 합니다 예: A 가 계좌이체 중일 때 B 가 같은 계좌를 조회해도 이체 완료 전까지는 원래 금액이 보입니다 지속성 (Durability)\n성공적으로 완료된 트랜잭션의 결과는 영구적으로 반영되어야 합니다 시스템 장애가 발생하더라도 데이터는 보존되어야 합니다 예: 계좌이체 완료 후 정전이 되어도 이체 내역은 보존됩니다 동작 과정:\n트랜잭션 시작: START TRANSACTION 명령으로 시작합니다. 작업 수행: 데이터베이스 작업을 실행합니다. 커밋 또는 롤백: 모든 작업이 성공적으로 완료되면 COMMIT 을 실행하여 변경사항을 영구적으로 반영합니다. 오류 발생 시 ROLLBACK 을 실행하여 트랜잭션 시작 전 상태로 되돌립니다. 트랜잭션의 기본 구조:\n1 2 3 4 5 6 7 8 BEGIN TRANSACTION; -- 트랜잭션 시작 -- 데이터베이스 작업들 작업1; 작업2; 작업3; COMMIT; -- 트랜잭션 완료 -- 또는 ROLLBACK; -- 트랜잭션 취소 트랜잭션의 상태 트랜잭션:\nActive (활동): 트랜잭션이 실행 중인 상태 Partially Committed (부분 완료): 마지막 작업이 끝났지만, 아직 커밋되지 않은 상태 Committed (완료): 트랜잭션이 성공적으로 완료된 상태 Failed (실패): 오류가 발생하여 트랜잭션이 중단된 상태 Aborted (철회): 트랜잭션이 롤백되고 데이터베이스가 원래 상태로 돌아간 상태 제어 명령어:\nBEGIN TRANSACTION: 트랜잭션 시작 COMMIT: 트랜잭션 완료 및 변경사항 영구 저장 ROLLBACK: 트랜잭션 취소 및 변경사항 폐기 SAVEPOINT: 트랜잭션 내에 중간 저장점 생성 트랜잭션의 동시성 제어:\n여러 트랜잭션이 동시에 실행될 때 발생할 수 있는 문제를 해결하기 위해 다음과 같은 기법을 사용한다.\n잠금 (Locking): 공유 잠금 (Shared Lock) 과 배타적 잠금 (Exclusive Lock) 을 사용하여 동시 접근을 제어합니다. 타임스탬프 기반 프로토콜: 각 트랜잭션에 고유한 타임스탬프를 부여하여 충돌을 해결합니다. 다중 버전 동시성 제어 (MVCC): 데이터의 여러 버전을 유지하여 읽기 작업의 동시성을 향상시킵니다. 트랜잭션 격리 수준:\nSQL 표준은 네 가지 트랜잭션 격리 수준을 정의한다.\nREAD UNCOMMITTED: 가장 낮은 격리 수준으로, 더티 리드가 발생할 수 있습니다. READ COMMITTED: 커밋된 데이터만 읽을 수 있지만, 반복 불가능한 읽기가 발생할 수 있습니다. REPEATABLE READ: 트랜잭션 내에서 동일한 쿼리는 항상 같은 결과를 반환하지만, 팬텀 읽기가 발생할 수 있습니다. SERIALIZABLE: 가장 높은 격리 수준으로, 완전한 일관성을 보장하지만 성능 저하가 발생할 수 있습니다. 장점:\n데이터 무결성 보장 동시성 제어 오류 복구 용이성 복잡한 데이터베이스 연산의 단순화 단점:\n성능 오버헤드 복잡한 구현 잠금으로 인한 동시성 저하 가능성 트랜잭션의 주요 특성과 고려사항 트랜잭션 격리 수준 (Transaction Isolation Level)\n1 2 3 4 5 6 7 -- 격리 수준 설정 예시 SET TRANSACTION ISOLATION LEVEL READ COMMITTED; BEGIN TRANSACTION; SELECT * FROM products WHERE id = 1; -- 이 시점에서 다른 트랜잭션의 커밋된 변경사항만 볼 수 있음 COMMIT; 교착상태 (Deadlock) 처리\n1 2 3 4 5 6 7 8 9 -- 교착상태 감지 및 처리 BEGIN TRANSACTION; SET DEADLOCK_PRIORITY LOW; -- 교착상태 발생 시 이 트랜잭션이 희생됨 UPDATE table1 SET col1 = value1 WHERE id = 1; UPDATE table2 SET col2 = value2 WHERE id = 1; -- 교착상태 발생 시 자동으로 롤백됨 COMMIT; 중첩 트랜잭션 (Nested Transactions)\n1 2 3 4 5 6 7 8 9 BEGIN TRANSACTION outer_trans; -- 외부 트랜잭션 작업 BEGIN TRANSACTION inner_trans; -- 내부 트랜잭션 작업 COMMIT TRANSACTION inner_trans; -- 외부 트랜잭션 계속 COMMIT TRANSACTION outer_trans; 세이브포인트 (Savepoint) 활용\n1 2 3 4 5 6 7 8 9 10 BEGIN TRANSACTION; INSERT INTO orders (product_id, quantity) VALUES (1, 1); SAVEPOINT after_order; -- 세이브포인트 생성 UPDATE inventory SET stock = stock - 1; -- 재고 업데이트 실패 시 ROLLBACK TO after_order; -- 주문 정보는 유지한 채 재고만 롤백 COMMIT; 트랜잭션 설계 시 고려해야 할 실무적 팁들 트랜잭션 범위 최소화\n트랜잭션은 가능한 한 작게 유지하여 다른 트랜잭션과의 충돌 가능성을 줄여야 한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -- 좋지 않은 예 BEGIN TRANSACTION; -- 오래 걸리는 데이터 처리 WHILE (SELECT COUNT(*) FROM huge_table) \u003e 0 BEGIN -- 처리 로직 END COMMIT; -- 좋은 예 BEGIN TRANSACTION; -- 작은 단위로 나누어 처리 DECLARE @batch_size INT = 1000; DELETE TOP (@batch_size) FROM huge_table; COMMIT; 오류 처리\n모든 트랜잭션은 적절한 오류 처리 로직을 포함해야 한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 BEGIN TRY BEGIN TRANSACTION; -- 트랜잭션 로직 COMMIT; END TRY BEGIN CATCH IF @@TRANCOUNT \u003e 0 ROLLBACK; -- 오류 로깅 INSERT INTO error_logs (error_message, error_time) VALUES (ERROR_MESSAGE(), GETDATE()); -- 오류 재발생 THROW; END CATCH 성능 모니터링\n트랜잭션의 성능을 모니터링하고 최적화하는 것이 중요.\n1 2 3 4 5 6 7 8 -- 트랜잭션 성능 모니터링 쿼리 SELECT session_id, transaction_id, transaction_begin_time, DATEDIFF(SECOND, transaction_begin_time, GETDATE()) as duration_seconds FROM sys.dm_tran_active_transactions WHERE transaction_type = 1; -- 사용자 트랜잭션만 조회 예제 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 -- 온라인 쇼핑몰의 주문 처리 트랜잭션 BEGIN TRANSACTION; SAVEPOINT order_start; -- 중간 저장점 생성 TRY { -- 1. 재고 확인 및 감소 UPDATE products SET stock = stock - @ordered_quantity WHERE product_id = @product_id AND stock \u003e= @ordered_quantity; IF @@ROWCOUNT = 0 THROW 50001, '재고 부족', 1; -- 2. 주문 정보 저장 INSERT INTO orders (user_id, product_id, quantity, total_amount) VALUES (@user_id, @product_id, @ordered_quantity, @total_amount); -- 3. 사용자 포인트 차감 UPDATE users SET points = points - @used_points WHERE user_id = @user_id AND points \u003e= @used_points; IF @@ROWCOUNT = 0 THROW 50002, '포인트 부족', 1; -- 4. 결제 처리 INSERT INTO payments (order_id, payment_method, amount) VALUES (@order_id, @payment_method, @total_amount); COMMIT TRANSACTION; } CATCH { ROLLBACK TRANSACTION TO order_start; -- 오류 로깅 및 처리 INSERT INTO error_logs (error_message, error_time) VALUES (ERROR_MESSAGE(), GETDATE()); } 데이터베이스에서 트랜잭션은 데이터베이스의 상태를 변화시키는 논리적 작업 단위이다.\n트랜잭션은 데이터베이스의 무결성과 일관성을 보장하는 핵심 개념으로 ACID 속성을 통해 데이터의 신뢰성을 보장하며, 다양한 격리 수준을 통해 동시성 제어가 가능하다. 현대 데이터베이스 시스템은 대부분 트랜잭션을 지원하며, 각 시스템마다 구현 방식과 기능에 차이가 있다.\n트랜잭션을 올바르게 이해하고 적용하면 데이터 일관성을 유지하면서도 시스템의 성능과 확장성을 최적화할 수 있다. 특히 금융, 전자상거래, 재고 관리와 같은 중요한 비즈니스 시스템에서는 트랜잭션의 올바른 구현이 필수적이다.\n트랜잭션의 기본 개념 트랜잭션은 데이터베이스의 무결성을 보장하기 위한 핵심 메커니즘이다.\n은행 시스템을 예로 들어보면 계좌에서 1 만원을 인출하는 과정은 다음과 같은 단계로 구성된다:\n계좌 잔액 확인 잔액에서 1 만원 차감 새로운 잔액 저장 현금 지급\n이 모든 단계가 하나의 트랜잭션을 구성하며, 모든 단계가 성공적으로 완료되거나 아무것도 실행되지 않아야 한다.\n만약 3 단계에서 시스템이 실패한다면, 계좌에서 돈은 차감되었지만 실제로 돈을 받지 못하는 상황이 발생할 수 있다. 트랜잭션은 이러한 불일치 상황을 방지한다. 트랜잭션의 ACID 속성 데이터베이스 트랜잭션은 다음과 같은 ACID 속성을 갖는다:\n원자성 (Atomicity)\n트랜잭션의 모든 연산은 완전히 수행되거나 전혀 수행되지 않아야 한다. 중간 상태는 존재하지 않는다.\n1 2 3 4 BEGIN TRANSACTION; UPDATE accounts SET balance = balance - 10000 WHERE account_id = 'A'; UPDATE accounts SET balance = balance + 10000 WHERE account_id = 'B'; COMMIT; 위 트랜잭션에서 첫 번째 UPDATE 는 성공했지만 두 번째 UPDATE 가 실패한다면, 첫 번째 UPDATE 도 취소되어야 한다.\n일관성 (Consistency)\n트랜잭션이 완료된 후에도 데이터베이스는 일관된 상태를 유지해야 한다. 모든 무결성 제약조건이 만족되어야 한다. 예를 들어, 계좌 잔액이 항상 0 이상이어야 한다는 제약이 있다면, 트랜잭션 실행 후에도 이 조건은 유지되어야 한다.\n고립성 (Isolation)\n여러 트랜잭션이 동시에 실행될 때, 각 트랜잭션은 다른 트랜잭션의 연산에 영향을 받지 않고 독립적으로 실행되어야 한다.\n지속성 (Durability)\n트랜잭션이 성공적으로 완료 (커밋) 된 후에는 그 결과가 시스템 장애가 발생하더라도 영구적으로 반영되어야 한다.\n트랜잭션 제어 명령어 SQL 에서는 다음과 같은 명령어로 트랜잭션을 제어한다:\nBEGIN TRANSACTION (또는 START TRANSACTION)\n트랜잭션의 시작을 표시한다.\n1 BEGIN TRANSACTION; COMMIT\n트랜잭션의 모든 변경사항을 데이터베이스에 영구적으로 저장한다.\n1 COMMIT; ROLLBACK\n트랜잭션의 모든 변경사항을 취소하고 트랜잭션 시작 전 상태로 되돌린다.\n1 ROLLBACK; SAVEPOINT\n트랜잭션 내에서 특정 지점을 표시하여, 나중에 해당 지점으로 롤백할 수 있게 한다.\n1 2 3 SAVEPOINT save1; -- 일부 연산 실행 후 ROLLBACK TO save1; -- save1 지점으로 롤백 트랜잭션 격리 수준 동시에 여러 트랜잭션이 실행될 때, 트랜잭션 간의 격리 정도를 정의한다.\n표준 SQL 은 네 가지 격리 수준을 정의한다:\nREAD UNCOMMITTED\n가장 낮은 격리 수준으로, 한 트랜잭션이 다른 트랜잭션의 커밋되지 않은 변경사항을 읽을 수 있다. 이로 인해 ’ 더티 리드 (Dirty Read)’ 가 발생할 수 있다.\nREAD COMMITTED\n각 트랜잭션은 다른 트랜잭션이 커밋한 데이터만 읽을 수 있다. 그러나 ’ 반복 불가능한 읽기 (Non-repeatable Read)’ 가 발생할 수 있다.\nREPEATABLE READ\n트랜잭션이 읽은 데이터는 트랜잭션이 완료될 때까지 다른 트랜잭션에 의해 변경될 수 없다. 그러나 ’ 팬텀 읽기 (Phantom Read)’ 가 발생할 수 있다.\nSERIALIZABLE\n가장 높은 격리 수준으로, 트랜잭션이 완전히 격리되어 동시성 문제가 발생하지 않는다. 그러나 성능이 저하될 수 있다.\n격리 수준 설정 예:\n1 SET TRANSACTION ISOLATION LEVEL READ COMMITTED; 트랜잭션 관련 문제 더티 리드 (Dirty Read)\n한 트랜잭션이 아직 커밋되지 않은 다른 트랜잭션의 데이터를 읽는 경우.\n반복 불가능한 읽기 (Non-repeatable Read)\n트랜잭션 내에서 같은 쿼리를 두 번 실행했을 때, 다른 트랜잭션의 커밋으로 인해 결과가 달라지는 경우.\n팬텀 읽기 (Phantom Read)\n트랜잭션 내에서 같은 쿼리를 두 번 실행했을 때, 다른 트랜잭션의 삽입 또는 삭제로 인해 결과 집합이 달라지는 경우.\n다양한 DBMS 의 트랜잭션 구현 MySQL (InnoDB) InnoDB 스토리지 엔진은 ACID 트랜잭션을 완벽하게 지원한다.\n1 2 3 START TRANSACTION; -- SQL 명령어들 COMMIT; 기본 격리 수준은 REPEATABLE READ 이다.\nPostgreSQL PostgreSQL 은 모든 격리 수준을 지원하며, 기본 격리 수준은 READ COMMITTED 이다.\n1 2 3 BEGIN; -- SQL 명령어들 COMMIT; SQL Server SQL Server 는 모든 트랜잭션 격리 수준을 지원하며, 추가로 SNAPSHOT 격리 수준도 제공한다.\n1 2 3 BEGIN TRANSACTION; -- SQL 명령어들 COMMIT TRANSACTION; Oracle Oracle 은 READ UNCOMMITTED 를 제외한 모든 격리 수준을 지원합니다. 기본 격리 수준은 READ COMMITTED 이다.\n1 2 3 BEGIN; -- SQL 명령어들 COMMIT; 트랜잭션의 실제 적용 사례 금융 시스템 계좌 이체는 트랜잭션의 대표적인 사례:\n1 2 3 4 5 6 7 8 9 10 11 12 13 BEGIN TRANSACTION; -- 출금 계좌에서 금액 차감 UPDATE accounts SET balance = balance - 100000 WHERE account_id = 'A'; -- 입금 계좌에 금액 추가 UPDATE accounts SET balance = balance + 100000 WHERE account_id = 'B'; -- 거래 내역 기록 INSERT INTO transactions(from_account, to_account, amount, date) VALUES('A', 'B', 100000, NOW()); COMMIT; 재고 관리 시스템 제품 주문 처리:\n1 2 3 4 5 6 7 8 9 10 11 BEGIN TRANSACTION; -- 재고 확인 SELECT quantity FROM inventory WHERE product_id = 123 FOR UPDATE; -- 재고 업데이트 UPDATE inventory SET quantity = quantity - 5 WHERE product_id = 123; -- 주문 생성 INSERT INTO orders(customer_id, product_id, quantity) VALUES(456, 123, 5); COMMIT; 트랜잭션 성능 최적화 팁 트랜잭션은 가능한 짧게 유지하세요.\n긴 트랜잭션은 잠금 경합과 데이터베이스 리소스를 과도하게 사용할 수 있다.\n불필요한 작업은 트랜잭션 외부로 이동하세요.\n데이터 조회만 필요한 경우 트랜잭션이 필요하지 않을 수 있다.\n적절한 격리 수준을 선택하세요.\n모든 상황에 SERIALIZABLE 이 필요하지는 않다. 애플리케이션 요구사항에 맞는 최소한의 격리 수준을 선택한다.\n데드락을 방지하기 위해 항상 같은 순서로 테이블에 접근하세요.\n여러 테이블에 접근할 때 일관된 순서를 유지하면 데드락 가능성이 줄어든다.\n트랜잭션 로그 관리에 주의하세요.\n대용량 트랜잭션은 로그 파일을 급격히 증가시킬 수 있다.\n분산 트랜잭션 여러 데이터베이스 또는 시스템에 걸쳐 있는 트랜잭션을 처리하기 위한 방법.\n2 단계 커밋 (Two-Phase Commit)\n분산 트랜잭션의 일관성을 보장하기 위한 프로토콜로, 준비 단계와 커밋 단계로 구성된다: 준비 단계: 모든 참여 노드가 트랜잭션을 커밋할 준비가 되었는지 확인 커밋 단계: 모든 노드가 준비되었다면 실제 커밋 실행 보상 트랜잭션 (Compensating Transaction)\n마이크로서비스 아키텍처에서 주로 사용되는 방식으로, 트랜잭션이 실패할 경우 이미 수행된 작업을 취소하는 별도의 트랜잭션을 실행한다. ## 용어 정리 용어 설명 참고 및 출처 ","wordCount":"8864","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-10-24T13:19:00Z","dateModified":"2024-10-24T13:19:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/system-design/distributed-systems/transactions/transactions/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1 class="post-title entry-hint-parent">트랜잭션 (Transactions)</h1><div class=post-description>데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위</div><div class=post-meta><span title='2024-10-24 13:19:00 +0000 UTC'>October 24, 2024</span>&nbsp;·&nbsp;42 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/System%20Design/Distributed%20Systems/Transactions/Transactions.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#트랜잭션-transactions>트랜잭션 (Transactions)</a><ul><li><a href=#1-부-태그-분류-구조-요약-및-개요>1 부. 태그, 분류 구조, 요약 및 개요</a></li><li><a href=#2-부-트랜잭션-심층-분석>2 부. 트랜잭션 심층 분석</a></li><li><a href=#3-부-구현-기법-장단점-실무-활용>3 부. 구현 기법, 장단점, 실무 활용</a></li><li><a href=#4-부-주제별-주목할-내용-및-학습-필수-항목>4 부. 주제별 주목할 내용 및 학습 필수 항목</a></li></ul></li><li><a href=#용어-정리>용어 정리</a></li><li><a href=#참고-및-출처>참고 및 출처</a></li><li><a href=#1-태그>1. 태그</a></li><li><a href=#2-분류-구조-적절성-분석>2. 분류 구조 적절성 분석</a></li><li><a href=#3-요약-200-자-내외>3. 요약 (200 자 내외)</a></li><li><a href=#4-개요-250-자-내외>4. 개요 (250 자 내외)</a></li><li><a href=#5-핵심-개념>5. 핵심 개념</a><ul><li><a href=#51-실무-연관성>5.1. 실무 연관성</a></li></ul></li><li><a href=#6-주요-원리--작동-방식>6. 주요 원리 & 작동 방식</a><ul><li><a href=#원리-wal--mvcc>원리: WAL & MVCC</a></li><li><a href=#작동-다이어그램-mvcc--2pl>작동 다이어그램 (MVCC + 2PL)</a></li></ul></li><li><a href=#7-구조-및-아키텍처>7. 구조 및 아키텍처</a><ul><li><a href=#구성-요소>구성 요소</a></li><li><a href=#아키텍처-도식>아키텍처 도식</a></li></ul></li><li><a href=#8-구현-기법>8. 구현 기법</a></li><li><a href=#9-장점>9. 장점</a></li><li><a href=#10-단점문제점해결방안>10. 단점·문제점·해결방안</a><ul><li><a href=#단점-1>단점</a></li><li><a href=#문제점-1>문제점</a></li></ul></li><li><a href=#11-분류-기준별-유형-비교>11. 분류 기준별 유형 비교</a></li><li><a href=#12-실무-사용-예시>12. 실무 사용 예시</a></li><li><a href=#13-활용-사례은행-계좌-이체>13. 활용 사례–은행 계좌 이체</a><ul><li><a href=#시스템-구성도>시스템 구성도</a></li><li><a href=#workflow>Workflow</a></li></ul></li><li><a href=#14-구현-예시-nodejs>14. 구현 예시 (Node.js)</a></li><li><a href=#15-실무-적용-고려사항>15. 실무 적용 고려사항</a></li><li><a href=#16-최적화-고려사항>16. 최적화 고려사항</a></li><li><a href=#용어-정리-1>용어 정리</a></li><li><a href=#참고-및-출처-1>참고 및 출처</a></li><li><a href=#17-도전-과제-challenges-in-practice>17. 도전 과제 (Challenges in Practice)</a></li><li><a href=#18-분류-기준에-따른-종류-및-유형>18. 분류 기준에 따른 종류 및 유형</a></li><li><a href=#19-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>19. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점</a></li><li><a href=#20-최적화하기-위한-고려사항-및-주의할-점>20. 최적화하기 위한 고려사항 및 주의할 점</a></li><li><a href=#21-기타-사항>21. 기타 사항</a><ul><li><a href=#트랜잭션-vs-비동기-메시지-기반-처리-비교-표>트랜잭션 Vs 비동기 메시지 기반 처리 비교 (표)</a></li></ul></li><li><a href=#22-주제와-관련하여-주목할-내용>22. 주제와 관련하여 주목할 내용</a></li><li><a href=#23-반드시-학습해야-할-내용>23. 반드시 학습해야 할 내용</a></li><li><a href=#용어-정리-2>용어 정리</a></li><li><a href=#참고-및-출처-2>참고 및 출처</a></li><li><a href=#24-기타-사항-추가로-알아야-할-필수-개념-및-기술>24. 기타 사항 (추가로 알아야 할 필수 개념 및 기술)</a><ul><li><a href=#1-트랜잭션과-트랜잭션-로그의-차이>1) 트랜잭션과 트랜잭션 로그의 차이</a></li><li><a href=#2-트랜잭션-관점에서의-query-best-practices>2) 트랜잭션 관점에서의 Query Best Practices</a></li><li><a href=#3-트랜잭션과-인프라스트럭처-연계-고려사항>3) 트랜잭션과 인프라스트럭처 연계 고려사항</a></li><li><a href=#4-트랜잭션과-보안>4) 트랜잭션과 보안</a></li><li><a href=#5-트랜잭션-테스트-기법>5) 트랜잭션 테스트 기법</a></li></ul></li><li><a href=#25-연계-기술-정리>25. 연계 기술 정리</a></li><li><a href=#26-마무리-요약>26. 마무리 요약</a></li><li><a href=#다음으로-추천되는-학습-주제>다음으로 추천되는 학습 주제</a></li><li><a href=#-1-mvcc-기반-상세-트랜잭션-흐름>📌 1. MVCC 기반 상세 트랜잭션 흐름</a><ul><li><a href=#핵심-흐름>핵심 흐름</a></li><li><a href=#다이어그램-흐름>다이어그램 흐름</a></li></ul></li><li><a href=#-2-분산-트랜잭션-프로토콜-비교-및-동작-시나리오>🔗 2. 분산 트랜잭션 프로토콜 비교 및 동작 시나리오</a><ul><li><a href=#21-two-phase-commit-2pc>2.1 Two-Phase Commit (2PC)</a></li><li><a href=#22-three-phase-commit-3pc>2.2 Three-Phase Commit (3PC)</a></li><li><a href=#23-saga-패턴>2.3 Saga 패턴</a></li><li><a href=#비교-표>비교 표</a></li></ul></li><li><a href=#-3-분산-트랜잭션-개요-distributed-transactions>🌐 3. 분산 트랜잭션 개요 (Distributed Transactions)</a></li><li><a href=#-요약>✅ 요약</a></li><li><a href=#트랜잭션-transactions-심화-분석>트랜잭션 (Transactions) 심화 분석</a><ul><li><a href=#1-태그-및-분류-검증>1. 태그 및 분류 검증</a></li><li><a href=#2-주제-요약-및-개요>2. 주제 요약 및 개요</a></li><li><a href=#3-핵심-개념>3. 핵심 개념</a></li><li><a href=#4-배경-및-목적>4. 배경 및 목적</a></li><li><a href=#5-주요-기능-및-역할-1>5. 주요 기능 및 역할</a></li><li><a href=#6-특징-및-핵심-원칙>6. 특징 및 핵심 원칙</a></li><li><a href=#7-작동-원리-및-방식>7. 작동 원리 및 방식</a></li><li><a href=#8-구조-및-아키텍처>8. 구조 및 아키텍처</a></li><li><a href=#9-구현-기법>9. 구현 기법</a></li><li><a href=#10-장점>10. 장점</a></li><li><a href=#11-단점과-문제점-그리고-해결방안>11. 단점과 문제점 그리고 해결방안</a></li><li><a href=#12-도전-과제>12. 도전 과제</a></li><li><a href=#13-분류-기준에-따른-종류-및-유형>13. 분류 기준에 따른 종류 및 유형</a></li><li><a href=#14-실무-사용-예시>14. 실무 사용 예시</a></li><li><a href=#15-활용-사례-전자상거래-주문-처리-시스템>15. 활용 사례: 전자상거래 주문 처리 시스템</a></li><li><a href=#16-구현-예시>16. 구현 예시</a></li><li><a href=#17-실무에서-효과적으로-적용하기-위한-고려사항>17. 실무에서 효과적으로 적용하기 위한 고려사항</a></li><li><a href=#18-최적화하기-위한-고려사항>18. 최적화하기 위한 고려사항</a></li><li><a href=#19-주제와-관련하여-주목할-내용>19. 주제와 관련하여 주목할 내용</a></li><li><a href=#20-반드시-학습해야할-내용>20. 반드시 학습해야할 내용</a></li><li><a href=#용어-정리-3>용어 정리</a></li><li><a href=#참고-및-출처-3>참고 및 출처</a></li><li><a href=#-용어-정리>## 용어 정리</a></li><li><a href=#참고-및-출처-4>참고 및 출처</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=트랜잭션-transactions>트랜잭션 (Transactions)<a hidden class=anchor aria-hidden=true href=#트랜잭션-transactions>#</a></h2><h3 id=1-부-태그-분류-구조-요약-및-개요>1 부. 태그, 분류 구조, 요약 및 개요<a hidden class=anchor aria-hidden=true href=#1-부-태그-분류-구조-요약-및-개요>#</a></h3><h4 id=1-태그-tag>1. 태그 (Tag)<a hidden class=anchor aria-hidden=true href=#1-태그-tag>#</a></h4><p>Transaction, Database-Systems, Data-Integrity, Concurrency-Control</p><h4 id=2-분류-구조의-적합성-분석>2. 분류 구조의 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조의-적합성-분석>#</a></h4><p>&ldquo;Systems and Infrastructure > Database Systems&rdquo; 분류는 트랜잭션 (Transactions) 의 본질을 잘 반영합니다. 트랜잭션은 데이터베이스 시스템의 핵심 기능이자, 데이터 무결성과 동시성 제어, 장애 복구 등 모든 데이터베이스 운영의 중심이 되는 개념이므로 이 분류 체계가 적합합니다.</p><h4 id=3-200-자-내외-요약>3. 200 자 내외 요약<a hidden class=anchor aria-hidden=true href=#3-200-자-내외-요약>#</a></h4><p>트랜잭션 (Transaction) 은 데이터베이스에서 하나의 논리적 작업 단위로, 원자성, 일관성, 고립성, 지속성 (ACID) 을 보장하여 데이터의 무결성과 신뢰성을 확보합니다. 트랜잭션은 동시성 제어, 장애 복구 등 복잡한 환경에서도 안정적인 데이터 처리를 가능하게 합니다.</p><h4 id=4-250-자-내외-개요>4. 250 자 내외 개요<a hidden class=anchor aria-hidden=true href=#4-250-자-내외-개요>#</a></h4><p>트랜잭션 (Transaction) 은 데이터베이스에서 여러 작업을 하나의 논리적 단위로 묶어 처리하는 개념입니다. 트랜잭션은 반드시 원자성 (Atomicity), 일관성 (Consistency), 고립성 (Isolation), 지속성 (Durability) 이라는 ACID 특성을 지켜야 하며, 이를 통해 데이터의 신뢰성과 무결성을 보장합니다. 실무에서는 금융, 예약, 전자상거래 등 데이터 정합성이 중요한 시스템에서 필수적으로 사용되며, 동시성 제어와 장애 복구 등 다양한 기술과 연계되어 운영됩니다.</p><h3 id=2-부-트랜잭션-심층-분석>2 부. 트랜잭션 심층 분석<a hidden class=anchor aria-hidden=true href=#2-부-트랜잭션-심층-분석>#</a></h3><h4 id=1-핵심-개념>1. 핵심 개념<a hidden class=anchor aria-hidden=true href=#1-핵심-개념>#</a></h4><ul><li><strong>트랜잭션 (Transaction)</strong>: 데이터베이스에서 하나의 논리적 작업 단위로, 여러 작업을 묶어서 원자적으로 처리</li><li><strong>ACID 특성</strong>: 원자성, 일관성, 고립성, 지속성 보장</li><li><strong>커밋 (Commit)/롤백 (Rollback)</strong>: 트랜잭션의 성공/실패 처리 방식</li></ul><h4 id=2-실무-연관성-분석>2. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#2-실무-연관성-분석>#</a></h4><ul><li>데이터 무결성 보장, 동시성 제어, 장애 복구에 필수</li><li>금융, 주문, 예약 등 데이터 정합성이 중요한 시스템에서 핵심 역할</li></ul><h4 id=3-배경>3. 배경<a hidden class=anchor aria-hidden=true href=#3-배경>#</a></h4><ul><li>여러 사용자가 동시에 데이터베이스에 접근할 때 데이터 손실, 불일치, 장애 발생 방지 필요성에서 등장</li></ul><h4 id=4-목적-및-필요성>4. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#4-목적-및-필요성>#</a></h4><ul><li>데이터 손상 및 불일치 방지</li><li>장애 발생 시 데이터 복구</li><li>신뢰성 있는 데이터베이스 운영</li></ul><h4 id=5-주요-기능-및-역할>5. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#5-주요-기능-및-역할>#</a></h4><ul><li>논리적 작업 단위로 묶어 처리</li><li>부분 실패 시 전체 작업 취소 (원자성)</li><li>트랜잭션 간 간섭 방지 (고립성)</li><li>장애 발생 시 데이터 복구 (지속성)</li></ul><h4 id=6-특징>6. 특징<a hidden class=anchor aria-hidden=true href=#6-특징>#</a></h4><ul><li>명확한 성공/실패 처리</li><li>동시성 및 장애 복원력 강화</li><li>트랜잭션 단위의 일관성 보장</li></ul><h4 id=7-핵심-원칙>7. 핵심 원칙<a hidden class=anchor aria-hidden=true href=#7-핵심-원칙>#</a></h4><ul><li>ACID 특성 준수 (원자성, 일관성, 고립성, 지속성)</li></ul><h4 id=8-주요-원리-및-작동-원리>8. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#8-주요-원리-및-작동-원리>#</a></h4><pre class=mermaid>flowchart TD
    A[트랜잭션 시작] --&gt; B[작업 수행]
    B --&gt; C{모든 작업 성공?}
    C -- 예 --&gt; D[커밋(Commit)]
    C -- 아니오 --&gt; E[롤백(Rollback)]
    D --&gt; F[트랜잭션 종료]
    E --&gt; F
</pre><ul><li><strong>설명</strong>: 트랜잭션 내 모든 작업이 성공하면 커밋, 하나라도 실패하면 롤백되어 데이터의 무결성이 보장됩니다.</li></ul><h4 id=9-구조-및-아키텍처>9. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#9-구조-및-아키텍처>#</a></h4><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td>트랜잭션 관리자</td><td>트랜잭션 상태 관리</td><td>ACID 특성 보장</td></tr><tr><td>로그 관리자</td><td>변경 이력 기록</td><td>복구 및 지속성 지원</td></tr><tr><td>동시성 제어기</td><td>동시 트랜잭션 조정</td><td>고립성, 일관성 유지</td></tr><tr><td>복구 관리자</td><td>장애 시 데이터 복구</td><td>지속성, 일관성 보장</td></tr></tbody></table><h5 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h5><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td>락 관리자</td><td>자원 잠금 관리</td><td>고립성 강화</td></tr><tr><td>체크포인트 관리자</td><td>상태 저장</td><td>복구 최적화</td></tr></tbody></table><h4 id=구조-다이어그램>구조 다이어그램<a hidden class=anchor aria-hidden=true href=#구조-다이어그램>#</a></h4><pre class=mermaid>flowchart LR
    User(사용자) --&gt; TxManager(트랜잭션 관리자)
    TxManager --&gt; LogManager(로그 관리자)
    TxManager --&gt; Concurrency(동시성 제어기)
    TxManager --&gt; Recovery(복구 관리자)
    Concurrency --&gt; DB(데이터베이스)
    Recovery --&gt; DB
    LogManager --&gt; DB
</pre><ul><li><strong>설명</strong>: 트랜잭션 관리자는 로그, 동시성, 복구 관리자를 통해 데이터베이스의 ACID 특성을 보장합니다.</li></ul><h3 id=3-부-구현-기법-장단점-실무-활용>3 부. 구현 기법, 장단점, 실무 활용<a hidden class=anchor aria-hidden=true href=#3-부-구현-기법-장단점-실무-활용>#</a></h3><h4 id=1-구현-기법>1. 구현 기법<a hidden class=anchor aria-hidden=true href=#1-구현-기법>#</a></h4><ul><li><strong>Write-Ahead Logging (WAL, 선기록 로그)</strong>: 변경 전 로그 기록 후 실제 데이터 변경</li><li><strong>Locking(락킹)</strong>: 자원 잠금으로 동시성 제어</li><li><strong>MVCC(다중 버전 동시성 제어)</strong>: 버전별 데이터 관리로 고립성 보장</li><li><strong>2-Phase Commit(2PC, 2 단계 커밋)</strong>: 분산 트랜잭션에서 원자성 보장</li></ul><h4 id=2-장점>2. 장점<a hidden class=anchor aria-hidden=true href=#2-장점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>데이터 무결성</td><td>트랜잭션 단위로 일관성 보장</td></tr><tr><td>장점</td><td>신뢰성</td><td>오류·장애 발생 시 데이터 손실 방지</td></tr><tr><td>장점</td><td>동시성</td><td>여러 트랜잭션의 안정적 병행 처리</td></tr><tr><td>장점</td><td>복구 용이성</td><td>장애 발생 시 신속한 복구 가능</td></tr></tbody></table><h4 id=3-단점과-문제점-그리고-해결방안>3. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#3-단점과-문제점-그리고-해결방안>#</a></h4><h5 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h5><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>성능 저하</td><td>동시성 제어로 인한 지연</td><td>MVCC, 최적화된 락 전략</td></tr><tr><td>단점</td><td>복잡성 증가</td><td>트랜잭션 관리 로직 복잡</td><td>자동화 도구 활용</td></tr><tr><td>단점</td><td>확장성 한계</td><td>분산 환경에서 관리 어려움</td><td>분산 트랜잭션 프로토콜</td></tr></tbody></table><h5 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h5><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데드락</td><td>상호 잠금</td><td>트랜잭션 정지</td><td>모니터링, 타임아웃</td><td>락 순서 지정</td><td>데드락 회피 알고리즘</td></tr><tr><td>문제점</td><td>성능 저하</td><td>락 경합</td><td>응답 지연</td><td>성능 모니터링</td><td>락 범위 최소화</td><td>MVCC 적용</td></tr><tr><td>문제점</td><td>일관성 오류</td><td>트랜잭션 실패</td><td>데이터 불일치</td><td>정합성 검사</td><td>트랜잭션 재시도</td><td>자동 롤백</td></tr></tbody></table><h4 id=4-도전-과제>4. 도전 과제<a hidden class=anchor aria-hidden=true href=#4-도전-과제>#</a></h4><ul><li>분산 환경에서의 트랜잭션 일관성 보장</li><li>글로벌 트랜잭션의 성능·확장성 최적화</li><li>장애 복구 자동화 및 신뢰성 강화</li></ul><h4 id=5-분류-기준에-따른-종류-및-유형>5. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#5-분류-기준에-따른-종류-및-유형>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션 범위</td><td>단일 데이터베이스</td><td>하나의 DB 내 트랜잭션</td></tr><tr><td>트랜잭션 범위</td><td>분산 트랜잭션</td><td>여러 DB, 시스템 간 트랜잭션</td></tr><tr><td>동시성 제어</td><td>Locking 기반</td><td>자원 잠금 방식</td></tr><tr><td>동시성 제어</td><td>MVCC 기반</td><td>다중 버전 관리 방식</td></tr></tbody></table><h4 id=6-실무-사용-예시>6. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#6-실무-사용-예시>#</a></h4><table><thead><tr><th>사용 분야</th><th>함께 사용하는 시스템</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>금융 거래</td><td>Oracle, PostgreSQL</td><td>정확한 잔액 처리</td><td>데이터 손실 및 오류 방지</td></tr><tr><td>전자상거래 주문</td><td>MySQL, MongoDB</td><td>주문/재고 동시 처리</td><td>정확한 재고 관리</td></tr><tr><td>예약 시스템</td><td>SQL Server</td><td>동시 예약 방지</td><td>이중 예약 방지</td></tr></tbody></table><h4 id=7-활용-사례>7. 활용 사례<a hidden class=anchor aria-hidden=true href=#7-활용-사례>#</a></h4><ul><li><strong>전자상거래 주문 처리 시스템</strong><ul><li>주문 요청 → 트랜잭션 시작 → 재고 차감 및 결제 → 성공 시 커밋, 실패 시 롤백</li><li>트랜잭션 미적용 시: 장애 발생 시 재고 불일치, 결제 오류 발생 가능</li><li>트랜잭션 적용 시: 장애 발생 시 모든 작업 롤백, 데이터 일관성 유지</li></ul></li></ul><pre class=mermaid>flowchart TD
    A[주문 요청] --&gt; B[트랜잭션 시작]
    B --&gt; C[재고 차감]
    C --&gt; D[결제 처리]
    D --&gt; E{모두 성공?}
    E -- 예 --&gt; F[커밋]
    E -- 아니오 --&gt; G[롤백]
</pre><h4 id=8-구현-예시-python-sqlalchemy>8. 구현 예시 (Python, SQLAlchemy)<a hidden class=anchor aria-hidden=true href=#8-구현-예시-python-sqlalchemy>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># SQLAlchemy를 활용한 트랜잭션 처리 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=s1>&#39;postgresql://user:pw@localhost/db&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>session</span> <span class=o>=</span> <span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 트랜잭션 시작</span>
</span></span><span class=line><span class=cl>    <span class=c1># 주문 정보 저장</span>
</span></span><span class=line><span class=cl>    <span class=c1># 재고 차감</span>
</span></span><span class=line><span class=cl>    <span class=c1># 결제 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>  <span class=c1># 모든 작업 성공 시 커밋</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>  <span class=c1># 하나라도 실패 시 롤백</span>
</span></span><span class=line><span class=cl><span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>설명</strong>: 모든 작업이 성공하면 커밋, 실패 시 롤백하여 원자성과 일관성을 보장합니다.</li></ul><h4 id=9-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>9. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#9-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계</td><td>트랜잭션 경계 명확화</td><td>작업 단위 명확히 구분</td></tr><tr><td>운영</td><td>동시성 제어</td><td>락 경합 최소화</td></tr><tr><td>복구</td><td>로그 관리</td><td>WAL 등 로그 기록 필수</td></tr><tr><td>확장성</td><td>분산 트랜잭션 관리</td><td>XA 등 프로토콜 적용</td></tr></tbody></table><ul><li><strong>권장사항</strong>: 트랜잭션 범위 최소화, 자동화 도구 활용, 실시간 모니터링 도입</li></ul><h4 id=10-최적화하기-위한-고려사항-및-주의할-점>10. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#10-최적화하기-위한-고려사항-및-주의할-점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>성능</td><td>락 범위 최소화</td><td>필요한 자원만 잠금</td></tr><tr><td>동시성</td><td>MVCC 활용</td><td>충돌 최소화</td></tr><tr><td>복구</td><td>체크포인트 관리</td><td>복구 시간 단축</td></tr><tr><td>운영</td><td>모니터링</td><td>데드락·성능 이슈 실시간 감지</td></tr></tbody></table><ul><li><strong>권장사항</strong>: MVCC 및 WAL 적극 활용, 자동화된 복구 및 모니터링 시스템 구축</li></ul><h3 id=4-부-주제별-주목할-내용-및-학습-필수-항목>4 부. 주제별 주목할 내용 및 학습 필수 항목<a hidden class=anchor aria-hidden=true href=#4-부-주제별-주목할-내용-및-학습-필수-항목>#</a></h3><h4 id=1-주제별-주목할-내용>1. 주제별 주목할 내용<a hidden class=anchor aria-hidden=true href=#1-주제별-주목할-내용>#</a></h4><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션</td><td>ACID</td><td>4 대 원칙</td><td>데이터베이스 신뢰성의 핵심</td></tr><tr><td>동시성</td><td>Locking</td><td>자원 잠금</td><td>고립성, 일관성 보장</td></tr><tr><td>복구</td><td>WAL</td><td>로그 기반 복구</td><td>지속성, 장애 복구</td></tr><tr><td>확장성</td><td>2PC</td><td>분산 트랜잭션</td><td>원자성 보장</td></tr></tbody></table><h4 id=2-반드시-학습해야할-내용>2. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#2-반드시-학습해야할-내용>#</a></h4><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션</td><td>ACID</td><td>원자성, 일관성, 고립성, 지속성</td><td>트랜잭션의 기본 원칙</td></tr><tr><td>동시성 제어</td><td>Locking, MVCC</td><td>동시성 관리</td><td>여러 트랜잭션의 안정적 실행</td></tr><tr><td>복구</td><td>WAL, Shadow Paging</td><td>장애 복구</td><td>데이터 손실 방지</td></tr><tr><td>분산 시스템</td><td>분산 트랜잭션</td><td>확장성</td><td>여러 시스템 간 일관성 유지</td></tr></tbody></table><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션</td><td>트랜잭션 (Transaction)</td><td>데이터베이스에서 하나의 논리적 작업 단위</td></tr><tr><td>트랜잭션</td><td>커밋 (Commit)</td><td>트랜잭션의 모든 작업을 영구 반영하는 명령</td></tr><tr><td>트랜잭션</td><td>롤백 (Rollback)</td><td>트랜잭션 내 모든 작업을 취소하는 명령</td></tr><tr><td>동시성</td><td>락 (Lock)</td><td>동시 접근 제어를 위한 자원 잠금 기법</td></tr><tr><td>복구</td><td>로그 (Log)</td><td>변경 이력을 기록한 파일</td></tr><tr><td>복구</td><td>체크포인트 (Checkpoint)</td><td>복구 시점 저장을 위한 데이터베이스 상태</td></tr><tr><td>분산</td><td>2PC(2-Phase Commit)</td><td>분산 트랜잭션의 원자성 보장 프로토콜</td></tr><tr><td>최적화</td><td>MVCC(Multi-Version Concurrency Control)</td><td>다중 버전 동시성 제어 기법</td></tr></tbody></table><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Database_transaction>트랜잭션 개념 및 ACID 특성</a></li><li><a href=https://www.postgresql.org/docs/current/transaction-iso.html>트랜잭션과 동시성 제어</a></li><li><a href=https://www.sqlite.org/wal.html>Write-Ahead Logging 개념</a></li><li><a href=https://docs.oracle.com/cd/E13222_01/wls/docs81/jta/fund.html>분산 트랜잭션과 2PC</a></li><li><a href=https://www.cockroachlabs.com/blog/transactions-acid/>MVCC와 동시성 제어</a></li></ul><p><a href=https://mbagrat.com/database/acid-atomicity-consistency-isolation-durability/><figure><img alt="A beginner’s guide to ACID and database transactions - Bagrat Mukaelyan &mldr;" loading=lazy src="https://tse2.mm.bing.net/th/id/OIP.rVfRpJAWSfsLdIiKrTRSRQHaIR?r=0\\&pid=Api"></figure></a></p><p>다음은 <strong>Transactions</strong> 주제에 대한 심화 정리입니다.</p><hr><h2 id=1-태그>1. 태그<a hidden class=anchor aria-hidden=true href=#1-태그>#</a></h2><ul><li>Database-Transactions</li><li>ACID-Properties</li><li>Concurrency-Control</li><li>Distributed-Transactions</li></ul><hr><h2 id=2-분류-구조-적절성-분석>2. 분류 구조 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적절성-분석>#</a></h2><p>현재 &ldquo;Systems and Infrastructure > Database Systems&rdquo; 안에 &ldquo;Transactions&rdquo; 가 위치하고 있으며, 이는 데이터베이스 동작의 핵심 개념으로 적절합니다.<br><strong>근거</strong>:</p><ul><li>트랜잭션은 DB 의 일관성, 동시성, 복구의 핵심 메커니즘이므로, 해당 분류 구조가 매우 적합합니다.</li></ul><hr><h2 id=3-요약-200-자-내외>3. 요약 (200 자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-200-자-내외>#</a></h2><p>트랜잭션은 여러 데이터베이스 작업을 하나의 논리적 단위로 묶어 <strong>ACID</strong>(Atomicity, Consistency, Isolation, Durability) 를 보장합니다. 이를 통해 동시성 문제 및 시스템 장애에도 데이터 정확성과 일관성을 유지합니다. Isolation 수준 (Serializable, Repeatable Read 등) 을 설정하여 동시성 - 성능 균형을 조절하며, 분산 환경에서는 2 상 커밋 같은 프로토콜이 활용됩니다.</p><hr><h2 id=4-개요-250-자-내외>4. 개요 (250 자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요-250-자-내외>#</a></h2><p>데이터베이스 트랜잭션은 여러 연산을 하나의 원자적 (atomic) 유닛으로 처리하여, 실패 시 롤백, 성공 시 커밋 처리하는 일련의 흐름입니다. 이는 <strong>ACID</strong> 속성을 기반으로 하며, 동시성 제어를 통해 여러 트랜잭션이 충돌 없이 실행되도록 합니다. Isolation 수준 (Serializable 등) 을 조정해 일관성과 성능을 조율하고, 시스템 장애 시 WAL(write-ahead logging) 이나 쉐도 페이지 (shadow paging) 로 복구됩니다. 분산 환경에서는 2PC(two-phase commit) 로 전역 원자성을 보장합니다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>Transaction</strong>: 일련의 DB 작업 (read/write) 의 의미있는 묶음, <code>BEGIN…COMMIT/ROLLBACK</code> 통해 경계 정의 (<a href="https://en.wikipedia.org/wiki/ACID?utm_source=chatgpt.com" title=ACID>위키백과</a>)</li><li><strong>ACID 특성</strong>:<ul><li><strong>Atomicity</strong>: 전부 실행되거나 전혀 실행되지 않음</li><li><strong>Consistency</strong>: 트랜잭션 전후에 DB 무결성 보장 (<a href="https://en.wikipedia.org/wiki/ACID?utm_source=chatgpt.com" title=ACID>위키백과</a>)</li><li><strong>Isolation</strong>: 동시 트랜잭션 간 간섭 없음, 격리 수준에 따라 동시성 조절</li><li><strong>Durability</strong>: 커밋 후 영구 저장, 시스템 장애에도 손실 없음 (<a href="https://en.wikipedia.org/wiki/Durability_%28database_systems%29?utm_source=chatgpt.com" title="Durability (database systems)">위키백과</a>)</li></ul></li><li><strong>Isolation Levels</strong>: ANSI 수준 (READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE), 동시성 현상 관리 (<a href="https://en.wikipedia.org/wiki/Isolation_%28database_systems%29?utm_source=chatgpt.com" title="Isolation (database systems)">위키백과</a>)</li></ul><h3 id=51-실무-연관성>5.1. 실무 연관성<a hidden class=anchor aria-hidden=true href=#51-실무-연관성>#</a></h3><ul><li>금융/재무 시스템: 정확한 금액 이체와 무결성 보장</li><li>동시 사용: 쇼핑카트, 예약 시스템에서 경쟁 조건 방지</li><li>분산 트랜잭션: 데이터 샤딩 환경에서 일관성 유지</li></ul><hr><h2 id=6-주요-원리--작동-방식>6. 주요 원리 & 작동 방식<a hidden class=anchor aria-hidden=true href=#6-주요-원리--작동-방식>#</a></h2><h3 id=원리-wal--mvcc>원리: WAL & MVCC<a hidden class=anchor aria-hidden=true href=#원리-wal--mvcc>#</a></h3><ul><li><strong>Write-Ahead Logging</strong>: 로그에 먼저 기록 후 반영 → 복구 지원 (<a href="https://tru-dasc.github.io/DASC_5410_students/lectures/lecture8.html?utm_source=chatgpt.com" title="Lecture 8: Transactions ACID in SQL—DASC 5410 - Data and Database …">tru-dasc.github.io</a>, <a href="https://en.wikipedia.org/wiki/ACID?utm_source=chatgpt.com" title=ACID>위키백과</a>)</li><li><strong>Concurrency Control</strong>:<ul><li><strong>Lock 기반 (2PL)</strong>: 잠금을 통해 동시성 조절</li><li><strong>MVCC(snapshot)</strong>: 버전 기반 읽기, Dirty/Non-repeatable/Phantom 방지 (<a href="https://en.wikipedia.org/wiki/Isolation_%28database_systems%29?utm_source=chatgpt.com" title="Isolation (database systems)">위키백과</a>)</li></ul></li></ul><h3 id=작동-다이어그램-mvcc--2pl>작동 다이어그램 (MVCC + 2PL)<a hidden class=anchor aria-hidden=true href=#작동-다이어그램-mvcc--2pl>#</a></h3><pre class=mermaid>sequenceDiagram
  participant T1
  participant T2
  T1-&gt;&gt;DB: BEGIN
  DB-&gt;&gt;T1: Snapshot at S1
  T1-&gt;&gt;DB: UPDATE A
  T2-&gt;&gt;DB: BEGIN
  DB-&gt;&gt;T2: Snapshot at S1
  T2-&gt;&gt;DB: READ A (old version)
  T1-&gt;&gt;DB: COMMIT → write-ahead log, version++ 
  T2-&gt;&gt;DB: UPDATE A? → check version conflict
</pre><hr><h2 id=7-구조-및-아키텍처>7. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#7-구조-및-아키텍처>#</a></h2><h3 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h3><table><thead><tr><th>구성 요소</th><th>필수/선택</th><th>역할</th></tr></thead><tbody><tr><td>Transaction Manager</td><td>필수</td><td>트랜잭션 시작/커밋/롤백, 상태 관리</td></tr><tr><td>Concurrency Control</td><td>필수</td><td>Lock/MVCC / 격리 수준 관리</td></tr><tr><td>Recovery Manager</td><td>필수</td><td>WAL 기반 장애 복구 구현</td></tr><tr><td>Log Manager</td><td>필수</td><td>WAL 기록 및 체크포인트 관리</td></tr><tr><td>Scheduler</td><td>선택</td><td>작업 스케줄링 및 동시성 조정</td></tr><tr><td>2PC Coordinator</td><td>선택</td><td>분산 트랜잭션 커밋 협의</td></tr><tr><td>Timeout Manager</td><td>선택</td><td>롱 트랜잭션 탐지/타임아웃</td></tr></tbody></table><h3 id=아키텍처-도식>아키텍처 도식<a hidden class=anchor aria-hidden=true href=#아키텍처-도식>#</a></h3><pre class=mermaid>flowchart LR
  App --&gt; TM[Transaction Manager]
  TM --&gt; CControl[Concurrency Control]
  TM --&gt; LogM[Log Manager]
  TM --&gt; RM[Recovery Manager]
  CControl --&gt; Storage
  LogM --&gt; WAL
  RM --&gt; Storage
</pre><hr><h2 id=8-구현-기법>8. 구현 기법<a hidden class=anchor aria-hidden=true href=#8-구현-기법>#</a></h2><ul><li><strong>단일 인스턴스 DB</strong>:<ul><li>WAL + 2PL 또는 MVCC</li></ul></li><li><strong>분산 트랜잭션</strong>:<ul><li>2PC (코디네이터 + 참가자, voting)</li></ul></li><li><strong>NoSQL/Bulk 데이터베이스</strong>:<ul><li>Multi-document 트랜잭션 (MongoDB), 제한된 ACID 적용 (<a href="https://www.geeksforgeeks.org/dbms/acid-properties-in-dbms/?utm_source=chatgpt.com" title="ACID Properties in DBMS - GeeksforGeeks">GeeksforGeeks</a>, <a href="https://hevodata.com/learn/mongodb-acid-transactions/?utm_source=chatgpt.com" title="MongoDB ACID Transactions: Multi-Document Transactions Simplified 101">hevodata.com</a>, <a href="https://en.wikipedia.org/wiki/Isolation_%28database_systems%29?utm_source=chatgpt.com" title="Isolation (database systems)">위키백과</a>, <a href="https://www.mongodb.com/basics/acid-transactions?utm_source=chatgpt.com" title="ACID Properties In DBMS Explained | MongoDB | MongoDB">MongoDB</a>)</li></ul></li></ul><hr><h2 id=9-장점>9. 장점<a hidden class=anchor aria-hidden=true href=#9-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>데이터 무결성 보장</td><td>ACID 로 정확한 처리 흐름 유지</td></tr><tr><td></td><td>동시성 관리</td><td>Isolation 수준으로 교착 없이 처리</td></tr><tr><td></td><td>장애 복구 능력</td><td>WAL+Recovery 로 데이터 손실 방지</td></tr><tr><td></td><td>일관된 분산 처리</td><td>2PC 로 전역 동기화된 커밋 보장</td></tr></tbody></table><hr><h2 id=10-단점문제점해결방안>10. 단점·문제점·해결방안<a hidden class=anchor aria-hidden=true href=#10-단점문제점해결방안>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>성능 오버헤드</td><td>Lock/MVCC 관리로 처리 지연</td><td>최적 isolation 설정, 인덱스 활용</td></tr><tr><td></td><td>확장성 한계</td><td>2PC 로 인한 블로킹 및 복잡도 증가</td><td>Saga 패턴으로 대체</td></tr><tr><td></td><td>자원 사용 증가</td><td>로그/버전 관리 비용 발생</td><td>로그 압축, 버전 GC 설정</td></tr></tbody></table><h3 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지</th><th>예방</th><th>해결</th></tr></thead><tbody><tr><td>문제점</td><td>Deadlock</td><td>순환 Lock 대기</td><td>시스템 hang</td><td>Deadlock detector</td><td>올바른 잠금 순서</td><td>타임아웃, rollback</td></tr><tr><td></td><td>Phantom read</td><td>낮은 isolation</td><td>불일치 조회</td><td>비정상 query 결과</td><td>SERIALIZABLE 수준</td><td>Upgrade isolation</td></tr><tr><td></td><td>Coordinator crash</td><td>2PC 중단</td><td>분산 블로킹</td><td>Unresolved participants</td><td>Retry, Timeout</td><td>Recovery 절차 완비</td></tr></tbody></table><hr><h2 id=11-분류-기준별-유형-비교>11. 분류 기준별 유형 비교<a hidden class=anchor aria-hidden=true href=#11-분류-기준별-유형-비교>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>Isolation 기준</td><td>Read Uncommitted, Read Committed, Repeatable Read, Serializable</td><td>ANSI 표준</td></tr><tr><td>Concurrency 방식</td><td>Lock-based, MVCC</td><td>동시성 제어 방식</td></tr><tr><td>환경 기준</td><td>Local, Distributed</td><td>분산 여부 기준</td></tr></tbody></table><hr><h2 id=12-실무-사용-예시>12. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#12-실무-사용-예시>#</a></h2><table><thead><tr><th>시스템</th><th>사용 목적</th><th>효과</th></tr></thead><tbody><tr><td>금융 앱</td><td>이체 작업 개발</td><td>금액 정확성, 롤백 보장</td></tr><tr><td>전자상거래</td><td>주문/재고 동시 처리</td><td>재고 오버셀 방지</td></tr><tr><td>분산 서비스</td><td>샤 arded DB 간 트랜잭션</td><td>Saga vs 2PC 전략 선택</td></tr></tbody></table><hr><h2 id=13-활용-사례은행-계좌-이체>13. 활용 사례–은행 계좌 이체<a hidden class=anchor aria-hidden=true href=#13-활용-사례은행-계좌-이체>#</a></h2><h3 id=시스템-구성도>시스템 구성도<a hidden class=anchor aria-hidden=true href=#시스템-구성도>#</a></h3><pre class=mermaid>graph LR
  A[App API] --&gt; TM[Transaction Manager]
  TM --&gt; DB1
  TM --&gt; DB2
</pre><h3 id=workflow>Workflow<a hidden class=anchor aria-hidden=true href=#workflow>#</a></h3><ol><li>계좌 A 에서 금액 차감</li><li>계좌 B 에 금액 입금</li><li>두 DB 에 대해 2PC 수행</li><li>모두 성공 시 Commit, 아니면 Rollback</li></ol><p><strong>With 트랜잭션</strong>: 원자성 확보, 불일치 없음<br><strong>Without 트랜잭션</strong>: 반만 실행될 경우 데이터 불일치 및 오류 발생</p><hr><h2 id=14-구현-예시-nodejs>14. 구현 예시 (Node.js)<a hidden class=anchor aria-hidden=true href=#14-구현-예시-nodejs>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>transfer</span><span class=p>(</span><span class=nx>client1</span><span class=p>,</span> <span class=nx>client2</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>conn1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client1</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>conn2</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client2</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>conn1</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;BEGIN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>conn2</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;BEGIN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>conn1</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;UPDATE accounts SET bal=bal-$1 WHERE id=$2&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>amount</span><span class=p>,</span> <span class=s1>&#39;A&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>conn2</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;UPDATE accounts SET bal=bal+$1 WHERE id=$2&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>amount</span><span class=p>,</span> <span class=s1>&#39;B&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>conn1</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;COMMIT&#39;</span><span class=p>),</span> <span class=nx>conn2</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;COMMIT&#39;</span><span class=p>)]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>conn1</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;ROLLBACK&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>conn2</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;ROLLBACK&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn1</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn2</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=15-실무-적용-고려사항>15. 실무 적용 고려사항<a hidden class=anchor aria-hidden=true href=#15-실무-적용-고려사항>#</a></h2><table><thead><tr><th>고려 항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>Isolation 선택</td><td>데이터 정합성 vs 성능</td><td>대부분 R/C, 필요 시 R/R</td></tr><tr><td>Timeout 설정</td><td>롱 트랜잭션 방지</td><td>타임아웃 + 모니터링</td></tr><tr><td>로그 및 GC</td><td>MVCC log 누적 방지</td><td>VACUUM/Cleanup 주기 설정</td></tr><tr><td>장애 대응</td><td>중단된 트랜잭션 탐지</td><td>Deadlock 감지, coordinator 복구</td></tr></tbody></table><hr><h2 id=16-최적화-고려사항>16. 최적화 고려사항<a hidden class=anchor aria-hidden=true href=#16-최적화-고려사항>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>인덱스 활용</td><td>Lock 범위 최소화</td><td>WHERE↑JOIN 컬럼 인덱스</td></tr><tr><td>배치 처리</td><td>트랜잭션 오버헤드 감소</td><td>100~1000 건당 묶기</td></tr><tr><td>Isolation 혼합 사용</td><td>경우에 따라 차등 적용</td><td>읽기: R/C, 쓰기: R/R</td></tr><tr><td>Connection Pool 조정</td><td>트랜잭션 수에 연동</td><td>max connections &lt; DB limit</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>Transaction</td><td>작업의 논리적 단위, ACID 보장</td></tr><tr><td>ACID 속성</td><td>Atomicity</td><td>원자성, 전부 또는 전무</td></tr><tr><td>ACID 속성</td><td>Consistency</td><td>일관성, 무결성 규칙 유지</td></tr><tr><td>ACID 속성</td><td>Isolation</td><td>격리성, 동시성 간섭 방지</td></tr><tr><td>ACID 속성</td><td>Durability</td><td>영구성, 커밋 보장</td></tr><tr><td>동시성</td><td>MVCC</td><td>멀티 버전 동시성 제어</td></tr><tr><td>동시성</td><td>2PL</td><td>2 단계 잠금 프로토콜</td></tr><tr><td>분산 트랜잭션</td><td>2PC</td><td>2 상 커밋 프로토콜</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li>[Databricks: ACID 트랜잭션 정의](<a href="https://en.wikipedia.org/wiki/ACID?utm_source=chatgpt.com" title=ACID>위키백과</a>, <a href="https://dev.mysql.com/doc/refman/en/innodb-transaction-isolation-levels.html?utm_source=chatgpt.com" title="MySQL 8.4 Reference Manual:: 17.7.2.1 Transaction Isolation Levels">dev.mysql.com</a>, <a href="https://www.databricks.com/glossary/acid-transactions?utm_source=chatgpt.com" title="ACID Transactions in Databases - Databricks">databricks.com</a>)</li><li>[Wikipedia: ACID 속성 유래]</li><li>[CockroachLabs: Isolation Level 설명](<a href="https://www.cockroachlabs.com/blog/sql-isolation-levels-explained/?utm_source=chatgpt.com" title="Everything you always wanted to know about SQL isolation levels …">cockroachlabs.com</a>)</li><li>[PostgreSQL 문서: Isolation 레벨](<a href="https://www.postgresql.org/docs/current/transaction-iso.html?utm_source=chatgpt.com" title="Documentation: 17: 13.2. Transaction Isolation - PostgreSQL">PostgreSQL</a>)</li><li>[Wikipedia: MVCC (Snapshot Isolation)](<a href="https://en.wikipedia.org/wiki/Snapshot_isolation?utm_source=chatgpt.com" title="Snapshot isolation">위키백과</a>)</li></ul><hr><p>필요하신 추가 항목 (분산 트랜잭션 상세, 트랜잭션 모니터링 등) 도 언제든 요청하세요!</p><p>이어서 <strong>Transactions</strong> 주제의 나머지 항목을 상세하게 정리합니다.</p><hr><h2 id=17-도전-과제-challenges-in-practice>17. 도전 과제 (Challenges in Practice)<a hidden class=anchor aria-hidden=true href=#17-도전-과제-challenges-in-practice>#</a></h2><p>트랜잭션은 실무에서 <strong>확장성</strong>, <strong>성능</strong>, <strong>복구 전략</strong>, <strong>분산 처리</strong> 등 다양한 과제를 안고 있습니다.</p><table><thead><tr><th>카테고리</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>동시성 제어</td><td>Lock Contention</td><td>다중 쓰기 충돌</td><td>성능 저하, Deadlock</td><td>대기 시간, Lock Queue 모니터링</td><td>분리된 범위로 쓰기 분산</td><td>MVCC 기반 버전 격리</td></tr><tr><td>분산 환경</td><td>2PC 지연</td><td>참가자 간 메시지 지연</td><td>블로킹, 불완전 트랜잭션</td><td>Coordinator 로그 분석</td><td>Saga 기반 롤백 설계</td><td>Compensation 트랜잭션 도입</td></tr><tr><td>복구 전략</td><td>WAL 손상</td><td>디스크 오류</td><td>로그 기반 복구 실패</td><td>CRC 검사, 로그 비교</td><td>WAL 이중화</td><td>RAID 구성, 이중 로그 채널</td></tr><tr><td>시스템 확장</td><td>글로벌 트랜잭션 증가</td><td>마이크로서비스 간 분산 처리</td><td>트랜잭션 관리 복잡도 상승</td><td>트랜잭션 추적 로그</td><td>서비스 단위 최소화</td><td>분산 트랜잭션 추상화 도입 (Atomikos, Debezium)</td></tr><tr><td>데이터 지연</td><td>트랜잭션 큐 증가</td><td>높은 TPS → 처리 병목</td><td>대기 시간 증가</td><td>대기열 모니터링</td><td>처리량 기반 Auto-scaling</td><td>비동기 트랜잭션 처리</td></tr></tbody></table><hr><h2 id=18-분류-기준에-따른-종류-및-유형>18. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#18-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션 환경</td><td>Local Transaction</td><td>단일 DB 내 트랜잭션</td></tr><tr><td></td><td>Distributed Transaction</td><td>여러 DB 노드에 걸친 트랜잭션 (2PC 사용)</td></tr><tr><td>처리 단위 기준</td><td>Flat Transaction</td><td>단일 수준의 begin/commit 구조</td></tr><tr><td></td><td>Nested Transaction</td><td>하위 트랜잭션 포함 구조</td></tr><tr><td>동시성 제어 방식</td><td>Lock-based Concurrency</td><td>잠금 기반 격리 제어 (2PL)</td></tr><tr><td></td><td>MVCC (Multi-Version Concurrency)</td><td>버전 기반 비차단 읽기</td></tr><tr><td>실패 복구 방식</td><td>Undo Logging</td><td>이전 상태 저장 → 롤백</td></tr><tr><td></td><td>Redo Logging</td><td>변경사항 저장 → 복구</td></tr><tr><td>API 스타일 기준</td><td>Declarative Transaction</td><td>설정 기반 관리 (@Transactional)</td></tr><tr><td></td><td>Programmatic Transaction</td><td>명시적 API 호출 관리</td></tr></tbody></table><hr><h2 id=19-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>19. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#19-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>고려 항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>Isolation Level</td><td>낮을수록 성능 향상, 높을수록 정합성 보장</td><td>기본은 Read Committed, 중요 데이터는 Serializable</td></tr><tr><td>커넥션 수 제한</td><td>동시 트랜잭션 수는 DB 의 커넥션 수 제약에 영향</td><td>커넥션 풀을 적절히 설정하고 트랜잭션 범위를 짧게 유지</td></tr><tr><td>트랜잭션 범위 정의</td><td>긴 트랜잭션은 교착 상태 유발 가능성 ↑</td><td>트랜잭션 범위를 최소화하고 명확히 경계 설정</td></tr><tr><td>장애 복구 전략 수립</td><td>WAL, replication 등을 활용한 복구 메커니즘 필수</td><td>DB 장애 시 빠른 복구를 위한 백업 및 장애대응 자동화</td></tr><tr><td>분산 환경 고려</td><td>마이크로서비스 간 트랜잭션은 복잡도 높음</td><td>분산 트랜잭션 프레임워크 (Saga, Atomikos 등) 활용</td></tr></tbody></table><hr><h2 id=20-최적화하기-위한-고려사항-및-주의할-점>20. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#20-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>최적화 항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>Read-Only 트랜잭션 구분</td><td>읽기 전용 트랜잭션은 격리 수준 낮게 설정</td><td>성능 개선 위해 READ COMMITTED 활용</td></tr><tr><td>Index 최적화</td><td>트랜잭션 내 검색 성능 향상</td><td>WHERE 절과 JOIN 키에 적절한 인덱스 구성</td></tr><tr><td>Bulk 처리 최적화</td><td>다건 처리 시 트랜잭션 하나로 묶어 오버헤드 감소</td><td>500~1000 건 단위로 batching</td></tr><tr><td>트랜잭션 프로파일링</td><td>병목 파악 및 로그 분석</td><td>pg_stat_activity, SHOW ENGINE INNODB STATUS 등 활용</td></tr><tr><td>쓰기 분산 전략</td><td>특정 테이블 집중 쓰기 → 경합 발생</td><td>샤딩 (sharding), 파티셔닝 (partitioning) 도입</td></tr></tbody></table><hr><h2 id=21-기타-사항>21. 기타 사항<a hidden class=anchor aria-hidden=true href=#21-기타-사항>#</a></h2><h3 id=트랜잭션-vs-비동기-메시지-기반-처리-비교-표>트랜잭션 Vs 비동기 메시지 기반 처리 비교 (표)<a hidden class=anchor aria-hidden=true href=#트랜잭션-vs-비동기-메시지-기반-처리-비교-표>#</a></h3><table><thead><tr><th>기준</th><th>트랜잭션 기반 처리</th><th>비동기 메시지 처리</th></tr></thead><tbody><tr><td>일관성</td><td>강한 정합성 보장 (ACID)</td><td>Eventually Consistent</td></tr><tr><td>성능</td><td>TPS 제한 가능성 있음</td><td>고성능 처리 가능</td></tr><tr><td>장애 복구</td><td>로그 기반 재처리 지원</td><td>메시지 재시도 가능</td></tr><tr><td>구현 복잡도</td><td>상대적으로 단순</td><td>메시지 큐, 보상 로직 필요</td></tr><tr><td>사용 사례</td><td>금융, 재고, 주문 처리 등</td><td>이벤트 전파, 분산 처리 등</td></tr></tbody></table><hr><h2 id=22-주제와-관련하여-주목할-내용>22. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#22-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션 모델</td><td>ACID</td><td>Durability</td><td>장애 후에도 데이터 일관성 유지</td></tr><tr><td>동시성</td><td>격리 수준</td><td>Serializable</td><td>가장 강력한 데이터 정합성 보장</td></tr><tr><td>장애 복구</td><td>WAL</td><td>Write-Ahead Logging</td><td>장애 복구 시점 제어의 핵심 메커니즘</td></tr><tr><td>분산 처리</td><td>2PC</td><td>Two-Phase Commit</td><td>분산 트랜잭션의 표준 처리 방식</td></tr><tr><td>대체 전략</td><td>Saga</td><td>보상 트랜잭션 기반 분산처리</td><td>롱 트랜잭션 없이 확장성 확보 가능</td></tr></tbody></table><hr><h2 id=23-반드시-학습해야-할-내용>23. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#23-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본 이론</td><td>트랜잭션 모델</td><td>ACID</td><td>트랜잭션의 4 대 핵심 속성</td></tr><tr><td>동시성 제어</td><td>MVCC / 2PL</td><td>격리 수준 설정</td><td>동시성 문제를 방지하는 제어 기술</td></tr><tr><td>분산 환경</td><td>2PC, 3PC, Saga</td><td>커밋/보상 전략</td><td>글로벌 트랜잭션 구현을 위한 기술</td></tr><tr><td>복구 전략</td><td>로그 기반 복구</td><td>Undo/Redo Logging</td><td>장애 대응 및 무결성 확보</td></tr><tr><td>프레임워크</td><td>JTA, Atomikos</td><td>트랜잭션 API</td><td>분산 트랜잭션 관리용 표준 프레임워크</td></tr></tbody></table><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션 이론</td><td>Atomicity</td><td>트랜잭션의 원자성: 모두 또는 전무 수행 원칙</td></tr><tr><td>트랜잭션 이론</td><td>Isolation</td><td>서로 다른 트랜잭션 간 간섭 차단</td></tr><tr><td>트랜잭션 이론</td><td>Durability</td><td>커밋된 변경은 장애에도 유지</td></tr><tr><td>동시성 제어</td><td>MVCC</td><td>버전 기반 동시성 처리 기법</td></tr><tr><td>동시성 제어</td><td>2PL</td><td>잠금 기반 격리 전략 (2 단계 잠금 프로토콜)</td></tr><tr><td>장애 복구</td><td>WAL</td><td>로그 우선 기록, 장애 시 롤백/재실행 가능</td></tr><tr><td>분산 처리</td><td>2PC</td><td>전역 커밋 여부 협의 프로토콜</td></tr><tr><td>대체 전략</td><td>Saga</td><td>각 작업의 보상 트랜잭션을 통한 분산 제어</td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/ACID>ACID Transactions - Wikipedia</a></li><li><a href=https://www.postgresql.org/docs/current/transaction-iso.html>Isolation Levels - PostgreSQL Docs</a></li><li><a href=https://www.geeksforgeeks.org/dbms-concurrency-control/>Concurrency Control in DBMS - GeeksforGeeks</a></li><li><a href=https://wiki.postgresql.org/wiki/Write-Ahead_Logging>Write-Ahead Logging - PostgreSQL Wiki</a></li><li><a href=https://www.mongodb.com/basics/acid-transactions>MongoDB ACID Transactions</a></li><li><a href=https://microservices.io/patterns/data/saga.html>Saga Pattern - microservices.io</a></li><li><a href=https://docs.oracle.com/cd/B19306_01/server.102/b14220/distrib.htm>2PC and Distributed Transactions - Oracle Docs</a></li></ul><hr><p>이어서 <strong>Transactions</strong> 주제의 마무리 정리 및 보완 내용을 중심으로 작성합니다.</p><hr><h2 id=24-기타-사항-추가로-알아야-할-필수-개념-및-기술>24. 기타 사항 (추가로 알아야 할 필수 개념 및 기술)<a hidden class=anchor aria-hidden=true href=#24-기타-사항-추가로-알아야-할-필수-개념-및-기술>#</a></h2><h3 id=1-트랜잭션과-트랜잭션-로그의-차이>1) 트랜잭션과 트랜잭션 로그의 차이<a hidden class=anchor aria-hidden=true href=#1-트랜잭션과-트랜잭션-로그의-차이>#</a></h3><ul><li><strong>트랜잭션</strong>: DB 의 상태를 바꾸는 작업 집합</li><li><strong>트랜잭션 로그 (WAL)</strong>: DB 에 실제 반영 전에 수행 작업을 기록하여 복구 시 활용</li><li>⇒ 트랜잭션이 실행한 작업을 영속화하고, 복구 및 재처리의 기준점이 되는 핵심 기술</li></ul><hr><h3 id=2-트랜잭션-관점에서의-query-best-practices>2) 트랜잭션 관점에서의 Query Best Practices<a hidden class=anchor aria-hidden=true href=#2-트랜잭션-관점에서의-query-best-practices>#</a></h3><table><thead><tr><th>분류</th><th>Best Practice</th><th>설명</th></tr></thead><tbody><tr><td>SELECT</td><td>FOR UPDATE 최소화</td><td>불필요한 잠금 방지, 교착 상태 위험 감소</td></tr><tr><td>INSERT/UPDATE</td><td>WHERE 정확성 확보</td><td>인덱스를 활용한 타겟 최소화</td></tr><tr><td>DELETE</td><td>LIMIT 및 배치</td><td>대량 삭제 시 소규모로 나눠 처리, 롤백 부담 경감</td></tr><tr><td>전체</td><td>트랜잭션 내 로직 최소화</td><td>외부 호출 (HTTP 등) 을 트랜잭션 외부로 분리</td></tr></tbody></table><hr><h3 id=3-트랜잭션과-인프라스트럭처-연계-고려사항>3) 트랜잭션과 인프라스트럭처 연계 고려사항<a hidden class=anchor aria-hidden=true href=#3-트랜잭션과-인프라스트럭처-연계-고려사항>#</a></h3><table><thead><tr><th>영역</th><th>연계 고려 요소</th><th>설명</th></tr></thead><tbody><tr><td>컨테이너 환경</td><td>트랜잭션 유지</td><td>Kubernetes 에서 롤백 고려, Init container 실패 시 유의</td></tr><tr><td>CI/CD</td><td>트랜잭션 보존 여부</td><td>배포 중단 시 미완료 트랜잭션 롤백 상태 확인 필요</td></tr><tr><td>클라우드 환경</td><td>Managed DB 와 WAL</td><td>GCP Cloud SQL, AWS RDS 에서 WAL 접근 제한에 따른 제약 존재</td></tr></tbody></table><hr><h3 id=4-트랜잭션과-보안>4) 트랜잭션과 보안<a hidden class=anchor aria-hidden=true href=#4-트랜잭션과-보안>#</a></h3><ul><li>트랜잭션 자체는 보안 기능을 제공하지 않지만, <strong>접근 제어 및 무결성 보장</strong>과 직접 연관됨</li><li><strong>보안 로그</strong>와 <strong>트랜잭션 로그</strong>는 병행 저장되어야 감사를 위한 추적 가능성 확보</li><li><strong>TAM (Transaction Access Monitor)</strong> 구축 시 내부자 위변조 감지 가능</li></ul><hr><h3 id=5-트랜잭션-테스트-기법>5) 트랜잭션 테스트 기법<a hidden class=anchor aria-hidden=true href=#5-트랜잭션-테스트-기법>#</a></h3><table><thead><tr><th>기법</th><th>설명</th></tr></thead><tbody><tr><td>Rollback Test</td><td>실패 상황 가정 후 트랜잭션이 정확히 원복되는지 검증</td></tr><tr><td>Concurrency Test</td><td>여러 트랜잭션 간 동시 실행 시 정합성 유지 여부 확인</td></tr><tr><td>Commit Consistency</td><td>커밋된 데이터만 조회되는지, 읽기 일관성 보장 확인</td></tr><tr><td>Fault Injection</td><td>장애 발생 시 트랜잭션 로그 복구 및 commit/rollback 확인</td></tr></tbody></table><hr><h2 id=25-연계-기술-정리>25. 연계 기술 정리<a hidden class=anchor aria-hidden=true href=#25-연계-기술-정리>#</a></h2><table><thead><tr><th>연계 기술</th><th>역할</th><th>트랜잭션과의 관계</th></tr></thead><tbody><tr><td>Kafka (with Idempotency)</td><td>메시지 기반 처리</td><td>Exactly-once 보장을 위한 트랜잭션 API</td></tr><tr><td>Redis (with Lua Script)</td><td>트랜잭션 유사 실행</td><td>MULTI/EXEC 블록, atomic 블록 실행</td></tr><tr><td>gRPC / REST</td><td>API 호출 경계</td><td>트랜잭션 범위 내 외부 호출 시 장애 발생 가능성 있음</td></tr><tr><td>Saga Pattern</td><td>분산 트랜잭션 대체</td><td>트랜잭션을 보상 트랜잭션으로 쪼개 비동기 처리</td></tr><tr><td>Debezium / CDC</td><td>변경 감지</td><td>커밋된 데이터의 변경 이력을 외부로 실시간 추출</td></tr></tbody></table><hr><h2 id=26-마무리-요약>26. 마무리 요약<a hidden class=anchor aria-hidden=true href=#26-마무리-요약>#</a></h2><p>트랜잭션은 단일 또는 복수의 데이터 조작 연산을 하나의 <strong>원자적 실행 단위</strong>로 묶어, 장애와 동시성 문제에서도 데이터의 일관성을 유지하기 위한 핵심 기술입니다.<br>ACID 원칙을 기반으로 하며, 각 RDBMS 와 NoSQL 환경에서도 다양한 방식으로 구현됩니다.<br>실무에서는 격리 수준 조절, WAL 활용, 분산 트랜잭션 관리, 그리고 보상 트랜잭션 등의 전략을 복합적으로 활용해야 하며, 단일 노드 트랜잭션에서 분산 환경까지 확장된 전반적인 이해가 필요합니다.</p><hr><h2 id=다음으로-추천되는-학습-주제>다음으로 추천되는 학습 주제<a hidden class=anchor aria-hidden=true href=#다음으로-추천되는-학습-주제>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Concurrency</td><td>MVCC 상세</td><td>Snapshot 기반 버전 읽기</td><td>PostgreSQL, MySQL InnoDB, Oracle 등에서 차이 존재</td></tr><tr><td>Distributed Systems</td><td>2PC vs Saga</td><td>분산 커밋 대안 비교</td><td>전역 원자성 vs 보상 트랜잭션 모델</td></tr><tr><td>DB Internals</td><td>WAL 구조</td><td>Write-ahead logging 내부</td><td>기록 순서, checkpoint, redo log 동작 방식</td></tr><tr><td>Monitoring</td><td>트랜잭션 추적</td><td>APM 연계 및 성능 추적</td><td>트랜잭션 슬로우 로그, deadlock 감지 등</td></tr><tr><td>API Design</td><td>트랜잭션 범위 제한</td><td>외부 API 호출 시 경계 설정</td><td>DB 연결/처리 사이클 분리 설계 필요</td></tr></tbody></table><hr><p>이제 요청하신 <strong>MVCC 기반 상세 트랜잭션 흐름</strong>, <strong>2PC vs 3PC vs Saga 동작 시나리오</strong>, <strong>분산 트랜잭션</strong>에 대한 심화 내용을 정리해드립니다.</p><hr><h2 id=-1-mvcc-기반-상세-트랜잭션-흐름>📌 1. MVCC 기반 상세 트랜잭션 흐름<a hidden class=anchor aria-hidden=true href=#-1-mvcc-기반-상세-트랜잭션-흐름>#</a></h2><h3 id=핵심-흐름>핵심 흐름<a hidden class=anchor aria-hidden=true href=#핵심-흐름>#</a></h3><ol><li><p><strong>트랜잭션 시작</strong> → 고유 XID 할당 → <strong>스냅샷 (snapshot)</strong> 캡처 (<a href="https://en.wikipedia.org/wiki/ACID?utm_source=chatgpt.com" title=ACID>Medium</a>)</p></li><li><p><strong>읽기 (Read)</strong> → 스냅샷 타임스탬프 ≤ 레코드 <code>xmin/xmax</code> 조건에 맞는 버전 조회</p></li><li><p><strong>쓰기 (Update/Delete/Insert)</strong></p><ul><li>Update/Delete: 새로운 버전 생성, 이전 버전 유지 (<code>xmax</code> 설정)</li><li>Insert: 새 튜플 <code>xmin = XID</code>, <code>xmax = ∞</code> (<a href="https://en.wikipedia.org/wiki/Durability_%28database_systems%29?utm_source=chatgpt.com" title="Durability (database systems)">Vlad Mihalcea</a>, <a href="https://en.wikipedia.org/wiki/Isolation_%28database_systems%29?utm_source=chatgpt.com" title="Isolation (database systems)">devcenter.heroku.com</a>)</li></ul></li><li><p><strong>커밋 시점</strong></p><ul><li>XID 는 고정, 새로운 버전이 활성화됨</li><li>다른 트랜잭션도 이후 커밋된 버전부터 읽기 시작</li></ul></li><li><p><strong>빈 버전 정리</strong></p><ul><li><code>VACUUM</code> 또는 GC 가 불필요 버전 제거</li><li>스토리지 누수 방지 (<a href="https://tru-dasc.github.io/DASC_5410_students/lectures/lecture8.html?utm_source=chatgpt.com" title="Lecture 8: Transactions ACID in SQL—DASC 5410 - Data and Database …">위키백과</a>)</li></ul></li></ol><h3 id=다이어그램-흐름>다이어그램 흐름<a hidden class=anchor aria-hidden=true href=#다이어그램-흐름>#</a></h3><pre class=mermaid>sequenceDiagram
  participant T1 as 트랜잭션 T1
  participant T2 as 트랜잭션 T2
  participant DB as Database
  T1-&gt;&gt;DB: BEGIN (XID=100)
  T2-&gt;&gt;DB: BEGIN (XID=101)
  T1-&gt;&gt;DB: UPDATE A -&gt; new version xmin=100
  T2-&gt;&gt;DB: SELECT A -&gt; snapshot sees old version (xmin &lt; 101 &lt; xmax)
  T1-&gt;&gt;DB: COMMIT
  T2-&gt;&gt;DB: UPDATE A -&gt; new version xmin=101
</pre><p>이 흐름은 독립적인 스냅샷으로 인해 <strong>읽기와 쓰기 간 비차단</strong>을 보장하며, 정상적으로 스냅샷 격리 정보를 유지합니다.</p><hr><h2 id=-2-분산-트랜잭션-프로토콜-비교-및-동작-시나리오>🔗 2. 분산 트랜잭션 프로토콜 비교 및 동작 시나리오<a hidden class=anchor aria-hidden=true href=#-2-분산-트랜잭션-프로토콜-비교-및-동작-시나리오>#</a></h2><h3 id=21-two-phase-commit-2pc>2.1 Two-Phase Commit (2PC)<a hidden class=anchor aria-hidden=true href=#21-two-phase-commit-2pc>#</a></h3><ul><li>**1 단계: Prepare (투표 요청)**<br>코디네이터 → 모든 참가자에게 &ldquo;Prepare?&rdquo;<br>참가자: 로컬 트랜잭션 준비 후 Yes/No 응답 (<a href="https://www.geeksforgeeks.org/dbms/acid-properties-in-dbms/?utm_source=chatgpt.com" title="ACID Properties in DBMS - GeeksforGeeks">위키백과</a>, <a href="https://hevodata.com/learn/mongodb-acid-transactions/?utm_source=chatgpt.com" title="MongoDB ACID Transactions: Multi-Document Transactions Simplified 101">위키백과</a>)</li><li><strong>2 단계: Commit/Abort</strong><ul><li>All Yes → Commit 명령, 각 참가자 커밋 후 ACK</li><li>Any No → Abort 명령, 각 참가자 롤백</li></ul></li></ul><p><strong>특징</strong>: 원자성 보장, 단일 코디네이터 기반, 장애 시 블로킹 가능 (<a href="https://www.geeksforgeeks.org/dbms/acid-properties-in-dbms/?utm_source=chatgpt.com" title="ACID Properties in DBMS - GeeksforGeeks">위키백과</a>, <a href="https://www.mongodb.com/basics/acid-transactions?utm_source=chatgpt.com" title="ACID Properties In DBMS Explained | MongoDB | MongoDB">위키백과</a>)</p><h3 id=22-three-phase-commit-3pc>2.2 Three-Phase Commit (3PC)<a hidden class=anchor aria-hidden=true href=#22-three-phase-commit-3pc>#</a></h3><ul><li><strong>준비 단계</strong>: Prepare</li><li><strong>사전 커밋 단계</strong>: Pre-Commit—참가자가 준비 완료 확인</li><li><strong>최종 커밋 단계</strong>: Commit</li></ul><p><strong>개선점</strong>: 코디네이터 장애 시에도 참가자가 사전 커밋 상태를 인식하여 시스템 블로킹 완화 (<a href="https://dev.mysql.com/doc/refman/en/innodb-transaction-isolation-levels.html?utm_source=chatgpt.com" title="MySQL 8.4 Reference Manual:: 17.7.2.1 Transaction Isolation Levels">위키백과</a>)<br><strong>단점</strong>: 추가 메시지 및 타임아웃 복잡도 증가, 가정 한정적</p><h3 id=23-saga-패턴>2.3 Saga 패턴<a hidden class=anchor aria-hidden=true href=#23-saga-패턴>#</a></h3><ul><li><strong>Orchestration (중앙 조정)</strong><br>각 마이크로서비스 별 로컬 트랜잭션 수행 → 실패 시 보상 트랜잭션 실행 (<a href="https://www.databricks.com/glossary/acid-transactions?utm_source=chatgpt.com" title="ACID Transactions in Databases - Databricks">LinkedIn</a>)</li><li><strong>Choreography (이벤트 방식)</strong><br>서비스 간 이벤트 연쇄 방식, 보상 및 흐름 분산 처리</li></ul><p><strong>장점</strong>: 속도, 확장성, 장애 내성 좋음<br><strong>단점</strong>: 보상 로직 복잡, 일관성 보장 어려움 (<a href="https://www.databricks.com/glossary/acid-transactions?utm_source=chatgpt.com" title="ACID Transactions in Databases - Databricks">LinkedIn</a>)</p><h3 id=비교-표>비교 표<a hidden class=anchor aria-hidden=true href=#비교-표>#</a></h3><table><thead><tr><th>특성</th><th>2PC</th><th>3PC</th><th>Saga</th></tr></thead><tbody><tr><td>일관성</td><td>강한 (원자성)</td><td>강함, 블로킹 완화</td><td>Eventually Consistent (사후 보상)</td></tr><tr><td>블로킹 가능성</td><td>높음</td><td>중간 (타임아웃 처리 가능)</td><td>낮음 (비동기 처리)</td></tr><tr><td>장애 시 완화</td><td>manual intervention 필요</td><td>타임아웃 기반 복구 가능</td><td>보상 트랜잭션으로 자동 회복</td></tr><tr><td>구현 복잡도</td><td>중간</td><td>높음</td><td>매우 높음 (각 단계별 보상 설계 필요)</td></tr><tr><td>메시지 오버헤드</td><td>2 라운드</td><td>3 라운드</td><td>이벤트/명시적 호출 필요</td></tr></tbody></table><hr><h2 id=-3-분산-트랜잭션-개요-distributed-transactions>🌐 3. 분산 트랜잭션 개요 (Distributed Transactions)<a hidden class=anchor aria-hidden=true href=#-3-분산-트랜잭션-개요-distributed-transactions>#</a></h2><ul><li><strong>목적</strong>: 여러 독립 시스템 간 원자적 데이터 변경 보장</li><li><strong>핵심 구성 요소</strong>:<ul><li><strong>코디네이터 (Transaction Manager)</strong></li><li><strong>참가자 (Participants)</strong></li><li><strong>Committed / Rolled-back 상태 기록 (로그 기반)</strong></li><li><strong>타임아웃/복구/보상 메커니즘</strong></li></ul></li><li><strong>프로토콜 선택 기준</strong>:<ul><li>원자성 필요 시 → 2PC/3PC, 확장성 초점 시 → Saga, 메시징 시스템 통합 시 → Kafka 트랜잭션 등</li></ul></li></ul><hr><h2 id=-요약>✅ 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h2><ul><li><strong>MVCC</strong>는 읽기와 쓰기 충돌을 최소화하여 고성능 동시성을 제공하며, PostgreSQL, MySQL 등에서 널리 채택됨 (<a href="https://www.cockroachlabs.com/blog/sql-isolation-levels-explained/?utm_source=chatgpt.com" title="Everything you always wanted to know about SQL isolation levels …">GeeksforGeeks</a>, <a href="https://en.wikipedia.org/wiki/Durability_%28database_systems%29?utm_source=chatgpt.com" title="Durability (database systems)">Vlad Mihalcea</a>, <a href="https://en.wikipedia.org/wiki/ACID?utm_source=chatgpt.com" title=ACID>Medium</a>, <a href="https://www.postgresql.org/docs/current/transaction-iso.html?utm_source=chatgpt.com" title="Documentation: 17: 13.2. Transaction Isolation - PostgreSQL">betterengineers.substack.com</a>, <a href="https://www.databricks.com/glossary/acid-transactions?utm_source=chatgpt.com" title="ACID Transactions in Databases - Databricks">LinkedIn</a>)</li><li><strong>2PC</strong>는 분산 원자성을 보장하지만, 블로킹과 장애 복잡성이 존재</li><li><strong>3PC</strong>는 2PC 단점을 일부 보완하나, 구현 부담이 커 현실에서는 잘 사용되지 않음</li><li><strong>Saga</strong>는 확장성과 내성 면에서 우수하지만, 보상 트랜잭션 설계의 복잡도 존재</li></ul><hr><p>더 구체적인 코드 시나리오, 아키텍처 설계, 도구 연동 (Apache Kafka, Debezium 등) 관련 설명도 필요하시면 알려주세요!</p><h2 id=트랜잭션-transactions-심화-분석>트랜잭션 (Transactions) 심화 분석<a hidden class=anchor aria-hidden=true href=#트랜잭션-transactions-심화-분석>#</a></h2><h3 id=1-태그-및-분류-검증>1. 태그 및 분류 검증<a hidden class=anchor aria-hidden=true href=#1-태그-및-분류-검증>#</a></h3><p><strong>주제 태그</strong>: <code>Database-Transactions</code>, <code>ACID-Properties</code>, <code>Concurrency-Control</code>, <code>Data-Consistency</code></p><p><strong>분류 구조 검증</strong>: &ldquo;Systems and Infrastructure > Database Systems&rdquo;<br>현재 분류가 적절합니다. 트랜잭션은 데이터베이스 시스템의 핵심 구성 요소로서 데이터 무결성과 일관성을 보장하는 시스템 레벨의 메커니즘이므로 해당 분류에 정확히 위치합니다.</p><h3 id=2-주제-요약-및-개요>2. 주제 요약 및 개요<a hidden class=anchor aria-hidden=true href=#2-주제-요약-및-개요>#</a></h3><p><strong>주제 요약 (200 자)</strong>:<br>트랜잭션은 데이터베이스 시스템에서 논리적 작업 단위로, ACID 속성을 통해 데이터 무결성과 일관성을 보장하는 핵심 메커니즘입니다. 동시성 제어, 장애 복구, 격리 수준 관리를 통해 안정적인 데이터 처리를 가능하게 합니다.</p><p><strong>전체 개요 (250 자)</strong>:<br>데이터베이스 트랜잭션은 하나 이상의 연산들을 논리적으로 묶어 원자성 (Atomicity), 일관성 (Consistency), 격리성 (Isolation), 지속성 (Durability) 을 보장하는 시스템입니다. 락 기반 제어, 타임스탬프 기반 제어 등 다양한 동시성 제어 기법을 통해 멀티유저 환경에서 안전한 데이터 접근을 제공합니다.</p><hr><h3 id=3-핵심-개념>3. 핵심 개념<a hidden class=anchor aria-hidden=true href=#3-핵심-개념>#</a></h3><h4 id=31-기본-개념>3.1 기본 개념<a hidden class=anchor aria-hidden=true href=#31-기본-개념>#</a></h4><p><strong>트랜잭션 (Transaction)</strong>: 데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 논리적 단위로, 분할할 수 없는 최소 작업 단위입니다.</p><p><strong>ACID 속성</strong>:</p><ul><li><strong>원자성 (Atomicity)</strong>: 트랜잭션 내 모든 연산이 성공하거나 모두 실패해야 함</li><li><strong>일관성 (Consistency)</strong>: 트랜잭션 실행 전후 데이터베이스가 일관된 상태를 유지</li><li><strong>격리성 (Isolation)</strong>: 동시 실행되는 트랜잭션들이 서로 영향을 주지 않음</li><li><strong>지속성 (Durability)</strong>: 성공적으로 완료된 트랜잭션의 결과가 영구적으로 저장됨</li></ul><h4 id=32-실무-구현-관련-핵심-개념>3.2 실무 구현 관련 핵심 개념<a hidden class=anchor aria-hidden=true href=#32-실무-구현-관련-핵심-개념>#</a></h4><p><strong>동시성 제어 (Concurrency Control)</strong>: 여러 트랜잭션이 동시에 실행될 때 데이터 일관성을 유지하는 메커니즘</p><p><strong>격리 수준 (Isolation Levels)</strong>:</p><ul><li>READ UNCOMMITTED: 커밋되지 않은 데이터 읽기 가능</li><li>READ COMMITTED: 커밋된 데이터만 읽기 가능</li><li>REPEATABLE READ: 동일 트랜잭션 내 반복 읽기 결과 동일</li><li>SERIALIZABLE: 가장 높은 격리 수준, 직렬 실행과 동일</li></ul><p><strong>로킹 (Locking)</strong>: 데이터 접근을 제어하여 동시성 문제를 해결하는 기법</p><p><strong>데드락 (Deadlock)</strong>: 두 개 이상의 트랜잭션이 서로 점유한 자원을 기다리며 무한 대기하는 상황</p><hr><h3 id=4-배경-및-목적>4. 배경 및 목적<a hidden class=anchor aria-hidden=true href=#4-배경-및-목적>#</a></h3><h4 id=41-배경>4.1 배경<a hidden class=anchor aria-hidden=true href=#41-배경>#</a></h4><p>데이터베이스 시스템이 다중 사용자 환경에서 운영되면서 데이터 무결성과 일관성 보장의 필요성이 대두되었습니다. 특히 은행 시스템과 같은 중요한 애플리케이션에서 데이터 신뢰성이 핵심 요구사항이 되었습니다.</p><h4 id=42-목적-및-필요성>4.2 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#42-목적-및-필요성>#</a></h4><ul><li><strong>데이터 무결성 보장</strong>: 잘못된 데이터 입력이나 시스템 오류로부터 데이터 보호</li><li><strong>동시성 제어</strong>: 여러 사용자가 동시에 데이터에 접근할 때 충돌 방지</li><li><strong>장애 복구</strong>: 시스템 장애 발생 시 데이터 일관성 유지</li><li><strong>격리성 보장</strong>: 트랜잭션 간 간섭 없는 독립적 실행</li></ul><hr><h3 id=5-주요-기능-및-역할-1>5. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#5-주요-기능-및-역할-1>#</a></h3><h4 id=51-주요-기능>5.1 주요 기능<a hidden class=anchor aria-hidden=true href=#51-주요-기능>#</a></h4><ul><li><strong>데이터 변경 관리</strong>: INSERT, UPDATE, DELETE 연산의 논리적 그룹화</li><li><strong>롤백 (Rollback)</strong>: 오류 발생 시 이전 상태로 복원</li><li><strong>커밋 (Commit)</strong>: 변경사항을 영구적으로 데이터베이스에 반영</li><li><strong>체크포인트 (Checkpoint)</strong>: 복구를 위한 일관된 상태 저장점 생성</li></ul><h4 id=52-역할>5.2 역할<a hidden class=anchor aria-hidden=true href=#52-역할>#</a></h4><ul><li>데이터베이스 상태의 일관성 유지</li><li>동시 접근 환경에서의 충돌 해결</li><li>시스템 장애 시 데이터 복구 지원</li><li>비즈니스 로직의 논리적 단위 구현</li></ul><hr><h3 id=6-특징-및-핵심-원칙>6. 특징 및 핵심 원칙<a hidden class=anchor aria-hidden=true href=#6-특징-및-핵심-원칙>#</a></h3><h4 id=61-특징>6.1 특징<a hidden class=anchor aria-hidden=true href=#61-특징>#</a></h4><ul><li><strong>원자성</strong>: 전부 성공 또는 전부 실패</li><li><strong>독립성</strong>: 다른 트랜잭션과 독립적 실행</li><li><strong>영속성</strong>: 성공한 변경사항의 영구 보존</li><li><strong>일관성</strong>: 무결성 제약조건 준수</li></ul><h4 id=62-핵심-원칙>6.2 핵심 원칙<a hidden class=anchor aria-hidden=true href=#62-핵심-원칙>#</a></h4><ul><li><strong>All or Nothing</strong>: 부분적 실행 불허</li><li><strong>Isolation</strong>: 트랜잭션 간 격리</li><li><strong>Consistency</strong>: 데이터베이스 제약조건 유지</li><li><strong>Durability</strong>: 영구적 저장</li></ul><hr><h3 id=7-작동-원리-및-방식>7. 작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#7-작동-원리-및-방식>#</a></h3><h4 id=71-트랜잭션-생명주기>7.1 트랜잭션 생명주기<a hidden class=anchor aria-hidden=true href=#71-트랜잭션-생명주기>#</a></h4><pre class=mermaid>stateDiagram-v2
    [*] --&gt; Active: BEGIN
    Active --&gt; PartiallyCommitted: COMMIT 요청
    Active --&gt; Failed: 오류 발생
    PartiallyCommitted --&gt; Committed: 커밋 완료
    PartiallyCommitted --&gt; Failed: 커밋 실패
    Failed --&gt; Aborted: ROLLBACK
    Committed --&gt; [*]
    Aborted --&gt; [*]
</pre><h4 id=72-acid-보장-메커니즘>7.2 ACID 보장 메커니즘<a hidden class=anchor aria-hidden=true href=#72-acid-보장-메커니즘>#</a></h4><pre class=mermaid>graph TD
    A[트랜잭션 시작] --&gt; B[원자성 보장]
    B --&gt; C[일관성 검증]
    C --&gt; D[격리성 적용]
    D --&gt; E[지속성 확보]
    E --&gt; F[트랜잭션 완료]
    
    B --&gt; G[로그 기록]
    C --&gt; H[제약조건 검사]
    D --&gt; I[락 메커니즘]
    E --&gt; J[디스크 저장]
</pre><p>트랜잭션은 시작부터 완료까지 엄격한 상태 관리를 통해 ACID 속성을 보장합니다. 각 단계에서 로그 기록, 제약조건 검사, 락 적용, 영구 저장 등의 메커니즘이 동작합니다.</p><hr><h3 id=8-구조-및-아키텍처>8. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#8-구조-및-아키텍처>#</a></h3><h4 id=81-트랜잭션-관리-아키텍처>8.1 트랜잭션 관리 아키텍처<a hidden class=anchor aria-hidden=true href=#81-트랜잭션-관리-아키텍처>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;애플리케이션 계층&#34;
        App[애플리케이션]
    end
    
    subgraph &#34;트랜잭션 관리 계층&#34;
        TM[트랜잭션 매니저]
        CC[동시성 제어자]
        LM[락 매니저]
        RM[복구 매니저]
    end
    
    subgraph &#34;저장소 계층&#34;
        BM[버퍼 매니저]
        SM[저장소 매니저]
        LB[로그 버퍼]
        DB[데이터베이스]
    end
    
    App --&gt; TM
    TM --&gt; CC
    TM --&gt; LM
    TM --&gt; RM
    CC --&gt; BM
    LM --&gt; BM
    RM --&gt; LB
    BM --&gt; SM
    SM --&gt; DB
    LB --&gt; DB
</pre><h4 id=82-필수-구성요소>8.2 필수 구성요소<a hidden class=anchor aria-hidden=true href=#82-필수-구성요소>#</a></h4><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td>트랜잭션 매니저</td><td>트랜잭션 생명주기 관리</td><td>BEGIN, COMMIT, ROLLBACK 처리</td></tr><tr><td>동시성 제어자</td><td>동시 실행 제어</td><td>격리성 보장, 스케줄링</td></tr><tr><td>락 매니저</td><td>자원 접근 제어</td><td>락 획득/해제, 데드락 탐지</td></tr><tr><td>복구 매니저</td><td>장애 복구</td><td>로그 관리, 롤백/복구 수행</td></tr><tr><td>버퍼 매니저</td><td>메모리 관리</td><td>페이지 캐싱, 더티 페이지 관리</td></tr></tbody></table><h4 id=83-선택-구성요소>8.3 선택 구성요소<a hidden class=anchor aria-hidden=true href=#83-선택-구성요소>#</a></h4><table><thead><tr><th>구성요소</th><th>기능</th><th>특징</th></tr></thead><tbody><tr><td>체크포인트 매니저</td><td>복구 지점 관리</td><td>성능 최적화, 복구 시간 단축</td></tr><tr><td>분산 트랜잭션 코디네이터</td><td>분산 환경 지원</td><td>2PC, 3PC 프로토콜 구현</td></tr><tr><td>성능 모니터</td><td>성능 감시</td><td>트랜잭션 통계, 병목점 분석</td></tr></tbody></table><hr><h3 id=9-구현-기법>9. 구현 기법<a hidden class=anchor aria-hidden=true href=#9-구현-기법>#</a></h3><h4 id=91-락-기반-동시성-제어>9.1 락 기반 동시성 제어<a hidden class=anchor aria-hidden=true href=#91-락-기반-동시성-제어>#</a></h4><p><strong>정의</strong>: 데이터 항목에 락을 설정하여 동시 접근을 제어하는 기법</p><p><strong>구성</strong>:</p><ul><li>공유 락 (Shared Lock): 읽기 전용 접근</li><li>배타 락 (Exclusive Lock): 읽기/쓰기 독점 접근</li><li>의도 락 (Intent Lock): 하위 레벨 락 설정 의도 표시</li></ul><p><strong>목적</strong>: 데이터 일관성 보장, 동시성 제어</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 은행 계좌 이체 시나리오</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transfer_money</span><span class=p>(</span><span class=n>from_account</span><span class=p>,</span> <span class=n>to_account</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 계좌 순서대로 락 획득 (데드락 방지)</span>
</span></span><span class=line><span class=cl>    <span class=n>accounts</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>([</span><span class=n>from_account</span><span class=p>,</span> <span class=n>to_account</span><span class=p>],</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_locks</span><span class=p>(</span><span class=n>accounts</span><span class=p>,</span> <span class=n>EXCLUSIVE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>from_account</span><span class=o>.</span><span class=n>balance</span> <span class=o>&gt;=</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>from_account</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>            <span class=n>to_account</span><span class=o>.</span><span class=n>balance</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=92-타임스탬프-기반-제어>9.2 타임스탬프 기반 제어<a hidden class=anchor aria-hidden=true href=#92-타임스탬프-기반-제어>#</a></h4><p><strong>정의</strong>: 각 트랜잭션에 고유한 타임스탬프를 부여하여 실행 순서 결정</p><p><strong>구성</strong>:</p><ul><li>읽기 타임스탬프 (Read Timestamp)</li><li>쓰기 타임스탬프 (Write Timestamp)</li><li>트랜잭션 타임스탬프 (Transaction Timestamp)</li></ul><p><strong>목적</strong>: 데드락 없는 동시성 제어</p><h4 id=93-다버전-동시성-제어-mvcc>9.3 다버전 동시성 제어 (MVCC)<a hidden class=anchor aria-hidden=true href=#93-다버전-동시성-제어-mvcc>#</a></h4><p><strong>정의</strong>: 데이터의 여러 버전을 유지하여 읽기 - 쓰기 충돌 최소화</p><p><strong>구성</strong>:</p><ul><li>버전 체인</li><li>스냅샷 격리</li><li>가비지 컬렉션</li></ul><p><strong>목적</strong>: 읽기 성능 향상, 락 경합 감소</p><hr><h3 id=10-장점>10. 장점<a hidden class=anchor aria-hidden=true href=#10-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>데이터 무결성</td><td>ACID 속성을 통한 데이터 일관성과 신뢰성 보장</td></tr><tr><td>장점</td><td>장애 복구</td><td>로그 기반 복구 메커니즘으로 시스템 장애 시 데이터 복원</td></tr><tr><td>장점</td><td>동시성 지원</td><td>여러 사용자의 동시 접근을 안전하게 처리</td></tr><tr><td>장점</td><td>비즈니스 로직 지원</td><td>복잡한 비즈니스 규칙을 논리적 단위로 구현</td></tr><tr><td>장점</td><td>표준화</td><td>SQL 표준을 통한 일관된 인터페이스 제공</td></tr></tbody></table><hr><h3 id=11-단점과-문제점-그리고-해결방안>11. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#11-단점과-문제점-그리고-해결방안>#</a></h3><h4 id=111-단점>11.1 단점<a hidden class=anchor aria-hidden=true href=#111-단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>성능 오버헤드</td><td>락 관리와 로그 기록으로 인한 처리 지연</td><td>적절한 격리 수준 선택, 락 최소화</td></tr><tr><td>단점</td><td>데드락 위험</td><td>상호 대기로 인한 시스템 정지</td><td>데드락 탐지/해결 알고리즘 구현</td></tr><tr><td>단점</td><td>확장성 제한</td><td>중앙집중식 락 관리로 인한 병목</td><td>분산 락, 파티셔닝 적용</td></tr></tbody></table><h4 id=112-문제점>11.2 문제점<a hidden class=anchor aria-hidden=true href=#112-문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>데드락</td><td>순환 대기 조건</td><td>시스템 정지</td><td>대기 그래프 분석</td><td>락 순서 정렬</td><td>희생자 선택, 롤백</td></tr><tr><td>문제점</td><td>라이브락</td><td>지속적 충돌</td><td>무한 재시도</td><td>재시도 패턴 모니터링</td><td>백오프 전략</td><td>우선순위 부여</td></tr><tr><td>문제점</td><td>팬텀 리드</td><td>범위 락 부재</td><td>데이터 불일치</td><td>쿼리 결과 비교</td><td>범위 락 사용</td><td>직렬화 가능 격리</td></tr></tbody></table><hr><h3 id=12-도전-과제>12. 도전 과제<a hidden class=anchor aria-hidden=true href=#12-도전-과제>#</a></h3><h4 id=121-성능-최적화-과제>12.1 성능 최적화 과제<a hidden class=anchor aria-hidden=true href=#121-성능-최적화-과제>#</a></h4><p><strong>원인</strong>: 동시성 제어와 일관성 보장 간의 트레이드오프<br><strong>영향</strong>: 시스템 처리량 감소<br><strong>해결 방법</strong>: 적응적 격리 수준, 비관적/낙관적 락 혼합 사용</p><h4 id=122-분산-환경-과제>12.2 분산 환경 과제<a hidden class=anchor aria-hidden=true href=#122-분산-환경-과제>#</a></h4><p><strong>원인</strong>: 네트워크 지연과 부분 실패<br><strong>영향</strong>: 2PC 프로토콜의 블로킹 문제<br><strong>해결 방법</strong>: 3PC, Saga 패턴, 최종 일관성 모델 적용</p><h4 id=123-클라우드-네이티브-과제>12.3 클라우드 네이티브 과제<a hidden class=anchor aria-hidden=true href=#123-클라우드-네이티브-과제>#</a></h4><p><strong>원인</strong>: 마이크로서비스 아키텍처의 데이터 분산<br><strong>영향</strong>: 전역 트랜잭션 관리 복잡성<br><strong>해결 방법</strong>: 이벤트 소싱, CQRS 패턴 적용</p><hr><h3 id=13-분류-기준에-따른-종류-및-유형>13. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#13-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td>범위</td><td>로컬 트랜잭션</td><td>단일 데이터베이스 내 실행</td><td>일반적인 CRUD 연산</td></tr><tr><td>범위</td><td>분산 트랜잭션</td><td>다중 데이터베이스 간 실행</td><td>마이크로서비스 간 데이터 동기화</td></tr><tr><td>처리 방식</td><td>온라인 트랜잭션 (OLTP)</td><td>실시간 처리, 짧은 실행 시간</td><td>웹 애플리케이션, ERP 시스템</td></tr><tr><td>처리 방식</td><td>배치 트랜잭션</td><td>대량 데이터 처리, 긴 실행 시간</td><td>데이터 마이그레이션, 리포팅</td></tr><tr><td>제어 방식</td><td>명시적 트랜잭션</td><td>개발자가 직접 제어</td><td>복잡한 비즈니스 로직</td></tr><tr><td>제어 방식</td><td>암시적 트랜잭션</td><td>시스템이 자동 관리</td><td>단순한 단일 연산</td></tr></tbody></table><hr><h3 id=14-실무-사용-예시>14. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시>#</a></h3><table><thead><tr><th>사용 영역</th><th>목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td>전자상거래</td><td>주문 처리</td><td>결제 게이트웨이, 재고 관리</td><td>주문 - 결제 - 재고 일관성 보장</td></tr><tr><td>금융 시스템</td><td>계좌 이체</td><td>보안 모듈, 감사 로그</td><td>자금 무결성 보장</td></tr><tr><td>예약 시스템</td><td>좌석 예약</td><td>캐싱 시스템, 큐잉</td><td>동시 예약 충돌 방지</td></tr><tr><td>게임 서비스</td><td>아이템 거래</td><td>메시징 시스템, NoSQL</td><td>게임 경제 균형 유지</td></tr><tr><td>의료 시스템</td><td>환자 기록</td><td>암호화, 백업 시스템</td><td>의료 데이터 신뢰성 확보</td></tr></tbody></table><hr><h3 id=15-활용-사례-전자상거래-주문-처리-시스템>15. 활용 사례: 전자상거래 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#15-활용-사례-전자상거래-주문-처리-시스템>#</a></h3><h4 id=151-시스템-구성>15.1 시스템 구성<a hidden class=anchor aria-hidden=true href=#151-시스템-구성>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;클라이언트&#34;
        User[사용자]
        Web[웹 인터페이스]
    end
    
    subgraph &#34;애플리케이션 서버&#34;
        OrderService[주문 서비스]
        PaymentService[결제 서비스]
        InventoryService[재고 서비스]
    end
    
    subgraph &#34;데이터베이스&#34;
        OrderDB[(주문 DB)]
        PaymentDB[(결제 DB)]
        InventoryDB[(재고 DB)]
    end
    
    subgraph &#34;외부 시스템&#34;
        PaymentGateway[결제 게이트웨이]
        ShippingAPI[배송 API]
    end
    
    User --&gt; Web
    Web --&gt; OrderService
    OrderService --&gt; PaymentService
    OrderService --&gt; InventoryService
    
    OrderService --&gt; OrderDB
    PaymentService --&gt; PaymentDB
    InventoryService --&gt; InventoryDB
    
    PaymentService --&gt; PaymentGateway
    OrderService --&gt; ShippingAPI
</pre><h4 id=152-주문-처리-워크플로우>15.2 주문 처리 워크플로우<a hidden class=anchor aria-hidden=true href=#152-주문-처리-워크플로우>#</a></h4><pre class=mermaid>sequenceDiagram
    participant C as 고객
    participant O as 주문서비스
    participant P as 결제서비스
    participant I as 재고서비스
    participant DB as 데이터베이스
    
    C-&gt;&gt;O: 주문 요청
    O-&gt;&gt;DB: BEGIN TRANSACTION
    O-&gt;&gt;I: 재고 확인
    I-&gt;&gt;DB: SELECT FOR UPDATE (재고)
    DB--&gt;&gt;I: 재고 정보
    I--&gt;&gt;O: 재고 충분
    O-&gt;&gt;I: 재고 차감
    I-&gt;&gt;DB: UPDATE 재고
    O-&gt;&gt;P: 결제 요청
    P-&gt;&gt;DB: INSERT 결제 기록
    O-&gt;&gt;DB: INSERT 주문 기록
    O-&gt;&gt;DB: COMMIT
    DB--&gt;&gt;O: 커밋 완료
    O--&gt;&gt;C: 주문 완료
</pre><h4 id=153-트랜잭션의-역할>15.3 트랜잭션의 역할<a hidden class=anchor aria-hidden=true href=#153-트랜잭션의-역할>#</a></h4><ol><li><strong>원자성 보장</strong>: 재고 차감, 결제 처리, 주문 생성이 모두 성공하거나 모두 실패</li><li><strong>일관성 유지</strong>: 재고량과 주문량의 정확한 매칭</li><li><strong>격리성 적용</strong>: 동시 주문 요청 간 재고 충돌 방지</li><li><strong>지속성 확보</strong>: 성공한 주문의 영구적 보존</li></ol><h4 id=154-트랜잭션-적용-전후-차이점>15.4 트랜잭션 적용 전후 차이점<a hidden class=anchor aria-hidden=true href=#154-트랜잭션-적용-전후-차이점>#</a></h4><p><strong>적용 전</strong>:</p><ul><li>재고는 차감되었으나 결제 실패 시 재고 복구 누락</li><li>동시 주문으로 인한 초과 판매 발생</li><li>시스템 장애 시 데이터 불일치</li></ul><p><strong>적용 후</strong>:</p><ul><li>결제 실패 시 자동 롤백으로 재고 복구</li><li>락을 통한 동시 접근 제어로 정확한 재고 관리</li><li>장애 복구 시 일관된 상태 보장</li></ul><hr><h3 id=16-구현-예시>16. 구현 예시<a hidden class=anchor aria-hidden=true href=#16-구현-예시>#</a></h3><h4 id=161-python-구현-sqlalchemy-사용>16.1 Python 구현 (SQLAlchemy 사용)<a hidden class=anchor aria-hidden=true href=#161-python-구현-sqlalchemy-사용>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>  1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>  2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>  3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>  4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>  5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>  6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>  7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>  8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>  9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10> 10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11> 11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12> 12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13> 13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14> 14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15> 15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16> 16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17> 17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18> 18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19> 19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20> 20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21> 21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22> 22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23> 23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24> 24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25> 25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26> 26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27> 27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28> 28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29> 29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30> 30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31> 31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32> 32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33> 33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34> 34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35> 35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36> 36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37> 37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38> 38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39> 39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40> 40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41> 41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42> 42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43> 43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44> 44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45> 45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46> 46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47> 47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48> 48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49> 49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50> 50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51> 51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52> 52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53> 53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54> 54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55> 55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56> 56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57> 57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58> 58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59> 59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60> 60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61> 61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62> 62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63> 63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64> 64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65> 65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66> 66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67> 67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68> 68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69> 69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70> 70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71> 71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72> 72</a>
</span><span class=lnt id=hl-15-73><a class=lnlinks href=#hl-15-73> 73</a>
</span><span class=lnt id=hl-15-74><a class=lnlinks href=#hl-15-74> 74</a>
</span><span class=lnt id=hl-15-75><a class=lnlinks href=#hl-15-75> 75</a>
</span><span class=lnt id=hl-15-76><a class=lnlinks href=#hl-15-76> 76</a>
</span><span class=lnt id=hl-15-77><a class=lnlinks href=#hl-15-77> 77</a>
</span><span class=lnt id=hl-15-78><a class=lnlinks href=#hl-15-78> 78</a>
</span><span class=lnt id=hl-15-79><a class=lnlinks href=#hl-15-79> 79</a>
</span><span class=lnt id=hl-15-80><a class=lnlinks href=#hl-15-80> 80</a>
</span><span class=lnt id=hl-15-81><a class=lnlinks href=#hl-15-81> 81</a>
</span><span class=lnt id=hl-15-82><a class=lnlinks href=#hl-15-82> 82</a>
</span><span class=lnt id=hl-15-83><a class=lnlinks href=#hl-15-83> 83</a>
</span><span class=lnt id=hl-15-84><a class=lnlinks href=#hl-15-84> 84</a>
</span><span class=lnt id=hl-15-85><a class=lnlinks href=#hl-15-85> 85</a>
</span><span class=lnt id=hl-15-86><a class=lnlinks href=#hl-15-86> 86</a>
</span><span class=lnt id=hl-15-87><a class=lnlinks href=#hl-15-87> 87</a>
</span><span class=lnt id=hl-15-88><a class=lnlinks href=#hl-15-88> 88</a>
</span><span class=lnt id=hl-15-89><a class=lnlinks href=#hl-15-89> 89</a>
</span><span class=lnt id=hl-15-90><a class=lnlinks href=#hl-15-90> 90</a>
</span><span class=lnt id=hl-15-91><a class=lnlinks href=#hl-15-91> 91</a>
</span><span class=lnt id=hl-15-92><a class=lnlinks href=#hl-15-92> 92</a>
</span><span class=lnt id=hl-15-93><a class=lnlinks href=#hl-15-93> 93</a>
</span><span class=lnt id=hl-15-94><a class=lnlinks href=#hl-15-94> 94</a>
</span><span class=lnt id=hl-15-95><a class=lnlinks href=#hl-15-95> 95</a>
</span><span class=lnt id=hl-15-96><a class=lnlinks href=#hl-15-96> 96</a>
</span><span class=lnt id=hl-15-97><a class=lnlinks href=#hl-15-97> 97</a>
</span><span class=lnt id=hl-15-98><a class=lnlinks href=#hl-15-98> 98</a>
</span><span class=lnt id=hl-15-99><a class=lnlinks href=#hl-15-99> 99</a>
</span><span class=lnt id=hl-15-100><a class=lnlinks href=#hl-15-100>100</a>
</span><span class=lnt id=hl-15-101><a class=lnlinks href=#hl-15-101>101</a>
</span><span class=lnt id=hl-15-102><a class=lnlinks href=#hl-15-102>102</a>
</span><span class=lnt id=hl-15-103><a class=lnlinks href=#hl-15-103>103</a>
</span><span class=lnt id=hl-15-104><a class=lnlinks href=#hl-15-104>104</a>
</span><span class=lnt id=hl-15-105><a class=lnlinks href=#hl-15-105>105</a>
</span><span class=lnt id=hl-15-106><a class=lnlinks href=#hl-15-106>106</a>
</span><span class=lnt id=hl-15-107><a class=lnlinks href=#hl-15-107>107</a>
</span><span class=lnt id=hl-15-108><a class=lnlinks href=#hl-15-108>108</a>
</span><span class=lnt id=hl-15-109><a class=lnlinks href=#hl-15-109>109</a>
</span><span class=lnt id=hl-15-110><a class=lnlinks href=#hl-15-110>110</a>
</span><span class=lnt id=hl-15-111><a class=lnlinks href=#hl-15-111>111</a>
</span><span class=lnt id=hl-15-112><a class=lnlinks href=#hl-15-112>112</a>
</span><span class=lnt id=hl-15-113><a class=lnlinks href=#hl-15-113>113</a>
</span><span class=lnt id=hl-15-114><a class=lnlinks href=#hl-15-114>114</a>
</span><span class=lnt id=hl-15-115><a class=lnlinks href=#hl-15-115>115</a>
</span><span class=lnt id=hl-15-116><a class=lnlinks href=#hl-15-116>116</a>
</span><span class=lnt id=hl-15-117><a class=lnlinks href=#hl-15-117>117</a>
</span><span class=lnt id=hl-15-118><a class=lnlinks href=#hl-15-118>118</a>
</span><span class=lnt id=hl-15-119><a class=lnlinks href=#hl-15-119>119</a>
</span><span class=lnt id=hl-15-120><a class=lnlinks href=#hl-15-120>120</a>
</span><span class=lnt id=hl-15-121><a class=lnlinks href=#hl-15-121>121</a>
</span><span class=lnt id=hl-15-122><a class=lnlinks href=#hl-15-122>122</a>
</span><span class=lnt id=hl-15-123><a class=lnlinks href=#hl-15-123>123</a>
</span><span class=lnt id=hl-15-124><a class=lnlinks href=#hl-15-124>124</a>
</span><span class=lnt id=hl-15-125><a class=lnlinks href=#hl-15-125>125</a>
</span><span class=lnt id=hl-15-126><a class=lnlinks href=#hl-15-126>126</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span><span class=p>,</span> <span class=n>Column</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>String</span><span class=p>,</span> <span class=n>Numeric</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.ext.declarative</span> <span class=kn>import</span> <span class=n>declarative_base</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 데이터베이스 모델 정의</span>
</span></span><span class=line><span class=cl><span class=n>Base</span> <span class=o>=</span> <span class=n>declarative_base</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Account</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;은행 계좌 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s1>&#39;accounts&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>account_number</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>balance</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Numeric</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>owner_name</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Transaction</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;거래 기록 모델&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s1>&#39;transactions&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>from_account</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>to_account</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Numeric</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># SUCCESS, FAILED</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 데이터베이스 연결 설정</span>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=s1>&#39;postgresql://user:password@localhost/bank_db&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>SessionLocal</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>autoflush</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankingService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;은행 서비스 클래스 - 트랜잭션 관리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_db_session</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터베이스 세션 관리 컨텍스트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span> <span class=o>=</span> <span class=n>SessionLocal</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>session</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>  <span class=c1># 트랜잭션 커밋</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>  <span class=c1># 오류 시 롤백</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;트랜잭션 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transfer_money</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>from_account_number</span><span class=p>,</span> <span class=n>to_account_number</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        계좌 이체 처리 - ACID 속성 보장
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            from_account_number: 출금 계좌번호
</span></span></span><span class=line><span class=cl><span class=s2>            to_account_number: 입금 계좌번호  
</span></span></span><span class=line><span class=cl><span class=s2>            amount: 이체 금액
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            bool: 이체 성공 여부
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_db_session</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 1. 원자성(Atomicity): 모든 연산이 하나의 트랜잭션으로 처리</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 2. 일관성(Consistency): 데이터베이스 제약조건 확인</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;이체 금액은 0보다 커야 합니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 3. 격리성(Isolation): SELECT FOR UPDATE로 배타적 락 적용</span>
</span></span><span class=line><span class=cl>                <span class=n>from_account</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Account</span><span class=p>)</span>\
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>Account</span><span class=o>.</span><span class=n>account_number</span> <span class=o>==</span> <span class=n>from_account_number</span><span class=p>)</span>\
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=n>with_for_update</span><span class=p>()</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>to_account</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Account</span><span class=p>)</span>\
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>Account</span><span class=o>.</span><span class=n>account_number</span> <span class=o>==</span> <span class=n>to_account_number</span><span class=p>)</span>\
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=n>with_for_update</span><span class=p>()</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 계좌 존재 여부 확인</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>from_account</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>to_account</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;존재하지 않는 계좌입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 잔액 확인</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>from_account</span><span class=o>.</span><span class=n>balance</span> <span class=o>&lt;</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;잔액이 부족합니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 잔액 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=n>from_account</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>                <span class=n>to_account</span><span class=o>.</span><span class=n>balance</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 거래 기록 생성</span>
</span></span><span class=line><span class=cl>                <span class=n>transaction_record</span> <span class=o>=</span> <span class=n>Transaction</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>from_account</span><span class=o>=</span><span class=n>from_account_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>to_account</span><span class=o>=</span><span class=n>to_account_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>amount</span><span class=o>=</span><span class=n>amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>status</span><span class=o>=</span><span class=s2>&#34;SUCCESS&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>transaction_record</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 4. 지속성(Durability): 커밋으로 영구 저장 보장</span>
</span></span><span class=line><span class=cl>                <span class=c1># (컨텍스트 매니저에서 자동 커밋)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이체 성공: </span><span class=si>{</span><span class=n>from_account_number</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>to_account_number</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>amount</span><span class=si>}</span><span class=s2>원&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 오류 발생 시 거래 실패 기록</span>
</span></span><span class=line><span class=cl>                <span class=n>failed_transaction</span> <span class=o>=</span> <span class=n>Transaction</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>from_account</span><span class=o>=</span><span class=n>from_account_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>to_account</span><span class=o>=</span><span class=n>to_account_number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>amount</span><span class=o>=</span><span class=n>amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>status</span><span class=o>=</span><span class=s2>&#34;FAILED&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>failed_transaction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이체 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>banking_service</span> <span class=o>=</span> <span class=n>BankingService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 정상적인 이체</span>
</span></span><span class=line><span class=cl><span class=n>success</span> <span class=o>=</span> <span class=n>banking_service</span><span class=o>.</span><span class=n>transfer_money</span><span class=p>(</span><span class=s2>&#34;123-456-789&#34;</span><span class=p>,</span> <span class=s2>&#34;987-654-321&#34;</span><span class=p>,</span> <span class=mi>100000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 잔액 부족으로 실패하는 이체  </span>
</span></span><span class=line><span class=cl><span class=n>failed</span> <span class=o>=</span> <span class=n>banking_service</span><span class=o>.</span><span class=n>transfer_money</span><span class=p>(</span><span class=s2>&#34;123-456-789&#34;</span><span class=p>,</span> <span class=s2>&#34;987-654-321&#34;</span><span class=p>,</span> <span class=mi>999999999</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=162-javascript-구현-nodejs--postgresql>16.2 JavaScript 구현 (Node.js + PostgreSQL)<a hidden class=anchor aria-hidden=true href=#162-javascript-구현-nodejs--postgresql>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>  1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>  2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>  3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>  4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>  5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>  6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>  7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>  8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9>  9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10> 10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11> 11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12> 12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13> 13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14> 14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15> 15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16> 16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17> 17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18> 18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19> 19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20> 20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21> 21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22> 22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23> 23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24> 24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25> 25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26> 26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27> 27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28> 28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29> 29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30> 30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31> 31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32> 32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33> 33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34> 34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35> 35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36> 36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37> 37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38> 38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39> 39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40> 40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41> 41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42> 42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43> 43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44> 44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45> 45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46> 46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47> 47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48> 48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49> 49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50> 50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51> 51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52> 52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53> 53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54> 54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55> 55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56> 56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57> 57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58> 58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59> 59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60> 60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61> 61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62> 62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63> 63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64> 64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65> 65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66> 66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67> 67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68> 68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69> 69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70> 70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71> 71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72> 72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73> 73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74> 74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75> 75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76> 76</a>
</span><span class=lnt id=hl-16-77><a class=lnlinks href=#hl-16-77> 77</a>
</span><span class=lnt id=hl-16-78><a class=lnlinks href=#hl-16-78> 78</a>
</span><span class=lnt id=hl-16-79><a class=lnlinks href=#hl-16-79> 79</a>
</span><span class=lnt id=hl-16-80><a class=lnlinks href=#hl-16-80> 80</a>
</span><span class=lnt id=hl-16-81><a class=lnlinks href=#hl-16-81> 81</a>
</span><span class=lnt id=hl-16-82><a class=lnlinks href=#hl-16-82> 82</a>
</span><span class=lnt id=hl-16-83><a class=lnlinks href=#hl-16-83> 83</a>
</span><span class=lnt id=hl-16-84><a class=lnlinks href=#hl-16-84> 84</a>
</span><span class=lnt id=hl-16-85><a class=lnlinks href=#hl-16-85> 85</a>
</span><span class=lnt id=hl-16-86><a class=lnlinks href=#hl-16-86> 86</a>
</span><span class=lnt id=hl-16-87><a class=lnlinks href=#hl-16-87> 87</a>
</span><span class=lnt id=hl-16-88><a class=lnlinks href=#hl-16-88> 88</a>
</span><span class=lnt id=hl-16-89><a class=lnlinks href=#hl-16-89> 89</a>
</span><span class=lnt id=hl-16-90><a class=lnlinks href=#hl-16-90> 90</a>
</span><span class=lnt id=hl-16-91><a class=lnlinks href=#hl-16-91> 91</a>
</span><span class=lnt id=hl-16-92><a class=lnlinks href=#hl-16-92> 92</a>
</span><span class=lnt id=hl-16-93><a class=lnlinks href=#hl-16-93> 93</a>
</span><span class=lnt id=hl-16-94><a class=lnlinks href=#hl-16-94> 94</a>
</span><span class=lnt id=hl-16-95><a class=lnlinks href=#hl-16-95> 95</a>
</span><span class=lnt id=hl-16-96><a class=lnlinks href=#hl-16-96> 96</a>
</span><span class=lnt id=hl-16-97><a class=lnlinks href=#hl-16-97> 97</a>
</span><span class=lnt id=hl-16-98><a class=lnlinks href=#hl-16-98> 98</a>
</span><span class=lnt id=hl-16-99><a class=lnlinks href=#hl-16-99> 99</a>
</span><span class=lnt id=hl-16-100><a class=lnlinks href=#hl-16-100>100</a>
</span><span class=lnt id=hl-16-101><a class=lnlinks href=#hl-16-101>101</a>
</span><span class=lnt id=hl-16-102><a class=lnlinks href=#hl-16-102>102</a>
</span><span class=lnt id=hl-16-103><a class=lnlinks href=#hl-16-103>103</a>
</span><span class=lnt id=hl-16-104><a class=lnlinks href=#hl-16-104>104</a>
</span><span class=lnt id=hl-16-105><a class=lnlinks href=#hl-16-105>105</a>
</span><span class=lnt id=hl-16-106><a class=lnlinks href=#hl-16-106>106</a>
</span><span class=lnt id=hl-16-107><a class=lnlinks href=#hl-16-107>107</a>
</span><span class=lnt id=hl-16-108><a class=lnlinks href=#hl-16-108>108</a>
</span><span class=lnt id=hl-16-109><a class=lnlinks href=#hl-16-109>109</a>
</span><span class=lnt id=hl-16-110><a class=lnlinks href=#hl-16-110>110</a>
</span><span class=lnt id=hl-16-111><a class=lnlinks href=#hl-16-111>111</a>
</span><span class=lnt id=hl-16-112><a class=lnlinks href=#hl-16-112>112</a>
</span><span class=lnt id=hl-16-113><a class=lnlinks href=#hl-16-113>113</a>
</span><span class=lnt id=hl-16-114><a class=lnlinks href=#hl-16-114>114</a>
</span><span class=lnt id=hl-16-115><a class=lnlinks href=#hl-16-115>115</a>
</span><span class=lnt id=hl-16-116><a class=lnlinks href=#hl-16-116>116</a>
</span><span class=lnt id=hl-16-117><a class=lnlinks href=#hl-16-117>117</a>
</span><span class=lnt id=hl-16-118><a class=lnlinks href=#hl-16-118>118</a>
</span><span class=lnt id=hl-16-119><a class=lnlinks href=#hl-16-119>119</a>
</span><span class=lnt id=hl-16-120><a class=lnlinks href=#hl-16-120>120</a>
</span><span class=lnt id=hl-16-121><a class=lnlinks href=#hl-16-121>121</a>
</span><span class=lnt id=hl-16-122><a class=lnlinks href=#hl-16-122>122</a>
</span><span class=lnt id=hl-16-123><a class=lnlinks href=#hl-16-123>123</a>
</span><span class=lnt id=hl-16-124><a class=lnlinks href=#hl-16-124>124</a>
</span><span class=lnt id=hl-16-125><a class=lnlinks href=#hl-16-125>125</a>
</span><span class=lnt id=hl-16-126><a class=lnlinks href=#hl-16-126>126</a>
</span><span class=lnt id=hl-16-127><a class=lnlinks href=#hl-16-127>127</a>
</span><span class=lnt id=hl-16-128><a class=lnlinks href=#hl-16-128>128</a>
</span><span class=lnt id=hl-16-129><a class=lnlinks href=#hl-16-129>129</a>
</span><span class=lnt id=hl-16-130><a class=lnlinks href=#hl-16-130>130</a>
</span><span class=lnt id=hl-16-131><a class=lnlinks href=#hl-16-131>131</a>
</span><span class=lnt id=hl-16-132><a class=lnlinks href=#hl-16-132>132</a>
</span><span class=lnt id=hl-16-133><a class=lnlinks href=#hl-16-133>133</a>
</span><span class=lnt id=hl-16-134><a class=lnlinks href=#hl-16-134>134</a>
</span><span class=lnt id=hl-16-135><a class=lnlinks href=#hl-16-135>135</a>
</span><span class=lnt id=hl-16-136><a class=lnlinks href=#hl-16-136>136</a>
</span><span class=lnt id=hl-16-137><a class=lnlinks href=#hl-16-137>137</a>
</span><span class=lnt id=hl-16-138><a class=lnlinks href=#hl-16-138>138</a>
</span><span class=lnt id=hl-16-139><a class=lnlinks href=#hl-16-139>139</a>
</span><span class=lnt id=hl-16-140><a class=lnlinks href=#hl-16-140>140</a>
</span><span class=lnt id=hl-16-141><a class=lnlinks href=#hl-16-141>141</a>
</span><span class=lnt id=hl-16-142><a class=lnlinks href=#hl-16-142>142</a>
</span><span class=lnt id=hl-16-143><a class=lnlinks href=#hl-16-143>143</a>
</span><span class=lnt id=hl-16-144><a class=lnlinks href=#hl-16-144>144</a>
</span><span class=lnt id=hl-16-145><a class=lnlinks href=#hl-16-145>145</a>
</span><span class=lnt id=hl-16-146><a class=lnlinks href=#hl-16-146>146</a>
</span><span class=lnt id=hl-16-147><a class=lnlinks href=#hl-16-147>147</a>
</span><span class=lnt id=hl-16-148><a class=lnlinks href=#hl-16-148>148</a>
</span><span class=lnt id=hl-16-149><a class=lnlinks href=#hl-16-149>149</a>
</span><span class=lnt id=hl-16-150><a class=lnlinks href=#hl-16-150>150</a>
</span><span class=lnt id=hl-16-151><a class=lnlinks href=#hl-16-151>151</a>
</span><span class=lnt id=hl-16-152><a class=lnlinks href=#hl-16-152>152</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Pool</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;pg&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>TransactionManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>dbConfig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>pool</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Pool</span><span class=p>(</span><span class=nx>dbConfig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 트랜잭션 실행 래퍼
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {Function} operation - 실행할 데이터베이스 연산
</span></span></span><span class=line><span class=cl><span class=cm>     * @returns {Promise} 연산 결과
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>executeTransaction</span><span class=p>(</span><span class=nx>operation</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 트랜잭션 시작
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;BEGIN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 격리 수준 설정 (REPEATABLE READ)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;SET TRANSACTION ISOLATION LEVEL REPEATABLE READ&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 연산 수행
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>operation</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 트랜잭션 커밋
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;COMMIT&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 오류 발생 시 롤백
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;ROLLBACK&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 해제
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>client</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 온라인 쇼핑몰 주문 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {Object} orderData - 주문 데이터
</span></span></span><span class=line><span class=cl><span class=cm>     * @returns {Promise&lt;Object&gt;} 주문 결과
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>processOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>executeTransaction</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>client</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>,</span> <span class=nx>price</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>orderData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 1. 상품 재고 확인 및 차감 (배타적 락 적용)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>stockResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;SELECT stock FROM products WHERE id = $1 FOR UPDATE&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>productId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>stockResult</span><span class=p>.</span><span class=nx>rows</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;상품이 존재하지 않습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>currentStock</span> <span class=o>=</span> <span class=nx>stockResult</span><span class=p>.</span><span class=nx>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>stock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>currentStock</span> <span class=o>&lt;</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;재고가 부족합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 재고 차감
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;UPDATE products SET stock = stock - $1 WHERE id = $2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>quantity</span><span class=p>,</span> <span class=nx>productId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 2. 사용자 포인트 확인 및 차감
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>userResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;SELECT points FROM users WHERE id = $1 FOR UPDATE&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>userId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>userResult</span><span class=p>.</span><span class=nx>rows</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;사용자가 존재하지 않습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>currentPoints</span> <span class=o>=</span> <span class=nx>userResult</span><span class=p>.</span><span class=nx>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>points</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>totalPrice</span> <span class=o>=</span> <span class=nx>price</span> <span class=o>*</span> <span class=nx>quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>currentPoints</span> <span class=o>&lt;</span> <span class=nx>totalPrice</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;포인트가 부족합니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 포인트 차감
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;UPDATE users SET points = points - $1 WHERE id = $2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>totalPrice</span><span class=p>,</span> <span class=nx>userId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 3. 주문 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>orderResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sb>`INSERT INTO orders (user_id, product_id, quantity, price, status, created_at) 
</span></span></span><span class=line><span class=cl><span class=sb>                 VALUES ($1, $2, $3, $4, &#39;COMPLETED&#39;, NOW()) 
</span></span></span><span class=line><span class=cl><span class=sb>                 RETURNING id`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>,</span> <span class=nx>price</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=nx>orderResult</span><span class=p>.</span><span class=nx>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 4. 주문 상세 로그 기록
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sb>`INSERT INTO order_logs (order_id, action, description, created_at)
</span></span></span><span class=line><span class=cl><span class=sb>                 VALUES ($1, &#39;ORDER_CREATED&#39;, $2, NOW())`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>orderId</span><span class=p>,</span> <span class=sb>`주문 생성: 상품 </span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>, 수량 </span><span class=si>${</span><span class=nx>quantity</span><span class=si>}</span><span class=sb>, 금액 </span><span class=si>${</span><span class=nx>totalPrice</span><span class=si>}</span><span class=sb>`</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;주문이 성공적으로 처리되었습니다&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>totalPrice</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>remainingStock</span><span class=o>:</span> <span class=nx>currentStock</span> <span class=o>-</span> <span class=nx>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>remainingPoints</span><span class=o>:</span> <span class=nx>currentPoints</span> <span class=o>-</span> <span class=nx>totalPrice</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>dbConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span><span class=o>:</span> <span class=s1>&#39;your_username&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>database</span><span class=o>:</span> <span class=s1>&#39;ecommerce_db&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span><span class=o>:</span> <span class=s1>&#39;your_password&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span><span class=o>:</span> <span class=mi>5432</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>transactionManager</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TransactionManager</span><span class=p>(</span><span class=nx>dbConfig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 주문 처리 실행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>orderData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>userId</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>productId</span><span class=o>:</span> <span class=mi>101</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>quantity</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>price</span><span class=o>:</span> <span class=mi>25000</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>transactionManager</span><span class=p>.</span><span class=nx>processOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;주문 성공:&#39;</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;주문 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=17-실무에서-효과적으로-적용하기-위한-고려사항>17. 실무에서 효과적으로 적용하기 위한 고려사항<a hidden class=anchor aria-hidden=true href=#17-실무에서-효과적으로-적용하기-위한-고려사항>#</a></h3><table><thead><tr><th>분류</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>성능</td><td>트랜잭션 범위 최소화</td><td>긴 트랜잭션은 락 경합 증가</td><td>필요한 연산만 트랜잭션에 포함</td></tr><tr><td>성능</td><td>적절한 격리 수준 선택</td><td>과도한 격리는 성능 저하</td><td>비즈니스 요구사항에 맞는 최소 격리 수준 적용</td></tr><tr><td>안정성</td><td>데드락 방지 전략</td><td>순환 대기 방지</td><td>일관된 락 순서 정의, 타임아웃 설정</td></tr><tr><td>안정성</td><td>예외 처리 체계</td><td>부분 실패 상황 대응</td><td>명확한 롤백 정책과 에러 핸들링</td></tr><tr><td>모니터링</td><td>트랜잭션 로깅</td><td>문제 상황 추적</td><td>시작/종료 시점, 실행 시간, 결과 기록</td></tr><tr><td>모니터링</td><td>성능 메트릭 수집</td><td>병목점 식별</td><td>락 대기 시간, 커밋 비율, 처리량 측정</td></tr></tbody></table><hr><h3 id=18-최적화하기-위한-고려사항>18. 최적화하기 위한 고려사항<a hidden class=anchor aria-hidden=true href=#18-최적화하기-위한-고려사항>#</a></h3><table><thead><tr><th>분류</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>동시성</td><td>락 최적화</td><td>락 경합 최소화</td><td>행 레벨 락, 락 분할, 비관적/낙관적 락 적절한 선택</td></tr><tr><td>동시성</td><td>배치 처리</td><td>대량 데이터 처리 최적화</td><td>청크 단위 처리, 부분 커밋 활용</td></tr><tr><td>저장소</td><td>인덱스 최적화</td><td>빠른 데이터 접근</td><td>트랜잭션에서 자주 사용되는 컬럼에 인덱스 생성</td></tr><tr><td>저장소</td><td>로그 관리</td><td>I/O 부하 최소화</td><td>로그 버퍼링, 비동기 로그 쓰기</td></tr><tr><td>아키텍처</td><td>읽기 전용 복제본</td><td>읽기 부하 분산</td><td>읽기 전용 쿼리를 복제본으로 라우팅</td></tr><tr><td>아키텍처</td><td>분산 처리</td><td>수평 확장</td><td>샤딩, 파티셔닝으로 트랜잭션 분산</td></tr></tbody></table><hr><h3 id=19-주제와-관련하여-주목할-내용>19. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#19-주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>성능 최적화</td><td>락 메커니즘</td><td>적응적 락 관리</td><td>실행 패턴에 따라 락 전략을 동적으로 조정</td></tr><tr><td>성능 최적화</td><td>캐싱 전략</td><td>트랜잭션 캐시</td><td>읽기 전용 데이터의 캐싱으로 성능 향상</td></tr><tr><td>분산 시스템</td><td>마이크로서비스</td><td>Saga 패턴</td><td>분산 환경에서 장기 실행 트랜잭션 관리</td></tr><tr><td>분산 시스템</td><td>이벤트 소싱</td><td>이벤트 기반 아키텍처</td><td>상태 변화를 이벤트로 기록하여 복구 및 감사 지원</td></tr><tr><td>클라우드 네이티브</td><td>서버리스</td><td>함수형 트랜잭션</td><td>서버리스 환경에서의 상태 관리 및 트랜잭션 처리</td></tr><tr><td>신기술</td><td>블록체인</td><td>분산 원장 기술</td><td>탈중앙화된 트랜잭션 처리 및 스마트 컨트랙트</td></tr></tbody></table><hr><h3 id=20-반드시-학습해야할-내용>20. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#20-반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기초 이론</td><td>동시성 제어</td><td>2PL, MVCC, 타임스탬프 순서</td><td>다양한 동시성 제어 알고리즘의 이해와 적용</td></tr><tr><td>기초 이론</td><td>복구 기법</td><td>ARIES, WAL, 체크포인트</td><td>장애 복구를 위한 로그 기반 알고리즘</td></tr><tr><td>실무 기술</td><td>SQL 트랜잭션</td><td>BEGIN, COMMIT, ROLLBACK</td><td>표준 SQL 트랜잭션 명령어와 격리 수준</td></tr><tr><td>실무 기술</td><td>ORM 활용</td><td>JPA, Hibernate, SQLAlchemy</td><td>객체 관계 매핑에서의 트랜잭션 관리</td></tr><tr><td>고급 주제</td><td>분산 트랜잭션</td><td>2PC, 3PC, XA</td><td>분산 환경에서의 원자성 보장 프로토콜</td></tr><tr><td>고급 주제</td><td>NoSQL 트랜잭션</td><td>MongoDB, Cassandra</td><td>NoSQL 데이터베이스의 트랜잭션 특성과 제약사항</td></tr></tbody></table><hr><h3 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h3><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>2PC (Two-Phase Commit)</td><td>분산 트랜잭션에서 모든 참여자의 합의를 통한 커밋 프로토콜</td></tr><tr><td>기본 개념</td><td>WAL (Write-Ahead Logging)</td><td>데이터 변경 전에 로그를 먼저 기록하는 복구 기법</td></tr><tr><td>기본 개념</td><td>MVCC (Multi-Version Concurrency Control)</td><td>데이터의 여러 버전을 유지하여 동시성을 제어하는 기법</td></tr><tr><td>락 관리</td><td>2PL (Two-Phase Locking)</td><td>성장 단계와 축소 단계로 나누어 락을 관리하는 프로토콜</td></tr><tr><td>락 관리</td><td>의도 락 (Intent Lock)</td><td>하위 레벨에서 락을 설정할 의도를 상위 레벨에 표시하는 락</td></tr><tr><td>문제 상황</td><td>더티 리드 (Dirty Read)</td><td>커밋되지 않은 데이터를 읽는 현상</td></tr><tr><td>문제 상황</td><td>팬텀 리드 (Phantom Read)</td><td>동일 쿼리의 반복 실행에서 새로운 행이 나타나는 현상</td></tr><tr><td>문제 상황</td><td>논리피터블 리드 (Non-Repeatable Read)</td><td>동일 데이터의 반복 읽기에서 다른 값이 나타나는 현상</td></tr></tbody></table><hr><h3 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h3><ul><li>Database System Concepts (Abraham Silberschatz, Henry F. Korth, S. Sudarshan)</li><li>Transaction Processing: Concepts and Techniques (Jim Gray, Andreas Reuter)</li><li>PostgreSQL Documentation - Transaction Isolation</li><li>MySQL Documentation - InnoDB Locking and Transaction Model</li><li>Oracle Database Concepts - Data Concurrency and Consistency</li><li>Microsoft SQL Server Documentation - Transaction Locking and Row Versioning Guide</li><li>MongoDB Documentation - Transactions</li><li>Apache Cassandra Documentation - Lightweight Transactions</li></ul><hr><p>데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위<br>트랜잭션은 데이터베이스의 무결성을 보장하고 일관성 있는 상태를 유지하는 데 중요한 역할을 한다.</p><p>데이터베이스의 상태를 변화시키는 하나의 논리적 작업 단위를 구성하는 연산들의 집합.<br>이는 한 번에 모두 수행되어야 할 일련의 데이터베이스 연산들을 의미한다.</p><p>트랜잭션의 역할:</p><ol><li>데이터 무결성 보장: 여러 작업이 하나의 단위로 처리되어 부분적인 데이터 변경을 방지합니다.</li><li>동시성 제어: 여러 사용자가 동시에 데이터에 접근할 때 데이터의 일관성을 유지합니다.</li><li>오류 복구: 트랜잭션 실행 중 오류가 발생하면 이전 상태로 롤백하여 데이터의 안정성을 보장합니다.</li><li>복잡한 비즈니스 로직 처리: 여러 단계의 작업을 하나의 논리적 단위로 처리할 수 있게 합니다.</li></ol><p>트랜잭션의 특성 (ACID):</p><ol><li><p>원자성 (Atomicity)</p><ul><li>트랜잭션의 모든 연산이 완전히 수행되거나 전혀 수행되지 않아야 합니다</li><li>중간 단계까지 실행되다가 실패하면 처음부터 다시 시작해야 합니다</li><li>예: 계좌이체 시 출금과 입금이 모두 성공하거나, 둘 다 실패해야 합니다</li></ul></li><li><p>일관성 (Consistency)</p><ul><li>트랜잭션 실행 전과 후의 데이터베이스는 일관된 상태를 유지해야 합니다</li><li>데이터베이스의 제약조건을 위반하지 않아야 합니다</li><li>예: 계좌 잔고는 항상 0 원 이상이어야 한다는 규칙이 있다면, 이를 위반할 수 없습니다</li></ul></li><li><p>독립성 (Isolation)</p><ul><li>동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야 합니다</li><li>한 트랜잭션의 중간 결과가 다른 트랜잭션에게 보이지 않아야 합니다</li><li>예: A 가 계좌이체 중일 때 B 가 같은 계좌를 조회해도 이체 완료 전까지는 원래 금액이 보입니다</li></ul></li><li><p>지속성 (Durability)</p><ul><li>성공적으로 완료된 트랜잭션의 결과는 영구적으로 반영되어야 합니다</li><li>시스템 장애가 발생하더라도 데이터는 보존되어야 합니다</li><li>예: 계좌이체 완료 후 정전이 되어도 이체 내역은 보존됩니다</li></ul></li></ol><p>동작 과정:</p><ol><li>트랜잭션 시작: START TRANSACTION 명령으로 시작합니다.</li><li>작업 수행: 데이터베이스 작업을 실행합니다.</li><li>커밋 또는 롤백:<ul><li>모든 작업이 성공적으로 완료되면 COMMIT 을 실행하여 변경사항을 영구적으로 반영합니다.</li><li>오류 발생 시 ROLLBACK 을 실행하여 트랜잭션 시작 전 상태로 되돌립니다.</li></ul></li></ol><p>트랜잭션의 기본 구조:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 트랜잭션 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>-- 데이터베이스 작업들
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=err>작업</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>작업</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>작업</span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>            </span><span class=c1>-- 트랜잭션 완료
</span></span></span><span class=line><span class=cl><span class=c1>-- 또는
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ROLLBACK</span><span class=p>;</span><span class=w>          </span><span class=c1>-- 트랜잭션 취소
</span></span></span></code></pre></td></tr></table></div></div><p>트랜잭션의 상태 트랜잭션:</p><ul><li>Active (활동): 트랜잭션이 실행 중인 상태</li><li>Partially Committed (부분 완료): 마지막 작업이 끝났지만, 아직 커밋되지 않은 상태</li><li>Committed (완료): 트랜잭션이 성공적으로 완료된 상태</li><li>Failed (실패): 오류가 발생하여 트랜잭션이 중단된 상태</li><li>Aborted (철회): 트랜잭션이 롤백되고 데이터베이스가 원래 상태로 돌아간 상태</li></ul><p>제어 명령어:</p><ol><li><strong>BEGIN TRANSACTION</strong>: 트랜잭션 시작</li><li><strong>COMMIT</strong>: 트랜잭션 완료 및 변경사항 영구 저장</li><li><strong>ROLLBACK</strong>: 트랜잭션 취소 및 변경사항 폐기</li><li><strong>SAVEPOINT</strong>: 트랜잭션 내에 중간 저장점 생성</li></ol><p>트랜잭션의 동시성 제어:<br>여러 트랜잭션이 동시에 실행될 때 발생할 수 있는 문제를 해결하기 위해 다음과 같은 기법을 사용한다.</p><ol><li><strong>잠금 (Locking)</strong>: 공유 잠금 (Shared Lock) 과 배타적 잠금 (Exclusive Lock) 을 사용하여 동시 접근을 제어합니다.</li><li><strong>타임스탬프 기반 프로토콜</strong>: 각 트랜잭션에 고유한 타임스탬프를 부여하여 충돌을 해결합니다.</li><li><strong>다중 버전 동시성 제어 (MVCC)</strong>: 데이터의 여러 버전을 유지하여 읽기 작업의 동시성을 향상시킵니다.</li></ol><p>트랜잭션 격리 수준:<br>SQL 표준은 네 가지 트랜잭션 격리 수준을 정의한다.</p><ol><li><strong>READ UNCOMMITTED</strong>: 가장 낮은 격리 수준으로, 더티 리드가 발생할 수 있습니다.</li><li><strong>READ COMMITTED</strong>: 커밋된 데이터만 읽을 수 있지만, 반복 불가능한 읽기가 발생할 수 있습니다.</li><li><strong>REPEATABLE READ</strong>: 트랜잭션 내에서 동일한 쿼리는 항상 같은 결과를 반환하지만, 팬텀 읽기가 발생할 수 있습니다.</li><li><strong>SERIALIZABLE</strong>: 가장 높은 격리 수준으로, 완전한 일관성을 보장하지만 성능 저하가 발생할 수 있습니다.</li></ol><p>장점:</p><ul><li>데이터 무결성 보장</li><li>동시성 제어</li><li>오류 복구 용이성</li><li>복잡한 데이터베이스 연산의 단순화</li></ul><p>단점:</p><ul><li>성능 오버헤드</li><li>복잡한 구현</li><li>잠금으로 인한 동시성 저하 가능성</li></ul><h4 id=트랜잭션의-주요-특성과-고려사항>트랜잭션의 주요 특성과 고려사항<a hidden class=anchor aria-hidden=true href=#트랜잭션의-주요-특성과-고려사항>#</a></h4><ol><li><p>트랜잭션 격리 수준 (Transaction Isolation Level)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 격리 수준 설정 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SET</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=k>COMMITTED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 이 시점에서 다른 트랜잭션의 커밋된 변경사항만 볼 수 있음
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>교착상태 (Deadlock) 처리</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 교착상태 감지 및 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=n>DEADLOCK_PRIORITY</span><span class=w> </span><span class=n>LOW</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 교착상태 발생 시 이 트랜잭션이 희생됨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>table1</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>col1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value1</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>table2</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>col2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value2</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 교착상태 발생 시 자동으로 롤백됨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>중첩 트랜잭션 (Nested Transactions)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=n>outer_trans</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 외부 트랜잭션 작업
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=n>inner_trans</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>-- 내부 트랜잭션 작업
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>COMMIT</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=n>inner_trans</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 외부 트랜잭션 계속
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=n>outer_trans</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>세이브포인트 (Savepoint) 활용</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>quantity</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SAVEPOINT</span><span class=w> </span><span class=n>after_order</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 세이브포인트 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>inventory</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 재고 업데이트 실패 시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>ROLLBACK</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>after_order</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 주문 정보는 유지한 채 재고만 롤백
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=트랜잭션-설계-시-고려해야-할-실무적-팁들>트랜잭션 설계 시 고려해야 할 실무적 팁들<a hidden class=anchor aria-hidden=true href=#트랜잭션-설계-시-고려해야-할-실무적-팁들>#</a></h4><ol><li><p>트랜잭션 범위 최소화<br>트랜잭션은 가능한 한 작게 유지하여 다른 트랜잭션과의 충돌 가능성을 줄여야 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 좋지 않은 예
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 오래 걸리는 데이터 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>WHILE</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>huge_table</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>-- 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 좋은 예
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 작은 단위로 나누어 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>batch_size</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DELETE</span><span class=w> </span><span class=n>TOP</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=n>batch_size</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>huge_table</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>오류 처리<br>모든 트랜잭션은 적절한 오류 처리 로직을 포함해야 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=n>TRY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>-- 트랜잭션 로직
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=n>TRY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w> </span><span class=n>CATCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IF</span><span class=w> </span><span class=o>@@</span><span class=n>TRANCOUNT</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 오류 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>error_logs</span><span class=w> </span><span class=p>(</span><span class=n>error_message</span><span class=p>,</span><span class=w> </span><span class=n>error_time</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>ERROR_MESSAGE</span><span class=p>(),</span><span class=w> </span><span class=n>GETDATE</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 오류 재발생
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>THROW</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=n>CATCH</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>성능 모니터링<br>트랜잭션의 성능을 모니터링하고 최적화하는 것이 중요.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3>3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4>4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5>5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6>6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7>7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 트랜잭션 성능 모니터링 쿼리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>session_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>transaction_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>transaction_begin_time</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DATEDIFF</span><span class=p>(</span><span class=k>SECOND</span><span class=p>,</span><span class=w> </span><span class=n>transaction_begin_time</span><span class=p>,</span><span class=w> </span><span class=n>GETDATE</span><span class=p>())</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>duration_seconds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>dm_tran_active_transactions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>transaction_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 사용자 트랜잭션만 조회
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=예제>예제<a hidden class=anchor aria-hidden=true href=#예제>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 온라인 쇼핑몰의 주문 처리 트랜잭션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SAVEPOINT</span><span class=w> </span><span class=n>order_start</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 중간 저장점 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>TRY</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 1. 재고 확인 및 감소
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=o>@</span><span class=n>ordered_quantity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>product_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=o>@</span><span class=n>ordered_quantity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IF</span><span class=w> </span><span class=o>@@</span><span class=n>ROWCOUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=n>THROW</span><span class=w> </span><span class=mi>50001</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;재고 부족&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 2. 주문 정보 저장
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>quantity</span><span class=p>,</span><span class=w> </span><span class=n>total_amount</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>ordered_quantity</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>total_amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 3. 사용자 포인트 차감
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>users</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=n>points</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>points</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=o>@</span><span class=n>used_points</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>user_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>points</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=o>@</span><span class=n>used_points</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IF</span><span class=w> </span><span class=o>@@</span><span class=n>ROWCOUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=n>THROW</span><span class=w> </span><span class=mi>50002</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;포인트 부족&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 4. 결제 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>payments</span><span class=w> </span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=n>payment_method</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>payment_method</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>total_amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>COMMIT</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CATCH</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ROLLBACK</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>order_start</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 오류 로깅 및 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>error_logs</span><span class=w> </span><span class=p>(</span><span class=n>error_message</span><span class=p>,</span><span class=w> </span><span class=n>error_time</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>ERROR_MESSAGE</span><span class=p>(),</span><span class=w> </span><span class=n>GETDATE</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>데이터베이스에서 트랜잭션은 데이터베이스의 상태를 변화시키는 논리적 작업 단위이다.</p><p>트랜잭션은 데이터베이스의 무결성과 일관성을 보장하는 핵심 개념으로 ACID 속성을 통해 데이터의 신뢰성을 보장하며, 다양한 격리 수준을 통해 동시성 제어가 가능하다. 현대 데이터베이스 시스템은 대부분 트랜잭션을 지원하며, 각 시스템마다 구현 방식과 기능에 차이가 있다.</p><p>트랜잭션을 올바르게 이해하고 적용하면 데이터 일관성을 유지하면서도 시스템의 성능과 확장성을 최적화할 수 있다. 특히 금융, 전자상거래, 재고 관리와 같은 중요한 비즈니스 시스템에서는 트랜잭션의 올바른 구현이 필수적이다.</p><h4 id=트랜잭션의-기본-개념>트랜잭션의 기본 개념<a hidden class=anchor aria-hidden=true href=#트랜잭션의-기본-개념>#</a></h4><p>트랜잭션은 데이터베이스의 무결성을 보장하기 위한 핵심 메커니즘이다.</p><p>은행 시스템을 예로 들어보면 계좌에서 1 만원을 인출하는 과정은 다음과 같은 단계로 구성된다:</p><ol><li>계좌 잔액 확인</li><li>잔액에서 1 만원 차감</li><li>새로운 잔액 저장</li><li>현금 지급<br>이 모든 단계가 하나의 트랜잭션을 구성하며, 모든 단계가 성공적으로 완료되거나 아무것도 실행되지 않아야 한다.<br>만약 3 단계에서 시스템이 실패한다면, 계좌에서 돈은 차감되었지만 실제로 돈을 받지 못하는 상황이 발생할 수 있다. 트랜잭션은 이러한 불일치 상황을 방지한다.</li></ol><h4 id=트랜잭션의-acid-속성>트랜잭션의 ACID 속성<a hidden class=anchor aria-hidden=true href=#트랜잭션의-acid-속성>#</a></h4><p>데이터베이스 트랜잭션은 다음과 같은 ACID 속성을 갖는다:</p><ol><li><p>원자성 (Atomicity)<br>트랜잭션의 모든 연산은 완전히 수행되거나 전혀 수행되지 않아야 한다. 중간 상태는 존재하지 않는다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>10000</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>10000</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;B&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>위 트랜잭션에서 첫 번째 UPDATE 는 성공했지만 두 번째 UPDATE 가 실패한다면, 첫 번째 UPDATE 도 취소되어야 한다.</p></li><li><p>일관성 (Consistency)<br>트랜잭션이 완료된 후에도 데이터베이스는 일관된 상태를 유지해야 한다. 모든 무결성 제약조건이 만족되어야 한다. 예를 들어, 계좌 잔액이 항상 0 이상이어야 한다는 제약이 있다면, 트랜잭션 실행 후에도 이 조건은 유지되어야 한다.</p></li><li><p>고립성 (Isolation)<br>여러 트랜잭션이 동시에 실행될 때, 각 트랜잭션은 다른 트랜잭션의 연산에 영향을 받지 않고 독립적으로 실행되어야 한다.</p></li><li><p>지속성 (Durability)<br>트랜잭션이 성공적으로 완료 (커밋) 된 후에는 그 결과가 시스템 장애가 발생하더라도 영구적으로 반영되어야 한다.</p></li></ol><h4 id=트랜잭션-제어-명령어>트랜잭션 제어 명령어<a hidden class=anchor aria-hidden=true href=#트랜잭션-제어-명령어>#</a></h4><p>SQL 에서는 다음과 같은 명령어로 트랜잭션을 제어한다:</p><ol><li><p>BEGIN TRANSACTION (또는 START TRANSACTION)<br>트랜잭션의 시작을 표시한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>COMMIT<br>트랜잭션의 모든 변경사항을 데이터베이스에 영구적으로 저장한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>ROLLBACK<br>트랜잭션의 모든 변경사항을 취소하고 트랜잭션 시작 전 상태로 되돌린다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>SAVEPOINT<br>트랜잭션 내에서 특정 지점을 표시하여, 나중에 해당 지점으로 롤백할 수 있게 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>SAVEPOINT</span><span class=w> </span><span class=n>save1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 일부 연산 실행 후
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ROLLBACK</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>save1</span><span class=p>;</span><span class=w> </span><span class=c1>-- save1 지점으로 롤백
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=트랜잭션-격리-수준>트랜잭션 격리 수준<a hidden class=anchor aria-hidden=true href=#트랜잭션-격리-수준>#</a></h4><p>동시에 여러 트랜잭션이 실행될 때, 트랜잭션 간의 격리 정도를 정의한다.</p><p>표준 SQL 은 네 가지 격리 수준을 정의한다:</p><ol><li><p>READ UNCOMMITTED<br>가장 낮은 격리 수준으로, 한 트랜잭션이 다른 트랜잭션의 커밋되지 않은 변경사항을 읽을 수 있다. 이로 인해 &rsquo; 더티 리드 (Dirty Read)&rsquo; 가 발생할 수 있다.</p></li><li><p>READ COMMITTED<br>각 트랜잭션은 다른 트랜잭션이 커밋한 데이터만 읽을 수 있다. 그러나 &rsquo; 반복 불가능한 읽기 (Non-repeatable Read)&rsquo; 가 발생할 수 있다.</p></li><li><p>REPEATABLE READ<br>트랜잭션이 읽은 데이터는 트랜잭션이 완료될 때까지 다른 트랜잭션에 의해 변경될 수 없다. 그러나 &rsquo; 팬텀 읽기 (Phantom Read)&rsquo; 가 발생할 수 있다.</p></li><li><p>SERIALIZABLE<br>가장 높은 격리 수준으로, 트랜잭션이 완전히 격리되어 동시성 문제가 발생하지 않는다. 그러나 성능이 저하될 수 있다.</p></li></ol><p>격리 수준 설정 예:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=k>COMMITTED</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=트랜잭션-관련-문제>트랜잭션 관련 문제<a hidden class=anchor aria-hidden=true href=#트랜잭션-관련-문제>#</a></h4><ol><li><p>더티 리드 (Dirty Read)<br>한 트랜잭션이 아직 커밋되지 않은 다른 트랜잭션의 데이터를 읽는 경우.</p></li><li><p>반복 불가능한 읽기 (Non-repeatable Read)<br>트랜잭션 내에서 같은 쿼리를 두 번 실행했을 때, 다른 트랜잭션의 커밋으로 인해 결과가 달라지는 경우.</p></li><li><p>팬텀 읽기 (Phantom Read)<br>트랜잭션 내에서 같은 쿼리를 두 번 실행했을 때, 다른 트랜잭션의 삽입 또는 삭제로 인해 결과 집합이 달라지는 경우.</p></li></ol><h4 id=다양한-dbms-의-트랜잭션-구현>다양한 DBMS 의 트랜잭션 구현<a hidden class=anchor aria-hidden=true href=#다양한-dbms-의-트랜잭션-구현>#</a></h4><h5 id=mysql-innodb>MySQL (InnoDB)<a hidden class=anchor aria-hidden=true href=#mysql-innodb>#</a></h5><p>InnoDB 스토리지 엔진은 ACID 트랜잭션을 완벽하게 지원한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- SQL 명령어들
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>기본 격리 수준은 REPEATABLE READ 이다.</p><h5 id=postgresql>PostgreSQL<a hidden class=anchor aria-hidden=true href=#postgresql>#</a></h5><p>PostgreSQL 은 모든 격리 수준을 지원하며, 기본 격리 수준은 READ COMMITTED 이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- SQL 명령어들
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=sql-server>SQL Server<a hidden class=anchor aria-hidden=true href=#sql-server>#</a></h5><p>SQL Server 는 모든 트랜잭션 격리 수준을 지원하며, 추가로 SNAPSHOT 격리 수준도 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- SQL 명령어들
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=oracle>Oracle<a hidden class=anchor aria-hidden=true href=#oracle>#</a></h5><p>Oracle 은 READ UNCOMMITTED 를 제외한 모든 격리 수준을 지원합니다. 기본 격리 수준은 READ COMMITTED 이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1>1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2>2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- SQL 명령어들
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=트랜잭션의-실제-적용-사례>트랜잭션의 실제 적용 사례<a hidden class=anchor aria-hidden=true href=#트랜잭션의-실제-적용-사례>#</a></h4><h5 id=금융-시스템>금융 시스템<a hidden class=anchor aria-hidden=true href=#금융-시스템>#</a></h5><p>계좌 이체는 트랜잭션의 대표적인 사례:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 출금 계좌에서 금액 차감
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100000</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 입금 계좌에 금액 추가
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>100000</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;B&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 거래 내역 기록
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>transactions</span><span class=p>(</span><span class=n>from_account</span><span class=p>,</span><span class=w> </span><span class=n>to_account</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=nb>date</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;B&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>100000</span><span class=p>,</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=재고-관리-시스템>재고 관리 시스템<a hidden class=anchor aria-hidden=true href=#재고-관리-시스템>#</a></h5><p>제품 주문 처리:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 재고 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>quantity</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>inventory</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>123</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 재고 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>inventory</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>quantity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>quantity</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>123</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 주문 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>quantity</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>456</span><span class=p>,</span><span class=w> </span><span class=mi>123</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=트랜잭션-성능-최적화-팁>트랜잭션 성능 최적화 팁<a hidden class=anchor aria-hidden=true href=#트랜잭션-성능-최적화-팁>#</a></h4><ol><li><p><strong>트랜잭션은 가능한 짧게 유지하세요.</strong><br>긴 트랜잭션은 잠금 경합과 데이터베이스 리소스를 과도하게 사용할 수 있다.</p></li><li><p><strong>불필요한 작업은 트랜잭션 외부로 이동하세요.</strong><br>데이터 조회만 필요한 경우 트랜잭션이 필요하지 않을 수 있다.</p></li><li><p><strong>적절한 격리 수준을 선택하세요.</strong><br>모든 상황에 SERIALIZABLE 이 필요하지는 않다. 애플리케이션 요구사항에 맞는 최소한의 격리 수준을 선택한다.</p></li><li><p><strong>데드락을 방지하기 위해 항상 같은 순서로 테이블에 접근하세요.</strong><br>여러 테이블에 접근할 때 일관된 순서를 유지하면 데드락 가능성이 줄어든다.</p></li><li><p><strong>트랜잭션 로그 관리에 주의하세요.</strong><br>대용량 트랜잭션은 로그 파일을 급격히 증가시킬 수 있다.</p></li></ol><h4 id=분산-트랜잭션>분산 트랜잭션<a hidden class=anchor aria-hidden=true href=#분산-트랜잭션>#</a></h4><p>여러 데이터베이스 또는 시스템에 걸쳐 있는 트랜잭션을 처리하기 위한 방법.</p><ol><li>2 단계 커밋 (Two-Phase Commit)<br>분산 트랜잭션의 일관성을 보장하기 위한 프로토콜로, 준비 단계와 커밋 단계로 구성된다:<ol><li><strong>준비 단계</strong>: 모든 참여 노드가 트랜잭션을 커밋할 준비가 되었는지 확인</li><li><strong>커밋 단계</strong>: 모든 노드가 준비되었다면 실제 커밋 실행</li></ol></li><li>보상 트랜잭션 (Compensating Transaction)<br>마이크로서비스 아키텍처에서 주로 사용되는 방식으로, 트랜잭션이 실패할 경우 이미 수행된 작업을 취소하는 별도의 트랜잭션을 실행한다.</li></ol><hr><h3 id=-용어-정리>## 용어 정리<a hidden class=anchor aria-hidden=true href=#-용어-정리>#</a></h3><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h3 id=참고-및-출처-4>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-4>#</a></h3><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/databases/>Databases</a></li><li><a href=https://buenhyden.github.io/tags/more-about-databases/>More-About-Databases</a></li><li><a href=https://buenhyden.github.io/tags/transactions/>Transactions</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/devops-and-platform-engineering/version-control-systems/advanced-topics/gitops-and-iac/><span class=title>« Prev</span><br><span>GitOps and IaC</span>
</a><a class=next href=https://buenhyden.github.io/posts/system-design/database-systems/database-fundamentals/database-concepts/acid-properties/acid/><span class=title>Next »</span><br><span>ACID</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>